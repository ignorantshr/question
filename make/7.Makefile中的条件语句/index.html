<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>7.Makefile中的条件语句 - Work Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u4f8b\u5b50", url: "#_top", children: [
          ]},
          {title: "\u8bed\u6cd5", url: "#_2", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p>不能用于控制<em>recipes</em>。</p>
<p><strong>warning</strong>：不能在Makefile.am中使用。</p>
<h2 id="_1">例子</h2>
<pre><code>libs_for_gcc = -lgnu
normal_libs =

foo: $(objects)
ifeq ($(CC),gcc)
        $(CC) -o foo $(objects) $(libs_for_gcc)
else
        $(CC) -o foo $(objects) $(normal_libs)
endif
</code></pre>

<p>带有<code>tab</code>才能算作recipe，这里的条件语句被当作文本来看待。</p>
<h2 id="_2">语法</h2>
<pre><code>conditional-directive-one
text-if-one-is-true
else conditional-directive-two
text-if-two-is-true
...
else
text-if-one-and-two-are-false
endif
</code></pre>

<p>else可省略。</p>
<p>测试变量是否相等，有五种条件<code>conditional-directive</code>的写法：</p>
<pre><code>ifeq (arg1, arg2)
ifeq 'arg1' 'arg2'
ifeq &quot;arg1&quot; &quot;arg2&quot;
ifeq &quot;arg1&quot; 'arg2'
ifeq 'arg1' &quot;arg2&quot;
</code></pre>

<p>测试变量是否为空值（类似于""）：</p>
<pre><code>ifeq ($(strip $(foo)),)
text-if-empty
endif
</code></pre>

<p>测试变量是否不等，也有五种写法：</p>
<pre><code>ifneq (arg1, arg2)
ifneq 'arg1' 'arg2'
ifneq &quot;arg1&quot; &quot;arg2&quot;
ifneq &quot;arg1&quot; 'arg2'
ifneq 'arg1' &quot;arg2&quot;
</code></pre>

<pre><code>ifdef variable-name
</code></pre>

<p>ifdef获取变量的名字作为参数，而不是变量值的引用。如果变量的值是非空的，则执行<code>text-if-true</code>。
<em>variable-name</em>是可扩展的，所以其可以是一个扩展成一个变量名的变量或函数。
<em>note</em>：<em>ifdef</em>只测试值是否为非空。所以除了像这样定义的变量：<code>foo =</code>，都会返回真。
如果想测试空值，使用<em>ifeq</em>。</p>
<p>例如：</p>
<pre><code>bar =
foo = $(bar)
ifdef foo
frobozz = yes
else
frobozz = no
endif
</code></pre>

<p>结果是：frobozz = yes</p>
<pre><code>foo =
ifdef foo
frobozz = yes
else
frobozz = no
endif
</code></pre>

<p>结果是：frobozz = no</p>
<pre><code>ifndef variable-name
</code></pre>

<p>与<em>ifdef</em>相反。</p>
<p>make是在读取Makefile的时候判断条件的，所以不能在条件的测试中使用自动变量，因为直到recipes运行时他们才被定义。参考<a href="../10.使用隐含规则/">自动变量</a></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../8.转换文本函数/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../8.转换文本函数/" class="btn btn-xs btn-link">
        8.转换文本函数
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../6.变量/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../6.变量/" class="btn btn-xs btn-link">
        6.变量
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>