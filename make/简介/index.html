<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>简介 - Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Makefile\u4ecb\u7ecd", url: "#_top", children: [
              {title: "\u89c4\u5219\u4ecb\u7ecd", url: "#_1" },
              {title: "make\u5982\u4f55\u6267\u884cMakefile", url: "#makemakefile" },
              {title: "\u4f7f\u7528\u53d8\u91cf", url: "#_2" },
              {title: "\u8ba9make\u63a8\u6d4brecipe", url: "#makerecipe" },
              {title: "Makefile\u7684\u53e6\u4e00\u79cd\u98ce\u683c", url: "#makefile_1" },
              {title: "\u6e05\u7406\u6587\u4ef6\u5939\u7684\u89c4\u5219", url: "#_3" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../m4/11.文本处理的宏/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../m4/11.文本处理的宏/" class="btn btn-xs btn-link">
        11.文本处理的宏
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../8.转换文本函数/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../8.转换文本函数/" class="btn btn-xs btn-link">
        8.转换文本函数
      </a>
    </div>
    
  </div>

    

    <p><code>make</code>指明了一个大程序的哪一部分需要重新构建，然后发出命令来重新编译它们。</p>
<h1 id="makefile">Makefile介绍</h1>
<p><code>Makefile</code>文件告诉make如何编译和链接一个程序。</p>
<h2 id="_1">规则介绍</h2>
<p><em>rule</em>模型</p>
<pre><code class="make">target … : prerequisites …
        recipe
        …
        …
</code></pre>

<p><em>target</em>通常是被一个程序生成的文件名（可执行的），也可以是一个可执行的动作。</p>
<p><em>prerequisites</em>是输入文件。</p>
<p><em>recipe</em>是将要执行的动作。需要在每行的开头键入一个tab字符。
通常一个<em>recipe</em>是一个带有先决条件和表现的规则来创建一个目标文件如果任何条件发生改变。但是，为目标指定一个<em>recipe</em>的<em>rule</em>不需要先决条件。</p>
<p><em>rule</em>解释如何、何时重新构建某些特定规则的目标文件。make执行带有<em>prerequisites</em>的<em>recipe</em>创建、更新目标；<em>rule</em>也可以解释如何、何时执行动作。</p>
<p>Makefile还可以包含除了规则以外的其他文本。</p>
<p>那些不引用文件仅仅是操作的目标称为<em>phony targets</em>（伪目标）。 See <a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">Phony Targets</a>。</p>
<p>See <a href="https://www.gnu.org/software/make/manual/make.html#Errors">Errors in Recipes</a>查看如何忽略错误。</p>
<h2 id="makemakefile">make如何执行Makefile</h2>
<p>make默认伴随着第一个目标开始。叫做<em>default goal</em>。<em>Goals</em>是make最终要更新的目标。</p>
<p>执行<em>rule</em>之前，需要满足<em>prerequisites</em>，所以会先执行满足<em>prerequisites</em>的<em>rule</em>。</p>
<pre><code class="make">objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)
main.o : main.c defs.h
        cc -c main.c
kbd.o : kbd.c defs.h command.h
        cc -c kbd.c
command.o : command.c defs.h command.h
        cc -c command.c
display.o : display.c defs.h buffer.h
        cc -c display.c
insert.o : insert.c defs.h buffer.h
        cc -c insert.c
search.o : search.c defs.h buffer.h
        cc -c search.c
files.o : files.c defs.h buffer.h command.h
        cc -c files.c
utils.o : utils.c defs.h
        cc -c utils.c
clean :
        rm edit $(objects)
</code></pre>

<h2 id="_2">使用变量</h2>
<p>定义变量：</p>
<pre><code class="make">objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o
</code></pre>

<p>使用变量：</p>
<pre><code class="make">$(objects)
</code></pre>

<h2 id="makerecipe">让make推测recipe</h2>
<p>例子：
不必为了单个C源文件拼写<code>recipe</code>，因为make可以自动地解决：它有<em>implicit rule</em>（隐含规则）使用<code>cc -c</code>命令更新一个<code>.o</code>文件从相关的<code>.c</code>文件。</p>
<pre><code class="make">objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)

main.o : defs.h
kbd.o : defs.h command.h
command.o : defs.h command.h
display.o : defs.h buffer.h
insert.o : defs.h buffer.h
search.o : defs.h buffer.h
files.o : defs.h buffer.h command.h
utils.o : defs.h

.PHONY : clean
clean :
        rm edit $(objects)
</code></pre>

<h2 id="makefile_1">Makefile的另一种风格</h2>
<p>当Makefile文件只由<em>implicit rule</em>组成时，可以写成另一种的风格：通过他们的<em>prerequisites</em>将对象分组而不是他们的<em>targets</em>。</p>
<pre><code class="make">objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)

$(objects) : defs.h
kbd.o command.o files.o : command.h
display.o insert.o search.o files.o : buffer.h
</code></pre>

<h2 id="_3">清理文件夹的规则</h2>
<pre><code class="make">.PHONY : clean
clean :
        -rm edit $(objects)
</code></pre>

<p>防止make被一个叫做<em>clean</em>的文件弄糊涂，并使其在出错的情况下继续执行。</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../m4/11.文本处理的宏/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../m4/11.文本处理的宏/" class="btn btn-xs btn-link">
        11.文本处理的宏
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../8.转换文本函数/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../8.转换文本函数/" class="btn btn-xs btn-link">
        8.转换文本函数
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>