<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>4.初始化和输出文件 - Work Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "4.1 \u521d\u59cb\u5316 configure", url: "#_top", children: [
              {title: "AC_INIT (package, version, [bug-report], [tarname], [url])", url: "#ac_init-package-version-bug-report-tarname-url" },
          ]},
          {title: "4.2 \u89e3\u51b3Autoconf\u7684\u7248\u672c", url: "#42-autoconf", children: [
              {title: "AC_PREREQ (version)", url: "#ac_prereq-version" },
          ]},
          {title: "4.4 \u627e\u5230 configure \u7684\u8f93\u5165", url: "#44-configure", children: [
              {title: "AC_CONFIG_SRCDIR (unique-file-in-source-dir)", url: "#ac_config_srcdir-unique-file-in-source-dir" },
              {title: "AC_CONFIG_AUX_DIR (dir)", url: "#ac_config_aux_dir-dir" },
              {title: "AC_REQUIRE_AUX_FILE (file)", url: "#ac_require_aux_file-file" },
              {title: "AC_CONFIG_MACRO_DIR (dir)", url: "#ac_config_macro_dir-dir" },
          ]},
          {title: "4.5 \u8f93\u51fa\u6587\u4ef6", url: "#45", children: [
              {title: "AC_OUTPUT ([file]..., [extra-cmds], [init-cmds])", url: "#ac_output-file-extra-cmds-init-cmds" },
              {title: "AC_OUTPUT", url: "#ac_output" },
              {title: "AC_PROG_MAKE_SET", url: "#ac_prog_make_set" },
          ]},
          {title: "4.6 \u6267\u884c\u914d\u7f6e\u52a8\u4f5c", url: "#46", children: [
          ]},
          {title: "4.7 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6", url: "#47", children: [
              {title: "AC_CONFIG_FILES (file..., [cmds], [init-cmds])", url: "#ac_config_files-file-cmds-init-cmds" },
          ]},
          {title: "4.8 Makefile\u4e2d\u7684\u66ff\u6362", url: "#48-makefile", children: [
              {title: "4.8.1 \u9884\u7f6e\u8f93\u51fa\u53d8\u91cf", url: "#481" },
              {title: "4.8.2 \u5b89\u88c5\u76ee\u5f55\u53d8\u91cf", url: "#482" },
          ]},
          {title: "4.9 \u914d\u7f6e\u5934\u6587\u4ef6", url: "#49", children: [
              {title: "AC_CONFIG_HEADERS (header ..., [cmds], [init-cmds])", url: "#ac_config_headers-header-cmds-init-cmds" },
          ]},
          {title: "4.10 \u8fd0\u884c\u4efb\u610f\u914d\u7f6e\u547d\u4ee4", url: "#410", children: [
              {title: "AC_CONFIG_COMMANDS (tag..., [cmds], [init-cmds])", url: "#ac_config_commands-tag-cmds-init-cmds" },
              {title: "AC_CONFIG_COMMANDS_PRE (cmds)", url: "#ac_config_commands_pre-cmds" },
              {title: "AC_CONFIG_COMMANDS_POST (cmds)", url: "#ac_config_commands_post-cmds" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h2 id="41-configure">4.1 初始化 configure</h2>
<h4 id="ac_init-package-version-bug-report-tarname-url">AC_INIT <em>(package, version, [bug-report], [tarname], [url])</em></h4>
<p>第一个要执行的宏。设置程序名、版本号、联系方式...。他们都应该是静态的参数，不能是shell参数、引用或者新行，但是可以通过m4计算出来。</p>
<pre><code class="autoconf">AC_INIT([vdsm],
        [m4_esyscmd([build-aux/pkg-version --version])],
        [vdsm-devel@lists.fedorahosted.org])
</code></pre>

<h2 id="42-autoconf">4.2 解决Autoconf的版本</h2>
<p>选择最低的Autoconf的版本确保可以成功的编译<code>configure.ac</code>。</p>
<h4 id="ac_prereq-version">AC_PREREQ <em>(version)</em></h4>
<p>要求Autoconf的最低版本，如果不满足则报错并退出。必须在<code>AC_INIT</code>之前定义。</p>
<pre><code>AC_PREREQ([2.69])
</code></pre>

<h2 id="44-configure">4.4 找到 configure 的输入</h2>
<h4 id="ac_config_srcdir-unique-file-in-source-dir">AC_CONFIG_SRCDIR <em>(unique-file-in-source-dir)</em></h4>
<p><em>unique-file-in-source-dir</em>是包的源码目录下的某些文件。configure检查这些文件确保目录包含源码。</p>
<h4 id="ac_config_aux_dir-dir">AC_CONFIG_AUX_DIR <em>(dir)</em></h4>
<p>辅助构建工具（e.g., install-sh, config.sub, config.guess, Cygnus configure, Automake and Libtool scripts, etc.）所在的目录。<em>dir</em>可以是<em>srcdir</em>的绝对或相对路径，通常命名为<code>build-aux</code>。</p>
<pre><code class="autoconf">AC_CONFIG_AUX_DIR([build-aux])
</code></pre>

<h4 id="ac_require_aux_file-file">AC_REQUIRE_AUX_FILE <em>(file)</em></h4>
<p>声明<em>file</em>必须在上述定义的文件夹中必须存在。</p>
<pre><code>AC_REQUIRE_AUX_FILE([tap-driver.sh])
</code></pre>

<h4 id="ac_config_macro_dir-dir">AC_CONFIG_MACRO_DIR <em>(dir)</em></h4>
<p>指定<em>dir</em>作为额外的Autoconf宏的定位。</p>
<p><em>note</em>：如果在Automake中使用<code>aclocal</code>生成<code>aclocal.m4</code>文件，必须在顶级的Makefile.am文件中设置<code>ACLOCAL_AMFLAGS = -I dir</code>。</p>
<h2 id="45">4.5 输出文件</h2>
<h4 id="ac_output-file-extra-cmds-init-cmds">AC_OUTPUT <em>([file]..., [extra-cmds], [init-cmds])</em></h4>
<p>不推荐使用这个废弃的接口，用以下三个宏代替：</p>
<pre><code>      AC_CONFIG_FILES(file...)
      AC_CONFIG_COMMANDS([default],
                         extra-cmds, init-cmds)
      AC_OUTPUT
</code></pre>
<h4 id="ac_output">AC_OUTPUT</h4>
<p>生成config.status并启动它。configure.ac应该以调用此宏结束。
config.status执行所有的配置动作：所有的输出文件、头文件、命令、链接、要配置的子目录</p>
<h4 id="ac_prog_make_set">AC_PROG_MAKE_SET</h4>
<p>如果Make命令、$MAKE被设置或者其他<code>make</code>，预定义了<code>$(MAKE)</code>，定义输出变量<code>SET_MAKE</code>将是空值。否则将SET_MAKE定义为设置$(MAKE)的宏定义。</p>
<h2 id="46">4.6 执行配置动作</h2>
<p>configure实际上还有一个隐藏的子文件config.status。configure检查系统，config.status基于检查的结果执行相应的操作。</p>
<h2 id="47">4.7 创建配置文件</h2>
<h4 id="ac_config_files-file-cmds-init-cmds">AC_CONFIG_FILES <em>(file..., [cmds], [init-cmds])</em></h4>
<p>让<code>AC_OUTPUT</code>通过复制输入文件（默认是<em>file.in</em>文件）并代替里面的变量的值来创建每一个<em>file</em>。通常用于生成Makefile，但也可以指定其它文件。</p>
<pre><code>      AC_CONFIG_FILES([Makefile src/Makefile man/Makefile X/Imakefile])
      AC_CONFIG_FILES([autoconf], [chmod +x autoconf])
</code></pre>
<p>冒号分隔指定输入文件：</p>
<pre><code>      AC_CONFIG_FILES([Makefile:boiler/top.mk:boiler/bot.mk]
                      [lib/Makefile:boiler/lib.mk])
</code></pre>
<h2 id="48-makefile">4.8 Makefile中的替换</h2>
<p>被替换到输出文件的变量称作<em>output variables</em>。</p>
<h3 id="481">4.8.1 预置输出变量</h3>
<ul>
<li>CFLAGS - C编译器的调试和优化选项。</li>
<li>builddir - 等于<code>.</code>。</li>
<li>abs_builddir - <em>builddir</em>的绝对名称。</li>
<li>top_builddir - 当前目录相对于顶级目录的相对路径。在顶级目录与<code>builddir</code>相等。</li>
<li>top_build_prefix - 当前目录相对于顶级目录的相对路径，带有<code>/</code>如果不为空。帮助make在顶级构建目录区别对待<code>./file</code>和<code>file</code>。</li>
<li>abs_top_builddir - <em>top_builddir</em>的绝对名称。</li>
<li>srcdir - 对于makefile包含了源码的目录。</li>
<li>abs_srcdir - <em>srcdir</em>的绝对名称。</li>
<li>top_srcdir - 对于package包含了源码的顶级目录。在顶级目录的的configure.ac中没有用处，是空值！！！；在子目录的configure.ac和Makefile.am中才能发挥作用。</li>
<li>abs_top_srcdir - 对于package包含了源码的顶级目录的绝对名称。
更多说明请参考<a href="https://www.gnu.org/software/autoconf/manual/autoconf.html#Preset-Output-Variables">Preset Output Variables</a>。</li>
</ul>
<h3 id="482">4.8.2 安装目录变量</h3>
<p>后缀<code>/</code>被删除，例如<em>${prefix}/lib</em>。</p>
<ul>
<li>bindir - 可执行文件的安装目录。</li>
<li>datadir - 安装特殊的只读、架构依赖的数据文件目录。</li>
<li>datarootdir - 只读架构依赖数据文件的根目录。通常是<code>/usr/local/share</code>，但是写作<code>$(prefix)/share</code>(如果使用Autoconf，写作<code>@datarootdir@</code>，其余变量同理)。</li>
<li>docdir - 文档文件。</li>
<li>exec_prefix - 架构依赖文件的安装前缀。默认情况下与<em>prefix</em>相同。</li>
<li>includedir - 安装C的头文件</li>
<li>infodir - Info格式的文档</li>
<li>libdir - 对象代码库文件</li>
<li>libexecdir - 其它程序运行的可执行文件</li>
<li>mandir - man格式文档的安装顶级目录</li>
<li>prefix - 所有文件的安装前缀。</li>
<li>sbindir - 系统administrators运行的可运行文件的安装目录。
更加详细的说明参考<a href="https://www.gnu.org/software/autoconf/manual/standards.html#Directory-Variables">Variables for Installation Directories</a>。</li>
</ul>
<h2 id="49">4.9 配置头文件</h2>
<h4 id="ac_config_headers-header-cmds-init-cmds">AC_CONFIG_HEADERS <em>(header ..., [cmds], [init-cmds])</em></h4>
<p>让<code>AC_OUTPUT</code>创建一个头文件，该文件列出一系列的<code>#define</code>声明；赋值<code>DEFS=-DHAVE_CONFIG_H</code>。通常头文件<em>header</em>的名字是<em>config.h</em>。</p>
<p>一般输入源是<code>header.in</code>，可以采用冒号分隔符来指定输入来源。</p>
<pre><code>AC_CONFIG_HEADERS([config.h:config.hin])
</code></pre>

<h2 id="410">4.10 运行任意配置命令</h2>
<h4 id="ac_config_commands-tag-cmds-init-cmds">AC_CONFIG_COMMANDS <em>(tag..., [cmds], [init-cmds])</em></h4>
<p>config.status结束的时候执行额外的命令。
下面两个类似的宏是由configure执行的，不能使用config.status来重新运行它们。</p>
<h4 id="ac_config_commands_pre-cmds">AC_CONFIG_COMMANDS_PRE <em>(cmds)</em></h4>
<p>创建config.status之前执行。</p>
<h4 id="ac_config_commands_post-cmds">AC_CONFIG_COMMANDS_POST <em>(cmds)</em></h4>
<p>创建config.status之后执行。</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../5.现有测试/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../5.现有测试/" class="btn btn-xs btn-link">
        5.现有测试
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../15.Site配置/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../15.Site配置/" class="btn btn-xs btn-link">
        15.Site配置
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>