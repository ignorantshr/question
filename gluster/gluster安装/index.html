<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>gluster安装 - Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u5b89\u88c5", url: "#_top", children: [
          ]},
          {title: "\u6570\u636e\u4e00\u81f4\u6027", url: "#_2", children: [
              {title: "\u670d\u52a1\u7aef\u7684Quorum", url: "#quorum" },
              {title: "\u5ba2\u6237\u7aef\u7684Quorum", url: "#quorum_1" },
          ]},
          {title: "\u8111\u88c2\u7684\u9884\u9632\u53ca\u6062\u590d\uff1a", url: "#_3", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ovirt的gluster数据恢复bug/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ovirt的gluster数据恢复bug/" class="btn btn-xs btn-link">
        ovirt的gluster数据恢复bug
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../linux网络编程/简单tcp通信实现/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../linux网络编程/简单tcp通信实现/" class="btn btn-xs btn-link">
        简单tcp通信实现
      </a>
    </div>
    
  </div>

    

    <h3 id="_1">安装</h3>
<p>先安装yum源，这是最新版本；centos的库不是最新版，如果版本不匹配会造成挂载失败</p>
<p>yum install centos-release-gluster</p>
<p>centos快速安装：</p>
<p><a href="https://wiki.centos.org/SpecialInterestGroup/Storage/gluster-Quickstart">https://wiki.centos.org/SpecialInterestGroup/Storage/gluster-Quickstart</a></p>
<p>快速使用：</p>
<p><a href="https://gluster.readthedocs.io/en/latest/Quick-Start-Guide/Quickstart/">https://gluster.readthedocs.io/en/latest/Quick-Start-Guide/Quickstart/</a></p>
<p>服务端：</p>
<pre><code class="shell">yum install glusterfs-server
</code></pre>

<p>客户端：</p>
<pre><code class="shell"># 挂载fuse模块
modprobe fuse
dmesg | grep -i fuse

yum install -y centos-release-gluster
sudo yum -y install openssh-server wget fuse fuse-libs openib libibverbs
yum install -y glusterfs glusterfs-fuse glusterfs-rdma
vi /etc/hosts # 添加所有的服务器，包括自己
mount。。。。
</code></pre>

<h3 id="_2">数据一致性</h3>
<h5 id="quorum">服务端的Quorum</h5>
<ul>
<li>cluster.server-quorum-ratio：0-100 依据结点数量 &gt;=</li>
<li>cluster.server-quorum-type：none | server </li>
<li>一旦失去了一致性，不可写也不可读</li>
<li>一个volume不满足quorum时，任何更新volume配置和集群的增删操作都不能执行</li>
<li>glusterd服务停止或者网络断开会被同等对待</li>
</ul>
<h5 id="quorum_1">客户端的Quorum</h5>
<ul>
<li>在 replicated volume brick=2的情况下，需要将quorum-count = 2 才能预防脑裂</li>
<li>cluster.quorum-type：none|auto|fixed auto：在线brick数量&gt;=总的brick数量/2;fixed与quorum-count配合使用</li>
<li>cluster.quorum-count： 与cluster.quorum-type =fixed配合使用，满足此数量的brick在线时才允许进行写操作；如果 cluster.quorum-type =auto，那么这个限定不起作用</li>
<li>cluster.quorum-reads：yes|no yes时满足数量的brick在线才可读取</li>
<li>如果只有两个 replica brick 并且想要高可用性，就不用启用client-quorum</li>
</ul>
<h3 id="_3">脑裂的预防及恢复：</h3>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-Managing_Split-brain#chap-Managing_Red_Hat_Storage_Volumes-splibrain_mount_point">https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-Managing_Split-brain#chap-Managing_Red_Hat_Storage_Volumes-splibrain_mount_point</a></p>
<p><em>taps</em>:最优的disperse volume
    性能最佳： （bricks - redundancy） 为2的幂</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ovirt的gluster数据恢复bug/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ovirt的gluster数据恢复bug/" class="btn btn-xs btn-link">
        ovirt的gluster数据恢复bug
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../linux网络编程/简单tcp通信实现/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../linux网络编程/简单tcp通信实现/" class="btn btn-xs btn-link">
        简单tcp通信实现
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>