{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"1. Welcome to Person Sink \u00b6 This is a personal blog of shihr. \u81ea\u5df1\u5199\u7684\u4e3amkdocs\u6587\u6863\u6807\u9898\u6dfb\u52a0\u5e8f\u53f7\u7684\u5c0f\u63d2\u4ef6: mkdocs-add-number-plugin \u5f00\u542f\u672c\u5730mkdocs\u5b9e\u65f6\u6784\u5efa\u670d\u52a1: mkdocs serve -a localhost:9001 1.1 Commands \u00b6 mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. mkdocs gh-deploy -r github - Deploy this blog. 1.2 Project layout \u00b6 mkdocs . yml # The configuration file . docs / index . md # The documentation homepage . ... # Other markdown pages , images and other files . For full introductional documentation visit mkdocs.org . 1.3 \u6708\u4efd\u53ca\u661f\u671f \u00b6 \u661f\u671f Monday-Mon Tuesday-Tue Wednesday-Wed Thursday-Thur/Thurs Friday-Fri Saturday-Sat Sunday-Sun \u6708\u4efd \u4e00\u6708 January Jan. \u4e8c\u6708 February Feb. \u4e09\u6708 March Mar. \u56db\u6708 April Apr. \u4e94\u6708 May May \u516d\u6708 June Jun. \u4e03\u6708 July Jul. \u516b\u6708 August Aug. \u4e5d\u6708 September Sep. \u5341\u6708 October Oct. \u5341\u4e00\u6708 November Nov. \u5341\u4e8c\u6708 December Dec.","title":"Home"},{"location":"#1-welcome-to-person-sink","text":"This is a personal blog of shihr. \u81ea\u5df1\u5199\u7684\u4e3amkdocs\u6587\u6863\u6807\u9898\u6dfb\u52a0\u5e8f\u53f7\u7684\u5c0f\u63d2\u4ef6: mkdocs-add-number-plugin \u5f00\u542f\u672c\u5730mkdocs\u5b9e\u65f6\u6784\u5efa\u670d\u52a1: mkdocs serve -a localhost:9001","title":"1. Welcome to Person Sink"},{"location":"#11-commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. mkdocs gh-deploy -r github - Deploy this blog.","title":"1.1 Commands"},{"location":"#12-project-layout","text":"mkdocs . yml # The configuration file . docs / index . md # The documentation homepage . ... # Other markdown pages , images and other files . For full introductional documentation visit mkdocs.org .","title":"1.2 Project layout"},{"location":"#13","text":"\u661f\u671f Monday-Mon Tuesday-Tue Wednesday-Wed Thursday-Thur/Thurs Friday-Fri Saturday-Sat Sunday-Sun \u6708\u4efd \u4e00\u6708 January Jan. \u4e8c\u6708 February Feb. \u4e09\u6708 March Mar. \u56db\u6708 April Apr. \u4e94\u6708 May May \u516d\u6708 June Jun. \u4e03\u6708 July Jul. \u516b\u6708 August Aug. \u4e5d\u6708 September Sep. \u5341\u6708 October Oct. \u5341\u4e00\u6708 November Nov. \u5341\u4e8c\u6708 December Dec.","title":"1.3 \u6708\u4efd\u53ca\u661f\u671f"},{"location":"CS50/1. \u7b80\u4ecb/","text":"1. \u7b80\u4ecb \u00b6 \u54c8\u4f5b\u5927\u5b66\u516c\u5f00\u8bfeCS50\u3002 2. \u975e\u5e38\u56f0\u96be\u4f46\u7edd\u5bf9\u53ef\u884c \u00b6","title":"\u7b80\u4ecb"},{"location":"CS50/1. \u7b80\u4ecb/#1","text":"\u54c8\u4f5b\u5927\u5b66\u516c\u5f00\u8bfeCS50\u3002","title":"1. \u7b80\u4ecb"},{"location":"CS50/1. \u7b80\u4ecb/#2","text":"","title":"2. \u975e\u5e38\u56f0\u96be\u4f46\u7edd\u5bf9\u53ef\u884c"},{"location":"CS50/2. \u7f16\u8bd1\u5668/","text":"1. \u7f16\u8bd1\u5668 \u00b6 \u7f16\u8bd1\u5668\u7684\u4f5c\u7528\u662f\u5c06\u7a0b\u5e8f\u5458\u5199\u7684 \u6e90\u4ee3\u7801 \u8f6c\u6362\u4e3a\u8ba1\u7b97\u673a\u53ef\u6267\u884c\u7684 \u673a\u5668\u7801 \uff08\u75310\u548c1\u7ec4\u6210\uff09\u3002 \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 gcc \u8fd9\u79cd\u7f16\u8bd1\u5668\u6765\u7f16\u8bd1\u6e90\u7801\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 make \u7b49\u6784\u5efa\u5de5\u5177\u6765\u7f16\u8bd1\u3002 1.1 something else \u00b6 \u6d6e\u70b9\u6570\u4e0d\u80fd\u7cbe\u786e\u5730\u5b58\u50a8\uff0c\u4e00\u4e2a\u89e3\u51b3\u65b9\u6cd5\u662f\u5c06\u5176\u8f6c\u6362\u4e3a\u6574\u6570\u518d\u505a\u8ba1\u7b97\u3002","title":"\u7f16\u8bd1\u5668"},{"location":"CS50/2. \u7f16\u8bd1\u5668/#1","text":"\u7f16\u8bd1\u5668\u7684\u4f5c\u7528\u662f\u5c06\u7a0b\u5e8f\u5458\u5199\u7684 \u6e90\u4ee3\u7801 \u8f6c\u6362\u4e3a\u8ba1\u7b97\u673a\u53ef\u6267\u884c\u7684 \u673a\u5668\u7801 \uff08\u75310\u548c1\u7ec4\u6210\uff09\u3002 \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 gcc \u8fd9\u79cd\u7f16\u8bd1\u5668\u6765\u7f16\u8bd1\u6e90\u7801\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 make \u7b49\u6784\u5efa\u5de5\u5177\u6765\u7f16\u8bd1\u3002","title":"1. \u7f16\u8bd1\u5668"},{"location":"CS50/2. \u7f16\u8bd1\u5668/#11-something-else","text":"\u6d6e\u70b9\u6570\u4e0d\u80fd\u7cbe\u786e\u5730\u5b58\u50a8\uff0c\u4e00\u4e2a\u89e3\u51b3\u65b9\u6cd5\u662f\u5c06\u5176\u8f6c\u6362\u4e3a\u6574\u6570\u518d\u505a\u8ba1\u7b97\u3002","title":"1.1 something else"},{"location":"algorithm/\u590d\u6742\u5ea6\u5206\u6790/","text":"1. \u65f6\u95f4\u590d\u6742\u5ea6 \u00b6 \u5927 O \u65f6\u95f4\u590d\u6742\u5ea6\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5177\u4f53\u8868\u793a\u4ee3\u7801\u771f\u6b63\u7684\u6267\u884c\u65f6\u95f4\uff0c\u800c\u662f\u8868\u793a\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u968f\u6570\u636e\u89c4\u6a21\u589e\u957f\u7684\u53d8\u5316\u8d8b\u52bf\uff0c\u6240\u4ee5\uff0c\u4e5f\u53eb\u4f5c\u6e10\u8fdb\u65f6\u95f4\u590d\u6742\u5ea6\uff08asymptotic time complexity\uff09\uff0c\u7b80\u79f0\u65f6\u95f4\u590d\u6742\u5ea6\u3002 \u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\uff1a 1. \u53ea\u5173\u6ce8\u5faa\u73af\u6267\u884c\u6b21\u6570\u6700\u591a\u7684\u4e00\u6bb5\u4ee3\u7801 2. \u52a0\u6cd5\u6cd5\u5219\uff1a\u603b\u590d\u6742\u5ea6\u7b49\u4e8e\u91cf\u7ea7\u6700\u5927\u7684\u90a3\u6bb5\u4ee3\u7801\u7684\u590d\u6742\u5ea6 \u65f6\u95f4\u590d\u6742\u5ea6\u7684\u6982\u5ff5\u6765\u8bf4\uff0c\u5b83\u8868\u793a\u7684\u662f\u4e00\u4e2a\u7b97\u6cd5\u6267\u884c\u6548\u7387\u4e0e\u6570\u636e\u89c4\u6a21\u589e\u957f\u7684\u53d8\u5316\u8d8b\u52bf\uff0c\u4e0d\u4ee3\u8868\u7a0b\u5e8f\u6267\u884c\u65f6\u95f4\u3002 \u5982\u679c T1(n)=O(f(n))\uff0cT2(n)=O(g(n))\uff1b\u90a3\u4e48 T(n)=T1(n)+T2(n)=max(O(f(n)), O(g(n))) =O(max(f(n),g(n))). T1(m) + T2(n) = O(f(m) + g(n)). 3. \u4e58\u6cd5\u6cd5\u5219\uff1a\u5d4c\u5957\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u7b49\u4e8e\u5d4c\u5957\u5185\u5916\u4ee3\u7801\u590d\u6742\u5ea6\u7684\u4e58\u79ef T1(n) T2(n) = O(f(n) * g(n)) T1(m) T2(n) = O(f(m) * f(n)) 2. \u7a7a\u95f4\u590d\u6742\u5ea6 \u00b6 \u7a7a\u95f4\u590d\u6742\u5ea6\u5168\u79f0\u5c31\u662f\u6e10\u8fdb\u7a7a\u95f4\u590d\u6742\u5ea6\uff08asymptotic space complexity\uff09\uff0c\u8868\u793a\u7b97\u6cd5\u7684 \u5b58\u50a8\u7a7a\u95f4\u4e0e\u6570\u636e\u89c4\u6a21\u4e4b\u95f4\u7684\u589e\u957f\u5173\u7cfb\u3002 \u51e0\u8f6e\u5207\u5206","title":"\u590d\u6742\u5ea6\u5206\u6790"},{"location":"algorithm/\u590d\u6742\u5ea6\u5206\u6790/#1","text":"\u5927 O \u65f6\u95f4\u590d\u6742\u5ea6\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5177\u4f53\u8868\u793a\u4ee3\u7801\u771f\u6b63\u7684\u6267\u884c\u65f6\u95f4\uff0c\u800c\u662f\u8868\u793a\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u968f\u6570\u636e\u89c4\u6a21\u589e\u957f\u7684\u53d8\u5316\u8d8b\u52bf\uff0c\u6240\u4ee5\uff0c\u4e5f\u53eb\u4f5c\u6e10\u8fdb\u65f6\u95f4\u590d\u6742\u5ea6\uff08asymptotic time complexity\uff09\uff0c\u7b80\u79f0\u65f6\u95f4\u590d\u6742\u5ea6\u3002 \u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\uff1a 1. \u53ea\u5173\u6ce8\u5faa\u73af\u6267\u884c\u6b21\u6570\u6700\u591a\u7684\u4e00\u6bb5\u4ee3\u7801 2. \u52a0\u6cd5\u6cd5\u5219\uff1a\u603b\u590d\u6742\u5ea6\u7b49\u4e8e\u91cf\u7ea7\u6700\u5927\u7684\u90a3\u6bb5\u4ee3\u7801\u7684\u590d\u6742\u5ea6 \u65f6\u95f4\u590d\u6742\u5ea6\u7684\u6982\u5ff5\u6765\u8bf4\uff0c\u5b83\u8868\u793a\u7684\u662f\u4e00\u4e2a\u7b97\u6cd5\u6267\u884c\u6548\u7387\u4e0e\u6570\u636e\u89c4\u6a21\u589e\u957f\u7684\u53d8\u5316\u8d8b\u52bf\uff0c\u4e0d\u4ee3\u8868\u7a0b\u5e8f\u6267\u884c\u65f6\u95f4\u3002 \u5982\u679c T1(n)=O(f(n))\uff0cT2(n)=O(g(n))\uff1b\u90a3\u4e48 T(n)=T1(n)+T2(n)=max(O(f(n)), O(g(n))) =O(max(f(n),g(n))). T1(m) + T2(n) = O(f(m) + g(n)). 3. \u4e58\u6cd5\u6cd5\u5219\uff1a\u5d4c\u5957\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u7b49\u4e8e\u5d4c\u5957\u5185\u5916\u4ee3\u7801\u590d\u6742\u5ea6\u7684\u4e58\u79ef T1(n) T2(n) = O(f(n) * g(n)) T1(m) T2(n) = O(f(m) * f(n))","title":"1. \u65f6\u95f4\u590d\u6742\u5ea6"},{"location":"algorithm/\u590d\u6742\u5ea6\u5206\u6790/#2","text":"\u7a7a\u95f4\u590d\u6742\u5ea6\u5168\u79f0\u5c31\u662f\u6e10\u8fdb\u7a7a\u95f4\u590d\u6742\u5ea6\uff08asymptotic space complexity\uff09\uff0c\u8868\u793a\u7b97\u6cd5\u7684 \u5b58\u50a8\u7a7a\u95f4\u4e0e\u6570\u636e\u89c4\u6a21\u4e4b\u95f4\u7684\u589e\u957f\u5173\u7cfb\u3002 \u51e0\u8f6e\u5207\u5206","title":"2. \u7a7a\u95f4\u590d\u6742\u5ea6"},{"location":"algorithm/\u9009\u62e9\u6392\u5e8f/","text":"","title":"\u9009\u62e9\u6392\u5e8f"},{"location":"ansible/01. \u7b80\u4ecb/","text":"Ansible\u4e2d\u6587\u6743\u5a01\u6307\u5357 Ansible Documentation 1. \u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42 \u00b6 \u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2.6 \u6216 Python 2.7 (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u63a7\u5236\u4e3b\u673a),\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible. 2. \u5bf9\u6258\u7ba1\u8282\u70b9\u7684\u8981\u6c42 \u00b6 \u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u6258\u7ba1\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp.\u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5 Python 2.4 \u6216\u4ee5\u4e0a\u7684\u7248\u672c.\u5982\u679c\u7248\u672c\u4f4e\u4e8e Python 2.5 ,\u8fd8\u9700\u8981\u989d\u5916\u5b89\u88c5\u4e00\u4e2a\u6a21\u5757: python-simplejson Note \u5982\u679c\u6258\u7ba1\u8282\u70b9\u4e0a\u5f00\u542f\u4e86 SElinux ,\u4f60\u9700\u8981\u5b89\u88c5 libselinux-python ,\u8fd9\u6837\u624d\u53ef\u4f7f\u7528Ansible\u4e2d\u4e0ecopy/file/template\u76f8\u5173\u7684\u51fd\u6570.\u4f60\u53ef\u4ee5\u901a\u8fc7Ansible\u7684yum\u6a21\u5757\u5728\u9700\u8981\u7684\u6258\u7ba1\u8282\u70b9\u4e0a\u5b89\u88c5libselinux-python\u3002 Note \u4f60\u9700\u8981\u5b89\u88c5\u4e00\u4e2a Python 2.X \u89e3\u91ca\u5668,\u5e76\u5728 inventory (\u8be6\u89c1 Inventory\u6587\u4ef6 ) \u4e2d\u8bbe\u7f6e \u2018ansible_python_interpreter\u2019 \u53d8\u91cf\u6307\u5411\u4f60\u7684 2.X Python.\u4f60\u53ef\u4ee5\u4f7f\u7528 \u2018raw\u2019 \u6a21\u5757\u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u8fdc\u7a0b\u5b89\u88c5Python 2.X\u3002\u4f8b\u5982\uff1a ansible myhost --sudo -m raw -a \"yum install -y python2 python-simplejson\" \u8fd9\u6761\u547d\u4ee4\u53ef\u4ee5\u901a\u8fc7\u8fdc\u7a0b\u65b9\u5f0f\u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u5b89\u88c5 Python 2.X \u548c simplejson \u6a21\u5757. 3. \u5b89\u88c5 \u00b6 \u5148\u914d\u7f6e epel \u6e90\uff1a \u5b89\u88c5epel\u6e90 \u5b89\u88c5\uff1a yum install ansible 3.1 \u6a21\u5757\u4f7f\u7528\u8bf4\u660e \u00b6 \u6a21\u5757\u7d22\u5f15 \u7b80\u6613\u7684\u67e5\u8be2\u6a21\u5757\u7684\u53c2\u6570\u548c\u8bf4\u660e\uff1a ansible - doc yum","title":"01. \u7b80\u4ecb"},{"location":"ansible/01. \u7b80\u4ecb/#1","text":"\u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2.6 \u6216 Python 2.7 (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u63a7\u5236\u4e3b\u673a),\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible.","title":"1. \u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42"},{"location":"ansible/01. \u7b80\u4ecb/#2","text":"\u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u6258\u7ba1\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp.\u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5 Python 2.4 \u6216\u4ee5\u4e0a\u7684\u7248\u672c.\u5982\u679c\u7248\u672c\u4f4e\u4e8e Python 2.5 ,\u8fd8\u9700\u8981\u989d\u5916\u5b89\u88c5\u4e00\u4e2a\u6a21\u5757: python-simplejson Note \u5982\u679c\u6258\u7ba1\u8282\u70b9\u4e0a\u5f00\u542f\u4e86 SElinux ,\u4f60\u9700\u8981\u5b89\u88c5 libselinux-python ,\u8fd9\u6837\u624d\u53ef\u4f7f\u7528Ansible\u4e2d\u4e0ecopy/file/template\u76f8\u5173\u7684\u51fd\u6570.\u4f60\u53ef\u4ee5\u901a\u8fc7Ansible\u7684yum\u6a21\u5757\u5728\u9700\u8981\u7684\u6258\u7ba1\u8282\u70b9\u4e0a\u5b89\u88c5libselinux-python\u3002 Note \u4f60\u9700\u8981\u5b89\u88c5\u4e00\u4e2a Python 2.X \u89e3\u91ca\u5668,\u5e76\u5728 inventory (\u8be6\u89c1 Inventory\u6587\u4ef6 ) \u4e2d\u8bbe\u7f6e \u2018ansible_python_interpreter\u2019 \u53d8\u91cf\u6307\u5411\u4f60\u7684 2.X Python.\u4f60\u53ef\u4ee5\u4f7f\u7528 \u2018raw\u2019 \u6a21\u5757\u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u8fdc\u7a0b\u5b89\u88c5Python 2.X\u3002\u4f8b\u5982\uff1a ansible myhost --sudo -m raw -a \"yum install -y python2 python-simplejson\" \u8fd9\u6761\u547d\u4ee4\u53ef\u4ee5\u901a\u8fc7\u8fdc\u7a0b\u65b9\u5f0f\u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u5b89\u88c5 Python 2.X \u548c simplejson \u6a21\u5757.","title":"2. \u5bf9\u6258\u7ba1\u8282\u70b9\u7684\u8981\u6c42"},{"location":"ansible/01. \u7b80\u4ecb/#3","text":"\u5148\u914d\u7f6e epel \u6e90\uff1a \u5b89\u88c5epel\u6e90 \u5b89\u88c5\uff1a yum install ansible","title":"3. \u5b89\u88c5"},{"location":"ansible/01. \u7b80\u4ecb/#31","text":"\u6a21\u5757\u7d22\u5f15 \u7b80\u6613\u7684\u67e5\u8be2\u6a21\u5757\u7684\u53c2\u6570\u548c\u8bf4\u660e\uff1a ansible - doc yum","title":"3.1 \u6a21\u5757\u4f7f\u7528\u8bf4\u660e"},{"location":"ansible/02. Inventory\u6587\u4ef6/","text":"Ansible \u53ef\u540c\u65f6\u64cd\u4f5c\u5c5e\u4e8e\u4e00\u4e2a\u7ec4\u7684\u591a\u53f0\u4e3b\u673a\uff0c\u7ec4\u548c\u4e3b\u673a\u4e4b\u95f4\u7684\u5173\u7cfb\u901a\u8fc7 inventory \u6587\u4ef6\u914d\u7f6e\u3002\u9ed8\u8ba4\u7684\u6587\u4ef6\u8def\u5f84\u4e3a /etc/ansible/hosts \u3002 \u9664\u9ed8\u8ba4\u6587\u4ef6\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u591a\u4e2a inventory \u6587\u4ef6(\u540e\u9762\u4f1a\u8bb2\u5230)\uff0c\u4e5f\u53ef\u4ee5\u4ece\u52a8\u6001\u6e90\uff0c\u6216\u4e91\u4e0a\u62c9\u53d6 inventory \u914d\u7f6e\u4fe1\u606f.\u8be6\u89c1 \u52a8\u6001 Inventory \u3002 1. \u4e3b\u673a\u4e0e\u7ec4 \u00b6 mail . example . com [ webservers ] foo . example . com bar . example . com [ dbservers ] one . example . com two . example . com three . example . com \u65b9\u62ec\u53f7[]\u4e2d\u662f\u7ec4\u540d\u3002\u4e00\u4e2a\u7cfb\u7edf\u53ef\u4ee5\u5c5e\u4e8e\u4e0d\u540c\u7684\u7ec4\uff0c\u6bd4\u5982\u4e00\u53f0\u670d\u52a1\u5668\u53ef\u4ee5\u540c\u65f6\u5c5e\u4e8e webserver\u7ec4 \u548c dbserver\u7ec4.\u8fd9\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7ec4\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u4e3a\u8fd9\u53f0\u4e3b\u673a\u6240\u7528\u3002 \u5982\u679c\u6709\u4e3b\u673a\u7684SSH\u7aef\u53e3\u4e0d\u662f\u6807\u51c6\u768422\u7aef\u53e3\uff0c\u53ef\u5728\u4e3b\u673a\u540d\u4e4b\u540e\u52a0\u4e0a\u7aef\u53e3\u53f7\uff0c\u7528\u5192\u53f7\u5206\u9694\u3002 \u5047\u8bbe\u4f60\u6709\u4e00\u4e9b\u9759\u6001IP\u5730\u5740\uff0c\u5e0c\u671b\u8bbe\u7f6e\u4e00\u4e9b\u522b\u540d\uff0c\u4f46\u4e0d\u662f\u5728\u7cfb\u7edf\u7684 host \u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u53c8\u6216\u8005\u4f60\u662f\u901a\u8fc7\u96a7\u9053\u5728\u8fde\u63a5\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u5982\u4e0b: jumper ansible_ssh_port = 5555 ansible_ssh_host = 192 . 168 . 1 . 50 jumper\u5373\u662f\u4e3b\u673a\u522b\u540d\u3002 \u7b80\u5199\u683c\u5f0f\uff0c\u7c7b\u4f3c\u4e0elinux\u4e2d\u7684 {1..50} \uff1a [databases] db-[a:f].example.com \u5bf9\u4e8e\u6bcf\u4e00\u4e2a host\uff0c\u4f60\u8fd8\u53ef\u4ee5\u9009\u62e9\u8fde\u63a5\u7c7b\u578b\u548c\u8fde\u63a5\u7528\u6237\u540d: [targets] localhost ansible_connection = local other1.example.com ansible_connection = ssh ansible_ssh_user=mpdehaan other2.example.com ansible_connection = ssh ansible_ssh_user=mdehaan 2. \u4e3b\u673a\u53d8\u91cf \u00b6 \u524d\u9762\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u5206\u914d\u53d8\u91cf\u7ed9\u4e3b\u673a\u5f88\u5bb9\u6613\u505a\u5230\uff0c\u8fd9\u4e9b\u53d8\u91cf\u5b9a\u4e49\u540e\u53ef\u5728 playbooks \u4e2d\u4f7f\u7528: [atlanta] host1 http_port = 80 maxRequestsPerChild=808 host2 http_port = 303 maxRequestsPerChild=909 3. \u7ec4\u7684\u53d8\u91cf \u00b6 \u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5c5e\u4e8e\u6574\u4e2a\u7ec4\u7684\u53d8\u91cf: [atlanta] host1 host2 [atlanta:vars] ntp_server = ntp.atlanta.example.com proxy = proxy.atlanta.example.com 4. \u628a\u4e00\u4e2a\u7ec4\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7ec4\u7684\u5b50\u6210\u5458 \u00b6 \u53ef\u4ee5\u628a\u4e00\u4e2a\u7ec4\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7ec4\u7684\u5b50\u6210\u5458\uff0c\u4ee5\u53ca\u5206\u914d\u53d8\u91cf\u7ed9\u6574\u4e2a\u7ec4\u4f7f\u7528. \u8fd9\u4e9b\u53d8\u91cf\u53ef\u4ee5\u7ed9 /usr/bin/ansible-playbook \u4f7f\u7528\uff0c\u4f46\u4e0d\u80fd\u7ed9 /usr/bin/ansible \u4f7f\u7528: [atlanta] host1 host2 [raleigh] host2 host3 [southeast:children] atlanta raleigh [southeast:vars] some_server = foo.southeast.example.com halon_system_timeout = 30 self_destruct_countdown = 60 escape_pods = 2 [usa:children] southeast northeast 5. \u5206\u6587\u4ef6\u5b9a\u4e49 Host \u548c Group \u53d8\u91cf \u00b6 \u4e0d\u540c\u4e8e inventory \u6587\u4ef6(INI \u683c\u5f0f)\uff0c\u8fd9\u4e9b\u72ec\u7acb\u6587\u4ef6\u7684\u683c\u5f0f\u4e3a YAML\u3002\u8be6\u89c1 YAML \u8bed\u6cd5 \u3002 \u5047\u8bbe inventory \u6587\u4ef6\u7684\u8def\u5f84\u4e3a: / etc / ansible / hosts \u5047\u8bbe\u6709\u4e00\u4e2a\u4e3b\u673a\u540d\u4e3a \u2018foosball\u2019\uff0c \u4e3b\u673a\u540c\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7ec4\uff0c\u4e00\u4e2a\u662f \u2018raleigh\u2019\uff0c \u53e6\u4e00\u4e2a\u662f \u2018webservers\u2019. \u90a3\u4e48\u4ee5\u4e0b\u914d\u7f6e\u6587\u4ef6(YAML \u683c\u5f0f)\u4e2d\u7684\u53d8\u91cf\u53ef\u4ee5\u4e3a \u2018foosball\u2019 \u4e3b\u673a\u6240\u7528.\u4f9d\u6b21\u4e3a \u2018raleigh\u2019 \u7684\u7ec4\u53d8\u91cf\uff0c\u2019webservers\u2019 \u7684\u7ec4\u53d8\u91cf\uff0c\u2019foosball\u2019 \u7684\u4e3b\u673a\u53d8\u91cf: / etc / ansible / group_vars / raleigh / etc / ansible / group_vars / webservers / etc / ansible / host_vars / foosball \u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a --- ntp_server : acme . example . org database_server : storage . example . org \u8fd8\u6709\u66f4\u8fdb\u4e00\u6b65\u7684\u8fd0\u7528\uff0c\u4f60\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u4e3b\u673a\uff0c\u6216\u4e00\u4e2a\u7ec4\uff0c\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u5c31\u662f\u4e3b\u673a\u540d\u6216\u7ec4\u540d\u3002\u76ee\u5f55\u4e2d\u7684\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\u90fd\u4f1a\u88ab\u8bfb\u53d6\u4e3a\u4e3b\u673a\u6216\u7ec4\u7684\u53d8\u91cf\u3002 / etc / ansible / group_vars / raleigh / db_settings / etc / ansible / group_vars / raleigh / cluster_settings Ansible 1.2 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\u4e2d\uff0cgroup_vars/ \u548c host_vars/ \u76ee\u5f55\u53ef\u653e\u5728 inventory \u76ee\u5f55\u4e0b\uff0c\u6216\u662f playbook \u76ee\u5f55\u4e0b\u3002\u5982\u679c\u4e24\u4e2a\u76ee\u5f55\u4e0b\u90fd\u5b58\u5728\uff0c\u90a3\u4e48 playbook \u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u4f1a\u8986\u76d6 inventory \u76ee\u5f55\u7684\u914d\u7f6e\u3002 6. Inventory \u53c2\u6570\u7684\u8bf4\u660e \u00b6 ansible_ssh_host \u5c06\u8981\u8fde\u63a5\u7684\u8fdc\u7a0b\u4e3b\u673a\u540d . \u4e0e\u4f60\u60f3\u8981\u8bbe\u5b9a\u7684\u4e3b\u673a\u7684\u522b\u540d\u4e0d\u540c\u7684\u8bdd\uff0c\u53ef\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e . ansible_ssh_port ssh\u7aef\u53e3\u53f7 . \u5982\u679c\u4e0d\u662f\u9ed8\u8ba4\u7684\u7aef\u53e3\u53f7\uff0c\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e . ansible_ssh_user \u9ed8\u8ba4\u7684 ssh \u7528\u6237\u540d ansible_ssh_pass ssh \u5bc6\u7801 ( \u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u5b89\u5168\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 --ask-pass \u6216 SSH \u5bc6\u94a5) ansible_sudo_pass sudo \u5bc6\u7801 ( \u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u5b89\u5168\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 --ask-sudo-pass) ansible_sudo_exe ( new in version 1 . 8 ) sudo \u547d\u4ee4\u8def\u5f84 ( \u9002\u7528\u4e8e 1 . 8 \u53ca\u4ee5\u4e0a\u7248\u672c ) ansible_connection \u4e0e\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b . \u6bd4\u5982 : local \uff0c ssh \u6216\u8005 paramiko . Ansible 1 . 2 \u4ee5\u524d\u9ed8\u8ba4\u4f7f\u7528 paramiko . 1 . 2 \u4ee5\u540e\u9ed8\u8ba4\u4f7f\u7528 'smart' \uff0c 'smart' \u65b9\u5f0f\u4f1a\u6839\u636e\u662f\u5426\u652f\u6301 ControlPersist \uff0c \u6765\u5224\u65ad 'ssh' \u65b9\u5f0f\u662f\u5426\u53ef\u884c . ansible_ssh_private_key_file ssh \u4f7f\u7528\u7684\u79c1\u94a5\u6587\u4ef6 . \u9002\u7528\u4e8e\u6709\u591a\u4e2a\u5bc6\u94a5\uff0c\u800c\u4f60\u4e0d\u60f3\u4f7f\u7528 SSH \u4ee3\u7406\u7684\u60c5\u51b5 . ansible_shell_type \u76ee\u6807\u7cfb\u7edf\u7684 shell\u7c7b\u578b . \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u547d\u4ee4\u7684\u6267\u884c\u4f7f\u7528 'sh' \u8bed\u6cd5\uff0c\u53ef\u8bbe\u7f6e\u4e3a 'csh' \u6216 'fish' . ansible_python_interpreter \u76ee\u6807\u4e3b\u673a\u7684 python \u8def\u5f84 . \u9002\u7528\u4e8e\u7684\u60c5\u51b5 : \u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a Python \uff0c \u6216\u8005\u547d\u4ee4\u8def\u5f84\u4e0d\u662f \"/usr/bin/python\" \uff0c\u6bd4\u5982 \\ * BSD \uff0c \u6216\u8005 / usr / bin / python \u4e0d\u662f 2 . X \u7248\u672c\u7684 Python . \u6211\u4eec\u4e0d\u4f7f\u7528 \"/usr/bin/env\" \u673a\u5236\uff0c\u56e0\u4e3a\u8fd9\u8981\u6c42\u8fdc\u7a0b\u7528\u6237\u7684\u8def\u5f84\u8bbe\u7f6e\u6b63\u786e\uff0c\u4e14\u8981\u6c42 \"python\" \u53ef\u6267\u884c\u7a0b\u5e8f\u540d\u4e0d\u53ef\u4e3a python\u4ee5\u5916\u7684\u540d\u5b57 ( \u5b9e\u9645\u6709\u53ef\u80fd\u540d\u4e3a python26 ). \u4e0e ansible_python_interpreter \u7684\u5de5\u4f5c\u65b9\u5f0f\u76f8\u540c\uff0c\u53ef\u8bbe\u5b9a\u5982 ruby \u6216 perl \u7684\u8def\u5f84 ....","title":"02. Inventory\u6587\u4ef6"},{"location":"ansible/02. Inventory\u6587\u4ef6/#1","text":"mail . example . com [ webservers ] foo . example . com bar . example . com [ dbservers ] one . example . com two . example . com three . example . com \u65b9\u62ec\u53f7[]\u4e2d\u662f\u7ec4\u540d\u3002\u4e00\u4e2a\u7cfb\u7edf\u53ef\u4ee5\u5c5e\u4e8e\u4e0d\u540c\u7684\u7ec4\uff0c\u6bd4\u5982\u4e00\u53f0\u670d\u52a1\u5668\u53ef\u4ee5\u540c\u65f6\u5c5e\u4e8e webserver\u7ec4 \u548c dbserver\u7ec4.\u8fd9\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7ec4\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u4e3a\u8fd9\u53f0\u4e3b\u673a\u6240\u7528\u3002 \u5982\u679c\u6709\u4e3b\u673a\u7684SSH\u7aef\u53e3\u4e0d\u662f\u6807\u51c6\u768422\u7aef\u53e3\uff0c\u53ef\u5728\u4e3b\u673a\u540d\u4e4b\u540e\u52a0\u4e0a\u7aef\u53e3\u53f7\uff0c\u7528\u5192\u53f7\u5206\u9694\u3002 \u5047\u8bbe\u4f60\u6709\u4e00\u4e9b\u9759\u6001IP\u5730\u5740\uff0c\u5e0c\u671b\u8bbe\u7f6e\u4e00\u4e9b\u522b\u540d\uff0c\u4f46\u4e0d\u662f\u5728\u7cfb\u7edf\u7684 host \u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u53c8\u6216\u8005\u4f60\u662f\u901a\u8fc7\u96a7\u9053\u5728\u8fde\u63a5\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u5982\u4e0b: jumper ansible_ssh_port = 5555 ansible_ssh_host = 192 . 168 . 1 . 50 jumper\u5373\u662f\u4e3b\u673a\u522b\u540d\u3002 \u7b80\u5199\u683c\u5f0f\uff0c\u7c7b\u4f3c\u4e0elinux\u4e2d\u7684 {1..50} \uff1a [databases] db-[a:f].example.com \u5bf9\u4e8e\u6bcf\u4e00\u4e2a host\uff0c\u4f60\u8fd8\u53ef\u4ee5\u9009\u62e9\u8fde\u63a5\u7c7b\u578b\u548c\u8fde\u63a5\u7528\u6237\u540d: [targets] localhost ansible_connection = local other1.example.com ansible_connection = ssh ansible_ssh_user=mpdehaan other2.example.com ansible_connection = ssh ansible_ssh_user=mdehaan","title":"1. \u4e3b\u673a\u4e0e\u7ec4"},{"location":"ansible/02. Inventory\u6587\u4ef6/#2","text":"\u524d\u9762\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u5206\u914d\u53d8\u91cf\u7ed9\u4e3b\u673a\u5f88\u5bb9\u6613\u505a\u5230\uff0c\u8fd9\u4e9b\u53d8\u91cf\u5b9a\u4e49\u540e\u53ef\u5728 playbooks \u4e2d\u4f7f\u7528: [atlanta] host1 http_port = 80 maxRequestsPerChild=808 host2 http_port = 303 maxRequestsPerChild=909","title":"2. \u4e3b\u673a\u53d8\u91cf"},{"location":"ansible/02. Inventory\u6587\u4ef6/#3","text":"\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5c5e\u4e8e\u6574\u4e2a\u7ec4\u7684\u53d8\u91cf: [atlanta] host1 host2 [atlanta:vars] ntp_server = ntp.atlanta.example.com proxy = proxy.atlanta.example.com","title":"3. \u7ec4\u7684\u53d8\u91cf"},{"location":"ansible/02. Inventory\u6587\u4ef6/#4","text":"\u53ef\u4ee5\u628a\u4e00\u4e2a\u7ec4\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7ec4\u7684\u5b50\u6210\u5458\uff0c\u4ee5\u53ca\u5206\u914d\u53d8\u91cf\u7ed9\u6574\u4e2a\u7ec4\u4f7f\u7528. \u8fd9\u4e9b\u53d8\u91cf\u53ef\u4ee5\u7ed9 /usr/bin/ansible-playbook \u4f7f\u7528\uff0c\u4f46\u4e0d\u80fd\u7ed9 /usr/bin/ansible \u4f7f\u7528: [atlanta] host1 host2 [raleigh] host2 host3 [southeast:children] atlanta raleigh [southeast:vars] some_server = foo.southeast.example.com halon_system_timeout = 30 self_destruct_countdown = 60 escape_pods = 2 [usa:children] southeast northeast","title":"4. \u628a\u4e00\u4e2a\u7ec4\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7ec4\u7684\u5b50\u6210\u5458"},{"location":"ansible/02. Inventory\u6587\u4ef6/#5-host-group","text":"\u4e0d\u540c\u4e8e inventory \u6587\u4ef6(INI \u683c\u5f0f)\uff0c\u8fd9\u4e9b\u72ec\u7acb\u6587\u4ef6\u7684\u683c\u5f0f\u4e3a YAML\u3002\u8be6\u89c1 YAML \u8bed\u6cd5 \u3002 \u5047\u8bbe inventory \u6587\u4ef6\u7684\u8def\u5f84\u4e3a: / etc / ansible / hosts \u5047\u8bbe\u6709\u4e00\u4e2a\u4e3b\u673a\u540d\u4e3a \u2018foosball\u2019\uff0c \u4e3b\u673a\u540c\u65f6\u5c5e\u4e8e\u4e24\u4e2a\u7ec4\uff0c\u4e00\u4e2a\u662f \u2018raleigh\u2019\uff0c \u53e6\u4e00\u4e2a\u662f \u2018webservers\u2019. \u90a3\u4e48\u4ee5\u4e0b\u914d\u7f6e\u6587\u4ef6(YAML \u683c\u5f0f)\u4e2d\u7684\u53d8\u91cf\u53ef\u4ee5\u4e3a \u2018foosball\u2019 \u4e3b\u673a\u6240\u7528.\u4f9d\u6b21\u4e3a \u2018raleigh\u2019 \u7684\u7ec4\u53d8\u91cf\uff0c\u2019webservers\u2019 \u7684\u7ec4\u53d8\u91cf\uff0c\u2019foosball\u2019 \u7684\u4e3b\u673a\u53d8\u91cf: / etc / ansible / group_vars / raleigh / etc / ansible / group_vars / webservers / etc / ansible / host_vars / foosball \u6587\u4ef6\u5185\u5bb9\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a --- ntp_server : acme . example . org database_server : storage . example . org \u8fd8\u6709\u66f4\u8fdb\u4e00\u6b65\u7684\u8fd0\u7528\uff0c\u4f60\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u4e3b\u673a\uff0c\u6216\u4e00\u4e2a\u7ec4\uff0c\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u76ee\u5f55\u540d\u5c31\u662f\u4e3b\u673a\u540d\u6216\u7ec4\u540d\u3002\u76ee\u5f55\u4e2d\u7684\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u7684\u53d8\u91cf\u90fd\u4f1a\u88ab\u8bfb\u53d6\u4e3a\u4e3b\u673a\u6216\u7ec4\u7684\u53d8\u91cf\u3002 / etc / ansible / group_vars / raleigh / db_settings / etc / ansible / group_vars / raleigh / cluster_settings Ansible 1.2 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\u4e2d\uff0cgroup_vars/ \u548c host_vars/ \u76ee\u5f55\u53ef\u653e\u5728 inventory \u76ee\u5f55\u4e0b\uff0c\u6216\u662f playbook \u76ee\u5f55\u4e0b\u3002\u5982\u679c\u4e24\u4e2a\u76ee\u5f55\u4e0b\u90fd\u5b58\u5728\uff0c\u90a3\u4e48 playbook \u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u4f1a\u8986\u76d6 inventory \u76ee\u5f55\u7684\u914d\u7f6e\u3002","title":"5. \u5206\u6587\u4ef6\u5b9a\u4e49 Host \u548c Group \u53d8\u91cf"},{"location":"ansible/02. Inventory\u6587\u4ef6/#6-inventory","text":"ansible_ssh_host \u5c06\u8981\u8fde\u63a5\u7684\u8fdc\u7a0b\u4e3b\u673a\u540d . \u4e0e\u4f60\u60f3\u8981\u8bbe\u5b9a\u7684\u4e3b\u673a\u7684\u522b\u540d\u4e0d\u540c\u7684\u8bdd\uff0c\u53ef\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e . ansible_ssh_port ssh\u7aef\u53e3\u53f7 . \u5982\u679c\u4e0d\u662f\u9ed8\u8ba4\u7684\u7aef\u53e3\u53f7\uff0c\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e . ansible_ssh_user \u9ed8\u8ba4\u7684 ssh \u7528\u6237\u540d ansible_ssh_pass ssh \u5bc6\u7801 ( \u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u5b89\u5168\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 --ask-pass \u6216 SSH \u5bc6\u94a5) ansible_sudo_pass sudo \u5bc6\u7801 ( \u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u5b89\u5168\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528 --ask-sudo-pass) ansible_sudo_exe ( new in version 1 . 8 ) sudo \u547d\u4ee4\u8def\u5f84 ( \u9002\u7528\u4e8e 1 . 8 \u53ca\u4ee5\u4e0a\u7248\u672c ) ansible_connection \u4e0e\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b . \u6bd4\u5982 : local \uff0c ssh \u6216\u8005 paramiko . Ansible 1 . 2 \u4ee5\u524d\u9ed8\u8ba4\u4f7f\u7528 paramiko . 1 . 2 \u4ee5\u540e\u9ed8\u8ba4\u4f7f\u7528 'smart' \uff0c 'smart' \u65b9\u5f0f\u4f1a\u6839\u636e\u662f\u5426\u652f\u6301 ControlPersist \uff0c \u6765\u5224\u65ad 'ssh' \u65b9\u5f0f\u662f\u5426\u53ef\u884c . ansible_ssh_private_key_file ssh \u4f7f\u7528\u7684\u79c1\u94a5\u6587\u4ef6 . \u9002\u7528\u4e8e\u6709\u591a\u4e2a\u5bc6\u94a5\uff0c\u800c\u4f60\u4e0d\u60f3\u4f7f\u7528 SSH \u4ee3\u7406\u7684\u60c5\u51b5 . ansible_shell_type \u76ee\u6807\u7cfb\u7edf\u7684 shell\u7c7b\u578b . \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u547d\u4ee4\u7684\u6267\u884c\u4f7f\u7528 'sh' \u8bed\u6cd5\uff0c\u53ef\u8bbe\u7f6e\u4e3a 'csh' \u6216 'fish' . ansible_python_interpreter \u76ee\u6807\u4e3b\u673a\u7684 python \u8def\u5f84 . \u9002\u7528\u4e8e\u7684\u60c5\u51b5 : \u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a Python \uff0c \u6216\u8005\u547d\u4ee4\u8def\u5f84\u4e0d\u662f \"/usr/bin/python\" \uff0c\u6bd4\u5982 \\ * BSD \uff0c \u6216\u8005 / usr / bin / python \u4e0d\u662f 2 . X \u7248\u672c\u7684 Python . \u6211\u4eec\u4e0d\u4f7f\u7528 \"/usr/bin/env\" \u673a\u5236\uff0c\u56e0\u4e3a\u8fd9\u8981\u6c42\u8fdc\u7a0b\u7528\u6237\u7684\u8def\u5f84\u8bbe\u7f6e\u6b63\u786e\uff0c\u4e14\u8981\u6c42 \"python\" \u53ef\u6267\u884c\u7a0b\u5e8f\u540d\u4e0d\u53ef\u4e3a python\u4ee5\u5916\u7684\u540d\u5b57 ( \u5b9e\u9645\u6709\u53ef\u80fd\u540d\u4e3a python26 ). \u4e0e ansible_python_interpreter \u7684\u5de5\u4f5c\u65b9\u5f0f\u76f8\u540c\uff0c\u53ef\u8bbe\u5b9a\u5982 ruby \u6216 perl \u7684\u8def\u5f84 ....","title":"6. Inventory \u53c2\u6570\u7684\u8bf4\u660e"},{"location":"ansible/03. playbooks-roles/","text":"1. \u76ee\u5f55\u7ed3\u6784 \u00b6 site . yml webservers . yml fooservers . yml roles / common / tasks / handlers / files / templates / vars / defaults / meta / webservers / tasks / defaults / meta / tasks\uff1a\u5305\u542b\u4e3b\u8981\u7684\u88ab\u6267\u884c\u7684tasks\u5217\u8868 handlers\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u6240\u6709\u7684roles\u4f7f\u7528\u7684handlers defaults\uff1a\u5bf9\u4e8e\u8fd9\u4e2arole\u6765\u8bf4\u7684\u9ed8\u8ba4\u53d8\u91cf vars\uff1a\u5bf9\u4e8e\u8fd9\u4e2arole\u6765\u8bf4\u7684\u5176\u5b83\u53d8\u91cf files\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u8fd9\u4e2arole\u90e8\u7f72\u7684\u6587\u4ef6 templates\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u8fd9\u4e2arole\u90e8\u7f72\u7684\u6a21\u7248\u6587\u4ef6\uff08\u9075\u5faa Jinja2 \u89c4\u8303\uff09 meta\uff1a\u5b9a\u4e49\u8fd9\u4e2arole\u7684\u4e00\u4e9b\u5143\u6570\u636e 2. \u4f7f\u7528 roles \u00b6 \u5728playbook\u6587\u4ef6\u4e2d\u7f16\u5199\uff1a --- - hosts : webservers roles : - common - webservers \u8fd9\u4e3a\u6bcf\u4e2a\u89d2\u8272 x \u6307\u5b9a\u4e86\u4ee5\u4e0b\u884c\u4e3a\uff1a \u82e5\u5b58\u5728 roles/x/tasks/main.yml \uff0c\u4f1a\u5c06\u5176\u4e2d\u7684tasks\u52a0\u5165\u5230play\u4e2d roles/x/handlers/main.yml \uff0c\u52a0\u5165 roles/x/vars/main.yml \uff0c\u52a0\u5165 roles/x/defaults/main.yml \uff0c\u52a0\u5165 roles/x/meta/main.yml \uff0c\u52a0\u5165 roles/x/{files,templates,tasks}/ \u4e2d\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab copy\u3001script\u3001template \u6216\u6b64role\u4e2d\u5bfc\u5165\u7684tasks\u90fd\u53ef\u4ee5\u88ab\u5f15\u7528\u3002\u65e0\u9700\u5199\u76f8\u5bf9\u6216\u7edd\u5bf9\u8def\u5f84\u3002 playbook \u7684\u6267\u884c\u987a\u5e8f\uff1a \u5728play\u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55 pre_tasks \u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002 \u8f6e\u6d41\u6267\u884c roles \u4e2d\u7684\u6bcf\u4e2arole\u3002\u5728 meta/main.yml \u4e2d\u4f9d\u8d56\u7684role\u4f1a\u5148\u88ab\u8fd0\u884c\uff0c\u53d7\u6807\u7b7e\u8fc7\u6ee4\u548c\u6761\u4ef6\u9650\u5236\u3002 \u4efb\u4f55\u5728play\u4e2d\u5b9a\u4e49\u7684tasks\u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002 \u5728play\u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55 post_tasks \u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002 3. \u9ed8\u8ba4\u53d8\u91cf \u00b6 \u9ed8\u8ba4\u53d8\u91cf\u5141\u8bb8\u4f60\u5728\u5bfc\u5165\uff08included\uff09\u548c\u4f9d\u8d56\uff08dependent\uff09\u65f6\u8bbe\u7f6e\u9ed8\u8ba4\u53d8\u91cf\u3002\u8fd9\u4e9b\u53d8\u91cf\u62e5\u6709\u6700\u4f4e\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u88ab\u4efb\u4f55\u5176\u5b83\u7c7b\u578b\u7684\u53d8\u91cf\u6216inventory\u7684\u53d8\u91cf\u8986\u76d6\u3002 \u7f16\u5199 defaults/main.yml \u5373\u53ef\u521b\u5efa\u9ed8\u8ba4\u53d8\u91cf\u3002 4. \u4f8b\u5b50 \u00b6 4.1 \u4f7f\u7528\u666e\u901a\u7684playbook\u6587\u4ef6 \u00b6 \u76ee\u5f55\u7ed3\u6784\uff1a [ root@linux files ] # tree . \u251c\u2500\u2500 rpms \u2502 \u251c\u2500\u2500 qemu - kvm - ev - 2.3.0 - 31. x86_64 . rpm \u2502 \u2514\u2500\u2500 qemu - kvm - tools - ev - 2.3.0 - 31. x86_64 . rpm \u2514\u2500\u2500 upgrade - nodes . yml playbook\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat upgrade - nodes . yml --- - hosts : nodes tasks : - name : remove rpms firstly file : state : absent path : / root / test / rpm / - name : copy rpms to nodes copy : src : rpms / dest : / root / test / rpm / notify : - list rpms handlers : - name : list rpms command : ls - l / root / test / rpm / 4.2 \u4f7f\u7528roles\u7ed3\u6784 \u00b6 inventory\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat /etc/ansible/hosts [ nodes ] 192 .168.216.41 192 .168.216.42 \u76ee\u5f55\u7ed3\u6784\uff1a [ root@linux playbooks ] # pwd /usr/share/ansible/playbooks [ root@linux playbooks ] # tree . . \u251c\u2500\u2500 roles \u2502 \u2514\u2500\u2500 upgrade-nodes \u2502 \u251c\u2500\u2500 files \u2502 \u2502 \u2514\u2500\u2500 rpms \u2502 \u2502 \u251c\u2500\u2500 qemu-kvm-ev-2.3.0-31.x86_64.rpm \u2502 \u2502 \u2514\u2500\u2500 qemu-kvm-tools-ev-2.3.0-31.x86_64.rpm \u2502 \u251c\u2500\u2500 handlers \u2502 \u2502 \u2514\u2500\u2500 main.yml \u2502 \u2514\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u2514\u2500\u2500 upgrade-nodes.yml playbook\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat upgrade-nodes.yml --- - hosts : nodes roles : - upgrade-nodes tasks\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat roles/upgrade-nodes/tasks/main.yml --- - name : remove rpms firstly file : state : absent path : /root/test/rpm/ - name : copy rpms to nodes copy : src : rpms/ dest : /root/test/rpm/ notify : - list rpms handlers\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat roles/upgrade-nodes/handlers/main.yml - name : list rpms command : ls -l /root/test/rpm/ \u4f7f\u7528 -C \u9009\u9879\u65f6\uff0c\u53ef\u80fd\u4e0d\u4f1a\u89e6\u53d1handlers\u3002","title":"03. playbooks roles"},{"location":"ansible/03. playbooks-roles/#1","text":"site . yml webservers . yml fooservers . yml roles / common / tasks / handlers / files / templates / vars / defaults / meta / webservers / tasks / defaults / meta / tasks\uff1a\u5305\u542b\u4e3b\u8981\u7684\u88ab\u6267\u884c\u7684tasks\u5217\u8868 handlers\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u6240\u6709\u7684roles\u4f7f\u7528\u7684handlers defaults\uff1a\u5bf9\u4e8e\u8fd9\u4e2arole\u6765\u8bf4\u7684\u9ed8\u8ba4\u53d8\u91cf vars\uff1a\u5bf9\u4e8e\u8fd9\u4e2arole\u6765\u8bf4\u7684\u5176\u5b83\u53d8\u91cf files\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u8fd9\u4e2arole\u90e8\u7f72\u7684\u6587\u4ef6 templates\uff1a\u5305\u542b\u53ef\u4ee5\u88ab\u8fd9\u4e2arole\u90e8\u7f72\u7684\u6a21\u7248\u6587\u4ef6\uff08\u9075\u5faa Jinja2 \u89c4\u8303\uff09 meta\uff1a\u5b9a\u4e49\u8fd9\u4e2arole\u7684\u4e00\u4e9b\u5143\u6570\u636e","title":"1. \u76ee\u5f55\u7ed3\u6784"},{"location":"ansible/03. playbooks-roles/#2-roles","text":"\u5728playbook\u6587\u4ef6\u4e2d\u7f16\u5199\uff1a --- - hosts : webservers roles : - common - webservers \u8fd9\u4e3a\u6bcf\u4e2a\u89d2\u8272 x \u6307\u5b9a\u4e86\u4ee5\u4e0b\u884c\u4e3a\uff1a \u82e5\u5b58\u5728 roles/x/tasks/main.yml \uff0c\u4f1a\u5c06\u5176\u4e2d\u7684tasks\u52a0\u5165\u5230play\u4e2d roles/x/handlers/main.yml \uff0c\u52a0\u5165 roles/x/vars/main.yml \uff0c\u52a0\u5165 roles/x/defaults/main.yml \uff0c\u52a0\u5165 roles/x/meta/main.yml \uff0c\u52a0\u5165 roles/x/{files,templates,tasks}/ \u4e2d\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab copy\u3001script\u3001template \u6216\u6b64role\u4e2d\u5bfc\u5165\u7684tasks\u90fd\u53ef\u4ee5\u88ab\u5f15\u7528\u3002\u65e0\u9700\u5199\u76f8\u5bf9\u6216\u7edd\u5bf9\u8def\u5f84\u3002 playbook \u7684\u6267\u884c\u987a\u5e8f\uff1a \u5728play\u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55 pre_tasks \u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002 \u8f6e\u6d41\u6267\u884c roles \u4e2d\u7684\u6bcf\u4e2arole\u3002\u5728 meta/main.yml \u4e2d\u4f9d\u8d56\u7684role\u4f1a\u5148\u88ab\u8fd0\u884c\uff0c\u53d7\u6807\u7b7e\u8fc7\u6ee4\u548c\u6761\u4ef6\u9650\u5236\u3002 \u4efb\u4f55\u5728play\u4e2d\u5b9a\u4e49\u7684tasks\u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002 \u5728play\u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55 post_tasks \u3002 \u8fd0\u884c\u4efb\u4f55\u8fc4\u4eca\u4e3a\u6b62\u88ab\u89e6\u53d1\u7684handlers\u3002","title":"2. \u4f7f\u7528 roles"},{"location":"ansible/03. playbooks-roles/#3","text":"\u9ed8\u8ba4\u53d8\u91cf\u5141\u8bb8\u4f60\u5728\u5bfc\u5165\uff08included\uff09\u548c\u4f9d\u8d56\uff08dependent\uff09\u65f6\u8bbe\u7f6e\u9ed8\u8ba4\u53d8\u91cf\u3002\u8fd9\u4e9b\u53d8\u91cf\u62e5\u6709\u6700\u4f4e\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u88ab\u4efb\u4f55\u5176\u5b83\u7c7b\u578b\u7684\u53d8\u91cf\u6216inventory\u7684\u53d8\u91cf\u8986\u76d6\u3002 \u7f16\u5199 defaults/main.yml \u5373\u53ef\u521b\u5efa\u9ed8\u8ba4\u53d8\u91cf\u3002","title":"3. \u9ed8\u8ba4\u53d8\u91cf"},{"location":"ansible/03. playbooks-roles/#4","text":"","title":"4. \u4f8b\u5b50"},{"location":"ansible/03. playbooks-roles/#41-playbook","text":"\u76ee\u5f55\u7ed3\u6784\uff1a [ root@linux files ] # tree . \u251c\u2500\u2500 rpms \u2502 \u251c\u2500\u2500 qemu - kvm - ev - 2.3.0 - 31. x86_64 . rpm \u2502 \u2514\u2500\u2500 qemu - kvm - tools - ev - 2.3.0 - 31. x86_64 . rpm \u2514\u2500\u2500 upgrade - nodes . yml playbook\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat upgrade - nodes . yml --- - hosts : nodes tasks : - name : remove rpms firstly file : state : absent path : / root / test / rpm / - name : copy rpms to nodes copy : src : rpms / dest : / root / test / rpm / notify : - list rpms handlers : - name : list rpms command : ls - l / root / test / rpm /","title":"4.1 \u4f7f\u7528\u666e\u901a\u7684playbook\u6587\u4ef6"},{"location":"ansible/03. playbooks-roles/#42-roles","text":"inventory\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat /etc/ansible/hosts [ nodes ] 192 .168.216.41 192 .168.216.42 \u76ee\u5f55\u7ed3\u6784\uff1a [ root@linux playbooks ] # pwd /usr/share/ansible/playbooks [ root@linux playbooks ] # tree . . \u251c\u2500\u2500 roles \u2502 \u2514\u2500\u2500 upgrade-nodes \u2502 \u251c\u2500\u2500 files \u2502 \u2502 \u2514\u2500\u2500 rpms \u2502 \u2502 \u251c\u2500\u2500 qemu-kvm-ev-2.3.0-31.x86_64.rpm \u2502 \u2502 \u2514\u2500\u2500 qemu-kvm-tools-ev-2.3.0-31.x86_64.rpm \u2502 \u251c\u2500\u2500 handlers \u2502 \u2502 \u2514\u2500\u2500 main.yml \u2502 \u2514\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u2514\u2500\u2500 upgrade-nodes.yml playbook\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat upgrade-nodes.yml --- - hosts : nodes roles : - upgrade-nodes tasks\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat roles/upgrade-nodes/tasks/main.yml --- - name : remove rpms firstly file : state : absent path : /root/test/rpm/ - name : copy rpms to nodes copy : src : rpms/ dest : /root/test/rpm/ notify : - list rpms handlers\u6587\u4ef6\uff1a [ root@linux playbooks ] # cat roles/upgrade-nodes/handlers/main.yml - name : list rpms command : ls -l /root/test/rpm/ \u4f7f\u7528 -C \u9009\u9879\u65f6\uff0c\u53ef\u80fd\u4e0d\u4f1a\u89e6\u53d1handlers\u3002","title":"4.2 \u4f7f\u7528roles\u7ed3\u6784"},{"location":"c/mutiple definition of xxx/","text":"\u53c2\u8003\uff1ahttps://www.cnblogs.com/fnlingnzb-learner/p/5890065.html Warning \u4e0d\u8981\u5c06\u5168\u5c40\u53d8\u91cf\u548c\u5168\u5c40\u65b9\u6cd5\u7684\u5b9a\u4e49\u653e\u5728\u5934\u6587\u4ef6\u4e2d\u3002 \u7ed9\u6bcf\u4e2a\u5934\u6587\u4ef6\u90fd\u52a0\u4e0a\u6761\u4ef6\u7f16\u8bd1 #ifndef TEST_H #define TEST_H ...... #endif // TEST_H \u4f7f\u7528extern \u5728\u5934\u6587\u4ef6\u4e2d\u4f7f\u7528 extern \u5173\u952e\u5b57\u58f0\u660e\u5168\u5c40\u53d8\u91cf\uff0c\u5728 .c \u6587\u4ef6\u4e2d\u5b9a\u4e49\u5e76\u5f15\u5165\u5934\u6587\u4ef6\u3002","title":"Mutiple definition of xxx"},{"location":"c/\u52a8\u6001\u7f16\u8bd1/","text":"\u52a8\u6001\u5e93\u6587\u4ef6\u653e\u5728 /usr/lib64 \u4e0b\u9762\u3002 \u94fe\u63a5\u7684\u65f6\u5019\u8981\u6390\u5934\u53bb\u5c3e\u3002\u6bd4\u5982\u94fe\u63a5 libkmip.so \u6587\u4ef6\uff1a gcc test.c -o test -lkmip -ldl -lssl -lcrypto \u5b89\u88c5\u52a8\u6001\u5e93\u6587\u4ef6 \uff1a install -m libkmip.so.2.49_x86_64 /usr/lib64/libkmip.so","title":"\u52a8\u6001\u7f16\u8bd1"},{"location":"c/\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4/","text":"#include <time.h> time_t start , end ; //\u8ba1\u7b97\u7684\u662f1970\u5e741\u67081\u53f7\u4ee5\u6765\u7684 \u79d2\u6570 , time_t = long start = time ( NULL ); \u2026 end = time ( NULL ); difftime ( end , start ); //\u8fd4\u56de\u65f6\u95f4\u95f4\u9694\uff0c\u8fd4\u56dedouble\u7c7b\u578b clock_t start , end ; //\u8fd4\u56de\u4ece\u201c\u5f00\u542f\u8fd9\u4e2a\u7a0b\u5e8f\u8fdb\u7a0b\u201d\u5230\u201c\u7a0b\u5e8f\u4e2d\u8c03\u7528clock()\u51fd\u6570\u201d\u65f6\u4e4b\u95f4\u7684CPU\u65f6\u949f\u8ba1\u65f6\u5355\u5143\uff08clock tick\uff09\u6570\u3002 //1\u5355\u5143 = 1 ms,\u8981\u5728\u540c\u4e00\u4e2a\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u624d\u53ef\u8ba1\u7b97\u51fa\u65f6\u95f4\u5dee, clock_t = unsigned long start = clock (); \u2026 end = clock (); difftime ( end , start );","title":"\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4"},{"location":"c/\u7ed3\u6784\u4f53\u4e2d\u7684\u51fd\u6570\u6307\u9488/","text":"C\u8bed\u8a00\u662f\u53ef\u4ee5\u5728\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49\u51fd\u6570\u7684\u3002 \u5c06\u51fd\u6570\u5f53\u4f5c\u4e00\u4e2a\u6307\u9488\u53d8\u91cf\u6765\u770b\u5f85\u5c31\u5bb9\u6613\u7406\u89e3\u4e86\u3002 func.h #ifndef FUNC_H #define FUNC_H typedef struct data { char * name ; int ( * func_2 )( char * name ); } data ; int func_1 ( char * name ); #endif /* #ifndef FUNC_H */ func.c #include <stdio.h> int func_1 ( char * name ){ printf ( \"func_1 : %s \\n \" , name ); return 0 ; } main.c #include <stdlib.h> #include \"func.h\" void main (){ struct data * d ; d = ( struct data * ) malloc ( sizeof ( struct data * )); d -> name = \"ssh\" ; d -> func_2 = func_1 ; d -> func_2 ( d -> name ); } \u7f16\u8bd1\u8fd0\u884c\uff1a $ gcc -o main main.c func.c $ ./main func_1 : ssh","title":"\u7ed3\u6784\u4f53\u4e2d\u7684\u51fd\u6570\u6307\u9488"},{"location":"datastruct/\u4e8c\u53c9\u6811/","text":"\u4f7f\u7528\u4e8c\u53c9\u6811\u5b9e\u73b0\u6709\u5e8f\u7b26\u53f7\u8868\u3002 1. \u5b58\u50a8\u7ed3\u6784 \u00b6 /** * \u4e8c\u53c9\u67e5\u627e\u6811\u6709\u5e8f\u7b26\u53f7\u8868\uff0c\u63d2\u5165\u548c\u67e5\u627e\u90fd\u5f88\u5feb */ public class BST < K extends Comparable < K >, V >{ private Node root ; // \u6839\u8282\u70b9 private int base ; void setRoot ( Node node ){ this . root = node ; } private class Node { private K k ; private V v ; private Node left , right ; private int N ; // \u8be5\u5b50\u6811\u7684\u8282\u70b9\u6570 private Node ( K k , V v , int N ) { this . k = k ; this . v = v ; this . N = N ; } } 2. \u5de5\u5177\u51fd\u6570 \u00b6 public int size (){ return size ( root ); } private int size ( Node x ){ if ( null == x ){ return 0 ; } return x . N ; } boolean isEmpty (){ return root == null ; } 3. get\u65b9\u6cd5 \u00b6 //\u8fed\u4ee3\u5b9e\u73b0 V get ( K k ) { /*Node tmp = root; while (tmp != null){ int re = k.compareTo(tmp.k); if (re == 0){ return tmp.v; }else if (re > 0){ tmp = tmp.right; }else { tmp = tmp.left; } } return null;*/ //\u9012\u5f52\u5b9e\u73b0 return get ( root , k ); } //\u9012\u5f52\u5b9e\u73b0 private V get ( Node x , K k ){ if ( null == x ){ return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x . v ; } else if ( re > 0 ){ return get ( x . right , k ); } else { return get ( x . left , k ); } } 4. \u63d2\u5165\u65b9\u6cd5 \u00b6 //\u8fed\u4ee3\u5b9e\u73b0 void put ( K k , V v ) { /* if (null == root){ root = new Node(k, v, 1); return; } Node tmp = root; while (true){ int re = k.compareTo(tmp.k); if (re == 0){ // \u7b49\u4e8e\u5f53\u524d\u8282\u70b9 tmp.v = v; break; }else if(re > 0){ // \u5927\u4e8e tmp.N++; if (tmp.right == null){ tmp.right = new Node(k, v, 1); break; }else { tmp = tmp.right; } }else { // \u5c0f\u4e8e tmp.N++; if (tmp.left == null){ tmp.left = new Node(k, v, 1); break; }else { tmp = tmp.left; } } }*/ //\u9012\u5f52\u5b9e\u73b0 root = put ( root , k , v ); } //\u9012\u5f52\u5b9e\u73b0 Node put ( Node h , K k , V v ){ if ( h == null ){ return new Node ( k , v , 1 ); } int re = k . compareTo ( h . k ); if ( re < 0 ){ h . left = put2 ( h . left , k , v ); } else if ( re > 0 ){ h . right = put2 ( h . right , k , v ); } else { h . v = v ; return h ; } //\u522b\u5fd8\u4e86\u8c03\u6574\u5927\u5c0f\uff01\uff01\uff01 h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; } 5. \u5220\u9664\u65b9\u6cd5 \u00b6 void delete ( K k ) { root = delete ( root , k ); } private Node delete ( Node x , K k ){ if ( x == null ) { return null ; } int re = k . compareTo ( x . k ); if ( re > 0 ){ //forward and rebuild right-tree x . right = delete ( x . right , k ); } else if ( re < 0 ){ //forward and rebuild left-tree x . left = delete ( x . left , k ); } else { //x = deleteNode if ( x . left == null ){ //only right-tree exist or null return x . right ; } else if ( x . right == null ){ //only left-tree exist or null return x . left ; } else { //both left and right tree Node t = x ; x = min ( t . right ); x . right = deleteMin ( t . right ); x . left = t . left ; } } x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; } void deleteMin () { if ( isEmpty ()){ //\u9632\u6b62\u7a7a\u6307\u9488\u5f02\u5e38 return ; } root = deleteMin ( root ); } private Node deleteMin ( Node x ){ if ( x . left == null ){ //\u8fd4\u56de\u5230\u4e0a\u4e00\u7ea7\u7ed3\u70b9 return x . right ; //\u6ce8\u610f\u6b64\u5904\u8fd4\u56de\u7684\u662f\u53f3\u5b50\u7ed3\u70b9 } x . left = deleteMin ( x . left ); //\u66f4\u65b0\u5de6\u7ed3\u70b9 x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; } void deleteMax () { if ( isEmpty ()){ return ; } root = deleteMax ( root ); } private Node deleteMax ( Node x ){ if ( x . right == null ){ return x . left ; } x . right = deleteMax ( x . right ); x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; } 6. \u83b7\u53d6\u6781\u503c \u00b6 K min () { if ( isEmpty ()){ return null ; } //\u9012\u5f52\u5b9e\u73b0 return min ( root ). k ; } private Node min ( Node x ){ if ( x . left == null ){ return x ; } else { return min ( x . left ); } } //\u8fed\u4ee3\u5b9e\u73b0 K max () { if ( isEmpty ()){ return null ; } else { Node tmp = root ; while ( tmp != null ){ if ( tmp . right == null ){ return tmp . k ; } else { tmp = tmp . right ; } } } return null ; } 7. \u5411\u4e0a\u3001\u5411\u4e0b\u53d6\u6574 \u00b6 K floor ( K k ) { /* \u5411\u4e0b\u53d6\u6574\uff1b\u5c0f\u4e8e\u7b49\u4e8ek\u7684\u6700\u5927\u503c */ if ( isEmpty ()){ return null ; } //recursive return floor ( root , k ). k ; } private Node floor ( Node x , K k ){ if ( x == null ){ //\u5230\u8fbe\u53f6\u5b50\u8282\u70b9\u7684\u7a7a\u679d return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x ; } else if ( re < 0 ){ //left-tree return floor ( x . left , k ); } Node tmp = floor ( x . right , k ); //right-tree if ( tmp == null ){ return x ; } else { return tmp ; } } K ceiling ( K k ) { if ( isEmpty ()){ return null ; } return ceiling ( root , k ). k ; } private Node ceiling ( Node x , K k ){ /* \u5411\u4e0a\u53d6\u6574\uff1b\u5927\u4e8e\u7b49\u4e8ek\u7684\u6700\u5c0f\u503c */ if ( x == null ){ return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x ; } else if ( re > 0 ){ return ceiling ( x . right , k ); } Node tmp = ceiling ( x . left , k ); if ( tmp == null ){ return x ; } else { return tmp ; } } 8. \u6309\u5e8f\u83b7\u53d6\uff0c\u6b21\u5e8f \u00b6 K select ( int i ) { /* \u83b7\u53d6\u7b2ci\u4e2a\u503c */ Node re = select ( root , i ); if ( re == null ){ return null ; } else { return re . k ; } } private Node select ( Node x , int i ){ if ( x == null ){ return null ; } int tmp = size ( x . left ); if ( tmp == i ){ return x ; } else if ( tmp > i ){ return select ( x . left , i ); } else { return select ( x . right , i - tmp - 1 ); } } int rank ( K k ) { /* \u6b21\u5e8f */ return rank ( root , k ); } private int rank ( Node x , K k ){ if ( x == null ){ return 0 ; } int tmp = size ( x . left ); int re = k . compareTo ( x . k ); if ( re == 0 ){ return tmp ; } else if ( re > 0 ){ return tmp + rank ( x . right , k ) + 1 ; } else { return rank ( x . left , k ); } } void print (){ print ( root ); } private void print ( Node x ){ if ( x == null ){ return ; } print ( x . left ); System . out . println ( x . k ); print ( x . right ); } }","title":"\u4e8c\u53c9\u6811"},{"location":"datastruct/\u4e8c\u53c9\u6811/#1","text":"/** * \u4e8c\u53c9\u67e5\u627e\u6811\u6709\u5e8f\u7b26\u53f7\u8868\uff0c\u63d2\u5165\u548c\u67e5\u627e\u90fd\u5f88\u5feb */ public class BST < K extends Comparable < K >, V >{ private Node root ; // \u6839\u8282\u70b9 private int base ; void setRoot ( Node node ){ this . root = node ; } private class Node { private K k ; private V v ; private Node left , right ; private int N ; // \u8be5\u5b50\u6811\u7684\u8282\u70b9\u6570 private Node ( K k , V v , int N ) { this . k = k ; this . v = v ; this . N = N ; } }","title":"1. \u5b58\u50a8\u7ed3\u6784"},{"location":"datastruct/\u4e8c\u53c9\u6811/#2","text":"public int size (){ return size ( root ); } private int size ( Node x ){ if ( null == x ){ return 0 ; } return x . N ; } boolean isEmpty (){ return root == null ; }","title":"2. \u5de5\u5177\u51fd\u6570"},{"location":"datastruct/\u4e8c\u53c9\u6811/#3-get","text":"//\u8fed\u4ee3\u5b9e\u73b0 V get ( K k ) { /*Node tmp = root; while (tmp != null){ int re = k.compareTo(tmp.k); if (re == 0){ return tmp.v; }else if (re > 0){ tmp = tmp.right; }else { tmp = tmp.left; } } return null;*/ //\u9012\u5f52\u5b9e\u73b0 return get ( root , k ); } //\u9012\u5f52\u5b9e\u73b0 private V get ( Node x , K k ){ if ( null == x ){ return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x . v ; } else if ( re > 0 ){ return get ( x . right , k ); } else { return get ( x . left , k ); } }","title":"3. get\u65b9\u6cd5"},{"location":"datastruct/\u4e8c\u53c9\u6811/#4","text":"//\u8fed\u4ee3\u5b9e\u73b0 void put ( K k , V v ) { /* if (null == root){ root = new Node(k, v, 1); return; } Node tmp = root; while (true){ int re = k.compareTo(tmp.k); if (re == 0){ // \u7b49\u4e8e\u5f53\u524d\u8282\u70b9 tmp.v = v; break; }else if(re > 0){ // \u5927\u4e8e tmp.N++; if (tmp.right == null){ tmp.right = new Node(k, v, 1); break; }else { tmp = tmp.right; } }else { // \u5c0f\u4e8e tmp.N++; if (tmp.left == null){ tmp.left = new Node(k, v, 1); break; }else { tmp = tmp.left; } } }*/ //\u9012\u5f52\u5b9e\u73b0 root = put ( root , k , v ); } //\u9012\u5f52\u5b9e\u73b0 Node put ( Node h , K k , V v ){ if ( h == null ){ return new Node ( k , v , 1 ); } int re = k . compareTo ( h . k ); if ( re < 0 ){ h . left = put2 ( h . left , k , v ); } else if ( re > 0 ){ h . right = put2 ( h . right , k , v ); } else { h . v = v ; return h ; } //\u522b\u5fd8\u4e86\u8c03\u6574\u5927\u5c0f\uff01\uff01\uff01 h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; }","title":"4. \u63d2\u5165\u65b9\u6cd5"},{"location":"datastruct/\u4e8c\u53c9\u6811/#5","text":"void delete ( K k ) { root = delete ( root , k ); } private Node delete ( Node x , K k ){ if ( x == null ) { return null ; } int re = k . compareTo ( x . k ); if ( re > 0 ){ //forward and rebuild right-tree x . right = delete ( x . right , k ); } else if ( re < 0 ){ //forward and rebuild left-tree x . left = delete ( x . left , k ); } else { //x = deleteNode if ( x . left == null ){ //only right-tree exist or null return x . right ; } else if ( x . right == null ){ //only left-tree exist or null return x . left ; } else { //both left and right tree Node t = x ; x = min ( t . right ); x . right = deleteMin ( t . right ); x . left = t . left ; } } x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; } void deleteMin () { if ( isEmpty ()){ //\u9632\u6b62\u7a7a\u6307\u9488\u5f02\u5e38 return ; } root = deleteMin ( root ); } private Node deleteMin ( Node x ){ if ( x . left == null ){ //\u8fd4\u56de\u5230\u4e0a\u4e00\u7ea7\u7ed3\u70b9 return x . right ; //\u6ce8\u610f\u6b64\u5904\u8fd4\u56de\u7684\u662f\u53f3\u5b50\u7ed3\u70b9 } x . left = deleteMin ( x . left ); //\u66f4\u65b0\u5de6\u7ed3\u70b9 x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; } void deleteMax () { if ( isEmpty ()){ return ; } root = deleteMax ( root ); } private Node deleteMax ( Node x ){ if ( x . right == null ){ return x . left ; } x . right = deleteMax ( x . right ); x . N = size ( x . left ) + size ( x . right ) + 1 ; return x ; }","title":"5. \u5220\u9664\u65b9\u6cd5"},{"location":"datastruct/\u4e8c\u53c9\u6811/#6","text":"K min () { if ( isEmpty ()){ return null ; } //\u9012\u5f52\u5b9e\u73b0 return min ( root ). k ; } private Node min ( Node x ){ if ( x . left == null ){ return x ; } else { return min ( x . left ); } } //\u8fed\u4ee3\u5b9e\u73b0 K max () { if ( isEmpty ()){ return null ; } else { Node tmp = root ; while ( tmp != null ){ if ( tmp . right == null ){ return tmp . k ; } else { tmp = tmp . right ; } } } return null ; }","title":"6. \u83b7\u53d6\u6781\u503c"},{"location":"datastruct/\u4e8c\u53c9\u6811/#7","text":"K floor ( K k ) { /* \u5411\u4e0b\u53d6\u6574\uff1b\u5c0f\u4e8e\u7b49\u4e8ek\u7684\u6700\u5927\u503c */ if ( isEmpty ()){ return null ; } //recursive return floor ( root , k ). k ; } private Node floor ( Node x , K k ){ if ( x == null ){ //\u5230\u8fbe\u53f6\u5b50\u8282\u70b9\u7684\u7a7a\u679d return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x ; } else if ( re < 0 ){ //left-tree return floor ( x . left , k ); } Node tmp = floor ( x . right , k ); //right-tree if ( tmp == null ){ return x ; } else { return tmp ; } } K ceiling ( K k ) { if ( isEmpty ()){ return null ; } return ceiling ( root , k ). k ; } private Node ceiling ( Node x , K k ){ /* \u5411\u4e0a\u53d6\u6574\uff1b\u5927\u4e8e\u7b49\u4e8ek\u7684\u6700\u5c0f\u503c */ if ( x == null ){ return null ; } int re = k . compareTo ( x . k ); if ( re == 0 ){ return x ; } else if ( re > 0 ){ return ceiling ( x . right , k ); } Node tmp = ceiling ( x . left , k ); if ( tmp == null ){ return x ; } else { return tmp ; } }","title":"7. \u5411\u4e0a\u3001\u5411\u4e0b\u53d6\u6574"},{"location":"datastruct/\u4e8c\u53c9\u6811/#8","text":"K select ( int i ) { /* \u83b7\u53d6\u7b2ci\u4e2a\u503c */ Node re = select ( root , i ); if ( re == null ){ return null ; } else { return re . k ; } } private Node select ( Node x , int i ){ if ( x == null ){ return null ; } int tmp = size ( x . left ); if ( tmp == i ){ return x ; } else if ( tmp > i ){ return select ( x . left , i ); } else { return select ( x . right , i - tmp - 1 ); } } int rank ( K k ) { /* \u6b21\u5e8f */ return rank ( root , k ); } private int rank ( Node x , K k ){ if ( x == null ){ return 0 ; } int tmp = size ( x . left ); int re = k . compareTo ( x . k ); if ( re == 0 ){ return tmp ; } else if ( re > 0 ){ return tmp + rank ( x . right , k ) + 1 ; } else { return rank ( x . left , k ); } } void print (){ print ( root ); } private void print ( Node x ){ if ( x == null ){ return ; } print ( x . left ); System . out . println ( x . k ); print ( x . right ); } }","title":"8. \u6309\u5e8f\u83b7\u53d6\uff0c\u6b21\u5e8f"},{"location":"datastruct/\u6563\u5217\u8868/","text":"\u4e3a\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\u4e00\u4e2a\u4f18\u79c0\u7684\u6563\u5217\u65b9\u6cd5\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\uff1a \u4e00\u81f4\u6027----\u7b49\u4ef7\u7684\u952e\u5fc5\u7136\u4ea7\u751f\u76f8\u7b49\u7684\u6563\u5217\u503c \u9ad8\u6548\u6027----\u8ba1\u7b97\u7b80\u4fbf \u5747\u5300\u6027----\u5747\u5300\u5730\u6563\u5217\u6240\u6709\u7684\u952e \u5bf9\u4e8e\u6563\u5217\u8ba1\u7b97\u5f88\u8017\u65f6\uff0c\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u952e\u7684\u6563\u5217\u503c\u7f13\u5b58\u8d77\u6765\u3002 pdf\uff1a149 union-find pdf\uff1a363 \u5b9a\u4e49\uff1a\u7ed9\u5b9a\u65e0\u5b64\u7acb\u7ed3\u70b9\u56feG\uff0c\u82e5\u5b58\u5728\u4e00\u6761\u8def\uff0c\u7ecf\u8fc7\u56fe\u4e2d\u6bcf\u8fb9\u4e00\u6b21\u4e14\u4ec5\u4e00\u6b21\uff0c\u8be5\u6761\u8def\u79f0\u4e3a\u6b27\u62c9\u8def\uff1b\u82e5\u5b58\u5728\u4e00\u6761\u56de\u8def\uff0c\u7ecf\u8fc7\u56fe\u4e2d\u6bcf\u8fb9\u4e00\u6b21\u4e14\u4ec5\u4e00\u6b21\uff0c\u8be5\u56de\u8def\u79f0\u4e3a\u6b27\u62c9\u56de\u8def\u3002 \u5177\u6709\u6b27\u62c9\u56de\u8def\u7684\u56fe\u79f0\u4f5c\u6b27\u62c9\u56fe\u3002 - \u65e0\u5411\u56fe\u5b9a\u7406\uff1a 1 . \u65e0\u5411\u56fe G\u5177\u6709\u4e00\u6761\u6b27\u62c9\u8def \uff0c\u5f53\u4e14\u4ec5\u5f53 G\u662f\u8fde\u901a\u7684 \uff0c\u4e14\u6709\u96f6\u4e2a\u6216\u4e24\u4e2a\u5947\u6570\u5ea6\u7ed3\u70b9\u3002 2 . \u65e0\u5411\u56fe G\u5177\u6709\u4e00\u6761\u6b27\u62c9\u56de\u8def \uff0c\u5f53\u4e14\u4ec5\u5f53 G\u662f\u8fde\u901a\u7684 \uff0c\u5e76\u4e14\u6240\u6709\u7ed3\u70b9\u5ea6\u6570\u5168\u4e3a\u5076\u6570\u3002 - \u6709\u5411\u56fe\u5b9a\u7406\uff1a 1 . \u7ed9\u5b9a\u6709\u5411\u56fe G \uff0c\u901a\u8fc7\u56fe\u4e2d\u6bcf\u8fb9\u4e00\u6b21\u4e14\u4ec5\u4e00\u6b21\u7684\u4e00\u6761\u5355\u5411\u8def ( \u56de\u8def ) \uff0c\u79f0\u4f5c\u5355\u5411\u6b27\u62c9\u8def ( \u56de\u8def ) \u3002 2 . \u6709\u5411\u56fe G\u5177\u6709\u4e00\u6761\u5355\u5411\u6b27\u62c9\u56de\u8def \uff0c\u5f53\u4e14\u4ec5\u5f53\u662f\u8fde\u901a\u7684\uff0c\u4e14\u6bcf\u4e2a\u7ed3\u70b9\u5165\u5ea6\u7b49\u4e8e\u51fa\u5ea6\u3002\u4e00\u4e2a\u6709\u5411\u56fe G\u5177\u6709\u5355\u5411\u6b27\u62c9\u8def \uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u662f\u8fde\u901a\u7684\uff0c\u800c\u4e14\u9664\u4e24\u4e2a\u7ed3\u70b9\u5916\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u7684\u5165\u5ea6\u7b49\u4e8e\u51fa\u5ea6\uff0c\u4f46\u8fd9\u4e24\u4e2a\u7ed3\u70b9\u4e2d\uff0c\u4e00\u4e2a\u7ed3\u70b9\u7684\u5165\u5ea6\u6bd4\u51fa\u5ea6\u5927 1 \uff0c\u53e6\u4e00\u4e2a\u7ed3\u70b9\u7684\u5165\u5ea6\u6bd4\u51fa\u5ea6\u5c0f 1 \u3002 \u5b9a\u4e49\uff1a\u7ed9\u5b9a\u56feG\uff0c\u82e5\u5b58\u5728\u4e00\u6761\u8def\u7ecf\u8fc7\u56fe\u4e2d\u7684\u6bcf\u4e2a\u7ed3\u70b9\u6070\u597d\u4e00\u6b21\uff0c\u8fd9\u6761\u8def\u79f0\u4f5c\u6c49\u5bc6\u5c14\u987f\u8def\u3002\u82e5\u5b58\u5728\u4e00\u6761\u56de\u8def\uff0c\u7ecf\u8fc7\u56fe\u4e2d\u7684\u6bcf\u4e2a\u7ed3\u70b9\u6070\u597d\u4e00\u6b21\uff0c\u8fd9\u6761\u56de\u8def\u79f0\u4f5c\u6c49\u5bc6\u5c14\u987f\u56de\u8def\u3002 \u5177\u6709\u6c49\u5bc6\u5c14\u987f\u56de\u8def\u7684\u56fe\u79f0\u4f5c\u6c49\u5bc6\u5c14\u987f\u56fe\u3002 - \u65e0\u5411\u56fe\u5b9a\u7406\uff1a 1 . \u8bbe G\u662f\u5177\u6709n\u4e2a\u7ed3\u70b9\u7684\u7b80\u5355\u56fe \u3002\u5982\u679c G\u4e2d\u6bcf\u4e00\u5bf9\u7ed3\u70b9\u5ea6\u6570\u4e4b\u548c\u5927\u4e8e\u7b49\u4e8en \uff0c\u5219\u5728 G\u4e2d\u5b58\u5728\u4e00\u6761\u6c49\u5bc6\u5c14\u987f\u56de\u8def","title":"\u6563\u5217\u8868"},{"location":"datastruct/\u7ea2\u9ed1\u6811/","text":"1. \u4e00\u4e9b\u6982\u5ff5\uff1a \u00b6 \u5982\u679c\u4e00\u4e2a\u7ed3\u70b9\u53ea\u5b58\u50a8\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u90a3\u4e48\u53eb\u505a 2-\u7ed3\u70b9 \uff0c\u6240\u7ec4\u6210\u7684\u6811\u53eb\u505a 2-\u6811 \u3002\u540c\u7406\uff0c\u5b58\u50a8\u4e24\u4e2a\u952e\u503c\u5bf9\u7684\u7ed3\u70b9\u53eb\u505a 3-\u7ed3\u70b9 \u3002\u5982\u679c\u4e00\u4e2a\u6811\u4e2d\u542b\u6709\u8fd9\u4e24\u79cd\u7ed3\u70b9\uff0c\u90a3\u4e48\u79f0\u4f5c 2-3\u6811 \u3002 \u7ea2\u9ed1\u6811\u662f\u4e00\u79cd\u57fa\u4e8e\u6709\u5e8f\u7b26\u53f7\u8868\u7684\u4e8c\u53c9\u5e73\u8861\u6811\u7684\u5b9e\u73b0\u3002 \u7ea2\u9ed1\u6811\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u5b9a\u4e49\u662f\u6ee1\u8db3\u4e0b\u9762\u6761\u4ef6\u7684\u4e8c\u53c9\u67e5\u627e\u6811\uff1a \u7ea2\u94fe\u63a5\u5747\u4e3a\u5de6\u94fe\u63a5 \u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u7ed3\u70b9\u540c\u65f6\u548c\u4e24\u6761\u7ea2\u94fe\u63a5\u76f8\u8fde \u8be5\u6811\u662f\u5b8c\u7f8e\u9ed1\u8272\u5e73\u8861\u7684\uff0c\u5373\u4efb\u610f\u7a7a\u94fe\u63a5\u5230\u6839\u7ed3\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u9ed1\u94fe\u63a5\u6570\u91cf\u76f8\u540c \u8fd9\u6837\u7684\u6811\u548c2-3\u6811\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002 2. \u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5b9e\u73b0 \u00b6 2.1 \u5b58\u50a8\u7ed3\u70b9 \u00b6 public class RedBlackBST < K extends Comparable < K >, V > { private Node root ; private static final boolean RED = true ; private static final boolean BLACK = false ; private class Node { private K k ; private V v ; private Node left , right ; private int N ; private boolean color ; //\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u8868\u793a\u6307\u5411\u8be5\u7ed3\u70b9\u7684\u94fe\u63a5\u7684\u989c\u8272 Node ( K k , V v , int n , boolean color ) { this . k = k ; this . v = v ; N = n ; this . color = color ; } } } 2.2 \u57fa\u672c\u65b9\u6cd5 \u00b6 \u5de6\u65cb\u548c\u53f3\u65cb\u3002\u5de6\u65cb\u5373\u628a\u5de6\u8fb9\u7684\u7ea2\u94fe\u63a5\u8f6c\u6362\u5230\u53f3\u8fb9\u53bb\uff1b\u53f3\u65cb\u76f8\u53cd \u5728\u7ea2\u9ed1\u6811\u7684\u53d8\u6362\u4e2d\uff0c\u662f\u901a\u8fc7\u4e0d\u65ad\u7684\u5de6\u65cb\u4e0e\u53f3\u65cb\u6765\u5b9e\u73b0\u7684\uff0c\u6545\u9700\u8981\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002 \u5de6\u65cb private Node rotateLeft ( Node h ){ /* \u5c06\u4e00\u4e2a\u53f3\u94fe\u63a5\u4e3a\u7ea2\u8272\u7684\u7ed3\u70b9\u5de6\u65cb\u3002\u6d89\u53ca\u5230\u5b50\u6811\u4e2d\u7ed3\u70b9\u4f4d\u7f6e\u7684\u53d8\u6362\uff0c\u989c\u8272\u7684\u6539\u53d8\uff0c\u7ed3\u70b9\u6570\u91cf\u7684\u6539\u53d8\u3002 */ Node x = h . right ; h . right = x . left ; x . left = h ; x . color = h . color ; h . color = RED ; x . N = h . N ; h . N = size ( h . left ) + size ( h . right ) + 1 ; return x ; } \u53f3\u65cb\u53ea\u9700\u5c06\u65b9\u5411\u76f8\u53cd\u5373\u53ef\u3002 \u989c\u8272\u8f6c\u6362 \u5728\u63d2\u5165\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e24\u4e2a\u5b50\u7ed3\u70b9\u90fd\u4e3a\u7ea2\u8272\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u76f8\u5f53\u4e8e\u53d8\u6210\u4e86 4-\u7ed3\u70b9 \uff0c\u6240\u4ee5\u9700\u8981\u5c06\u4e2d\u95f4\u7ed3\u70b9\u63d0\u53d6\u51fa\u6765\uff0c\u53d8\u6210\u4e24\u4e2a 2-\u7ed3\u70b9 \uff0c\u5c06\u4e2d\u95f4\u7684\u7ed3\u70b9\u653e\u5230\u7236\u7ed3\u70b9\u4e2d\u7ee7\u7eed\u5904\u7406\u3002 private void flipColor ( Node h , boolean reverse ){ if ( reverse ){ /* \u5220\u9664\u64cd\u4f5c\u7684\u8f6c\u6362\uff0c\u4e3a\u4e86\u6784\u90203-\u62164-\u5b50\u7ed3\u70b9\u3002\u8f6c\u6362\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e24\u4e2a\u9ed1\u8272\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u5e76\u5c06\u81ea\u5df1\u53d8\u4e3a\u9ed1\u8272\u7ed3\u70b9\u3002 */ h . color = BLACK ; h . right . color = h . left . color = RED ; } else { /* \u63d2\u5165\u64cd\u4f5c\u7684\u8f6c\u6362\u3002\u8f6c\u6362\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e24\u4e2a\u7ea2\u8272\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u5e76\u5c06\u81ea\u5df1\u53d8\u4e3a\u7ea2\u8272\u7ed3\u70b9\uff0c\u76f8\u5f53\u4e8e\u628a\u81ea\u5df1\u9001\u5165\u5230\u7236\u8282\u70b9\u4e2d\u3002 */ h . color = RED ; h . right . color = h . left . color = BLACK ; } } 2.3 \u63d2\u5165\u64cd\u4f5c \u00b6 \u5c06\u65b0\u7ed3\u70b9\u4e0d\u65ad\u7684\u5411\u4e0b\u904d\u5386\uff0c\u76f4\u5230\u6210\u4e3a\u53f6\u5b50\u8282\u70b9\u3002 \u63d2\u5165\u65b0\u7684\u7ed3\u70b9\u540e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e09\u79cd\u60c5\u51b5\uff1a \u82e5\u53f3\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\u800c\u5de6\u5b50\u7ed3\u70b9\u662f\u9ed1\u8272\uff0c\u90a3\u4e48\u5de6\u65cb \u82e5\u5de6\u5b50\u7ed3\u70b9\u4e3a\u7ea2\u8272\u5e76\u4e14\u5b83\u7684\u5de6\u5b50\u7ed3\u70b9\u4e5f\u4e3a\u7ea2\u8272\uff0c\u5373\u5b58\u5728\u4e24\u4e2a\u76f8\u8fde\u7684\u7ea2\u94fe\uff0c\u90a3\u4e48\u5148\u53f3\u65cb\u9876\u90e8\u7684\u7ed3\u70b9\uff0c\u518d\u6267\u884c3. \u82e5\u4e24\u4e2a\u5b50\u7ed3\u70b9\u90fd\u4e3a\u7ea2\u8272\uff0c\u90a3\u4e48\u6539\u53d8\u989c\u8272 void put ( K k , V v ){ root = put ( root , k , v ); root . color = BLACK ; } private Node put ( Node h , K k , V v ){ //\u63d2\u5165\u65b0\u7684\u7ed3\u70b9\uff0c\u6ce8\u610f\u662f\u7ea2\u8272\u7ed3\u70b9 if ( h == null ){ return new Node ( k , v , 1 , RED ); } //\u5411\u4e0b\u904d\u5386 int re = k . compareTo ( h . k ); if ( re == 0 ){ //\u8fd9\u91cc\u4e0d\u80fd\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff1f\uff1f\uff1f h . v = v ; } else if ( re > 0 ){ h . right = put ( h . right , k , v ); } else { h . left = put ( h . left , k , v ); } //1.\u5de6\u65cb if ( isRed ( h . right ) && ! isRed ( h . left )){ h = rotateLeft ( h ); } //2.\u53f3\u65cb if ( isRed ( h . left ) && isRed ( h . left . left )){ h = rotateRight ( h ); } //3.\u8f6c\u6362 if ( isRed ( h . left ) && isRed ( h . right )){ flipColor ( h , false ); } h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; } 2.4 \u5220\u9664\u6700\u5c0f\u7684\u952e\u503c\u5bf9 \u00b6 \u5220\u9664\u7684\u65f6\u5019\u5141\u8bb8\u4e34\u65f6\u7684 4-\u7ed3\u70b9 \u5b58\u5728\u3002 \u5728\u5220\u9664\u6700\u5c0f\u952e\u7684\u65f6\u5019\uff0c\u56e0\u8981\u4fdd\u6301\u6811\u7684\u5e73\u8861\uff0c\u6240\u4ee5\u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u5de6\u5b50\u7ed3\u70b9\u90fd\u4e0d\u662f 2-\u7ed3\u70b9 \uff0c\u5373\u5c06\u9047\u5230\u7684\u6bcf\u4e2a2-\u7ed3\u70b9\u90fd\u8f6c\u5316\u4e3a3-\u7ed3\u70b9\u62164-\u7ed3\u70b9\uff0c\u8fd9\u6837\u5220\u9664\u7684\u65f6\u5019\u6811\u4ecd\u7136\u662f\u5e73\u8861\u7684\u3002 private Node balance ( Node h ){ /*\u5e73\u8861\u7ea2\u9ed1\u6811\uff0c\u53ea\u8981\u5728put()\u65b9\u6cd5\u7684\u540e\u4e94\u53e5\u52a0\u4e0a\u6b64\u53e5\u5c31\u80fd\u8fbe\u5230\u6548\u679c???*/ //\u5bf9\u53ef\u80fd\u51fa\u73b0\u7684\u4e0d\u5e73\u8861\u7684\u60c5\u51b5\u505a\u9884\u5904\u7406 if ( isRed ( h . right )){ h = rotateLeft ( h ); } if ( isRed ( h . right ) && ! isRed ( h . left )){ h = rotateLeft ( h ); } if ( isRed ( h . left ) && isRed ( h . left . left )){ h = rotateRight ( h ); } if ( isRed ( h . left ) && isRed ( h . right )){ flipColor ( h , false ); } h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; } private Node moveRedLeft ( Node h ){ //\u53d8\u4e3ah\u662f\u9ed1\u8272\uff08\u4e3a\u4e86\u4e0d\u4f1a\u4ea7\u751f5-\u7ed3\u70b9\uff09\uff0c\u4e24\u4e2a\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\uff0c\u5148\u5c06h\u53d8\u6210\u4e86\u4e00\u4e2a3-\u7ed3\u70b9\uff0c\u4fdd\u8bc1\u5de6\u5b50\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 flipColor ( h , true ); //\u82e5\u53f3\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9\uff0c\u5c06\u4e00\u4e2a\u952e\u79fb\u52a8\u5230\u5de6\u5b50\u7ed3\u70b9\u4e2d\uff0ch\u7ee7\u7eed\u53d8\u6210\u4e00\u4e2a4-\u7ed3\u70b9\uff1b\u6b64\u65f6\u56e0\u4e3a\u5df2\u7ecf\u5c06\u53f3\u7ed3\u70b9\u53d8\u4e3a\u7ea2\u8272\uff0c\u6240\u4ee5\u65e0\u9700\u5224\u65ad\u5176\u989c\u8272\u3002 if ( isRed ( h . right . left )){ h . right = rotateRight ( h . right ); //\u53f3\u65cbh\u7684\u53f3\u5b50\u6811\uff0c\u53d8\u4e3a\u53f3\u8fb9\u76844-\u7ed3\u70b9 h = rotateLeft ( h ); //\u518d\u5de6\u65cbh\uff0c\u5c06\u5de6\u5b50\u6811\u53d8\u4e3a4-\u7ed3\u70b9 } return h ; } void deleteMin () { //\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u8f6c\u53d8\u989c\u8272??? if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = deleteMin ( root ); if (! isEmpty ()){ root . color = BLACK ; } } private Node deleteMin ( Node h ){ //\u5220\u9664\u6700\u5c0f\u7ed3\u70b9 if ( h . left == null ){ return null ; } //\u5de6\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u662f2-\u7ed3\u70b9\uff0c\u8f6c\u6362\u4e3a\u975e2-\u7ed3\u70b9\uff0c\u53ef\u80fd\u662f3-\u7ed3\u70b9\u62164-\u7ed3\u70b9 if (! isRed ( h . left ) && ! isRed ( h . left . left )){ h = moveRedLeft ( h ); } //\u6b64\u65f6\u5df2\u7ecf\u4fdd\u8bc1\u4e86\u5de6\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 //\u5411\u4e0b\u5220\u9664\u7ed3\u70b9\uff0c\u6539\u53d8\u7ea2\u9ed1\u6811\u7ed3\u6784 h . left = deleteMin ( h . left ); //\u5411\u4e0a\u5e73\u8861\u7ea2\u9ed1\u6811\uff0c\u6d88\u9664\u4e34\u65f6\u4ea7\u751f\u76844-\u7ed3\u70b9\uff0c\u5e73\u8861\u4e4b\u540e\u518d\u66f4\u65b0\u7ed3\u70b9\u5927\u5c0f return balance ( h ); } 2.5 \u5220\u9664\u6700\u5927\u7684\u952e\u503c\u5bf9 \u00b6 \u56e0\u7ea2\u94fe\u63a5\u90fd\u4e3a\u5de6\u94fe\u63a5\uff0c\u6240\u4ee5\u6709\u7a0d\u5fae\u4e0d\u540c\u3002 private Node moveRedRight ( Node h ){ //\u53d8\u4e3ah\u662f\u9ed1\u8272\uff0c\u4e24\u4e2a\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\uff0c\u5148\u5c06h\u53d8\u6210\u53f3\u8fb9\u76843-\u7ed3\u70b9\uff0c\u4fdd\u8bc1\u53f3\u5b50\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 flipColor ( h , true ); //h\u7684\u5de6\u5b50\u7ed3\u70b9\u4e5f\u662f2-\u7ed3\u70b9\uff0c\u5c06h\u7684\u53f3\u5b50\u7ed3\u70b9\u7ee7\u7eed\u53d8\u4e3a\u53f3\u8fb9\u76844-\u7ed3\u70b9 if (! isRed ( h . left . left )){ h = rotateRight ( h ); } return h ; } void deleteMax () { if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = deleteMax ( root ); if (! isEmpty ()){ root . color = BLACK ; } } private Node deleteMax ( Node h ){ //\u5c06\u4e3a\u7ea2\u8272\u7684\u5de6\u6839\u7ed3\u70b9\u76f4\u63a5\u8f6c\u5230\u53f3\u8fb9\u6765 if ( isRed ( h . left )){ h = rotateRight ( h ); } //\u5220\u9664\u6700\u5927\u7ed3\u70b9 if ( h . right == null ){ return null ; } //h\u7684\u53f3\u5b50\u7ed3\u70b9\u662f\u9ed1\u8272\u7ed3\u70b9\uff0c\u5e76\u4e14\u53f3\u5b50\u6811\u4e0d\u662f3-\u7ed3\u70b9\u3002 //\u56e0\u4e3a\u7b2c\u4e00\u6b65\u5df2\u7ecf\u76f4\u63a5\u628a\u4e3a\u7ea2\u8272\u7684\u5de6\u6839\u7ed3\u70b9\u8f6c\u5230\u53f3\u8fb9\uff0c\u4fdd\u8bc1\u4e86\u6b64\u53f3\u6811\u662f\u53f3\u8fb9\u76843-\u7ed3\u70b9\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u53d8\u5e7b\uff0c\u8981\u5c06\u5176\u8fc7\u6ee4 if (! isRed ( h . right ) && ! isRed ( h . right . left )){ h = moveRedRight ( h ); } //\u5411\u4e0b\u5220\u9664\u7ed3\u70b9 h . right = deleteMax ( h . right ); //\u5411\u4e0a\u5e73\u8861\u4e8c\u53c9\u6811 return balance ( h ); } 2.6 \u5220\u9664\u64cd\u4f5c \u00b6 \u5c06\u5220\u9664\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u7ed3\u5408\u8d77\u6765\u5b8c\u6210\u5220\u9664\u64cd\u4f5c\u3002 void delete ( K k ) { if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = delete ( root , k ); if (! isEmpty ()){ root . color = BLACK ; } } private Node delete ( Node h , K k ){ //\u5728\u5de6\u5b50\u6811\u4e2d if ( k . compareTo ( h . k ) < 0 ){ if (! isRed ( h . left ) && ! isRed ( h . left . left )){ h = moveRedLeft ( h ); } h . left = delete ( h . left , k ); } //\u627e\u5230\u4e86\u8be5\u7ed3\u70b9\u6216\u5728\u53f3\u5b50\u6811\u4e2d else { if ( isRed ( h . left )){ h = rotateRight ( h ); } //\u627e\u5230\u8be5\u7ed3\u70b9\uff0c\u5e76\u4e14\u53f3\u5b50\u6811\u4e3a\u7a7a\uff0c\u65e0\u9700\u8c03\u6574\u7ed3\u6784\uff0c\u5220\u9664\u8be5\u7ed3\u70b9 if ( k . compareTo ( h . k ) == 0 && ( h . right == null )){ return null ; } //\u53f3\u5b50\u6811\u662f2-\u7ed3\u70b9\uff0c\u8f6c\u5316\u4e3a\u53f3\u8fb9\u76844-\u62163-\u7ed3\u70b9 if (! isRed ( h . right ) && ! isRed ( h . right . left )){ h = moveRedRight ( h ); } //\u627e\u5230\u4e86\u8be5\u7ed3\u70b9\uff0c\u4f46\u662f\u53f3\u5b50\u6811\u4e0d\u4e3a\u7a7a\uff0c\u6240\u4ee5\u9700\u8981\u8c03\u6574\u7ed3\u6784\uff1b\u4e0e\u4e8c\u53c9\u6811\u7684\u5220\u9664\u65b9\u6cd5\u7c7b\u4f3c if ( k . compareTo ( h . k ) == 0 ){ h . v = get ( h . right , min ( h . right ). k ); h . k = min ( h . right ). k ; h . right = deleteMin ( h . right ); } //\u8be5\u7ed3\u70b9\u5728\u53f3\u5b50\u6811\u4e2d else { h . right = delete ( h . right , k ); } } return balance ( h ); } 2.7 \u5176\u5b83\u65b9\u6cd5 \u00b6 \u5bf9\u4e8e\u5176\u5b83\u65b9\u6cd5\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u6d89\u53ca\u5230\u989c\u8272\u8f6c\u6362\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e8c\u53c9\u6811\u7684\u65b9\u6cd5\u3002","title":"\u7ea2\u9ed1\u6811"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#1","text":"\u5982\u679c\u4e00\u4e2a\u7ed3\u70b9\u53ea\u5b58\u50a8\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u90a3\u4e48\u53eb\u505a 2-\u7ed3\u70b9 \uff0c\u6240\u7ec4\u6210\u7684\u6811\u53eb\u505a 2-\u6811 \u3002\u540c\u7406\uff0c\u5b58\u50a8\u4e24\u4e2a\u952e\u503c\u5bf9\u7684\u7ed3\u70b9\u53eb\u505a 3-\u7ed3\u70b9 \u3002\u5982\u679c\u4e00\u4e2a\u6811\u4e2d\u542b\u6709\u8fd9\u4e24\u79cd\u7ed3\u70b9\uff0c\u90a3\u4e48\u79f0\u4f5c 2-3\u6811 \u3002 \u7ea2\u9ed1\u6811\u662f\u4e00\u79cd\u57fa\u4e8e\u6709\u5e8f\u7b26\u53f7\u8868\u7684\u4e8c\u53c9\u5e73\u8861\u6811\u7684\u5b9e\u73b0\u3002 \u7ea2\u9ed1\u6811\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u5b9a\u4e49\u662f\u6ee1\u8db3\u4e0b\u9762\u6761\u4ef6\u7684\u4e8c\u53c9\u67e5\u627e\u6811\uff1a \u7ea2\u94fe\u63a5\u5747\u4e3a\u5de6\u94fe\u63a5 \u6ca1\u6709\u4efb\u4f55\u4e00\u4e2a\u7ed3\u70b9\u540c\u65f6\u548c\u4e24\u6761\u7ea2\u94fe\u63a5\u76f8\u8fde \u8be5\u6811\u662f\u5b8c\u7f8e\u9ed1\u8272\u5e73\u8861\u7684\uff0c\u5373\u4efb\u610f\u7a7a\u94fe\u63a5\u5230\u6839\u7ed3\u70b9\u7684\u8def\u5f84\u4e0a\u7684\u9ed1\u94fe\u63a5\u6570\u91cf\u76f8\u540c \u8fd9\u6837\u7684\u6811\u548c2-3\u6811\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002","title":"1. \u4e00\u4e9b\u6982\u5ff5\uff1a"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#2","text":"","title":"2. \u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5b9e\u73b0"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#21","text":"public class RedBlackBST < K extends Comparable < K >, V > { private Node root ; private static final boolean RED = true ; private static final boolean BLACK = false ; private class Node { private K k ; private V v ; private Node left , right ; private int N ; private boolean color ; //\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u8868\u793a\u6307\u5411\u8be5\u7ed3\u70b9\u7684\u94fe\u63a5\u7684\u989c\u8272 Node ( K k , V v , int n , boolean color ) { this . k = k ; this . v = v ; N = n ; this . color = color ; } } }","title":"2.1 \u5b58\u50a8\u7ed3\u70b9"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#22","text":"\u5de6\u65cb\u548c\u53f3\u65cb\u3002\u5de6\u65cb\u5373\u628a\u5de6\u8fb9\u7684\u7ea2\u94fe\u63a5\u8f6c\u6362\u5230\u53f3\u8fb9\u53bb\uff1b\u53f3\u65cb\u76f8\u53cd \u5728\u7ea2\u9ed1\u6811\u7684\u53d8\u6362\u4e2d\uff0c\u662f\u901a\u8fc7\u4e0d\u65ad\u7684\u5de6\u65cb\u4e0e\u53f3\u65cb\u6765\u5b9e\u73b0\u7684\uff0c\u6545\u9700\u8981\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002 \u5de6\u65cb private Node rotateLeft ( Node h ){ /* \u5c06\u4e00\u4e2a\u53f3\u94fe\u63a5\u4e3a\u7ea2\u8272\u7684\u7ed3\u70b9\u5de6\u65cb\u3002\u6d89\u53ca\u5230\u5b50\u6811\u4e2d\u7ed3\u70b9\u4f4d\u7f6e\u7684\u53d8\u6362\uff0c\u989c\u8272\u7684\u6539\u53d8\uff0c\u7ed3\u70b9\u6570\u91cf\u7684\u6539\u53d8\u3002 */ Node x = h . right ; h . right = x . left ; x . left = h ; x . color = h . color ; h . color = RED ; x . N = h . N ; h . N = size ( h . left ) + size ( h . right ) + 1 ; return x ; } \u53f3\u65cb\u53ea\u9700\u5c06\u65b9\u5411\u76f8\u53cd\u5373\u53ef\u3002 \u989c\u8272\u8f6c\u6362 \u5728\u63d2\u5165\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e24\u4e2a\u5b50\u7ed3\u70b9\u90fd\u4e3a\u7ea2\u8272\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u76f8\u5f53\u4e8e\u53d8\u6210\u4e86 4-\u7ed3\u70b9 \uff0c\u6240\u4ee5\u9700\u8981\u5c06\u4e2d\u95f4\u7ed3\u70b9\u63d0\u53d6\u51fa\u6765\uff0c\u53d8\u6210\u4e24\u4e2a 2-\u7ed3\u70b9 \uff0c\u5c06\u4e2d\u95f4\u7684\u7ed3\u70b9\u653e\u5230\u7236\u7ed3\u70b9\u4e2d\u7ee7\u7eed\u5904\u7406\u3002 private void flipColor ( Node h , boolean reverse ){ if ( reverse ){ /* \u5220\u9664\u64cd\u4f5c\u7684\u8f6c\u6362\uff0c\u4e3a\u4e86\u6784\u90203-\u62164-\u5b50\u7ed3\u70b9\u3002\u8f6c\u6362\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e24\u4e2a\u9ed1\u8272\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u5e76\u5c06\u81ea\u5df1\u53d8\u4e3a\u9ed1\u8272\u7ed3\u70b9\u3002 */ h . color = BLACK ; h . right . color = h . left . color = RED ; } else { /* \u63d2\u5165\u64cd\u4f5c\u7684\u8f6c\u6362\u3002\u8f6c\u6362\u4e00\u4e2a\u7ed3\u70b9\u7684\u4e24\u4e2a\u7ea2\u8272\u7ed3\u70b9\u7684\u989c\u8272\uff0c\u5e76\u5c06\u81ea\u5df1\u53d8\u4e3a\u7ea2\u8272\u7ed3\u70b9\uff0c\u76f8\u5f53\u4e8e\u628a\u81ea\u5df1\u9001\u5165\u5230\u7236\u8282\u70b9\u4e2d\u3002 */ h . color = RED ; h . right . color = h . left . color = BLACK ; } }","title":"2.2 \u57fa\u672c\u65b9\u6cd5"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#23","text":"\u5c06\u65b0\u7ed3\u70b9\u4e0d\u65ad\u7684\u5411\u4e0b\u904d\u5386\uff0c\u76f4\u5230\u6210\u4e3a\u53f6\u5b50\u8282\u70b9\u3002 \u63d2\u5165\u65b0\u7684\u7ed3\u70b9\u540e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e09\u79cd\u60c5\u51b5\uff1a \u82e5\u53f3\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\u800c\u5de6\u5b50\u7ed3\u70b9\u662f\u9ed1\u8272\uff0c\u90a3\u4e48\u5de6\u65cb \u82e5\u5de6\u5b50\u7ed3\u70b9\u4e3a\u7ea2\u8272\u5e76\u4e14\u5b83\u7684\u5de6\u5b50\u7ed3\u70b9\u4e5f\u4e3a\u7ea2\u8272\uff0c\u5373\u5b58\u5728\u4e24\u4e2a\u76f8\u8fde\u7684\u7ea2\u94fe\uff0c\u90a3\u4e48\u5148\u53f3\u65cb\u9876\u90e8\u7684\u7ed3\u70b9\uff0c\u518d\u6267\u884c3. \u82e5\u4e24\u4e2a\u5b50\u7ed3\u70b9\u90fd\u4e3a\u7ea2\u8272\uff0c\u90a3\u4e48\u6539\u53d8\u989c\u8272 void put ( K k , V v ){ root = put ( root , k , v ); root . color = BLACK ; } private Node put ( Node h , K k , V v ){ //\u63d2\u5165\u65b0\u7684\u7ed3\u70b9\uff0c\u6ce8\u610f\u662f\u7ea2\u8272\u7ed3\u70b9 if ( h == null ){ return new Node ( k , v , 1 , RED ); } //\u5411\u4e0b\u904d\u5386 int re = k . compareTo ( h . k ); if ( re == 0 ){ //\u8fd9\u91cc\u4e0d\u80fd\u76f4\u63a5\u8fd4\u56de\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff1f\uff1f\uff1f h . v = v ; } else if ( re > 0 ){ h . right = put ( h . right , k , v ); } else { h . left = put ( h . left , k , v ); } //1.\u5de6\u65cb if ( isRed ( h . right ) && ! isRed ( h . left )){ h = rotateLeft ( h ); } //2.\u53f3\u65cb if ( isRed ( h . left ) && isRed ( h . left . left )){ h = rotateRight ( h ); } //3.\u8f6c\u6362 if ( isRed ( h . left ) && isRed ( h . right )){ flipColor ( h , false ); } h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; }","title":"2.3 \u63d2\u5165\u64cd\u4f5c"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#24","text":"\u5220\u9664\u7684\u65f6\u5019\u5141\u8bb8\u4e34\u65f6\u7684 4-\u7ed3\u70b9 \u5b58\u5728\u3002 \u5728\u5220\u9664\u6700\u5c0f\u952e\u7684\u65f6\u5019\uff0c\u56e0\u8981\u4fdd\u6301\u6811\u7684\u5e73\u8861\uff0c\u6240\u4ee5\u9700\u8981\u786e\u4fdd\u6bcf\u4e2a\u5de6\u5b50\u7ed3\u70b9\u90fd\u4e0d\u662f 2-\u7ed3\u70b9 \uff0c\u5373\u5c06\u9047\u5230\u7684\u6bcf\u4e2a2-\u7ed3\u70b9\u90fd\u8f6c\u5316\u4e3a3-\u7ed3\u70b9\u62164-\u7ed3\u70b9\uff0c\u8fd9\u6837\u5220\u9664\u7684\u65f6\u5019\u6811\u4ecd\u7136\u662f\u5e73\u8861\u7684\u3002 private Node balance ( Node h ){ /*\u5e73\u8861\u7ea2\u9ed1\u6811\uff0c\u53ea\u8981\u5728put()\u65b9\u6cd5\u7684\u540e\u4e94\u53e5\u52a0\u4e0a\u6b64\u53e5\u5c31\u80fd\u8fbe\u5230\u6548\u679c???*/ //\u5bf9\u53ef\u80fd\u51fa\u73b0\u7684\u4e0d\u5e73\u8861\u7684\u60c5\u51b5\u505a\u9884\u5904\u7406 if ( isRed ( h . right )){ h = rotateLeft ( h ); } if ( isRed ( h . right ) && ! isRed ( h . left )){ h = rotateLeft ( h ); } if ( isRed ( h . left ) && isRed ( h . left . left )){ h = rotateRight ( h ); } if ( isRed ( h . left ) && isRed ( h . right )){ flipColor ( h , false ); } h . N = size ( h . left ) + size ( h . right ) + 1 ; return h ; } private Node moveRedLeft ( Node h ){ //\u53d8\u4e3ah\u662f\u9ed1\u8272\uff08\u4e3a\u4e86\u4e0d\u4f1a\u4ea7\u751f5-\u7ed3\u70b9\uff09\uff0c\u4e24\u4e2a\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\uff0c\u5148\u5c06h\u53d8\u6210\u4e86\u4e00\u4e2a3-\u7ed3\u70b9\uff0c\u4fdd\u8bc1\u5de6\u5b50\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 flipColor ( h , true ); //\u82e5\u53f3\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9\uff0c\u5c06\u4e00\u4e2a\u952e\u79fb\u52a8\u5230\u5de6\u5b50\u7ed3\u70b9\u4e2d\uff0ch\u7ee7\u7eed\u53d8\u6210\u4e00\u4e2a4-\u7ed3\u70b9\uff1b\u6b64\u65f6\u56e0\u4e3a\u5df2\u7ecf\u5c06\u53f3\u7ed3\u70b9\u53d8\u4e3a\u7ea2\u8272\uff0c\u6240\u4ee5\u65e0\u9700\u5224\u65ad\u5176\u989c\u8272\u3002 if ( isRed ( h . right . left )){ h . right = rotateRight ( h . right ); //\u53f3\u65cbh\u7684\u53f3\u5b50\u6811\uff0c\u53d8\u4e3a\u53f3\u8fb9\u76844-\u7ed3\u70b9 h = rotateLeft ( h ); //\u518d\u5de6\u65cbh\uff0c\u5c06\u5de6\u5b50\u6811\u53d8\u4e3a4-\u7ed3\u70b9 } return h ; } void deleteMin () { //\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u8f6c\u53d8\u989c\u8272??? if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = deleteMin ( root ); if (! isEmpty ()){ root . color = BLACK ; } } private Node deleteMin ( Node h ){ //\u5220\u9664\u6700\u5c0f\u7ed3\u70b9 if ( h . left == null ){ return null ; } //\u5de6\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u662f2-\u7ed3\u70b9\uff0c\u8f6c\u6362\u4e3a\u975e2-\u7ed3\u70b9\uff0c\u53ef\u80fd\u662f3-\u7ed3\u70b9\u62164-\u7ed3\u70b9 if (! isRed ( h . left ) && ! isRed ( h . left . left )){ h = moveRedLeft ( h ); } //\u6b64\u65f6\u5df2\u7ecf\u4fdd\u8bc1\u4e86\u5de6\u5b50\u6811\u7684\u6839\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 //\u5411\u4e0b\u5220\u9664\u7ed3\u70b9\uff0c\u6539\u53d8\u7ea2\u9ed1\u6811\u7ed3\u6784 h . left = deleteMin ( h . left ); //\u5411\u4e0a\u5e73\u8861\u7ea2\u9ed1\u6811\uff0c\u6d88\u9664\u4e34\u65f6\u4ea7\u751f\u76844-\u7ed3\u70b9\uff0c\u5e73\u8861\u4e4b\u540e\u518d\u66f4\u65b0\u7ed3\u70b9\u5927\u5c0f return balance ( h ); }","title":"2.4 \u5220\u9664\u6700\u5c0f\u7684\u952e\u503c\u5bf9"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#25","text":"\u56e0\u7ea2\u94fe\u63a5\u90fd\u4e3a\u5de6\u94fe\u63a5\uff0c\u6240\u4ee5\u6709\u7a0d\u5fae\u4e0d\u540c\u3002 private Node moveRedRight ( Node h ){ //\u53d8\u4e3ah\u662f\u9ed1\u8272\uff0c\u4e24\u4e2a\u5b50\u7ed3\u70b9\u662f\u7ea2\u8272\uff0c\u5148\u5c06h\u53d8\u6210\u53f3\u8fb9\u76843-\u7ed3\u70b9\uff0c\u4fdd\u8bc1\u53f3\u5b50\u7ed3\u70b9\u4e0d\u662f2-\u7ed3\u70b9 flipColor ( h , true ); //h\u7684\u5de6\u5b50\u7ed3\u70b9\u4e5f\u662f2-\u7ed3\u70b9\uff0c\u5c06h\u7684\u53f3\u5b50\u7ed3\u70b9\u7ee7\u7eed\u53d8\u4e3a\u53f3\u8fb9\u76844-\u7ed3\u70b9 if (! isRed ( h . left . left )){ h = rotateRight ( h ); } return h ; } void deleteMax () { if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = deleteMax ( root ); if (! isEmpty ()){ root . color = BLACK ; } } private Node deleteMax ( Node h ){ //\u5c06\u4e3a\u7ea2\u8272\u7684\u5de6\u6839\u7ed3\u70b9\u76f4\u63a5\u8f6c\u5230\u53f3\u8fb9\u6765 if ( isRed ( h . left )){ h = rotateRight ( h ); } //\u5220\u9664\u6700\u5927\u7ed3\u70b9 if ( h . right == null ){ return null ; } //h\u7684\u53f3\u5b50\u7ed3\u70b9\u662f\u9ed1\u8272\u7ed3\u70b9\uff0c\u5e76\u4e14\u53f3\u5b50\u6811\u4e0d\u662f3-\u7ed3\u70b9\u3002 //\u56e0\u4e3a\u7b2c\u4e00\u6b65\u5df2\u7ecf\u76f4\u63a5\u628a\u4e3a\u7ea2\u8272\u7684\u5de6\u6839\u7ed3\u70b9\u8f6c\u5230\u53f3\u8fb9\uff0c\u4fdd\u8bc1\u4e86\u6b64\u53f3\u6811\u662f\u53f3\u8fb9\u76843-\u7ed3\u70b9\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u53d8\u5e7b\uff0c\u8981\u5c06\u5176\u8fc7\u6ee4 if (! isRed ( h . right ) && ! isRed ( h . right . left )){ h = moveRedRight ( h ); } //\u5411\u4e0b\u5220\u9664\u7ed3\u70b9 h . right = deleteMax ( h . right ); //\u5411\u4e0a\u5e73\u8861\u4e8c\u53c9\u6811 return balance ( h ); }","title":"2.5 \u5220\u9664\u6700\u5927\u7684\u952e\u503c\u5bf9"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#26","text":"\u5c06\u5220\u9664\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\u7ed3\u5408\u8d77\u6765\u5b8c\u6210\u5220\u9664\u64cd\u4f5c\u3002 void delete ( K k ) { if (! isRed ( root . left ) && ! isRed ( root . right )){ root . color = RED ; } root = delete ( root , k ); if (! isEmpty ()){ root . color = BLACK ; } } private Node delete ( Node h , K k ){ //\u5728\u5de6\u5b50\u6811\u4e2d if ( k . compareTo ( h . k ) < 0 ){ if (! isRed ( h . left ) && ! isRed ( h . left . left )){ h = moveRedLeft ( h ); } h . left = delete ( h . left , k ); } //\u627e\u5230\u4e86\u8be5\u7ed3\u70b9\u6216\u5728\u53f3\u5b50\u6811\u4e2d else { if ( isRed ( h . left )){ h = rotateRight ( h ); } //\u627e\u5230\u8be5\u7ed3\u70b9\uff0c\u5e76\u4e14\u53f3\u5b50\u6811\u4e3a\u7a7a\uff0c\u65e0\u9700\u8c03\u6574\u7ed3\u6784\uff0c\u5220\u9664\u8be5\u7ed3\u70b9 if ( k . compareTo ( h . k ) == 0 && ( h . right == null )){ return null ; } //\u53f3\u5b50\u6811\u662f2-\u7ed3\u70b9\uff0c\u8f6c\u5316\u4e3a\u53f3\u8fb9\u76844-\u62163-\u7ed3\u70b9 if (! isRed ( h . right ) && ! isRed ( h . right . left )){ h = moveRedRight ( h ); } //\u627e\u5230\u4e86\u8be5\u7ed3\u70b9\uff0c\u4f46\u662f\u53f3\u5b50\u6811\u4e0d\u4e3a\u7a7a\uff0c\u6240\u4ee5\u9700\u8981\u8c03\u6574\u7ed3\u6784\uff1b\u4e0e\u4e8c\u53c9\u6811\u7684\u5220\u9664\u65b9\u6cd5\u7c7b\u4f3c if ( k . compareTo ( h . k ) == 0 ){ h . v = get ( h . right , min ( h . right ). k ); h . k = min ( h . right ). k ; h . right = deleteMin ( h . right ); } //\u8be5\u7ed3\u70b9\u5728\u53f3\u5b50\u6811\u4e2d else { h . right = delete ( h . right , k ); } } return balance ( h ); }","title":"2.6 \u5220\u9664\u64cd\u4f5c"},{"location":"datastruct/\u7ea2\u9ed1\u6811/#27","text":"\u5bf9\u4e8e\u5176\u5b83\u65b9\u6cd5\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u6d89\u53ca\u5230\u989c\u8272\u8f6c\u6362\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e8c\u53c9\u6811\u7684\u65b9\u6cd5\u3002","title":"2.7 \u5176\u5b83\u65b9\u6cd5"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/","text":"1. \u5b89\u88c5 1.1 \u5378\u8f7d\u4e4b\u524d\u7684\u7248\u672c 1.2 \u5b89\u88c5 Docker CE 2. \u5b89\u88c5\u68c0\u67e5 3. \u5378\u8f7d Docker CE 4. \u5e38\u7528\u547d\u4ee4 1. \u5b89\u88c5 \u00b6 \u5b98\u65b9\u539f\u6587\uff1a\u5b89\u88c5 1.1 \u5378\u8f7d\u4e4b\u524d\u7684\u7248\u672c \u00b6 $ sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine 1.2 \u5b89\u88c5 Docker CE \u00b6 $ sudo yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2 $ sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo $ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl start docker 2. \u5b89\u88c5\u68c0\u67e5 \u00b6 \u5b98\u65b9\u539f\u6587\uff1a\u5b89\u88c5\u68c0\u67e5 $ sudo docker run hello-world 3. \u5378\u8f7d Docker CE \u00b6 $ sudo yum remove docker-ce # \u5220\u9664\u6570\u636e $ sudo rm -rf /var/lib/docker \u8fd8\u9700\u8981\u624b\u52a8\u5730\u5220\u9664\u7f16\u8f91\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u3002 4. \u5e38\u7528\u547d\u4ee4 \u00b6 ## List Docker CLI commands docker docker container --help ## Display Docker version and info docker --version docker version docker info ## Execute Docker image docker run hello-world ## List Docker images docker image ls ## List Docker containers (running, all, all in quiet mode) docker container ls docker container ls --all docker container ls -aq","title":"01. \u5165\u95e8 \u5b89\u88c5"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#1","text":"\u5b98\u65b9\u539f\u6587\uff1a\u5b89\u88c5","title":"1. \u5b89\u88c5"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#11","text":"$ sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine","title":"1.1 \u5378\u8f7d\u4e4b\u524d\u7684\u7248\u672c"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#12-docker-ce","text":"$ sudo yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2 $ sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo $ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl start docker","title":"1.2 \u5b89\u88c5 Docker CE"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#2","text":"\u5b98\u65b9\u539f\u6587\uff1a\u5b89\u88c5\u68c0\u67e5 $ sudo docker run hello-world","title":"2. \u5b89\u88c5\u68c0\u67e5"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#3-docker-ce","text":"$ sudo yum remove docker-ce # \u5220\u9664\u6570\u636e $ sudo rm -rf /var/lib/docker \u8fd8\u9700\u8981\u624b\u52a8\u5730\u5220\u9664\u7f16\u8f91\u8fc7\u7684\u914d\u7f6e\u6587\u4ef6\u3002","title":"3. \u5378\u8f7d Docker CE"},{"location":"docker/01. \u5165\u95e8-\u5b89\u88c5/#4","text":"## List Docker CLI commands docker docker container --help ## Display Docker version and info docker --version docker version docker info ## Execute Docker image docker run hello-world ## List Docker images docker image ls ## List Docker containers (running, all, all in quiet mode) docker container ls docker container ls --all docker container ls -aq","title":"4. \u5e38\u7528\u547d\u4ee4"},{"location":"docker/02. \u5165\u95e8-\u5bb9\u5668/","text":"\u5b98\u65b9\u539f\u6587 \u5bb9\u5668 container \u662f\u955c\u50cf image \u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002 \u5b9a\u4e49\u4e00\u4e2a\u5bb9\u5668\u9700\u8981\u7f16\u5199 Dockerfile \uff0c\u4f8b\u5b50\uff1a # Use an official Python runtime as a parent image FROM python:2.7-slim # Set the working directory to /app WORKDIR /app # Copy the current directory contents into the container at /app COPY . /app # Install any needed packages specified in requirements.txt RUN pip install --trusted-host pypi.python.org -r requirements.txt # Make port 80 available to the world outside this container EXPOSE 80 # Define environment variable ENV NAME World # Run app.py when the container launches CMD [ \"python\" , \"app.py\" ] \u4e00\u4e9b\u5e38\u7528\u547d\u4ee4\uff1a docker build -t friendlyhello . # Create image using this directory's Dockerfile docker run -p 4000 :80 friendlyhello # Run \"friendlyhello\" mapping port 4000 to 80 docker run -d -p 4000 :80 friendlyhello # Same thing, but in detached mode\uff08\u540e\u53f0\u8fd0\u884c\uff09 docker container ls # List all running containers docker container ls -a # List all containers, even those not running docker container stop <hash> # Gracefully stop the specified container docker container kill <hash> # Force shutdown of the specified container docker container rm <hash> # Remove specified container from this machine docker container rm $( docker container ls -a -q ) # Remove all containers docker image ls -a # List all images on this machine docker image rm <image id> # Remove specified image from this machine docker image rm $( docker image ls -a -q ) # Remove all images from this machine docker login # Log in this CLI session using your Docker credentials docker tag <image> username/repository:tag # Tag <image> for upload to registry docker push username/repository:tag # Upload tagged image to registry docker run username/repository:tag # Run image from a registry","title":"02. \u5165\u95e8 \u5bb9\u5668"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/","text":"1. \u524d\u63d0 2. \u7f16\u5199\u6587\u4ef6 3. \u8fd0\u884capp 4. \u6269\u5c55app 5. \u5173\u95edapp\u548cswarm 6. \u5e38\u7528\u547d\u4ee4 \u5b98\u65b9\u539f\u6587 \u5728\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0d\u540c\u90e8\u5206\u79f0\u4e3a\u201c\u670d\u52a1\u201d service \u3002 \u670d\u52a1\u5b9e\u9645\u4e0a\u662f\u751f\u6210\u73af\u5883\u4e2d\u7684\u5bb9\u5668\u3002 \u670d\u52a1\u53ef\u4ee5 \u6269\u5c55\u5e94\u7528\u7a0b\u5e8f app \u5e76\u542f\u7528 \u8d1f\u8f7d\u5e73\u8861 \u3002 1. \u524d\u63d0 \u00b6 linux\u9700\u8981\u5b89\u88c5 docker-compose \uff1a curl -L https://github.com/docker/compose/releases/download/1.25.0-rc1/docker-compose- ` uname -s ` - ` uname -m ` -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose 2. \u7f16\u5199\u6587\u4ef6 \u00b6 \u5b9a\u4e49\u670d\u52a1\u9700\u8981\u7f16\u5199 docker-compose.yml \u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u89c4\u5b9a\u5982\u4f55\u8fd0\u884c\u5bb9\u5668\u3002\u53ef\u5728\u4efb\u610f\u4f4d\u7f6e\u7f16\u5199\uff0c\u4f8b\u5b50\uff1a version : \"3\" services : web : # replace username/repo:tag with your name and image details image : username/repo:tag deploy : replicas : 5 resources : limits : cpus : \"0.1\" memory : 50M restart_policy : condition : on-failure ports : - \"4000:80\" networks : - webnet networks : webnet : 3. \u8fd0\u884capp \u00b6 \u53d1\u5e03\u4e00\u4e2a stack \u3002 docker swarm init # getstartedlab \u662f\u4f60\u7684app\u540d\u5b57\uff0c\u4e5f\u662fstack\u540d\u5b57\uff0c\u968f\u610f\u53d6\u540d docker stack deploy -c docker-compose.yml getstartedlab \u670d\u52a1\u7684\u540d\u5b57\u4ee5 \"stack_name\" + \"_\" + \"compose\u6587\u4ef6\u4e2d\u670d\u52a1\u540d\" \u4e3a\u540d\u3002 # \u5217\u51fa\u6240\u6709\u7684\u670d\u52a1 docker service ls # \u5217\u51fa\u6307\u5b9a\u7684\u670d\u52a1 docker stack services getstartedlab \u5728\u670d\u52a1\u4e2d\u8fd0\u884c\u7684\u4e00\u4e2a\u5bb9\u5668\u53eb\u505a\u4e00\u4e2a\u4efb\u52a1 task \uff0c\u6570\u91cf\u662f\u5728yml\u6587\u4ef6\u4e2d\u7684 replicas \u5b57\u6bb5\u5b9a\u4e49\u7684\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u4ee5\u5faa\u73af\u65b9\u5f0f\u9009\u62e9\u8fd9\u4e9b\u4efb\u52a1\u4e2d\u7684\u4e00\u4e2a\u6765\u54cd\u5e94\u3002 # \u67e5\u770b\u4e00\u4e2a\u670d\u52a1\u4e2d\u7684\u4efb\u52a1 docker service ps getstartedlab_web # \u67e5\u770b\u4e00\u4e2astack\u4e2d\u7684\u4efb\u52a1 docker stack ps getstartedlab # \u67e5\u770b\u6240\u6709\u7684\u4efb\u52a1\uff0c\u5217\u51fa\u7684\u662fcontainer_id\uff0c\u4e0etask_id\u4e0d\u540c docker container ls 4. \u6269\u5c55app \u00b6 \u76f4\u63a5\u4fee\u6539 docker-compose.yml \u6587\u4ef6\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884c docker stack deploy app_name \uff08 app_name \u8981\u76f8\u540c\uff09\u547d\u4ee4\u5373\u53ef\u5b9e\u73b0\u6269\u5c55\u3002docker\u6267\u884c\u66ff\u6362\u5f0f\u66f4\u65b0\uff0c\u65e0\u9700\u5173\u95ed\u4efb\u4f55stack\u6216container\u3002 bug\uff1a\u6539\u53d8\u6620\u5c04\u7aef\u53e3\u4e4b\u540e\u4e0d\u4f1a\u8d1f\u8f7d\u5747\u8861\u4e86\uff0c\u4e00\u76f4\u90fd\u662f\u4e00\u4e2a\u4efb\u52a1\u5728\u63d0\u4f9b\u670d\u52a1\u3002 5. \u5173\u95edapp\u548cswarm \u00b6 docker stack rm getstartedlab docker swarm leave --force 6. \u5e38\u7528\u547d\u4ee4 \u00b6 docker stack ls # List stacks or apps docker stack deploy -c <composefile> <appname> # Run the specified Compose file docker service ls # List running services associated with an app docker service ps <service> # List tasks associated with an app docker inspect <task_id or container_id> # Inspect\uff08\u67e5\u9605\uff09 task or container docker container ls -q # List container IDs docker stack rm <appname> # Tear down an application docker swarm leave --force # Take down a single node swarm from the manager","title":"03. \u5165\u95e8 \u670d\u52a1"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#1","text":"linux\u9700\u8981\u5b89\u88c5 docker-compose \uff1a curl -L https://github.com/docker/compose/releases/download/1.25.0-rc1/docker-compose- ` uname -s ` - ` uname -m ` -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose","title":"1. \u524d\u63d0"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#2","text":"\u5b9a\u4e49\u670d\u52a1\u9700\u8981\u7f16\u5199 docker-compose.yml \u6587\u4ef6\uff0c\u6b64\u6587\u4ef6\u89c4\u5b9a\u5982\u4f55\u8fd0\u884c\u5bb9\u5668\u3002\u53ef\u5728\u4efb\u610f\u4f4d\u7f6e\u7f16\u5199\uff0c\u4f8b\u5b50\uff1a version : \"3\" services : web : # replace username/repo:tag with your name and image details image : username/repo:tag deploy : replicas : 5 resources : limits : cpus : \"0.1\" memory : 50M restart_policy : condition : on-failure ports : - \"4000:80\" networks : - webnet networks : webnet :","title":"2. \u7f16\u5199\u6587\u4ef6"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#3-app","text":"\u53d1\u5e03\u4e00\u4e2a stack \u3002 docker swarm init # getstartedlab \u662f\u4f60\u7684app\u540d\u5b57\uff0c\u4e5f\u662fstack\u540d\u5b57\uff0c\u968f\u610f\u53d6\u540d docker stack deploy -c docker-compose.yml getstartedlab \u670d\u52a1\u7684\u540d\u5b57\u4ee5 \"stack_name\" + \"_\" + \"compose\u6587\u4ef6\u4e2d\u670d\u52a1\u540d\" \u4e3a\u540d\u3002 # \u5217\u51fa\u6240\u6709\u7684\u670d\u52a1 docker service ls # \u5217\u51fa\u6307\u5b9a\u7684\u670d\u52a1 docker stack services getstartedlab \u5728\u670d\u52a1\u4e2d\u8fd0\u884c\u7684\u4e00\u4e2a\u5bb9\u5668\u53eb\u505a\u4e00\u4e2a\u4efb\u52a1 task \uff0c\u6570\u91cf\u662f\u5728yml\u6587\u4ef6\u4e2d\u7684 replicas \u5b57\u6bb5\u5b9a\u4e49\u7684\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u4ee5\u5faa\u73af\u65b9\u5f0f\u9009\u62e9\u8fd9\u4e9b\u4efb\u52a1\u4e2d\u7684\u4e00\u4e2a\u6765\u54cd\u5e94\u3002 # \u67e5\u770b\u4e00\u4e2a\u670d\u52a1\u4e2d\u7684\u4efb\u52a1 docker service ps getstartedlab_web # \u67e5\u770b\u4e00\u4e2astack\u4e2d\u7684\u4efb\u52a1 docker stack ps getstartedlab # \u67e5\u770b\u6240\u6709\u7684\u4efb\u52a1\uff0c\u5217\u51fa\u7684\u662fcontainer_id\uff0c\u4e0etask_id\u4e0d\u540c docker container ls","title":"3. \u8fd0\u884capp"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#4-app","text":"\u76f4\u63a5\u4fee\u6539 docker-compose.yml \u6587\u4ef6\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884c docker stack deploy app_name \uff08 app_name \u8981\u76f8\u540c\uff09\u547d\u4ee4\u5373\u53ef\u5b9e\u73b0\u6269\u5c55\u3002docker\u6267\u884c\u66ff\u6362\u5f0f\u66f4\u65b0\uff0c\u65e0\u9700\u5173\u95ed\u4efb\u4f55stack\u6216container\u3002 bug\uff1a\u6539\u53d8\u6620\u5c04\u7aef\u53e3\u4e4b\u540e\u4e0d\u4f1a\u8d1f\u8f7d\u5747\u8861\u4e86\uff0c\u4e00\u76f4\u90fd\u662f\u4e00\u4e2a\u4efb\u52a1\u5728\u63d0\u4f9b\u670d\u52a1\u3002","title":"4. \u6269\u5c55app"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#5-appswarm","text":"docker stack rm getstartedlab docker swarm leave --force","title":"5. \u5173\u95edapp\u548cswarm"},{"location":"docker/03. \u5165\u95e8-\u670d\u52a1/#6","text":"docker stack ls # List stacks or apps docker stack deploy -c <composefile> <appname> # Run the specified Compose file docker service ls # List running services associated with an app docker service ps <service> # List tasks associated with an app docker inspect <task_id or container_id> # Inspect\uff08\u67e5\u9605\uff09 task or container docker container ls -q # List container IDs docker stack rm <appname> # Tear down an application docker swarm leave --force # Take down a single node swarm from the manager","title":"6. \u5e38\u7528\u547d\u4ee4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/","text":"1. \u524d\u63d0 1.1 \u5b89\u88c5 Docker Machine 1.2 \u5b89\u88c5bash\u8865\u5168\u811a\u672c 1.3 \u5378\u8f7d Docker Machine 1.3.1 \u5220\u9664\u521b\u5efa\u7684Machine 1.3.2 \u5220\u9664\u53ef\u6267\u884c\u547d\u4ee4 2. \u96c6\u7fa4\u8bf4\u660e 3. \u8bbe\u7f6eswarm 3.1 \u521b\u5efa\u96c6\u7fa4 3.2 \u67e5\u770b\u96c6\u7fa4 3.3 \u79bb\u5f00\u96c6\u7fa4 4. \u5728\u96c6\u7fa4\u4e0a\u90e8\u7f72app 4.1 \u914d\u7f6e\u4e00\u4e2adocker-machine shell\u5230 swarm manager 4.2 \u5728 swarm manager \u4e0a\u90e8\u7f72app 4.3 \u8bbf\u95ee\u4f60\u7684\u670d\u52a1 5. \u8fed\u4ee3\u3001\u6269\u5c55app 6. \u6e05\u7406\u4e0e\u91cd\u542f 6.1 stacks 6.2 swarms 6.3 \u53d6\u6d88 docker-machine \u7684shell\u53d8\u91cf\u8bbe\u7f6e 6.4 \u91cd\u542f docker machines 7. \u5e38\u7528\u547d\u4ee4 \u5b98\u65b9\u539f\u6587 \u901a\u8fc7\u5c06\u591a\u53f0\u673a\u5668\u8fde\u63a5\u5230 Dockerized \u96c6\u7fa4 swarm \uff0c\u53ef\u4ee5\u5b9e\u73b0\u591a\u5bb9\u5668\uff0c\u591a\u673a\u5668\u5e94\u7528\u7a0b\u5e8f\u3002 1. \u524d\u63d0 \u00b6 \u5b89\u88c5Docker Machine \u8fd9\u4e00\u6b65\u662f\u4e3a\u4e86\u5728\u672c\u673a\u4e2d\u4f7f\u7528virtualbox\u9a71\u52a8\u521b\u5efa\u865a\u62df\u673a\u4f5c\u4e3a\u7ed3\u70b9\uff0c\u5982\u679c\u4e0d\u662f\u5728virtualbox\u8fd0\u884c\u865a\u62df\u673a\u7684\u8bdd\u53ef\u80fd\u4e0d\u884c\u3002 1.1 \u5b89\u88c5 Docker Machine \u00b6 curl -L https://github.com/docker/machine/releases/download/v0.16.1/docker-machine- ` uname -s ` - ` uname -m ` >/tmp/docker-machine && chmod +x /tmp/docker-machine && sudo cp /tmp/docker-machine /usr/local/bin/docker-machine 1.2 \u5b89\u88c5bash\u8865\u5168\u811a\u672c \u00b6 \u8865\u5168\u529f\u80fd\u91cd\u542f\u751f\u6548\uff0c\u6709\u5e2e\u52a9\u6587\u6863\u3002 \u4e0b\u8f7d\uff1a base = https://raw.githubusercontent.com/docker/machine/v0.16.1 for i in docker-machine-prompt.bash docker-machine-wrapper.bash docker-machine.bash do sudo wget \" $base /contrib/completion/bash/ ${ i } \" -P /etc/bash_completion.d done \u7136\u540e\u6267\u884c\uff1a source /etc/bash_completion.d/docker-machine-prompt.bash \u5728 ~/.bashrc \u6587\u4ef6\u4e2d\u6dfb\u52a0\uff1a PS1 = '[\\u@\\h \\W$(__docker_machine_ps1)]\\$ ' 1.3 \u5378\u8f7d Docker Machine \u00b6 1.3.1 \u5220\u9664\u521b\u5efa\u7684Machine \u00b6 \u5220\u9664\u6307\u5b9a\u7684Machine\uff1a docker-machine rm <machine-name> \u5220\u9664\u6240\u6709\u7684Machine\uff1a docker-machine rm -f $( docker-machine ls -q ) 1.3.2 \u5220\u9664\u53ef\u6267\u884c\u547d\u4ee4 \u00b6 rm $( which docker-machine ) Note docker-machine\u521b\u5efa\u7684\u76f8\u5173\u6570\u636e\u3001\u914d\u7f6e\u6587\u4ef6\u7b49\u4fe1\u606f\u5b58\u50a8\u5728 ~/.docker/machine/machines/ \u76ee\u5f55\u4e0b\u3002\u5efa\u8bae\u4e0d\u8981\u76f4\u63a5\u4fee\u6539\u6216\u5220\u9664\u8fd9\u4e9b\u6587\u4ef6\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u53ea\u4f1a\u5f71\u54cdDocker CLI\uff0c\u800c\u4e0d\u662f\u771f\u6b63\u7684\u865a\u62df\u673a\u3002 2. \u96c6\u7fa4\u8bf4\u660e \u00b6 swarm \u662f\u4e00\u7ec4\u8fd0\u884cdocker\u5e76\u52a0\u5165\u5230\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u7684\u673a\u5668\u3002\u901a\u8fc7 swarm manager \u5728\u96c6\u7fa4\u4e0a\u6267\u884c\u547d\u4ee4\u3002\u8fd9\u5b57\u513f\u673a\u5668\u79f0\u4e3a nodes \uff0c\u53ef\u4ee5\u662f\u7269\u7406\u673a\u6216\u865a\u62df\u673a\u3002 \u96c6\u7fa4\u6709\u591a\u79cd\u7b56\u7565\u6765\u8fd0\u884c\u5bb9\u5668\u3002 swarm managers \u6307\u90a3\u4e9b\u53ef\u4ee5\u6267\u884c\u4f60\u7684\u547d\u4ee4\uff0c\u6216\u6279\u51c6\u5176\u5b83 worker \u52a0\u5165\u5230swarm\u4e2d\u7684\u7684\u673a\u5668\u3002workers\u4ec5\u4ec5\u63d0\u4f9b\u80fd\u529b\u5e76\u4e14\u4e0d\u80fd\u8fdb\u884c\u6388\u6743\u3002 docker\u53ef\u4ee5\u5207\u6362\u5230 swarm mode \u5f00\u542f\u96c6\u7fa4\uff0c\u8fd9\u4f1a\u8ba9\u5f53\u524d\u7684\u673a\u5668\u6210\u4e3a swarm manager \uff0c\u4ece\u6b64\uff0cdocker\u5728swarm\u4e0a\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u518d\u53ea\u662f\u5728\u5f53\u524d\u673a\u5668\u3002 3. \u8bbe\u7f6eswarm \u00b6 \u5f00\u542f swarm mode \u5e76\u6210\u4e3a swarm manager \uff1a docker swarm init \uff0c\u7136\u540e\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c docker swarm join \uff0c\u8ba9\u5b83\u4eec\u4f5c\u4e3a worker \u52a0\u5165 swarm \u3002 $ docker swarm init Swarm initialized: current node ( coqrwmgo1dvmymo3rvjgp9f29 ) is now a manager. To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1-0vfdwlab520va171c1jj3rrshrxbvykakmikerl3x8tjujz5u7-5j52x2866y5auq3at9fjeerx6 172 .16.2.237:2377 To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions. 3.1 \u521b\u5efa\u96c6\u7fa4 \u00b6 \u672c\u6b21\u4f7f\u7528\u7269\u7406\u673a\u4f5c\u4e3a\u7ed3\u70b9\u8fdb\u884c\u5b9e\u9a8c\u3002\u4ee5\u4e0b\u662f\u521b\u5efa\u865a\u62df\u673a\u4f5c\u4e3a\u7ed3\u70b9\uff0c\u5927\u540c\u5c0f\u5f02\u3002 \u82e5\u4f7f\u7528\u865a\u62df\u673a\u521b\u5efa\u96c6\u7fa4\u5219\u9700\u8981\u5b89\u88c5 virtualbox \uff0ccentos7\u5b89\u88c5\u65f6\u4e00\u5b9a\u8981\u5c06\u5f53\u524d\u4f7f\u7528\u7684\u5185\u6838\u7248\u672c\u4e0e\u6240\u9700\u7684rpm\u5305 kernel-devel \u4e00\u81f4\uff0c\u5426\u5219\u65e0\u6cd5\u8bc6\u522b\u5185\u6838\u6a21\u5757\uff0c\u65e0\u6cd5\u4f7f\u7528\u865a\u62df\u673a\u3002 \u4f7f\u7528 docker-machine \u521b\u5efa\u865a\u62df\u673a\uff1a $ docker-machine create --driver virtualbox myvm1 \u67e5\u770b\u865a\u62df\u673a\uff1a $ docker-machine ls \u521d\u59cb\u5316swarm\uff0c\u6dfb\u52a0nodes\uff1a # \u8fd9\u91cc\u7684<myvm1\u2014ip>\u6839\u636e\u63d0\u793a\u586b\u5199 $ docker-machine ssh myvm1 \"docker swarm init --advertise-addr <myvm1-ip>\" \u6dfb\u52a0worker\uff1a $ docker-machine ssh myvm2 \"docker swarm join \\ --token <token> \\ <ip>:2377\" Important \u6267\u884c\u6dfb\u52a0manager\u548cworker\u7684\u547d\u4ee4\u65f6\uff0c\u7aef\u53e3\u53f7\u603b\u662f\u6307\u5b9a 2377 \uff0c\u6216\u8005\u4e0d\u8981\u6307\u5b9a\u3002 \u5e76\u4e14\u4e0d\u8981\u4f7f\u7528 2376 \u3002SSH\u6709\u95ee\u9898\u65f6\uff0c\u53ef\u6307\u5b9a\u4f7f\u7528\u672c\u5730SSH\uff1a docker-machine --native-ssh ssh myvm1 ... \u3002 3.2 \u67e5\u770b\u96c6\u7fa4 \u00b6 \u5728manager\u4e0a\u9762\u67e5\u770bswarm\u4e0a\u9762\u7684nodes\uff0cmanager\u662f\u5426\u6fc0\u6d3b\uff08 * \u8868\u793a\u6fc0\u6d3b\uff09\uff1a # \u865a\u62df\u673a\u67e5\u770b $ docker-machine ssh myvm1 \"docker node ls\" # \u7269\u7406\u673a\u67e5\u770b $ docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION invw2ljg6e34s2o1naux9wklt convert-server Ready Active 18 .09.6 coqrwmgo1dvmymo3rvjgp9f29 * dev Ready Active Leader 18 .09.6 3.3 \u79bb\u5f00\u96c6\u7fa4 \u00b6 \u5982\u679c\u8981\u91cd\u65b0\u5f00\u59cb\uff0c\u53ef\u4ee5\u4ece\u6bcf\u4e2a\u8282\u70b9\u8fd0\u884c docker swarm leave \u3002 4. \u5728\u96c6\u7fa4\u4e0a\u90e8\u7f72app \u00b6 4.1 \u914d\u7f6e\u4e00\u4e2a docker-machine shell\u5230 swarm manager \u00b6 \u7269\u7406\u673a\u65e0\u9700\u6267\u884c\u6b64\u6b65\u9aa4\u3002 \u9664\u4e86 docker-machine ssh \uff0c\u8fd8\u6709\u53e6\u4e00\u79cd\u4e0e\u865a\u62df\u673a\u901a\u4fe1\u7684\u65b9\u5f0f\uff1a docker-machine env <machine> \uff0c\u5b83\u5141\u8bb8\u4f60\u4f7f\u7528 \u672c\u5730\u7684 docker-compose.yml \u6587\u4ef6\u6765\u8fdc\u7a0b\u90e8\u7f72app\u800c\u4e0d\u5fc5\u5230\u5904\u590d\u5236\u8be5\u6587\u4ef6\u3002 \u6267\u884c\u4e4b\u540e\u6839\u636e\u63d0\u793a\u6267\u884c eval $(docker-machine env myvm1) \uff0c\u7136\u540e\u67e5\u770bmanager\u662f\u5426\u6fc0\u6d3b\uff08 * \u8868\u793a\u6fc0\u6d3b\uff09\uff1a $ docker-machine ls 4.2 \u5728 swarm manager \u4e0a\u90e8\u7f72app \u00b6 \u4e0e 03. \u5165\u95e8-\u670d\u52a1 \u76f8\u540c\uff0c\u5728 swarm manager \u4e0a\u9762\u6267\u884c\uff1a docker stack deploy -c docker-compose.yml getstartedlab \u7136\u540e\u4f1a\u53d1\u73b0\u5728\u4e24\u8005\u90fd\u90e8\u7f72\u4e86\u5bb9\u5668\u4e0e\u4efb\u52a1\u3002 Note \u5982\u679c\u4f60\u7684\u955c\u50cf\u5b58\u653e\u5728\u79c1\u6709\u4ed3\u5e93\u800c\u4e0d\u662f Docker Hub \uff0c\u90a3\u4e48\u9996\u5148\u4f60\u9700\u8981\u767b\u5f55\uff1a docker login <your-registry> \uff1b\u7136\u540e\u5728\u90e8\u7f72\u7684\u65f6\u5019\u9700\u8981\u6dfb\u52a0\u9a8c\u8bc1\u53c2\u6570\uff1a docker stack deploy --with-registry-auth -c docker-compose.yml getstartedlab 4.3 \u8bbf\u95ee\u4f60\u7684\u670d\u52a1 \u00b6 \u901a\u8fc7\u4e24\u8005\u7684ip\u5730\u5740\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\u670d\u52a1\uff08\u4ecd\u662f\u8d1f\u8f7d\u5747\u8861\u7684\uff09\u3002 Question \u6b64\u670d\u52a1\u9700\u8981\u6253\u5f00\u4ee5\u4e0b\u7aef\u53e3\uff1a 1. Port 7946 TCP/UDP for container network discovery. 2. Port 4789 UDP for the container ingress network. 5. \u8fed\u4ee3\u3001\u6269\u5c55app \u00b6 \u53ef\u4ee5\u505a 02. \u5165\u95e8-\u5bb9\u5668 \u3001 03. \u5165\u95e8-\u670d\u52a1 \u4e2d\u7684\u4e00\u5207\u3002 \u5728\u6dfb\u52a0\u65b0\u7684nodes\u4e4b\u540e\uff0c\u901a\u8fc7\u8fd0\u884c docker stack deploy \u5373\u53ef\u4f7f\u7528\u65b0\u7684\u8d44\u6e90\u3002 6. \u6e05\u7406\u4e0e\u91cd\u542f \u00b6 6.1 stacks \u00b6 docker stack rm test 6.2 swarms \u00b6 manager: docker swarm leave --force worker: docker swarm leave 6.3 \u53d6\u6d88 docker-machine \u7684shell\u53d8\u91cf\u8bbe\u7f6e \u00b6 eval $( docker-machine env -u ) 6.4 \u91cd\u542f docker machines \u00b6 docker-machine start <machine-name> 7. \u5e38\u7528\u547d\u4ee4 \u00b6 docker-machine create --driver virtualbox myvm1 # Create a VM (Mac, Win7, Linux) docker-machine create -d hyperv --hyperv-virtual-switch \"myswitch\" myvm1 # Win10 docker-machine env myvm1 # View basic information about your node docker-machine ssh myvm1 \"docker node ls\" # List the nodes in your swarm docker-machine ssh myvm1 \"docker node inspect <node ID>\" # Inspect a node docker-machine ssh myvm1 \"docker swarm join-token -q worker\" # View join token docker-machine ssh myvm1 # Open an SSH session with the VM; type \"exit\" to end docker node ls # View nodes in swarm (while logged on to manager) docker-machine ssh myvm2 \"docker swarm leave\" # Make the worker leave the swarm docker-machine ssh myvm1 \"docker swarm leave -f\" # Make master leave, kill swarm docker-machine ls # list VMs, asterisk shows which VM this shell is talking to docker-machine start myvm1 # Start a VM that is currently not running docker-machine env myvm1 # show environment variables and command for myvm1 eval $( docker-machine env myvm1 ) # Mac command to connect shell to myvm1 & \"C:\\Program Files\\Docker\\Docker\\Resources\\bin\\docker-machine.exe\" env myvm1 | Invoke-Expression # Windows command to connect shell to myvm1 docker stack deploy -c <file> <app> # Deploy an app; command shell must be set to talk to manager (myvm1), uses local Compose file docker-machine scp docker-compose.yml myvm1:~ # Copy file to node's home dir (only required if you use ssh to connect to manager and deploy the app) docker-machine ssh myvm1 \"docker stack deploy -c <file> <app>\" # Deploy an app using ssh (you must have first copied the Compose file to myvm1) eval $( docker-machine env -u ) # Disconnect shell from VMs, use native docker docker-machine stop $( docker-machine ls -q ) # Stop all running VMs docker-machine rm $( docker-machine ls -q ) # Delete all VMs and their disk images","title":"04. \u5165\u95e8 \u96c6\u7fa4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#1","text":"\u5b89\u88c5Docker Machine \u8fd9\u4e00\u6b65\u662f\u4e3a\u4e86\u5728\u672c\u673a\u4e2d\u4f7f\u7528virtualbox\u9a71\u52a8\u521b\u5efa\u865a\u62df\u673a\u4f5c\u4e3a\u7ed3\u70b9\uff0c\u5982\u679c\u4e0d\u662f\u5728virtualbox\u8fd0\u884c\u865a\u62df\u673a\u7684\u8bdd\u53ef\u80fd\u4e0d\u884c\u3002","title":"1. \u524d\u63d0"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#11-docker-machine","text":"curl -L https://github.com/docker/machine/releases/download/v0.16.1/docker-machine- ` uname -s ` - ` uname -m ` >/tmp/docker-machine && chmod +x /tmp/docker-machine && sudo cp /tmp/docker-machine /usr/local/bin/docker-machine","title":"1.1 \u5b89\u88c5 Docker Machine"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#12-bash","text":"\u8865\u5168\u529f\u80fd\u91cd\u542f\u751f\u6548\uff0c\u6709\u5e2e\u52a9\u6587\u6863\u3002 \u4e0b\u8f7d\uff1a base = https://raw.githubusercontent.com/docker/machine/v0.16.1 for i in docker-machine-prompt.bash docker-machine-wrapper.bash docker-machine.bash do sudo wget \" $base /contrib/completion/bash/ ${ i } \" -P /etc/bash_completion.d done \u7136\u540e\u6267\u884c\uff1a source /etc/bash_completion.d/docker-machine-prompt.bash \u5728 ~/.bashrc \u6587\u4ef6\u4e2d\u6dfb\u52a0\uff1a PS1 = '[\\u@\\h \\W$(__docker_machine_ps1)]\\$ '","title":"1.2 \u5b89\u88c5bash\u8865\u5168\u811a\u672c"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#13-docker-machine","text":"","title":"1.3 \u5378\u8f7d Docker Machine"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#131-machine","text":"\u5220\u9664\u6307\u5b9a\u7684Machine\uff1a docker-machine rm <machine-name> \u5220\u9664\u6240\u6709\u7684Machine\uff1a docker-machine rm -f $( docker-machine ls -q )","title":"1.3.1 \u5220\u9664\u521b\u5efa\u7684Machine"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#132","text":"rm $( which docker-machine ) Note docker-machine\u521b\u5efa\u7684\u76f8\u5173\u6570\u636e\u3001\u914d\u7f6e\u6587\u4ef6\u7b49\u4fe1\u606f\u5b58\u50a8\u5728 ~/.docker/machine/machines/ \u76ee\u5f55\u4e0b\u3002\u5efa\u8bae\u4e0d\u8981\u76f4\u63a5\u4fee\u6539\u6216\u5220\u9664\u8fd9\u4e9b\u6587\u4ef6\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u53ea\u4f1a\u5f71\u54cdDocker CLI\uff0c\u800c\u4e0d\u662f\u771f\u6b63\u7684\u865a\u62df\u673a\u3002","title":"1.3.2 \u5220\u9664\u53ef\u6267\u884c\u547d\u4ee4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#2","text":"swarm \u662f\u4e00\u7ec4\u8fd0\u884cdocker\u5e76\u52a0\u5165\u5230\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u7684\u673a\u5668\u3002\u901a\u8fc7 swarm manager \u5728\u96c6\u7fa4\u4e0a\u6267\u884c\u547d\u4ee4\u3002\u8fd9\u5b57\u513f\u673a\u5668\u79f0\u4e3a nodes \uff0c\u53ef\u4ee5\u662f\u7269\u7406\u673a\u6216\u865a\u62df\u673a\u3002 \u96c6\u7fa4\u6709\u591a\u79cd\u7b56\u7565\u6765\u8fd0\u884c\u5bb9\u5668\u3002 swarm managers \u6307\u90a3\u4e9b\u53ef\u4ee5\u6267\u884c\u4f60\u7684\u547d\u4ee4\uff0c\u6216\u6279\u51c6\u5176\u5b83 worker \u52a0\u5165\u5230swarm\u4e2d\u7684\u7684\u673a\u5668\u3002workers\u4ec5\u4ec5\u63d0\u4f9b\u80fd\u529b\u5e76\u4e14\u4e0d\u80fd\u8fdb\u884c\u6388\u6743\u3002 docker\u53ef\u4ee5\u5207\u6362\u5230 swarm mode \u5f00\u542f\u96c6\u7fa4\uff0c\u8fd9\u4f1a\u8ba9\u5f53\u524d\u7684\u673a\u5668\u6210\u4e3a swarm manager \uff0c\u4ece\u6b64\uff0cdocker\u5728swarm\u4e0a\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u518d\u53ea\u662f\u5728\u5f53\u524d\u673a\u5668\u3002","title":"2. \u96c6\u7fa4\u8bf4\u660e"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#3-swarm","text":"\u5f00\u542f swarm mode \u5e76\u6210\u4e3a swarm manager \uff1a docker swarm init \uff0c\u7136\u540e\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c docker swarm join \uff0c\u8ba9\u5b83\u4eec\u4f5c\u4e3a worker \u52a0\u5165 swarm \u3002 $ docker swarm init Swarm initialized: current node ( coqrwmgo1dvmymo3rvjgp9f29 ) is now a manager. To add a worker to this swarm, run the following command: docker swarm join --token SWMTKN-1-0vfdwlab520va171c1jj3rrshrxbvykakmikerl3x8tjujz5u7-5j52x2866y5auq3at9fjeerx6 172 .16.2.237:2377 To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.","title":"3. \u8bbe\u7f6eswarm"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#31","text":"\u672c\u6b21\u4f7f\u7528\u7269\u7406\u673a\u4f5c\u4e3a\u7ed3\u70b9\u8fdb\u884c\u5b9e\u9a8c\u3002\u4ee5\u4e0b\u662f\u521b\u5efa\u865a\u62df\u673a\u4f5c\u4e3a\u7ed3\u70b9\uff0c\u5927\u540c\u5c0f\u5f02\u3002 \u82e5\u4f7f\u7528\u865a\u62df\u673a\u521b\u5efa\u96c6\u7fa4\u5219\u9700\u8981\u5b89\u88c5 virtualbox \uff0ccentos7\u5b89\u88c5\u65f6\u4e00\u5b9a\u8981\u5c06\u5f53\u524d\u4f7f\u7528\u7684\u5185\u6838\u7248\u672c\u4e0e\u6240\u9700\u7684rpm\u5305 kernel-devel \u4e00\u81f4\uff0c\u5426\u5219\u65e0\u6cd5\u8bc6\u522b\u5185\u6838\u6a21\u5757\uff0c\u65e0\u6cd5\u4f7f\u7528\u865a\u62df\u673a\u3002 \u4f7f\u7528 docker-machine \u521b\u5efa\u865a\u62df\u673a\uff1a $ docker-machine create --driver virtualbox myvm1 \u67e5\u770b\u865a\u62df\u673a\uff1a $ docker-machine ls \u521d\u59cb\u5316swarm\uff0c\u6dfb\u52a0nodes\uff1a # \u8fd9\u91cc\u7684<myvm1\u2014ip>\u6839\u636e\u63d0\u793a\u586b\u5199 $ docker-machine ssh myvm1 \"docker swarm init --advertise-addr <myvm1-ip>\" \u6dfb\u52a0worker\uff1a $ docker-machine ssh myvm2 \"docker swarm join \\ --token <token> \\ <ip>:2377\" Important \u6267\u884c\u6dfb\u52a0manager\u548cworker\u7684\u547d\u4ee4\u65f6\uff0c\u7aef\u53e3\u53f7\u603b\u662f\u6307\u5b9a 2377 \uff0c\u6216\u8005\u4e0d\u8981\u6307\u5b9a\u3002 \u5e76\u4e14\u4e0d\u8981\u4f7f\u7528 2376 \u3002SSH\u6709\u95ee\u9898\u65f6\uff0c\u53ef\u6307\u5b9a\u4f7f\u7528\u672c\u5730SSH\uff1a docker-machine --native-ssh ssh myvm1 ... \u3002","title":"3.1 \u521b\u5efa\u96c6\u7fa4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#32","text":"\u5728manager\u4e0a\u9762\u67e5\u770bswarm\u4e0a\u9762\u7684nodes\uff0cmanager\u662f\u5426\u6fc0\u6d3b\uff08 * \u8868\u793a\u6fc0\u6d3b\uff09\uff1a # \u865a\u62df\u673a\u67e5\u770b $ docker-machine ssh myvm1 \"docker node ls\" # \u7269\u7406\u673a\u67e5\u770b $ docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION invw2ljg6e34s2o1naux9wklt convert-server Ready Active 18 .09.6 coqrwmgo1dvmymo3rvjgp9f29 * dev Ready Active Leader 18 .09.6","title":"3.2 \u67e5\u770b\u96c6\u7fa4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#33","text":"\u5982\u679c\u8981\u91cd\u65b0\u5f00\u59cb\uff0c\u53ef\u4ee5\u4ece\u6bcf\u4e2a\u8282\u70b9\u8fd0\u884c docker swarm leave \u3002","title":"3.3 \u79bb\u5f00\u96c6\u7fa4"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#4-app","text":"","title":"4. \u5728\u96c6\u7fa4\u4e0a\u90e8\u7f72app"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#41-docker-machine-shell-swarm-manager","text":"\u7269\u7406\u673a\u65e0\u9700\u6267\u884c\u6b64\u6b65\u9aa4\u3002 \u9664\u4e86 docker-machine ssh \uff0c\u8fd8\u6709\u53e6\u4e00\u79cd\u4e0e\u865a\u62df\u673a\u901a\u4fe1\u7684\u65b9\u5f0f\uff1a docker-machine env <machine> \uff0c\u5b83\u5141\u8bb8\u4f60\u4f7f\u7528 \u672c\u5730\u7684 docker-compose.yml \u6587\u4ef6\u6765\u8fdc\u7a0b\u90e8\u7f72app\u800c\u4e0d\u5fc5\u5230\u5904\u590d\u5236\u8be5\u6587\u4ef6\u3002 \u6267\u884c\u4e4b\u540e\u6839\u636e\u63d0\u793a\u6267\u884c eval $(docker-machine env myvm1) \uff0c\u7136\u540e\u67e5\u770bmanager\u662f\u5426\u6fc0\u6d3b\uff08 * \u8868\u793a\u6fc0\u6d3b\uff09\uff1a $ docker-machine ls","title":"4.1 \u914d\u7f6e\u4e00\u4e2adocker-machine shell\u5230 swarm manager"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#42-swarm-manager-app","text":"\u4e0e 03. \u5165\u95e8-\u670d\u52a1 \u76f8\u540c\uff0c\u5728 swarm manager \u4e0a\u9762\u6267\u884c\uff1a docker stack deploy -c docker-compose.yml getstartedlab \u7136\u540e\u4f1a\u53d1\u73b0\u5728\u4e24\u8005\u90fd\u90e8\u7f72\u4e86\u5bb9\u5668\u4e0e\u4efb\u52a1\u3002 Note \u5982\u679c\u4f60\u7684\u955c\u50cf\u5b58\u653e\u5728\u79c1\u6709\u4ed3\u5e93\u800c\u4e0d\u662f Docker Hub \uff0c\u90a3\u4e48\u9996\u5148\u4f60\u9700\u8981\u767b\u5f55\uff1a docker login <your-registry> \uff1b\u7136\u540e\u5728\u90e8\u7f72\u7684\u65f6\u5019\u9700\u8981\u6dfb\u52a0\u9a8c\u8bc1\u53c2\u6570\uff1a docker stack deploy --with-registry-auth -c docker-compose.yml getstartedlab","title":"4.2 \u5728 swarm manager \u4e0a\u90e8\u7f72app"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#43","text":"\u901a\u8fc7\u4e24\u8005\u7684ip\u5730\u5740\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\u670d\u52a1\uff08\u4ecd\u662f\u8d1f\u8f7d\u5747\u8861\u7684\uff09\u3002 Question \u6b64\u670d\u52a1\u9700\u8981\u6253\u5f00\u4ee5\u4e0b\u7aef\u53e3\uff1a 1. Port 7946 TCP/UDP for container network discovery. 2. Port 4789 UDP for the container ingress network.","title":"4.3 \u8bbf\u95ee\u4f60\u7684\u670d\u52a1"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#5-app","text":"\u53ef\u4ee5\u505a 02. \u5165\u95e8-\u5bb9\u5668 \u3001 03. \u5165\u95e8-\u670d\u52a1 \u4e2d\u7684\u4e00\u5207\u3002 \u5728\u6dfb\u52a0\u65b0\u7684nodes\u4e4b\u540e\uff0c\u901a\u8fc7\u8fd0\u884c docker stack deploy \u5373\u53ef\u4f7f\u7528\u65b0\u7684\u8d44\u6e90\u3002","title":"5. \u8fed\u4ee3\u3001\u6269\u5c55app"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#6","text":"","title":"6. \u6e05\u7406\u4e0e\u91cd\u542f"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#61-stacks","text":"docker stack rm test","title":"6.1 stacks"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#62-swarms","text":"manager: docker swarm leave --force worker: docker swarm leave","title":"6.2 swarms"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#63-docker-machine-shell","text":"eval $( docker-machine env -u )","title":"6.3 \u53d6\u6d88 docker-machine \u7684shell\u53d8\u91cf\u8bbe\u7f6e"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#64-docker-machines","text":"docker-machine start <machine-name>","title":"6.4 \u91cd\u542f docker machines"},{"location":"docker/04. \u5165\u95e8-\u96c6\u7fa4/#7","text":"docker-machine create --driver virtualbox myvm1 # Create a VM (Mac, Win7, Linux) docker-machine create -d hyperv --hyperv-virtual-switch \"myswitch\" myvm1 # Win10 docker-machine env myvm1 # View basic information about your node docker-machine ssh myvm1 \"docker node ls\" # List the nodes in your swarm docker-machine ssh myvm1 \"docker node inspect <node ID>\" # Inspect a node docker-machine ssh myvm1 \"docker swarm join-token -q worker\" # View join token docker-machine ssh myvm1 # Open an SSH session with the VM; type \"exit\" to end docker node ls # View nodes in swarm (while logged on to manager) docker-machine ssh myvm2 \"docker swarm leave\" # Make the worker leave the swarm docker-machine ssh myvm1 \"docker swarm leave -f\" # Make master leave, kill swarm docker-machine ls # list VMs, asterisk shows which VM this shell is talking to docker-machine start myvm1 # Start a VM that is currently not running docker-machine env myvm1 # show environment variables and command for myvm1 eval $( docker-machine env myvm1 ) # Mac command to connect shell to myvm1 & \"C:\\Program Files\\Docker\\Docker\\Resources\\bin\\docker-machine.exe\" env myvm1 | Invoke-Expression # Windows command to connect shell to myvm1 docker stack deploy -c <file> <app> # Deploy an app; command shell must be set to talk to manager (myvm1), uses local Compose file docker-machine scp docker-compose.yml myvm1:~ # Copy file to node's home dir (only required if you use ssh to connect to manager and deploy the app) docker-machine ssh myvm1 \"docker stack deploy -c <file> <app>\" # Deploy an app using ssh (you must have first copied the Compose file to myvm1) eval $( docker-machine env -u ) # Disconnect shell from VMs, use native docker docker-machine stop $( docker-machine ls -q ) # Stop all running VMs docker-machine rm $( docker-machine ls -q ) # Delete all VMs and their disk images","title":"7. \u5e38\u7528\u547d\u4ee4"},{"location":"docker/05. \u5165\u95e8-\u6808/","text":"1. \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u5e76\u91cd\u65b0\u90e8\u7f72 \u5b98\u65b9\u539f\u6587 \u6808 stack \u662f\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u7684\u9876\u5c42\u3002stack\u662f\u4e00\u7ec4\u76f8\u5173\u7684\u670d\u52a1\uff0c\u5b83\u4eec\u5171\u4eab\u4f9d\u8d56\uff0c\u53ef\u4ee5\u88ab\u4e00\u8d77\u534f\u8c03\u548c\u6269\u5c55\u3002 1. \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u5e76\u91cd\u65b0\u90e8\u7f72 \u00b6 1.\u7f16\u5199 docker-compose.yml \uff1a version : \"3\" services : web : # replace username/repo:tag with your name and image details image : username/repo:tag deploy : replicas : 5 restart_policy : condition : on-failure resources : limits : cpus : \"0.1\" memory : 50M ports : - \"80:80\" networks : - webnet visualizer : image : dockersamples/visualizer:stable ports : - \"8080:8080\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" deploy : placement : constraints : [ node.role == manager ] networks : - webnet networks : webnet : 2.\u786e\u4fdd\u4f60\u80fd\u4e0emanager\u901a\u4fe1 docker node ls 3.\u5728manager\u4e0a\u91cd\u65b0\u8fd0\u884c docker stack deploy \u547d\u4ee4\uff0c\u5e76\u66f4\u65b0\u9700\u8981\u66f4\u65b0\u7684\u4efb\u4f55\u670d\u52a1 docker stack deploy -c docker-compose.yml getstartedlab 4.\u67e5\u770b\u53ef\u89c6\u5316\u5de5\u5177visualizer visualizer \u662f\u53ef\u4ee5\u8fd0\u884c\u5728\u4efb\u4f55app\u4e0a\u7684\u72ec\u7acb\u7684\u670d\u52a1\u3002 \u901a\u8fc7\u7f51\u9875\u8bbf\u95ee\u3002","title":"05. \u5165\u95e8 \u6808"},{"location":"docker/05. \u5165\u95e8-\u6808/#1","text":"1.\u7f16\u5199 docker-compose.yml \uff1a version : \"3\" services : web : # replace username/repo:tag with your name and image details image : username/repo:tag deploy : replicas : 5 restart_policy : condition : on-failure resources : limits : cpus : \"0.1\" memory : 50M ports : - \"80:80\" networks : - webnet visualizer : image : dockersamples/visualizer:stable ports : - \"8080:8080\" volumes : - \"/var/run/docker.sock:/var/run/docker.sock\" deploy : placement : constraints : [ node.role == manager ] networks : - webnet networks : webnet : 2.\u786e\u4fdd\u4f60\u80fd\u4e0emanager\u901a\u4fe1 docker node ls 3.\u5728manager\u4e0a\u91cd\u65b0\u8fd0\u884c docker stack deploy \u547d\u4ee4\uff0c\u5e76\u66f4\u65b0\u9700\u8981\u66f4\u65b0\u7684\u4efb\u4f55\u670d\u52a1 docker stack deploy -c docker-compose.yml getstartedlab 4.\u67e5\u770b\u53ef\u89c6\u5316\u5de5\u5177visualizer visualizer \u662f\u53ef\u4ee5\u8fd0\u884c\u5728\u4efb\u4f55app\u4e0a\u7684\u72ec\u7acb\u7684\u670d\u52a1\u3002 \u901a\u8fc7\u7f51\u9875\u8bbf\u95ee\u3002","title":"1. \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u5e76\u91cd\u65b0\u90e8\u7f72"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/","text":"1. \u521b\u5efa\u955c\u50cf 1.1 \u57fa\u4e8e\u5df2\u6709\u7684\u955c\u50cf\u7684\u5bb9\u5668\u521b\u5efa 1.2 \u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165 1.3 \u57fa\u4e8eDokcerfile\u521b\u5efa 2. \u5b58\u51fa\u548c\u8f7d\u5165\u955c\u50cf 2.1 \u5b58\u51fa\u955c\u50cf 2.2 \u8f7d\u5165\u955c\u50cf \u4ece\u672c\u6587\u5f00\u59cb\uff0c\u540e\u9762\u7684\u6587\u7ae0\u90fd\u53c2\u8003\u4e86\u300aDocker\u6280\u672f\u5165\u95e8\u4e0e\u5b9e\u7ad9\u300b\u7b2c\u4e09\u7248\u3002 1. \u521b\u5efa\u955c\u50cf \u00b6 \u4e09\u79cd\u65b9\u6cd5\uff1a \u57fa\u4e8e\u5df2\u6709\u7684\u955c\u50cf\u7684\u5bb9\u5668\u521b\u5efa \u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165 \u57fa\u4e8eDokcerfile\u521b\u5efa 1.1 \u57fa\u4e8e\u5df2\u6709\u7684\u955c\u50cf\u7684\u5bb9\u5668\u521b\u5efa \u00b6 \u547d\u4ee4\uff1a docker commit [ OPTIONS ] CONTAINER [ REPOSITORY[:TAG ] ] \u4f8b\u5b50\uff1a docker commit -m '\u6d4b\u8bd5\u4ece\u5bb9\u5668\u521b\u5efa\u955c\u50cf' b3817030e31f changedcentos:v0.1 1.2 \u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165 \u00b6 \u547d\u4ee4\uff1a # Import the contents from a tarball to create a filesystem image # - \u8868\u793a\u6807\u51c6\u8f93\u5165 docker image import [ OPTIONS ] file | URL | - [ REPOSITORY [ :TAG ]] \u4f8b\u5b50\uff1a # \u5148\u5bfc\u51fa\u955c\u50cf docker image save -o changedcentos.tar changedcentos # \u518d\u5bfc\u5165\u955c\u50cf docker image import changedcentos.tar changedcentos:v0.1 1.3 \u57fa\u4e8eDokcerfile\u521b\u5efa \u00b6 \u9996\u5148\u7f16\u5199\u4e00\u4e2a Dockerfile \u6587\u4ef6\u3002 \u521b\u5efa\u955c\u50cf\u547d\u4ee4\uff1a docker image build [ OPTIONS ] PATH | URL | - \u4f8b\u5b50\uff1a docker image build -t mytest:v1.0 . 2. \u5b58\u51fa\u548c\u8f7d\u5165\u955c\u50cf \u00b6 2.1 \u5b58\u51fa\u955c\u50cf \u00b6 \u5bfc\u51fa\u4e00\u4e2a\u6216\u591a\u4e2a\u955c\u50cf\u5230\u672c\u5730\u6587\u4ef6\u3002 \u547d\u4ee4\uff1a docker image save [ OPTIONS ] IMAGE [ IMAGE... ] \u4f8b\u5b50\uff1a docker image save - o changedcentos . tar changedcentos 2.2 \u8f7d\u5165\u955c\u50cf \u00b6 \u547d\u4ee4\uff1a # Load an image from a tar archive or STDIN docker image load [ OPTIONS ] \u4f8b\u5b50\uff1a docker image load - i changecentos . tar export \u53ea\u80fd\u5bfc\u51fa\u5bb9\u5668\uff0c save \u53ea\u80fd\u5bfc\u51fa\u955c\u50cf\uff1b import \u548c load \u90fd\u80fd\u5bfc\u5165\u524d\u4e24\u8005\u7684\u5bfc\u51fa\u6587\u4ef6\uff0c\u6210\u4e3a\u955c\u50cf\uff0c\u4e24\u8005\u7684\u533a\u522b\u53c2\u8003 7. \u5bb9\u5668\u64cd\u4f5c \u3002","title":"06. \u4f7f\u7528docker\u955c\u50cf"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#1","text":"\u4e09\u79cd\u65b9\u6cd5\uff1a \u57fa\u4e8e\u5df2\u6709\u7684\u955c\u50cf\u7684\u5bb9\u5668\u521b\u5efa \u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165 \u57fa\u4e8eDokcerfile\u521b\u5efa","title":"1. \u521b\u5efa\u955c\u50cf"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#11","text":"\u547d\u4ee4\uff1a docker commit [ OPTIONS ] CONTAINER [ REPOSITORY[:TAG ] ] \u4f8b\u5b50\uff1a docker commit -m '\u6d4b\u8bd5\u4ece\u5bb9\u5668\u521b\u5efa\u955c\u50cf' b3817030e31f changedcentos:v0.1","title":"1.1 \u57fa\u4e8e\u5df2\u6709\u7684\u955c\u50cf\u7684\u5bb9\u5668\u521b\u5efa"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#12","text":"\u547d\u4ee4\uff1a # Import the contents from a tarball to create a filesystem image # - \u8868\u793a\u6807\u51c6\u8f93\u5165 docker image import [ OPTIONS ] file | URL | - [ REPOSITORY [ :TAG ]] \u4f8b\u5b50\uff1a # \u5148\u5bfc\u51fa\u955c\u50cf docker image save -o changedcentos.tar changedcentos # \u518d\u5bfc\u5165\u955c\u50cf docker image import changedcentos.tar changedcentos:v0.1","title":"1.2 \u57fa\u4e8e\u672c\u5730\u6a21\u677f\u5bfc\u5165"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#13-dokcerfile","text":"\u9996\u5148\u7f16\u5199\u4e00\u4e2a Dockerfile \u6587\u4ef6\u3002 \u521b\u5efa\u955c\u50cf\u547d\u4ee4\uff1a docker image build [ OPTIONS ] PATH | URL | - \u4f8b\u5b50\uff1a docker image build -t mytest:v1.0 .","title":"1.3 \u57fa\u4e8eDokcerfile\u521b\u5efa"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#2","text":"","title":"2. \u5b58\u51fa\u548c\u8f7d\u5165\u955c\u50cf"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#21","text":"\u5bfc\u51fa\u4e00\u4e2a\u6216\u591a\u4e2a\u955c\u50cf\u5230\u672c\u5730\u6587\u4ef6\u3002 \u547d\u4ee4\uff1a docker image save [ OPTIONS ] IMAGE [ IMAGE... ] \u4f8b\u5b50\uff1a docker image save - o changedcentos . tar changedcentos","title":"2.1 \u5b58\u51fa\u955c\u50cf"},{"location":"docker/06. \u4f7f\u7528docker\u955c\u50cf/#22","text":"\u547d\u4ee4\uff1a # Load an image from a tar archive or STDIN docker image load [ OPTIONS ] \u4f8b\u5b50\uff1a docker image load - i changecentos . tar export \u53ea\u80fd\u5bfc\u51fa\u5bb9\u5668\uff0c save \u53ea\u80fd\u5bfc\u51fa\u955c\u50cf\uff1b import \u548c load \u90fd\u80fd\u5bfc\u5165\u524d\u4e24\u8005\u7684\u5bfc\u51fa\u6587\u4ef6\uff0c\u6210\u4e3a\u955c\u50cf\uff0c\u4e24\u8005\u7684\u533a\u522b\u53c2\u8003 7. \u5bb9\u5668\u64cd\u4f5c \u3002","title":"2.2 \u8f7d\u5165\u955c\u50cf"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/","text":"\u5bb9\u5668\u662fdocker\u4e2d\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u8bb8\u591a\u548c\u5bb9\u5668\u76f8\u5173\u7684\u547d\u4ee4\u90fd\u53ef\u4ee5\u7701\u7565 container \u53c2\u6570\u3002 1. \u5f00\u542f\u5bb9\u5668 \u00b6 \u521b\u5efa\u5bb9\u5668\uff08\u9009\u9879\u5de8\u591a\uff09\uff1a docker [ container ] create [ OPTIONS ] IMAGE [ COMMAND ] [ ARG... ] \u5f00\u542f\u5bb9\u5668\uff1a docker [ container ] start [ OPTIONS ] CONTAINER [ CONTAINER... ] \u8fd8\u6709\u5220\u9664\u5bb9\u5668\u3001\u5220\u9664\u9000\u51fa\u7684\u5bb9\u5668\u3001\u6682\u505c/\u8fd8\u539f\u5bb9\u5668\u7b49\u3002 docker run \u76f8\u5f53\u4e8e\u5148\u6267\u884cdocker [container] create\u547d\u4ee4\uff0c\u518d\u6267\u884cdocker [container] start\u547d\u4ee4\u3002\u5f53\u4f7f\u7528\u8be5\u547d\u4ee4\u521b\u5efa\u5e76\u542f\u52a8\u65f6\uff0cDocker\u5728\u540e\u53f0\u8fd0\u884c\u7684\u6807\u51c6\u64cd\u4f5c\u5305\u62ec\uff1a \u68c0\u67e5\u672c\u5730\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u4e0d\u5b58\u5728\u5c31\u4ece\u516c\u6709\u4ed3\u5e93\u4e0b\u8f7d\uff1b \u5229\u7528\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u5e76\u542f\u52a8\u8be5\u5bb9\u5668\uff1b \u5206\u914d\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7ed9\u5bb9\u5668\uff0c\u5e76\u5728\u53ea\u8bfb\u7684\u955c\u50cf\u5c42\u5916\u9762\u6302\u8f7d\u4e00\u5c42\u53ef\u8bfb\u5199\u5c42\uff1b \u4ece\u5bbf\u4e3b\u4e3b\u673a\u914d\u7f6e\u7684\u7f51\u6865\u63a5\u53e3\u4e2d\u6865\u63a5\u4e00\u4e2a\u865a\u62df\u63a5\u53e3\u5230\u5bb9\u5668\u4e2d\u53bb\uff1b \u4ece\u7f51\u6865\u7684\u5730\u5740\u6c60\u914d\u7f6e\u4e00\u4e2aIP\u5730\u5740\u7ed9\u5bb9\u5668\uff1b \u6267\u884c\u7528\u6237\u6307\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f\uff1b \u6267\u884c\u5b8c\u6bd5\u540e\u5bb9\u5668\u88ab\u81ea\u52a8\u7ec8\u6b62\u3002 docker run - itd centos / bin / bash -it \u662f\u4e2a\u91cd\u8981\u7684\u9009\u9879\uff0c\u5176\u4e2d\uff0c \uff0dt \u9009\u9879\u8ba9Docker\u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff08pseudo-tty\uff09\u5e76\u7ed1\u5b9a\u5230\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4e0a\uff0c \uff0di \u5219\u8ba9\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4fdd\u6301\u6253\u5f00\u3002 -d \u5219\u662f\u8ba9\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\u3002\u6b64\u65f6\uff0c\u4e0e\u5bb9\u5668\u901a\u4fe1\u7684\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1a docker attach # Attach local standard input, output, and error streams to a running container docker attach [ OPTIONS ] CONTAINER docker exec\uff08\u63a8\u8350\u65b9\u5f0f\uff09 # Run a command in a running container docker exec [ OPTIONS ] CONTAINER COMMAND [ ARG... ] Options: -d, --detach Detached mode: run command in the background --detach-keys string Override the key sequence for detaching a container -e, --env list Set environment variables -i, --interactive Keep STDIN open even if not attached --privileged Give extended privileges to the command -t, --tty Allocate a pseudo-TTY -u, --user string Username or UID ( format: <name | uid> [ :<group | gid> ]) -w, --workdir string Working directory inside the container 2. \u5bfc\u51fa\u4e0e\u5bfc\u5165\u5bb9\u5668 \u00b6 \u5bfc\u51fa\u5bb9\u5668\uff08\u4e0d\u8bba\u8fd0\u884c\u4e0e\u5426\uff09\uff1a # Export a container's filesystem as a tar archive Usage: docker export [ OPTIONS ] CONTAINER Options: -o, --output string Write to a tar file, instead of STDOUT \u5bfc\u5165\u5bb9\u5668\uff1a # Import the contents from a tarball to create a filesystem image docker import [ OPTIONS ] file | URL | - [ REPOSITORY [ :TAG ]] Options: -c, --change list Apply Dockerfile instruction to the created image\uff08\u5728\u5bfc\u4eba\u7684\u540c\u65f6\u6267\u884c\u5bf9\u5bb9\u5668\u8fdb\u884c\u4fee\u6539\u7684Dockerfile\u6307\u4ee4 ) -m, --message string Set commit message for imported image \u5bfc\u5165\u4e0e\u8f7d\u5165 \uff1a \u65e2\u53ef\u4ee5\u4f7f\u7528 docker [image] load \u547d\u4ee4\u6765\u5bfc\u5165 \u955c\u50cf\u5b58\u50a8\u6587\u4ef6 \u5230\u672c\u5730\u955c\u50cf\u5e93\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 docker [container] import \u547d\u4ee4\u6765\u5bfc\u5165\u4e00\u4e2a \u5bb9\u5668\u5feb\u7167 \u5230\u672c\u5730\u955c\u50cf\u5e93\u3002 \u8fd9\u4e24\u8005\u7684\u533a\u522b\u5728\u4e8e\uff1a \u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u5c06\u4e22\u5f03\u6240\u6709\u7684\u5386\u53f2\u8bb0\u5f55\u548c\u5143\u6570\u636e\u4fe1\u606f\uff08\u5373\u4ec5\u4fdd\u5b58\u5bb9\u5668\u5f53\u65f6\u7684\u5feb\u7167\u72b6\u6001\uff09\uff0c\u800c\u955c\u50cf\u5b58\u50a8\u6587\u4ef6\u5c06\u4fdd\u5b58\u5b8c\u6574\u8bb0\u5f55\uff0c\u4f53\u79ef\u66f4\u5927\u3002 \u6b64\u5916\uff0c\u4ece\u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u5bfc\u4eba\u65f6\u53ef\u4ee5\u91cd\u65b0\u6307\u5b9a\u6807\u7b7e\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002 3. \u67e5\u770b\u5bb9\u5668 \u00b6 3.1 \u67e5\u770b\u5bb9\u5668\u8be6\u60c5 \u00b6 \u67e5\u770b\u5bb9\u5668\u7684\u5177\u4f53\u4fe1\u606f\uff0c\u8fd4\u56dejson\u6570\u636e\u3002 # Display detailed information on one or more containers docker container inspect [ OPTIONS ] CONTAINER [ CONTAINER... ] 3.2 \u67e5\u770b\u5bb9\u5668\u5185\u8fdb\u7a0b \u00b6 # Display the running processes of a container docker container top CONTAINER [ ps OPTIONS ] 3.3 \u67e5\u770b\u7edf\u8ba1\u4fe1\u606f \u00b6 CPU\u3001\u5185\u5b58\u3001\u5b58\u50a8\u3001\u7f51\u7edc\u7b49\u4f7f\u7528\u60c5\u51b5\u3002 # Display a live stream of container(s) resource usage statistics # \u663e\u793a\u5b9e\u65f6\u5bb9\u5668(s)\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\u6d41 docker container stats [ OPTIONS ] [ CONTAINER... ] Options: -a, --all Show all containers ( default shows just running ) --format string Pretty-print images using a Go template --no-stream Disable streaming stats and only pull the first result --no-trunc Do not truncate output 4. \u5176\u5b83\u547d\u4ee4 \u00b6 \u590d\u5236\u6587\u4ef6\uff1a # Copy files/folders between a container and the local filesystem docker container cp [ OPTIONS ] CONTAINER:SRC_PATH DEST_PATH | - docker cp [ OPTIONS ] SRC_PATH | - CONTAINER:DEST_PATH \u66f4\u65b0\u914d\u7f6e\uff1a \u66f4\u65b0\u5bb9\u5668\u7684\u4e00\u4e9b\u8fd0\u884c\u65f6\u914d\u7f6e\uff0c\u4e3b\u8981\u662f\u4e00\u4e9b\u8d44\u6e90\u9650\u5236\u4efd\u989d\u3002 docker container update [ OPTIONS ] CONTAINER [ CONTAINER... ]","title":"07. \u5bb9\u5668\u64cd\u4f5c"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#1","text":"\u521b\u5efa\u5bb9\u5668\uff08\u9009\u9879\u5de8\u591a\uff09\uff1a docker [ container ] create [ OPTIONS ] IMAGE [ COMMAND ] [ ARG... ] \u5f00\u542f\u5bb9\u5668\uff1a docker [ container ] start [ OPTIONS ] CONTAINER [ CONTAINER... ] \u8fd8\u6709\u5220\u9664\u5bb9\u5668\u3001\u5220\u9664\u9000\u51fa\u7684\u5bb9\u5668\u3001\u6682\u505c/\u8fd8\u539f\u5bb9\u5668\u7b49\u3002 docker run \u76f8\u5f53\u4e8e\u5148\u6267\u884cdocker [container] create\u547d\u4ee4\uff0c\u518d\u6267\u884cdocker [container] start\u547d\u4ee4\u3002\u5f53\u4f7f\u7528\u8be5\u547d\u4ee4\u521b\u5efa\u5e76\u542f\u52a8\u65f6\uff0cDocker\u5728\u540e\u53f0\u8fd0\u884c\u7684\u6807\u51c6\u64cd\u4f5c\u5305\u62ec\uff1a \u68c0\u67e5\u672c\u5730\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u4e0d\u5b58\u5728\u5c31\u4ece\u516c\u6709\u4ed3\u5e93\u4e0b\u8f7d\uff1b \u5229\u7528\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u5e76\u542f\u52a8\u8be5\u5bb9\u5668\uff1b \u5206\u914d\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7ed9\u5bb9\u5668\uff0c\u5e76\u5728\u53ea\u8bfb\u7684\u955c\u50cf\u5c42\u5916\u9762\u6302\u8f7d\u4e00\u5c42\u53ef\u8bfb\u5199\u5c42\uff1b \u4ece\u5bbf\u4e3b\u4e3b\u673a\u914d\u7f6e\u7684\u7f51\u6865\u63a5\u53e3\u4e2d\u6865\u63a5\u4e00\u4e2a\u865a\u62df\u63a5\u53e3\u5230\u5bb9\u5668\u4e2d\u53bb\uff1b \u4ece\u7f51\u6865\u7684\u5730\u5740\u6c60\u914d\u7f6e\u4e00\u4e2aIP\u5730\u5740\u7ed9\u5bb9\u5668\uff1b \u6267\u884c\u7528\u6237\u6307\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f\uff1b \u6267\u884c\u5b8c\u6bd5\u540e\u5bb9\u5668\u88ab\u81ea\u52a8\u7ec8\u6b62\u3002 docker run - itd centos / bin / bash -it \u662f\u4e2a\u91cd\u8981\u7684\u9009\u9879\uff0c\u5176\u4e2d\uff0c \uff0dt \u9009\u9879\u8ba9Docker\u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff08pseudo-tty\uff09\u5e76\u7ed1\u5b9a\u5230\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4e0a\uff0c \uff0di \u5219\u8ba9\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4fdd\u6301\u6253\u5f00\u3002 -d \u5219\u662f\u8ba9\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\u3002\u6b64\u65f6\uff0c\u4e0e\u5bb9\u5668\u901a\u4fe1\u7684\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1a docker attach # Attach local standard input, output, and error streams to a running container docker attach [ OPTIONS ] CONTAINER docker exec\uff08\u63a8\u8350\u65b9\u5f0f\uff09 # Run a command in a running container docker exec [ OPTIONS ] CONTAINER COMMAND [ ARG... ] Options: -d, --detach Detached mode: run command in the background --detach-keys string Override the key sequence for detaching a container -e, --env list Set environment variables -i, --interactive Keep STDIN open even if not attached --privileged Give extended privileges to the command -t, --tty Allocate a pseudo-TTY -u, --user string Username or UID ( format: <name | uid> [ :<group | gid> ]) -w, --workdir string Working directory inside the container","title":"1. \u5f00\u542f\u5bb9\u5668"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#2","text":"\u5bfc\u51fa\u5bb9\u5668\uff08\u4e0d\u8bba\u8fd0\u884c\u4e0e\u5426\uff09\uff1a # Export a container's filesystem as a tar archive Usage: docker export [ OPTIONS ] CONTAINER Options: -o, --output string Write to a tar file, instead of STDOUT \u5bfc\u5165\u5bb9\u5668\uff1a # Import the contents from a tarball to create a filesystem image docker import [ OPTIONS ] file | URL | - [ REPOSITORY [ :TAG ]] Options: -c, --change list Apply Dockerfile instruction to the created image\uff08\u5728\u5bfc\u4eba\u7684\u540c\u65f6\u6267\u884c\u5bf9\u5bb9\u5668\u8fdb\u884c\u4fee\u6539\u7684Dockerfile\u6307\u4ee4 ) -m, --message string Set commit message for imported image \u5bfc\u5165\u4e0e\u8f7d\u5165 \uff1a \u65e2\u53ef\u4ee5\u4f7f\u7528 docker [image] load \u547d\u4ee4\u6765\u5bfc\u5165 \u955c\u50cf\u5b58\u50a8\u6587\u4ef6 \u5230\u672c\u5730\u955c\u50cf\u5e93\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 docker [container] import \u547d\u4ee4\u6765\u5bfc\u5165\u4e00\u4e2a \u5bb9\u5668\u5feb\u7167 \u5230\u672c\u5730\u955c\u50cf\u5e93\u3002 \u8fd9\u4e24\u8005\u7684\u533a\u522b\u5728\u4e8e\uff1a \u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u5c06\u4e22\u5f03\u6240\u6709\u7684\u5386\u53f2\u8bb0\u5f55\u548c\u5143\u6570\u636e\u4fe1\u606f\uff08\u5373\u4ec5\u4fdd\u5b58\u5bb9\u5668\u5f53\u65f6\u7684\u5feb\u7167\u72b6\u6001\uff09\uff0c\u800c\u955c\u50cf\u5b58\u50a8\u6587\u4ef6\u5c06\u4fdd\u5b58\u5b8c\u6574\u8bb0\u5f55\uff0c\u4f53\u79ef\u66f4\u5927\u3002 \u6b64\u5916\uff0c\u4ece\u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u5bfc\u4eba\u65f6\u53ef\u4ee5\u91cd\u65b0\u6307\u5b9a\u6807\u7b7e\u7b49\u5143\u6570\u636e\u4fe1\u606f\u3002","title":"2. \u5bfc\u51fa\u4e0e\u5bfc\u5165\u5bb9\u5668"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#3","text":"","title":"3. \u67e5\u770b\u5bb9\u5668"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#31","text":"\u67e5\u770b\u5bb9\u5668\u7684\u5177\u4f53\u4fe1\u606f\uff0c\u8fd4\u56dejson\u6570\u636e\u3002 # Display detailed information on one or more containers docker container inspect [ OPTIONS ] CONTAINER [ CONTAINER... ]","title":"3.1 \u67e5\u770b\u5bb9\u5668\u8be6\u60c5"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#32","text":"# Display the running processes of a container docker container top CONTAINER [ ps OPTIONS ]","title":"3.2 \u67e5\u770b\u5bb9\u5668\u5185\u8fdb\u7a0b"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#33","text":"CPU\u3001\u5185\u5b58\u3001\u5b58\u50a8\u3001\u7f51\u7edc\u7b49\u4f7f\u7528\u60c5\u51b5\u3002 # Display a live stream of container(s) resource usage statistics # \u663e\u793a\u5b9e\u65f6\u5bb9\u5668(s)\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\u6d41 docker container stats [ OPTIONS ] [ CONTAINER... ] Options: -a, --all Show all containers ( default shows just running ) --format string Pretty-print images using a Go template --no-stream Disable streaming stats and only pull the first result --no-trunc Do not truncate output","title":"3.3 \u67e5\u770b\u7edf\u8ba1\u4fe1\u606f"},{"location":"docker/07. \u5bb9\u5668\u64cd\u4f5c/#4","text":"\u590d\u5236\u6587\u4ef6\uff1a # Copy files/folders between a container and the local filesystem docker container cp [ OPTIONS ] CONTAINER:SRC_PATH DEST_PATH | - docker cp [ OPTIONS ] SRC_PATH | - CONTAINER:DEST_PATH \u66f4\u65b0\u914d\u7f6e\uff1a \u66f4\u65b0\u5bb9\u5668\u7684\u4e00\u4e9b\u8fd0\u884c\u65f6\u914d\u7f6e\uff0c\u4e3b\u8981\u662f\u4e00\u4e9b\u8d44\u6e90\u9650\u5236\u4efd\u989d\u3002 docker container update [ OPTIONS ] CONTAINER [ CONTAINER... ]","title":"4. \u5176\u5b83\u547d\u4ee4"},{"location":"docker/08. docker\u4ed3\u5e93/","text":"1. \u81ea\u52a8\u521b\u5efa \u00b6 \u81ea\u52a8\u521b\u5efa\uff08AutomatedBuilds\uff09\u662fDockerHub\u63d0\u4f9b\u7684\u81ea\u52a8\u5316\u670d\u52a1\uff0c\u8fd9\u4e00\u529f\u80fd\u53ef\u4ee5\u81ea\u52a8\u8ddf\u968f\u9879\u76ee\u4ee3\u7801\u7684\u53d8\u66f4\u800c\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u3002 \u4f8b\u5982\uff0c\u7528\u6237\u6784\u5efa\u4e86\u67d0\u5e94\u7528\u955c\u50cf\uff0c\u5982\u679c\u5e94\u7528\u53d1\u5e03\u65b0\u7248\u672c\uff0c\u7528\u6237\u9700\u8981\u624b\u52a8\u66f4\u65b0\u955c\u50cf\u3002 \u800c\u81ea\u52a8\u521b\u5efa\u5219\u5141\u8bb8\u7528\u6237\u901a\u8fc7DockerHub\u6307\u5b9a\u8ddf\u8e2a\u4e00\u4e2a\u76ee\u6807\u7f51\u7ad9\uff08\u76ee\u524d\u652f\u6301GitHub\u6216BitBucket\uff09\u4e0a\u7684\u9879\u76ee\uff0c\u4e00\u65e6\u9879\u76ee\u53d1\u751f\u65b0\u7684\u63d0\u4ea4\uff0c\u5219\u81ea\u52a8\u6267\u884c\u521b\u5efa\u3002 \u8981\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\uff0c\u5305\u62ec\u5982\u4e0b\u7684\u6b65\u9aa4\uff1a \u521b\u5efa\u5e76\u767b\u5f55DockerHub\uff0c\u4ee5\u53ca\u76ee\u6807\u7f51\u7ad9\u5982Github; \u5728\u76ee\u6807\u7f51\u7ad9\u4e2d\u5141\u8bb8DockerHub\u8bbf\u95ee\u670d\u52a1\uff1b \u5728DockerHub\u4e2d\u914d\u7f6e\u4e00\u4e2a\u201c\u81ea\u52a8\u521b\u5efa\u201d\u7c7b\u578b\u7684\u9879\u76ee\uff1b \u9009\u53d6\u4e00\u4e2a\u76ee\u6807\u7f51\u7ad9\u4e2d\u7684\u9879\u76ee\uff08\u9700\u8981\u542bDockerfile\uff09\u548c\u5206\u652f\uff1b \u6307\u5b9aDockerfile\u7684\u4f4d\u7f6e\uff0c\u5e76\u63d0\u4ea4\u521b\u5efa\u3002 \u4e4b\u540e\uff0c\u53ef\u4ee5\u5728DockerHub\u7684\u201c\u81ea\u52a8\u521b\u5efa\u201d\u9875\u9762\u4e2d\u8ddf\u8e2a\u6bcf\u6b21\u521b\u5efa\u7684\u72b6\u6001\u3002 2. \u7b2c\u4e09\u65b9\u955c\u50cf\u5e02\u573a \u00b6 \u4e0b\u8f7d\u955c\u50cf\u4e5f\u662f\u4f7f\u7528docker pull\u547d\u4ee4\uff0c\u4f46\u662f\u8981\u5728\u955c\u50cf\u540d\u79f0\u524d\u6dfb\u52a0\u6ce8\u518c\u670d\u52a1\u5668\u7684\u5177\u4f53\u5730\u5740\u3002 \u683c\u5f0f\u4e3a daocloud.io/<namespace>/<repository>:<tag> \u3002 \u4f8b\u5982\uff0c\u8981\u4ece DaoCloud \u4e0b\u8f7d\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a $ docker pull daocloud.io/node:latest 3. \u642d\u5efa\u79c1\u6709\u955c\u50cf\u4ed3\u5e93 \u00b6 \u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u63d0\u4f9b\u7684 registry \u955c\u50cf\u6765\u7b80\u5355\u642d\u5efa\u4e00\u5957\u672c\u5730\u79c1\u6709\u4ed3\u5e93\u73af\u5883\uff1a $ docker run -d -p 5000 :5000 registry \u6807\u8bb0\u672c\u5730\u955c\u50cf\uff1a $ docker tag changedcentos:latest localhost:5000/mycentos \u4e0a\u4f20\u955c\u50cf\uff1a $ docker push localhost:5000/mycentos \u4e0b\u8f7d\u955c\u50cf\uff1a $ docker pull localhost:5000/mycentos \u9664\u4e86\u5b98\u65b9\u7684registry\u9879\u76ee\u5916\uff0c\u7528\u6237\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u5f00\u6e90\u65b9\u6848\uff08\u4f8b\u5982nexus\uff09\u6765\u642d\u5efa\u79c1\u6709\u5316\u7684\u5bb9\u5668\u955c\u50cf\u4ed3\u5e93\u3002","title":"08. docker\u4ed3\u5e93"},{"location":"docker/08. docker\u4ed3\u5e93/#1","text":"\u81ea\u52a8\u521b\u5efa\uff08AutomatedBuilds\uff09\u662fDockerHub\u63d0\u4f9b\u7684\u81ea\u52a8\u5316\u670d\u52a1\uff0c\u8fd9\u4e00\u529f\u80fd\u53ef\u4ee5\u81ea\u52a8\u8ddf\u968f\u9879\u76ee\u4ee3\u7801\u7684\u53d8\u66f4\u800c\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u3002 \u4f8b\u5982\uff0c\u7528\u6237\u6784\u5efa\u4e86\u67d0\u5e94\u7528\u955c\u50cf\uff0c\u5982\u679c\u5e94\u7528\u53d1\u5e03\u65b0\u7248\u672c\uff0c\u7528\u6237\u9700\u8981\u624b\u52a8\u66f4\u65b0\u955c\u50cf\u3002 \u800c\u81ea\u52a8\u521b\u5efa\u5219\u5141\u8bb8\u7528\u6237\u901a\u8fc7DockerHub\u6307\u5b9a\u8ddf\u8e2a\u4e00\u4e2a\u76ee\u6807\u7f51\u7ad9\uff08\u76ee\u524d\u652f\u6301GitHub\u6216BitBucket\uff09\u4e0a\u7684\u9879\u76ee\uff0c\u4e00\u65e6\u9879\u76ee\u53d1\u751f\u65b0\u7684\u63d0\u4ea4\uff0c\u5219\u81ea\u52a8\u6267\u884c\u521b\u5efa\u3002 \u8981\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\uff0c\u5305\u62ec\u5982\u4e0b\u7684\u6b65\u9aa4\uff1a \u521b\u5efa\u5e76\u767b\u5f55DockerHub\uff0c\u4ee5\u53ca\u76ee\u6807\u7f51\u7ad9\u5982Github; \u5728\u76ee\u6807\u7f51\u7ad9\u4e2d\u5141\u8bb8DockerHub\u8bbf\u95ee\u670d\u52a1\uff1b \u5728DockerHub\u4e2d\u914d\u7f6e\u4e00\u4e2a\u201c\u81ea\u52a8\u521b\u5efa\u201d\u7c7b\u578b\u7684\u9879\u76ee\uff1b \u9009\u53d6\u4e00\u4e2a\u76ee\u6807\u7f51\u7ad9\u4e2d\u7684\u9879\u76ee\uff08\u9700\u8981\u542bDockerfile\uff09\u548c\u5206\u652f\uff1b \u6307\u5b9aDockerfile\u7684\u4f4d\u7f6e\uff0c\u5e76\u63d0\u4ea4\u521b\u5efa\u3002 \u4e4b\u540e\uff0c\u53ef\u4ee5\u5728DockerHub\u7684\u201c\u81ea\u52a8\u521b\u5efa\u201d\u9875\u9762\u4e2d\u8ddf\u8e2a\u6bcf\u6b21\u521b\u5efa\u7684\u72b6\u6001\u3002","title":"1. \u81ea\u52a8\u521b\u5efa"},{"location":"docker/08. docker\u4ed3\u5e93/#2","text":"\u4e0b\u8f7d\u955c\u50cf\u4e5f\u662f\u4f7f\u7528docker pull\u547d\u4ee4\uff0c\u4f46\u662f\u8981\u5728\u955c\u50cf\u540d\u79f0\u524d\u6dfb\u52a0\u6ce8\u518c\u670d\u52a1\u5668\u7684\u5177\u4f53\u5730\u5740\u3002 \u683c\u5f0f\u4e3a daocloud.io/<namespace>/<repository>:<tag> \u3002 \u4f8b\u5982\uff0c\u8981\u4ece DaoCloud \u4e0b\u8f7d\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a $ docker pull daocloud.io/node:latest","title":"2. \u7b2c\u4e09\u65b9\u955c\u50cf\u5e02\u573a"},{"location":"docker/08. docker\u4ed3\u5e93/#3","text":"\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u63d0\u4f9b\u7684 registry \u955c\u50cf\u6765\u7b80\u5355\u642d\u5efa\u4e00\u5957\u672c\u5730\u79c1\u6709\u4ed3\u5e93\u73af\u5883\uff1a $ docker run -d -p 5000 :5000 registry \u6807\u8bb0\u672c\u5730\u955c\u50cf\uff1a $ docker tag changedcentos:latest localhost:5000/mycentos \u4e0a\u4f20\u955c\u50cf\uff1a $ docker push localhost:5000/mycentos \u4e0b\u8f7d\u955c\u50cf\uff1a $ docker pull localhost:5000/mycentos \u9664\u4e86\u5b98\u65b9\u7684registry\u9879\u76ee\u5916\uff0c\u7528\u6237\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u5f00\u6e90\u65b9\u6848\uff08\u4f8b\u5982nexus\uff09\u6765\u642d\u5efa\u79c1\u6709\u5316\u7684\u5bb9\u5668\u955c\u50cf\u4ed3\u5e93\u3002","title":"3. \u642d\u5efa\u79c1\u6709\u955c\u50cf\u4ed3\u5e93"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/","text":"\u5bb9\u5668\u4e2d\u7684\u7ba1\u7406\u6570\u636e\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u6570\u636e\u5377\uff08Data Volumes\uff09\uff1a \u5bb9\u5668\u5185\u6570\u636e\u76f4\u63a5\u6620\u5c04\u5230\u672c\u5730\u4e3b\u673a\u73af\u5883\uff1b \u6570\u636e\u5377\u5bb9\u5668\uff08Data Volume Containers\uff09\uff1a \u4f7f\u7528\u7279\u5b9a\u5bb9\u5668\u7ef4\u62a4\u6570\u636e\u5377\u3002 1. \u6570\u636e\u5377 \u00b6 \u6570\u636e\u5377\uff08Data Volumes\uff09 \u662f\u4e00\u4e2a\u53ef\u4f9b\u5bb9\u5668\u4f7f\u7528\u7684\u7279\u6b8a\u76ee\u5f55\uff0c\u5b83\u5c06\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u76f4\u63a5\u6620\u5c04\u8fdb\u5bb9\u5668\uff0c\u7c7b\u4f3c\u4e8eLinux\u4e2d\u7684mount\u884c\u4e3a\u3002 \u6570\u636e\u5377\u53ef\u4ee5\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4e8b\u548c\u91cd\u7528\uff0c\u5bb9\u5668\u95f4\u4f20\u9012\u6570\u636e\u5c06\u53d8\u5f97\u9ad8\u6548\u4e0e\u65b9\u4fbf\uff1b \u5bf9\u6570\u636e\u5377\u5185\u6570\u636e\u7684\u4fee\u6539\u4f1a\u7acb\u9a6c\u751f\u6548\uff0c\u65e0\u8bba\u662f\u5bb9\u5668\u5185\u64cd\u4f5c\u8fd8\u662f\u672c\u5730\u64cd\u4f5c\uff1b \u5bf9\u6570\u636e\u5377\u7684\u66f4\u65b0\u4e0d\u4f1a\u5f71\u54cd\u955c\u50cf\uff0c\u89e3\u85d5\u5f00\u5e94\u7528\u548c\u6570\u636e\uff1b \u5377\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u76f4\u5230\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u5378\u8f7d\u5b83\u3002 1.1 \u7ed1\u5b9a\u6570\u636e\u5377 \u00b6 \u9664\u4e86\u4f7f\u7528 volume \u5b50\u547d\u4ee4\u6765\u7ba1\u7406\u6570\u636e\u5377\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u5c06\u4e3b\u673a\u672c\u5730\u7684\u4efb\u610f\u8def\u5f84\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u4f5c\u4e3a\u6570\u636e\u5377\uff0c\u8fd9\u79cd\u5f62\u5f0f\u521b\u5efa\u7684\u6570\u636e\u5377\u79f0\u4e3a\u7ed1\u5b9a\u6570\u636e\u5377\u3002 \u4f7f\u7528 docker run \u547d\u4ee4\u7684 --mount \u9009\u9879\u8fbe\u6210\u6b64\u76ee\u7684\uff1a $ docker run -P -itd --name test_mount --mount type = bind,source = /home/amhello-1.0,destination = /home/mount_point changedcentos:latest /bin/bash $ docker attach test_mount $ [ root@aa3cf2fe682f mount_point ] # pwd /home/mount_point $ [ root@aa3cf2fe682f mount_point ] # ll total 304 -rw-r--r-- 1 1000 1000 813 Dec 28 2018 Makefile.am \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 --mount \u9009\u9879\u652f\u6301\u4e09\u79cd\u7c7b\u578b\u7684\u6570\u636e\u5377\uff1a volume \uff1a \u666e\u901a\u6570\u636e\u5377\uff0c\u6620\u5c04\u5230\u4e3b\u673a\uff0fvar/lib/docker/volumes\u8def\u5f84\u4e0b\uff1b bind\uff1a\u7ed1\u5b9a\u6570\u636e\u5377\uff0c\u6620\u5c04\u5230\u4e3b\u673a\u6307\u5b9a\u8def\u5f84\u4e0b\uff1b tmpfs\uff1a\u4e34\u65f6\u6570\u636e\u5377\uff0c\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u3002 \u8fd9\u4e2a\u529f\u80fd\u5728\u8fdb\u884c\u5e94\u7528\u6d4b\u8bd5\u7684\u65f6\u5019\u5341\u5206\u65b9\u4fbf\uff0c\u6bd4\u5982\u7528\u6237\u53ef\u4ee5\u653e\u7f6e\u4e00\u4e9b\u7a0b\u5e8f\u6216\u6570\u636e\u5230\u672c\u5730\u76ee\u5f55\u4e2d\u5b9e\u65f6\u8fdb\u884c\u66f4\u65b0\uff0c\u7136\u540e\u5728\u5bb9\u5668\u5185\u8fd0\u884c\u548c\u4f7f\u7528\u3002 \u53e6\u5916\uff0c\u672c\u5730\u76ee\u5f55\u7684\u8def\u5f84\u5fc5\u987b\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5bb9\u5668\u5185\u8def\u5f84\u53ef\u4ee5\u4e3a\u76f8\u5bf9\u8def\u5f84\u3002 \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c Docker\u4f1a\u81ea\u52a8\u521b\u5efa\u3002 \u63a8\u8350\u7684\u65b9\u5f0f\u662f\u76f4\u63a5\u6302\u8f7d\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u5230\u5bb9\u5668\u5185\u3002 2. \u6570\u636e\u5377\u5bb9\u5668 \u00b6 \u6570\u636e\u5377\u5bb9\u5668\u4e5f\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u4f46\u662f\u5b83\u7684\u76ee\u7684\u662f\u4e13\u95e8\u63d0\u4f9b\u6570\u636e\u5377\u7ed9\u5176\u4ed6\u5bb9\u5668\u6302\u8f7d\u3002 \u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\u5bb9\u5668\uff1a # -v \u548c --mount \u9009\u9879\u7c7b\u4f3c\uff0c\u90fd\u53ef\u4ee5\u6307\u5b9a\u6570\u636e\u5377 # -v \u7684\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a/webapp:/opt/webapp:ro # \u4f7f\u7528\u201c:\u201d\u5206\u9694source\u548cdestination\uff0c\u7701\u7565source\u65f6\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684volume docker run -itd -v /shared_volume --name shared_container changedcentos /bin/bash # --volumes-from \u4ece\u6307\u5b9a\u7684\u5bb9\u5668\uff08s\uff09\u6302\u8f7d\u6570\u636e\u5377 docker run -itd --volumes-from shared_container --name test1 centos # \u6b64\u65f6\u4e24\u8005\u4e2d\u90fd\u53ef\u4ee5\u770b\u5230/shared_volume\u76ee\u5f55\uff0c\u5e76\u4e14\u8bfb\u5199\u540c\u6b65 3. \u5907\u4efd\u3001\u6062\u590d\u3001\u8fc1\u79fb\u6570\u636e\u5377 \u00b6 3.1 \u5907\u4efd\u5bb9\u5668 \u00b6 $ docker run --rm --volumes-from dbstore -v $( pwd ) :/backup ubuntu tar cvf /backup/backup.tar /dbdata \u767b\u5f55\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668\u5e76\u4ece dbstore \u5bb9\u5668\u6302\u8f7d\u5377 \u6302\u5728\u672c\u5730\u76ee\u5f55\u5230 /backup \u4f20\u9012\u6253\u5305\u547d\u4ee4\uff0c\u5c06\u5377\u7684\u5185\u5bb9\u8fdb\u884c\u6253\u5305\u5230\u6302\u8f7d\u70b9 3.2 \u4ece\u5907\u4efd\u4e2d\u6062\u590d\u5bb9\u5668 \u00b6 \u53ef\u4ee5\u4f7f\u7528\u5907\u4efd\u6587\u4ef6\u6062\u590d\u5230\u540c\u4e00\u4e2a\u6216\u5176\u5b83\u5bb9\u5668\u4e2d\u3002 \u521b\u5efa\u65b0\u7684\u5bb9\u5668 dbstore2 $ docker run -v /dbdata --name dbstore2 ubuntu /bin/bash \u5728\u65b0\u5bb9\u5668\u7684\u6570\u636e\u5377\u4e2d\u89e3\u5305\u5907\u4efd\u6587\u4ef6 $ docker run --rm --volumes-from dbstore2 -v $( pwd ) :/backup ubuntu bash -c \"cd /dbdata && tar xvf /backup/backup.tar --strip 1\" \u4f60\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u5de5\u5177\u6765\u4f7f\u7528\u4e0a\u8ff0\u7684\u6280\u672f\u8fdb\u884c\u81ea\u52a8\u7684\u5907\u4efd\u3001\u8fc1\u79fb\u548c\u6062\u590d\u3002 4. \u5220\u9664\u5377 \u00b6 \u5f53\u5bb9\u5668\u5220\u9664\u65f6\u6570\u636e\u5377\u4e0d\u4f1a\u81ea\u52a8\u5220\u9664\u3002 \u547d\u540d\u5377\u5177\u6709\u6765\u81ea\u5bb9\u5668\u5916\u90e8\u7684\u7279\u5b9a\u6e90\uff0c\u4f8b\u5982 awsome:/bar \u3002 \u533f\u540d\u5377\u6ca1\u6709\u7279\u5b9a\u7684\u6e90\uff0c\u56e0\u6b64\u5728\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u6307\u793aDocker Engine\u5b88\u62a4\u7a0b\u5e8f\u5220\u9664\u5b83\u4eec\u3002 4.1 \u79fb\u9664\u533f\u540d\u5377 \u00b6 \u8981\u81ea\u52a8\u5220\u9664\u533f\u540d\u5377\uff0c\u4f7f\u7528 --rm \u9009\u9879\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u533f\u540d\u5377 /foo \uff0c\u5f53\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u4f1a\u5220\u9664 /foo \u5377\u800c\u4e0d\u662f awsome \u5377\u3002 $ docker run --rm -v /foo -v awesome:/bar busybox top","title":"09. Docker\u6570\u636e\u7ba1\u7406"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#1","text":"\u6570\u636e\u5377\uff08Data Volumes\uff09 \u662f\u4e00\u4e2a\u53ef\u4f9b\u5bb9\u5668\u4f7f\u7528\u7684\u7279\u6b8a\u76ee\u5f55\uff0c\u5b83\u5c06\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u76f4\u63a5\u6620\u5c04\u8fdb\u5bb9\u5668\uff0c\u7c7b\u4f3c\u4e8eLinux\u4e2d\u7684mount\u884c\u4e3a\u3002 \u6570\u636e\u5377\u53ef\u4ee5\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4e8b\u548c\u91cd\u7528\uff0c\u5bb9\u5668\u95f4\u4f20\u9012\u6570\u636e\u5c06\u53d8\u5f97\u9ad8\u6548\u4e0e\u65b9\u4fbf\uff1b \u5bf9\u6570\u636e\u5377\u5185\u6570\u636e\u7684\u4fee\u6539\u4f1a\u7acb\u9a6c\u751f\u6548\uff0c\u65e0\u8bba\u662f\u5bb9\u5668\u5185\u64cd\u4f5c\u8fd8\u662f\u672c\u5730\u64cd\u4f5c\uff1b \u5bf9\u6570\u636e\u5377\u7684\u66f4\u65b0\u4e0d\u4f1a\u5f71\u54cd\u955c\u50cf\uff0c\u89e3\u85d5\u5f00\u5e94\u7528\u548c\u6570\u636e\uff1b \u5377\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u76f4\u5230\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u5378\u8f7d\u5b83\u3002","title":"1. \u6570\u636e\u5377"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#11","text":"\u9664\u4e86\u4f7f\u7528 volume \u5b50\u547d\u4ee4\u6765\u7ba1\u7406\u6570\u636e\u5377\u5916\uff0c\u8fd8\u53ef\u4ee5\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u5c06\u4e3b\u673a\u672c\u5730\u7684\u4efb\u610f\u8def\u5f84\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u4f5c\u4e3a\u6570\u636e\u5377\uff0c\u8fd9\u79cd\u5f62\u5f0f\u521b\u5efa\u7684\u6570\u636e\u5377\u79f0\u4e3a\u7ed1\u5b9a\u6570\u636e\u5377\u3002 \u4f7f\u7528 docker run \u547d\u4ee4\u7684 --mount \u9009\u9879\u8fbe\u6210\u6b64\u76ee\u7684\uff1a $ docker run -P -itd --name test_mount --mount type = bind,source = /home/amhello-1.0,destination = /home/mount_point changedcentos:latest /bin/bash $ docker attach test_mount $ [ root@aa3cf2fe682f mount_point ] # pwd /home/mount_point $ [ root@aa3cf2fe682f mount_point ] # ll total 304 -rw-r--r-- 1 1000 1000 813 Dec 28 2018 Makefile.am \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 --mount \u9009\u9879\u652f\u6301\u4e09\u79cd\u7c7b\u578b\u7684\u6570\u636e\u5377\uff1a volume \uff1a \u666e\u901a\u6570\u636e\u5377\uff0c\u6620\u5c04\u5230\u4e3b\u673a\uff0fvar/lib/docker/volumes\u8def\u5f84\u4e0b\uff1b bind\uff1a\u7ed1\u5b9a\u6570\u636e\u5377\uff0c\u6620\u5c04\u5230\u4e3b\u673a\u6307\u5b9a\u8def\u5f84\u4e0b\uff1b tmpfs\uff1a\u4e34\u65f6\u6570\u636e\u5377\uff0c\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u3002 \u8fd9\u4e2a\u529f\u80fd\u5728\u8fdb\u884c\u5e94\u7528\u6d4b\u8bd5\u7684\u65f6\u5019\u5341\u5206\u65b9\u4fbf\uff0c\u6bd4\u5982\u7528\u6237\u53ef\u4ee5\u653e\u7f6e\u4e00\u4e9b\u7a0b\u5e8f\u6216\u6570\u636e\u5230\u672c\u5730\u76ee\u5f55\u4e2d\u5b9e\u65f6\u8fdb\u884c\u66f4\u65b0\uff0c\u7136\u540e\u5728\u5bb9\u5668\u5185\u8fd0\u884c\u548c\u4f7f\u7528\u3002 \u53e6\u5916\uff0c\u672c\u5730\u76ee\u5f55\u7684\u8def\u5f84\u5fc5\u987b\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5bb9\u5668\u5185\u8def\u5f84\u53ef\u4ee5\u4e3a\u76f8\u5bf9\u8def\u5f84\u3002 \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c Docker\u4f1a\u81ea\u52a8\u521b\u5efa\u3002 \u63a8\u8350\u7684\u65b9\u5f0f\u662f\u76f4\u63a5\u6302\u8f7d\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u5230\u5bb9\u5668\u5185\u3002","title":"1.1 \u7ed1\u5b9a\u6570\u636e\u5377"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#2","text":"\u6570\u636e\u5377\u5bb9\u5668\u4e5f\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u4f46\u662f\u5b83\u7684\u76ee\u7684\u662f\u4e13\u95e8\u63d0\u4f9b\u6570\u636e\u5377\u7ed9\u5176\u4ed6\u5bb9\u5668\u6302\u8f7d\u3002 \u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\u5bb9\u5668\uff1a # -v \u548c --mount \u9009\u9879\u7c7b\u4f3c\uff0c\u90fd\u53ef\u4ee5\u6307\u5b9a\u6570\u636e\u5377 # -v \u7684\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a/webapp:/opt/webapp:ro # \u4f7f\u7528\u201c:\u201d\u5206\u9694source\u548cdestination\uff0c\u7701\u7565source\u65f6\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684volume docker run -itd -v /shared_volume --name shared_container changedcentos /bin/bash # --volumes-from \u4ece\u6307\u5b9a\u7684\u5bb9\u5668\uff08s\uff09\u6302\u8f7d\u6570\u636e\u5377 docker run -itd --volumes-from shared_container --name test1 centos # \u6b64\u65f6\u4e24\u8005\u4e2d\u90fd\u53ef\u4ee5\u770b\u5230/shared_volume\u76ee\u5f55\uff0c\u5e76\u4e14\u8bfb\u5199\u540c\u6b65","title":"2. \u6570\u636e\u5377\u5bb9\u5668"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#3","text":"","title":"3. \u5907\u4efd\u3001\u6062\u590d\u3001\u8fc1\u79fb\u6570\u636e\u5377"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#31","text":"$ docker run --rm --volumes-from dbstore -v $( pwd ) :/backup ubuntu tar cvf /backup/backup.tar /dbdata \u767b\u5f55\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668\u5e76\u4ece dbstore \u5bb9\u5668\u6302\u8f7d\u5377 \u6302\u5728\u672c\u5730\u76ee\u5f55\u5230 /backup \u4f20\u9012\u6253\u5305\u547d\u4ee4\uff0c\u5c06\u5377\u7684\u5185\u5bb9\u8fdb\u884c\u6253\u5305\u5230\u6302\u8f7d\u70b9","title":"3.1 \u5907\u4efd\u5bb9\u5668"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#32","text":"\u53ef\u4ee5\u4f7f\u7528\u5907\u4efd\u6587\u4ef6\u6062\u590d\u5230\u540c\u4e00\u4e2a\u6216\u5176\u5b83\u5bb9\u5668\u4e2d\u3002 \u521b\u5efa\u65b0\u7684\u5bb9\u5668 dbstore2 $ docker run -v /dbdata --name dbstore2 ubuntu /bin/bash \u5728\u65b0\u5bb9\u5668\u7684\u6570\u636e\u5377\u4e2d\u89e3\u5305\u5907\u4efd\u6587\u4ef6 $ docker run --rm --volumes-from dbstore2 -v $( pwd ) :/backup ubuntu bash -c \"cd /dbdata && tar xvf /backup/backup.tar --strip 1\" \u4f60\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u5de5\u5177\u6765\u4f7f\u7528\u4e0a\u8ff0\u7684\u6280\u672f\u8fdb\u884c\u81ea\u52a8\u7684\u5907\u4efd\u3001\u8fc1\u79fb\u548c\u6062\u590d\u3002","title":"3.2 \u4ece\u5907\u4efd\u4e2d\u6062\u590d\u5bb9\u5668"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#4","text":"\u5f53\u5bb9\u5668\u5220\u9664\u65f6\u6570\u636e\u5377\u4e0d\u4f1a\u81ea\u52a8\u5220\u9664\u3002 \u547d\u540d\u5377\u5177\u6709\u6765\u81ea\u5bb9\u5668\u5916\u90e8\u7684\u7279\u5b9a\u6e90\uff0c\u4f8b\u5982 awsome:/bar \u3002 \u533f\u540d\u5377\u6ca1\u6709\u7279\u5b9a\u7684\u6e90\uff0c\u56e0\u6b64\u5728\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u6307\u793aDocker Engine\u5b88\u62a4\u7a0b\u5e8f\u5220\u9664\u5b83\u4eec\u3002","title":"4. \u5220\u9664\u5377"},{"location":"docker/09. Docker\u6570\u636e\u7ba1\u7406/#41","text":"\u8981\u81ea\u52a8\u5220\u9664\u533f\u540d\u5377\uff0c\u4f7f\u7528 --rm \u9009\u9879\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u547d\u4ee4\u521b\u5efa\u533f\u540d\u5377 /foo \uff0c\u5f53\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u4f1a\u5220\u9664 /foo \u5377\u800c\u4e0d\u662f awsome \u5377\u3002 $ docker run --rm -v /foo -v awesome:/bar busybox top","title":"4.1 \u79fb\u9664\u533f\u540d\u5377"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/","text":"Docker \u9664\u4e86\u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee\u5916\uff0c \u8fd8\u63d0\u4f9b\u4e86\u4e24\u4e2a\u5f88\u65b9\u4fbf\u7684\u529f\u80fd\u6765\u6ee1\u8db3\u670d\u52a1\u8bbf\u95ee\u7684\u57fa\u672c\u9700\u6c42\uff1a \u4e00\u4e2a\u662f\u5141\u8bb8\u6620\u5c04\u5bb9\u5668\u5185\u5e94\u7528\u7684\u670d\u52a1\u7aef\u53e3\u5230\u672c\u5730\u5bbf\u4e3b\u4e3b\u673a\uff1b \u53e6\u4e00\u4e2a\u662f\u4e92\u8054\u673a\u5236\u5b9e\u73b0\u591a\u4e2a\u5bb9\u5668\u95f4\u901a\u8fc7\u5bb9\u5668\u540d\u6765\u5feb\u901f\u8bbf\u95ee\u3002 1. \u7aef\u53e3\u6620\u5c04\u5b9e\u73b0\u5bb9\u5668\u8bbf\u95ee \u00b6 1.1 \u4ece\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528 \u00b6 \u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5bf9\u5e94\u53c2\u6570\uff0c\u5728\u5bb9\u5668\u5916\u90e8\u662f\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u6765\u8bbf\u95ee\u5bb9\u5668\u5185\u7684\u7f51\u7edc\u5e94\u7528\u548c\u670d\u52a1\u7684\u3002 \u8981\u8ba9\u5916\u90e8\u8bbf\u95ee\u8fd9\u4e9b\u5e94\u7528\u65f6\uff0c \u53ef\u4ee5\u901a\u8fc7-P\u6216-p\u53c2\u6570\u6765\u6307\u5b9a\u7aef\u53e3\u6620\u5c04\u3002 \u5f53\u4f7f\u7528 -P \uff08\u5927\u5199\u7684\uff09\u6807\u8bb0\u65f6\uff0c Docker \u4f1a\u968f\u673a\u6620\u5c04\u4e00\u4e2a 49000~49900 \u7684\u7aef\u53e3\u5230\u5185\u90e8\u5bb9\u5668\u5f00\u653e\u7684\u7f51\u7edc\u7aef\u53e3\u3002\u7136\u540e\u4f7f\u7528 docker port CONTAINER \u67e5\u770b\u7aef\u53e3\u3002 $ docker run -P -itd --name test_mount changedcentos:latest /bin/bash $ docker port test_mount -p (\u5c0f\u5199\u7684\uff09\u5219\u53ef\u4ee5\u6307\u5b9a\u8981\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u5e76\u4e14\uff0c\u5728\u4e00\u4e2a\u6307\u5b9a\u7aef\u53e3\u4e0a\u53ea\u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a\u5bb9\u5668\u3002\u652f\u6301\u7684\u683c\u5f0f\u6709 IP:HostPort:ContainerPort \u6216 IP::ContainerPort \u6216 HostPort:ContainerPort \u3002 1.2 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u6307\u5b9a\u7aef\u53e3 \u00b6 IP:HostPort:ContainerPort \u6307\u5b9a\u6620\u5c04\u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u7684\u5730\u5740\uff1a docker run - d - p 127 . 0 . 0 . 1 : 5000 : 5000 training / webapp python app . py 1.3 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u968f\u673a\u7aef\u53e3 \u00b6 IP::ContainerPort \u7ed1\u5b9a\u4e00\u4e2a\u7aef\u53e3\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u672c\u5730\u4e3b\u673a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a\u7aef\u53e3\uff1a docker run - d - p 127 . 0 . 0 . 1 :: 5000 training / webapp python app . py 1.4 \u6620\u5c04\u6240\u6709\u63a5\u53e3\u5730\u5740 \u00b6 HostPort:ContainerPort \u5c06\u672c\u5730\u6240\u6709\u63a5\u53e3\u4e0a\u7684\u6240\u6709\u5730\u5740\u7684\u7279\u5b9a\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a docker run - d - p 5000 : 5000 webapp python app . py \u591a\u6b21\u4f7f\u7528 -p \u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u7aef\u53e3\uff1a docker run - d - p 5000 : 5000 - p 3000 : 80 training / webapp python app . py Note \u5bb9\u5668\u6709\u81ea\u5df1\u7684\u5185\u90e8\u7f51\u7edc\u548cIP\u5730\u5740\uff0c\u4f7f\u7528 docker [container) inspect\uff0b\u5bb9\u5668ID \u53ef\u4ee5\u83b7\u53d6\u5bb9\u5668\u7684\u5177\u4f53\u4fe1\u606f\u3002 2. \u4e92\u8054\u673a\u5236\u5b9e\u73b0\u4fbf\u6377\u4e92\u8bbf \u00b6 \u5bb9\u5668\u7684 \u4e92\u8054(Iinking) \u662f\u4e00\u79cd\u8ba9\u591a\u4e2a\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u8fdb\u884c\u5feb\u901f\u4ea4\u4e92\u7684\u65b9\u5f0f\u3002\u5b83\u4f1a\u5728\u6e90\u548c\u63a5\u6536\u5bb9\u5668\u4e4b\u95f4\u521b\u5efa\u8fde\u63a5\u5173\u7cfb\uff0c\u63a5\u6536\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668\u540d\u5feb\u901f\u8bbf\u95ee\u5230\u6e90\u5bb9\u5668\uff0c\u800c\u4e0d\u7528\u6307\u5b9a\u5177\u4f53\u7684IP\u5730\u5740\u3002 \u5728\u6267\u884cdocker [container] run\u7684\u65f6\u5019\u5982\u679c\u6dfb\u52a0 --rm \u6807\u8bb0\uff0c\u5219\u5bb9\u5668\u5728\u7ec8\u6b62\u540e\u4f1a\u7acb\u523b\u5220\u9664\u3002 \u6ce8\u610f\uff0c--rm \u548c -d \u53c2\u6570\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002 2.1 \u5bb9\u5668\u4e92\u8054 \u00b6 \u4f7f\u7528 --link \u53c2\u6570\u53ef\u4ee5\u8ba9\u5bb9\u5668\u4e4b\u95f4\u5b89\u5168\u5730\u8fdb\u884c\u4ea4\u4e92\u3002 # \u5148\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u5bb9\u5668 # \u6ca1\u6709\u4f7f\u7528\u7aef\u53e3\u6620\u5c04\uff0c\u907f\u514d\u66b4\u9732\u6570\u636e\u5e93\u670d\u52a1\u7aef\u53e3\u5230\u5916\u90e8\u7f51\u7edc $ docker run -d --name mysqldb -e MYSQL_ROOT_PASSWORD = abcd1234 mysql # \u7136\u540e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684web\u5bb9\u5668\uff0c\u5e76\u5c06\u5b83\u8fde\u63a5\u5230db\u5bb9\u5668 # --link \u5bb9\u5668\u540d:\u522b\u540d $ docker run -d -P --name my_flask --link mysqldb:db jcdemo/flaskapp # \u53ef\u4ee5\u770b\u5230\u73b0\u5728web\u5bb9\u5668\u7684\u540d\u5b57\u591a\u4e86\u4e00\u4e2a\u503c\uff1amy_flask/db $ docker ps --no-trunc CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fb662a99332d4825e7bacfc914718b0d7097330efa10893232f1c7a16c0a5415 jcdemo/flaskapp \"python /src/app.py\" 8 minutes ago Up 8 minutes 0 .0.0.0:32770->5000/tcp my_flask aae4ae2138f76f945a042157755d6f1fc4f30d1b884b98902270d9d6826a2e7f mysql \"docker-entrypoint.sh mysqld\" 21 minutes ago Up 21 minutes 3306 /tcp, 33060 /tcp my_flask/db,mysqldb Docker \u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u4e3a\u5bb9\u5668\u516c\u5f00\u8fde\u63a5\u4fe1\u606f\uff1a \u66f4\u65b0\u73af\u5883\u53d8\u91cf\uff1b \u66f4\u65b0 /etc/hosts \u6587\u4ef6\u3002 \u4f7f\u7528 env \u547d\u4ee4\u6765\u67e5\u770b web \u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\uff1a $ docker run --rm -P --name my_registry2 --link mysqldb:db daocloud.io/registry env DB_PORT_33060_TCP_ADDR = 172 .17.0.3 HOSTNAME = 901607172aa7 DB_PORT = tcp://172.17.0.3:3306 DB_PORT_3306_TCP = tcp://172.17.0.3:3306 DB_PORT_33060_TCP_PORT = 33060 DB_ENV_MYSQL_VERSION = 8 .0.16-2debian9 SHLVL = 1 DB_PORT_33060_TCP_PROTO = tcp HOME = /root DB_NAME = /my_registry2/db DB_PORT_33060_TCP = tcp://172.17.0.3:33060 PATH = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin DB_ENV_MYSQL_MAJOR = 8 .0 DB_PORT_3306_TCP_ADDR = 172 .17.0.3 DB_ENV_MYSQL_ROOT_PASSWORD = abcd1234 PWD = / DB_ENV_GOSU_VERSION = 1 .7 DB_PORT_3306_TCP_PORT = 3306 DB_PORT_3306_TCP_PROTO = tcp \u5176\u4e2d DB_ \u5f00\u5934\u7684\u73af\u5883\u53d8\u91cf\u662f\u4f9bweb\u5bb9\u5668\u8fde\u63a5db\u5bb9\u5668\u4f7f\u7528\u3001\u524d\u7f00\u91c7\u7528\u5927\u5199\u7684\u8fde\u63a5\u522b\u540d\u3002 \u9664\u4e86\u73af\u5883\u53d8\u91cf\uff0c Docker \u8fd8\u6dfb\u52a0 host\u4fe1\u606f\u5230\u7236\u5bb9\u5668\u7684 /etc/hosts \u7684\u6587\u4ef6\uff1a $ docker run --rm -P -it --name my_centos2 --link mysqldb:db changedcentos /bin/bash # \u5176\u5b9e\u4e5f\u53ef\u4ee5\u5728\u8fd9\u91cc\u6267\u884cenv\u67e5\u770b\u73af\u5883\u53d8\u91cf [ root@7881bcf7a164 / ] # cat /etc/hosts 127 .0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 172 .17.0.3 db aae4ae2138f7 mysqldb 172 .17.0.5 7881bcf7a164 # \u8fd8\u53ef\u4ee5\u53bbping\u5bb9\u5668 [ root@7881bcf7a164 / ] # ping db PING db ( 172 .17.0.3 ) 56 ( 84 ) bytes of data. 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 1 ttl = 64 time = 0 .258 ms 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 2 ttl = 64 time = 0 .114 ms 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 3 ttl = 64 time = 0 .125 ms \u7528\u6237\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2a\u5b50\u5bb9\u5668\u5230\u7236\u5bb9\u5668\uff0c\u6bd4\u5982\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2aweb\u5230\u540c\u4e00\u4e2adb\u5bb9\u5668\u4e0a\u3002","title":"10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#1","text":"","title":"1. \u7aef\u53e3\u6620\u5c04\u5b9e\u73b0\u5bb9\u5668\u8bbf\u95ee"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#11","text":"\u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5bf9\u5e94\u53c2\u6570\uff0c\u5728\u5bb9\u5668\u5916\u90e8\u662f\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u6765\u8bbf\u95ee\u5bb9\u5668\u5185\u7684\u7f51\u7edc\u5e94\u7528\u548c\u670d\u52a1\u7684\u3002 \u8981\u8ba9\u5916\u90e8\u8bbf\u95ee\u8fd9\u4e9b\u5e94\u7528\u65f6\uff0c \u53ef\u4ee5\u901a\u8fc7-P\u6216-p\u53c2\u6570\u6765\u6307\u5b9a\u7aef\u53e3\u6620\u5c04\u3002 \u5f53\u4f7f\u7528 -P \uff08\u5927\u5199\u7684\uff09\u6807\u8bb0\u65f6\uff0c Docker \u4f1a\u968f\u673a\u6620\u5c04\u4e00\u4e2a 49000~49900 \u7684\u7aef\u53e3\u5230\u5185\u90e8\u5bb9\u5668\u5f00\u653e\u7684\u7f51\u7edc\u7aef\u53e3\u3002\u7136\u540e\u4f7f\u7528 docker port CONTAINER \u67e5\u770b\u7aef\u53e3\u3002 $ docker run -P -itd --name test_mount changedcentos:latest /bin/bash $ docker port test_mount -p (\u5c0f\u5199\u7684\uff09\u5219\u53ef\u4ee5\u6307\u5b9a\u8981\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u5e76\u4e14\uff0c\u5728\u4e00\u4e2a\u6307\u5b9a\u7aef\u53e3\u4e0a\u53ea\u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a\u5bb9\u5668\u3002\u652f\u6301\u7684\u683c\u5f0f\u6709 IP:HostPort:ContainerPort \u6216 IP::ContainerPort \u6216 HostPort:ContainerPort \u3002","title":"1.1 \u4ece\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668\u5e94\u7528"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#12","text":"IP:HostPort:ContainerPort \u6307\u5b9a\u6620\u5c04\u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u7684\u5730\u5740\uff1a docker run - d - p 127 . 0 . 0 . 1 : 5000 : 5000 training / webapp python app . py","title":"1.2 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u6307\u5b9a\u7aef\u53e3"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#13","text":"IP::ContainerPort \u7ed1\u5b9a\u4e00\u4e2a\u7aef\u53e3\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u672c\u5730\u4e3b\u673a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a\u7aef\u53e3\uff1a docker run - d - p 127 . 0 . 0 . 1 :: 5000 training / webapp python app . py","title":"1.3 \u6620\u5c04\u5230\u6307\u5b9a\u5730\u5740\u7684\u968f\u673a\u7aef\u53e3"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#14","text":"HostPort:ContainerPort \u5c06\u672c\u5730\u6240\u6709\u63a5\u53e3\u4e0a\u7684\u6240\u6709\u5730\u5740\u7684\u7279\u5b9a\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a docker run - d - p 5000 : 5000 webapp python app . py \u591a\u6b21\u4f7f\u7528 -p \u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u7aef\u53e3\uff1a docker run - d - p 5000 : 5000 - p 3000 : 80 training / webapp python app . py Note \u5bb9\u5668\u6709\u81ea\u5df1\u7684\u5185\u90e8\u7f51\u7edc\u548cIP\u5730\u5740\uff0c\u4f7f\u7528 docker [container) inspect\uff0b\u5bb9\u5668ID \u53ef\u4ee5\u83b7\u53d6\u5bb9\u5668\u7684\u5177\u4f53\u4fe1\u606f\u3002","title":"1.4 \u6620\u5c04\u6240\u6709\u63a5\u53e3\u5730\u5740"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#2","text":"\u5bb9\u5668\u7684 \u4e92\u8054(Iinking) \u662f\u4e00\u79cd\u8ba9\u591a\u4e2a\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u8fdb\u884c\u5feb\u901f\u4ea4\u4e92\u7684\u65b9\u5f0f\u3002\u5b83\u4f1a\u5728\u6e90\u548c\u63a5\u6536\u5bb9\u5668\u4e4b\u95f4\u521b\u5efa\u8fde\u63a5\u5173\u7cfb\uff0c\u63a5\u6536\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668\u540d\u5feb\u901f\u8bbf\u95ee\u5230\u6e90\u5bb9\u5668\uff0c\u800c\u4e0d\u7528\u6307\u5b9a\u5177\u4f53\u7684IP\u5730\u5740\u3002 \u5728\u6267\u884cdocker [container] run\u7684\u65f6\u5019\u5982\u679c\u6dfb\u52a0 --rm \u6807\u8bb0\uff0c\u5219\u5bb9\u5668\u5728\u7ec8\u6b62\u540e\u4f1a\u7acb\u523b\u5220\u9664\u3002 \u6ce8\u610f\uff0c--rm \u548c -d \u53c2\u6570\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002","title":"2. \u4e92\u8054\u673a\u5236\u5b9e\u73b0\u4fbf\u6377\u4e92\u8bbf"},{"location":"docker/10 \u7aef\u53e3\u6620\u5c04\u4e0e\u5bb9\u5668\u4e92\u8054/#21","text":"\u4f7f\u7528 --link \u53c2\u6570\u53ef\u4ee5\u8ba9\u5bb9\u5668\u4e4b\u95f4\u5b89\u5168\u5730\u8fdb\u884c\u4ea4\u4e92\u3002 # \u5148\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u5bb9\u5668 # \u6ca1\u6709\u4f7f\u7528\u7aef\u53e3\u6620\u5c04\uff0c\u907f\u514d\u66b4\u9732\u6570\u636e\u5e93\u670d\u52a1\u7aef\u53e3\u5230\u5916\u90e8\u7f51\u7edc $ docker run -d --name mysqldb -e MYSQL_ROOT_PASSWORD = abcd1234 mysql # \u7136\u540e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684web\u5bb9\u5668\uff0c\u5e76\u5c06\u5b83\u8fde\u63a5\u5230db\u5bb9\u5668 # --link \u5bb9\u5668\u540d:\u522b\u540d $ docker run -d -P --name my_flask --link mysqldb:db jcdemo/flaskapp # \u53ef\u4ee5\u770b\u5230\u73b0\u5728web\u5bb9\u5668\u7684\u540d\u5b57\u591a\u4e86\u4e00\u4e2a\u503c\uff1amy_flask/db $ docker ps --no-trunc CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fb662a99332d4825e7bacfc914718b0d7097330efa10893232f1c7a16c0a5415 jcdemo/flaskapp \"python /src/app.py\" 8 minutes ago Up 8 minutes 0 .0.0.0:32770->5000/tcp my_flask aae4ae2138f76f945a042157755d6f1fc4f30d1b884b98902270d9d6826a2e7f mysql \"docker-entrypoint.sh mysqld\" 21 minutes ago Up 21 minutes 3306 /tcp, 33060 /tcp my_flask/db,mysqldb Docker \u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u4e3a\u5bb9\u5668\u516c\u5f00\u8fde\u63a5\u4fe1\u606f\uff1a \u66f4\u65b0\u73af\u5883\u53d8\u91cf\uff1b \u66f4\u65b0 /etc/hosts \u6587\u4ef6\u3002 \u4f7f\u7528 env \u547d\u4ee4\u6765\u67e5\u770b web \u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\uff1a $ docker run --rm -P --name my_registry2 --link mysqldb:db daocloud.io/registry env DB_PORT_33060_TCP_ADDR = 172 .17.0.3 HOSTNAME = 901607172aa7 DB_PORT = tcp://172.17.0.3:3306 DB_PORT_3306_TCP = tcp://172.17.0.3:3306 DB_PORT_33060_TCP_PORT = 33060 DB_ENV_MYSQL_VERSION = 8 .0.16-2debian9 SHLVL = 1 DB_PORT_33060_TCP_PROTO = tcp HOME = /root DB_NAME = /my_registry2/db DB_PORT_33060_TCP = tcp://172.17.0.3:33060 PATH = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin DB_ENV_MYSQL_MAJOR = 8 .0 DB_PORT_3306_TCP_ADDR = 172 .17.0.3 DB_ENV_MYSQL_ROOT_PASSWORD = abcd1234 PWD = / DB_ENV_GOSU_VERSION = 1 .7 DB_PORT_3306_TCP_PORT = 3306 DB_PORT_3306_TCP_PROTO = tcp \u5176\u4e2d DB_ \u5f00\u5934\u7684\u73af\u5883\u53d8\u91cf\u662f\u4f9bweb\u5bb9\u5668\u8fde\u63a5db\u5bb9\u5668\u4f7f\u7528\u3001\u524d\u7f00\u91c7\u7528\u5927\u5199\u7684\u8fde\u63a5\u522b\u540d\u3002 \u9664\u4e86\u73af\u5883\u53d8\u91cf\uff0c Docker \u8fd8\u6dfb\u52a0 host\u4fe1\u606f\u5230\u7236\u5bb9\u5668\u7684 /etc/hosts \u7684\u6587\u4ef6\uff1a $ docker run --rm -P -it --name my_centos2 --link mysqldb:db changedcentos /bin/bash # \u5176\u5b9e\u4e5f\u53ef\u4ee5\u5728\u8fd9\u91cc\u6267\u884cenv\u67e5\u770b\u73af\u5883\u53d8\u91cf [ root@7881bcf7a164 / ] # cat /etc/hosts 127 .0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 172 .17.0.3 db aae4ae2138f7 mysqldb 172 .17.0.5 7881bcf7a164 # \u8fd8\u53ef\u4ee5\u53bbping\u5bb9\u5668 [ root@7881bcf7a164 / ] # ping db PING db ( 172 .17.0.3 ) 56 ( 84 ) bytes of data. 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 1 ttl = 64 time = 0 .258 ms 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 2 ttl = 64 time = 0 .114 ms 64 bytes from db ( 172 .17.0.3 ) : icmp_seq = 3 ttl = 64 time = 0 .125 ms \u7528\u6237\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2a\u5b50\u5bb9\u5668\u5230\u7236\u5bb9\u5668\uff0c\u6bd4\u5982\u53ef\u4ee5\u94fe\u63a5\u591a\u4e2aweb\u5230\u540c\u4e00\u4e2adb\u5bb9\u5668\u4e0a\u3002","title":"2.1 \u5bb9\u5668\u4e92\u8054"},{"location":"docker/11. Dockerfile/","text":"\u4f7f\u7528 Dockerfile \u6765\u5feb\u901f\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u955c\u50cf\u3002 1. \u57fa\u672c\u7ed3\u6784 \u00b6 \u4e00\u822c\u800c\u8a00\uff0c Dockerfile \u4e3b\u4f53\u5185\u5bb9\u5206\u4e3a\u56db\u90e8\u5206\uff1a\u57fa\u7840\u955c\u50cf\u4fe1\u606f\u3001 \u7ef4\u62a4\u8005\u4fe1\u606f\u3001 \u955c\u50cf\u64cd\u4f5c\u6307\u4ee4\u548c\u5bb9\u5668\u542f\u52a8\u65f6\u6267\u884c\u6307\u4ee4\u3002 # escape=\\ (backslash) # This dockerfile uses the ubuntu:xeniel image # VERSION 2 - EDITION 1 # Author: docker_user # Command format: Instruction [arguments / command] .. # Base image to use, this must be set as the first line FROM ubuntu:xeniel # Maintainer: docker_user <docker_user at email.com> (@docker_user) LABEL maintainer docker_user<docker_user@email.com> # Commands to update the image RUN echo \"deb http://archive.ubuntu.com/ubuntu/ xeniel main universe\" >> /etc/apt/sources.list RUN apt-get update && apt-get install -y nginx RUN echo \"\\ ndaernon off;\" >> /etc/nginx/nginx.conf # Commands when creating a new container CMD /usr/sbin/nginx \u9996\u884c\u53ef\u4ee5\u901a\u8fc7\u6ce8\u91ca\u6765\u6307\u5b9a\u89e3\u6790\u5668\u547d\u4ee4\uff0c \u540e\u7eed\u901a\u8fc7\u6ce8\u91ca\u8bf4\u660e\u955c\u50cf\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u4e3b\u4f53\u90e8\u5206\u9996\u5148\u4f7f\u7528FROM\u6307\u4ee4\u6307\u660e\u6240\u57fa\u4e8e\u7684\u955c\u50cf\u540d\u79f0\uff0c \u63a5\u4e0b\u6765\u4e00\u822c\u662f\u4f7f\u7528LABEL\u6307\u4ee4\u8bf4\u660e\u7ef4\u62a4\u8005\u4fe1\u606f\u3002\u540e\u9762\u5219\u662f\u955c\u50cf\u64cd\u4f5c\u6307\u4ee4\uff0c\u6bcf\u8fd0\u884c\u4e00\u6761RUN\u6307\u4ee4\uff0c\u955c\u50cf\u6dfb\u52a0\u65b0\u7684\u4e00\u5c42\uff0c \u5e76\u63d0\u4ea4\u3002 \u6700\u540e\u662fCMD\u6307\u4ee4\uff0c \u6765\u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u65f6\u7684\u64cd\u4f5c\u547d\u4ee4\u3002 2. \u6307\u4ee4\u8bf4\u660e \u00b6 Dockerfile \u4e2d\u6307\u4ee4\u7684\u4e00\u822c\u683c\u5f0f\u4e3a INSTRUCTION arguments 2.1 \u914d\u7f6e\u6307\u4ee4 \u00b6 2.1.1 ARG \u00b6 \u5b9a\u4e49\u521b\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u53d8\u91cf\u3002 ARG <name> [= <default value> ] \u5728 docker build \u65f6\u53ef\u4ee5\u901a\u8fc7 --build-arg \u4e3a\u53d8\u91cf\u8d4b\u503c\uff1a docker build --build-arg user=what_user . \u5f53\u955c\u50cf\u7f16\u8bd1\u6210\u529f\u540e\uff0c ARG \u6307\u5b9a\u7684\u53d8\u91cf\u5c06\u4e0d\u518d\u5b58\u5728 (ENV \u6307\u5b9a\u7684\u53d8\u91cf\u5c06\u5728\u955c\u50cf\u4e2d\u4fdd\u7559\uff09\u3002 Docker \u5185\u7f6e\u4e86\u4e00\u4e9b\u955c\u50cf\u521b\u5efa\u53d8\u91cf\uff0c \u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u800c\u65e0\u987b\u58f0\u660e\uff0c \u5305\u62ec\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09\uff1a HTTP_PROXY HTTPS_PROXY FTP_PROXY NO_PROXY 2.1.2 FROM \u00b6 \u6307\u5b9a\u6240\u521b\u5efa\u955c\u50cf\u7684\u57fa\u7840\u955c\u50cf\u3002 FROM < image > [ AS < name > ] FROM < image > [: < tag > ] [ AS < name > ] FROM < image > [ @< digest > ] [ AS < name > ] \u4efb\u4f55 Dockerfile \u4e2d\u7b2c\u4e00\u6761\u6307\u4ee4\u5fc5\u987b\u4e3a FROM \u6307\u4ee4\u3002 \u5e76\u4e14\uff0c \u5982\u679c\u5728\u540c\u4e00\u4e2a Dockerfile \u4e2d\u521b\u5efa\u591a\u4e2a\u955c\u50cf\u65f6\uff0c \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a FROM \u6307\u4ee4\uff08\u6bcf\u4e2a\u955c\u50cf\u4e00\u6b21\uff09\u3002 ARG\u662fDockerfile\u4e2d\u552f\u4e00\u53ef\u4ee5\u5728FROM\u4e4b\u524d\u7684\u6307\u4ee4\u3002 FROM\u53ef\u4ee5\u5728\u5355\u4e2aDockerfile\u4e2d\u591a\u6b21\u51fa\u73b0\u4ee5\u521b\u5efa\u591a\u4e2a\u6620\u50cf\uff0c\u6216\u8005\u4f7f\u7528\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u7684\u4f9d\u8d56\u9879\u3002\u53ea\u9700\u5728\u6bcf\u4e2a\u65b0\u7684FROM\u6307\u4ee4\u4e4b\u524d\u8bb0\u4e0b\u63d0\u4ea4\u8f93\u51fa\u7684\u6700\u540e\u4e00\u4e2a\u955c\u50cfID\u3002\u6bcf\u4e2aFROM\u6307\u4ee4\u6e05\u9664\u5148\u524d\u6307\u4ee4\u521b\u5efa\u7684\u4efb\u4f55\u72b6\u6001\u3002 \u53ef\u4ee5\u5728\u540e\u7eed\u7684FROM\u548c COPY --from = <name | index> \u6307\u4ee4\u4e2d\u4f7f\u7528\uff0c\u4ee5\u5f15\u7528\u6b64\u9636\u6bb5\u6784\u5efa\u7684\u955c\u50cf\u3002 FROM\u6307\u4ee4\u652f\u6301\u5728\u7b2c\u4e00\u4e2aFROM\u4e4b\u524d\u53d1\u751f\u7684\u4efb\u4f55ARG\u6307\u4ee4\u58f0\u660e\u7684\u53d8\u91cf\uff1a ARG CODE_VERSION = latest FROM base:${CODE_VERSION} CMD /code/run-app FROM extras:${CODE_VERSION} CMD /code/run-extras \u5728FROM\u4e4b\u524d\u58f0\u660e\u7684ARG \u5728\u6784\u5efa\u9636\u6bb5\u4e4b\u5916 \uff0c\u56e0\u6b64\u5728FROM\u4e4b\u540e\u7684\u4efb\u4f55\u6307\u4ee4\u4e2d\u90fd\u4e0d\u80fd\u4f7f\u7528\u5b83\u3002\u8981\u4f7f\u7528\u5728\u7b2c\u4e00\u4e2aFROM\u4e4b\u524d\u58f0\u660e\u7684ARG\u7684\u9ed8\u8ba4\u503c\uff0c\u8bf7\u4f7f\u7528\u6784\u5efa\u9636\u6bb5\u5185\u6ca1\u6709\u503c\u7684ARG\u6307\u4ee4\uff1a ARG VERSION = latest FROM busybox:$VERSION ARG VERSION RUN echo $VERSION > image_version 2.1.3 LABEL \u00b6 \u4e3a\u751f\u6210\u7684\u955c\u50cf\u6dfb\u52a0\u5143\u6570\u636e\u6807\u7b7e\u4fe1\u606f\uff0c \u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u7528\u6765\u8f85\u52a9\u8fc7\u6ee4\u51fa\u7279\u5b9a\u955c\u50cf\u3002 LABEL <key> = <value> <key> = <value> <key> = <value> ... LABEL \"com.example.vendor\" = \"ACME Incorporated\" LABEL com . example . label - with - value = \"foo\" LABEL version = \"1.0\" LABEL description = \"This text illustrates \\ that label-values can span multiple lines.\" 2.1.4 EXPOSE \u00b6 \u58f0\u660e\u955c\u50cf\u5185\u670d\u52a1\u76d1\u542c\u7684\u7aef\u53e3\u3002 EXPOSE <port> [<port>/<protocol>...] \u6ce8\u610f\u8be5\u6307\u4ee4\u53ea\u662f\u8d77\u5230\u58f0\u660e\u4f5c\u7528\uff0c \u5e76\u4e0d\u4f1a\u81ea\u52a8\u5b8c\u6210\u7aef\u53e3\u6620\u5c04\u3002 EXPOSE 80/tcp EXPOSE 80/udp 2.1.5 ENV \u00b6 \u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c \u5728\u955c\u50cf\u751f\u6210\u8fc7\u7a0b\u4e2d\u4f1a\u88ab\u540e\u7eedRUN\u6307\u4ee4\u4f7f\u7528\uff0c \u5728\u955c\u50cf\u542f\u52a8\u7684\u5bb9\u5668\u4e2d\u4e5f\u4f1a\u5b58\u5728\u3002 ENV <key> <value> ENV <key> = <value> ... \u6307\u4ee4\u6307\u5b9a\u7684\u73af\u5883\u53d8\u91cf\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u88ab\u8986\u76d6\u6389\uff1a docker run --env <key> = <value> built_image \u6ce8\u610f \uff1a\u5f53\u4e00\u6761 ENV \u6307\u4ee4\u4e2d\u540c\u65f6\u4e3a\u591a\u4e2a\u73af\u5883\u53d8\u91cf\u8d4b\u503c\u5e76\u4e14\u503c\u4e5f \u662f\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u65f6\uff0c \u4f1a\u4e3a\u53d8\u91cf\u90fd\u8d4b\u503c\u540e\u518d\u66f4\u65b0 \u3002 \u5982\u4e0b\u9762\u7684\u6307\u4ee4\uff0c \u6700\u7ec8\u7ed3\u679c\u4e3a keyl=valuel key2=value2: ENV key1 = value2 ENV key1 = value1 key2 = ${ key1 } 2.1.6 ENTRYPOINT \u00b6 \u6307\u5b9a\u955c\u50cf\u7684\u9ed8\u8ba4\u5165\u53e3\u547d\u4ee4\uff0c \u8be5\u5165\u53e3\u547d\u4ee4\u4f1a\u5728\u542f\u52a8\u5bb9\u5668\u65f6\u4f5c\u4e3a\u6839\u547d\u4ee4\u6267\u884c\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u5185\u5bb9\u542f\u52a8nginx\uff0c\u5e76\u76d1\u542c80\u7aef\u53e3\uff1a docker run - i - t --rm -p 80:80 nginx \u6709\u4e24\u79cd\u683c\u5f0f\uff1a ENTRYPOINT [\"executable\", \"param1\", \"param2\"] ( exec \u683c\u5f0f\uff0c\u9996\u9009) ENTRYPOINT command param1 param2 ( shell \u683c\u5f0f) \u6bcf\u4e2a Dockerfile \u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a ENTRYPOINT, \u5f53\u6307\u5b9a\u591a\u4e2a\u65f6\uff0c \u53ea\u6709 \u6700\u540e\u4e00\u4e2a\u8d77\u6548 \u3002 2.1.6.1 exec \u683c\u5f0f \u00b6 \u6b64\u65f6\uff0c\u540e\u8ddf\u7684 CMD \u6307\u4ee4\u6307\u5b9a\u503c\u5c06\u4f5c\u4e3a\u6839\u547d\u4ee4\u7684\u53c2\u6570\uff1b \u6240\u6709\u4f20\u5165\u503c\u4f5c\u4e3a\u8be5\u547d\u4ee4\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u4f1a\u8986\u76d6\u6389\u6240\u6709\u4f7f\u7528CMD\u6307\u4ee4\u6307\u5b9a\u7684\u53c2\u6570\u3002 \u4f8b\u5982\uff0c docker run <image> -d \u4f1a\u4f20\u9012 -d \u53c2\u6570\u7ed9 ENTRYPOINT \u3002\u53ef\u4ee5\u4f7f\u7528 docker run --entrypoint \u8986\u76d6ENTRYPOINT\u6307\u4ee4\uff08\u4e0d\u80fd\u4f7f\u7528 sh -c \uff09\u3002 2.1.6.2 shell \u683c\u5f0f \u00b6 \u8be5\u683c\u5f0f\u5c06\u9632\u6b62\u4f7f\u7528\u4efb\u4f55 CMD \u6216 run \u547d\u4ee4\u884c\u53c2\u6570\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u7f3a\u70b9\uff1a\u4f60\u7684 ENTRYPOINT \u6307\u4ee4\u4f1a\u88ab\u4f5c\u4e3a /bin/sh -c \u7684\u5b50\u547d\u4ee4\u542f\u52a8\uff0c\u4e0d\u80fd\u4f20\u9012\u4fe1\u53f7\uff08 signal \uff09\u3002\u8fd9\u610f\u5473\u7740\u53ef\u6267\u884c\u7a0b\u5e8f\u4e0d\u4f1a\u662f\u5bb9\u5668\u7684 PID 1 \u5e76\u4e14\u4e0d\u80fd\u63a5\u6536\u5230 Unix signals \uff0c\u6240\u4ee5\u4f60\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u4e0d\u80fd\u63a5\u6536\u5230\u4ece docker stop <container> \u53d1\u51fa\u7684 SIGTERM \u3002 2.1.6.3 exec\u683c\u5f0fENTRYPOINT\u4e3e\u4f8b \u00b6 \u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u683c\u5f0f\u8bbe\u7f6e\u56fa\u5b9a\u7684\u9ed8\u8ba4\u547d\u4ee4\u548c\u53c2\u6570\uff0c\u7136\u540e\u4f7f\u7528\u4efb\u4e00\u683c\u5f0f\u7684 CMD \u8bbe\u7f6e\u66f4\u6539\u5176\u5b83\u53ef\u53d8\u7684\u9ed8\u8ba4\u503c\u3002 \u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\u662f top -b -c \uff1a FROM ubuntu ENTRYPOINT [ \"top\" , \"-b\" ] CMD [ \"-c\" ] \u6b64\u65f6\u6267\u884c\u7684\u547d\u4ee4\u662f top -b -H \uff1a $ docker run -it --rm --name test top -H top - 08 :25:00 up 7 :27, 0 users, load average: 0 .00, 0 .01, 0 .05 Threads: 1 total, 1 running, 0 sleeping, 0 stopped, 0 zombie %Cpu ( s ) : 0 .1 us, 0 .1 sy, 0 .0 ni, 99 .7 id, 0 .0 wa, 0 .0 hi, 0 .0 si, 0 .0 st KiB Mem: 2056668 total, 1616832 used, 439836 free, 99352 buffers KiB Swap: 1441840 total, 0 used, 1441840 free. 1324440 cached Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 19744 2336 2080 R 0 .0 0 .1 0 :00.04 top \u4e0b\u9762\u7684Dockerfile\u5c55\u793a\u4e86\u4f7f\u7528ENTRYPOINT\u5728\u540e\u53f0\u8fd0\u884cApache\uff1a FROM debian:stable RUN apt-get update && apt-get install -y --force-yes apache2 EXPOSE 80 443 VOLUME [ \"/var/www\" , \"/var/log/apache2\" , \"/etc/apache2\" ] ENTRYPOINT [ \"/usr/sbin/apache2ctl\" , \"-D\" , \"FOREGROUND\" ] \u5982\u679c\u9700\u8981\u4e3a\u5355\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u7f16\u5199\u542f\u52a8\u811a\u672c,\u5219\u53ef\u4ee5\u4f7f\u7528 exec \u548c gosu \u547d\u4ee4\u786e\u4fdd\u6700\u7ec8\u53ef\u6267\u884c\u6587\u4ef6\u63a5\u6536 Unix \u4fe1\u53f7: #!/usr/bin/env bash set -e if [ \" $1 \" = 'postgres' ] ; then chown -R postgres \" $PGDATA \" if [ -z \" $( ls -A \" $PGDATA \" ) \" ] ; then gosu postgres initdb fi exec gosu postgres \" $@ \" fi exec \" $@ \" \u6700\u540e\uff0c\u5982\u679c\u60a8\u9700\u8981\u5728\u5173\u673a\u65f6\u8fdb\u884c\u4e00\u4e9b\u989d\u5916\u7684\u6e05\u7406\uff08\u6216\u4e0e\u5176\u4ed6\u5bb9\u5668\u901a\u4fe1\uff09\uff0c\u6216\u8005\u534f\u8c03\u591a\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u786e\u4fddENTRYPOINT\u811a\u672c\u63a5\u6536Unix\u4fe1\u53f7\uff0c\u4f20\u9012\u5b83\u4eec\uff0c\u7136\u540e\u505a\u4e86\u4e00\u4e9b\u5de5\u4f5c\uff1a #!/bin/sh # Note: I've written this using sh so it works in the busybox container too # USE the trap if you need to also do manual cleanup after the service is stopped, # or need to start multiple services in the one container trap \"echo TRAPed signal\" HUP INT QUIT TERM # start service in background here /usr/sbin/apachectl start echo \"[hit enter key to exit] or run 'docker stop <container>'\" read # stop service and clean up here echo \"stopping apache\" /usr/sbin/apachectl stop echo \"exited $0 \" Note exec \u683c\u5f0f\u88ab\u89e3\u6790\u4e3aJSON\u6570\u7ec4\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5fc5\u987b\u4f7f\u7528 \u53cc\u5f15\u53f7 \u5305\u56f4\u5355\u8bcd\u800c\u4e0d\u662f\u5355\u5f15\u53f7\u3002 Note exec \u683c\u5f0f\u4e0d\u4f1a\u8c03\u7528\u547d\u4ee4shell\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u4f1a\u6b63\u5e38\u5730\u6267\u884cshell\u3002\u4f8b\u5982\uff0c ENTRYPOINT [ \"echo\", \"$HOME\" ] \u4e0d\u4f1a\u505a\u53d8\u91cf\u66ff\u6362\u3002\u5982\u679c\u4f60\u60f3\u8981shell\u5904\u7406\uff0c\u90a3\u4e48\u4f7f\u7528 shell \u683c\u5f0f\u6216\u8005\u76f4\u63a5\u6267\u884cshell\uff1a ENTRYPOINT [ \"sh\", \"-c\", \"echo $HOME\" ] \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u662fshell\u505a\u4e86\u73af\u5883\u53d8\u91cf\u6269\u5c55\uff0c\u800c\u4e0d\u662fdocker\u3002 2.1.6.4 shell\u683c\u5f0fENTRYPOINT\u4e3e\u4f8b \u00b6 \u60a8\u53ef\u4ee5\u4e3a ENTRYPOINT \u6307\u5b9a\u4e00\u4e2a\u7eaf\u5b57\u7b26\u4e32\uff0c\u5b83\u5c06\u5728 /bin/sh -c \u4e2d\u6267\u884c\u3002\u6b64\u683c\u5f0f\u5c06\u4f7f\u7528shell\u5904\u7406\u66ff\u6362shell\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u4e14\u4f1a \u5ffd\u89c6 \u4efb\u4f55 CMD \u6307\u4ee4\u6216 docker run \u547d\u4ee4\u884c\u53c2\u6570\u3002 \u4e3a\u4e86\u786e\u4fdd docker stop \u80fd\u6b63\u786e\u5730\u5411 ENTRYPOINT \u53ef\u6267\u884c\u7a0b\u5e8f\u53d1\u51fa\u4fe1\u53f7\uff0c \u8981\u7262\u8bb0\u4f7f\u7528 exec \u6267\u884c\u547d\u4ee4 \uff1a FROM ubuntu ENTRYPOINT exec top -b \u5f53\u4f60\u8fd0\u884c\u8fd9\u4e2a\u955c\u50cf\u65f6\uff0c\u53ef\u4ee5\u770b\u5230\u5355\u4e2a PID \u8fdb\u7a0b \uff1a $ docker run -it --rm --name test top Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached CPU: 5 % usr 0 % sys 0 % nic 94 % idle 0 % io 0 % irq 0 % sirq Load average: 0 .08 0 .03 0 .05 2 /98 6 PID PPID USER STAT VSZ %VSZ %CPU COMMAND 1 0 root R 3164 0 % 0 % top -b \u6ce8\u610f \uff1a\u5982\u679c\u4ece\u57fa\u7840\u955c\u50cf\u5b9a\u4e49CMD\uff0c\u5219\u8bbe\u7f6eENTRYPOINT\u4f1a\u5c06CMD\u91cd\u7f6e\u4e3a\u7a7a\u503c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u5728\u5f53\u524d\u955c\u50cf\u4e2d\u5b9a\u4e49CMD\u624d\u80fd\u83b7\u5f97\u503c\u3002 2.1.7 VOLUME \u00b6 \u521b\u5efa\u6570\u636e\u5377\u6302\u8f7d\u70b9\uff0c\u5e76\u5c06\u5176\u6807\u8bb0\u4e3a\u4ece\u672c\u5730\u4e3b\u673a\u6216\u5176\u4ed6\u5bb9\u5668\u4fdd\u5b58\u5916\u90e8\u6302\u8f7d\u7684\u5377\u3002json\u6570\u7ec4\u3002\u8fd0\u884c\u5bb9\u5668\u65f6\u53ef\u4ee5\u4ece\u672c\u5730\u4e3b\u673a\u6216\u5176\u4ed6\u5bb9\u5668\u6302\u8f7d\u6570\u636e\u5377\uff0c \u4e00\u822c\u7528\u6765\u5b58\u653e\u6570\u636e\u5e93\u548c\u9700\u8981\u4fdd\u6301\u7684\u6570\u636e\u7b49\u3002 VOLUME [ \"/data\" ] \u4eceDockerfile\u4e2d\u66f4\u6539\u5377\uff1a\u5982\u679c\u4efb\u4f55\u6784\u5efa\u6b65\u9aa4\u5728\u58f0\u660e\u540e\u66f4\u6539\u5377\u5185\u7684\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u4e9b\u66f4\u6539\u5c06\u88ab\u4e22\u5f03\u3002 2.1.8 USER \u00b6 \u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u65f6\u7684\u7528\u6237\u540d\u6216UID, \u540e\u7eed\u7684RUN\u3001CMD\u3001 ENTRYPOINT\u6307\u4ee4\u4e5f\u4f1a\u4f7f\u7528\u6307\u5b9a\u7684\u7528\u6237\u8eab\u4efd\u3002 USER <user>[:<group>] or USER <UID>[:<GID>] \u5f53\u670d\u52a1\u4e0d\u9700\u8981\u7ba1 \u7406\u5458\u6743\u9650\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u547d\u4ee4\u6307\u5b9a\u8fd0\u884c\u7528\u6237\uff0c \u5e76\u4e14\u53ef\u4ee5\u5728 Dockerfile \u5efa\u6240\u9700\u8981\u7684\u7528\u6237\u3002 2.1.9 WORKDIR \u00b6 \u4e3a\u540e\u7eed\u7684 RUN\u3001CMD\u3001 ENTRYPOINT\u3001COPY\u3001 ADD\u6307\u4ee4\u914d\u7f6e\u5de5\u4f5c\u76ee\u5f55\u3002 WORKDIR /path/to/workdir \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a WORKDIR \u4ee4\uff0c\u540e\u7eed\u547d\u4ee4\u5982\u679c\u53c2\u6570\u662f\u76f8\u5bf9\u8def\u5f84\uff0c \u4f1a\u57fa\u4e8e\u4e4b\u524d\u547d\u4ee4\u6307\u5b9a\u7684\u8def\u5f84 \uff1a WORKDIR /a WORKDIR b WORKDIR c RUN pwd \u7ed3\u679c\u662f /a/b/c \u3002 \u53ea\u80fd\u4f7f\u7528Dockerfile\u4e2d\u663e\u5f0f\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff08\u5373\u53ea\u80fd\u4f7f\u7528\u5148\u524d\u5728 ENV \u4e2d\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\uff09\uff1a ENV DIRPATH /path WORKDIR $DIRPATH/$DIRNAME RUN pwd \u7ed3\u679c\u662f /path/$DIRNAME \u3002 2.1.10 ONBUILD \u00b6 \u6307\u5b9a\u5f53\u57fa\u4e8e\u5f53\u524dDockerfile\u751f\u6210\u7684\u955c\u50cf\u521b\u5efa\u5b50\u955c\u50cf\u65f6\uff0c\u9996\u5148\u81ea\u52a8\u6267\u884c\u7684\u64cd\u4f5c\u6307\u4ee4\u3002 ONBUILD [ INSTRUCTION ] \u4f8b\u5982\uff0c\u4f7f\u7528\u5982\u4e0b\u7684 Dockerfile \u521b\u5efa\u7236\u955c\u50cf ParentImag \uff0c\u6307\u5b9a ONBUILD\u6307\u4ee4\uff1a # Dockerfile for Parentimage [ ... ] ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src [ ... ] \u4f7f\u7528 docker build \u547d\u4ee4\u521b\u5efa\u5b50\u955c\u50cf childImage \u65f6\uff08 FROM Parentimage \uff09\uff0c\u4f1a\u9996\u5148\u6267\u884c Parentimage \u914d\u7f6e\u7684 ONBUILD \u6307\u4ee4\uff1a # Dockerfile for Chi ldimage FROM Parentimage \u7b49\u4ef7\u4e8e\u5728 Childimage Dockerfi \u4e2d\u6dfb\u52a0\u4e86\u5982\u4e0b\u6307\u4ee4\uff1a #Automatically run the following when building Ch ldimage ADD . /app/src RUN /usr/local/bin/python-build --dir /app/src \u8be5\u6307\u4ee4\u5728\u521b\u5efa\u4e13\u95e8\u7528\u4e8e\u81ea\u52a8\u7f16\u8bd1\u3001\u68c0\u67e5\u7b49\u64cd\u4f5c\u7684\u57fa\u7840\u955c\u50cf\u65f6\uff0c\u5341\u5206\u6709\u7528\u3002 \u7531\u4e8e ONBUILD \u6307\u4ee4\u662f\u9690\u5f0f\u6267\u884c\u7684\uff0c\u63a8\u8350\u5728\u4f7f\u7528\u5b83\u7684\u955c\u50cf\u6807 \u7b7e\u4e2d\u8fdb\u884c\u6807\u6ce8\uff0c \u4f8b\u5982 ruby:2.l-onbuild\u3002 2.1.11 STOPSIGNAL \u00b6 \u6307\u5b9a\u6240\u521b\u5efa\u955c\u50cf\u542f\u52a8\u7684\u5bb9\u5668\u63a5\u6536\u9000\u51fa\u7684\u4fe1\u53f7\u503c\u3002 STOPSIGNAL signal 2.1.12 HEALTHCHECK \u00b6 \u914d\u7f6e\u6240\u542f\u52a8\u5bb9\u5668\u5982\u4f55\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\uff08\u5982 \u5224\u65ad\u5065\u5eb7\u4e0e\u5426\uff09\u3002 \u6709\u4e24\u79cd\u683c\u5f0f\uff1a HEALTHCHECK [OPTIONS] CMD command (check container health by running a command inside the container) HEALTHCHECK NONE (\u7981\u6b62\u57fa\u7840\u955c\u50cf\u4e2d\u7684\u5065\u5eb7\u68c0\u67e5) OPTIONS \u7684\u503c\uff1a --interval=DURATION (default: 30s )\uff1a\u8ddd\u4e0a\u4e00\u4e2a\u68c0\u67e5\u5b8c\u6210\u540e\u591a\u4e45\u68c0\u67e5\u4e00\u6b21\u3002 --timeout=DURATION (default: 30s )\uff1a\u68c0\u67e5\u7ed3\u679c\u7684\u8d85\u65f6\u65f6\u95f4\u3002 --start-period=DURATION (default: 0s )\uff1a\u4e3a\u9700\u8981\u65f6\u95f4\u5f15\u5bfc\u7684\u5bb9\u5668\u63d0\u4f9b\u521d\u59cb\u5316\u65f6\u95f4\u3002\u5728\u6b64\u671f\u95f4\u63a2\u6d4b\u5931\u8d25\u5c06\u4e0d\u8ba1\u5165\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002\u4f46\u662f\uff0c\u5982\u679c\u5065\u5eb7\u68c0\u67e5\u5728\u5f00\u59cb\u671f\u95f4\u6210\u529f\uff0c\u5bb9\u5668\u88ab\u89c6\u4e3a\u5df2\u542f\u52a8\uff0c\u6240\u6709\u8fde\u7eed\u5931\u8d25\u5c06\u8ba1\u5165\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002 --retries=N (default: 3 )\uff1a\u5982\u679c\u5931\u8d25\u4e86\uff0c\u91cd\u8bd5\u51e0\u6b21\u624d\u6700\u7ec8\u786e\u5b9a\u5931\u8d25\u3002 command\u53ef\u4ee5\u662fshell\u547d\u4ee4\u6216 exec \u6570\u7ec4\u3002 \u68c0\u67e5\u7ed3\u679c\uff1a 0: success - the container is healthy and ready for use 1: unhealthy - the container is not working correctly 2: reserved - do not use this exit code\u3002\u4fdd\u7559\u5b57\u3002 2.1.13 SHELL \u00b6 \u6307\u5b9a\u5176\u4ed6\u6307\u4ee4\u4f7f\u7528 shell \u65f6\u7684\u9ed8\u8ba4 shell \u7c7b\u578b\u3002 SHELL [ \"executable\" , \"parameters\" ] linux\u7684\u9ed8\u8ba4\u503c\u662f [\"/bin/sh\", \"-c\"] \uff1bWindows\u7684\u9ed8\u8ba4\u503c\u662f [\"cmd\", \"/S\", \"/C\"] \u3002 \u6ce8\u610f \uff1a\u5bf9\u4e8e Windows \u7cfb\u7edf\uff0cshell\u8def\u5f84\u4e2d\u4f7f\u7528\u4e86\u201c\uff3c\u201d\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u5efa\u8bae\u5728 Dockerfile \u5f00\u5934\u6dfb\u52a0 # escape=' \u6765\u6307\u5b9a\u8f6c\u4e49\u7b26\u3002 2.2 \u64cd\u4f5c\u6307\u4ee4 \u00b6 2.2.1 RUN \u00b6 \u8fd0\u884c\u6307\u5b9a\u547d\u4ee4\u3002 \u4e24\u79cd\u683c\u5f0f\uff1a RUN <command> ( shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows) RUN [\"executable\", \"param1\", \"param2\"] ( exec form\uff0c\u4e0d\u4f1a\u542f\u52a8shell\u73af\u5883) \u6bcf\u6761 RUN \u6307\u4ee4\u5c06\u5728\u5f53\u524d\u955c\u50cf\u57fa\u7840\u4e0a\u6267\u884c\u6307\u5b9a\u547d\u4ee4\uff0c\u5e76 \u63d0\u4ea4\u4e3a\u65b0\u7684\u955c\u50cf\u5c42 \uff0c\u5f53\u547d\u4ee4\u8f83\u957f\u65f6\u53ef\u4ee5\u4f7f\u7528 \\ \u6765\u6362\u884c\u3002\u4f8b\uff1a RUN /bin/bash -c 'source $HOME/.bashrc; \\ echo $HOME'","title":"11. Dockerfile"},{"location":"docker/11. Dockerfile/#1","text":"\u4e00\u822c\u800c\u8a00\uff0c Dockerfile \u4e3b\u4f53\u5185\u5bb9\u5206\u4e3a\u56db\u90e8\u5206\uff1a\u57fa\u7840\u955c\u50cf\u4fe1\u606f\u3001 \u7ef4\u62a4\u8005\u4fe1\u606f\u3001 \u955c\u50cf\u64cd\u4f5c\u6307\u4ee4\u548c\u5bb9\u5668\u542f\u52a8\u65f6\u6267\u884c\u6307\u4ee4\u3002 # escape=\\ (backslash) # This dockerfile uses the ubuntu:xeniel image # VERSION 2 - EDITION 1 # Author: docker_user # Command format: Instruction [arguments / command] .. # Base image to use, this must be set as the first line FROM ubuntu:xeniel # Maintainer: docker_user <docker_user at email.com> (@docker_user) LABEL maintainer docker_user<docker_user@email.com> # Commands to update the image RUN echo \"deb http://archive.ubuntu.com/ubuntu/ xeniel main universe\" >> /etc/apt/sources.list RUN apt-get update && apt-get install -y nginx RUN echo \"\\ ndaernon off;\" >> /etc/nginx/nginx.conf # Commands when creating a new container CMD /usr/sbin/nginx \u9996\u884c\u53ef\u4ee5\u901a\u8fc7\u6ce8\u91ca\u6765\u6307\u5b9a\u89e3\u6790\u5668\u547d\u4ee4\uff0c \u540e\u7eed\u901a\u8fc7\u6ce8\u91ca\u8bf4\u660e\u955c\u50cf\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u4e3b\u4f53\u90e8\u5206\u9996\u5148\u4f7f\u7528FROM\u6307\u4ee4\u6307\u660e\u6240\u57fa\u4e8e\u7684\u955c\u50cf\u540d\u79f0\uff0c \u63a5\u4e0b\u6765\u4e00\u822c\u662f\u4f7f\u7528LABEL\u6307\u4ee4\u8bf4\u660e\u7ef4\u62a4\u8005\u4fe1\u606f\u3002\u540e\u9762\u5219\u662f\u955c\u50cf\u64cd\u4f5c\u6307\u4ee4\uff0c\u6bcf\u8fd0\u884c\u4e00\u6761RUN\u6307\u4ee4\uff0c\u955c\u50cf\u6dfb\u52a0\u65b0\u7684\u4e00\u5c42\uff0c \u5e76\u63d0\u4ea4\u3002 \u6700\u540e\u662fCMD\u6307\u4ee4\uff0c \u6765\u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u65f6\u7684\u64cd\u4f5c\u547d\u4ee4\u3002","title":"1. \u57fa\u672c\u7ed3\u6784"},{"location":"docker/11. Dockerfile/#2","text":"Dockerfile \u4e2d\u6307\u4ee4\u7684\u4e00\u822c\u683c\u5f0f\u4e3a INSTRUCTION arguments","title":"2. \u6307\u4ee4\u8bf4\u660e"},{"location":"docker/11. Dockerfile/#21","text":"","title":"2.1 \u914d\u7f6e\u6307\u4ee4"},{"location":"docker/11. Dockerfile/#211-arg","text":"\u5b9a\u4e49\u521b\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u53d8\u91cf\u3002 ARG <name> [= <default value> ] \u5728 docker build \u65f6\u53ef\u4ee5\u901a\u8fc7 --build-arg \u4e3a\u53d8\u91cf\u8d4b\u503c\uff1a docker build --build-arg user=what_user . \u5f53\u955c\u50cf\u7f16\u8bd1\u6210\u529f\u540e\uff0c ARG \u6307\u5b9a\u7684\u53d8\u91cf\u5c06\u4e0d\u518d\u5b58\u5728 (ENV \u6307\u5b9a\u7684\u53d8\u91cf\u5c06\u5728\u955c\u50cf\u4e2d\u4fdd\u7559\uff09\u3002 Docker \u5185\u7f6e\u4e86\u4e00\u4e9b\u955c\u50cf\u521b\u5efa\u53d8\u91cf\uff0c \u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u800c\u65e0\u987b\u58f0\u660e\uff0c \u5305\u62ec\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09\uff1a HTTP_PROXY HTTPS_PROXY FTP_PROXY NO_PROXY","title":"2.1.1 ARG"},{"location":"docker/11. Dockerfile/#212-from","text":"\u6307\u5b9a\u6240\u521b\u5efa\u955c\u50cf\u7684\u57fa\u7840\u955c\u50cf\u3002 FROM < image > [ AS < name > ] FROM < image > [: < tag > ] [ AS < name > ] FROM < image > [ @< digest > ] [ AS < name > ] \u4efb\u4f55 Dockerfile \u4e2d\u7b2c\u4e00\u6761\u6307\u4ee4\u5fc5\u987b\u4e3a FROM \u6307\u4ee4\u3002 \u5e76\u4e14\uff0c \u5982\u679c\u5728\u540c\u4e00\u4e2a Dockerfile \u4e2d\u521b\u5efa\u591a\u4e2a\u955c\u50cf\u65f6\uff0c \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a FROM \u6307\u4ee4\uff08\u6bcf\u4e2a\u955c\u50cf\u4e00\u6b21\uff09\u3002 ARG\u662fDockerfile\u4e2d\u552f\u4e00\u53ef\u4ee5\u5728FROM\u4e4b\u524d\u7684\u6307\u4ee4\u3002 FROM\u53ef\u4ee5\u5728\u5355\u4e2aDockerfile\u4e2d\u591a\u6b21\u51fa\u73b0\u4ee5\u521b\u5efa\u591a\u4e2a\u6620\u50cf\uff0c\u6216\u8005\u4f7f\u7528\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u6784\u5efa\u9636\u6bb5\u7684\u4f9d\u8d56\u9879\u3002\u53ea\u9700\u5728\u6bcf\u4e2a\u65b0\u7684FROM\u6307\u4ee4\u4e4b\u524d\u8bb0\u4e0b\u63d0\u4ea4\u8f93\u51fa\u7684\u6700\u540e\u4e00\u4e2a\u955c\u50cfID\u3002\u6bcf\u4e2aFROM\u6307\u4ee4\u6e05\u9664\u5148\u524d\u6307\u4ee4\u521b\u5efa\u7684\u4efb\u4f55\u72b6\u6001\u3002 \u53ef\u4ee5\u5728\u540e\u7eed\u7684FROM\u548c COPY --from = <name | index> \u6307\u4ee4\u4e2d\u4f7f\u7528\uff0c\u4ee5\u5f15\u7528\u6b64\u9636\u6bb5\u6784\u5efa\u7684\u955c\u50cf\u3002 FROM\u6307\u4ee4\u652f\u6301\u5728\u7b2c\u4e00\u4e2aFROM\u4e4b\u524d\u53d1\u751f\u7684\u4efb\u4f55ARG\u6307\u4ee4\u58f0\u660e\u7684\u53d8\u91cf\uff1a ARG CODE_VERSION = latest FROM base:${CODE_VERSION} CMD /code/run-app FROM extras:${CODE_VERSION} CMD /code/run-extras \u5728FROM\u4e4b\u524d\u58f0\u660e\u7684ARG \u5728\u6784\u5efa\u9636\u6bb5\u4e4b\u5916 \uff0c\u56e0\u6b64\u5728FROM\u4e4b\u540e\u7684\u4efb\u4f55\u6307\u4ee4\u4e2d\u90fd\u4e0d\u80fd\u4f7f\u7528\u5b83\u3002\u8981\u4f7f\u7528\u5728\u7b2c\u4e00\u4e2aFROM\u4e4b\u524d\u58f0\u660e\u7684ARG\u7684\u9ed8\u8ba4\u503c\uff0c\u8bf7\u4f7f\u7528\u6784\u5efa\u9636\u6bb5\u5185\u6ca1\u6709\u503c\u7684ARG\u6307\u4ee4\uff1a ARG VERSION = latest FROM busybox:$VERSION ARG VERSION RUN echo $VERSION > image_version","title":"2.1.2 FROM"},{"location":"docker/11. Dockerfile/#213-label","text":"\u4e3a\u751f\u6210\u7684\u955c\u50cf\u6dfb\u52a0\u5143\u6570\u636e\u6807\u7b7e\u4fe1\u606f\uff0c \u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u7528\u6765\u8f85\u52a9\u8fc7\u6ee4\u51fa\u7279\u5b9a\u955c\u50cf\u3002 LABEL <key> = <value> <key> = <value> <key> = <value> ... LABEL \"com.example.vendor\" = \"ACME Incorporated\" LABEL com . example . label - with - value = \"foo\" LABEL version = \"1.0\" LABEL description = \"This text illustrates \\ that label-values can span multiple lines.\"","title":"2.1.3 LABEL"},{"location":"docker/11. Dockerfile/#214-expose","text":"\u58f0\u660e\u955c\u50cf\u5185\u670d\u52a1\u76d1\u542c\u7684\u7aef\u53e3\u3002 EXPOSE <port> [<port>/<protocol>...] \u6ce8\u610f\u8be5\u6307\u4ee4\u53ea\u662f\u8d77\u5230\u58f0\u660e\u4f5c\u7528\uff0c \u5e76\u4e0d\u4f1a\u81ea\u52a8\u5b8c\u6210\u7aef\u53e3\u6620\u5c04\u3002 EXPOSE 80/tcp EXPOSE 80/udp","title":"2.1.4 EXPOSE"},{"location":"docker/11. Dockerfile/#215-env","text":"\u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c \u5728\u955c\u50cf\u751f\u6210\u8fc7\u7a0b\u4e2d\u4f1a\u88ab\u540e\u7eedRUN\u6307\u4ee4\u4f7f\u7528\uff0c \u5728\u955c\u50cf\u542f\u52a8\u7684\u5bb9\u5668\u4e2d\u4e5f\u4f1a\u5b58\u5728\u3002 ENV <key> <value> ENV <key> = <value> ... \u6307\u4ee4\u6307\u5b9a\u7684\u73af\u5883\u53d8\u91cf\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u88ab\u8986\u76d6\u6389\uff1a docker run --env <key> = <value> built_image \u6ce8\u610f \uff1a\u5f53\u4e00\u6761 ENV \u6307\u4ee4\u4e2d\u540c\u65f6\u4e3a\u591a\u4e2a\u73af\u5883\u53d8\u91cf\u8d4b\u503c\u5e76\u4e14\u503c\u4e5f \u662f\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u65f6\uff0c \u4f1a\u4e3a\u53d8\u91cf\u90fd\u8d4b\u503c\u540e\u518d\u66f4\u65b0 \u3002 \u5982\u4e0b\u9762\u7684\u6307\u4ee4\uff0c \u6700\u7ec8\u7ed3\u679c\u4e3a keyl=valuel key2=value2: ENV key1 = value2 ENV key1 = value1 key2 = ${ key1 }","title":"2.1.5 ENV"},{"location":"docker/11. Dockerfile/#216-entrypoint","text":"\u6307\u5b9a\u955c\u50cf\u7684\u9ed8\u8ba4\u5165\u53e3\u547d\u4ee4\uff0c \u8be5\u5165\u53e3\u547d\u4ee4\u4f1a\u5728\u542f\u52a8\u5bb9\u5668\u65f6\u4f5c\u4e3a\u6839\u547d\u4ee4\u6267\u884c\u3002 \u4f8b\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u5185\u5bb9\u542f\u52a8nginx\uff0c\u5e76\u76d1\u542c80\u7aef\u53e3\uff1a docker run - i - t --rm -p 80:80 nginx \u6709\u4e24\u79cd\u683c\u5f0f\uff1a ENTRYPOINT [\"executable\", \"param1\", \"param2\"] ( exec \u683c\u5f0f\uff0c\u9996\u9009) ENTRYPOINT command param1 param2 ( shell \u683c\u5f0f) \u6bcf\u4e2a Dockerfile \u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a ENTRYPOINT, \u5f53\u6307\u5b9a\u591a\u4e2a\u65f6\uff0c \u53ea\u6709 \u6700\u540e\u4e00\u4e2a\u8d77\u6548 \u3002","title":"2.1.6 ENTRYPOINT"},{"location":"docker/11. Dockerfile/#2161-exec","text":"\u6b64\u65f6\uff0c\u540e\u8ddf\u7684 CMD \u6307\u4ee4\u6307\u5b9a\u503c\u5c06\u4f5c\u4e3a\u6839\u547d\u4ee4\u7684\u53c2\u6570\uff1b \u6240\u6709\u4f20\u5165\u503c\u4f5c\u4e3a\u8be5\u547d\u4ee4\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u4f1a\u8986\u76d6\u6389\u6240\u6709\u4f7f\u7528CMD\u6307\u4ee4\u6307\u5b9a\u7684\u53c2\u6570\u3002 \u4f8b\u5982\uff0c docker run <image> -d \u4f1a\u4f20\u9012 -d \u53c2\u6570\u7ed9 ENTRYPOINT \u3002\u53ef\u4ee5\u4f7f\u7528 docker run --entrypoint \u8986\u76d6ENTRYPOINT\u6307\u4ee4\uff08\u4e0d\u80fd\u4f7f\u7528 sh -c \uff09\u3002","title":"2.1.6.1 exec\u683c\u5f0f"},{"location":"docker/11. Dockerfile/#2162-shell","text":"\u8be5\u683c\u5f0f\u5c06\u9632\u6b62\u4f7f\u7528\u4efb\u4f55 CMD \u6216 run \u547d\u4ee4\u884c\u53c2\u6570\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u7f3a\u70b9\uff1a\u4f60\u7684 ENTRYPOINT \u6307\u4ee4\u4f1a\u88ab\u4f5c\u4e3a /bin/sh -c \u7684\u5b50\u547d\u4ee4\u542f\u52a8\uff0c\u4e0d\u80fd\u4f20\u9012\u4fe1\u53f7\uff08 signal \uff09\u3002\u8fd9\u610f\u5473\u7740\u53ef\u6267\u884c\u7a0b\u5e8f\u4e0d\u4f1a\u662f\u5bb9\u5668\u7684 PID 1 \u5e76\u4e14\u4e0d\u80fd\u63a5\u6536\u5230 Unix signals \uff0c\u6240\u4ee5\u4f60\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u4e0d\u80fd\u63a5\u6536\u5230\u4ece docker stop <container> \u53d1\u51fa\u7684 SIGTERM \u3002","title":"2.1.6.2 shell\u683c\u5f0f"},{"location":"docker/11. Dockerfile/#2163-execentrypoint","text":"\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u683c\u5f0f\u8bbe\u7f6e\u56fa\u5b9a\u7684\u9ed8\u8ba4\u547d\u4ee4\u548c\u53c2\u6570\uff0c\u7136\u540e\u4f7f\u7528\u4efb\u4e00\u683c\u5f0f\u7684 CMD \u8bbe\u7f6e\u66f4\u6539\u5176\u5b83\u53ef\u53d8\u7684\u9ed8\u8ba4\u503c\u3002 \u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\u662f top -b -c \uff1a FROM ubuntu ENTRYPOINT [ \"top\" , \"-b\" ] CMD [ \"-c\" ] \u6b64\u65f6\u6267\u884c\u7684\u547d\u4ee4\u662f top -b -H \uff1a $ docker run -it --rm --name test top -H top - 08 :25:00 up 7 :27, 0 users, load average: 0 .00, 0 .01, 0 .05 Threads: 1 total, 1 running, 0 sleeping, 0 stopped, 0 zombie %Cpu ( s ) : 0 .1 us, 0 .1 sy, 0 .0 ni, 99 .7 id, 0 .0 wa, 0 .0 hi, 0 .0 si, 0 .0 st KiB Mem: 2056668 total, 1616832 used, 439836 free, 99352 buffers KiB Swap: 1441840 total, 0 used, 1441840 free. 1324440 cached Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 19744 2336 2080 R 0 .0 0 .1 0 :00.04 top \u4e0b\u9762\u7684Dockerfile\u5c55\u793a\u4e86\u4f7f\u7528ENTRYPOINT\u5728\u540e\u53f0\u8fd0\u884cApache\uff1a FROM debian:stable RUN apt-get update && apt-get install -y --force-yes apache2 EXPOSE 80 443 VOLUME [ \"/var/www\" , \"/var/log/apache2\" , \"/etc/apache2\" ] ENTRYPOINT [ \"/usr/sbin/apache2ctl\" , \"-D\" , \"FOREGROUND\" ] \u5982\u679c\u9700\u8981\u4e3a\u5355\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u7f16\u5199\u542f\u52a8\u811a\u672c,\u5219\u53ef\u4ee5\u4f7f\u7528 exec \u548c gosu \u547d\u4ee4\u786e\u4fdd\u6700\u7ec8\u53ef\u6267\u884c\u6587\u4ef6\u63a5\u6536 Unix \u4fe1\u53f7: #!/usr/bin/env bash set -e if [ \" $1 \" = 'postgres' ] ; then chown -R postgres \" $PGDATA \" if [ -z \" $( ls -A \" $PGDATA \" ) \" ] ; then gosu postgres initdb fi exec gosu postgres \" $@ \" fi exec \" $@ \" \u6700\u540e\uff0c\u5982\u679c\u60a8\u9700\u8981\u5728\u5173\u673a\u65f6\u8fdb\u884c\u4e00\u4e9b\u989d\u5916\u7684\u6e05\u7406\uff08\u6216\u4e0e\u5176\u4ed6\u5bb9\u5668\u901a\u4fe1\uff09\uff0c\u6216\u8005\u534f\u8c03\u591a\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u786e\u4fddENTRYPOINT\u811a\u672c\u63a5\u6536Unix\u4fe1\u53f7\uff0c\u4f20\u9012\u5b83\u4eec\uff0c\u7136\u540e\u505a\u4e86\u4e00\u4e9b\u5de5\u4f5c\uff1a #!/bin/sh # Note: I've written this using sh so it works in the busybox container too # USE the trap if you need to also do manual cleanup after the service is stopped, # or need to start multiple services in the one container trap \"echo TRAPed signal\" HUP INT QUIT TERM # start service in background here /usr/sbin/apachectl start echo \"[hit enter key to exit] or run 'docker stop <container>'\" read # stop service and clean up here echo \"stopping apache\" /usr/sbin/apachectl stop echo \"exited $0 \" Note exec \u683c\u5f0f\u88ab\u89e3\u6790\u4e3aJSON\u6570\u7ec4\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5fc5\u987b\u4f7f\u7528 \u53cc\u5f15\u53f7 \u5305\u56f4\u5355\u8bcd\u800c\u4e0d\u662f\u5355\u5f15\u53f7\u3002 Note exec \u683c\u5f0f\u4e0d\u4f1a\u8c03\u7528\u547d\u4ee4shell\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u4f1a\u6b63\u5e38\u5730\u6267\u884cshell\u3002\u4f8b\u5982\uff0c ENTRYPOINT [ \"echo\", \"$HOME\" ] \u4e0d\u4f1a\u505a\u53d8\u91cf\u66ff\u6362\u3002\u5982\u679c\u4f60\u60f3\u8981shell\u5904\u7406\uff0c\u90a3\u4e48\u4f7f\u7528 shell \u683c\u5f0f\u6216\u8005\u76f4\u63a5\u6267\u884cshell\uff1a ENTRYPOINT [ \"sh\", \"-c\", \"echo $HOME\" ] \uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u662fshell\u505a\u4e86\u73af\u5883\u53d8\u91cf\u6269\u5c55\uff0c\u800c\u4e0d\u662fdocker\u3002","title":"2.1.6.3 exec\u683c\u5f0fENTRYPOINT\u4e3e\u4f8b"},{"location":"docker/11. Dockerfile/#2164-shellentrypoint","text":"\u60a8\u53ef\u4ee5\u4e3a ENTRYPOINT \u6307\u5b9a\u4e00\u4e2a\u7eaf\u5b57\u7b26\u4e32\uff0c\u5b83\u5c06\u5728 /bin/sh -c \u4e2d\u6267\u884c\u3002\u6b64\u683c\u5f0f\u5c06\u4f7f\u7528shell\u5904\u7406\u66ff\u6362shell\u73af\u5883\u53d8\u91cf\uff0c\u5e76\u4e14\u4f1a \u5ffd\u89c6 \u4efb\u4f55 CMD \u6307\u4ee4\u6216 docker run \u547d\u4ee4\u884c\u53c2\u6570\u3002 \u4e3a\u4e86\u786e\u4fdd docker stop \u80fd\u6b63\u786e\u5730\u5411 ENTRYPOINT \u53ef\u6267\u884c\u7a0b\u5e8f\u53d1\u51fa\u4fe1\u53f7\uff0c \u8981\u7262\u8bb0\u4f7f\u7528 exec \u6267\u884c\u547d\u4ee4 \uff1a FROM ubuntu ENTRYPOINT exec top -b \u5f53\u4f60\u8fd0\u884c\u8fd9\u4e2a\u955c\u50cf\u65f6\uff0c\u53ef\u4ee5\u770b\u5230\u5355\u4e2a PID \u8fdb\u7a0b \uff1a $ docker run -it --rm --name test top Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached CPU: 5 % usr 0 % sys 0 % nic 94 % idle 0 % io 0 % irq 0 % sirq Load average: 0 .08 0 .03 0 .05 2 /98 6 PID PPID USER STAT VSZ %VSZ %CPU COMMAND 1 0 root R 3164 0 % 0 % top -b \u6ce8\u610f \uff1a\u5982\u679c\u4ece\u57fa\u7840\u955c\u50cf\u5b9a\u4e49CMD\uff0c\u5219\u8bbe\u7f6eENTRYPOINT\u4f1a\u5c06CMD\u91cd\u7f6e\u4e3a\u7a7a\u503c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u5728\u5f53\u524d\u955c\u50cf\u4e2d\u5b9a\u4e49CMD\u624d\u80fd\u83b7\u5f97\u503c\u3002","title":"2.1.6.4 shell\u683c\u5f0fENTRYPOINT\u4e3e\u4f8b"},{"location":"docker/11. Dockerfile/#217-volume","text":"\u521b\u5efa\u6570\u636e\u5377\u6302\u8f7d\u70b9\uff0c\u5e76\u5c06\u5176\u6807\u8bb0\u4e3a\u4ece\u672c\u5730\u4e3b\u673a\u6216\u5176\u4ed6\u5bb9\u5668\u4fdd\u5b58\u5916\u90e8\u6302\u8f7d\u7684\u5377\u3002json\u6570\u7ec4\u3002\u8fd0\u884c\u5bb9\u5668\u65f6\u53ef\u4ee5\u4ece\u672c\u5730\u4e3b\u673a\u6216\u5176\u4ed6\u5bb9\u5668\u6302\u8f7d\u6570\u636e\u5377\uff0c \u4e00\u822c\u7528\u6765\u5b58\u653e\u6570\u636e\u5e93\u548c\u9700\u8981\u4fdd\u6301\u7684\u6570\u636e\u7b49\u3002 VOLUME [ \"/data\" ] \u4eceDockerfile\u4e2d\u66f4\u6539\u5377\uff1a\u5982\u679c\u4efb\u4f55\u6784\u5efa\u6b65\u9aa4\u5728\u58f0\u660e\u540e\u66f4\u6539\u5377\u5185\u7684\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u4e9b\u66f4\u6539\u5c06\u88ab\u4e22\u5f03\u3002","title":"2.1.7 VOLUME"},{"location":"docker/11. Dockerfile/#218-user","text":"\u6307\u5b9a\u8fd0\u884c\u5bb9\u5668\u65f6\u7684\u7528\u6237\u540d\u6216UID, \u540e\u7eed\u7684RUN\u3001CMD\u3001 ENTRYPOINT\u6307\u4ee4\u4e5f\u4f1a\u4f7f\u7528\u6307\u5b9a\u7684\u7528\u6237\u8eab\u4efd\u3002 USER <user>[:<group>] or USER <UID>[:<GID>] \u5f53\u670d\u52a1\u4e0d\u9700\u8981\u7ba1 \u7406\u5458\u6743\u9650\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u547d\u4ee4\u6307\u5b9a\u8fd0\u884c\u7528\u6237\uff0c \u5e76\u4e14\u53ef\u4ee5\u5728 Dockerfile \u5efa\u6240\u9700\u8981\u7684\u7528\u6237\u3002","title":"2.1.8 USER"},{"location":"docker/11. Dockerfile/#219-workdir","text":"\u4e3a\u540e\u7eed\u7684 RUN\u3001CMD\u3001 ENTRYPOINT\u3001COPY\u3001 ADD\u6307\u4ee4\u914d\u7f6e\u5de5\u4f5c\u76ee\u5f55\u3002 WORKDIR /path/to/workdir \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a WORKDIR \u4ee4\uff0c\u540e\u7eed\u547d\u4ee4\u5982\u679c\u53c2\u6570\u662f\u76f8\u5bf9\u8def\u5f84\uff0c \u4f1a\u57fa\u4e8e\u4e4b\u524d\u547d\u4ee4\u6307\u5b9a\u7684\u8def\u5f84 \uff1a WORKDIR /a WORKDIR b WORKDIR c RUN pwd \u7ed3\u679c\u662f /a/b/c \u3002 \u53ea\u80fd\u4f7f\u7528Dockerfile\u4e2d\u663e\u5f0f\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff08\u5373\u53ea\u80fd\u4f7f\u7528\u5148\u524d\u5728 ENV \u4e2d\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\uff09\uff1a ENV DIRPATH /path WORKDIR $DIRPATH/$DIRNAME RUN pwd \u7ed3\u679c\u662f /path/$DIRNAME \u3002","title":"2.1.9 WORKDIR"},{"location":"docker/11. Dockerfile/#2110-onbuild","text":"\u6307\u5b9a\u5f53\u57fa\u4e8e\u5f53\u524dDockerfile\u751f\u6210\u7684\u955c\u50cf\u521b\u5efa\u5b50\u955c\u50cf\u65f6\uff0c\u9996\u5148\u81ea\u52a8\u6267\u884c\u7684\u64cd\u4f5c\u6307\u4ee4\u3002 ONBUILD [ INSTRUCTION ] \u4f8b\u5982\uff0c\u4f7f\u7528\u5982\u4e0b\u7684 Dockerfile \u521b\u5efa\u7236\u955c\u50cf ParentImag \uff0c\u6307\u5b9a ONBUILD\u6307\u4ee4\uff1a # Dockerfile for Parentimage [ ... ] ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src [ ... ] \u4f7f\u7528 docker build \u547d\u4ee4\u521b\u5efa\u5b50\u955c\u50cf childImage \u65f6\uff08 FROM Parentimage \uff09\uff0c\u4f1a\u9996\u5148\u6267\u884c Parentimage \u914d\u7f6e\u7684 ONBUILD \u6307\u4ee4\uff1a # Dockerfile for Chi ldimage FROM Parentimage \u7b49\u4ef7\u4e8e\u5728 Childimage Dockerfi \u4e2d\u6dfb\u52a0\u4e86\u5982\u4e0b\u6307\u4ee4\uff1a #Automatically run the following when building Ch ldimage ADD . /app/src RUN /usr/local/bin/python-build --dir /app/src \u8be5\u6307\u4ee4\u5728\u521b\u5efa\u4e13\u95e8\u7528\u4e8e\u81ea\u52a8\u7f16\u8bd1\u3001\u68c0\u67e5\u7b49\u64cd\u4f5c\u7684\u57fa\u7840\u955c\u50cf\u65f6\uff0c\u5341\u5206\u6709\u7528\u3002 \u7531\u4e8e ONBUILD \u6307\u4ee4\u662f\u9690\u5f0f\u6267\u884c\u7684\uff0c\u63a8\u8350\u5728\u4f7f\u7528\u5b83\u7684\u955c\u50cf\u6807 \u7b7e\u4e2d\u8fdb\u884c\u6807\u6ce8\uff0c \u4f8b\u5982 ruby:2.l-onbuild\u3002","title":"2.1.10 ONBUILD"},{"location":"docker/11. Dockerfile/#2111-stopsignal","text":"\u6307\u5b9a\u6240\u521b\u5efa\u955c\u50cf\u542f\u52a8\u7684\u5bb9\u5668\u63a5\u6536\u9000\u51fa\u7684\u4fe1\u53f7\u503c\u3002 STOPSIGNAL signal","title":"2.1.11 STOPSIGNAL"},{"location":"docker/11. Dockerfile/#2112-healthcheck","text":"\u914d\u7f6e\u6240\u542f\u52a8\u5bb9\u5668\u5982\u4f55\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\uff08\u5982 \u5224\u65ad\u5065\u5eb7\u4e0e\u5426\uff09\u3002 \u6709\u4e24\u79cd\u683c\u5f0f\uff1a HEALTHCHECK [OPTIONS] CMD command (check container health by running a command inside the container) HEALTHCHECK NONE (\u7981\u6b62\u57fa\u7840\u955c\u50cf\u4e2d\u7684\u5065\u5eb7\u68c0\u67e5) OPTIONS \u7684\u503c\uff1a --interval=DURATION (default: 30s )\uff1a\u8ddd\u4e0a\u4e00\u4e2a\u68c0\u67e5\u5b8c\u6210\u540e\u591a\u4e45\u68c0\u67e5\u4e00\u6b21\u3002 --timeout=DURATION (default: 30s )\uff1a\u68c0\u67e5\u7ed3\u679c\u7684\u8d85\u65f6\u65f6\u95f4\u3002 --start-period=DURATION (default: 0s )\uff1a\u4e3a\u9700\u8981\u65f6\u95f4\u5f15\u5bfc\u7684\u5bb9\u5668\u63d0\u4f9b\u521d\u59cb\u5316\u65f6\u95f4\u3002\u5728\u6b64\u671f\u95f4\u63a2\u6d4b\u5931\u8d25\u5c06\u4e0d\u8ba1\u5165\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002\u4f46\u662f\uff0c\u5982\u679c\u5065\u5eb7\u68c0\u67e5\u5728\u5f00\u59cb\u671f\u95f4\u6210\u529f\uff0c\u5bb9\u5668\u88ab\u89c6\u4e3a\u5df2\u542f\u52a8\uff0c\u6240\u6709\u8fde\u7eed\u5931\u8d25\u5c06\u8ba1\u5165\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002 --retries=N (default: 3 )\uff1a\u5982\u679c\u5931\u8d25\u4e86\uff0c\u91cd\u8bd5\u51e0\u6b21\u624d\u6700\u7ec8\u786e\u5b9a\u5931\u8d25\u3002 command\u53ef\u4ee5\u662fshell\u547d\u4ee4\u6216 exec \u6570\u7ec4\u3002 \u68c0\u67e5\u7ed3\u679c\uff1a 0: success - the container is healthy and ready for use 1: unhealthy - the container is not working correctly 2: reserved - do not use this exit code\u3002\u4fdd\u7559\u5b57\u3002","title":"2.1.12 HEALTHCHECK"},{"location":"docker/11. Dockerfile/#2113-shell","text":"\u6307\u5b9a\u5176\u4ed6\u6307\u4ee4\u4f7f\u7528 shell \u65f6\u7684\u9ed8\u8ba4 shell \u7c7b\u578b\u3002 SHELL [ \"executable\" , \"parameters\" ] linux\u7684\u9ed8\u8ba4\u503c\u662f [\"/bin/sh\", \"-c\"] \uff1bWindows\u7684\u9ed8\u8ba4\u503c\u662f [\"cmd\", \"/S\", \"/C\"] \u3002 \u6ce8\u610f \uff1a\u5bf9\u4e8e Windows \u7cfb\u7edf\uff0cshell\u8def\u5f84\u4e2d\u4f7f\u7528\u4e86\u201c\uff3c\u201d\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u5efa\u8bae\u5728 Dockerfile \u5f00\u5934\u6dfb\u52a0 # escape=' \u6765\u6307\u5b9a\u8f6c\u4e49\u7b26\u3002","title":"2.1.13 SHELL"},{"location":"docker/11. Dockerfile/#22","text":"","title":"2.2 \u64cd\u4f5c\u6307\u4ee4"},{"location":"docker/11. Dockerfile/#221-run","text":"\u8fd0\u884c\u6307\u5b9a\u547d\u4ee4\u3002 \u4e24\u79cd\u683c\u5f0f\uff1a RUN <command> ( shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows) RUN [\"executable\", \"param1\", \"param2\"] ( exec form\uff0c\u4e0d\u4f1a\u542f\u52a8shell\u73af\u5883) \u6bcf\u6761 RUN \u6307\u4ee4\u5c06\u5728\u5f53\u524d\u955c\u50cf\u57fa\u7840\u4e0a\u6267\u884c\u6307\u5b9a\u547d\u4ee4\uff0c\u5e76 \u63d0\u4ea4\u4e3a\u65b0\u7684\u955c\u50cf\u5c42 \uff0c\u5f53\u547d\u4ee4\u8f83\u957f\u65f6\u53ef\u4ee5\u4f7f\u7528 \\ \u6765\u6362\u884c\u3002\u4f8b\uff1a RUN /bin/bash -c 'source $HOME/.bashrc; \\ echo $HOME'","title":"2.2.1 RUN"},{"location":"gerrit/Apache\u4ee3\u7406\u6dfb\u52a0\u65b0\u7528\u6237/","text":"\u65b0\u5efa\u7528\u6237 htpasswd -bc /etc/httpd/passwords user1 passwd1 \u6dfb\u52a0\u7528\u6237 htpasswd -b /etc/httpd/passwords user2 passwd2","title":"Apache\u4ee3\u7406\u6dfb\u52a0\u65b0\u7528\u6237"},{"location":"gerrit/Gerrit submit change after abandoning its parent/","text":"There is a few options and it depends if you want to include the changes of patchset-1. You only want the changes from patchset-2? Checkout master and cherry-pick patchset-2, commit -amend and push again You want to include changes from patchset-1 and 2? In this case you may want to combine the two patchsets, easiest is to do a git reset HEAD~2 and commit again, don't forget to copy the Change-ID of your last commit to be able to continue that review change A\u88ab\u5e9f\u5f03\uff0cchange B\u62a5\u9519 1. \u53ea\u60f3\u8981B\uff1a \u00b6 \u5207\u6362\u5230\u5176\u4ed6\u5206\u652f\uff0c\u4fee\u6539\u4ee3\u7801\uff0c\u63d0\u4ea4\u5230\u76ee\u6807\u5206\u652f cherry-pick 2. A B\u90fd\u8981\uff1a \u00b6 git reset HEAD^^ \u518d\u6b21\u63d0\u4ea4\uff0c\u590d\u5236\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\u7684Change-ID\u4ee5\u4fbf\u4e8e\u53ef\u4ee5\u7ee7\u7eed\u7ed9gerrit \u8fdb\u884c\u4ee3\u7801\u5ba1\u67e5\u3002","title":"Gerrit submit change after abandoning its parent"},{"location":"gerrit/Gerrit submit change after abandoning its parent/#1-b","text":"\u5207\u6362\u5230\u5176\u4ed6\u5206\u652f\uff0c\u4fee\u6539\u4ee3\u7801\uff0c\u63d0\u4ea4\u5230\u76ee\u6807\u5206\u652f cherry-pick","title":"1. \u53ea\u60f3\u8981B\uff1a"},{"location":"gerrit/Gerrit submit change after abandoning its parent/#2-a-b","text":"git reset HEAD^^ \u518d\u6b21\u63d0\u4ea4\uff0c\u590d\u5236\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\u7684Change-ID\u4ee5\u4fbf\u4e8e\u53ef\u4ee5\u7ee7\u7eed\u7ed9gerrit \u8fdb\u884c\u4ee3\u7801\u5ba1\u67e5\u3002","title":"2. A B\u90fd\u8981\uff1a"},{"location":"gerrit/\u4f7f\u7528Apache\u4ee3\u7406\u8def\u5f84\u9519\u8bef/","text":"\u4f7f\u7528Apache\u4ee3\u7406gerrit\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528test/test\u8fd9\u79cd\u5e26\u6709\u2018/\u2019\u7684\u8def\u5f84\u4f1a\u6709404\u9519\u8bef\u3002 \u5728 /etc/httpd/config.d/gerrit.config \u4fee\u6539\u5982\u4e0b\uff1a AllowEncodedSlashes On ProxyPass / http://192.168.216.12:8082/ nocanon Nocanon\u4f1a\u7981\u6b62\u5b57\u7b26\u8f6c\u4e49\uff0c\u76f4\u63a5\u4f20\u9012\u7ed9\u540e\u53f0","title":"\u4f7f\u7528Apache\u4ee3\u7406\u8def\u5f84\u9519\u8bef"},{"location":"gerrit/\u5237\u65b0gerrit\u9879\u76ee\u5217\u8868/","text":"\u628a\u670d\u52a1\u5668\u7684id_rsa.pub\u52a0\u5165\u5230admin\u7528\u6237\u4e2d ssh -p 29418 admin@localhost gerrit flush-caches --cache project_list \u6216\u8005\u91cd\u542fgerrit\u670d\u52a1","title":"\u5237\u65b0gerrit\u9879\u76ee\u5217\u8868"},{"location":"git/git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)/","text":"1. \u6709\u6587\u4ef6\u4fee\u6539 \u00b6 1.1 \u6b63\u5e38\u6d41\u7a0b \u00b6 git rebase - i 68598 f1d65da0dd3de283cf5ac04bbf17b58d1a1 \u4fee\u6539\u6587\u4ef6 git add . git commit -- amend git rebase -- continue 1.2 \u6587\u4ef6\u51b2\u7a81 \u00b6 git rebase - i 48 a55705063291c68208880bbcc7581e3c2e5074 \u4fee\u6539\u6587\u4ef6 git add . git rebase -- continue \u89e3\u51b3\u51b2\u7a81 git add . git rebase \u2013 - continue taps :\u5fd8\u8bb0\u4e86\u6d41\u7a0b\u3002\u3002\u3002 2. \u5408\u5e76\u5386\u53f2\u63d0\u4ea4 \u00b6 \u5148\u5230\u60f3\u8981\u5408\u5e76\u7684\u63d0\u4ea4\u4e2d\u6700\u65e9\u7684\u4e00\u6b21 git rebase - i 48 a55705063291c68208880bbcc7581e3c2e5074 \u6216 git rebase - i HEAD ~ 2 \u7b2c\u4e00\u5217\u662frebase\u5177\u4f53\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u5176\u4e2d\u64cd\u4f5c\u53ef\u4ee5\u9009\u62e9\uff0c\u5176\u4e2d\u542b\u4e49\u5982\u4e0b\uff1a \u9009\u62e9pick\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4ee5\u540c\u6837\u7684\u63d0\u4ea4\u4fe1\u606f\uff08commit message\uff09\u4fdd\u5b58\u63d0\u4ea4 \u9009\u62e9reword\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u9700\u8981\u91cd\u65b0\u7f16\u8f91\u63d0\u4ea4\u4fe1\u606f \u9009\u62e9edit\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u56e0\u4e3aamending\u800c\u7ec8\u6b62 \u9009\u62e9squash\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u4e0e\u4e4b\u524d\u7684\u63d0\u4ea4\u5408\u5e76 \u9009\u62e9fixup\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u4e22\u6389\u63d0\u4ea4\u65e5\u5fd7 \u9009\u62e9exec\u64cd\u4f5c\uff0cgit\u4f1a\u5728shell\u4e2d\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4 \u6839\u636e\u4e0a\u8ff0\u7684\u63d0\u793a\u5c06\u60f3\u8981\u5408\u5e76\u7684\u63d0\u4ea4\u6539\u53d8\u5176\u64cd\u4f5c\uff0c\u4fdd\u5b58\u4e4b\u540e\u4f1a\u63d0\u793a\u4fee\u6539\u540e\u7684\u4fe1\u606f\uff0c\u5982\u679c\u9700\u8981\u53ef\u4ee5\u518d\u6b21\u66f4\u6539\u63d0\u4ea4\u4fe1\u606f\u3002\u4e0b\u9762\u7684\u8865\u4e01\u4f1a\u5e94\u7528\u5230\u4e0a\u9762\u7684pick\u63d0\u4ea4\u3002","title":"git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)"},{"location":"git/git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)/#1","text":"","title":"1. \u6709\u6587\u4ef6\u4fee\u6539"},{"location":"git/git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)/#11","text":"git rebase - i 68598 f1d65da0dd3de283cf5ac04bbf17b58d1a1 \u4fee\u6539\u6587\u4ef6 git add . git commit -- amend git rebase -- continue","title":"1.1 \u6b63\u5e38\u6d41\u7a0b"},{"location":"git/git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)/#12","text":"git rebase - i 48 a55705063291c68208880bbcc7581e3c2e5074 \u4fee\u6539\u6587\u4ef6 git add . git rebase -- continue \u89e3\u51b3\u51b2\u7a81 git add . git rebase \u2013 - continue taps :\u5fd8\u8bb0\u4e86\u6d41\u7a0b\u3002\u3002\u3002","title":"1.2 \u6587\u4ef6\u51b2\u7a81"},{"location":"git/git rebase(\u4fee\u6539\u5386\u53f2\u63d0\u4ea4)/#2","text":"\u5148\u5230\u60f3\u8981\u5408\u5e76\u7684\u63d0\u4ea4\u4e2d\u6700\u65e9\u7684\u4e00\u6b21 git rebase - i 48 a55705063291c68208880bbcc7581e3c2e5074 \u6216 git rebase - i HEAD ~ 2 \u7b2c\u4e00\u5217\u662frebase\u5177\u4f53\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u5176\u4e2d\u64cd\u4f5c\u53ef\u4ee5\u9009\u62e9\uff0c\u5176\u4e2d\u542b\u4e49\u5982\u4e0b\uff1a \u9009\u62e9pick\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4ee5\u540c\u6837\u7684\u63d0\u4ea4\u4fe1\u606f\uff08commit message\uff09\u4fdd\u5b58\u63d0\u4ea4 \u9009\u62e9reword\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u9700\u8981\u91cd\u65b0\u7f16\u8f91\u63d0\u4ea4\u4fe1\u606f \u9009\u62e9edit\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u56e0\u4e3aamending\u800c\u7ec8\u6b62 \u9009\u62e9squash\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u4e0e\u4e4b\u524d\u7684\u63d0\u4ea4\u5408\u5e76 \u9009\u62e9fixup\u64cd\u4f5c\uff0cgit\u4f1a\u5e94\u7528\u8fd9\u4e2a\u8865\u4e01\uff0c\u4f46\u4f1a\u4e22\u6389\u63d0\u4ea4\u65e5\u5fd7 \u9009\u62e9exec\u64cd\u4f5c\uff0cgit\u4f1a\u5728shell\u4e2d\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4 \u6839\u636e\u4e0a\u8ff0\u7684\u63d0\u793a\u5c06\u60f3\u8981\u5408\u5e76\u7684\u63d0\u4ea4\u6539\u53d8\u5176\u64cd\u4f5c\uff0c\u4fdd\u5b58\u4e4b\u540e\u4f1a\u63d0\u793a\u4fee\u6539\u540e\u7684\u4fe1\u606f\uff0c\u5982\u679c\u9700\u8981\u53ef\u4ee5\u518d\u6b21\u66f4\u6539\u63d0\u4ea4\u4fe1\u606f\u3002\u4e0b\u9762\u7684\u8865\u4e01\u4f1a\u5e94\u7528\u5230\u4e0a\u9762\u7684pick\u63d0\u4ea4\u3002","title":"2. \u5408\u5e76\u5386\u53f2\u63d0\u4ea4"},{"location":"git/windows\u65e0\u6cd5\u4f7f\u7528git\u514b\u9686/","text":"vi ~/.ssh/config Host *.*.*.* KexAlgorithms +diffie-hellman-group1-sha1 git\u4e2d\u6587\u6307\u5357 \u5206\u652f\u5408\u5e76\u7b56\u7565\uff1a\u5feb\u901f\u5411\u524d\u5408\u5e76\uff08\u642d\u914d rebase \u4f7f\u7528\uff09\u6765\u5408\u5e76\u5fae\u5c0f\u7684\u529f\u80fd\u6216\u8005\u4fee\u590d bug\uff0c\u4f7f\u7528\u4e09\u8def\u5408\u5e76\u6765\u6574\u5408\u957f\u671f\u8fd0\u884c\u7684\u529f\u80fd\u3002\u540e\u8005\u5bfc\u81f4\u7684\u5408\u5e76\u63d0\u4ea4\u4f5c\u4e3a\u4e24\u4e2a\u5206\u652f\u7684\u8fde\u63a5\u6807\u5fd7\u3002","title":"windows\u65e0\u6cd5\u4f7f\u7528git\u514b\u9686"},{"location":"git/\u4fee\u6539\u5386\u53f2/","text":"\u53c2\u8003\uff1ahttps://github.com/geeeeeeeeek/git-recipes/wiki/2.7-%E9%87%8D%E5%86%99%E9%A1%B9%E7%9B%AE%E5%8E%86%E5%8F%B2 1. git commit --amend \u00b6 \u53ef\u4ee5\u7528\u6765\u5bf9\u6700\u65b0\u7684\u63d0\u4ea4\u6253\u8865\u4e01\uff0c\u4fee\u6539\u6700\u65b0\u63d0\u4ea4\u7684\u63d0\u4ea4\u4fe1\u606f commit message \u3002 Note \u5373\u4f7f\u4ec0\u4e48\u90fd\u4e0d\u4fee\u6539\uff0c\u4e5f\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4id\uff0c\u672c\u8d28\u4e0a\u662f\u4f7f\u7528\u4e86\u65b0\u7684\u63d0\u4ea4\u66ff\u6362\u6389\u4e86\u65e7\u7684\u63d0\u4ea4\u3002 [ root@dev git-test ] # git log --oneline 352538e conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic [ root@dev git-test ] # git commit --amend [ master 98c3844 ] conflict commit 1 file changed, 1 insertion ( + ) [ root@dev git-test ] # git log --oneline 98c3844 conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic 2. git rebase \u00b6 Reapply commits on top of another base tip\u3002 Forward-port local commits to the updated upstream head\u3002 git rebase [ - i | -- interactive ] [ options ] [ -- exec < cmd > ] [ -- onto < newbase > ] [ < upstream > ] [ < branch > ] git rebase [ - i | -- interactive ] [ options ] [ -- exec < cmd > ] [ -- onto < newbase > ] -- root [ < branch > ] git rebase -- continue | -- skip | -- abort | -- edit - todo \u5982\u679c\u6307\u5b9a\u4e86 \uff0c git rebase \u5c06\u5728\u6267\u884c\u4efb\u4f55\u5176\u4ed6\u64cd\u4f5c\u4e4b\u524d\u6267\u884c\u81ea\u52a8\u6267\u884c git checkout <branch> \u3002 \u5047\u8bbe\u5f53\u524d\u5904\u4e8e topic \u5206\u652f\uff1a A ---B---C topic / D ---E---F---G master \u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u4e4b\u4e00\uff08\u53ef\u4ee5\u4f7f\u7528 \"-i\" \u9009\u9879\u4ea4\u4e92\u5f0f\u7684\u66f4\u6539\u63d0\u4ea4\uff0c\u7136\u540e\u518d rebase \uff09 : git rebase master git rebase master topic \u4f1a\u53d8\u6210 : A '--B' --C' topic / D ---E---F---G master NOTE : \u540e\u4e00\u79cd\u5f62\u5f0f\u53ea\u662f\u6267\u884c\u8ddf\u5728 git rebase master \u540e\u9762\u7684 git checkout topic\u7684\u7b80\u5199\u65b9\u5f0f \u3002\u5f53 rebase\u9000\u51fa\u65f6 \uff0c\u5f53\u524d\u5206\u652f\u4ecd\u5c06\u662f topic \u3002 \u5982\u679c\u4e0a\u6e38\u5206\u652f\u5df2\u5305\u542b\u6240\u505a\u7684\u66f4\u6539\uff0c\u5219\u5c06\u8df3\u8fc7\u8be5\u63d0\u4ea4\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u5386\u53f2\u8bb0\u5f55\u4e0a\u8fd0\u884c \"git rebase master\" \uff08\u5176\u4e2d A ' \u548c A \u5f15\u5165\u4e86\u76f8\u540c\u7684\u66f4\u6539\u96c6\uff0c\u4f46\u5177\u6709\u4e0d\u540c\u7684\u63d0\u4ea4\u8005\u4fe1\u606f\uff09\uff1a A---B---C topic / D---E---A' ---F master \u7ed3\u679c\u662f : B '---C' topic / D ---E---A'---F master \u5b9e\u8df5\uff1a # \u5f53\u524d\u7684master\u5206\u652f [ root@dev git-test ] # git log --oneline fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u5207\u6362\u5230develop\u5206\u652f [ root@dev git-test ] # git checkout develop Switched to branch 'develop' # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u5206\u652f\u6709\u4e0d\u540c\u7684\u63d0\u4ea4 [ root@dev git-test ] # git log --oneline 992bcc4 test rebase f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u73b0\u5728\u5c06develop\u7684\u63d0\u4ea4\u91cd\u65b0\u57fa\u4e8emaster\u7684\u63d0\u4ea4 [ root@dev git-test ] # git rebase master First, rewinding head to replay your work on top of it... Applying: test rebase [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u6b64\u65f6\u53ef\u9009\u62e9\u5c06master\u4e0edevelop\u8fdb\u884c\u7ebf\u5408\u5e76\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u5408\u5e76\u63d0\u4ea4 merge commits \u7684\u60c5\u51b5 [ root@dev git-test ] # git checkout master Switched to branch 'master' [ root@dev git-test ] # git merge develop Updating fdd2dad..3c525df Fast-forward d6 | 1 + 1 file changed, 1 insertion ( + ) [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 3. git reflog \u00b6 \u8bb0\u5f55HEAD\u7684\u66f4\u65b0\u3002 [ root@dev git-test ] # git reflog 3c525df HEAD@ { 0 } : merge develop: Fast-forward fdd2dad HEAD@ { 1 } : checkout: moving from develop to master 3c525df HEAD@ { 2 } : rebase finished: returning to refs/heads/develop 3c525df HEAD@ { 3 } : rebase: test rebase fdd2dad HEAD@ { 4 } : checkout: moving from develop to fdd2dad853f57ec89edf881e6102521a1ba208c0^0 992bcc4 HEAD@ { 5 } : checkout: moving from master to develop fdd2dad HEAD@ { 6 } : checkout: moving from develop to master 992bcc4 HEAD@ { 7 } : commit: test rebase ...... \u5f15\u7528\u65e5\u5fd7\u63d0\u4f9b\u7684\u5b89\u5168\u7f51\u53ea\u5bf9\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u7684\u66f4\u6539\u6709\u6548\uff0c\u800c\u4e14\u53ea\u6709\u79fb\u52a8\u64cd\u4f5c\u4f1a\u88ab\u8bb0\u5f55\u3002","title":"\u4fee\u6539\u5386\u53f2"},{"location":"git/\u4fee\u6539\u5386\u53f2/#1-git-commit-amend","text":"\u53ef\u4ee5\u7528\u6765\u5bf9\u6700\u65b0\u7684\u63d0\u4ea4\u6253\u8865\u4e01\uff0c\u4fee\u6539\u6700\u65b0\u63d0\u4ea4\u7684\u63d0\u4ea4\u4fe1\u606f commit message \u3002 Note \u5373\u4f7f\u4ec0\u4e48\u90fd\u4e0d\u4fee\u6539\uff0c\u4e5f\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4id\uff0c\u672c\u8d28\u4e0a\u662f\u4f7f\u7528\u4e86\u65b0\u7684\u63d0\u4ea4\u66ff\u6362\u6389\u4e86\u65e7\u7684\u63d0\u4ea4\u3002 [ root@dev git-test ] # git log --oneline 352538e conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic [ root@dev git-test ] # git commit --amend [ master 98c3844 ] conflict commit 1 file changed, 1 insertion ( + ) [ root@dev git-test ] # git log --oneline 98c3844 conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic","title":"1. git commit --amend"},{"location":"git/\u4fee\u6539\u5386\u53f2/#2-git-rebase","text":"Reapply commits on top of another base tip\u3002 Forward-port local commits to the updated upstream head\u3002 git rebase [ - i | -- interactive ] [ options ] [ -- exec < cmd > ] [ -- onto < newbase > ] [ < upstream > ] [ < branch > ] git rebase [ - i | -- interactive ] [ options ] [ -- exec < cmd > ] [ -- onto < newbase > ] -- root [ < branch > ] git rebase -- continue | -- skip | -- abort | -- edit - todo \u5982\u679c\u6307\u5b9a\u4e86 \uff0c git rebase \u5c06\u5728\u6267\u884c\u4efb\u4f55\u5176\u4ed6\u64cd\u4f5c\u4e4b\u524d\u6267\u884c\u81ea\u52a8\u6267\u884c git checkout <branch> \u3002 \u5047\u8bbe\u5f53\u524d\u5904\u4e8e topic \u5206\u652f\uff1a A ---B---C topic / D ---E---F---G master \u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u4e4b\u4e00\uff08\u53ef\u4ee5\u4f7f\u7528 \"-i\" \u9009\u9879\u4ea4\u4e92\u5f0f\u7684\u66f4\u6539\u63d0\u4ea4\uff0c\u7136\u540e\u518d rebase \uff09 : git rebase master git rebase master topic \u4f1a\u53d8\u6210 : A '--B' --C' topic / D ---E---F---G master NOTE : \u540e\u4e00\u79cd\u5f62\u5f0f\u53ea\u662f\u6267\u884c\u8ddf\u5728 git rebase master \u540e\u9762\u7684 git checkout topic\u7684\u7b80\u5199\u65b9\u5f0f \u3002\u5f53 rebase\u9000\u51fa\u65f6 \uff0c\u5f53\u524d\u5206\u652f\u4ecd\u5c06\u662f topic \u3002 \u5982\u679c\u4e0a\u6e38\u5206\u652f\u5df2\u5305\u542b\u6240\u505a\u7684\u66f4\u6539\uff0c\u5219\u5c06\u8df3\u8fc7\u8be5\u63d0\u4ea4\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u5386\u53f2\u8bb0\u5f55\u4e0a\u8fd0\u884c \"git rebase master\" \uff08\u5176\u4e2d A ' \u548c A \u5f15\u5165\u4e86\u76f8\u540c\u7684\u66f4\u6539\u96c6\uff0c\u4f46\u5177\u6709\u4e0d\u540c\u7684\u63d0\u4ea4\u8005\u4fe1\u606f\uff09\uff1a A---B---C topic / D---E---A' ---F master \u7ed3\u679c\u662f : B '---C' topic / D ---E---A'---F master \u5b9e\u8df5\uff1a # \u5f53\u524d\u7684master\u5206\u652f [ root@dev git-test ] # git log --oneline fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u5207\u6362\u5230develop\u5206\u652f [ root@dev git-test ] # git checkout develop Switched to branch 'develop' # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u5206\u652f\u6709\u4e0d\u540c\u7684\u63d0\u4ea4 [ root@dev git-test ] # git log --oneline 992bcc4 test rebase f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u73b0\u5728\u5c06develop\u7684\u63d0\u4ea4\u91cd\u65b0\u57fa\u4e8emaster\u7684\u63d0\u4ea4 [ root@dev git-test ] # git rebase master First, rewinding head to replay your work on top of it... Applying: test rebase [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3 # \u6b64\u65f6\u53ef\u9009\u62e9\u5c06master\u4e0edevelop\u8fdb\u884c\u7ebf\u5408\u5e76\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u5408\u5e76\u63d0\u4ea4 merge commits \u7684\u60c5\u51b5 [ root@dev git-test ] # git checkout master Switched to branch 'master' [ root@dev git-test ] # git merge develop Updating fdd2dad..3c525df Fast-forward d6 | 1 + 1 file changed, 1 insertion ( + ) [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a f1681e8 index of develop commit: 5 f808049 index of develop commit: 3","title":"2. git rebase"},{"location":"git/\u4fee\u6539\u5386\u53f2/#3-git-reflog","text":"\u8bb0\u5f55HEAD\u7684\u66f4\u65b0\u3002 [ root@dev git-test ] # git reflog 3c525df HEAD@ { 0 } : merge develop: Fast-forward fdd2dad HEAD@ { 1 } : checkout: moving from develop to master 3c525df HEAD@ { 2 } : rebase finished: returning to refs/heads/develop 3c525df HEAD@ { 3 } : rebase: test rebase fdd2dad HEAD@ { 4 } : checkout: moving from develop to fdd2dad853f57ec89edf881e6102521a1ba208c0^0 992bcc4 HEAD@ { 5 } : checkout: moving from master to develop fdd2dad HEAD@ { 6 } : checkout: moving from develop to master 992bcc4 HEAD@ { 7 } : commit: test rebase ...... \u5f15\u7528\u65e5\u5fd7\u63d0\u4f9b\u7684\u5b89\u5168\u7f51\u53ea\u5bf9\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u7684\u66f4\u6539\u6709\u6548\uff0c\u800c\u4e14\u53ea\u6709\u79fb\u52a8\u64cd\u4f5c\u4f1a\u88ab\u8bb0\u5f55\u3002","title":"3. git reflog"},{"location":"git/\u56de\u6eda/","text":"\u53c2\u8003\uff1ahttps://github.com/geeeeeeeeek/git-recipes/wiki/2.6-%E5%9B%9E%E6%BB%9A%E9%94%99%E8%AF%AF%E7%9A%84%E4%BF%AE%E6%94%B9 1. git revert \u00b6 \u8fd8\u539f\u4e00\u4e9b\u73b0\u6709\u7684\u63d0\u4ea4\u3002 git revert [ -- [ no - ] edit ] [ - n ] [ - m parent - number ] [ - s ] < commit > ... git revert -- continue git revert -- quit git revert -- abort \u5b83\u662f\u901a\u8fc7\u641e\u6e05\u695a\u5982\u4f55\u64a4\u9500\u8fd9\u4e2a\u63d0\u4ea4\u5f15\u5165\u7684\u66f4\u6539\uff0c\u7136\u540e\u5728\u6700\u540e\u52a0\u4e0a\u4e00\u4e2a\u64a4\u9500\u4e86\u66f4\u6539\u7684 \u65b0\u63d0\u4ea4 \uff0c\u800c\u4e0d\u662f\u4ece\u9879\u76ee\u5386\u53f2\u4e2d\u79fb\u9664\u8fd9\u4e2a\u63d0\u4ea4\u3002\u8fd9\u907f\u514d\u4e86Git\u4e22\u5931\u9879\u76ee\u5386\u53f2\u3002 \u4f8b\u5b50\uff1a [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit # 3c525df\u589e\u52a0\u4e86d6\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9 [ root@dev git-test ] # cat d6 test rebase # \u64a4\u95003c525df\u6240\u505a\u7684\u66f4\u6539 [ root@dev git-test ] # git revert 3c525df [ master bdcb3b5 ] Revert \"test rebase\" 1 file changed, 1 deletion ( - ) # \u6b64\u65f6d6\u6ca1\u6709\u5185\u5bb9 [ root@dev git-test ] # cat d6 [ root@dev git-test ] # git log --oneline bdcb3b5 Revert \"test rebase\" 3c525df test rebase fdd2dad conflict commit 2. git reset \u00b6 \u8be5\u547d\u4ee4\u4e0d\u4f1a\u91cd\u7f6egit\u672a\u8ffd\u8e2a\u7684\u6587\u4ef6\uff08\u6bd4\u5982.gitignore\u4e2d\u7684\u6587\u4ef6\uff09\u3002 \u4e0d\u52a0 --hard \u9009\u9879\u65f6\u53ea\u91cd\u8bbe\u7f13\u51b2\u533a\uff1b\u52a0\u4e0a\u8be5\u9009\u9879\u65f6\uff0c\u8fd8\u4f1a\u91cd\u8bbe\u5de5\u4f5c\u76ee\u5f55\u3002 git reset \uff1a\u91cd\u8bbe\u7f13\u51b2\u533a\uff0c\u5339\u914d\u6700\u8fd1\u7684\u4e00\u6b21\u63d0\u4ea4\uff0c\u4f46\u5de5\u4f5c\u76ee\u5f55\u4e0d\u53d8\u3002\u5b83\u4f1a\u53d6\u6d88 \u6240\u6709 \u6587\u4ef6\u7684\u7f13\u5b58\uff0c\u800c\u4e0d\u4f1a\u8986\u76d6\u4efb\u4f55\u4fee\u6539 git reset --hard \uff1a\u91cd\u8bbe\u7f13\u51b2\u533a\u548c\u5de5\u4f5c\u76ee\u5f55\uff0c\u5339\u914d\u6700\u8fd1\u7684\u4e00\u6b21\u63d0\u4ea4\u3002 git reset <commit> \uff1a\u5c06\u7f13\u5b58\u533a\u91cd\u8bbe\u5230\u8fd9\u4e2a\u63d0\u4ea4\uff0c\u4f46\u4e0d\u6539\u53d8\u5de5\u4f5c\u76ee\u5f55\u3002 \u6240\u6709 <commit> \u4e4b\u540e\u7684\u66f4\u6539\u4f1a\u4fdd\u7559\u5728\u5de5\u4f5c\u76ee\u5f55\u4e2d\u3002 3. git clean \u00b6 \u5220\u9664git \u672a\u8ffd\u8e2a \u7684\u6587\u4ef6\u3002\u5e38\u4e0e git reset --hard \u7ed3\u5408\u4f7f\u7528\u3002 git clean [ - d ] [ - f ] [ - n ] [ - q ] [ - e < pattern > ] [ - x | - X ] [ --] <path>... -f \uff1a\u5220\u9664\u6587\u4ef6\u5fc5\u52a0\u9009\u9879\u3002 -n \uff1a\u4e0d\u53bb\u771f\u6b63\u5730\u5220\u9664\u6587\u4ef6\uff0c\u800c\u662f\u544a\u77e5\u54ea\u4e9b\u6587\u4ef6\u4f1a\u88ab\u5220\u9664\u3002 -d \uff1a\u9664\u4e86\u672a\u8ddf\u8e2a\u7684\u6587\u4ef6\u5916\uff0c\u8fd8\u5220\u9664\u672a\u8ddf\u8e2a\u7684\u76ee\u5f55\u3002 -x \uff1a\u4e0d\u4f7f\u7528 .gitignore \uff08\u6bcf\u4e2a\u6587\u4ef6\u5939\u4e0b\u7684\uff09\u548c $GIT_DIR/info/exclude \u7684\u5ffd\u89c6\u89c4\u5219\uff0c\u53ea\u4f7f\u7528 -e \u9009\u9879\u5b9a\u4e49\u7684\u89c4\u5219\u6765\u5220\u9664\u6587\u4ef6\u3002 -X \uff1a\u53ea\u5220\u9664\u88abgit\u5ffd\u89c6\u7684\u6587\u4ef6\u3002 [ root@dev git-test ] # git clean -n Would remove clean-test [ root@dev git-test ] # git clean -f Removing clean-test","title":"\u56de\u6eda"},{"location":"git/\u56de\u6eda/#1-git-revert","text":"\u8fd8\u539f\u4e00\u4e9b\u73b0\u6709\u7684\u63d0\u4ea4\u3002 git revert [ -- [ no - ] edit ] [ - n ] [ - m parent - number ] [ - s ] < commit > ... git revert -- continue git revert -- quit git revert -- abort \u5b83\u662f\u901a\u8fc7\u641e\u6e05\u695a\u5982\u4f55\u64a4\u9500\u8fd9\u4e2a\u63d0\u4ea4\u5f15\u5165\u7684\u66f4\u6539\uff0c\u7136\u540e\u5728\u6700\u540e\u52a0\u4e0a\u4e00\u4e2a\u64a4\u9500\u4e86\u66f4\u6539\u7684 \u65b0\u63d0\u4ea4 \uff0c\u800c\u4e0d\u662f\u4ece\u9879\u76ee\u5386\u53f2\u4e2d\u79fb\u9664\u8fd9\u4e2a\u63d0\u4ea4\u3002\u8fd9\u907f\u514d\u4e86Git\u4e22\u5931\u9879\u76ee\u5386\u53f2\u3002 \u4f8b\u5b50\uff1a [ root@dev git-test ] # git log --oneline 3c525df test rebase fdd2dad conflict commit # 3c525df\u589e\u52a0\u4e86d6\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9 [ root@dev git-test ] # cat d6 test rebase # \u64a4\u95003c525df\u6240\u505a\u7684\u66f4\u6539 [ root@dev git-test ] # git revert 3c525df [ master bdcb3b5 ] Revert \"test rebase\" 1 file changed, 1 deletion ( - ) # \u6b64\u65f6d6\u6ca1\u6709\u5185\u5bb9 [ root@dev git-test ] # cat d6 [ root@dev git-test ] # git log --oneline bdcb3b5 Revert \"test rebase\" 3c525df test rebase fdd2dad conflict commit","title":"1. git revert"},{"location":"git/\u56de\u6eda/#2-git-reset","text":"\u8be5\u547d\u4ee4\u4e0d\u4f1a\u91cd\u7f6egit\u672a\u8ffd\u8e2a\u7684\u6587\u4ef6\uff08\u6bd4\u5982.gitignore\u4e2d\u7684\u6587\u4ef6\uff09\u3002 \u4e0d\u52a0 --hard \u9009\u9879\u65f6\u53ea\u91cd\u8bbe\u7f13\u51b2\u533a\uff1b\u52a0\u4e0a\u8be5\u9009\u9879\u65f6\uff0c\u8fd8\u4f1a\u91cd\u8bbe\u5de5\u4f5c\u76ee\u5f55\u3002 git reset \uff1a\u91cd\u8bbe\u7f13\u51b2\u533a\uff0c\u5339\u914d\u6700\u8fd1\u7684\u4e00\u6b21\u63d0\u4ea4\uff0c\u4f46\u5de5\u4f5c\u76ee\u5f55\u4e0d\u53d8\u3002\u5b83\u4f1a\u53d6\u6d88 \u6240\u6709 \u6587\u4ef6\u7684\u7f13\u5b58\uff0c\u800c\u4e0d\u4f1a\u8986\u76d6\u4efb\u4f55\u4fee\u6539 git reset --hard \uff1a\u91cd\u8bbe\u7f13\u51b2\u533a\u548c\u5de5\u4f5c\u76ee\u5f55\uff0c\u5339\u914d\u6700\u8fd1\u7684\u4e00\u6b21\u63d0\u4ea4\u3002 git reset <commit> \uff1a\u5c06\u7f13\u5b58\u533a\u91cd\u8bbe\u5230\u8fd9\u4e2a\u63d0\u4ea4\uff0c\u4f46\u4e0d\u6539\u53d8\u5de5\u4f5c\u76ee\u5f55\u3002 \u6240\u6709 <commit> \u4e4b\u540e\u7684\u66f4\u6539\u4f1a\u4fdd\u7559\u5728\u5de5\u4f5c\u76ee\u5f55\u4e2d\u3002","title":"2. git reset"},{"location":"git/\u56de\u6eda/#3-git-clean","text":"\u5220\u9664git \u672a\u8ffd\u8e2a \u7684\u6587\u4ef6\u3002\u5e38\u4e0e git reset --hard \u7ed3\u5408\u4f7f\u7528\u3002 git clean [ - d ] [ - f ] [ - n ] [ - q ] [ - e < pattern > ] [ - x | - X ] [ --] <path>... -f \uff1a\u5220\u9664\u6587\u4ef6\u5fc5\u52a0\u9009\u9879\u3002 -n \uff1a\u4e0d\u53bb\u771f\u6b63\u5730\u5220\u9664\u6587\u4ef6\uff0c\u800c\u662f\u544a\u77e5\u54ea\u4e9b\u6587\u4ef6\u4f1a\u88ab\u5220\u9664\u3002 -d \uff1a\u9664\u4e86\u672a\u8ddf\u8e2a\u7684\u6587\u4ef6\u5916\uff0c\u8fd8\u5220\u9664\u672a\u8ddf\u8e2a\u7684\u76ee\u5f55\u3002 -x \uff1a\u4e0d\u4f7f\u7528 .gitignore \uff08\u6bcf\u4e2a\u6587\u4ef6\u5939\u4e0b\u7684\uff09\u548c $GIT_DIR/info/exclude \u7684\u5ffd\u89c6\u89c4\u5219\uff0c\u53ea\u4f7f\u7528 -e \u9009\u9879\u5b9a\u4e49\u7684\u89c4\u5219\u6765\u5220\u9664\u6587\u4ef6\u3002 -X \uff1a\u53ea\u5220\u9664\u88abgit\u5ffd\u89c6\u7684\u6587\u4ef6\u3002 [ root@dev git-test ] # git clean -n Would remove clean-test [ root@dev git-test ] # git clean -f Removing clean-test","title":"3. git clean"},{"location":"git/\u62c9\u53d6\u4e0e\u63a8\u9001/","text":"\u53c2\u8003\uff1ahttps://www.yiibai.com/git/git_pull.html 1. \u62c9\u53d6 \u00b6 git pull < \u8fdc\u7a0b\u4ed3\u5e93\u540d > < \u8fdc\u7a0b\u5206\u652f\u540d > : < \u672c\u5730\u5206\u652f\u540d > \u53ea\u5199\u4e00\u4e2a\u5206\u652f\u540d\u7684\u8bdd\u5c31\u8868\u793a\u8fdc\u7a0b\u5206\u652f\u540d\u4e0e\u672c\u5730\u76f8\u540c\u3002 1.1 \u57fa\u4e8e Rebase \u7684 Pull \u00b6 \u53c2\u8003\uff1ahttps://github.com/geeeeeeeeek/git-recipes/wiki/3.2-%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5 --rebase \u6807\u8bb0\u53ef\u4ee5\u7528\u6765\u4fdd\u8bc1\u7ebf\u6027\u7684\u9879\u76ee\u5386\u53f2\uff0c\u9632\u6b62\u5408\u5e76\u63d0\u4ea4\uff08merge commits\uff09\u7684\u4ea7\u751f\u3002\u5f88\u591a\u5f00\u53d1\u8005\u503e\u5411\u4e8e\u4f7f\u7528 rebase \u800c\u4e0d\u662f merge\uff0c\u56e0\u4e3a \u6211\u60f3\u8981\u628a\u6211\u7684\u66f4\u6539\u653e\u5728\u5176\u4ed6\u4eba\u5b8c\u6210\u7684\u5de5\u4f5c\u4e4b\u540e \u3002 \u4e8b\u5b9e\u4e0a\uff0c\u4f7f\u7528 --rebase \u7684 pull \u7684\u5de5\u4f5c\u6d41\u662f\u5982\u6b64\u666e\u904d\uff0c\u4ee5\u81f4\u4e8e\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u9879\u4e2d\u8bbe\u7f6e\u5b83\uff1a git config --global branch.autosetuprebase always # In git < 1.7.9 git config --global pull.rebase true # In git >= 1.7.9 \u5728\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u6240\u6709\u7684 git pull \u547d\u4ee4\u5c06\u4f7f\u7528 git rebase \u800c\u4e0d\u662f git merge \u3002 2. \u63a8\u9001 \u00b6 \u4e0e\u62c9\u53d6\u7684\u987a\u5e8f\u76f8\u53cd\uff0c\u53ef\u4ee5\u8fd9\u6837\u8bb0\u5fc6\u987a\u5e8f\uff1a\u62c9\u53d6\u65f6\u5c06<\u8fdc\u7a0b\u5206\u652f>\u62c9\u53d6\u5230<\u672c\u5730\u5206\u652f>\uff1b\u63a8\u9001\u65f6\u5c06<\u672c\u5730\u5206\u652f>\u63a8\u9001\u5230<\u8fdc\u7a0b\u5206\u652f>\u3002 git push < \u8fdc\u7a0b\u4ed3\u5e93\u540d > < \u672c\u5730\u5206\u652f\u540d > : < \u8fdc\u7a0b\u5206\u652f\u540d > \u5982\u679c\u7701\u7565\u672c\u5730\u5206\u652f\u540d\uff0c\u5219\u8868\u793a\u5220\u9664\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\uff0c\u56e0\u4e3a\u8fd9\u7b49\u540c\u4e8e\u63a8\u9001\u4e00\u4e2a\u7a7a\u7684\u672c\u5730\u5206\u652f\u5230\u8fdc\u7a0b\u5206\u652f\uff1a $ git push origin :master # \u7b49\u540c\u4e8e $ git push origin --delete master","title":"\u62c9\u53d6\u4e0e\u63a8\u9001"},{"location":"git/\u62c9\u53d6\u4e0e\u63a8\u9001/#1","text":"git pull < \u8fdc\u7a0b\u4ed3\u5e93\u540d > < \u8fdc\u7a0b\u5206\u652f\u540d > : < \u672c\u5730\u5206\u652f\u540d > \u53ea\u5199\u4e00\u4e2a\u5206\u652f\u540d\u7684\u8bdd\u5c31\u8868\u793a\u8fdc\u7a0b\u5206\u652f\u540d\u4e0e\u672c\u5730\u76f8\u540c\u3002","title":"1. \u62c9\u53d6"},{"location":"git/\u62c9\u53d6\u4e0e\u63a8\u9001/#11-rebase-pull","text":"\u53c2\u8003\uff1ahttps://github.com/geeeeeeeeek/git-recipes/wiki/3.2-%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5 --rebase \u6807\u8bb0\u53ef\u4ee5\u7528\u6765\u4fdd\u8bc1\u7ebf\u6027\u7684\u9879\u76ee\u5386\u53f2\uff0c\u9632\u6b62\u5408\u5e76\u63d0\u4ea4\uff08merge commits\uff09\u7684\u4ea7\u751f\u3002\u5f88\u591a\u5f00\u53d1\u8005\u503e\u5411\u4e8e\u4f7f\u7528 rebase \u800c\u4e0d\u662f merge\uff0c\u56e0\u4e3a \u6211\u60f3\u8981\u628a\u6211\u7684\u66f4\u6539\u653e\u5728\u5176\u4ed6\u4eba\u5b8c\u6210\u7684\u5de5\u4f5c\u4e4b\u540e \u3002 \u4e8b\u5b9e\u4e0a\uff0c\u4f7f\u7528 --rebase \u7684 pull \u7684\u5de5\u4f5c\u6d41\u662f\u5982\u6b64\u666e\u904d\uff0c\u4ee5\u81f4\u4e8e\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u914d\u7f6e\u9879\u4e2d\u8bbe\u7f6e\u5b83\uff1a git config --global branch.autosetuprebase always # In git < 1.7.9 git config --global pull.rebase true # In git >= 1.7.9 \u5728\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4\u4e4b\u540e\uff0c\u6240\u6709\u7684 git pull \u547d\u4ee4\u5c06\u4f7f\u7528 git rebase \u800c\u4e0d\u662f git merge \u3002","title":"1.1 \u57fa\u4e8e Rebase \u7684 Pull"},{"location":"git/\u62c9\u53d6\u4e0e\u63a8\u9001/#2","text":"\u4e0e\u62c9\u53d6\u7684\u987a\u5e8f\u76f8\u53cd\uff0c\u53ef\u4ee5\u8fd9\u6837\u8bb0\u5fc6\u987a\u5e8f\uff1a\u62c9\u53d6\u65f6\u5c06<\u8fdc\u7a0b\u5206\u652f>\u62c9\u53d6\u5230<\u672c\u5730\u5206\u652f>\uff1b\u63a8\u9001\u65f6\u5c06<\u672c\u5730\u5206\u652f>\u63a8\u9001\u5230<\u8fdc\u7a0b\u5206\u652f>\u3002 git push < \u8fdc\u7a0b\u4ed3\u5e93\u540d > < \u672c\u5730\u5206\u652f\u540d > : < \u8fdc\u7a0b\u5206\u652f\u540d > \u5982\u679c\u7701\u7565\u672c\u5730\u5206\u652f\u540d\uff0c\u5219\u8868\u793a\u5220\u9664\u6307\u5b9a\u7684\u8fdc\u7a0b\u5206\u652f\uff0c\u56e0\u4e3a\u8fd9\u7b49\u540c\u4e8e\u63a8\u9001\u4e00\u4e2a\u7a7a\u7684\u672c\u5730\u5206\u652f\u5230\u8fdc\u7a0b\u5206\u652f\uff1a $ git push origin :master # \u7b49\u540c\u4e8e $ git push origin --delete master","title":"2. \u63a8\u9001"},{"location":"git/\u8fdc\u7a0b\u76f8\u5173/","text":"\u53c2\u8003\uff1ahttps://github.com/geeeeeeeeek/git-recipes/wiki/3.2-%E4%BF%9D%E6%8C%81%E5%90%8C%E6%AD%A5 1. git fetch \u00b6 \u5c06\u8fdc\u7a0b\u4ed3\u5e93\u7684\u63d0\u4ea4\u5b58\u50a8\u5230\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u5206\u652f\u4e2d\u3002\u6b64\u547d\u4ee4\u53ef\u4ee5\u5728\u5c06\u53d8\u66f4\u6574\u5408\u5230\u672c\u5730\u4e4b\u524d\u67e5\u770b\u5176\u4ed6\u4eba\u7684\u4fee\u6539\u3002 \u5373\u5c06\u8fdc\u7a0b\u4ed3\u5e93master\u7684\u5185\u5bb9\u5b58\u50a8\u5230 origin/master \u4e2d\uff0c\u800c\u4e0d\u662f\u672c\u5730\u7684master\u5206\u652f\u3002 \u53ef\u4ee5\u5bf9 origin/master \u8fdb\u884c\u6b63\u5e38\u7684 git log \u3001 git checkout \u7b49\u64cd\u4f5c\u3002 git fetch [ < options > ] [ < repository > [ < refspec > ...]] git fetch [ < options > ] < group > git fetch --multiple [<options>] [(<repository> | <group>)...] git fetch --all [<options>] [ root@dev git-test ] # git fetch remote: Enumerating objects: 5 , done . remote: Counting objects: 100 % ( 5 /5 ) , done . remote: Compressing objects: 100 % ( 3 /3 ) , done . remote: Total 3 ( delta 1 ) , reused 0 ( delta 0 ) Unpacking objects: 100 % ( 3 /3 ) , done . From gitee.com:ignorantshr/git-test 8a52ff8..2b43768 master -> origin/master \u5f53\u4f60\u76f8\u8981\u5e94\u7528\u8fdc\u7a0b\u7684\u53d8\u66f4\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 git merge <repository>/<refspec> \u547d\u4ee4\u5408\u5e76\u5230\u672c\u5730\u5206\u652f\u3002 [ root@dev git-test ] # git merge origin/master Updating 8a52ff8..2b43768 Fast-forward pull-test | 1 + 1 file changed, 1 insertion ( + ) \u800c git pull \u662f\u4e24\u8005\u7684\u5feb\u6377\u547d\u4ee4\u3002 2. git pull \u00b6 git pull \u76f8\u5f53\u4e8e\u5148\u6267\u884c git fetch \uff0c\u7136\u540e\u6267\u884c git merge \u3002 git pull [ options ] [ <repository> [<refspec>... ] ] -r \u6216 --rebase \u9009\u9879\u4f7f\u4f60\u53ef\u4ee5\u5c06\u5408\u5e76\u53d8\u4e3a\u7ebf\u6027\u63d0\u4ea4\uff0c\u9632\u6b62\u5408\u5e76\u63d0\u4ea4\uff08merge commits\uff09\u7684\u4ea7\u751f\u3002\u4f7f\u7528\u8be5\u9009\u9879\u610f\u5473\u7740\uff1a\u6211\u60f3\u8981\u5c06\u81ea\u5df1\u7684\u63d0\u4ea4\u653e\u5728\u6700\u65b0\u7684\u63d0\u4ea4\u4e4b\u540e\u800c\u4e0d\u4ea7\u751f\u4e00\u4e2a\u5408\u5e76\u7684\u63d0\u4ea4\u3002 \u4f8b\u5b50\uff1a \u8fdc\u7a0b\u4ed3\u5e93\u72b6\u6001 \u672c\u5730\u63d0\u4ea4\u4e00\u4e2a\u4fee\u6539 [ root@dev git-test ] # git log --oneline 6e87ba5 conflict commit 2b43768 test pull --rebase conflic \u73b0\u57286e87ba5\u4e0e\u8fdc\u7a0b\u4ed3\u5e93\u7684a9f87ab\u51b2\u7a81\u3002 \u6267\u884c git pull [ root@dev git-test ] # git pull -r remote: Enumerating objects: 5 , done . remote: Counting objects: 100 % ( 5 /5 ) , done . remote: Compressing objects: 100 % ( 2 /2 ) , done . remote: Total 3 ( delta 1 ) , reused 0 ( delta 0 ) Unpacking objects: 100 % ( 3 /3 ) , done . From gitee.com:ignorantshr/git-test 2b43768..a9f87ab master -> origin/master First, rewinding head to replay your work on top of it... Applying: conflict commit Using index info to reconstruct a base tree... M pull-test Falling back to patching base and 3 -way merge... Auto-merging pull-test \u6b64\u65f6\u81ea\u52a8\u5408\u5e76\u4e86\u51b2\u7a81\uff0c\u8fd8\u6709\u4e0d\u80fd\u81ea\u52a8\u5408\u5e76\u51b2\u7a81\u7684\u72b6\u51b5\uff0c\u6839\u636egit\u7684\u63d0\u793a\u6765\u6267\u884c\u64cd\u4f5c\u5373\u53ef\u3002 \u67e5\u770b\u672c\u5730\u63d0\u4ea4\u8bb0\u5f55 [ root@dev git-test ] # git log --oneline fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic \u4f1a\u53d1\u73b0\u81ea\u5df1\u672c\u5730\u7684\u63d0\u4ea4\u5728\u6700\u540e\u4e00\u4e2a\uff0c\u5e76\u6ca1\u6709 merge commits \u4ea7\u751f\uff0c\u4fdd\u6301\u4e86\u7ebf\u6027\u63d0\u4ea4\u5386\u53f2\u3002","title":"\u8fdc\u7a0b\u76f8\u5173"},{"location":"git/\u8fdc\u7a0b\u76f8\u5173/#1-git-fetch","text":"\u5c06\u8fdc\u7a0b\u4ed3\u5e93\u7684\u63d0\u4ea4\u5b58\u50a8\u5230\u672c\u5730\u4ed3\u5e93\u7684\u8fdc\u7a0b\u5206\u652f\u4e2d\u3002\u6b64\u547d\u4ee4\u53ef\u4ee5\u5728\u5c06\u53d8\u66f4\u6574\u5408\u5230\u672c\u5730\u4e4b\u524d\u67e5\u770b\u5176\u4ed6\u4eba\u7684\u4fee\u6539\u3002 \u5373\u5c06\u8fdc\u7a0b\u4ed3\u5e93master\u7684\u5185\u5bb9\u5b58\u50a8\u5230 origin/master \u4e2d\uff0c\u800c\u4e0d\u662f\u672c\u5730\u7684master\u5206\u652f\u3002 \u53ef\u4ee5\u5bf9 origin/master \u8fdb\u884c\u6b63\u5e38\u7684 git log \u3001 git checkout \u7b49\u64cd\u4f5c\u3002 git fetch [ < options > ] [ < repository > [ < refspec > ...]] git fetch [ < options > ] < group > git fetch --multiple [<options>] [(<repository> | <group>)...] git fetch --all [<options>] [ root@dev git-test ] # git fetch remote: Enumerating objects: 5 , done . remote: Counting objects: 100 % ( 5 /5 ) , done . remote: Compressing objects: 100 % ( 3 /3 ) , done . remote: Total 3 ( delta 1 ) , reused 0 ( delta 0 ) Unpacking objects: 100 % ( 3 /3 ) , done . From gitee.com:ignorantshr/git-test 8a52ff8..2b43768 master -> origin/master \u5f53\u4f60\u76f8\u8981\u5e94\u7528\u8fdc\u7a0b\u7684\u53d8\u66f4\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 git merge <repository>/<refspec> \u547d\u4ee4\u5408\u5e76\u5230\u672c\u5730\u5206\u652f\u3002 [ root@dev git-test ] # git merge origin/master Updating 8a52ff8..2b43768 Fast-forward pull-test | 1 + 1 file changed, 1 insertion ( + ) \u800c git pull \u662f\u4e24\u8005\u7684\u5feb\u6377\u547d\u4ee4\u3002","title":"1. git fetch"},{"location":"git/\u8fdc\u7a0b\u76f8\u5173/#2-git-pull","text":"git pull \u76f8\u5f53\u4e8e\u5148\u6267\u884c git fetch \uff0c\u7136\u540e\u6267\u884c git merge \u3002 git pull [ options ] [ <repository> [<refspec>... ] ] -r \u6216 --rebase \u9009\u9879\u4f7f\u4f60\u53ef\u4ee5\u5c06\u5408\u5e76\u53d8\u4e3a\u7ebf\u6027\u63d0\u4ea4\uff0c\u9632\u6b62\u5408\u5e76\u63d0\u4ea4\uff08merge commits\uff09\u7684\u4ea7\u751f\u3002\u4f7f\u7528\u8be5\u9009\u9879\u610f\u5473\u7740\uff1a\u6211\u60f3\u8981\u5c06\u81ea\u5df1\u7684\u63d0\u4ea4\u653e\u5728\u6700\u65b0\u7684\u63d0\u4ea4\u4e4b\u540e\u800c\u4e0d\u4ea7\u751f\u4e00\u4e2a\u5408\u5e76\u7684\u63d0\u4ea4\u3002 \u4f8b\u5b50\uff1a \u8fdc\u7a0b\u4ed3\u5e93\u72b6\u6001 \u672c\u5730\u63d0\u4ea4\u4e00\u4e2a\u4fee\u6539 [ root@dev git-test ] # git log --oneline 6e87ba5 conflict commit 2b43768 test pull --rebase conflic \u73b0\u57286e87ba5\u4e0e\u8fdc\u7a0b\u4ed3\u5e93\u7684a9f87ab\u51b2\u7a81\u3002 \u6267\u884c git pull [ root@dev git-test ] # git pull -r remote: Enumerating objects: 5 , done . remote: Counting objects: 100 % ( 5 /5 ) , done . remote: Compressing objects: 100 % ( 2 /2 ) , done . remote: Total 3 ( delta 1 ) , reused 0 ( delta 0 ) Unpacking objects: 100 % ( 3 /3 ) , done . From gitee.com:ignorantshr/git-test 2b43768..a9f87ab master -> origin/master First, rewinding head to replay your work on top of it... Applying: conflict commit Using index info to reconstruct a base tree... M pull-test Falling back to patching base and 3 -way merge... Auto-merging pull-test \u6b64\u65f6\u81ea\u52a8\u5408\u5e76\u4e86\u51b2\u7a81\uff0c\u8fd8\u6709\u4e0d\u80fd\u81ea\u52a8\u5408\u5e76\u51b2\u7a81\u7684\u72b6\u51b5\uff0c\u6839\u636egit\u7684\u63d0\u793a\u6765\u6267\u884c\u64cd\u4f5c\u5373\u53ef\u3002 \u67e5\u770b\u672c\u5730\u63d0\u4ea4\u8bb0\u5f55 [ root@dev git-test ] # git log --oneline fdd2dad conflict commit a9f87ab pull --rebase \u6f14\u793a 2b43768 test pull --rebase conflic \u4f1a\u53d1\u73b0\u81ea\u5df1\u672c\u5730\u7684\u63d0\u4ea4\u5728\u6700\u540e\u4e00\u4e2a\uff0c\u5e76\u6ca1\u6709 merge commits \u4ea7\u751f\uff0c\u4fdd\u6301\u4e86\u7ebf\u6027\u63d0\u4ea4\u5386\u53f2\u3002","title":"2. git pull"},{"location":"gluster/gluster\u5b89\u88c5/","text":"1. \u5b89\u88c5 \u00b6 \u5148\u5b89\u88c5yum\u6e90\uff0c\u8fd9\u662f\u6700\u65b0\u7248\u672c\uff1bcentos\u7684\u5e93\u4e0d\u662f\u6700\u65b0\u7248\uff0c\u5982\u679c\u7248\u672c\u4e0d\u5339\u914d\u4f1a\u9020\u6210\u6302\u8f7d\u5931\u8d25 yum install centos-release-gluster centos\u5feb\u901f\u5b89\u88c5\uff1a https://wiki.centos.org/SpecialInterestGroup/Storage/gluster-Quickstart \u5feb\u901f\u4f7f\u7528\uff1a https://gluster.readthedocs.io/en/latest/Quick-Start-Guide/Quickstart/ \u670d\u52a1\u7aef\uff1a yum install glusterfs-server \u5ba2\u6237\u7aef\uff1a # \u6302\u8f7dfuse\u6a21\u5757 modprobe fuse dmesg | grep -i fuse yum install -y centos-release-gluster sudo yum -y install openssh-server wget fuse fuse-libs openib libibverbs yum install -y glusterfs glusterfs-fuse glusterfs-rdma vi /etc/hosts # \u6dfb\u52a0\u6240\u6709\u7684\u670d\u52a1\u5668\uff0c\u5305\u62ec\u81ea\u5df1 mount\u3002\u3002\u3002\u3002 2. \u6570\u636e\u4e00\u81f4\u6027 \u00b6 2.1 \u670d\u52a1\u7aef\u7684Quorum \u00b6 cluster.server-quorum-ratio\uff1a0-100 \u4f9d\u636e\u7ed3\u70b9\u6570\u91cf >= cluster.server-quorum-type\uff1anone | server \u4e00\u65e6\u5931\u53bb\u4e86\u4e00\u81f4\u6027\uff0c\u4e0d\u53ef\u5199\u4e5f\u4e0d\u53ef\u8bfb \u4e00\u4e2avolume\u4e0d\u6ee1\u8db3quorum\u65f6\uff0c\u4efb\u4f55\u66f4\u65b0volume\u914d\u7f6e\u548c\u96c6\u7fa4\u7684\u589e\u5220\u64cd\u4f5c\u90fd\u4e0d\u80fd\u6267\u884c glusterd\u670d\u52a1\u505c\u6b62\u6216\u8005\u7f51\u7edc\u65ad\u5f00\u4f1a\u88ab\u540c\u7b49\u5bf9\u5f85 2.2 \u5ba2\u6237\u7aef\u7684Quorum \u00b6 \u5728 replicated volume brick=2\u7684\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5c06quorum-count = 2 \u624d\u80fd\u9884\u9632\u8111\u88c2 cluster.quorum-type\uff1anone|auto|fixed auto\uff1a\u5728\u7ebfbrick\u6570\u91cf>=\u603b\u7684brick\u6570\u91cf/2;fixed\u4e0equorum-count\u914d\u5408\u4f7f\u7528 cluster.quorum-count\uff1a \u4e0ecluster.quorum-type =fixed\u914d\u5408\u4f7f\u7528\uff0c\u6ee1\u8db3\u6b64\u6570\u91cf\u7684brick\u5728\u7ebf\u65f6\u624d\u5141\u8bb8\u8fdb\u884c\u5199\u64cd\u4f5c\uff1b\u5982\u679c cluster.quorum-type =auto\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9650\u5b9a\u4e0d\u8d77\u4f5c\u7528 cluster.quorum-reads\uff1ayes|no yes\u65f6\u6ee1\u8db3\u6570\u91cf\u7684brick\u5728\u7ebf\u624d\u53ef\u8bfb\u53d6 \u5982\u679c\u53ea\u6709\u4e24\u4e2a replica brick \u5e76\u4e14\u60f3\u8981\u9ad8\u53ef\u7528\u6027\uff0c\u5c31\u4e0d\u7528\u542f\u7528client-quorum 3. \u8111\u88c2\u7684\u9884\u9632\u53ca\u6062\u590d\uff1a \u00b6 https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-Managing_Split-brain#chap-Managing_Red_Hat_Storage_Volumes-splibrain_mount_point taps :\u6700\u4f18\u7684disperse volume \u6027\u80fd\u6700\u4f73\uff1a \uff08bricks - redundancy\uff09 \u4e3a2\u7684\u5e42","title":"gluster\u5b89\u88c5"},{"location":"gluster/gluster\u5b89\u88c5/#1","text":"\u5148\u5b89\u88c5yum\u6e90\uff0c\u8fd9\u662f\u6700\u65b0\u7248\u672c\uff1bcentos\u7684\u5e93\u4e0d\u662f\u6700\u65b0\u7248\uff0c\u5982\u679c\u7248\u672c\u4e0d\u5339\u914d\u4f1a\u9020\u6210\u6302\u8f7d\u5931\u8d25 yum install centos-release-gluster centos\u5feb\u901f\u5b89\u88c5\uff1a https://wiki.centos.org/SpecialInterestGroup/Storage/gluster-Quickstart \u5feb\u901f\u4f7f\u7528\uff1a https://gluster.readthedocs.io/en/latest/Quick-Start-Guide/Quickstart/ \u670d\u52a1\u7aef\uff1a yum install glusterfs-server \u5ba2\u6237\u7aef\uff1a # \u6302\u8f7dfuse\u6a21\u5757 modprobe fuse dmesg | grep -i fuse yum install -y centos-release-gluster sudo yum -y install openssh-server wget fuse fuse-libs openib libibverbs yum install -y glusterfs glusterfs-fuse glusterfs-rdma vi /etc/hosts # \u6dfb\u52a0\u6240\u6709\u7684\u670d\u52a1\u5668\uff0c\u5305\u62ec\u81ea\u5df1 mount\u3002\u3002\u3002\u3002","title":"1. \u5b89\u88c5"},{"location":"gluster/gluster\u5b89\u88c5/#2","text":"","title":"2. \u6570\u636e\u4e00\u81f4\u6027"},{"location":"gluster/gluster\u5b89\u88c5/#21-quorum","text":"cluster.server-quorum-ratio\uff1a0-100 \u4f9d\u636e\u7ed3\u70b9\u6570\u91cf >= cluster.server-quorum-type\uff1anone | server \u4e00\u65e6\u5931\u53bb\u4e86\u4e00\u81f4\u6027\uff0c\u4e0d\u53ef\u5199\u4e5f\u4e0d\u53ef\u8bfb \u4e00\u4e2avolume\u4e0d\u6ee1\u8db3quorum\u65f6\uff0c\u4efb\u4f55\u66f4\u65b0volume\u914d\u7f6e\u548c\u96c6\u7fa4\u7684\u589e\u5220\u64cd\u4f5c\u90fd\u4e0d\u80fd\u6267\u884c glusterd\u670d\u52a1\u505c\u6b62\u6216\u8005\u7f51\u7edc\u65ad\u5f00\u4f1a\u88ab\u540c\u7b49\u5bf9\u5f85","title":"2.1 \u670d\u52a1\u7aef\u7684Quorum"},{"location":"gluster/gluster\u5b89\u88c5/#22-quorum","text":"\u5728 replicated volume brick=2\u7684\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5c06quorum-count = 2 \u624d\u80fd\u9884\u9632\u8111\u88c2 cluster.quorum-type\uff1anone|auto|fixed auto\uff1a\u5728\u7ebfbrick\u6570\u91cf>=\u603b\u7684brick\u6570\u91cf/2;fixed\u4e0equorum-count\u914d\u5408\u4f7f\u7528 cluster.quorum-count\uff1a \u4e0ecluster.quorum-type =fixed\u914d\u5408\u4f7f\u7528\uff0c\u6ee1\u8db3\u6b64\u6570\u91cf\u7684brick\u5728\u7ebf\u65f6\u624d\u5141\u8bb8\u8fdb\u884c\u5199\u64cd\u4f5c\uff1b\u5982\u679c cluster.quorum-type =auto\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9650\u5b9a\u4e0d\u8d77\u4f5c\u7528 cluster.quorum-reads\uff1ayes|no yes\u65f6\u6ee1\u8db3\u6570\u91cf\u7684brick\u5728\u7ebf\u624d\u53ef\u8bfb\u53d6 \u5982\u679c\u53ea\u6709\u4e24\u4e2a replica brick \u5e76\u4e14\u60f3\u8981\u9ad8\u53ef\u7528\u6027\uff0c\u5c31\u4e0d\u7528\u542f\u7528client-quorum","title":"2.2 \u5ba2\u6237\u7aef\u7684Quorum"},{"location":"gluster/gluster\u5b89\u88c5/#3","text":"https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-Managing_Split-brain#chap-Managing_Red_Hat_Storage_Volumes-splibrain_mount_point taps :\u6700\u4f18\u7684disperse volume \u6027\u80fd\u6700\u4f73\uff1a \uff08bricks - redundancy\uff09 \u4e3a2\u7684\u5e42","title":"3. \u8111\u88c2\u7684\u9884\u9632\u53ca\u6062\u590d\uff1a"},{"location":"gluster/ovirt\u7684gluster\u6570\u636e\u6062\u590dbug/","text":"distributed-replicated volume\u7c7b\u578b\uff1a \u5220\u9664\u4e00\u4e2abrick\uff0c\u53ef\u80fd\u4f1a\u81ea\u52a8\u65b0\u5efa\u88ab\u5220\u9664\u7684brick\uff0c\u9020\u6210\u6240\u6709\u7684brick\u7684\u6743\u9650\u6539\u53d8\uff0c\u9020\u6210\u6240\u6709\u7684\u5b58\u50a8\u57df\u5931\u6548\u3002\u6b64\u65f6\u9700\u8981\u624b\u52a8\u4fee\u6539\u6240\u6709brick\u7684\u6743\u9650\uff1achmod a+xr bricks \u4e3b\u673a\u627e\u4e0d\u5230\u4e3b\u5b58\u50a8\u57df\u6216\u8005\u6302\u8f7d\u70b9\u6709\u95ee\u9898\uff1a \u91cd\u542f\u4e3b\u673a","title":"ovirt\u7684gluster\u6570\u636e\u6062\u590dbug"},{"location":"gluster/\u6e05\u7406\u4e0d\u53ef\u7528\u7684brick/","text":"mkfs.xfs -f -i size=512 device \u683c\u5f0f\u5316\u78c1\u76d8 \u5982\u679cbrick\u4e0d\u80fd\u88ab\u683c\u5f0f\u5316\uff0c\u6216\u8005\u4e0d\u80fd\u8be5\u6587\u4ef6\u5939\u4e0d\u80fd\u88ab\u79fb\u9664\uff0c\u6267\u884c\u4e0b\u9762\u7684\u6b65\u9aa4 \u5220\u9664brick\u4e0b\u9762\u6240\u6709\u7684\u6570\u636e\uff0c\u5305\u62ec.glusterfs Run # setfattr -x trusted.glusterfs.volume-id brick and # setfattr -x trusted.gfid brick to remove the attributes from the root of the brick. Run # getfattr -d -m . brick to examine the attributes set on the volume. Take note of the attributes. Run # setfattr -x attribute brick to remove the attributes relating to the glusterFS file system.","title":"\u6e05\u7406\u4e0d\u53ef\u7528\u7684brick"},{"location":"gluster/\u7ed3\u70b9\u6545\u969c/","text":"\u5728\u6545\u969c\u7ed3\u70b9\u4e0a\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4 Stop glusterd In /var/lib/glusterd, delete everything except glusterd.info (the UUID file) Start glusterd Probe one of the good peers Restart glusterd, check 'gluster peer status' taps :You may need to restart glusterd another time or two, keep checking peer status.","title":"\u7ed3\u70b9\u6545\u969c"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/","text":"1. HTTP\u62a5\u6587 \u00b6 \u7528\u4e8e HTTP \u534f\u8bae\u4ea4\u4e92\u7684\u4fe1\u606f\u88ab\u79f0\u4e3a HTTP \u62a5\u6587\u3002 \u8bf7\u6c42\u884c \u5305\u542b\u7528\u4e8e\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u8bf7\u6c42 U RI \u548c HTTP \u7248\u672c\u3002 \u72b6\u6001\u884c \u5305\u542b\u8868\u660e\u54cd\u5e94\u7ed3\u679c\u7684\u72b6\u6001\u7801\uff0c\u539f\u56e0\u77ed\u8bed\u548c HTTP \u7248\u672c\u3002 \u9996\u90e8\u5b57\u6bb5 \u5305\u542b\u8868\u793a\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5404\u79cd\u6761\u4ef6\u548c\u5c5e\u6027\u7684\u5404\u7c7b\u9996\u90e8\u3002 \u4e00\u822c\u6709 4 \u79cd\u9996\u90e8\uff0c\u5206\u522b\u662f\uff1a\u901a\u7528\u9996\u90e8\u3001\u8bf7\u6c42\u9996\u90e8\u3001\u54cd\u5e94\u9996\u90e8\u548c\u5b9e\u4f53\u9996\u90e8\u3002 \u5176\u4ed6 \u53ef\u80fd\u5305\u542b HTTP \u7684 RFC \u91cc\u672a\u5b9a\u4e49\u7684\u9996\u90e8\uff08Cook ie \u7b49\uff09\u3002 2. \u7f16\u7801\u63d0\u5347\u4f20\u8f93\u901f\u7387 \u00b6 2.1 \u62a5\u6587\u4e3b\u4f53\u548c\u5b9e\u4f53\u4e3b\u4f53\u7684\u5dee\u5f02 \u00b6 \u62a5\u6587\uff08message \uff09 \u662f HTTP \u901a\u4fe1\u4e2d\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u7531 8 \u4f4d\u7ec4\u5b57\u8282\u6d41\uff08octet sequence\uff0c \u5176\u4e2d octet \u4e3a 8 \u4e2a\u6bd4\u7279\uff09\u7ec4\u6210\uff0c\u901a\u8fc7 HTTP \u901a\u4fe1\u4f20\u8f93\u3002 \u5b9e\u4f53\uff08entity\uff09 \u4f5c\u4e3a\u8bf7\u6c42\u6216\u54cd\u5e94\u7684\u6709\u6548\u8f7d\u8377\u6570\u636e\uff08\u8865\u5145\u9879\uff09\u88ab\u4f20\u8f93\uff0c\u5176\u5185\u5bb9\u7531\u5b9e \u4f53\u9996\u90e8\u548c\u5b9e\u4f53\u4e3b\u4f53\u7ec4\u6210\u3002 HTTP \u62a5\u6587\u7684\u4e3b\u4f53\u7528\u4e8e\u4f20\u8f93\u8bf7\u6c42\u6216\u54cd\u5e94\u7684\u5b9e\u4f53\u4e3b\u4f53\u3002 \u901a\u5e38\uff0c\u62a5\u6587\u4e3b\u4f53\u7b49\u4e8e\u5b9e\u4f53\u4e3b\u4f53\u3002\u53ea\u6709\u5f53\u4f20\u8f93\u4e2d\u8fdb\u884c\u7f16\u7801\u64cd\u4f5c\u65f6\uff0c\u5b9e\u4f53\u4e3b\u4f53\u7684\u5185\u5bb9\u53d1\u751f\u53d8\u5316\uff0c\u624d\u5bfc\u81f4\u5b83\u548c\u62a5\u6587\u4e3b\u4f53\u4ea7\u751f\u5dee\u5f02\u3002 2.2 \u538b\u7f29\u4f20\u8f93\u7684\u5185\u5bb9\u7f16\u7801 \u00b6 \u5c06\u5b9e\u4f53\u7f16\u7801\u538b\u7f29\u540e\u8fdb\u884c\u4f20\u8f93\u3002\u670d\u52a1\u7aef\u538b\u7f29\uff0c\u5ba2\u6237\u7aef\u6062\u590d\u3002 \u5185\u5bb9\u7f16\u7801\u7684\u7c7b\u578b\uff1a gzip \uff08GNU zip\uff09 compress\uff08UNIX \u7cfb\u7edf\u7684\u6807\u51c6\u538b\u7f29\uff09 deflate \uff08zlib \uff09 identity\uff08\u4e0d\u8fdb\u884c\u7f16\u7801\uff09 2.3 \u5206\u5272\u53d1\u9001\u7684\u5206\u5757\u4f20\u8f93\u7f16\u7801 \u00b6 \u628a\u5b9e\u4f53\u4e3b\u4f53\u5206\u5757\u4f20\u8f93\u3002\u8fd9\u79cd\u529f\u80fd\u53eb\u505a \u5206\u5757\u4f20\u8f93\u7f16\u7801 \uff08Chunked Transfer Coding\uff09\u3002\u670d\u52a1\u7aef\u538b\u7f29\uff0c\u5ba2\u6237\u7aef\u89e3\u7801\u6062\u590d\u3002 \u6bcf\u4e00\u5757\u90fd\u4f1a\u7528\u5341\u516d\u8fdb\u5236\u6765\u6807\u8bb0\u5757\u7684\u5927\u5c0f\uff0c\u800c\u5b9e\u4f53\u4e3b\u4f53\u7684\u6700\u540e\u4e00\u5757\u4f1a\u4f7f\u7528\u201c0(CR+L F)\u201d\u6765\u6807\u8bb0\u3002 3. \u53d1\u9001\u591a\u79cd\u6570\u636e\u7684\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408 \u00b6 HTTP \u534f\u8bae\u4e2d\u4e5f\u91c7\u7eb3\u4e86\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\uff0c\u53d1\u9001\u7684\u4e00\u4efd\u62a5\u6587\u4e3b\u4f53\u5185\u53ef\u542b\u6709\u591a\u7c7b\u578b\u5b9e\u4f53\u3002 \u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u5305\u542b\u7684\u5bf9\u8c61\u5982\u4e0b\uff1a multipart/form-data \u5728 W eb \u8868\u5355\u6587\u4ef6\u4e0a\u4f20\u65f6\u4f7f\u7528\u3002 multipart/byteranges \u72b6\u6001\u7801 206\uff08Partial Content\uff0c\u90e8\u5206\u5185\u5bb9\uff09\u54cd\u5e94\u62a5\u6587\u5305\u542b\u4e86\u591a\u4e2a\u8303\u56f4\u7684\u5185\u5bb9\u65f6\u4f7f\u7528\u3002 \u5728 HTTP \u62a5\u6587\u4e2d\u4f7f\u7528\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u65f6\uff0c\u9700\u8981\u5728\u9996\u90e8\u5b57\u6bb5\u91cc\u52a0\u4e0aContent-type\u3002 \u4f7f\u7528 boundary \u5b57\u7b26\u4e32\u6765\u5212\u5206\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u6307\u660e\u7684\u5404\u7c7b\u5b9e\u4f53\u3002 \u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u7684\u6bcf\u4e2a\u90e8\u5206\u7c7b\u578b\u4e2d\uff0c\u90fd\u53ef\u4ee5\u542b\u6709\u9996\u90e8\u5b57\u6bb5\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u5728\u67d0\u4e2a\u90e8\u5206\u4e2d\u5d4c\u5957\u4f7f\u7528\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u3002 4. \u83b7\u53d6\u90e8\u5206\u5185\u5bb9\u7684\u8303\u56f4\u8bf7\u6c42 \u00b6 \u6307\u5b9a\u8303\u56f4\u53d1\u9001\u7684\u8bf7\u6c42\u53eb\u505a\u8303\u56f4\u8bf7\u6c42\uff08Range Request\uff09\u3002 \u9488\u5bf9\u8303\u56f4\u8bf7\u6c42\uff0c\u54cd\u5e94\u4f1a\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 206 Partial Content \u7684\u54cd\u5e94\u62a5\u6587\u3002\u53e6\u5916\uff0c\u5bf9\u4e8e\u591a\u91cd\u8303\u56f4\u7684\u8303\u56f4\u8bf7\u6c42\uff0c\u54cd\u5e94\u4f1a\u5728\u9996\u90e8\u5b57\u6bb5 Content Type \u6807\u660e multipart/byteranges \u540e\u8fd4\u56de\u54cd\u5e94\u62a5\u6587\u3002 \u5982\u679c\u670d\u52a1\u5668\u7aef\u65e0\u6cd5\u54cd\u5e94\u8303\u56f4\u8bf7\u6c42\uff0c\u5219\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u548c\u5b8c\u6574\u7684\u5b9e\u4f53\u5185\u5bb9\u3002 5. \u5185\u5bb9\u534f\u5546\u8fd4\u56de\u6700\u5408\u9002\u7684\u5185\u5bb9 \u00b6 \u5185\u5bb9\u534f\u5546\u673a\u5236\u662f\u6307\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u5c31\u54cd\u5e94\u7684\u8d44\u6e90\u5185\u5bb9\u8fdb\u884c\u4ea4\u6d89\uff0c\u7136\u540e\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7aef\u6700\u4e3a\u9002\u5408\u7684\u8d44\u6e90\u3002\u5185\u5bb9\u534f\u5546\u4f1a\u4ee5\u54cd\u5e94\u8d44\u6e90\u7684\u8bed\u8a00\u3001\u5b57\u7b26\u96c6\u3001\u7f16\u7801\u65b9\u5f0f\u7b49\u4f5c\u4e3a\u5224\u65ad\u7684\u57fa\u51c6\u3002 \u6709\u4ee5\u4e0b\u4e09\u79cd\u7c7b\u578b\uff1a \u670d\u52a1\u5668\u9a71\u52a8\u534f\u5546\uff08Server-driven Negotiation\uff09 \u5ba2\u6237\u7aef\u9a71\u52a8\u534f\u5546\uff08Agent-driven Negotiation\uff09 \u900f\u660e\u534f\u5546\uff08Transparent Negotiation\uff09","title":"HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f.md"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#1-http","text":"\u7528\u4e8e HTTP \u534f\u8bae\u4ea4\u4e92\u7684\u4fe1\u606f\u88ab\u79f0\u4e3a HTTP \u62a5\u6587\u3002 \u8bf7\u6c42\u884c \u5305\u542b\u7528\u4e8e\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u8bf7\u6c42 U RI \u548c HTTP \u7248\u672c\u3002 \u72b6\u6001\u884c \u5305\u542b\u8868\u660e\u54cd\u5e94\u7ed3\u679c\u7684\u72b6\u6001\u7801\uff0c\u539f\u56e0\u77ed\u8bed\u548c HTTP \u7248\u672c\u3002 \u9996\u90e8\u5b57\u6bb5 \u5305\u542b\u8868\u793a\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5404\u79cd\u6761\u4ef6\u548c\u5c5e\u6027\u7684\u5404\u7c7b\u9996\u90e8\u3002 \u4e00\u822c\u6709 4 \u79cd\u9996\u90e8\uff0c\u5206\u522b\u662f\uff1a\u901a\u7528\u9996\u90e8\u3001\u8bf7\u6c42\u9996\u90e8\u3001\u54cd\u5e94\u9996\u90e8\u548c\u5b9e\u4f53\u9996\u90e8\u3002 \u5176\u4ed6 \u53ef\u80fd\u5305\u542b HTTP \u7684 RFC \u91cc\u672a\u5b9a\u4e49\u7684\u9996\u90e8\uff08Cook ie \u7b49\uff09\u3002","title":"1. HTTP\u62a5\u6587"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#2","text":"","title":"2. \u7f16\u7801\u63d0\u5347\u4f20\u8f93\u901f\u7387"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#21","text":"\u62a5\u6587\uff08message \uff09 \u662f HTTP \u901a\u4fe1\u4e2d\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u7531 8 \u4f4d\u7ec4\u5b57\u8282\u6d41\uff08octet sequence\uff0c \u5176\u4e2d octet \u4e3a 8 \u4e2a\u6bd4\u7279\uff09\u7ec4\u6210\uff0c\u901a\u8fc7 HTTP \u901a\u4fe1\u4f20\u8f93\u3002 \u5b9e\u4f53\uff08entity\uff09 \u4f5c\u4e3a\u8bf7\u6c42\u6216\u54cd\u5e94\u7684\u6709\u6548\u8f7d\u8377\u6570\u636e\uff08\u8865\u5145\u9879\uff09\u88ab\u4f20\u8f93\uff0c\u5176\u5185\u5bb9\u7531\u5b9e \u4f53\u9996\u90e8\u548c\u5b9e\u4f53\u4e3b\u4f53\u7ec4\u6210\u3002 HTTP \u62a5\u6587\u7684\u4e3b\u4f53\u7528\u4e8e\u4f20\u8f93\u8bf7\u6c42\u6216\u54cd\u5e94\u7684\u5b9e\u4f53\u4e3b\u4f53\u3002 \u901a\u5e38\uff0c\u62a5\u6587\u4e3b\u4f53\u7b49\u4e8e\u5b9e\u4f53\u4e3b\u4f53\u3002\u53ea\u6709\u5f53\u4f20\u8f93\u4e2d\u8fdb\u884c\u7f16\u7801\u64cd\u4f5c\u65f6\uff0c\u5b9e\u4f53\u4e3b\u4f53\u7684\u5185\u5bb9\u53d1\u751f\u53d8\u5316\uff0c\u624d\u5bfc\u81f4\u5b83\u548c\u62a5\u6587\u4e3b\u4f53\u4ea7\u751f\u5dee\u5f02\u3002","title":"2.1 \u62a5\u6587\u4e3b\u4f53\u548c\u5b9e\u4f53\u4e3b\u4f53\u7684\u5dee\u5f02"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#22","text":"\u5c06\u5b9e\u4f53\u7f16\u7801\u538b\u7f29\u540e\u8fdb\u884c\u4f20\u8f93\u3002\u670d\u52a1\u7aef\u538b\u7f29\uff0c\u5ba2\u6237\u7aef\u6062\u590d\u3002 \u5185\u5bb9\u7f16\u7801\u7684\u7c7b\u578b\uff1a gzip \uff08GNU zip\uff09 compress\uff08UNIX \u7cfb\u7edf\u7684\u6807\u51c6\u538b\u7f29\uff09 deflate \uff08zlib \uff09 identity\uff08\u4e0d\u8fdb\u884c\u7f16\u7801\uff09","title":"2.2 \u538b\u7f29\u4f20\u8f93\u7684\u5185\u5bb9\u7f16\u7801"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#23","text":"\u628a\u5b9e\u4f53\u4e3b\u4f53\u5206\u5757\u4f20\u8f93\u3002\u8fd9\u79cd\u529f\u80fd\u53eb\u505a \u5206\u5757\u4f20\u8f93\u7f16\u7801 \uff08Chunked Transfer Coding\uff09\u3002\u670d\u52a1\u7aef\u538b\u7f29\uff0c\u5ba2\u6237\u7aef\u89e3\u7801\u6062\u590d\u3002 \u6bcf\u4e00\u5757\u90fd\u4f1a\u7528\u5341\u516d\u8fdb\u5236\u6765\u6807\u8bb0\u5757\u7684\u5927\u5c0f\uff0c\u800c\u5b9e\u4f53\u4e3b\u4f53\u7684\u6700\u540e\u4e00\u5757\u4f1a\u4f7f\u7528\u201c0(CR+L F)\u201d\u6765\u6807\u8bb0\u3002","title":"2.3 \u5206\u5272\u53d1\u9001\u7684\u5206\u5757\u4f20\u8f93\u7f16\u7801"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#3","text":"HTTP \u534f\u8bae\u4e2d\u4e5f\u91c7\u7eb3\u4e86\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\uff0c\u53d1\u9001\u7684\u4e00\u4efd\u62a5\u6587\u4e3b\u4f53\u5185\u53ef\u542b\u6709\u591a\u7c7b\u578b\u5b9e\u4f53\u3002 \u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u5305\u542b\u7684\u5bf9\u8c61\u5982\u4e0b\uff1a multipart/form-data \u5728 W eb \u8868\u5355\u6587\u4ef6\u4e0a\u4f20\u65f6\u4f7f\u7528\u3002 multipart/byteranges \u72b6\u6001\u7801 206\uff08Partial Content\uff0c\u90e8\u5206\u5185\u5bb9\uff09\u54cd\u5e94\u62a5\u6587\u5305\u542b\u4e86\u591a\u4e2a\u8303\u56f4\u7684\u5185\u5bb9\u65f6\u4f7f\u7528\u3002 \u5728 HTTP \u62a5\u6587\u4e2d\u4f7f\u7528\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u65f6\uff0c\u9700\u8981\u5728\u9996\u90e8\u5b57\u6bb5\u91cc\u52a0\u4e0aContent-type\u3002 \u4f7f\u7528 boundary \u5b57\u7b26\u4e32\u6765\u5212\u5206\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u6307\u660e\u7684\u5404\u7c7b\u5b9e\u4f53\u3002 \u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u7684\u6bcf\u4e2a\u90e8\u5206\u7c7b\u578b\u4e2d\uff0c\u90fd\u53ef\u4ee5\u542b\u6709\u9996\u90e8\u5b57\u6bb5\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u5728\u67d0\u4e2a\u90e8\u5206\u4e2d\u5d4c\u5957\u4f7f\u7528\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408\u3002","title":"3. \u53d1\u9001\u591a\u79cd\u6570\u636e\u7684\u591a\u90e8\u5206\u5bf9\u8c61\u96c6\u5408"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#4","text":"\u6307\u5b9a\u8303\u56f4\u53d1\u9001\u7684\u8bf7\u6c42\u53eb\u505a\u8303\u56f4\u8bf7\u6c42\uff08Range Request\uff09\u3002 \u9488\u5bf9\u8303\u56f4\u8bf7\u6c42\uff0c\u54cd\u5e94\u4f1a\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 206 Partial Content \u7684\u54cd\u5e94\u62a5\u6587\u3002\u53e6\u5916\uff0c\u5bf9\u4e8e\u591a\u91cd\u8303\u56f4\u7684\u8303\u56f4\u8bf7\u6c42\uff0c\u54cd\u5e94\u4f1a\u5728\u9996\u90e8\u5b57\u6bb5 Content Type \u6807\u660e multipart/byteranges \u540e\u8fd4\u56de\u54cd\u5e94\u62a5\u6587\u3002 \u5982\u679c\u670d\u52a1\u5668\u7aef\u65e0\u6cd5\u54cd\u5e94\u8303\u56f4\u8bf7\u6c42\uff0c\u5219\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u548c\u5b8c\u6574\u7684\u5b9e\u4f53\u5185\u5bb9\u3002","title":"4. \u83b7\u53d6\u90e8\u5206\u5185\u5bb9\u7684\u8303\u56f4\u8bf7\u6c42"},{"location":"http\u534f\u8bae/HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f/#5","text":"\u5185\u5bb9\u534f\u5546\u673a\u5236\u662f\u6307\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u5c31\u54cd\u5e94\u7684\u8d44\u6e90\u5185\u5bb9\u8fdb\u884c\u4ea4\u6d89\uff0c\u7136\u540e\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7aef\u6700\u4e3a\u9002\u5408\u7684\u8d44\u6e90\u3002\u5185\u5bb9\u534f\u5546\u4f1a\u4ee5\u54cd\u5e94\u8d44\u6e90\u7684\u8bed\u8a00\u3001\u5b57\u7b26\u96c6\u3001\u7f16\u7801\u65b9\u5f0f\u7b49\u4f5c\u4e3a\u5224\u65ad\u7684\u57fa\u51c6\u3002 \u6709\u4ee5\u4e0b\u4e09\u79cd\u7c7b\u578b\uff1a \u670d\u52a1\u5668\u9a71\u52a8\u534f\u5546\uff08Server-driven Negotiation\uff09 \u5ba2\u6237\u7aef\u9a71\u52a8\u534f\u5546\uff08Agent-driven Negotiation\uff09 \u900f\u660e\u534f\u5546\uff08Transparent Negotiation\uff09","title":"5. \u5185\u5bb9\u534f\u5546\u8fd4\u56de\u6700\u5408\u9002\u7684\u5185\u5bb9"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/","text":"HTTP \u9996\u90e8\u7ed3\u6784\uff0c\u4ee5\u53ca\u9996\u90e8\u4e2d\u5404\u5b57\u6bb5\u7684\u7528\u6cd5\u3002 1. HTTP \u62a5\u6587\u9996\u90e8 \u00b6 \u53c2\u8003 HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f \uff0c\u672c\u4e66\u4e3b\u8981\u6d89\u53ca HTTP/1.1 \u53ca\u5e38\u7528\u7684\u9996\u90e8\u5b57\u6bb5\u3002 2. HTTP \u9996\u90e8\u5b57\u6bb5 \u00b6 2.1 HTTP \u9996\u90e8\u5b57\u6bb5\u7ed3\u6784 \u00b6 \u9996\u90e8\u5b57\u6bb5\u540d: \u5b57\u6bb5\u503c 1 ,\u5b57\u6bb5\u503c 2 ,... HTTP \u9996\u90e8\u5b57\u6bb5\u91cd\u590d\u7684\u5904\u7406\u65b9\u5f0f\u6839\u636e\u6d4f\u89c8\u5668\u5185\u90e8\u7684\u903b\u8f91\u51b3\u5b9a\u3002 2.2 \u5404\u79cd\u5b57\u6bb5\u6982\u89c8 \u00b6 2.3 \u975e HTTP/1.1 \u9996\u90e8\u5b57\u6bb5 \u00b6 \u4e0d\u9650\u4e8e RFC2616 \u4e2d\u5b9a\u4e49\u7684 47 \u79cd\u9996\u90e8\u5b57\u6bb5\uff0c\u5176\u5b83\u975e\u6b63\u5f0f\u7684\u9996\u90e8\u5b57\u6bb5\u7edf\u4e00\u5f52\u7eb3\u5728 RFC4229 HTTP Header Field Registrations \u4e2d\u3002 2.4 End-to-end \u9996\u90e8\u548c Hop-by-hop \u9996\u90e8 \u00b6 HTTP \u9996\u90e8\u5b57\u6bb5\u5c06\u5b9a\u4e49\u6210\u7f13\u5b58\u4ee3\u7406\u548c\u975e\u7f13\u5b58\u4ee3\u7406\u7684\u884c\u4e3a\uff0c\u5206\u6210 2 \u79cd\u7c7b\u578b\u3002 \u7aef\u5230\u7aef\u9996\u90e8\uff08End-to-end Header\uff09 \u5206\u5728\u6b64\u7c7b\u522b\u4e2d\u7684\u9996\u90e8\u4f1a\u8f6c\u53d1\u7ed9\u8bf7\u6c42 / \u54cd\u5e94\u5bf9\u5e94\u7684\u6700\u7ec8\u63a5\u6536\u76ee\u6807\uff0c\u4e14\u5fc5\u987b\u4fdd\u5b58\u5728\u7531\u7f13\u5b58\u751f\u6210\u7684\u54cd\u5e94\u4e2d\uff0c\u53e6\u5916\u89c4\u5b9a\u5b83\u5fc5\u987b\u88ab\u8f6c\u53d1\u3002 \u9010\u8df3\u9996\u90e8\uff08Hop-by-hop Header\uff09 \u5206\u5728\u6b64\u7c7b\u522b\u4e2d\u7684\u9996\u90e8\u53ea\u5bf9\u5355\u6b21\u8f6c\u53d1\u6709\u6548\uff0c\u4f1a\u56e0\u901a\u8fc7\u7f13\u5b58\u6216\u4ee3\u7406\u800c\u4e0d\u518d\u8f6c\u53d1\u3002HTTP/1.1 \u548c\u4e4b\u540e\u7248\u672c\u4e2d\uff0c\u5982\u679c\u8981\u4f7f\u7528 hop-by -hop \u9996\u90e8\uff0c\u9700\u63d0\u4f9b Connection \u9996\u90e8\u5b57\u6bb5\u3002 \u9664\u8fd9 8 \u4e2a\u9996\u90e8\u5b57\u6bb5\u4e4b\u5916\uff0c\u5176\u4ed6\u6240\u6709\u5b57\u6bb5\u90fd\u5c5e\u4e8e\u7aef\u5230\u7aef\u9996\u90e8\uff1a Connection Keep-Alive Proxy-Authenticate Proxy-Authorization Trailer TE Transfer-Encoding Upgrade 3. HTTP/1.1 \u901a\u7528\u9996\u90e8\u5b57\u6bb5 \u00b6 3.1 Cache -Control \u00b6 \u63a7\u5236\u7f13\u5b58\u7684\u884c\u4e3a\u3002 \u6307\u4ee4\u4e00\u89c8\uff1a \u8be6\u7ec6\u8bf4\u660e\u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.3.1 \u8282\u3002 3.2 Connecti on \u00b6 \u63a7\u5236\u4e0d\u518d\u8f6c\u53d1\u7ed9\u4ee3\u7406\u7684\u9996\u90e8\u5b57\u6bb5 Connection: \u4e0d\u518d\u8f6c\u53d1\u7684\u9996\u90e8\u5b57\u6bb5\u540d \u7ba1\u7406\u6301\u4e45\u8fde\u63a5 Connection: close/Keep-Alive HTTP/1.1\u4e4b\u540e\u9ed8\u8ba4\u662f\u6301\u4e45\u5316\u8fde\u63a5\uff1b\u4e4b\u524d\u662f\u975e\u6301\u4e45\u5316\u8fde\u63a5\u3002\u4f7f\u7528\u6b64\u9996\u90e8\u6539\u53d8\u8fde\u63a5\u7684\u6301\u4e45\u5316\u72b6\u6001\u3002 3.3 Date \u00b6 HTTP/1.1 \u534f\u8bae\u4f7f\u7528\u5728 RFC1123 \u4e2d\u89c4\u5b9a\u7684\u65e5\u671f\u65f6\u95f4\u7684\u683c\u5f0f\uff1a Date: Tue, 03 Jul 2012 04 : 40 : 59 GMT \u524d\u7684 HTTP \u534f\u8bae\u7248\u672c\u4e2d\u4f7f\u7528\u5728 RFC850 \u4e2d\u5b9a\u4e49\u7684\u683c\u5f0f\uff1a Date: Tue, 03 -Jul -12 04 : 40 : 59 GMT \u8fd8\u6709\u4e00\u79cd\u683c\u5f0f\u3002\u5b83\u4e0e C \u6807\u51c6\u5e93\u5185\u7684 asct im e() \u51fd\u6570\u7684\u8f93\u51fa\u683c\u5f0f\u4e00\u81f4\uff1a Date: Tue Jul 03 04 : 40 : 59 2012 3.4 Pragma \u00b6 Pragma \u662f HTTP/1.1 \u4e4b\u524d\u7248\u672c\u7684\u5386\u53f2\u9057\u7559\u5b57\u6bb5\uff0c\u4ec5\u4f5c\u4e3a\u4e0e HTTP/1.0\u7684\u5411\u540e\u517c\u5bb9\u800c\u5b9a\u4e49\u3002 Pragma: no-cache \u8be5\u9996\u90e8\u5b57\u6bb5\u5c5e\u4e8e\u901a\u7528\u9996\u90e8\u5b57\u6bb5\uff0c\u4f46\u53ea\u7528\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u4e2d\u3002\u5ba2\u6237\u7aef\u4f1a\u8981\u6c42\u6240\u6709\u7684\u4e2d\u95f4\u670d\u52a1\u5668\u4e0d\u8fd4\u56de\u7f13\u5b58\u7684\u8d44\u6e90\u3002 \u53d1\u9001\u7684\u8bf7\u6c42\u4f1a\u540c\u65f6\u542b\u6709\u4e0b\u9762\u4e24\u4e2a\u9996\u90e8\u5b57\u6bb5\u6765\u4fdd\u8bc1\u6240\u6709\u7248\u672c\u7684HTTP\u534f\u8bae\u6709\u76f8\u540c\u7684\u7f13\u5b58\u65b9\u5f0f\uff1a Cache-Control: no-cache Pragma: no-cache 3.5 Trailer \u00b6 Trailer \u4f1a\u4e8b\u5148\u8bf4\u660e\u5728\u62a5\u6587\u4e3b\u4f53\u540e\u8bb0\u5f55\u4e86\u54ea\u4e9b\u9996\u90e8\u5b57\u6bb5\u3002\u8be5\u9996\u90e8\u5b57\u6bb5\u53ef\u5e94\u7528\u5728 HTTP/1.1 \u7248\u672c\u5206\u5757\u4f20\u8f93\u7f16\u7801\u65f6\u3002 ... Trailer: Expires ...(\u62a5\u6587\u4e3b\u4f53)... Expires: Tue, 28 Sep 2004 23 : 59 : 59 GMT 3.6 Transfer-Encoding \u00b6 \u89c4\u5b9a\u4e86\u4f20\u8f93\u62a5\u6587\u4e3b\u4f53\u65f6\u91c7\u7528\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u4ec5\u5bf9\u5206\u5757\u4f20\u8f93\u7f16\u7801\u6709\u6548\u3002 ... Transfer-Encoding: chunked Connection: keep-alive cf 0 \u2190 16 \u8fdb\u5236( 10 \u8fdb\u5236\u4e3a 3312 ) ... 3312 \u5b57\u8282\u5206\u5757\u6570\u636e... 392 \u2190 16 \u8fdb\u5236( 10 \u8fdb\u5236\u4e3a 914 ) ... 914 \u5b57\u8282\u5206\u5757\u6570\u636e... 0 3.7 Upgrade \u00b6 \u7528\u4e8e\u68c0\u6d4b HTTP \u534f\u8bae\u53ca\u5176\u4ed6\u534f\u8bae\u662f\u5426\u53ef\u4f7f\u7528\u66f4\u9ad8\u7684\u7248\u672c\u8fdb\u884c\u901a\u4fe1\uff0c\u5176\u53c2\u6570\u503c\u53ef\u4ee5\u7528\u6765\u6307\u5b9a\u4e00\u4e2a\u5b8c\u5168\u4e0d\u540c\u7684\u901a\u4fe1\u534f\u8bae\u3002 Upgrade \u9996\u90e8\u5b57\u6bb5\u4ea7\u751f\u4f5c\u7528\u7684 Upgrade \u5bf9\u8c61\u4ec5\u9650\u4e8e\u5ba2\u6237\u7aef\u548c\u90bb\u63a5\u670d\u52a1\u5668\u4e4b\u95f4\u3002\u56e0\u6b64\uff0c\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 Upgrade \u65f6\uff0c\u8fd8\u9700\u8981\u989d\u5916\u6307\u5b9a Connection :Upgrade \u3002 \u670d\u52a1\u5668\u53ef\u7528 101 Switching Protocols \u72b6\u6001\u7801\u4f5c\u4e3a\u54cd\u5e94\u8fd4\u56de\u3002 3.8 Via \u00b6 \u4e3a\u4e86\u8ffd\u8e2a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u62a5\u6587\u7684\u4f20\u8f93\u8def\u5f84\u3002 \u62a5\u6587\u7ecf\u8fc7\u4ee3\u7406\u6216\u7f51\u5173\u65f6\uff0c\u4f1a\u5148\u5728\u9996\u90e8\u5b57\u6bb5 Via \u4e2d\u9644\u52a0\u8be5\u670d\u52a1\u5668\u7684\u4fe1\u606f\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8f6c\u53d1\u3002 \u9996\u90e8\u5b57\u6bb5 Via \u4e0d\u4ec5\u7528\u4e8e\u8ffd\u8e2a\u62a5\u6587\u7684\u8f6c\u53d1\uff0c\u8fd8\u53ef\u907f\u514d\u8bf7\u6c42\u56de\u73af\u7684\u53d1\u751f\uff0c\u6240\u4ee5\u5fc5\u987b\u5728\u7ecf\u8fc7\u4ee3\u7406\u65f6\u9644\u52a0\u8be5\u9996\u90e8\u5b57\u6bb5\u5185\u5bb9\u3002 Via \u9996\u90e8\u662f\u4e3a\u4e86\u8ffd\u8e2a\u4f20\u8f93\u8def\u5f84\uff0c\u6240\u4ee5\u7ecf\u5e38\u4f1a\u548c TRACE \u65b9\u6cd5\u4e00\u8d77\u4f7f\u7528\u3002 3.9 Warning \u00b6 \u8be5\u9996\u90e8\u901a\u5e38\u4f1a\u544a\u77e5\u7528\u6237\u4e00\u4e9b\u4e0e\u7f13\u5b58\u76f8\u5173\u7684\u95ee\u9898\u7684\u8b66\u544a\u3002 \u683c\u5f0f\uff08\u65e5\u671f\u53ef\u7701\u7565\uff09\uff1a Warning: [ \u8b66\u544a\u7801 ][ \u8b66\u544a\u7684\u4e3b\u673a:\u7aef\u53e3\u53f7 ] \u201c [ \u8b66\u544a\u5185\u5bb9 ] \u201d( [ \u65e5\u671f\u65f6\u95f4 ] ) 4. \u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5 \u00b6 \u7528\u4e8e\u8865\u5145\u8bf7\u6c42\u7684\u9644\u52a0\u4fe1\u606f\u3001\u5ba2\u6237\u7aef\u4fe1\u606f\u3001\u5bf9\u54cd\u5e94\u5185\u5bb9\u76f8\u5173\u7684\u4f18\u5148\u7ea7\u7b49\u5185\u5bb9\u3002 4.1 Accept \u00b6 Accept \u9996\u90e8\u5b57\u6bb5\u53ef\u901a\u77e5\u670d\u52a1\u5668\uff0c\u7528\u6237\u4ee3\u7406\u80fd\u591f\u5904\u7406\u7684\u5a92\u4f53\u7c7b\u578b\u53ca\u5a92\u4f53\u7c7b\u578b\u7684\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002\u53ef\u4f7f\u7528 type/subtype \u8fd9\u79cd\u5f62\u5f0f\uff0c\u4e00\u6b21\u6307\u5b9a\u591a\u79cd\u5a92\u4f53\u7c7b\u578b\u3002 \u4f7f\u7528 q= \u6765\u989d\u5916\u8868\u793a\u6743\u91cd\u503c\uff0c\u7528\u5206\u53f7\uff08;\uff09\u8fdb\u884c\u5206\u9694\u3002\u8303\u56f4\u662f 0~1\uff08\u53ef\u7cbe\u786e\u5230\u5c0f\u6570\u70b9\u540e 3 \u4f4d\uff09\uff0c\u4e14 1 \u4e3a\u6700\u5927\u503c\uff0c\u9ed8\u8ba4\u503c\u662f1.0\u3002 \u4f8b\u5b50\uff0c\u4f18\u5148\u53d1\u9001plain\u6587\u672c\u6587\u4ef6\uff1a Accept: text/html; q= 0.5 , text/plain 4.2 Accept-Charset \u00b6 Accept-Charset \u9996\u90e8\u5b57\u6bb5\u53ef\u7528\u6765\u901a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u652f\u6301\u7684\u5b57\u7b26\u96c6\u53ca\u5b57\u7b26\u96c6\u7684\u76f8\u5bf9\u4f18\u5148\u987a\u5e8f\u3002\u4e5f\u53ef\u6307\u5b9a\u6743\u91cd\u503c\u3002 \u8be5\u9996\u90e8\u5b57\u6bb5\u5e94\u7528\u4e8e\u5185\u5bb9\u534f\u5546\u673a\u5236\u7684\u670d\u52a1\u5668\u9a71\u52a8\u534f\u5546\u3002 4.3 Accept-Encoding \u00b6 Accept-Encoding \u9996\u90e8\u5b57\u6bb5\u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u652f\u6301\u7684\u5185\u5bb9\u7f16\u7801\u53ca\u5185\u5bb9\u7f16\u7801\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\u3002 Accept-Encoding: gzip, deflate gzip \uff08GNU zip\uff09 compress\uff08UNIX \u7cfb\u7edf\u7684\u6807\u51c6\u538b\u7f29\uff09 deflate \uff08zlib \uff09 identity\uff08\u4e0d\u8fdb\u884c\u7f16\u7801\uff09 \u91c7\u7528\u6743\u91cd q \u503c\u6765\u8868\u793a\u76f8\u5bf9\u4f18\u5148\u7ea7\uff0c\u4e5f\u53ef\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u4f5c\u4e3a\u901a\u914d\u7b26\uff0c\u6307\u5b9a\u4efb\u610f\u7684\u7f16\u7801\u683c\u5f0f\u3002 4.4 Accept-Language \u00b6 Accept-Language \u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u80fd\u591f\u5904\u7406\u7684\u81ea\u7136\u8bed\u8a00\u96c6\uff08\u6307\u4e2d\u6587\u6216\u82f1\u6587\u7b49\uff09\uff0c\u4ee5\u53ca\u81ea\u7136\u8bed\u8a00\u96c6\u7684\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002 \u652f\u6301 q \u503c\u3002 4.5 Authorization \u00b6 Authorization \u662f\u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\uff0c\u7528\u6237\u4ee3\u7406\u7684\u8ba4\u8bc1\u4fe1\u606f\uff08\u8bc1\u4e66\u503c\uff09\u3002\u901a\u5e38\uff0c\u60f3\u8981\u901a\u8fc7\u670d\u52a1\u5668\u8ba4\u8bc1\u7684\u7528\u6237\u4ee3\u7406\u4f1a\u5728\u63a5\u6536\u5230\u8fd4\u56de\u7684 401 \u72b6\u6001\u7801\u54cd\u5e94\u540e\uff0c\u628a\u9996\u90e8\u5b57\u6bb5 Authorization \u52a0\u5165\u8bf7\u6c42\u4e2d\u3002 4.6 Expect \u00b6 Expect \u6765\u544a\u77e5\u670d\u52a1\u5668\uff0c\u671f\u671b\u51fa\u73b0\u7684\u67d0\u79cd\u7279\u5b9a\u884c\u4e3a\u3002 \u56e0\u670d\u52a1\u5668\u65e0\u6cd5\u7406\u89e3\u5ba2\u6237\u7aef\u7684\u671f\u671b\u4f5c\u51fa\u56de\u5e94\u800c\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 417 Expectation Failed\u3002 \u7b49\u5f85\u72b6\u6001\u7801 100 \u54cd\u5e94\u7684\u5ba2\u6237\u7aef\u5728\u53d1\u751f\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u6307\u5b9a Expectt :100-continue \u3002 4.7 From \u00b6 \u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u4f7f\u7528\u7528\u6237\u4ee3\u7406\u7684\u7528\u6237\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u3002\u4f7f\u7528\u4ee3\u7406\u65f6\uff0c\u5e94\u5c3d\u53ef\u80fd\u5305\u542b From \u9996\u90e8\u5b57\u6bb5\uff08\u4f46 \u53ef\u80fd\u4f1a\u56e0\u4ee3\u7406\u4e0d\u540c\uff0c\u5c06\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u8bb0\u5f55\u5728 User-Agent \u9996\u90e8\u5b57\u6bb5\u5185\uff09\u3002 4.8 Host \u00b6 \u544a\u77e5\u670d\u52a1\u5668\u8bf7\u6c42\u7684\u8d44\u6e90\u6240\u5904\u7684\u4e92\u8054\u7f51\u4e3b\u673a\u540d\u548c\u7aef\u53e3\u53f7\u3002\u552f\u4e00\u4e00\u4e2a\u5fc5\u987b\u88ab\u5305\u542b\u5728\u8bf7\u6c42\u5185\u7684\u9996\u90e8\u5b57\u6bb5\u3002 \u82e5\u670d\u52a1\u5668\u672a\u8bbe\u5b9a\u4e3b\u673a\u540d\uff0c\u90a3\u76f4\u63a5\u53d1\u9001\u4e00\u4e2a\u7a7a\u503c\u5373\u53ef\u3002 4.9 If-Match \u00b6 \u5f62\u5982 If-xxx \u8fd9\u79cd\u6837\u5f0f\u7684\u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5\uff0c\u90fd\u53ef\u79f0\u4e3a\u6761\u4ef6\u8bf7\u6c42\u3002\u670d\u52a1\u5668\u63a5\u6536\u5230\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\u540e\uff0c\u53ea\u6709\u5224\u65ad\u6307\u5b9a\u6761\u4ef6\u4e3a\u771f\u65f6\uff0c\u624d\u4f1a\u6267\u884c\u8bf7\u6c42\u3002\u5426\u5219\u8fd4\u56de\u72b6\u6001\u7801 412 Precondition Failed \u7684\u54cd\u5e94\u3002 If-Match \u5b83\u4f1a\u544a\u77e5\u670d\u52a1\u5668\u5339\u914d\u8d44\u6e90\u6240\u7528\u7684\u5b9e\u4f53\u6807\u8bb0\uff08ETag \uff09\u503c\u3002\u8fd9\u65f6\u7684\u670d\u52a1\u5668\u65e0\u6cd5\u4f7f\u7528\u5f31 ETag \u503c\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u6307\u5b9a If -Match \u7684\u5b57\u6bb5\u503c\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u670d\u52a1\u5668\u5c06\u4f1a\u5ffd\u7565 ETag \u7684\u503c\uff0c\u53ea\u8981\u8d44\u6e90\u5b58\u5728\u5c31\u5904\u7406\u8bf7\u6c42\u3002 4.10 If-None-Match \u00b6 \u4e0e If-Match \u76f8\u53cd\u3002\u5728 GET \u6216 HEAD \u65b9\u6cd5\u4e2d\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 If-None-Match \u53ef\u83b7\u53d6\u6700\u65b0\u7684\u8d44\u6e90\u3002 4.11 If-Modified-Since \u00b6 \u5b83\u4f1a\u544a\u77e5\u670d\u52a1\u5668\u82e5 If-Modified-Since \u5b57\u6bb5\u503c\u65e9\u4e8e\u8d44\u6e90\u7684\u66f4\u65b0\u65f6\u95f4\uff0c\u5219\u5e0c\u671b\u80fd\u5904\u7406\u8be5\u8bf7\u6c42\u3002\u5982\u679c\u8bf7\u6c42\u7684\u8d44\u6e90\u90fd\u6ca1\u6709\u8fc7\u66f4\u65b0\uff0c\u5219\u8fd4\u56de\u72b6\u6001\u7801 304 Not Modified \u7684\u54cd\u5e94\u3002 \u7528\u4e8e\u786e\u8ba4\u4ee3\u7406\u6216\u5ba2\u6237\u7aef\u62e5\u6709\u7684\u672c\u5730\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002\u83b7\u53d6\u8d44\u6e90\u7684\u66f4\u65b0\u65e5\u671f\u65f6\u95f4\uff0c\u53ef\u901a\u8fc7\u786e\u8ba4\u9996\u90e8\u5b57\u6bb5 Last-Modified \u6765\u786e \u5b9a\u3002 4.12 If-Unmodified-Since \u00b6 \u548c\u9996\u90e8\u5b57\u6bb5 If-Modified-Since \u7684\u4f5c\u7528\u76f8\u53cd\u3002\u5982\u679c\u5728\u6307\u5b9a\u65e5\u671f\u65f6\u95f4\u540e\u53d1\u751f\u4e86\u66f4\u65b0\uff0c\u5219\u4ee5\u72b6\u6001\u7801 412 Precondition Failed \u4f5c\u4e3a\u54cd\u5e94\u8fd4\u56de\u3002 4.13 If-Range \u00b6 \u5b83\u544a\u77e5\u670d\u52a1\u5668\u82e5\u6307\u5b9a\u7684 If-Range \u5b57\u6bb5\u503c\uff08ETag \u503c\u6216\u8005\u65f6\u95f4\uff09\u548c\u8bf7\u6c42\u8d44\u6e90\u7684 ETag \u503c\u6216\u65f6\u95f4\u76f8\u4e00\u81f4\u65f6\uff0c\u5219\u4f5c\u4e3a\u8303\u56f4\u8bf7\u6c42\u5904\u7406\u3002\u53cd\u4e4b\uff0c\u5219\u8fd4\u56de\u5168\u4f53\u8d44\u6e90\u3002 4.14 Max-Forwards \u00b6 \u901a\u8fc7 TRACE \u65b9\u6cd5\u6216 OPTIONS \u65b9\u6cd5\uff0c\u53d1\u9001\u5305\u542b\u9996\u90e8\u5b57\u6bb5 Max-Forwards \u7684\u8bf7\u6c42\u65f6\uff0c\u8be5\u5b57\u6bb5\u4ee5\u5341\u8fdb\u5236\u6574\u6570\u5f62\u5f0f\u6307\u5b9a\u53ef\u7ecf\u8fc7\u7684\u670d\u52a1\u5668\u6700\u5927\u6570\u76ee\u3002\u6bcf\u6b21\u8f6c\u53d1\u6570\u503c\u51cf 1\u3002\u5f53\u6570\u503c\u53d8 0 \u65f6\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u3002 4.15 Proxy-Authorization \u00b6 \u63a5\u6536\u5230\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u53d1\u6765\u7684\u8ba4\u8bc1\u8d28\u8be2\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u5305\u542b\u8be5\u9996\u90e8\u5b57\u6bb5\u7684\u8bf7\u6c42\uff0c\u4ee5\u544a\u77e5\u670d\u52a1\u5668\u8ba4\u8bc1\u6240\u9700\u8981\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u884c\u4e3a\u662f\u4e0e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684 HTTP \u8bbf\u95ee\u8ba4\u8bc1\u76f8\u7c7b\u4f3c\u7684\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u8ba4\u8bc1\u884c\u4e3a\u53d1\u751f\u5728\u5ba2\u6237\u7aef\u4e0e\u4ee3\u7406\u4e4b\u95f4\u3002\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8ba4\u8bc1\uff0c\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 Authorization \u53ef\u8d77\u5230\u76f8\u540c\u4f5c\u7528\u3002 4.16 Range \u00b6 \u5bf9\u4e8e\u53ea\u9700\u83b7\u53d6\u90e8\u5206\u8d44\u6e90\u7684\u8303\u56f4\u8bf7\u6c42\uff0c\u5305\u542b\u9996\u90e8\u5b57\u6bb5 Range \u5373\u53ef\u544a\u77e5\u670d\u52a1\u5668\u8d44\u6e90\u7684\u6307\u5b9a\u8303\u56f4\u3002 \u5904\u7406\u8bf7\u6c42\u4e4b\u540e\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 206 Partial Content \u7684\u54cd\u5e94\u3002\u65e0\u6cd5\u5904\u7406\u8be5\u8303\u56f4\u8bf7\u6c42\u65f6\uff0c\u5219\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u7684\u54cd\u5e94\u53ca\u5168\u90e8\u8d44\u6e90\u3002 4.17 Referer \u00b6 \u4f1a\u544a\u77e5\u670d\u52a1\u5668\u8bf7\u6c42\u7684\u539f\u59cb\u8d44\u6e90\u7684 URI\u3002 4.18 TE \u00b6 \u544a\u77e5\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u80fd\u591f\u5904\u7406\u54cd\u5e94\u7684\u4f20\u8f93\u7f16\u7801\u65b9\u5f0f\u53ca\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002\u5b83\u548c\u9996\u90e8\u5b57\u6bb5 Accept-Encoding \u7684\u529f\u80fd\u5f88\u76f8\u50cf\uff0c\u4f46\u662f\u7528\u4e8e\u4f20\u8f93\u7f16\u7801\u3002 \u8fd8\u53ef\u4ee5\u6307\u5b9a\u4f34\u968f trailer \u5b57\u6bb5\u7684\u5206\u5757\u4f20\u8f93\u7f16\u7801\u7684\u65b9\u5f0f\u3002\u5e94\u7528\u540e\u8005\u65f6\uff0c\u53ea\u9700\u628a trailers \u8d4b\u503c\u7ed9\u8be5\u5b57\u6bb5\u503c\uff1a TE: trailers 5. \u54cd\u5e94\u9996\u90e8\u5b57\u6bb5 \u00b6 \u7528\u4e8e\u8865\u5145\u54cd\u5e94\u7684\u9644\u52a0\u4fe1\u606f\u3001\u670d\u52a1\u5668\u4fe1\u606f\uff0c\u4ee5\u53ca\u5bf9\u5ba2\u6237\u7aef\u7684\u9644\u52a0\u8981\u6c42\u7b49\u4fe1\u606f\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.5 \u8282 \u5f3a ETag \u503c\uff0c\u4e0d\u8bba\u5b9e\u4f53\u53d1\u751f\u591a\u4e48\u7ec6\u5fae\u7684\u53d8\u5316\u90fd\u4f1a\u6539\u53d8\u5176\u503c\u3002 \u5f31 ETag \u503c\u53ea\u7528\u4e8e\u63d0\u793a\u8d44\u6e90\u662f\u5426\u76f8\u540c\u3002\u53ea\u6709\u8d44\u6e90\u53d1\u751f\u4e86\u6839\u672c\u6539\u53d8\uff0c\u4ea7\u751f\u5dee\u5f02\u65f6\u624d\u4f1a\u6539\u53d8 ETag \u503c\u3002\u8fd9\u65f6\uff0c\u4f1a\u5728\u5b57\u6bb5\u503c\u6700\u5f00\u59cb\u5904\u9644\u52a0 W/ \u3002 6. \u5b9e\u4f53\u9996\u90e8\u5b57\u6bb5 \u00b6 \u7528\u4e8e\u8865\u5145\u5185\u5bb9\u7684\u66f4\u65b0\u65f6\u95f4\u7b49\u4e0e\u5b9e\u4f53\u76f8\u5173\u7684\u4fe1\u606f\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.6 \u8282 7. \u4e3a Cookie \u670d\u52a1\u7684\u9996\u90e8\u5b57\u6bb5 \u00b6 Cookie \u7684\u5de5\u4f5c\u673a\u5236\u662f\u7528\u6237\u8bc6\u522b\u53ca\u72b6\u6001\u7ba1\u7406\u3002 7.1 Set-Cookie \u00b6 \u5f53\u670d\u52a1\u5668\u51c6\u5907\u5f00\u59cb\u7ba1\u7406\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u65f6\uff0c\u4f1a\u4e8b\u5148\u544a\u77e5\u5404\u79cd\u4fe1\u606f\u3002 Set-Cookie \u5b57\u6bb5\u7684\u5c5e\u6027 expires \u6307\u5b9a\u6d4f\u89c8\u5668\u53ef\u53d1\u9001 Cookie \u7684\u6709\u6548\u671f\u3002 \u5f53\u7701\u7565 expires \u5c5e\u6027\u65f6\uff0c\u5176\u6709\u6548\u671f\u4ec5\u9650\u4e8e\u7ef4\u6301\u6d4f\u89c8\u5668\u4f1a\u8bdd\uff08Session \uff09 \u65f6\u95f4\u6bb5\u5185\u3002 \u53e6\u5916\uff0c\u4e00\u65e6 Cookie \u4ece\u670d\u52a1\u5668\u7aef\u53d1\u9001\u81f3\u5ba2\u6237\u7aef\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4e0d\u5b58\u5728\u53ef \u4ee5\u663e\u5f0f\u5220\u9664 Cookie \u7684\u65b9\u6cd5\u3002\u4f46\u53ef\u901a\u8fc7\u8986\u76d6\u5df2\u8fc7\u671f\u7684 Cookie \uff0c\u5b9e\u73b0\u5bf9 \u5ba2\u6237\u7aef Cookie \u7684\u5b9e\u8d28\u6027\u5220\u9664\u64cd\u4f5c\u3002 path \u53ef\u7528\u4e8e\u9650\u5236\u6307\u5b9a Cookie \u7684\u53d1\u9001\u8303\u56f4\u7684\u6587\u4ef6\u76ee\u5f55\u3002 domain \u901a\u8fc7 Cookie \u7684 domain \u5c5e\u6027\u6307\u5b9a\u7684\u57df\u540d\u53ef\u505a\u5230\u4e0e\u7ed3\u5c3e\u5339\u914d\u4e00\u81f4\u3002 \u56e0\u6b64\uff0c\u9664\u4e86\u9488\u5bf9\u5177\u4f53\u6307\u5b9a\u7684\u591a\u4e2a\u57df\u540d\u53d1\u9001 Cookie \u4e4b \u5916\uff0c\u4e0d\u6307\u5b9a domain \u5c5e\u6027\u663e\u5f97\u66f4\u5b89\u5168\u3002 secure Cookie \u7684 secure \u5c5e\u6027\u7528\u4e8e\u9650\u5236 Web \u9875\u9762\u4ec5\u5728 HTTPS \u5b89\u5168\u8fde\u63a5\u65f6\uff0c\u624d \u53ef\u4ee5\u53d1\u9001 Cookie\u3002 \u683c\u5f0f\uff1a Set-Cookie: name=value; secure HttpOnly \u662f Cookie \u7684\u6269\u5c55\u529f\u80fd\uff0c\u5b83\u4f7f JavaScript \u811a\u672c \u65e0\u6cd5\u83b7\u5f97 Cookie\u3002\u5176\u4e3b\u8981\u76ee\u7684\u4e3a\u9632\u6b62\u8de8\u7ad9\u811a\u672c\u653b\u51fb\uff08Cross-site scripting \uff0cXSS\uff09\u5bf9 Cookie \u7684\u4fe1\u606f\u7a83\u53d6\u3002 \u683c\u5f0f\uff1a Set-Cookie: name=value; HttpOnly 7.2 Cookie \u00b6 Cookie: status=enable \u9996\u90e8\u5b57\u6bb5 Cookie \u4f1a\u544a\u77e5\u670d\u52a1\u5668\uff0c\u5f53\u5ba2\u6237\u7aef\u60f3\u83b7\u5f97 HTTP \u72b6\u6001\u7ba1\u7406\u652f\u6301\u65f6\uff0c\u5c31\u4f1a\u5728\u8bf7\u6c42\u4e2d\u5305\u542b\u4ece\u670d\u52a1\u5668\u63a5\u6536\u5230\u7684 Cookie\u3002\u63a5\u6536\u5230\u591a\u4e2a Cookie \u65f6\uff0c\u540c\u6837\u53ef\u4ee5\u4ee5\u591a\u4e2a Cookie \u5f62\u5f0f\u53d1\u9001\u3002 8. \u5176\u4ed6\u9996\u90e8\u5b57\u6bb5 \u00b6 \u4e3b\u8981\u662f\u4fdd\u62a4\u4e0d\u53d7\u653b\u51fb\u7684\u5b57\u6bb5\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.8 \u8282","title":"HTTP \u9996\u90e8.md"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#1-http","text":"\u53c2\u8003 HTTP \u62a5\u6587\u5185\u7684 HTTP \u4fe1\u606f \uff0c\u672c\u4e66\u4e3b\u8981\u6d89\u53ca HTTP/1.1 \u53ca\u5e38\u7528\u7684\u9996\u90e8\u5b57\u6bb5\u3002","title":"1. HTTP  \u62a5\u6587\u9996\u90e8"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#2-http","text":"","title":"2. HTTP  \u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#21-http","text":"\u9996\u90e8\u5b57\u6bb5\u540d: \u5b57\u6bb5\u503c 1 ,\u5b57\u6bb5\u503c 2 ,... HTTP \u9996\u90e8\u5b57\u6bb5\u91cd\u590d\u7684\u5904\u7406\u65b9\u5f0f\u6839\u636e\u6d4f\u89c8\u5668\u5185\u90e8\u7684\u903b\u8f91\u51b3\u5b9a\u3002","title":"2.1 HTTP \u9996\u90e8\u5b57\u6bb5\u7ed3\u6784"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#22","text":"","title":"2.2 \u5404\u79cd\u5b57\u6bb5\u6982\u89c8"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#23-http11","text":"\u4e0d\u9650\u4e8e RFC2616 \u4e2d\u5b9a\u4e49\u7684 47 \u79cd\u9996\u90e8\u5b57\u6bb5\uff0c\u5176\u5b83\u975e\u6b63\u5f0f\u7684\u9996\u90e8\u5b57\u6bb5\u7edf\u4e00\u5f52\u7eb3\u5728 RFC4229 HTTP Header Field Registrations \u4e2d\u3002","title":"2.3 \u975e HTTP/1.1 \u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#24-end-to-end-hop-by-hop","text":"HTTP \u9996\u90e8\u5b57\u6bb5\u5c06\u5b9a\u4e49\u6210\u7f13\u5b58\u4ee3\u7406\u548c\u975e\u7f13\u5b58\u4ee3\u7406\u7684\u884c\u4e3a\uff0c\u5206\u6210 2 \u79cd\u7c7b\u578b\u3002 \u7aef\u5230\u7aef\u9996\u90e8\uff08End-to-end Header\uff09 \u5206\u5728\u6b64\u7c7b\u522b\u4e2d\u7684\u9996\u90e8\u4f1a\u8f6c\u53d1\u7ed9\u8bf7\u6c42 / \u54cd\u5e94\u5bf9\u5e94\u7684\u6700\u7ec8\u63a5\u6536\u76ee\u6807\uff0c\u4e14\u5fc5\u987b\u4fdd\u5b58\u5728\u7531\u7f13\u5b58\u751f\u6210\u7684\u54cd\u5e94\u4e2d\uff0c\u53e6\u5916\u89c4\u5b9a\u5b83\u5fc5\u987b\u88ab\u8f6c\u53d1\u3002 \u9010\u8df3\u9996\u90e8\uff08Hop-by-hop Header\uff09 \u5206\u5728\u6b64\u7c7b\u522b\u4e2d\u7684\u9996\u90e8\u53ea\u5bf9\u5355\u6b21\u8f6c\u53d1\u6709\u6548\uff0c\u4f1a\u56e0\u901a\u8fc7\u7f13\u5b58\u6216\u4ee3\u7406\u800c\u4e0d\u518d\u8f6c\u53d1\u3002HTTP/1.1 \u548c\u4e4b\u540e\u7248\u672c\u4e2d\uff0c\u5982\u679c\u8981\u4f7f\u7528 hop-by -hop \u9996\u90e8\uff0c\u9700\u63d0\u4f9b Connection \u9996\u90e8\u5b57\u6bb5\u3002 \u9664\u8fd9 8 \u4e2a\u9996\u90e8\u5b57\u6bb5\u4e4b\u5916\uff0c\u5176\u4ed6\u6240\u6709\u5b57\u6bb5\u90fd\u5c5e\u4e8e\u7aef\u5230\u7aef\u9996\u90e8\uff1a Connection Keep-Alive Proxy-Authenticate Proxy-Authorization Trailer TE Transfer-Encoding Upgrade","title":"2.4 End-to-end \u9996\u90e8\u548c Hop-by-hop \u9996\u90e8"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#3-http11","text":"","title":"3. HTTP/1.1 \u901a\u7528\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#31-cache-control","text":"\u63a7\u5236\u7f13\u5b58\u7684\u884c\u4e3a\u3002 \u6307\u4ee4\u4e00\u89c8\uff1a \u8be6\u7ec6\u8bf4\u660e\u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.3.1 \u8282\u3002","title":"3.1 Cache -Control"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#32-connecti-on","text":"\u63a7\u5236\u4e0d\u518d\u8f6c\u53d1\u7ed9\u4ee3\u7406\u7684\u9996\u90e8\u5b57\u6bb5 Connection: \u4e0d\u518d\u8f6c\u53d1\u7684\u9996\u90e8\u5b57\u6bb5\u540d \u7ba1\u7406\u6301\u4e45\u8fde\u63a5 Connection: close/Keep-Alive HTTP/1.1\u4e4b\u540e\u9ed8\u8ba4\u662f\u6301\u4e45\u5316\u8fde\u63a5\uff1b\u4e4b\u524d\u662f\u975e\u6301\u4e45\u5316\u8fde\u63a5\u3002\u4f7f\u7528\u6b64\u9996\u90e8\u6539\u53d8\u8fde\u63a5\u7684\u6301\u4e45\u5316\u72b6\u6001\u3002","title":"3.2 Connecti on"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#33-date","text":"HTTP/1.1 \u534f\u8bae\u4f7f\u7528\u5728 RFC1123 \u4e2d\u89c4\u5b9a\u7684\u65e5\u671f\u65f6\u95f4\u7684\u683c\u5f0f\uff1a Date: Tue, 03 Jul 2012 04 : 40 : 59 GMT \u524d\u7684 HTTP \u534f\u8bae\u7248\u672c\u4e2d\u4f7f\u7528\u5728 RFC850 \u4e2d\u5b9a\u4e49\u7684\u683c\u5f0f\uff1a Date: Tue, 03 -Jul -12 04 : 40 : 59 GMT \u8fd8\u6709\u4e00\u79cd\u683c\u5f0f\u3002\u5b83\u4e0e C \u6807\u51c6\u5e93\u5185\u7684 asct im e() \u51fd\u6570\u7684\u8f93\u51fa\u683c\u5f0f\u4e00\u81f4\uff1a Date: Tue Jul 03 04 : 40 : 59 2012","title":"3.3 Date"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#34-pragma","text":"Pragma \u662f HTTP/1.1 \u4e4b\u524d\u7248\u672c\u7684\u5386\u53f2\u9057\u7559\u5b57\u6bb5\uff0c\u4ec5\u4f5c\u4e3a\u4e0e HTTP/1.0\u7684\u5411\u540e\u517c\u5bb9\u800c\u5b9a\u4e49\u3002 Pragma: no-cache \u8be5\u9996\u90e8\u5b57\u6bb5\u5c5e\u4e8e\u901a\u7528\u9996\u90e8\u5b57\u6bb5\uff0c\u4f46\u53ea\u7528\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u4e2d\u3002\u5ba2\u6237\u7aef\u4f1a\u8981\u6c42\u6240\u6709\u7684\u4e2d\u95f4\u670d\u52a1\u5668\u4e0d\u8fd4\u56de\u7f13\u5b58\u7684\u8d44\u6e90\u3002 \u53d1\u9001\u7684\u8bf7\u6c42\u4f1a\u540c\u65f6\u542b\u6709\u4e0b\u9762\u4e24\u4e2a\u9996\u90e8\u5b57\u6bb5\u6765\u4fdd\u8bc1\u6240\u6709\u7248\u672c\u7684HTTP\u534f\u8bae\u6709\u76f8\u540c\u7684\u7f13\u5b58\u65b9\u5f0f\uff1a Cache-Control: no-cache Pragma: no-cache","title":"3.4 Pragma"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#35-trailer","text":"Trailer \u4f1a\u4e8b\u5148\u8bf4\u660e\u5728\u62a5\u6587\u4e3b\u4f53\u540e\u8bb0\u5f55\u4e86\u54ea\u4e9b\u9996\u90e8\u5b57\u6bb5\u3002\u8be5\u9996\u90e8\u5b57\u6bb5\u53ef\u5e94\u7528\u5728 HTTP/1.1 \u7248\u672c\u5206\u5757\u4f20\u8f93\u7f16\u7801\u65f6\u3002 ... Trailer: Expires ...(\u62a5\u6587\u4e3b\u4f53)... Expires: Tue, 28 Sep 2004 23 : 59 : 59 GMT","title":"3.5 Trailer"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#36-transfer-encoding","text":"\u89c4\u5b9a\u4e86\u4f20\u8f93\u62a5\u6587\u4e3b\u4f53\u65f6\u91c7\u7528\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u4ec5\u5bf9\u5206\u5757\u4f20\u8f93\u7f16\u7801\u6709\u6548\u3002 ... Transfer-Encoding: chunked Connection: keep-alive cf 0 \u2190 16 \u8fdb\u5236( 10 \u8fdb\u5236\u4e3a 3312 ) ... 3312 \u5b57\u8282\u5206\u5757\u6570\u636e... 392 \u2190 16 \u8fdb\u5236( 10 \u8fdb\u5236\u4e3a 914 ) ... 914 \u5b57\u8282\u5206\u5757\u6570\u636e... 0","title":"3.6 Transfer-Encoding"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#37-upgrade","text":"\u7528\u4e8e\u68c0\u6d4b HTTP \u534f\u8bae\u53ca\u5176\u4ed6\u534f\u8bae\u662f\u5426\u53ef\u4f7f\u7528\u66f4\u9ad8\u7684\u7248\u672c\u8fdb\u884c\u901a\u4fe1\uff0c\u5176\u53c2\u6570\u503c\u53ef\u4ee5\u7528\u6765\u6307\u5b9a\u4e00\u4e2a\u5b8c\u5168\u4e0d\u540c\u7684\u901a\u4fe1\u534f\u8bae\u3002 Upgrade \u9996\u90e8\u5b57\u6bb5\u4ea7\u751f\u4f5c\u7528\u7684 Upgrade \u5bf9\u8c61\u4ec5\u9650\u4e8e\u5ba2\u6237\u7aef\u548c\u90bb\u63a5\u670d\u52a1\u5668\u4e4b\u95f4\u3002\u56e0\u6b64\uff0c\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 Upgrade \u65f6\uff0c\u8fd8\u9700\u8981\u989d\u5916\u6307\u5b9a Connection :Upgrade \u3002 \u670d\u52a1\u5668\u53ef\u7528 101 Switching Protocols \u72b6\u6001\u7801\u4f5c\u4e3a\u54cd\u5e94\u8fd4\u56de\u3002","title":"3.7 Upgrade"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#38-via","text":"\u4e3a\u4e86\u8ffd\u8e2a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u62a5\u6587\u7684\u4f20\u8f93\u8def\u5f84\u3002 \u62a5\u6587\u7ecf\u8fc7\u4ee3\u7406\u6216\u7f51\u5173\u65f6\uff0c\u4f1a\u5148\u5728\u9996\u90e8\u5b57\u6bb5 Via \u4e2d\u9644\u52a0\u8be5\u670d\u52a1\u5668\u7684\u4fe1\u606f\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8f6c\u53d1\u3002 \u9996\u90e8\u5b57\u6bb5 Via \u4e0d\u4ec5\u7528\u4e8e\u8ffd\u8e2a\u62a5\u6587\u7684\u8f6c\u53d1\uff0c\u8fd8\u53ef\u907f\u514d\u8bf7\u6c42\u56de\u73af\u7684\u53d1\u751f\uff0c\u6240\u4ee5\u5fc5\u987b\u5728\u7ecf\u8fc7\u4ee3\u7406\u65f6\u9644\u52a0\u8be5\u9996\u90e8\u5b57\u6bb5\u5185\u5bb9\u3002 Via \u9996\u90e8\u662f\u4e3a\u4e86\u8ffd\u8e2a\u4f20\u8f93\u8def\u5f84\uff0c\u6240\u4ee5\u7ecf\u5e38\u4f1a\u548c TRACE \u65b9\u6cd5\u4e00\u8d77\u4f7f\u7528\u3002","title":"3.8 Via"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#39-warning","text":"\u8be5\u9996\u90e8\u901a\u5e38\u4f1a\u544a\u77e5\u7528\u6237\u4e00\u4e9b\u4e0e\u7f13\u5b58\u76f8\u5173\u7684\u95ee\u9898\u7684\u8b66\u544a\u3002 \u683c\u5f0f\uff08\u65e5\u671f\u53ef\u7701\u7565\uff09\uff1a Warning: [ \u8b66\u544a\u7801 ][ \u8b66\u544a\u7684\u4e3b\u673a:\u7aef\u53e3\u53f7 ] \u201c [ \u8b66\u544a\u5185\u5bb9 ] \u201d( [ \u65e5\u671f\u65f6\u95f4 ] )","title":"3.9 Warning"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#4","text":"\u7528\u4e8e\u8865\u5145\u8bf7\u6c42\u7684\u9644\u52a0\u4fe1\u606f\u3001\u5ba2\u6237\u7aef\u4fe1\u606f\u3001\u5bf9\u54cd\u5e94\u5185\u5bb9\u76f8\u5173\u7684\u4f18\u5148\u7ea7\u7b49\u5185\u5bb9\u3002","title":"4. \u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#41-accept","text":"Accept \u9996\u90e8\u5b57\u6bb5\u53ef\u901a\u77e5\u670d\u52a1\u5668\uff0c\u7528\u6237\u4ee3\u7406\u80fd\u591f\u5904\u7406\u7684\u5a92\u4f53\u7c7b\u578b\u53ca\u5a92\u4f53\u7c7b\u578b\u7684\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002\u53ef\u4f7f\u7528 type/subtype \u8fd9\u79cd\u5f62\u5f0f\uff0c\u4e00\u6b21\u6307\u5b9a\u591a\u79cd\u5a92\u4f53\u7c7b\u578b\u3002 \u4f7f\u7528 q= \u6765\u989d\u5916\u8868\u793a\u6743\u91cd\u503c\uff0c\u7528\u5206\u53f7\uff08;\uff09\u8fdb\u884c\u5206\u9694\u3002\u8303\u56f4\u662f 0~1\uff08\u53ef\u7cbe\u786e\u5230\u5c0f\u6570\u70b9\u540e 3 \u4f4d\uff09\uff0c\u4e14 1 \u4e3a\u6700\u5927\u503c\uff0c\u9ed8\u8ba4\u503c\u662f1.0\u3002 \u4f8b\u5b50\uff0c\u4f18\u5148\u53d1\u9001plain\u6587\u672c\u6587\u4ef6\uff1a Accept: text/html; q= 0.5 , text/plain","title":"4.1 Accept"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#42-accept-charset","text":"Accept-Charset \u9996\u90e8\u5b57\u6bb5\u53ef\u7528\u6765\u901a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u652f\u6301\u7684\u5b57\u7b26\u96c6\u53ca\u5b57\u7b26\u96c6\u7684\u76f8\u5bf9\u4f18\u5148\u987a\u5e8f\u3002\u4e5f\u53ef\u6307\u5b9a\u6743\u91cd\u503c\u3002 \u8be5\u9996\u90e8\u5b57\u6bb5\u5e94\u7528\u4e8e\u5185\u5bb9\u534f\u5546\u673a\u5236\u7684\u670d\u52a1\u5668\u9a71\u52a8\u534f\u5546\u3002","title":"4.2 Accept-Charset"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#43-accept-encoding","text":"Accept-Encoding \u9996\u90e8\u5b57\u6bb5\u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u652f\u6301\u7684\u5185\u5bb9\u7f16\u7801\u53ca\u5185\u5bb9\u7f16\u7801\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\u3002 Accept-Encoding: gzip, deflate gzip \uff08GNU zip\uff09 compress\uff08UNIX \u7cfb\u7edf\u7684\u6807\u51c6\u538b\u7f29\uff09 deflate \uff08zlib \uff09 identity\uff08\u4e0d\u8fdb\u884c\u7f16\u7801\uff09 \u91c7\u7528\u6743\u91cd q \u503c\u6765\u8868\u793a\u76f8\u5bf9\u4f18\u5148\u7ea7\uff0c\u4e5f\u53ef\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u4f5c\u4e3a\u901a\u914d\u7b26\uff0c\u6307\u5b9a\u4efb\u610f\u7684\u7f16\u7801\u683c\u5f0f\u3002","title":"4.3 Accept-Encoding"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#44-accept-language","text":"Accept-Language \u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u7528\u6237\u4ee3\u7406\u80fd\u591f\u5904\u7406\u7684\u81ea\u7136\u8bed\u8a00\u96c6\uff08\u6307\u4e2d\u6587\u6216\u82f1\u6587\u7b49\uff09\uff0c\u4ee5\u53ca\u81ea\u7136\u8bed\u8a00\u96c6\u7684\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002 \u652f\u6301 q \u503c\u3002","title":"4.4 Accept-Language"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#45-authorization","text":"Authorization \u662f\u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\uff0c\u7528\u6237\u4ee3\u7406\u7684\u8ba4\u8bc1\u4fe1\u606f\uff08\u8bc1\u4e66\u503c\uff09\u3002\u901a\u5e38\uff0c\u60f3\u8981\u901a\u8fc7\u670d\u52a1\u5668\u8ba4\u8bc1\u7684\u7528\u6237\u4ee3\u7406\u4f1a\u5728\u63a5\u6536\u5230\u8fd4\u56de\u7684 401 \u72b6\u6001\u7801\u54cd\u5e94\u540e\uff0c\u628a\u9996\u90e8\u5b57\u6bb5 Authorization \u52a0\u5165\u8bf7\u6c42\u4e2d\u3002","title":"4.5 Authorization"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#46-expect","text":"Expect \u6765\u544a\u77e5\u670d\u52a1\u5668\uff0c\u671f\u671b\u51fa\u73b0\u7684\u67d0\u79cd\u7279\u5b9a\u884c\u4e3a\u3002 \u56e0\u670d\u52a1\u5668\u65e0\u6cd5\u7406\u89e3\u5ba2\u6237\u7aef\u7684\u671f\u671b\u4f5c\u51fa\u56de\u5e94\u800c\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 417 Expectation Failed\u3002 \u7b49\u5f85\u72b6\u6001\u7801 100 \u54cd\u5e94\u7684\u5ba2\u6237\u7aef\u5728\u53d1\u751f\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u6307\u5b9a Expectt :100-continue \u3002","title":"4.6 Expect"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#47-from","text":"\u7528\u6765\u544a\u77e5\u670d\u52a1\u5668\u4f7f\u7528\u7528\u6237\u4ee3\u7406\u7684\u7528\u6237\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u3002\u4f7f\u7528\u4ee3\u7406\u65f6\uff0c\u5e94\u5c3d\u53ef\u80fd\u5305\u542b From \u9996\u90e8\u5b57\u6bb5\uff08\u4f46 \u53ef\u80fd\u4f1a\u56e0\u4ee3\u7406\u4e0d\u540c\uff0c\u5c06\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u8bb0\u5f55\u5728 User-Agent \u9996\u90e8\u5b57\u6bb5\u5185\uff09\u3002","title":"4.7 From"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#48-host","text":"\u544a\u77e5\u670d\u52a1\u5668\u8bf7\u6c42\u7684\u8d44\u6e90\u6240\u5904\u7684\u4e92\u8054\u7f51\u4e3b\u673a\u540d\u548c\u7aef\u53e3\u53f7\u3002\u552f\u4e00\u4e00\u4e2a\u5fc5\u987b\u88ab\u5305\u542b\u5728\u8bf7\u6c42\u5185\u7684\u9996\u90e8\u5b57\u6bb5\u3002 \u82e5\u670d\u52a1\u5668\u672a\u8bbe\u5b9a\u4e3b\u673a\u540d\uff0c\u90a3\u76f4\u63a5\u53d1\u9001\u4e00\u4e2a\u7a7a\u503c\u5373\u53ef\u3002","title":"4.8 Host"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#49-if-match","text":"\u5f62\u5982 If-xxx \u8fd9\u79cd\u6837\u5f0f\u7684\u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5\uff0c\u90fd\u53ef\u79f0\u4e3a\u6761\u4ef6\u8bf7\u6c42\u3002\u670d\u52a1\u5668\u63a5\u6536\u5230\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\u540e\uff0c\u53ea\u6709\u5224\u65ad\u6307\u5b9a\u6761\u4ef6\u4e3a\u771f\u65f6\uff0c\u624d\u4f1a\u6267\u884c\u8bf7\u6c42\u3002\u5426\u5219\u8fd4\u56de\u72b6\u6001\u7801 412 Precondition Failed \u7684\u54cd\u5e94\u3002 If-Match \u5b83\u4f1a\u544a\u77e5\u670d\u52a1\u5668\u5339\u914d\u8d44\u6e90\u6240\u7528\u7684\u5b9e\u4f53\u6807\u8bb0\uff08ETag \uff09\u503c\u3002\u8fd9\u65f6\u7684\u670d\u52a1\u5668\u65e0\u6cd5\u4f7f\u7528\u5f31 ETag \u503c\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u6307\u5b9a If -Match \u7684\u5b57\u6bb5\u503c\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u670d\u52a1\u5668\u5c06\u4f1a\u5ffd\u7565 ETag \u7684\u503c\uff0c\u53ea\u8981\u8d44\u6e90\u5b58\u5728\u5c31\u5904\u7406\u8bf7\u6c42\u3002","title":"4.9 If-Match"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#410-if-none-match","text":"\u4e0e If-Match \u76f8\u53cd\u3002\u5728 GET \u6216 HEAD \u65b9\u6cd5\u4e2d\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 If-None-Match \u53ef\u83b7\u53d6\u6700\u65b0\u7684\u8d44\u6e90\u3002","title":"4.10 If-None-Match"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#411-if-modified-since","text":"\u5b83\u4f1a\u544a\u77e5\u670d\u52a1\u5668\u82e5 If-Modified-Since \u5b57\u6bb5\u503c\u65e9\u4e8e\u8d44\u6e90\u7684\u66f4\u65b0\u65f6\u95f4\uff0c\u5219\u5e0c\u671b\u80fd\u5904\u7406\u8be5\u8bf7\u6c42\u3002\u5982\u679c\u8bf7\u6c42\u7684\u8d44\u6e90\u90fd\u6ca1\u6709\u8fc7\u66f4\u65b0\uff0c\u5219\u8fd4\u56de\u72b6\u6001\u7801 304 Not Modified \u7684\u54cd\u5e94\u3002 \u7528\u4e8e\u786e\u8ba4\u4ee3\u7406\u6216\u5ba2\u6237\u7aef\u62e5\u6709\u7684\u672c\u5730\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002\u83b7\u53d6\u8d44\u6e90\u7684\u66f4\u65b0\u65e5\u671f\u65f6\u95f4\uff0c\u53ef\u901a\u8fc7\u786e\u8ba4\u9996\u90e8\u5b57\u6bb5 Last-Modified \u6765\u786e \u5b9a\u3002","title":"4.11 If-Modified-Since"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#412-if-unmodified-since","text":"\u548c\u9996\u90e8\u5b57\u6bb5 If-Modified-Since \u7684\u4f5c\u7528\u76f8\u53cd\u3002\u5982\u679c\u5728\u6307\u5b9a\u65e5\u671f\u65f6\u95f4\u540e\u53d1\u751f\u4e86\u66f4\u65b0\uff0c\u5219\u4ee5\u72b6\u6001\u7801 412 Precondition Failed \u4f5c\u4e3a\u54cd\u5e94\u8fd4\u56de\u3002","title":"4.12 If-Unmodified-Since"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#413-if-range","text":"\u5b83\u544a\u77e5\u670d\u52a1\u5668\u82e5\u6307\u5b9a\u7684 If-Range \u5b57\u6bb5\u503c\uff08ETag \u503c\u6216\u8005\u65f6\u95f4\uff09\u548c\u8bf7\u6c42\u8d44\u6e90\u7684 ETag \u503c\u6216\u65f6\u95f4\u76f8\u4e00\u81f4\u65f6\uff0c\u5219\u4f5c\u4e3a\u8303\u56f4\u8bf7\u6c42\u5904\u7406\u3002\u53cd\u4e4b\uff0c\u5219\u8fd4\u56de\u5168\u4f53\u8d44\u6e90\u3002","title":"4.13 If-Range"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#414-max-forwards","text":"\u901a\u8fc7 TRACE \u65b9\u6cd5\u6216 OPTIONS \u65b9\u6cd5\uff0c\u53d1\u9001\u5305\u542b\u9996\u90e8\u5b57\u6bb5 Max-Forwards \u7684\u8bf7\u6c42\u65f6\uff0c\u8be5\u5b57\u6bb5\u4ee5\u5341\u8fdb\u5236\u6574\u6570\u5f62\u5f0f\u6307\u5b9a\u53ef\u7ecf\u8fc7\u7684\u670d\u52a1\u5668\u6700\u5927\u6570\u76ee\u3002\u6bcf\u6b21\u8f6c\u53d1\u6570\u503c\u51cf 1\u3002\u5f53\u6570\u503c\u53d8 0 \u65f6\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u3002","title":"4.14 Max-Forwards"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#415-proxy-authorization","text":"\u63a5\u6536\u5230\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u53d1\u6765\u7684\u8ba4\u8bc1\u8d28\u8be2\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001\u5305\u542b\u8be5\u9996\u90e8\u5b57\u6bb5\u7684\u8bf7\u6c42\uff0c\u4ee5\u544a\u77e5\u670d\u52a1\u5668\u8ba4\u8bc1\u6240\u9700\u8981\u7684\u4fe1\u606f\u3002 \u8fd9\u4e2a\u884c\u4e3a\u662f\u4e0e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684 HTTP \u8bbf\u95ee\u8ba4\u8bc1\u76f8\u7c7b\u4f3c\u7684\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u8ba4\u8bc1\u884c\u4e3a\u53d1\u751f\u5728\u5ba2\u6237\u7aef\u4e0e\u4ee3\u7406\u4e4b\u95f4\u3002\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8ba4\u8bc1\uff0c\u4f7f\u7528\u9996\u90e8\u5b57\u6bb5 Authorization \u53ef\u8d77\u5230\u76f8\u540c\u4f5c\u7528\u3002","title":"4.15 Proxy-Authorization"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#416-range","text":"\u5bf9\u4e8e\u53ea\u9700\u83b7\u53d6\u90e8\u5206\u8d44\u6e90\u7684\u8303\u56f4\u8bf7\u6c42\uff0c\u5305\u542b\u9996\u90e8\u5b57\u6bb5 Range \u5373\u53ef\u544a\u77e5\u670d\u52a1\u5668\u8d44\u6e90\u7684\u6307\u5b9a\u8303\u56f4\u3002 \u5904\u7406\u8bf7\u6c42\u4e4b\u540e\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 206 Partial Content \u7684\u54cd\u5e94\u3002\u65e0\u6cd5\u5904\u7406\u8be5\u8303\u56f4\u8bf7\u6c42\u65f6\uff0c\u5219\u4f1a\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u7684\u54cd\u5e94\u53ca\u5168\u90e8\u8d44\u6e90\u3002","title":"4.16 Range"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#417-referer","text":"\u4f1a\u544a\u77e5\u670d\u52a1\u5668\u8bf7\u6c42\u7684\u539f\u59cb\u8d44\u6e90\u7684 URI\u3002","title":"4.17 Referer"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#418-te","text":"\u544a\u77e5\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u80fd\u591f\u5904\u7406\u54cd\u5e94\u7684\u4f20\u8f93\u7f16\u7801\u65b9\u5f0f\u53ca\u76f8\u5bf9\u4f18\u5148\u7ea7\u3002\u5b83\u548c\u9996\u90e8\u5b57\u6bb5 Accept-Encoding \u7684\u529f\u80fd\u5f88\u76f8\u50cf\uff0c\u4f46\u662f\u7528\u4e8e\u4f20\u8f93\u7f16\u7801\u3002 \u8fd8\u53ef\u4ee5\u6307\u5b9a\u4f34\u968f trailer \u5b57\u6bb5\u7684\u5206\u5757\u4f20\u8f93\u7f16\u7801\u7684\u65b9\u5f0f\u3002\u5e94\u7528\u540e\u8005\u65f6\uff0c\u53ea\u9700\u628a trailers \u8d4b\u503c\u7ed9\u8be5\u5b57\u6bb5\u503c\uff1a TE: trailers","title":"4.18 TE"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#5","text":"\u7528\u4e8e\u8865\u5145\u54cd\u5e94\u7684\u9644\u52a0\u4fe1\u606f\u3001\u670d\u52a1\u5668\u4fe1\u606f\uff0c\u4ee5\u53ca\u5bf9\u5ba2\u6237\u7aef\u7684\u9644\u52a0\u8981\u6c42\u7b49\u4fe1\u606f\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.5 \u8282 \u5f3a ETag \u503c\uff0c\u4e0d\u8bba\u5b9e\u4f53\u53d1\u751f\u591a\u4e48\u7ec6\u5fae\u7684\u53d8\u5316\u90fd\u4f1a\u6539\u53d8\u5176\u503c\u3002 \u5f31 ETag \u503c\u53ea\u7528\u4e8e\u63d0\u793a\u8d44\u6e90\u662f\u5426\u76f8\u540c\u3002\u53ea\u6709\u8d44\u6e90\u53d1\u751f\u4e86\u6839\u672c\u6539\u53d8\uff0c\u4ea7\u751f\u5dee\u5f02\u65f6\u624d\u4f1a\u6539\u53d8 ETag \u503c\u3002\u8fd9\u65f6\uff0c\u4f1a\u5728\u5b57\u6bb5\u503c\u6700\u5f00\u59cb\u5904\u9644\u52a0 W/ \u3002","title":"5. \u54cd\u5e94\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#6","text":"\u7528\u4e8e\u8865\u5145\u5185\u5bb9\u7684\u66f4\u65b0\u65f6\u95f4\u7b49\u4e0e\u5b9e\u4f53\u76f8\u5173\u7684\u4fe1\u606f\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.6 \u8282","title":"6. \u5b9e\u4f53\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#7-cookie","text":"Cookie \u7684\u5de5\u4f5c\u673a\u5236\u662f\u7528\u6237\u8bc6\u522b\u53ca\u72b6\u6001\u7ba1\u7406\u3002","title":"7. \u4e3a Cookie \u670d\u52a1\u7684\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#71-set-cookie","text":"\u5f53\u670d\u52a1\u5668\u51c6\u5907\u5f00\u59cb\u7ba1\u7406\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u65f6\uff0c\u4f1a\u4e8b\u5148\u544a\u77e5\u5404\u79cd\u4fe1\u606f\u3002 Set-Cookie \u5b57\u6bb5\u7684\u5c5e\u6027 expires \u6307\u5b9a\u6d4f\u89c8\u5668\u53ef\u53d1\u9001 Cookie \u7684\u6709\u6548\u671f\u3002 \u5f53\u7701\u7565 expires \u5c5e\u6027\u65f6\uff0c\u5176\u6709\u6548\u671f\u4ec5\u9650\u4e8e\u7ef4\u6301\u6d4f\u89c8\u5668\u4f1a\u8bdd\uff08Session \uff09 \u65f6\u95f4\u6bb5\u5185\u3002 \u53e6\u5916\uff0c\u4e00\u65e6 Cookie \u4ece\u670d\u52a1\u5668\u7aef\u53d1\u9001\u81f3\u5ba2\u6237\u7aef\uff0c\u670d\u52a1\u5668\u7aef\u5c31\u4e0d\u5b58\u5728\u53ef \u4ee5\u663e\u5f0f\u5220\u9664 Cookie \u7684\u65b9\u6cd5\u3002\u4f46\u53ef\u901a\u8fc7\u8986\u76d6\u5df2\u8fc7\u671f\u7684 Cookie \uff0c\u5b9e\u73b0\u5bf9 \u5ba2\u6237\u7aef Cookie \u7684\u5b9e\u8d28\u6027\u5220\u9664\u64cd\u4f5c\u3002 path \u53ef\u7528\u4e8e\u9650\u5236\u6307\u5b9a Cookie \u7684\u53d1\u9001\u8303\u56f4\u7684\u6587\u4ef6\u76ee\u5f55\u3002 domain \u901a\u8fc7 Cookie \u7684 domain \u5c5e\u6027\u6307\u5b9a\u7684\u57df\u540d\u53ef\u505a\u5230\u4e0e\u7ed3\u5c3e\u5339\u914d\u4e00\u81f4\u3002 \u56e0\u6b64\uff0c\u9664\u4e86\u9488\u5bf9\u5177\u4f53\u6307\u5b9a\u7684\u591a\u4e2a\u57df\u540d\u53d1\u9001 Cookie \u4e4b \u5916\uff0c\u4e0d\u6307\u5b9a domain \u5c5e\u6027\u663e\u5f97\u66f4\u5b89\u5168\u3002 secure Cookie \u7684 secure \u5c5e\u6027\u7528\u4e8e\u9650\u5236 Web \u9875\u9762\u4ec5\u5728 HTTPS \u5b89\u5168\u8fde\u63a5\u65f6\uff0c\u624d \u53ef\u4ee5\u53d1\u9001 Cookie\u3002 \u683c\u5f0f\uff1a Set-Cookie: name=value; secure HttpOnly \u662f Cookie \u7684\u6269\u5c55\u529f\u80fd\uff0c\u5b83\u4f7f JavaScript \u811a\u672c \u65e0\u6cd5\u83b7\u5f97 Cookie\u3002\u5176\u4e3b\u8981\u76ee\u7684\u4e3a\u9632\u6b62\u8de8\u7ad9\u811a\u672c\u653b\u51fb\uff08Cross-site scripting \uff0cXSS\uff09\u5bf9 Cookie \u7684\u4fe1\u606f\u7a83\u53d6\u3002 \u683c\u5f0f\uff1a Set-Cookie: name=value; HttpOnly","title":"7.1 Set-Cookie"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#72-cookie","text":"Cookie: status=enable \u9996\u90e8\u5b57\u6bb5 Cookie \u4f1a\u544a\u77e5\u670d\u52a1\u5668\uff0c\u5f53\u5ba2\u6237\u7aef\u60f3\u83b7\u5f97 HTTP \u72b6\u6001\u7ba1\u7406\u652f\u6301\u65f6\uff0c\u5c31\u4f1a\u5728\u8bf7\u6c42\u4e2d\u5305\u542b\u4ece\u670d\u52a1\u5668\u63a5\u6536\u5230\u7684 Cookie\u3002\u63a5\u6536\u5230\u591a\u4e2a Cookie \u65f6\uff0c\u540c\u6837\u53ef\u4ee5\u4ee5\u591a\u4e2a Cookie \u5f62\u5f0f\u53d1\u9001\u3002","title":"7.2 Cookie"},{"location":"http\u534f\u8bae/HTTP \u9996\u90e8/#8","text":"\u4e3b\u8981\u662f\u4fdd\u62a4\u4e0d\u53d7\u653b\u51fb\u7684\u5b57\u6bb5\u3002 \u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b6.8 \u8282","title":"8. \u5176\u4ed6\u9996\u90e8\u5b57\u6bb5"},{"location":"http\u534f\u8bae/HTTPS/","text":"HTTP+ \u52a0\u5bc6 + \u8ba4\u8bc1 + \u5b8c\u6574\u6027\u4fdd\u62a4 = HTTPS \u6211\u4eec\u628a\u6dfb\u52a0\u4e86\u52a0\u5bc6\u53ca\u8ba4\u8bc1\u673a\u5236\u7684 HTTP \u79f0\u4e3a HTTPS\uff08HTTP Secure\uff09\u3002 \u901a\u5e38\uff0cHTTP \u76f4\u63a5\u548c TCP \u901a\u4fe1\u3002\u5f53\u4f7f\u7528 SSL \u65f6\uff0c\u5219\u6f14\u53d8\u6210\u5148\u548c SSL \u901a\u4fe1\uff0c\u518d\u7531 SSL \u548c TCP \u901a\u4fe1\u4e86\u3002 \u6df7\u5408\u52a0\u5bc6\u673a\u5236\uff1a\u5728\u4ea4\u6362\u5bc6\u94a5\u73af\u8282\u4f7f\u7528 \u975e\u5bf9\u79f0\u5bc6\u94a5 \u52a0\u5bc6\u65b9\u5f0f\uff0c\u4e4b\u540e\u7684\u5efa\u7acb\u901a\u4fe1\u4ea4\u6362\u62a5\u6587\u9636\u6bb5\u5219\u4f7f\u7528 \u5bf9\u79f0\u5bc6\u94a5 \u52a0\u5bc6\u65b9\u5f0f\u3002 \u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\uff08CA\uff0cCertificate Authority\uff09\u548c\u5176\u76f8\u5173\u673a\u5173\u9881\u53d1\u7684\u516c\u5f00\u5bc6\u94a5\u8bc1\u4e66\u7528\u4e8e\u8bc1\u660e\u516c\u5f00\u5bc6\u94a5\u6b63\u786e\u6027\u3002\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\u5904\u4e8e\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u53cc\u65b9\u90fd\u53ef\u4fe1\u8d56\u7684\u7b2c\u4e09\u65b9\u673a\u6784\u7684\u7acb\u573a\u4e0a\u3002 \u63a5\u5230\u8bc1\u4e66\u7684\u5ba2\u6237\u7aef\u53ef\u4f7f\u7528\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\u7684\u516c\u5f00\u5bc6\u94a5\uff0c\u5bf9\u90a3\u5f20\u8bc1\u4e66\u4e0a\u7684\u6570\u5b57\u7b7e\u540d\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4e00\u65e6\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5ba2\u6237\u7aef\u4fbf\u53ef\u660e\u786e\u4e24\u4ef6\u4e8b\uff1a \u8ba4\u8bc1\u670d\u52a1\u5668\u7684\u516c\u5f00\u5bc6\u94a5\u7684\u662f\u771f\u5b9e\u6709\u6548\u7684\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\u3002 \u670d\u52a1\u5668\u7684\u516c\u5f00\u5bc6\u94a5\u662f\u503c\u5f97\u4fe1\u8d56\u7684\u3002 \u5982\u4f55\u83b7\u53d6\u8ba4\u8bc1\u673a\u6784\u7684\u516c\u5f00\u5bc6\u94a5\uff1a\u591a\u6570\u6d4f\u89c8\u5668\u4f1a\u4e8b\u5148\u5728\u5185\u90e8\u690d\u5165\u5e38\u7528\u8ba4\u8bc1\u673a\u5173\u7684\u516c\u5f00\u5bc6\u94a5\u3002 SSL \u7684\u6162\u5206\u4e24\u79cd\u3002\u4e00\u79cd\u662f\u6307\u901a\u4fe1\u6162\u3002\u53e6\u4e00\u79cd\u662f\u6307\u7531\u4e8e\u5927\u91cf\u6d88\u8017CPU \u53ca\u5185\u5b58\u7b49\u8d44\u6e90\uff0c\u5bfc\u81f4\u5904\u7406\u901f\u5ea6\u53d8\u6162\u3002 \u8be6\u7ec6\u901a\u4fe1\u8fc7\u7a0b\u89e3\u8bfb\u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b7.2 \u8282\u3002 \u66f4\u591aHTTP\u4ecb\u7ecd\u53c2\u8003\u300a\u56fe\u89e3HTTP\u300b\u3002","title":"HTTPS.md"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/","text":"1. \u7528\u5355\u53f0\u865a\u62df\u4e3b\u673a\u5b9e\u73b0\u591a\u4e2a\u57df\u540d \u00b6 HTTP/1.1 \u89c4\u8303\u5141\u8bb8\u4e00\u53f0 HTTP \u670d\u52a1\u5668\u642d\u5efa\u591a\u4e2a Web \u7ad9\u70b9\u3002\u5229\u7528\u4e86\u865a\u62df\u4e3b\u673a\uff08V i rt u al Host\uff0c\u53c8\u79f0\u865a\u62df\u670d\u52a1\u5668\uff09\u7684\u529f \u80fd\u3002 \u5728\u76f8\u540c\u7684 IP \u5730\u5740\u4e0b\uff0c\u7531\u4e8e\u865a\u62df\u4e3b\u673a\u53ef\u4ee5\u5bc4\u5b58\u591a\u4e2a\u4e0d\u540c\u4e3b\u673a\u540d\u548c\u57df\u540d\u7684 W eb \u7f51\u7ad9\uff0c\u56e0\u6b64\u5728\u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\uff0c\u5fc5\u987b\u5728 Host \u9996\u90e8\u5185\u5b8c\u6574\u6307\u5b9a\u4e3b\u673a\u540d\u6216\u57df\u540d\u7684 URI\u3002 2. \u901a\u4fe1\u6570\u636e\u8f6c\u53d1\u7a0b\u5e8f \uff1a\u4ee3\u7406\u3001\u7f51\u5173\u3001\u96a7\u9053 \u00b6 \u4ee3\u7406\u662f\u4e00\u79cd\u6709\u8f6c\u53d1\u529f\u80fd\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 \u7f51\u5173\u662f\u8f6c\u53d1\u5176\u4ed6\u670d\u52a1\u5668\u901a\u4fe1\u6570\u636e\u7684\u670d\u52a1\u5668\uff0c\u63a5\u6536\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u8bf7\u6c42\u65f6\uff0c\u5b83\u5c31\u50cf\u81ea\u5df1\u62e5\u6709\u8d44\u6e90\u7684\u6e90\u670d\u52a1\u5668\u4e00\u6837\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\u3002 \u96a7\u9053\u662f\u5728\u76f8\u9694\u751a\u8fdc\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e24\u8005\u4e4b\u95f4\u8fdb\u884c\u4e2d\u8f6c\uff0c\u5e76\u4fdd\u6301\u53cc\u65b9\u901a\u4fe1\u8fde\u63a5\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 2.1 \u4ee3\u7406 \u00b6 \u4ee3\u7406\u670d\u52a1\u5668\u7684\u57fa\u672c\u884c\u4e3a\u5c31\u662f\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u540e\u8f6c\u53d1\u7ed9\u5176\u4ed6\u670d\u52a1\u5668\u3002\u4ee3\u7406\u4e0d\u6539\u53d8\u8bf7\u6c42 URI\uff0c\u4f1a\u76f4\u63a5\u53d1\u9001\u7ed9\u524d\u65b9\u6301\u6709\u8d44\u6e90\u7684\u76ee\u6807\u670d\u52a1\u5668\u3002 \u8f6c\u53d1\u65f6\uff0c\u9700\u8981\u9644\u52a0 Via \u9996\u90e8\u5b57\u6bb5\u4ee5\u6807\u8bb0\u51fa\u7ecf\u8fc7\u7684\u4e3b\u673a\u4fe1\u606f\u3002 \u4f7f\u7528\u573a\u666f\uff1a \u5229\u7528\u7f13\u5b58\u6280\u672f\uff08\u7a0d\u540e\u8bb2\u89e3\uff09\u51cf\u5c11\u7f51\u7edc\u5e26\u5bbd\u7684\u6d41\u91cf \u7ec4\u7ec7\u5185\u90e8\u9488\u5bf9\u7279\u5b9a\u7f51\u7ad9\u7684\u8bbf\u95ee\u63a7\u5236 \u4ee5\u83b7\u53d6\u8bbf\u95ee\u65e5\u5fd7\u4e3a\u4e3b\u8981\u76ee\u7684 ...... \u7f13\u5b58\u4ee3\u7406 \u4ee3\u7406\u8f6c\u53d1\u54cd\u5e94\u65f6\uff0c\u7f13\u5b58\u4ee3\u7406\uff08Caching Proxy\uff09\u4f1a\u9884\u5148\u5c06\u8d44\u6e90\u7684\u526f\u672c \uff08\u7f13\u5b58\uff09\u4fdd\u5b58\u5728\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u3002 \u900f\u660e\u4ee3\u7406 \u8f6c\u53d1\u8bf7\u6c42\u6216\u54cd\u5e94\u65f6\uff0c\u4e0d\u5bf9\u62a5\u6587\u505a\u4efb\u4f55\u52a0\u5de5\u7684\u4ee3\u7406\u7c7b\u578b\u88ab\u79f0\u4e3a\u900f\u660e\u4ee3\u7406 \uff08Transparent Proxy\uff09\u3002 2.2 \u7f51\u5173 \u00b6 \u7f51\u5173\u80fd\u4f7f\u901a\u4fe1\u7ebf\u8def\u4e0a\u7684\u670d\u52a1\u5668\u63d0\u4f9b\u975e HTTP \u534f\u8bae\u670d\u52a1\u3002 2.3 \u96a7\u9053 \u00b6 \u96a7\u9053\u53ef\u6309\u8981\u6c42\u5efa\u7acb\u8d77\u4e00\u6761\u4e0e\u5176\u4ed6\u670d\u52a1\u5668\u7684\u901a\u4fe1\u7ebf\u8def\uff0c\u5c4a\u65f6\u4f7f\u7528 SSL \u7b49\u52a0\u5bc6\u624b\u6bb5\u8fdb\u884c\u901a\u4fe1\u3002\u96a7\u9053\u7684\u76ee\u7684\u662f\u786e\u4fdd\u5ba2\u6237\u7aef\u80fd\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5b89\u5168\u7684\u901a\u4fe1\u3002 \u96a7\u9053\u672c\u8eab\u4e0d\u4f1a\u53bb\u89e3\u6790 HTTP \u8bf7\u6c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bf7\u6c42\u4fdd\u6301\u539f\u6837\u4e2d\u8f6c\u7ed9\u4e4b\u540e\u7684\u670d\u52a1\u5668\u3002\u96a7\u9053\u4f1a\u5728\u901a\u4fe1\u53cc\u65b9\u65ad\u5f00\u8fde\u63a5\u65f6\u7ed3\u675f\u3002 \u96a7\u9053\u672c\u8eab\u662f\u900f\u660e\u7684\uff0c\u5ba2\u6237\u7aef\u4e0d\u7528\u5728\u610f\u96a7\u9053\u7684\u5b58\u5728\u3002 3. \u4fdd\u5b58\u8d44\u6e90\u7684\u7f13\u5b58 \u00b6 \u7f13\u5b58 \u6307\u4ee3\u7406\u670d\u52a1\u5668\u6216\u5ba2\u6237\u7aef\u672c\u5730\u78c1\u76d8\u5185\u4fdd\u5b58\u7684\u8d44\u6e90\u526f\u672c\u3002 3.1 \u7f13\u5b58\u7684\u6709\u6548\u671f\u9650 \u00b6 \u5373\u4f7f\u5b58\u5728\u7f13\u5b58\uff0c\u4e5f\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u8981\u6c42\u3001\u7f13\u5b58\u7684\u6709\u6548\u671f\u7b49\u56e0\u7d20\uff0c\u5411\u6e90\u670d\u52a1\u5668\u786e\u8ba4\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002 3.2 \u5ba2\u6237\u7aef\u7684\u7f13\u5b58 \u00b6 \u5b58\u5728\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\u4e2d\u3002\u4e5f\u4f1a\u786e\u8ba4\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002","title":"\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668.md"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#1","text":"HTTP/1.1 \u89c4\u8303\u5141\u8bb8\u4e00\u53f0 HTTP \u670d\u52a1\u5668\u642d\u5efa\u591a\u4e2a Web \u7ad9\u70b9\u3002\u5229\u7528\u4e86\u865a\u62df\u4e3b\u673a\uff08V i rt u al Host\uff0c\u53c8\u79f0\u865a\u62df\u670d\u52a1\u5668\uff09\u7684\u529f \u80fd\u3002 \u5728\u76f8\u540c\u7684 IP \u5730\u5740\u4e0b\uff0c\u7531\u4e8e\u865a\u62df\u4e3b\u673a\u53ef\u4ee5\u5bc4\u5b58\u591a\u4e2a\u4e0d\u540c\u4e3b\u673a\u540d\u548c\u57df\u540d\u7684 W eb \u7f51\u7ad9\uff0c\u56e0\u6b64\u5728\u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\uff0c\u5fc5\u987b\u5728 Host \u9996\u90e8\u5185\u5b8c\u6574\u6307\u5b9a\u4e3b\u673a\u540d\u6216\u57df\u540d\u7684 URI\u3002","title":"1. \u7528\u5355\u53f0\u865a\u62df\u4e3b\u673a\u5b9e\u73b0\u591a\u4e2a\u57df\u540d"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#2","text":"\u4ee3\u7406\u662f\u4e00\u79cd\u6709\u8f6c\u53d1\u529f\u80fd\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 \u7f51\u5173\u662f\u8f6c\u53d1\u5176\u4ed6\u670d\u52a1\u5668\u901a\u4fe1\u6570\u636e\u7684\u670d\u52a1\u5668\uff0c\u63a5\u6536\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u8bf7\u6c42\u65f6\uff0c\u5b83\u5c31\u50cf\u81ea\u5df1\u62e5\u6709\u8d44\u6e90\u7684\u6e90\u670d\u52a1\u5668\u4e00\u6837\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\u3002 \u96a7\u9053\u662f\u5728\u76f8\u9694\u751a\u8fdc\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e24\u8005\u4e4b\u95f4\u8fdb\u884c\u4e2d\u8f6c\uff0c\u5e76\u4fdd\u6301\u53cc\u65b9\u901a\u4fe1\u8fde\u63a5\u7684\u5e94\u7528\u7a0b\u5e8f\u3002","title":"2. \u901a\u4fe1\u6570\u636e\u8f6c\u53d1\u7a0b\u5e8f \uff1a\u4ee3\u7406\u3001\u7f51\u5173\u3001\u96a7\u9053"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#21","text":"\u4ee3\u7406\u670d\u52a1\u5668\u7684\u57fa\u672c\u884c\u4e3a\u5c31\u662f\u63a5\u6536\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u540e\u8f6c\u53d1\u7ed9\u5176\u4ed6\u670d\u52a1\u5668\u3002\u4ee3\u7406\u4e0d\u6539\u53d8\u8bf7\u6c42 URI\uff0c\u4f1a\u76f4\u63a5\u53d1\u9001\u7ed9\u524d\u65b9\u6301\u6709\u8d44\u6e90\u7684\u76ee\u6807\u670d\u52a1\u5668\u3002 \u8f6c\u53d1\u65f6\uff0c\u9700\u8981\u9644\u52a0 Via \u9996\u90e8\u5b57\u6bb5\u4ee5\u6807\u8bb0\u51fa\u7ecf\u8fc7\u7684\u4e3b\u673a\u4fe1\u606f\u3002 \u4f7f\u7528\u573a\u666f\uff1a \u5229\u7528\u7f13\u5b58\u6280\u672f\uff08\u7a0d\u540e\u8bb2\u89e3\uff09\u51cf\u5c11\u7f51\u7edc\u5e26\u5bbd\u7684\u6d41\u91cf \u7ec4\u7ec7\u5185\u90e8\u9488\u5bf9\u7279\u5b9a\u7f51\u7ad9\u7684\u8bbf\u95ee\u63a7\u5236 \u4ee5\u83b7\u53d6\u8bbf\u95ee\u65e5\u5fd7\u4e3a\u4e3b\u8981\u76ee\u7684 ...... \u7f13\u5b58\u4ee3\u7406 \u4ee3\u7406\u8f6c\u53d1\u54cd\u5e94\u65f6\uff0c\u7f13\u5b58\u4ee3\u7406\uff08Caching Proxy\uff09\u4f1a\u9884\u5148\u5c06\u8d44\u6e90\u7684\u526f\u672c \uff08\u7f13\u5b58\uff09\u4fdd\u5b58\u5728\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u3002 \u900f\u660e\u4ee3\u7406 \u8f6c\u53d1\u8bf7\u6c42\u6216\u54cd\u5e94\u65f6\uff0c\u4e0d\u5bf9\u62a5\u6587\u505a\u4efb\u4f55\u52a0\u5de5\u7684\u4ee3\u7406\u7c7b\u578b\u88ab\u79f0\u4e3a\u900f\u660e\u4ee3\u7406 \uff08Transparent Proxy\uff09\u3002","title":"2.1 \u4ee3\u7406"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#22","text":"\u7f51\u5173\u80fd\u4f7f\u901a\u4fe1\u7ebf\u8def\u4e0a\u7684\u670d\u52a1\u5668\u63d0\u4f9b\u975e HTTP \u534f\u8bae\u670d\u52a1\u3002","title":"2.2 \u7f51\u5173"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#23","text":"\u96a7\u9053\u53ef\u6309\u8981\u6c42\u5efa\u7acb\u8d77\u4e00\u6761\u4e0e\u5176\u4ed6\u670d\u52a1\u5668\u7684\u901a\u4fe1\u7ebf\u8def\uff0c\u5c4a\u65f6\u4f7f\u7528 SSL \u7b49\u52a0\u5bc6\u624b\u6bb5\u8fdb\u884c\u901a\u4fe1\u3002\u96a7\u9053\u7684\u76ee\u7684\u662f\u786e\u4fdd\u5ba2\u6237\u7aef\u80fd\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5b89\u5168\u7684\u901a\u4fe1\u3002 \u96a7\u9053\u672c\u8eab\u4e0d\u4f1a\u53bb\u89e3\u6790 HTTP \u8bf7\u6c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bf7\u6c42\u4fdd\u6301\u539f\u6837\u4e2d\u8f6c\u7ed9\u4e4b\u540e\u7684\u670d\u52a1\u5668\u3002\u96a7\u9053\u4f1a\u5728\u901a\u4fe1\u53cc\u65b9\u65ad\u5f00\u8fde\u63a5\u65f6\u7ed3\u675f\u3002 \u96a7\u9053\u672c\u8eab\u662f\u900f\u660e\u7684\uff0c\u5ba2\u6237\u7aef\u4e0d\u7528\u5728\u610f\u96a7\u9053\u7684\u5b58\u5728\u3002","title":"2.3 \u96a7\u9053"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#3","text":"\u7f13\u5b58 \u6307\u4ee3\u7406\u670d\u52a1\u5668\u6216\u5ba2\u6237\u7aef\u672c\u5730\u78c1\u76d8\u5185\u4fdd\u5b58\u7684\u8d44\u6e90\u526f\u672c\u3002","title":"3. \u4fdd\u5b58\u8d44\u6e90\u7684\u7f13\u5b58"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#31","text":"\u5373\u4f7f\u5b58\u5728\u7f13\u5b58\uff0c\u4e5f\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u8981\u6c42\u3001\u7f13\u5b58\u7684\u6709\u6548\u671f\u7b49\u56e0\u7d20\uff0c\u5411\u6e90\u670d\u52a1\u5668\u786e\u8ba4\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002","title":"3.1 \u7f13\u5b58\u7684\u6709\u6548\u671f\u9650"},{"location":"http\u534f\u8bae/\u4e0e HTTP \u534f\u4f5c\u7684 Web \u670d\u52a1\u5668/#32","text":"\u5b58\u5728\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\u4e2d\u3002\u4e5f\u4f1a\u786e\u8ba4\u8d44\u6e90\u7684\u6709\u6548\u6027\u3002","title":"3.2 \u5ba2\u6237\u7aef\u7684\u7f13\u5b58"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/","text":"\u300a\u56fe\u89e3HTTP\u300b 1. TCP/IP\u534f\u8bae\u65cf \u00b6 \u200b \u628a\u4e0e\u4e92\u8054\u7f51\u76f8\u5173\u8054\u7684\u534f\u8bae\u96c6\u5408\u8d77\u6765\u603b\u79f0\u4e3a TCP/IP \u3002 \u200b TCP/ IP \u534f\u8bae\u65cf\u6309\u5c42\u6b21\u5206\u522b\u5206\u4e3a\u4ee5\u4e0b 4 \u5c42\uff1a\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u548c\u6570\u636e\u94fe\u8def\u5c42\u3002 \u200b IP \u534f\u8bae\u7684\u4f5c\u7528\u662f\u628a\u5404\u79cd\u6570\u636e\u5305\u4f20\u9001\u7ed9\u5bf9\u65b9\u3002 \u200b TCP \u534f\u8bae\u91c7\u7528\u4e86\u4e09\u6b21\u63e1\u624b\uff08three-way handshaking\uff09\u7b56\u7565\uff0c\u63e1\u624b\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86 TCP \u7684\u6807\u5fd7\uff08flag \uff09 \u2014\u2014 SYN\uff08synchronize\uff09 \u548c ACK\uff08acknowledgement\uff09\u3002 \u200b \u53d1\u9001\u7aef\u9996\u5148\u53d1\u9001\u4e00\u4e2a\u5e26 SYN \u6807\u5fd7\u7684\u6570\u636e\u5305\u7ed9\u5bf9\u65b9\u3002\u63a5\u6536\u7aef\u6536\u5230\u540e\uff0c\u56de\u4f20\u4e00\u4e2a\u5e26\u6709 SYN/ACK \u6807\u5fd7\u7684\u6570\u636e\u5305\u4ee5\u793a\u4f20\u8fbe\u786e\u8ba4\u4fe1\u606f\u3002\u6700\u540e\uff0c\u53d1\u9001\u7aef\u518d\u56de\u4f20\u4e00\u4e2a\u5e26 ACK \u6807\u5fd7\u7684\u6570\u636e\u5305\uff0c\u4ee3\u8868\u201c\u63e1\u624b\u201d\u7ed3\u675f\u3002 2. URI\u548cURL \u00b6 URI\uff08\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\uff09\uff0c URL \uff08Uniform Resource Locator\uff0c\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff09\u3002URL \u6b63\u662f\u4f7f\u7528 Web \u6d4f\u89c8\u5668\u7b49 \u8bbf\u95ee Web \u9875\u9762\u65f6\u9700\u8981\u8f93\u5165\u7684\u7f51\u9875\u5730\u5740\u3002 URI \u5c31\u662f\u7531\u67d0\u4e2a\u534f\u8bae\u65b9\u6848\u8868\u793a\u7684\u8d44\u6e90\u7684\u5b9a\u4f4d\u6807\u8bc6\u7b26\u3002 URI \u7528\u5b57\u7b26\u4e32\u6807\u8bc6\u67d0\u4e00\u4e92\u8054\u7f51\u8d44\u6e90\uff0c\u800c URL \u8868\u793a\u8d44\u6e90\u7684\u5730\u70b9\uff08\u4e92\u8054 \u7f51\u4e0a\u6240\u5904\u7684\u4f4d\u7f6e\uff09\u3002\u53ef\u89c1 URL \u662f URI \u7684\u5b50\u96c6\u3002 3. \u7b80\u5355\u7684 HTTP \u534f\u8bae \u00b6 3.1 \u8bf7\u6c42\u62a5\u6587 \u00b6 \u8bf7\u6c42\u62a5\u6587\u662f\u7531\u8bf7\u6c42\u65b9\u6cd5\u3001\u8bf7\u6c42 URI\u3001\u534f\u8bae\u7248\u672c\u3001\u53ef\u9009\u7684\u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5\u548c\u5185\u5bb9\u5b9e\u4f53\u6784\u6210\u7684\uff1a 3.2 \u54cd\u5e94\u62a5\u6587 \u00b6 \u54cd\u5e94\u62a5\u6587\u57fa\u672c\u4e0a\u7531\u534f\u8bae\u7248\u672c\u3001\u72b6\u6001\u7801\uff08\u8868\u793a\u8bf7\u6c42\u6210\u529f\u6216\u5931\u8d25\u7684\u6570\u5b57\u4ee3\u7801\uff09\u3001\u7528\u4ee5\u89e3\u91ca\u72b6\u6001\u7801\u7684\u539f\u56e0\u77ed\u8bed\u3001\u53ef\u9009\u7684\u54cd\u5e94\u9996\u90e8\u5b57\u6bb5\u4ee5\u53ca\u5b9e\u4f53\u4e3b\u4f53\u6784\u6210\uff1a 3.3 \u65e0\u72b6\u6001\u534f\u8bae \u00b6 HTTP\u672c\u8eab\u4e0d\u4fdd\u5b58\u8bf7\u6c42\u548c\u54cd\u5e94\u4e4b\u95f4\u7684\u901a\u4fe1\u72b6\u6001\u3002\u4e3a\u4e86\u5b9e\u73b0\u671f\u671b\u7684\u4fdd\u6301\u72b6\u6001\u7684\u529f\u80fd\uff0c\u5f15\u5165\u4e86 cookie \u6280\u672f\u3002 3.4 HTTP \u65b9\u6cd5 \u00b6 GET \uff1a\u83b7\u53d6\u8d44\u6e90 POST \uff1a\u4f20\u8f93\u5b9e\u4f53\u4e3b\u4f53 \u867d\u7136\u7528 GET \u65b9\u6cd5\u4e5f\u53ef\u4ee5\u4f20\u8f93\u5b9e\u4f53\u7684\u4e3b\u4f53\uff0c\u4f46\u4e00\u822c\u4e0d\u7528 GET \u65b9\u6cd5\u8fdb\u884c\u4f20\u8f93\uff0c\u800c\u662f\u7528 POST \u65b9\u6cd5\u3002\u867d\u8bf4 POST \u7684\u529f\u80fd\u4e0e GET \u5f88\u76f8\u4f3c\uff0c\u4f46POST \u7684\u4e3b\u8981\u76ee\u7684\u5e76\u4e0d\u662f\u83b7\u53d6\u54cd\u5e94\u7684\u4e3b\u4f53\u5185\u5bb9\u3002 PUT \uff1a\u4f20\u8f93\u6587\u4ef6 HEAD \uff1a\u83b7\u5f97\u62a5\u6587\u9996\u90e8 HEAD \u65b9\u6cd5\u548c GET \u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u662f\u4e0d\u8fd4\u56de URI \u7684\u6709\u6548\u6027\u53ca\u8d44\u6e90\u66f4\u65b0\u7684\u65e5\u671f\u65f6\u95f4\u7b49\u3002 DELETE \uff1a\u5220\u9664\u6587\u4ef6 OPTIONS \uff1a\u8be2\u95ee\u652f\u6301\u7684\u65b9\u6cd5 OPTIONS \u65b9\u6cd5\u7528\u6765\u67e5\u8be2\u9488\u5bf9\u8bf7\u6c42 U RI \u6307\u5b9a\u7684\u8d44\u6e90\u652f\u6301\u7684\u65b9\u6cd5\u3002 TRACE \uff1a\u8ffd\u8e2a\u8def\u5f84 TRACE \u65b9\u6cd5\u662f\u8ba9 W eb \u670d\u52a1\u5668\u7aef\u5c06\u4e4b\u524d\u7684\u8bf7\u6c42\u901a\u4fe1\u73af\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5\u3002 \u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5728 Max -Forwards \u9996\u90e8\u5b57\u6bb5\u4e2d\u586b\u5165\u6570\u503c\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u670d\u52a1\u5668\u7aef\u5c31\u5c06\u8be5\u6570\u5b57\u51cf 1\uff0c\u5f53\u6570\u503c\u521a\u597d\u51cf\u5230 0 \u65f6\uff0c\u5c31\u505c\u6b62\u7ee7\u7eed\u4f20\u8f93\uff0c\u6700\u540e\u63a5\u6536\u5230\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7aef\u5219\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u7684\u54cd\u5e94\u3002 \u5f88\u5c11\u4f7f\u7528\u3002 CONNECT \uff1a\u8981\u6c42\u7528\u96a7\u9053\u534f\u8bae\u8fde\u63a5\u4ee3\u7406 CONNECT \u65b9\u6cd5\u8981\u6c42\u5728\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u901a\u4fe1\u65f6\u5efa\u7acb\u96a7\u9053\uff0c\u5b9e\u73b0\u7528\u96a7\u9053\u534f\u8bae\u8fdb\u884c TCP \u901a\u4fe1\u3002\u4e3b\u8981\u4f7f\u7528 SSL \uff08Secure Sockets Layer\uff0c\u5b89\u5168\u5957\u63a5\u5c42\uff09\u548c TLS\uff08Transport Layer Security\uff0c\u4f20\u8f93\u5c42\u5b89\u5168\uff09\u534f\u8bae\u628a\u901a\u4fe1\u5185\u5bb9\u52a0\u5bc6\u540e\u7ecf\u7f51\u7edc\u96a7\u9053\u4f20\u8f93\u3002 \u683c\u5f0f\uff1a CONNECT \u4ee3\u7406\u670d\u52a1\u5668\u540d:\u7aef\u53e3\u53f7 HTTP\u7248\u672c \u3002 3.4.1 \u65b9\u6cd5\u603b\u7ed3 \u00b6 \u4e0b\u8868\u5217\u51fa\u4e86 HTTP/1.0 \u548c HTTP/1.1 \u652f\u6301\u7684\u65b9\u6cd5\u3002\u53e6\u5916\uff0c\u65b9\u6cd5\u540d\u533a\u5206\u5927 \u5c0f\u5199\uff0c\u6ce8\u610f\u8981\u7528\u5927\u5199\u5b57\u6bcd\u3002 3.5 \u6301\u4e45\u8fde\u63a5 \u00b6 \u6301\u4e45\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219 \u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001 \u3002\u6301\u4e45\u8fde\u63a5\u65e8\u5728\u5efa\u7acb 1 \u6b21 TCP \u8fde\u63a5\u540e\u8fdb\u884c\u591a\u6b21\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4ea4\u4e92\u3002 \u7ba1\u7ebf\u5316 \u6280\u672f\u51fa\u73b0\u540e\uff0c\u4e0d\u7528\u7b49\u5f85\u54cd\u5e94\u4ea6\u53ef\u76f4\u63a5\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u3002 3.6 \u4f7f\u7528Cookie \u8fdb\u884c\u72b6\u6001\u7ba1\u7406 \u00b6 Cookie \u6280\u672f\u901a\u8fc7\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u62a5\u6587\u4e2d\u5199\u5165 Cookie \u4fe1\u606f\u6765\u63a7\u5236\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u3002 Cookie \u4f1a\u6839\u636e\u4ece\u670d\u52a1\u5668\u7aef\u53d1\u9001\u7684\u54cd\u5e94\u62a5\u6587\u5185\u7684\u4e00\u4e2a\u53eb\u505a Set-Cookie \u7684\u9996\u90e8\u5b57\u6bb5\u4fe1\u606f\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u4fdd\u5b58 Cookie\u3002\u5f53\u4e0b\u6b21\u5ba2\u6237\u7aef\u518d\u5f80\u8be5\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u81ea\u52a8\u5728\u8bf7\u6c42\u62a5\u6587\u4e2d\u52a0\u5165 Cookie \u503c\u540e\u53d1\u9001\u51fa\u53bb\u3002 \u670d\u52a1\u5668\u7aef\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684 Cookie \u540e\uff0c\u4f1a\u53bb\u68c0\u67e5\u7a76\u7adf\u662f\u4ece\u54ea\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5bf9\u6bd4\u670d\u52a1\u5668\u4e0a\u7684\u8bb0\u5f55\uff0c\u6700\u540e\u5f97\u5230\u4e4b\u524d\u7684\u72b6\u6001\u4fe1\u606f\u3002","title":"\u7b80\u4ecb.md"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#1-tcpip","text":"\u200b \u628a\u4e0e\u4e92\u8054\u7f51\u76f8\u5173\u8054\u7684\u534f\u8bae\u96c6\u5408\u8d77\u6765\u603b\u79f0\u4e3a TCP/IP \u3002 \u200b TCP/ IP \u534f\u8bae\u65cf\u6309\u5c42\u6b21\u5206\u522b\u5206\u4e3a\u4ee5\u4e0b 4 \u5c42\uff1a\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u548c\u6570\u636e\u94fe\u8def\u5c42\u3002 \u200b IP \u534f\u8bae\u7684\u4f5c\u7528\u662f\u628a\u5404\u79cd\u6570\u636e\u5305\u4f20\u9001\u7ed9\u5bf9\u65b9\u3002 \u200b TCP \u534f\u8bae\u91c7\u7528\u4e86\u4e09\u6b21\u63e1\u624b\uff08three-way handshaking\uff09\u7b56\u7565\uff0c\u63e1\u624b\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86 TCP \u7684\u6807\u5fd7\uff08flag \uff09 \u2014\u2014 SYN\uff08synchronize\uff09 \u548c ACK\uff08acknowledgement\uff09\u3002 \u200b \u53d1\u9001\u7aef\u9996\u5148\u53d1\u9001\u4e00\u4e2a\u5e26 SYN \u6807\u5fd7\u7684\u6570\u636e\u5305\u7ed9\u5bf9\u65b9\u3002\u63a5\u6536\u7aef\u6536\u5230\u540e\uff0c\u56de\u4f20\u4e00\u4e2a\u5e26\u6709 SYN/ACK \u6807\u5fd7\u7684\u6570\u636e\u5305\u4ee5\u793a\u4f20\u8fbe\u786e\u8ba4\u4fe1\u606f\u3002\u6700\u540e\uff0c\u53d1\u9001\u7aef\u518d\u56de\u4f20\u4e00\u4e2a\u5e26 ACK \u6807\u5fd7\u7684\u6570\u636e\u5305\uff0c\u4ee3\u8868\u201c\u63e1\u624b\u201d\u7ed3\u675f\u3002","title":"1. TCP/IP\u534f\u8bae\u65cf"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#2-uriurl","text":"URI\uff08\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\uff09\uff0c URL \uff08Uniform Resource Locator\uff0c\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff09\u3002URL \u6b63\u662f\u4f7f\u7528 Web \u6d4f\u89c8\u5668\u7b49 \u8bbf\u95ee Web \u9875\u9762\u65f6\u9700\u8981\u8f93\u5165\u7684\u7f51\u9875\u5730\u5740\u3002 URI \u5c31\u662f\u7531\u67d0\u4e2a\u534f\u8bae\u65b9\u6848\u8868\u793a\u7684\u8d44\u6e90\u7684\u5b9a\u4f4d\u6807\u8bc6\u7b26\u3002 URI \u7528\u5b57\u7b26\u4e32\u6807\u8bc6\u67d0\u4e00\u4e92\u8054\u7f51\u8d44\u6e90\uff0c\u800c URL \u8868\u793a\u8d44\u6e90\u7684\u5730\u70b9\uff08\u4e92\u8054 \u7f51\u4e0a\u6240\u5904\u7684\u4f4d\u7f6e\uff09\u3002\u53ef\u89c1 URL \u662f URI \u7684\u5b50\u96c6\u3002","title":"2. URI\u548cURL"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#3-http","text":"","title":"3. \u7b80\u5355\u7684 HTTP \u534f\u8bae"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#31","text":"\u8bf7\u6c42\u62a5\u6587\u662f\u7531\u8bf7\u6c42\u65b9\u6cd5\u3001\u8bf7\u6c42 URI\u3001\u534f\u8bae\u7248\u672c\u3001\u53ef\u9009\u7684\u8bf7\u6c42\u9996\u90e8\u5b57\u6bb5\u548c\u5185\u5bb9\u5b9e\u4f53\u6784\u6210\u7684\uff1a","title":"3.1 \u8bf7\u6c42\u62a5\u6587"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#32","text":"\u54cd\u5e94\u62a5\u6587\u57fa\u672c\u4e0a\u7531\u534f\u8bae\u7248\u672c\u3001\u72b6\u6001\u7801\uff08\u8868\u793a\u8bf7\u6c42\u6210\u529f\u6216\u5931\u8d25\u7684\u6570\u5b57\u4ee3\u7801\uff09\u3001\u7528\u4ee5\u89e3\u91ca\u72b6\u6001\u7801\u7684\u539f\u56e0\u77ed\u8bed\u3001\u53ef\u9009\u7684\u54cd\u5e94\u9996\u90e8\u5b57\u6bb5\u4ee5\u53ca\u5b9e\u4f53\u4e3b\u4f53\u6784\u6210\uff1a","title":"3.2 \u54cd\u5e94\u62a5\u6587"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#33","text":"HTTP\u672c\u8eab\u4e0d\u4fdd\u5b58\u8bf7\u6c42\u548c\u54cd\u5e94\u4e4b\u95f4\u7684\u901a\u4fe1\u72b6\u6001\u3002\u4e3a\u4e86\u5b9e\u73b0\u671f\u671b\u7684\u4fdd\u6301\u72b6\u6001\u7684\u529f\u80fd\uff0c\u5f15\u5165\u4e86 cookie \u6280\u672f\u3002","title":"3.3 \u65e0\u72b6\u6001\u534f\u8bae"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#34-http","text":"GET \uff1a\u83b7\u53d6\u8d44\u6e90 POST \uff1a\u4f20\u8f93\u5b9e\u4f53\u4e3b\u4f53 \u867d\u7136\u7528 GET \u65b9\u6cd5\u4e5f\u53ef\u4ee5\u4f20\u8f93\u5b9e\u4f53\u7684\u4e3b\u4f53\uff0c\u4f46\u4e00\u822c\u4e0d\u7528 GET \u65b9\u6cd5\u8fdb\u884c\u4f20\u8f93\uff0c\u800c\u662f\u7528 POST \u65b9\u6cd5\u3002\u867d\u8bf4 POST \u7684\u529f\u80fd\u4e0e GET \u5f88\u76f8\u4f3c\uff0c\u4f46POST \u7684\u4e3b\u8981\u76ee\u7684\u5e76\u4e0d\u662f\u83b7\u53d6\u54cd\u5e94\u7684\u4e3b\u4f53\u5185\u5bb9\u3002 PUT \uff1a\u4f20\u8f93\u6587\u4ef6 HEAD \uff1a\u83b7\u5f97\u62a5\u6587\u9996\u90e8 HEAD \u65b9\u6cd5\u548c GET \u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u662f\u4e0d\u8fd4\u56de URI \u7684\u6709\u6548\u6027\u53ca\u8d44\u6e90\u66f4\u65b0\u7684\u65e5\u671f\u65f6\u95f4\u7b49\u3002 DELETE \uff1a\u5220\u9664\u6587\u4ef6 OPTIONS \uff1a\u8be2\u95ee\u652f\u6301\u7684\u65b9\u6cd5 OPTIONS \u65b9\u6cd5\u7528\u6765\u67e5\u8be2\u9488\u5bf9\u8bf7\u6c42 U RI \u6307\u5b9a\u7684\u8d44\u6e90\u652f\u6301\u7684\u65b9\u6cd5\u3002 TRACE \uff1a\u8ffd\u8e2a\u8def\u5f84 TRACE \u65b9\u6cd5\u662f\u8ba9 W eb \u670d\u52a1\u5668\u7aef\u5c06\u4e4b\u524d\u7684\u8bf7\u6c42\u901a\u4fe1\u73af\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u65b9\u6cd5\u3002 \u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5728 Max -Forwards \u9996\u90e8\u5b57\u6bb5\u4e2d\u586b\u5165\u6570\u503c\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u670d\u52a1\u5668\u7aef\u5c31\u5c06\u8be5\u6570\u5b57\u51cf 1\uff0c\u5f53\u6570\u503c\u521a\u597d\u51cf\u5230 0 \u65f6\uff0c\u5c31\u505c\u6b62\u7ee7\u7eed\u4f20\u8f93\uff0c\u6700\u540e\u63a5\u6536\u5230\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7aef\u5219\u8fd4\u56de\u72b6\u6001\u7801 200 OK \u7684\u54cd\u5e94\u3002 \u5f88\u5c11\u4f7f\u7528\u3002 CONNECT \uff1a\u8981\u6c42\u7528\u96a7\u9053\u534f\u8bae\u8fde\u63a5\u4ee3\u7406 CONNECT \u65b9\u6cd5\u8981\u6c42\u5728\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u901a\u4fe1\u65f6\u5efa\u7acb\u96a7\u9053\uff0c\u5b9e\u73b0\u7528\u96a7\u9053\u534f\u8bae\u8fdb\u884c TCP \u901a\u4fe1\u3002\u4e3b\u8981\u4f7f\u7528 SSL \uff08Secure Sockets Layer\uff0c\u5b89\u5168\u5957\u63a5\u5c42\uff09\u548c TLS\uff08Transport Layer Security\uff0c\u4f20\u8f93\u5c42\u5b89\u5168\uff09\u534f\u8bae\u628a\u901a\u4fe1\u5185\u5bb9\u52a0\u5bc6\u540e\u7ecf\u7f51\u7edc\u96a7\u9053\u4f20\u8f93\u3002 \u683c\u5f0f\uff1a CONNECT \u4ee3\u7406\u670d\u52a1\u5668\u540d:\u7aef\u53e3\u53f7 HTTP\u7248\u672c \u3002","title":"3.4 HTTP \u65b9\u6cd5"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#341","text":"\u4e0b\u8868\u5217\u51fa\u4e86 HTTP/1.0 \u548c HTTP/1.1 \u652f\u6301\u7684\u65b9\u6cd5\u3002\u53e6\u5916\uff0c\u65b9\u6cd5\u540d\u533a\u5206\u5927 \u5c0f\u5199\uff0c\u6ce8\u610f\u8981\u7528\u5927\u5199\u5b57\u6bcd\u3002","title":"3.4.1 \u65b9\u6cd5\u603b\u7ed3"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#35","text":"\u6301\u4e45\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219 \u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001 \u3002\u6301\u4e45\u8fde\u63a5\u65e8\u5728\u5efa\u7acb 1 \u6b21 TCP \u8fde\u63a5\u540e\u8fdb\u884c\u591a\u6b21\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4ea4\u4e92\u3002 \u7ba1\u7ebf\u5316 \u6280\u672f\u51fa\u73b0\u540e\uff0c\u4e0d\u7528\u7b49\u5f85\u54cd\u5e94\u4ea6\u53ef\u76f4\u63a5\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u3002","title":"3.5 \u6301\u4e45\u8fde\u63a5"},{"location":"http\u534f\u8bae/\u7b80\u4ecb/#36-cookie","text":"Cookie \u6280\u672f\u901a\u8fc7\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u62a5\u6587\u4e2d\u5199\u5165 Cookie \u4fe1\u606f\u6765\u63a7\u5236\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u3002 Cookie \u4f1a\u6839\u636e\u4ece\u670d\u52a1\u5668\u7aef\u53d1\u9001\u7684\u54cd\u5e94\u62a5\u6587\u5185\u7684\u4e00\u4e2a\u53eb\u505a Set-Cookie \u7684\u9996\u90e8\u5b57\u6bb5\u4fe1\u606f\uff0c\u901a\u77e5\u5ba2\u6237\u7aef\u4fdd\u5b58 Cookie\u3002\u5f53\u4e0b\u6b21\u5ba2\u6237\u7aef\u518d\u5f80\u8be5\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u81ea\u52a8\u5728\u8bf7\u6c42\u62a5\u6587\u4e2d\u52a0\u5165 Cookie \u503c\u540e\u53d1\u9001\u51fa\u53bb\u3002 \u670d\u52a1\u5668\u7aef\u53d1\u73b0\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684 Cookie \u540e\uff0c\u4f1a\u53bb\u68c0\u67e5\u7a76\u7adf\u662f\u4ece\u54ea\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5bf9\u6bd4\u670d\u52a1\u5668\u4e0a\u7684\u8bb0\u5f55\uff0c\u6700\u540e\u5f97\u5230\u4e4b\u524d\u7684\u72b6\u6001\u4fe1\u606f\u3002","title":"3.6 \u4f7f\u7528Cookie \u8fdb\u884c\u72b6\u6001\u7ba1\u7406"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/","text":"\u4ee5 3 \u4f4d\u6570\u5b57\u548c\u539f\u56e0\u77ed\u8bed\u7ec4\u6210\u3002 \u6570\u5b57\u4e2d\u7684\u7b2c\u4e00\u4f4d\u6307\u5b9a\u4e86\u54cd\u5e94\u7c7b\u522b\uff0c\u540e\u4e24\u4f4d\u65e0\u5206\u7c7b\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4ee3\u8868\u6027\u768414\u79cd\u72b6\u6001\u7801\u3002 1. 2XX \u6210\u529f \u00b6 1.1 200 OK \u00b6 \u5728\u54cd\u5e94\u62a5\u6587\u5185\uff0c\u968f\u72b6\u6001\u7801\u4e00\u8d77\u8fd4\u56de\u7684\u4fe1\u606f\u4f1a\u56e0\u65b9\u6cd5\u7684\u4e0d\u540c\u800c\u53d1\u751f\u6539\u53d8\u3002 1.2 204 No Content \u00b6 \u8be5\u72b6\u6001\u7801\u4ee3\u8868\u670d\u52a1\u5668\u63a5\u6536\u7684\u8bf7\u6c42\u5df2\u6210\u529f\u5904\u7406\uff0c\u4f46\u5728\u8fd4\u56de\u7684\u54cd\u5e94\u62a5\u6587\u4e2d\u4e0d\u542b\u5b9e\u4f53\u7684\u4e3b\u4f53\u90e8\u5206\u3002 1.3 206 Partial Content \u00b6 \u54cd\u5e94\u62a5\u6587\u4e2d\u5305\u542b\u7531 Content-Range \u6307\u5b9a\u8303\u56f4\u7684\u5b9e\u4f53\u5185\u5bb9\u3002 2. 3XX \u91cd\u5b9a\u5411 \u00b6 3XX \u54cd\u5e94\u7ed3\u679c\u8868\u660e\u6d4f\u89c8\u5668\u9700\u8981\u6267\u884c\u67d0\u4e9b\u7279\u6b8a\u7684\u5904\u7406\u4ee5\u6b63\u786e\u5904\u7406\u8bf7\u6c42\u3002 2.1 301 Moved Permanently \u00b6 \u6c38\u4e45\u6027\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u88ab\u5206\u914d\u4e86\u65b0\u7684 URI\uff0c\u4ee5\u540e\u5e94\u4f7f\u7528\u8d44\u6e90\u73b0\u5728\u6240\u6307\u7684 URI\u3002 2.2 302 Found \u00b6 \u4e34\u65f6\u6027\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u88ab\u5206\u914d\u4e86\u65b0\u7684 URI\uff0c\u5e0c\u671b\u7528\u6237\uff08\u672c\u6b21\uff09\u80fd\u4f7f\u7528\u65b0\u7684 URI \u8bbf\u95ee\u3002 302 \u72b6\u6001\u7801\u4ee3\u8868\u7684\u8d44\u6e90\u4e0d\u662f\u88ab\u6c38\u4e45\u79fb\u52a8\uff0c\u53ea\u662f\u4e34\u65f6\u6027\u8d28\u7684\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5df2\u79fb\u52a8\u7684\u8d44\u6e90\u5bf9\u5e94\u7684 URI \u5c06\u6765\u8fd8\u6709\u53ef\u80fd\u53d1\u751f\u6539\u53d8\u3002 2.3 303 See Other \u00b6 \u8be5\u72b6\u6001\u7801\u8868\u793a\u7531\u4e8e\u8bf7\u6c42\u5bf9\u5e94\u7684\u8d44\u6e90\u5b58\u5728\u7740\u53e6\u4e00\u4e2a URI\uff0c\u5e94\u4f7f\u7528 GET \u65b9\u6cd5\u5b9a\u5411\u83b7\u53d6\u8bf7\u6c42\u7684\u8d44\u6e90\u3002 303 \u72b6\u6001\u7801\u548c 302 Found \u72b6\u6001\u7801\u6709\u7740\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f46 303 \u72b6\u6001\u7801\u660e\u786e\u8868\u793a\u5ba2\u6237\u7aef\u5e94\u5f53\u91c7\u7528 GET \u65b9\u6cd5\u83b7\u53d6\u8d44\u6e90\u3002 \u6ce8\u610f \uff1a\u5f53 301\u3001302\u3001303 \u54cd\u5e94\u72b6\u6001\u7801\u8fd4\u56de\u65f6\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u6d4f\u89c8\u5668\u90fd\u4f1a\u628aPOST \u6539\u6210 GET\uff0c\u5e76\u5220\u9664\u8bf7\u6c42\u62a5\u6587\u5185\u7684\u4e3b\u4f53\uff0c\u4e4b\u540e\u8bf7\u6c42\u4f1a\u81ea\u52a8\u518d\u6b21\u53d1\u9001\u3002 301\u3001302 \u6807\u51c6\u662f\u7981\u6b62\u5c06 POST \u65b9\u6cd5\u6539\u53d8\u6210 GET \u65b9\u6cd5\u7684\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u65f6\u5927\u5bb6\u90fd\u4f1a\u8fd9\u4e48\u505a\u3002 2.4 304 Not Modified \u00b6 \u8be5\u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u9001\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\uff08\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\u662f\u6307\u91c7\u7528 GET \u65b9\u6cd5\u7684\u8bf7\u6c42\u62a5\u6587\u4e2d\u5305\u542b If-Match\uff0cIf-ModifiedSince\uff0cIf-None-Match\uff0cIf-Range\uff0cIf-Unmodified-Since \u4e2d\u4efb\u4e00\u9996\u90e8\uff09\u65f6\uff0c\u670d\u52a1\u5668\u7aef\u5141\u8bb8\u8bf7\u6c42\u8bbf\u95ee\u8d44\u6e90\uff0c\u4f46\u672a\u6ee1\u8db3\u6761\u4ef6\u7684\u60c5\u51b5\u3002304 \u72b6\u6001\u7801\u8fd4\u56de\u65f6\uff0c\u4e0d\u5305\u542b\u4efb\u4f55\u54cd\u5e94\u7684\u4e3b\u4f53\u90e8\u5206\u3002 2.5 307 Temporary Redirect \u00b6 \u4e34\u65f6\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u4e0e 302 Found \u6709\u7740\u76f8\u540c\u7684\u542b\u4e49\u3002 \u533a\u522b\u5c31\u662f 307 \u4f1a\u9075\u7167\u6d4f\u89c8\u5668\u6807\u51c6\uff0c\u4e0d\u4f1a\u4ece POST \u53d8\u6210 GET\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u5904\u7406\u54cd\u5e94\u65f6\u7684\u884c\u4e3a\uff0c\u6bcf\u79cd\u6d4f\u89c8\u5668\u6709\u53ef\u80fd\u51fa\u73b0\u4e0d\u540c\u7684\u60c5\u51b5\u3002 3. 4XX \u5ba2\u6237\u7aef\u9519\u8bef \u00b6 3.1 400 Bad Request \u00b6 \u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u62a5\u6587\u4e2d\u5b58\u5728\u8bed\u6cd5\u9519\u8bef\u3002\u53e6\u5916\uff0c\u6d4f\u89c8\u5668\u4f1a\u50cf 200 OK \u4e00\u6837\u5bf9\u5f85\u8be5\u72b6\u6001\u7801\u3002 3.2 401 Unauthorized \u00b6 \u8be5\u72b6\u6001\u7801\u8868\u793a\u53d1\u9001\u7684\u8bf7\u6c42\u9700\u8981\u6709\u901a\u8fc7 HTTP \u8ba4\u8bc1\uff08BASIC \u8ba4\u8bc1\u3001DIGEST \u8ba4\u8bc1\uff09\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002\u5f53\u6d4f\u89c8\u5668\u521d\u6b21\u63a5\u6536\u5230 401 \u54cd\u5e94\uff0c\u4f1a\u5f39\u51fa\u8ba4\u8bc1\u7528\u7684\u5bf9\u8bdd\u7a97\u53e3\uff1b\u518d\u6b21\u63a5\u6536\u5230\u8bf7\u6c42\u5e76\u8fd4\u56de\u8be5\u72b6\u6001\u7801\u65f6\uff0c\u5219\u8868\u793a\u8ba4\u8bc1\u5931\u8d25\u3002 3.3 403 Forbidden \u00b6 \u5bf9\u8bf7\u6c42\u8d44\u6e90\u7684\u8bbf\u95ee\u88ab\u670d\u52a1\u5668\u62d2\u7edd\u4e86\u3002\u53ef\u4ee5\u5728\u5b9e\u4f53\u7684\u4e3b\u4f53\u90e8\u5206\u5bf9\u539f\u56e0\u4f5c\u63cf\u8ff0\u3002 3.4 404 Not Found \u00b6 \u670d\u52a1\u5668\u4e0a\u65e0\u6cd5\u627e\u5230\u8bf7\u6c42\u7684\u8d44\u6e90\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u62d2\u7edd\u8bf7\u6c42\u4e14\u4e0d\u60f3\u8bf4\u660e\u7406\u7531\u65f6\u4f7f\u7528\u3002 4. 5XX \u670d\u52a1\u5668\u9519\u8bef \u00b6 4.1 500 Internal Server Error \u00b6 \u8868\u660e\u670d\u52a1\u5668\u7aef\u5728\u6267\u884c\u8bf7\u6c42\u65f6\u53d1\u751f\u4e86\u9519\u8bef\u3002 4.2 503 Service Unavailable \u00b6 \u8868\u660e\u670d\u52a1\u5668\u6682\u65f6\u5904\u4e8e\u8d85\u8d1f\u8f7d\u6216\u6b63\u5728\u8fdb\u884c\u505c\u673a\u7ef4\u62a4\uff0c\u73b0\u5728\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\u3002","title":"\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801.md"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#1-2xx","text":"","title":"1. 2XX \u6210\u529f"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#11-200-ok","text":"\u5728\u54cd\u5e94\u62a5\u6587\u5185\uff0c\u968f\u72b6\u6001\u7801\u4e00\u8d77\u8fd4\u56de\u7684\u4fe1\u606f\u4f1a\u56e0\u65b9\u6cd5\u7684\u4e0d\u540c\u800c\u53d1\u751f\u6539\u53d8\u3002","title":"1.1 200 OK"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#12-204-no-content","text":"\u8be5\u72b6\u6001\u7801\u4ee3\u8868\u670d\u52a1\u5668\u63a5\u6536\u7684\u8bf7\u6c42\u5df2\u6210\u529f\u5904\u7406\uff0c\u4f46\u5728\u8fd4\u56de\u7684\u54cd\u5e94\u62a5\u6587\u4e2d\u4e0d\u542b\u5b9e\u4f53\u7684\u4e3b\u4f53\u90e8\u5206\u3002","title":"1.2 204 No Content"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#13-206-partial-content","text":"\u54cd\u5e94\u62a5\u6587\u4e2d\u5305\u542b\u7531 Content-Range \u6307\u5b9a\u8303\u56f4\u7684\u5b9e\u4f53\u5185\u5bb9\u3002","title":"1.3 206 Partial  Content"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#2-3xx","text":"3XX \u54cd\u5e94\u7ed3\u679c\u8868\u660e\u6d4f\u89c8\u5668\u9700\u8981\u6267\u884c\u67d0\u4e9b\u7279\u6b8a\u7684\u5904\u7406\u4ee5\u6b63\u786e\u5904\u7406\u8bf7\u6c42\u3002","title":"2. 3XX \u91cd\u5b9a\u5411"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#21-301-moved-permanently","text":"\u6c38\u4e45\u6027\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u88ab\u5206\u914d\u4e86\u65b0\u7684 URI\uff0c\u4ee5\u540e\u5e94\u4f7f\u7528\u8d44\u6e90\u73b0\u5728\u6240\u6307\u7684 URI\u3002","title":"2.1 301 Moved Permanently"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#22-302-found","text":"\u4e34\u65f6\u6027\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u88ab\u5206\u914d\u4e86\u65b0\u7684 URI\uff0c\u5e0c\u671b\u7528\u6237\uff08\u672c\u6b21\uff09\u80fd\u4f7f\u7528\u65b0\u7684 URI \u8bbf\u95ee\u3002 302 \u72b6\u6001\u7801\u4ee3\u8868\u7684\u8d44\u6e90\u4e0d\u662f\u88ab\u6c38\u4e45\u79fb\u52a8\uff0c\u53ea\u662f\u4e34\u65f6\u6027\u8d28\u7684\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5df2\u79fb\u52a8\u7684\u8d44\u6e90\u5bf9\u5e94\u7684 URI \u5c06\u6765\u8fd8\u6709\u53ef\u80fd\u53d1\u751f\u6539\u53d8\u3002","title":"2.2 302 Found"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#23-303-see-other","text":"\u8be5\u72b6\u6001\u7801\u8868\u793a\u7531\u4e8e\u8bf7\u6c42\u5bf9\u5e94\u7684\u8d44\u6e90\u5b58\u5728\u7740\u53e6\u4e00\u4e2a URI\uff0c\u5e94\u4f7f\u7528 GET \u65b9\u6cd5\u5b9a\u5411\u83b7\u53d6\u8bf7\u6c42\u7684\u8d44\u6e90\u3002 303 \u72b6\u6001\u7801\u548c 302 Found \u72b6\u6001\u7801\u6709\u7740\u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f46 303 \u72b6\u6001\u7801\u660e\u786e\u8868\u793a\u5ba2\u6237\u7aef\u5e94\u5f53\u91c7\u7528 GET \u65b9\u6cd5\u83b7\u53d6\u8d44\u6e90\u3002 \u6ce8\u610f \uff1a\u5f53 301\u3001302\u3001303 \u54cd\u5e94\u72b6\u6001\u7801\u8fd4\u56de\u65f6\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u6d4f\u89c8\u5668\u90fd\u4f1a\u628aPOST \u6539\u6210 GET\uff0c\u5e76\u5220\u9664\u8bf7\u6c42\u62a5\u6587\u5185\u7684\u4e3b\u4f53\uff0c\u4e4b\u540e\u8bf7\u6c42\u4f1a\u81ea\u52a8\u518d\u6b21\u53d1\u9001\u3002 301\u3001302 \u6807\u51c6\u662f\u7981\u6b62\u5c06 POST \u65b9\u6cd5\u6539\u53d8\u6210 GET \u65b9\u6cd5\u7684\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u65f6\u5927\u5bb6\u90fd\u4f1a\u8fd9\u4e48\u505a\u3002","title":"2.3 303 See  Other"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#24-304-not-modified","text":"\u8be5\u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u9001\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\uff08\u9644\u5e26\u6761\u4ef6\u7684\u8bf7\u6c42\u662f\u6307\u91c7\u7528 GET \u65b9\u6cd5\u7684\u8bf7\u6c42\u62a5\u6587\u4e2d\u5305\u542b If-Match\uff0cIf-ModifiedSince\uff0cIf-None-Match\uff0cIf-Range\uff0cIf-Unmodified-Since \u4e2d\u4efb\u4e00\u9996\u90e8\uff09\u65f6\uff0c\u670d\u52a1\u5668\u7aef\u5141\u8bb8\u8bf7\u6c42\u8bbf\u95ee\u8d44\u6e90\uff0c\u4f46\u672a\u6ee1\u8db3\u6761\u4ef6\u7684\u60c5\u51b5\u3002304 \u72b6\u6001\u7801\u8fd4\u56de\u65f6\uff0c\u4e0d\u5305\u542b\u4efb\u4f55\u54cd\u5e94\u7684\u4e3b\u4f53\u90e8\u5206\u3002","title":"2.4 304 Not Modified"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#25-307-temporary-redirect","text":"\u4e34\u65f6\u91cd\u5b9a\u5411\u3002\u8be5\u72b6\u6001\u7801\u4e0e 302 Found \u6709\u7740\u76f8\u540c\u7684\u542b\u4e49\u3002 \u533a\u522b\u5c31\u662f 307 \u4f1a\u9075\u7167\u6d4f\u89c8\u5668\u6807\u51c6\uff0c\u4e0d\u4f1a\u4ece POST \u53d8\u6210 GET\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u5904\u7406\u54cd\u5e94\u65f6\u7684\u884c\u4e3a\uff0c\u6bcf\u79cd\u6d4f\u89c8\u5668\u6709\u53ef\u80fd\u51fa\u73b0\u4e0d\u540c\u7684\u60c5\u51b5\u3002","title":"2.5 307 Temporary Redirect"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#3-4xx","text":"","title":"3. 4XX \u5ba2\u6237\u7aef\u9519\u8bef"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#31-400-bad-request","text":"\u8be5\u72b6\u6001\u7801\u8868\u793a\u8bf7\u6c42\u62a5\u6587\u4e2d\u5b58\u5728\u8bed\u6cd5\u9519\u8bef\u3002\u53e6\u5916\uff0c\u6d4f\u89c8\u5668\u4f1a\u50cf 200 OK \u4e00\u6837\u5bf9\u5f85\u8be5\u72b6\u6001\u7801\u3002","title":"3.1 400 Bad Request"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#32-401-unauthorized","text":"\u8be5\u72b6\u6001\u7801\u8868\u793a\u53d1\u9001\u7684\u8bf7\u6c42\u9700\u8981\u6709\u901a\u8fc7 HTTP \u8ba4\u8bc1\uff08BASIC \u8ba4\u8bc1\u3001DIGEST \u8ba4\u8bc1\uff09\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002\u5f53\u6d4f\u89c8\u5668\u521d\u6b21\u63a5\u6536\u5230 401 \u54cd\u5e94\uff0c\u4f1a\u5f39\u51fa\u8ba4\u8bc1\u7528\u7684\u5bf9\u8bdd\u7a97\u53e3\uff1b\u518d\u6b21\u63a5\u6536\u5230\u8bf7\u6c42\u5e76\u8fd4\u56de\u8be5\u72b6\u6001\u7801\u65f6\uff0c\u5219\u8868\u793a\u8ba4\u8bc1\u5931\u8d25\u3002","title":"3.2 401 Unauthorized"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#33-403-forbidden","text":"\u5bf9\u8bf7\u6c42\u8d44\u6e90\u7684\u8bbf\u95ee\u88ab\u670d\u52a1\u5668\u62d2\u7edd\u4e86\u3002\u53ef\u4ee5\u5728\u5b9e\u4f53\u7684\u4e3b\u4f53\u90e8\u5206\u5bf9\u539f\u56e0\u4f5c\u63cf\u8ff0\u3002","title":"3.3 403 Forbidden"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#34-404-not-found","text":"\u670d\u52a1\u5668\u4e0a\u65e0\u6cd5\u627e\u5230\u8bf7\u6c42\u7684\u8d44\u6e90\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u7aef\u62d2\u7edd\u8bf7\u6c42\u4e14\u4e0d\u60f3\u8bf4\u660e\u7406\u7531\u65f6\u4f7f\u7528\u3002","title":"3.4 404 Not Found"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#4-5xx","text":"","title":"4. 5XX \u670d\u52a1\u5668\u9519\u8bef"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#41-500-internal-server-error","text":"\u8868\u660e\u670d\u52a1\u5668\u7aef\u5728\u6267\u884c\u8bf7\u6c42\u65f6\u53d1\u751f\u4e86\u9519\u8bef\u3002","title":"4.1 500 Internal  Server Error"},{"location":"http\u534f\u8bae/\u8fd4\u56de\u7ed3\u679c\u7684 HTTP \u72b6\u6001\u7801/#42-503-service-unavailable","text":"\u8868\u660e\u670d\u52a1\u5668\u6682\u65f6\u5904\u4e8e\u8d85\u8d1f\u8f7d\u6216\u6b63\u5728\u8fdb\u884c\u505c\u673a\u7ef4\u62a4\uff0c\u73b0\u5728\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\u3002","title":"4.2 503 Service  Unavailable"},{"location":"java/IO/","text":"1. \u540c\u6b65\u4e0e\u5f02\u6b65\u3001\u963b\u585e\u4e0e\u975e\u963b\u585e \u00b6 \u540c\u6b65\u4e0e\u5f02\u6b65\u5173\u6ce8\u7684\u662f\u7b49\u5f85\u7ed3\u679c\u7684\u65b9\u5f0f\u3002\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u540e\uff0c\u662f\u4e00\u76f4\u7b49\u5f85\u76f4\u5230\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd8\u662f\u4e0d\u7ba1\u7ed3\u679c\uff0c\u76f4\u63a5\u8fd4\u56de\uff08\u540e\u7eed\u901a\u77e5\u7ed3\u679c\uff09\u3002 \u963b\u585e\u4e0e\u975e\u963b\u585e\u5173\u6ce8\u7684\u662f\u7b49\u5f85\u7ed3\u679c\u7684\u72b6\u6001\u3002\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u540e\u5728\u7b49\u5f85\u7ed3\u679c\u7684\u8fd9\u6bb5\u65f6\u95f4\u91cc\uff0c\u662f\u6302\u673a\u4ec0\u4e48\u90fd\u4e0d\u5e72\uff0c\u8fd8\u662f\u505a\u4e00\u4e9b\u5176\u4ed6\u7684\u4e8b\u3002 2. POSIX\u672f\u8bed\u5b9a\u4e49 \u00b6 \u540c\u6b65I/O\u64cd\u4f5c\uff1a\u5bfc\u81f4\u8bf7\u6c42\u8fdb\u7a0b\u963b\u585e\uff0c\u76f4\u5230I/O\u64cd\u4f5c\u5b8c\u6210\u3002 \u5f02\u6b65I/O\u64cd\u4f5c\uff1a\u4e0d\u5bfc\u81f4\u8bf7\u6c42\u8fdb\u7a0b\u963b\u585e\u3002 3. Linux\u4e0b\u7684\u4e94\u79cdI/O\u6a21\u578b \u00b6 IO\u6a21\u578b","title":"IO"},{"location":"java/IO/#1","text":"\u540c\u6b65\u4e0e\u5f02\u6b65\u5173\u6ce8\u7684\u662f\u7b49\u5f85\u7ed3\u679c\u7684\u65b9\u5f0f\u3002\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u540e\uff0c\u662f\u4e00\u76f4\u7b49\u5f85\u76f4\u5230\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\uff0c\u8fd8\u662f\u4e0d\u7ba1\u7ed3\u679c\uff0c\u76f4\u63a5\u8fd4\u56de\uff08\u540e\u7eed\u901a\u77e5\u7ed3\u679c\uff09\u3002 \u963b\u585e\u4e0e\u975e\u963b\u585e\u5173\u6ce8\u7684\u662f\u7b49\u5f85\u7ed3\u679c\u7684\u72b6\u6001\u3002\u8c03\u7528\u4e86\u4e00\u4e2a\u51fd\u6570\u540e\u5728\u7b49\u5f85\u7ed3\u679c\u7684\u8fd9\u6bb5\u65f6\u95f4\u91cc\uff0c\u662f\u6302\u673a\u4ec0\u4e48\u90fd\u4e0d\u5e72\uff0c\u8fd8\u662f\u505a\u4e00\u4e9b\u5176\u4ed6\u7684\u4e8b\u3002","title":"1. \u540c\u6b65\u4e0e\u5f02\u6b65\u3001\u963b\u585e\u4e0e\u975e\u963b\u585e"},{"location":"java/IO/#2-posix","text":"\u540c\u6b65I/O\u64cd\u4f5c\uff1a\u5bfc\u81f4\u8bf7\u6c42\u8fdb\u7a0b\u963b\u585e\uff0c\u76f4\u5230I/O\u64cd\u4f5c\u5b8c\u6210\u3002 \u5f02\u6b65I/O\u64cd\u4f5c\uff1a\u4e0d\u5bfc\u81f4\u8bf7\u6c42\u8fdb\u7a0b\u963b\u585e\u3002","title":"2. POSIX\u672f\u8bed\u5b9a\u4e49"},{"location":"java/IO/#3-linuxio","text":"IO\u6a21\u578b","title":"3. Linux\u4e0b\u7684\u4e94\u79cdI/O\u6a21\u578b"},{"location":"java/synchronized\u5173\u952e\u5b57/","text":"1. \u9501\u5b9a\u4e0d\u540c\u5bf9\u8c61 \u00b6 synchronized\u5173\u952e\u5b57\u52a0\u5230static\u9759\u6001\u65b9\u6cd5\u548csynchronized(class)\u4ee3\u7801\u5757\u4e0a\u90fd\u662f\u662f\u7ed9Class\u7c7b\u4e0a\u9501 \u800csynchronized\u5173\u952e\u5b57\u52a0\u5230\u975estatic\u9759\u6001\u65b9\u6cd5\u4e0a\u662f\u7ed9\u5bf9\u8c61\u4e0a\u9501\u3002 warning \uff1a\u5f53\u7ed9 String \u4e0a\u9501\u65f6\uff0c\u9501\u5b9a\u7684\u662f\u4e00\u4e2a\u5e38\u91cf 2. \u7b49\u5f85/\u901a\u77e5\u673a\u5236 \u00b6 \u5f53\u65b9\u6cd5wait()\u88ab\u6267\u884c\u540e\uff0c\u9501\u81ea\u52a8\u88ab\u91ca\u653e\uff0c\u4f46\u6267\u884c\u5b8cnotify()\u65b9\u6cd5\u540e\uff0c\u9501\u4e0d\u4f1a\u81ea\u52a8\u91ca\u653e\u3002\u5fc5\u987b\u6267\u884c\u5b8cnotify()\u65b9\u6cd5\u6240\u5728\u7684synchronized\u4ee3\u7801\u5757\u540e\u624d\u91ca\u653e\u3002 \u5f53\u7ebf\u7a0b\u5448wait\u72b6\u6001\u65f6\uff0c\u5bf9\u7ebf\u7a0b\u5bf9\u8c61\u8c03\u7528interrupt\u65b9\u6cd5\u4f1a\u51fa\u73b0InterrupedException\u5f02\u5e38\u3002 3. \u9501 \u00b6 \u201c\u53ef\u91cd\u5165\u9501\u201d\u6982\u5ff5\u662f\uff1a\u81ea\u5df1\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u81ea\u5df1\u7684\u5185\u90e8\u9501\u3002 \u7b80\u5355\u7528\u6cd5\uff1a lock . lock (); try { for ( int i = 0 ; i < 3 ; ++ i ){ System . out . println ( Thread . currentThread (). getName () + \" -> \" + i ); } } finally { lock . unlock (); } warning \uff1a\u6700\u597d\u4e0d\u8981\u628a\u83b7\u53d6\u9501\u7684\u8fc7\u7a0b\u5199\u5728try\u8bed\u53e5\u5757\u4e2d\uff0c\u56e0\u4e3a\u5982\u679c\u5728\u83b7\u53d6\u9501\u65f6\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u5f02\u5e38\u629b\u51fa\u7684\u540c\u65f6\u4e5f\u4f1a\u5bfc\u81f4\u9501\u65e0\u6cd5\u88ab\u91ca\u653e\u3002 Lock\u63a5\u53e3\u63d0\u4f9b\u7684synchronized\u5173\u952e\u5b57\u4e0d\u5177\u5907\u7684\u4e3b\u8981\u7279\u6027\uff1a \u7279\u6027 \u63cf\u8ff0 \u5c1d\u8bd5\u975e\u963b\u585e\u5730\u83b7\u53d6\u9501 \u5f53\u524d\u7ebf\u7a0b\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5982\u679c\u8fd9\u4e00\u65f6\u523b\u9501\u6ca1\u6709\u88ab\u5176\u5b83\u7ebf\u7a0b\u83b7\u53d6\u5230\uff0c\u5219\u6210\u529f\u83b7\u53d6\u5e76\u6301\u6709\u9501 \u80fd\u88ab\u4e2d\u65ad\u5730\u83b7\u53d6\u9501 \u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u80fd\u76f8\u5e94\u4e2d\u65ad\uff0c\u5f53\u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u65f6\uff0c\u4e2d\u65ad\u5f02\u5e38\u4f1a\u88ab\u629b\u51fa\uff0c\u540c\u65f6\u91ca\u653e\u9501 \u8d85\u65f6\u83b7\u53d6\u9501 \u5728\u6307\u5b9a\u7684\u622a\u6b62\u65f6\u95f4\u4e4b\u524d\u83b7\u53d6\u9501\uff0c\u8d85\u8fc7\u622a\u6b62\u65f6\u95f4\u540e\u4ecd\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de warning \uff1a\u5fc5\u987b\u5728condition.await()\u65b9\u6cd5\u8c03\u7528\u4e4b\u524d\u8c03\u7528lock.lock()\u4ee3\u7801\u83b7\u5f97\u540c\u6b65\u76d1\u89c6\u5668\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\u3002 3.1 ReenTrantLock \u6bd4 synchronized \u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd \u00b6 \u76f8\u6bd4synchronized\uff0cReenTrantLock\u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002\u4e3b\u8981\u6765\u8bf4\u4e3b\u8981\u6709\u4e09\u70b9\uff1a\u2460\u7b49\u5f85\u53ef\u4e2d\u65ad\uff1b\u2461\u53ef\u5b9e\u73b0\u516c\u5e73\u9501\uff1b\u2462\u53ef\u5b9e\u73b0\u9009\u62e9\u6027\u901a\u77e5\uff08\u9501\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6\uff09 ReenTrantLock\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u4e2d\u65ad\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u7684\u673a\u5236\uff0c\u901a\u8fc7lock.lockInterruptibly()\u6765\u5b9e\u73b0\u8fd9\u4e2a\u673a\u5236\u3002\u4e5f\u5c31\u662f\u8bf4\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u53ef\u4ee5\u9009\u62e9\u653e\u5f03\u7b49\u5f85\uff0c\u6539\u4e3a\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\u3002 ReenTrantLock\u53ef\u4ee5\u6307\u5b9a\u662f\u516c\u5e73\u9501\u8fd8\u662f\u975e\u516c\u5e73\u9501\u3002\u800csynchronized\u53ea\u80fd\u662f\u975e\u516c\u5e73\u9501\u3002\u6240\u8c13\u7684\u516c\u5e73\u9501\u5c31\u662f\u5148\u7b49\u5f85\u7684\u7ebf\u7a0b\u5148\u83b7\u5f97\u9501\u3002 ReenTrantLock\u9ed8\u8ba4\u60c5\u51b5\u662f\u975e\u516c\u5e73\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 ReenTrantLock\u7c7b\u7684ReentrantLock(boolean fair)\u6784\u9020\u65b9\u6cd5\u6765\u5236\u5b9a\u662f\u5426\u662f\u516c\u5e73\u7684\u3002 synchronized\u5173\u952e\u5b57\u4e0ewait()\u548cnotify/notifyAll()\u65b9\u6cd5\u76f8\u7ed3\u5408\u53ef\u4ee5\u5b9e\u73b0\u7b49\u5f85/\u901a\u77e5\u673a\u5236\uff0cReentrantLock\u7c7b\u5f53\u7136\u4e5f\u53ef\u4ee5\u5b9e\u73b0\uff0c\u4f46\u662f\u9700\u8981\u501f\u52a9\u4e8eCondition\u63a5\u53e3\u4e0enewCondition() \u65b9\u6cd5\u3002Condition\u662fJDK1.5\u4e4b\u540e\u624d\u6709\u7684\uff0c\u5b83\u5177\u6709\u5f88\u597d\u7684\u7075\u6d3b\u6027\uff0c\u6bd4\u5982\u53ef\u4ee5\u5b9e\u73b0\u591a\u8def\u901a\u77e5\u529f\u80fd\u4e5f\u5c31\u662f\u5728\u4e00\u4e2aLock\u5bf9\u8c61\u4e2d\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aCondition\u5b9e\u4f8b\uff08\u5373\u5bf9\u8c61\u76d1\u89c6\u5668\uff09\uff0c\u7ebf\u7a0b\u5bf9\u8c61\u53ef\u4ee5\u6ce8\u518c\u5728\u6307\u5b9a\u7684Condition\u4e2d\uff0c\u4ece\u800c\u53ef\u4ee5\u6709\u9009\u62e9\u6027\u7684\u8fdb\u884c\u7ebf\u7a0b\u901a\u77e5\uff0c\u5728\u8c03\u5ea6\u7ebf\u7a0b\u4e0a\u66f4\u52a0\u7075\u6d3b\u3002 \u5728\u4f7f\u7528notify/notifyAll()\u65b9\u6cd5\u8fdb\u884c\u901a\u77e5\u65f6\uff0c\u88ab\u901a\u77e5\u7684\u7ebf\u7a0b\u662f\u7531 JVM \u9009\u62e9\u7684\uff0c\u7528ReentrantLock\u7c7b\u7ed3\u5408Condition\u5b9e\u4f8b\u53ef\u4ee5\u5b9e\u73b0\u201c\u9009\u62e9\u6027\u901a\u77e5\u201d \uff0c\u8fd9\u4e2a\u529f\u80fd\u975e\u5e38\u91cd\u8981\uff0c\u800c\u4e14\u662fCondition\u63a5\u53e3\u9ed8\u8ba4\u63d0\u4f9b\u7684\u3002\u800csynchronized\u5173\u952e\u5b57\u5c31\u76f8\u5f53\u4e8e\u6574\u4e2aLock\u5bf9\u8c61\u4e2d\u53ea\u6709\u4e00\u4e2aCondition\u5b9e\u4f8b\uff0c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u6ce8\u518c\u5728\u5b83\u4e00\u4e2a\u8eab\u4e0a\u3002\u5982\u679c\u6267\u884cnotifyAll()\u65b9\u6cd5\u7684\u8bdd\u5c31\u4f1a\u901a\u77e5\u6240\u6709\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u8fd9\u6837\u4f1a\u9020\u6210\u5f88\u5927\u7684\u6548\u7387\u95ee\u9898\uff0c\u800cCondition\u5b9e\u4f8b\u7684signalAll()\u65b9\u6cd5 \u53ea\u4f1a\u5524\u9192\u6ce8\u518c\u5728\u8be5Condition\u5b9e\u4f8b\u4e2d\u7684\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u3002 4. \u7ebf\u7a0b\u6c60 \u00b6 \u963f\u91cc\u5df4\u5df4\u4e0d\u63a8\u8350\u7684\u521b\u5efa\u65b9\u5f0f\uff1a 1. \u7ebf\u7a0b\u8d44\u6e90\u5fc5\u987b\u901a\u8fc7\u7ebf\u7a0b\u6c60\u63d0\u4f9b\uff0c\u4e0d\u5141\u8bb8\u5728\u5e94\u7528\u4e2d\u81ea\u884c\u663e\u793a\u521b\u5efa\u7ebf\u7a0b \u200b \u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u597d\u5904\u662f\u51cf\u5c11\u5728\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u4e0a\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4ee5\u53ca\u7cfb\u7edf\u8d44\u6e90\u5f00\u9500\uff0c\u89e3\u51b3\u8d44\u6e90\u4e0d\u8db3\u7684\u95ee\u9898\u3002\u5982\u679c\u4e0d\u4f7f\u7528\u7ebf\u7a0b\u6c60\uff0c\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u7cfb\u7edf\u521b\u5efa\u5927\u91cf\u540c\u7c7b\u7ebf\u7a0b\u800c\u5bfc\u81f4\u6d88\u8017\u5b8c\u5185\u5b58\u6216\u8005\u201c\u8fc7\u5ea6\u5207\u6362\u201d\u7684\u95ee\u9898\u3002 2. \u4e0d\u5141\u8bb8\u4f7f\u7528 Executors \u53bb\u521b\u5efa\uff0c\u800c\u662f\u901a\u8fc7 ThreadPoolExecutor \u7684\u65b9\u5f0f \u200b Executors \u8fd4\u56de\u7ebf\u7a0b\u6c60\u5bf9\u8c61\u7684\u5f0a\u7aef\u5982\u4e0b \uff1a FixedThreadPool \u548c SingleThreadExecutor \uff1a \u5141\u8bb8\u8bf7\u6c42\u7684\u961f\u5217\u957f\u5ea6\u4e3a Integer.MAX_VALUE,\u53ef\u80fd\u5806\u79ef\u5927\u91cf\u7684\u8bf7\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4OOM\u3002 CachedThreadPool \u548c ScheduledThreadPool \uff1a \u5141\u8bb8\u521b\u5efa\u7684\u7ebf\u7a0b\u6570\u91cf\u4e3a Integer.MAX_VALUE \uff0c\u53ef\u80fd\u4f1a\u521b\u5efa\u5927\u91cf\u7ebf\u7a0b\uff0c\u4ece\u800c\u5bfc\u81f4OOM\u3002 Executor \u6846\u67b6","title":"synchronized\u5173\u952e\u5b57"},{"location":"java/synchronized\u5173\u952e\u5b57/#1","text":"synchronized\u5173\u952e\u5b57\u52a0\u5230static\u9759\u6001\u65b9\u6cd5\u548csynchronized(class)\u4ee3\u7801\u5757\u4e0a\u90fd\u662f\u662f\u7ed9Class\u7c7b\u4e0a\u9501 \u800csynchronized\u5173\u952e\u5b57\u52a0\u5230\u975estatic\u9759\u6001\u65b9\u6cd5\u4e0a\u662f\u7ed9\u5bf9\u8c61\u4e0a\u9501\u3002 warning \uff1a\u5f53\u7ed9 String \u4e0a\u9501\u65f6\uff0c\u9501\u5b9a\u7684\u662f\u4e00\u4e2a\u5e38\u91cf","title":"1. \u9501\u5b9a\u4e0d\u540c\u5bf9\u8c61"},{"location":"java/synchronized\u5173\u952e\u5b57/#2","text":"\u5f53\u65b9\u6cd5wait()\u88ab\u6267\u884c\u540e\uff0c\u9501\u81ea\u52a8\u88ab\u91ca\u653e\uff0c\u4f46\u6267\u884c\u5b8cnotify()\u65b9\u6cd5\u540e\uff0c\u9501\u4e0d\u4f1a\u81ea\u52a8\u91ca\u653e\u3002\u5fc5\u987b\u6267\u884c\u5b8cnotify()\u65b9\u6cd5\u6240\u5728\u7684synchronized\u4ee3\u7801\u5757\u540e\u624d\u91ca\u653e\u3002 \u5f53\u7ebf\u7a0b\u5448wait\u72b6\u6001\u65f6\uff0c\u5bf9\u7ebf\u7a0b\u5bf9\u8c61\u8c03\u7528interrupt\u65b9\u6cd5\u4f1a\u51fa\u73b0InterrupedException\u5f02\u5e38\u3002","title":"2. \u7b49\u5f85/\u901a\u77e5\u673a\u5236"},{"location":"java/synchronized\u5173\u952e\u5b57/#3","text":"\u201c\u53ef\u91cd\u5165\u9501\u201d\u6982\u5ff5\u662f\uff1a\u81ea\u5df1\u53ef\u4ee5\u518d\u6b21\u83b7\u53d6\u81ea\u5df1\u7684\u5185\u90e8\u9501\u3002 \u7b80\u5355\u7528\u6cd5\uff1a lock . lock (); try { for ( int i = 0 ; i < 3 ; ++ i ){ System . out . println ( Thread . currentThread (). getName () + \" -> \" + i ); } } finally { lock . unlock (); } warning \uff1a\u6700\u597d\u4e0d\u8981\u628a\u83b7\u53d6\u9501\u7684\u8fc7\u7a0b\u5199\u5728try\u8bed\u53e5\u5757\u4e2d\uff0c\u56e0\u4e3a\u5982\u679c\u5728\u83b7\u53d6\u9501\u65f6\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u5f02\u5e38\u629b\u51fa\u7684\u540c\u65f6\u4e5f\u4f1a\u5bfc\u81f4\u9501\u65e0\u6cd5\u88ab\u91ca\u653e\u3002 Lock\u63a5\u53e3\u63d0\u4f9b\u7684synchronized\u5173\u952e\u5b57\u4e0d\u5177\u5907\u7684\u4e3b\u8981\u7279\u6027\uff1a \u7279\u6027 \u63cf\u8ff0 \u5c1d\u8bd5\u975e\u963b\u585e\u5730\u83b7\u53d6\u9501 \u5f53\u524d\u7ebf\u7a0b\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5982\u679c\u8fd9\u4e00\u65f6\u523b\u9501\u6ca1\u6709\u88ab\u5176\u5b83\u7ebf\u7a0b\u83b7\u53d6\u5230\uff0c\u5219\u6210\u529f\u83b7\u53d6\u5e76\u6301\u6709\u9501 \u80fd\u88ab\u4e2d\u65ad\u5730\u83b7\u53d6\u9501 \u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u80fd\u76f8\u5e94\u4e2d\u65ad\uff0c\u5f53\u83b7\u53d6\u5230\u9501\u7684\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u65f6\uff0c\u4e2d\u65ad\u5f02\u5e38\u4f1a\u88ab\u629b\u51fa\uff0c\u540c\u65f6\u91ca\u653e\u9501 \u8d85\u65f6\u83b7\u53d6\u9501 \u5728\u6307\u5b9a\u7684\u622a\u6b62\u65f6\u95f4\u4e4b\u524d\u83b7\u53d6\u9501\uff0c\u8d85\u8fc7\u622a\u6b62\u65f6\u95f4\u540e\u4ecd\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de warning \uff1a\u5fc5\u987b\u5728condition.await()\u65b9\u6cd5\u8c03\u7528\u4e4b\u524d\u8c03\u7528lock.lock()\u4ee3\u7801\u83b7\u5f97\u540c\u6b65\u76d1\u89c6\u5668\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\u3002","title":"3. \u9501"},{"location":"java/synchronized\u5173\u952e\u5b57/#31-reentrantlock-synchronized","text":"\u76f8\u6bd4synchronized\uff0cReenTrantLock\u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002\u4e3b\u8981\u6765\u8bf4\u4e3b\u8981\u6709\u4e09\u70b9\uff1a\u2460\u7b49\u5f85\u53ef\u4e2d\u65ad\uff1b\u2461\u53ef\u5b9e\u73b0\u516c\u5e73\u9501\uff1b\u2462\u53ef\u5b9e\u73b0\u9009\u62e9\u6027\u901a\u77e5\uff08\u9501\u53ef\u4ee5\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6\uff09 ReenTrantLock\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u4e2d\u65ad\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u7684\u673a\u5236\uff0c\u901a\u8fc7lock.lockInterruptibly()\u6765\u5b9e\u73b0\u8fd9\u4e2a\u673a\u5236\u3002\u4e5f\u5c31\u662f\u8bf4\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u53ef\u4ee5\u9009\u62e9\u653e\u5f03\u7b49\u5f85\uff0c\u6539\u4e3a\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\u3002 ReenTrantLock\u53ef\u4ee5\u6307\u5b9a\u662f\u516c\u5e73\u9501\u8fd8\u662f\u975e\u516c\u5e73\u9501\u3002\u800csynchronized\u53ea\u80fd\u662f\u975e\u516c\u5e73\u9501\u3002\u6240\u8c13\u7684\u516c\u5e73\u9501\u5c31\u662f\u5148\u7b49\u5f85\u7684\u7ebf\u7a0b\u5148\u83b7\u5f97\u9501\u3002 ReenTrantLock\u9ed8\u8ba4\u60c5\u51b5\u662f\u975e\u516c\u5e73\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 ReenTrantLock\u7c7b\u7684ReentrantLock(boolean fair)\u6784\u9020\u65b9\u6cd5\u6765\u5236\u5b9a\u662f\u5426\u662f\u516c\u5e73\u7684\u3002 synchronized\u5173\u952e\u5b57\u4e0ewait()\u548cnotify/notifyAll()\u65b9\u6cd5\u76f8\u7ed3\u5408\u53ef\u4ee5\u5b9e\u73b0\u7b49\u5f85/\u901a\u77e5\u673a\u5236\uff0cReentrantLock\u7c7b\u5f53\u7136\u4e5f\u53ef\u4ee5\u5b9e\u73b0\uff0c\u4f46\u662f\u9700\u8981\u501f\u52a9\u4e8eCondition\u63a5\u53e3\u4e0enewCondition() \u65b9\u6cd5\u3002Condition\u662fJDK1.5\u4e4b\u540e\u624d\u6709\u7684\uff0c\u5b83\u5177\u6709\u5f88\u597d\u7684\u7075\u6d3b\u6027\uff0c\u6bd4\u5982\u53ef\u4ee5\u5b9e\u73b0\u591a\u8def\u901a\u77e5\u529f\u80fd\u4e5f\u5c31\u662f\u5728\u4e00\u4e2aLock\u5bf9\u8c61\u4e2d\u53ef\u4ee5\u521b\u5efa\u591a\u4e2aCondition\u5b9e\u4f8b\uff08\u5373\u5bf9\u8c61\u76d1\u89c6\u5668\uff09\uff0c\u7ebf\u7a0b\u5bf9\u8c61\u53ef\u4ee5\u6ce8\u518c\u5728\u6307\u5b9a\u7684Condition\u4e2d\uff0c\u4ece\u800c\u53ef\u4ee5\u6709\u9009\u62e9\u6027\u7684\u8fdb\u884c\u7ebf\u7a0b\u901a\u77e5\uff0c\u5728\u8c03\u5ea6\u7ebf\u7a0b\u4e0a\u66f4\u52a0\u7075\u6d3b\u3002 \u5728\u4f7f\u7528notify/notifyAll()\u65b9\u6cd5\u8fdb\u884c\u901a\u77e5\u65f6\uff0c\u88ab\u901a\u77e5\u7684\u7ebf\u7a0b\u662f\u7531 JVM \u9009\u62e9\u7684\uff0c\u7528ReentrantLock\u7c7b\u7ed3\u5408Condition\u5b9e\u4f8b\u53ef\u4ee5\u5b9e\u73b0\u201c\u9009\u62e9\u6027\u901a\u77e5\u201d \uff0c\u8fd9\u4e2a\u529f\u80fd\u975e\u5e38\u91cd\u8981\uff0c\u800c\u4e14\u662fCondition\u63a5\u53e3\u9ed8\u8ba4\u63d0\u4f9b\u7684\u3002\u800csynchronized\u5173\u952e\u5b57\u5c31\u76f8\u5f53\u4e8e\u6574\u4e2aLock\u5bf9\u8c61\u4e2d\u53ea\u6709\u4e00\u4e2aCondition\u5b9e\u4f8b\uff0c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u6ce8\u518c\u5728\u5b83\u4e00\u4e2a\u8eab\u4e0a\u3002\u5982\u679c\u6267\u884cnotifyAll()\u65b9\u6cd5\u7684\u8bdd\u5c31\u4f1a\u901a\u77e5\u6240\u6709\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u8fd9\u6837\u4f1a\u9020\u6210\u5f88\u5927\u7684\u6548\u7387\u95ee\u9898\uff0c\u800cCondition\u5b9e\u4f8b\u7684signalAll()\u65b9\u6cd5 \u53ea\u4f1a\u5524\u9192\u6ce8\u518c\u5728\u8be5Condition\u5b9e\u4f8b\u4e2d\u7684\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u3002","title":"3.1 ReenTrantLock \u6bd4 synchronized \u589e\u52a0\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd"},{"location":"java/synchronized\u5173\u952e\u5b57/#4","text":"\u963f\u91cc\u5df4\u5df4\u4e0d\u63a8\u8350\u7684\u521b\u5efa\u65b9\u5f0f\uff1a 1. \u7ebf\u7a0b\u8d44\u6e90\u5fc5\u987b\u901a\u8fc7\u7ebf\u7a0b\u6c60\u63d0\u4f9b\uff0c\u4e0d\u5141\u8bb8\u5728\u5e94\u7528\u4e2d\u81ea\u884c\u663e\u793a\u521b\u5efa\u7ebf\u7a0b \u200b \u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u597d\u5904\u662f\u51cf\u5c11\u5728\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u4e0a\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4ee5\u53ca\u7cfb\u7edf\u8d44\u6e90\u5f00\u9500\uff0c\u89e3\u51b3\u8d44\u6e90\u4e0d\u8db3\u7684\u95ee\u9898\u3002\u5982\u679c\u4e0d\u4f7f\u7528\u7ebf\u7a0b\u6c60\uff0c\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u7cfb\u7edf\u521b\u5efa\u5927\u91cf\u540c\u7c7b\u7ebf\u7a0b\u800c\u5bfc\u81f4\u6d88\u8017\u5b8c\u5185\u5b58\u6216\u8005\u201c\u8fc7\u5ea6\u5207\u6362\u201d\u7684\u95ee\u9898\u3002 2. \u4e0d\u5141\u8bb8\u4f7f\u7528 Executors \u53bb\u521b\u5efa\uff0c\u800c\u662f\u901a\u8fc7 ThreadPoolExecutor \u7684\u65b9\u5f0f \u200b Executors \u8fd4\u56de\u7ebf\u7a0b\u6c60\u5bf9\u8c61\u7684\u5f0a\u7aef\u5982\u4e0b \uff1a FixedThreadPool \u548c SingleThreadExecutor \uff1a \u5141\u8bb8\u8bf7\u6c42\u7684\u961f\u5217\u957f\u5ea6\u4e3a Integer.MAX_VALUE,\u53ef\u80fd\u5806\u79ef\u5927\u91cf\u7684\u8bf7\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4OOM\u3002 CachedThreadPool \u548c ScheduledThreadPool \uff1a \u5141\u8bb8\u521b\u5efa\u7684\u7ebf\u7a0b\u6570\u91cf\u4e3a Integer.MAX_VALUE \uff0c\u53ef\u80fd\u4f1a\u521b\u5efa\u5927\u91cf\u7ebf\u7a0b\uff0c\u4ece\u800c\u5bfc\u81f4OOM\u3002 Executor \u6846\u67b6","title":"4. \u7ebf\u7a0b\u6c60"},{"location":"java/\u4f5c\u7528\u8303\u56f4\u7ea7\u522b/","text":"\u8bbf\u95ee\u63a7\u5236\u7b26 protected\u3001private\u4e0d\u80fd\u4fee\u9970\u7c7b\uff0c\u9664\u4e86\u5185\u90e8\u7c7b\u3002 \u8bbf\u95ee\u63a7\u5236\u53ea\u505c\u7559\u5728\u7f16\u8bd1\u5c42\u9762\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u8bbf\u95ee\u63a7\u5236\u6743\u9650\uff0c\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u7b49\u624b\u6bb5\u4fee\u6539\u3002","title":"\u4f5c\u7528\u8303\u56f4\u7ea7\u522b"},{"location":"linux/Linux\u4e0b\u67e5\u770b\u6587\u4ef6\u7c7b\u578b/","text":"1. \u67e5\u770b\u6587\u4ef6 \u00b6 \u4f7f\u7528 file \u547d\u4ee4\u67e5\u770b\uff1a $ touch t { 1 ..2 } $ tar -z -cf test.tar.gz t1 t2 $ file test.tar.gz test.tar.gz: gzip compressed data, from Unix, last modified: Tue Jul 9 09 :33:41 2019 2. \u67e5\u770b\u538b\u7f29\u6587\u4ef6\u7c7b\u578b \u00b6 \u53c2\u8003\u95ee\u7b54 \u4f7f\u7528 xxd \u547d\u4ee4\u67e5\u770b\u538b\u7f29\u6587\u4ef6\u7684\u524d\u51e0\u4e2a\u5b57\u8282\uff1a $ xxd -l 10 test.tar.gz 0000000 : 1f8b 0800 f5ee 235d 0003 ......# ] .. \u6839\u636e\u5b57\u8282\u5224\u65ad\u538b\u7f29\u6587\u4ef6\u7c7b\u578b\uff1a Zip\uff08.zip\uff09\u683c\u5f0f\uff1a0x50, 0x4b, 0x03, 0x04\uff08\u9664\u975e\u4e3a\u7a7a\uff0c\u90a3\u4e48\u6700\u540e\u4e24\u4e2a\u662f0x05, 0x06 \u6216 0x06, 0x06\uff09 Gzip\uff08.gz\uff09\u683c\u5f0f\uff1a0x1f, 0x8b, 0x08 xz\uff08.xz\uff09\u683c\u5f0f\uff1a0xfd, 0x37, 0x7a, 0x58, 0x5a, 0x00 \u538b\u7f29\uff08.Z\uff09\uff1a0x1f, 0x9d bzip2\uff08.bz2\uff09\u683c\u5f0f\uff1a0x42, 0x5a, 0x68 zlib\uff08.zz\uff09\u683c\u5f0f\uff1a\u6ca1\u770b\u61c2\uff0c file \u4e5f\u68c0\u6d4b\u4e0d\u51fa\u6765\u3002\u4e0d\u8fc7\u53d1\u73b0\u524d3\u4e2a\u5b57\u8282\u90fd\u662f0x1f\uff0c0x9d\uff0c0x90\uff0c\u52c9\u5f3a\u7b97\u68c0\u6d4b\u51fa\u6765\u5427\u3002","title":"Linux\u4e0b\u67e5\u770b\u6587\u4ef6\u7c7b\u578b"},{"location":"linux/Linux\u4e0b\u67e5\u770b\u6587\u4ef6\u7c7b\u578b/#1","text":"\u4f7f\u7528 file \u547d\u4ee4\u67e5\u770b\uff1a $ touch t { 1 ..2 } $ tar -z -cf test.tar.gz t1 t2 $ file test.tar.gz test.tar.gz: gzip compressed data, from Unix, last modified: Tue Jul 9 09 :33:41 2019","title":"1. \u67e5\u770b\u6587\u4ef6"},{"location":"linux/Linux\u4e0b\u67e5\u770b\u6587\u4ef6\u7c7b\u578b/#2","text":"\u53c2\u8003\u95ee\u7b54 \u4f7f\u7528 xxd \u547d\u4ee4\u67e5\u770b\u538b\u7f29\u6587\u4ef6\u7684\u524d\u51e0\u4e2a\u5b57\u8282\uff1a $ xxd -l 10 test.tar.gz 0000000 : 1f8b 0800 f5ee 235d 0003 ......# ] .. \u6839\u636e\u5b57\u8282\u5224\u65ad\u538b\u7f29\u6587\u4ef6\u7c7b\u578b\uff1a Zip\uff08.zip\uff09\u683c\u5f0f\uff1a0x50, 0x4b, 0x03, 0x04\uff08\u9664\u975e\u4e3a\u7a7a\uff0c\u90a3\u4e48\u6700\u540e\u4e24\u4e2a\u662f0x05, 0x06 \u6216 0x06, 0x06\uff09 Gzip\uff08.gz\uff09\u683c\u5f0f\uff1a0x1f, 0x8b, 0x08 xz\uff08.xz\uff09\u683c\u5f0f\uff1a0xfd, 0x37, 0x7a, 0x58, 0x5a, 0x00 \u538b\u7f29\uff08.Z\uff09\uff1a0x1f, 0x9d bzip2\uff08.bz2\uff09\u683c\u5f0f\uff1a0x42, 0x5a, 0x68 zlib\uff08.zz\uff09\u683c\u5f0f\uff1a\u6ca1\u770b\u61c2\uff0c file \u4e5f\u68c0\u6d4b\u4e0d\u51fa\u6765\u3002\u4e0d\u8fc7\u53d1\u73b0\u524d3\u4e2a\u5b57\u8282\u90fd\u662f0x1f\uff0c0x9d\uff0c0x90\uff0c\u52c9\u5f3a\u7b97\u68c0\u6d4b\u51fa\u6765\u5427\u3002","title":"2. \u67e5\u770b\u538b\u7f29\u6587\u4ef6\u7c7b\u578b"},{"location":"linux/Linux\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6FHS/","text":"Filesystem Hierarchy Standard\uff08FHS\uff09 \u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6\u5b9a\u4e49\u4e86Linux\u53d1\u884c\u7248\u4e2d\u7684 \u76ee\u5f55\u7ed3\u6784\u548c\u76ee\u5f55\u5185\u5bb9 \u3002 1. \u76ee\u5f55\u7ed3\u6784 \u00b6 \u5728 FHS \u4e2d\uff0c\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\u90fd\u663e\u793a\u5728\u6839\u76ee\u5f55 / \u4e0b\uff0c\u5373\u4f7f\u5b83\u4eec\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u7269\u7406\u6216\u865a\u62df\u8bbe\u5907\u4e0a\u3002\u5982\u679c\u5b89\u88c5\u4e86\u67d0\u4e9b\u5b50\u7cfb\u7edf\uff08\u5982X Window System\uff09\uff0c\u5219\u67d0\u4e9b\u76ee\u5f55\u4ec5\u5b58\u5728\u4e8e\u7279\u5b9a\u7cfb\u7edf\u4e0a\u3002 \u76ee\u5f55 \u63cf\u8ff0 / \u4e3b\u5c42\u6b21\u7ed3\u6784\u6839\u76ee\u5f55\u548c\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u7684\u6839\u76ee\u5f55\u3002 /bin \u9700\u8981\u5728\u5355\u7528\u6237\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u7684\u5fc5\u8981\u547d\u4ee4\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1b\u662f\u9762\u5411\u6240\u6709\u7528\u6237\u7684\uff0c\u4f8b\u5982 cat , ls , cp . /boot \u5f15\u5bfc\u542f\u52a8\u6587\u4ef6\u3002\u4e00\u822c\u662f\u5355\u72ec\u7684\u5206\u533a\u3002 Boot loader files, e.g. , kernels , initrd . /dev \u8bbe\u5907\u6587\u4ef6\u3002 e.g. , /dev/null , /dev/disk0 , /dev/sda1 , /dev/tty , /dev/random . /etc \u7279\u5b9a\u4e3b\u673a\uff0c\u7cfb\u7edf\u8303\u56f4\u5185\u7684\u914d\u7f6e\u6587\u4ef6\u3002FHS\u9650\u5236 /etc \u5b58\u653e\u9759\u6001\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u80fd\u5305\u542b\u4e8c\u8fdb\u5236\u6587\u4ef6 /etc/opt \u5b58\u50a8\u5728 /opt \u4e2d\u7684\u9644\u52a0\u5305\u7684\u914d\u7f6e\u6587\u4ef6\u3002 /etc/sgml \u5904\u7406 SGML \u8f6f\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u76ee\u5f55\u3002 /etc/X11 X Window System \uff08\u7248\u672c 11\uff09\u7684\u914d\u7f6e\u6587\u4ef6 /etc/xml \u5904\u7406 XML \u8f6f\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u76ee\u5f55\u3002 /home \u7528\u6237\u7684 home \u76ee\u5f55\uff0c\u5305\u542b\u4fdd\u5b58\u7684\u6587\u4ef6\u3001\u4e2a\u4eba\u8bbe\u7f6e\u7b49\u3002\u4e00\u822c\u662f\u5355\u72ec\u7684\u5206\u533a\u3002 /lib /bin \u548c /sbin \u4e2d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5fc5\u8981\u5e93\u6587\u4ef6\u3002 /lib<qual> \u53ef\u9009\u683c\u5f0f\u5fc5\u8981\u5e93\u3002\u6b64\u7c7b\u76ee\u5f55\u662f\u53ef\u9009\u7684,\u4f46\u5982\u679c\u5b83\u4eec\u5b58\u5728,\u5219\u5b83\u4eec\u5177\u6709\u4e00\u4e9b\u8981\u6c42\u3002\u4f8b\u5982 /lib64 \u3002 /media \u53ef\u79fb\u9664\u5a92\u4f53\u6587\u4ef6\uff08\u6bd4\u5982 CD-ROMs \uff09\u6302\u8f7d\u70b9\u3002 /mnt \u4e34\u65f6\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\u3002 /opt \u53ef\u9009\u5e94\u7528\u8f6f\u4ef6\u5305\u3002 application software packages \u3002 /proc \u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u4ee5\u6587\u4ef6\u5f62\u5f0f\u63d0\u4f9b\u8fdb\u7a0b\u548c\u5185\u6838\u4fe1\u606f\u3002\u5728linux\u4e2d\uff0c\u5bf9\u5e94\u4e00\u4e2a procfs \uff08\u5728\u8bb8\u591a\u7c7b Unix \u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c procfs \u662f \u8fdb\u7a0b \u6587\u4ef6\u7cfb\u7edf \u7684\u7f29\u5199\uff0c\u5305\u542b\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff08\u542f\u52a8\u65f6\u52a8\u6001\u751f\u6210\u7684\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c\u7528\u4e8e\u901a\u8fc7\u5185\u6838\u8bbf\u95ee\u8fdb\u7a0b\u4fe1\u606f\u3002\u8fd9\u4e2a\u6587\u4ef6\u7cfb\u7edf\u901a\u5e38\u88ab\u6302\u8f7d\u5230 /proc \u76ee\u5f55\u3002\u7531\u4e8e /proc \u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u4e5f\u5c31\u4e0d\u5360\u7528\u5b58\u50a8\u7a7a\u95f4\uff0c\u53ea\u662f\u5360\u7528\u6709\u9650\u7684\u5185\u5b58\u3002https://zh.wikipedia.org/wiki/Procfs\uff09\u6302\u8f7d\u3002 \u901a\u5e38\u81ea\u52a8\u751f\u6210\u5e76\u7531\u7cfb\u7edf\u52a8\u6001\u586b\u5145\u3002 /root root\u7528\u6237\u7684 home \u76ee\u5f55 /run \u8fd0\u884c\u65f6\u53d8\u5316\u7684\u6570\u636e\uff1a\u81ea\u4ece\u6700\u540e\u4e00\u6b21\u542f\u52a8\u7684\u6b63\u5728\u8fd0\u884c\u7684\u7cfb\u7edf\u7684\u4fe1\u606f\u3002\u6bd4\u5982\uff0c\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u548c\u8fd0\u884c\u7684\u5b88\u62a4\u8fdb\u7a0b\u3002\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5fc5\u987b\u5728\u542f\u52a8\u8fdb\u7a0b\u5f00\u59cb\u65f6\u5220\u9664\u6216\u622a\u65ad\uff08\u6e05\u7a7a\uff09\uff1b\u4f46\u662f\u5728\u63d0\u4f9b temporary filesystem ( tmpfs )\u76ee\u5f55\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u662f\u4e0d\u5fc5\u8981\u7684\u3002 /sbin \u5fc5\u8981\u7684\u7cfb\u7edf\u7ea7\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 e.g. , fsck, init, route. /srv \u7cfb\u7edf\u63d0\u4f9b\u7684\u5177\u4f53\u7ad9\u70b9\u6570\u636e\u3002\u4f8b\u5982\u4e3aweb\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\u548c\u811a\u672c\uff0c\u4e3aFTP\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\uff0c\u4e3a\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u63d0\u4f9b\u7684\u4ed3\u5e93\u7b49\u3002 /sys \u5305\u542b\u5173\u4e8e\u8bbe\u5907\u3001\u9a71\u52a8\u548c\u4e00\u4e9b\u5185\u6838\u7279\u6027\u7684\u4fe1\u606f\u3002 /tmp \u4e34\u65f6\u6587\u4ef6 (see also /var/tmp )\u3002\u7cfb\u7edf\u91cd\u542f\u65f6\u901a\u5e38\u4e0d\u4f1a\u4fdd\u7559\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5e76\u53ef\u80fd\u4e25\u91cd\u9650\u5236\u5927\u5c0f\u3002 /usr \u5bf9\u4e8e\u53ea\u8bfb\u7528\u6237\u6570\u636e\u7684\u4e8c\u7ea7\u5c42\u6b21\u7ed3\u6784\uff1b\u5305\u542b\u5927\u90e8\u5206\u7684\uff08\u591a\uff09\u7528\u6237\u5de5\u5177\u548c\u5e94\u7528\u7a0b\u5e8f\u3002 /usr/bin \u975e\u5fc5\u8981\u547d\u4ee4\u53ef\u6267\u884c\u6587\u4ef6\uff08\u5355\u7528\u6237\u6a21\u5f0f\u4e0b\u975e\u5fc5\u9700\uff09\uff1b\u9762\u5411\u6240\u6709\u7528\u6237\u3002 /usr/include \u6807\u51c6\u5934\u6587\u4ef6\u3002 /usr/lib /usr/bin \u548c /usr/sbin \u4e2d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5e93\u3002 /usr/lib<qual> \u53ef\u9009\u683c\u5f0f\u5e93\u3002 e.g. /usr/lib32 for 32-bit libraries on a 64-bit machine (optional). /usr/local \u672c\u5730\u6570\u636e\u7684\u4e09\u7ea7\u5c42\u6b21\u7ed3\u6784\uff0c\u7279\u5b9a\u4e8e\u6b64\u4e3b\u673a\u3002\u901a\u5e38\u6709\u66f4\u591a\u5b50\u76ee\u5f55\uff0c e.g. , bin , lib , share \u3002 /usr/sbin \u975e\u5fc5\u8981\u7cfb\u7edf\u7ea7\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 e.g. , daemons for various network-services . /usr/share \u975e\u67b6\u6784\u4f9d\u8d56\u7684\u5171\u4eab\u6570\u636e\u3002 /usr/src \u6e90\u7801\u3002 e.g. , the kernel source code with its header files. /usr/X11R6 X Window System , Version 11, Release 6 (up to FHS-2.3, optional). /var \u53d8\u5316\u7684\u6587\u4ef6\u2014\u2014\u5728\u7cfb\u7edf\u7684\u6b63\u5e38\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u5185\u5bb9\u4e00\u76f4\u53d8\u5316\u7684\u6587\u4ef6\u3002\u4f8b\u5982 logs, spool files, and temporary e-mail files\u3002\u6709\u65f6\u662f\u5355\u72ec\u7684\u4e00\u4e2a\u5206\u533a\u3002 /var/cache \u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u6570\u636e\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u5728\u672c\u5730\u751f\u6210\u7684\u4e00\u4e2a\u8017\u65f6\u7684I/O\u7ed3\u679c\u6216\u8ba1\u7b97\u7ed3\u679c\u3002\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u80fd\u591f\u518d\u751f\u6216\u6062\u590d\u6570\u636e\u3002\u7f13\u5b58\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u5220\u9664\u800c\u4e0d\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002 /var/lib \u72b6\u6001\u4fe1\u606f\u3002 \u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u6301\u4e45\u6027\u6570\u636e, e.g. , databases, packaging system metadata, etc. /var/lock \u9501\u6587\u4ef6\u3002\u4e00\u7c7b\u8ddf\u8e2a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u8d44\u6e90\u7684\u6587\u4ef6\u3002 /var/log \u65e5\u5fd7\u6587\u4ef6\uff0c\u5305\u542b\u5927\u91cf\u65e5\u5fd7\u6587\u4ef6\u3002 /var/mail \u7535\u5b50\u90ae\u4ef6\u3002\u5728\u4e00\u4e9b\u53d1\u884c\u7248\u4e2d\uff0c\u8fd9\u4e9b\u6587\u4ef6\u53ef\u80fd\u4f4d\u4e8e\u5e9f\u5f03\u7684 /var/spool/mail . /var/opt \u5b58\u50a8\u53ef\u9009\u5305\u7684 /opt \u4e2d\u7684\u53d8\u5316\u6570\u636e\u3002 /var/run \u8fd0\u884c\u65f6\u53d8\u5316\u6570\u636e\u3002\u8be5\u76ee\u5f55\u5305\u542b\u4e86\u81ea\u4ece\u542f\u52a8\u4ee5\u6765\u7684\u7cfb\u7edf\u4fe1\u606f\u6570\u636e\u3002In FHS 3.0, /var/run is replaced by /run ; a system should either continue to provide a /var/run directory, or provide a symbolic link from /var/run to /run , for backwards compatibility. /var/spool \u7b49\u5f85\u5904\u7406\u7684\u4efb\u52a1\u7684 Spool \uff0c e.g. , print queues and outgoing mail queue. /var/spool/mail \u5e9f\u5f03\u7684\u7528\u6237\u90ae\u4ef6\u76ee\u5f55\u3002 /var/tmp \u5728\u91cd\u542f\u4e4b\u540e\u5e94\u8be5\u4fdd\u5b58\u7684\u6587\u4ef6\u3002 FHS\u53ea\u662f\u4e00\u4e2a\u89c4\u8303\uff0c\u4e0d\u4e00\u5b9a\u8981\u4e25\u683c\u9075\u5faa\u5b83\u3002","title":"Linux\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6FHS"},{"location":"linux/Linux\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6FHS/#1","text":"\u5728 FHS \u4e2d\uff0c\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\u90fd\u663e\u793a\u5728\u6839\u76ee\u5f55 / \u4e0b\uff0c\u5373\u4f7f\u5b83\u4eec\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u7269\u7406\u6216\u865a\u62df\u8bbe\u5907\u4e0a\u3002\u5982\u679c\u5b89\u88c5\u4e86\u67d0\u4e9b\u5b50\u7cfb\u7edf\uff08\u5982X Window System\uff09\uff0c\u5219\u67d0\u4e9b\u76ee\u5f55\u4ec5\u5b58\u5728\u4e8e\u7279\u5b9a\u7cfb\u7edf\u4e0a\u3002 \u76ee\u5f55 \u63cf\u8ff0 / \u4e3b\u5c42\u6b21\u7ed3\u6784\u6839\u76ee\u5f55\u548c\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u7684\u6839\u76ee\u5f55\u3002 /bin \u9700\u8981\u5728\u5355\u7528\u6237\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u7684\u5fc5\u8981\u547d\u4ee4\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1b\u662f\u9762\u5411\u6240\u6709\u7528\u6237\u7684\uff0c\u4f8b\u5982 cat , ls , cp . /boot \u5f15\u5bfc\u542f\u52a8\u6587\u4ef6\u3002\u4e00\u822c\u662f\u5355\u72ec\u7684\u5206\u533a\u3002 Boot loader files, e.g. , kernels , initrd . /dev \u8bbe\u5907\u6587\u4ef6\u3002 e.g. , /dev/null , /dev/disk0 , /dev/sda1 , /dev/tty , /dev/random . /etc \u7279\u5b9a\u4e3b\u673a\uff0c\u7cfb\u7edf\u8303\u56f4\u5185\u7684\u914d\u7f6e\u6587\u4ef6\u3002FHS\u9650\u5236 /etc \u5b58\u653e\u9759\u6001\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u80fd\u5305\u542b\u4e8c\u8fdb\u5236\u6587\u4ef6 /etc/opt \u5b58\u50a8\u5728 /opt \u4e2d\u7684\u9644\u52a0\u5305\u7684\u914d\u7f6e\u6587\u4ef6\u3002 /etc/sgml \u5904\u7406 SGML \u8f6f\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u76ee\u5f55\u3002 /etc/X11 X Window System \uff08\u7248\u672c 11\uff09\u7684\u914d\u7f6e\u6587\u4ef6 /etc/xml \u5904\u7406 XML \u8f6f\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u76ee\u5f55\u3002 /home \u7528\u6237\u7684 home \u76ee\u5f55\uff0c\u5305\u542b\u4fdd\u5b58\u7684\u6587\u4ef6\u3001\u4e2a\u4eba\u8bbe\u7f6e\u7b49\u3002\u4e00\u822c\u662f\u5355\u72ec\u7684\u5206\u533a\u3002 /lib /bin \u548c /sbin \u4e2d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5fc5\u8981\u5e93\u6587\u4ef6\u3002 /lib<qual> \u53ef\u9009\u683c\u5f0f\u5fc5\u8981\u5e93\u3002\u6b64\u7c7b\u76ee\u5f55\u662f\u53ef\u9009\u7684,\u4f46\u5982\u679c\u5b83\u4eec\u5b58\u5728,\u5219\u5b83\u4eec\u5177\u6709\u4e00\u4e9b\u8981\u6c42\u3002\u4f8b\u5982 /lib64 \u3002 /media \u53ef\u79fb\u9664\u5a92\u4f53\u6587\u4ef6\uff08\u6bd4\u5982 CD-ROMs \uff09\u6302\u8f7d\u70b9\u3002 /mnt \u4e34\u65f6\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\u3002 /opt \u53ef\u9009\u5e94\u7528\u8f6f\u4ef6\u5305\u3002 application software packages \u3002 /proc \u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u4ee5\u6587\u4ef6\u5f62\u5f0f\u63d0\u4f9b\u8fdb\u7a0b\u548c\u5185\u6838\u4fe1\u606f\u3002\u5728linux\u4e2d\uff0c\u5bf9\u5e94\u4e00\u4e2a procfs \uff08\u5728\u8bb8\u591a\u7c7b Unix \u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0c procfs \u662f \u8fdb\u7a0b \u6587\u4ef6\u7cfb\u7edf \u7684\u7f29\u5199\uff0c\u5305\u542b\u4e00\u4e2a\u4f2a\u6587\u4ef6\u7cfb\u7edf\uff08\u542f\u52a8\u65f6\u52a8\u6001\u751f\u6210\u7684\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c\u7528\u4e8e\u901a\u8fc7\u5185\u6838\u8bbf\u95ee\u8fdb\u7a0b\u4fe1\u606f\u3002\u8fd9\u4e2a\u6587\u4ef6\u7cfb\u7edf\u901a\u5e38\u88ab\u6302\u8f7d\u5230 /proc \u76ee\u5f55\u3002\u7531\u4e8e /proc \u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u4e5f\u5c31\u4e0d\u5360\u7528\u5b58\u50a8\u7a7a\u95f4\uff0c\u53ea\u662f\u5360\u7528\u6709\u9650\u7684\u5185\u5b58\u3002https://zh.wikipedia.org/wiki/Procfs\uff09\u6302\u8f7d\u3002 \u901a\u5e38\u81ea\u52a8\u751f\u6210\u5e76\u7531\u7cfb\u7edf\u52a8\u6001\u586b\u5145\u3002 /root root\u7528\u6237\u7684 home \u76ee\u5f55 /run \u8fd0\u884c\u65f6\u53d8\u5316\u7684\u6570\u636e\uff1a\u81ea\u4ece\u6700\u540e\u4e00\u6b21\u542f\u52a8\u7684\u6b63\u5728\u8fd0\u884c\u7684\u7cfb\u7edf\u7684\u4fe1\u606f\u3002\u6bd4\u5982\uff0c\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u548c\u8fd0\u884c\u7684\u5b88\u62a4\u8fdb\u7a0b\u3002\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5fc5\u987b\u5728\u542f\u52a8\u8fdb\u7a0b\u5f00\u59cb\u65f6\u5220\u9664\u6216\u622a\u65ad\uff08\u6e05\u7a7a\uff09\uff1b\u4f46\u662f\u5728\u63d0\u4f9b temporary filesystem ( tmpfs )\u76ee\u5f55\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u662f\u4e0d\u5fc5\u8981\u7684\u3002 /sbin \u5fc5\u8981\u7684\u7cfb\u7edf\u7ea7\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 e.g. , fsck, init, route. /srv \u7cfb\u7edf\u63d0\u4f9b\u7684\u5177\u4f53\u7ad9\u70b9\u6570\u636e\u3002\u4f8b\u5982\u4e3aweb\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\u548c\u811a\u672c\uff0c\u4e3aFTP\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\uff0c\u4e3a\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u63d0\u4f9b\u7684\u4ed3\u5e93\u7b49\u3002 /sys \u5305\u542b\u5173\u4e8e\u8bbe\u5907\u3001\u9a71\u52a8\u548c\u4e00\u4e9b\u5185\u6838\u7279\u6027\u7684\u4fe1\u606f\u3002 /tmp \u4e34\u65f6\u6587\u4ef6 (see also /var/tmp )\u3002\u7cfb\u7edf\u91cd\u542f\u65f6\u901a\u5e38\u4e0d\u4f1a\u4fdd\u7559\u8fd9\u4e9b\u6587\u4ef6\uff0c\u5e76\u53ef\u80fd\u4e25\u91cd\u9650\u5236\u5927\u5c0f\u3002 /usr \u5bf9\u4e8e\u53ea\u8bfb\u7528\u6237\u6570\u636e\u7684\u4e8c\u7ea7\u5c42\u6b21\u7ed3\u6784\uff1b\u5305\u542b\u5927\u90e8\u5206\u7684\uff08\u591a\uff09\u7528\u6237\u5de5\u5177\u548c\u5e94\u7528\u7a0b\u5e8f\u3002 /usr/bin \u975e\u5fc5\u8981\u547d\u4ee4\u53ef\u6267\u884c\u6587\u4ef6\uff08\u5355\u7528\u6237\u6a21\u5f0f\u4e0b\u975e\u5fc5\u9700\uff09\uff1b\u9762\u5411\u6240\u6709\u7528\u6237\u3002 /usr/include \u6807\u51c6\u5934\u6587\u4ef6\u3002 /usr/lib /usr/bin \u548c /usr/sbin \u4e2d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5e93\u3002 /usr/lib<qual> \u53ef\u9009\u683c\u5f0f\u5e93\u3002 e.g. /usr/lib32 for 32-bit libraries on a 64-bit machine (optional). /usr/local \u672c\u5730\u6570\u636e\u7684\u4e09\u7ea7\u5c42\u6b21\u7ed3\u6784\uff0c\u7279\u5b9a\u4e8e\u6b64\u4e3b\u673a\u3002\u901a\u5e38\u6709\u66f4\u591a\u5b50\u76ee\u5f55\uff0c e.g. , bin , lib , share \u3002 /usr/sbin \u975e\u5fc5\u8981\u7cfb\u7edf\u7ea7\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002 e.g. , daemons for various network-services . /usr/share \u975e\u67b6\u6784\u4f9d\u8d56\u7684\u5171\u4eab\u6570\u636e\u3002 /usr/src \u6e90\u7801\u3002 e.g. , the kernel source code with its header files. /usr/X11R6 X Window System , Version 11, Release 6 (up to FHS-2.3, optional). /var \u53d8\u5316\u7684\u6587\u4ef6\u2014\u2014\u5728\u7cfb\u7edf\u7684\u6b63\u5e38\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u5185\u5bb9\u4e00\u76f4\u53d8\u5316\u7684\u6587\u4ef6\u3002\u4f8b\u5982 logs, spool files, and temporary e-mail files\u3002\u6709\u65f6\u662f\u5355\u72ec\u7684\u4e00\u4e2a\u5206\u533a\u3002 /var/cache \u5e94\u7528\u7a0b\u5e8f\u7f13\u5b58\u6570\u636e\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u5728\u672c\u5730\u751f\u6210\u7684\u4e00\u4e2a\u8017\u65f6\u7684I/O\u7ed3\u679c\u6216\u8ba1\u7b97\u7ed3\u679c\u3002\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u80fd\u591f\u518d\u751f\u6216\u6062\u590d\u6570\u636e\u3002\u7f13\u5b58\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u5220\u9664\u800c\u4e0d\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002 /var/lib \u72b6\u6001\u4fe1\u606f\u3002 \u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u7684\u6301\u4e45\u6027\u6570\u636e, e.g. , databases, packaging system metadata, etc. /var/lock \u9501\u6587\u4ef6\u3002\u4e00\u7c7b\u8ddf\u8e2a\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u8d44\u6e90\u7684\u6587\u4ef6\u3002 /var/log \u65e5\u5fd7\u6587\u4ef6\uff0c\u5305\u542b\u5927\u91cf\u65e5\u5fd7\u6587\u4ef6\u3002 /var/mail \u7535\u5b50\u90ae\u4ef6\u3002\u5728\u4e00\u4e9b\u53d1\u884c\u7248\u4e2d\uff0c\u8fd9\u4e9b\u6587\u4ef6\u53ef\u80fd\u4f4d\u4e8e\u5e9f\u5f03\u7684 /var/spool/mail . /var/opt \u5b58\u50a8\u53ef\u9009\u5305\u7684 /opt \u4e2d\u7684\u53d8\u5316\u6570\u636e\u3002 /var/run \u8fd0\u884c\u65f6\u53d8\u5316\u6570\u636e\u3002\u8be5\u76ee\u5f55\u5305\u542b\u4e86\u81ea\u4ece\u542f\u52a8\u4ee5\u6765\u7684\u7cfb\u7edf\u4fe1\u606f\u6570\u636e\u3002In FHS 3.0, /var/run is replaced by /run ; a system should either continue to provide a /var/run directory, or provide a symbolic link from /var/run to /run , for backwards compatibility. /var/spool \u7b49\u5f85\u5904\u7406\u7684\u4efb\u52a1\u7684 Spool \uff0c e.g. , print queues and outgoing mail queue. /var/spool/mail \u5e9f\u5f03\u7684\u7528\u6237\u90ae\u4ef6\u76ee\u5f55\u3002 /var/tmp \u5728\u91cd\u542f\u4e4b\u540e\u5e94\u8be5\u4fdd\u5b58\u7684\u6587\u4ef6\u3002 FHS\u53ea\u662f\u4e00\u4e2a\u89c4\u8303\uff0c\u4e0d\u4e00\u5b9a\u8981\u4e25\u683c\u9075\u5faa\u5b83\u3002","title":"1. \u76ee\u5f55\u7ed3\u6784"},{"location":"linux/Linux\u903b\u8f91\u5377\u5212\u5206\u793a\u610f\u56fe/","text":"","title":"Linux\u903b\u8f91\u5377\u5212\u5206\u793a\u610f\u56fe"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/","text":"\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\u3002 1. \u6362\u884c\u7b26 \u00b6 Windows\u7cfb\u7edf\u7684\u6587\u4ef6\u7684\u6362\u884c\u7b26\u662f CR \uff08^M\uff09\u4e0e LF \uff08$\uff09\uff0c\u5728linux\u4e2d\u8868\u73b0\u4e3a\uff1a [ sink@dev vitest ] $ cat -A .gitignore autorun.inf^M$ uchkvk.pif^M$ \u53ef\u4ee5\u4f7f\u7528 dos2unix \u6765\u4e0elinux\u683c\u5f0f\u76f8\u4e92\u8f6c\u6362\u3002 1.1 \u5b89\u88c5 \u00b6 1.1.1 \u4ece\u955c\u50cf\u83b7\u53d6 \u00b6 \u6302\u8f7dcentos\u955c\u50cf\uff0c\u5b89\u88c5\uff1a $ rpm -ivh dos2unix-6.0.3-4.el7.x86_64.rpm 1.1.2 \u4eceyum\u83b7\u53d6 \u00b6 $ yum search dos2unix dos2unix.x86_64 : Text file format converters 1.2 \u4f7f\u7528 \u00b6 dos2unix / unix2dos / mac2unix / unix2mac [ options ] [ file ... ] [ -n infile outfile ... ] - k , --keepdate keep output file date - n , --newfile write to new file infile original file in new file mode outfile output file in new file mode - o , --oldfile write to old file file ... files to convert in old file mode [ sink@dev vitest ] $ cat -A .gitignore autorun.inf^M$ uchkvk.pif^M$ # linux [ sink@dev vitest ] $ dos2unix -n .gitignore .gitignore-linux dos2unix: converting file .gitignore to file .gitignore-linux in Unix format ... [ sink@dev vitest ] $ cat -A .gitignore-linux autorun.inf$ uchkvk.pif$ # Windows [ sink@dev vitest ] $ unix2dos -n .gitignore-linux .gitignore-Windows unix2dos: converting file .gitignore-linux to file .gitignore-Windows in DOS format ... [ sink@dev vitest ] $ cat -A .gitignore-Windows autorun.inf^M$ uchkvk.pif^M$ # macOS [ sink@dev vitest ] $ unix2mac -n .gitignore-linux .gitignore-mac unix2mac: converting file .gitignore-linux to file .gitignore-mac in Mac format ... [ sink@dev vitest ] $ cat -A .gitignore-mac autorun.inf^Muchkvk.pif^M [ sink@dev vitest ] $ file .gitignore-* .gitignore-linux: ASCII text .gitignore-mac: ASCII text, with CR line terminators .gitignore-Windows: ASCII text, with CRLF line terminators 1.3 \u5176\u5b83\u5b57\u7b26\u8f6c\u6362\u65b9\u6cd5 \u00b6 tr [ OPTION ]... SET1 [ SET2 ] \u4ece\u6807\u51c6\u8f93\u5165 \u8f6c\u6362\u3001\u53bb\u91cd\u3001\u5220\u9664\u5b57\u7b26\uff0c\u5199\u5165\u6807\u51c6\u8f93\u51fa - c , - C , -- complement \u4f7f\u7528\u5b8c\u6574\u7684 SET1 - d , -- delete \u5220\u9664 SET1 \u4e2d\u7684\u5b57\u7b26 - s , -- squeeze - repeats \u5bf9\u76f8\u8fde\u7684\u5355\u4e2a\u5b57\u7b26\u53bb\u91cd SETs \uff1a \\\\ backslash \\ b backspace \\ n new line \\ r return \\ t horizontal tab CHAR1 - CHAR2 all characters from CHAR1 to CHAR2 in ascending order [ CHAR * ] in SET2 , copies of CHAR until length of SET1 [ CHAR * REPEAT ] REPEAT copies of CHAR , REPEAT octal \uff08\u516b\u8fdb\u5236\uff09 if starting with 0 [: alnum :] all letters and digits [: alpha :] all letters [: blank :] all horizontal whitespace [: digit :] all digits [: lower :] all lower case letters [: space :] all horizontal or vertical whitespace [: upper :] all upper case letters [: xdigit :] all hexadecimal digits [ = CHAR = ] all characters which are equivalent to CHAR [ root@dev vitest ] # echo abcdABCD | tr [:lower:] [:upper:] ABCDABCD [ root@dev vitest ] # echo abcdABCD | tr [a-z] [A-Z] ABCDABCD [ root@dev vitest ] # echo abcdABCD | tr [a-z] [1-9] 1234ABCD [ root@dev vitest ] # cat -A .gitignore-Windows | tr -d '^M' autorun.inf$ uchkvk.pif$ [ root@dev vitest ] # cat .gitignore-Windows | tr -d '\\r' | cat -A autorun.inf$ uchkvk.pif$ [ root@dev vitest ] # echo aaabbbb | tr -s a abbbb [ root@dev vitest ] # echo aaabbbb | tr -s a b b 2. \u7f16\u7801 \u00b6 \u5728Windows\u7cfb\u7edf\u4e2d\u8f6c\u6362\u7f16\u7801\u53ef\u4ee5\u4f7f\u7528 \u8bb0\u4e8b\u672c\u7684\u53e6\u5b58\u4e3a \u3001 Nodepade++ \u7b49\u5de5\u5177\u3002 iconv [ OPTION ...] [ FILE ...] Convert encoding of given files from one encoding to another . - f , -- from - code = NAME encoding of original text - t , -- to - code = NAME encoding for output - l , -- list list all known coded character sets - o , -- output = FILE \u8f93\u51fa\u5230\u65b0\u7684\u6587\u4ef6\u3002\u9ed8\u8ba4\u66f4\u6539\u539f\u6587\u4ef6 # \u5148\u5728Windows\u4e2d\u7f16\u5199\u6587\u4ef6\uff0c\u653e\u5230linux\u4e2d # \u6253\u5f00\u65b0\u7ec8\u7aef\u8bbe\u7f6eGBK\u7f16\u7801\uff0c\u6b64\u65f6\u53ef\u6b63\u5e38\u67e5\u770b\u6587\u4ef6 [ sink@dev vitest ] $ cat charactor.txt abcd \u5927\u8fd0\u6cb3 [ sink@dev vitest ] $ iconv -f gbk -t utf-8 -o charactor-utf8.txt charactor.txt # \u518d\u6253\u5f00\u65b0\u7684\u7ec8\u7aef\u8bbe\u7f6e\u4e3aUTF-8\u7f16\u7801\uff0c\u67e5\u770b\u6587\u4ef6 [ sink@dev vitest ] $ cat charactor-utf8.txt abcd \u5927\u8fd0\u6cb3 # \u6ce8\u610f\uff1afile\u547d\u4ee4\u5e76\u4e0d\u80fd\u51c6\u786e\u7684\u8bc6\u522b\u5230Windows\u7684\u6587\u4ef6\u7f16\u7801 [ sink@dev vitest ] $ file -i charactor* charactor.txt: text/plain ; charset = iso-8859-1 charactor-utf8.txt: text/plain ; charset = utf-8","title":"Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#1","text":"Windows\u7cfb\u7edf\u7684\u6587\u4ef6\u7684\u6362\u884c\u7b26\u662f CR \uff08^M\uff09\u4e0e LF \uff08$\uff09\uff0c\u5728linux\u4e2d\u8868\u73b0\u4e3a\uff1a [ sink@dev vitest ] $ cat -A .gitignore autorun.inf^M$ uchkvk.pif^M$ \u53ef\u4ee5\u4f7f\u7528 dos2unix \u6765\u4e0elinux\u683c\u5f0f\u76f8\u4e92\u8f6c\u6362\u3002","title":"1. \u6362\u884c\u7b26"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#11","text":"","title":"1.1 \u5b89\u88c5"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#111","text":"\u6302\u8f7dcentos\u955c\u50cf\uff0c\u5b89\u88c5\uff1a $ rpm -ivh dos2unix-6.0.3-4.el7.x86_64.rpm","title":"1.1.1 \u4ece\u955c\u50cf\u83b7\u53d6"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#112-yum","text":"$ yum search dos2unix dos2unix.x86_64 : Text file format converters","title":"1.1.2 \u4eceyum\u83b7\u53d6"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#12","text":"dos2unix / unix2dos / mac2unix / unix2mac [ options ] [ file ... ] [ -n infile outfile ... ] - k , --keepdate keep output file date - n , --newfile write to new file infile original file in new file mode outfile output file in new file mode - o , --oldfile write to old file file ... files to convert in old file mode [ sink@dev vitest ] $ cat -A .gitignore autorun.inf^M$ uchkvk.pif^M$ # linux [ sink@dev vitest ] $ dos2unix -n .gitignore .gitignore-linux dos2unix: converting file .gitignore to file .gitignore-linux in Unix format ... [ sink@dev vitest ] $ cat -A .gitignore-linux autorun.inf$ uchkvk.pif$ # Windows [ sink@dev vitest ] $ unix2dos -n .gitignore-linux .gitignore-Windows unix2dos: converting file .gitignore-linux to file .gitignore-Windows in DOS format ... [ sink@dev vitest ] $ cat -A .gitignore-Windows autorun.inf^M$ uchkvk.pif^M$ # macOS [ sink@dev vitest ] $ unix2mac -n .gitignore-linux .gitignore-mac unix2mac: converting file .gitignore-linux to file .gitignore-mac in Mac format ... [ sink@dev vitest ] $ cat -A .gitignore-mac autorun.inf^Muchkvk.pif^M [ sink@dev vitest ] $ file .gitignore-* .gitignore-linux: ASCII text .gitignore-mac: ASCII text, with CR line terminators .gitignore-Windows: ASCII text, with CRLF line terminators","title":"1.2 \u4f7f\u7528"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#13","text":"tr [ OPTION ]... SET1 [ SET2 ] \u4ece\u6807\u51c6\u8f93\u5165 \u8f6c\u6362\u3001\u53bb\u91cd\u3001\u5220\u9664\u5b57\u7b26\uff0c\u5199\u5165\u6807\u51c6\u8f93\u51fa - c , - C , -- complement \u4f7f\u7528\u5b8c\u6574\u7684 SET1 - d , -- delete \u5220\u9664 SET1 \u4e2d\u7684\u5b57\u7b26 - s , -- squeeze - repeats \u5bf9\u76f8\u8fde\u7684\u5355\u4e2a\u5b57\u7b26\u53bb\u91cd SETs \uff1a \\\\ backslash \\ b backspace \\ n new line \\ r return \\ t horizontal tab CHAR1 - CHAR2 all characters from CHAR1 to CHAR2 in ascending order [ CHAR * ] in SET2 , copies of CHAR until length of SET1 [ CHAR * REPEAT ] REPEAT copies of CHAR , REPEAT octal \uff08\u516b\u8fdb\u5236\uff09 if starting with 0 [: alnum :] all letters and digits [: alpha :] all letters [: blank :] all horizontal whitespace [: digit :] all digits [: lower :] all lower case letters [: space :] all horizontal or vertical whitespace [: upper :] all upper case letters [: xdigit :] all hexadecimal digits [ = CHAR = ] all characters which are equivalent to CHAR [ root@dev vitest ] # echo abcdABCD | tr [:lower:] [:upper:] ABCDABCD [ root@dev vitest ] # echo abcdABCD | tr [a-z] [A-Z] ABCDABCD [ root@dev vitest ] # echo abcdABCD | tr [a-z] [1-9] 1234ABCD [ root@dev vitest ] # cat -A .gitignore-Windows | tr -d '^M' autorun.inf$ uchkvk.pif$ [ root@dev vitest ] # cat .gitignore-Windows | tr -d '\\r' | cat -A autorun.inf$ uchkvk.pif$ [ root@dev vitest ] # echo aaabbbb | tr -s a abbbb [ root@dev vitest ] # echo aaabbbb | tr -s a b b","title":"1.3 \u5176\u5b83\u5b57\u7b26\u8f6c\u6362\u65b9\u6cd5"},{"location":"linux/Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362/#2","text":"\u5728Windows\u7cfb\u7edf\u4e2d\u8f6c\u6362\u7f16\u7801\u53ef\u4ee5\u4f7f\u7528 \u8bb0\u4e8b\u672c\u7684\u53e6\u5b58\u4e3a \u3001 Nodepade++ \u7b49\u5de5\u5177\u3002 iconv [ OPTION ...] [ FILE ...] Convert encoding of given files from one encoding to another . - f , -- from - code = NAME encoding of original text - t , -- to - code = NAME encoding for output - l , -- list list all known coded character sets - o , -- output = FILE \u8f93\u51fa\u5230\u65b0\u7684\u6587\u4ef6\u3002\u9ed8\u8ba4\u66f4\u6539\u539f\u6587\u4ef6 # \u5148\u5728Windows\u4e2d\u7f16\u5199\u6587\u4ef6\uff0c\u653e\u5230linux\u4e2d # \u6253\u5f00\u65b0\u7ec8\u7aef\u8bbe\u7f6eGBK\u7f16\u7801\uff0c\u6b64\u65f6\u53ef\u6b63\u5e38\u67e5\u770b\u6587\u4ef6 [ sink@dev vitest ] $ cat charactor.txt abcd \u5927\u8fd0\u6cb3 [ sink@dev vitest ] $ iconv -f gbk -t utf-8 -o charactor-utf8.txt charactor.txt # \u518d\u6253\u5f00\u65b0\u7684\u7ec8\u7aef\u8bbe\u7f6e\u4e3aUTF-8\u7f16\u7801\uff0c\u67e5\u770b\u6587\u4ef6 [ sink@dev vitest ] $ cat charactor-utf8.txt abcd \u5927\u8fd0\u6cb3 # \u6ce8\u610f\uff1afile\u547d\u4ee4\u5e76\u4e0d\u80fd\u51c6\u786e\u7684\u8bc6\u522b\u5230Windows\u7684\u6587\u4ef6\u7f16\u7801 [ sink@dev vitest ] $ file -i charactor* charactor.txt: text/plain ; charset = iso-8859-1 charactor-utf8.txt: text/plain ; charset = utf-8","title":"2. \u7f16\u7801"},{"location":"linux/centos\u91cd\u542f\u5361\u6b7b/","text":"\u8fd0\u884c fix_systemd.sh \u6587\u4ef6\uff1a #!/bin/bash #only centos need fix if [ ! -f /etc/centos-release ] ; then echo \"this is not centos linux\" exit 1 fi #only centos7.0 7.1 7.2 need fix osversion = ` awk '{print $4}' /etc/centos-release ` if [ ${ osversion } ! = '7.0.1406' ] && [ ${ osversion } ! = '7.1.1503' ] && [ ${ osversion } ! = '7.2.1511' ] ; then echo \"this is not centos7.0 7.1 7.2\" exit 1 fi #create rc-local.service cat > /etc/systemd/system/rc-local.service <<EOF # This file is part of systemd. # # systemd is free software; you can redistribute it and/or modify it # under the terms of the GNU Lesser General Public License as published by # the Free Software Foundation; either version 2.1 of the License, or # (at your option) any later version. # This unit gets pulled automatically into multi-user.target by # systemd-rc-local-generator if /etc/rc.d/rc.local is executable. [Unit] Description=/etc/rc.d/rc.local Compatibility ConditionFileIsExecutable=/etc/rc.d/rc.local After=network.target [Service] Type=forking ExecStart=/etc/rc.d/rc.local start TimeoutSec=5 RemainAfterExit=yes EOF #modify the default timeout of systemd sed -i 's/#DefaultTimeoutStopSec=90s/DefaultTimeoutStopSec=30s/g' /etc/systemd/system.conf systemctl daemon-reload exit 0","title":"Centos\u91cd\u542f\u5361\u6b7b"},{"location":"linux/epel\u6e90/","text":"yum install -y epel-release libvirt_storage_backend_rbd.so\u7f3a\u5931 \u7f3a\u5931\u7684\u94fe\u63a5\u5e93\u6587\u4ef6\u5728librbd1\u5305\u91cc\uff0c\u89e3\u51b3\u65b9\u6cd5\u5982\u4e0b\uff1a yum update librbd1 systemctl restart libvirtd","title":"epel\u6e90"},{"location":"linux/sanlock/","text":"\u53c2\u8003\u8d44\u6e90\uff1a https://www.ibm.com/developerworks/cn/linux/1404_zhouzs_sanlock/ https://www.ibm.com/developerworks/cn/linux/l-cn-watchdog/ https://www.ovirt.org/develop/developer-guide/vdsm/sanlock.html \u5b89\u88c5sanlock yum install sanlock sanlock-python # \u5b89\u88c5sanlock \u4e0e python \u5e93 systemctl start sanlock.service # \u4f1a\u81ea\u52a8\u52a0\u8f7d softdog \u6a21\u5757 \u51c6\u5907\u5de5\u4f5c [ root@linux tmp ] # mount.nfs 192.168.216.10:/sanlock_test/ sanlock-test/ [ root@linux tmp ] # dd if=/dev/zero of=sanlock-test/ids bs=1048576 count=1 [ root@linux tmp ] # dd if=/dev/zero of=sanlock-test/leases bs=1048576 count=1 [ root@linux tmp ] # chown sanlock:sanlock sanlock-test/{ids,leases} \u521d\u59cb\u5316\u8d44\u6e90 [ root@linux tmp ] # sanlock client init -s LS:0:/tmp/sanlock-test/ids:0 init init done 0 [ root@linux tmp ] # sanlock client init -r LS:leader:/tmp/sanlock-test/leases:0 init init done 0 \u8fd0\u884csanlock [ root@linux tmp ] # ./sanlock-test/ha.py 1 /tmp/sanlock-test/ids /tmp/sanlock-test/leases & Try to acquire host id LS:1:/tmp/sanlock-test/ids:0 Try to acquire leader lease LS:leader:/tmp/sanlock-test/leases:0 2019 12 CST 09 :08:06 Service is running \u2026\u2026 \u6b64\u65f6\u65ad\u5f00NFS\u5b58\u50a8\u7f51\u7edc\uff0c\u7cfb\u7edf\u5c06\u572860s\u540e\u8b66\u544a20s\uff0c\u7136\u540e\u5c1d\u8bd5kill\u6389\u8fdb\u7a0b\uff0c\u5982\u679c60s\uff08\u524d40s\u6267\u884c kill -15 \uff0c\u540e20s\u6267\u884c kill -9 \uff09\u5185kill\u5931\u8d25\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c06\u91cd\u542f\u3002 /var/log/sanlock.log \u53ea\u8bb0\u8f7d sanlock \u65e5\u5fd7\uff0c /var/log/messages \u4f1a\u8bb0\u8f7d sanlock \u4e0e wdmd \u65e5\u5fd7\u3002\u4e0d\u8fc7\u4e24\u8005\u7684\u65e5\u5fd7\u90fd\u8bb0\u5f55\u4e0d\u5168\u6700\u597d\u5728\u7ec8\u7aef\u67e5\u770b\uff1a tailf /var/log/sanlock.log \u3002 # \u91cd\u542f\u540e\u67e5\u770b\u65e5\u5fd7 [ root@linux ~ ] # vi /var/log/messages # \u65ad\u5f00\u7f51\u7edc\u540e\u5f00\u59cb\u62a5\u9519 Dec 23 09 :25:31 linux sanlock [ 1816 ] : 2019 -12-23 09 :25:31 2395 [ 2234 ] : s2 delta_renew read timeout 10 sec offset 0 /tmp/sanlock-test/ids Dec 23 09 :25:31 linux sanlock [ 1816 ] : 2019 -12-23 09 :25:31 2395 [ 2234 ] : s2 renewal error -202 delta_length 10 last_success 2365 Dec 23 09 :25:51 linux sanlock [ 1816 ] : 2019 -12-23 09 :25:51 2416 [ 2234 ] : s2 delta_renew read timeout 10 sec offset 0 /tmp/sanlock-test/ids Dec 23 09 :25:51 linux sanlock [ 1816 ] : 2019 -12-23 09 :25:51 2416 [ 2234 ] : s2 renewal error -202 delta_length 20 last_success 2365 # \u5f00\u59cb\u8b66\u544a Dec 23 09 :26:01 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:01 2425 [ 1816 ] : s2 check_our_lease warning 60 last_success 2365 Dec 23 09 :26:02 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:02 2426 [ 1816 ] : s2 check_our_lease warning 61 last_success 2365 \u2026\u2026 Dec 23 09 :26:15 linux wdmd [ 1825 ] : test warning now 2440 ping 2430 close 2037 renewal 2365 expire 2445 client 1816 sanlock_LS:1 # wdmd \u7684 watchdog \u65e5\u5fd7 Dec 23 09 :26:15 linux wdmd [ 1825 ] : /dev/watchdog0 closed unclean Dec 23 09 :26:15 linux kernel: watchdog watchdog0: watchdog did not stop! \u2026\u2026 Dec 23 09 :26:19 linux wdmd [ 1825 ] : test warning now 2444 ping 2430 close 2440 renewal 2365 expire 2445 client 1816 sanlock_LS:1 Dec 23 09 :26:20 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:20 2444 [ 1816 ] : s2 check_our_lease warning 79 last_success 2365 Dec 23 09 :26:20 linux wdmd [ 1825 ] : test failed rem 55 now 2445 ping 2430 close 2440 renewal 2365 expire 2445 client 1816 sanlock_LS:1 # 80s \u7ed3\u675f Dec 23 09 :26:21 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:21 2445 [ 1816 ] : s2 check_our_lease failed 80 # kill \u6389\u8fdb\u7a0b Dec 23 09 :26:21 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:21 2445 [ 1816 ] : s2 kill 2236 sig 15 count 1 Dec 23 09 :26:21 linux sanlock [ 1816 ] : 2019 -12-23 09 :26:21 2446 [ 1816 ] : s2 kill 2236 sig 15 count 2 \u2026\u2026 # \u4e0d\u80fd kill \u6389\u8fdb\u7a0b\u7684\u539f\u56e0 Dec 23 09 :26:30 linux setroubleshoot: SELinux is preventing /usr/sbin/sanlock from using the signal access on a process. For complete SELinux messages run: sealert -l 7a8e5ae9-5274-4d09-81b2-a93b37cd716d Dec 23 09 :26:30 linux python: SELinux is preventing /usr/sbin/sanlock from using the signal access on a process.#012#012***** Plugin catchall ( 100 . confidence ) suggests **************************#012#012If you believe that sanlock should be allowed signal access on processes labeled unconfined_t by default.#012Then you should report this as a bug.\u2026\u2026 # \u4e0b\u9762\u662f\u7cfb\u7edf\u542f\u52a8\u65e5\u5fd7 Dec 23 09 :27:23 linux journal: Runtime journal is using 8 .0M ( max allowed 91 .0M, trying to leave 136 .6M free of 902 .7M available \u2192 current limit 91 .0M ) . Dec 23 09 :27:23 linux kernel: Initializing cgroup subsys cpuset Dec 23 09 :27:23 linux kernel: Initializing cgroup subsys cpu \u89e3\u51b3selinux\u7684\u95ee\u9898\u4e4b\u540e\uff0c\u518d\u6b21\u5c1d\u8bd5\uff0c\u53d1\u73b0\u8fdb\u7a0b\u88ab\u6210\u529f\u5730kill\u6389\u4e86\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u91cd\u542f\uff1a 2019 12 CST 10 :08:09 Service is running [ 1 ] + Done ./sanlock-test/ha.py 1 /tmp/sanlock-test/ids /tmp/sanlock-test/leases [ root@linux tmp ] # vi /var/log/messages Dec 23 10 :08:07 linux kernel: watchdog watchdog0: watchdog did not stop! Dec 23 10 :08:07 linux wdmd [ 1750 ] : test warning now 2444 ping 2434 close 0 renewal 2366 expire 2446 client 1737 sanlock_LS:1 Dec 23 10 :08:07 linux wdmd [ 1750 ] : /dev/watchdog0 closed unclean Dec 23 10 :08:07 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:07 2444 [ 1737 ] : s1 check_our_lease warning 78 last_success 2366 Dec 23 10 :08:08 linux wdmd [ 1750 ] : test warning now 2445 ping 2434 close 2444 renewal 2366 expire 2446 client 1737 sanlock_LS:1 Dec 23 10 :08:08 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:08 2445 [ 1737 ] : s1 check_our_lease warning 79 last_success 2366 Dec 23 10 :08:09 linux wdmd [ 1750 ] : test failed rem 58 now 2446 ping 2434 close 2444 renewal 2366 expire 2446 client 1737 sanlock_LS:1 Dec 23 10 :08:09 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:09 2446 [ 1737 ] : s1 check_our_lease failed 80 Dec 23 10 :08:09 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:09 2446 [ 1737 ] : s1 kill 1831 sig 15 count 1 Dec 23 10 :08:09 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:09 2446 [ 1737 ] : dead 1831 ci 2 count 1 Dec 23 10 :08:10 linux wdmd [ 1750 ] : /dev/watchdog0 reopen # \u8fd9\u91cc\u6307\u793a\u8fdb\u7a0b\u5df2\u7ecf\u88ab kill \u4e86 Dec 23 10 :08:10 linux sanlock [ 1737 ] : 2019 -12-23 10 :08:10 2447 [ 1737 ] : s1 all pids clear python\u6587\u4ef6 ha.py #!/usr/bin/python # coding=utf-8 import sys import time from multiprocessing import Process import sanlock # simpleHA \u4e3b\u7a0b\u5e8f\uff0c\u52a0\u5165 sanlock \u96c6\u7fa4\u5e76\u5c1d\u8bd5\u83b7\u53d6 Paxos Lease def serviceMain ( hostId , lockspacePath , leasePath ): sfd = sanlock . register () # \u628a\u672c\u8fdb\u7a0b\u6ce8\u518c\u5230 sanlock \u670d\u52a1\u4e0a while True : try : # \u82e5\u5c1a\u672a\u52a0\u5165 sanlock \u96c6\u7fa4\uff0c\u5219\u5c1d\u8bd5\u83b7\u53d6\u5bf9 hostId \u7684 Delta Lease # \u5e76\u5c1d\u8bd5\u52a0\u5165 sanlock \u96c6\u7fa4 if not sanlock . inq_lockspace ( \"LS\" , hostId , lockspacePath ): print \"Try to acquire host id LS: %s : %s :0\" % ( hostId , lockspacePath ) sanlock . add_lockspace ( \"LS\" , hostId , lockspacePath ) # \u5c1d\u8bd5\u83b7\u53d6 Delta Lease print \"Try to acquire leader lease LS:leader: %s :0\" % leasePath sanlock . acquire ( \"LS\" , \"leader\" , [( leasePath , 0 )], sfd ) except sanlock . SanlockException as e : print e # \u65e0\u6cd5\u52a0\u5165\u96c6\u7fa4\uff0c\u6216\u65e0\u6cd5\u83b7\u53d6 Delta Lease # 10 \u79d2\u540e\u91cd\u8bd5 print \"Failed to acquire leases, try again in 10s.\" time . sleep ( 10 ) else : break # \u6210\u529f\u83b7\u53d6 Paxos Lease\uff0c\u4e0d\u518d\u91cd\u8bd5 # \u6210\u529f\u52a0\u5165\u4e86 sanlock \u96c6\u7fa4\u5e76\u83b7\u53d6\u4e86 Paxos Lease # \u6267\u884c\u5b9e\u9645\u7684\u5e94\u7528\u670d\u52a1 serve () # \u8ba9\u5b83\u4e00\u76f4\u8fd0\u884c def serve (): while True : print time . strftime ( \"%Y %m %Z %H:%M:%S\" ), \"Service is running\" time . sleep ( 10 ) print time . strftime ( \"%Y %m %Z %H:%M:%S\" ), \"Service crashed\" if __name__ == \"__main__\" : try : hostId = int ( sys . argv [ 1 ]) lockspacePath = sys . argv [ 2 ] leasePath = sys . argv [ 3 ] except Exception : sys . stderr . write ( \"Usage: %s host_id lockspace_path lease_path \\n \" % sys . argv [ 0 ]) exit ( 1 ) p = Process ( target = serviceMain , args = ( hostId , lockspacePath , leasePath )) p . start () p . join ()","title":"Sanlock"},{"location":"linux/\u4e3b\u673a\u4e0d\u80fd\u8fde\u63a5mariadb/","text":"mysql > use mysql ; MariaDB [ mysql ]> update user set host = '%' where host = 'localhost' ; mysql > flush privileges ;","title":"\u4e3b\u673a\u4e0d\u80fd\u8fde\u63a5mariadb"},{"location":"linux/\u4fee\u6539centos7\u8bed\u8a00/","text":"1. \u4fee\u6539centos7\u8bed\u8a00 \u00b6 \u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5 \u4f7f\u7528LANG=\u201czh_CN.UTF-8\u201d\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u4e0d\u8fc7\u5728\u91cd\u65b0\u767b\u5f55\u7684\u65f6\u5019\u53c8\u4f1a\u53d8\u56de\u82f1\u6587\u3002\u8fd9\u4e2a\u4e0d\u662f\u957f\u4e45\u7684\u65b9\u6cd5\u3002 \u66f4\u6539\u7cfb\u7edf\u53c2\u6570 \u5982\u679c\u7cfb\u7edf\u6ca1\u6709\u4e2d\u6587\u652f\u6301\uff0c\u53ef\u4ee5\u901a\u8fc7\u7f51\u4e0a\u4e0b\u8f7d\u5b89\u88c5\u4e2d\u6587\u8bed\u8a00\u5305,\u4f7f\u7528\u547d\u4ee4\uff1a yum groupinstall Chinese-support vim /etc/locale.conf \u8fdb\u5165\u4ee5\u540e\u53ea\u6709\u7b80\u5355\u7684\u4e00\u53e5LANG=\"en_US.UTF-8\" \u8fd9\u4e2a\u914d\u7f6e\uff0c\u628a\"en_US.UTF-8\"\u66ff\u6362\u6210\"zh_CN.UTF-8\" \u4fdd\u5b58\u9000\u51fa\u5373\u53ef\u3002","title":"\u4fee\u6539centos7\u8bed\u8a00"},{"location":"linux/\u4fee\u6539centos7\u8bed\u8a00/#1-centos7","text":"\u4e34\u65f6\u89e3\u51b3\u65b9\u6cd5 \u4f7f\u7528LANG=\u201czh_CN.UTF-8\u201d\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u4e0d\u8fc7\u5728\u91cd\u65b0\u767b\u5f55\u7684\u65f6\u5019\u53c8\u4f1a\u53d8\u56de\u82f1\u6587\u3002\u8fd9\u4e2a\u4e0d\u662f\u957f\u4e45\u7684\u65b9\u6cd5\u3002 \u66f4\u6539\u7cfb\u7edf\u53c2\u6570 \u5982\u679c\u7cfb\u7edf\u6ca1\u6709\u4e2d\u6587\u652f\u6301\uff0c\u53ef\u4ee5\u901a\u8fc7\u7f51\u4e0a\u4e0b\u8f7d\u5b89\u88c5\u4e2d\u6587\u8bed\u8a00\u5305,\u4f7f\u7528\u547d\u4ee4\uff1a yum groupinstall Chinese-support vim /etc/locale.conf \u8fdb\u5165\u4ee5\u540e\u53ea\u6709\u7b80\u5355\u7684\u4e00\u53e5LANG=\"en_US.UTF-8\" \u8fd9\u4e2a\u914d\u7f6e\uff0c\u628a\"en_US.UTF-8\"\u66ff\u6362\u6210\"zh_CN.UTF-8\" \u4fdd\u5b58\u9000\u51fa\u5373\u53ef\u3002","title":"1. \u4fee\u6539centos7\u8bed\u8a00"},{"location":"linux/\u4fee\u6539mariadb\u7f16\u7801\u7c7b\u578b/","text":"1. \u7b2c\u4e00\u79cd\uff1a \u00b6 vi /etc/my.conf.d/server.cnf [server] character_set_server = utf8 [mysqld] character_set_server = utf8 Service mysql restart 2. \u7b2c\u4e8c\u79cd\uff1a \u00b6 \u767b\u5f55MySQL\uff0c\u4f7f\u7528 SHOW VARIABLES LIKE 'character%'; \u67e5\u770b\u5f53\u524d\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\uff0c\u5e94\u8be5\u6709\u597d\u51e0\u4e2a\u4e0d\u662fUTF-8\u683c\u5f0f\u3002 \u8981\u4fee\u6539\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e /etc/my.cnf.d \u76ee\u5f55\u4e0b\uff1a client . cnf \u5728 [ client ] \u5b57\u6bb5\u91cc\u52a0\u5165 default - character - set = utf8 server . cnf \u5728 [ mysqld ] \u5b57\u6bb5\u91cc\u52a0\u5165 character - set - server = utf8","title":"\u4fee\u6539mariadb\u7f16\u7801\u7c7b\u578b"},{"location":"linux/\u4fee\u6539mariadb\u7f16\u7801\u7c7b\u578b/#1","text":"vi /etc/my.conf.d/server.cnf [server] character_set_server = utf8 [mysqld] character_set_server = utf8 Service mysql restart","title":"1. \u7b2c\u4e00\u79cd\uff1a"},{"location":"linux/\u4fee\u6539mariadb\u7f16\u7801\u7c7b\u578b/#2","text":"\u767b\u5f55MySQL\uff0c\u4f7f\u7528 SHOW VARIABLES LIKE 'character%'; \u67e5\u770b\u5f53\u524d\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\uff0c\u5e94\u8be5\u6709\u597d\u51e0\u4e2a\u4e0d\u662fUTF-8\u683c\u5f0f\u3002 \u8981\u4fee\u6539\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e /etc/my.cnf.d \u76ee\u5f55\u4e0b\uff1a client . cnf \u5728 [ client ] \u5b57\u6bb5\u91cc\u52a0\u5165 default - character - set = utf8 server . cnf \u5728 [ mysqld ] \u5b57\u6bb5\u91cc\u52a0\u5165 character - set - server = utf8","title":"2. \u7b2c\u4e8c\u79cd\uff1a"},{"location":"linux/\u5173\u95edselinux/","text":"1. nginx \u542f\u52a8\u5931\u8d25,\u65e5\u5fd7\u91cc\u9762\u62a5\u9519\u4fe1\u606f\u5982\u4e0b: \u00b6 Starting nginx: nginx: [emerg] bind() to 0.0.0.0:8095 failed (13: Permission denied) \u6743\u9650\u62d2\u7edd\uff0c\u7ecf\u68c0\u67e5\u53d1\u73b0\u662f\u5f00\u542fselinux \u5bfc\u81f4\u7684\u3002 \u76f4\u63a5\u5173\u95ed\u3002 getenforce \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u662f\u5426\u5f00\u542f\u4e86selinux \u5982\u679c\u8f93\u51fa disabled \u6216 permissive \u90a3\u5c31\u662f\u5173\u95ed\u4e86\uff0c \u5982\u679c\u8f93\u51fa enforcing \u90a3\u5c31\u662f\u5f00\u542f\u4e86 selinux\u3002 2. \u4e34\u65f6\u5173\u95edselinux \u00b6 setenforce 0 ##\u8bbe\u7f6eSELinux \u6210\u4e3apermissive\u6a21\u5f0f setenforce 1 ##\u8bbe\u7f6eSELinux \u6210\u4e3aenforcing\u6a21\u5f0f 3. \u6c38\u4e45\u5173\u95edselinux, \u00b6 \u4fee\u6539/etc/selinux/config \u6587\u4ef6 \u5c06SELINUX=enforcing\u6539\u4e3aSELINUX=disabled \u91cd\u542f\u673a\u5668\u5373\u53ef Tags: selinux , nginx\u7ed1\u5b9a\u7aef\u53e3\u5931\u8d25","title":"\u5173\u95edselinux"},{"location":"linux/\u5173\u95edselinux/#1-nginx","text":"Starting nginx: nginx: [emerg] bind() to 0.0.0.0:8095 failed (13: Permission denied) \u6743\u9650\u62d2\u7edd\uff0c\u7ecf\u68c0\u67e5\u53d1\u73b0\u662f\u5f00\u542fselinux \u5bfc\u81f4\u7684\u3002 \u76f4\u63a5\u5173\u95ed\u3002 getenforce \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u662f\u5426\u5f00\u542f\u4e86selinux \u5982\u679c\u8f93\u51fa disabled \u6216 permissive \u90a3\u5c31\u662f\u5173\u95ed\u4e86\uff0c \u5982\u679c\u8f93\u51fa enforcing \u90a3\u5c31\u662f\u5f00\u542f\u4e86 selinux\u3002","title":"1. nginx \u542f\u52a8\u5931\u8d25,\u65e5\u5fd7\u91cc\u9762\u62a5\u9519\u4fe1\u606f\u5982\u4e0b:"},{"location":"linux/\u5173\u95edselinux/#2-selinux","text":"setenforce 0 ##\u8bbe\u7f6eSELinux \u6210\u4e3apermissive\u6a21\u5f0f setenforce 1 ##\u8bbe\u7f6eSELinux \u6210\u4e3aenforcing\u6a21\u5f0f","title":"2. \u4e34\u65f6\u5173\u95edselinux"},{"location":"linux/\u5173\u95edselinux/#3-selinux","text":"\u4fee\u6539/etc/selinux/config \u6587\u4ef6 \u5c06SELINUX=enforcing\u6539\u4e3aSELINUX=disabled \u91cd\u542f\u673a\u5668\u5373\u53ef Tags: selinux , nginx\u7ed1\u5b9a\u7aef\u53e3\u5931\u8d25","title":"3. \u6c38\u4e45\u5173\u95edselinux,"},{"location":"linux/\u5220\u9664\u7f51\u6865/","text":"1. \u5220\u9664\u7f51\u6865 \u00b6 1.\u505c\u7528\u7f51\u6865 ip link set down <bridge> 2.\u5220\u9664\u7f51\u6865\u7684\u914d\u7f6e\u6587\u4ef6 rm -f ifcfg-<bridge> 3.\u5220\u9664\u7f51\u6865 # \u67e5\u770b\u7f51\u6865 brctl show # \u5220\u9664\u7f51\u6865 brctl delbr <bridge> 4.\u91cd\u542f\u7f51\u7edc\u670d\u52a1 systemctl restart network","title":"\u5220\u9664\u7f51\u6865"},{"location":"linux/\u5220\u9664\u7f51\u6865/#1","text":"1.\u505c\u7528\u7f51\u6865 ip link set down <bridge> 2.\u5220\u9664\u7f51\u6865\u7684\u914d\u7f6e\u6587\u4ef6 rm -f ifcfg-<bridge> 3.\u5220\u9664\u7f51\u6865 # \u67e5\u770b\u7f51\u6865 brctl show # \u5220\u9664\u7f51\u6865 brctl delbr <bridge> 4.\u91cd\u542f\u7f51\u7edc\u670d\u52a1 systemctl restart network","title":"1. \u5220\u9664\u7f51\u6865"},{"location":"linux/\u5f00\u542f\u56fe\u5f62\u754c\u9762/","text":"1. \u5b89\u88c5\u56fe\u5f62\u754c\u9762 \u00b6 yum groupinstall \"GNOME Desktop\" \"Graphical Administration Tools\" 2. \u8bbe\u7f6e\u6587\u672c\u754c\u9762 \u00b6 systemctl set-default multi-user.target \u6216 ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target 3. \u8bbe\u7f6e\u56fe\u5f62\u754c\u9762 \u00b6 systemctl set-default graphical.target","title":"\u5f00\u542f\u56fe\u5f62\u754c\u9762"},{"location":"linux/\u5f00\u542f\u56fe\u5f62\u754c\u9762/#1","text":"yum groupinstall \"GNOME Desktop\" \"Graphical Administration Tools\"","title":"1. \u5b89\u88c5\u56fe\u5f62\u754c\u9762"},{"location":"linux/\u5f00\u542f\u56fe\u5f62\u754c\u9762/#2","text":"systemctl set-default multi-user.target \u6216 ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target","title":"2. \u8bbe\u7f6e\u6587\u672c\u754c\u9762"},{"location":"linux/\u5f00\u542f\u56fe\u5f62\u754c\u9762/#3","text":"systemctl set-default graphical.target","title":"3. \u8bbe\u7f6e\u56fe\u5f62\u754c\u9762"},{"location":"linux/\u6539\u53d8\u7cfb\u7edf\u65f6\u533a/","text":"mv /etc/localtime /etc/localtime.bak ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime","title":"\u6539\u53d8\u7cfb\u7edf\u65f6\u533a"},{"location":"linux/\u6587\u672c\u5b89\u88c5\u65f6\u78c1\u76d8\u53ef\u9009/","text":"\u81ea\u52a8\u5316\u5b89\u88c5 centos7 \u65f6\uff0c\u5982\u679c\u6709\u591a\u4e2a\u78c1\u76d8\u5b58\u5728\uff0c\u4f1a\u81ea\u52a8\u5730\u628a\u7cfb\u7edf\u88c5\u5728\u591a\u4e2a\u78c1\u76d8\u4e0a\u9762\uff0c\u6b64\u65f6\u5165\u80a1\u9700\u8981\u624b\u52a8\u9009\u62e9\u78c1\u76d8\uff0c\u5219\u9700\u8981\u5728 .cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u4ee5\u4e0b\u8bed\u53e5\uff1a #\u4ea4\u4e92\u5f0f\u7684\u9009\u62e9\u78c1\u76d8 #ignoredisk --only-use=sda ignoredisk --interactive #\u6ce8\u91ca\u6389\u81ea\u52a8\u5206\u533a #autopart --type=lvm \u4fee\u6539\u5b8c\u6210\u540e\uff0c\u5b89\u88c5\u65f6\u4f1a\u51fa\u73b0\u4e00\u4e2abug\uff0c\u5c31\u662f\u9009\u62e9\u5b8c\u78c1\u76d8\u4e4b\u540e\uff0c\u4f1a\u51fa\u73b0 \u8f6f\u4ef6\u9009\u62e9\u65e0\u6cd5\u68c0\u6d4b \u7684\u60c5\u51b5\u3002\u6b64\u65f6\u9700\u8981\u91cd\u65b0\u9009\u62e9\u5b89\u88c5\u6e90\u6216\u8f6f\u4ef6\u9009\u62e9\u6216\u6267\u884c\u5237\u65b0\u64cd\u4f5c\uff0c\u603b\u4e4b\u5c31\u662f\u8981\u5168\u90e8\u9009\u62e9\u624d\u53ef\u4ee5\u7ee7\u7eed\u5b89\u88c5\u3002 1.\u6b64\u65f6\u5c31\u9700\u8981 \u91cd\u65b0\u9009\u62e9\u5b89\u88c5\u6e90 \uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a 2.\u9009\u62e9\u4e4b\u540e\uff0c\u6267\u884c\u5237\u65b0\u64cd\u4f5c\uff1a 3.\u5237\u65b0\u4e4b\u540e\u53d8\u4e3a\u4e0b\u56fe\u6240\u793a\uff0c\u9009\u62e9\u8f6f\u4ef6\u4e4b\u540e\u7ee7\u7eed\uff1a 4.\u7136\u540e\u53ef\u80fd\u4f1a\u53d8\u4e3a\u4e0b\u56fe\u6240\u793a\uff0c\u6b64\u65f6\u7ee7\u7eed\u5237\u65b0\uff0c\u76f4\u5230\u4e24\u8005\u90fd\u9009\u4e2d\u4e3a\u6b62\uff1a","title":"\u6587\u672c\u5b89\u88c5\u65f6\u78c1\u76d8\u53ef\u9009"},{"location":"linux/\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5/","text":"1. lsof \u00b6 \u9700\u8981\u5148\u5b89\u88c5\u518d\u4f7f\u7528\uff1a $ yum install -y lsof \u67e5\u770b\uff1a $ [ root@centos7 ~ ] # lsof -i:3306 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME mysqld 6824 mysql 31u IPv6 39058 0t0 TCP *:mysql ( LISTEN ) \u66f4\u591a\u547d\u4ee4\uff1a lsof - i : 8080 \uff1a\u67e5\u770b 8080 \u7aef\u53e3\u5360\u7528 lsof abc . txt \uff1a\u663e\u793a\u5f00\u542f\u6587\u4ef6 abc . txt\u7684\u8fdb\u7a0b lsof - c abc \uff1a\u663e\u793a abc\u8fdb\u7a0b\u73b0\u5728\u6253\u5f00\u7684\u6587\u4ef6 lsof - c - p 1234 \uff1a\u5217\u51fa\u8fdb\u7a0b\u53f7\u4e3a 1234 \u7684\u8fdb\u7a0b\u6240\u6253\u5f00\u7684\u6587\u4ef6 lsof - g gid \uff1a\u663e\u793a\u5f52\u5c5e gid\u7684\u8fdb\u7a0b\u60c5\u51b5 lsof + d / usr / local / \uff1a\u663e\u793a\u76ee\u5f55\u4e0b\u88ab\u8fdb\u7a0b\u5f00\u542f\u7684\u6587\u4ef6 lsof + D / usr / local / \uff1a\u540c\u4e0a\uff0c\u4f46\u662f\u4f1a\u641c\u7d22\u76ee\u5f55\u4e0b\u7684\u76ee\u5f55\uff0c\u65f6\u95f4\u8f83\u957f lsof - d 4 \uff1a\u663e\u793a\u4f7f\u7528 fd\u4e3a4\u7684\u8fdb\u7a0b lsof - i - U \uff1a\u663e\u793a\u6240\u6709\u6253\u5f00\u7684\u7aef\u53e3\u548c UNIX domain\u6587\u4ef6 2. netstat \u00b6 netstat -tunlp | grep \u7aef\u53e3\u53f7 -t (tcp) \u4ec5\u663e\u793atcp\u76f8\u5173\u9009\u9879 -u (udp)\u4ec5\u663e\u793audp\u76f8\u5173\u9009\u9879 -n \u62d2\u7edd\u663e\u793a\u522b\u540d\uff0c\u80fd\u663e\u793a\u6570\u5b57\u7684\u5168\u90e8\u8f6c\u5316\u4e3a\u6570\u5b57 -l \u4ec5\u5217\u51fa\u5728Listen(\u76d1\u542c)\u7684\u670d\u52a1\u72b6\u6001 -p \u663e\u793a\u5efa\u7acb\u76f8\u5173\u94fe\u63a5\u7684\u7a0b\u5e8f\u540d","title":"\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5"},{"location":"linux/\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5/#1-lsof","text":"\u9700\u8981\u5148\u5b89\u88c5\u518d\u4f7f\u7528\uff1a $ yum install -y lsof \u67e5\u770b\uff1a $ [ root@centos7 ~ ] # lsof -i:3306 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME mysqld 6824 mysql 31u IPv6 39058 0t0 TCP *:mysql ( LISTEN ) \u66f4\u591a\u547d\u4ee4\uff1a lsof - i : 8080 \uff1a\u67e5\u770b 8080 \u7aef\u53e3\u5360\u7528 lsof abc . txt \uff1a\u663e\u793a\u5f00\u542f\u6587\u4ef6 abc . txt\u7684\u8fdb\u7a0b lsof - c abc \uff1a\u663e\u793a abc\u8fdb\u7a0b\u73b0\u5728\u6253\u5f00\u7684\u6587\u4ef6 lsof - c - p 1234 \uff1a\u5217\u51fa\u8fdb\u7a0b\u53f7\u4e3a 1234 \u7684\u8fdb\u7a0b\u6240\u6253\u5f00\u7684\u6587\u4ef6 lsof - g gid \uff1a\u663e\u793a\u5f52\u5c5e gid\u7684\u8fdb\u7a0b\u60c5\u51b5 lsof + d / usr / local / \uff1a\u663e\u793a\u76ee\u5f55\u4e0b\u88ab\u8fdb\u7a0b\u5f00\u542f\u7684\u6587\u4ef6 lsof + D / usr / local / \uff1a\u540c\u4e0a\uff0c\u4f46\u662f\u4f1a\u641c\u7d22\u76ee\u5f55\u4e0b\u7684\u76ee\u5f55\uff0c\u65f6\u95f4\u8f83\u957f lsof - d 4 \uff1a\u663e\u793a\u4f7f\u7528 fd\u4e3a4\u7684\u8fdb\u7a0b lsof - i - U \uff1a\u663e\u793a\u6240\u6709\u6253\u5f00\u7684\u7aef\u53e3\u548c UNIX domain\u6587\u4ef6","title":"1. lsof"},{"location":"linux/\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5/#2-netstat","text":"netstat -tunlp | grep \u7aef\u53e3\u53f7 -t (tcp) \u4ec5\u663e\u793atcp\u76f8\u5173\u9009\u9879 -u (udp)\u4ec5\u663e\u793audp\u76f8\u5173\u9009\u9879 -n \u62d2\u7edd\u663e\u793a\u522b\u540d\uff0c\u80fd\u663e\u793a\u6570\u5b57\u7684\u5168\u90e8\u8f6c\u5316\u4e3a\u6570\u5b57 -l \u4ec5\u5217\u51fa\u5728Listen(\u76d1\u542c)\u7684\u670d\u52a1\u72b6\u6001 -p \u663e\u793a\u5efa\u7acb\u76f8\u5173\u94fe\u63a5\u7684\u7a0b\u5e8f\u540d","title":"2. netstat"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/","text":"1. VMware\u6dfb\u52a0\u65b0\u78c1\u76d8 1.1 \u4e0d\u91cd\u542f\u8bc6\u522b\u78c1\u76d8 1.2 \u67e5\u770b\u78c1\u76d8\u4fe1\u606f 2. \u76f4\u63a5\u4f7f\u7528\u78c1\u76d8 2.1 \u683c\u5f0f\u5316\u78c1\u76d8 2.2 \u6302\u8f7d\u78c1\u76d8 3. \u78c1\u76d8\u6269\u5bb9 3.1 \u5bf9\u65b0\u76d8\u8fdb\u884c\u5206\u533a 3.2 \u521b\u5efa\u7269\u7406\u5377pv 3.3 \u6269\u5bb9\u903b\u8f91\u5377 3.3.1 \u6269\u5c55\u5377\u7ec4vg 3.3.2 \u6269\u5bb9\u903b\u8f91\u5377lv 3.3.3 \u5728\u7ebf\u8c03\u6574xfs\u683c\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5927\u5c0f 3.4 \u65b0\u5efa\u903b\u8f91\u5377 3.4.1 \u65b0\u5efa\u5377\u7ec4vg 3.4.2 \u65b0\u5efa\u903b\u8f91\u5377lv 3.4.3 \u521b\u5efa\u903b\u8f91\u5377\u6c60 1. VMware\u6dfb\u52a0\u65b0\u78c1\u76d8 \u00b6 1.1 \u4e0d\u91cd\u542f\u8bc6\u522b\u78c1\u76d8 \u00b6 # \u54ea\u4e2a\u8f93\u51famptspi\uff0c\u90a3\u4e2a\u5c31\u662f\u8bc6\u522b\u78c1\u76d8\u7684host grep mpt /sys/class/scsi_host/host0/proc_name grep mpt /sys/class/scsi_host/host1/proc_name grep mpt /sys/class/scsi_host/host2/proc_name \u6216\u8005\u6267\u884c\uff1a # \u67e5\u770b\u662f\u54ea\u53f0host ll /sys/class/scsi_disk/ \u5047\u8bbe\u662fhost2\uff0c\u6700\u540e\u6267\u884c\uff1a echo \"- - -\" > /sys/class/scsi_host/host2/scan 1.2 \u67e5\u770b\u78c1\u76d8\u4fe1\u606f \u00b6 fdisk -l \u5982\u679c\u60f3\u76f4\u63a5\u4f7f\u7528\u78c1\u76d8\uff0c\u53c2\u89c1\u4e0b\u65b9\u7684 2. \u76f4\u63a5\u4f7f\u7528\u78c1\u76d8 \u5982\u679c\u60f3\u5bf9\u73b0\u6709\u78c1\u76d8\u8fdb\u884c\u6269\u5bb9\uff0c\u53c2\u89c1\u4e0b\u65b9\u7684 3. \u78c1\u76d8\u6269\u5bb9 \u3002 2. \u76f4\u63a5\u4f7f\u7528\u78c1\u76d8 \u00b6 2.1 \u683c\u5f0f\u5316\u78c1\u76d8 \u00b6 mkfs.xfs /dev/sdb 2.2 \u6302\u8f7d\u78c1\u76d8 \u00b6 # \u521b\u5efa\u6302\u8f7d\u76ee\u5f55 mkdir -p /disk/sdb # \u4e34\u65f6\u6302\u8f7d\uff0c\u91cd\u542f\u4e4b\u540e\u65e0\u6548 mount /dev/sdb /disk/sdb/ # \u5728/etc/fstab\u4e2d\u6dfb\u52a0\u4e00\u884c\uff0c\u6c38\u4e45\u6709\u6548 /dev/sdb /disk/sdb xfs defaults 0 0 \u7136\u540e\u5c31\u53ef\u4ee5\u5728\u6302\u8f7d\u70b9\u8fdb\u884c\u6587\u4ef6\u64cd\u4f5c\u4e86\u3002 3. \u78c1\u76d8\u6269\u5bb9 \u00b6 3.1 \u5bf9\u65b0\u76d8\u8fdb\u884c\u5206\u533a \u00b6 \u8fd9\u91cc\u6700\u597d\u4f7f\u7528 gdisk \u6765\u8fdb\u884c\u5206\u533a\u64cd\u4f5c\u3002 fdisk /dev/sdb 3.2 \u521b\u5efa\u7269\u7406\u5377pv \u00b6 pvcreate /dev/sdb1 \u67e5\u770b\u521b\u5efa\u7684\u7269\u7406\u5377 pvdisplay \u81f3\u6b64\uff0c\u6709\u4ee5\u4e0b \u6269\u5bb9\u903b\u8f91\u5377 \u548c \u65b0\u5efa\u903b\u8f91\u5377 \u4e24\u79cd\u64cd\u4f5c\u3002 3.3 \u6269\u5bb9\u903b\u8f91\u5377 \u00b6 3.3.1 \u6269\u5c55\u5377\u7ec4vg \u00b6 # \u5217\u51fa\u5b58\u5728\u7684\u5377\u7ec4\uff0c\u627e\u5230\u5377\u7ec4\u540d vgdisplay # \u5c06pv\u6dfb\u52a0\u5230\u8981\u6269\u5c55\u903b\u8f91\u5377\u6240\u5728\u7684\u5377\u7ec4 # cl:\u8981\u6269\u5c55\u7684\u5377\u7ec4\u540d vgextend cl /dev/sdb1 vgextend \u53ef\u80fd\u4f1a\u62a5\u51fa Couldn't create temporary archive name \u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u539f\u6765\u7684\u903b\u8f91\u5377\u5b9e\u5728\u592a\u5c0f\u4e86\uff0c\u6b64\u65f6\u9700\u8981\u5220\u9664\u4e00\u4e9b\u4e1c\u897f\u5373\u53ef\u7ee7\u7eed\u6269\u5bb9\u3002 \u5982\u679c\u53d1\u73b0\u6269\u5c55\u5377\u7ec4\u65f6\u9519\u8bef\u5730\u5c06\u7269\u7406\u5377pv\u6269\u5c55\u5230\u4e86\u5176\u4ed6\u5377\u7ec4vg\u4e0a\uff0c\u6b64\u65f6\u53ef\u6267\u884c vgreduce <VolumeGroupName> /dev/sbd1 \u5c06\u5176\u79fb\u9664\uff0c\u7136\u540e\u518d\u4ece\u65b0\u6269\u5c55\u3002 vgreduce - Remove physical volume(s) from a volume group vgremove - Remove volume group(s) 3.3.2 \u6269\u5bb9\u903b\u8f91\u5377lv \u00b6 # /dev/mapper/cl-root\u662f\u8981\u6269\u5c55\u903b\u8f91\u5377 lvextend \u2013L +15G /dev/mapper/cl-root \u5982\u679c\u51fa\u73b0\u4e86 couldn't create temporary archive name. \u7684\u9519\u8bef\uff0c\u90a3\u4e48\u662f\u78c1\u76d8\u7a7a\u95f4\u88ab\u586b\u6ee1\u4e86\uff0c\u6b64\u65f6\u5220\u9664\u4e00\u4e9b\u6587\u4ef6\u5373\u53ef\u3002 3.3.3 \u5728\u7ebf\u8c03\u6574xfs\u683c\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5927\u5c0f \u00b6 \u6b64\u65f6\u901a\u8fc7 df -h \u8fd8\u4e0d\u80fd\u770b\u5230\u6269\u5145\u7684\u5bb9\u91cf\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef\uff1a xfs_growfs /dev/mapper/cl-root df -h 3.4 \u65b0\u5efa\u903b\u8f91\u5377 \u00b6 3.4.1 \u65b0\u5efa\u5377\u7ec4vg \u00b6 vgcreate bc /dev/sdb1 3.4.2 \u65b0\u5efa\u903b\u8f91\u5377lv \u00b6 \u76f4\u63a5\u65b0\u5efa\u903b\u8f91\u5377\uff0c\u4e0d\u521b\u5efa\u903b\u8f91\u5377\u6c60\u3002 lvcreate 8G bc -n bc_lv1 3.4.3 \u521b\u5efa\u903b\u8f91\u5377\u6c60 \u00b6 \u53c2\u8003\uff1a \u521b\u5efa\u7cbe\u7b80\u5206\u914d\u7684\u903b\u8f91\u5377\u53ca\u6269\u5bb9","title":"\u78c1\u76d8\u5bb9\u91cf\u6269\u5145"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#1-vmware","text":"","title":"1. VMware\u6dfb\u52a0\u65b0\u78c1\u76d8"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#11","text":"# \u54ea\u4e2a\u8f93\u51famptspi\uff0c\u90a3\u4e2a\u5c31\u662f\u8bc6\u522b\u78c1\u76d8\u7684host grep mpt /sys/class/scsi_host/host0/proc_name grep mpt /sys/class/scsi_host/host1/proc_name grep mpt /sys/class/scsi_host/host2/proc_name \u6216\u8005\u6267\u884c\uff1a # \u67e5\u770b\u662f\u54ea\u53f0host ll /sys/class/scsi_disk/ \u5047\u8bbe\u662fhost2\uff0c\u6700\u540e\u6267\u884c\uff1a echo \"- - -\" > /sys/class/scsi_host/host2/scan","title":"1.1 \u4e0d\u91cd\u542f\u8bc6\u522b\u78c1\u76d8"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#12","text":"fdisk -l \u5982\u679c\u60f3\u76f4\u63a5\u4f7f\u7528\u78c1\u76d8\uff0c\u53c2\u89c1\u4e0b\u65b9\u7684 2. \u76f4\u63a5\u4f7f\u7528\u78c1\u76d8 \u5982\u679c\u60f3\u5bf9\u73b0\u6709\u78c1\u76d8\u8fdb\u884c\u6269\u5bb9\uff0c\u53c2\u89c1\u4e0b\u65b9\u7684 3. \u78c1\u76d8\u6269\u5bb9 \u3002","title":"1.2 \u67e5\u770b\u78c1\u76d8\u4fe1\u606f"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#2","text":"","title":"2. \u76f4\u63a5\u4f7f\u7528\u78c1\u76d8"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#21","text":"mkfs.xfs /dev/sdb","title":"2.1 \u683c\u5f0f\u5316\u78c1\u76d8"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#22","text":"# \u521b\u5efa\u6302\u8f7d\u76ee\u5f55 mkdir -p /disk/sdb # \u4e34\u65f6\u6302\u8f7d\uff0c\u91cd\u542f\u4e4b\u540e\u65e0\u6548 mount /dev/sdb /disk/sdb/ # \u5728/etc/fstab\u4e2d\u6dfb\u52a0\u4e00\u884c\uff0c\u6c38\u4e45\u6709\u6548 /dev/sdb /disk/sdb xfs defaults 0 0 \u7136\u540e\u5c31\u53ef\u4ee5\u5728\u6302\u8f7d\u70b9\u8fdb\u884c\u6587\u4ef6\u64cd\u4f5c\u4e86\u3002","title":"2.2 \u6302\u8f7d\u78c1\u76d8"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#3","text":"","title":"3. \u78c1\u76d8\u6269\u5bb9"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#31","text":"\u8fd9\u91cc\u6700\u597d\u4f7f\u7528 gdisk \u6765\u8fdb\u884c\u5206\u533a\u64cd\u4f5c\u3002 fdisk /dev/sdb","title":"3.1 \u5bf9\u65b0\u76d8\u8fdb\u884c\u5206\u533a"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#32-pv","text":"pvcreate /dev/sdb1 \u67e5\u770b\u521b\u5efa\u7684\u7269\u7406\u5377 pvdisplay \u81f3\u6b64\uff0c\u6709\u4ee5\u4e0b \u6269\u5bb9\u903b\u8f91\u5377 \u548c \u65b0\u5efa\u903b\u8f91\u5377 \u4e24\u79cd\u64cd\u4f5c\u3002","title":"3.2 \u521b\u5efa\u7269\u7406\u5377pv"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#33","text":"","title":"3.3 \u6269\u5bb9\u903b\u8f91\u5377"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#331-vg","text":"# \u5217\u51fa\u5b58\u5728\u7684\u5377\u7ec4\uff0c\u627e\u5230\u5377\u7ec4\u540d vgdisplay # \u5c06pv\u6dfb\u52a0\u5230\u8981\u6269\u5c55\u903b\u8f91\u5377\u6240\u5728\u7684\u5377\u7ec4 # cl:\u8981\u6269\u5c55\u7684\u5377\u7ec4\u540d vgextend cl /dev/sdb1 vgextend \u53ef\u80fd\u4f1a\u62a5\u51fa Couldn't create temporary archive name \u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u539f\u6765\u7684\u903b\u8f91\u5377\u5b9e\u5728\u592a\u5c0f\u4e86\uff0c\u6b64\u65f6\u9700\u8981\u5220\u9664\u4e00\u4e9b\u4e1c\u897f\u5373\u53ef\u7ee7\u7eed\u6269\u5bb9\u3002 \u5982\u679c\u53d1\u73b0\u6269\u5c55\u5377\u7ec4\u65f6\u9519\u8bef\u5730\u5c06\u7269\u7406\u5377pv\u6269\u5c55\u5230\u4e86\u5176\u4ed6\u5377\u7ec4vg\u4e0a\uff0c\u6b64\u65f6\u53ef\u6267\u884c vgreduce <VolumeGroupName> /dev/sbd1 \u5c06\u5176\u79fb\u9664\uff0c\u7136\u540e\u518d\u4ece\u65b0\u6269\u5c55\u3002 vgreduce - Remove physical volume(s) from a volume group vgremove - Remove volume group(s)","title":"3.3.1 \u6269\u5c55\u5377\u7ec4vg"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#332-lv","text":"# /dev/mapper/cl-root\u662f\u8981\u6269\u5c55\u903b\u8f91\u5377 lvextend \u2013L +15G /dev/mapper/cl-root \u5982\u679c\u51fa\u73b0\u4e86 couldn't create temporary archive name. \u7684\u9519\u8bef\uff0c\u90a3\u4e48\u662f\u78c1\u76d8\u7a7a\u95f4\u88ab\u586b\u6ee1\u4e86\uff0c\u6b64\u65f6\u5220\u9664\u4e00\u4e9b\u6587\u4ef6\u5373\u53ef\u3002","title":"3.3.2 \u6269\u5bb9\u903b\u8f91\u5377lv"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#333-xfs","text":"\u6b64\u65f6\u901a\u8fc7 df -h \u8fd8\u4e0d\u80fd\u770b\u5230\u6269\u5145\u7684\u5bb9\u91cf\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef\uff1a xfs_growfs /dev/mapper/cl-root df -h","title":"3.3.3 \u5728\u7ebf\u8c03\u6574xfs\u683c\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5927\u5c0f"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#34","text":"","title":"3.4 \u65b0\u5efa\u903b\u8f91\u5377"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#341-vg","text":"vgcreate bc /dev/sdb1","title":"3.4.1 \u65b0\u5efa\u5377\u7ec4vg"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#342-lv","text":"\u76f4\u63a5\u65b0\u5efa\u903b\u8f91\u5377\uff0c\u4e0d\u521b\u5efa\u903b\u8f91\u5377\u6c60\u3002 lvcreate 8G bc -n bc_lv1","title":"3.4.2 \u65b0\u5efa\u903b\u8f91\u5377lv"},{"location":"linux/\u78c1\u76d8\u5bb9\u91cf\u6269\u5145/#343","text":"\u53c2\u8003\uff1a \u521b\u5efa\u7cbe\u7b80\u5206\u914d\u7684\u903b\u8f91\u5377\u53ca\u6269\u5bb9","title":"3.4.3 \u521b\u5efa\u903b\u8f91\u5377\u6c60"},{"location":"linux/\u7f51\u5361\u4e0d\u5b58\u5728/","text":"\u5b89\u88c5\u5b8c\u4e00\u4e2acentos\u865a\u62df\u673a\uff0c\u53c8\u62f7\u8d1d\u4e00\u4efd\uff0c\u5f00\u673a\u540e\u7f51\u5361\u65e0\u6cd5\u6b63\u5e38\u542f\u52a8\uff0c\u62a5\u9519\uff1aDevice eth0 does not seem to be present, delaying initialization \u89e3\u51b3\uff1a mv /etc/sysconfig/network-scripts/ifcfg-eth0 sysconfig/network-scripts/ifcfg-eth1 vim sysconfig/network-scripts/ifcfg-eth1 \u4fee\u6539DEVICE=\"eth0\" \u4e3aDEVICE=\"eth1\" \u53ef\u5220\u6389uuid\u3001\u7269\u7406\u5730\u5740 \u7136\u540e\u91cd\u542f\u542f\u52a8\u7f51\u5361","title":"\u7f51\u5361\u4e0d\u5b58\u5728"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/","text":"1. \u533a\u522b 2. \u793a\u610f\u56fe 2.1 Soft-link 2.2 Hard-link 2.3 Symbolic-link 3. \u521b\u5efa 3.1 \u521b\u5efa\u786c\u94fe\u63a5 3.2 \u521b\u5efa\u8f6f/\u7b26\u53f7\u94fe\u63a5 4. \u76ee\u5f55\u7684\u94fe\u63a5\u6570 1. \u533a\u522b \u00b6 \u8bf4\u660e \u786c\u94fe\u63a5\uff0cLink\uff08ln\uff09 \u8f6f/\u7b26\u53f7\u94fe\u63a5\uff0cSoft/Symbolic link\uff08symlink\uff09 \u521b\u5efa \u4e0d\u80fd\u5bf9\u76ee\u5f55\u4f7f\u7528\uff0c\u4e0d\u80fd\u8de8filesystem\u3002\u4e0d\u4f1a\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e0d\u5360\u7528\u78c1\u76d8\u5bb9\u91cf\uff08\u975e\u5e38\u5c0f\uff09\uff0c\u4e0d\u5360\u7528inode\u53f7\u3001block\u53f7 \u53ef\u4ee5\u521b\u5efa\u6587\u4ef6\u5939\u6216\u6587\u4ef6\u7684\u8f6f\u94fe\u63a5\u3002\u4f1a\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4f1a\u5360\u7528\u78c1\u76d8\u5bb9\u91cf\uff0c\u4f1a\u5360\u7528inode\u53f7\u3001block\u53f7 inode 1 \u65b0\u65e7\u6587\u4ef6\u7684 inode \u53f7\u7801\u76f8\u540c \u65b0\u65e7\u6587\u4ef6\u7684 inode \u53f7\u7801\u4e0d\u540c \u6743\u9650 \u6709\u76f8\u540c\u7684\u6743\u9650 \u65b0\u6587\u4ef6\u6743\u9650\u662f lrwxrwxrwx \u94fe\u63a5\u6570 2 \u6bcf\u4e2a\u6587\u4ef6\uff08\u5305\u62ec\u4ee5\u524d\u521b\u5efa\u7684\u786c\u8fde\u63a5\u6587\u4ef6\uff09\u7684\u94fe\u63a5\u6570\u90fd\u4f1a\u52a0 1 \u65e7\u6587\u4ef6\u7684\u8fde\u63a5\u6570\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u65b0\u6587\u4ef6\u7684\u8fde\u63a5\u6570\u662f1 chmod chmod \u547d\u4ee4\u4f1a\u5bf9\u4e24\u8005\u9020\u6210\u76f8\u540c\u7684\u5f71\u54cd \u5373\u4f7f\u4f60\u4fee\u6539\u4e86\u65b0\u6587\u4ef6\u7684\u6743\u9650\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u88ab\u6539\u53d8 \u5927\u5c0f \u4e24\u8005\u6709\u76f8\u540c\u7684\u5927\u5c0f \u65b0\u6587\u4ef6\u53ea\u5305\u542b \u8def\u5f84 \u548c inode \u53f7\u7801\uff0c\u5176\u5927\u5c0f\u4e0e\u94fe\u63a5\u7684\u5b57\u7b26\u6570\u91cf\u76f8\u540c rm rm \u547d\u4ee4\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u5bf9\u65b9 \u5220\u9664\u65e7\u6587\u4ef6\u5c06\u4f7f\u65b0\u6587\u4ef6\u4e0d\u53ef\u7528 \u4fee\u6539 \u6539\u53d8\u4e00\u8005\u5c06\u4f1a\u6539\u53d8\u53e6\u4e00\u4e2a \u4e0e\u786c\u94fe\u63a5\u76f8\u540c 2. \u793a\u610f\u56fe \u00b6 2.1 Soft-link \u00b6 \u65b0\u6587\u4ef6\u7684 inode \u53f7\u7801\u6307\u5411\u65e7\u6587\u4ef6\u7684\u3002 2.2 Hard-link \u00b6 \u65b0\u65e7\u6587\u4ef6\u90fd\u6307\u5411\u540c\u4e00\u4e2a inode \u53f7\u7801\u3002 2.3 Symbolic-link \u00b6 \u5728\u4e00\u4e9bUnix/Linux\u4e2d\u7b26\u53f7\u94fe\u63a5\u548c\u8f6f\u94fe\u63a5\u88ab\u540c\u7b49\u5bf9\u5f85\u3002\u4f46\u4e0d\u540c\u5728\u4e8e\uff1a\u65b0\u65e7\u6587\u4ef6\u4f1a\u6307\u5411\u540c\u4e00\u4e2a\u65b0\u7684 inode \u53f7\u7801\u3002\u8fd9\u5b8c\u5168\u53d6\u51b3\u4e8e\u5b9e\u73b0\u3002 Note \u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u7b26\u53f7\u548c\u8f6f\u94fe\u63a5\u672f\u8bed\u53ef\u4e92\u6362\u4f7f\u7528\u3002\u4f46\u662f\u5fc5\u987b\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u4ec0\u4e48\u3002 3. \u521b\u5efa \u00b6 \u4f7f\u7528 ln \u547d\u4ee4\uff0c\u9ed8\u8ba4\u662f\u786c\u94fe\u63a5\u3002 3.1 \u521b\u5efa\u786c\u94fe\u63a5 \u00b6 $ ln src.txt dst.txt $ ll -i 10923 -rw-r--r-- 2 root root 9 Jun 4 14 :50 hard_dst.txt 10923 -rw-r--r-- 2 root root 9 Jun 4 14 :50 hard_src.txt 3.2 \u521b\u5efa\u8f6f/\u7b26\u53f7\u94fe\u63a5 \u00b6 ln -s \uff0c\u4e5f\u53ef\u4ee5\u4e3a \u6587\u4ef6\u5939 \u521b\u5efa\u8f6f\u94fe\u63a5\u3002 $ ln -s src/ dst $ ll -i 10924 lrwxrwxrwx 1 root root 4 Jun 4 14 :53 dst -> src/ 107576244 drwxr-xr-x 2 root root 6 Jun 4 14 :52 src # \u4e0e\u4e0a\u8ff0\u5199\u6cd5\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\u94fe\u63a5\u7684\u6307\u5411\u663e\u793a\u4e0d\u5e26\u201c/\u201d $ ln -s src dst $ ll -i 10924 lrwxrwxrwx 1 root root 3 Jun 4 15 :05 dst -> src 107576244 drwxr-xr-x 2 root root 6 Jun 4 15 :03 src \u5728\u6587\u4ef6\u5939\u4e2d\u7684\u6587\u4ef6\u4f1a\u5728\u4e24\u8005\u4e4b\u95f4\u540c\u6b65\u3002 \u6587\u4ef6\u5939\u7684\u8f6f\u94fe\u63a5\u7684\u5220\u9664 \u4e0e\u666e\u901a\u7684\u6587\u4ef6\u5939\u5220\u9664\u4e0d\u4e00\u6837\uff0c\u5982\u679c\u4f7f\u7528\u5e26\u6709\u659c\u6760 / \u7684\u547d\u4ee4: rm -rf dst/ \uff0c\u4e0d\u4f1a\u5220\u9664\u8be5\u94fe\u63a5\uff0c\u800c\u662f\u5220\u9664\u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002 \u6b64\u65f6\u5e94\u4f7f\u7528\u4e0d\u5e26\u6709\u659c\u6760 / \u7684\u547d\u4ee4\uff1a rm -rf dst 4. \u76ee\u5f55\u7684\u94fe\u63a5\u6570 \u00b6 \u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u4f1a\u53d1\u73b0\u5176\u94fe\u63a5\u6570\u662f 2 \uff1a [ user1@dev work-together ] $ ll -d ../work-together/ drwxrws--- 3 root projects 81 Sep 26 14 :50 ../work-together/ [ user1@dev work-together ] $ mkdir d1 [ user1@dev work-together ] $ ll -id d1 110662374 drwxrwsr-x 2 user1 projects 6 Sep 26 14 :47 d1 [ user1@dev work-together ] $ ll -d ../work-together/ drwxrws--- 4 root projects 91 Sep 26 14 :50 ../work-together/ \u8fd9\u662f\u56e0\u4e3a d1 \u4e0e d1/. \u6307\u5411\u7684\u90fd\u662f\u8be5\u76ee\u5f55\uff0c\u6240\u4ee5\u94fe\u63a5\u6570\u662f2\u3002\u540c\u7406\uff0c d1/.. \u6307\u5411\u7684 d1 \u7684\u7236\u76ee\u5f55\u4e5f\u4f1a\u589e\u52a0\u4e00\u4e2a\u94fe\u63a5\u6570\u3002 inode\u7f16\u53f7\u662f Linux/unix \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u521b\u5efa\u7684\u4efb\u4f55\u6587\u4ef6\u65f6\u751f\u6210\u7684\u552f\u4e00\u7d22\u5f15\u7f16\u53f7\u3002\u4f46\u662f\u5728\u94fe\u63a5\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e9binode\u7f16\u53f7\u662f\u7531\u6587\u4ef6\u5171\u4eab\u7684\uff0c\u5e76\u4e14\u53ea\u5728\u6587\u4ef6\u8868\u4e2d\u66f4\u65b0\u8def\u5f84\u3002\u53ef\u4ee5\u901a\u8fc7 ls -i \u67e5\u770b\uff0c\u7b2c\u4e00\u5217\u5373\u662finode\u7f16\u53f7\u3002 \u21a9 \u94fe\u63a5\u6570\u6307\u7684\u662f\u6709\u591a\u5c11\u6587\u4ef6\u540d\u94fe\u63a5\u5230\u8fd9\u4e2ainode\u3002 \u21a9","title":"\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#1","text":"\u8bf4\u660e \u786c\u94fe\u63a5\uff0cLink\uff08ln\uff09 \u8f6f/\u7b26\u53f7\u94fe\u63a5\uff0cSoft/Symbolic link\uff08symlink\uff09 \u521b\u5efa \u4e0d\u80fd\u5bf9\u76ee\u5f55\u4f7f\u7528\uff0c\u4e0d\u80fd\u8de8filesystem\u3002\u4e0d\u4f1a\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e0d\u5360\u7528\u78c1\u76d8\u5bb9\u91cf\uff08\u975e\u5e38\u5c0f\uff09\uff0c\u4e0d\u5360\u7528inode\u53f7\u3001block\u53f7 \u53ef\u4ee5\u521b\u5efa\u6587\u4ef6\u5939\u6216\u6587\u4ef6\u7684\u8f6f\u94fe\u63a5\u3002\u4f1a\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4f1a\u5360\u7528\u78c1\u76d8\u5bb9\u91cf\uff0c\u4f1a\u5360\u7528inode\u53f7\u3001block\u53f7 inode 1 \u65b0\u65e7\u6587\u4ef6\u7684 inode \u53f7\u7801\u76f8\u540c \u65b0\u65e7\u6587\u4ef6\u7684 inode \u53f7\u7801\u4e0d\u540c \u6743\u9650 \u6709\u76f8\u540c\u7684\u6743\u9650 \u65b0\u6587\u4ef6\u6743\u9650\u662f lrwxrwxrwx \u94fe\u63a5\u6570 2 \u6bcf\u4e2a\u6587\u4ef6\uff08\u5305\u62ec\u4ee5\u524d\u521b\u5efa\u7684\u786c\u8fde\u63a5\u6587\u4ef6\uff09\u7684\u94fe\u63a5\u6570\u90fd\u4f1a\u52a0 1 \u65e7\u6587\u4ef6\u7684\u8fde\u63a5\u6570\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u65b0\u6587\u4ef6\u7684\u8fde\u63a5\u6570\u662f1 chmod chmod \u547d\u4ee4\u4f1a\u5bf9\u4e24\u8005\u9020\u6210\u76f8\u540c\u7684\u5f71\u54cd \u5373\u4f7f\u4f60\u4fee\u6539\u4e86\u65b0\u6587\u4ef6\u7684\u6743\u9650\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u88ab\u6539\u53d8 \u5927\u5c0f \u4e24\u8005\u6709\u76f8\u540c\u7684\u5927\u5c0f \u65b0\u6587\u4ef6\u53ea\u5305\u542b \u8def\u5f84 \u548c inode \u53f7\u7801\uff0c\u5176\u5927\u5c0f\u4e0e\u94fe\u63a5\u7684\u5b57\u7b26\u6570\u91cf\u76f8\u540c rm rm \u547d\u4ee4\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u5bf9\u65b9 \u5220\u9664\u65e7\u6587\u4ef6\u5c06\u4f7f\u65b0\u6587\u4ef6\u4e0d\u53ef\u7528 \u4fee\u6539 \u6539\u53d8\u4e00\u8005\u5c06\u4f1a\u6539\u53d8\u53e6\u4e00\u4e2a \u4e0e\u786c\u94fe\u63a5\u76f8\u540c","title":"1. \u533a\u522b"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#2","text":"","title":"2. \u793a\u610f\u56fe"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#21-soft-link","text":"\u65b0\u6587\u4ef6\u7684 inode \u53f7\u7801\u6307\u5411\u65e7\u6587\u4ef6\u7684\u3002","title":"2.1 Soft-link"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#22-hard-link","text":"\u65b0\u65e7\u6587\u4ef6\u90fd\u6307\u5411\u540c\u4e00\u4e2a inode \u53f7\u7801\u3002","title":"2.2 Hard-link"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#23-symbolic-link","text":"\u5728\u4e00\u4e9bUnix/Linux\u4e2d\u7b26\u53f7\u94fe\u63a5\u548c\u8f6f\u94fe\u63a5\u88ab\u540c\u7b49\u5bf9\u5f85\u3002\u4f46\u4e0d\u540c\u5728\u4e8e\uff1a\u65b0\u65e7\u6587\u4ef6\u4f1a\u6307\u5411\u540c\u4e00\u4e2a\u65b0\u7684 inode \u53f7\u7801\u3002\u8fd9\u5b8c\u5168\u53d6\u51b3\u4e8e\u5b9e\u73b0\u3002 Note \u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u7b26\u53f7\u548c\u8f6f\u94fe\u63a5\u672f\u8bed\u53ef\u4e92\u6362\u4f7f\u7528\u3002\u4f46\u662f\u5fc5\u987b\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u4ec0\u4e48\u3002","title":"2.3 Symbolic-link"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#3","text":"\u4f7f\u7528 ln \u547d\u4ee4\uff0c\u9ed8\u8ba4\u662f\u786c\u94fe\u63a5\u3002","title":"3. \u521b\u5efa"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#31","text":"$ ln src.txt dst.txt $ ll -i 10923 -rw-r--r-- 2 root root 9 Jun 4 14 :50 hard_dst.txt 10923 -rw-r--r-- 2 root root 9 Jun 4 14 :50 hard_src.txt","title":"3.1 \u521b\u5efa\u786c\u94fe\u63a5"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#32","text":"ln -s \uff0c\u4e5f\u53ef\u4ee5\u4e3a \u6587\u4ef6\u5939 \u521b\u5efa\u8f6f\u94fe\u63a5\u3002 $ ln -s src/ dst $ ll -i 10924 lrwxrwxrwx 1 root root 4 Jun 4 14 :53 dst -> src/ 107576244 drwxr-xr-x 2 root root 6 Jun 4 14 :52 src # \u4e0e\u4e0a\u8ff0\u5199\u6cd5\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\u94fe\u63a5\u7684\u6307\u5411\u663e\u793a\u4e0d\u5e26\u201c/\u201d $ ln -s src dst $ ll -i 10924 lrwxrwxrwx 1 root root 3 Jun 4 15 :05 dst -> src 107576244 drwxr-xr-x 2 root root 6 Jun 4 15 :03 src \u5728\u6587\u4ef6\u5939\u4e2d\u7684\u6587\u4ef6\u4f1a\u5728\u4e24\u8005\u4e4b\u95f4\u540c\u6b65\u3002 \u6587\u4ef6\u5939\u7684\u8f6f\u94fe\u63a5\u7684\u5220\u9664 \u4e0e\u666e\u901a\u7684\u6587\u4ef6\u5939\u5220\u9664\u4e0d\u4e00\u6837\uff0c\u5982\u679c\u4f7f\u7528\u5e26\u6709\u659c\u6760 / \u7684\u547d\u4ee4: rm -rf dst/ \uff0c\u4e0d\u4f1a\u5220\u9664\u8be5\u94fe\u63a5\uff0c\u800c\u662f\u5220\u9664\u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002 \u6b64\u65f6\u5e94\u4f7f\u7528\u4e0d\u5e26\u6709\u659c\u6760 / \u7684\u547d\u4ee4\uff1a rm -rf dst","title":"3.2 \u521b\u5efa\u8f6f/\u7b26\u53f7\u94fe\u63a5"},{"location":"linux/\u8f6f\u94fe\u63a5\u4e0e\u786c\u94fe\u63a5/#4","text":"\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u4f1a\u53d1\u73b0\u5176\u94fe\u63a5\u6570\u662f 2 \uff1a [ user1@dev work-together ] $ ll -d ../work-together/ drwxrws--- 3 root projects 81 Sep 26 14 :50 ../work-together/ [ user1@dev work-together ] $ mkdir d1 [ user1@dev work-together ] $ ll -id d1 110662374 drwxrwsr-x 2 user1 projects 6 Sep 26 14 :47 d1 [ user1@dev work-together ] $ ll -d ../work-together/ drwxrws--- 4 root projects 91 Sep 26 14 :50 ../work-together/ \u8fd9\u662f\u56e0\u4e3a d1 \u4e0e d1/. \u6307\u5411\u7684\u90fd\u662f\u8be5\u76ee\u5f55\uff0c\u6240\u4ee5\u94fe\u63a5\u6570\u662f2\u3002\u540c\u7406\uff0c d1/.. \u6307\u5411\u7684 d1 \u7684\u7236\u76ee\u5f55\u4e5f\u4f1a\u589e\u52a0\u4e00\u4e2a\u94fe\u63a5\u6570\u3002 inode\u7f16\u53f7\u662f Linux/unix \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u521b\u5efa\u7684\u4efb\u4f55\u6587\u4ef6\u65f6\u751f\u6210\u7684\u552f\u4e00\u7d22\u5f15\u7f16\u53f7\u3002\u4f46\u662f\u5728\u94fe\u63a5\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e9binode\u7f16\u53f7\u662f\u7531\u6587\u4ef6\u5171\u4eab\u7684\uff0c\u5e76\u4e14\u53ea\u5728\u6587\u4ef6\u8868\u4e2d\u66f4\u65b0\u8def\u5f84\u3002\u53ef\u4ee5\u901a\u8fc7 ls -i \u67e5\u770b\uff0c\u7b2c\u4e00\u5217\u5373\u662finode\u7f16\u53f7\u3002 \u21a9 \u94fe\u63a5\u6570\u6307\u7684\u662f\u6709\u591a\u5c11\u6587\u4ef6\u540d\u94fe\u63a5\u5230\u8fd9\u4e2ainode\u3002 \u21a9","title":"4. \u76ee\u5f55\u7684\u94fe\u63a5\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/socket\u901a\u4fe1\u6d41\u7a0b/","text":"\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u51fd\u6570\u8c03\u7528\u6d41\u7a0b \u5ba2\u6237\u7aef\u53ef\u4ee5\u4e0d\u5199bind()\u51fd\u6570\u3002","title":"socket\u901a\u4fe1\u6d41\u7a0b"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/","text":"1. \u7f51\u7edc\u5b57\u8282\u5e8f\u4e0e\u4e3b\u673a\u5b57\u8282\u5e8f\u7684\u8f6c\u6362\u51fd\u6570 \u00b6 \u8fd9\u4e9b\u51fd\u6570\u53ef\u901a\u8fc7 man \u51fd\u6570\u540d \u67e5\u770b #include <arpa/inet.h> uint32_t htonl ( uint32_t hostlong ); uint16_t htons ( uint16_t hostshort ); uint32_t ntohl ( uint32_t netlong ); uint16_t ntohs ( uint16_t netshort ); h \u8868\u793a\u4e3b\u673a\uff0c n \u8868\u793a\u7f51\u7edc\uff1b l \u8868\u793along\uff0c\u5373ip\u5730\u5740\uff1b s \u8868\u793ashort\uff0c\u7aef\u53e3\u53f7\u3002 1.1 \u4e00\u6b65\u5230\u4f4d\uff1a \u00b6 #include <arpa/inet.h> //\u628a\u70b9\u5206\u5341\u8fdb\u5236\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684ip\u5730\u5740\u8f6c\u6362\u4e3a\u5b57\u8282\u5e8f\u683c\u5f0f\uff1a int inet_pton ( int af , const char * src , void * dst ); //\u8fd9\u4e2a\u51fd\u6570\u5219\u76f8\u53cd\uff1a const char * inet_ntop ( int af , const void * src , char * dst , socklen_t size ); \u53c2\u6570\u8bf4\u660e\uff1a af: AF_INET\uff08ipv4\uff09\u3001AF_INET6\uff08ipv6\uff09 src\uff1a \u6e90\u5730\u5740 dst: \u8f6c\u6362\u540e\u7684\u5b57\u8282\u5e8f 2. sockaddr\u6570\u636e\u7ed3\u6784 \u00b6 sockaddr\u662f\u8001\u7248\u672c\u7684\u7ed3\u6784\u4f53\uff0csockaddr_in\u662f\u65b0\u7248\u672c\u7684\u7ed3\u6784\u4f53\uff0c\u6784\u9020\u53c2\u6570\u7684\u65f6\u5019\u4f7f\u7528 sockaddr_in \uff0c\u4f20\u53c2\u7684\u65f6\u5019\u5f3a\u8f6c\u4e3a sockaddr \u3002 sockaddr_in\u7684\u7ed3\u6784\u4f53\uff0c\u53ef\u901a\u8fc7 man 7 ip \u67e5\u770b struct sockaddr_in { sa_family_t sin_family ; /* address family: AF_INET */ in_port_t sin_port ; /* port in network byte order */ struct in_addr sin_addr ; /* internet address */ }; /* Internet address. */ struct in_addr { uint32_t s_addr ; /* address in network byte order */ }; \u53c2\u6570\u8bf4\u660e\uff1a sin_family\uff1a ip\u5730\u5740\u534f\u8bae\u7c07 sin_port\uff1a \u7aef\u53e3\u53f7\uff0c\u901a\u8fc7\u5b57\u8282\u5e8f\u8f6c\u6362\u51fd\u6570\u8f6c\u5316 sin_addr\uff1aip\u5730\u5740\uff0c\u901a\u8fc7\u5b57\u8282\u5e8f\u8f6c\u6362\u51fd\u6570\u8f6c\u5316 3. \u51fd\u6570 \u00b6 3.1 \u5957\u63a5\u5b57\u521b\u5efa\u51fd\u6570 \u00b6 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int socket ( int domain , int type , int protocol ); \u53c2\u6570\u8bf4\u660e\uff1a domain\uff1a \u534f\u8bae\u7c07\u3002AF_INET\u3001AF_UNIX\u7b49 type\uff1a \u7c7b\u578b\u3002SOCK_STREAM\uff08\u6d41\u5f0f\u534f\u8bae\uff09\u3001SOCK_DGRAM\uff08\u62a5\u5f0f\u534f\u8bae\uff09\u7b49 protocol\uff1a \u6307\u5b9a\u7684\u534f\u8bae\uff0c\u901a\u5e38\u4f7f\u75280\u8868\u793a\u9ed8\u8ba4\u534f\u8bae\u3002TCP\u3001UDP\u7b49 \u8fd4\u56de\u503c\uff1a \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5931\u8d25\u8fd4\u56de-1\uff0c\u8bbe\u7f6eerrorno 3.2 bind\u51fd\u6570 \u00b6 int bind ( int socket , const struct sockaddr * address , socklen_t address_len ); \u53c2\u6570\u8bf4\u660e\uff1a socket\uff1a socket\u6587\u4ef6\u63cf\u8ff0\u7b26 address\uff1a \u7ed1\u5b9a\u7684ip\u548c\u7aef\u53e3\u53f7 address_len\uff1a address\u7ed3\u6784\u4f53\u7684\u957f\u5ea6 3.3 listen\u51fd\u6570 \u00b6 \u6307\u5b9a\u540c\u65f6\u5efa\u7acb\u7684\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\uff0c\u4e0d\u662f\u76d1\u542c\uff01\uff01\uff01 \u540c\u65f6\u5efa\u7acb\u8fde\u63a5\u7684\u8fde\u63a5\u3002 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int listen ( int sockfd , int backlog ); \u53c2\u6570\u8bf4\u660e\uff1a backlog: \u6570\u91cf 3.4 accept\u51fd\u6570 \u00b6 \u63a5\u6536\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int accept ( int sockfd , struct sockaddr * addr , socklen_t * addrlen ); \u53c2\u6570\u8bf4\u660e\uff1a addr\uff1a \u4f20\u51fa\u53c2\u6570\uff0c\u8c03\u7528\u540e\u4f1a\u5b58\u5165\u5ba2\u6237\u7aef\u7684\u5730\u5740 addrlen\uff1a \u4f20\u5165\u4f20\u51fa\u53c2\u6570 \u8fd4\u56de\u503c\uff1a \u65b0\u7684 socket\u6587\u4ef6\u63cf\u8ff0\u7b26 3.5 connect\u51fd\u6570 \u00b6 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int connect ( int sockfd , const struct sockaddr * addr , socklen_t addrlen ); \u53c2\u6570\u8bf4\u660e\uff1a sockfd\uff1a\u5ba2\u6237\u7aef\u7684socket addr\uff1a \u670d\u52a1\u5668\u7684\u5730\u5740 addrlen\uff1a \u957f\u5ea6","title":"\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#1","text":"\u8fd9\u4e9b\u51fd\u6570\u53ef\u901a\u8fc7 man \u51fd\u6570\u540d \u67e5\u770b #include <arpa/inet.h> uint32_t htonl ( uint32_t hostlong ); uint16_t htons ( uint16_t hostshort ); uint32_t ntohl ( uint32_t netlong ); uint16_t ntohs ( uint16_t netshort ); h \u8868\u793a\u4e3b\u673a\uff0c n \u8868\u793a\u7f51\u7edc\uff1b l \u8868\u793along\uff0c\u5373ip\u5730\u5740\uff1b s \u8868\u793ashort\uff0c\u7aef\u53e3\u53f7\u3002","title":"1. \u7f51\u7edc\u5b57\u8282\u5e8f\u4e0e\u4e3b\u673a\u5b57\u8282\u5e8f\u7684\u8f6c\u6362\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#11","text":"#include <arpa/inet.h> //\u628a\u70b9\u5206\u5341\u8fdb\u5236\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684ip\u5730\u5740\u8f6c\u6362\u4e3a\u5b57\u8282\u5e8f\u683c\u5f0f\uff1a int inet_pton ( int af , const char * src , void * dst ); //\u8fd9\u4e2a\u51fd\u6570\u5219\u76f8\u53cd\uff1a const char * inet_ntop ( int af , const void * src , char * dst , socklen_t size ); \u53c2\u6570\u8bf4\u660e\uff1a af: AF_INET\uff08ipv4\uff09\u3001AF_INET6\uff08ipv6\uff09 src\uff1a \u6e90\u5730\u5740 dst: \u8f6c\u6362\u540e\u7684\u5b57\u8282\u5e8f","title":"1.1 \u4e00\u6b65\u5230\u4f4d\uff1a"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#2-sockaddr","text":"sockaddr\u662f\u8001\u7248\u672c\u7684\u7ed3\u6784\u4f53\uff0csockaddr_in\u662f\u65b0\u7248\u672c\u7684\u7ed3\u6784\u4f53\uff0c\u6784\u9020\u53c2\u6570\u7684\u65f6\u5019\u4f7f\u7528 sockaddr_in \uff0c\u4f20\u53c2\u7684\u65f6\u5019\u5f3a\u8f6c\u4e3a sockaddr \u3002 sockaddr_in\u7684\u7ed3\u6784\u4f53\uff0c\u53ef\u901a\u8fc7 man 7 ip \u67e5\u770b struct sockaddr_in { sa_family_t sin_family ; /* address family: AF_INET */ in_port_t sin_port ; /* port in network byte order */ struct in_addr sin_addr ; /* internet address */ }; /* Internet address. */ struct in_addr { uint32_t s_addr ; /* address in network byte order */ }; \u53c2\u6570\u8bf4\u660e\uff1a sin_family\uff1a ip\u5730\u5740\u534f\u8bae\u7c07 sin_port\uff1a \u7aef\u53e3\u53f7\uff0c\u901a\u8fc7\u5b57\u8282\u5e8f\u8f6c\u6362\u51fd\u6570\u8f6c\u5316 sin_addr\uff1aip\u5730\u5740\uff0c\u901a\u8fc7\u5b57\u8282\u5e8f\u8f6c\u6362\u51fd\u6570\u8f6c\u5316","title":"2. sockaddr\u6570\u636e\u7ed3\u6784"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#3","text":"","title":"3. \u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#31","text":"#include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int socket ( int domain , int type , int protocol ); \u53c2\u6570\u8bf4\u660e\uff1a domain\uff1a \u534f\u8bae\u7c07\u3002AF_INET\u3001AF_UNIX\u7b49 type\uff1a \u7c7b\u578b\u3002SOCK_STREAM\uff08\u6d41\u5f0f\u534f\u8bae\uff09\u3001SOCK_DGRAM\uff08\u62a5\u5f0f\u534f\u8bae\uff09\u7b49 protocol\uff1a \u6307\u5b9a\u7684\u534f\u8bae\uff0c\u901a\u5e38\u4f7f\u75280\u8868\u793a\u9ed8\u8ba4\u534f\u8bae\u3002TCP\u3001UDP\u7b49 \u8fd4\u56de\u503c\uff1a \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5931\u8d25\u8fd4\u56de-1\uff0c\u8bbe\u7f6eerrorno","title":"3.1 \u5957\u63a5\u5b57\u521b\u5efa\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#32-bind","text":"int bind ( int socket , const struct sockaddr * address , socklen_t address_len ); \u53c2\u6570\u8bf4\u660e\uff1a socket\uff1a socket\u6587\u4ef6\u63cf\u8ff0\u7b26 address\uff1a \u7ed1\u5b9a\u7684ip\u548c\u7aef\u53e3\u53f7 address_len\uff1a address\u7ed3\u6784\u4f53\u7684\u957f\u5ea6","title":"3.2 bind\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#33-listen","text":"\u6307\u5b9a\u540c\u65f6\u5efa\u7acb\u7684\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\uff0c\u4e0d\u662f\u76d1\u542c\uff01\uff01\uff01 \u540c\u65f6\u5efa\u7acb\u8fde\u63a5\u7684\u8fde\u63a5\u3002 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int listen ( int sockfd , int backlog ); \u53c2\u6570\u8bf4\u660e\uff1a backlog: \u6570\u91cf","title":"3.3 listen\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#34-accept","text":"\u63a5\u6536\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5 #include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int accept ( int sockfd , struct sockaddr * addr , socklen_t * addrlen ); \u53c2\u6570\u8bf4\u660e\uff1a addr\uff1a \u4f20\u51fa\u53c2\u6570\uff0c\u8c03\u7528\u540e\u4f1a\u5b58\u5165\u5ba2\u6237\u7aef\u7684\u5730\u5740 addrlen\uff1a \u4f20\u5165\u4f20\u51fa\u53c2\u6570 \u8fd4\u56de\u503c\uff1a \u65b0\u7684 socket\u6587\u4ef6\u63cf\u8ff0\u7b26","title":"3.4 accept\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u51fd\u6570/#35-connect","text":"#include <sys/types.h> /* See NOTES */ #include <sys/socket.h> int connect ( int sockfd , const struct sockaddr * addr , socklen_t addrlen ); \u53c2\u6570\u8bf4\u660e\uff1a sockfd\uff1a\u5ba2\u6237\u7aef\u7684socket addr\uff1a \u670d\u52a1\u5668\u7684\u5730\u5740 addrlen\uff1a \u957f\u5ea6","title":"3.5 connect\u51fd\u6570"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u7b80\u5355tcp\u901a\u4fe1\u5b9e\u73b0/","text":"1. \u5934\u6587\u4ef6 \u00b6 // // Created by root on 2/2/19. // #ifndef SOCKETTOY_SERVER_H #define SOCKETTOY_SERVER_H #define SERVER_IP \"172.16.2.124\" #define SERVER_PORT 5900 #endif //SOCKETTOY_SERVER_H 2. \u5ba2\u6237\u7aef \u00b6 // // Created by root on 2/2/19. // #include <stdio.h> #include <arpa/inet.h> #include <sys/socket.h> #include <stdlib.h> #include <unistd.h> #include <memory.h> #include \"server.h\" void handle_error ( char * str ){ printf ( \"Client %s error! \\n \" , str ); exit ( 1 ); } int main ( void ){ int re ; char str_buf [ BUFSIZ ] = { \"sdsaf\" }; /* create socket */ int client_socket = socket ( AF_INET , SOCK_STREAM , 0 ); if ( client_socket == - 1 ){ handle_error ( \"create socket\" ); } /* connect */ struct sockaddr_in server_addr ; struct in_addr buf ; inet_pton ( AF_INET , SERVER_IP , & buf ); server_addr . sin_family = AF_INET ; server_addr . sin_port = htons ( SERVER_PORT ); // server_addr.sin_addr.s_addr = buf.s_addr; server_addr . sin_addr . s_addr = inet_addr ( SERVER_IP ); re = connect ( client_socket , ( struct sockaddr * ) & server_addr , sizeof ( server_addr )); if ( re == - 1 ){ handle_error ( \"connect\" ); } printf ( \"Input [exit] to exit the socket \\n \" ); while ( 1 ){ printf ( \"input your word: \" ); scanf ( \"%s\" , str_buf ); if ( memcmp ( str_buf , \"exit\" , 4 ) == 0 ){ break ; } send ( client_socket , str_buf , sizeof ( str_buf ), 0 ); recv ( client_socket , str_buf , sizeof ( str_buf ), 0 ); printf ( \"str_buf convert: %s \\n \" , str_buf ); } /* close */ ssize_t r = send ( client_socket , \"exit\" , 4 , 0 ); if ( r == - 1 ){ handle_error ( \"send\" ); } close ( client_socket ); return 0 ; } 3. \u670d\u52a1\u7aef \u00b6 // // Created by root on 2/2/19. // #include <stdio.h> #include <unistd.h> #include <sys/socket.h> #include <stdlib.h> #include <netinet/in.h> #include <arpa/inet.h> #include <ctype.h> #include <memory.h> #include <pthread.h> #include \"server.h\" void handle_error ( char * str ){ printf ( \"Server %s error! \\n \" , str ); exit ( 1 ); } int main ( void ){ int re ; /* create socket */ int server_socket = socket ( AF_INET , SOCK_STREAM , 0 ); if ( server_socket == - 1 ){ handle_error ( \"create socket\" ); } /* bind */ struct sockaddr_in server_addr ; struct in_addr buf ; inet_pton ( AF_INET , SERVER_IP , & buf ); server_addr . sin_family = AF_INET ; server_addr . sin_port = htons ( SERVER_PORT ); // server_addr.sin_addr.s_addr = buf.s_addr; server_addr . sin_addr . s_addr = htonl ( INADDR_ANY ); re = bind ( server_socket , ( struct sockaddr * ) & server_addr , sizeof ( server_addr )); if ( re != 0 ){ handle_error ( \"bind\" ); } /* listen */ //max = 128 re = listen ( server_socket , 10 ); if ( re != 0 ){ handle_error ( \"listen\" ); } /* accept */ struct sockaddr_in client_addr ; char str_buf [ BUFSIZ ]; ssize_t n ; int i ; socklen_t in_out = sizeof ( client_addr ); int client_socket = accept ( server_socket , ( struct sockaddr * ) & client_addr , & in_out ); printf ( \"Client ip: %s, port: %d. \\n \" , inet_ntoa ( client_addr . sin_addr ), ntohs ( client_addr . sin_port )); while ( 1 ){ n = recv ( client_socket , str_buf , sizeof ( str_buf ), 0 ); if ( memcmp ( str_buf , \"exit\" , 4 ) == 0 ){ break ; } for ( i = 0 ; i < n ; ++ i ){ str_buf [ i ] = toupper ( str_buf [ i ]); } send ( client_socket , str_buf , ( size_t ) n , 0 ); } /* close */ close ( client_socket ); close ( server_socket ); return 0 ; }","title":"\u7b80\u5355tcp\u901a\u4fe1\u5b9e\u73b0"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u7b80\u5355tcp\u901a\u4fe1\u5b9e\u73b0/#1","text":"// // Created by root on 2/2/19. // #ifndef SOCKETTOY_SERVER_H #define SOCKETTOY_SERVER_H #define SERVER_IP \"172.16.2.124\" #define SERVER_PORT 5900 #endif //SOCKETTOY_SERVER_H","title":"1. \u5934\u6587\u4ef6"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u7b80\u5355tcp\u901a\u4fe1\u5b9e\u73b0/#2","text":"// // Created by root on 2/2/19. // #include <stdio.h> #include <arpa/inet.h> #include <sys/socket.h> #include <stdlib.h> #include <unistd.h> #include <memory.h> #include \"server.h\" void handle_error ( char * str ){ printf ( \"Client %s error! \\n \" , str ); exit ( 1 ); } int main ( void ){ int re ; char str_buf [ BUFSIZ ] = { \"sdsaf\" }; /* create socket */ int client_socket = socket ( AF_INET , SOCK_STREAM , 0 ); if ( client_socket == - 1 ){ handle_error ( \"create socket\" ); } /* connect */ struct sockaddr_in server_addr ; struct in_addr buf ; inet_pton ( AF_INET , SERVER_IP , & buf ); server_addr . sin_family = AF_INET ; server_addr . sin_port = htons ( SERVER_PORT ); // server_addr.sin_addr.s_addr = buf.s_addr; server_addr . sin_addr . s_addr = inet_addr ( SERVER_IP ); re = connect ( client_socket , ( struct sockaddr * ) & server_addr , sizeof ( server_addr )); if ( re == - 1 ){ handle_error ( \"connect\" ); } printf ( \"Input [exit] to exit the socket \\n \" ); while ( 1 ){ printf ( \"input your word: \" ); scanf ( \"%s\" , str_buf ); if ( memcmp ( str_buf , \"exit\" , 4 ) == 0 ){ break ; } send ( client_socket , str_buf , sizeof ( str_buf ), 0 ); recv ( client_socket , str_buf , sizeof ( str_buf ), 0 ); printf ( \"str_buf convert: %s \\n \" , str_buf ); } /* close */ ssize_t r = send ( client_socket , \"exit\" , 4 , 0 ); if ( r == - 1 ){ handle_error ( \"send\" ); } close ( client_socket ); return 0 ; }","title":"2. \u5ba2\u6237\u7aef"},{"location":"linux\u7f51\u7edc\u7f16\u7a0b/\u7b80\u5355tcp\u901a\u4fe1\u5b9e\u73b0/#3","text":"// // Created by root on 2/2/19. // #include <stdio.h> #include <unistd.h> #include <sys/socket.h> #include <stdlib.h> #include <netinet/in.h> #include <arpa/inet.h> #include <ctype.h> #include <memory.h> #include <pthread.h> #include \"server.h\" void handle_error ( char * str ){ printf ( \"Server %s error! \\n \" , str ); exit ( 1 ); } int main ( void ){ int re ; /* create socket */ int server_socket = socket ( AF_INET , SOCK_STREAM , 0 ); if ( server_socket == - 1 ){ handle_error ( \"create socket\" ); } /* bind */ struct sockaddr_in server_addr ; struct in_addr buf ; inet_pton ( AF_INET , SERVER_IP , & buf ); server_addr . sin_family = AF_INET ; server_addr . sin_port = htons ( SERVER_PORT ); // server_addr.sin_addr.s_addr = buf.s_addr; server_addr . sin_addr . s_addr = htonl ( INADDR_ANY ); re = bind ( server_socket , ( struct sockaddr * ) & server_addr , sizeof ( server_addr )); if ( re != 0 ){ handle_error ( \"bind\" ); } /* listen */ //max = 128 re = listen ( server_socket , 10 ); if ( re != 0 ){ handle_error ( \"listen\" ); } /* accept */ struct sockaddr_in client_addr ; char str_buf [ BUFSIZ ]; ssize_t n ; int i ; socklen_t in_out = sizeof ( client_addr ); int client_socket = accept ( server_socket , ( struct sockaddr * ) & client_addr , & in_out ); printf ( \"Client ip: %s, port: %d. \\n \" , inet_ntoa ( client_addr . sin_addr ), ntohs ( client_addr . sin_port )); while ( 1 ){ n = recv ( client_socket , str_buf , sizeof ( str_buf ), 0 ); if ( memcmp ( str_buf , \"exit\" , 4 ) == 0 ){ break ; } for ( i = 0 ; i < n ; ++ i ){ str_buf [ i ] = toupper ( str_buf [ i ]); } send ( client_socket , str_buf , ( size_t ) n , 0 ); } /* close */ close ( client_socket ); close ( server_socket ); return 0 ; }","title":"3. \u670d\u52a1\u7aef"},{"location":"little toys/\u6469\u65af\u8f6c\u6362/","text":"morse = { 'a' : '.-' , 'b' : '-...' , 'c' : '-.-.' , 'd' : '-..' , 'e' : '.' , 'f' : '..-.' , 'g' : '--.' , 'h' : '....' , 'i' : '..' , 'j' : '.---' , 'k' : '-.-' , 'l' : '.-..' , 'm' : '--' , 'n' : '-.' , 'o' : '---' , 'p' : '.--.' , 'q' : '--.-' , 'r' : '.-.' , 's' : '...' , 't' : '-' , 'u' : '..-' , 'v' : '...-' , 'w' : '.--' , 'x' : '-..-' , 'y' : '-.--' , 'z' : '--..' , '1' : '.----' , '2' : '..---' , '3' : '...--' , '4' : '....-' , '5' : '.....' , '6' : '-....' , '7' : '--...' , '8' : '---..' , '9' : '----.' , '0' : '-----' , '?' : '..--..' , '.' : '.-.-.-' } reverse_morse = dict () for k , v in morse . items (): reverse_morse [ v ] = k def morse2line ( line ): new_line = \"\" for string in line . split ( ' ' ): for char in string . split ( ' ' ): new_line += reverse_morse . get ( char , char ) new_line += ' ' return new_line def line2morse ( line ): new_line = \"\" for char in line : new_line += morse . get ( char , char ) new_line += \" \" return new_line def morse_translator (): if len ( sys . argv ) < 3 : print ( \"please provides a line.\" ) exit ( 1 ) opts , args = getopt . getopt ( sys . argv [ 1 :], \"lm\" ) translator = line2morse for opt , _ in opts : if opt == '-l' : translator = line2morse elif opt == '-m' : translator = morse2line else : print ( 'invalid option %s ' % opt ) exit ( 1 ) line = args [ 0 ] return translator ( line ) print ( morse_translator ()) \u4f7f\u7528\u793a\u4f8b\uff1a [ root @dev ~ ] # python test.py -l shihr ... .... .. .... .-. [ root @dev ~ ] # python test.py -m -- '... .... .. .... .-.' shihr","title":"\u6469\u65af\u8f6c\u6362"},{"location":"mybatis/XML\u914d\u7f6e/","text":"mybatis\u7684\u914d\u7f6e\u6587\u4ef6 1. \u5c5e\u6027\uff08properties\uff09 \u00b6 \u8fd9\u4e9b\u5c5e\u6027\u90fd\u662f\u53ef\u5916\u90e8\u914d\u7f6e\u4e14\u53ef\u52a8\u6001\u66ff\u6362\u7684\uff0c\u65e2\u53ef\u4ee5\u5728\u5178\u578b\u7684 Java \u5c5e\u6027\u6587\u4ef6\u4e2d\u914d\u7f6e\uff0c\u4ea6\u53ef\u901a\u8fc7 properties \u5143\u7d20\u7684\u5b50\u5143\u7d20\u6765\u4f20\u9012\u3002 <properties resource= \"org/mybatis/example/config.properties\" > <property name= \"username\" value= \"dev_user\" /> <property name= \"password\" value= \"F2Fa3!33TYyg\" /> </properties> \u7136\u540e\u5176\u4e2d\u7684\u5c5e\u6027\u5c31\u53ef\u4ee5\u5728\u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\u88ab\u7528\u6765\u66ff\u6362\u9700\u8981\u52a8\u6001\u914d\u7f6e\u7684\u5c5e\u6027\u503c\u3002\u6bd4\u5982: <dataSource type= \"POOLED\" > <property name= \"username\" value= \"${username}\" /> <property name= \"password\" value= \"${password}\" /> </dataSource> \u901a\u8fc7 \u65b9\u6cd5\u53c2\u6570\u4f20\u9012 \u7684\u5c5e\u6027\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c resource/url \u5c5e\u6027 \u4e2d\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u6b21\u4e4b\uff0c\u6700\u4f4e\u4f18\u5148\u7ea7\u7684\u662f properties \u5c5e\u6027 \u4e2d\u6307\u5b9a\u7684\u5c5e\u6027\u3002 2. \u8bbe\u7f6e\uff08settings\uff09 \u00b6 \u4f1a\u6539\u53d8 MyBatis \u7684\u8fd0\u884c\u65f6\u884c\u4e3a\u3002 \u8be6\u7ec6\u8bf4\u660e 3. \u7c7b\u578b\u522b\u540d\uff08typeAliases\uff09 \u00b6 \u7c7b\u578b\u522b\u540d\u662f\u4e3a Java \u7c7b\u578b\u8bbe\u7f6e\u4e00\u4e2a\u77ed\u7684\u540d\u5b57\u3002 \u5b83\u53ea\u548c XML \u914d\u7f6e\u6709\u5173\uff0c\u5b58\u5728\u7684\u610f\u4e49\u4ec5\u5728\u4e8e\u7528\u6765\u51cf\u5c11\u7c7b\u5b8c\u5168\u9650\u5b9a\u540d\u7684\u5197\u4f59\u3002 <typeAliases> <typeAlias alias= \"Author\" type= \"domain.blog.Author\" /> </typeAliases> \u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u540d\uff0cMyBatis \u4f1a\u5728\u5305\u540d\u4e0b\u9762\u641c\u7d22\u9700\u8981\u7684 Java Bean\uff1a <typeAliases> <package name= \"domain.blog\" /> </typeAliases> \u6bcf\u4e00\u4e2a\u5728\u5305 domain.blog \u4e2d\u7684 Java Bean\uff0c\u5728\u6ca1\u6709\u6ce8\u89e3\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4f7f\u7528 Bean \u7684\u9996\u5b57\u6bcd\u5c0f\u5199\u7684\u975e\u9650\u5b9a\u7c7b\u540d\u6765\u4f5c\u4e3a\u5b83\u7684\u522b\u540d\u3002 \u6bd4\u5982 domain.blog.Author \u7684\u522b\u540d\u4e3a author \uff1b\u82e5\u6709\u6ce8\u89e3\uff0c\u5219\u522b\u540d\u4e3a\u5176\u6ce8\u89e3\u503c\u3002 @Alias ( \"author\" ) public class Author { ... } 4. \u7c7b\u578b\u5904\u7406\u5668\uff08typeHandlers\uff09 \u00b6 \u7528\u7c7b\u578b\u5904\u7406\u5668\u5c06\u83b7\u53d6\u7684\u503c\u4ee5\u5408\u9002\u7684\u65b9\u5f0f\u8f6c\u6362\u6210 Java \u7c7b\u578b\u3002 5. \u73af\u5883\u914d\u7f6e\uff08environments\uff09 \u00b6 \u5c3d\u7ba1\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u73af\u5883\uff0c\u4f46\u6bcf\u4e2a SqlSessionFactory \u5b9e\u4f8b\u53ea\u80fd\u9009\u62e9\u4e00\u79cd\u73af\u5883\u3002 \u6bcf\u4e2a\u6570\u636e\u5e93\u5bf9\u5e94\u4e00\u4e2a\u73af\u5883\u3002 \u4e8b\u52a1\u7ba1\u7406\u5668\uff08transactionManager\uff09 JDBC \u2013 \u8fd9\u4e2a\u914d\u7f6e\u5c31\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 JDBC \u7684\u63d0\u4ea4\u548c\u56de\u6eda\u8bbe\u7f6e\uff0c\u5b83\u4f9d\u8d56\u4e8e\u4ece\u6570\u636e\u6e90\u5f97\u5230\u7684\u8fde\u63a5\u6765\u7ba1\u7406\u4e8b\u52a1\u4f5c\u7528\u57df\u3002 MANAGED \u2013 \u8fd9\u4e2a\u914d\u7f6e\u51e0\u4e4e\u6ca1\u505a\u4ec0\u4e48\u3002\u5b83\u4ece\u6765\u4e0d\u63d0\u4ea4\u6216\u56de\u6eda\u4e00\u4e2a\u8fde\u63a5\uff0c\u800c\u662f\u8ba9\u5bb9\u5668\u6765\u7ba1\u7406\u4e8b\u52a1\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\uff08\u6bd4\u5982 JEE \u5e94\u7528\u670d\u52a1\u5668\u7684\u4e0a\u4e0b\u6587\uff09\u3002 \u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 Spring + MyBatis\uff0c\u5219\u6ca1\u6709\u5fc5\u8981\u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668\uff0c \u56e0\u4e3a Spring \u6a21\u5757\u4f1a\u4f7f\u7528\u81ea\u5e26\u7684\u7ba1\u7406\u5668\u6765\u8986\u76d6\u524d\u9762\u7684\u914d\u7f6e\u3002 \u6570\u636e\u6e90\uff08dataSource\uff09 \u7c7b\u578b\uff1a UNPOOLED \u8fd9\u4e2a\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u53ea\u662f\u6bcf\u6b21\u88ab\u8bf7\u6c42\u65f6\u6253\u5f00\u548c\u5173\u95ed\u8fde\u63a5\u3002 POOLED \u8fd9\u79cd\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u5229\u7528\u201c\u6c60\u201d\u7684\u6982\u5ff5\u5c06 JDBC \u8fde\u63a5\u5bf9\u8c61\u7ec4\u7ec7\u8d77\u6765\uff0c\u907f\u514d\u4e86\u521b\u5efa\u65b0\u7684\u8fde\u63a5\u5b9e\u4f8b\u65f6\u6240\u5fc5\u9700\u7684\u521d\u59cb\u5316\u548c\u8ba4\u8bc1\u65f6\u95f4\u3002 JNDI \u8fd9\u4e2a\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u662f\u4e3a\u4e86\u80fd\u5728\u5982 EJB \u6216\u5e94\u7528\u670d\u52a1\u5668\u8fd9\u7c7b\u5bb9\u5668\u4e2d\u4f7f\u7528\uff0c\u5bb9\u5668\u53ef\u4ee5\u96c6\u4e2d\u6216\u5728\u5916\u90e8\u914d\u7f6e\u6570\u636e\u6e90\uff0c\u7136\u540e\u653e\u7f6e\u4e00\u4e2a JNDI \u4e0a\u4e0b\u6587\u7684\u5f15\u7528\u3002 6. \u6620\u5c04\u5668\uff08mappers\uff09 \u00b6 \u4f60\u53ef\u4ee5\u4f7f\u7528\u76f8\u5bf9\u4e8e\u7c7b\u8def\u5f84\u7684\u8d44\u6e90\u5f15\u7528\uff0c \u6216\u5b8c\u5168\u9650\u5b9a\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff08\u5305\u62ec file:/// \u7684 URL\uff09\uff0c\u6216\u7c7b\u540d\u548c\u5305\u540d\u7b49\u3002\u4f8b\u5982\uff1a <mappers> <!-- \u4f7f\u7528\u76f8\u5bf9\u4e8e\u7c7b\u8def\u5f84\u7684\u8d44\u6e90\u5f15\u7528 --> <mapper resource= \"org/mybatis/builder/AuthorMapper.xml\" /> <!-- \u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff08URL\uff09 --> <mapper url= \"file:///var/mappers/AuthorMapper.xml\" /> <!-- \u4f7f\u7528\u6620\u5c04\u5668\u63a5\u53e3\u5b9e\u73b0\u7c7b\u7684\u5b8c\u5168\u9650\u5b9a\u7c7b\u540d --> <mapper class= \"org.mybatis.builder.AuthorMapper\" /> <!-- \u5c06\u5305\u5185\u7684\u6620\u5c04\u5668\u63a5\u53e3\u5b9e\u73b0\u5168\u90e8\u6ce8\u518c\u4e3a\u6620\u5c04\u5668 --> <package name= \"org.mybatis.builder\" /> </mappers>","title":"XML\u914d\u7f6e.md"},{"location":"mybatis/XML\u914d\u7f6e/#1-properties","text":"\u8fd9\u4e9b\u5c5e\u6027\u90fd\u662f\u53ef\u5916\u90e8\u914d\u7f6e\u4e14\u53ef\u52a8\u6001\u66ff\u6362\u7684\uff0c\u65e2\u53ef\u4ee5\u5728\u5178\u578b\u7684 Java \u5c5e\u6027\u6587\u4ef6\u4e2d\u914d\u7f6e\uff0c\u4ea6\u53ef\u901a\u8fc7 properties \u5143\u7d20\u7684\u5b50\u5143\u7d20\u6765\u4f20\u9012\u3002 <properties resource= \"org/mybatis/example/config.properties\" > <property name= \"username\" value= \"dev_user\" /> <property name= \"password\" value= \"F2Fa3!33TYyg\" /> </properties> \u7136\u540e\u5176\u4e2d\u7684\u5c5e\u6027\u5c31\u53ef\u4ee5\u5728\u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\u88ab\u7528\u6765\u66ff\u6362\u9700\u8981\u52a8\u6001\u914d\u7f6e\u7684\u5c5e\u6027\u503c\u3002\u6bd4\u5982: <dataSource type= \"POOLED\" > <property name= \"username\" value= \"${username}\" /> <property name= \"password\" value= \"${password}\" /> </dataSource> \u901a\u8fc7 \u65b9\u6cd5\u53c2\u6570\u4f20\u9012 \u7684\u5c5e\u6027\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c resource/url \u5c5e\u6027 \u4e2d\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u6b21\u4e4b\uff0c\u6700\u4f4e\u4f18\u5148\u7ea7\u7684\u662f properties \u5c5e\u6027 \u4e2d\u6307\u5b9a\u7684\u5c5e\u6027\u3002","title":"1. \u5c5e\u6027\uff08properties\uff09"},{"location":"mybatis/XML\u914d\u7f6e/#2-settings","text":"\u4f1a\u6539\u53d8 MyBatis \u7684\u8fd0\u884c\u65f6\u884c\u4e3a\u3002 \u8be6\u7ec6\u8bf4\u660e","title":"2. \u8bbe\u7f6e\uff08settings\uff09"},{"location":"mybatis/XML\u914d\u7f6e/#3-typealiases","text":"\u7c7b\u578b\u522b\u540d\u662f\u4e3a Java \u7c7b\u578b\u8bbe\u7f6e\u4e00\u4e2a\u77ed\u7684\u540d\u5b57\u3002 \u5b83\u53ea\u548c XML \u914d\u7f6e\u6709\u5173\uff0c\u5b58\u5728\u7684\u610f\u4e49\u4ec5\u5728\u4e8e\u7528\u6765\u51cf\u5c11\u7c7b\u5b8c\u5168\u9650\u5b9a\u540d\u7684\u5197\u4f59\u3002 <typeAliases> <typeAlias alias= \"Author\" type= \"domain.blog.Author\" /> </typeAliases> \u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5305\u540d\uff0cMyBatis \u4f1a\u5728\u5305\u540d\u4e0b\u9762\u641c\u7d22\u9700\u8981\u7684 Java Bean\uff1a <typeAliases> <package name= \"domain.blog\" /> </typeAliases> \u6bcf\u4e00\u4e2a\u5728\u5305 domain.blog \u4e2d\u7684 Java Bean\uff0c\u5728\u6ca1\u6709\u6ce8\u89e3\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4f7f\u7528 Bean \u7684\u9996\u5b57\u6bcd\u5c0f\u5199\u7684\u975e\u9650\u5b9a\u7c7b\u540d\u6765\u4f5c\u4e3a\u5b83\u7684\u522b\u540d\u3002 \u6bd4\u5982 domain.blog.Author \u7684\u522b\u540d\u4e3a author \uff1b\u82e5\u6709\u6ce8\u89e3\uff0c\u5219\u522b\u540d\u4e3a\u5176\u6ce8\u89e3\u503c\u3002 @Alias ( \"author\" ) public class Author { ... }","title":"3. \u7c7b\u578b\u522b\u540d\uff08typeAliases\uff09"},{"location":"mybatis/XML\u914d\u7f6e/#4-typehandlers","text":"\u7528\u7c7b\u578b\u5904\u7406\u5668\u5c06\u83b7\u53d6\u7684\u503c\u4ee5\u5408\u9002\u7684\u65b9\u5f0f\u8f6c\u6362\u6210 Java \u7c7b\u578b\u3002","title":"4. \u7c7b\u578b\u5904\u7406\u5668\uff08typeHandlers\uff09"},{"location":"mybatis/XML\u914d\u7f6e/#5-environments","text":"\u5c3d\u7ba1\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\u73af\u5883\uff0c\u4f46\u6bcf\u4e2a SqlSessionFactory \u5b9e\u4f8b\u53ea\u80fd\u9009\u62e9\u4e00\u79cd\u73af\u5883\u3002 \u6bcf\u4e2a\u6570\u636e\u5e93\u5bf9\u5e94\u4e00\u4e2a\u73af\u5883\u3002 \u4e8b\u52a1\u7ba1\u7406\u5668\uff08transactionManager\uff09 JDBC \u2013 \u8fd9\u4e2a\u914d\u7f6e\u5c31\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 JDBC \u7684\u63d0\u4ea4\u548c\u56de\u6eda\u8bbe\u7f6e\uff0c\u5b83\u4f9d\u8d56\u4e8e\u4ece\u6570\u636e\u6e90\u5f97\u5230\u7684\u8fde\u63a5\u6765\u7ba1\u7406\u4e8b\u52a1\u4f5c\u7528\u57df\u3002 MANAGED \u2013 \u8fd9\u4e2a\u914d\u7f6e\u51e0\u4e4e\u6ca1\u505a\u4ec0\u4e48\u3002\u5b83\u4ece\u6765\u4e0d\u63d0\u4ea4\u6216\u56de\u6eda\u4e00\u4e2a\u8fde\u63a5\uff0c\u800c\u662f\u8ba9\u5bb9\u5668\u6765\u7ba1\u7406\u4e8b\u52a1\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\uff08\u6bd4\u5982 JEE \u5e94\u7528\u670d\u52a1\u5668\u7684\u4e0a\u4e0b\u6587\uff09\u3002 \u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 Spring + MyBatis\uff0c\u5219\u6ca1\u6709\u5fc5\u8981\u914d\u7f6e\u4e8b\u52a1\u7ba1\u7406\u5668\uff0c \u56e0\u4e3a Spring \u6a21\u5757\u4f1a\u4f7f\u7528\u81ea\u5e26\u7684\u7ba1\u7406\u5668\u6765\u8986\u76d6\u524d\u9762\u7684\u914d\u7f6e\u3002 \u6570\u636e\u6e90\uff08dataSource\uff09 \u7c7b\u578b\uff1a UNPOOLED \u8fd9\u4e2a\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u53ea\u662f\u6bcf\u6b21\u88ab\u8bf7\u6c42\u65f6\u6253\u5f00\u548c\u5173\u95ed\u8fde\u63a5\u3002 POOLED \u8fd9\u79cd\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u5229\u7528\u201c\u6c60\u201d\u7684\u6982\u5ff5\u5c06 JDBC \u8fde\u63a5\u5bf9\u8c61\u7ec4\u7ec7\u8d77\u6765\uff0c\u907f\u514d\u4e86\u521b\u5efa\u65b0\u7684\u8fde\u63a5\u5b9e\u4f8b\u65f6\u6240\u5fc5\u9700\u7684\u521d\u59cb\u5316\u548c\u8ba4\u8bc1\u65f6\u95f4\u3002 JNDI \u8fd9\u4e2a\u6570\u636e\u6e90\u7684\u5b9e\u73b0\u662f\u4e3a\u4e86\u80fd\u5728\u5982 EJB \u6216\u5e94\u7528\u670d\u52a1\u5668\u8fd9\u7c7b\u5bb9\u5668\u4e2d\u4f7f\u7528\uff0c\u5bb9\u5668\u53ef\u4ee5\u96c6\u4e2d\u6216\u5728\u5916\u90e8\u914d\u7f6e\u6570\u636e\u6e90\uff0c\u7136\u540e\u653e\u7f6e\u4e00\u4e2a JNDI \u4e0a\u4e0b\u6587\u7684\u5f15\u7528\u3002","title":"5. \u73af\u5883\u914d\u7f6e\uff08environments\uff09"},{"location":"mybatis/XML\u914d\u7f6e/#6-mappers","text":"\u4f60\u53ef\u4ee5\u4f7f\u7528\u76f8\u5bf9\u4e8e\u7c7b\u8def\u5f84\u7684\u8d44\u6e90\u5f15\u7528\uff0c \u6216\u5b8c\u5168\u9650\u5b9a\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff08\u5305\u62ec file:/// \u7684 URL\uff09\uff0c\u6216\u7c7b\u540d\u548c\u5305\u540d\u7b49\u3002\u4f8b\u5982\uff1a <mappers> <!-- \u4f7f\u7528\u76f8\u5bf9\u4e8e\u7c7b\u8def\u5f84\u7684\u8d44\u6e90\u5f15\u7528 --> <mapper resource= \"org/mybatis/builder/AuthorMapper.xml\" /> <!-- \u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u8d44\u6e90\u5b9a\u4f4d\u7b26\uff08URL\uff09 --> <mapper url= \"file:///var/mappers/AuthorMapper.xml\" /> <!-- \u4f7f\u7528\u6620\u5c04\u5668\u63a5\u53e3\u5b9e\u73b0\u7c7b\u7684\u5b8c\u5168\u9650\u5b9a\u7c7b\u540d --> <mapper class= \"org.mybatis.builder.AuthorMapper\" /> <!-- \u5c06\u5305\u5185\u7684\u6620\u5c04\u5668\u63a5\u53e3\u5b9e\u73b0\u5168\u90e8\u6ce8\u518c\u4e3a\u6620\u5c04\u5668 --> <package name= \"org.mybatis.builder\" /> </mappers>","title":"6. \u6620\u5c04\u5668\uff08mappers\uff09"},{"location":"mybatis/\u6ce8\u610f\u4e8b\u9879/","text":"1. \u591a\u53c2\u4f20\u9012\u95ee\u9898 \u00b6 \u6709\u591a\u4e2a\u53c2\u6570\u4f20\u5165\u65f6\uff0c\u4e0d\u80fd\u76f4\u63a5\u6839\u636e\u53c2\u6570\u540d\u8bc6\u522b\uff0c\u8981\u53d8\u6210 arg0\u3001arg1 \u6765\u6620\u5c04\u53c2\u6570\u3002\u4e5f\u53ef\u4ee5\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u52a0\u4e0a @Param(\"\") \u6765\u5b9e\u73b0\u3002 <update id= \"updateTags\" > <include refid= \"updateBlog\" /> tags = #{arg1} WHERE id = #{arg0} </update> void updateTitle ( @Param ( \"id\" ) int id , @Param ( \"title\" ) String title ); \u53c2\u8003\u535a\u5ba2 2. \u8fd4\u56de\u66f4\u65b0\u6761\u76ee\u7684\u6570\u91cf\u95ee\u9898 \u00b6 mybatis\u53ef\u4ee5\u5728 Mapper \u4e2d\u7684\u65b9\u6cd5\u52a0\u4e0a int \u7c7b\u578b\u7684\u8fd4\u56de\u503c\u6765\u8868\u793a\u5f71\u54cd\u4e86\u591a\u5c11\u6761\u6570\u636e\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u7684 url \u52a0\u4e0a useAffectedRows=true \u53c2\u6570\u3002 jdbc.url = jdbc:mariadb://192.168.216.3:3306/blog?useAffectedRows=true 3. \u4e8b\u52a1 \u00b6 \u4e8b\u52a1\u7684\u6982\u5ff5\u53ef\u4ee5\u63cf\u8ff0\u4e3a\u5177\u6709\u4ee5\u4e0b\u56db\u4e2a\u5173\u952e\u5c5e\u6027\u8bf4\u6210\u662f ACID \uff1a \u539f\u5b50\u6027\uff1a \u4e8b\u52a1\u5e94\u8be5\u5f53\u4f5c\u4e00\u4e2a\u5355\u72ec\u5355\u5143\u7684\u64cd\u4f5c\uff0c\u8fd9\u610f\u5473\u7740\u6574\u4e2a\u5e8f\u5217\u64cd\u4f5c\u8981\u4e48\u662f\u6210\u529f\uff0c\u8981\u4e48\u662f\u5931\u8d25\u7684\u3002 \u4e00\u81f4\u6027\uff1a \u4e00\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u5c01\u88c5\u72b6\u6001\u6539\u53d8\uff08\u9664\u975e\u5b83\u662f\u4e00\u4e2a\u53ea\u8bfb\u7684\uff09\u3002\u4e8b\u52a1\u5fc5\u987b\u59cb\u7ec8\u4fdd\u6301\u7cfb\u7edf\u5904\u4e8e\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u4e0d\u7ba1\u5728\u4efb\u4f55\u7ed9\u5b9a\u7684\u65f6\u95f4\u5e76\u53d1\u4e8b\u52a1\u6709\u591a\u5c11\u3002\u5373\u5982\u679c\u4e8b\u52a1\u662f\u5e76\u53d1\u591a\u4e2a\uff0c\u7cfb\u7edf\u4e5f\u5fc5\u987b\u5982\u540c\u4e32\u884c\u4e8b\u52a1\u4e00\u6837\u64cd\u4f5c\u3002 \u9694\u79bb\u6027\uff1a \u53ef\u80fd\u540c\u65f6\u5904\u7406\u5f88\u591a\u6709\u76f8\u540c\u7684\u6570\u636e\u96c6\u7684\u4e8b\u52a1\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5e94\u8be5\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\uff0c\u4ee5\u9632\u6b62\u6570\u636e\u635f\u574f\u3002 \u6301\u4e45\u6027\uff1a \u4e00\u4e2a\u4e8b\u52a1\u4e00\u65e6\u5b8c\u6210\u5168\u90e8\u64cd\u4f5c\u540e\uff0c\u8fd9\u4e2a\u4e8b\u52a1\u7684\u7ed3\u679c\u5fc5\u987b\u662f\u6c38\u4e45\u6027\u7684\uff0c\u4e0d\u80fd\u56e0\u7cfb\u7edf\u6545\u969c\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u5220\u9664\u3002","title":"\u6ce8\u610f\u4e8b\u9879.md"},{"location":"mybatis/\u6ce8\u610f\u4e8b\u9879/#1","text":"\u6709\u591a\u4e2a\u53c2\u6570\u4f20\u5165\u65f6\uff0c\u4e0d\u80fd\u76f4\u63a5\u6839\u636e\u53c2\u6570\u540d\u8bc6\u522b\uff0c\u8981\u53d8\u6210 arg0\u3001arg1 \u6765\u6620\u5c04\u53c2\u6570\u3002\u4e5f\u53ef\u4ee5\u5728\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u52a0\u4e0a @Param(\"\") \u6765\u5b9e\u73b0\u3002 <update id= \"updateTags\" > <include refid= \"updateBlog\" /> tags = #{arg1} WHERE id = #{arg0} </update> void updateTitle ( @Param ( \"id\" ) int id , @Param ( \"title\" ) String title ); \u53c2\u8003\u535a\u5ba2","title":"1. \u591a\u53c2\u4f20\u9012\u95ee\u9898"},{"location":"mybatis/\u6ce8\u610f\u4e8b\u9879/#2","text":"mybatis\u53ef\u4ee5\u5728 Mapper \u4e2d\u7684\u65b9\u6cd5\u52a0\u4e0a int \u7c7b\u578b\u7684\u8fd4\u56de\u503c\u6765\u8868\u793a\u5f71\u54cd\u4e86\u591a\u5c11\u6761\u6570\u636e\uff0c\u9700\u8981\u5728\u6570\u636e\u5e93\u7684 url \u52a0\u4e0a useAffectedRows=true \u53c2\u6570\u3002 jdbc.url = jdbc:mariadb://192.168.216.3:3306/blog?useAffectedRows=true","title":"2. \u8fd4\u56de\u66f4\u65b0\u6761\u76ee\u7684\u6570\u91cf\u95ee\u9898"},{"location":"mybatis/\u6ce8\u610f\u4e8b\u9879/#3","text":"\u4e8b\u52a1\u7684\u6982\u5ff5\u53ef\u4ee5\u63cf\u8ff0\u4e3a\u5177\u6709\u4ee5\u4e0b\u56db\u4e2a\u5173\u952e\u5c5e\u6027\u8bf4\u6210\u662f ACID \uff1a \u539f\u5b50\u6027\uff1a \u4e8b\u52a1\u5e94\u8be5\u5f53\u4f5c\u4e00\u4e2a\u5355\u72ec\u5355\u5143\u7684\u64cd\u4f5c\uff0c\u8fd9\u610f\u5473\u7740\u6574\u4e2a\u5e8f\u5217\u64cd\u4f5c\u8981\u4e48\u662f\u6210\u529f\uff0c\u8981\u4e48\u662f\u5931\u8d25\u7684\u3002 \u4e00\u81f4\u6027\uff1a \u4e00\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u5c01\u88c5\u72b6\u6001\u6539\u53d8\uff08\u9664\u975e\u5b83\u662f\u4e00\u4e2a\u53ea\u8bfb\u7684\uff09\u3002\u4e8b\u52a1\u5fc5\u987b\u59cb\u7ec8\u4fdd\u6301\u7cfb\u7edf\u5904\u4e8e\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u4e0d\u7ba1\u5728\u4efb\u4f55\u7ed9\u5b9a\u7684\u65f6\u95f4\u5e76\u53d1\u4e8b\u52a1\u6709\u591a\u5c11\u3002\u5373\u5982\u679c\u4e8b\u52a1\u662f\u5e76\u53d1\u591a\u4e2a\uff0c\u7cfb\u7edf\u4e5f\u5fc5\u987b\u5982\u540c\u4e32\u884c\u4e8b\u52a1\u4e00\u6837\u64cd\u4f5c\u3002 \u9694\u79bb\u6027\uff1a \u53ef\u80fd\u540c\u65f6\u5904\u7406\u5f88\u591a\u6709\u76f8\u540c\u7684\u6570\u636e\u96c6\u7684\u4e8b\u52a1\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5e94\u8be5\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\uff0c\u4ee5\u9632\u6b62\u6570\u636e\u635f\u574f\u3002 \u6301\u4e45\u6027\uff1a \u4e00\u4e2a\u4e8b\u52a1\u4e00\u65e6\u5b8c\u6210\u5168\u90e8\u64cd\u4f5c\u540e\uff0c\u8fd9\u4e2a\u4e8b\u52a1\u7684\u7ed3\u679c\u5fc5\u987b\u662f\u6c38\u4e45\u6027\u7684\uff0c\u4e0d\u80fd\u56e0\u7cfb\u7edf\u6545\u969c\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u5220\u9664\u3002","title":"3. \u4e8b\u52a1"},{"location":"mybatis/\u7b80\u4ecb/","text":"mybatis\u53c2\u8003\u6587\u6863 1. \u5b89\u88c5 \u00b6 pom.xml <dependency> <groupId> org.mybatis </groupId> <artifactId> mybatis </artifactId> <version> x.x.x </version> </dependency> 2. \u4ece XML \u4e2d\u6784\u5efa SqlSessionFactory \u00b6 3. \u4ece SqlSessionFactory \u4e2d\u83b7\u53d6 SqlSession \u00b6 \u547d\u540d\u89e3\u6790\uff1a \u4e3a\u4e86\u51cf\u5c11\u8f93\u5165\u91cf\uff0cMyBatis \u5bf9\u6240\u6709\u7684\u547d\u540d\u914d\u7f6e\u5143\u7d20\uff08\u5305\u62ec\u8bed\u53e5\uff0c\u7ed3\u679c\u6620\u5c04\uff0c\u7f13\u5b58\u7b49\uff09\u4f7f\u7528\u4e86\u5982\u4e0b\u7684\u547d\u540d\u89e3\u6790\u89c4\u5219\u3002 \u5b8c\u5168\u9650\u5b9a\u540d\uff08\u6bd4\u5982 \u201ccom.mypackage.MyMapper.selectAllThings\uff09\u5c06\u88ab\u76f4\u63a5\u7528\u4e8e\u67e5\u627e\u53ca\u4f7f\u7528\u3002 \u77ed\u540d\u79f0\uff08\u6bd4\u5982 \u201cselectAllThings\u201d\uff09\u5982\u679c\u5168\u5c40\u552f\u4e00\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u5f15\u7528\u3002 \u5982\u679c\u4e0d\u552f\u4e00\uff0c\u6709\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u76f8\u540c\u540d\u79f0\uff08\u6bd4\u5982 \u201ccom.foo.selectAllThings\u201d \u548c \u201ccom.bar.selectAllThings\u201d\uff09\uff0c\u90a3\u4e48\u4f7f\u7528\u65f6\u5c31\u4f1a\u4ea7\u751f\u201c\u77ed\u540d\u79f0\u4e0d\u552f\u4e00\u201d\u7684\u9519\u8bef\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u5fc5\u987b\u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u540d\u3002 4. \u4f5c\u7528\u57df\uff08Scope\uff09\u548c\u751f\u547d\u5468\u671f \u00b6 \u5bf9\u8c61\u751f\u547d\u5468\u671f\u548c\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6 \u4f9d\u8d56\u6ce8\u5165\u6846\u67b6\u53ef\u4ee5\u521b\u5efa\u7ebf\u7a0b\u5b89\u5168\u7684\u3001\u57fa\u4e8e\u4e8b\u52a1\u7684 SqlSession \u548c\u6620\u5c04\u5668\uff0c\u5e76\u5c06\u5b83\u4eec\u76f4\u63a5\u6ce8\u5165\u5230\u4f60\u7684 bean \u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u5ffd\u7565\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u3002 4.1 SqlSessionFactoryBuilder \u00b6 \u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u88ab\u5b9e\u4f8b\u5316\u3001\u4f7f\u7528\u548c\u4e22\u5f03\uff0c\u4e00\u65e6\u521b\u5efa\u4e86 SqlSessionFactory\uff0c\u5c31\u4e0d\u518d\u9700\u8981\u5b83\u4e86\u3002SqlSessionFactoryBuilder \u5b9e\u4f8b\u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u65b9\u6cd5\u4f5c\u7528\u57df\uff08\u4e5f\u5c31\u662f\u5c40\u90e8\u65b9\u6cd5\u53d8\u91cf\uff09 4.2 SqlSessionFactory \u00b6 SqlSessionFactory \u4e00\u65e6\u88ab\u521b\u5efa\u5c31\u5e94\u8be5\u5728\u5e94\u7528\u7684\u8fd0\u884c\u671f\u95f4\u4e00\u76f4\u5b58\u5728\uff0c\u6ca1\u6709\u4efb\u4f55\u7406\u7531\u4e22\u5f03\u5b83\u6216\u91cd\u65b0\u521b\u5efa\u53e6\u4e00\u4e2a\u5b9e\u4f8b\u3002\u56e0\u6b64 SqlSessionFactory \u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u5e94\u7528\u4f5c\u7528\u57df\u3002 4.3 SqlSession \u00b6 \u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5e94\u8be5\u6709\u5b83\u81ea\u5df1\u7684 SqlSession \u5b9e\u4f8b\u3002SqlSession \u7684\u5b9e\u4f8b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u56e0\u6b64\u662f\u4e0d\u80fd\u88ab\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u5b83\u7684\u6700\u4f73\u7684\u4f5c\u7528\u57df\u662f\u8bf7\u6c42\u6216\u65b9\u6cd5\u4f5c\u7528\u57df\u3002 \u7edd\u5bf9\u4e0d\u80fd\u5c06 SqlSession \u5b9e\u4f8b\u7684\u5f15\u7528\u653e\u5728\u4e00\u4e2a\u7c7b\u7684\u9759\u6001\u57df\uff0c\u751a\u81f3\u4e00\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u53d8\u91cf\u4e5f\u4e0d\u884c\u3002 \u4e5f\u7edd\u4e0d\u80fd\u5c06 SqlSession \u5b9e\u4f8b\u7684\u5f15\u7528\u653e\u5728\u4efb\u4f55\u7c7b\u578b\u7684\u6258\u7ba1\u4f5c\u7528\u57df\u4e2d\u3002 \u6bcf\u6b21\u6536\u5230\u7684 HTTP \u8bf7\u6c42\uff0c\u5c31\u53ef\u4ee5\u6253\u5f00\u4e00\u4e2a SqlSession\uff0c\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\uff0c\u5c31\u5173\u95ed\u5b83\u3002 4.4 \u6620\u5c04\u5668\u5b9e\u4f8b \u00b6 \u6620\u5c04\u5668\u662f\u4e00\u4e9b\u7531\u4f60\u521b\u5efa\u7684\u3001\u7ed1\u5b9a\u4f60\u6620\u5c04\u7684\u8bed\u53e5\u7684\u63a5\u53e3\u3002\u6620\u5c04\u5668\u63a5\u53e3\u7684\u5b9e\u4f8b\u662f\u4ece SqlSession \u4e2d\u83b7\u5f97\u7684\u3002\u6620\u5c04\u5668\u5b9e\u4f8b\u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u65b9\u6cd5\u4f5c\u7528\u57df\u3002 SqlSession session = sqlSessionFactory . openSession (); try { BlogMapper mapper = session . getMapper ( BlogMapper . class ); // \u4f60\u7684\u5e94\u7528\u903b\u8f91\u4ee3\u7801 } finally { session . close (); }","title":"\u7b80\u4ecb.md"},{"location":"mybatis/\u7b80\u4ecb/#1","text":"pom.xml <dependency> <groupId> org.mybatis </groupId> <artifactId> mybatis </artifactId> <version> x.x.x </version> </dependency>","title":"1. \u5b89\u88c5"},{"location":"mybatis/\u7b80\u4ecb/#2-xml-sqlsessionfactory","text":"","title":"2. \u4ece XML \u4e2d\u6784\u5efa SqlSessionFactory"},{"location":"mybatis/\u7b80\u4ecb/#3-sqlsessionfactory-sqlsession","text":"\u547d\u540d\u89e3\u6790\uff1a \u4e3a\u4e86\u51cf\u5c11\u8f93\u5165\u91cf\uff0cMyBatis \u5bf9\u6240\u6709\u7684\u547d\u540d\u914d\u7f6e\u5143\u7d20\uff08\u5305\u62ec\u8bed\u53e5\uff0c\u7ed3\u679c\u6620\u5c04\uff0c\u7f13\u5b58\u7b49\uff09\u4f7f\u7528\u4e86\u5982\u4e0b\u7684\u547d\u540d\u89e3\u6790\u89c4\u5219\u3002 \u5b8c\u5168\u9650\u5b9a\u540d\uff08\u6bd4\u5982 \u201ccom.mypackage.MyMapper.selectAllThings\uff09\u5c06\u88ab\u76f4\u63a5\u7528\u4e8e\u67e5\u627e\u53ca\u4f7f\u7528\u3002 \u77ed\u540d\u79f0\uff08\u6bd4\u5982 \u201cselectAllThings\u201d\uff09\u5982\u679c\u5168\u5c40\u552f\u4e00\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u5f15\u7528\u3002 \u5982\u679c\u4e0d\u552f\u4e00\uff0c\u6709\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u76f8\u540c\u540d\u79f0\uff08\u6bd4\u5982 \u201ccom.foo.selectAllThings\u201d \u548c \u201ccom.bar.selectAllThings\u201d\uff09\uff0c\u90a3\u4e48\u4f7f\u7528\u65f6\u5c31\u4f1a\u4ea7\u751f\u201c\u77ed\u540d\u79f0\u4e0d\u552f\u4e00\u201d\u7684\u9519\u8bef\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u5fc5\u987b\u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u540d\u3002","title":"3. \u4ece SqlSessionFactory \u4e2d\u83b7\u53d6 SqlSession"},{"location":"mybatis/\u7b80\u4ecb/#4-scope","text":"\u5bf9\u8c61\u751f\u547d\u5468\u671f\u548c\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6 \u4f9d\u8d56\u6ce8\u5165\u6846\u67b6\u53ef\u4ee5\u521b\u5efa\u7ebf\u7a0b\u5b89\u5168\u7684\u3001\u57fa\u4e8e\u4e8b\u52a1\u7684 SqlSession \u548c\u6620\u5c04\u5668\uff0c\u5e76\u5c06\u5b83\u4eec\u76f4\u63a5\u6ce8\u5165\u5230\u4f60\u7684 bean \u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u5ffd\u7565\u5b83\u4eec\u7684\u751f\u547d\u5468\u671f\u3002","title":"4. \u4f5c\u7528\u57df\uff08Scope\uff09\u548c\u751f\u547d\u5468\u671f"},{"location":"mybatis/\u7b80\u4ecb/#41-sqlsessionfactorybuilder","text":"\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u88ab\u5b9e\u4f8b\u5316\u3001\u4f7f\u7528\u548c\u4e22\u5f03\uff0c\u4e00\u65e6\u521b\u5efa\u4e86 SqlSessionFactory\uff0c\u5c31\u4e0d\u518d\u9700\u8981\u5b83\u4e86\u3002SqlSessionFactoryBuilder \u5b9e\u4f8b\u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u65b9\u6cd5\u4f5c\u7528\u57df\uff08\u4e5f\u5c31\u662f\u5c40\u90e8\u65b9\u6cd5\u53d8\u91cf\uff09","title":"4.1 SqlSessionFactoryBuilder"},{"location":"mybatis/\u7b80\u4ecb/#42-sqlsessionfactory","text":"SqlSessionFactory \u4e00\u65e6\u88ab\u521b\u5efa\u5c31\u5e94\u8be5\u5728\u5e94\u7528\u7684\u8fd0\u884c\u671f\u95f4\u4e00\u76f4\u5b58\u5728\uff0c\u6ca1\u6709\u4efb\u4f55\u7406\u7531\u4e22\u5f03\u5b83\u6216\u91cd\u65b0\u521b\u5efa\u53e6\u4e00\u4e2a\u5b9e\u4f8b\u3002\u56e0\u6b64 SqlSessionFactory \u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u5e94\u7528\u4f5c\u7528\u57df\u3002","title":"4.2 SqlSessionFactory"},{"location":"mybatis/\u7b80\u4ecb/#43-sqlsession","text":"\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5e94\u8be5\u6709\u5b83\u81ea\u5df1\u7684 SqlSession \u5b9e\u4f8b\u3002SqlSession \u7684\u5b9e\u4f8b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u56e0\u6b64\u662f\u4e0d\u80fd\u88ab\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u5b83\u7684\u6700\u4f73\u7684\u4f5c\u7528\u57df\u662f\u8bf7\u6c42\u6216\u65b9\u6cd5\u4f5c\u7528\u57df\u3002 \u7edd\u5bf9\u4e0d\u80fd\u5c06 SqlSession \u5b9e\u4f8b\u7684\u5f15\u7528\u653e\u5728\u4e00\u4e2a\u7c7b\u7684\u9759\u6001\u57df\uff0c\u751a\u81f3\u4e00\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u53d8\u91cf\u4e5f\u4e0d\u884c\u3002 \u4e5f\u7edd\u4e0d\u80fd\u5c06 SqlSession \u5b9e\u4f8b\u7684\u5f15\u7528\u653e\u5728\u4efb\u4f55\u7c7b\u578b\u7684\u6258\u7ba1\u4f5c\u7528\u57df\u4e2d\u3002 \u6bcf\u6b21\u6536\u5230\u7684 HTTP \u8bf7\u6c42\uff0c\u5c31\u53ef\u4ee5\u6253\u5f00\u4e00\u4e2a SqlSession\uff0c\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\uff0c\u5c31\u5173\u95ed\u5b83\u3002","title":"4.3 SqlSession"},{"location":"mybatis/\u7b80\u4ecb/#44","text":"\u6620\u5c04\u5668\u662f\u4e00\u4e9b\u7531\u4f60\u521b\u5efa\u7684\u3001\u7ed1\u5b9a\u4f60\u6620\u5c04\u7684\u8bed\u53e5\u7684\u63a5\u53e3\u3002\u6620\u5c04\u5668\u63a5\u53e3\u7684\u5b9e\u4f8b\u662f\u4ece SqlSession \u4e2d\u83b7\u5f97\u7684\u3002\u6620\u5c04\u5668\u5b9e\u4f8b\u7684\u6700\u4f73\u4f5c\u7528\u57df\u662f\u65b9\u6cd5\u4f5c\u7528\u57df\u3002 SqlSession session = sqlSessionFactory . openSession (); try { BlogMapper mapper = session . getMapper ( BlogMapper . class ); // \u4f60\u7684\u5e94\u7528\u903b\u8f91\u4ee3\u7801 } finally { session . close (); }","title":"4.4 \u6620\u5c04\u5668\u5b9e\u4f8b"},{"location":"mysql/1. \u7b80\u4ecb/","text":"1. \u53c2\u8003\u8d44\u6599 \u00b6 \u5ed6\u96ea\u5cf0sql\u6559\u7a0b MySQL\u5b98\u65b9\u6587\u6863 \u300a\u6df1\u5165\u6d45\u51faMySQL\u300b 2. \u6570\u636e\u5e93\u4e09\u8303\u5f0f \u00b6 2.1 \u7b2c\u4e00\u8303\u5f0f\uff081NF\uff09 \u00b6 \u5f3a\u8c03\u7684\u662f\u5217\u7684\u539f\u5b50\u6027\u3002\u5217\u4e0d\u80fd\u518d\u5206\u6210\u5176\u5b83\u51e0\u5217\u3002 2.2 \u7b2c\u4e8c\u8303\u5f0f\uff082NF\uff09 \u00b6 \u57fa\u4e8e 1NF \uff0c\u989d\u5916\u5305\u542b\u4e24\u90e8\u5206\u5185\u5bb9\uff1a \u8868\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3b\u952e \u6ca1\u6709\u5305\u542b\u5728\u4e3b\u952e\u4e2d\u7684\u5217\u5fc5\u987b\u5b8c\u5168\u4f9d\u8d56\u4e8e\u4e3b\u952e\uff0c\u4e8c\u4e0d\u80fd\u53ea\u4f9d\u8d56\u4e8e\u4e3b\u952e\u7684\u4e00\u90e8\u5206\u3002\u6b64\u65f6\u5e94\u5206\u79bb\u51fa\u65b0\u7684\u5b9e\u4f53\uff0c\u5373\u8868\u3002 2.3 \u7b2c\u4e09\u8303\u5f0f\uff083NF\uff09 \u00b6 \u57fa\u4e8e 1NF \uff0c\u4efb\u4f55\u975e\u4e3b\u5c5e\u6027\u4e0d\u4f9d\u8d56\u4e8e\u5176\u5b83\u975e\u4e3b\u5c5e\u6027\uff08\u57282NF\u7684\u57fa\u7840\u4e0a\u6d88\u9664\u4f9d\u8d56\u4f20\u9012\uff09\u3002 \u4e0d\u80fd\u5b58\u5728\u4f20\u9012\u4f9d\u8d56\u7684\u610f\u601d\u662f\u4e0d\u80fd\u5b58\u5728\uff1a\u975e\u4e3b\u952e\u5217 A \u4f9d\u8d56\u4e8e\u975e\u4e3b\u952e\u5217 B\uff0c\u975e\u4e3b\u952e\u5217 B \u4f9d\u8d56\u4e8e\u4e3b\u952e\u7684\u60c5\u51b5\u3002 3. \u65b9\u8a00 \u00b6 \u5404\u4e2a\u6570\u636e\u5e93\u652f\u6301\u7684\u5404\u81ea\u6269\u5c55\u7684\u529f\u80fd\uff0c\u901a\u5e38\u6211\u4eec\u628a\u5b83\u4eec\u79f0\u4e4b\u4e3a \u65b9\u8a00 \u3002 4. \u4e09\u79cd\u8bed\u53e5 \u00b6 DDL\uff1aData Definition Language DDL\u5141\u8bb8\u7528\u6237\u5b9a\u4e49\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u521b\u5efa\u8868\u3001\u5220\u9664\u8868\u3001\u4fee\u6539\u8868\u7ed3\u6784\u8fd9\u4e9b\u64cd\u4f5c\u3002\u901a\u5e38\uff0cDDL\u7531\u6570\u636e\u5e93\u7ba1\u7406\u5458\u6267\u884c\u3002 DML\uff1aData Manipulation Language \uff08\u6570\u636e\u64cd\u7eb5\u8bed\u53e5\uff09 DML\u4e3a\u7528\u6237\u63d0\u4f9b\u6dfb\u52a0\u3001\u5220\u9664\u3001\u66f4\u65b0\u6570\u636e\u7684\u80fd\u529b\uff0c\u8fd9\u4e9b\u662f\u5e94\u7528\u7a0b\u5e8f\u5bf9\u6570\u636e\u5e93\u7684\u65e5\u5e38\u64cd\u4f5c\u3002 DQL\uff1aData Query Language DQL\u5141\u8bb8\u7528\u6237\u67e5\u8be2\u6570\u636e\uff0c\u8fd9\u4e5f\u662f\u901a\u5e38\u6700\u9891\u7e41\u7684\u6570\u636e\u5e93\u65e5\u5e38\u64cd\u4f5c\u3002 4.1 \u7b80\u5199 \u00b6 CRUD \uff1aCreate\u3001Retrieve\uff08\u68c0\u7d22\uff09\u3001Update\u3001Delete\u3002 5. \u89c4\u5b9a \u00b6 SQL\u8bed\u8a00\u5173\u952e\u5b57\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f46\u662f\u4e0d\u540c\u6570\u636e\u5e93\u6216\u5e73\u53f0\u7684\u652f\u6301\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u89c4\u5b9a\uff1a SQL\u5173\u952e\u5b57\u603b\u662f\u5927\u5199\uff0c\u5176\u4f59\u4f7f\u7528\u5c0f\u5199\u3002 6. \u5e2e\u52a9 \u00b6 \u53ef\u4ee5\u767b\u5f55\u5230mysql\u4e4b\u540e\u6267\u884c help \u67e5\u770b\u5e2e\u52a9\uff1a MariaDB [ blog ] > help xxx ; \u6216 MariaDB [ blog ] > ? xxx ; \u6216\u8005\u5b98\u7f51\u67e5\u770b\u4f7f\u7528\u624b\u518c\uff1a Mysql5.5\u7248\u672c\u4f7f\u7528\u624b\u518c 7. \u5176\u5b83 \u00b6 \u5206\u5e93\u5206\u8868\u3001\u5206\u533a\uff1a https://www.cnblogs.com/langtianya/p/4997768.html \u5bf9global\u4f5c\u7528\u57df\u7684\u53d8\u91cf\u5efa\u8bae\u662f\uff1a\u5728my.cnf\u4e2d\u6307\u5b9a\uff0c\u91cd\u542f\u670d\u52a1\u540e\u751f\u6548\u3002","title":"1. \u7b80\u4ecb"},{"location":"mysql/1. \u7b80\u4ecb/#1","text":"\u5ed6\u96ea\u5cf0sql\u6559\u7a0b MySQL\u5b98\u65b9\u6587\u6863 \u300a\u6df1\u5165\u6d45\u51faMySQL\u300b","title":"1. \u53c2\u8003\u8d44\u6599"},{"location":"mysql/1. \u7b80\u4ecb/#2","text":"","title":"2. \u6570\u636e\u5e93\u4e09\u8303\u5f0f"},{"location":"mysql/1. \u7b80\u4ecb/#21-1nf","text":"\u5f3a\u8c03\u7684\u662f\u5217\u7684\u539f\u5b50\u6027\u3002\u5217\u4e0d\u80fd\u518d\u5206\u6210\u5176\u5b83\u51e0\u5217\u3002","title":"2.1 \u7b2c\u4e00\u8303\u5f0f\uff081NF\uff09"},{"location":"mysql/1. \u7b80\u4ecb/#22-2nf","text":"\u57fa\u4e8e 1NF \uff0c\u989d\u5916\u5305\u542b\u4e24\u90e8\u5206\u5185\u5bb9\uff1a \u8868\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3b\u952e \u6ca1\u6709\u5305\u542b\u5728\u4e3b\u952e\u4e2d\u7684\u5217\u5fc5\u987b\u5b8c\u5168\u4f9d\u8d56\u4e8e\u4e3b\u952e\uff0c\u4e8c\u4e0d\u80fd\u53ea\u4f9d\u8d56\u4e8e\u4e3b\u952e\u7684\u4e00\u90e8\u5206\u3002\u6b64\u65f6\u5e94\u5206\u79bb\u51fa\u65b0\u7684\u5b9e\u4f53\uff0c\u5373\u8868\u3002","title":"2.2 \u7b2c\u4e8c\u8303\u5f0f\uff082NF\uff09"},{"location":"mysql/1. \u7b80\u4ecb/#23-3nf","text":"\u57fa\u4e8e 1NF \uff0c\u4efb\u4f55\u975e\u4e3b\u5c5e\u6027\u4e0d\u4f9d\u8d56\u4e8e\u5176\u5b83\u975e\u4e3b\u5c5e\u6027\uff08\u57282NF\u7684\u57fa\u7840\u4e0a\u6d88\u9664\u4f9d\u8d56\u4f20\u9012\uff09\u3002 \u4e0d\u80fd\u5b58\u5728\u4f20\u9012\u4f9d\u8d56\u7684\u610f\u601d\u662f\u4e0d\u80fd\u5b58\u5728\uff1a\u975e\u4e3b\u952e\u5217 A \u4f9d\u8d56\u4e8e\u975e\u4e3b\u952e\u5217 B\uff0c\u975e\u4e3b\u952e\u5217 B \u4f9d\u8d56\u4e8e\u4e3b\u952e\u7684\u60c5\u51b5\u3002","title":"2.3 \u7b2c\u4e09\u8303\u5f0f\uff083NF\uff09"},{"location":"mysql/1. \u7b80\u4ecb/#3","text":"\u5404\u4e2a\u6570\u636e\u5e93\u652f\u6301\u7684\u5404\u81ea\u6269\u5c55\u7684\u529f\u80fd\uff0c\u901a\u5e38\u6211\u4eec\u628a\u5b83\u4eec\u79f0\u4e4b\u4e3a \u65b9\u8a00 \u3002","title":"3. \u65b9\u8a00"},{"location":"mysql/1. \u7b80\u4ecb/#4","text":"DDL\uff1aData Definition Language DDL\u5141\u8bb8\u7528\u6237\u5b9a\u4e49\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u521b\u5efa\u8868\u3001\u5220\u9664\u8868\u3001\u4fee\u6539\u8868\u7ed3\u6784\u8fd9\u4e9b\u64cd\u4f5c\u3002\u901a\u5e38\uff0cDDL\u7531\u6570\u636e\u5e93\u7ba1\u7406\u5458\u6267\u884c\u3002 DML\uff1aData Manipulation Language \uff08\u6570\u636e\u64cd\u7eb5\u8bed\u53e5\uff09 DML\u4e3a\u7528\u6237\u63d0\u4f9b\u6dfb\u52a0\u3001\u5220\u9664\u3001\u66f4\u65b0\u6570\u636e\u7684\u80fd\u529b\uff0c\u8fd9\u4e9b\u662f\u5e94\u7528\u7a0b\u5e8f\u5bf9\u6570\u636e\u5e93\u7684\u65e5\u5e38\u64cd\u4f5c\u3002 DQL\uff1aData Query Language DQL\u5141\u8bb8\u7528\u6237\u67e5\u8be2\u6570\u636e\uff0c\u8fd9\u4e5f\u662f\u901a\u5e38\u6700\u9891\u7e41\u7684\u6570\u636e\u5e93\u65e5\u5e38\u64cd\u4f5c\u3002","title":"4. \u4e09\u79cd\u8bed\u53e5"},{"location":"mysql/1. \u7b80\u4ecb/#41","text":"CRUD \uff1aCreate\u3001Retrieve\uff08\u68c0\u7d22\uff09\u3001Update\u3001Delete\u3002","title":"4.1 \u7b80\u5199"},{"location":"mysql/1. \u7b80\u4ecb/#5","text":"SQL\u8bed\u8a00\u5173\u952e\u5b57\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f46\u662f\u4e0d\u540c\u6570\u636e\u5e93\u6216\u5e73\u53f0\u7684\u652f\u6301\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u89c4\u5b9a\uff1a SQL\u5173\u952e\u5b57\u603b\u662f\u5927\u5199\uff0c\u5176\u4f59\u4f7f\u7528\u5c0f\u5199\u3002","title":"5. \u89c4\u5b9a"},{"location":"mysql/1. \u7b80\u4ecb/#6","text":"\u53ef\u4ee5\u767b\u5f55\u5230mysql\u4e4b\u540e\u6267\u884c help \u67e5\u770b\u5e2e\u52a9\uff1a MariaDB [ blog ] > help xxx ; \u6216 MariaDB [ blog ] > ? xxx ; \u6216\u8005\u5b98\u7f51\u67e5\u770b\u4f7f\u7528\u624b\u518c\uff1a Mysql5.5\u7248\u672c\u4f7f\u7528\u624b\u518c","title":"6. \u5e2e\u52a9"},{"location":"mysql/1. \u7b80\u4ecb/#7","text":"\u5206\u5e93\u5206\u8868\u3001\u5206\u533a\uff1a https://www.cnblogs.com/langtianya/p/4997768.html \u5bf9global\u4f5c\u7528\u57df\u7684\u53d8\u91cf\u5efa\u8bae\u662f\uff1a\u5728my.cnf\u4e2d\u6307\u5b9a\uff0c\u91cd\u542f\u670d\u52a1\u540e\u751f\u6548\u3002","title":"7. \u5176\u5b83"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/","text":"1. \u5b57\u7b26\u4e32\u51fd\u6570 1.1 CONCAT(str1,str2,...) 1.2 INSERT(str,x,y,instr) 1.3 LTRIM(str)\u3001RTRIM(str)\u548cTRIM(str) 1.4 REPEAT(str,x) 1.5 STRCMP(s1,s2) 2. \u6570\u503c\u51fd\u6570 2.1 ABS(x) 2.2 CEIL(x) 2.3 FLOOR(x) 2.4 RAND() 2.5 ROUND(x,y) 2.6 TRUNCATE(x,y) 3. \u65e5\u671f\u548c\u65f6\u95f4\u51fd\u6570 3.1 CURDATE() 3.2 NOW() 3.3 DATE_FORMAT(date,fmt) 3.4 DATE_ADD(date,INTERVAL expr unit), DATE_SUB(date,INTERVAL expr unit) 3.5 DATEDIFF(expr1,expr2) 4. \u6d41\u7a0b\u51fd\u6570 1. \u5b57\u7b26\u4e32\u51fd\u6570 \u00b6 1.1 CONCAT(str1,str2,...) \u00b6 \u8fde\u63a5\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u6709NULL\u65f6\u4e3a NULL \u3002 MariaDB [ blog ] > SELECT CONCAT ( 'A' , 'B' ), CONCAT ( 'C' , NULL ); + ------------------+-------------------+ | CONCAT ( 'A' , 'B' ) | CONCAT ( 'C' , NULL ) | + ------------------+-------------------+ | AB | NULL | + ------------------+-------------------+ 1.2 INSERT(str,x,y,instr) \u00b6 \u5c06\u5b57\u7b26\u4e32 str \u4ece\u7b2c x \u4f4d\u7f6e\u5f00\u59cb\uff0cy \u4e2a\u5b57\u7b26\u957f\u7684\u5b50\u4e32\u66ff\u6362\u4e3a\u5b57\u7b26\u4e32 instr\u3002 MariaDB [ blog ] > SELECT INSERT ( 'ABCD' , 2 , 1 , 'Z' ); + ------------------------+ | INSERT ( 'ABCD' , 2 , 1 , 'Z' ) | + ------------------------+ | AZCD | + ------------------------+ 1.3 LTRIM(str)\u3001RTRIM(str)\u548cTRIM(str) \u00b6 \u53bb\u9664\u7a7a\u683c\u7684\u51fd\u6570\u3002 1.4 REPEAT(str,x) \u00b6 \u5b57\u7b26\u4e32\u91cd\u590d\u51fd\u6570\u3002 1.5 STRCMP(s1,s2) \u00b6 \u5b57\u7b26\u4e32\u6bd4\u8f83\u51fd\u6570\u3002\u5927\u5c0f\u5199\u4e0d\u654f\u611f s1<s2\uff0creturn -1 s1=s2\uff0creturn 0 s1>s2\uff0creturn 1 MariaDB [ blog ] > SELECT STRCMP ( 'A' , 'a' ), STRCMP ( 'ABC' , 'ACB' ); + ------------------+----------------------+ | STRCMP ( 'A' , 'a' ) | STRCMP ( 'ABC' , 'ACB' ) | + ------------------+----------------------+ | 0 | - 1 | + ------------------+----------------------+ 2. \u6570\u503c\u51fd\u6570 \u00b6 2.1 ABS(x) \u00b6 \u7edd\u5bf9\u503c 2.2 CEIL(x) \u00b6 \u5411\u4e0a\u53d6\u6574 2.3 FLOOR(x) \u00b6 \u5411\u4e0b\u53d6\u6574 2.4 RAND() \u00b6 \u8fd4\u56de 0 \u5230 1 \u5185\u7684\u968f\u673a\u503c 2.5 ROUND(x,y) \u00b6 \u8fd4\u56de\u53c2\u6570 x \u7684\u56db\u820d\u4e94\u5165\u7684\u6709 y \u4f4d\u5c0f\u6570\u7684\u503c 2.6 TRUNCATE(x,y) \u00b6 \u8fd4\u56de\u6570\u5b57 x \u622a\u65ad\u4e3a y \u4f4d\u5c0f\u6570\u7684\u7ed3\u679c\uff0c\u4e0eROUND\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u4e0d\u4f1a\u56db\u820d\u4e94\u5165\u3002 3. \u65e5\u671f\u548c\u65f6\u95f4\u51fd\u6570 \u00b6 3.1 CURDATE() \u00b6 \u4e0e CURRENT_DATE \u3001 CURRENT_DATE() \u662f\u540c\u4e49\u8bcd\u3002 CURTIME \u540c\u7406\u3002 3.2 NOW() \u00b6 \u548c CURRENT_TIMESTAMP \u3001 CURRENT_TIMESTAMP() \u662f\u540c\u4e49\u8bcd\u3002 3.3 DATE_FORMAT(date,fmt) \u00b6 \u683c\u5f0f\u5316\u8fd4\u56de\u65e5\u671f\u3002 \u5e38\u7528\u683c\u5f0f\uff1a \u683c\u5f0f\u7b26 \u8bf4\u660e %a Abbreviated weekday name ( Sun .. Sat ) %Y Year, numeric, four digits %b Abbreviated month name ( Jan .. Dec ) %m Month, numeric ( 00 .. 12 ) %d Day of the month, numeric ( 00 .. 31 ) %H Hour ( 00 .. 23 ) %h , %I Hour ( 01 .. 12 ) %i Minutes, numeric ( 00 .. 59 ) %S , %s Seconds ( 00 .. 59 ) %r Time, 12-hour ( hh:mm:ss followed by AM or PM ) %T Time, 24-hour ( hh:mm:ss ) MariaDB [ blog ] > SELECT DATE_FORMAT ( CURDATE (), '%Y-%m-%d' ); + ------------------------------------+ | DATE_FORMAT ( CURDATE (), '%Y-%m-%d' ) | + ------------------------------------+ | 2019 - 05 - 08 | + ------------------------------------+ 3.4 DATE_ADD(date,INTERVAL expr unit), DATE_SUB(date,INTERVAL expr unit) \u00b6 \u65e5\u671f\u52a0\u51cf\u51fd\u6570\u3002 expr\uff1a\u8868\u8fbe\u5f0f unit\uff1a\u5355\u4f4d mysql > SELECT DATE_ADD ( '2010-12-31 23:59:59' , -> INTERVAL 1 DAY ); -> '2011-01-01 23:59:59' mysql > SELECT DATE_ADD ( '2100-12-31 23:59:59' , -> INTERVAL '1:1' MINUTE_SECOND ); -> '2101-01-01 00:01:00' mysql > SELECT DATE_SUB ( '2005-01-01 00:00:00' , -> INTERVAL '1 1:1:1' DAY_SECOND ); -> '2004-12-30 22:58:59' mysql > SELECT DATE_ADD ( '1900-01-01 00:00:00' , -> INTERVAL '-1 10' DAY_HOUR ); -> '1899-12-30 14:00:00' 3.5 DATEDIFF(expr1,expr2) \u00b6 \u8ba1\u7b97\u5929\u6570\u5dee\u3002 mysql > SELECT DATEDIFF ( '2007-12-31 23:59:59' , '2007-12-30' ); -> 1 mysql > SELECT DATEDIFF ( '2010-11-30 23:59:59' , '2010-12-31' ); -> - 31 4. \u6d41\u7a0b\u51fd\u6570 \u00b6 \u51fd\u6570 \u8bf4\u660e IF(value, t, f) \u5982\u679c value \u662f\u771f\uff0c\u8fd4\u56de t\uff1b\u5426\u5219\u8fd4\u56de f IFNULL(value1,value2) \u5982\u679c value1 \u4e0d\u4e3a\u7a7a\u8fd4\u56de value1\uff0c\u5426\u5219\u8fd4\u56de value2 CASE value WHEN [compare_value] THEN result [WHEN [compare_value] THEN result ...] [ELSE default] END \u5982\u679c value\u7b49\u4e8e compare_value\uff0c\u8fd4\u56de result\uff0c\u5426\u5219\u8fd4\u56de default CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE default] END \u5982\u679ccondition \u662f\u771f\uff0c\u8fd4\u56de result\uff0c\u5426\u5219\u8fd4\u56de default SELECT IF ( createDate > '2019-04-08' , 'true' , 'false' ) FROM new_user ; SELECT IFNULL ( introduction , 'empty' ) FROM new_user ; SELECT ( CASE createDate WHEN '2019-04-08' THEN 'TRUE' ELSE 'FALSE' END ) diffDate FROM new_user ; SELECT ( CASE WHEN '2019-04-08' > createDate THEN 'TRUE' ELSE 'FALSE' END ) diffDate FROM new_user ;","title":"10. MySQL\u5e38\u7528\u51fd\u6570"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#1","text":"","title":"1. \u5b57\u7b26\u4e32\u51fd\u6570"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#11-concatstr1str2","text":"\u8fde\u63a5\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u6709NULL\u65f6\u4e3a NULL \u3002 MariaDB [ blog ] > SELECT CONCAT ( 'A' , 'B' ), CONCAT ( 'C' , NULL ); + ------------------+-------------------+ | CONCAT ( 'A' , 'B' ) | CONCAT ( 'C' , NULL ) | + ------------------+-------------------+ | AB | NULL | + ------------------+-------------------+","title":"1.1 CONCAT(str1,str2,...)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#12-insertstrxyinstr","text":"\u5c06\u5b57\u7b26\u4e32 str \u4ece\u7b2c x \u4f4d\u7f6e\u5f00\u59cb\uff0cy \u4e2a\u5b57\u7b26\u957f\u7684\u5b50\u4e32\u66ff\u6362\u4e3a\u5b57\u7b26\u4e32 instr\u3002 MariaDB [ blog ] > SELECT INSERT ( 'ABCD' , 2 , 1 , 'Z' ); + ------------------------+ | INSERT ( 'ABCD' , 2 , 1 , 'Z' ) | + ------------------------+ | AZCD | + ------------------------+","title":"1.2 INSERT(str,x,y,instr)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#13-ltrimstrrtrimstrtrimstr","text":"\u53bb\u9664\u7a7a\u683c\u7684\u51fd\u6570\u3002","title":"1.3 LTRIM(str)\u3001RTRIM(str)\u548cTRIM(str)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#14-repeatstrx","text":"\u5b57\u7b26\u4e32\u91cd\u590d\u51fd\u6570\u3002","title":"1.4 REPEAT(str,x)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#15-strcmps1s2","text":"\u5b57\u7b26\u4e32\u6bd4\u8f83\u51fd\u6570\u3002\u5927\u5c0f\u5199\u4e0d\u654f\u611f s1<s2\uff0creturn -1 s1=s2\uff0creturn 0 s1>s2\uff0creturn 1 MariaDB [ blog ] > SELECT STRCMP ( 'A' , 'a' ), STRCMP ( 'ABC' , 'ACB' ); + ------------------+----------------------+ | STRCMP ( 'A' , 'a' ) | STRCMP ( 'ABC' , 'ACB' ) | + ------------------+----------------------+ | 0 | - 1 | + ------------------+----------------------+","title":"1.5 STRCMP(s1,s2)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#2","text":"","title":"2. \u6570\u503c\u51fd\u6570"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#21-absx","text":"\u7edd\u5bf9\u503c","title":"2.1 ABS(x)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#22-ceilx","text":"\u5411\u4e0a\u53d6\u6574","title":"2.2 CEIL(x)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#23-floorx","text":"\u5411\u4e0b\u53d6\u6574","title":"2.3 FLOOR(x)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#24-rand","text":"\u8fd4\u56de 0 \u5230 1 \u5185\u7684\u968f\u673a\u503c","title":"2.4 RAND()"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#25-roundxy","text":"\u8fd4\u56de\u53c2\u6570 x \u7684\u56db\u820d\u4e94\u5165\u7684\u6709 y \u4f4d\u5c0f\u6570\u7684\u503c","title":"2.5 ROUND(x,y)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#26-truncatexy","text":"\u8fd4\u56de\u6570\u5b57 x \u622a\u65ad\u4e3a y \u4f4d\u5c0f\u6570\u7684\u7ed3\u679c\uff0c\u4e0eROUND\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u4e0d\u4f1a\u56db\u820d\u4e94\u5165\u3002","title":"2.6 TRUNCATE(x,y)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#3","text":"","title":"3. \u65e5\u671f\u548c\u65f6\u95f4\u51fd\u6570"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#31-curdate","text":"\u4e0e CURRENT_DATE \u3001 CURRENT_DATE() \u662f\u540c\u4e49\u8bcd\u3002 CURTIME \u540c\u7406\u3002","title":"3.1 CURDATE()"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#32-now","text":"\u548c CURRENT_TIMESTAMP \u3001 CURRENT_TIMESTAMP() \u662f\u540c\u4e49\u8bcd\u3002","title":"3.2 NOW()"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#33-date_formatdatefmt","text":"\u683c\u5f0f\u5316\u8fd4\u56de\u65e5\u671f\u3002 \u5e38\u7528\u683c\u5f0f\uff1a \u683c\u5f0f\u7b26 \u8bf4\u660e %a Abbreviated weekday name ( Sun .. Sat ) %Y Year, numeric, four digits %b Abbreviated month name ( Jan .. Dec ) %m Month, numeric ( 00 .. 12 ) %d Day of the month, numeric ( 00 .. 31 ) %H Hour ( 00 .. 23 ) %h , %I Hour ( 01 .. 12 ) %i Minutes, numeric ( 00 .. 59 ) %S , %s Seconds ( 00 .. 59 ) %r Time, 12-hour ( hh:mm:ss followed by AM or PM ) %T Time, 24-hour ( hh:mm:ss ) MariaDB [ blog ] > SELECT DATE_FORMAT ( CURDATE (), '%Y-%m-%d' ); + ------------------------------------+ | DATE_FORMAT ( CURDATE (), '%Y-%m-%d' ) | + ------------------------------------+ | 2019 - 05 - 08 | + ------------------------------------+","title":"3.3 DATE_FORMAT(date,fmt)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#34-date_adddateinterval-expr-unit-date_subdateinterval-expr-unit","text":"\u65e5\u671f\u52a0\u51cf\u51fd\u6570\u3002 expr\uff1a\u8868\u8fbe\u5f0f unit\uff1a\u5355\u4f4d mysql > SELECT DATE_ADD ( '2010-12-31 23:59:59' , -> INTERVAL 1 DAY ); -> '2011-01-01 23:59:59' mysql > SELECT DATE_ADD ( '2100-12-31 23:59:59' , -> INTERVAL '1:1' MINUTE_SECOND ); -> '2101-01-01 00:01:00' mysql > SELECT DATE_SUB ( '2005-01-01 00:00:00' , -> INTERVAL '1 1:1:1' DAY_SECOND ); -> '2004-12-30 22:58:59' mysql > SELECT DATE_ADD ( '1900-01-01 00:00:00' , -> INTERVAL '-1 10' DAY_HOUR ); -> '1899-12-30 14:00:00'","title":"3.4 DATE_ADD(date,INTERVAL expr unit), DATE_SUB(date,INTERVAL expr unit)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#35-datediffexpr1expr2","text":"\u8ba1\u7b97\u5929\u6570\u5dee\u3002 mysql > SELECT DATEDIFF ( '2007-12-31 23:59:59' , '2007-12-30' ); -> 1 mysql > SELECT DATEDIFF ( '2010-11-30 23:59:59' , '2010-12-31' ); -> - 31","title":"3.5 DATEDIFF(expr1,expr2)"},{"location":"mysql/10. MySQL\u5e38\u7528\u51fd\u6570/#4","text":"\u51fd\u6570 \u8bf4\u660e IF(value, t, f) \u5982\u679c value \u662f\u771f\uff0c\u8fd4\u56de t\uff1b\u5426\u5219\u8fd4\u56de f IFNULL(value1,value2) \u5982\u679c value1 \u4e0d\u4e3a\u7a7a\u8fd4\u56de value1\uff0c\u5426\u5219\u8fd4\u56de value2 CASE value WHEN [compare_value] THEN result [WHEN [compare_value] THEN result ...] [ELSE default] END \u5982\u679c value\u7b49\u4e8e compare_value\uff0c\u8fd4\u56de result\uff0c\u5426\u5219\u8fd4\u56de default CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE default] END \u5982\u679ccondition \u662f\u771f\uff0c\u8fd4\u56de result\uff0c\u5426\u5219\u8fd4\u56de default SELECT IF ( createDate > '2019-04-08' , 'true' , 'false' ) FROM new_user ; SELECT IFNULL ( introduction , 'empty' ) FROM new_user ; SELECT ( CASE createDate WHEN '2019-04-08' THEN 'TRUE' ELSE 'FALSE' END ) diffDate FROM new_user ; SELECT ( CASE WHEN '2019-04-08' > createDate THEN 'TRUE' ELSE 'FALSE' END ) diffDate FROM new_user ;","title":"4. \u6d41\u7a0b\u51fd\u6570"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/","text":"1. \u67e5\u770b\u5f15\u64ce 2. MyISAM 2.1 \u5b58\u50a8\u65b9\u5f0f 2.2 \u5b58\u50a8\u683c\u5f0f 3. InnoDB 3.1 \u81ea\u52a8\u589e\u957f\u5217 3.2 \u5916\u952e\u7ea6\u675f 3.3 \u5b58\u50a8\u65b9\u5f0f 3.3.1 \u5171\u4eab\u8868\u7a7a\u95f4\u5b58\u50a8 3.3.2 \u591a\u8868\u7a7a\u95f4\u5b58\u50a8 4. MEMORY 5. MRG_MyISAM 6. TukoDB mysql\u7684\u6570\u636e\u5e93\u6587\u4ef6\u90fd\u5b58\u50a8\u5728 /var/lib/mysql/ \u76ee\u5f55\u4e0b\u3002 1. \u67e5\u770b\u5f15\u64ce \u00b6 \u6267\u884c SHOW ENGINES; \u67e5\u770b\u6240\u6709\u7684\u5f15\u64ce\u3002 MariaDB [ blog ] > SHOW ENGINES ; + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ | Engine | Support | Comment | Transactions | XA | Savepoints | + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ | MEMORY | YES | Hash based , stored in memory , useful for temporary tables | NO | NO | NO | | MRG_MYISAM | YES | Collection of identical MyISAM tables | NO | NO | NO | | CSV | YES | CSV storage engine | NO | NO | NO | | BLACKHOLE | YES | / dev / null storage engine ( anything you write to it disappears ) | NO | NO | NO | | MyISAM | YES | MyISAM storage engine | NO | NO | NO | | InnoDB | DEFAULT | Percona - XtraDB , Supports transactions , row - level locking , and foreign keys | YES | YES | YES | | ARCHIVE | YES | Archive storage engine | NO | NO | NO | | FEDERATED | YES | FederatedX pluggable storage engine | YES | NO | YES | | PERFORMANCE_SCHEMA | YES | Performance Schema | NO | NO | NO | | Aria | YES | Crash - safe tables with MyISAM heritage | NO | NO | NO | + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ 10 rows in set ( 0 . 00 sec ) MySQL 5.5.5\u4e4b\u524d\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u662fMyISAM\uff0c\u540e\u7eed\u662fInnoDB\u3002 2. MyISAM \u00b6 MyISAM \u662f MySQL \u7684 \u9ed8\u8ba4 \u5b58\u50a8\u5f15\u64ce\u3002MyISAM \u4e0d\u652f\u6301\u4e8b\u52a1\u3001\u4e5f\u4e0d\u652f\u6301\u5916\u952e\uff0c\u5176\u4f18\u52bf\u662f\u8bbf\u95ee\u901f\u5ea6\u5feb\u3002 2.1 \u5b58\u50a8\u65b9\u5f0f \u00b6 \u6bcf\u4e2a MyISAM \u5728\u78c1\u76d8\u4e0a\u5b58\u50a8\u6210 3 \u4e2a\u6587\u4ef6\uff0c\u5176\u6587\u4ef6\u540d\u90fd\u548c\u8868\u540d\u76f8\u540c\uff0c\u4f46\u6269\u5c55\u540d\u5206\u522b\u662f\uff1a .frm\uff08\u5b58\u50a8\u8868\u5b9a\u4e49\uff09\uff1b .MYD\uff08MYData\uff0c\u5b58\u50a8\u6570\u636e\uff09\uff1b .MYI \uff08MYIndex\uff0c\u5b58\u50a8\u7d22\u5f15\uff09\u3002 \u6570\u636e\u6587\u4ef6\u548c\u7d22\u5f15\u6587\u4ef6\u53ef\u4ee5\u653e\u7f6e\u5728\u4e0d \u540c\u7684\u76ee\u5f55\uff0c\u5e73\u5747\u5206\u5e03 IO \uff0c\u83b7\u5f97\u66f4\u5feb\u7684\u901f\u5ea6\u3002 \u8981\u6307\u5b9a\u7d22\u5f15\u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\uff0c \u9700\u8981\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u901a\u8fc7 DATA DIRECTORY \u548c INDEX DIRECTORY \u8bed\u53e5\u6307\u5b9a\u3002\u6587\u4ef6\u8def\u5f84\u9700\u8981\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5e76\u4e14\u5177\u6709\u8bbf\u95ee\u6743\u9650\u3002 ALTER TABLE TEST DATA DIRECTORY = '/tmp/test/' , INDEX DIRECTORY = '/tmp/test/' ; \u5b9e\u9645\u6d4b\u8bd5\u4f1a\u53d1\u51fa\u53c2\u6570\u65e0\u6548\u7684\u8b66\u544a\uff08\u6682\u65f6\u6ca1\u627e\u5230\u539f\u56e0\uff0cTODO\uff09\uff1a + ---------+------+----------------------------------+ | Level | Code | Message | + ---------+------+----------------------------------+ | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | + ---------+------+----------------------------------+ MyISAM \u7c7b\u578b\u7684\u8868\u53ef\u80fd\u4f1a\u635f\u574f\uff0c\u4f1a\u63d0\u793a\u9700\u8981\u4fee\u590d\u6216\u8005\u8bbf\u95ee\u540e\u8fd4\u56de\u9519\u8bef\u7684\u7ed3\u679c\u3002 2.2 \u5b58\u50a8\u683c\u5f0f \u00b6 MyISAM \u7684\u8868\u53c8\u652f\u6301 3 \u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u5206\u522b\u662f\uff1a \u9759\u6001\uff08\u56fa\u5b9a\u957f\u5ea6\uff09\u8868\uff0c\u9ed8\u8ba4\u683c\u5f0f\u3002\u5b57\u6bb5\u90fd\u662f\u975e\u53d8\u957f\u5b57\u6bb5\u3002\u4f18\u70b9\u662f\u5b58\u50a8\u975e\u5e38\u8fc5\u901f\uff0c \u5bb9\u6613\u7f13\u5b58\uff0c \u51fa\u73b0\u6545\u969c\u5bb9\u6613\u6062\u590d\uff1b \u7f3a\u70b9\u662f\u5360\u7528\u7684\u7a7a\u95f4\u901a\u5e38\u6bd4\u52a8\u6001\u8868\u591a\u3002 \u9759\u6001\u8868\u7684\u6570\u636e\u5728\u5b58\u50a8\u7684\u65f6\u5019\u4f1a\u6309\u7167\u5217\u7684\u5bbd\u5ea6\u5b9a\u4e49\u8865\u8db3\u7a7a\u683c\uff0c \u4f46 \u662f\u5728\u5e94\u7528\u8bbf\u95ee\u7684\u65f6\u5019\u5e76\u4f1a\u5c06\u5c3e\u90e8\u7684\u7a7a\u683c\u5168\u90e8\u5220\u9664\u3002 CHAR \u548c VARCHAR \u53ef\u7528\uff0c\u4f46\u662f space-padded \uff0c \u7c7b\u578b\u4e0d\u53ef\u53d8\uff08\u5b9e\u9645\u6d4b\u8bd5\u53ef\u53d8\uff1f\uff1f\uff1f\uff09\u3002 \u52a8\u6001\u8868\u3002\u52a8\u6001\u8868\u4e2d\u5305\u542b\u53d8\u957f\u5b57\u6bb5\uff0c \u8bb0\u5f55\u4e0d\u662f\u56fa\u5b9a\u957f\u5ea6\u7684\uff0c \u8fd9\u6837\u5b58\u50a8\u7684\u4f18\u70b9\u662f\u5360\u7528\u7684\u7a7a\u95f4\u76f8\u5bf9\u8f83\u5c11\uff0c \u4f46 \u662f\u9891\u7e41\u5730\u66f4\u65b0\u5220\u9664\u8bb0\u5f55\u4f1a\u4ea7\u751f\u788e\u7247\uff08\u53ef\u6267\u884c\u547d\u4ee4\u6539\u5584\uff09\uff0c\u5e76\u4e14\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\u6062\u590d\u76f8\u5bf9\u6bd4\u8f83\u56f0\u96be\u3002 \u538b\u7f29\u8868\u3002\u538b\u7f29\u8868\u662f\u53ea\u8bfb\u7684\uff0c\u7531 myisampack \u5de5\u5177\u521b\u5efa\uff0c\u5360\u636e\u975e\u5e38\u5c0f\u7684\u78c1\u76d8\u7a7a\u95f4\u3002\u8bbf\u95ee\u5f00\u652f\u975e\u5e38\u5c0f\u3002 \u524d\u4e24\u79cd\u4f1a\u6839\u636e\u5b57\u6bb5\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u3002 3. InnoDB \u00b6 InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u5177\u6709\u63d0\u4ea4\u3001 \u56de\u6eda\u548c\u5d29\u6e83\u6062\u590d\u80fd\u529b\u7684\u4e8b\u52a1\u5b89\u5168\u3002\u4f46\u662f\u76f8\u5bf9\u4e8eMyISAM\u6548\u7387\u5dee\u5e76\u4e14\u7a7a\u95f4\u5360\u7528\u7387\u9ad8\u3002 3.1 \u81ea\u52a8\u589e\u957f\u5217 \u00b6 InnoDB \u8868\u7684\u81ea\u52a8\u589e\u957f\u5217\u53ef\u4ee5\u624b\u5de5\u63d2\u5165\uff0c \u4f46\u662f\u63d2\u5165\u7684\u503c\u5982\u679c\u662f \u7a7a\u3001NULL\u6216\u8005 0 \uff0c \u5219\u5b9e\u9645\u63d2\u5165\u7684\u5c06\u662f\u81ea\u52a8\u589e\u957f\u540e\u7684\u503c\u3002 \u53ef\u4ee5\u901a\u8fc7 ALTER TABLE *** AUTO_INCREMENT = n; \u8bed\u53e5\u5f3a\u5236\u8bbe\u7f6e\u81ea\u52a8\u589e\u957f\u5217\u7684\u521d\u8bc6\u503c\uff0c\u9ed8\u8ba4\u662f1\u3002\u4f46\u662f\u5982\u679c\u672a\u4f7f\u7528\u8be5\u503c\u5e76\u91cd\u542f\u4e86\u6570\u636e\u5e93\u5219\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u3002 3.2 \u5916\u952e\u7ea6\u675f \u00b6 MySQL \u652f\u6301\u5916\u952e\u7684\u5b58\u50a8\u5f15\u64ce\u53ea\u6709 InnoDB\uff0c\u5728\u521b\u5efa\u5916\u952e\u7684\u65f6\u5019\uff0c\u8981\u6c42\u7236\u8868\u5fc5\u987b\u6709\u5bf9\u5e94\u7684\u7d22\u5f15\uff0c\u5b50\u8868\u5728\u521b\u5efa\u5916\u952e\u7684\u65f6\u5019\u4e5f\u4f1a\u81ea\u52a8\u521b\u5efa\u5bf9\u5e94\u7684\u7d22\u5f15\u3002 \u5728\u521b\u5efa\u7d22\u5f15\u7684\u65f6\u5019\uff0c \u53ef\u4ee5\u6307\u5b9a\u5728\u5220\u9664\u3001 \u66f4\u65b0\u7236\u8868\u65f6\uff0c \u5bf9\u5b50\u8868\u8fdb\u884c\u7684\u76f8\u5e94\u64cd\u4f5c\uff0c \u5305 RESTRICT\u3001CASCADE\u3001SET NULL \u548c NO ACTION\u3002 RESTRICT \u548c NO ACTION \u76f8\u540c\uff0c\u662f\u6307\u9650\u5236\u5728\u5b50\u8868\u6709\u5173\u8054\u8bb0\u5f55\u7684\u60c5\u51b5\u4e0b\u7236\u8868\u4e0d\u80fd\u66f4\u65b0 CASCADE \u8868\u793a\u7236\u8868\u5728\u66f4\u65b0\u6216\u8005\u5220\u9664\u65f6\uff0c \u66f4\u65b0\u6216\u8005\u5220\u9664\u5b50\u8868\u5bf9\u5e94\u8bb0\u5f55 SET NULL \u5219\u8868\u793a\u7236\u8868\u5728\u66f4\u65b0\u6216\u8005\u5220\u9664\u7684\u65f6\u5019\uff0c\u5b50\u8868\u7684\u5bf9\u5e94\u5b57\u6bb5\u88abSET NULL \u6682\u65f6\u5173\u95ed/\u6253\u5f00\u5916\u952e\u7ea6\u675f\uff1a SET FOREIGN_KEY_CHECKS = 0; / SET FOREIGN_KEY_CHECKS = 1; 3.3 \u5b58\u50a8\u65b9\u5f0f \u00b6 InnoDB \u5b58\u50a8\u8868\u548c\u7d22\u5f15\u6709\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u3002 3.3.1 \u5171\u4eab\u8868\u7a7a\u95f4\u5b58\u50a8 \u00b6 \u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7684\u8868\u7684\u8868\u7ed3\u6784\u4fdd\u5b58\u5728.frm \u6587\u4ef6\u4e2d\uff0c \u6570\u636e\u548c\u7d22\u5f15\u4fdd\u5b58\u5728 innodb_data_home_dir \u548c innodb_data_file_path \u5b9a\u4e49\u7684\u8868\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u662f\u591a\u4e2a\u6587\u4ef6\u3002 3.3.2 \u591a\u8868\u7a7a\u95f4\u5b58\u50a8 \u00b6 \u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7684\u8868\u7684\u8868\u7ed3\u6784\u4ecd\u7136\u4fdd\u5b58\u5728.frm \u6587\u4ef6\u4e2d\uff0c \u4f46\u662f\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u5355\u72ec\u4fdd\u5b58\u5728.ibd \u4e2d\u3002\u5982\u679c\u662f\u4e2a\u5206\u533a\u8868\uff0c\u5219\u6bcf\u4e2a\u5206\u533a\u5bf9\u5e94\u5355\u72ec\u7684.ibd\u6587\u4ef6\uff0c \u6587\u4ef6\u540d\u662f \u201c\u8868\u540d+\u5206\u533a\u540d\u201d \uff0c \u53ef\u4ee5\u5728\u521b\u5efa\u5206\u533a\u7684\u65f6\u5019\u6307\u5b9a\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u4ee5\u6b64\u6765\u5c06\u8868\u7684 IO \u5747\u5300\u5206\u5e03\u5728\u591a\u4e2a\u78c1\u76d8\u4e0a\u3002 \u4f7f\u7528\u6b64\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u9700\u8981\u8bbe\u7f6e\u53c2\u6570 innodb_file_per_table \uff0c\u5e76\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u540e\u624d\u53ef\u4ee5\u751f\u6548\u3002 \u9ed8\u8ba4\u6253\u5f00\u7684 MariaDB [ MYISAM_TEST ] > SHOW VARIABLES LIKE 'innodb_file_per_table' ; + -----------------------+-------+ | Variable_name | Value | + -----------------------+-------+ | innodb_file_per_table | ON | + -----------------------+-------+ \u6ce8\u610f \uff1a\u5f53\u4f60\u4fee\u6539\u4e86\u5b58\u50a8\u65b9\u5f0f\u540e\uff0c\u53ea\u5bf9\u65b0\u5efa\u7684\u8868\u751f\u6548\uff0c\u539f\u6765\u7684\u8868\u4ecd\u7136\u4fdd\u6301\u539f\u5148\u7684\u5b58\u50a8\u65b9\u5f0f\u53ca\u8bbf\u95ee\u65b9\u5f0f\u3002 \u591a\u8868\u7a7a\u95f4\u7684\u6570\u636e\u6587\u4ef6 \u6ca1\u6709\u5927\u5c0f\u9650\u5236 \uff0c \u4e0d\u9700\u8981\u8bbe\u7f6e\u521d\u59cb\u5927\u5c0f\uff0c \u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e\u6587\u4ef6\u7684\u6700\u5927\u9650\u5236\u3001\u6269\u5c55\u5927\u5c0f\u7b49\u53c2\u6570\u3002 \u5982\u679c\u8981\u5c06\u5355\u8868\u6062\u590d\u5230\u76ee\u6807\u6570\u636e\u5e93\uff0c\u5219\u9700\u8981\u901a\u8fc7 mysqldump \u548c mysqlimport \u6765\u5b9e\u73b0\u3002 \u6ce8\u610f \uff1a\u5373\u4fbf\u5728\u591a\u8868\u7a7a\u95f4\u7684\u5b58\u50a8\u65b9\u5f0f\u4e0b\uff0c\u5171\u4eab\u8868\u7a7a\u95f4\u4ecd\u7136\u662f\u5fc5\u987b\u7684\uff0cInnoDB \u628a\u5185\u90e8\u6570\u636e\u8bcd\u5178\u548c\u5728\u7ebf\u91cd\u505a\u65e5\u5fd7\u653e\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002 4. MEMORY \u00b6 \u4f7f\u7528\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\u6765\u521b\u5efa\u8868\u3002\u6bcf\u4e2a MEMORY \u8868\u53ea\u5b9e\u9645\u5bf9\u5e94\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c\u683c\u5f0f\u662f.frm\u3002 \u5b58\u50a8\u65b9\u5f0f \uff1a\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u56e0\u4e3a\u5b83\u7684\u6570\u636e\u662f\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4f7f\u7528 HASH \u7d22\u5f15\uff0c\u4f46\u662f\u4e00\u65e6\u670d\u52a1\u5173\u95ed\uff0c\u8868\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u9002\u7528\u573a\u666f \uff1aMEMORY \u7c7b\u578b\u7684\u5b58\u50a8\u5f15\u64ce\u4e3b\u8981\u7528\u5728\u90a3\u4e9b\u5185\u5bb9\u53d8\u5316\u4e0d\u9891\u7e41\u7684\u4ee3\u7801\u8868\uff0c\u6216\u8005\u4f5c\u4e3a\u7edf\u8ba1\u64cd\u4f5c\u7684\u4e2d\u95f4\u7ed3\u679c\u8868\uff0c\u4fbf\u4e8e\u9ad8\u6548\u5730\u5bf9\u4e2d\u95f4\u7ed3\u679c\u8fdb\u884c\u5206\u6790\u5e76\u5f97\u5230\u6700\u7ec8\u7684\u7edf\u8ba1\u7ed3\u679c\u3002 MAX_ROWS \uff1a\u8fd9\u4e0d\u662f\u4e00\u4e2a\u786c\u6027\u9650\u5236\uff0c\u53ea\u662f\u63d0\u793a\u5b58\u50a8\u5f15\u64ce\u81f3\u5c11\u80fd\u591f\u5b58\u50a8\u8fd9\u4e48\u591a\u884c\u3002 MIN_ROWS \uff1a\u8ba1\u5212\u5728\u8868\u4e2d\u5b58\u50a8\u7684\u6700\u5c11\u884c\u6570\u3002MEMORY \u5c06\u8fd9\u4e2a\u9009\u9879\u770b\u4f5c\u5185\u5b58\u4f7f\u7528\u7684\u63d0\u793a\u3002 5. MRG_MyISAM \u00b6 MRG_MyISAM \u5b58\u50a8\u5f15\u64ce\u662f\u4e00\u7ec4 MyISAM \u8868\u7684\u7ec4\u5408\uff0c \u8fd9\u4e9b MyISAM \u8868\u7ed3\u6784\u5fc5\u987b\u5b8c\u5168\u76f8\u540c\uff0c MRG_MyISAM\u8868\u672c\u8eab\u5e76\u6ca1\u6709\u6570\u636e\u3002 \u5bf9 MRG_MyISAM \u7c7b\u578b\u7684\u8868\u53ef\u4ee5\u8fdb\u884c \u67e5\u8be2\u3001\u66f4\u65b0\u3001\u5220\u9664 \u7684\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u5bf9\u5185\u90e8\u7684\u5b9e\u9645\u7684 MyISAM \u8868\u8fdb\u884c\u7684\u3002 \u5bf9\u4e8e MRG_MyISAM \u7c7b\u578b\u8868\u7684 \u63d2\u5165 \u64cd\u4f5c \uff0c\u662f\u901a\u8fc7INSERT_METHOD \u5b50\u53e5\u5b9a\u4e49\u63d2\u5165\u7684\u8868\uff0c\u53ef\u4ee5\u6709 3 \u4e2a\u4e0d\u540c\u7684\u503c\uff0c\u4f7f\u7528 FIRST \u6216 LAST \u503c\u4f7f\u5f97\u63d2\u5165\u64cd\u4f5c\u88ab\u76f8\u5e94\u5730\u4f5c\u7528\u5728\u7b2c\u4e00\u6216\u6700\u540e\u4e00\u4e2a\u8868\u4e0a\uff0c\u4e0d\u5b9a\u4e49\u8fd9\u4e2a\u5b50\u53e5\u6216\u8005\u5b9a\u4e49\u4e3a NO\uff0c\u8868\u793a\u4e0d\u80fd\u5bf9\u8fd9\u4e2a MRG_MyISAM \u8868\u6267\u884c\u63d2\u5165\u64cd\u4f5c\u3002 \u53ef\u4ee5\u5bf9 MRG_MyISAM \u8868\u8fdb\u884c DROP \u64cd\u4f5c\uff0c \u8fd9\u4e2a\u64cd\u4f5c \u53ea\u662f\u5220\u9664 MRG_MyISAM \u7684\u5b9a\u4e49 \uff0c \u5bf9\u5185\u90e8\u7684\u8868\u6ca1\u6709\u4efb\u4f55\u7684\u5f71\u54cd\u3002 \u5b58\u50a8\u65b9\u5f0f \uff1aMRG_MyISAM \u8868\u5728\u78c1\u76d8\u4e0a\u4fdd\u7559\u4e24\u4e2a\u6587\u4ef6\uff0c \u6587\u4ef6\u540d\u4ee5\u8868\u7684\u540d\u5b57\u5f00\u59cb\uff0c \u4e00\u4e2a.frm \u6587\u4ef6\u5b58\u50a8\u8868\u5b9a\u4e49\uff0c\u53e6\u4e00\u4e2a.MRG \u6587\u4ef6\u5305\u542b\u7ec4\u5408\u8868\u7684\u4fe1\u606f\uff0c \u5305\u62ec MRG_MyISAM \u8868\u7531\u54ea\u4e9b\u8868\u7ec4\u6210\u3001 \u63d2\u5165\u65b0\u7684\u6570\u636e\u65f6\u7684\u4f9d\u636e\u3002\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 .MRG \u6587\u4ef6\u6765\u4fee\u6539 MRG_MyISAM \u8868\uff0c\u4f46\u662f\u4fee\u6539\u540e\u8981\u901a\u8fc7 FLUSH TABLES \u5237\u65b0\u3002 # \u521b\u5efa MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST \\ G ; *************************** 1 . row *************************** Table : TEST Create Table : CREATE TABLE ` TEST ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 # \u521b\u5efa MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST2 \\ G ; *************************** 1 . row *************************** Table : TEST2 Create Table : CREATE TABLE ` TEST2 ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 # \u521b\u5efa MRG_MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST3 \\ G ; *************************** 1 . row *************************** Table : TEST3 Create Table : CREATE TABLE ` TEST3 ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MRG_MyISAM DEFAULT CHARSET = utf8 INSERT_METHOD = LAST UNION = ( ` TEST ` , ` TEST2 ` ) # \u5411\u5b50\u8868\u4e2d\u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO TEST VALUES ( 'SHI' ); MariaDB [ MYISAM_TEST ] > INSERT INTO TEST2 VALUES ( 'SHI2' ); # \u5728\u603b\u8868\u53ef\u4ee5\u67e5\u8be2\u5230\u6240\u6709\u7684\u6570\u636e MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST3 ; + ------+ | NAME | + ------+ | SHI | | SHI2 | + ------+ # \u5411\u603b\u8868\u4e2d\u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO TEST3 VALUES ( 'SHI3' ); # \u68c0\u7d22\u603b\u8868\u6570\u636e MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST3 ; + ------+ | NAME | + ------+ | SHI | | SHI2 | | SHI3 | + ------+ # \u5b9e\u9645\u5b58\u50a8\u5728\u5b50\u8868\u4e2d MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST2 ; + ------+ | NAME | + ------+ | SHI2 | | SHI3 | + ------+ \u8fd9\u4e5f\u662f MRG_MyISAM \u8868\u548c\u5206\u533a\u8868\u7684\u533a\u522b\uff0c MRG_MyISAM \u8868\u5e76\u4e0d\u80fd\u667a\u80fd\u5730\u5c06\u8bb0\u5f55\u5199\u5230\u5bf9\u5e94\u7684\u8868\u4e2d\uff0c\u800c\u5206\u533a\u8868\u662f\u53ef\u4ee5\u7684\u3002 6. TukoDB \u00b6 \u7b2c\u4e09\u65b9\u5b58\u50a8\u5f15\u64ce\u3002 \u9ad8\u6027\u80fd\u3001\u652f\u6301\u4e8b\u52a1 \u9ad8\u6269\u5c55\u6027\u3001\u9ad8\u538b\u7f29\u7387\u3001\u9ad8\u6548\u7684\u5199\u5165\u6027\u80fd \u652f\u6301\u5927\u591a\u6570\u5728\u7ebfDDL\u64cd\u4f5c \u9002\u7528\u573a\u666f\uff1a \u65e5\u5fd7\u6570\u636e \u5386\u53f2\u6570\u636e \u5728\u7ebfDDL\u9891\u7e41\u7684\u573a\u666f","title":"11. MySQL\u5b58\u50a8\u5f15\u64ce"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#1","text":"\u6267\u884c SHOW ENGINES; \u67e5\u770b\u6240\u6709\u7684\u5f15\u64ce\u3002 MariaDB [ blog ] > SHOW ENGINES ; + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ | Engine | Support | Comment | Transactions | XA | Savepoints | + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ | MEMORY | YES | Hash based , stored in memory , useful for temporary tables | NO | NO | NO | | MRG_MYISAM | YES | Collection of identical MyISAM tables | NO | NO | NO | | CSV | YES | CSV storage engine | NO | NO | NO | | BLACKHOLE | YES | / dev / null storage engine ( anything you write to it disappears ) | NO | NO | NO | | MyISAM | YES | MyISAM storage engine | NO | NO | NO | | InnoDB | DEFAULT | Percona - XtraDB , Supports transactions , row - level locking , and foreign keys | YES | YES | YES | | ARCHIVE | YES | Archive storage engine | NO | NO | NO | | FEDERATED | YES | FederatedX pluggable storage engine | YES | NO | YES | | PERFORMANCE_SCHEMA | YES | Performance Schema | NO | NO | NO | | Aria | YES | Crash - safe tables with MyISAM heritage | NO | NO | NO | + --------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+ 10 rows in set ( 0 . 00 sec ) MySQL 5.5.5\u4e4b\u524d\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u662fMyISAM\uff0c\u540e\u7eed\u662fInnoDB\u3002","title":"1. \u67e5\u770b\u5f15\u64ce"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#2-myisam","text":"MyISAM \u662f MySQL \u7684 \u9ed8\u8ba4 \u5b58\u50a8\u5f15\u64ce\u3002MyISAM \u4e0d\u652f\u6301\u4e8b\u52a1\u3001\u4e5f\u4e0d\u652f\u6301\u5916\u952e\uff0c\u5176\u4f18\u52bf\u662f\u8bbf\u95ee\u901f\u5ea6\u5feb\u3002","title":"2. MyISAM"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#21","text":"\u6bcf\u4e2a MyISAM \u5728\u78c1\u76d8\u4e0a\u5b58\u50a8\u6210 3 \u4e2a\u6587\u4ef6\uff0c\u5176\u6587\u4ef6\u540d\u90fd\u548c\u8868\u540d\u76f8\u540c\uff0c\u4f46\u6269\u5c55\u540d\u5206\u522b\u662f\uff1a .frm\uff08\u5b58\u50a8\u8868\u5b9a\u4e49\uff09\uff1b .MYD\uff08MYData\uff0c\u5b58\u50a8\u6570\u636e\uff09\uff1b .MYI \uff08MYIndex\uff0c\u5b58\u50a8\u7d22\u5f15\uff09\u3002 \u6570\u636e\u6587\u4ef6\u548c\u7d22\u5f15\u6587\u4ef6\u53ef\u4ee5\u653e\u7f6e\u5728\u4e0d \u540c\u7684\u76ee\u5f55\uff0c\u5e73\u5747\u5206\u5e03 IO \uff0c\u83b7\u5f97\u66f4\u5feb\u7684\u901f\u5ea6\u3002 \u8981\u6307\u5b9a\u7d22\u5f15\u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\uff0c \u9700\u8981\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u901a\u8fc7 DATA DIRECTORY \u548c INDEX DIRECTORY \u8bed\u53e5\u6307\u5b9a\u3002\u6587\u4ef6\u8def\u5f84\u9700\u8981\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5e76\u4e14\u5177\u6709\u8bbf\u95ee\u6743\u9650\u3002 ALTER TABLE TEST DATA DIRECTORY = '/tmp/test/' , INDEX DIRECTORY = '/tmp/test/' ; \u5b9e\u9645\u6d4b\u8bd5\u4f1a\u53d1\u51fa\u53c2\u6570\u65e0\u6548\u7684\u8b66\u544a\uff08\u6682\u65f6\u6ca1\u627e\u5230\u539f\u56e0\uff0cTODO\uff09\uff1a + ---------+------+----------------------------------+ | Level | Code | Message | + ---------+------+----------------------------------+ | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | + ---------+------+----------------------------------+ MyISAM \u7c7b\u578b\u7684\u8868\u53ef\u80fd\u4f1a\u635f\u574f\uff0c\u4f1a\u63d0\u793a\u9700\u8981\u4fee\u590d\u6216\u8005\u8bbf\u95ee\u540e\u8fd4\u56de\u9519\u8bef\u7684\u7ed3\u679c\u3002","title":"2.1 \u5b58\u50a8\u65b9\u5f0f"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#22","text":"MyISAM \u7684\u8868\u53c8\u652f\u6301 3 \u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u5206\u522b\u662f\uff1a \u9759\u6001\uff08\u56fa\u5b9a\u957f\u5ea6\uff09\u8868\uff0c\u9ed8\u8ba4\u683c\u5f0f\u3002\u5b57\u6bb5\u90fd\u662f\u975e\u53d8\u957f\u5b57\u6bb5\u3002\u4f18\u70b9\u662f\u5b58\u50a8\u975e\u5e38\u8fc5\u901f\uff0c \u5bb9\u6613\u7f13\u5b58\uff0c \u51fa\u73b0\u6545\u969c\u5bb9\u6613\u6062\u590d\uff1b \u7f3a\u70b9\u662f\u5360\u7528\u7684\u7a7a\u95f4\u901a\u5e38\u6bd4\u52a8\u6001\u8868\u591a\u3002 \u9759\u6001\u8868\u7684\u6570\u636e\u5728\u5b58\u50a8\u7684\u65f6\u5019\u4f1a\u6309\u7167\u5217\u7684\u5bbd\u5ea6\u5b9a\u4e49\u8865\u8db3\u7a7a\u683c\uff0c \u4f46 \u662f\u5728\u5e94\u7528\u8bbf\u95ee\u7684\u65f6\u5019\u5e76\u4f1a\u5c06\u5c3e\u90e8\u7684\u7a7a\u683c\u5168\u90e8\u5220\u9664\u3002 CHAR \u548c VARCHAR \u53ef\u7528\uff0c\u4f46\u662f space-padded \uff0c \u7c7b\u578b\u4e0d\u53ef\u53d8\uff08\u5b9e\u9645\u6d4b\u8bd5\u53ef\u53d8\uff1f\uff1f\uff1f\uff09\u3002 \u52a8\u6001\u8868\u3002\u52a8\u6001\u8868\u4e2d\u5305\u542b\u53d8\u957f\u5b57\u6bb5\uff0c \u8bb0\u5f55\u4e0d\u662f\u56fa\u5b9a\u957f\u5ea6\u7684\uff0c \u8fd9\u6837\u5b58\u50a8\u7684\u4f18\u70b9\u662f\u5360\u7528\u7684\u7a7a\u95f4\u76f8\u5bf9\u8f83\u5c11\uff0c \u4f46 \u662f\u9891\u7e41\u5730\u66f4\u65b0\u5220\u9664\u8bb0\u5f55\u4f1a\u4ea7\u751f\u788e\u7247\uff08\u53ef\u6267\u884c\u547d\u4ee4\u6539\u5584\uff09\uff0c\u5e76\u4e14\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\u6062\u590d\u76f8\u5bf9\u6bd4\u8f83\u56f0\u96be\u3002 \u538b\u7f29\u8868\u3002\u538b\u7f29\u8868\u662f\u53ea\u8bfb\u7684\uff0c\u7531 myisampack \u5de5\u5177\u521b\u5efa\uff0c\u5360\u636e\u975e\u5e38\u5c0f\u7684\u78c1\u76d8\u7a7a\u95f4\u3002\u8bbf\u95ee\u5f00\u652f\u975e\u5e38\u5c0f\u3002 \u524d\u4e24\u79cd\u4f1a\u6839\u636e\u5b57\u6bb5\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u3002","title":"2.2 \u5b58\u50a8\u683c\u5f0f"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#3-innodb","text":"InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u5177\u6709\u63d0\u4ea4\u3001 \u56de\u6eda\u548c\u5d29\u6e83\u6062\u590d\u80fd\u529b\u7684\u4e8b\u52a1\u5b89\u5168\u3002\u4f46\u662f\u76f8\u5bf9\u4e8eMyISAM\u6548\u7387\u5dee\u5e76\u4e14\u7a7a\u95f4\u5360\u7528\u7387\u9ad8\u3002","title":"3. InnoDB"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#31","text":"InnoDB \u8868\u7684\u81ea\u52a8\u589e\u957f\u5217\u53ef\u4ee5\u624b\u5de5\u63d2\u5165\uff0c \u4f46\u662f\u63d2\u5165\u7684\u503c\u5982\u679c\u662f \u7a7a\u3001NULL\u6216\u8005 0 \uff0c \u5219\u5b9e\u9645\u63d2\u5165\u7684\u5c06\u662f\u81ea\u52a8\u589e\u957f\u540e\u7684\u503c\u3002 \u53ef\u4ee5\u901a\u8fc7 ALTER TABLE *** AUTO_INCREMENT = n; \u8bed\u53e5\u5f3a\u5236\u8bbe\u7f6e\u81ea\u52a8\u589e\u957f\u5217\u7684\u521d\u8bc6\u503c\uff0c\u9ed8\u8ba4\u662f1\u3002\u4f46\u662f\u5982\u679c\u672a\u4f7f\u7528\u8be5\u503c\u5e76\u91cd\u542f\u4e86\u6570\u636e\u5e93\u5219\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u3002","title":"3.1 \u81ea\u52a8\u589e\u957f\u5217"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#32","text":"MySQL \u652f\u6301\u5916\u952e\u7684\u5b58\u50a8\u5f15\u64ce\u53ea\u6709 InnoDB\uff0c\u5728\u521b\u5efa\u5916\u952e\u7684\u65f6\u5019\uff0c\u8981\u6c42\u7236\u8868\u5fc5\u987b\u6709\u5bf9\u5e94\u7684\u7d22\u5f15\uff0c\u5b50\u8868\u5728\u521b\u5efa\u5916\u952e\u7684\u65f6\u5019\u4e5f\u4f1a\u81ea\u52a8\u521b\u5efa\u5bf9\u5e94\u7684\u7d22\u5f15\u3002 \u5728\u521b\u5efa\u7d22\u5f15\u7684\u65f6\u5019\uff0c \u53ef\u4ee5\u6307\u5b9a\u5728\u5220\u9664\u3001 \u66f4\u65b0\u7236\u8868\u65f6\uff0c \u5bf9\u5b50\u8868\u8fdb\u884c\u7684\u76f8\u5e94\u64cd\u4f5c\uff0c \u5305 RESTRICT\u3001CASCADE\u3001SET NULL \u548c NO ACTION\u3002 RESTRICT \u548c NO ACTION \u76f8\u540c\uff0c\u662f\u6307\u9650\u5236\u5728\u5b50\u8868\u6709\u5173\u8054\u8bb0\u5f55\u7684\u60c5\u51b5\u4e0b\u7236\u8868\u4e0d\u80fd\u66f4\u65b0 CASCADE \u8868\u793a\u7236\u8868\u5728\u66f4\u65b0\u6216\u8005\u5220\u9664\u65f6\uff0c \u66f4\u65b0\u6216\u8005\u5220\u9664\u5b50\u8868\u5bf9\u5e94\u8bb0\u5f55 SET NULL \u5219\u8868\u793a\u7236\u8868\u5728\u66f4\u65b0\u6216\u8005\u5220\u9664\u7684\u65f6\u5019\uff0c\u5b50\u8868\u7684\u5bf9\u5e94\u5b57\u6bb5\u88abSET NULL \u6682\u65f6\u5173\u95ed/\u6253\u5f00\u5916\u952e\u7ea6\u675f\uff1a SET FOREIGN_KEY_CHECKS = 0; / SET FOREIGN_KEY_CHECKS = 1;","title":"3.2 \u5916\u952e\u7ea6\u675f"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#33","text":"InnoDB \u5b58\u50a8\u8868\u548c\u7d22\u5f15\u6709\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u3002","title":"3.3 \u5b58\u50a8\u65b9\u5f0f"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#331","text":"\u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7684\u8868\u7684\u8868\u7ed3\u6784\u4fdd\u5b58\u5728.frm \u6587\u4ef6\u4e2d\uff0c \u6570\u636e\u548c\u7d22\u5f15\u4fdd\u5b58\u5728 innodb_data_home_dir \u548c innodb_data_file_path \u5b9a\u4e49\u7684\u8868\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u662f\u591a\u4e2a\u6587\u4ef6\u3002","title":"3.3.1 \u5171\u4eab\u8868\u7a7a\u95f4\u5b58\u50a8"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#332","text":"\u8fd9\u79cd\u65b9\u5f0f\u521b\u5efa\u7684\u8868\u7684\u8868\u7ed3\u6784\u4ecd\u7136\u4fdd\u5b58\u5728.frm \u6587\u4ef6\u4e2d\uff0c \u4f46\u662f\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u5355\u72ec\u4fdd\u5b58\u5728.ibd \u4e2d\u3002\u5982\u679c\u662f\u4e2a\u5206\u533a\u8868\uff0c\u5219\u6bcf\u4e2a\u5206\u533a\u5bf9\u5e94\u5355\u72ec\u7684.ibd\u6587\u4ef6\uff0c \u6587\u4ef6\u540d\u662f \u201c\u8868\u540d+\u5206\u533a\u540d\u201d \uff0c \u53ef\u4ee5\u5728\u521b\u5efa\u5206\u533a\u7684\u65f6\u5019\u6307\u5b9a\u6bcf\u4e2a\u5206\u533a\u7684\u6570\u636e\u6587\u4ef6\u7684\u4f4d\u7f6e\uff0c\u4ee5\u6b64\u6765\u5c06\u8868\u7684 IO \u5747\u5300\u5206\u5e03\u5728\u591a\u4e2a\u78c1\u76d8\u4e0a\u3002 \u4f7f\u7528\u6b64\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u9700\u8981\u8bbe\u7f6e\u53c2\u6570 innodb_file_per_table \uff0c\u5e76\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u540e\u624d\u53ef\u4ee5\u751f\u6548\u3002 \u9ed8\u8ba4\u6253\u5f00\u7684 MariaDB [ MYISAM_TEST ] > SHOW VARIABLES LIKE 'innodb_file_per_table' ; + -----------------------+-------+ | Variable_name | Value | + -----------------------+-------+ | innodb_file_per_table | ON | + -----------------------+-------+ \u6ce8\u610f \uff1a\u5f53\u4f60\u4fee\u6539\u4e86\u5b58\u50a8\u65b9\u5f0f\u540e\uff0c\u53ea\u5bf9\u65b0\u5efa\u7684\u8868\u751f\u6548\uff0c\u539f\u6765\u7684\u8868\u4ecd\u7136\u4fdd\u6301\u539f\u5148\u7684\u5b58\u50a8\u65b9\u5f0f\u53ca\u8bbf\u95ee\u65b9\u5f0f\u3002 \u591a\u8868\u7a7a\u95f4\u7684\u6570\u636e\u6587\u4ef6 \u6ca1\u6709\u5927\u5c0f\u9650\u5236 \uff0c \u4e0d\u9700\u8981\u8bbe\u7f6e\u521d\u59cb\u5927\u5c0f\uff0c \u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e\u6587\u4ef6\u7684\u6700\u5927\u9650\u5236\u3001\u6269\u5c55\u5927\u5c0f\u7b49\u53c2\u6570\u3002 \u5982\u679c\u8981\u5c06\u5355\u8868\u6062\u590d\u5230\u76ee\u6807\u6570\u636e\u5e93\uff0c\u5219\u9700\u8981\u901a\u8fc7 mysqldump \u548c mysqlimport \u6765\u5b9e\u73b0\u3002 \u6ce8\u610f \uff1a\u5373\u4fbf\u5728\u591a\u8868\u7a7a\u95f4\u7684\u5b58\u50a8\u65b9\u5f0f\u4e0b\uff0c\u5171\u4eab\u8868\u7a7a\u95f4\u4ecd\u7136\u662f\u5fc5\u987b\u7684\uff0cInnoDB \u628a\u5185\u90e8\u6570\u636e\u8bcd\u5178\u548c\u5728\u7ebf\u91cd\u505a\u65e5\u5fd7\u653e\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002","title":"3.3.2 \u591a\u8868\u7a7a\u95f4\u5b58\u50a8"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#4-memory","text":"\u4f7f\u7528\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\u6765\u521b\u5efa\u8868\u3002\u6bcf\u4e2a MEMORY \u8868\u53ea\u5b9e\u9645\u5bf9\u5e94\u4e00\u4e2a\u78c1\u76d8\u6587\u4ef6\uff0c\u683c\u5f0f\u662f.frm\u3002 \u5b58\u50a8\u65b9\u5f0f \uff1a\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u56e0\u4e3a\u5b83\u7684\u6570\u636e\u662f\u653e\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4f7f\u7528 HASH \u7d22\u5f15\uff0c\u4f46\u662f\u4e00\u65e6\u670d\u52a1\u5173\u95ed\uff0c\u8868\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002 \u9002\u7528\u573a\u666f \uff1aMEMORY \u7c7b\u578b\u7684\u5b58\u50a8\u5f15\u64ce\u4e3b\u8981\u7528\u5728\u90a3\u4e9b\u5185\u5bb9\u53d8\u5316\u4e0d\u9891\u7e41\u7684\u4ee3\u7801\u8868\uff0c\u6216\u8005\u4f5c\u4e3a\u7edf\u8ba1\u64cd\u4f5c\u7684\u4e2d\u95f4\u7ed3\u679c\u8868\uff0c\u4fbf\u4e8e\u9ad8\u6548\u5730\u5bf9\u4e2d\u95f4\u7ed3\u679c\u8fdb\u884c\u5206\u6790\u5e76\u5f97\u5230\u6700\u7ec8\u7684\u7edf\u8ba1\u7ed3\u679c\u3002 MAX_ROWS \uff1a\u8fd9\u4e0d\u662f\u4e00\u4e2a\u786c\u6027\u9650\u5236\uff0c\u53ea\u662f\u63d0\u793a\u5b58\u50a8\u5f15\u64ce\u81f3\u5c11\u80fd\u591f\u5b58\u50a8\u8fd9\u4e48\u591a\u884c\u3002 MIN_ROWS \uff1a\u8ba1\u5212\u5728\u8868\u4e2d\u5b58\u50a8\u7684\u6700\u5c11\u884c\u6570\u3002MEMORY \u5c06\u8fd9\u4e2a\u9009\u9879\u770b\u4f5c\u5185\u5b58\u4f7f\u7528\u7684\u63d0\u793a\u3002","title":"4. MEMORY"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#5-mrg_myisam","text":"MRG_MyISAM \u5b58\u50a8\u5f15\u64ce\u662f\u4e00\u7ec4 MyISAM \u8868\u7684\u7ec4\u5408\uff0c \u8fd9\u4e9b MyISAM \u8868\u7ed3\u6784\u5fc5\u987b\u5b8c\u5168\u76f8\u540c\uff0c MRG_MyISAM\u8868\u672c\u8eab\u5e76\u6ca1\u6709\u6570\u636e\u3002 \u5bf9 MRG_MyISAM \u7c7b\u578b\u7684\u8868\u53ef\u4ee5\u8fdb\u884c \u67e5\u8be2\u3001\u66f4\u65b0\u3001\u5220\u9664 \u7684\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u5bf9\u5185\u90e8\u7684\u5b9e\u9645\u7684 MyISAM \u8868\u8fdb\u884c\u7684\u3002 \u5bf9\u4e8e MRG_MyISAM \u7c7b\u578b\u8868\u7684 \u63d2\u5165 \u64cd\u4f5c \uff0c\u662f\u901a\u8fc7INSERT_METHOD \u5b50\u53e5\u5b9a\u4e49\u63d2\u5165\u7684\u8868\uff0c\u53ef\u4ee5\u6709 3 \u4e2a\u4e0d\u540c\u7684\u503c\uff0c\u4f7f\u7528 FIRST \u6216 LAST \u503c\u4f7f\u5f97\u63d2\u5165\u64cd\u4f5c\u88ab\u76f8\u5e94\u5730\u4f5c\u7528\u5728\u7b2c\u4e00\u6216\u6700\u540e\u4e00\u4e2a\u8868\u4e0a\uff0c\u4e0d\u5b9a\u4e49\u8fd9\u4e2a\u5b50\u53e5\u6216\u8005\u5b9a\u4e49\u4e3a NO\uff0c\u8868\u793a\u4e0d\u80fd\u5bf9\u8fd9\u4e2a MRG_MyISAM \u8868\u6267\u884c\u63d2\u5165\u64cd\u4f5c\u3002 \u53ef\u4ee5\u5bf9 MRG_MyISAM \u8868\u8fdb\u884c DROP \u64cd\u4f5c\uff0c \u8fd9\u4e2a\u64cd\u4f5c \u53ea\u662f\u5220\u9664 MRG_MyISAM \u7684\u5b9a\u4e49 \uff0c \u5bf9\u5185\u90e8\u7684\u8868\u6ca1\u6709\u4efb\u4f55\u7684\u5f71\u54cd\u3002 \u5b58\u50a8\u65b9\u5f0f \uff1aMRG_MyISAM \u8868\u5728\u78c1\u76d8\u4e0a\u4fdd\u7559\u4e24\u4e2a\u6587\u4ef6\uff0c \u6587\u4ef6\u540d\u4ee5\u8868\u7684\u540d\u5b57\u5f00\u59cb\uff0c \u4e00\u4e2a.frm \u6587\u4ef6\u5b58\u50a8\u8868\u5b9a\u4e49\uff0c\u53e6\u4e00\u4e2a.MRG \u6587\u4ef6\u5305\u542b\u7ec4\u5408\u8868\u7684\u4fe1\u606f\uff0c \u5305\u62ec MRG_MyISAM \u8868\u7531\u54ea\u4e9b\u8868\u7ec4\u6210\u3001 \u63d2\u5165\u65b0\u7684\u6570\u636e\u65f6\u7684\u4f9d\u636e\u3002\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 .MRG \u6587\u4ef6\u6765\u4fee\u6539 MRG_MyISAM \u8868\uff0c\u4f46\u662f\u4fee\u6539\u540e\u8981\u901a\u8fc7 FLUSH TABLES \u5237\u65b0\u3002 # \u521b\u5efa MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST \\ G ; *************************** 1 . row *************************** Table : TEST Create Table : CREATE TABLE ` TEST ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 # \u521b\u5efa MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST2 \\ G ; *************************** 1 . row *************************** Table : TEST2 Create Table : CREATE TABLE ` TEST2 ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 # \u521b\u5efa MRG_MyISAM\u8868 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE TEST3 \\ G ; *************************** 1 . row *************************** Table : TEST3 Create Table : CREATE TABLE ` TEST3 ` ( ` NAME ` char ( 5 ) DEFAULT NULL ) ENGINE = MRG_MyISAM DEFAULT CHARSET = utf8 INSERT_METHOD = LAST UNION = ( ` TEST ` , ` TEST2 ` ) # \u5411\u5b50\u8868\u4e2d\u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO TEST VALUES ( 'SHI' ); MariaDB [ MYISAM_TEST ] > INSERT INTO TEST2 VALUES ( 'SHI2' ); # \u5728\u603b\u8868\u53ef\u4ee5\u67e5\u8be2\u5230\u6240\u6709\u7684\u6570\u636e MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST3 ; + ------+ | NAME | + ------+ | SHI | | SHI2 | + ------+ # \u5411\u603b\u8868\u4e2d\u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO TEST3 VALUES ( 'SHI3' ); # \u68c0\u7d22\u603b\u8868\u6570\u636e MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST3 ; + ------+ | NAME | + ------+ | SHI | | SHI2 | | SHI3 | + ------+ # \u5b9e\u9645\u5b58\u50a8\u5728\u5b50\u8868\u4e2d MariaDB [ MYISAM_TEST ] > SELECT * FROM TEST2 ; + ------+ | NAME | + ------+ | SHI2 | | SHI3 | + ------+ \u8fd9\u4e5f\u662f MRG_MyISAM \u8868\u548c\u5206\u533a\u8868\u7684\u533a\u522b\uff0c MRG_MyISAM \u8868\u5e76\u4e0d\u80fd\u667a\u80fd\u5730\u5c06\u8bb0\u5f55\u5199\u5230\u5bf9\u5e94\u7684\u8868\u4e2d\uff0c\u800c\u5206\u533a\u8868\u662f\u53ef\u4ee5\u7684\u3002","title":"5. MRG_MyISAM"},{"location":"mysql/11. MySQL\u5b58\u50a8\u5f15\u64ce/#6-tukodb","text":"\u7b2c\u4e09\u65b9\u5b58\u50a8\u5f15\u64ce\u3002 \u9ad8\u6027\u80fd\u3001\u652f\u6301\u4e8b\u52a1 \u9ad8\u6269\u5c55\u6027\u3001\u9ad8\u538b\u7f29\u7387\u3001\u9ad8\u6548\u7684\u5199\u5165\u6027\u80fd \u652f\u6301\u5927\u591a\u6570\u5728\u7ebfDDL\u64cd\u4f5c \u9002\u7528\u573a\u666f\uff1a \u65e5\u5fd7\u6570\u636e \u5386\u53f2\u6570\u636e \u5728\u7ebfDDL\u9891\u7e41\u7684\u573a\u666f","title":"6. TukoDB"},{"location":"mysql/12. MySQL\u6570\u636e\u7c7b\u578b\u7684\u9009\u62e9/","text":"1. CHAR \u4e0e VARCHAR 2. TEXT \u4e0e BLOB 3. \u6d6e\u70b9\u6570\u4e0e\u5b9a\u70b9\u6570 1. CHAR \u4e0e VARCHAR \u00b6 VARCHAR\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\u4f1a\u5360\u7528\u6bd4\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u591a\u4e00\u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\u3002 CHAR \u5728\u68c0\u7d22\u65f6\u4f1a\u5220\u6389\u5c3e\u90e8\u7684\u7a7a\u683c\u3002 CHAR \u7684\u5904\u7406\u901f\u5ea6\u6bd4VARCHAR \u5feb\u5f97\u591a\u3002 \u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5bf9 CHAR \u548c VARCHAR \u7684\u4f7f\u7528\u539f\u5219\u6709\u6240\u4e0d\u540c\uff1a MyISAM \u5b58\u50a8\u5f15\u64ce\uff1a\u5efa\u8bae\u4f7f\u7528 CHAR \u6570\u636e\u5217\u4ee3\u66ff VARCHAR \u7684\u6570\u636e\u5217\u3002 MEMORY \u5b58\u50a8\u5f15\u64ce\uff1a\u76ee\u524d\u90fd\u4f7f\u7528\u56fa\u5b9a\u957f\u5ea6\u7684\u6570\u636e\u884c\u5b58\u50a8\uff0c\u56e0\u6b64\u65e0\u8bba\u4f7f\u7528 CHAR \u6216 VARCHAR \u5217\u90fd\u6ca1\u6709\u5173\u7cfb\u3002\u4e24\u8005\u90fd\u662f\u4f5c\u4e3a CHAR \u7c7b\u578b\u5904\u7406\u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\uff1a\u5efa\u8bae\u4f7f\u7528 VARCHAR \u7c7b\u578b\u3002\u5bf9\u4e8e InnoDB \u6570\u636e\u8868\uff0c\u5185\u90e8\u7684\u884c\u5b58\u50a8\u683c\u5f0f\u6ca1\u6709\u533a\u5206\u56fa\u5b9a\u957f\u5ea6\u548c\u53ef\u53d8\u957f\u5ea6\u5217\uff08\u6240\u6709\u6570\u636e\u884c\u90fd\u4f7f\u7528\u6307\u5411\u6570\u636e\u5217\u503c\u7684\u5934\u6307\u9488\uff09\uff0c\u5e76\u4e14 CHAR \u5e73\u5747\u5360\u7528\u7684\u7a7a\u95f4\u591a\u4e8e VARCHAR\u3002 2. TEXT \u4e0e BLOB \u00b6 1.BLOB \u548c TEXT \u503c\u4f1a\u5f15\u8d77\u4e00\u4e9b\u6027\u80fd\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u6267\u884c\u4e86\u5927\u91cf\u7684\u5220\u9664\u64cd\u4f5c\u65f6\u3002\u5220\u9664\u64cd\u4f5c\u4f1a\u5728\u6570\u636e\u8868\u4e2d\u7559\u4e0b\u5f88\u5927\u7684 \u7a7a\u6d1e \uff0c\u4ee5\u540e\u586b\u5165\u8fd9\u4e9b\u201c\u7a7a\u6d1e\u201d\u7684\u8bb0\u5f55\u5728\u63d2\u5165\u7684\u6027\u80fd\u4e0a\u4f1a\u6709\u5f71\u54cd\u3002\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u5efa\u8bae\u5b9a\u671f\u4f7f\u7528 OPTIMIZE TABLE \u529f\u80fd\u5bf9\u8fd9\u7c7b\u8868\u8fdb\u884c\u788e\u7247\u6574\u7406\uff0c\u907f\u514d\u56e0\u4e3a\u201c\u7a7a\u6d1e\u201d\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff08InnoDB\u65e0\u9700\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002 2.\u53ef\u4ee5\u4f7f\u7528\u5408\u6210\u7684\uff08Synthetic\uff09\u7d22\u5f15\u6765\u63d0\u9ad8\u5927\u6587\u672c\u5b57\u6bb5\uff08BLOB \u6216 TEXT\uff09\u7684\u67e5\u8be2\u6027\u80fd\u3002\u7b80\u5355\u6765\u8bf4\uff0c \u5408\u6210\u7d22\u5f15\u5c31\u662f\u6839\u636e\u5927\u6587\u672c\u5b57\u6bb5\u7684\u5185\u5bb9\u5efa\u7acb\u4e00\u4e2a\u6563\u5217\u503c\uff08MD5()\u3001SHA1()\u6216 CRC32()\uff09\uff0c \u5e76\u628a\u8fd9\u4e2a\u503c\u5b58\u50a8\u5728\u5355\u72ec\u7684\u6570\u636e\u5217\u4e2d\uff0c \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u901a\u8fc7\u68c0\u7d22\u6563\u5217\u503c\u627e\u5230\u6570\u636e\u884c\u4e86\u3002 \u4f46\u662f\uff0c \u8981\u6ce8\u610f\u8fd9\u79cd\u6280\u672f\u53ea\u80fd\u7528\u4e8e\u7cbe\u786e\u5339\u914d\u7684\u67e5\u8be2\uff08\u6563\u5217\u503c\u5bf9\u4e8e\u7c7b\u4f3c<\u6216>=\u7b49\u8303\u56f4\u641c\u7d22\u64cd\u4f5c\u7b26\u662f\u6ca1\u6709\u7528\u5904\u7684\uff09\u3002 \u5982\u679c\u6563\u5217\u7b97\u6cd5\u751f\u6210\u7684\u5b57\u7b26\u4e32\u5e26\u6709\u5c3e\u90e8\u7a7a\u683c\uff0c\u5c31\u4e0d\u8981\u628a\u5b83\u4eec\u5b58\u50a8\u5728 CHAR \u6216 VARCHAR \u5217\u4e2d\uff0c\u5b83\u4eec\u4f1a\u53d7\u5230\u5c3e\u90e8\u7a7a\u683c\u53bb\u9664\u7684\u5f71\u54cd\u3002 MariaDB [ MYISAM_TEST ] > DESC HASH ; + ------------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | + ------------+-------------+------+-----+---------+----------------+ | ID | int ( 11 ) | NO | PRI | NULL | auto_increment | | STRING | varchar ( 5 ) | YES | | NULL | | | HASH_VALUE | varchar ( 40 ) | YES | | NULL | | + ------------+-------------+------+-----+---------+----------------+ MariaDB [ MYISAM_TEST ] > INSERT INTO HASH VALUES ( 0 , 'SHIHR' , MD5 ( 'SHIHR' )); MariaDB [ MYISAM_TEST ] > SELECT * FROM HASH WHERE HASH_VALUE = MD5 ( 'SHIHR' ); \u5982\u679c\u9700\u8981\u5bf9 BLOB \u6216\u8005 TEXT \u5b57\u6bb5\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c MySQL \u63d0\u4f9b\u4e86 \u524d\u7f00\u7d22\u5f15 \uff08\u6ce8\u610f\uff0c\u5e76\u4e0d\u662f\u8fd9\u4e24\u79cd\u7c7b\u578b\u7279\u6709\u7684\uff09\uff0c\u4e5f\u5c31\u662f\u53ea\u4e3a\u5b57\u6bb5\u7684\u524d n \u5217\u521b\u5efa\u7d22\u5f15\uff1a MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE BIGCONTENT \\ G ; Create Table : CREATE TABLE ` BIGCONTENT ` ( ` ID ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` CONTENT ` text , PRIMARY KEY ( ` ID ` ), KEY ` CONTENT ` ( ` CONTENT ` ( 5 )) ) ENGINE = MyISAM AUTO_INCREMENT = 12 DEFAULT CHARSET = utf8 # \u67e5\u8be2 MariaDB [ MYISAM_TEST ] > SELECT * FROM BIGCONTENT WHERE CONTENT LIKE 'SHIHR%' ; \u6ce8\u610f \uff1a\u53ea\u6709\u540e\u7f00 % \uff0c\u5982\u679c\u5e26\u6709\u524d\u7f00 % \uff0c\u5219\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u3002 3.\u5728\u4e0d\u5fc5\u8981\u7684\u65f6\u5019\u907f\u514d\u68c0\u7d22\u5927\u578b\u7684 BLOB \u6216 TEXT \u503c\u3002 4.\u628a BLOB \u6216 TEXT \u5217\u5206\u79bb\u5230\u5355\u72ec\u7684\u8868\u4e2d\u3002 \u8fd9\u4f1a\u51cf\u5c11\u4e3b\u8868\u4e2d\u7684\u788e\u7247\uff0c \u53ef\u4ee5\u5f97\u5230\u56fa\u5b9a\u957f\u5ea6\u6570\u636e\u884c\u7684\u6027\u80fd\u4f18\u52bf\u3002 3. \u6d6e\u70b9\u6570\u4e0e\u5b9a\u70b9\u6570 \u00b6 \u6d6e\u70b9\u6570\uff1afloat\u3001double\uff08real\uff09\uff0c\u622a\u65ad\u65f6\u56db\u820d\u4e94\u5165 \u5b9a\u70b9\u6570\uff1adecimal\uff08numberic\uff09\uff0c\u622a\u65ad\u65f6\u4e0d\u4f1a\u56db\u820d\u4e94\u5165 \u4e24\u8005\u5728\u63d2\u5165\u7684\u6570\u503c\u7684\u6574\u6570\u4f4d\u8d85\u8fc7\u7cbe\u5ea6\u4e4b\u540e\uff0c\u6240\u6709\u7684\u4f4d\u6570\u90fd\u53d8\u4e3a 9 \uff1b\u5c0f\u6570\u4f4d\u8d85\u8fc7\u7cbe\u5ea6\u540e\uff0c\u4f1a\u53d1\u751f\u622a\u65ad\u3002 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE FLOAT_NUM \\ G ; *************************** 1 . row *************************** Table : FLOAT_NUM Create Table : CREATE TABLE ` FLOAT_NUM ` ( ` F ` float ( 5 , 2 ) DEFAULT NULL , ` D ` decimal ( 5 , 2 ) DEFAULT NULL ) ENGINE = InnoDB DEFAULT CHARSET = utf8 MariaDB [ MYISAM_TEST ] > INSERT INTO FLOAT_NUM VALUE ( 2122324 . 3 , 2 . 322342 ); MariaDB [ MYISAM_TEST ] > INSERT INTO FLOAT_NUM VALUE ( 2 . 3432654 , 23545 . 42 ); MariaDB [ MYISAM_TEST ] > SELECT * FROM FLOAT_NUM ; + --------+--------+ | F | D | + --------+--------+ | 999 . 99 | 2 . 32 | | 2 . 34 | 999 . 99 | + --------+--------+ \u5373\u4f7f\u7cbe\u5ea6\u8db3\u591f\u4fdd\u5b58\u7684\u6570\u503c\uff0c\u6d6e\u70b9\u6570\u4e5f\u8fd8\u662f\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bef\u5dee\uff08\u8ba1\u7b97\u3001\u4fdd\u5b58\u7b49\uff09\u3002 \u5bf9\u8d27\u5e01\u7b49\u5bf9\u7cbe\u5ea6\u654f\u611f\u7684\u6570\u636e\uff0c\u5e94\u8be5\u7528\u5b9a\u70b9\u6570\u8868\u793a\u6216\u5b58\u50a8\uff1b \u5728\u7f16\u7a0b\u4e2d\uff0c\u5982\u679c\u7528\u5230\u6d6e\u70b9\u6570\uff0c\u8981\u7279\u522b\u6ce8\u610f\u8bef\u5dee\u95ee\u9898\uff0c\u5e76\u5c3d\u91cf\u907f\u514d\u505a\u6d6e\u70b9\u6570\u6bd4\u8f83\uff1b\u5728\u7f16\u7a0b\u4e2d\u5e94\u5c3d\u91cf\u907f\u514d\u6d6e\u70b9\u6570\u7684\u6bd4\u8f83\uff0c\u5982\u679c\u975e\u8981\u4f7f\u7528\u6d6e\u70b9\u6570\u6bd4\u8f83\u5219\u6700\u597d\u4f7f\u7528\u8303\u56f4\u6bd4\u8f83\u800c\u4e0d\u8981\u4f7f\u7528\u201c==\u201d\u6bd4\u8f83\u3002 \u8981\u6ce8\u610f\u6d6e\u70b9\u6570\u4e2d\u4e00\u4e9b\u7279\u6b8a\u503c\u7684\u5904\u7406\u3002","title":"12. MySQL\u6570\u636e\u7c7b\u578b\u7684\u9009\u62e9"},{"location":"mysql/12. MySQL\u6570\u636e\u7c7b\u578b\u7684\u9009\u62e9/#1-char-varchar","text":"VARCHAR\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\u4f1a\u5360\u7528\u6bd4\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u591a\u4e00\u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\u3002 CHAR \u5728\u68c0\u7d22\u65f6\u4f1a\u5220\u6389\u5c3e\u90e8\u7684\u7a7a\u683c\u3002 CHAR \u7684\u5904\u7406\u901f\u5ea6\u6bd4VARCHAR \u5feb\u5f97\u591a\u3002 \u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5bf9 CHAR \u548c VARCHAR \u7684\u4f7f\u7528\u539f\u5219\u6709\u6240\u4e0d\u540c\uff1a MyISAM \u5b58\u50a8\u5f15\u64ce\uff1a\u5efa\u8bae\u4f7f\u7528 CHAR \u6570\u636e\u5217\u4ee3\u66ff VARCHAR \u7684\u6570\u636e\u5217\u3002 MEMORY \u5b58\u50a8\u5f15\u64ce\uff1a\u76ee\u524d\u90fd\u4f7f\u7528\u56fa\u5b9a\u957f\u5ea6\u7684\u6570\u636e\u884c\u5b58\u50a8\uff0c\u56e0\u6b64\u65e0\u8bba\u4f7f\u7528 CHAR \u6216 VARCHAR \u5217\u90fd\u6ca1\u6709\u5173\u7cfb\u3002\u4e24\u8005\u90fd\u662f\u4f5c\u4e3a CHAR \u7c7b\u578b\u5904\u7406\u3002 InnoDB \u5b58\u50a8\u5f15\u64ce\uff1a\u5efa\u8bae\u4f7f\u7528 VARCHAR \u7c7b\u578b\u3002\u5bf9\u4e8e InnoDB \u6570\u636e\u8868\uff0c\u5185\u90e8\u7684\u884c\u5b58\u50a8\u683c\u5f0f\u6ca1\u6709\u533a\u5206\u56fa\u5b9a\u957f\u5ea6\u548c\u53ef\u53d8\u957f\u5ea6\u5217\uff08\u6240\u6709\u6570\u636e\u884c\u90fd\u4f7f\u7528\u6307\u5411\u6570\u636e\u5217\u503c\u7684\u5934\u6307\u9488\uff09\uff0c\u5e76\u4e14 CHAR \u5e73\u5747\u5360\u7528\u7684\u7a7a\u95f4\u591a\u4e8e VARCHAR\u3002","title":"1. CHAR \u4e0e VARCHAR"},{"location":"mysql/12. MySQL\u6570\u636e\u7c7b\u578b\u7684\u9009\u62e9/#2-text-blob","text":"1.BLOB \u548c TEXT \u503c\u4f1a\u5f15\u8d77\u4e00\u4e9b\u6027\u80fd\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u6267\u884c\u4e86\u5927\u91cf\u7684\u5220\u9664\u64cd\u4f5c\u65f6\u3002\u5220\u9664\u64cd\u4f5c\u4f1a\u5728\u6570\u636e\u8868\u4e2d\u7559\u4e0b\u5f88\u5927\u7684 \u7a7a\u6d1e \uff0c\u4ee5\u540e\u586b\u5165\u8fd9\u4e9b\u201c\u7a7a\u6d1e\u201d\u7684\u8bb0\u5f55\u5728\u63d2\u5165\u7684\u6027\u80fd\u4e0a\u4f1a\u6709\u5f71\u54cd\u3002\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u5efa\u8bae\u5b9a\u671f\u4f7f\u7528 OPTIMIZE TABLE \u529f\u80fd\u5bf9\u8fd9\u7c7b\u8868\u8fdb\u884c\u788e\u7247\u6574\u7406\uff0c\u907f\u514d\u56e0\u4e3a\u201c\u7a7a\u6d1e\u201d\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff08InnoDB\u65e0\u9700\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09\u3002 2.\u53ef\u4ee5\u4f7f\u7528\u5408\u6210\u7684\uff08Synthetic\uff09\u7d22\u5f15\u6765\u63d0\u9ad8\u5927\u6587\u672c\u5b57\u6bb5\uff08BLOB \u6216 TEXT\uff09\u7684\u67e5\u8be2\u6027\u80fd\u3002\u7b80\u5355\u6765\u8bf4\uff0c \u5408\u6210\u7d22\u5f15\u5c31\u662f\u6839\u636e\u5927\u6587\u672c\u5b57\u6bb5\u7684\u5185\u5bb9\u5efa\u7acb\u4e00\u4e2a\u6563\u5217\u503c\uff08MD5()\u3001SHA1()\u6216 CRC32()\uff09\uff0c \u5e76\u628a\u8fd9\u4e2a\u503c\u5b58\u50a8\u5728\u5355\u72ec\u7684\u6570\u636e\u5217\u4e2d\uff0c \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u901a\u8fc7\u68c0\u7d22\u6563\u5217\u503c\u627e\u5230\u6570\u636e\u884c\u4e86\u3002 \u4f46\u662f\uff0c \u8981\u6ce8\u610f\u8fd9\u79cd\u6280\u672f\u53ea\u80fd\u7528\u4e8e\u7cbe\u786e\u5339\u914d\u7684\u67e5\u8be2\uff08\u6563\u5217\u503c\u5bf9\u4e8e\u7c7b\u4f3c<\u6216>=\u7b49\u8303\u56f4\u641c\u7d22\u64cd\u4f5c\u7b26\u662f\u6ca1\u6709\u7528\u5904\u7684\uff09\u3002 \u5982\u679c\u6563\u5217\u7b97\u6cd5\u751f\u6210\u7684\u5b57\u7b26\u4e32\u5e26\u6709\u5c3e\u90e8\u7a7a\u683c\uff0c\u5c31\u4e0d\u8981\u628a\u5b83\u4eec\u5b58\u50a8\u5728 CHAR \u6216 VARCHAR \u5217\u4e2d\uff0c\u5b83\u4eec\u4f1a\u53d7\u5230\u5c3e\u90e8\u7a7a\u683c\u53bb\u9664\u7684\u5f71\u54cd\u3002 MariaDB [ MYISAM_TEST ] > DESC HASH ; + ------------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | + ------------+-------------+------+-----+---------+----------------+ | ID | int ( 11 ) | NO | PRI | NULL | auto_increment | | STRING | varchar ( 5 ) | YES | | NULL | | | HASH_VALUE | varchar ( 40 ) | YES | | NULL | | + ------------+-------------+------+-----+---------+----------------+ MariaDB [ MYISAM_TEST ] > INSERT INTO HASH VALUES ( 0 , 'SHIHR' , MD5 ( 'SHIHR' )); MariaDB [ MYISAM_TEST ] > SELECT * FROM HASH WHERE HASH_VALUE = MD5 ( 'SHIHR' ); \u5982\u679c\u9700\u8981\u5bf9 BLOB \u6216\u8005 TEXT \u5b57\u6bb5\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c MySQL \u63d0\u4f9b\u4e86 \u524d\u7f00\u7d22\u5f15 \uff08\u6ce8\u610f\uff0c\u5e76\u4e0d\u662f\u8fd9\u4e24\u79cd\u7c7b\u578b\u7279\u6709\u7684\uff09\uff0c\u4e5f\u5c31\u662f\u53ea\u4e3a\u5b57\u6bb5\u7684\u524d n \u5217\u521b\u5efa\u7d22\u5f15\uff1a MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE BIGCONTENT \\ G ; Create Table : CREATE TABLE ` BIGCONTENT ` ( ` ID ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` CONTENT ` text , PRIMARY KEY ( ` ID ` ), KEY ` CONTENT ` ( ` CONTENT ` ( 5 )) ) ENGINE = MyISAM AUTO_INCREMENT = 12 DEFAULT CHARSET = utf8 # \u67e5\u8be2 MariaDB [ MYISAM_TEST ] > SELECT * FROM BIGCONTENT WHERE CONTENT LIKE 'SHIHR%' ; \u6ce8\u610f \uff1a\u53ea\u6709\u540e\u7f00 % \uff0c\u5982\u679c\u5e26\u6709\u524d\u7f00 % \uff0c\u5219\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u3002 3.\u5728\u4e0d\u5fc5\u8981\u7684\u65f6\u5019\u907f\u514d\u68c0\u7d22\u5927\u578b\u7684 BLOB \u6216 TEXT \u503c\u3002 4.\u628a BLOB \u6216 TEXT \u5217\u5206\u79bb\u5230\u5355\u72ec\u7684\u8868\u4e2d\u3002 \u8fd9\u4f1a\u51cf\u5c11\u4e3b\u8868\u4e2d\u7684\u788e\u7247\uff0c \u53ef\u4ee5\u5f97\u5230\u56fa\u5b9a\u957f\u5ea6\u6570\u636e\u884c\u7684\u6027\u80fd\u4f18\u52bf\u3002","title":"2. TEXT \u4e0e BLOB"},{"location":"mysql/12. MySQL\u6570\u636e\u7c7b\u578b\u7684\u9009\u62e9/#3","text":"\u6d6e\u70b9\u6570\uff1afloat\u3001double\uff08real\uff09\uff0c\u622a\u65ad\u65f6\u56db\u820d\u4e94\u5165 \u5b9a\u70b9\u6570\uff1adecimal\uff08numberic\uff09\uff0c\u622a\u65ad\u65f6\u4e0d\u4f1a\u56db\u820d\u4e94\u5165 \u4e24\u8005\u5728\u63d2\u5165\u7684\u6570\u503c\u7684\u6574\u6570\u4f4d\u8d85\u8fc7\u7cbe\u5ea6\u4e4b\u540e\uff0c\u6240\u6709\u7684\u4f4d\u6570\u90fd\u53d8\u4e3a 9 \uff1b\u5c0f\u6570\u4f4d\u8d85\u8fc7\u7cbe\u5ea6\u540e\uff0c\u4f1a\u53d1\u751f\u622a\u65ad\u3002 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE FLOAT_NUM \\ G ; *************************** 1 . row *************************** Table : FLOAT_NUM Create Table : CREATE TABLE ` FLOAT_NUM ` ( ` F ` float ( 5 , 2 ) DEFAULT NULL , ` D ` decimal ( 5 , 2 ) DEFAULT NULL ) ENGINE = InnoDB DEFAULT CHARSET = utf8 MariaDB [ MYISAM_TEST ] > INSERT INTO FLOAT_NUM VALUE ( 2122324 . 3 , 2 . 322342 ); MariaDB [ MYISAM_TEST ] > INSERT INTO FLOAT_NUM VALUE ( 2 . 3432654 , 23545 . 42 ); MariaDB [ MYISAM_TEST ] > SELECT * FROM FLOAT_NUM ; + --------+--------+ | F | D | + --------+--------+ | 999 . 99 | 2 . 32 | | 2 . 34 | 999 . 99 | + --------+--------+ \u5373\u4f7f\u7cbe\u5ea6\u8db3\u591f\u4fdd\u5b58\u7684\u6570\u503c\uff0c\u6d6e\u70b9\u6570\u4e5f\u8fd8\u662f\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bef\u5dee\uff08\u8ba1\u7b97\u3001\u4fdd\u5b58\u7b49\uff09\u3002 \u5bf9\u8d27\u5e01\u7b49\u5bf9\u7cbe\u5ea6\u654f\u611f\u7684\u6570\u636e\uff0c\u5e94\u8be5\u7528\u5b9a\u70b9\u6570\u8868\u793a\u6216\u5b58\u50a8\uff1b \u5728\u7f16\u7a0b\u4e2d\uff0c\u5982\u679c\u7528\u5230\u6d6e\u70b9\u6570\uff0c\u8981\u7279\u522b\u6ce8\u610f\u8bef\u5dee\u95ee\u9898\uff0c\u5e76\u5c3d\u91cf\u907f\u514d\u505a\u6d6e\u70b9\u6570\u6bd4\u8f83\uff1b\u5728\u7f16\u7a0b\u4e2d\u5e94\u5c3d\u91cf\u907f\u514d\u6d6e\u70b9\u6570\u7684\u6bd4\u8f83\uff0c\u5982\u679c\u975e\u8981\u4f7f\u7528\u6d6e\u70b9\u6570\u6bd4\u8f83\u5219\u6700\u597d\u4f7f\u7528\u8303\u56f4\u6bd4\u8f83\u800c\u4e0d\u8981\u4f7f\u7528\u201c==\u201d\u6bd4\u8f83\u3002 \u8981\u6ce8\u610f\u6d6e\u70b9\u6570\u4e2d\u4e00\u4e9b\u7279\u6b8a\u503c\u7684\u5904\u7406\u3002","title":"3. \u6d6e\u70b9\u6570\u4e0e\u5b9a\u70b9\u6570"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/","text":"1. \u6821\u5bf9\u89c4\u5219 1.1 \u67e5\u8be2 1.2 \u547d\u540d\u7ea6\u5b9a 2. \u5b57\u7b26\u96c6\u7684\u8bbe\u7f6e 2.1 \u67e5\u8be2\u8bbe\u7f6e\u7684\u5b57\u7b26\u96c6\u548c\u89c4\u5219 2.2 \u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 2.3 \u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 2.4 \u8868\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 2.5 \u5217\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 2.6 \u8fde\u63a5\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 3. \u5b57\u7b26\u96c6\u7684\u4fee\u6539\u6b65\u9aa4 3.1 1. \u5bfc\u51fa\u8868\u7ed3\u6784 3.2 2. \u624b\u5de5\u4fee\u6539 createblog.sql \u4e2d\u8868\u7ed3\u6784\u5b9a\u4e49\u4e2d\u7684\u5b57\u7b26\u96c6\u4e3a\u65b0\u7684\u5b57\u7b26\u96c6\u3002 3.3 3. \u786e\u4fdd\u8bb0\u5f55\u4e0d\u518d\u66f4\u65b0\uff0c\u5bfc\u51fa\u6240\u6709\u8bb0\u5f55\u3002 3.4 4. \u6253\u5f00 blogdata.sql\uff0c\u5c06 SET NAMES utf8 \u4fee\u6539\u6210 SET NAMES gbk\u3002 3.5 5. \u4f7f\u7528\u65b0\u7684\u5b57\u7b26\u96c6\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u3002 3.6 6. \u521b\u5efa\u8868\uff0c\u6267\u884c createblog.sql\u3002 3.7 7. \u5bfc\u5165\u6570\u636e\uff0c\u6267\u884c data.sql\u3002 MySQL \u7684\u5b57\u7b26\u96c6\u5305\u62ec\u5b57\u7b26\u96c6\uff08 CHARACTER \uff09\u548c\u6821\u5bf9\u89c4\u5219\uff08 COLLATION \uff09\u4e24\u4e2a\u6982\u5ff5\u3002\u5b57\u7b26 \u96c6\u662f\u7528\u6765\u5b9a\u4e49 MySQL \u5b58\u50a8\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\uff0c\u6821\u5bf9\u89c4\u5219\u5219\u662f\u5b9a\u4e49\u4e86\u6bd4\u8f83\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u3002\u5b57\u7b26\u96c6 \u548c\u6821\u5bf9\u89c4\u5219\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002 1. \u6821\u5bf9\u89c4\u5219 \u00b6 1.1 \u67e5\u8be2 \u00b6 \u67e5\u770b\u6709\u54ea\u4e9b\u5b57\u7b26\u96c6\uff1a SHOW CHARACTER SET LIKE '%***%'; MariaDB [ MYISAM_TEST ] > SHOW CHARACTER SET LIKE '%GBK%' ; + ---------+------------------------+-------------------+--------+ | Charset | Description | Default collation | Maxlen | + ---------+------------------------+-------------------+--------+ | gbk | GBK Simplified Chinese | gbk_chinese_ci | 2 | + ---------+------------------------+-------------------+--------+ \u67e5\u770b\u6709\u54ea\u4e9b\u5b57\u7b26\u96c6\u7684\u6821\u5bf9\u89c4\u5219\uff1a SHOW COLLATION LIKE '%***%'; MariaDB [ MYISAM_TEST ] > SHOW COLLATION LIKE '%utf8%' ; + --------------------------+---------+-----+---------+----------+---------+ | Collation | Charset | Id | Default | Compiled | Sortlen | + --------------------------+---------+-----+---------+----------+---------+ | utf8_general_ci | utf8 | 33 | Yes | Yes | 1 | | utf8_bin | utf8 | 83 | | Yes | 1 | | utf8_unicode_ci | utf8 | 192 | | Yes | 8 | | utf8_icelandic_ci | utf8 | 193 | | Yes | 8 | 1.2 \u547d\u540d\u7ea6\u5b9a \u00b6 \u5b83\u4eec\u4ee5\u5176\u76f8\u5173\u7684\u5b57\u7b26\u96c6\u540d\u5f00\u59cb\uff0c\u901a\u5e38\u5305\u62ec\u4e00\u4e2a\u8bed\u8a00\u540d\uff0c\u5e76\u4e14\u4ee5 _ci\uff08\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff09\u3001 _cs \uff08\u5927\u5c0f\u5199\u654f\u611f\uff09 \u6216_bin \uff08\u4e8c\u5143\uff0c \u5373\u6bd4\u8f83\u662f\u57fa\u4e8e\u5b57\u7b26\u7f16\u7801\u7684\u503c\u800c\u4e0elanguage\u65e0\u5173\uff09 \u7ed3\u675f\u3002 MariaDB [ MYISAM_TEST ] > SELECT CASE WHEN ( 'SHIHR' COLLATE utf8_bin ) = 'shihr' THEN 1 ELSE 0 END ; + ------------------------------------------------------------------+ | CASE WHEN ( 'SHIHR' COLLATE utf8_bin ) = 'shihr' THEN 1 ELSE 0 END | + ------------------------------------------------------------------+ | 0 | + ------------------------------------------------------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > SELECT CASE WHEN ( 'SHIHR' COLLATE utf8_general_ci ) = 'shihr' THEN 1 ELSE 0 END ; + -------------------------------------------------------------------------+ | CASE WHEN ( 'SHIHR' COLLATE utf8_general_ci ) = 'shihr' THEN 1 ELSE 0 END | + -------------------------------------------------------------------------+ | 1 | + -------------------------------------------------------------------------+ 1 row in set ( 0 . 00 sec ) 2. \u5b57\u7b26\u96c6\u7684\u8bbe\u7f6e \u00b6 MySQL \u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u6709 4 \u4e2a\u7ea7\u522b\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff1a \u670d\u52a1\u5668\u7ea7\u3001\u6570\u636e\u5e93\u7ea7\u3001\u8868\u7ea7\u548c\u5b57\u6bb5\u7ea7 \u3002\u5b83\u4eec\u5206\u522b\u5728\u4e0d\u540c\u7684\u5730\u65b9\u8bbe\u7f6e\uff0c\u4f5c\u7528\u4e5f\u4e0d\u76f8\u540c\u3002\u5982\u679c\u53ea\u6307\u5b9a\u4e86\u5b57\u7b26\u96c6\uff0c\u90a3\u4e48\u4f7f\u7528\u9ed8\u8ba4\u7684\u6821\u5bf9\u89c4\u5219\u3002 2.1 \u67e5\u8be2\u8bbe\u7f6e\u7684\u5b57\u7b26\u96c6\u548c\u89c4\u5219 \u00b6 SHOW VARIABLES LIKE 'CHARACTER_SET_%' ; SHOW VARIABLES LIKE 'COLLATION_%' ; 2.2 \u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 \u00b6 \u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\uff0c\u5728 MySQL \u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\u786e\u5b9a\u3002 \u53ef\u4ee5\u5728 my.cnf \u4e2d\u8bbe\u7f6e\uff1a [mysqld] default-character-set=gbk \u6216\u8005\u5728\u542f\u52a8\u9009\u9879\u4e2d\u6307\u5b9a\uff1a mysqld --default-character-set=gbk \u6216\u8005\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u6307\u5b9a\uff1a ./configure --with-charset=gbk 2.3 \u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 \u00b6 \u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u5728\u521b\u5efa\u6570\u636e\u5e93\u7684\u65f6\u5019\u6307\u5b9a\uff0c \u4e5f\u53ef\u4ee5\u5728\u521b\u5efa\u5b8c\u6570\u636e\u5e93\u540e\u901a\u8fc7 alter database \u547d\u4ee4\u8fdb\u884c\u4fee\u6539\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c \u5219\u4f7f\u7528\u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002 ALTER { DATABASE | SCHEMA } [ db_name ] alter_specification ... alter_specification : [ DEFAULT ] CHARACTER SET [ = ] charset_name | [ DEFAULT ] COLLATE [ = ] collation_name \u6ce8\u610f \uff1a\u5982\u679c\u6570\u636e\u5e93\u91cc\u5df2\u7ecf\u5b58\u5728\u6570\u636e\uff0c\u56e0\u4e3a\u4fee\u6539\u5b57\u7b26\u96c6\u5e76\u4e0d\u80fd\u5c06\u5df2\u6709\u7684\u6570\u636e\u6309\u7167\u65b0\u7684\u5b57\u7b26\u96c6\u8fdb\u884c\u5b58\u653e\u3002 2.4 \u8868\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 \u00b6 \u540c\u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c \u4f7f\u7528\u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u4f5c\u4e3a\u8868\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002 2.5 \u5217\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 \u00b6 \u540c\u8868\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u7279\u522b\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528\u8868\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002 2.6 \u8fde\u63a5\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219 \u00b6 \u5bf9\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7684\u4ea4\u4e92\u64cd\u4f5c\uff0cMylSQL \u63d0\u4f9b\u4e86 3 \u4e2a\u4e0d\u540c\u7684\u53c2\u6570\uff1a character_set_client\u3001character_set_connection \u548c character_set_results \uff0c \u5206\u522b\u4ee3\u8868 \u5ba2\u6237\u7aef\u3001 \u8fde\u63a5\u548c\u8fd4\u56de\u7ed3\u679c \u7684\u5b57\u7b26 \u96c6\uff0c \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c \u8fd9 3 \u4e2a\u5b57\u7b26\u96c6\u5e94\u8be5\u662f\u76f8\u540c\u7684\uff0c \u624d\u53ef\u4ee5\u786e\u4fdd\u7528\u6237\u5199\u5165\u7684\u6570\u636e\u53ef\u4ee5\u6b63\u786e\u5730\u8bfb\u51fa\u3002 \u53ef\u901a\u8fc7 SET NAMES ***; \u7edf\u4e00\u8bbe\u7f6e\u8fd9\u4e09\u4e2a\u53d8\u91cf\uff0c\u4f46\u8fd9\u662f\u4e34\u65f6\u7684\uff0c\u91cd\u65b0\u8fde\u63a5\u6570\u636e\u5e93\u540e\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u5728 my.cnf.d/mysql-clients.cnf \u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u8bed\u53e5\uff1a [mysql] default-character-set=gbk \u8fd9\u6837\u670d\u52a1\u5668\u542f\u52a8\u540e\uff0c\u6240\u6709\u8fde\u63a5\u9ed8\u8ba4\u5c31\u662f\u4f7f\u7528 GBK \u5b57\u7b26\u96c6\u8fdb\u884c\u8fde\u63a5\u7684\uff0c\u800c\u4e0d\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u518d\u6267\u884c set names \u547d\u4ee4\u3002 3. \u5b57\u7b26\u96c6\u7684\u4fee\u6539\u6b65\u9aa4 \u00b6 \u5df2\u6709\u8bb0\u5f55\u7684\u5b57\u7b26\u96c6\u8c03\u6574\uff0c\u9700\u8981\u5148\u5c06\u6570\u636e\u5bfc\u51fa\uff0c\u7ecf\u8fc7\u9002\u5f53\u7684\u8c03\u6574\u91cd\u65b0\u5bfc\u5165\u540e\u624d\u53ef\u5b8c\u6210\u3002 \u4ee5\u4e0b\u6a21\u62df\u7684\u662f\u5c06 utf8 \u5b57\u7b26\u96c6\u7684\u6570\u636e\u5e93\u4fee\u6539\u6210 GBK \u5b57\u7b26\u96c6\u7684\u6570\u636e\u5e93\u7684\u8fc7\u7a0b\u3002 3.1 1. \u5bfc\u51fa\u8868\u7ed3\u6784 \u00b6 mysqldump -uroot -pabcd1234 --default-character-set = gbk -d blog > createblog.sql --default-character-set=gbk\uff1a\u8868\u793a\u8bbe\u7f6e\u4ee5\u4ec0\u4e48\u5b57\u7b26\u96c6\u8fde\u63a5 -d\uff1a\u8868\u793a\u53ea\u5bfc\u51fa\u8868\u7ed3\u6784\uff0c\u4e0d\u5bfc\u51fa\u6570\u636e 3.2 2. \u624b\u5de5\u4fee\u6539 createblog.sql \u4e2d\u8868\u7ed3\u6784\u5b9a\u4e49\u4e2d\u7684\u5b57\u7b26\u96c6\u4e3a\u65b0\u7684\u5b57\u7b26\u96c6\u3002 \u00b6 3.3 3. \u786e\u4fdd\u8bb0\u5f55\u4e0d\u518d\u66f4\u65b0\uff0c\u5bfc\u51fa\u6240\u6709\u8bb0\u5f55\u3002 \u00b6 mysqldump -uroot -pabcd1234 --quick --no-create-info --extended-insert --default-character-set = utf8 blog > blogdata.sql --quick\uff1a\u8be5\u9009\u9879\u7528\u4e8e\u8f6c\u50a8\u5927\u7684\u8868\u3002\u5b83\u5f3a\u5236 mysqldump \u4ece\u670d\u52a1\u5668\u4e00\u6b21\u4e00\u884c\u5730\u68c0\u7d22\u8868\u4e2d \u7684\u884c\u800c\u4e0d\u662f\u68c0\u7d22\u6240\u6709\u884c\uff0c\u5e76\u5728\u8f93\u51fa\u524d\u5c06\u5b83\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\u3002 --extended-insert\uff1a\u4f7f\u7528\u5305\u62ec\u51e0\u4e2a VALUES \u5217\u8868\u7684\u591a\u884c INSERT \u8bed\u6cd5\u3002\u8fd9\u6837\u4f7f\u8f6c\u50a8\u6587\u4ef6 \u66f4\u5c0f\uff0c\u91cd\u8f7d\u6587\u4ef6\u65f6\u53ef\u4ee5\u52a0\u901f\u63d2\u5165\u3002 --no-create-info\uff1a\u4e0d\u5199\u91cd\u65b0\u521b\u5efa\u6bcf\u4e2a\u8f6c\u50a8\u8868\u7684 CREATE TABLE \u8bed\u53e5\u3002 --default-character-set=latin1\uff1a \u6309\u7167\u539f\u6709\u7684\u5b57\u7b26\u96c6\u5bfc\u51fa\u6240\u6709\u6570\u636e\uff0c \u8fd9\u6837\u5bfc\u51fa\u7684\u6587\u4ef6\u4e2d\uff0c \u6240\u6709\u4e2d\u6587\u90fd\u662f\u53ef\u89c1\u7684\uff0c\u4e0d\u4f1a\u4fdd\u5b58\u6210\u4e71\u7801\u3002 3.4 4. \u6253\u5f00 blogdata.sql\uff0c\u5c06 SET NAMES utf8 \u4fee\u6539\u6210 SET NAMES gbk\u3002 \u00b6 3.5 5. \u4f7f\u7528\u65b0\u7684\u5b57\u7b26\u96c6\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u3002 \u00b6 CREATE DATABASE blog_back DEFAULT CHARACTER SET gbk ; 3.6 6. \u521b\u5efa\u8868\uff0c\u6267\u884c createblog.sql\u3002 \u00b6 mysql -uroot -pabcd1234 blog_back < createblog.sql 3.7 7. \u5bfc\u5165\u6570\u636e\uff0c\u6267\u884c data.sql\u3002 \u00b6 mysql -uroot -pabcd1234 blog_back < blogdata.sql \u6ce8\u610f \uff1a\u9009\u62e9\u76ee\u6807\u5b57\u7b26\u96c6\u7684\u65f6\u5019\uff0c\u8981\u6ce8\u610f\u6700\u597d\u662f\u6e90\u5b57\u7b26\u96c6\u7684\u8d85\u96c6\uff0c\u6216\u8005\u786e\u5b9a\u6bd4\u6e90\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\u66f4\u5927\uff0c\u5426\u5219\u5982\u679c\u76ee\u6807\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\u5c0f\u4e8e\u6e90\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\uff0c\u90a3\u4e48\u76ee\u6807\u5b57\u7b26\u96c6\u4e2d\u4e0d\u652f\u6301\u7684\u5b57\u7b26\u5bfc\u5165\u540e\u4f1a\u53d8\u6210\u4e71\u7801\uff0c\u4e22\u5931\u4e00\u90e8\u5206\u6570\u636e\u3002","title":"13. MySQL\u5b57\u7b26\u96c6"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#1","text":"","title":"1. \u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#11","text":"\u67e5\u770b\u6709\u54ea\u4e9b\u5b57\u7b26\u96c6\uff1a SHOW CHARACTER SET LIKE '%***%'; MariaDB [ MYISAM_TEST ] > SHOW CHARACTER SET LIKE '%GBK%' ; + ---------+------------------------+-------------------+--------+ | Charset | Description | Default collation | Maxlen | + ---------+------------------------+-------------------+--------+ | gbk | GBK Simplified Chinese | gbk_chinese_ci | 2 | + ---------+------------------------+-------------------+--------+ \u67e5\u770b\u6709\u54ea\u4e9b\u5b57\u7b26\u96c6\u7684\u6821\u5bf9\u89c4\u5219\uff1a SHOW COLLATION LIKE '%***%'; MariaDB [ MYISAM_TEST ] > SHOW COLLATION LIKE '%utf8%' ; + --------------------------+---------+-----+---------+----------+---------+ | Collation | Charset | Id | Default | Compiled | Sortlen | + --------------------------+---------+-----+---------+----------+---------+ | utf8_general_ci | utf8 | 33 | Yes | Yes | 1 | | utf8_bin | utf8 | 83 | | Yes | 1 | | utf8_unicode_ci | utf8 | 192 | | Yes | 8 | | utf8_icelandic_ci | utf8 | 193 | | Yes | 8 |","title":"1.1 \u67e5\u8be2"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#12","text":"\u5b83\u4eec\u4ee5\u5176\u76f8\u5173\u7684\u5b57\u7b26\u96c6\u540d\u5f00\u59cb\uff0c\u901a\u5e38\u5305\u62ec\u4e00\u4e2a\u8bed\u8a00\u540d\uff0c\u5e76\u4e14\u4ee5 _ci\uff08\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff09\u3001 _cs \uff08\u5927\u5c0f\u5199\u654f\u611f\uff09 \u6216_bin \uff08\u4e8c\u5143\uff0c \u5373\u6bd4\u8f83\u662f\u57fa\u4e8e\u5b57\u7b26\u7f16\u7801\u7684\u503c\u800c\u4e0elanguage\u65e0\u5173\uff09 \u7ed3\u675f\u3002 MariaDB [ MYISAM_TEST ] > SELECT CASE WHEN ( 'SHIHR' COLLATE utf8_bin ) = 'shihr' THEN 1 ELSE 0 END ; + ------------------------------------------------------------------+ | CASE WHEN ( 'SHIHR' COLLATE utf8_bin ) = 'shihr' THEN 1 ELSE 0 END | + ------------------------------------------------------------------+ | 0 | + ------------------------------------------------------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > SELECT CASE WHEN ( 'SHIHR' COLLATE utf8_general_ci ) = 'shihr' THEN 1 ELSE 0 END ; + -------------------------------------------------------------------------+ | CASE WHEN ( 'SHIHR' COLLATE utf8_general_ci ) = 'shihr' THEN 1 ELSE 0 END | + -------------------------------------------------------------------------+ | 1 | + -------------------------------------------------------------------------+ 1 row in set ( 0 . 00 sec )","title":"1.2 \u547d\u540d\u7ea6\u5b9a"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#2","text":"MySQL \u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u6709 4 \u4e2a\u7ea7\u522b\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff1a \u670d\u52a1\u5668\u7ea7\u3001\u6570\u636e\u5e93\u7ea7\u3001\u8868\u7ea7\u548c\u5b57\u6bb5\u7ea7 \u3002\u5b83\u4eec\u5206\u522b\u5728\u4e0d\u540c\u7684\u5730\u65b9\u8bbe\u7f6e\uff0c\u4f5c\u7528\u4e5f\u4e0d\u76f8\u540c\u3002\u5982\u679c\u53ea\u6307\u5b9a\u4e86\u5b57\u7b26\u96c6\uff0c\u90a3\u4e48\u4f7f\u7528\u9ed8\u8ba4\u7684\u6821\u5bf9\u89c4\u5219\u3002","title":"2. \u5b57\u7b26\u96c6\u7684\u8bbe\u7f6e"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#21","text":"SHOW VARIABLES LIKE 'CHARACTER_SET_%' ; SHOW VARIABLES LIKE 'COLLATION_%' ;","title":"2.1 \u67e5\u8be2\u8bbe\u7f6e\u7684\u5b57\u7b26\u96c6\u548c\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#22","text":"\u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\uff0c\u5728 MySQL \u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\u786e\u5b9a\u3002 \u53ef\u4ee5\u5728 my.cnf \u4e2d\u8bbe\u7f6e\uff1a [mysqld] default-character-set=gbk \u6216\u8005\u5728\u542f\u52a8\u9009\u9879\u4e2d\u6307\u5b9a\uff1a mysqld --default-character-set=gbk \u6216\u8005\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u6307\u5b9a\uff1a ./configure --with-charset=gbk","title":"2.2 \u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#23","text":"\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u5728\u521b\u5efa\u6570\u636e\u5e93\u7684\u65f6\u5019\u6307\u5b9a\uff0c \u4e5f\u53ef\u4ee5\u5728\u521b\u5efa\u5b8c\u6570\u636e\u5e93\u540e\u901a\u8fc7 alter database \u547d\u4ee4\u8fdb\u884c\u4fee\u6539\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c \u5219\u4f7f\u7528\u670d\u52a1\u5668\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002 ALTER { DATABASE | SCHEMA } [ db_name ] alter_specification ... alter_specification : [ DEFAULT ] CHARACTER SET [ = ] charset_name | [ DEFAULT ] COLLATE [ = ] collation_name \u6ce8\u610f \uff1a\u5982\u679c\u6570\u636e\u5e93\u91cc\u5df2\u7ecf\u5b58\u5728\u6570\u636e\uff0c\u56e0\u4e3a\u4fee\u6539\u5b57\u7b26\u96c6\u5e76\u4e0d\u80fd\u5c06\u5df2\u6709\u7684\u6570\u636e\u6309\u7167\u65b0\u7684\u5b57\u7b26\u96c6\u8fdb\u884c\u5b58\u653e\u3002","title":"2.3 \u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#24","text":"\u540c\u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c \u4f7f\u7528\u6570\u636e\u5e93\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u4f5c\u4e3a\u8868\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002","title":"2.4 \u8868\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#25","text":"\u540c\u8868\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u7279\u522b\u6307\u5b9a\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528\u8868\u7684\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219\u3002","title":"2.5 \u5217\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#26","text":"\u5bf9\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7684\u4ea4\u4e92\u64cd\u4f5c\uff0cMylSQL \u63d0\u4f9b\u4e86 3 \u4e2a\u4e0d\u540c\u7684\u53c2\u6570\uff1a character_set_client\u3001character_set_connection \u548c character_set_results \uff0c \u5206\u522b\u4ee3\u8868 \u5ba2\u6237\u7aef\u3001 \u8fde\u63a5\u548c\u8fd4\u56de\u7ed3\u679c \u7684\u5b57\u7b26 \u96c6\uff0c \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c \u8fd9 3 \u4e2a\u5b57\u7b26\u96c6\u5e94\u8be5\u662f\u76f8\u540c\u7684\uff0c \u624d\u53ef\u4ee5\u786e\u4fdd\u7528\u6237\u5199\u5165\u7684\u6570\u636e\u53ef\u4ee5\u6b63\u786e\u5730\u8bfb\u51fa\u3002 \u53ef\u901a\u8fc7 SET NAMES ***; \u7edf\u4e00\u8bbe\u7f6e\u8fd9\u4e09\u4e2a\u53d8\u91cf\uff0c\u4f46\u8fd9\u662f\u4e34\u65f6\u7684\uff0c\u91cd\u65b0\u8fde\u63a5\u6570\u636e\u5e93\u540e\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002 \u5728 my.cnf.d/mysql-clients.cnf \u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u8bed\u53e5\uff1a [mysql] default-character-set=gbk \u8fd9\u6837\u670d\u52a1\u5668\u542f\u52a8\u540e\uff0c\u6240\u6709\u8fde\u63a5\u9ed8\u8ba4\u5c31\u662f\u4f7f\u7528 GBK \u5b57\u7b26\u96c6\u8fdb\u884c\u8fde\u63a5\u7684\uff0c\u800c\u4e0d\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u518d\u6267\u884c set names \u547d\u4ee4\u3002","title":"2.6 \u8fde\u63a5\u5b57\u7b26\u96c6\u548c\u6821\u5bf9\u89c4\u5219"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#3","text":"\u5df2\u6709\u8bb0\u5f55\u7684\u5b57\u7b26\u96c6\u8c03\u6574\uff0c\u9700\u8981\u5148\u5c06\u6570\u636e\u5bfc\u51fa\uff0c\u7ecf\u8fc7\u9002\u5f53\u7684\u8c03\u6574\u91cd\u65b0\u5bfc\u5165\u540e\u624d\u53ef\u5b8c\u6210\u3002 \u4ee5\u4e0b\u6a21\u62df\u7684\u662f\u5c06 utf8 \u5b57\u7b26\u96c6\u7684\u6570\u636e\u5e93\u4fee\u6539\u6210 GBK \u5b57\u7b26\u96c6\u7684\u6570\u636e\u5e93\u7684\u8fc7\u7a0b\u3002","title":"3. \u5b57\u7b26\u96c6\u7684\u4fee\u6539\u6b65\u9aa4"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#31-1","text":"mysqldump -uroot -pabcd1234 --default-character-set = gbk -d blog > createblog.sql --default-character-set=gbk\uff1a\u8868\u793a\u8bbe\u7f6e\u4ee5\u4ec0\u4e48\u5b57\u7b26\u96c6\u8fde\u63a5 -d\uff1a\u8868\u793a\u53ea\u5bfc\u51fa\u8868\u7ed3\u6784\uff0c\u4e0d\u5bfc\u51fa\u6570\u636e","title":"3.1 1. \u5bfc\u51fa\u8868\u7ed3\u6784"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#32-2-createblogsql","text":"","title":"3.2 2. \u624b\u5de5\u4fee\u6539 createblog.sql \u4e2d\u8868\u7ed3\u6784\u5b9a\u4e49\u4e2d\u7684\u5b57\u7b26\u96c6\u4e3a\u65b0\u7684\u5b57\u7b26\u96c6\u3002"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#33-3","text":"mysqldump -uroot -pabcd1234 --quick --no-create-info --extended-insert --default-character-set = utf8 blog > blogdata.sql --quick\uff1a\u8be5\u9009\u9879\u7528\u4e8e\u8f6c\u50a8\u5927\u7684\u8868\u3002\u5b83\u5f3a\u5236 mysqldump \u4ece\u670d\u52a1\u5668\u4e00\u6b21\u4e00\u884c\u5730\u68c0\u7d22\u8868\u4e2d \u7684\u884c\u800c\u4e0d\u662f\u68c0\u7d22\u6240\u6709\u884c\uff0c\u5e76\u5728\u8f93\u51fa\u524d\u5c06\u5b83\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\u3002 --extended-insert\uff1a\u4f7f\u7528\u5305\u62ec\u51e0\u4e2a VALUES \u5217\u8868\u7684\u591a\u884c INSERT \u8bed\u6cd5\u3002\u8fd9\u6837\u4f7f\u8f6c\u50a8\u6587\u4ef6 \u66f4\u5c0f\uff0c\u91cd\u8f7d\u6587\u4ef6\u65f6\u53ef\u4ee5\u52a0\u901f\u63d2\u5165\u3002 --no-create-info\uff1a\u4e0d\u5199\u91cd\u65b0\u521b\u5efa\u6bcf\u4e2a\u8f6c\u50a8\u8868\u7684 CREATE TABLE \u8bed\u53e5\u3002 --default-character-set=latin1\uff1a \u6309\u7167\u539f\u6709\u7684\u5b57\u7b26\u96c6\u5bfc\u51fa\u6240\u6709\u6570\u636e\uff0c \u8fd9\u6837\u5bfc\u51fa\u7684\u6587\u4ef6\u4e2d\uff0c \u6240\u6709\u4e2d\u6587\u90fd\u662f\u53ef\u89c1\u7684\uff0c\u4e0d\u4f1a\u4fdd\u5b58\u6210\u4e71\u7801\u3002","title":"3.3 3. \u786e\u4fdd\u8bb0\u5f55\u4e0d\u518d\u66f4\u65b0\uff0c\u5bfc\u51fa\u6240\u6709\u8bb0\u5f55\u3002"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#34-4-blogdatasql-set-names-utf8-set-names-gbk","text":"","title":"3.4 4. \u6253\u5f00 blogdata.sql\uff0c\u5c06 SET NAMES utf8 \u4fee\u6539\u6210 SET NAMES gbk\u3002"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#35-5","text":"CREATE DATABASE blog_back DEFAULT CHARACTER SET gbk ;","title":"3.5 5. \u4f7f\u7528\u65b0\u7684\u5b57\u7b26\u96c6\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u3002"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#36-6-createblogsql","text":"mysql -uroot -pabcd1234 blog_back < createblog.sql","title":"3.6 6. \u521b\u5efa\u8868\uff0c\u6267\u884c createblog.sql\u3002"},{"location":"mysql/13. MySQL\u5b57\u7b26\u96c6/#37-7-datasql","text":"mysql -uroot -pabcd1234 blog_back < blogdata.sql \u6ce8\u610f \uff1a\u9009\u62e9\u76ee\u6807\u5b57\u7b26\u96c6\u7684\u65f6\u5019\uff0c\u8981\u6ce8\u610f\u6700\u597d\u662f\u6e90\u5b57\u7b26\u96c6\u7684\u8d85\u96c6\uff0c\u6216\u8005\u786e\u5b9a\u6bd4\u6e90\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\u66f4\u5927\uff0c\u5426\u5219\u5982\u679c\u76ee\u6807\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\u5c0f\u4e8e\u6e90\u5b57\u7b26\u96c6\u7684\u5b57\u5e93\uff0c\u90a3\u4e48\u76ee\u6807\u5b57\u7b26\u96c6\u4e2d\u4e0d\u652f\u6301\u7684\u5b57\u7b26\u5bfc\u5165\u540e\u4f1a\u53d8\u6210\u4e71\u7801\uff0c\u4e22\u5931\u4e00\u90e8\u5206\u6570\u636e\u3002","title":"3.7 7. \u5bfc\u5165\u6570\u636e\uff0c\u6267\u884c data.sql\u3002"},{"location":"mysql/14. MySQL\u7d22\u5f15\u7684\u8bbe\u8ba1\u548c\u4f7f\u7528/","text":"1. \u4f7f\u7528 2. \u8bbe\u8ba1\u539f\u5219 3. BTREE \u7d22\u5f15\u4e0e HASH \u7d22\u5f15 1. \u4f7f\u7528 \u00b6 \u521b\u5efa\u7d22\u5f15 CREATE [ ONLINE | OFFLINE ] [ UNIQUE | FULLTEXT | SPATIAL ] INDEX index_name [ index_type ] ON tbl_name ( index_col_name ,...) [ index_option ] ... index_col_name : col_name [( length )] [ ASC | DESC ] index_type : USING { BTREE | HASH } index_option : KEY_BLOCK_SIZE [ = ] value | index_type | WITH PARSER parser_name | COMMENT 'string' \u4f7f\u7528 EXPLAIN \u67e5\u770b\u7d22\u5f15\u662f\u5426\u88ab\u4f7f\u7528\uff1a MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD WHERE PID = 4 \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : CHILD type : ref possible_keys : PARENT_ID /* \u7d22\u5f15\u88ab\u4f7f\u7528 */ key : PARENT_ID key_len : 3 ref : const rows : 1 Extra : Using index 1 row in set ( 0 . 00 sec ) \u5220\u9664\u7d22\u5f15\uff1a DROP [ ONLINE | OFFLINE ] INDEX index_name ON tbl_name 2. \u8bbe\u8ba1\u539f\u5219 \u00b6 \u6700\u9002\u5408\u7d22\u5f15\u7684\u5217\u662f\u51fa\u73b0\u5728 WHERE \u5b50\u53e5\u4e2d\u7684\u5217\uff0c\u6216\u8fde\u63a5\u5b50\u53e5\u4e2d\u6307\u5b9a\u7684\u5217\u3002 \u4f7f\u7528\u60df\u4e00\u7d22\u5f15\u3002\u8003\u8651\u67d0\u5217\u4e2d\u503c\u7684\u5206\u5e03\u3002\u7d22\u5f15\u7684\u5217\u7684\u57fa\u6570\u8d8a\u5927\uff0c\u7d22\u5f15\u7684\u6548\u679c\u8d8a\u597d\u3002 \u4f7f\u7528\u77ed\u7d22\u5f15\u3002\u5982\u679c\u5bf9\u5b57\u7b26\u4e32\u5217\u8fdb\u884c\u7d22\u5f15\uff0c\u5e94\u8be5\u6307\u5b9a\u4e00\u4e2a\u524d\u7f00\u957f\u5ea6\uff0c\u53ea\u8981\u6709\u53ef\u80fd\u5c31\u5e94\u8be5\u8fd9\u6837\u505a\u3002 \u5229\u7528\u6700\u5de6\u524d\u7f00\u3002 \u5728\u521b\u5efa\u4e00\u4e2a n \u5217\u7684\u7d22\u5f15\u65f6\uff0c \u5b9e\u9645\u662f\u521b\u5efa\u4e86 MySQL \u53ef\u5229\u7528\u7684 n \u4e2a\u7d22\u5f15\u3002\u591a\u5217\u7d22\u5f15\u53ef\u8d77\u51e0\u4e2a\u7d22\u5f15\u7684\u4f5c\u7528\uff0c \u56e0\u4e3a\u53ef\u5229\u7528\u7d22\u5f15\u4e2d\u6700\u5de6\u8fb9\u7684\u5217\u96c6\u6765\u5339\u914d\u884c\u3002 \u8fd9\u6837\u7684\u5217\u96c6\u79f0\u4e3a\u6700\u5de6\u524d\u7f00\u3002 \u4e0d\u8981\u8fc7\u5ea6\u7d22\u5f15\u3002\u6bcf\u4e2a\u989d\u5916\u7684\u7d22\u5f15\u90fd\u8981\u5360\u7528\u989d\u5916\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c \u5e76\u964d\u4f4e\u5199\u64cd\u4f5c\u7684\u6027\u80fd\u3002 \u5728\u4fee\u6539\u8868\u7684\u5185\u5bb9\u65f6\uff0c \u7d22\u5f15\u5fc5\u987b\u8fdb\u884c\u66f4\u65b0\uff0c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u91cd\u6784\uff0c\u56e0\u6b64\uff0c\u7d22\u5f15\u8d8a\u591a\uff0c\u6240\u82b1\u7684\u65f6\u95f4\u8d8a\u957f\u3002 \u5bf9\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\uff0c\u5c3d\u91cf\u81ea\u5df1\u6307\u5b9a\u4e3b\u952e\u3002InnoDB \u8868\u7684\u666e\u901a\u7d22\u5f15\u90fd\u4f1a\u4fdd\u5b58\u4e3b\u952e\u7684\u952e\u503c\uff0c\u6240\u4ee5\u4e3b\u952e\u8981\u5c3d\u53ef\u80fd\u9009\u62e9\u8f83\u77ed\u7684\u6570\u636e\u7c7b\u578b\uff0c \u53ef\u4ee5\u6709\u6548\u5730\u51cf\u5c11\u7d22\u5f15\u7684\u78c1\u76d8\u5360\u7528\uff0c \u63d0\u9ad8\u7d22\u5f15\u7684\u7f13\u5b58\u6548\u679c\u3002 3. BTREE \u7d22\u5f15\u4e0e HASH \u7d22\u5f15 \u00b6 MEMORY \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 BTREE \u7d22\u5f15\u6216\u8005 HASH \u7d22\u5f15\uff0c \u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u7d22\u5f15\u5404\u6709\u5176\u4e0d\u540c\u7684\u9002\u7528\u8303\u56f4\u3002 HASH \u7d22\u5f15\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u7279\u5f81\u9700\u8981\u5728\u4f7f\u7528\u7684\u65f6\u5019\u7279\u522b\u6ce8\u610f\uff1a \u53ea\u7528\u4e8e\u4f7f\u7528=\u6216<=>\uff08NULL\u7684\u5b89\u5168\u6bd4\u8f83\uff09\u64cd\u4f5c\u7b26\u7684\u7b49\u5f0f\u6bd4\u8f83\uff08\u4f46\u662f\u5f88\u5feb\uff09\u3002 \u4f18\u5316\u5668\u4e0d\u80fd\u4f7f\u7528 HASH \u7d22\u5f15\u6765\u52a0\u901f ORDER BY \u64cd\u4f5c\u3002 MySQL \u4e0d\u80fd\u786e\u5b9a\u5728\u4e24\u4e2a\u503c\u4e4b\u95f4\u5927\u7ea6\u6709\u591a\u5c11\u884c\u3002 \u5982\u679c\u5c06\u4e00\u4e2a MyISAM \u8868\u6539\u4e3a HASH \u7d22 \u5f15\u7684 MEMORY \u8868\uff0c\u4f1a\u5f71\u54cd\u4e00\u4e9b\u67e5\u8be2\u7684\u6267\u884c\u6548\u7387\u3002 \u53ea\u80fd\u4f7f\u7528\u6574\u4e2a\u5173\u952e\u5b57\u6765\u641c\u7d22\u4e00\u884c\u3002 \u800c\u5bf9\u4e8e BTREE \u7d22\u5f15\uff0c \u5f53\u4f7f\u7528>\u3001 <\u3001 >=\u3001 <=\u3001 BETWEEN\u3001!=\u6216\u8005<>\uff0c \u6216\u8005 LIKE 'pattern' \uff08\u5176 \u4e2d'pattern'\u4e0d\u4ee5\u901a\u914d\u7b26\u5f00\u59cb\uff09\u64cd\u4f5c\u7b26\u65f6\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u76f8\u5173\u5217\u4e0a\u7684\u7d22\u5f15\u3002 IN \u8303\u56f4\u67e5\u8be2\u9002\u7528\u4e8e BTREE \u7d22\u5f15\u548c HASH \u7d22\u5f15\uff1a SELECT * FROM t1 WHERE key_col IN ( 15 , 18 , 20 ); InnoDB \u548c MyISAM \u4e0d\u652f\u6301HASH\u7d22\u5f15\u7c7b\u578b \uff0c\u5982\u679c\u6307\u5b9a\u4e86\u4f7f\u7528HASH\u7c7b\u578b\u7684\u7d22\u5f15\uff0c\u4f1a\u88ab\u66ff\u6362\u4e3aBTREE\u3002 \u6ce8\u610f \uff1a\u5982\u679c\u9700\u8981\u8bbf\u95ee\u5927\u90e8\u5206\u884c\uff0c\u987a\u5e8f\u8bfb\u53d6\u8981\u5feb\u5f97\u591a\uff0c\u56e0\u4e3a\u6b64\u65f6\u5e94\u907f\u514d\u78c1\u76d8\u641c\u7d22\u3002","title":"14. MySQL\u7d22\u5f15\u7684\u8bbe\u8ba1\u548c\u4f7f\u7528"},{"location":"mysql/14. MySQL\u7d22\u5f15\u7684\u8bbe\u8ba1\u548c\u4f7f\u7528/#1","text":"\u521b\u5efa\u7d22\u5f15 CREATE [ ONLINE | OFFLINE ] [ UNIQUE | FULLTEXT | SPATIAL ] INDEX index_name [ index_type ] ON tbl_name ( index_col_name ,...) [ index_option ] ... index_col_name : col_name [( length )] [ ASC | DESC ] index_type : USING { BTREE | HASH } index_option : KEY_BLOCK_SIZE [ = ] value | index_type | WITH PARSER parser_name | COMMENT 'string' \u4f7f\u7528 EXPLAIN \u67e5\u770b\u7d22\u5f15\u662f\u5426\u88ab\u4f7f\u7528\uff1a MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD WHERE PID = 4 \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : CHILD type : ref possible_keys : PARENT_ID /* \u7d22\u5f15\u88ab\u4f7f\u7528 */ key : PARENT_ID key_len : 3 ref : const rows : 1 Extra : Using index 1 row in set ( 0 . 00 sec ) \u5220\u9664\u7d22\u5f15\uff1a DROP [ ONLINE | OFFLINE ] INDEX index_name ON tbl_name","title":"1. \u4f7f\u7528"},{"location":"mysql/14. MySQL\u7d22\u5f15\u7684\u8bbe\u8ba1\u548c\u4f7f\u7528/#2","text":"\u6700\u9002\u5408\u7d22\u5f15\u7684\u5217\u662f\u51fa\u73b0\u5728 WHERE \u5b50\u53e5\u4e2d\u7684\u5217\uff0c\u6216\u8fde\u63a5\u5b50\u53e5\u4e2d\u6307\u5b9a\u7684\u5217\u3002 \u4f7f\u7528\u60df\u4e00\u7d22\u5f15\u3002\u8003\u8651\u67d0\u5217\u4e2d\u503c\u7684\u5206\u5e03\u3002\u7d22\u5f15\u7684\u5217\u7684\u57fa\u6570\u8d8a\u5927\uff0c\u7d22\u5f15\u7684\u6548\u679c\u8d8a\u597d\u3002 \u4f7f\u7528\u77ed\u7d22\u5f15\u3002\u5982\u679c\u5bf9\u5b57\u7b26\u4e32\u5217\u8fdb\u884c\u7d22\u5f15\uff0c\u5e94\u8be5\u6307\u5b9a\u4e00\u4e2a\u524d\u7f00\u957f\u5ea6\uff0c\u53ea\u8981\u6709\u53ef\u80fd\u5c31\u5e94\u8be5\u8fd9\u6837\u505a\u3002 \u5229\u7528\u6700\u5de6\u524d\u7f00\u3002 \u5728\u521b\u5efa\u4e00\u4e2a n \u5217\u7684\u7d22\u5f15\u65f6\uff0c \u5b9e\u9645\u662f\u521b\u5efa\u4e86 MySQL \u53ef\u5229\u7528\u7684 n \u4e2a\u7d22\u5f15\u3002\u591a\u5217\u7d22\u5f15\u53ef\u8d77\u51e0\u4e2a\u7d22\u5f15\u7684\u4f5c\u7528\uff0c \u56e0\u4e3a\u53ef\u5229\u7528\u7d22\u5f15\u4e2d\u6700\u5de6\u8fb9\u7684\u5217\u96c6\u6765\u5339\u914d\u884c\u3002 \u8fd9\u6837\u7684\u5217\u96c6\u79f0\u4e3a\u6700\u5de6\u524d\u7f00\u3002 \u4e0d\u8981\u8fc7\u5ea6\u7d22\u5f15\u3002\u6bcf\u4e2a\u989d\u5916\u7684\u7d22\u5f15\u90fd\u8981\u5360\u7528\u989d\u5916\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c \u5e76\u964d\u4f4e\u5199\u64cd\u4f5c\u7684\u6027\u80fd\u3002 \u5728\u4fee\u6539\u8868\u7684\u5185\u5bb9\u65f6\uff0c \u7d22\u5f15\u5fc5\u987b\u8fdb\u884c\u66f4\u65b0\uff0c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u91cd\u6784\uff0c\u56e0\u6b64\uff0c\u7d22\u5f15\u8d8a\u591a\uff0c\u6240\u82b1\u7684\u65f6\u95f4\u8d8a\u957f\u3002 \u5bf9\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\uff0c\u5c3d\u91cf\u81ea\u5df1\u6307\u5b9a\u4e3b\u952e\u3002InnoDB \u8868\u7684\u666e\u901a\u7d22\u5f15\u90fd\u4f1a\u4fdd\u5b58\u4e3b\u952e\u7684\u952e\u503c\uff0c\u6240\u4ee5\u4e3b\u952e\u8981\u5c3d\u53ef\u80fd\u9009\u62e9\u8f83\u77ed\u7684\u6570\u636e\u7c7b\u578b\uff0c \u53ef\u4ee5\u6709\u6548\u5730\u51cf\u5c11\u7d22\u5f15\u7684\u78c1\u76d8\u5360\u7528\uff0c \u63d0\u9ad8\u7d22\u5f15\u7684\u7f13\u5b58\u6548\u679c\u3002","title":"2. \u8bbe\u8ba1\u539f\u5219"},{"location":"mysql/14. MySQL\u7d22\u5f15\u7684\u8bbe\u8ba1\u548c\u4f7f\u7528/#3-btree-hash","text":"MEMORY \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 BTREE \u7d22\u5f15\u6216\u8005 HASH \u7d22\u5f15\uff0c \u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u7d22\u5f15\u5404\u6709\u5176\u4e0d\u540c\u7684\u9002\u7528\u8303\u56f4\u3002 HASH \u7d22\u5f15\u6709\u4e00\u4e9b\u91cd\u8981\u7684\u7279\u5f81\u9700\u8981\u5728\u4f7f\u7528\u7684\u65f6\u5019\u7279\u522b\u6ce8\u610f\uff1a \u53ea\u7528\u4e8e\u4f7f\u7528=\u6216<=>\uff08NULL\u7684\u5b89\u5168\u6bd4\u8f83\uff09\u64cd\u4f5c\u7b26\u7684\u7b49\u5f0f\u6bd4\u8f83\uff08\u4f46\u662f\u5f88\u5feb\uff09\u3002 \u4f18\u5316\u5668\u4e0d\u80fd\u4f7f\u7528 HASH \u7d22\u5f15\u6765\u52a0\u901f ORDER BY \u64cd\u4f5c\u3002 MySQL \u4e0d\u80fd\u786e\u5b9a\u5728\u4e24\u4e2a\u503c\u4e4b\u95f4\u5927\u7ea6\u6709\u591a\u5c11\u884c\u3002 \u5982\u679c\u5c06\u4e00\u4e2a MyISAM \u8868\u6539\u4e3a HASH \u7d22 \u5f15\u7684 MEMORY \u8868\uff0c\u4f1a\u5f71\u54cd\u4e00\u4e9b\u67e5\u8be2\u7684\u6267\u884c\u6548\u7387\u3002 \u53ea\u80fd\u4f7f\u7528\u6574\u4e2a\u5173\u952e\u5b57\u6765\u641c\u7d22\u4e00\u884c\u3002 \u800c\u5bf9\u4e8e BTREE \u7d22\u5f15\uff0c \u5f53\u4f7f\u7528>\u3001 <\u3001 >=\u3001 <=\u3001 BETWEEN\u3001!=\u6216\u8005<>\uff0c \u6216\u8005 LIKE 'pattern' \uff08\u5176 \u4e2d'pattern'\u4e0d\u4ee5\u901a\u914d\u7b26\u5f00\u59cb\uff09\u64cd\u4f5c\u7b26\u65f6\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u76f8\u5173\u5217\u4e0a\u7684\u7d22\u5f15\u3002 IN \u8303\u56f4\u67e5\u8be2\u9002\u7528\u4e8e BTREE \u7d22\u5f15\u548c HASH \u7d22\u5f15\uff1a SELECT * FROM t1 WHERE key_col IN ( 15 , 18 , 20 ); InnoDB \u548c MyISAM \u4e0d\u652f\u6301HASH\u7d22\u5f15\u7c7b\u578b \uff0c\u5982\u679c\u6307\u5b9a\u4e86\u4f7f\u7528HASH\u7c7b\u578b\u7684\u7d22\u5f15\uff0c\u4f1a\u88ab\u66ff\u6362\u4e3aBTREE\u3002 \u6ce8\u610f \uff1a\u5982\u679c\u9700\u8981\u8bbf\u95ee\u5927\u90e8\u5206\u884c\uff0c\u987a\u5e8f\u8bfb\u53d6\u8981\u5feb\u5f97\u591a\uff0c\u56e0\u4e3a\u6b64\u65f6\u5e94\u907f\u514d\u78c1\u76d8\u641c\u7d22\u3002","title":"3. BTREE \u7d22\u5f15\u4e0e HASH \u7d22\u5f15"},{"location":"mysql/15. MySQL\u89c6\u56fe/","text":"1. \u521b\u5efa\u6216\u8005\u4fee\u6539\u89c6\u56fe 1.1 MySQL \u521b\u5efa\u89c6\u56fe\u7684\u9650\u5236 1.2 MySQL \u66f4\u65b0\u89c6\u56fe\u7684\u9650\u5236 2. \u67e5\u770b\u89c6\u56fe 3. \u5220\u9664\u89c6\u56fe \u89c6\u56fe\u5e76\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u5b9e\u9645\u5b58\u5728\uff0c \u884c\u548c\u5217\u6570\u636e\u6765\u81ea\u5b9a\u4e49\u89c6\u56fe\u7684\u67e5\u8be2\u4e2d\u4f7f\u7528\u7684\u8868\uff0c \u5e76\u4e14\u662f\u5728\u4f7f\u7528\u89c6\u56fe\u65f6\u52a8\u6001\u751f\u6210\u7684\u3002 \u4f18\u70b9\uff1a \u7b80\u5355\uff1a \u4f7f\u7528\u89c6\u56fe\u7684\u7528\u6237\u5b8c\u5168\u4e0d\u9700\u8981\u5173\u5fc3\u540e\u9762\u5bf9\u5e94\u7684\u8868\u7684\u7ed3\u6784\u3001 \u5173\u8054\u6761\u4ef6\u548c\u7b5b\u9009\u6761\u4ef6\uff0c\u5bf9\u7528\u6237\u6765\u8bf4\u5df2\u7ecf\u662f\u8fc7\u6ee4\u597d\u7684\u590d\u5408\u6761\u4ef6\u7684\u7ed3\u679c\u96c6\u3002 \u5b89\u5168\uff1a \u4f7f\u7528\u89c6\u56fe\u7684\u7528\u6237\u53ea\u80fd\u8bbf\u95ee\u4ed6\u4eec\u88ab\u5141\u8bb8\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\uff1b \u5bf9\u8868\u7684\u6743\u9650\u7ba1\u7406\u5e76\u4e0d\u80fd\u9650\u5236\u5230\u67d0\u4e2a\u884c\u67d0\u4e2a\u5217\uff0c\u4f46\u662f\u901a\u8fc7\u89c6\u56fe\u5c31\u53ef\u4ee5\u7b80\u5355\u7684\u5b9e\u73b0\u3002 \u6570\u636e\u72ec\u7acb\uff1a \u4e00\u65e6\u89c6\u56fe\u7684\u7ed3\u6784\u786e\u5b9a\u4e86\uff0c \u53ef\u4ee5\u5c4f\u853d\u8868\u7ed3\u6784\u53d8\u5316\u5bf9\u7528\u6237\u7684\u5f71\u54cd\uff0c \u6e90\u8868\u589e\u52a0\u5217\u5bf9\u89c6\u56fe\u6ca1\u6709\u5f71\u54cd\uff1b \u6e90\u8868\u4fee\u6539\u5217\u540d\uff0c \u5219\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u89c6\u56fe\u6765\u89e3\u51b3\uff0c \u4e0d\u4f1a\u9020\u6210\u5bf9\u8bbf\u95ee\u8005\u7684\u5f71\u54cd\u3002 1. \u521b\u5efa\u6216\u8005\u4fee\u6539\u89c6\u56fe \u00b6 \u521b\u5efa\u89c6\u56fe\u9700\u8981\u6709 CREATE VIEW \u7684\u6743\u9650\uff0c\u5e76\u4e14\u5bf9\u4e8e\u67e5\u8be2\u6d89\u53ca\u7684\u5217\u6709 SELECT \u6743\u9650\u3002\u5982\u679c\u4f7f\u7528 CREATE OR REPLACE \u6216\u8005 ALTER \u4fee\u6539\u89c6\u56fe\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u8be5\u89c6\u56fe\u7684 DROP \u6743\u9650\u3002 CREATE [ OR REPLACE ] [ ALGORITHM = { UNDEFINED | MERGE | TEMPTABLE } ] [ DEFINER = { user | CURRENT_USER } ] [ SQL SECURITY { DEFINER | INVOKER } ] VIEW view_name [( column_list )] AS select_statement [ WITH [ CASCADED | LOCAL ] CHECK OPTION ] CREATE OR REPLACE VIEW\uff1a \u89c6\u56fe\u4e0d\u5b58\u5728\uff1a\u548c CREATE VIEW \u7b49\u4ef7 \u89c6\u56fe\u5b58\u5728\uff1a\u548c ALTER VIEW \u7b49\u4ef7 1.1 MySQL \u521b\u5efa\u89c6\u56fe\u7684\u9650\u5236 \u00b6 MySQL \u5b9a\u4e49\u89c6\u56fe\u7684\u9650\u5236\uff1a SELECT \u8bed\u53e5\u4e2d\u7684 FROM \u8bed\u6cd5\u4e2d\u4e0d\u80fd\u5305\u542b\u5b50\u67e5\u8be2 SELECT \u8bed\u53e5\u4e0d\u80fd\u5f15\u7528\u7cfb\u7edf\u53d8\u91cf\u6216\u7528\u6237\u5b9a\u4e49\u7684\u53d8\u91cf \u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\uff0cSELECT \u4e0d\u80fd\u5f15\u7528\u7a0b\u5e8f\u53c2\u6570\u6216\u5c40\u90e8\u53d8\u91cf SELECT \u8bed\u53e5\u4e0d\u80fd\u5f15\u7528\u51c6\u5907\u597d\u7684\u58f0\u660e\u53c2\u6570\uff08statement parameters\uff09\uff1f\uff1f\uff1f \u5728\u5b9a\u4e49\u4e2d\u5f15\u7528\u7684\u8868\u6216\u89c6\u56fe\u5fc5\u987b\u5b58\u5728\u3002 \u4e0d\u80fd\u5f15\u7528\u4e34\u65f6\u8868\uff0c\u6240\u4ee5\u4e0d\u80fd\u521b\u5efa\u4e34\u65f6\u89c6\u56fe \u4e0d\u80fd\u8bb2\u89c6\u56fe\u4e0e\u89e6\u53d1\u5668\u5173\u8054\u8d77\u6765 SELECT \u5b50\u53e5\u4e2d\u5217\u7684\u522b\u540d\u6700\u5927\u957f\u5ea6\u4e3a64\u4e2a\u5b57\u7b26 \u4e0d\u80fd\u5728\u89c6\u56fe\u4e2d\u521b\u5efa\u7d22\u5f15 \u5bf9\u4e8e\u7b2c\u4e00\u6761\uff0c\u5982\u679c\u89c6\u56fe\u662f\u4ece\u5176\u4ed6\u6570\u636e\u5e93\u8fc1\u79fb\u8fc7\u6765\u7684\uff0c \u90a3\u4e48\u53ef\u80fd\u9700\u8981\u56e0\u6b64\u505a\u4e00\u4e9b\u6539\u52a8\uff0c \u53ef\u4ee5\u5c06\u5b50\u67e5\u8be2\u7684\u5185\u5bb9\u5148\u5b9a\u4e49\u6210\u4e00\u4e2a\u89c6\u56fe\uff0c\u7136\u540e\u5bf9\u8be5\u89c6\u56fe\u518d\u521b\u5efa\u89c6\u56fe\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u7684\u529f\u80fd\u4e86\u3002 1.2 MySQL \u66f4\u65b0\u89c6\u56fe\u7684\u9650\u5236 \u00b6 \u89c6\u56fe\u7684\u53ef\u66f4\u65b0\u6027\uff08\u5373\u901a\u8fc7\u89c6\u56fe\u8fdb\u884c\u63d2\u5165\u7b49\u64cd\u4f5c\uff09\u548c\u89c6\u56fe\u4e2d\u67e5\u8be2\u7684\u5b9a\u4e49\u6709\u5173\u7cfb \uff0c\u4ee5\u4e0b\u7c7b\u578b\u7684\u89c6\u56fe\u662f\u4e0d\u53ef\u66f4\u65b0\u7684\uff1a \u5305\u542b\u4ee5\u4e0b\u5173\u952e\u5b57\u7684 SQL \u8bed\u53e5\uff1a \u805a\u5408\u51fd\u6570 \uff08SUM\u3001 MIN\u3001 MAX\u3001 COUNT \u7b49\uff09\u3001 DISTINCT\u3001 GROUP BY\u3001HAVING\u3001UNION \u6216\u8005 UNION ALL\u3002 \u5e38\u91cf\u89c6\u56fe\u3002 SELECT \u4e2d\u5305\u542b\u5b50\u67e5\u8be2\u3002 JION\u3002 FROM \u4e00\u4e2a\u4e0d\u80fd\u66f4\u65b0\u7684\u89c6\u56fe\u3002 WHERE \u5b50\u53e5\u7684\u5b50\u67e5\u8be2\u5f15\u7528\u4e86 FROM \u5b50\u53e5\u4e2d\u7684\u8868\u3002 WITH [CASCADED | LOCAL] CHECK OPTION \u51b3\u5b9a\u4e86\u662f\u5426\u5141\u8bb8\u66f4\u65b0\u4e0d\u6ee1\u8db3\u89c6\u56fe\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 CASCADED\uff1a\u5fc5\u987b\u6ee1\u8db3\u9488\u5bf9\u8be5\u89c6\u56fe\u7684\u6240\u6709\u6761\u4ef6\u624d\u53ef\u4ee5\u66f4\u65b0\u3002 LOCAL\uff1a\u53ea\u8981\u6ee1\u8db3\u672c\u89c6\u56fe\u7684\u6761\u4ef6\u5c31\u53ef\u4ee5\u66f4\u65b0\u3002 \u5982\u679c\u4e0d\u6307\u5b9a\u6b64\u9009\u9879\uff0c\u4e0eLOCAL\u89c4\u5219\u76f8\u540c\uff0c\u4f46\u4e0d\u6ee1\u8db3\u672c\u89c6\u56fe\u6761\u4ef6\u65f6\u4f1a\u663e\u793a\u6210\u529f\u4e14\u4e0d\u4f1a\u66f4\u65b0\u6570\u636e\u3002 /* \u57fa\u7840\u89c6\u56fe */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW ( PID , PNAME ) AS SELECT * FROM PARENT WHERE ID < 5 ; /* \u4e8c\u5c42\u89c6\u56fe\uff0cCASCADED */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW1 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 1 WITH CASCADED CHECK OPTION ; /* \u63d2\u5165\u5931\u8d25 */ MariaDB [ MYISAM_TEST ] > INSERT INTO PARENT_VIEW1 VALUES ( 11 , 'DSAF' ); ERROR 1369 ( HY000 ): CHECK OPTION failed 'MYISAM_TEST.PARENT_VIEW1' /* \u4e8c\u5c42\u89c6\u56fe\uff0cLOCAL */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW1 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 1 WITH LOCA CHECK OPTION ; /* \u63d2\u5165\u6210\u529f */ MariaDB [ MYISAM_TEST ] > INSERT INTO PARENT_VIEW2 VALUES ( 11 , 'DSAF' ); Query OK , 1 row affected ( 0 . 01 sec ) /* \u4e8c\u5c42\u89c6\u56fe\uff0c\u4e0d\u6307\u5b9a\u68c0\u67e5\u9009\u9879 */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW3 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 2 ; /* \u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u66f4\u65b0 */ MariaDB [ MYISAM_TEST ] > DELETE FROM PARENT_VIEW3 WHERE PID = 1 ; Query OK , 0 rows affected ( 0 . 00 sec ) 2. \u67e5\u770b\u89c6\u56fe \u00b6 SHOW TABLES ; SHOW TABLE STATUS ; SHOW CREATE VIEW ; 3. \u5220\u9664\u89c6\u56fe \u00b6 \u4e00\u6b21\u53ef\u4ee5\u5220\u9664\u591a\u4e2a\u89c6\u56fe DROP VIEW [ IF EXISTS ] view_name [, view_name ] ... [ RESTRICT | CASCADE ]","title":"15. MySQL\u89c6\u56fe"},{"location":"mysql/15. MySQL\u89c6\u56fe/#1","text":"\u521b\u5efa\u89c6\u56fe\u9700\u8981\u6709 CREATE VIEW \u7684\u6743\u9650\uff0c\u5e76\u4e14\u5bf9\u4e8e\u67e5\u8be2\u6d89\u53ca\u7684\u5217\u6709 SELECT \u6743\u9650\u3002\u5982\u679c\u4f7f\u7528 CREATE OR REPLACE \u6216\u8005 ALTER \u4fee\u6539\u89c6\u56fe\uff0c\u90a3\u4e48\u8fd8\u9700\u8981\u8be5\u89c6\u56fe\u7684 DROP \u6743\u9650\u3002 CREATE [ OR REPLACE ] [ ALGORITHM = { UNDEFINED | MERGE | TEMPTABLE } ] [ DEFINER = { user | CURRENT_USER } ] [ SQL SECURITY { DEFINER | INVOKER } ] VIEW view_name [( column_list )] AS select_statement [ WITH [ CASCADED | LOCAL ] CHECK OPTION ] CREATE OR REPLACE VIEW\uff1a \u89c6\u56fe\u4e0d\u5b58\u5728\uff1a\u548c CREATE VIEW \u7b49\u4ef7 \u89c6\u56fe\u5b58\u5728\uff1a\u548c ALTER VIEW \u7b49\u4ef7","title":"1. \u521b\u5efa\u6216\u8005\u4fee\u6539\u89c6\u56fe"},{"location":"mysql/15. MySQL\u89c6\u56fe/#11-mysql","text":"MySQL \u5b9a\u4e49\u89c6\u56fe\u7684\u9650\u5236\uff1a SELECT \u8bed\u53e5\u4e2d\u7684 FROM \u8bed\u6cd5\u4e2d\u4e0d\u80fd\u5305\u542b\u5b50\u67e5\u8be2 SELECT \u8bed\u53e5\u4e0d\u80fd\u5f15\u7528\u7cfb\u7edf\u53d8\u91cf\u6216\u7528\u6237\u5b9a\u4e49\u7684\u53d8\u91cf \u5728\u5b58\u50a8\u8fc7\u7a0b\u4e2d\uff0cSELECT \u4e0d\u80fd\u5f15\u7528\u7a0b\u5e8f\u53c2\u6570\u6216\u5c40\u90e8\u53d8\u91cf SELECT \u8bed\u53e5\u4e0d\u80fd\u5f15\u7528\u51c6\u5907\u597d\u7684\u58f0\u660e\u53c2\u6570\uff08statement parameters\uff09\uff1f\uff1f\uff1f \u5728\u5b9a\u4e49\u4e2d\u5f15\u7528\u7684\u8868\u6216\u89c6\u56fe\u5fc5\u987b\u5b58\u5728\u3002 \u4e0d\u80fd\u5f15\u7528\u4e34\u65f6\u8868\uff0c\u6240\u4ee5\u4e0d\u80fd\u521b\u5efa\u4e34\u65f6\u89c6\u56fe \u4e0d\u80fd\u8bb2\u89c6\u56fe\u4e0e\u89e6\u53d1\u5668\u5173\u8054\u8d77\u6765 SELECT \u5b50\u53e5\u4e2d\u5217\u7684\u522b\u540d\u6700\u5927\u957f\u5ea6\u4e3a64\u4e2a\u5b57\u7b26 \u4e0d\u80fd\u5728\u89c6\u56fe\u4e2d\u521b\u5efa\u7d22\u5f15 \u5bf9\u4e8e\u7b2c\u4e00\u6761\uff0c\u5982\u679c\u89c6\u56fe\u662f\u4ece\u5176\u4ed6\u6570\u636e\u5e93\u8fc1\u79fb\u8fc7\u6765\u7684\uff0c \u90a3\u4e48\u53ef\u80fd\u9700\u8981\u56e0\u6b64\u505a\u4e00\u4e9b\u6539\u52a8\uff0c \u53ef\u4ee5\u5c06\u5b50\u67e5\u8be2\u7684\u5185\u5bb9\u5148\u5b9a\u4e49\u6210\u4e00\u4e2a\u89c6\u56fe\uff0c\u7136\u540e\u5bf9\u8be5\u89c6\u56fe\u518d\u521b\u5efa\u89c6\u56fe\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u7684\u529f\u80fd\u4e86\u3002","title":"1.1 MySQL \u521b\u5efa\u89c6\u56fe\u7684\u9650\u5236"},{"location":"mysql/15. MySQL\u89c6\u56fe/#12-mysql","text":"\u89c6\u56fe\u7684\u53ef\u66f4\u65b0\u6027\uff08\u5373\u901a\u8fc7\u89c6\u56fe\u8fdb\u884c\u63d2\u5165\u7b49\u64cd\u4f5c\uff09\u548c\u89c6\u56fe\u4e2d\u67e5\u8be2\u7684\u5b9a\u4e49\u6709\u5173\u7cfb \uff0c\u4ee5\u4e0b\u7c7b\u578b\u7684\u89c6\u56fe\u662f\u4e0d\u53ef\u66f4\u65b0\u7684\uff1a \u5305\u542b\u4ee5\u4e0b\u5173\u952e\u5b57\u7684 SQL \u8bed\u53e5\uff1a \u805a\u5408\u51fd\u6570 \uff08SUM\u3001 MIN\u3001 MAX\u3001 COUNT \u7b49\uff09\u3001 DISTINCT\u3001 GROUP BY\u3001HAVING\u3001UNION \u6216\u8005 UNION ALL\u3002 \u5e38\u91cf\u89c6\u56fe\u3002 SELECT \u4e2d\u5305\u542b\u5b50\u67e5\u8be2\u3002 JION\u3002 FROM \u4e00\u4e2a\u4e0d\u80fd\u66f4\u65b0\u7684\u89c6\u56fe\u3002 WHERE \u5b50\u53e5\u7684\u5b50\u67e5\u8be2\u5f15\u7528\u4e86 FROM \u5b50\u53e5\u4e2d\u7684\u8868\u3002 WITH [CASCADED | LOCAL] CHECK OPTION \u51b3\u5b9a\u4e86\u662f\u5426\u5141\u8bb8\u66f4\u65b0\u4e0d\u6ee1\u8db3\u89c6\u56fe\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 CASCADED\uff1a\u5fc5\u987b\u6ee1\u8db3\u9488\u5bf9\u8be5\u89c6\u56fe\u7684\u6240\u6709\u6761\u4ef6\u624d\u53ef\u4ee5\u66f4\u65b0\u3002 LOCAL\uff1a\u53ea\u8981\u6ee1\u8db3\u672c\u89c6\u56fe\u7684\u6761\u4ef6\u5c31\u53ef\u4ee5\u66f4\u65b0\u3002 \u5982\u679c\u4e0d\u6307\u5b9a\u6b64\u9009\u9879\uff0c\u4e0eLOCAL\u89c4\u5219\u76f8\u540c\uff0c\u4f46\u4e0d\u6ee1\u8db3\u672c\u89c6\u56fe\u6761\u4ef6\u65f6\u4f1a\u663e\u793a\u6210\u529f\u4e14\u4e0d\u4f1a\u66f4\u65b0\u6570\u636e\u3002 /* \u57fa\u7840\u89c6\u56fe */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW ( PID , PNAME ) AS SELECT * FROM PARENT WHERE ID < 5 ; /* \u4e8c\u5c42\u89c6\u56fe\uff0cCASCADED */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW1 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 1 WITH CASCADED CHECK OPTION ; /* \u63d2\u5165\u5931\u8d25 */ MariaDB [ MYISAM_TEST ] > INSERT INTO PARENT_VIEW1 VALUES ( 11 , 'DSAF' ); ERROR 1369 ( HY000 ): CHECK OPTION failed 'MYISAM_TEST.PARENT_VIEW1' /* \u4e8c\u5c42\u89c6\u56fe\uff0cLOCAL */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW1 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 1 WITH LOCA CHECK OPTION ; /* \u63d2\u5165\u6210\u529f */ MariaDB [ MYISAM_TEST ] > INSERT INTO PARENT_VIEW2 VALUES ( 11 , 'DSAF' ); Query OK , 1 row affected ( 0 . 01 sec ) /* \u4e8c\u5c42\u89c6\u56fe\uff0c\u4e0d\u6307\u5b9a\u68c0\u67e5\u9009\u9879 */ MariaDB [ MYISAM_TEST ] > CREATE OR REPLACE VIEW PARENT_VIEW3 ( PID , PNAME ) AS SELECT * FROM PARENT_VIEW WHERE PID > 2 ; /* \u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u66f4\u65b0 */ MariaDB [ MYISAM_TEST ] > DELETE FROM PARENT_VIEW3 WHERE PID = 1 ; Query OK , 0 rows affected ( 0 . 00 sec )","title":"1.2 MySQL \u66f4\u65b0\u89c6\u56fe\u7684\u9650\u5236"},{"location":"mysql/15. MySQL\u89c6\u56fe/#2","text":"SHOW TABLES ; SHOW TABLE STATUS ; SHOW CREATE VIEW ;","title":"2. \u67e5\u770b\u89c6\u56fe"},{"location":"mysql/15. MySQL\u89c6\u56fe/#3","text":"\u4e00\u6b21\u53ef\u4ee5\u5220\u9664\u591a\u4e2a\u89c6\u56fe DROP VIEW [ IF EXISTS ] view_name [, view_name ] ... [ RESTRICT | CASCADE ]","title":"3. \u5220\u9664\u89c6\u56fe"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/","text":"1. \u521b\u5efa 2. \u4fee\u6539 3. \u8c03\u7528 4. \u67e5\u770b 4.1 \u72b6\u6001 4.2 \u5b9a\u4e49 4.3 \u4fe1\u606f 5. \u5220\u9664 \u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u662f\u4e8b\u5148\u7ecf\u8fc7\u7f16\u8bd1\u5e76\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u6bb5 SQL \u8bed\u53e5\u7684\u96c6\u5408\u3002\u4e8c\u8005\u5408\u79f0\u4e3a routine \u3002 \u533a\u522b\uff1a \u51fd\u6570\u5fc5\u987b\u6709\u8fd4\u56de\u503c\uff0c\u800c\u5b58\u50a8\u8fc7\u7a0b\u6ca1\u6709 \u5b58\u50a8\u8fc7\u7a0b\u7684\u53c2\u6570\u53ef\u4ee5\u4f7f\u7528 IN\u3001 OUT\u3001 INOUT \u7c7b\u578b\uff0c\u800c\u51fd\u6570\u7684\u53c2\u6570\u53ea\u80fd\u662f IN \u7c7b\u578b\u7684 \u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b\u6216\u8005\u51fd\u6570\u9700\u8981 CREATE ROUTINE \u6743\u9650\uff0c\u4fee\u6539\u6216\u8005\u5220\u9664\u5b58\u50a8\u8fc7\u7a0b\u6216\u8005\u51fd\u6570\u9700\u8981 ALTER ROUTINE \u6743\u9650\uff0c\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\u6216\u8005\u51fd\u6570\u9700\u8981 EXECUTE \u6743\u9650\u3002 1. \u521b\u5efa \u00b6 CREATE [ DEFINER = { user | CURRENT_USER } ] PROCEDURE sp_name ([ proc_parameter [,...]]) [ characteristic ...] routine_body CREATE [ DEFINER = { user | CURRENT_USER } ] FUNCTION sp_name ([ func_parameter [,...]]) RETURNS type [ characteristic ...] routine_body proc_parameter : [ IN | OUT | INOUT ] param_name type func_parameter : param_name type type : Any valid MySQL data type characteristic : COMMENT 'string' | LANGUAGE SQL | [ NOT ] DETERMINISTIC | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } routine_body : Valid SQL routine statement \u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u4e2d\u4e0d\u5141\u8bb8\u6267\u884c LOAD DATA INFILE \u8bed\u53e5\u3002 \u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u4e8b\u52a1\u5f00\u59cb\u8bed\u53e5\u9700\u8981\u66ff\u6362\u4e3a START TRANSACTION \u3002 \u5b58\u50a8\u8fc7\u7a0b\u4e0d\u80fd\u5305\u542b \u53ea\u80fd\u5728\u8fd0\u884c\u65f6\u786e\u5b9a\u8fd4\u56de\u7ed3\u679c\u96c6\u7684\u8bed\u53e5\u3002 \u51fd\u6570\u4e0d\u5141\u8bb8\u8fd4\u56de\u7ed3\u679c\u96c6\uff0c\u5b58\u50a8\u8fc7\u7a0b\u53ef\u4ee5\u3002 \u51fd\u6570\u4e0d\u80fd\u5305\u542b\u4e8b\u52a1\u8bed\u53e5\u3002 \u4e0d\u5141\u8bb8\u9012\u5f52\u4f7f\u7528\u51fd\u6570\u3002 \u4e0d\u5141\u8bb8\u4f7f\u7528 USE \u3002 /* \u5b9a\u4e49\u5b58\u50a8\u8fc7\u7a0b */ MariaDB [ MYISAM_TEST ] > delimiter $$ MariaDB [ MYISAM_TEST ] > CREATE PROCEDURE get_child_count ( IN pid INT , OUT count INT ) READs SQL DATA BEGIN SELECT COUNT ( * ) FROM CHILD WHERE PARENT_ID = pid ; SELECT FOUND_ROWS () INTO count ; END $$ MariaDB [ MYISAM_TEST ] > delimiter ; /* \u5b9a\u4e49\u51fd\u6570 */ MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION get_date () RETURNS CHAR ( 10 ) BEGIN DECLARE RESULT CHAR ( 10 ); SELECT DATE_FORMAT ( CURRENT_DATE , '%Y-%m-%d' ) INTO RESULT ; RETURN RESULT ; END // MariaDB [ MYISAM_TEST ] > delimiter ; delimiter $$ \uff1a\u5728\u521b\u5efa\u4e4b\u524d\u5b9a\u4e49\u7ed3\u675f\u7b26\uff0c\u9632\u6b62\u5728\u5b9a\u4e49\u65f6\u8f93\u5165 ; \u800c\u9519\u8bef\u5730\u7ed3\u675f delimiter ; \uff1a\u6539\u56de\u9ed8\u8ba4\u7684\u7ed3\u675f\u7b26 2. \u4fee\u6539 \u00b6 ALTER { PROCEDURE | FUNCTION } proc_name [ characteristic ...] characteristic : COMMENT 'string' | LANGUAGE SQL | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } \u4ee5\u4e0b\u662f\u63d0\u4f9b\u5b50\u7a0b\u5e8f\u4f7f\u7528\u6570\u636e\u7684\u5185\u5728\u4fe1\u606f\u7684\u7279\u5f81\u503c\uff0c\u53ea\u662f\u63d0\u4f9b\u7ed9\u670d\u52a1\u5668\uff0c\u5e76\u6ca1\u6709\u9650\u5236\u5b9e\u9645\u7684\u6570\u636e\u4f7f\u7528\u60c5\u51b5\uff1a CONTAINS SQL\uff1a\u8868\u793a\u5b50\u7a0b\u5e8f\u4e0d\u5305\u542b\u8bfb\u6216\u5199\u6570\u636e\u7684\u8bed\u53e5 NO SQL\uff1a\u8868\u793a\u5b50\u7a0b\u5e8f\u4e0d\u5305\u542b SQL \u8bed\u53e5 READS SQL DATA\uff1a\u5305\u542b\u8bfb\u6570\u636e\u7684\u8bed\u53e5\uff0c\u4e0d\u5305\u542b\u5199 MODIFIES SQL DATA\uff1a\u5305\u542b\u5199\u6570\u636e\u7684\u8bed\u53e5 SQL SECURITY \u7279\u5f81\u503c\uff1a DEFINER\uff1a\u8868\u793a\u4ee5\u521b\u5efa\u8005\u7684\u6743\u9650\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u8bed\u53e5\u3002 INVOKER\uff1a\u8868\u793a\u4ee5\u8c03\u7528\u8005\u7684\u6743\u9650\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u8bed\u53e5\u3002\u5982\u679c\u8c03\u7528\u8005\u6ca1\u6709\u6267\u884c\u5176\u4e2d\u5b50\u7a0b\u5e8f\u7684\u6743\u9650\u4f1a\u62a5\u9519\u3002 3. \u8c03\u7528 \u00b6 \u5b58\u50a8\u8fc7\u7a0b CALL sp_name ([ parameter [,...]]) CALL sp_name [()] \u51fd\u6570 SELECT function (); \u6216\u5728\u5176\u4ed6\u5b50\u53e5\u4e2d\u76f4\u63a5\u4f7f\u7528 4. \u67e5\u770b \u00b6 4.1 \u72b6\u6001 \u00b6 SHOW { PROCEDURE | FUNCTION } STATUS [ LIKE 'pattern' | WHERE expr ] /* \u4e3e\u4f8b */ /* \u9ed8\u8ba4\u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b */ SHOW PROCEDURE STATUS ; SHOW PROCEDURE STATUS LIKE 'get_child_count' ; /* WHERE \u7528\u4e8e\u5bf9\u5b57\u6bb5\u505a\u51fa\u9650\u5b9a\u3002 */ SHOW PROCEDURE STATUS WHERE Name LIKE 'get_child_count' ; 4.2 \u5b9a\u4e49 \u00b6 SHOW CREATE { PROCEDURE | FUNCTION } sp_name ; SHOW CREATE PROCEDURE get_child_count \\ G ; 4.3 \u4fe1\u606f \u00b6 \u901a\u8fc7\u67e5\u770b\u7cfb\u7edf\u8868 information_schema.Routines \u5c31\u53ef\u4ee5\u83b7\u5f97\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u7684\u4fe1\u606f\u3002 MariaDB [ information_schema ] > SELECT * FROM ROUTINES WHERE ROUTINE_NAME = 'get_child_count' \\ G ; 5. \u5220\u9664 \u00b6 DROP { PROCEDURE | FUNCTION } [ IF EXISTS ] sp_name ;","title":"16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#1","text":"CREATE [ DEFINER = { user | CURRENT_USER } ] PROCEDURE sp_name ([ proc_parameter [,...]]) [ characteristic ...] routine_body CREATE [ DEFINER = { user | CURRENT_USER } ] FUNCTION sp_name ([ func_parameter [,...]]) RETURNS type [ characteristic ...] routine_body proc_parameter : [ IN | OUT | INOUT ] param_name type func_parameter : param_name type type : Any valid MySQL data type characteristic : COMMENT 'string' | LANGUAGE SQL | [ NOT ] DETERMINISTIC | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } routine_body : Valid SQL routine statement \u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u4e2d\u4e0d\u5141\u8bb8\u6267\u884c LOAD DATA INFILE \u8bed\u53e5\u3002 \u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u4e8b\u52a1\u5f00\u59cb\u8bed\u53e5\u9700\u8981\u66ff\u6362\u4e3a START TRANSACTION \u3002 \u5b58\u50a8\u8fc7\u7a0b\u4e0d\u80fd\u5305\u542b \u53ea\u80fd\u5728\u8fd0\u884c\u65f6\u786e\u5b9a\u8fd4\u56de\u7ed3\u679c\u96c6\u7684\u8bed\u53e5\u3002 \u51fd\u6570\u4e0d\u5141\u8bb8\u8fd4\u56de\u7ed3\u679c\u96c6\uff0c\u5b58\u50a8\u8fc7\u7a0b\u53ef\u4ee5\u3002 \u51fd\u6570\u4e0d\u80fd\u5305\u542b\u4e8b\u52a1\u8bed\u53e5\u3002 \u4e0d\u5141\u8bb8\u9012\u5f52\u4f7f\u7528\u51fd\u6570\u3002 \u4e0d\u5141\u8bb8\u4f7f\u7528 USE \u3002 /* \u5b9a\u4e49\u5b58\u50a8\u8fc7\u7a0b */ MariaDB [ MYISAM_TEST ] > delimiter $$ MariaDB [ MYISAM_TEST ] > CREATE PROCEDURE get_child_count ( IN pid INT , OUT count INT ) READs SQL DATA BEGIN SELECT COUNT ( * ) FROM CHILD WHERE PARENT_ID = pid ; SELECT FOUND_ROWS () INTO count ; END $$ MariaDB [ MYISAM_TEST ] > delimiter ; /* \u5b9a\u4e49\u51fd\u6570 */ MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION get_date () RETURNS CHAR ( 10 ) BEGIN DECLARE RESULT CHAR ( 10 ); SELECT DATE_FORMAT ( CURRENT_DATE , '%Y-%m-%d' ) INTO RESULT ; RETURN RESULT ; END // MariaDB [ MYISAM_TEST ] > delimiter ; delimiter $$ \uff1a\u5728\u521b\u5efa\u4e4b\u524d\u5b9a\u4e49\u7ed3\u675f\u7b26\uff0c\u9632\u6b62\u5728\u5b9a\u4e49\u65f6\u8f93\u5165 ; \u800c\u9519\u8bef\u5730\u7ed3\u675f delimiter ; \uff1a\u6539\u56de\u9ed8\u8ba4\u7684\u7ed3\u675f\u7b26","title":"1. \u521b\u5efa"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#2","text":"ALTER { PROCEDURE | FUNCTION } proc_name [ characteristic ...] characteristic : COMMENT 'string' | LANGUAGE SQL | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER } \u4ee5\u4e0b\u662f\u63d0\u4f9b\u5b50\u7a0b\u5e8f\u4f7f\u7528\u6570\u636e\u7684\u5185\u5728\u4fe1\u606f\u7684\u7279\u5f81\u503c\uff0c\u53ea\u662f\u63d0\u4f9b\u7ed9\u670d\u52a1\u5668\uff0c\u5e76\u6ca1\u6709\u9650\u5236\u5b9e\u9645\u7684\u6570\u636e\u4f7f\u7528\u60c5\u51b5\uff1a CONTAINS SQL\uff1a\u8868\u793a\u5b50\u7a0b\u5e8f\u4e0d\u5305\u542b\u8bfb\u6216\u5199\u6570\u636e\u7684\u8bed\u53e5 NO SQL\uff1a\u8868\u793a\u5b50\u7a0b\u5e8f\u4e0d\u5305\u542b SQL \u8bed\u53e5 READS SQL DATA\uff1a\u5305\u542b\u8bfb\u6570\u636e\u7684\u8bed\u53e5\uff0c\u4e0d\u5305\u542b\u5199 MODIFIES SQL DATA\uff1a\u5305\u542b\u5199\u6570\u636e\u7684\u8bed\u53e5 SQL SECURITY \u7279\u5f81\u503c\uff1a DEFINER\uff1a\u8868\u793a\u4ee5\u521b\u5efa\u8005\u7684\u6743\u9650\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u8bed\u53e5\u3002 INVOKER\uff1a\u8868\u793a\u4ee5\u8c03\u7528\u8005\u7684\u6743\u9650\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u7684\u8bed\u53e5\u3002\u5982\u679c\u8c03\u7528\u8005\u6ca1\u6709\u6267\u884c\u5176\u4e2d\u5b50\u7a0b\u5e8f\u7684\u6743\u9650\u4f1a\u62a5\u9519\u3002","title":"2. \u4fee\u6539"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#3","text":"\u5b58\u50a8\u8fc7\u7a0b CALL sp_name ([ parameter [,...]]) CALL sp_name [()] \u51fd\u6570 SELECT function (); \u6216\u5728\u5176\u4ed6\u5b50\u53e5\u4e2d\u76f4\u63a5\u4f7f\u7528","title":"3. \u8c03\u7528"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#4","text":"","title":"4. \u67e5\u770b"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#41","text":"SHOW { PROCEDURE | FUNCTION } STATUS [ LIKE 'pattern' | WHERE expr ] /* \u4e3e\u4f8b */ /* \u9ed8\u8ba4\u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b */ SHOW PROCEDURE STATUS ; SHOW PROCEDURE STATUS LIKE 'get_child_count' ; /* WHERE \u7528\u4e8e\u5bf9\u5b57\u6bb5\u505a\u51fa\u9650\u5b9a\u3002 */ SHOW PROCEDURE STATUS WHERE Name LIKE 'get_child_count' ;","title":"4.1 \u72b6\u6001"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#42","text":"SHOW CREATE { PROCEDURE | FUNCTION } sp_name ; SHOW CREATE PROCEDURE get_child_count \\ G ;","title":"4.2 \u5b9a\u4e49"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#43","text":"\u901a\u8fc7\u67e5\u770b\u7cfb\u7edf\u8868 information_schema.Routines \u5c31\u53ef\u4ee5\u83b7\u5f97\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\u7684\u4fe1\u606f\u3002 MariaDB [ information_schema ] > SELECT * FROM ROUTINES WHERE ROUTINE_NAME = 'get_child_count' \\ G ;","title":"4.3 \u4fe1\u606f"},{"location":"mysql/16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570/#5","text":"DROP { PROCEDURE | FUNCTION } [ IF EXISTS ] sp_name ;","title":"5. \u5220\u9664"},{"location":"mysql/17.0 MySQL\u590d\u5408\u8bed\u53e5/","text":"17.xxx \u8fd9\u4e00\u90e8\u5206\u63cf\u8ff0\u7684\u662f BEGIN...END \u8bed\u53e5\u4ee5\u53ca\u80fd\u5728\u5b58\u50a8\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684\u8bed\u53e5\u3002 \u5b58\u50a8\u7a0b\u5e8f \uff1a\u5b58\u50a8\u8fc7\u7a0b\u3001\u51fd\u6570\u3001\u89e6\u53d1\u5668\u3001\u4e8b\u4ef6\u3002\u8fd9\u4e9b\u5bf9\u8c61\u662f\u6839\u636e\u5b58\u50a8\u5728\u670d\u52a1\u5668\u4e0a\u4ee5\u4f9b\u4ee5\u540e\u8c03\u7528\u7684SQL\u4ee3\u7801\u5b9a\u4e49\u7684\u3002 \u590d\u5408\u8bed\u53e5\u7684\u6307\u7684\u662f\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u7684\u4ee3\u7801\u5757\u3001\u53d8\u91cf\u7684\u58f0\u660e\u3001\u72b6\u51b5\u5904\u7406\u3001\u6e38\u6807\u3001\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u3002","title":"17.0 MySQL\u590d\u5408\u8bed\u53e5"},{"location":"mysql/17.1 BEGIN...END\u590d\u5408\u8bed\u53e5/","text":"\u7528\u4e8e\u7f16\u5199\u590d\u5408\u8bed\u53e5\u3002 statement_list \u4e2d\u7684\u6bcf\u6761\u8bed\u53e5\u4f7f\u7528 ; \u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u524d\u9700\u8981\u901a\u8fc7 delimiter new_delimiter \u6539\u53d8\uff0c\u5b58\u50a8\u7a0b\u5e8f\u5b9a\u4e49\u5b8c\u6210\u4e4b\u540e\u518d\u66f4\u6539\u4e3a ; \u3002\u53c2\u8003 16. MySQL\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570 \u3002 \u8be5\u7ed3\u6784\u53ef\u5d4c\u5957\u3002","title":"17.1 BEGIN...END\u590d\u5408\u8bed\u53e5"},{"location":"mysql/17.2 \u8bed\u53e5\u6807\u7b7e/","text":"1. \u8bed\u6cd5\u53ca\u89c4\u5219 \u00b6 [ begin_label :] BEGIN [ statement_list ] END [ end_label ] [ begin_label :] LOOP statement_list END LOOP [ end_label ] [ begin_label :] REPEAT statement_list UNTIL search_condition END REPEAT [ end_label ] [ begin_label :] WHILE search_condition DO statement_list END WHILE [ end_label ] \u4f7f\u7528\u89c4\u5219\uff1a end_label\u53ef\u4ee5\u6ca1\u6709\uff0c\u4f46\u662f\u5982\u679c\u5b58\u5728\u5219\u5fc5\u987b\u548cbegin_label\u4e00\u81f4 \u4e0d\u80fd\u53ea\u6709end_label \u540c\u4e00\u4e2a\u5d4c\u5957\u7b49\u7ea7\u7684label\u4e0d\u80fd\u91cd\u590d label\u81f3\u591a\u670916\u4e2a\u5b57\u7b26\u957f\u5ea6 2. \u4f7f\u7528 \u00b6 \u4f7f\u7528 ITERATE \u8fdb\u5165\uff0c\u4f7f\u7528 LEAVE \u79bb\u5f00\u3002 CREATE PROCEDURE doiterate ( p1 INT ) BEGIN label1 : LOOP SET p1 = p1 + 1 ; IF p1 < 10 THEN ITERATE label1 ; END IF ; LEAVE label1 ; END LOOP label1 ; END ;","title":"17.2 \u8bed\u53e5\u6807\u7b7e"},{"location":"mysql/17.2 \u8bed\u53e5\u6807\u7b7e/#1","text":"[ begin_label :] BEGIN [ statement_list ] END [ end_label ] [ begin_label :] LOOP statement_list END LOOP [ end_label ] [ begin_label :] REPEAT statement_list UNTIL search_condition END REPEAT [ end_label ] [ begin_label :] WHILE search_condition DO statement_list END WHILE [ end_label ] \u4f7f\u7528\u89c4\u5219\uff1a end_label\u53ef\u4ee5\u6ca1\u6709\uff0c\u4f46\u662f\u5982\u679c\u5b58\u5728\u5219\u5fc5\u987b\u548cbegin_label\u4e00\u81f4 \u4e0d\u80fd\u53ea\u6709end_label \u540c\u4e00\u4e2a\u5d4c\u5957\u7b49\u7ea7\u7684label\u4e0d\u80fd\u91cd\u590d label\u81f3\u591a\u670916\u4e2a\u5b57\u7b26\u957f\u5ea6","title":"1. \u8bed\u6cd5\u53ca\u89c4\u5219"},{"location":"mysql/17.2 \u8bed\u53e5\u6807\u7b7e/#2","text":"\u4f7f\u7528 ITERATE \u8fdb\u5165\uff0c\u4f7f\u7528 LEAVE \u79bb\u5f00\u3002 CREATE PROCEDURE doiterate ( p1 INT ) BEGIN label1 : LOOP SET p1 = p1 + 1 ; IF p1 < 10 THEN ITERATE label1 ; END IF ; LEAVE label1 ; END LOOP label1 ; END ;","title":"2. \u4f7f\u7528"},{"location":"mysql/17.3 \u58f0\u660e\u8bed\u6cd5/","text":"DECLARE \u7528\u4e8e\u5728\u7a0b\u5e8f\u4e2d\u5b9a\u4e49\u672c\u5730\u6761\u76ee\uff1a \u672c\u5730\u53d8\u91cf\u3002 17.4 \u53d8\u91cf \u72b6\u51b5\u548c\u5904\u7406\u5668\u3002 17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406 \u6e38\u6807\u3002 17.6 \u6e38\u6807 DECLARE\u53ea\u80fd\u5728 BEGIN...END \u8bed\u53e5\u4e2d\u7684\u5934\u90e8\uff0c\u5728\u4efb\u4f55\u5176\u4ed6\u8bed\u53e5\u4e4b\u524d\u3002 \u58f0\u660e\u5fc5\u987b\u6709\u4e00\u5b9a\u7684\u987a\u5e8f\uff1a \u6e38\u6807\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u58f0\u660e\u4e4b\u524d \u53d8\u91cf\u548c\u72b6\u51b5\u58f0\u660e\u5fc5\u987b\u5728\u6e38\u6807\u6216\u5904\u7406\u5668\u58f0\u660e\u4e4b\u524d","title":"17.3 \u58f0\u660e\u8bed\u6cd5"},{"location":"mysql/17.4 \u53d8\u91cf/","text":"1. \u5b9a\u4e49\u53d8\u91cf 2. \u4f7f\u7528\u9650\u5236 3. \u5c40\u90e8\u53d8\u91cf \u7528\u6237\u81ea\u5b9a\u4e49\u53d8\u91cf\uff1a @var_name \u3002\u53ef\u4ee5\u7531 \u5b57\u6bcd\u3001\u6570\u5b57\u3001\u70b9\u3001\u4e0b\u5212\u7ebf\u3001$ \u7ec4\u6210\uff0c\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u5b58\u50a8\u5728 session \u4e2d\uff0c\u53ea\u5728\u5f53\u524d\u5ba2\u6237\u7aef\u4e2d\u8d77\u4f5c\u7528\uff0c\u9000\u51fa\u65f6\u6e05\u9664\u6240\u6709\u81ea\u5b9a\u4e49\u53d8\u91cf\u3002 1. \u5b9a\u4e49\u53d8\u91cf \u00b6 /* 1.SET\u8bed\u6cd5\u8d4b\u503c */ SET @ var_name { = | : = } expr [, @ var_name = expr ] ... /* 2.\u901a\u8fc7\u67e5\u8be2\u5c06\u7ed3\u679c\u8d4b\u7ed9\u53d8\u91cf\uff0c\u8fd9\u8981\u6c42\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u5fc5\u987b\u53ea\u6709\u4e00\u884c */ SELECT col_name [,...] INTO @ var_name [,...] table_expr /* 3.\u901a\u8fc7\u6e38\u6807\u8d4b\u503c */ FETCH [[ NEXT ] FROM ] cursor_name INTO var_name [, var_name ] ... /* \u8868\u8fbe\u5f0f\u4e3e\u4f8b */ /* \u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u53ea\u80fd\u662f\u5355\u4e00\u5b57\u6bb5\uff0c\u5e76\u4e14\u53ea\u80fd\u6709\u4e00\u4e2a\u503c */ MariaDB [ MYISAM_TEST ] > SET @ V2 = ( SELECT COUNT ( ID ) FROM PARENT ); MariaDB [ MYISAM_TEST ] > SELECT ID INTO @ RESULT FROM CHILD WHERE ID = 1 ; \u503c\u7684\u7c7b\u578b\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6574\u6570 \u5b9a\u70b9\u6570 \u6d6e\u70b9\u6570 \u4e8c\u8fdb\u5236\u6216\u975e\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u3002\u5982\u679c\u8d4b\u4e88\u4e86\u975e\u4e8c\u8fdb\u5236\uff08character\uff09\u7684\u5b57\u7b26\u4e32\uff0c\u5c31\u548c\u5b57\u7b26\u4e32\u5177\u6709\u76f8\u540c\u7684\u5b57\u7b26\u96c6\u4e0e\u6392\u5e8f\u89c4\u5219\u3002\u5341\u516d\u8fdb\u5236\u548c\u6bd4\u7279\u7c7b\u578b\u7684\u503c\u88ab\u8ba4\u4e3a\u662f\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8f6c\u6362\u4f7f\u7528\u5b83\u7684\u6570\u5b57\u5f62\u5f0f\u3002 NULL mysql > SET @ v1 = X '41' ; mysql > SET @ v2 = X '41' + 0 ; mysql > SET @ v3 = CAST ( X '41' AS UNSIGNED ); mysql > SELECT @ v1 , @ v2 , @ v3 ; +------+------+------+ | @ v1 | @ v2 | @ v3 | +------+------+------+ | A | 65 | 65 | +------+------+------+ mysql > SET @ v1 = b '1000001' ; mysql > SET @ v2 = b '1000001' + 0 ; mysql > SET @ v3 = CAST ( b '1000001' AS UNSIGNED ); mysql > SELECT @ v1 , @ v2 , @ v3 ; +------+------+------+ | @ v1 | @ v2 | @ v3 | +------+------+------+ | A | 65 | 65 | +------+------+------+ \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u5b9a\u4e49\u53d8\u91cf\uff1a mysql > SET @ t1 = 1 , @ t2 = 2 , @ t3 : = 4 ; mysql > SELECT @ t1 , @ t2 , @ t3 , @ t4 : = @ t1 +@ t2 +@ t3 ; +------+------+------+--------------------+ | @ t1 | @ t2 | @ t3 | @ t4 : = @ t1 +@ t2 +@ t3 | +------+------+------+--------------------+ | 1 | 2 | 4 | 7 | +------+------+------+--------------------+ 2. \u4f7f\u7528\u9650\u5236 \u00b6 \u5982\u679c\u5728\u7ed3\u679c\u96c6\u4e2d\u9009\u62e9\u4e86\u7528\u6237\u53d8\u91cf\u7684\u503c\uff0c\u5219\u4f1a\u5c06\u5176\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\uff1f\uff1f\uff1f \u89c4\u5b9a \uff1a\u9664\u4e86\u5728 SET \u8bed\u53e5\u4e2d\uff0c\u4e0d\u8981\u5728\u540c\u4e00\u6761\u8bed\u53e5\u4e2d\u5bf9\u53d8\u91cf\u8d4b\u503c\u5e76\u8bfb\u53d6\u3002 \u5728SELECT\u8bed\u53e5\u4e2d\uff0c\u4ec5\u5728\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u65f6\u8bc4\u4f30\u6bcf\u4e2aselect\u8868\u8fbe\u5f0f\uff0c\u8fd9\u610f\u5473\u7740\u5728 HAVING , GROUP BY , or ORDER BY \u4e2d\u5f15\u7528\u53d8\u91cf\u4e0d\u4f1a\u8fd4\u56de\u6b63\u5e38\u7684\u7ed3\u679c\u3002 \u53d8\u91cf\u4e0d\u80fd\u76f4\u63a5\u7528\u4f5cSQL\u8bed\u53e5\u4e2d\u7684 \u6807\u8bc6\u7b26 \u6216\u6807\u8bc6\u7b26\u7684\u4e00\u90e8\u5206\uff0c\u52a0\u4e86\u5f15\u53f7\u4e5f\u6ca1\u7528\u3002\u4f8b\u5982 SELECT \u8bed\u53e5\u4e2d\u7684\u8868\u540d\u3002\u4e00\u4e2a \u4f8b\u5916 \u662f\uff0c\u5f53\u6784\u9020\u4e00\u4e2a\u5b57\u7b26\u4e32\u4ee5\u7528\u4f5c\u7a0d\u540e\u6267\u884c\u7684\u9884\u51c6\u5907\u8bed\u53e5\u65f6\u3002 mysql > SET @ c = \"c1\" ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > SET @ s = CONCAT ( \"SELECT \" , @ c , \" FROM t\" ); Query OK , 0 rows affected ( 0 . 00 sec ) mysql > PREPARE stmt FROM @ s ; Query OK , 0 rows affected ( 0 . 04 sec ) Statement prepared mysql > EXECUTE stmt ; + ----+ | c1 | + ----+ | 0 | + ----+ | 1 | + ----+ 2 rows in set ( 0 . 00 sec ) mysql > DEALLOCATE PREPARE stmt ; Query OK , 0 rows affected ( 0 . 00 sec ) 3. \u5c40\u90e8\u53d8\u91cf \u00b6 \u5b58\u50a8\u7a0b\u5e8f\u4f7f\u7528 DECLARE \u58f0\u660e\u5c40\u90e8\u53d8\u91cf\uff0c\u5728 BEGIN...END \u8bed\u53e5\u6216\u5d4c\u5957\u7684\u5757\u4e2d\u4f7f\u7528\u3002 DECLARE var_name [, var_name ] ... type [ DEFAULT value ] \u5982\u679c\u6709\u9ed8\u8ba4\u503c\u7684\u8bdd\u5fc5\u987b\u662f \u5e38\u91cf \uff0c\u6ca1\u6709\u7684\u8bdd\u521d\u59cb\u503c\u662f NULL \u3002 \u53d8\u91cf\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u548c\u6e38\u6807\u58f0\u660e\u4e4b\u524d\u3002 \u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u53ef\u4ee5\u5728\u5d4c\u5957\u7684\u7a0b\u5e8f\u5757\u4e2d\u4f7f\u7528\u53d8\u91cf\uff0c\u9664\u4e86\u5d4c\u5957\u7684\u5757\u4e2d\u58f0\u660e\u4e86\u540c\u540d\u7684\u53d8\u91cf\u3002 \u53ea\u4f5c\u7528\u4e8e\u5b58\u50a8\u8fc7\u7a0b\u6216\u51fd\u6570\u7684\u8fd0\u884c\u671f\u95f4\uff0c\u4e0d\u5141\u8bb8\u5728\u5b58\u50a8\u7a0b\u5e8f\u7684\u9884\u51c6\u5907\u8bed\u53e5\u4e2d\u5f15\u7528\uff08\u9884\u51c6\u5907\u8bed\u53e5\u7684\u4f5c\u7528\u57df\u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684session\uff09\u3002 \u4f8b\u5b50\uff1a MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION get_date () RETURNS CHAR ( 10 ) BEGIN DECLARE RESULT CHAR ( 10 ); SELECT DATE_FORMAT ( CURRENT_DATE , '%Y-%m-%d' ) INTO RESULT ; RETURN RESULT ; END // MariaDB [ MYISAM_TEST ] > delimiter ; MariaDB [ MYISAM_TEST ] > SET @ RE = get_date (); Query OK , 0 rows affected ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > SELECT @ RE ; +------------+ | @ RE | +------------+ | 2019 - 05 - 13 | +------------+","title":"17.4 \u53d8\u91cf"},{"location":"mysql/17.4 \u53d8\u91cf/#1","text":"/* 1.SET\u8bed\u6cd5\u8d4b\u503c */ SET @ var_name { = | : = } expr [, @ var_name = expr ] ... /* 2.\u901a\u8fc7\u67e5\u8be2\u5c06\u7ed3\u679c\u8d4b\u7ed9\u53d8\u91cf\uff0c\u8fd9\u8981\u6c42\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u5fc5\u987b\u53ea\u6709\u4e00\u884c */ SELECT col_name [,...] INTO @ var_name [,...] table_expr /* 3.\u901a\u8fc7\u6e38\u6807\u8d4b\u503c */ FETCH [[ NEXT ] FROM ] cursor_name INTO var_name [, var_name ] ... /* \u8868\u8fbe\u5f0f\u4e3e\u4f8b */ /* \u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u53ea\u80fd\u662f\u5355\u4e00\u5b57\u6bb5\uff0c\u5e76\u4e14\u53ea\u80fd\u6709\u4e00\u4e2a\u503c */ MariaDB [ MYISAM_TEST ] > SET @ V2 = ( SELECT COUNT ( ID ) FROM PARENT ); MariaDB [ MYISAM_TEST ] > SELECT ID INTO @ RESULT FROM CHILD WHERE ID = 1 ; \u503c\u7684\u7c7b\u578b\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6574\u6570 \u5b9a\u70b9\u6570 \u6d6e\u70b9\u6570 \u4e8c\u8fdb\u5236\u6216\u975e\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u3002\u5982\u679c\u8d4b\u4e88\u4e86\u975e\u4e8c\u8fdb\u5236\uff08character\uff09\u7684\u5b57\u7b26\u4e32\uff0c\u5c31\u548c\u5b57\u7b26\u4e32\u5177\u6709\u76f8\u540c\u7684\u5b57\u7b26\u96c6\u4e0e\u6392\u5e8f\u89c4\u5219\u3002\u5341\u516d\u8fdb\u5236\u548c\u6bd4\u7279\u7c7b\u578b\u7684\u503c\u88ab\u8ba4\u4e3a\u662f\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8f6c\u6362\u4f7f\u7528\u5b83\u7684\u6570\u5b57\u5f62\u5f0f\u3002 NULL mysql > SET @ v1 = X '41' ; mysql > SET @ v2 = X '41' + 0 ; mysql > SET @ v3 = CAST ( X '41' AS UNSIGNED ); mysql > SELECT @ v1 , @ v2 , @ v3 ; +------+------+------+ | @ v1 | @ v2 | @ v3 | +------+------+------+ | A | 65 | 65 | +------+------+------+ mysql > SET @ v1 = b '1000001' ; mysql > SET @ v2 = b '1000001' + 0 ; mysql > SET @ v3 = CAST ( b '1000001' AS UNSIGNED ); mysql > SELECT @ v1 , @ v2 , @ v3 ; +------+------+------+ | @ v1 | @ v2 | @ v3 | +------+------+------+ | A | 65 | 65 | +------+------+------+ \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u5b9a\u4e49\u53d8\u91cf\uff1a mysql > SET @ t1 = 1 , @ t2 = 2 , @ t3 : = 4 ; mysql > SELECT @ t1 , @ t2 , @ t3 , @ t4 : = @ t1 +@ t2 +@ t3 ; +------+------+------+--------------------+ | @ t1 | @ t2 | @ t3 | @ t4 : = @ t1 +@ t2 +@ t3 | +------+------+------+--------------------+ | 1 | 2 | 4 | 7 | +------+------+------+--------------------+","title":"1. \u5b9a\u4e49\u53d8\u91cf"},{"location":"mysql/17.4 \u53d8\u91cf/#2","text":"\u5982\u679c\u5728\u7ed3\u679c\u96c6\u4e2d\u9009\u62e9\u4e86\u7528\u6237\u53d8\u91cf\u7684\u503c\uff0c\u5219\u4f1a\u5c06\u5176\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\uff1f\uff1f\uff1f \u89c4\u5b9a \uff1a\u9664\u4e86\u5728 SET \u8bed\u53e5\u4e2d\uff0c\u4e0d\u8981\u5728\u540c\u4e00\u6761\u8bed\u53e5\u4e2d\u5bf9\u53d8\u91cf\u8d4b\u503c\u5e76\u8bfb\u53d6\u3002 \u5728SELECT\u8bed\u53e5\u4e2d\uff0c\u4ec5\u5728\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u65f6\u8bc4\u4f30\u6bcf\u4e2aselect\u8868\u8fbe\u5f0f\uff0c\u8fd9\u610f\u5473\u7740\u5728 HAVING , GROUP BY , or ORDER BY \u4e2d\u5f15\u7528\u53d8\u91cf\u4e0d\u4f1a\u8fd4\u56de\u6b63\u5e38\u7684\u7ed3\u679c\u3002 \u53d8\u91cf\u4e0d\u80fd\u76f4\u63a5\u7528\u4f5cSQL\u8bed\u53e5\u4e2d\u7684 \u6807\u8bc6\u7b26 \u6216\u6807\u8bc6\u7b26\u7684\u4e00\u90e8\u5206\uff0c\u52a0\u4e86\u5f15\u53f7\u4e5f\u6ca1\u7528\u3002\u4f8b\u5982 SELECT \u8bed\u53e5\u4e2d\u7684\u8868\u540d\u3002\u4e00\u4e2a \u4f8b\u5916 \u662f\uff0c\u5f53\u6784\u9020\u4e00\u4e2a\u5b57\u7b26\u4e32\u4ee5\u7528\u4f5c\u7a0d\u540e\u6267\u884c\u7684\u9884\u51c6\u5907\u8bed\u53e5\u65f6\u3002 mysql > SET @ c = \"c1\" ; Query OK , 0 rows affected ( 0 . 00 sec ) mysql > SET @ s = CONCAT ( \"SELECT \" , @ c , \" FROM t\" ); Query OK , 0 rows affected ( 0 . 00 sec ) mysql > PREPARE stmt FROM @ s ; Query OK , 0 rows affected ( 0 . 04 sec ) Statement prepared mysql > EXECUTE stmt ; + ----+ | c1 | + ----+ | 0 | + ----+ | 1 | + ----+ 2 rows in set ( 0 . 00 sec ) mysql > DEALLOCATE PREPARE stmt ; Query OK , 0 rows affected ( 0 . 00 sec )","title":"2. \u4f7f\u7528\u9650\u5236"},{"location":"mysql/17.4 \u53d8\u91cf/#3","text":"\u5b58\u50a8\u7a0b\u5e8f\u4f7f\u7528 DECLARE \u58f0\u660e\u5c40\u90e8\u53d8\u91cf\uff0c\u5728 BEGIN...END \u8bed\u53e5\u6216\u5d4c\u5957\u7684\u5757\u4e2d\u4f7f\u7528\u3002 DECLARE var_name [, var_name ] ... type [ DEFAULT value ] \u5982\u679c\u6709\u9ed8\u8ba4\u503c\u7684\u8bdd\u5fc5\u987b\u662f \u5e38\u91cf \uff0c\u6ca1\u6709\u7684\u8bdd\u521d\u59cb\u503c\u662f NULL \u3002 \u53d8\u91cf\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u548c\u6e38\u6807\u58f0\u660e\u4e4b\u524d\u3002 \u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u53ef\u4ee5\u5728\u5d4c\u5957\u7684\u7a0b\u5e8f\u5757\u4e2d\u4f7f\u7528\u53d8\u91cf\uff0c\u9664\u4e86\u5d4c\u5957\u7684\u5757\u4e2d\u58f0\u660e\u4e86\u540c\u540d\u7684\u53d8\u91cf\u3002 \u53ea\u4f5c\u7528\u4e8e\u5b58\u50a8\u8fc7\u7a0b\u6216\u51fd\u6570\u7684\u8fd0\u884c\u671f\u95f4\uff0c\u4e0d\u5141\u8bb8\u5728\u5b58\u50a8\u7a0b\u5e8f\u7684\u9884\u51c6\u5907\u8bed\u53e5\u4e2d\u5f15\u7528\uff08\u9884\u51c6\u5907\u8bed\u53e5\u7684\u4f5c\u7528\u57df\u662f\u5f53\u524d\u5ba2\u6237\u7aef\u7684session\uff09\u3002 \u4f8b\u5b50\uff1a MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION get_date () RETURNS CHAR ( 10 ) BEGIN DECLARE RESULT CHAR ( 10 ); SELECT DATE_FORMAT ( CURRENT_DATE , '%Y-%m-%d' ) INTO RESULT ; RETURN RESULT ; END // MariaDB [ MYISAM_TEST ] > delimiter ; MariaDB [ MYISAM_TEST ] > SET @ RE = get_date (); Query OK , 0 rows affected ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > SELECT @ RE ; +------------+ | @ RE | +------------+ | 2019 - 05 - 13 | +------------+","title":"3. \u5c40\u90e8\u53d8\u91cf"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/","text":"1. CASE 2. IF 3. ITERATE 4. LEAVE 5. LOOP 6. REPEAT 7. RETURN 8. WHILE \u5728\u5b58\u50a8\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u53ef\u4ee5\u5d4c\u5957\u4f7f\u7528\u3002 MySQL\u4e0d\u652f\u6301 for\u5faa\u73af \u3002 \u6ce8\u610f\u4e0e MySQL\u5e38\u7528\u51fd\u6570 \u4e2d\u7684\u6d41\u7a0b\u51fd\u6570\u533a\u5206\u3002 1. CASE \u00b6 CASE case_value WHEN when_value THEN statement_list [ WHEN when_value THEN statement_list ] ... [ ELSE statement_list ] END CASE Or: CASE WHEN search_condition THEN statement_list [ WHEN search_condition THEN statement_list ] ... [ ELSE statement_list ] END CASE \u5bf9\u4e8e\u7b2c\u4e00\u79cd\u8bed\u6cd5\uff0c\u8868\u8fbe\u5f0f case_value \u4e0e when_value \u4f5c\u6bd4\u8f83\u76f4\u5230\u6709\u4e00\u4e2a\u76f8\u7b49\uff0c\u4e0d\u80fd\u7528\u4e8eNULL\u7684\u6bd4\u8f83\u3002 \u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u8bed\u6cd5\uff0c\u8bc4\u4f30\u6bcf\u4e2a search_condition \u8868\u8fbe\u5f0f\u76f4\u5230\u6709\u4e00\u4e2a\u4e3a\u771f\u3002 \u5982\u679c\u6ca1\u6709\u5339\u914d\u4e14\u6ca1\u6709 ELSE \u8bed\u53e5\uff0c\u4f1a\u629b\u51fa Case not found for CASE statement \u9519\u8bef\u3002 statement_list \u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002 \u4e3a\u4e86\u5ffd\u7565\u7a7a\u5339\u914d\u9519\u8bef\uff0c\u53ef\u4ee5\u5728ELSE\u4e2d\u5199\u7a7a\u7684BEGIN...END\u5757\uff1a DELIMITER | CREATE PROCEDURE p () BEGIN DECLARE v INT DEFAULT 1 ; CASE v WHEN 2 THEN SELECT v ; WHEN 3 THEN SELECT 0 ; ELSE BEGIN END ; END CASE ; END ; | DELIMITER ; 2. IF \u00b6 IF search_condition THEN statement_list [ ELSEIF search_condition THEN statement_list ] ... [ ELSE statement_list ] END IF statement_list \u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002 \u6bcf\u6761\u8bed\u53e5\u5fc5\u987b\u4ee5\u5206\u53f7 ; \u7ed3\u5c3e \u4f8b\u5b50\uff1a MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION COMPARE ( N INT , M INT ) RETURNS VARCHAR ( 50 ) BEGIN DECLARE RE VARCHAR ( 50 ); IF N > M THEN SET RE = CONCAT ( N , ' > ' , M ); ELSEIF N < M THEN SET RE = CONCAT ( N , ' < ' , M ); ELSE SET RE = CONCAT ( N , ' = ' , M ); END IF ; RETURN RE ; END ; // MariaDB [ MYISAM_TEST ] > delimiter ; 3. ITERATE \u00b6 ITERATE label \u5728 LOOP, REPEAT, WHILE \u8bed\u53e5\u4e2d\u4f7f\u7528\uff0c\u610f\u601d\u5c31\u662f\u518d\u6b21\u5f00\u59cb\u5faa\u73af\u3002 4. LEAVE \u00b6 LEAVE label \u4f7f\u7528\u8303\u56f4\uff1a BEGIN...END, LOOP, REPEAT, WHILE \u3002\u7528\u4e8e\u9000\u51fa\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u3002\u82e5 label \u662f\u6700\u5916\u5c42\u7684\u5b58\u50a8\u7a0b\u5e8f\u5757\uff0c\u610f\u5473\u7740\u9000\u51fa\u7a0b\u5e8f\u3002 5. LOOP \u00b6 [ begin_label :] LOOP statement_list END LOOP [ end_label ] \u901a\u5e38\u4e0e LEAVE \u3001 ITERATE \u914d\u5408\u4f7f\u7528\u3002 6. REPEAT \u00b6 [ begin_label :] REPEAT statement_list UNTIL search_condition END REPEAT [ end_label ] \u76f8\u5f53\u4e8e do...while \u8bed\u6cd5\u3002 \u6ce8\u610f\u5206\u53f7 mysql > delimiter // mysql > CREATE PROCEDURE dorepeat ( p1 INT ) BEGIN SET @ x = 0 ; REPEAT SET @ x = @ x + 1 ; UNTIL @ x > p1 END REPEAT ; END // Query OK , 0 rows affected ( 0 . 00 sec ) mysql > CALL dorepeat ( 1000 ) // Query OK , 0 rows affected ( 0 . 00 sec ) mysql > SELECT @ x // +------+ | @ x | +------+ | 1001 | +------+ 1 row in set ( 0 . 00 sec ) 7. RETURN \u00b6 RETURN expr \u53ea\u80fd\u5728\u51fd\u6570\u4e2d\u4f7f\u7528\u3002 8. WHILE \u00b6 [ begin_label :] WHILE search_condition DO statement_list END WHILE [ end_label ]","title":"17.5 \u6d41\u7a0b\u63a7\u5236"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#1-case","text":"CASE case_value WHEN when_value THEN statement_list [ WHEN when_value THEN statement_list ] ... [ ELSE statement_list ] END CASE Or: CASE WHEN search_condition THEN statement_list [ WHEN search_condition THEN statement_list ] ... [ ELSE statement_list ] END CASE \u5bf9\u4e8e\u7b2c\u4e00\u79cd\u8bed\u6cd5\uff0c\u8868\u8fbe\u5f0f case_value \u4e0e when_value \u4f5c\u6bd4\u8f83\u76f4\u5230\u6709\u4e00\u4e2a\u76f8\u7b49\uff0c\u4e0d\u80fd\u7528\u4e8eNULL\u7684\u6bd4\u8f83\u3002 \u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u8bed\u6cd5\uff0c\u8bc4\u4f30\u6bcf\u4e2a search_condition \u8868\u8fbe\u5f0f\u76f4\u5230\u6709\u4e00\u4e2a\u4e3a\u771f\u3002 \u5982\u679c\u6ca1\u6709\u5339\u914d\u4e14\u6ca1\u6709 ELSE \u8bed\u53e5\uff0c\u4f1a\u629b\u51fa Case not found for CASE statement \u9519\u8bef\u3002 statement_list \u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002 \u4e3a\u4e86\u5ffd\u7565\u7a7a\u5339\u914d\u9519\u8bef\uff0c\u53ef\u4ee5\u5728ELSE\u4e2d\u5199\u7a7a\u7684BEGIN...END\u5757\uff1a DELIMITER | CREATE PROCEDURE p () BEGIN DECLARE v INT DEFAULT 1 ; CASE v WHEN 2 THEN SELECT v ; WHEN 3 THEN SELECT 0 ; ELSE BEGIN END ; END CASE ; END ; | DELIMITER ;","title":"1. CASE"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#2-if","text":"IF search_condition THEN statement_list [ ELSEIF search_condition THEN statement_list ] ... [ ELSE statement_list ] END IF statement_list \u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002 \u6bcf\u6761\u8bed\u53e5\u5fc5\u987b\u4ee5\u5206\u53f7 ; \u7ed3\u5c3e \u4f8b\u5b50\uff1a MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE FUNCTION COMPARE ( N INT , M INT ) RETURNS VARCHAR ( 50 ) BEGIN DECLARE RE VARCHAR ( 50 ); IF N > M THEN SET RE = CONCAT ( N , ' > ' , M ); ELSEIF N < M THEN SET RE = CONCAT ( N , ' < ' , M ); ELSE SET RE = CONCAT ( N , ' = ' , M ); END IF ; RETURN RE ; END ; // MariaDB [ MYISAM_TEST ] > delimiter ;","title":"2. IF"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#3-iterate","text":"ITERATE label \u5728 LOOP, REPEAT, WHILE \u8bed\u53e5\u4e2d\u4f7f\u7528\uff0c\u610f\u601d\u5c31\u662f\u518d\u6b21\u5f00\u59cb\u5faa\u73af\u3002","title":"3. ITERATE"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#4-leave","text":"LEAVE label \u4f7f\u7528\u8303\u56f4\uff1a BEGIN...END, LOOP, REPEAT, WHILE \u3002\u7528\u4e8e\u9000\u51fa\u6d41\u7a0b\u63a7\u5236\u7ed3\u6784\u3002\u82e5 label \u662f\u6700\u5916\u5c42\u7684\u5b58\u50a8\u7a0b\u5e8f\u5757\uff0c\u610f\u5473\u7740\u9000\u51fa\u7a0b\u5e8f\u3002","title":"4. LEAVE"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#5-loop","text":"[ begin_label :] LOOP statement_list END LOOP [ end_label ] \u901a\u5e38\u4e0e LEAVE \u3001 ITERATE \u914d\u5408\u4f7f\u7528\u3002","title":"5. LOOP"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#6-repeat","text":"[ begin_label :] REPEAT statement_list UNTIL search_condition END REPEAT [ end_label ] \u76f8\u5f53\u4e8e do...while \u8bed\u6cd5\u3002 \u6ce8\u610f\u5206\u53f7 mysql > delimiter // mysql > CREATE PROCEDURE dorepeat ( p1 INT ) BEGIN SET @ x = 0 ; REPEAT SET @ x = @ x + 1 ; UNTIL @ x > p1 END REPEAT ; END // Query OK , 0 rows affected ( 0 . 00 sec ) mysql > CALL dorepeat ( 1000 ) // Query OK , 0 rows affected ( 0 . 00 sec ) mysql > SELECT @ x // +------+ | @ x | +------+ | 1001 | +------+ 1 row in set ( 0 . 00 sec )","title":"6. REPEAT"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#7-return","text":"RETURN expr \u53ea\u80fd\u5728\u51fd\u6570\u4e2d\u4f7f\u7528\u3002","title":"7. RETURN"},{"location":"mysql/17.5 \u6d41\u7a0b\u63a7\u5236/#8-while","text":"[ begin_label :] WHILE search_condition DO statement_list END WHILE [ end_label ]","title":"8. WHILE"},{"location":"mysql/17.6 \u6e38\u6807/","text":"1. \u58f0\u660e\u6e38\u6807 2. \u6253\u5f00\u6e38\u6807 3. \u53d6\u51fa\u6e38\u6807\u6307\u5411\u7684\u5185\u5bb9 4. \u5173\u95ed\u6e38\u6807 \u6e38\u6807 CURSOR \u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a Asensitive: \u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u4e5f\u53ef\u80fd\u4e0d\u4f1a\u590d\u5236\u5b83\u7684\u7ed3\u679c\u8868 Read only: \u4e0d\u53ef\u66f4\u65b0 Nonscrollable: \u53ea\u80fd\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u904d\u5386\uff0c\u4e0d\u80fd\u8df3\u884c \u6e38\u6807\u7684\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u4e4b\u524d\u58f0\u660e\uff0c\u53d8\u91cf\u548c\u72b6\u51b5\u58f0\u660e\u4e4b\u540e\u3002 \u4f8b\u5b50\uff1a CREATE PROCEDURE curdemo () BEGIN DECLARE done INT DEFAULT FALSE ; DECLARE a CHAR ( 16 ); DECLARE b , c INT ; DECLARE cur1 CURSOR FOR SELECT id , data FROM test . t1 ; DECLARE cur2 CURSOR FOR SELECT i FROM test . t2 ; DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE ; OPEN cur1 ; OPEN cur2 ; read_loop : LOOP FETCH cur1 INTO a , b ; FETCH cur2 INTO c ; IF done THEN LEAVE read_loop ; END IF ; IF b < c THEN INSERT INTO test . t3 VALUES ( a , b ); ELSE INSERT INTO test . t3 VALUES ( a , c ); END IF ; END LOOP ; CLOSE cur1 ; CLOSE cur2 ; END ; 1. \u58f0\u660e\u6e38\u6807 \u00b6 DECLARE cursor_name CURSOR FOR select_statement \u58f0\u660e\u4e00\u4e2a\u6e38\u6807\u5e76\u5173\u8054\u5230 SELECT \u8bed\u53e5\u68c0\u7d22\u8981\u904d\u5386\u7684\u8bb0\u5f55\u3002 SELECT \u8bed\u53e5\u4e0d\u80fd\u542b\u6709 INTO \u5b50\u53e5 \u6e38\u6807\u7684\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u4e4b\u524d\u58f0\u660e\uff0c\u53d8\u91cf\u548c\u72b6\u51b5\u4e4b\u540e\u58f0\u660e\u3002 \u4e0d\u5141\u8bb8\u58f0\u660e\u76f8\u540c\u7684\u6e38\u6807\u540d\u5b57 2. \u6253\u5f00\u6e38\u6807 \u00b6 OPEN cursor_name \u6253\u5f00\u4e00\u4e2a\u5148\u524d\u58f0\u660e\u7684\u6e38\u6807\u3002 3. \u53d6\u51fa\u6e38\u6807\u6307\u5411\u7684\u5185\u5bb9 \u00b6 FETCH [[ NEXT ] FROM ] cursor_name INTO var_name [, var_name ] ... \u4e3a\u5173\u8054\u6307\u5b9a\u6e38\u6807\uff08\u5fc5\u987b\u662f\u6253\u5f00\u7684\uff09\u7684 SELECT \u8bed\u53e5\u53d6\u51fa\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6b65\u8fdb\u6e38\u6807\u3002 \u5982\u679c\u8bb0\u5f55\u5b58\u5728\uff0c\u83b7\u53d6\u7684\u5b57\u6bb5\u4f1a\u88ab\u5b58\u5728 var_name \u4e2d\u3002\u68c0\u7d22\u7684\u5b57\u6bb5\u6570\u5fc5\u987b\u5339\u914d\u8f93\u51fa\u53d8\u91cf\u7684\u6570\u91cf\u3002 \u5982\u679c\u8bb0\u5f55\u4e0d\u5b58\u5728\uff0c\u4f1a\u53d1\u751f\u4e00\u4e2a No Data \u7684\u72b6\u51b5\uff08Error number: 1643 ; Symbol: ER_SIGNAL_NOT_FOUND ; SQLSTATE: 02000 \uff09\u3002\u4f60\u53ef\u4ee5\u4e3a\u8fd9\u79cd\u72b6\u51b5\u8bbe\u7f6e\u4e00\u4e2a\u5904\u7406\u5668\u3002 \u6ce8\u610f \uff1a\u5176\u5b83\u7684\u64cd\u4f5c\u4e5f\u4f1a\u5f15\u53d1\u8fd9\u4e00\u9519\u8bef\uff0c\u5bfc\u81f4\u5904\u7406\u5668\u4e00\u5e76\u5904\u7406\u4e86\u8fd9\u79cd\u72b6\u51b5\u3002\u5982\u679c\u6709\u5fc5\u8981\u533a\u5206\u7684\u8bdd\uff0c\u5c06\u5404\u81ea\u7684\u5904\u7406\u5668\u653e\u5728\u5404\u81ea\u7684 BEGIN...END \u5757\u4e2d\u3002 4. \u5173\u95ed\u6e38\u6807 \u00b6 CLOSE cursor_name \u5173\u95ed\u5148\u524d\u6253\u5f00\u7684\u6e38\u6807\u3002 \u5982\u679c\u6ca1\u6709\u5173\u95ed\u4e86\u6ca1\u6709\u6253\u5f00\u7684\u6e38\u6807\u4f1a\u53d1\u751f\u9519\u8bef\u3002 \u82e5\u6ca1\u6709\u660e\u786e\u5730\u5173\u95ed\u6e38\u6807\uff0c\u4f1a\u5728\u5b83\u58f0\u660e\u7684 BEGIN...END \u5757\u7684\u672b\u5c3e\u5173\u95ed\u3002","title":"17.6 \u6e38\u6807"},{"location":"mysql/17.6 \u6e38\u6807/#1","text":"DECLARE cursor_name CURSOR FOR select_statement \u58f0\u660e\u4e00\u4e2a\u6e38\u6807\u5e76\u5173\u8054\u5230 SELECT \u8bed\u53e5\u68c0\u7d22\u8981\u904d\u5386\u7684\u8bb0\u5f55\u3002 SELECT \u8bed\u53e5\u4e0d\u80fd\u542b\u6709 INTO \u5b50\u53e5 \u6e38\u6807\u7684\u58f0\u660e\u5fc5\u987b\u5728\u5904\u7406\u5668\u4e4b\u524d\u58f0\u660e\uff0c\u53d8\u91cf\u548c\u72b6\u51b5\u4e4b\u540e\u58f0\u660e\u3002 \u4e0d\u5141\u8bb8\u58f0\u660e\u76f8\u540c\u7684\u6e38\u6807\u540d\u5b57","title":"1. \u58f0\u660e\u6e38\u6807"},{"location":"mysql/17.6 \u6e38\u6807/#2","text":"OPEN cursor_name \u6253\u5f00\u4e00\u4e2a\u5148\u524d\u58f0\u660e\u7684\u6e38\u6807\u3002","title":"2. \u6253\u5f00\u6e38\u6807"},{"location":"mysql/17.6 \u6e38\u6807/#3","text":"FETCH [[ NEXT ] FROM ] cursor_name INTO var_name [, var_name ] ... \u4e3a\u5173\u8054\u6307\u5b9a\u6e38\u6807\uff08\u5fc5\u987b\u662f\u6253\u5f00\u7684\uff09\u7684 SELECT \u8bed\u53e5\u53d6\u51fa\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6b65\u8fdb\u6e38\u6807\u3002 \u5982\u679c\u8bb0\u5f55\u5b58\u5728\uff0c\u83b7\u53d6\u7684\u5b57\u6bb5\u4f1a\u88ab\u5b58\u5728 var_name \u4e2d\u3002\u68c0\u7d22\u7684\u5b57\u6bb5\u6570\u5fc5\u987b\u5339\u914d\u8f93\u51fa\u53d8\u91cf\u7684\u6570\u91cf\u3002 \u5982\u679c\u8bb0\u5f55\u4e0d\u5b58\u5728\uff0c\u4f1a\u53d1\u751f\u4e00\u4e2a No Data \u7684\u72b6\u51b5\uff08Error number: 1643 ; Symbol: ER_SIGNAL_NOT_FOUND ; SQLSTATE: 02000 \uff09\u3002\u4f60\u53ef\u4ee5\u4e3a\u8fd9\u79cd\u72b6\u51b5\u8bbe\u7f6e\u4e00\u4e2a\u5904\u7406\u5668\u3002 \u6ce8\u610f \uff1a\u5176\u5b83\u7684\u64cd\u4f5c\u4e5f\u4f1a\u5f15\u53d1\u8fd9\u4e00\u9519\u8bef\uff0c\u5bfc\u81f4\u5904\u7406\u5668\u4e00\u5e76\u5904\u7406\u4e86\u8fd9\u79cd\u72b6\u51b5\u3002\u5982\u679c\u6709\u5fc5\u8981\u533a\u5206\u7684\u8bdd\uff0c\u5c06\u5404\u81ea\u7684\u5904\u7406\u5668\u653e\u5728\u5404\u81ea\u7684 BEGIN...END \u5757\u4e2d\u3002","title":"3. \u53d6\u51fa\u6e38\u6807\u6307\u5411\u7684\u5185\u5bb9"},{"location":"mysql/17.6 \u6e38\u6807/#4","text":"CLOSE cursor_name \u5173\u95ed\u5148\u524d\u6253\u5f00\u7684\u6e38\u6807\u3002 \u5982\u679c\u6ca1\u6709\u5173\u95ed\u4e86\u6ca1\u6709\u6253\u5f00\u7684\u6e38\u6807\u4f1a\u53d1\u751f\u9519\u8bef\u3002 \u82e5\u6ca1\u6709\u660e\u786e\u5730\u5173\u95ed\u6e38\u6807\uff0c\u4f1a\u5728\u5b83\u58f0\u660e\u7684 BEGIN...END \u5757\u7684\u672b\u5c3e\u5173\u95ed\u3002","title":"4. \u5173\u95ed\u6e38\u6807"},{"location":"mysql/17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406/","text":"1. \u72b6\u51b5 2. \u5904\u7406\u5668 2.1 \u4e0d\u6307\u5b9a\u5904\u7406\u5668\u65f6 \u5728\u5b58\u50a8\u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u53d1\u751f\u9519\u8bef\u7684\u72b6\u51b5 CONDITION \uff0c\u5e76\u8981\u6c42\u7279\u6b8a\u7684\u5904\u7406\u3002\u53ef\u4ee5\u4e3a\u901a\u5e38\u7684\u72b6\u51b5\u4f8b\u5982\u8b66\u544a\u6216\u5f02\u5e38\uff0c\u6216\u8005\u7279\u6b8a\u7684\u72b6\u51b5\u4f8b\u5982\u7279\u6b8a\u7684\u9519\u8bef\u7801\u5b9a\u4e49\u5904\u7406\u5668 HANDLER \u3002\u53ef\u4ee5\u4e3a\u7279\u5b9a\u72b6\u51b5\u6307\u5b9a\u540d\u79f0\u5e76\u5728\u5904\u7406\u5668\u4e2d\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5f15\u7528\u3002 \u5728MySQL5.6.3\u7248\u672c\u4e4b\u524d\uff0c\u5982\u679c\u8bed\u53e5\u751f\u6210\u7684\u8b66\u544a\u6216\u9519\u8bef\u5f15\u8d77\u4e86\u72b6\u51b5\u5904\u7406\u5668\u7684\u8c03\u7528\uff0c\u5904\u7406\u5668\u53ef\u80fd\u4e0d\u4f1a\u6e05\u7406\u6389\u8bca\u65ad\u533a\u57df\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5904\u7406\u5668\u770b\u8d77\u6765\u6ca1\u6709\u88ab\u8c03\u7528\u4e00\u6837\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u5728\u8ba9\u5904\u7406\u5668\u6267\u884c\u4e00\u6761\u65e0\u610f\u4e49\u7684\u8bed\u53e5\u6765\u8986\u76d6\u8bca\u65ad\u533a\u57df\u3002 1. \u72b6\u51b5 \u00b6 DECLARE condition_name CONDITION FOR condition_value condition_value : mysql_error_code | SQLSTATE [ VALUE ] sqlstate_value \u8be5\u8bed\u53e5\u58f0\u660e\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u72b6\u51b5\uff0c\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u540d\u5b57\u7528\u4e8e\u7279\u5b9a\u7684\u5904\u7406\uff08\u53ef\u7528\u4e8e\u5904\u7406\u5668\u7684\u58f0\u660e\u8bed\u53e5\uff09\u3002 \u8be5\u8bed\u53e5\u5fc5\u987b\u5728 CURSOR \u6216 HANDLER \u8bed\u53e5\u4e4b\u524d\u58f0\u660e\u3002 mysql_error_code \uff1a\u4e00\u4e2a\u8868\u660eMySQL\u9519\u8bef\u7801\u7684\u6574\u6570\u503c sqlstate_value \uff1a\u8868\u660e SQLSTATE \u503c\u76845\u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32 \u72b6\u6001\u7801 condition_value \u4e0d\u80fd\u6307\u5b9a\u4e3a 0 \u6216\u4ee5 '00' \u5f00\u5934\uff0c\u8fd9\u4e9b\u662f\u8868\u793a\u6b63\u786e\u5730\u72b6\u6001\u7801\u3002 5.5\u9519\u8bef\u7801\u624b\u518c -- mysql_error_code\u683c\u5f0f DECLARE no_such_table CONDITION FOR 1051 ; DECLARE CONTINUE HANDLER FOR no_such_table BEGIN -- body of handler END ; -- SQLSTATE sqlstate_value\u683c\u5f0f DECLARE no_such_table CONDITION FOR SQLSTATE '42S02' ; DECLARE CONTINUE HANDLER FOR no_such_table BEGIN -- body of handler END ; 2. \u5904\u7406\u5668 \u00b6 DECLARE handler_action HANDLER FOR condition_value [, condition_value ] ... statement handler_action : { CONTINUE | EXIT | UNDO } condition_value : { mysql_error_code | SQLSTATE [ VALUE ] sqlstate_value | condition_name | SQLWARNING | NOT FOUND | SQLEXCEPTION } statement -- \u53d1\u751f\u72b6\u51b5\u65f6\u6267\u884c\u7684\u8bed\u53e5 -- \u53ef\u4ee5\u662f\u7b80\u5355\u7684\u8bed\u53e5\u6216\u662f\u4f7f\u7528`BEGIN...END`\u7f16\u5199\u7684\u590d\u5408\u8bed\u53e5 \u6307\u5b9a\u4e00\u4e2a\u5904\u7406\u5668\u6765\u5904\u7406\u4e00\u79cd\u6216\u591a\u79cd\u72b6\u51b5\u3002 handler_action \u8868\u660e\u5728\u6267\u884c\u5b8c statement \u4e4b\u540e\u91c7\u53d6\u4ec0\u4e48\u52a8\u4f5c\uff1a CONTINUE\uff1a\u7ee7\u7eed\u6267\u884c\u5f53\u524d\u7a0b\u5e8f EXIT\uff1a\u7ec8\u6b62\u6267\u884c\u5904\u7406\u5668\u58f0\u660e\u6240\u5728\u7684 BEGIN...END \u590d\u5408\u8bed\u53e5 UNDO\uff1a\u4e0d\u652f\u6301\uff1f\uff1f\uff1f condition_value \u8868\u660e\u89e6\u53d1\u7684\u72b6\u51b5 mysql_error_code \uff1a\u8868\u793aMySQL\u7684\u9519\u8bef\u7801\uff0c\u6574\u578b SQLSTATE [VALUE] sqlstate_value \uff1a5\u4e2a\u5b57\u7b26\u957f\u5ea6\u7684SQLSTATE \u503c condition_name \uff1a\u58f0\u660e\u7684\u72b6\u51b5\u540d\u5b57 SQLWARNING\uff1aSQLSTATE\u4ee5\u201c01\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 NOT FOUND\uff1aSQLSTATE\u4ee5\u201c02\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 SQLEXCEPTION\uff1aSQLSTATE \u4e0d\u4ee5 \u201c00\u300101\u300102\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 \u6ce8\u610f\u4e8b\u9879 \uff1a \u5904\u7406\u5668\u5fc5\u987b\u5728\u53d8\u91cf\u548c\u72b6\u51b5\u4e4b\u540e\u58f0\u660e\u3002 \u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u56e0\u4e3a\u4e00\u4e2a\u672a\u5904\u7406\u7684\u5f02\u5e38\u800c\u9000\u51fa\uff0c\u4fee\u6539\u8fc7\u7684 OUT \u548c INOUT \u53c2\u6570\u7684\u503c\u4e0d\u4f1a\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 \u5982\u679c\u4e00\u4e2a\u5f02\u5e38\u88ab\u5305\u542b\u4e86 RESIGNAL \u8bed\u53e5\u7684 CONTINUE \u6216 EXIT \u7c7b\u578b\u7684\u5904\u7406\u5668\u5904\u7406\u4e86\uff0c RESIGNAL \u7684\u6267\u884c\u4f1a\u53d1\u51fa\u5f02\u5e38\u4fe1\u53f7\uff1f\uff1f\uff1f\u3002\u5982\u679c\u5f02\u5e38\u662f\u4e00\u4e2a\u9519\u8bef\uff0c OUT \u548c INOUT \u53c2\u6570\u7684\u503c\u4e0d\u4f1a\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 \u4ee3\u7801\u5757\u7684\u6807\u7b7e\u7684\u4f5c\u7528\u57df\u4e0d\u5305\u62ec\u5904\u7406\u5668\u7684\u6267\u884c\u8bed\u53e5\uff0c\u6240\u4ee5\u5904\u7406\u5668\u7684\u6267\u884c\u8bed\u53e5\u4e2d\u4e0d\u80fd\u5305\u542b\u6807\u7b7e\uff08 label \uff09\u3002\u907f\u514d\u4f7f\u7528\u5916\u90e8\u6807\u7b7e\u7684\u65b9\u6cd5\uff1a \u9700\u8981\u79bb\u5f00\u4ee3\u7801\u5757\u65f6\uff0c\u4f7f\u7528 EXIT \u7c7b\u578b\u7684\u5904\u7406\u5668\u3002 \u9700\u8981\u7ee7\u7eed\u6267\u884c\u65f6\uff0c\u5728 CONTINUE \u7c7b\u578b\u7684\u5904\u7406\u5668\u4e2d\u8bbe\u7f6e\u4e00\u4e2a \u53ef\u4ee5\u88ab\u68c0\u6d4b\u5230\u7684 \u72b6\u6001\u53d8\u91cf\u6765\u6307\u793a\u5904\u7406\u5668\u662f\u5426\u88ab\u8c03\u7528\u4e86\u3002\u4f8b\uff1a CREATE PROCEDURE p () BEGIN DECLARE i INT DEFAULT 3 ; DECLARE done INT DEFAULT FALSE ; retry : REPEAT BEGIN DECLARE CONTINUE HANDLER FOR SQLWARNING BEGIN SET done = TRUE ; END ; IF done OR i < 0 THEN LEAVE retry ; END IF ; SET i = i - 1 ; END ; UNTIL FALSE END REPEAT ; END ; 2.1 \u4e0d\u6307\u5b9a\u5904\u7406\u5668\u65f6 \u00b6 \u5982\u679c\u6ca1\u6709\u4e3a\u4e00\u79cd\u72b6\u51b5\u6307\u5b9a\u5904\u7406\u5668\uff0c\u90a3\u4e48\u53d1\u751f\u7684\u52a8\u4f5c\u53d6\u51b3\u4e8e\u72b6\u51b5\u7684\u7c7b\u578b\uff1a NOT FOUND\uff1a\u5982\u679c\u662f\u6b63\u5e38\u629b\u51fa\u7684\uff0c\u52a8\u4f5c\u662f CONTINUE \uff1b\u5982\u679c\u88ab SIGNAL \u6216 RESIGNAL \u629b\u51fa\u7684\uff0c\u52a8\u4f5c\u662f EXIT \u3002 SQLWARNING\uff1a\u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\uff0c\u5c31\u597d\u50cf\u5b58\u5728\u4e00\u4e2aCONTINUE\u7c7b\u578b\u7684\u5904\u7406\u5668 SQLEXCEPTION\uff1a\u5b58\u50a8\u7a0b\u5e8f\u5728\u5f15\u53d1\u72b6\u51b5\u7684\u8bed\u53e5\u7ec8\u6b62\uff0c\u5c31\u597d\u50cf\u5b58\u5728\u4e00\u4e2aEXIT\u7c7b\u578b\u7684\u5904\u7406\u5668\u3002\u5982\u679c\u8fd9\u4e2a\u7a0b\u5e8f\u88ab\u53e6\u4e00\u4e2a\u5b58\u50a8\u7a0b\u5e8f\u8c03\u7528\uff0c\u8c03\u7528\u7684\u7a0b\u5e8f\u4f1a\u6309\u81ea\u5df1\u7684\u5904\u7406\u5668\u9009\u62e9\u89c4\u5219\u5e94\u7528\u5230\u81ea\u8eab\u7684\u5904\u7406\u5668\u3002","title":"17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406"},{"location":"mysql/17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406/#1","text":"DECLARE condition_name CONDITION FOR condition_value condition_value : mysql_error_code | SQLSTATE [ VALUE ] sqlstate_value \u8be5\u8bed\u53e5\u58f0\u660e\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u72b6\u51b5\uff0c\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u540d\u5b57\u7528\u4e8e\u7279\u5b9a\u7684\u5904\u7406\uff08\u53ef\u7528\u4e8e\u5904\u7406\u5668\u7684\u58f0\u660e\u8bed\u53e5\uff09\u3002 \u8be5\u8bed\u53e5\u5fc5\u987b\u5728 CURSOR \u6216 HANDLER \u8bed\u53e5\u4e4b\u524d\u58f0\u660e\u3002 mysql_error_code \uff1a\u4e00\u4e2a\u8868\u660eMySQL\u9519\u8bef\u7801\u7684\u6574\u6570\u503c sqlstate_value \uff1a\u8868\u660e SQLSTATE \u503c\u76845\u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32 \u72b6\u6001\u7801 condition_value \u4e0d\u80fd\u6307\u5b9a\u4e3a 0 \u6216\u4ee5 '00' \u5f00\u5934\uff0c\u8fd9\u4e9b\u662f\u8868\u793a\u6b63\u786e\u5730\u72b6\u6001\u7801\u3002 5.5\u9519\u8bef\u7801\u624b\u518c -- mysql_error_code\u683c\u5f0f DECLARE no_such_table CONDITION FOR 1051 ; DECLARE CONTINUE HANDLER FOR no_such_table BEGIN -- body of handler END ; -- SQLSTATE sqlstate_value\u683c\u5f0f DECLARE no_such_table CONDITION FOR SQLSTATE '42S02' ; DECLARE CONTINUE HANDLER FOR no_such_table BEGIN -- body of handler END ;","title":"1. \u72b6\u51b5"},{"location":"mysql/17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406/#2","text":"DECLARE handler_action HANDLER FOR condition_value [, condition_value ] ... statement handler_action : { CONTINUE | EXIT | UNDO } condition_value : { mysql_error_code | SQLSTATE [ VALUE ] sqlstate_value | condition_name | SQLWARNING | NOT FOUND | SQLEXCEPTION } statement -- \u53d1\u751f\u72b6\u51b5\u65f6\u6267\u884c\u7684\u8bed\u53e5 -- \u53ef\u4ee5\u662f\u7b80\u5355\u7684\u8bed\u53e5\u6216\u662f\u4f7f\u7528`BEGIN...END`\u7f16\u5199\u7684\u590d\u5408\u8bed\u53e5 \u6307\u5b9a\u4e00\u4e2a\u5904\u7406\u5668\u6765\u5904\u7406\u4e00\u79cd\u6216\u591a\u79cd\u72b6\u51b5\u3002 handler_action \u8868\u660e\u5728\u6267\u884c\u5b8c statement \u4e4b\u540e\u91c7\u53d6\u4ec0\u4e48\u52a8\u4f5c\uff1a CONTINUE\uff1a\u7ee7\u7eed\u6267\u884c\u5f53\u524d\u7a0b\u5e8f EXIT\uff1a\u7ec8\u6b62\u6267\u884c\u5904\u7406\u5668\u58f0\u660e\u6240\u5728\u7684 BEGIN...END \u590d\u5408\u8bed\u53e5 UNDO\uff1a\u4e0d\u652f\u6301\uff1f\uff1f\uff1f condition_value \u8868\u660e\u89e6\u53d1\u7684\u72b6\u51b5 mysql_error_code \uff1a\u8868\u793aMySQL\u7684\u9519\u8bef\u7801\uff0c\u6574\u578b SQLSTATE [VALUE] sqlstate_value \uff1a5\u4e2a\u5b57\u7b26\u957f\u5ea6\u7684SQLSTATE \u503c condition_name \uff1a\u58f0\u660e\u7684\u72b6\u51b5\u540d\u5b57 SQLWARNING\uff1aSQLSTATE\u4ee5\u201c01\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 NOT FOUND\uff1aSQLSTATE\u4ee5\u201c02\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 SQLEXCEPTION\uff1aSQLSTATE \u4e0d\u4ee5 \u201c00\u300101\u300102\u201d\u5f00\u5934\u7684\u503c\u7684\u7b80\u5199 \u6ce8\u610f\u4e8b\u9879 \uff1a \u5904\u7406\u5668\u5fc5\u987b\u5728\u53d8\u91cf\u548c\u72b6\u51b5\u4e4b\u540e\u58f0\u660e\u3002 \u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u56e0\u4e3a\u4e00\u4e2a\u672a\u5904\u7406\u7684\u5f02\u5e38\u800c\u9000\u51fa\uff0c\u4fee\u6539\u8fc7\u7684 OUT \u548c INOUT \u53c2\u6570\u7684\u503c\u4e0d\u4f1a\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 \u5982\u679c\u4e00\u4e2a\u5f02\u5e38\u88ab\u5305\u542b\u4e86 RESIGNAL \u8bed\u53e5\u7684 CONTINUE \u6216 EXIT \u7c7b\u578b\u7684\u5904\u7406\u5668\u5904\u7406\u4e86\uff0c RESIGNAL \u7684\u6267\u884c\u4f1a\u53d1\u51fa\u5f02\u5e38\u4fe1\u53f7\uff1f\uff1f\uff1f\u3002\u5982\u679c\u5f02\u5e38\u662f\u4e00\u4e2a\u9519\u8bef\uff0c OUT \u548c INOUT \u53c2\u6570\u7684\u503c\u4e0d\u4f1a\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002 \u4ee3\u7801\u5757\u7684\u6807\u7b7e\u7684\u4f5c\u7528\u57df\u4e0d\u5305\u62ec\u5904\u7406\u5668\u7684\u6267\u884c\u8bed\u53e5\uff0c\u6240\u4ee5\u5904\u7406\u5668\u7684\u6267\u884c\u8bed\u53e5\u4e2d\u4e0d\u80fd\u5305\u542b\u6807\u7b7e\uff08 label \uff09\u3002\u907f\u514d\u4f7f\u7528\u5916\u90e8\u6807\u7b7e\u7684\u65b9\u6cd5\uff1a \u9700\u8981\u79bb\u5f00\u4ee3\u7801\u5757\u65f6\uff0c\u4f7f\u7528 EXIT \u7c7b\u578b\u7684\u5904\u7406\u5668\u3002 \u9700\u8981\u7ee7\u7eed\u6267\u884c\u65f6\uff0c\u5728 CONTINUE \u7c7b\u578b\u7684\u5904\u7406\u5668\u4e2d\u8bbe\u7f6e\u4e00\u4e2a \u53ef\u4ee5\u88ab\u68c0\u6d4b\u5230\u7684 \u72b6\u6001\u53d8\u91cf\u6765\u6307\u793a\u5904\u7406\u5668\u662f\u5426\u88ab\u8c03\u7528\u4e86\u3002\u4f8b\uff1a CREATE PROCEDURE p () BEGIN DECLARE i INT DEFAULT 3 ; DECLARE done INT DEFAULT FALSE ; retry : REPEAT BEGIN DECLARE CONTINUE HANDLER FOR SQLWARNING BEGIN SET done = TRUE ; END ; IF done OR i < 0 THEN LEAVE retry ; END IF ; SET i = i - 1 ; END ; UNTIL FALSE END REPEAT ; END ;","title":"2. \u5904\u7406\u5668"},{"location":"mysql/17.7 \u9519\u8bef\u72b6\u51b5\u53ca\u5904\u7406/#21","text":"\u5982\u679c\u6ca1\u6709\u4e3a\u4e00\u79cd\u72b6\u51b5\u6307\u5b9a\u5904\u7406\u5668\uff0c\u90a3\u4e48\u53d1\u751f\u7684\u52a8\u4f5c\u53d6\u51b3\u4e8e\u72b6\u51b5\u7684\u7c7b\u578b\uff1a NOT FOUND\uff1a\u5982\u679c\u662f\u6b63\u5e38\u629b\u51fa\u7684\uff0c\u52a8\u4f5c\u662f CONTINUE \uff1b\u5982\u679c\u88ab SIGNAL \u6216 RESIGNAL \u629b\u51fa\u7684\uff0c\u52a8\u4f5c\u662f EXIT \u3002 SQLWARNING\uff1a\u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\uff0c\u5c31\u597d\u50cf\u5b58\u5728\u4e00\u4e2aCONTINUE\u7c7b\u578b\u7684\u5904\u7406\u5668 SQLEXCEPTION\uff1a\u5b58\u50a8\u7a0b\u5e8f\u5728\u5f15\u53d1\u72b6\u51b5\u7684\u8bed\u53e5\u7ec8\u6b62\uff0c\u5c31\u597d\u50cf\u5b58\u5728\u4e00\u4e2aEXIT\u7c7b\u578b\u7684\u5904\u7406\u5668\u3002\u5982\u679c\u8fd9\u4e2a\u7a0b\u5e8f\u88ab\u53e6\u4e00\u4e2a\u5b58\u50a8\u7a0b\u5e8f\u8c03\u7528\uff0c\u8c03\u7528\u7684\u7a0b\u5e8f\u4f1a\u6309\u81ea\u5df1\u7684\u5904\u7406\u5668\u9009\u62e9\u89c4\u5219\u5e94\u7528\u5230\u81ea\u8eab\u7684\u5904\u7406\u5668\u3002","title":"2.1 \u4e0d\u6307\u5b9a\u5904\u7406\u5668\u65f6"},{"location":"mysql/17.8 SIGNAL/","text":"SIGNAL condition_value [ SET signal_information_item [, signal_information_item ] ...] condition_value : { SQLSTATE [ VALUE ] sqlstate_value | condition_name } signal_information_item : condition_information_item_name = simple_value_specification condition_information_item_name : { CLASS_ORIGIN | SUBCLASS_ORIGIN | MESSAGE_TEXT | MYSQL_ERRNO | CONSTRAINT_CATALOG | CONSTRAINT_SCHEMA | CONSTRAINT_NAME | CATALOG_NAME | SCHEMA_NAME | TABLE_NAME | COLUMN_NAME | CURSOR_NAME } condition_name , simple_value_specification : ( see following discussion ) SIGNAL \u662f\u4e00\u79cd\u8fd4\u56de\u9519\u8bef\u7684\u65b9\u6cd5\u3002\u63d0\u4f9b\u9519\u8bef\u4fe1\u606f\u7ed9\uff1a\u5904\u7406\u5668\u3001\u5916\u90e8\u5e94\u7528\u7a0b\u5e8f\u3001\u5ba2\u6237\u7aef\u3002\u5b83\u8fd8\u53ef\u4ee5\u63a7\u5236\u9519\u8bef\u7279\u5f81\uff08error number, SQLSTATE value, message\uff09\u3002 \u6267\u884c SIGNAL \u4e0d\u9700\u8981\u4efb\u4f55\u6743\u9650\u3002 \u8be6\u7ec6\u8bf4\u660e\u53c2\u8003\uff1ahttps://dev.mysql.com/doc/refman/5.5/en/signal.html","title":"17.8 SIGNAL"},{"location":"mysql/17.9 RESIGNAL/","text":"RESIGNAL [ condition_value ] [ SET signal_information_item [, signal_information_item ] ...] condition_value : { SQLSTATE [ VALUE ] sqlstate_value | condition_name } signal_information_item : condition_information_item_name = simple_value_specification condition_information_item_name : { CLASS_ORIGIN | SUBCLASS_ORIGIN | MESSAGE_TEXT | MYSQL_ERRNO | CONSTRAINT_CATALOG | CONSTRAINT_SCHEMA | CONSTRAINT_NAME | CATALOG_NAME | SCHEMA_NAME | TABLE_NAME | COLUMN_NAME | CURSOR_NAME } condition_name , simple_value_specification : ( see following discussion ) RESIGNAL \u4f20\u9012\u9519\u8bef\u72b6\u51b5\u7684\u4fe1\u606f\uff08 information \uff09\uff0c\u8be5\u4fe1\u606f\u662f\u5728\u5b58\u50a8\u8fc7\u7a0b\u6216\u51fd\u6570\u3001\u89e6\u53d1\u5668\u3001\u4e8b\u4ef6\u4e2d\u7684\u590d\u5408\u8bed\u53e5\u5185\u90e8\u7684\u5904\u7406\u5668\u7684\u6267\u884c\u671f\u95f4\u53ef\u7528\u7684\u4fe1\u606f\u3002 RESIGNAL \u53ef\u80fd\u4f1a\u5728\u4f20\u9012\u5b83\u4e4b\u524d\u6539\u53d8\u4fe1\u606f\u3002 RESIGNAL \u4e0e SIGNAL \u7684\u533a\u522b\u5728\u4e8e\uff1aSIGNAL\u53d1\u9001\u9519\u8bef\u72b6\u51b5\uff0c\u800cRESIGNAL\u4f20\u9012\u9519\u8bef\u72b6\u51b5\uff0c\u5e76\u53ef\u80fd\u4f1a\u5728\u4f20\u9012\u4e4b\u524d\u6539\u53d8\u4fe1\u606f\u3002 \u6267\u884c RESIGNAL \u4e0d\u9700\u8981\u4efb\u4f55\u6743\u9650\u3002 \u5b83\u5fc5\u987b\u5728 \u5904\u7406\u5668 \u7684\u5185\u90e8\u4f7f\u7528\u3002 \u8be6\u7ec6\u8bf4\u660e\u53c2\u8003\uff1ahttps://dev.mysql.com/doc/refman/5.5/en/resignal.html","title":"17.9 RESIGNAL"},{"location":"mysql/18. MySQL\u89e6\u53d1\u5668/","text":"1. \u521b\u5efa\u89e6\u53d1\u5668 2. \u67e5\u770b\u89e6\u53d1\u5668 3. \u5220\u9664\u89e6\u53d1\u5668 \u89e6\u53d1\u5668\u662f\u4e0e\u8868\u6709\u5173\u7684\u6570\u636e\u5e93\u5bf9\u8c61\uff0c\u5728\u6ee1\u8db3\u5b9a\u4e49\u6761\u4ef6\u65f6\u89e6\u53d1\uff0c \u5e76\u6267\u884c\u89e6\u53d1\u5668\u4e2d\u5b9a\u4e49\u7684\u8bed\u53e5\u96c6\u5408\u3002 1. \u521b\u5efa\u89e6\u53d1\u5668 \u00b6 CREATE [ DEFINER = { user | CURRENT_USER } ] TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_body trigger_time : { BEFORE | AFTER } trigger_event : { INSERT | UPDATE | DELETE } trigger_time \uff1a\u89e6\u53d1\u65f6\u95f4\u3002\u6709\u4e24\u79cd\u53d6\u503c\uff1a AFTER \u548c BEFORE \uff0c\u8868\u660e\u5728\u6bcf\u4e00\u884c\u88ab\u4fee\u6539\u7684\u4e4b\u540e\u6216\u4e4b\u524d\u89e6\u53d1\u52a8\u4f5c\u3002 trigger_event \uff1a\u89e6\u53d1\u7684\u8bed\u53e5\u7c7b\u578b\u3002 INSERT\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u63d2\u5165\u90fd\u4f1a\u89e6\u53d1\u3002 UPDATE\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u66f4\u65b0\u90fd\u4f1a\u89e6\u53d1\u3002 DELETE\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u5220\u9664\u90fd\u4f1a\u89e6\u53d1\u3002\u4f46\u662f DROP TABLE \u3001 TRUNCATE TABLE \u548c Dropping a partition \u4e0d\u4f1a\u89e6\u53d1\uff0c\u56e0\u4e3a\u5b83\u4eec\u6ca1\u6709\u4f7f\u7528 DELETE \u8bed\u53e5\u3002 trigger_body \uff1a\u89e6\u53d1\u5668\u6267\u884c\u7684\u8bed\u53e5\u3002\u53ef\u4f7f\u7528 BEGIN...END \u8bed\u53e5\u3002 \u6ce8\u610f \uff1a \u89e6\u53d1\u5668\u53ea\u80fd\u521b\u5efa\u5728\u6c38\u4e45\u8868\uff08Permanent Table\uff09\u4e0a\uff0c\u4e0d\u80fd\u5bf9\u4e34\u65f6\u8868\uff08Temporary Table\uff09\u521b\u5efa\u89e6\u53d1\u5668\u3002 \u53ea\u6709\u4f7f\u7528 SQL\u8bed\u53e5 \u89e6\u53d1\u7684\u4fee\u6539\u624d\u4f1a\u6fc0\u6d3b\u89e6\u53d1\u5668\uff1b\u5bf9\u4e8e\u4e0d\u5c06SQL\u8bed\u53e5\u4f20\u8f93\u5230MySQL\u670d\u52a1\u5668\u7684API\u6240\u505a\u7684\u66f4\u6539\uff0c\u89e6\u53d1\u5668\u4e0d\u4f1a\u6fc0\u6d3b\u3002 \u7ea7\u8054\u7684\u5916\u952e\u64cd\u4f5c\u4e0d\u4f1a\u6fc0\u6d3b\u89e6\u53d1\u5668 \u4e0d\u80fd\u5728\u89e6\u53d1\u5668\u4e2d\u4f7f\u7528\u4ee5\u663e\u5f0f\u6216\u9690\u5f0f\u65b9\u5f0f\u5f00\u59cb\u6216\u7ed3\u675f\u4e8b\u52a1\u7684\u8bed\u53e5\uff0c \u5982 START TRANSACTION\u3001COMMIT \u6216 ROLLBACK\u3002 MySQL\u5bf9\u540c\u4e00\u4e2a\u8868\u76f8\u540c\u89e6\u53d1\u65f6\u95f4\u7684\u76f8\u540c\u89e6\u53d1\u4e8b\u4ef6\uff0c \u53ea\u80fd\u5b9a\u4e49\u4e00\u4e2a\u89e6\u53d1\u5668\u3002 \u4f7f\u7528\u522b\u540d OLD \u548c NEW \u6765\u5f15\u7528\u89e6\u53d1\u5668\u4e2d\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u5185\u5bb9\u3002DELETE\u4e8b\u4ef6\u53ea\u80fd\u4f7f\u7528OLD. col_name \uff08\u53ea\u8bfb\u7684\uff09\uff0cINSERT\u4e8b\u4ef6\u53ea\u80fd\u4f7f\u7528NEW. col_name \u3002\u5728BEFORE\u7c7b\u578b\u7684\u89e6\u53d1\u5668\u4e2d\uff0c\u81ea\u589e\u5b57\u6bb5\u7684\u503c\u662f0\u3002\u800c\u4e0d\u662f\u5b9e\u9645\u63d2\u5165\u7684\u503c\u3002 MariaDB [ MYISAM_TEST ] > SET @ count_test = 0 ; MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE TRIGGER insert_test AFTER INSERT ON TEST FOR EACH ROW BEGIN SET @ count_test = @ count_test + 1 ; END // MariaDB [ MYISAM_TEST ] > CREATE TRIGGER update_test AFTER UPDATE ON TEST FOR EACH ROW BEGIN SET @ update_id_test = NEW . id ; END // MariaDB [ MYISAM_TEST ] > delimiter ; 2. \u67e5\u770b\u89e6\u53d1\u5668 \u00b6 -- \u67e5\u8be2\u5f53\u524d\u6570\u636e\u7684\u89e6\u53d1\u5668 SHOW TRIGGERS [ { FROM | IN } db_name ] [ LIKE 'pattern' | WHERE expr ] -- LIKE \u5339\u914d\u7684\u662f\u8868\u7684\u540d\u5b57 -- \u5728information_schema\u6570\u636e\u5e93\u4e2d\u7684TRIGGERS\u8868\u67e5\u8be2 MariaDB [ information_schema ] > DESC TRIGGERS ; 3. \u5220\u9664\u89e6\u53d1\u5668 \u00b6 DROP TRIGGER [ IF EXISTS ] [ schema_name .] trigger_name","title":"18. MySQL\u89e6\u53d1\u5668"},{"location":"mysql/18. MySQL\u89e6\u53d1\u5668/#1","text":"CREATE [ DEFINER = { user | CURRENT_USER } ] TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_body trigger_time : { BEFORE | AFTER } trigger_event : { INSERT | UPDATE | DELETE } trigger_time \uff1a\u89e6\u53d1\u65f6\u95f4\u3002\u6709\u4e24\u79cd\u53d6\u503c\uff1a AFTER \u548c BEFORE \uff0c\u8868\u660e\u5728\u6bcf\u4e00\u884c\u88ab\u4fee\u6539\u7684\u4e4b\u540e\u6216\u4e4b\u524d\u89e6\u53d1\u52a8\u4f5c\u3002 trigger_event \uff1a\u89e6\u53d1\u7684\u8bed\u53e5\u7c7b\u578b\u3002 INSERT\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u63d2\u5165\u90fd\u4f1a\u89e6\u53d1\u3002 UPDATE\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u66f4\u65b0\u90fd\u4f1a\u89e6\u53d1\u3002 DELETE\uff1a\u4e0d\u8bba\u4ec0\u4e48\u65b9\u5f0f\u7684\u8bb0\u5f55\u5220\u9664\u90fd\u4f1a\u89e6\u53d1\u3002\u4f46\u662f DROP TABLE \u3001 TRUNCATE TABLE \u548c Dropping a partition \u4e0d\u4f1a\u89e6\u53d1\uff0c\u56e0\u4e3a\u5b83\u4eec\u6ca1\u6709\u4f7f\u7528 DELETE \u8bed\u53e5\u3002 trigger_body \uff1a\u89e6\u53d1\u5668\u6267\u884c\u7684\u8bed\u53e5\u3002\u53ef\u4f7f\u7528 BEGIN...END \u8bed\u53e5\u3002 \u6ce8\u610f \uff1a \u89e6\u53d1\u5668\u53ea\u80fd\u521b\u5efa\u5728\u6c38\u4e45\u8868\uff08Permanent Table\uff09\u4e0a\uff0c\u4e0d\u80fd\u5bf9\u4e34\u65f6\u8868\uff08Temporary Table\uff09\u521b\u5efa\u89e6\u53d1\u5668\u3002 \u53ea\u6709\u4f7f\u7528 SQL\u8bed\u53e5 \u89e6\u53d1\u7684\u4fee\u6539\u624d\u4f1a\u6fc0\u6d3b\u89e6\u53d1\u5668\uff1b\u5bf9\u4e8e\u4e0d\u5c06SQL\u8bed\u53e5\u4f20\u8f93\u5230MySQL\u670d\u52a1\u5668\u7684API\u6240\u505a\u7684\u66f4\u6539\uff0c\u89e6\u53d1\u5668\u4e0d\u4f1a\u6fc0\u6d3b\u3002 \u7ea7\u8054\u7684\u5916\u952e\u64cd\u4f5c\u4e0d\u4f1a\u6fc0\u6d3b\u89e6\u53d1\u5668 \u4e0d\u80fd\u5728\u89e6\u53d1\u5668\u4e2d\u4f7f\u7528\u4ee5\u663e\u5f0f\u6216\u9690\u5f0f\u65b9\u5f0f\u5f00\u59cb\u6216\u7ed3\u675f\u4e8b\u52a1\u7684\u8bed\u53e5\uff0c \u5982 START TRANSACTION\u3001COMMIT \u6216 ROLLBACK\u3002 MySQL\u5bf9\u540c\u4e00\u4e2a\u8868\u76f8\u540c\u89e6\u53d1\u65f6\u95f4\u7684\u76f8\u540c\u89e6\u53d1\u4e8b\u4ef6\uff0c \u53ea\u80fd\u5b9a\u4e49\u4e00\u4e2a\u89e6\u53d1\u5668\u3002 \u4f7f\u7528\u522b\u540d OLD \u548c NEW \u6765\u5f15\u7528\u89e6\u53d1\u5668\u4e2d\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u5185\u5bb9\u3002DELETE\u4e8b\u4ef6\u53ea\u80fd\u4f7f\u7528OLD. col_name \uff08\u53ea\u8bfb\u7684\uff09\uff0cINSERT\u4e8b\u4ef6\u53ea\u80fd\u4f7f\u7528NEW. col_name \u3002\u5728BEFORE\u7c7b\u578b\u7684\u89e6\u53d1\u5668\u4e2d\uff0c\u81ea\u589e\u5b57\u6bb5\u7684\u503c\u662f0\u3002\u800c\u4e0d\u662f\u5b9e\u9645\u63d2\u5165\u7684\u503c\u3002 MariaDB [ MYISAM_TEST ] > SET @ count_test = 0 ; MariaDB [ MYISAM_TEST ] > delimiter // MariaDB [ MYISAM_TEST ] > CREATE TRIGGER insert_test AFTER INSERT ON TEST FOR EACH ROW BEGIN SET @ count_test = @ count_test + 1 ; END // MariaDB [ MYISAM_TEST ] > CREATE TRIGGER update_test AFTER UPDATE ON TEST FOR EACH ROW BEGIN SET @ update_id_test = NEW . id ; END // MariaDB [ MYISAM_TEST ] > delimiter ;","title":"1. \u521b\u5efa\u89e6\u53d1\u5668"},{"location":"mysql/18. MySQL\u89e6\u53d1\u5668/#2","text":"-- \u67e5\u8be2\u5f53\u524d\u6570\u636e\u7684\u89e6\u53d1\u5668 SHOW TRIGGERS [ { FROM | IN } db_name ] [ LIKE 'pattern' | WHERE expr ] -- LIKE \u5339\u914d\u7684\u662f\u8868\u7684\u540d\u5b57 -- \u5728information_schema\u6570\u636e\u5e93\u4e2d\u7684TRIGGERS\u8868\u67e5\u8be2 MariaDB [ information_schema ] > DESC TRIGGERS ;","title":"2. \u67e5\u770b\u89e6\u53d1\u5668"},{"location":"mysql/18. MySQL\u89e6\u53d1\u5668/#3","text":"DROP TRIGGER [ IF EXISTS ] [ schema_name .] trigger_name","title":"3. \u5220\u9664\u89e6\u53d1\u5668"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/","text":"1. \u9501\u5b9a\u3001\u89e3\u9501\u8868 2. \u4e8b\u52a1\u63a7\u5236 3. \u8fd8\u539f\u70b9 4. \u5206\u5e03\u5f0f\u4e8b\u52a1 4.1 \u539f\u7406 4.2 \u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u8bed\u6cd5 4.3 XA \u4e8b\u52a1\u4f7f\u7528\u6d41\u7a0b 4.4 \u5b58\u5728\u7684\u95ee\u9898 MySQL \u652f\u6301\u5bf9 MyISAM \u548c MEMORY \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u8fdb\u884c\u8868\u7ea7\u9501\u5b9a\uff0c\u5bf9 BDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u8fdb\u884c\u9875\u7ea7\u9501\u5b9a\uff0c\u5bf9 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u8fdb\u884c\u884c\u7ea7\u9501\u5b9a\u3002 1. \u9501\u5b9a\u3001\u89e3\u9501\u8868 \u00b6 -- \u9501\u8868 LOCK TABLES tbl_name [[ AS ] alias ] lock_type [, tbl_name [[ AS ] alias ] lock_type ] ... lock_type : READ [ LOCAL ] | [ LOW_PRIORITY ] WRITE -- \u4e00\u4e9b\u64cd\u4f5c -- \u89e3\u9501 UNLOCK TABLES MySQL\u4f7f\u5ba2\u6237\u7aef\u4f1a\u8bdd\uff08 session \uff09\u80fd\u591f\u660e\u786e\u83b7\u53d6\u8868\u9501\uff0c\u4ee5\u4fbf\u4e0e\u5176\u4ed6\u4f1a\u8bdd\u534f\u4f5c\u4ee5\u8bbf\u95ee\u8868\uff0c\u6216\u8005\u9632\u6b62\u5176\u4ed6\u4f1a\u8bdd\u5728\u4f1a\u8bdd\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u72ec\u5360\u8bbf\u95ee\u671f\u95f4\u4fee\u6539\u8868\u3002 LOCK TABLES \u663e\u5f0f\u83b7\u53d6\u5f53\u524d\u5ba2\u6237\u7aef\u4f1a\u8bdd\u7684\u8868\u9501\u3002\u53ef\u4ee5\u4e3a\u8868\u6216\u89c6\u56fe\u83b7\u53d6\u8868\u9501\u3002\u5728\u83b7\u53d6\u65b0\u9501\u4e4b\u524d\uff0cLOCK TABLES \u9690\u5f0f\u91ca\u653e \u5f53\u524d\u4f1a\u8bdd\u6301\u6709\u7684\u4efb\u4f55\u8868\u9501\u3002 UNLOCK TABLES \u663e\u5f0f\u91ca\u653e\u5f53\u524d\u4f1a\u8bdd\u6301\u6709\u7684\u4efb\u4f55\u8868\u9501\u3002 2. \u4e8b\u52a1\u63a7\u5236 \u00b6 MySQL\u652f\u6301\u7684\u672c\u5730\u4e8b\u52a1\u7684\u8bed\u53e5\uff1a -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION [ WITH CONSISTENT SNAPSHOT ] BEGIN [ WORK ] -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT [ WORK ] [ AND [ NO ] CHAIN ] [[ NO ] RELEASE ] -- \u56de\u6eda\u4e8b\u52a1 ROLLBACK [ WORK ] [ AND [ NO ] CHAIN ] [[ NO ] RELEASE ] -- \u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1 SET autocommit = { 0 | 1 } START TRANSACTION \u6216 BEGIN \u8bed\u53e5\u53ef\u4ee5\u5f00\u59cb\u4e00\u9879\u65b0\u7684\u4e8b\u52a1\u3002\u590d\u5408\u8bed\u53e5\u4e2d\u4f7f\u7528 START TRANSACTION \u5f00\u542f\u4e8b\u52a1\u3002 COMMIT \u548c ROLLBACK \u7528\u6765\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u4e8b\u52a1\u3002 CHAIN \u548c RELEASE \u5b50\u53e5\u5206\u522b\u7528\u6765\u5b9a\u4e49\u5728\u4e8b\u52a1\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u4e4b\u540e\u7684\u64cd\u4f5c CHAIN \u4f1a\u7acb\u5373\u542f\u52a8\u4e00\u4e2a\u65b0\u4e8b\u52a1\uff0c\u5e76\u4e14\u548c\u521a\u624d\u7684\u4e8b\u52a1\u5177\u6709\u76f8\u540c\u7684\u9694\u79bb\u7ea7\u522b RELEASE \u5219\u4f1a\u65ad\u5f00\u548c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002 SET AUTOCOMMIT \u53ef\u4ee5\u4fee\u6539\u5f53\u524d\u8fde\u63a5\u7684\u63d0\u4ea4\u65b9\u5f0f\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 SET AUTOCOMMIT=0\uff0c\u5219\u8bbe\u7f6e\u4e4b\u540e\u7684\u6240\u6709\u4e8b\u52a1\u90fd\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684\u547d\u4ee4\u8fdb\u884c\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL \u662f\u81ea\u52a8\u63d0\u4ea4\uff08Autocommit\uff09\u7684\uff0c\u8fd9\u610f\u5473\u7740\u53ea\u8981\u4f60\u4fee\u6539\u4e86\u8868\uff0cMySQL\u5c31\u4f1a\u5c06\u5176\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\uff0c \u4e0d\u53ef\u56de\u6eda \u3002\u5982\u679c\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684 Commit \u548c Rollback \u6765\u63d0\u4ea4\u548c\u56de\u6eda\u4e8b\u52a1\uff0c\u90a3\u4e48\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684\u4e8b\u52a1\u63a7\u5236\u547d\u4ee4\u6765\u5f00\u59cb\u4e8b\u52a1\u3002 \u5982\u679c\u5728\u9501\u8868\u671f\u95f4\uff0c\u7528 START TRANSACTION \u547d\u4ee4\u5f00\u59cb\u4e00\u4e2a\u65b0\u4e8b\u52a1\uff0c\u4f1a\u9020\u6210\u4e00\u4e2a\u9690\u542b\u7684 UNLOCK TABLES \u88ab\u6267\u884c\u3002 \u548c Oracle \u7684\u4e8b\u52a1\u7ba1\u7406\u76f8\u540c\uff0c\u6240\u6709\u7684 DDL \u8bed\u53e5\u662f\u4e0d\u80fd\u56de\u6eda\u7684\uff0c\u5e76\u4e14\u90e8\u5206\u7684 DDL \u8bed\u53e5\u4f1a\u9020\u6210\u9690\u5f0f\u7684\u63d0\u4ea4\u3002 3. \u8fd8\u539f\u70b9 \u00b6 \u5728\u4e8b\u52a1\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 SAVEPOINT\uff0c \u6307\u5b9a\u56de\u6eda\u4e8b\u52a1\u7684\u4e00\u4e2a\u90e8\u5206\uff0c \u4f46\u662f\u4e0d\u80fd\u6307\u5b9a\u63d0\u4ea4\u4e8b\u52a1\u7684\u4e00\u4e2a\u90e8\u5206\u3002\u5bf9\u4e8e\u590d\u6742\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u4e0d\u540c\u7684 SAVEPOINT\uff0c\u6ee1\u8db3\u4e0d\u540c\u7684\u6761\u4ef6\u65f6\uff0c\u56de\u6eda\u5230\u4e0d\u540c\u7684 SAVEPOINT\u3002 -- \u8bbe\u7f6e\u8fd8\u539f\u70b9 SAVEPOINT identifier -- \u56de\u6eda\u5230\u8fd8\u539f\u70b9 ROLLBACK [ WORK ] TO [ SAVEPOINT ] identifier -- \u5220\u9664\u8fd8\u539f\u70b9 RELEASE SAVEPOINT identifier \u53ea\u6709 InnoDB \u652f\u6301\u5bf9\u4e8b\u52a1\u8bbe\u7f6e\u8fd8\u539f\u70b9\uff08 SAVEPOINT \uff09\u3002 4. \u5206\u5e03\u5f0f\u4e8b\u52a1 \u00b6 \u53ea\u6709 InnoDB \u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\uff08 XA Transaction \uff09\u3002 4.1 \u539f\u7406 \u00b6 \u5728 MySQL \u4e2d\uff0c\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u6d89\u53ca\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\u7ba1\u7406\u5668\u548c\u4e00\u4e2a\u4e8b\u52a1\u7ba1\u7406\u5668\u3002 \u8d44\u6e90\u7ba1\u7406\u5668\uff08RM\uff09\uff1a\u63d0\u4f9b\u5bf9\u4e8b\u52a1\u8d44\u6e90\u7684\u8bbf\u95ee\u9014\u5f84\u3002\u6570\u636e\u5e93\u670d\u52a1\u5668\u5c31\u662f\u4e00\u79cd\u8d44\u6e90\u7ba1\u7406\u5668\u3002\u8be5\u7ba1\u7406\u5668\u5fc5\u987b\u53ef\u4ee5\u63d0\u4ea4\u6216\u56de\u6eda\u7531 RM \u7ba1\u7406\u7684\u4e8b\u52a1\u3002 \u4e8b\u52a1\u7ba1\u7406\u5668\uff08TM\uff09\uff1a\u534f\u8c03\u4f5c\u4e3a\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e00\u90e8\u5206\u7684\u4e8b\u52a1\u3002TM \u4e0e\u7ba1\u7406\u6bcf\u4e2a\u4e8b\u52a1\u7684 RMs \u8fdb\u884c\u901a\u8baf\u3002\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u5404\u4e2a\u5355\u4e2a\u4e8b\u52a1\u5747\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u201c\u5206\u652f\u4e8b\u52a1\u201d \u3002\u5206\u5e03\u5f0f\u4e8b\u52a1\u548c\u5404\u5206\u652f\u901a\u8fc7\u4e00\u79cd\u547d\u540d\u65b9\u6cd5\u8fdb\u884c\u6807\u8bc6\u3002 MySQL\u7684XA\u5b9e\u73b0\u662f\uff0c\u8ba9MySQL\u670d\u52a1\u5668\u8868\u73b0\u7684\u50cf\u662f\u5904\u7406XA\u4e8b\u52a1\u7684RM\uff0c\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\u8868\u73b0\u7684\u50cf\u662fTM\u3002 \u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6267\u884c\u4f7f\u7528\u4e24\u4e2a\u9636\u6bb5\u7684\u63d0\u4ea4\u3002\u8fd9\u662f\u5728\u6267\u884c\u4e86\u5168\u5c40\u4e8b\u52a1\u7684\u5206\u652f\u6267\u884c\u7684\u64cd\u4f5c\u4e4b\u540e\u53d1\u751f\u7684\u3002 \u7b2c\u4e00\u9636\u6bb5\uff0c\u6240\u6709\u7684\u5206\u652f\u51c6\u5907\u5b8c\u6bd5\u3002\u610f\u5473\u7740\u5df2\u7ecf\u51c6\u5907\u597d\u63d0\u4ea4\u4e86\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff0cTM \u544a\u77e5 RMs \u63d0\u4ea4\u6216\u56de\u6eda\u3002\u5982\u679c\u4efb\u4f55\u5206\u652f\u5728\u51c6\u5907\u65f6\u6307\u793a\u5b83\u5c06\u65e0\u6cd5\u63d0\u4ea4\uff0c\u5219\u544a\u77e5\u6240\u6709\u5206\u652f\u90fd\u56de\u6eda\u3002 4.2 \u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u8bed\u6cd5 \u00b6 XA { START | BEGIN } xid [ JOIN | RESUME ] -- \u4f7f\u4e8b\u52a1\u8fdb\u5165 PREPARE \u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u7b2c\u4e00\u4e2a\u63d0\u4ea4\u9636\u6bb5\u3002 XA END xid [ SUSPEND [ FOR MIGRATE ]] XA PREPARE xid -- \u7b2c\u4e8c\u4e2a\u63d0\u4ea4\u9636\u6bb5\uff0c\u5206\u652f\u4e8b\u52a1\u88ab\u5b9e\u9645\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002 XA COMMIT xid [ ONE PHASE ] XA ROLLBACK xid -- \u8fd4\u56de\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u5904\u4e8e PREPARE \u72b6\u6001\u7684\u5206\u652f\u4e8b\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 XA RECOVER xid \u662f\u4e00\u4e2a XA \u4e8b\u52a1\u6807\u8bc6\u7b26\uff0c\u7528\u6765\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002xid \u503c\u7531\u5ba2\u6237\u7aef\u63d0\u4f9b\uff0c\u6216\u7531MySQL \u670d\u52a1\u5668\u751f\u6210\u3002xid \u503c\u5305\u542b 1\uff5e3 \u4e2a\u90e8\u5206\uff1a xid : gtrid [, bqual [, formatID ]] gtrid \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u6807\u8bc6\u7b26\uff0c \u76f8\u540c\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5e94\u8be5\u4f7f\u7528\u76f8\u540c\u7684 gtrid\uff0c \u8fd9\u6837\u53ef\u4ee5\u660e\u786e\u77e5\u9053 xa \u4e8b\u52a1\u5c5e\u4e8e\u54ea\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002\u6700\u597d\u5199\u4e3a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32 ( X'6162' , 0x6162 ) bqual \u662f\u4e00\u4e2a\u5206\u652f\u9650\u5b9a\u7b26\uff0c \u9ed8\u8ba4\u503c\u662f\u7a7a\u4e32\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u7684\u6bcf\u4e2a\u5206\u652f\u4e8b\u52a1\uff0cbqual \u503c\u5fc5\u987b\u662f\u552f\u4e00\u7684\u3002\u6700\u597d\u5199\u4e3a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32 ( X'6162' , 0x6162 ) formatID \u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u7528\u4e8e\u6807\u8bc6\u7531 gtrid \u548c bqual \u503c\u4f7f\u7528\u7684\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503c\u662f 1\u3002 4.3 XA \u4e8b\u52a1\u4f7f\u7528\u6d41\u7a0b \u00b6 XA\u4e8b\u52a1\u901a\u8fc7\u4ee5\u4e0b\u6d41\u7a0b\u6267\u884c\uff1a \u4f7f\u7528 XA START \u5f00\u542f\u4e8b\u52a1\u5e76\u5c06\u5176\u7f6e\u4e3a ACTIVE \u6fc0\u6d3b\u72b6\u6001\u3002 \u5bf9\u4e8e ACTIVE \u72b6\u6001\u7684\u4e8b\u52a1\uff0c\u6267\u884c\u6784\u6210\u4e8b\u52a1\u7684SQL\u8bed\u53e5\uff0c\u7136\u540e\u6267\u884c XA END \u8bed\u53e5\uff0c\u6b64\u8bed\u53e5\u5c06\u4e8b\u52a1\u7f6e\u4e3a IDLE \u6020\u60f0\u72b6\u6001\u3002 \u5bf9\u4e8e IDLE \u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u4e24\u79cd\u8bed\u53e5\uff1a XA PREPARE \uff1a\u5c06\u4e8b\u52a1\u7f6e\u4e3a PREPARED \u51c6\u5907\u72b6\u6001\u3002\u6b64\u65f6\u53ef\u4ee5\u7528 XA RECOVER \u5217\u51fa\u4e8b\u52a1\u7684 xid \u503c\u3002 XA COMMIT ... ONE PHASE \uff1a\u51c6\u5907\u5e76\u63d0\u4ea4\u4e8b\u52a1\u3002 \u5bf9\u4e8e PREPARED \u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u6267\u884c XA COMMIT \u63d0\u4ea4\u5e76\u7ec8\u6b62\u4e8b\u52a1\uff0c\u6216\u8005\u6267\u884c XA ROLLBACK \u56de\u6eda\u5e76\u7ec8\u6b62\u4e8b\u52a1\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a XA START \u4e0d\u652f\u6301 [JOIN|RESUME] \u5b50\u53e5 XA END \u4e0d\u652f\u6301 [SUSPEND [FOR MIGRATE]] \u5b50\u53e5\u3002\uff1f\uff1f\uff1f \u5982\u679c XA START \u5df2\u7ecf\u5f00\u542f\u4e86\u4e00\u4e2aXA\u4e8b\u52a1\uff0c\u90a3\u4e48\u4e0d\u80fd\u4f7f\u7528\u672c\u5730\u4e8b\u52a1\uff0c\u9690\u5f0f\u7684\u63d0\u4ea4\uff08 \u5b58\u5728\u9690\u5f0f\u63d0\u4ea4\u7684\u8bed\u53e5 \uff09\u4e5f\u662f\u5982\u6b64\uff1b\u53cd\u4e4b\u4ea6\u7136\u3002 4.4 \u5b58\u5728\u7684\u95ee\u9898 \u00b6 \u200b \u5982\u679c\u5206\u652f\u4e8b\u52a1\u5728\u8fbe\u5230 prepare \u72b6\u6001\u65f6\uff0c\u6570\u636e\u5e93\u5f02\u5e38\u91cd\u65b0\u542f\u52a8\uff0c\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u4ee5\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u5206\u652f\u4e8b\u52a1\u8fdb\u884c\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u5f97\u64cd\u4f5c\uff0c\u4f46\u662f\u63d0\u4ea4\u7684\u4e8b\u52a1\u6ca1\u6709\u5199 binlog\uff0c\u5b58\u5728\u4e00\u5b9a\u7684\u9690\u60a3\uff0c \u53ef\u80fd\u5bfc\u81f4\u4f7f\u7528 binlog \u6062\u590d\u4e22\u5931\u90e8\u5206\u6570\u636e\u3002 \u200b \u5982\u679c\u5206\u652f\u4e8b\u52a1\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5f02\u5e38\u4e2d\u6b62\uff0c \u90a3\u4e48\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u56de\u6eda\u672a\u5b8c\u6210\u7684\u5206\u652f\u4e8b\u52a1\uff0c \u5982\u679c\u6b64\u65f6\u5206\u652f\u4e8b\u52a1\u5df2\u7ecf\u6267\u884c\u5230 prepare \u72b6\u6001\uff0c \u90a3\u4e48\u8fd9\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5176\u4ed6\u5206\u652f\u53ef\u80fd\u5df2\u7ecf\u6210\u529f\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u4e2a\u5206\u652f\u56de\u6eda\uff0c\u53ef\u80fd\u5bfc\u81f4\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u4e0d\u5b8c\u6574\uff0c\u4e22\u5931\u90e8\u5206\u5206\u652f\u4e8b\u52a1\u7684\u5185\u5bb9\u3002 \u5982\u679c\u5e94\u7528\u5bf9\u4e8b\u52a1\u7684\u5b8c\u6574\u6027\u6709\u6bd4\u8f83\u9ad8\u7684\u8981\u6c42\uff0c \u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u7684\u7248\u672c\uff0c \u5219\u4e0d\u63a8\u8350\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002","title":"19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#1","text":"-- \u9501\u8868 LOCK TABLES tbl_name [[ AS ] alias ] lock_type [, tbl_name [[ AS ] alias ] lock_type ] ... lock_type : READ [ LOCAL ] | [ LOW_PRIORITY ] WRITE -- \u4e00\u4e9b\u64cd\u4f5c -- \u89e3\u9501 UNLOCK TABLES MySQL\u4f7f\u5ba2\u6237\u7aef\u4f1a\u8bdd\uff08 session \uff09\u80fd\u591f\u660e\u786e\u83b7\u53d6\u8868\u9501\uff0c\u4ee5\u4fbf\u4e0e\u5176\u4ed6\u4f1a\u8bdd\u534f\u4f5c\u4ee5\u8bbf\u95ee\u8868\uff0c\u6216\u8005\u9632\u6b62\u5176\u4ed6\u4f1a\u8bdd\u5728\u4f1a\u8bdd\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u72ec\u5360\u8bbf\u95ee\u671f\u95f4\u4fee\u6539\u8868\u3002 LOCK TABLES \u663e\u5f0f\u83b7\u53d6\u5f53\u524d\u5ba2\u6237\u7aef\u4f1a\u8bdd\u7684\u8868\u9501\u3002\u53ef\u4ee5\u4e3a\u8868\u6216\u89c6\u56fe\u83b7\u53d6\u8868\u9501\u3002\u5728\u83b7\u53d6\u65b0\u9501\u4e4b\u524d\uff0cLOCK TABLES \u9690\u5f0f\u91ca\u653e \u5f53\u524d\u4f1a\u8bdd\u6301\u6709\u7684\u4efb\u4f55\u8868\u9501\u3002 UNLOCK TABLES \u663e\u5f0f\u91ca\u653e\u5f53\u524d\u4f1a\u8bdd\u6301\u6709\u7684\u4efb\u4f55\u8868\u9501\u3002","title":"1. \u9501\u5b9a\u3001\u89e3\u9501\u8868"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#2","text":"MySQL\u652f\u6301\u7684\u672c\u5730\u4e8b\u52a1\u7684\u8bed\u53e5\uff1a -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION [ WITH CONSISTENT SNAPSHOT ] BEGIN [ WORK ] -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT [ WORK ] [ AND [ NO ] CHAIN ] [[ NO ] RELEASE ] -- \u56de\u6eda\u4e8b\u52a1 ROLLBACK [ WORK ] [ AND [ NO ] CHAIN ] [[ NO ] RELEASE ] -- \u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1 SET autocommit = { 0 | 1 } START TRANSACTION \u6216 BEGIN \u8bed\u53e5\u53ef\u4ee5\u5f00\u59cb\u4e00\u9879\u65b0\u7684\u4e8b\u52a1\u3002\u590d\u5408\u8bed\u53e5\u4e2d\u4f7f\u7528 START TRANSACTION \u5f00\u542f\u4e8b\u52a1\u3002 COMMIT \u548c ROLLBACK \u7528\u6765\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u4e8b\u52a1\u3002 CHAIN \u548c RELEASE \u5b50\u53e5\u5206\u522b\u7528\u6765\u5b9a\u4e49\u5728\u4e8b\u52a1\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u4e4b\u540e\u7684\u64cd\u4f5c CHAIN \u4f1a\u7acb\u5373\u542f\u52a8\u4e00\u4e2a\u65b0\u4e8b\u52a1\uff0c\u5e76\u4e14\u548c\u521a\u624d\u7684\u4e8b\u52a1\u5177\u6709\u76f8\u540c\u7684\u9694\u79bb\u7ea7\u522b RELEASE \u5219\u4f1a\u65ad\u5f00\u548c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002 SET AUTOCOMMIT \u53ef\u4ee5\u4fee\u6539\u5f53\u524d\u8fde\u63a5\u7684\u63d0\u4ea4\u65b9\u5f0f\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 SET AUTOCOMMIT=0\uff0c\u5219\u8bbe\u7f6e\u4e4b\u540e\u7684\u6240\u6709\u4e8b\u52a1\u90fd\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684\u547d\u4ee4\u8fdb\u884c\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL \u662f\u81ea\u52a8\u63d0\u4ea4\uff08Autocommit\uff09\u7684\uff0c\u8fd9\u610f\u5473\u7740\u53ea\u8981\u4f60\u4fee\u6539\u4e86\u8868\uff0cMySQL\u5c31\u4f1a\u5c06\u5176\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\uff0c \u4e0d\u53ef\u56de\u6eda \u3002\u5982\u679c\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684 Commit \u548c Rollback \u6765\u63d0\u4ea4\u548c\u56de\u6eda\u4e8b\u52a1\uff0c\u90a3\u4e48\u9700\u8981\u901a\u8fc7\u660e\u786e\u7684\u4e8b\u52a1\u63a7\u5236\u547d\u4ee4\u6765\u5f00\u59cb\u4e8b\u52a1\u3002 \u5982\u679c\u5728\u9501\u8868\u671f\u95f4\uff0c\u7528 START TRANSACTION \u547d\u4ee4\u5f00\u59cb\u4e00\u4e2a\u65b0\u4e8b\u52a1\uff0c\u4f1a\u9020\u6210\u4e00\u4e2a\u9690\u542b\u7684 UNLOCK TABLES \u88ab\u6267\u884c\u3002 \u548c Oracle \u7684\u4e8b\u52a1\u7ba1\u7406\u76f8\u540c\uff0c\u6240\u6709\u7684 DDL \u8bed\u53e5\u662f\u4e0d\u80fd\u56de\u6eda\u7684\uff0c\u5e76\u4e14\u90e8\u5206\u7684 DDL \u8bed\u53e5\u4f1a\u9020\u6210\u9690\u5f0f\u7684\u63d0\u4ea4\u3002","title":"2. \u4e8b\u52a1\u63a7\u5236"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#3","text":"\u5728\u4e8b\u52a1\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 SAVEPOINT\uff0c \u6307\u5b9a\u56de\u6eda\u4e8b\u52a1\u7684\u4e00\u4e2a\u90e8\u5206\uff0c \u4f46\u662f\u4e0d\u80fd\u6307\u5b9a\u63d0\u4ea4\u4e8b\u52a1\u7684\u4e00\u4e2a\u90e8\u5206\u3002\u5bf9\u4e8e\u590d\u6742\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u4e0d\u540c\u7684 SAVEPOINT\uff0c\u6ee1\u8db3\u4e0d\u540c\u7684\u6761\u4ef6\u65f6\uff0c\u56de\u6eda\u5230\u4e0d\u540c\u7684 SAVEPOINT\u3002 -- \u8bbe\u7f6e\u8fd8\u539f\u70b9 SAVEPOINT identifier -- \u56de\u6eda\u5230\u8fd8\u539f\u70b9 ROLLBACK [ WORK ] TO [ SAVEPOINT ] identifier -- \u5220\u9664\u8fd8\u539f\u70b9 RELEASE SAVEPOINT identifier \u53ea\u6709 InnoDB \u652f\u6301\u5bf9\u4e8b\u52a1\u8bbe\u7f6e\u8fd8\u539f\u70b9\uff08 SAVEPOINT \uff09\u3002","title":"3. \u8fd8\u539f\u70b9"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#4","text":"\u53ea\u6709 InnoDB \u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\uff08 XA Transaction \uff09\u3002","title":"4. \u5206\u5e03\u5f0f\u4e8b\u52a1"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#41","text":"\u5728 MySQL \u4e2d\uff0c\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5e94\u7528\u7a0b\u5e8f\u6d89\u53ca\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\u7ba1\u7406\u5668\u548c\u4e00\u4e2a\u4e8b\u52a1\u7ba1\u7406\u5668\u3002 \u8d44\u6e90\u7ba1\u7406\u5668\uff08RM\uff09\uff1a\u63d0\u4f9b\u5bf9\u4e8b\u52a1\u8d44\u6e90\u7684\u8bbf\u95ee\u9014\u5f84\u3002\u6570\u636e\u5e93\u670d\u52a1\u5668\u5c31\u662f\u4e00\u79cd\u8d44\u6e90\u7ba1\u7406\u5668\u3002\u8be5\u7ba1\u7406\u5668\u5fc5\u987b\u53ef\u4ee5\u63d0\u4ea4\u6216\u56de\u6eda\u7531 RM \u7ba1\u7406\u7684\u4e8b\u52a1\u3002 \u4e8b\u52a1\u7ba1\u7406\u5668\uff08TM\uff09\uff1a\u534f\u8c03\u4f5c\u4e3a\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e00\u90e8\u5206\u7684\u4e8b\u52a1\u3002TM \u4e0e\u7ba1\u7406\u6bcf\u4e2a\u4e8b\u52a1\u7684 RMs \u8fdb\u884c\u901a\u8baf\u3002\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u5404\u4e2a\u5355\u4e2a\u4e8b\u52a1\u5747\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u201c\u5206\u652f\u4e8b\u52a1\u201d \u3002\u5206\u5e03\u5f0f\u4e8b\u52a1\u548c\u5404\u5206\u652f\u901a\u8fc7\u4e00\u79cd\u547d\u540d\u65b9\u6cd5\u8fdb\u884c\u6807\u8bc6\u3002 MySQL\u7684XA\u5b9e\u73b0\u662f\uff0c\u8ba9MySQL\u670d\u52a1\u5668\u8868\u73b0\u7684\u50cf\u662f\u5904\u7406XA\u4e8b\u52a1\u7684RM\uff0c\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\u8868\u73b0\u7684\u50cf\u662fTM\u3002 \u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6267\u884c\u4f7f\u7528\u4e24\u4e2a\u9636\u6bb5\u7684\u63d0\u4ea4\u3002\u8fd9\u662f\u5728\u6267\u884c\u4e86\u5168\u5c40\u4e8b\u52a1\u7684\u5206\u652f\u6267\u884c\u7684\u64cd\u4f5c\u4e4b\u540e\u53d1\u751f\u7684\u3002 \u7b2c\u4e00\u9636\u6bb5\uff0c\u6240\u6709\u7684\u5206\u652f\u51c6\u5907\u5b8c\u6bd5\u3002\u610f\u5473\u7740\u5df2\u7ecf\u51c6\u5907\u597d\u63d0\u4ea4\u4e86\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff0cTM \u544a\u77e5 RMs \u63d0\u4ea4\u6216\u56de\u6eda\u3002\u5982\u679c\u4efb\u4f55\u5206\u652f\u5728\u51c6\u5907\u65f6\u6307\u793a\u5b83\u5c06\u65e0\u6cd5\u63d0\u4ea4\uff0c\u5219\u544a\u77e5\u6240\u6709\u5206\u652f\u90fd\u56de\u6eda\u3002","title":"4.1 \u539f\u7406"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#42","text":"XA { START | BEGIN } xid [ JOIN | RESUME ] -- \u4f7f\u4e8b\u52a1\u8fdb\u5165 PREPARE \u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u7b2c\u4e00\u4e2a\u63d0\u4ea4\u9636\u6bb5\u3002 XA END xid [ SUSPEND [ FOR MIGRATE ]] XA PREPARE xid -- \u7b2c\u4e8c\u4e2a\u63d0\u4ea4\u9636\u6bb5\uff0c\u5206\u652f\u4e8b\u52a1\u88ab\u5b9e\u9645\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002 XA COMMIT xid [ ONE PHASE ] XA ROLLBACK xid -- \u8fd4\u56de\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u5904\u4e8e PREPARE \u72b6\u6001\u7684\u5206\u652f\u4e8b\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 XA RECOVER xid \u662f\u4e00\u4e2a XA \u4e8b\u52a1\u6807\u8bc6\u7b26\uff0c\u7528\u6765\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002xid \u503c\u7531\u5ba2\u6237\u7aef\u63d0\u4f9b\uff0c\u6216\u7531MySQL \u670d\u52a1\u5668\u751f\u6210\u3002xid \u503c\u5305\u542b 1\uff5e3 \u4e2a\u90e8\u5206\uff1a xid : gtrid [, bqual [, formatID ]] gtrid \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u6807\u8bc6\u7b26\uff0c \u76f8\u540c\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5e94\u8be5\u4f7f\u7528\u76f8\u540c\u7684 gtrid\uff0c \u8fd9\u6837\u53ef\u4ee5\u660e\u786e\u77e5\u9053 xa \u4e8b\u52a1\u5c5e\u4e8e\u54ea\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002\u6700\u597d\u5199\u4e3a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32 ( X'6162' , 0x6162 ) bqual \u662f\u4e00\u4e2a\u5206\u652f\u9650\u5b9a\u7b26\uff0c \u9ed8\u8ba4\u503c\u662f\u7a7a\u4e32\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\u7684\u6bcf\u4e2a\u5206\u652f\u4e8b\u52a1\uff0cbqual \u503c\u5fc5\u987b\u662f\u552f\u4e00\u7684\u3002\u6700\u597d\u5199\u4e3a\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32 ( X'6162' , 0x6162 ) formatID \u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u7528\u4e8e\u6807\u8bc6\u7531 gtrid \u548c bqual \u503c\u4f7f\u7528\u7684\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503c\u662f 1\u3002","title":"4.2 \u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u8bed\u6cd5"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#43-xa","text":"XA\u4e8b\u52a1\u901a\u8fc7\u4ee5\u4e0b\u6d41\u7a0b\u6267\u884c\uff1a \u4f7f\u7528 XA START \u5f00\u542f\u4e8b\u52a1\u5e76\u5c06\u5176\u7f6e\u4e3a ACTIVE \u6fc0\u6d3b\u72b6\u6001\u3002 \u5bf9\u4e8e ACTIVE \u72b6\u6001\u7684\u4e8b\u52a1\uff0c\u6267\u884c\u6784\u6210\u4e8b\u52a1\u7684SQL\u8bed\u53e5\uff0c\u7136\u540e\u6267\u884c XA END \u8bed\u53e5\uff0c\u6b64\u8bed\u53e5\u5c06\u4e8b\u52a1\u7f6e\u4e3a IDLE \u6020\u60f0\u72b6\u6001\u3002 \u5bf9\u4e8e IDLE \u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u4e24\u79cd\u8bed\u53e5\uff1a XA PREPARE \uff1a\u5c06\u4e8b\u52a1\u7f6e\u4e3a PREPARED \u51c6\u5907\u72b6\u6001\u3002\u6b64\u65f6\u53ef\u4ee5\u7528 XA RECOVER \u5217\u51fa\u4e8b\u52a1\u7684 xid \u503c\u3002 XA COMMIT ... ONE PHASE \uff1a\u51c6\u5907\u5e76\u63d0\u4ea4\u4e8b\u52a1\u3002 \u5bf9\u4e8e PREPARED \u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u6267\u884c XA COMMIT \u63d0\u4ea4\u5e76\u7ec8\u6b62\u4e8b\u52a1\uff0c\u6216\u8005\u6267\u884c XA ROLLBACK \u56de\u6eda\u5e76\u7ec8\u6b62\u4e8b\u52a1\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a XA START \u4e0d\u652f\u6301 [JOIN|RESUME] \u5b50\u53e5 XA END \u4e0d\u652f\u6301 [SUSPEND [FOR MIGRATE]] \u5b50\u53e5\u3002\uff1f\uff1f\uff1f \u5982\u679c XA START \u5df2\u7ecf\u5f00\u542f\u4e86\u4e00\u4e2aXA\u4e8b\u52a1\uff0c\u90a3\u4e48\u4e0d\u80fd\u4f7f\u7528\u672c\u5730\u4e8b\u52a1\uff0c\u9690\u5f0f\u7684\u63d0\u4ea4\uff08 \u5b58\u5728\u9690\u5f0f\u63d0\u4ea4\u7684\u8bed\u53e5 \uff09\u4e5f\u662f\u5982\u6b64\uff1b\u53cd\u4e4b\u4ea6\u7136\u3002","title":"4.3 XA \u4e8b\u52a1\u4f7f\u7528\u6d41\u7a0b"},{"location":"mysql/19. MySQL\u4e8b\u52a1\u4e0e\u9501\u5b9a\u8bed\u53e5/#44","text":"\u200b \u5982\u679c\u5206\u652f\u4e8b\u52a1\u5728\u8fbe\u5230 prepare \u72b6\u6001\u65f6\uff0c\u6570\u636e\u5e93\u5f02\u5e38\u91cd\u65b0\u542f\u52a8\uff0c\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u4ee5\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u5206\u652f\u4e8b\u52a1\u8fdb\u884c\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u5f97\u64cd\u4f5c\uff0c\u4f46\u662f\u63d0\u4ea4\u7684\u4e8b\u52a1\u6ca1\u6709\u5199 binlog\uff0c\u5b58\u5728\u4e00\u5b9a\u7684\u9690\u60a3\uff0c \u53ef\u80fd\u5bfc\u81f4\u4f7f\u7528 binlog \u6062\u590d\u4e22\u5931\u90e8\u5206\u6570\u636e\u3002 \u200b \u5982\u679c\u5206\u652f\u4e8b\u52a1\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5f02\u5e38\u4e2d\u6b62\uff0c \u90a3\u4e48\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u56de\u6eda\u672a\u5b8c\u6210\u7684\u5206\u652f\u4e8b\u52a1\uff0c \u5982\u679c\u6b64\u65f6\u5206\u652f\u4e8b\u52a1\u5df2\u7ecf\u6267\u884c\u5230 prepare \u72b6\u6001\uff0c \u90a3\u4e48\u8fd9\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5176\u4ed6\u5206\u652f\u53ef\u80fd\u5df2\u7ecf\u6210\u529f\u63d0\u4ea4\uff0c\u5982\u679c\u8fd9\u4e2a\u5206\u652f\u56de\u6eda\uff0c\u53ef\u80fd\u5bfc\u81f4\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u4e0d\u5b8c\u6574\uff0c\u4e22\u5931\u90e8\u5206\u5206\u652f\u4e8b\u52a1\u7684\u5185\u5bb9\u3002 \u5982\u679c\u5e94\u7528\u5bf9\u4e8b\u52a1\u7684\u5b8c\u6574\u6027\u6709\u6bd4\u8f83\u9ad8\u7684\u8981\u6c42\uff0c \u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u7684\u7248\u672c\uff0c \u5219\u4e0d\u63a8\u8350\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002","title":"4.4 \u5b58\u5728\u7684\u95ee\u9898"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/","text":"1. \u4e3b\u952e 1.1 \u8054\u5408\u4e3b\u952e 2. \u5916\u952e 2.1 \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff08CONSTRAINT\uff09\uff1a 2.2 \u5220\u9664\u5916\u952e\u7ea6\u675f\uff1a 2.1 \u591a\u5bf9\u591a 2.2 \u4e00\u5bf9\u4e00 3. \u7d22\u5f15 3.1 \u6dfb\u52a0\u7d22\u5f15\uff1a 3.1 \u552f\u4e00\u7d22\u5f15 3.2 \u552f\u4e00\u6027\u7ea6\u675f 4. \u793a\u4f8b \u6ce8\u610f NULL \u8868\u793a\u5b57\u6bb5\u6570\u636e \u4e0d\u5b58\u5728 \u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5b57\u6bb5\u5e94\u8be5\u907f\u514d\u5141\u8bb8\u4e3aNULL\u3002\u4e0d\u5141\u8bb8\u4e3aNULL\u53ef\u4ee5\u7b80\u5316\u67e5\u8be2\u6761\u4ef6\uff0c\u52a0\u5feb\u67e5\u8be2\u901f\u5ea6\uff0c\u4e5f\u5229\u4e8e\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u6570\u636e\u540e\u65e0\u9700\u5224\u65ad\u662f\u5426\u4e3aNULL\u3002 1. \u4e3b\u952e \u00b6 \u9009\u53d6\u4e3b\u952e\u7684\u4e00\u4e2a\u57fa\u672c\u539f\u5219\u662f\uff1a\u4e0d\u4f7f\u7528\u4efb\u4f55\u4e1a\u52a1\u76f8\u5173\u7684\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 \u5e38\u89c1\u7684\u53ef\u4f5c\u4e3a id \u5b57\u6bb5\u7684\u7c7b\u578b\u6709\uff1a \u81ea\u589e\u6574\u6570\u7c7b\u578b\uff1a\u6570\u636e\u5e93\u4f1a\u5728\u63d2\u5165\u6570\u636e\u65f6\u81ea\u52a8\u4e3a\u6bcf\u4e00\u6761\u8bb0\u5f55\u5206\u914d\u4e00\u4e2a\u81ea\u589e\u6574\u6570\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u5168\u4e0d\u7528\u62c5\u5fc3\u4e3b\u952e\u91cd\u590d\uff0c\u4e5f\u4e0d\u7528\u81ea\u5df1\u9884\u5148\u751f\u6210\u4e3b\u952e\uff1b\u4e0a\u9650\u662f2147483647\uff08\u7ea621\u4ebf\uff09\u3002\u7528\u6cd5\uff1a\u5728\u5b57\u6bb5\u5b9a\u4e49\u540e\u52a0\u4e0a AUTO_INCREMENT \u5168\u5c40\u552f\u4e00GUID\u7c7b\u578b\uff1a\u4f7f\u7528\u4e00\u79cd\u5168\u5c40\u552f\u4e00\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u952e\uff1b\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u90fd\u5185\u7f6e\u4e86GUID\u7b97\u6cd5\uff0c\u53ef\u4ee5\u81ea\u5df1\u9884\u7b97\u51fa\u4e3b\u952e\u3002 1.1 \u8054\u5408\u4e3b\u952e \u00b6 \u901a\u8fc7\u591a\u4e2a\u5b57\u6bb5\u552f\u4e00\u6807\u8bc6\u8bb0\u5f55\uff0c\u5373\u4e24\u4e2a\u6216\u66f4\u591a\u7684\u5b57\u6bb5\u90fd\u8bbe\u7f6e\u4e3a\u4e3b\u952e\uff0c\u8fd9\u79cd\u4e3b\u952e\u88ab\u79f0\u4e3a \u8054\u5408\u4e3b\u952e \u3002 \u5c3d\u91cf\u4e0d\u4f7f\u7528\u8054\u5408\u4e3b\u952e\u3002 2. \u5916\u952e \u00b6 2.1 \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff08CONSTRAINT\uff09\uff1a \u00b6 ALTER TABLE < table > ADD CONSTRAINT < foreign - key - name > FOREIGN KEY < column > REFERENCES < other - table > ( < other - table - column > ); table\uff1a\u672c\u8868 foreign-key-name\uff1a\u4efb\u610f\u7ea6\u675f\u540d\u79f0 column\uff1a\u5b57\u6bb5 other-table(other-table-column)\uff1a\u5176\u5b83\u8868\u7684\u5b57\u6bb5 \u7531\u4e8e\u5916\u952e\u7ea6\u675f\u4f1a\u964d\u4f4e\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u5927\u90e8\u5206\u4e92\u8054\u7f51\u5e94\u7528\u7a0b\u5e8f\u4e3a\u4e86\u8ffd\u6c42\u901f\u5ea6\uff0c\u5e76\u4e0d\u8bbe\u7f6e\u5916\u952e\u7ea6\u675f\uff0c\u800c\u662f\u4ec5\u9760\u5e94\u7528\u7a0b\u5e8f\u81ea\u8eab\u6765\u4fdd\u8bc1\u903b\u8f91\u7684\u6b63\u786e\u6027\u3002 CREATE TABLE CHILD ( ID SMALLINT UNSIGNED AUTO_INCREMENT , PID SMALLINT UNSIGNED , PRIMARY KEY ( ID ), CONSTRAINT ` PARENT_ID ` FOREIGN KEY ( PID ) REFERENCES PARENT ( ID )); 2.2 \u5220\u9664\u5916\u952e\u7ea6\u675f\uff1a \u00b6 ALTER TABLE < table > DROP FOREIGN KEY < foreign - key - name > ; \u6ce8\u610f \uff1a\u5220\u9664\u5916\u952e\u7ea6\u675f\u5e76\u6ca1\u6709\u5220\u9664\u5916\u952e\u8fd9\u4e00\u5217\u3002\u5220\u9664\u5217\u662f\u901a\u8fc7 DROP COLUMN ... \u5b9e\u73b0\u7684\u3002 2.1 \u591a\u5bf9\u591a \u00b6 \u901a\u8fc7\u4e24\u4e2a\u4e00\u5bf9\u591a\u5173\u7cfb\u5b9e\u73b0\u7684\uff0c\u5373\u901a\u8fc7\u4e00\u4e2a\u4e2d\u95f4\u8868\uff0c\u5173\u8054\u4e24\u4e2a\u4e00\u5bf9\u591a\u5173\u7cfb\u3002 2.2 \u4e00\u5bf9\u4e00 \u00b6 \u4e00\u4e9b\u5e94\u7528\u4f1a\u628a\u4e00\u4e2a\u5927\u8868\u62c6\u6210\u4e24\u4e2a\u4e00\u5bf9\u4e00\u7684\u8868\uff0c\u76ee\u7684\u662f\u628a\u7ecf\u5e38\u8bfb\u53d6\u548c\u4e0d\u7ecf\u5e38\u8bfb\u53d6\u7684\u5b57\u6bb5\u5206\u5f00\uff0c\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u6027\u80fd\u3002 3. \u7d22\u5f15 \u00b6 \u7d22\u5f15\u662f\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u5bf9\u67d0\u4e00\u5217\u6216\u591a\u4e2a\u5217\u7684\u503c\u8fdb\u884c \u9884\u6392\u5e8f \u7684\u6570\u636e\u7ed3\u6784\u3002\u901a\u8fc7\u4f7f\u7528\u7d22\u5f15\uff0c\u53ef\u4ee5\u8ba9\u6570\u636e\u5e93\u7cfb\u7edf\u4e0d\u5fc5\u626b\u63cf\u6574\u4e2a\u8868\uff0c\u800c\u662f\u76f4\u63a5\u5b9a\u4f4d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u52a0\u5feb\u4e86\u67e5\u8be2\u901f\u5ea6\u3002 \u4f18\u70b9 \u662f\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\uff0c \u7f3a\u70b9 \u662f\u5728\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u8bb0\u5f55\u65f6\uff0c\u9700\u8981\u540c\u65f6\u4fee\u6539\u7d22\u5f15\uff0c\u56e0\u6b64\uff0c\u7d22\u5f15\u8d8a\u591a\uff0c\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u8bb0\u5f55\u7684\u901f\u5ea6\u5c31\u8d8a\u6162\u3002 3.1 \u6dfb\u52a0\u7d22\u5f15\uff1a \u00b6 ALTER TABLE < table > ADD INDEX < index - name > ( column1 , column2 , ...); \u7d22\u5f15\u7684\u6548\u7387\u53d6\u51b3\u4e8e\u7d22\u5f15\u5217\u7684\u503c\u662f\u5426\u6563\u5217\uff0c\u5373\u8be5\u5217\u7684\u503c\u5982\u679c\u8d8a\u4e92\u4e0d\u76f8\u540c\uff0c\u90a3\u4e48\u7d22\u5f15\u6548\u7387\u8d8a\u9ad8\u3002 \u53ef\u4ee5\u5bf9\u4e00\u5f20\u8868\u521b\u5efa\u591a\u4e2a\u7d22\u5f15\u3002 \u5bf9\u4e8e\u4e3b\u952e\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u5bf9\u5176\u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u3002 3.1 \u552f\u4e00\u7d22\u5f15 \u00b6 \u65e2\u6709\u552f\u4e00\u6027\u7ea6\u675f\uff0c\u53c8\u6709\u7d22\u5f15\u3002 ALTER TABLE < table > ADD UNIQUE INDEX < index - name > ( column ); 3.2 \u552f\u4e00\u6027\u7ea6\u675f \u00b6 \u4e5f\u53ef\u4ee5\u53ea\u5bf9\u67d0\u4e00\u5217\u6dfb\u52a0\u4e00\u4e2a \u552f\u4e00\u7ea6\u675f \u800c\u4e0d\u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff1a ALTER TABLE < table > ADD CONSTRAINT < unique - name > UNIQUE ( column ); 4. \u793a\u4f8b \u00b6 CREATE TABLE IF NOT EXISTS blog ( id INT ( 11 ) AUTO_INCREMENT , title VARCHAR ( 180 ) NOT NULL , updateDate DATE NOT NULL , tags VARCHAR ( 255 ) , type VARCHAR ( 255 ) , content VARCHAR ( 255 ) NOT NULL , userId INT NOT NULL , # \u4e3b\u952e\u7ea6\u675f PRIMARY KEY ( id ) , # \u5916\u952e\u58f0\u660e\u7ea6\u675f CONSTRAINT blog_user_fk FOREIGN KEY ( userId ) REFERENCES user ( id ), # \u8054\u5408\u552f\u4e00\u7ea6\u675f UNIQUE KEY title_userId_u ( title , userId ) ) ENGINE = INNODB DEFAULT CHARSET = UTF8 ;","title":"2. \u5173\u7cfb\u6a21\u578b"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#1","text":"\u9009\u53d6\u4e3b\u952e\u7684\u4e00\u4e2a\u57fa\u672c\u539f\u5219\u662f\uff1a\u4e0d\u4f7f\u7528\u4efb\u4f55\u4e1a\u52a1\u76f8\u5173\u7684\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 \u5e38\u89c1\u7684\u53ef\u4f5c\u4e3a id \u5b57\u6bb5\u7684\u7c7b\u578b\u6709\uff1a \u81ea\u589e\u6574\u6570\u7c7b\u578b\uff1a\u6570\u636e\u5e93\u4f1a\u5728\u63d2\u5165\u6570\u636e\u65f6\u81ea\u52a8\u4e3a\u6bcf\u4e00\u6761\u8bb0\u5f55\u5206\u914d\u4e00\u4e2a\u81ea\u589e\u6574\u6570\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u5b8c\u5168\u4e0d\u7528\u62c5\u5fc3\u4e3b\u952e\u91cd\u590d\uff0c\u4e5f\u4e0d\u7528\u81ea\u5df1\u9884\u5148\u751f\u6210\u4e3b\u952e\uff1b\u4e0a\u9650\u662f2147483647\uff08\u7ea621\u4ebf\uff09\u3002\u7528\u6cd5\uff1a\u5728\u5b57\u6bb5\u5b9a\u4e49\u540e\u52a0\u4e0a AUTO_INCREMENT \u5168\u5c40\u552f\u4e00GUID\u7c7b\u578b\uff1a\u4f7f\u7528\u4e00\u79cd\u5168\u5c40\u552f\u4e00\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u952e\uff1b\u5927\u90e8\u5206\u7f16\u7a0b\u8bed\u8a00\u90fd\u5185\u7f6e\u4e86GUID\u7b97\u6cd5\uff0c\u53ef\u4ee5\u81ea\u5df1\u9884\u7b97\u51fa\u4e3b\u952e\u3002","title":"1. \u4e3b\u952e"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#11","text":"\u901a\u8fc7\u591a\u4e2a\u5b57\u6bb5\u552f\u4e00\u6807\u8bc6\u8bb0\u5f55\uff0c\u5373\u4e24\u4e2a\u6216\u66f4\u591a\u7684\u5b57\u6bb5\u90fd\u8bbe\u7f6e\u4e3a\u4e3b\u952e\uff0c\u8fd9\u79cd\u4e3b\u952e\u88ab\u79f0\u4e3a \u8054\u5408\u4e3b\u952e \u3002 \u5c3d\u91cf\u4e0d\u4f7f\u7528\u8054\u5408\u4e3b\u952e\u3002","title":"1.1 \u8054\u5408\u4e3b\u952e"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#2","text":"","title":"2. \u5916\u952e"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#21-constraint","text":"ALTER TABLE < table > ADD CONSTRAINT < foreign - key - name > FOREIGN KEY < column > REFERENCES < other - table > ( < other - table - column > ); table\uff1a\u672c\u8868 foreign-key-name\uff1a\u4efb\u610f\u7ea6\u675f\u540d\u79f0 column\uff1a\u5b57\u6bb5 other-table(other-table-column)\uff1a\u5176\u5b83\u8868\u7684\u5b57\u6bb5 \u7531\u4e8e\u5916\u952e\u7ea6\u675f\u4f1a\u964d\u4f4e\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u5927\u90e8\u5206\u4e92\u8054\u7f51\u5e94\u7528\u7a0b\u5e8f\u4e3a\u4e86\u8ffd\u6c42\u901f\u5ea6\uff0c\u5e76\u4e0d\u8bbe\u7f6e\u5916\u952e\u7ea6\u675f\uff0c\u800c\u662f\u4ec5\u9760\u5e94\u7528\u7a0b\u5e8f\u81ea\u8eab\u6765\u4fdd\u8bc1\u903b\u8f91\u7684\u6b63\u786e\u6027\u3002 CREATE TABLE CHILD ( ID SMALLINT UNSIGNED AUTO_INCREMENT , PID SMALLINT UNSIGNED , PRIMARY KEY ( ID ), CONSTRAINT ` PARENT_ID ` FOREIGN KEY ( PID ) REFERENCES PARENT ( ID ));","title":"2.1 \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff08CONSTRAINT\uff09\uff1a"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#22","text":"ALTER TABLE < table > DROP FOREIGN KEY < foreign - key - name > ; \u6ce8\u610f \uff1a\u5220\u9664\u5916\u952e\u7ea6\u675f\u5e76\u6ca1\u6709\u5220\u9664\u5916\u952e\u8fd9\u4e00\u5217\u3002\u5220\u9664\u5217\u662f\u901a\u8fc7 DROP COLUMN ... \u5b9e\u73b0\u7684\u3002","title":"2.2 \u5220\u9664\u5916\u952e\u7ea6\u675f\uff1a"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#21","text":"\u901a\u8fc7\u4e24\u4e2a\u4e00\u5bf9\u591a\u5173\u7cfb\u5b9e\u73b0\u7684\uff0c\u5373\u901a\u8fc7\u4e00\u4e2a\u4e2d\u95f4\u8868\uff0c\u5173\u8054\u4e24\u4e2a\u4e00\u5bf9\u591a\u5173\u7cfb\u3002","title":"2.1 \u591a\u5bf9\u591a"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#22_1","text":"\u4e00\u4e9b\u5e94\u7528\u4f1a\u628a\u4e00\u4e2a\u5927\u8868\u62c6\u6210\u4e24\u4e2a\u4e00\u5bf9\u4e00\u7684\u8868\uff0c\u76ee\u7684\u662f\u628a\u7ecf\u5e38\u8bfb\u53d6\u548c\u4e0d\u7ecf\u5e38\u8bfb\u53d6\u7684\u5b57\u6bb5\u5206\u5f00\uff0c\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u6027\u80fd\u3002","title":"2.2 \u4e00\u5bf9\u4e00"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#3","text":"\u7d22\u5f15\u662f\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u5bf9\u67d0\u4e00\u5217\u6216\u591a\u4e2a\u5217\u7684\u503c\u8fdb\u884c \u9884\u6392\u5e8f \u7684\u6570\u636e\u7ed3\u6784\u3002\u901a\u8fc7\u4f7f\u7528\u7d22\u5f15\uff0c\u53ef\u4ee5\u8ba9\u6570\u636e\u5e93\u7cfb\u7edf\u4e0d\u5fc5\u626b\u63cf\u6574\u4e2a\u8868\uff0c\u800c\u662f\u76f4\u63a5\u5b9a\u4f4d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u52a0\u5feb\u4e86\u67e5\u8be2\u901f\u5ea6\u3002 \u4f18\u70b9 \u662f\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\uff0c \u7f3a\u70b9 \u662f\u5728\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u8bb0\u5f55\u65f6\uff0c\u9700\u8981\u540c\u65f6\u4fee\u6539\u7d22\u5f15\uff0c\u56e0\u6b64\uff0c\u7d22\u5f15\u8d8a\u591a\uff0c\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u8bb0\u5f55\u7684\u901f\u5ea6\u5c31\u8d8a\u6162\u3002","title":"3. \u7d22\u5f15"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#31","text":"ALTER TABLE < table > ADD INDEX < index - name > ( column1 , column2 , ...); \u7d22\u5f15\u7684\u6548\u7387\u53d6\u51b3\u4e8e\u7d22\u5f15\u5217\u7684\u503c\u662f\u5426\u6563\u5217\uff0c\u5373\u8be5\u5217\u7684\u503c\u5982\u679c\u8d8a\u4e92\u4e0d\u76f8\u540c\uff0c\u90a3\u4e48\u7d22\u5f15\u6548\u7387\u8d8a\u9ad8\u3002 \u53ef\u4ee5\u5bf9\u4e00\u5f20\u8868\u521b\u5efa\u591a\u4e2a\u7d22\u5f15\u3002 \u5bf9\u4e8e\u4e3b\u952e\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u5bf9\u5176\u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u3002","title":"3.1 \u6dfb\u52a0\u7d22\u5f15\uff1a"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#31_1","text":"\u65e2\u6709\u552f\u4e00\u6027\u7ea6\u675f\uff0c\u53c8\u6709\u7d22\u5f15\u3002 ALTER TABLE < table > ADD UNIQUE INDEX < index - name > ( column );","title":"3.1 \u552f\u4e00\u7d22\u5f15"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#32","text":"\u4e5f\u53ef\u4ee5\u53ea\u5bf9\u67d0\u4e00\u5217\u6dfb\u52a0\u4e00\u4e2a \u552f\u4e00\u7ea6\u675f \u800c\u4e0d\u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff1a ALTER TABLE < table > ADD CONSTRAINT < unique - name > UNIQUE ( column );","title":"3.2 \u552f\u4e00\u6027\u7ea6\u675f"},{"location":"mysql/2. \u5173\u7cfb\u6a21\u578b/#4","text":"CREATE TABLE IF NOT EXISTS blog ( id INT ( 11 ) AUTO_INCREMENT , title VARCHAR ( 180 ) NOT NULL , updateDate DATE NOT NULL , tags VARCHAR ( 255 ) , type VARCHAR ( 255 ) , content VARCHAR ( 255 ) NOT NULL , userId INT NOT NULL , # \u4e3b\u952e\u7ea6\u675f PRIMARY KEY ( id ) , # \u5916\u952e\u58f0\u660e\u7ea6\u675f CONSTRAINT blog_user_fk FOREIGN KEY ( userId ) REFERENCES user ( id ), # \u8054\u5408\u552f\u4e00\u7ea6\u675f UNIQUE KEY title_userId_u ( title , userId ) ) ENGINE = INNODB DEFAULT CHARSET = UTF8 ;","title":"4. \u793a\u4f8b"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/","text":"1. SQL \u6ce8\u5165 1.1 \u5e94\u5bf9\u63aa\u65bd 1.1.1 PrepareStatement+Bind-variable 1.1.2 \u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u8f6c\u6362\u51fd\u6570 1.1.3 \u81ea\u5df1\u5b9a\u4e49\u51fd\u6570\u8fdb\u884c\u6821\u9a8c 1. SQL \u6ce8\u5165 \u00b6 SQL Injection \u5c31\u662f\u5229\u7528\u67d0\u4e9b\u6570\u636e\u5e93\u7684\u5916\u90e8\u63a5\u53e3\u5c06\u7528\u6237\u6570\u636e\u63d2\u5165\u5230\u5b9e\u9645\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u8a00\uff08SQL\uff09\u5f53\u4e2d\uff0c\u4ece\u800c\u8fbe\u5230\u5165\u4fb5\u6570\u636e\u5e93\u4e43\u81f3\u64cd\u4f5c\u7cfb\u7edf\u7684\u76ee\u7684\u3002\u5b83\u7684\u4ea7\u751f\u4e3b\u8981\u662f\u7531\u4e8e\u7a0b\u5e8f\u5bf9\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\u6ca1\u6709\u8fdb\u884c\u4e25\u683c\u7684 \u8fc7\u6ee4\uff0c\u5bfc\u81f4\u975e\u6cd5\u6570\u636e\u5e93\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u3002 1.1 \u5e94\u5bf9\u63aa\u65bd \u00b6 1.1.1 PrepareStatement+Bind-variable \u00b6 \u5bf9 Java\u3001JSP \u5f00\u53d1\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u5f0f\uff0c\u4e0d\u8981\u4f7f\u7528\u62fc\u63a5\u7684SQL\u3002 String sql = \"select * from users u where u.id = ? and u.password = ?\" ; Preparedstatement ps = connection . preparestatement ( sql ); ps . setint ( 1 , id ); ps . setstring ( 2 , pwd ); resultset rs = ps . executequery (); 1.1.2 \u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u8f6c\u6362\u51fd\u6570 \u00b6 \u5f88\u591a\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\u90fd\u63d0\u4f9b\u4e86\u5bf9\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u6362\u7684\u51fd\u6570\uff0c\u6070\u5f53\u5730\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\uff0c\u53ef\u4ee5\u9632\u6b62\u5e94\u7528\u7a0b\u5e8f\u7528\u6237\u8f93\u5165\u4f7f\u5e94\u7528\u7a0b\u5e8f\u751f\u6210\u4e0d\u671f\u671b\u7684\u8bed\u53e5\u3002 MySQL C API\uff1a\u4f7f\u7528 mysql_real_escape_string() API \u8c03\u7528\u3002 MySQL++\uff1a\u4f7f\u7528 escape \u548c quote \u4fee\u9970\u7b26\u3002 1.1.3 \u81ea\u5df1\u5b9a\u4e49\u51fd\u6570\u8fdb\u884c\u6821\u9a8c \u00b6 \u8f93\u5165\u9a8c\u8bc1\u7684\u9014\u5f84\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6574\u7406\u6570\u636e\u4f7f\u4e4b\u53d8\u5f97\u6709\u6548\uff1b \u62d2\u7edd\u5df2\u77e5\u7684\u975e\u6cd5\u8f93\u5165\uff1b \u53ea\u63a5\u53d7\u5df2\u77e5\u7684\u5408\u6cd5\u8f93\u5165\u3002 \u8fc7\u6ee4\u7279\u6b8a\u7b26\u53f7\u7684\u540c\u65f6\u4e5f\u8981\u8fc7\u6ee4\u5b83\u4eec\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u201c\uff05XX\u201d\u3002","title":"20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/#1-sql","text":"SQL Injection \u5c31\u662f\u5229\u7528\u67d0\u4e9b\u6570\u636e\u5e93\u7684\u5916\u90e8\u63a5\u53e3\u5c06\u7528\u6237\u6570\u636e\u63d2\u5165\u5230\u5b9e\u9645\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u8a00\uff08SQL\uff09\u5f53\u4e2d\uff0c\u4ece\u800c\u8fbe\u5230\u5165\u4fb5\u6570\u636e\u5e93\u4e43\u81f3\u64cd\u4f5c\u7cfb\u7edf\u7684\u76ee\u7684\u3002\u5b83\u7684\u4ea7\u751f\u4e3b\u8981\u662f\u7531\u4e8e\u7a0b\u5e8f\u5bf9\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\u6ca1\u6709\u8fdb\u884c\u4e25\u683c\u7684 \u8fc7\u6ee4\uff0c\u5bfc\u81f4\u975e\u6cd5\u6570\u636e\u5e93\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u3002","title":"1. SQL \u6ce8\u5165"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/#11","text":"","title":"1.1 \u5e94\u5bf9\u63aa\u65bd"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/#111-preparestatementbind-variable","text":"\u5bf9 Java\u3001JSP \u5f00\u53d1\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u5f0f\uff0c\u4e0d\u8981\u4f7f\u7528\u62fc\u63a5\u7684SQL\u3002 String sql = \"select * from users u where u.id = ? and u.password = ?\" ; Preparedstatement ps = connection . preparestatement ( sql ); ps . setint ( 1 , id ); ps . setstring ( 2 , pwd ); resultset rs = ps . executequery ();","title":"1.1.1 PrepareStatement+Bind-variable"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/#112","text":"\u5f88\u591a\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\u90fd\u63d0\u4f9b\u4e86\u5bf9\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u6362\u7684\u51fd\u6570\uff0c\u6070\u5f53\u5730\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\uff0c\u53ef\u4ee5\u9632\u6b62\u5e94\u7528\u7a0b\u5e8f\u7528\u6237\u8f93\u5165\u4f7f\u5e94\u7528\u7a0b\u5e8f\u751f\u6210\u4e0d\u671f\u671b\u7684\u8bed\u53e5\u3002 MySQL C API\uff1a\u4f7f\u7528 mysql_real_escape_string() API \u8c03\u7528\u3002 MySQL++\uff1a\u4f7f\u7528 escape \u548c quote \u4fee\u9970\u7b26\u3002","title":"1.1.2 \u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7684\u8f6c\u6362\u51fd\u6570"},{"location":"mysql/20. SQL\u4e2d\u7684\u5b89\u5168\u95ee\u9898/#113","text":"\u8f93\u5165\u9a8c\u8bc1\u7684\u9014\u5f84\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6574\u7406\u6570\u636e\u4f7f\u4e4b\u53d8\u5f97\u6709\u6548\uff1b \u62d2\u7edd\u5df2\u77e5\u7684\u975e\u6cd5\u8f93\u5165\uff1b \u53ea\u63a5\u53d7\u5df2\u77e5\u7684\u5408\u6cd5\u8f93\u5165\u3002 \u8fc7\u6ee4\u7279\u6b8a\u7b26\u53f7\u7684\u540c\u65f6\u4e5f\u8981\u8fc7\u6ee4\u5b83\u4eec\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u201c\uff05XX\u201d\u3002","title":"1.1.3 \u81ea\u5df1\u5b9a\u4e49\u51fd\u6570\u8fdb\u884c\u6821\u9a8c"},{"location":"mysql/21. SQL Mode/","text":"1. \u8bbe\u7f6emode 2. \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e 3. SQL Mode \u7684\u5e38\u89c1\u529f\u80fd 4. \u5e38\u7528\u7684 SQL Mode 5. SQL Mode \u5728\u8fc1\u79fb\u4e2d\u7684\u4f7f\u7528 MySQL \u53ef\u4ee5\u8fd0\u884c\u4e0d\u540c\u7684 SQL Mode\uff08SQL \u6a21\u5f0f\uff09\u4e0b\u3002 SQL Mode \u5b9a\u4e49\u4e86MySQL \u5e94\u652f\u6301\u7684 SQL \u8bed\u6cd5\u3001\u6570\u636e\u6821\u9a8c\u7b49\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u5bb9\u6613\u5730\u5728\u4e0d\u540c\u7684\u73af\u5883\u4e2d\u4f7f\u7528 MySQL\u3002 SQL Mode \u5e38\u7528\u6765\u89e3\u51b3\u4e0b\u9762\u51e0\u7c7b\u95ee\u9898\uff1a \u901a\u8fc7\u8bbe\u7f6e SQL Mode\uff0c\u53ef\u4ee5\u5b8c\u6210\u4e0d\u540c\u4e25\u683c\u7a0b\u5ea6\u7684\u6570\u636e\u6821\u9a8c\uff0c\u6709\u6548\u5730\u4fdd\u969c\u6570\u636e\u51c6\u786e\u6027\u3002 \u901a\u8fc7\u8bbe\u7f6e SQL Mode \u4e3a ANSI \u6a21\u5f0f\uff0c\u6765\u4fdd\u8bc1\u5927\u591a\u6570 SQL \u7b26\u5408\u6807\u51c6\u7684 SQL \u8bed\u6cd5,\u8fd9\u6837\u5e94\u7528\u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u8fdb\u884c\u8fc1\u79fb\u65f6\uff0c\u5219\u4e0d\u9700\u8981\u5bf9\u4e1a\u52a1 SQL \u8fdb\u884c\u8f83\u5927\u7684\u4fee\u6539\u3002 \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u4e4b\u524d\uff0c \u901a\u8fc7\u8bbe\u7f6e SQL Mode \u53ef\u4ee5\u4f7f MySQL \u4e0a\u7684\u6570\u636e\u66f4\u65b9\u4fbf\u5730\u8fc1\u79fb\u5230\u76ee\u6807\u6570\u636e\u5e93\u4e2d\u3002 1. \u8bbe\u7f6emode \u00b6 \u9ed8\u8ba4\u7684SQL mode\u662f\u6ca1\u6709\u8bbe\u7f6e\u7684\u3002 \u5728\u670d\u52a1\u5668\u542f\u52a8\u7684\u65f6\u5019\u8bbe\u7f6e\uff1a \u5728\u547d\u4ee4\u884c\u4f7f\u7528 --sql-mode=\"mode\" \u9009\u9879 \u5728 my.cnf \uff08Unix\uff09\u6216 my.ini \uff08Windows\uff09\u4e2d\u8bbe\u7f6e sql-mode=\"mode\" \u8981\u663e\u5f0f\u6e05\u9664SQL\u6a21\u5f0f\uff0c\u8bf7\u5728\u547d\u4ee4\u884c\u4e0a\u4f7f\u7528 --sql-mode =\"\u201c\u201d\" \u5c06\u5176\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u6216\u5728\u9009\u9879\u6587\u4ef6\u4e2d\u4f7f\u7528 sql-mode =\"\" \u5c06\u5176\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002 \u5728\u8fd0\u884c\u65f6\u6539\u53d8\u8bbe\u7f6e\u4f7f\u7528\uff1a -- \u8bbe\u7f6e\u5168\u5c40\u7684mode\uff0c\u5728\u65b0\u8fde\u63a5\u4e2d\u751f\u6548\uff0c\u672c\u6b21\u4e0d\u751f\u6548 SET GLOBAL sql_mode = 'modes' ; -- \u8bbe\u7f6e\u5f53\u524d\u8fde\u63a5\u7684mode SET SESSION sql_mode = 'modes' ; \u6ce8\u610f\uff1a \u5f3a\u70c8\u5efa\u8bae\u5728\u521b\u5efa\u4f7f\u7528\u7528\u6237\u5b9a\u4e49\u5206\u533a\u7684\u8868\u540e\u6c38\u8fdc\u4e0d\u8981\u66f4\u6539SQL\u6a21\u5f0f\u3002 \u5728\u4e3b\u4ece\u6a21\u5f0f\u4e2d\u4f7f\u7528\u540c\u4e00\u79cdmode\u3002 2. \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e \u00b6 SELECT @@ GLOBAL . sql_mode ; SELECT @@ SESSION . sql_mode ; 3. SQL Mode \u7684\u5e38\u89c1\u529f\u80fd \u00b6 \u6548\u9a8c\u65e5\u671f\u6570\u636e\u5408\u6cd5\u6027 \u5728 INSERT \u6216 UPDATE \u8fc7\u7a0b\u4e2d\uff0c \u5982\u679c SQL MODE \u5904\u4e8e \u4e25\u683c\u6a21\u5f0f\uff0c \u8fd0\u884c MOD(X\uff0c0)\u4f1a\u4ea7\u751f\u9519\u8bef\u3002\u5728\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b MOD(X\uff0c0)\u8fd4\u56de\u7684\u7ed3\u679c\u662f NULL\uff0c\u6240\u4ee5\u5728\u542b\u6709 MOD \u7684\u8fd0\u7b97\u4e2d\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8bbe\u5b9a\u597d sql_mode\u3002 \u542f\u7528 NO_BACKSLASH_ESCAPES \u6a21\u5f0f\uff0c\u4f7f\u53cd\u659c\u7ebf\u6210\u4e3a\u666e\u901a\u5b57\u7b26\u3002\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\u3002 \u542f\u7528 PIPES_AS_CONCAT \u6a21\u5f0f\uff0c\u5c06 || \u89c6\u4e3a\u5b57\u7b26\u4e32\u8fde\u63a5\u64cd\u4f5c\u7b26\uff0c\u5728 Oracle \u7b49\u6570\u636e\u5e93\u4e2d\uff0c || \u88ab\u89c6\u4e3a\u5b57\u7b26\u4e32\u7684\u8fde\u63a5\u64cd\u4f5c\u7b26\u3002 4. \u5e38\u7528\u7684 SQL Mode \u00b6 SQL Mode \u8bf4\u660e ANSI \u7b49\u540c\u4e8e REAL_AS_FLOAT , PIPES_AS_CONCAT , ANSI_QUOTES , IGNORE_SPACE \u7ec4\u5408\u6a21\u5f0f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4f7f\u8bed\u6cd5\u548c\u884c\u4e3a\u66f4\u7b26\u5408\u6807\u51c6\u7684 SQL STRICT_TRANS_TABLES \u9002\u7528\u4e8e\u4e8b\u52a1\u8868\u548c\u975e\u4e8b\u52a1\u8868\uff0c\u5b83\u662f\u4e25\u683c\u6a21\u5f0f\uff0c\u4e0d\u5141\u8bb8\u975e\u6cd5\u65e5\u671f\uff0c\u4e5f\u4e0d\u5141\u8bb8\u8d85\u8fc7\u5b57\u6bb5\u957f\u5ea6\u7684\u503c\u63d2\u5165\u5b57\u6bb5\u4e2d\uff0c\u5bf9\u4e8e\u63d2\u5165\u4e0d\u6b63\u786e\u7684\u503c\u7ed9\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8b66\u544a TRADITIONAL \u7b49\u540c\u4e8e STRICT_TRANS_TABLES , STRICT_ALL_TABLES , NO_ZERO_IN_DATE , NO_ZERO_DATE , ERROR_FOR_DIVISION_BY_ZERO , NO_AUTO_CREATE_USER , NO_ENGINE_SUBSTITUTION \u7ec4\u5408\u6a21\u5f0f\uff0c \u6240\u4ee5\u5b83\u4e5f\u662f\u4e25\u683c\u6a21\u5f0f\uff0c \u5bf9\u4e8e\u63d2\u5165\u4e0d\u6b63\u786e\u7684\u503c\u662f\u7ed9\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8b66\u544a\u3002 \u53ef\u4ee5\u5e94\u7528\u5728\u4e8b\u52a1\u8868\u548c\u975e\u4e8b\u52a1\u8868\uff0c \u7528\u5728\u4e8b\u52a1\u8868\u65f6\uff0c \u53ea\u8981\u51fa\u73b0\u9519\u8bef\u5c31\u4f1a\u7acb\u5373\u56de\u6eda 5. SQL Mode \u5728\u8fc1\u79fb\u4e2d\u7684\u4f7f\u7528 \u00b6 MySQL \u63d0\u4f9b\u4e86\u5f88\u591a\u6570\u636e\u5e93\u7684\u7ec4\u5408\u6a21\u5f0f\u540d\u79f0\uff0c \u4f8b\u5982 \u201cORACLE\u201d \u3001 \u201cDB2\u201d \u7b49\uff0c\u5728\u5f02\u6784\u6570\u636e\u5e93\u4e4b\u95f4\u8fc1\u79fb\u6570\u636e\u65f6\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u8fd9\u4e9b\u6a21\u5f0f\u6765\u5bfc\u51fa\u9002\u5408\u4e8e\u76ee\u6807\u6570\u636e\u5e93\u683c\u5f0f\u7684\u6570\u636e\u3002 \u5728\u6570\u636e\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c \u53ef\u4ee5\u8bbe\u7f6e SQL Mode \u4e3a NO_TABLE_OPTIONS \u6a21\u5f0f\uff0c \u8fd9\u6837\u5c06\u53bb\u6389\u5efa\u8868\u65f6\u7684\u9009\u9879\uff08engine\u3001default charset\u7b49\uff09\uff0c\u83b7\u5f97\u901a\u7528\u7684\u5efa\u8868\u811a\u672c\u3002","title":"21. SQL Mode"},{"location":"mysql/21. SQL Mode/#1-mode","text":"\u9ed8\u8ba4\u7684SQL mode\u662f\u6ca1\u6709\u8bbe\u7f6e\u7684\u3002 \u5728\u670d\u52a1\u5668\u542f\u52a8\u7684\u65f6\u5019\u8bbe\u7f6e\uff1a \u5728\u547d\u4ee4\u884c\u4f7f\u7528 --sql-mode=\"mode\" \u9009\u9879 \u5728 my.cnf \uff08Unix\uff09\u6216 my.ini \uff08Windows\uff09\u4e2d\u8bbe\u7f6e sql-mode=\"mode\" \u8981\u663e\u5f0f\u6e05\u9664SQL\u6a21\u5f0f\uff0c\u8bf7\u5728\u547d\u4ee4\u884c\u4e0a\u4f7f\u7528 --sql-mode =\"\u201c\u201d\" \u5c06\u5176\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u6216\u5728\u9009\u9879\u6587\u4ef6\u4e2d\u4f7f\u7528 sql-mode =\"\" \u5c06\u5176\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002 \u5728\u8fd0\u884c\u65f6\u6539\u53d8\u8bbe\u7f6e\u4f7f\u7528\uff1a -- \u8bbe\u7f6e\u5168\u5c40\u7684mode\uff0c\u5728\u65b0\u8fde\u63a5\u4e2d\u751f\u6548\uff0c\u672c\u6b21\u4e0d\u751f\u6548 SET GLOBAL sql_mode = 'modes' ; -- \u8bbe\u7f6e\u5f53\u524d\u8fde\u63a5\u7684mode SET SESSION sql_mode = 'modes' ; \u6ce8\u610f\uff1a \u5f3a\u70c8\u5efa\u8bae\u5728\u521b\u5efa\u4f7f\u7528\u7528\u6237\u5b9a\u4e49\u5206\u533a\u7684\u8868\u540e\u6c38\u8fdc\u4e0d\u8981\u66f4\u6539SQL\u6a21\u5f0f\u3002 \u5728\u4e3b\u4ece\u6a21\u5f0f\u4e2d\u4f7f\u7528\u540c\u4e00\u79cdmode\u3002","title":"1. \u8bbe\u7f6emode"},{"location":"mysql/21. SQL Mode/#2","text":"SELECT @@ GLOBAL . sql_mode ; SELECT @@ SESSION . sql_mode ;","title":"2. \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e"},{"location":"mysql/21. SQL Mode/#3-sql-mode","text":"\u6548\u9a8c\u65e5\u671f\u6570\u636e\u5408\u6cd5\u6027 \u5728 INSERT \u6216 UPDATE \u8fc7\u7a0b\u4e2d\uff0c \u5982\u679c SQL MODE \u5904\u4e8e \u4e25\u683c\u6a21\u5f0f\uff0c \u8fd0\u884c MOD(X\uff0c0)\u4f1a\u4ea7\u751f\u9519\u8bef\u3002\u5728\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b MOD(X\uff0c0)\u8fd4\u56de\u7684\u7ed3\u679c\u662f NULL\uff0c\u6240\u4ee5\u5728\u542b\u6709 MOD \u7684\u8fd0\u7b97\u4e2d\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8bbe\u5b9a\u597d sql_mode\u3002 \u542f\u7528 NO_BACKSLASH_ESCAPES \u6a21\u5f0f\uff0c\u4f7f\u53cd\u659c\u7ebf\u6210\u4e3a\u666e\u901a\u5b57\u7b26\u3002\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u6b63\u786e\u6027\u3002 \u542f\u7528 PIPES_AS_CONCAT \u6a21\u5f0f\uff0c\u5c06 || \u89c6\u4e3a\u5b57\u7b26\u4e32\u8fde\u63a5\u64cd\u4f5c\u7b26\uff0c\u5728 Oracle \u7b49\u6570\u636e\u5e93\u4e2d\uff0c || \u88ab\u89c6\u4e3a\u5b57\u7b26\u4e32\u7684\u8fde\u63a5\u64cd\u4f5c\u7b26\u3002","title":"3.  SQL Mode \u7684\u5e38\u89c1\u529f\u80fd"},{"location":"mysql/21. SQL Mode/#4-sql-mode","text":"SQL Mode \u8bf4\u660e ANSI \u7b49\u540c\u4e8e REAL_AS_FLOAT , PIPES_AS_CONCAT , ANSI_QUOTES , IGNORE_SPACE \u7ec4\u5408\u6a21\u5f0f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4f7f\u8bed\u6cd5\u548c\u884c\u4e3a\u66f4\u7b26\u5408\u6807\u51c6\u7684 SQL STRICT_TRANS_TABLES \u9002\u7528\u4e8e\u4e8b\u52a1\u8868\u548c\u975e\u4e8b\u52a1\u8868\uff0c\u5b83\u662f\u4e25\u683c\u6a21\u5f0f\uff0c\u4e0d\u5141\u8bb8\u975e\u6cd5\u65e5\u671f\uff0c\u4e5f\u4e0d\u5141\u8bb8\u8d85\u8fc7\u5b57\u6bb5\u957f\u5ea6\u7684\u503c\u63d2\u5165\u5b57\u6bb5\u4e2d\uff0c\u5bf9\u4e8e\u63d2\u5165\u4e0d\u6b63\u786e\u7684\u503c\u7ed9\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8b66\u544a TRADITIONAL \u7b49\u540c\u4e8e STRICT_TRANS_TABLES , STRICT_ALL_TABLES , NO_ZERO_IN_DATE , NO_ZERO_DATE , ERROR_FOR_DIVISION_BY_ZERO , NO_AUTO_CREATE_USER , NO_ENGINE_SUBSTITUTION \u7ec4\u5408\u6a21\u5f0f\uff0c \u6240\u4ee5\u5b83\u4e5f\u662f\u4e25\u683c\u6a21\u5f0f\uff0c \u5bf9\u4e8e\u63d2\u5165\u4e0d\u6b63\u786e\u7684\u503c\u662f\u7ed9\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8b66\u544a\u3002 \u53ef\u4ee5\u5e94\u7528\u5728\u4e8b\u52a1\u8868\u548c\u975e\u4e8b\u52a1\u8868\uff0c \u7528\u5728\u4e8b\u52a1\u8868\u65f6\uff0c \u53ea\u8981\u51fa\u73b0\u9519\u8bef\u5c31\u4f1a\u7acb\u5373\u56de\u6eda","title":"4. \u5e38\u7528\u7684 SQL Mode"},{"location":"mysql/21. SQL Mode/#5-sql-mode","text":"MySQL \u63d0\u4f9b\u4e86\u5f88\u591a\u6570\u636e\u5e93\u7684\u7ec4\u5408\u6a21\u5f0f\u540d\u79f0\uff0c \u4f8b\u5982 \u201cORACLE\u201d \u3001 \u201cDB2\u201d \u7b49\uff0c\u5728\u5f02\u6784\u6570\u636e\u5e93\u4e4b\u95f4\u8fc1\u79fb\u6570\u636e\u65f6\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u8fd9\u4e9b\u6a21\u5f0f\u6765\u5bfc\u51fa\u9002\u5408\u4e8e\u76ee\u6807\u6570\u636e\u5e93\u683c\u5f0f\u7684\u6570\u636e\u3002 \u5728\u6570\u636e\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c \u53ef\u4ee5\u8bbe\u7f6e SQL Mode \u4e3a NO_TABLE_OPTIONS \u6a21\u5f0f\uff0c \u8fd9\u6837\u5c06\u53bb\u6389\u5efa\u8868\u65f6\u7684\u9009\u9879\uff08engine\u3001default charset\u7b49\uff09\uff0c\u83b7\u5f97\u901a\u7528\u7684\u5efa\u8868\u811a\u672c\u3002","title":"5. SQL Mode \u5728\u8fc1\u79fb\u4e2d\u7684\u4f7f\u7528"},{"location":"mysql/22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898/","text":"1. \u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4f7f\u7528 2. \u7528 RAND()\u63d0\u53d6\u968f\u673a\u884c 3. \u5927\u5c0f\u5199\u654f\u611f\u6027 4. \u5916\u952e 1. \u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4f7f\u7528 \u00b6 expr REGEXP pat , expr RLIKE pat expr NOT REGEXP pat , expr NOT RLIKE pat \u7528\u4e8e\u5339\u914d\u5355\u4e2a\u5b57\u7b26\u4e32\u3002 REGEXP \u5728\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u65f6\u662f \u4e0d\u533a\u5206\u5927\u5c0f \u5199\u7684\uff0c\u9664\u975e\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u8fdb\u884c\u6bd4\u8f83\u3002 mysql > SELECT 'a' REGEXP 'A' , 'a' REGEXP BINARY 'A' ; -> 1 0 MySQL \u4f7f\u7528C\u8bed\u8a00\u7684\u8f6c\u4e49\u8bed\u6cd5\u3002 \u6b63\u5219\u8868\u8fbe\u5f0f \u8bf4\u660e [\u2026] \u5339\u914d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26\u3002\u5b57\u7b26\u4e32expr\u5c1d\u8bd5\u5339\u914dpat\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5b57\u7b26\u80fd\u5339\u914d\u4e0a\uff0c\u5219\u8fd4\u56de 1\u3002 [^\u2026] \u5339\u914d\u4e0d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26\u3002\u4e0b\u4f8b\u4e2d\u5b57\u7b26\u4e32expr\u4e2d\u5982\u679c\u6709\u4efb\u4f55\u4e00\u4e2a\u5b57\u7b26\u5339\u914d\u4e0d\u4e0apat\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5219\u8fd4\u56de 0\uff1b\u5982\u679c\u5168\u90e8\u90fd\u80fd\u5339\u914d\u4e0a\uff0c\u5219\u8fd4\u56de 1\u3002 a(m) \u5339\u914d m \u4e2a a a(m,) \u5339\u914d m \u4e2a\u6216\u66f4\u591a\u4e2a a a(m,n) \u5339\u914d m \u5230 n \u4e2a a a(,n) \u5339\u914d 0 \u5230 n \u4e2a a MariaDB [ MYISAM_TEST ] > select 'efg' REGEXP \"[^XYZ]\" , 'X' REGEXP \"[^XYZ]\" ; +-----------------------+---------------------+ | 'efg' REGEXP \"[^XYZ]\" | 'X' REGEXP \"[^XYZ]\" | +-----------------------+---------------------+ | 1 | 0 | +-----------------------+---------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > select 'efg' REGEXP \"[XYZ]\" , 'X' REGEXP \"[XYZ]\" ; +----------------------+--------------------+ | 'efg' REGEXP \"[XYZ]\" | 'X' REGEXP \"[XYZ]\" | +----------------------+--------------------+ | 0 | 1 | +----------------------+--------------------+ 1 row in set ( 0 . 00 sec ) 2. \u7528 RAND()\u63d0\u53d6\u968f\u673a\u884c \u00b6 \u7528\u6765\u4ece\u6570\u636e\u8868\u4e2d\u968f\u673a\u62bd\u53d6\u8bb0\u5f55\u3002 \u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u51fd\u6570\u4e0eORDER BY\u5b50\u53e5\u4e00\u8d77\u5b8c\u6210\u968f\u673a\u62bd\u53d6\u67d0\u4e9b\u884c\u7684\u529f\u80fd\u3002\u5b83\u7684\u539f\u7406\u5176\u5b9e\u5c31\u662fORDER BY RAND()\u80fd\u591f\u628a\u6570\u636e\u968f\u673a\u6392\u5e8f\u3002 -- \u5bf9\u6240\u6709\u7684\u6570\u636e\u968f\u673a\u6392\u5e8f SELECT * FROM CHILD ORDER BY RAND (); -- \u968f\u673a\u62bd\u53d6\u4e00\u90e8\u5206\u6570\u636e SELECT * FROM CHILD ORDER BY RAND () LIMIT 2 ; 3. \u5927\u5c0f\u5199\u654f\u611f\u6027 \u00b6 \u6240\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5927\u5c0f\u5199\u654f\u611f\u6027\u51b3\u5b9a\u4e86\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u7684\u5927\u5c0f\u5199\u654f\u611f\u6027\u3002\u5927\u90e8\u5206Unix\u533a\u5206\u5927\u5c0f\u5199\uff0cwindows\u7cfb\u7edf\u4e0d\u533a\u5206\u3002 \u5217\u3001\u7d22\u5f15\u3001\u5b58\u50a8\u5b50\u7a0b\u5e8f\u548c\u89e6\u53d1\u5668\u540d\u5728\u4efb\u4f55\u5e73\u53f0\u4e0a\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8868\u522b\u540d\u5728UNIX \u4e2d\u5bf9\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4f46\u5728 Windows \u6216 Mac OS X \u4e2d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8868\u522b\u540d\u5728UNIX \u4e2d\u5bf9\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4f46\u5728 Windows \u6216 Mac OS X \u4e2d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u5728 MySQL \u4e2d\u5982\u4f55\u5728\u786c\u76d8\u4e0a\u4fdd\u5b58\u3001\u4f7f\u7528\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u7531 lower_case_tables_name \u7cfb\u7edf\u53d8\u91cf\u51b3\u5b9a\uff0c \u53ef\u4ee5\u5728\u542f\u52a8 mysqld \u65f6\u8bbe\u7f6e\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\u3002 \u503c \u8bf4\u660e 0 \u4f7f\u7528 CREATE TABLE \u6216 CREATE DATABASE \u8bed\u53e5\u6307\u5b9a\u7684\u5927\u5199\u548c\u5c0f\u5199\u5728\u786c\u76d8\u4e0a\u4fdd\u5b58\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u3002\u540d\u79f0\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002\u5728 UNIX \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u5c31\u662f\u8fd9\u4e2a\u503c 1 \u8868\u540d\u5728\u786c\u76d8\u4e0a\u4ee5\u5c0f\u5199\u4fdd\u5b58\uff0c\u540d\u79f0\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002MySQL \u5c06\u6240\u6709\u8868\u540d\u8f6c\u6362\u4e3a\u5c0f\u5199\u4ee5\u4fbf\u5b58\u50a8\u548c\u67e5\u627e\u3002\u8be5\u503c\u4e3a Windows \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u503c 2 \u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u5728\u786c\u76d8\u4e0a\u4f7f\u7528 CREATE TABLE \u6216 CREATE DATABASE \u8bed\u53e5\u6307\u5b9a\u7684\u5927\u5c0f\u5199\u8fdb\u884c\u4fdd\u5b58\uff0c\u4f46MySQL \u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a\u5c0f\u5199\u4ee5\u4fbf\u67e5\u627e\u3002InnoDB\u7684\u8868\u540d\u4ee5\u5c0f\u5199\u4fdd\u5b58\u3002\u6b64\u503c\u53ea\u5728\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u9002\u7528\u3002Mac OS X \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u503c \u6ce8\u610f\uff1a \u5728 UNIX \u4e2d\u5c06 lower_case_tables_name \u8bbe\u7f6e\u4e3a 1 \u5e76\u4e14\u91cd\u542f mysqld \u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u5c06\u65e7\u7684\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u8f6c\u6362\u4e3a\u5c0f\u5199\u3002 \u5c3d\u7ba1\u5728\u67d0\u4e9b\u5e73\u53f0\u4e2d\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff0c\u4f46\u662f\u6700\u597d\u517b\u6210\u5728\u540c\u4e00\u67e5\u8be2\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u5927\u5c0f\u5199\u6765\u5f15\u7528\u7ed9\u5b9a\u7684\u6570\u636e\u5e93\u540d\u6216\u8868\u540d\u7684\u4e60\u60ef\u3002 4. \u5916\u952e \u00b6 MySQL \u7684\u5916\u952e\u529f\u80fd\u4ec5\u5bf9 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u6709\u4f5c\u7528\uff0c\u5176\u4ed6\u7c7b\u578b\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u867d\u7136\u53ef\u4ee5\u5efa\u7acb\u5916\u952e\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u8d77\u5230\u5916\u952e\u7684\u4f5c\u7528\uff0c \u53ea\u4f5c\u4e3a\u5907\u5fd8\u5f55\u6216\u6ce8\u91ca\u6765\u63d0\u9192\u7528\u6237\u76ee\u524d\u6b63\u5b9a\u4e49\u7684\u5217\u6307\u5411\u53e6\u4e00\u4e2a\u8868\u4e2d\u7684\u4e00\u4e2a\u5217\u3002","title":"22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898"},{"location":"mysql/22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898/#1","text":"expr REGEXP pat , expr RLIKE pat expr NOT REGEXP pat , expr NOT RLIKE pat \u7528\u4e8e\u5339\u914d\u5355\u4e2a\u5b57\u7b26\u4e32\u3002 REGEXP \u5728\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u65f6\u662f \u4e0d\u533a\u5206\u5927\u5c0f \u5199\u7684\uff0c\u9664\u975e\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u8fdb\u884c\u6bd4\u8f83\u3002 mysql > SELECT 'a' REGEXP 'A' , 'a' REGEXP BINARY 'A' ; -> 1 0 MySQL \u4f7f\u7528C\u8bed\u8a00\u7684\u8f6c\u4e49\u8bed\u6cd5\u3002 \u6b63\u5219\u8868\u8fbe\u5f0f \u8bf4\u660e [\u2026] \u5339\u914d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26\u3002\u5b57\u7b26\u4e32expr\u5c1d\u8bd5\u5339\u914dpat\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5b57\u7b26\u80fd\u5339\u914d\u4e0a\uff0c\u5219\u8fd4\u56de 1\u3002 [^\u2026] \u5339\u914d\u4e0d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26\u3002\u4e0b\u4f8b\u4e2d\u5b57\u7b26\u4e32expr\u4e2d\u5982\u679c\u6709\u4efb\u4f55\u4e00\u4e2a\u5b57\u7b26\u5339\u914d\u4e0d\u4e0apat\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\uff0c\u5219\u8fd4\u56de 0\uff1b\u5982\u679c\u5168\u90e8\u90fd\u80fd\u5339\u914d\u4e0a\uff0c\u5219\u8fd4\u56de 1\u3002 a(m) \u5339\u914d m \u4e2a a a(m,) \u5339\u914d m \u4e2a\u6216\u66f4\u591a\u4e2a a a(m,n) \u5339\u914d m \u5230 n \u4e2a a a(,n) \u5339\u914d 0 \u5230 n \u4e2a a MariaDB [ MYISAM_TEST ] > select 'efg' REGEXP \"[^XYZ]\" , 'X' REGEXP \"[^XYZ]\" ; +-----------------------+---------------------+ | 'efg' REGEXP \"[^XYZ]\" | 'X' REGEXP \"[^XYZ]\" | +-----------------------+---------------------+ | 1 | 0 | +-----------------------+---------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > select 'efg' REGEXP \"[XYZ]\" , 'X' REGEXP \"[XYZ]\" ; +----------------------+--------------------+ | 'efg' REGEXP \"[XYZ]\" | 'X' REGEXP \"[XYZ]\" | +----------------------+--------------------+ | 0 | 1 | +----------------------+--------------------+ 1 row in set ( 0 . 00 sec )","title":"1. \u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4f7f\u7528"},{"location":"mysql/22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898/#2-rand","text":"\u7528\u6765\u4ece\u6570\u636e\u8868\u4e2d\u968f\u673a\u62bd\u53d6\u8bb0\u5f55\u3002 \u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u51fd\u6570\u4e0eORDER BY\u5b50\u53e5\u4e00\u8d77\u5b8c\u6210\u968f\u673a\u62bd\u53d6\u67d0\u4e9b\u884c\u7684\u529f\u80fd\u3002\u5b83\u7684\u539f\u7406\u5176\u5b9e\u5c31\u662fORDER BY RAND()\u80fd\u591f\u628a\u6570\u636e\u968f\u673a\u6392\u5e8f\u3002 -- \u5bf9\u6240\u6709\u7684\u6570\u636e\u968f\u673a\u6392\u5e8f SELECT * FROM CHILD ORDER BY RAND (); -- \u968f\u673a\u62bd\u53d6\u4e00\u90e8\u5206\u6570\u636e SELECT * FROM CHILD ORDER BY RAND () LIMIT 2 ;","title":"2. \u7528 RAND()\u63d0\u53d6\u968f\u673a\u884c"},{"location":"mysql/22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898/#3","text":"\u6240\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5927\u5c0f\u5199\u654f\u611f\u6027\u51b3\u5b9a\u4e86\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u7684\u5927\u5c0f\u5199\u654f\u611f\u6027\u3002\u5927\u90e8\u5206Unix\u533a\u5206\u5927\u5c0f\u5199\uff0cwindows\u7cfb\u7edf\u4e0d\u533a\u5206\u3002 \u5217\u3001\u7d22\u5f15\u3001\u5b58\u50a8\u5b50\u7a0b\u5e8f\u548c\u89e6\u53d1\u5668\u540d\u5728\u4efb\u4f55\u5e73\u53f0\u4e0a\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8868\u522b\u540d\u5728UNIX \u4e2d\u5bf9\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4f46\u5728 Windows \u6216 Mac OS X \u4e2d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8868\u522b\u540d\u5728UNIX \u4e2d\u5bf9\u5927\u5c0f\u5199\u654f\u611f\uff0c\u4f46\u5728 Windows \u6216 Mac OS X \u4e2d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u3002 \u5728 MySQL \u4e2d\u5982\u4f55\u5728\u786c\u76d8\u4e0a\u4fdd\u5b58\u3001\u4f7f\u7528\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u7531 lower_case_tables_name \u7cfb\u7edf\u53d8\u91cf\u51b3\u5b9a\uff0c \u53ef\u4ee5\u5728\u542f\u52a8 mysqld \u65f6\u8bbe\u7f6e\u8fd9\u4e2a\u7cfb\u7edf\u53d8\u91cf\u3002 \u503c \u8bf4\u660e 0 \u4f7f\u7528 CREATE TABLE \u6216 CREATE DATABASE \u8bed\u53e5\u6307\u5b9a\u7684\u5927\u5199\u548c\u5c0f\u5199\u5728\u786c\u76d8\u4e0a\u4fdd\u5b58\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u3002\u540d\u79f0\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002\u5728 UNIX \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u5c31\u662f\u8fd9\u4e2a\u503c 1 \u8868\u540d\u5728\u786c\u76d8\u4e0a\u4ee5\u5c0f\u5199\u4fdd\u5b58\uff0c\u540d\u79f0\u5bf9\u5927\u5c0f\u5199\u654f\u611f\u3002MySQL \u5c06\u6240\u6709\u8868\u540d\u8f6c\u6362\u4e3a\u5c0f\u5199\u4ee5\u4fbf\u5b58\u50a8\u548c\u67e5\u627e\u3002\u8be5\u503c\u4e3a Windows \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u503c 2 \u8868\u540d\u548c\u6570\u636e\u5e93\u540d\u5728\u786c\u76d8\u4e0a\u4f7f\u7528 CREATE TABLE \u6216 CREATE DATABASE \u8bed\u53e5\u6307\u5b9a\u7684\u5927\u5c0f\u5199\u8fdb\u884c\u4fdd\u5b58\uff0c\u4f46MySQL \u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a\u5c0f\u5199\u4ee5\u4fbf\u67e5\u627e\u3002InnoDB\u7684\u8868\u540d\u4ee5\u5c0f\u5199\u4fdd\u5b58\u3002\u6b64\u503c\u53ea\u5728\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u9002\u7528\u3002Mac OS X \u7cfb\u7edf\u4e2d\u7684\u9ed8\u8ba4\u503c \u6ce8\u610f\uff1a \u5728 UNIX \u4e2d\u5c06 lower_case_tables_name \u8bbe\u7f6e\u4e3a 1 \u5e76\u4e14\u91cd\u542f mysqld \u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u5c06\u65e7\u7684\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u8f6c\u6362\u4e3a\u5c0f\u5199\u3002 \u5c3d\u7ba1\u5728\u67d0\u4e9b\u5e73\u53f0\u4e2d\u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff0c\u4f46\u662f\u6700\u597d\u517b\u6210\u5728\u540c\u4e00\u67e5\u8be2\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u5927\u5c0f\u5199\u6765\u5f15\u7528\u7ed9\u5b9a\u7684\u6570\u636e\u5e93\u540d\u6216\u8868\u540d\u7684\u4e60\u60ef\u3002","title":"3. \u5927\u5c0f\u5199\u654f\u611f\u6027"},{"location":"mysql/22. \u5e38\u7528 SQL \u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898/#4","text":"MySQL \u7684\u5916\u952e\u529f\u80fd\u4ec5\u5bf9 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u6709\u4f5c\u7528\uff0c\u5176\u4ed6\u7c7b\u578b\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u867d\u7136\u53ef\u4ee5\u5efa\u7acb\u5916\u952e\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u8d77\u5230\u5916\u952e\u7684\u4f5c\u7528\uff0c \u53ea\u4f5c\u4e3a\u5907\u5fd8\u5f55\u6216\u6ce8\u91ca\u6765\u63d0\u9192\u7528\u6237\u76ee\u524d\u6b63\u5b9a\u4e49\u7684\u5217\u6307\u5411\u53e6\u4e00\u4e2a\u8868\u4e2d\u7684\u4e00\u4e2a\u5217\u3002","title":"4. \u5916\u952e"},{"location":"mysql/23. MySQL\u5206\u533a/","text":"1. \u6982\u5ff5 2. \u5206\u533a\u8868\u7684\u521b\u5efa 3. \u67e5\u770b\u5206\u533a 4. \u5220\u9664\u5206\u533a 5. \u5206\u533a\u7c7b\u578b 5.1 RANGE \u5206\u533a 5.2 LIST \u5206\u533a 5.3 COLUMNS \u5206\u533a 5.3.1 RANGE COLUMNS \u5206\u533a 5.3.1.1 RANGE COLUMNS \u5212\u5206\u57fa\u4e8e\u5143\u7ec4\u4e4b\u95f4\u7684\u6bd4\u8f83\u7684\u89e3\u91ca 5.3.2 LIST COLUMNS \u5206\u533a 5.4 HASH \u5206\u533a 5.4.1 LINEAR HASH \u5206\u533a 5.5 KEY \u5206\u533a 5.5.1 LINEAR KEY \u5206\u533a 5.6 \u5b50\u5206\u533a 5.7 MySQL\u5206\u533a\u5982\u4f55\u5904\u7406NULL 5.7.1 RANGE partitioning 5.7.2 LIST partitioning 5.7.3 HASH and KEY partitioning 6. \u5206\u533a\u7ba1\u7406 6.1 RANGE and LIST \u7684\u7ba1\u7406 6.1.1 \u5220\u9664 6.1.2 \u6dfb\u52a0 6.1.3 \u91cd\u7ec4 6.2 HASH and KEY \u7684\u7ba1\u7406 6.2.1 \u5220\u9664 6.2.2 \u6dfb\u52a0 6.2.3 \u91cd\u7ec4 6.3 \u5206\u533a\u7684\u7ef4\u62a4 \u901a\u8fc7\u67e5\u770b\u63d2\u4ef6\u68c0\u67e5\u662f\u5f53\u524dMySQL\u7248\u672c\u5426\u652f\u6301\u5206\u533a\uff1a SHOW PLUGINS ; \u82e5\u5b58\u5728 partition \u8bb0\u5f55\u5e76\u4e14\u662f ACTIVE \u72b6\u6001\u5219\u8868\u793a\u652f\u6301\u3002 \u5f53\u521b\u5efa\u5206\u533a\u8868\u5e76\u4f7f\u7528InnoDB\u5f15\u64ce\u65f6 DATA DIRECTORY \u3001 INDEX DIRECTORY \u9009\u9879\u65e0\u6548\u3002 1. \u6982\u5ff5 \u00b6 \u200b \u5206\u533a\u5c06\u4e00\u5f20\u8868\u5206\u4e3a\u51e0\u4e2a\u5206\u533a\u8fdb\u884c\u5b58\u50a8\uff0c\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u5f20\u8868\u3002\u5206\u533a\u952e\u7528\u4e8e\u6839\u636e\u67d0\u4e2a\u533a\u95f4\u503c\u3001\u7279\u5b9a\u503c\u5217\u8868\u6216hash\u51fd\u6570\u503c\u6267\u884c\u6570\u636e\u7684\u805a\u96c6\uff0c\u8ba9\u6570\u636e\u66f4\u5177\u5206\u5e03\u89c4\u5219\u5206\u5e03\u5728\u4e0d\u540c\u7684\u5206\u533a\u4e2d\uff0c\u8ba9\u4e00\u4e2a\u5927\u5bf9\u8c61\u53d8\u6210\u4e00\u4e9b\u5c0f\u5bf9\u8c61\u3002 \u5206\u533a\u7684\u4f18\u70b9\uff1a \u53ef\u4ee5\u5728\u4e00\u4e2a\u8868\u4e2d\u5b58\u50a8\u6bd4\u5728\u5355\u4e2a\u78c1\u76d8\u6216\u6587\u4ef6\u7cfb\u7edf\u5206\u533a\u4e0a\u80fd\u4fdd\u5b58\u7684\u66f4\u591a\u7684\u6570\u636e\u3002 \u53ef\u4ee5\u8f7b\u677e\u7684\u79fb\u9664\u6216\u6dfb\u52a0\u5206\u533a\u8fbe\u5230\u5220\u9664\u6570\u636e\u6216\u65b0\u589e\u5b58\u50a8\u6570\u636e\u7684\u7a7a\u95f4\u3002 \u4e00\u4e9b\u67e5\u8be2\u53ef\u4ee5\u5f97\u5230\u5f88\u597d\u7684\u4f18\u5316\u3002 \u8de8\u591a\u4e2a\u78c1\u76d8\u5206\u6563\u6570\u636e\u67e5\u8be2\uff0c\u83b7\u5f97\u66f4\u5927\u7684\u541e\u5410\u91cf 2. \u5206\u533a\u8868\u7684\u521b\u5efa \u00b6 CREATE [ TEMPORARY ] TABLE [ IF NOT EXISTS ] tbl_name ( create_definition ,...) [ table_options ] [ partition_options ] partition_options : PARTITION BY { [ LINEAR ] HASH ( expr ) | [ LINEAR ] KEY ( column_list ) | RANGE { ( expr ) | COLUMNS ( column_list ) } | LIST { ( expr ) | COLUMNS ( column_list ) } } [ PARTITIONS num ] [ SUBPARTITION BY { [ LINEAR ] HASH ( expr ) | [ LINEAR ] KEY ( column_list ) } [ SUBPARTITIONS num ] ] [( partition_definition [, partition_definition ] ...)] partition_definition : PARTITION partition_name [ VALUES { LESS THAN { ( expr | value_list ) | MAXVALUE } | IN ( value_list ) } ] [[ STORAGE ] ENGINE [ = ] engine_name ] [ COMMENT [ = ] 'comment_text' ] [ DATA DIRECTORY [ = ] 'data_dir' ] [ INDEX DIRECTORY [ = ] 'index_dir' ] [ MAX_ROWS [ = ] max_number_of_rows ] [ MIN_ROWS [ = ] min_number_of_rows ] [ TABLESPACE [ = ] tablespace_name ] [ NODEGROUP [ = ] node_group_id ] [( subpartition_definition [, subpartition_definition ] ...)] subpartition_definition : SUBPARTITION logical_name [[ STORAGE ] ENGINE [ = ] engine_name ] [ COMMENT [ = ] 'comment_text' ] [ DATA DIRECTORY [ = ] 'data_dir' ] [ INDEX DIRECTORY [ = ] 'index_dir' ] [ MAX_ROWS [ = ] max_number_of_rows ] [ MIN_ROWS [ = ] min_number_of_rows ] [ TABLESPACE [ = ] tablespace_name ] [ NODEGROUP [ = ] node_group_id ] \u5206\u533a\u9009\u9879\u4e00\u5b9a\u8981\u653e\u5728\u6700\u540e\u3002 \u6307\u5b9a\u8868\u7684\u5206\u533a\u6570 PARTITIONS num \u65f6\uff0c\u5fc5\u987b\u5c06\u5176\u8868\u793a\u4e3a\u4e0d\u5e26\u524d\u5bfc\u96f6\u7684\u975e\u96f6\u6b63\u6574\u6570\uff0c\u5e76\u4e14\u4e0d\u662f0.8E + 01\u62166-2\u7b49\u8868\u8fbe\u5f0f\uff0c\u5373\u4f7f\u5b83\u7684\u8ba1\u7b97\u7ed3\u679c\u4e3a\u6574\u6570\u503c\u3002\u4e0d\u5141\u8bb8\u4f7f\u7528\u5c0f\u6570\u90e8\u5206\u3002 \u8981\u4e48\u5206\u533a\u8868\u4e0a\u6ca1\u6709\u4e3b\u952e/\u552f\u4e00\u952e\uff0c\u8981\u4e48\u4f7f\u7528\u4e3b\u952e/\u552f\u4e00\u952e\u90fd\u5fc5\u987b\u5305\u542b\u5206\u533a\u952e\u3002 \u5206\u533a\u7684\u540d\u5b57\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002 \u5f53NO_DIR_IN_CREATE\u670d\u52a1\u5668SQL\u6a21\u5f0f\u751f\u6548\u65f6\uff08\u6ca1\u6709\u6307\u5b9a\u8be5\u6a21\u5f0f\u4e5f\u4e0d\u53ef\u4ee5\uff09\uff0c\u5206\u533a\u5b9a\u4e49\u4e2d\u4e0d\u5141\u8bb8\u4f7f\u7528DATA DIRECTORY\u548cINDEX DIRECTORY\u9009\u9879\u3002\u4eceMySQL 5.5.5\u5f00\u59cb\uff0c\u5728\u5b9a\u4e49\u5b50\u5206\u533a\u65f6\u4e5f\u4e0d\u5141\u8bb8\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u3002\u5b9e\u9645\u64cd\u4f5c\u53ef\u77e5\uff1a\u5373\u4f7f\u4f60\u6dfb\u52a0\u4e86\u8fd9\u4e24\u4e2a\u9009\u9879\uff0c\u518d\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e5f\u4f1a\u5ffd\u7565\u5b83\u4eec\u3002 3. \u67e5\u770b\u5206\u533a \u00b6 \u4f7f\u7528 SHOW CREATE TABLE \u67e5\u770b\u5206\u533a\u8868\u7684\u5206\u533a\u5b50\u53e5\u3002 \u4f7f\u7528 SHOW TABLE STATUS \u786e\u8ba4\u662f\u5426\u662f\u5206\u533a\u8868\u3002 \u67e5\u8be2 INFORMATION_SCHEMA.PARTITIONS \u8868\uff1a SELECT * FROM INFORMATION_SCHEMA . PARTITIONS WHERE TABLE_NAME = 'table_name' ; -- \u7b80\u5316\u7248 SELECT PARTITION_NAME , TABLE_ROWS FROM information_schema . PARTITIONS WHERE TABLE_NAME = 'hash_par' ; \u4f7f\u7528 EXPLAIN PARTITIONS select_statement \u67e5\u770b\u4f7f\u7528\u4e86\u54ea\u4e9b\u5206\u533a\uff0c\u548c\u6807\u51c6\u7684 EXPLAIN SELECT \u8bed\u53e5\u7528\u6cd5\u4e00\u6837\uff1a EXPLAIN PARTITIONS select_statement ; EXPLAIN PARTITIONS \u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a \u4e0d\u80fd\u540c\u65f6\u4f7f\u7528PARTITIONS\u548cEXTENDED\u5173\u952e\u5b57\u3002 \u5982\u679c\u7528\u4e8e\u89e3\u91ca\u975e\u5206\u533a\u8868\uff0c partitions \u603b\u662f\u4e3a NULL \u3002 4. \u5220\u9664\u5206\u533a \u00b6 \u548c\u5220\u9664\u8868\u4e00\u6837\uff0c\u4f7f\u7528 TRUNCATE \u6e05\u7a7a\u5206\u533a\uff08\u6bd4 DELETE \u8981\u5feb\uff09\uff0c\u4f7f\u7528 DROP \u5220\u9664\u5206\u533a\uff1a ALTER TABLE table_name TRUNCATE PARTITION partition_name ; ALTER TABLE table_name DROP PARTITION partition_name ; 5. \u5206\u533a\u7c7b\u578b \u00b6 \u901a\u8fc7 KYE \u6216 LINEAR KEY \u5206\u533a\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 DATE,TIME,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u5b57\u6bb5\u3002 \u901a\u8fc7 RANGE COLUMNS \u548c LIST COLUMNS \u5206\u533a\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 DATE,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u5b57\u6bb5\u3002 \u5176\u5b83\u7684\u5206\u533a\u7c7b\u578b\u5728\u8981\u6c42\u4e00\u4e2a\u8fd4\u56de\u6574\u578b\u6570\u503c\u6216NULL\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u3002 5.1 RANGE \u5206\u533a \u00b6 \u6309\u8303\u56f4\u5206\u533a\u7684\u8868\u7684\u5206\u533a\u65b9\u5f0f\u662f\uff1a\u6bcf\u4e2a\u5206\u533a\u5305\u542b\u5206\u533a\u8868\u8fbe\u5f0f\u503c\u4f4d\u4e8e\u7ed9\u5b9a\u8303\u56f4\u5185\u7684\u884c\u3002 \u8303\u56f4\u5e94\u8be5\u662f \u8fde\u7eed\u4f46\u4e0d\u91cd\u53e0\u7684 \uff0c\u5e76\u4e14\u4f7f\u7528 VALUES LESS THAN \u8fd0\u7b97\u7b26\u5b9a\u4e49\u3002 NULL\u4f1a\u88ab\u5f53\u4f5c\u6700\u5c0f\u503c\u6765\u5904\u7406 \u652f\u6301\u4f7f\u7528 DATE,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e \u652f\u6301\u4f7f\u7528 UNIX_TIMESTAMP,YEAR \u7b49\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE `range_test` ( `ID` int ( 11 ) DEFAULT NULL ) ENGINE = InnoDB DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (ID) (PARTITION P0 VALUES LESS THAN (5) ENGINE = InnoDB, PARTITION P1 VALUES LESS THAN (10) ENGINE = InnoDB, -- MAXVALUE\u8868\u793a\u6700\u5927\u7684\u53ef\u80fd\u7684\u6574\u6570\u503c PARTITION P3 VALUES LESS THAN MAXVALUE ENGINE = InnoDB) */ -- /*!...*/ \u662fMySQL\u7684\u6269\u5c55\u7279\u6027\u3002\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6ce8\u91ca\uff0c\u5176\u4ed6\u7684\u6570\u636e\u5e93\u4ea7\u54c1\u5f53\u7136\u4e0d\u4f1a\u6267\u884c\u3002mysql\u7279\u6b8a\u5904\u7406\uff0c\u4f1a\u9009\u62e9\u6027\u7684\u6267\u884c\u3002\u7279\u522b\u6ce8\u610f 50100\uff0c\u5b83\u8868\u793a5.01.00 \u7248\u672c\u6216\u8005\u66f4\u9ad8\u7684\u7248\u672c\uff0c\u624d\u6267\u884c\u3002 -- \u4f7f\u7528DATE\u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e CREATE TABLE members ( username VARCHAR ( 16 ) NOT NULL , email VARCHAR ( 35 ), joined DATE NOT NULL ) PARTITION BY RANGE COLUMNS ( joined ) ( PARTITION p0 VALUES LESS THAN ( '1960-01-01' ), PARTITION p1 VALUES LESS THAN MAXVALUE ); -- \u4f7f\u7528UNIX_TIMESTAMP\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE quarterly_report_status ( report_id INT NOT NULL , report_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ) PARTITION BY RANGE ( UNIX_TIMESTAMP ( report_updated ) ) ( PARTITION p0 VALUES LESS THAN ( UNIX_TIMESTAMP ( '2008-01-01 00:00:00' ) ), PARTITION p1 VALUES LESS THAN ( MAXVALUE ) ); -- \u4f7f\u7528YEAR\u7b49\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE employees ( id INT NOT NULL , separated DATE NOT NULL DEFAULT '9999-12-31' , store_id INT ) PARTITION BY RANGE ( YEAR ( separated ) ) ( PARTITION p0 VALUES LESS THAN ( 1991 ), PARTITION p1 VALUES LESS THAN MAXVALUE ); RANGE \u5206\u533a\u7c7b\u578b\u7279\u522b\u9002\u5408\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a \u9700\u8981\u5220\u9664\u65e7\u6570\u636e\u65f6\u3002\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u901a\u8fc7\u5220\u9664\u5206\u533a\u6765\u5220\u9664\u65e7\u6570\u636e\u3002 ALTER TABLE employees DROP PARTITION p0; \u4f7f\u7528\u5305\u542b\u65e5\u671f\u6216\u65f6\u95f4\u503c\u7684\u5217\uff0c\u6216\u5305\u542b\u6765\u81ea\u5176\u4ed6\u4e00\u4e9b\u7cfb\u5217\u7684\u503c\u3002 \u7ecf\u5e38\u8fd0\u884c\u5305\u542b\u5206\u533a\u952e\u7684\u67e5\u8be2\u3002 5.2 LIST \u5206\u533a \u00b6 LIST \u5206\u533a\u65f6\u5efa\u7acb\u79bb\u6563\u7684\u503c\u5217\u8868\u544a\u8bc9\u6570\u636e\u5e93\u7279\u5b9a\u7684\u503c\u5c5e\u4e8e\u54ea\u4e2a\u5206\u533a\u3002 \u4e0eRANGE\u5206\u533a\u7684\u533a\u522b\uff1a\u662fLIST\u5206\u533a\u4ece\u5c5e\u4e8e\u4e00\u4e2a\u679a\u4e3e\u5217\u8868\u7684\u503c\u7684\u96c6\u5408\uff0cRANGE\u5206\u533a\u662f\u4ece\u5c5e\u4e8e\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\u503c\u7684\u96c6\u5408\u3002 \u4e0eRANGE\u5206\u533a\u4e0d\u540c\uff0c\u6ca1\u6709\u7c7b\u4f3c\u4e8e MAXVALUE \u7684\u503c\u6765\u5339\u914d\u6240\u6709\u7684\u60c5\u51b5\uff1b \u6240\u6709\u88ab\u671f\u671b\u7684\u503c \u90fd\u5e94\u8be5\u88ab\u5305\u542b\u8fdb PARTITION ... VALUES IN (...) \u5b50\u53e5\u3002 \u4f7f\u7528\u5355\u4e2aINSERT\u8bed\u53e5\u63d2\u5165\u591a\u884c\u65f6\uff0c\u884c\u4e3a\u53d6\u51b3\u4e8e\u8868\u662f\u5426\u4f7f\u7528\u4e8b\u52a1\u5b58\u50a8\u5f15\u64ce\uff1a \u5bf9\u4e8e\u652f\u6301\u4e8b\u52a1\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u5f53\u505a\u4e00\u4e2a\u5355\u4e00\u7684\u4e8b\u52a1\u3002 \u5bf9\u4e8e\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5728\u5305\u542b\u672a\u5339\u914d\u503c\u7684\u4e4b\u524d\u7684\u8bb0\u5f55\u4f1a\u88ab\u63d2\u5165\uff0c\u81ea\u5df1\u53ca\u5176\u4e4b\u540e\u7684\u4e0d\u4f1a\u3002 \u53ef\u4ee5\u4f7f\u7528 IGNORE \u5173\u952e\u5b57\u5ffd\u7565\u6b64\u7c7b\u9519\u8bef\uff0c\u5982\u6b64\u4e00\u6765\uff0c\u5305\u542b\u672a\u5339\u914d\u7684\u503c\u7684\u8bb0\u5f55\u4e0d\u4f1a\u63d2\u5165\uff0c\u5176\u4f59\u7684\u90fd\u4f1a\u88ab\u63d2\u5165\u5230\u6570\u636e\u5e93\u5e76\u4e14\u4e0d\u4f1a\u53d1\u51fa\u9519\u8bef\u3002 MariaDB [ MYISAM_TEST ] > CREATE TABLE IF NOT EXISTS list_test ( ID INT ) MAX_ROWS = 8 PARTITION BY LIST ( ID ) ( PARTITION P0 VALUES IN ( 1 , 2 , 3 , 4 , 5 ), PARTITION P1 VALUES IN ( 6 , 7 , 8 ) ); MariaDB [ MYISAM_TEST ] > INSERT INTO list_test VALUES ( 1 ),( 3 ),( 9 ); ERROR 1526 ( HY000 ): Table has no partition for value 9 MariaDB [ MYISAM_TEST ] > INSERT IGNORE INTO list_test VALUES ( 1 ),( 3 ),( 9 ); Query OK , 2 rows affected , 1 warning ( 0 . 00 sec ) Records : 3 Duplicates : 1 Warnings : 1 MariaDB [ MYISAM_TEST ] > SELECT * FROM list_test ; +------+ | ID | +------+ | 1 | | 3 | +------+ 5.3 COLUMNS \u5206\u533a \u00b6 \u5217\u5206\u533a\u662f RANGE \u548c LIST \u5206\u533a\u7684\u53d8\u79cd\u3002COLUMNS\u5206\u533a\u5141\u8bb8\u5728\u5206\u533a\u952e\u4e2d\u4f7f\u7528\u591a\u4e2a\u5217\u3002 RANGE COLUMNS \u5206\u533a\u548c LIST COLUMNS \u5206\u533a\u90fd\u652f\u6301\u975e\u6574\u578b\uff08non-integer\uff09\u5b57\u6bb5\u4f5c\u4e3a\u503c\u7684\u8303\u56f4\u6216\u5217\u7684\u6210\u5458\uff0c\u4ee5\u4e0b\u662f\u8fd0\u884c\u7684\u6570\u636e\u7c7b\u578b\uff1a \u6240\u6709\u7684\u6574\u6570\u7c7b\u578b\uff1aTINYINT, SMALLINT, MEDIUMINT, INT (INTEGER), BIGINT \u90e8\u5206\u65f6\u95f4\u7c7b\u578b\uff1aDATE \u548c DATETIME \u90e8\u5206\u5b57\u7b26\u4e32\u7c7b\u578b\uff1aCHAR, VARCHAR, BINARY, VARBINARY 5.3.1 RANGE COLUMNS \u5206\u533a \u00b6 \u8fd9\u79cd\u5206\u533a\u7c7b\u578b\u53ef\u4ee5\u4f7f\u7528\u6574\u6570\u7c7b\u578b\u4ee5\u5916\u7684\u7c7b\u578b\u5217\u6765\u5b9a\u4e49\u8303\u56f4\u3002 RANGE COLUMNS \u4e0e RANGE \u5206\u533a\u7684\u4e0d\u540c\uff1a RANGE COLUMNS \u4e0d\u63a5\u53d7\u8868\u8fbe\u5f0f\uff0c\u53ea\u63a5\u53d7\u5b57\u6bb5\u540d\u3002 RANGE COLUMNS \u63a5\u53d7\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u7684\u5217\u8868\u3002 RANGE COLUMNS \u5212\u5206\u57fa\u4e8e\u5143\u7ec4\u4e4b\u95f4\u7684\u6bd4\u8f83 RANGE COLUMNS \u4e0d\u53d7\u9650\u4e8e\u6574\u6570\u7c7b\u578b\u3002\u5176\u5b83\u7c7b\u578b\u4e5f\u53ef\u4ee5\u7528\u4f5c\u5206\u533a\u5b57\u6bb5\u3002 CREATE TABLE table_name PARTITIONED BY RANGE COLUMNS ( column_list ) ( PARTITION partition_name VALUES LESS THAN ( value_list )[, PARTITION partition_name VALUES LESS THAN ( value_list )][, ...] ); column_list : column_name [, column_name ][, ...] value_list : value [, value ][, ...] \u521b\u5efa\u4e3e\u4f8b\uff1a mysql > CREATE TABLE rcx ( -> a INT , -> b INT , -> c CHAR ( 3 ), -> d INT -> ) -> PARTITION BY RANGE COLUMNS ( a , d , c ) ( -> PARTITION p0 VALUES LESS THAN ( 5 , 10 , 'ggg' ), -> PARTITION p1 VALUES LESS THAN ( 10 , 20 , 'mmm' ), -> PARTITION p2 VALUES LESS THAN ( 15 , 30 , 'sss' ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) -> ); Query OK , 0 rows affected ( 0 . 15 sec ) \u5206\u533a\u7684\u5b9a\u4e49\u5fc5\u987b\u9075\u4ece\u9012\u589e\u7684\u987a\u5e8f\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff1a -- \u6b63\u786e CREATE TABLE rc4 ( a INT , b INT , c INT ) PARTITION BY RANGE COLUMNS ( a , b , c ) ( PARTITION p0 VALUES LESS THAN ( 0 , 25 , 50 ), PARTITION p1 VALUES LESS THAN ( 10 , 20 , 100 ), PARTITION p2 VALUES LESS THAN ( 10 , 30 , 50 ) PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) ); -- \u9519\u8bef mysql > CREATE TABLE rcf ( -> a INT , -> b INT , -> c INT -> ) -> PARTITION BY RANGE COLUMNS ( a , b , c ) ( -> PARTITION p0 VALUES LESS THAN ( 0 , 25 , 50 ), -> PARTITION p1 VALUES LESS THAN ( 20 , 20 , 100 ), -> PARTITION p2 VALUES LESS THAN ( 10 , 30 , 50 ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) -> ); ERROR 1493 ( HY000 ): VALUES LESS THAN value must be strictly increasing for each partition 5.3.1.1 RANGE COLUMNS \u5212\u5206\u57fa\u4e8e\u5143\u7ec4\u4e4b\u95f4\u7684\u6bd4\u8f83\u7684\u89e3\u91ca \u00b6 \u4e3e\u4f8b\u8bf4\u660e\uff1a -- \u521b\u5efa\u5206\u533a\u8868 MariaDB [ MYISAM_TEST ] > CREATE TABLE rc1 ( -> a INT , -> b INT -> ) -> PARTITION BY RANGE COLUMNS ( a , b ) ( -> PARTITION p0 VALUES LESS THAN ( 5 , 12 ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE ) -> ); -- \u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO rc1 VALUES ( 5 , 2 ), ( 5 , 10 ), ( 5 , 12 ); -- \u67e5\u770b\u6570\u636e\u5206\u5e03 MariaDB [ MYISAM_TEST ] > SELECT PARTITION_NAME , TABLE_ROWS FROM INFORMATION_SCHEMA . PARTITIONS WHERE TABLE_NAME = 'rc1' ; +----------------+------------+ | PARTITION_NAME | TABLE_ROWS | +----------------+------------+ | p0 | 2 | | p3 | 1 | +----------------+------------+ \u591a\u884c\u5206\u533a\u5bf9\u4e8e\u5206\u533a\u952e\u7684\u6bd4\u8f83\u662f\u5bf9\u5143\u7ec4\u8fdb\u884c\u6bd4\u8f83\uff0c\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a mysql > SELECT ( 5 , 10 ) < ( 5 , 12 ), ( 5 , 11 ) < ( 5 , 12 ), ( 5 , 12 ) < ( 5 , 12 ); +-----------------+-----------------+-----------------+ | ( 5 , 10 ) < ( 5 , 12 ) | ( 5 , 11 ) < ( 5 , 12 ) | ( 5 , 12 ) < ( 5 , 12 ) | +-----------------+-----------------+-----------------+ | 1 | 1 | 0 | +-----------------+-----------------+-----------------+ 1 row in set ( 0 . 00 sec ) 5.3.2 LIST COLUMNS \u5206\u533a \u00b6 \u8fd9\u79cd\u5206\u533a\u7c7b\u578b\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e\uff0c\u5e76\u4f7f\u7528\u6574\u6570\u7c7b\u578b\u4ee5\u5916\u7684\u7c7b\u578b\u5217\u6765\u5b9a\u4e49\u8303\u56f4\u3002 \u4e0eRANGE COLUMNS \u7c7b\u4f3c\uff0c\u53c2\u8003\u4e0a\u6587\u8bf4\u660e\u3002 \u591a\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e\u7684\u5199\u6cd5\uff1a CREATE TABLE lc ( a INT NULL , b INT NULL ) PARTITION BY LIST COLUMNS ( a , b ) ( PARTITION p0 VALUES IN ( ( 0 , 0 ), ( NULL , NULL ) ), PARTITION p1 VALUES IN ( ( 0 , 1 ), ( 0 , 2 ), ( 0 , 3 ), ( 1 , 1 ), ( 1 , 2 ) ), PARTITION p2 VALUES IN ( ( 1 , 0 ), ( 2 , 0 ), ( 2 , 1 ), ( 3 , 0 ), ( 3 , 1 ) ), PARTITION p3 VALUES IN ( ( 1 , 3 ), ( 2 , 2 ), ( 2 , 3 ), ( 3 , 2 ), ( 3 , 3 ) ) ); 5.4 HASH \u5206\u533a \u00b6 \u901a\u8fc7 HASH \u8fdb\u884c\u5206\u533a\u4e3b\u8981\u7528\u4e8e\u786e\u4fdd\u5728\u9884\u5b9a\u5206\u533a\u6570\u91cf\u4e4b\u95f4\u5747\u5300\u5730\u5206\u5e03\u6570\u636e\u3002 CREATE TABLE employees ( ... ) PARTITION BY HASH ( expr ) PARTITIONS num ; \u5206\u533a\u952e expr \u662f\u6574\u578b\u7684\u5b57\u6bb5\u6216\u8005\u662f\u8fd4\u56de\u6574\u578b\u7684\u8868\u8fbe\u5f0f\uff0c\u540c\u65f6\u9700\u8981\u6307\u5b9a\u5206\u533a\u6570\u91cf num \u3002 CREATE TABLE employees ( id INT NOT NULL , hired DATE NOT NULL DEFAULT '1970-01-01' , separated DATE NOT NULL DEFAULT '9999-12-31' , ) PARTITION BY HASH ( YEAR ( hired ) ) PARTITIONS 4 ; expr \u5fc5\u987b\u8fd4\u56de\u975e\u5e38\u91cf\u975e\u968f\u673a\u6570\u7684\u6574\u578b\u503c\u3002\u975e\u5e38\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8868\u8fbe\u5f0f\u8d8a\u63a5\u8fd1\u5b83\u6240\u57fa\u4e8e\u7684\u5217\u7684\u503c\uff0cMySQL\u5c31\u8d8a\u6709\u6548\u5730\u4f7f\u7528\u8868\u8fbe\u5f0f\u8fdb\u884c\u6563\u5217\u5206\u533a\u3002\u901a\u8fc7 \u53d6\u6a21\u8fd0\u7b97 \u8ba1\u7b97\u5b58\u50a8\u7684\u5206\u533a\u53f7\uff1a N = MOD( expr , num )\u3002 \u5e38\u89c4HASH\u5206\u533a\u8ba9\u6bcf\u4e2a\u5206\u533a\u7ba1\u7406\u7684\u6570\u636e\u90fd\u51cf\u5c11\u4e86\uff0c\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\uff1b\u4f46\u662f\u5728\u5206\u533a\u7ba1\u7406\u4e0a\u7684\u4ee3\u4ef7\u592a\u5927\uff0c\u6545\u63d0\u4f9b\u4e86\u7ebf\u6027\u5206\u533a LINEAR HASH Partitioning \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002 5.4.1 LINEAR HASH \u5206\u533a \u00b6 \u7ebf\u6027\u6563\u5217\u5229\u7528\u7ebf\u6027\u4e8c\u6b21\u5e42\u7b97\u6cd5\uff0c\u800c\u5e38\u89c4\u6563\u5217\u4f7f\u7528\u6563\u5217\u51fd\u6570\u503c\u7684\u6a21\u6570\u3002 CREATE TABLE employees ( ... ) PARTITION BY LINEAR HASH ( expr ) PARTITIONS num ; \u5206\u533a\u53f7 N \u901a\u8fc7\u4ee5\u4e0b\u7b97\u6cd5\u8ba1\u7b97\uff1a \u627e\u5230\u4e0b\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e num \u76842\u7684\u5e42 V V = POWER ( 2 , CEILING ( LOG ( 2 , num ))) \u8bbe\u7f6e N = expr & (V - 1) While N >= num : Set V = V / 2 Set N = N & ( V - 1) \u4e3e\u4f8b\uff1a CREATE TABLE t1 ( col1 INT , col2 CHAR ( 5 ), col3 DATE ) PARTITION BY LINEAR HASH ( YEAR ( col3 ) ) PARTITIONS 6 ; V = POWER ( 2 , CEILING ( LOG ( 2 , 6 ) )) = 8 N = YEAR ( '1998-10-19' ) & ( 8 - 1 ) = 1998 & 7 = 6 ( 6 >= 6 is TRUE : additional step required ) N = 6 & (( 8 / 2 ) - 1 ) = 6 & 3 = 2 ( 2 >= 6 is FALSE : record stored in partition #2) \u5f53\u7ebf\u6027\u5206\u533a\u7684\u5206\u533a\u6570\u662f 2\u7684N\u6b21\u5e42 \u65f6\uff0c\u5b83\u4e0e\u5e38\u89c4\u5206\u533a\u7684\u7ed3\u679c\u662f\u4e00\u81f4\u7684\u3002 \u4f18\u7f3a\u70b9\uff1a \u4f18\u70b9\uff1a\u5728\u5206\u533a\u7ba1\u7406\uff08\u589e\u52a0\u3001\u5220\u9664\u3001\u5408\u5e76\u3001\u62c6\u5206\uff09\u65f6\uff0c\u5904\u7406\u66f4\u52a0\u8fc5\u901f \u7f3a\u70b9\uff1a\u76f8\u5bf9\u4e8e\u5e38\u89c4HASH\u5206\u533a\uff0c\u7ebf\u6027\u5206\u533a\u6570\u636e\u5206\u5e03\u4e0d\u592a\u5747\u5300\u3002 5.5 KEY \u5206\u533a \u00b6 \u7c7b\u4f3c\u4e8eHASH\u5206\u533a\uff0c\u4f46\u662f\u4f7f\u7528MySQL\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u54c8\u5e0c\u51fd\u6570\u3002NDB Cluster \u4f7f\u7528MD5()\uff1b\u5176\u5b83\u7684\u4f7f\u7528\u57fa\u4e8e\u5bc6\u7801\u52a0\u5bc6\u7b97\u6cd5\u7684\u54c8\u5e0c\u51fd\u6570\u3002 CREATE TABLE employees ( ... ) PARTITION BY KEY ( expr ) PARTITIONS num ; \u5206\u533a\u952e expr \u662f0\u6216\u591a\u4e2a\u5b57\u6bb5\u540d\uff0c\u652f\u6301\u9664BLOB\u6216TEXT\u4e4b\u5916\u7684\u5176\u5b83\u7c7b\u578b\u4f5c\u4e3a\u5206\u533a\u952e\uff08\u67e5\u770b\u4e0a\u6587**\u5206\u533a\u7c7b\u578b \uff09\u3002\u7528\u4f5c\u5206\u533a\u952e\u7684\u4efb\u4f55\u5217\u5fc5\u987b\u5305\u542b\u8868\u7684\u4e3b\u952e\u7684\u90e8\u5206\u6216\u5168\u90e8\uff0c\u5982\u679c\u8868\u6709\u4e00\u4e2a\u3002\u5982\u679c\u6ca1\u6709\u5c06\u5217\u540d\u6307\u5b9a\u4e3a\u5206\u533a\u952e\uff0c\u5219\u4f7f\u7528\u8868\u7684\u4e3b\u952e\uff08\u5982\u679c\u6709\uff09\u3002\u5728\u6ca1\u6709\u4e3b\u952e\u65f6\uff0c\u9009\u62e9 *\u552f\u4e00\u975e\u7a7a\u952e \u4f5c\u4e3a\u5206\u533a\u952e\u3002 \u6ce8\u610f\uff1a\u4e0d\u80fd\u6267\u884c ALTER TABLE DROP PRIMARY KEY \u5220\u9664key\u7c7b\u578b\u7684\u5206\u533a\uff0c\u4f46\u662fNDB Cluster\u53ef\u4ee5\u3002 5.5.1 LINEAR KEY \u5206\u533a \u00b6 \u4e0e\u7ebf\u6027HASH\u5206\u533a\u7c7b\u4f3c\u3002 5.6 \u5b50\u5206\u533a \u00b6 \u5b50\u5206\u533a\uff08 Subpartitioning \uff09\u4e5f\u79f0\u4e3a\u590d\u5408\u5206\u533a\uff0c\u662f\u5bf9\u5206\u533a\u8868\u4e2d\u5206\u533a\u7684\u8fdb\u4e00\u6b65\u5212\u5206\u3002 \u521b\u5efa\u8bed\u6cd5\u89c1\u4e0a\u6587\u3002 \u652f\u6301\u5bf9RANGE\u5206\u533a\u548cLIST\u5206\u533a\u5212\u5206\u7684\u8868\u518d\u5212\u5206\uff0c\u5b50\u5206\u533a\u53c8\u652f\u6301HASH \u5206\u533a\u7c7b\u578b\u548cKEY \u5206\u533a\u7c7b\u578b\u3002 \u4f8b\uff1a -- \u7b2c\u4e00\u79cd\u5199\u6cd5 CREATE TABLE ts ( id INT , purchased DATE ) PARTITION BY RANGE ( YEAR ( purchased ) ) SUBPARTITION BY HASH ( TO_DAYS ( purchased ) ) SUBPARTITIONS 2 ( PARTITION p0 VALUES LESS THAN ( 1990 ), PARTITION p1 VALUES LESS THAN ( 2000 ), PARTITION p2 VALUES LESS THAN MAXVALUE ); -- \u7b2c\u4e8c\u79cd\u5199\u6cd5 CREATE TABLE ts ( id INT , purchased DATE ) PARTITION BY RANGE ( YEAR ( purchased ) ) SUBPARTITION BY HASH ( TO_DAYS ( purchased ) ) ( PARTITION p0 VALUES LESS THAN ( 1990 ) ( SUBPARTITION s0 , SUBPARTITION s1 ), PARTITION p1 VALUES LESS THAN ( 2000 ) ( SUBPARTITION s2 , SUBPARTITION s3 ), PARTITION p2 VALUES LESS THAN MAXVALUE ( SUBPARTITION s4 , SUBPARTITION s5 ) ); ts \u8868\u6709\u4e09\u4e2a\u5206\u533a\uff1a p0, p1, p2 \uff0c\u6bcf\u4e2a\u5206\u533a\u518d\u8fdb\u4e00\u6b65\u5212\u5206\u4e3a\u4e24\u4e2a\u5206\u533a\uff0c\u6240\u6709\u5171\u6709 2*3 = 6 \u4e2a\u5206\u533a\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a \u6bcf\u4e2a\u5206\u533a\u5fc5\u987b\u6709\u76f8\u540c\u6570\u91cf\u7684\u5b50\u5206\u533a \u4e0d\u5141\u8bb8\u53ea\u5bf9\u4e00\u90e8\u5206\u5206\u533a\u5b9a\u4e49\u5b50\u5206\u533a \u5728\u6574\u4e2a\u8868\u4e2d\u6bcf\u4e2a\u5b50\u5206\u533a\u7684\u540d\u79f0\u5fc5\u987b\u662f\u552f\u4e00\u7684 \u5f53NO_DIR_IN_CREATE\u670d\u52a1\u5668SQL\u6a21\u5f0f\u751f\u6548\u65f6\uff08\u4e0d\u6307\u5b9a\u8be5\u6a21\u5f0f\u4e5f\u4e0d\u53ef\u7528\uff09\uff0c\u5206\u533a\u5b9a\u4e49\u4e2d\u4e0d\u5141\u8bb8\u4f7f\u7528DATA DIRECTORY\u548cINDEX DIRECTORY\u9009\u9879\u3002\u4eceMySQL 5.5.5\u5f00\u59cb\uff0c\u5728\u5b9a\u4e49\u5b50\u5206\u533a\u65f6\u4e5f\u4e0d\u5141\u8bb8\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u3002\u5b9e\u9645\u64cd\u4f5c\u53ef\u77e5\uff1a\u5373\u4f7f\u4f60\u6dfb\u52a0\u4e86\u8fd9\u4e24\u4e2a\u9009\u9879\uff0c\u518d\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e5f\u4f1a\u5ffd\u7565\u5b83\u4eec\u3002 -- \u9009\u9879\u65e0\u6548\uff01 MariaDB [ MYISAM_TEST ] > CREATE TABLE sub_par_test ( id INT ) ENGINE = MYISAM PARTITION BY RANGE ( id ) SUBPARTITION BY HASH ( id ) -> ( -> PARTITION P0 VALUES LESS THAN ( 10 ) ( -> SUBPARTITION S01 DATA DIRECTORY = '/tmp/sub/data/s01' INDEX DIRECTORY = '/tmp/sub/index/s01' , -> SUBPARTITION S02 DATA DIRECTORY = '/tmp/sub/data/s02' INDEX DIRECTORY = '/tmp/sub/index/s02' -> ), -> PARTITION P1 VALUES LESS THAN ( MAXVALUE ) ( -> SUBPARTITION S03 DATA DIRECTORY = '/tmp/sub/data/s03' INDEX DIRECTORY = '/tmp/sub/index/s03' , -> SUBPARTITION S04 DATA DIRECTORY = '/tmp/sub/data/s04' INDEX DIRECTORY = '/tmp/sub/index/s04' -> ) -> ); MariaDB [ MYISAM_TEST ] > SHOW WARNINGS ; +---------+------+----------------------------------+ | Level | Code | Message | +---------+------+----------------------------------+ | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | +---------+------+----------------------------------+ 5.7 MySQL\u5206\u533a\u5982\u4f55\u5904\u7406NULL \u00b6 Note NULL \u4e0d\u662f\u4e00\u4e2a\u6570\u5b57\u3002 MySQL\u7684\u5206\u533a\u5b9e\u73b0\u5c06NULL\u89c6\u4e3a \u5c0f\u4e8e\u4efb\u4f55\u975eNULL\u503c \uff0c\u5c31\u50cfORDER BY\u4e00\u6837\u3002 5.7.1 RANGE partitioning \u00b6 \u5982\u679c\u8ba1\u7b97\u8fc7\u540e\u5206\u533a\u952e\u7684\u503c\u4e3aNULL\uff0c\u5c06\u8be5\u8bb0\u5f55\u63d2\u5165\u5230 \u6700\u4f4e\u7684\u5206\u533a \u4e2d\u3002 5.7.2 LIST partitioning \u00b6 \u6709\u4e00\u4e2a\u5206\u533a\u7684\u503c \u5305\u542bNULL \u65f6\uff0c\u7531LIST\u5206\u533a\u7684\u8868\u624d\u5141\u8bb8NULL\u503c\u3002 5.7.3 HASH and KEY partitioning \u00b6 NULL\u503c\u88ab\u89c6\u4e3a \u96f6 \u3002 6. \u5206\u533a\u7ba1\u7406 \u00b6 \u52a8\u4f5c\uff1a\u6dfb\u52a0\u3001\u5220\u9664\u3001\u91cd\u7ec4\uff08\u5408\u5e76\u3001\u5206\u79bb\uff09\u3002\u4f7f\u7528 ALTER TABLE \u8bed\u53e5\u5e26\u6709\u7684 partition_options \u5b50\u53e5\u6267\u884c\uff0c\u4e0e\u521b\u5efa\u5206\u533a\u7684\u8bed\u6cd5\u76f8\u540c\u3002\u8fd9\u4e9b\u52a8\u4f5c\u4f1a\u6d89\u53ca\u5230\u6570\u636e\u7684\u8fc1\u79fb\u3002 Note \u6240\u6709\u7684\u5206\u533a\u90fd\u5fc5\u987b\u6709\u76f8\u540c\u6570\u91cf\u7684\u5b50\u5206\u533a\uff0c\u5e76\u4e14\u5b50\u5206\u533a\u4e00\u65e6\u521b\u5efa\u5c31\u4e0d\u53ef\u6539\u53d8\u3002\u540c\u4e00\u6761\u8bed\u53e5\u4e2d\u53ea\u6709\u4e00\u4e2a\u52a8\u4f5c\u53ef\u4ee5\u88ab\u6267\u884c\u3002 6.1 RANGE and LIST \u7684\u7ba1\u7406 \u00b6 6.1.1 \u5220\u9664 \u00b6 ALTER TABLE ... DROP PARTITION ... mysql > ALTER TABLE tr DROP PARTITION p2 ; Query OK , 0 rows affected ( 0 . 03 sec ) \u5206\u533a\u4e2d\u7684\u6570\u636e\u540c\u65f6\u4e5f\u88ab\u5220\u9664\u3002 NDBCLUSTER \u5b58\u50a8\u5f15\u64ce\u4e0d\u652f\u6301\u8be5\u64cd\u4f5c\u3002 6.1.2 \u6dfb\u52a0 \u00b6 ALTER TABLE ... ADD PARTITION partition_definitions RANGE\u53ea\u80fd\u5728\u5206\u533a\u5c3e\u90e8\u6dfb\u52a0\u65b0\u7684\u5206\u533a\uff0c\u5e76\u4e14\u5176\u8303\u56f4\u6bd4\u5b58\u5728\u7684\u5206\u533a\u90fd\u5927\u3002 ALTER TABLE members ADD PARTITION ( PARTITION p3 VALUES LESS THAN ( 2010 )); ALTER TABLE tt ADD PARTITION ( PARTITION p2 VALUES IN ( 7 , 14 , 21 ), PARTITION p3 VALUES IN ( 1 )); LIST\u5206\u533a\u4e0d\u80fd\u5305\u542b \u91cd\u590d\u7684\u503c \u3002 6.1.3 \u91cd\u7ec4 \u00b6 ALTER TABLE table_name REORGANIZE PARTITION partition_names INTO ( partition_definitions ) \u6570\u636e\u4f1a\u5b58\u50a8\u5728\u65b0\u7684\u5206\u533a\u4e0a\u3002 \u5206\u79bb\u5206\u533a\uff1a ALTER TABLE members REORGANIZE PARTITION p0 INTO ( PARTITION n0 VALUES LESS THAN ( 1970 ), PARTITION n1 VALUES LESS THAN ( 1980 ) ); \u5408\u5e76\u5206\u533a\uff1a ALTER TABLE members REORGANIZE PARTITION s0 , s1 INTO ( PARTITION p0 VALUES LESS THAN ( 1970 ) ); \u5206\u79bb\u4e0e\u5408\u5e76\u7684\u5173\u7cfb\u4e0d\u5fc5\u662f\u4e00\u5bf9\u591a\u6216\u591a\u5bf9\u4e00\uff0c\u53ef\u4ee5\u662f \u591a\u5bf9\u591a \uff1a ALTER TABLE members REORGANIZE PARTITION p0 , p1 , p2 , p3 INTO ( PARTITION m0 VALUES LESS THAN ( 1980 ), PARTITION m1 VALUES LESS THAN ( 2000 ) ); Warning RANGE\u5206\u533a\u4e0d\u80fd\u8de8\u8303\u56f4\u91cd\u7ec4\u3002\u4f8b\u5982\uff1a\u4e0d\u80fd\u91cd\u7ec4\u2018p0,p2\u2019\uff0c\u800c\u8df3\u8fc7p1\u3002 \u4e0d\u80fd\u4f7f\u7528\u91cd\u7ec4\u8bed\u53e5\u6539\u53d8\u5206\u533a\u7c7b\u578b\uff0c\u4ee5\u53ca\u6539\u53d8\u5206\u533a\u952e expr \uff1b\u4f7f\u7528 ALTER TABLE ... PARTITION BY ... \u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\u3002 6.2 HASH and KEY \u7684\u7ba1\u7406 \u00b6 \u8fd9\u4e24\u4e2a\u5206\u533a\u6ca1\u6709\u5206\u533a\u540d\uff0c\u4e0d\u80fd\u4f7f\u7528\u548c\u5206\u533a\u540d\u76f8\u5173\u7684\u8bed\u53e5\u8fdb\u884c\u7ba1\u7406\u3002 6.2.1 \u5220\u9664 \u00b6 \u4e0d\u53ef\u5220\u9664\u6307\u5b9a\u5206\u533a\uff0c\u4f7f\u7528\u5982\u4e0b\u8bed\u53e5\u5408\u5e76\u5206\u533a\uff1a ALTER TABLE table_name COALESCE PARTITION number number \u662f\u8981\u5408\u5e76\u5230\u5176\u4f59\u5206\u533a\u7684\u5206\u533a\u6570\uff0c\u5373\u5220\u9664\u7684\u5206\u533a\u6570\u3002 MariaDB [ MYISAM_TEST ] > ALTER TABLE hash_par COALESCE PARTITION 2 ; Query OK , 4 rows affected ( 0 . 11 sec ) Records : 4 Duplicates : 0 Warnings : 0 6.2.2 \u6dfb\u52a0 \u00b6 ALTER TABLE table_name ADD PARTITION PARTITIONS number number \u662f\u6dfb\u52a0\u7684\u5206\u533a\u6570\u3002 6.2.3 \u91cd\u7ec4 \u00b6 \u901a\u8fc7\u5220\u9664\u548c\u6dfb\u52a0\u5b9e\u73b0\u3002 \u5b50\u5206\u533a\u4f1a\u81ea\u52a8\u7684\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff1a MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE sub_par_test \\ G ; CREATE TABLE `sub_par_test` ( `id` int ( 11 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (id) SUBPARTITION BY HASH (id) (PARTITION P0 VALUES LESS THAN (10) (SUBPARTITION S01 ENGINE = MyISAM, SUBPARTITION S02 ENGINE = MyISAM), PARTITION P1 VALUES LESS THAN MAXVALUE (SUBPARTITION S03 ENGINE = MyISAM, SUBPARTITION S04 ENGINE = MyISAM)) */ MariaDB [ MYISAM_TEST ] > ALTER TABLE sub_par_test REORGANIZE PARTITION P0 INTO ( PARTITION P00 VALUES LESS THAN ( 5 ), PARTITION P01 VALUES LESS THAN ( 10 )); Query OK , 2 rows affected ( 0 . 01 sec ) Records : 2 Duplicates : 0 Warnings : 0 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE sub_par_test \\ G ; CREATE TABLE `sub_par_test` ( `id` int ( 11 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (id) SUBPARTITION BY HASH (id) (PARTITION P00 VALUES LESS THAN (5) (SUBPARTITION P00sp0 ENGINE = MyISAM, SUBPARTITION P00sp1 ENGINE = MyISAM), PARTITION P01 VALUES LESS THAN (10) (SUBPARTITION P01sp0 ENGINE = MyISAM, SUBPARTITION P01sp1 ENGINE = MyISAM), PARTITION P1 VALUES LESS THAN MAXVALUE (SUBPARTITION S03 ENGINE = MyISAM, SUBPARTITION S04 ENGINE = MyISAM)) */ 6.3 \u5206\u533a\u7684\u7ef4\u62a4 \u00b6 \u7ef4\u62a4\u52a8\u4f5c\uff1a CHECK TABLE , OPTIMIZE TABLE , ANALYZE TABLE , and REPAIR TABLE \u3002 \u8bed\u6cd5\uff1a ALTER TABLE table_name action PARTITION { partition_names | ALL } \u91cd\u6784\u5206\u533a \uff1a\u4e22\u5f03\uff08drop\uff09\u5206\u533a\u6240\u6709\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u91cd\u65b0\u63d2\u5165\u6570\u636e\u3002\u5bf9\u4e8e\u788e\u7247\u6574\u7406\u5f88\u6709\u7528\u5904\u3002 ALTER TABLE t1 REBUILD PARTITION p0 , p1 ; \u4f18\u5316\u5206\u533a \uff1a\u82e5\u5220\u9664\u4e86\u4e00\u4e2a\u5206\u533a\u7684\u5927\u91cf\u6570\u636e\uff0c\u6216\u8005\u5728\u53ef\u53d8\u7c7b\u578b\u7684\u5b57\u6bb5\u505a\u51fa\u4e86\u5f88\u591a\u6539\u53d8\uff0c\u53ef\u4f7f\u7528\u6b64\u8bed\u53e5\u6765\u56de\u6536\u672a\u4f7f\u7528\u7684\u7a7a\u95f4\u548c\u4f18\u5316\u5206\u533a\u6570\u636e\u6587\u4ef6\u3002 ALTER TABLE t1 OPTIMIZE PARTITION p0 , p1 ; \u8fd0\u884c OPTIMIZE PARTITION \u4e0e\u8fd0\u884c CHECK PARTITION , ANALYZE PARTITION , and REPAIR PARTITION \u7b49\u4ef7\u3002 \u4e00\u4e9b\u5b58\u50a8\u5f15\u64ce\uff08\u5982InnoDB\uff09\uff0c\u4e0d\u652f\u6301\u5bf9\u5355\u72ec\u7684\u5206\u533a\u4f18\u5316\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6b64\u8bed\u53e5\u5c06\u91cd\u6784\u6574\u4e2a\u8868\u3002\u4eceMySQL 5.5.30\u5f00\u59cb\uff0c\u4f7f\u7528\u6b64\u8bed\u53e5\u5c06\u5bfc\u81f4\u4e00\u4e2abug\uff0c\u4f7f\u7528 ALTER TABLE ... REBUILD PARTITION and ALTER TABLE ... ANALYZE PARTITION \u6765\u907f\u514d\u6574\u4e2a\u95ee\u9898\u3002 \u5206\u6790\u5206\u533a \uff1a\u8bfb\u53d6\u5e76\u5b58\u50a8\u5206\u533a\u7684key\u5206\u5e03\u3002 ALTER TABLE t1 ANALYZE PARTITION p3 ; \u4fee\u590d\u5206\u533a \uff1a\u4fee\u590d\u635f\u574f\u7684\u5206\u533a\u3002 ALTER TABLE t1 REPAIR PARTITION p0 , p1 ; \u68c0\u67e5\u5206\u533a \uff1a\u68c0\u67e5\u5206\u533a\u662f\u5426\u5b58\u5728\u9519\u8bef\u3002\u5176\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5728\u975e\u5206\u533a\u8868\u4f7f\u7528CHECK TABLE\u7684\u65b9\u5f0f\u975e\u5e38\u76f8\u4f3c\u3002 ALTER TABLE trb3 CHECK PARTITION p1 ; \u6b64\u8bed\u53e5\u5c06\u544a\u8bc9\u8868\u4e2d\u7684\u6570\u636e\u6216\u7d22\u5f15\u662f\u5426\u5df2\u635f\u574f\u3002\u53ef\u4ee5\u4f7f\u7528 REPAIR PARTITION \u4fee\u590d\u3002 \u91cd\u5efa\u5206\u533a \uff1a\u5220\u9664\u6307\u5b9a\u5206\u533a\u4ee5\u53ca\u6240\u6709\u6307\u5b9a\u5206\u533a\u7684\u6570\u636e\u5e76\u521b\u5efa\u65b0\u5206\u533a\u3002\u5176\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5728\u975e\u5206\u533a\u8868\u4f7f\u7528TRUNCATE TABLE\u7684\u65b9\u5f0f\u975e\u5e38\u76f8\u4f3c\u3002\u4eceMySQL 5.5.0\u5f00\u59cb\u3002 ALTER TABLE hash_par TRUNCATE PARTITION ALL ; mysqlcheck and myisamchk \u4e0d\u652f\u6301\u5206\u533a\u8868\u3002 ANALYZE , CHECK , OPTIMIZE , REBUILD , REPAIR , and TRUNCATE \u64cd\u4f5c\u4e0d\u652f\u6301\u5b50\u5206\u533a\u3002","title":"23. MySQL\u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#1","text":"\u200b \u5206\u533a\u5c06\u4e00\u5f20\u8868\u5206\u4e3a\u51e0\u4e2a\u5206\u533a\u8fdb\u884c\u5b58\u50a8\uff0c\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u5f20\u8868\u3002\u5206\u533a\u952e\u7528\u4e8e\u6839\u636e\u67d0\u4e2a\u533a\u95f4\u503c\u3001\u7279\u5b9a\u503c\u5217\u8868\u6216hash\u51fd\u6570\u503c\u6267\u884c\u6570\u636e\u7684\u805a\u96c6\uff0c\u8ba9\u6570\u636e\u66f4\u5177\u5206\u5e03\u89c4\u5219\u5206\u5e03\u5728\u4e0d\u540c\u7684\u5206\u533a\u4e2d\uff0c\u8ba9\u4e00\u4e2a\u5927\u5bf9\u8c61\u53d8\u6210\u4e00\u4e9b\u5c0f\u5bf9\u8c61\u3002 \u5206\u533a\u7684\u4f18\u70b9\uff1a \u53ef\u4ee5\u5728\u4e00\u4e2a\u8868\u4e2d\u5b58\u50a8\u6bd4\u5728\u5355\u4e2a\u78c1\u76d8\u6216\u6587\u4ef6\u7cfb\u7edf\u5206\u533a\u4e0a\u80fd\u4fdd\u5b58\u7684\u66f4\u591a\u7684\u6570\u636e\u3002 \u53ef\u4ee5\u8f7b\u677e\u7684\u79fb\u9664\u6216\u6dfb\u52a0\u5206\u533a\u8fbe\u5230\u5220\u9664\u6570\u636e\u6216\u65b0\u589e\u5b58\u50a8\u6570\u636e\u7684\u7a7a\u95f4\u3002 \u4e00\u4e9b\u67e5\u8be2\u53ef\u4ee5\u5f97\u5230\u5f88\u597d\u7684\u4f18\u5316\u3002 \u8de8\u591a\u4e2a\u78c1\u76d8\u5206\u6563\u6570\u636e\u67e5\u8be2\uff0c\u83b7\u5f97\u66f4\u5927\u7684\u541e\u5410\u91cf","title":"1. \u6982\u5ff5"},{"location":"mysql/23. MySQL\u5206\u533a/#2","text":"CREATE [ TEMPORARY ] TABLE [ IF NOT EXISTS ] tbl_name ( create_definition ,...) [ table_options ] [ partition_options ] partition_options : PARTITION BY { [ LINEAR ] HASH ( expr ) | [ LINEAR ] KEY ( column_list ) | RANGE { ( expr ) | COLUMNS ( column_list ) } | LIST { ( expr ) | COLUMNS ( column_list ) } } [ PARTITIONS num ] [ SUBPARTITION BY { [ LINEAR ] HASH ( expr ) | [ LINEAR ] KEY ( column_list ) } [ SUBPARTITIONS num ] ] [( partition_definition [, partition_definition ] ...)] partition_definition : PARTITION partition_name [ VALUES { LESS THAN { ( expr | value_list ) | MAXVALUE } | IN ( value_list ) } ] [[ STORAGE ] ENGINE [ = ] engine_name ] [ COMMENT [ = ] 'comment_text' ] [ DATA DIRECTORY [ = ] 'data_dir' ] [ INDEX DIRECTORY [ = ] 'index_dir' ] [ MAX_ROWS [ = ] max_number_of_rows ] [ MIN_ROWS [ = ] min_number_of_rows ] [ TABLESPACE [ = ] tablespace_name ] [ NODEGROUP [ = ] node_group_id ] [( subpartition_definition [, subpartition_definition ] ...)] subpartition_definition : SUBPARTITION logical_name [[ STORAGE ] ENGINE [ = ] engine_name ] [ COMMENT [ = ] 'comment_text' ] [ DATA DIRECTORY [ = ] 'data_dir' ] [ INDEX DIRECTORY [ = ] 'index_dir' ] [ MAX_ROWS [ = ] max_number_of_rows ] [ MIN_ROWS [ = ] min_number_of_rows ] [ TABLESPACE [ = ] tablespace_name ] [ NODEGROUP [ = ] node_group_id ] \u5206\u533a\u9009\u9879\u4e00\u5b9a\u8981\u653e\u5728\u6700\u540e\u3002 \u6307\u5b9a\u8868\u7684\u5206\u533a\u6570 PARTITIONS num \u65f6\uff0c\u5fc5\u987b\u5c06\u5176\u8868\u793a\u4e3a\u4e0d\u5e26\u524d\u5bfc\u96f6\u7684\u975e\u96f6\u6b63\u6574\u6570\uff0c\u5e76\u4e14\u4e0d\u662f0.8E + 01\u62166-2\u7b49\u8868\u8fbe\u5f0f\uff0c\u5373\u4f7f\u5b83\u7684\u8ba1\u7b97\u7ed3\u679c\u4e3a\u6574\u6570\u503c\u3002\u4e0d\u5141\u8bb8\u4f7f\u7528\u5c0f\u6570\u90e8\u5206\u3002 \u8981\u4e48\u5206\u533a\u8868\u4e0a\u6ca1\u6709\u4e3b\u952e/\u552f\u4e00\u952e\uff0c\u8981\u4e48\u4f7f\u7528\u4e3b\u952e/\u552f\u4e00\u952e\u90fd\u5fc5\u987b\u5305\u542b\u5206\u533a\u952e\u3002 \u5206\u533a\u7684\u540d\u5b57\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002 \u5f53NO_DIR_IN_CREATE\u670d\u52a1\u5668SQL\u6a21\u5f0f\u751f\u6548\u65f6\uff08\u6ca1\u6709\u6307\u5b9a\u8be5\u6a21\u5f0f\u4e5f\u4e0d\u53ef\u4ee5\uff09\uff0c\u5206\u533a\u5b9a\u4e49\u4e2d\u4e0d\u5141\u8bb8\u4f7f\u7528DATA DIRECTORY\u548cINDEX DIRECTORY\u9009\u9879\u3002\u4eceMySQL 5.5.5\u5f00\u59cb\uff0c\u5728\u5b9a\u4e49\u5b50\u5206\u533a\u65f6\u4e5f\u4e0d\u5141\u8bb8\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u3002\u5b9e\u9645\u64cd\u4f5c\u53ef\u77e5\uff1a\u5373\u4f7f\u4f60\u6dfb\u52a0\u4e86\u8fd9\u4e24\u4e2a\u9009\u9879\uff0c\u518d\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e5f\u4f1a\u5ffd\u7565\u5b83\u4eec\u3002","title":"2. \u5206\u533a\u8868\u7684\u521b\u5efa"},{"location":"mysql/23. MySQL\u5206\u533a/#3","text":"\u4f7f\u7528 SHOW CREATE TABLE \u67e5\u770b\u5206\u533a\u8868\u7684\u5206\u533a\u5b50\u53e5\u3002 \u4f7f\u7528 SHOW TABLE STATUS \u786e\u8ba4\u662f\u5426\u662f\u5206\u533a\u8868\u3002 \u67e5\u8be2 INFORMATION_SCHEMA.PARTITIONS \u8868\uff1a SELECT * FROM INFORMATION_SCHEMA . PARTITIONS WHERE TABLE_NAME = 'table_name' ; -- \u7b80\u5316\u7248 SELECT PARTITION_NAME , TABLE_ROWS FROM information_schema . PARTITIONS WHERE TABLE_NAME = 'hash_par' ; \u4f7f\u7528 EXPLAIN PARTITIONS select_statement \u67e5\u770b\u4f7f\u7528\u4e86\u54ea\u4e9b\u5206\u533a\uff0c\u548c\u6807\u51c6\u7684 EXPLAIN SELECT \u8bed\u53e5\u7528\u6cd5\u4e00\u6837\uff1a EXPLAIN PARTITIONS select_statement ; EXPLAIN PARTITIONS \u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a \u4e0d\u80fd\u540c\u65f6\u4f7f\u7528PARTITIONS\u548cEXTENDED\u5173\u952e\u5b57\u3002 \u5982\u679c\u7528\u4e8e\u89e3\u91ca\u975e\u5206\u533a\u8868\uff0c partitions \u603b\u662f\u4e3a NULL \u3002","title":"3. \u67e5\u770b\u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#4","text":"\u548c\u5220\u9664\u8868\u4e00\u6837\uff0c\u4f7f\u7528 TRUNCATE \u6e05\u7a7a\u5206\u533a\uff08\u6bd4 DELETE \u8981\u5feb\uff09\uff0c\u4f7f\u7528 DROP \u5220\u9664\u5206\u533a\uff1a ALTER TABLE table_name TRUNCATE PARTITION partition_name ; ALTER TABLE table_name DROP PARTITION partition_name ;","title":"4. \u5220\u9664\u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#5","text":"\u901a\u8fc7 KYE \u6216 LINEAR KEY \u5206\u533a\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 DATE,TIME,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u5b57\u6bb5\u3002 \u901a\u8fc7 RANGE COLUMNS \u548c LIST COLUMNS \u5206\u533a\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 DATE,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u5b57\u6bb5\u3002 \u5176\u5b83\u7684\u5206\u533a\u7c7b\u578b\u5728\u8981\u6c42\u4e00\u4e2a\u8fd4\u56de\u6574\u578b\u6570\u503c\u6216NULL\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u3002","title":"5. \u5206\u533a\u7c7b\u578b"},{"location":"mysql/23. MySQL\u5206\u533a/#51-range","text":"\u6309\u8303\u56f4\u5206\u533a\u7684\u8868\u7684\u5206\u533a\u65b9\u5f0f\u662f\uff1a\u6bcf\u4e2a\u5206\u533a\u5305\u542b\u5206\u533a\u8868\u8fbe\u5f0f\u503c\u4f4d\u4e8e\u7ed9\u5b9a\u8303\u56f4\u5185\u7684\u884c\u3002 \u8303\u56f4\u5e94\u8be5\u662f \u8fde\u7eed\u4f46\u4e0d\u91cd\u53e0\u7684 \uff0c\u5e76\u4e14\u4f7f\u7528 VALUES LESS THAN \u8fd0\u7b97\u7b26\u5b9a\u4e49\u3002 NULL\u4f1a\u88ab\u5f53\u4f5c\u6700\u5c0f\u503c\u6765\u5904\u7406 \u652f\u6301\u4f7f\u7528 DATE,DATETIME \u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e \u652f\u6301\u4f7f\u7528 UNIX_TIMESTAMP,YEAR \u7b49\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE `range_test` ( `ID` int ( 11 ) DEFAULT NULL ) ENGINE = InnoDB DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (ID) (PARTITION P0 VALUES LESS THAN (5) ENGINE = InnoDB, PARTITION P1 VALUES LESS THAN (10) ENGINE = InnoDB, -- MAXVALUE\u8868\u793a\u6700\u5927\u7684\u53ef\u80fd\u7684\u6574\u6570\u503c PARTITION P3 VALUES LESS THAN MAXVALUE ENGINE = InnoDB) */ -- /*!...*/ \u662fMySQL\u7684\u6269\u5c55\u7279\u6027\u3002\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6ce8\u91ca\uff0c\u5176\u4ed6\u7684\u6570\u636e\u5e93\u4ea7\u54c1\u5f53\u7136\u4e0d\u4f1a\u6267\u884c\u3002mysql\u7279\u6b8a\u5904\u7406\uff0c\u4f1a\u9009\u62e9\u6027\u7684\u6267\u884c\u3002\u7279\u522b\u6ce8\u610f 50100\uff0c\u5b83\u8868\u793a5.01.00 \u7248\u672c\u6216\u8005\u66f4\u9ad8\u7684\u7248\u672c\uff0c\u624d\u6267\u884c\u3002 -- \u4f7f\u7528DATE\u7c7b\u578b\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e CREATE TABLE members ( username VARCHAR ( 16 ) NOT NULL , email VARCHAR ( 35 ), joined DATE NOT NULL ) PARTITION BY RANGE COLUMNS ( joined ) ( PARTITION p0 VALUES LESS THAN ( '1960-01-01' ), PARTITION p1 VALUES LESS THAN MAXVALUE ); -- \u4f7f\u7528UNIX_TIMESTAMP\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE quarterly_report_status ( report_id INT NOT NULL , report_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ) PARTITION BY RANGE ( UNIX_TIMESTAMP ( report_updated ) ) ( PARTITION p0 VALUES LESS THAN ( UNIX_TIMESTAMP ( '2008-01-01 00:00:00' ) ), PARTITION p1 VALUES LESS THAN ( MAXVALUE ) ); -- \u4f7f\u7528YEAR\u7b49\u51fd\u6570\u8fdb\u884c\u5206\u533a CREATE TABLE employees ( id INT NOT NULL , separated DATE NOT NULL DEFAULT '9999-12-31' , store_id INT ) PARTITION BY RANGE ( YEAR ( separated ) ) ( PARTITION p0 VALUES LESS THAN ( 1991 ), PARTITION p1 VALUES LESS THAN MAXVALUE ); RANGE \u5206\u533a\u7c7b\u578b\u7279\u522b\u9002\u5408\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a \u9700\u8981\u5220\u9664\u65e7\u6570\u636e\u65f6\u3002\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u901a\u8fc7\u5220\u9664\u5206\u533a\u6765\u5220\u9664\u65e7\u6570\u636e\u3002 ALTER TABLE employees DROP PARTITION p0; \u4f7f\u7528\u5305\u542b\u65e5\u671f\u6216\u65f6\u95f4\u503c\u7684\u5217\uff0c\u6216\u5305\u542b\u6765\u81ea\u5176\u4ed6\u4e00\u4e9b\u7cfb\u5217\u7684\u503c\u3002 \u7ecf\u5e38\u8fd0\u884c\u5305\u542b\u5206\u533a\u952e\u7684\u67e5\u8be2\u3002","title":"5.1 RANGE \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#52-list","text":"LIST \u5206\u533a\u65f6\u5efa\u7acb\u79bb\u6563\u7684\u503c\u5217\u8868\u544a\u8bc9\u6570\u636e\u5e93\u7279\u5b9a\u7684\u503c\u5c5e\u4e8e\u54ea\u4e2a\u5206\u533a\u3002 \u4e0eRANGE\u5206\u533a\u7684\u533a\u522b\uff1a\u662fLIST\u5206\u533a\u4ece\u5c5e\u4e8e\u4e00\u4e2a\u679a\u4e3e\u5217\u8868\u7684\u503c\u7684\u96c6\u5408\uff0cRANGE\u5206\u533a\u662f\u4ece\u5c5e\u4e8e\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\u503c\u7684\u96c6\u5408\u3002 \u4e0eRANGE\u5206\u533a\u4e0d\u540c\uff0c\u6ca1\u6709\u7c7b\u4f3c\u4e8e MAXVALUE \u7684\u503c\u6765\u5339\u914d\u6240\u6709\u7684\u60c5\u51b5\uff1b \u6240\u6709\u88ab\u671f\u671b\u7684\u503c \u90fd\u5e94\u8be5\u88ab\u5305\u542b\u8fdb PARTITION ... VALUES IN (...) \u5b50\u53e5\u3002 \u4f7f\u7528\u5355\u4e2aINSERT\u8bed\u53e5\u63d2\u5165\u591a\u884c\u65f6\uff0c\u884c\u4e3a\u53d6\u51b3\u4e8e\u8868\u662f\u5426\u4f7f\u7528\u4e8b\u52a1\u5b58\u50a8\u5f15\u64ce\uff1a \u5bf9\u4e8e\u652f\u6301\u4e8b\u52a1\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u5f53\u505a\u4e00\u4e2a\u5355\u4e00\u7684\u4e8b\u52a1\u3002 \u5bf9\u4e8e\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5728\u5305\u542b\u672a\u5339\u914d\u503c\u7684\u4e4b\u524d\u7684\u8bb0\u5f55\u4f1a\u88ab\u63d2\u5165\uff0c\u81ea\u5df1\u53ca\u5176\u4e4b\u540e\u7684\u4e0d\u4f1a\u3002 \u53ef\u4ee5\u4f7f\u7528 IGNORE \u5173\u952e\u5b57\u5ffd\u7565\u6b64\u7c7b\u9519\u8bef\uff0c\u5982\u6b64\u4e00\u6765\uff0c\u5305\u542b\u672a\u5339\u914d\u7684\u503c\u7684\u8bb0\u5f55\u4e0d\u4f1a\u63d2\u5165\uff0c\u5176\u4f59\u7684\u90fd\u4f1a\u88ab\u63d2\u5165\u5230\u6570\u636e\u5e93\u5e76\u4e14\u4e0d\u4f1a\u53d1\u51fa\u9519\u8bef\u3002 MariaDB [ MYISAM_TEST ] > CREATE TABLE IF NOT EXISTS list_test ( ID INT ) MAX_ROWS = 8 PARTITION BY LIST ( ID ) ( PARTITION P0 VALUES IN ( 1 , 2 , 3 , 4 , 5 ), PARTITION P1 VALUES IN ( 6 , 7 , 8 ) ); MariaDB [ MYISAM_TEST ] > INSERT INTO list_test VALUES ( 1 ),( 3 ),( 9 ); ERROR 1526 ( HY000 ): Table has no partition for value 9 MariaDB [ MYISAM_TEST ] > INSERT IGNORE INTO list_test VALUES ( 1 ),( 3 ),( 9 ); Query OK , 2 rows affected , 1 warning ( 0 . 00 sec ) Records : 3 Duplicates : 1 Warnings : 1 MariaDB [ MYISAM_TEST ] > SELECT * FROM list_test ; +------+ | ID | +------+ | 1 | | 3 | +------+","title":"5.2 LIST \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#53-columns","text":"\u5217\u5206\u533a\u662f RANGE \u548c LIST \u5206\u533a\u7684\u53d8\u79cd\u3002COLUMNS\u5206\u533a\u5141\u8bb8\u5728\u5206\u533a\u952e\u4e2d\u4f7f\u7528\u591a\u4e2a\u5217\u3002 RANGE COLUMNS \u5206\u533a\u548c LIST COLUMNS \u5206\u533a\u90fd\u652f\u6301\u975e\u6574\u578b\uff08non-integer\uff09\u5b57\u6bb5\u4f5c\u4e3a\u503c\u7684\u8303\u56f4\u6216\u5217\u7684\u6210\u5458\uff0c\u4ee5\u4e0b\u662f\u8fd0\u884c\u7684\u6570\u636e\u7c7b\u578b\uff1a \u6240\u6709\u7684\u6574\u6570\u7c7b\u578b\uff1aTINYINT, SMALLINT, MEDIUMINT, INT (INTEGER), BIGINT \u90e8\u5206\u65f6\u95f4\u7c7b\u578b\uff1aDATE \u548c DATETIME \u90e8\u5206\u5b57\u7b26\u4e32\u7c7b\u578b\uff1aCHAR, VARCHAR, BINARY, VARBINARY","title":"5.3 COLUMNS \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#531-range-columns","text":"\u8fd9\u79cd\u5206\u533a\u7c7b\u578b\u53ef\u4ee5\u4f7f\u7528\u6574\u6570\u7c7b\u578b\u4ee5\u5916\u7684\u7c7b\u578b\u5217\u6765\u5b9a\u4e49\u8303\u56f4\u3002 RANGE COLUMNS \u4e0e RANGE \u5206\u533a\u7684\u4e0d\u540c\uff1a RANGE COLUMNS \u4e0d\u63a5\u53d7\u8868\u8fbe\u5f0f\uff0c\u53ea\u63a5\u53d7\u5b57\u6bb5\u540d\u3002 RANGE COLUMNS \u63a5\u53d7\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u7684\u5217\u8868\u3002 RANGE COLUMNS \u5212\u5206\u57fa\u4e8e\u5143\u7ec4\u4e4b\u95f4\u7684\u6bd4\u8f83 RANGE COLUMNS \u4e0d\u53d7\u9650\u4e8e\u6574\u6570\u7c7b\u578b\u3002\u5176\u5b83\u7c7b\u578b\u4e5f\u53ef\u4ee5\u7528\u4f5c\u5206\u533a\u5b57\u6bb5\u3002 CREATE TABLE table_name PARTITIONED BY RANGE COLUMNS ( column_list ) ( PARTITION partition_name VALUES LESS THAN ( value_list )[, PARTITION partition_name VALUES LESS THAN ( value_list )][, ...] ); column_list : column_name [, column_name ][, ...] value_list : value [, value ][, ...] \u521b\u5efa\u4e3e\u4f8b\uff1a mysql > CREATE TABLE rcx ( -> a INT , -> b INT , -> c CHAR ( 3 ), -> d INT -> ) -> PARTITION BY RANGE COLUMNS ( a , d , c ) ( -> PARTITION p0 VALUES LESS THAN ( 5 , 10 , 'ggg' ), -> PARTITION p1 VALUES LESS THAN ( 10 , 20 , 'mmm' ), -> PARTITION p2 VALUES LESS THAN ( 15 , 30 , 'sss' ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) -> ); Query OK , 0 rows affected ( 0 . 15 sec ) \u5206\u533a\u7684\u5b9a\u4e49\u5fc5\u987b\u9075\u4ece\u9012\u589e\u7684\u987a\u5e8f\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff1a -- \u6b63\u786e CREATE TABLE rc4 ( a INT , b INT , c INT ) PARTITION BY RANGE COLUMNS ( a , b , c ) ( PARTITION p0 VALUES LESS THAN ( 0 , 25 , 50 ), PARTITION p1 VALUES LESS THAN ( 10 , 20 , 100 ), PARTITION p2 VALUES LESS THAN ( 10 , 30 , 50 ) PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) ); -- \u9519\u8bef mysql > CREATE TABLE rcf ( -> a INT , -> b INT , -> c INT -> ) -> PARTITION BY RANGE COLUMNS ( a , b , c ) ( -> PARTITION p0 VALUES LESS THAN ( 0 , 25 , 50 ), -> PARTITION p1 VALUES LESS THAN ( 20 , 20 , 100 ), -> PARTITION p2 VALUES LESS THAN ( 10 , 30 , 50 ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE , MAXVALUE ) -> ); ERROR 1493 ( HY000 ): VALUES LESS THAN value must be strictly increasing for each partition","title":"5.3.1 RANGE COLUMNS \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#5311-range-columns","text":"\u4e3e\u4f8b\u8bf4\u660e\uff1a -- \u521b\u5efa\u5206\u533a\u8868 MariaDB [ MYISAM_TEST ] > CREATE TABLE rc1 ( -> a INT , -> b INT -> ) -> PARTITION BY RANGE COLUMNS ( a , b ) ( -> PARTITION p0 VALUES LESS THAN ( 5 , 12 ), -> PARTITION p3 VALUES LESS THAN ( MAXVALUE , MAXVALUE ) -> ); -- \u63d2\u5165\u6570\u636e MariaDB [ MYISAM_TEST ] > INSERT INTO rc1 VALUES ( 5 , 2 ), ( 5 , 10 ), ( 5 , 12 ); -- \u67e5\u770b\u6570\u636e\u5206\u5e03 MariaDB [ MYISAM_TEST ] > SELECT PARTITION_NAME , TABLE_ROWS FROM INFORMATION_SCHEMA . PARTITIONS WHERE TABLE_NAME = 'rc1' ; +----------------+------------+ | PARTITION_NAME | TABLE_ROWS | +----------------+------------+ | p0 | 2 | | p3 | 1 | +----------------+------------+ \u591a\u884c\u5206\u533a\u5bf9\u4e8e\u5206\u533a\u952e\u7684\u6bd4\u8f83\u662f\u5bf9\u5143\u7ec4\u8fdb\u884c\u6bd4\u8f83\uff0c\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a mysql > SELECT ( 5 , 10 ) < ( 5 , 12 ), ( 5 , 11 ) < ( 5 , 12 ), ( 5 , 12 ) < ( 5 , 12 ); +-----------------+-----------------+-----------------+ | ( 5 , 10 ) < ( 5 , 12 ) | ( 5 , 11 ) < ( 5 , 12 ) | ( 5 , 12 ) < ( 5 , 12 ) | +-----------------+-----------------+-----------------+ | 1 | 1 | 0 | +-----------------+-----------------+-----------------+ 1 row in set ( 0 . 00 sec )","title":"5.3.1.1 RANGE COLUMNS \u5212\u5206\u57fa\u4e8e\u5143\u7ec4\u4e4b\u95f4\u7684\u6bd4\u8f83\u7684\u89e3\u91ca"},{"location":"mysql/23. MySQL\u5206\u533a/#532-list-columns","text":"\u8fd9\u79cd\u5206\u533a\u7c7b\u578b\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e\uff0c\u5e76\u4f7f\u7528\u6574\u6570\u7c7b\u578b\u4ee5\u5916\u7684\u7c7b\u578b\u5217\u6765\u5b9a\u4e49\u8303\u56f4\u3002 \u4e0eRANGE COLUMNS \u7c7b\u4f3c\uff0c\u53c2\u8003\u4e0a\u6587\u8bf4\u660e\u3002 \u591a\u4e2a\u5b57\u6bb5\u4f5c\u4e3a\u5206\u533a\u952e\u7684\u5199\u6cd5\uff1a CREATE TABLE lc ( a INT NULL , b INT NULL ) PARTITION BY LIST COLUMNS ( a , b ) ( PARTITION p0 VALUES IN ( ( 0 , 0 ), ( NULL , NULL ) ), PARTITION p1 VALUES IN ( ( 0 , 1 ), ( 0 , 2 ), ( 0 , 3 ), ( 1 , 1 ), ( 1 , 2 ) ), PARTITION p2 VALUES IN ( ( 1 , 0 ), ( 2 , 0 ), ( 2 , 1 ), ( 3 , 0 ), ( 3 , 1 ) ), PARTITION p3 VALUES IN ( ( 1 , 3 ), ( 2 , 2 ), ( 2 , 3 ), ( 3 , 2 ), ( 3 , 3 ) ) );","title":"5.3.2 LIST COLUMNS \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#54-hash","text":"\u901a\u8fc7 HASH \u8fdb\u884c\u5206\u533a\u4e3b\u8981\u7528\u4e8e\u786e\u4fdd\u5728\u9884\u5b9a\u5206\u533a\u6570\u91cf\u4e4b\u95f4\u5747\u5300\u5730\u5206\u5e03\u6570\u636e\u3002 CREATE TABLE employees ( ... ) PARTITION BY HASH ( expr ) PARTITIONS num ; \u5206\u533a\u952e expr \u662f\u6574\u578b\u7684\u5b57\u6bb5\u6216\u8005\u662f\u8fd4\u56de\u6574\u578b\u7684\u8868\u8fbe\u5f0f\uff0c\u540c\u65f6\u9700\u8981\u6307\u5b9a\u5206\u533a\u6570\u91cf num \u3002 CREATE TABLE employees ( id INT NOT NULL , hired DATE NOT NULL DEFAULT '1970-01-01' , separated DATE NOT NULL DEFAULT '9999-12-31' , ) PARTITION BY HASH ( YEAR ( hired ) ) PARTITIONS 4 ; expr \u5fc5\u987b\u8fd4\u56de\u975e\u5e38\u91cf\u975e\u968f\u673a\u6570\u7684\u6574\u578b\u503c\u3002\u975e\u5e38\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8868\u8fbe\u5f0f\u8d8a\u63a5\u8fd1\u5b83\u6240\u57fa\u4e8e\u7684\u5217\u7684\u503c\uff0cMySQL\u5c31\u8d8a\u6709\u6548\u5730\u4f7f\u7528\u8868\u8fbe\u5f0f\u8fdb\u884c\u6563\u5217\u5206\u533a\u3002\u901a\u8fc7 \u53d6\u6a21\u8fd0\u7b97 \u8ba1\u7b97\u5b58\u50a8\u7684\u5206\u533a\u53f7\uff1a N = MOD( expr , num )\u3002 \u5e38\u89c4HASH\u5206\u533a\u8ba9\u6bcf\u4e2a\u5206\u533a\u7ba1\u7406\u7684\u6570\u636e\u90fd\u51cf\u5c11\u4e86\uff0c\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\uff1b\u4f46\u662f\u5728\u5206\u533a\u7ba1\u7406\u4e0a\u7684\u4ee3\u4ef7\u592a\u5927\uff0c\u6545\u63d0\u4f9b\u4e86\u7ebf\u6027\u5206\u533a LINEAR HASH Partitioning \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","title":"5.4 HASH \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#541-linear-hash","text":"\u7ebf\u6027\u6563\u5217\u5229\u7528\u7ebf\u6027\u4e8c\u6b21\u5e42\u7b97\u6cd5\uff0c\u800c\u5e38\u89c4\u6563\u5217\u4f7f\u7528\u6563\u5217\u51fd\u6570\u503c\u7684\u6a21\u6570\u3002 CREATE TABLE employees ( ... ) PARTITION BY LINEAR HASH ( expr ) PARTITIONS num ; \u5206\u533a\u53f7 N \u901a\u8fc7\u4ee5\u4e0b\u7b97\u6cd5\u8ba1\u7b97\uff1a \u627e\u5230\u4e0b\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e num \u76842\u7684\u5e42 V V = POWER ( 2 , CEILING ( LOG ( 2 , num ))) \u8bbe\u7f6e N = expr & (V - 1) While N >= num : Set V = V / 2 Set N = N & ( V - 1) \u4e3e\u4f8b\uff1a CREATE TABLE t1 ( col1 INT , col2 CHAR ( 5 ), col3 DATE ) PARTITION BY LINEAR HASH ( YEAR ( col3 ) ) PARTITIONS 6 ; V = POWER ( 2 , CEILING ( LOG ( 2 , 6 ) )) = 8 N = YEAR ( '1998-10-19' ) & ( 8 - 1 ) = 1998 & 7 = 6 ( 6 >= 6 is TRUE : additional step required ) N = 6 & (( 8 / 2 ) - 1 ) = 6 & 3 = 2 ( 2 >= 6 is FALSE : record stored in partition #2) \u5f53\u7ebf\u6027\u5206\u533a\u7684\u5206\u533a\u6570\u662f 2\u7684N\u6b21\u5e42 \u65f6\uff0c\u5b83\u4e0e\u5e38\u89c4\u5206\u533a\u7684\u7ed3\u679c\u662f\u4e00\u81f4\u7684\u3002 \u4f18\u7f3a\u70b9\uff1a \u4f18\u70b9\uff1a\u5728\u5206\u533a\u7ba1\u7406\uff08\u589e\u52a0\u3001\u5220\u9664\u3001\u5408\u5e76\u3001\u62c6\u5206\uff09\u65f6\uff0c\u5904\u7406\u66f4\u52a0\u8fc5\u901f \u7f3a\u70b9\uff1a\u76f8\u5bf9\u4e8e\u5e38\u89c4HASH\u5206\u533a\uff0c\u7ebf\u6027\u5206\u533a\u6570\u636e\u5206\u5e03\u4e0d\u592a\u5747\u5300\u3002","title":"5.4.1 LINEAR HASH \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#55-key","text":"\u7c7b\u4f3c\u4e8eHASH\u5206\u533a\uff0c\u4f46\u662f\u4f7f\u7528MySQL\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u54c8\u5e0c\u51fd\u6570\u3002NDB Cluster \u4f7f\u7528MD5()\uff1b\u5176\u5b83\u7684\u4f7f\u7528\u57fa\u4e8e\u5bc6\u7801\u52a0\u5bc6\u7b97\u6cd5\u7684\u54c8\u5e0c\u51fd\u6570\u3002 CREATE TABLE employees ( ... ) PARTITION BY KEY ( expr ) PARTITIONS num ; \u5206\u533a\u952e expr \u662f0\u6216\u591a\u4e2a\u5b57\u6bb5\u540d\uff0c\u652f\u6301\u9664BLOB\u6216TEXT\u4e4b\u5916\u7684\u5176\u5b83\u7c7b\u578b\u4f5c\u4e3a\u5206\u533a\u952e\uff08\u67e5\u770b\u4e0a\u6587**\u5206\u533a\u7c7b\u578b \uff09\u3002\u7528\u4f5c\u5206\u533a\u952e\u7684\u4efb\u4f55\u5217\u5fc5\u987b\u5305\u542b\u8868\u7684\u4e3b\u952e\u7684\u90e8\u5206\u6216\u5168\u90e8\uff0c\u5982\u679c\u8868\u6709\u4e00\u4e2a\u3002\u5982\u679c\u6ca1\u6709\u5c06\u5217\u540d\u6307\u5b9a\u4e3a\u5206\u533a\u952e\uff0c\u5219\u4f7f\u7528\u8868\u7684\u4e3b\u952e\uff08\u5982\u679c\u6709\uff09\u3002\u5728\u6ca1\u6709\u4e3b\u952e\u65f6\uff0c\u9009\u62e9 *\u552f\u4e00\u975e\u7a7a\u952e \u4f5c\u4e3a\u5206\u533a\u952e\u3002 \u6ce8\u610f\uff1a\u4e0d\u80fd\u6267\u884c ALTER TABLE DROP PRIMARY KEY \u5220\u9664key\u7c7b\u578b\u7684\u5206\u533a\uff0c\u4f46\u662fNDB Cluster\u53ef\u4ee5\u3002","title":"5.5 KEY \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#551-linear-key","text":"\u4e0e\u7ebf\u6027HASH\u5206\u533a\u7c7b\u4f3c\u3002","title":"5.5.1 LINEAR KEY \u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#56","text":"\u5b50\u5206\u533a\uff08 Subpartitioning \uff09\u4e5f\u79f0\u4e3a\u590d\u5408\u5206\u533a\uff0c\u662f\u5bf9\u5206\u533a\u8868\u4e2d\u5206\u533a\u7684\u8fdb\u4e00\u6b65\u5212\u5206\u3002 \u521b\u5efa\u8bed\u6cd5\u89c1\u4e0a\u6587\u3002 \u652f\u6301\u5bf9RANGE\u5206\u533a\u548cLIST\u5206\u533a\u5212\u5206\u7684\u8868\u518d\u5212\u5206\uff0c\u5b50\u5206\u533a\u53c8\u652f\u6301HASH \u5206\u533a\u7c7b\u578b\u548cKEY \u5206\u533a\u7c7b\u578b\u3002 \u4f8b\uff1a -- \u7b2c\u4e00\u79cd\u5199\u6cd5 CREATE TABLE ts ( id INT , purchased DATE ) PARTITION BY RANGE ( YEAR ( purchased ) ) SUBPARTITION BY HASH ( TO_DAYS ( purchased ) ) SUBPARTITIONS 2 ( PARTITION p0 VALUES LESS THAN ( 1990 ), PARTITION p1 VALUES LESS THAN ( 2000 ), PARTITION p2 VALUES LESS THAN MAXVALUE ); -- \u7b2c\u4e8c\u79cd\u5199\u6cd5 CREATE TABLE ts ( id INT , purchased DATE ) PARTITION BY RANGE ( YEAR ( purchased ) ) SUBPARTITION BY HASH ( TO_DAYS ( purchased ) ) ( PARTITION p0 VALUES LESS THAN ( 1990 ) ( SUBPARTITION s0 , SUBPARTITION s1 ), PARTITION p1 VALUES LESS THAN ( 2000 ) ( SUBPARTITION s2 , SUBPARTITION s3 ), PARTITION p2 VALUES LESS THAN MAXVALUE ( SUBPARTITION s4 , SUBPARTITION s5 ) ); ts \u8868\u6709\u4e09\u4e2a\u5206\u533a\uff1a p0, p1, p2 \uff0c\u6bcf\u4e2a\u5206\u533a\u518d\u8fdb\u4e00\u6b65\u5212\u5206\u4e3a\u4e24\u4e2a\u5206\u533a\uff0c\u6240\u6709\u5171\u6709 2*3 = 6 \u4e2a\u5206\u533a\u3002 \u6ce8\u610f\u4e8b\u9879\uff1a \u6bcf\u4e2a\u5206\u533a\u5fc5\u987b\u6709\u76f8\u540c\u6570\u91cf\u7684\u5b50\u5206\u533a \u4e0d\u5141\u8bb8\u53ea\u5bf9\u4e00\u90e8\u5206\u5206\u533a\u5b9a\u4e49\u5b50\u5206\u533a \u5728\u6574\u4e2a\u8868\u4e2d\u6bcf\u4e2a\u5b50\u5206\u533a\u7684\u540d\u79f0\u5fc5\u987b\u662f\u552f\u4e00\u7684 \u5f53NO_DIR_IN_CREATE\u670d\u52a1\u5668SQL\u6a21\u5f0f\u751f\u6548\u65f6\uff08\u4e0d\u6307\u5b9a\u8be5\u6a21\u5f0f\u4e5f\u4e0d\u53ef\u7528\uff09\uff0c\u5206\u533a\u5b9a\u4e49\u4e2d\u4e0d\u5141\u8bb8\u4f7f\u7528DATA DIRECTORY\u548cINDEX DIRECTORY\u9009\u9879\u3002\u4eceMySQL 5.5.5\u5f00\u59cb\uff0c\u5728\u5b9a\u4e49\u5b50\u5206\u533a\u65f6\u4e5f\u4e0d\u5141\u8bb8\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u3002\u5b9e\u9645\u64cd\u4f5c\u53ef\u77e5\uff1a\u5373\u4f7f\u4f60\u6dfb\u52a0\u4e86\u8fd9\u4e24\u4e2a\u9009\u9879\uff0c\u518d\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e5f\u4f1a\u5ffd\u7565\u5b83\u4eec\u3002 -- \u9009\u9879\u65e0\u6548\uff01 MariaDB [ MYISAM_TEST ] > CREATE TABLE sub_par_test ( id INT ) ENGINE = MYISAM PARTITION BY RANGE ( id ) SUBPARTITION BY HASH ( id ) -> ( -> PARTITION P0 VALUES LESS THAN ( 10 ) ( -> SUBPARTITION S01 DATA DIRECTORY = '/tmp/sub/data/s01' INDEX DIRECTORY = '/tmp/sub/index/s01' , -> SUBPARTITION S02 DATA DIRECTORY = '/tmp/sub/data/s02' INDEX DIRECTORY = '/tmp/sub/index/s02' -> ), -> PARTITION P1 VALUES LESS THAN ( MAXVALUE ) ( -> SUBPARTITION S03 DATA DIRECTORY = '/tmp/sub/data/s03' INDEX DIRECTORY = '/tmp/sub/index/s03' , -> SUBPARTITION S04 DATA DIRECTORY = '/tmp/sub/data/s04' INDEX DIRECTORY = '/tmp/sub/index/s04' -> ) -> ); MariaDB [ MYISAM_TEST ] > SHOW WARNINGS ; +---------+------+----------------------------------+ | Level | Code | Message | +---------+------+----------------------------------+ | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | | Warning | 1618 | < DATA DIRECTORY > option ignored | | Warning | 1618 | < INDEX DIRECTORY > option ignored | +---------+------+----------------------------------+","title":"5.6 \u5b50\u5206\u533a"},{"location":"mysql/23. MySQL\u5206\u533a/#57-mysqlnull","text":"Note NULL \u4e0d\u662f\u4e00\u4e2a\u6570\u5b57\u3002 MySQL\u7684\u5206\u533a\u5b9e\u73b0\u5c06NULL\u89c6\u4e3a \u5c0f\u4e8e\u4efb\u4f55\u975eNULL\u503c \uff0c\u5c31\u50cfORDER BY\u4e00\u6837\u3002","title":"5.7 MySQL\u5206\u533a\u5982\u4f55\u5904\u7406NULL"},{"location":"mysql/23. MySQL\u5206\u533a/#571-range-partitioning","text":"\u5982\u679c\u8ba1\u7b97\u8fc7\u540e\u5206\u533a\u952e\u7684\u503c\u4e3aNULL\uff0c\u5c06\u8be5\u8bb0\u5f55\u63d2\u5165\u5230 \u6700\u4f4e\u7684\u5206\u533a \u4e2d\u3002","title":"5.7.1 RANGE partitioning"},{"location":"mysql/23. MySQL\u5206\u533a/#572-list-partitioning","text":"\u6709\u4e00\u4e2a\u5206\u533a\u7684\u503c \u5305\u542bNULL \u65f6\uff0c\u7531LIST\u5206\u533a\u7684\u8868\u624d\u5141\u8bb8NULL\u503c\u3002","title":"5.7.2 LIST partitioning"},{"location":"mysql/23. MySQL\u5206\u533a/#573-hash-and-key-partitioning","text":"NULL\u503c\u88ab\u89c6\u4e3a \u96f6 \u3002","title":"5.7.3 HASH and KEY partitioning"},{"location":"mysql/23. MySQL\u5206\u533a/#6","text":"\u52a8\u4f5c\uff1a\u6dfb\u52a0\u3001\u5220\u9664\u3001\u91cd\u7ec4\uff08\u5408\u5e76\u3001\u5206\u79bb\uff09\u3002\u4f7f\u7528 ALTER TABLE \u8bed\u53e5\u5e26\u6709\u7684 partition_options \u5b50\u53e5\u6267\u884c\uff0c\u4e0e\u521b\u5efa\u5206\u533a\u7684\u8bed\u6cd5\u76f8\u540c\u3002\u8fd9\u4e9b\u52a8\u4f5c\u4f1a\u6d89\u53ca\u5230\u6570\u636e\u7684\u8fc1\u79fb\u3002 Note \u6240\u6709\u7684\u5206\u533a\u90fd\u5fc5\u987b\u6709\u76f8\u540c\u6570\u91cf\u7684\u5b50\u5206\u533a\uff0c\u5e76\u4e14\u5b50\u5206\u533a\u4e00\u65e6\u521b\u5efa\u5c31\u4e0d\u53ef\u6539\u53d8\u3002\u540c\u4e00\u6761\u8bed\u53e5\u4e2d\u53ea\u6709\u4e00\u4e2a\u52a8\u4f5c\u53ef\u4ee5\u88ab\u6267\u884c\u3002","title":"6. \u5206\u533a\u7ba1\u7406"},{"location":"mysql/23. MySQL\u5206\u533a/#61-range-and-list","text":"","title":"6.1 RANGE and LIST \u7684\u7ba1\u7406"},{"location":"mysql/23. MySQL\u5206\u533a/#611","text":"ALTER TABLE ... DROP PARTITION ... mysql > ALTER TABLE tr DROP PARTITION p2 ; Query OK , 0 rows affected ( 0 . 03 sec ) \u5206\u533a\u4e2d\u7684\u6570\u636e\u540c\u65f6\u4e5f\u88ab\u5220\u9664\u3002 NDBCLUSTER \u5b58\u50a8\u5f15\u64ce\u4e0d\u652f\u6301\u8be5\u64cd\u4f5c\u3002","title":"6.1.1 \u5220\u9664"},{"location":"mysql/23. MySQL\u5206\u533a/#612","text":"ALTER TABLE ... ADD PARTITION partition_definitions RANGE\u53ea\u80fd\u5728\u5206\u533a\u5c3e\u90e8\u6dfb\u52a0\u65b0\u7684\u5206\u533a\uff0c\u5e76\u4e14\u5176\u8303\u56f4\u6bd4\u5b58\u5728\u7684\u5206\u533a\u90fd\u5927\u3002 ALTER TABLE members ADD PARTITION ( PARTITION p3 VALUES LESS THAN ( 2010 )); ALTER TABLE tt ADD PARTITION ( PARTITION p2 VALUES IN ( 7 , 14 , 21 ), PARTITION p3 VALUES IN ( 1 )); LIST\u5206\u533a\u4e0d\u80fd\u5305\u542b \u91cd\u590d\u7684\u503c \u3002","title":"6.1.2 \u6dfb\u52a0"},{"location":"mysql/23. MySQL\u5206\u533a/#613","text":"ALTER TABLE table_name REORGANIZE PARTITION partition_names INTO ( partition_definitions ) \u6570\u636e\u4f1a\u5b58\u50a8\u5728\u65b0\u7684\u5206\u533a\u4e0a\u3002 \u5206\u79bb\u5206\u533a\uff1a ALTER TABLE members REORGANIZE PARTITION p0 INTO ( PARTITION n0 VALUES LESS THAN ( 1970 ), PARTITION n1 VALUES LESS THAN ( 1980 ) ); \u5408\u5e76\u5206\u533a\uff1a ALTER TABLE members REORGANIZE PARTITION s0 , s1 INTO ( PARTITION p0 VALUES LESS THAN ( 1970 ) ); \u5206\u79bb\u4e0e\u5408\u5e76\u7684\u5173\u7cfb\u4e0d\u5fc5\u662f\u4e00\u5bf9\u591a\u6216\u591a\u5bf9\u4e00\uff0c\u53ef\u4ee5\u662f \u591a\u5bf9\u591a \uff1a ALTER TABLE members REORGANIZE PARTITION p0 , p1 , p2 , p3 INTO ( PARTITION m0 VALUES LESS THAN ( 1980 ), PARTITION m1 VALUES LESS THAN ( 2000 ) ); Warning RANGE\u5206\u533a\u4e0d\u80fd\u8de8\u8303\u56f4\u91cd\u7ec4\u3002\u4f8b\u5982\uff1a\u4e0d\u80fd\u91cd\u7ec4\u2018p0,p2\u2019\uff0c\u800c\u8df3\u8fc7p1\u3002 \u4e0d\u80fd\u4f7f\u7528\u91cd\u7ec4\u8bed\u53e5\u6539\u53d8\u5206\u533a\u7c7b\u578b\uff0c\u4ee5\u53ca\u6539\u53d8\u5206\u533a\u952e expr \uff1b\u4f7f\u7528 ALTER TABLE ... PARTITION BY ... \u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\u3002","title":"6.1.3 \u91cd\u7ec4"},{"location":"mysql/23. MySQL\u5206\u533a/#62-hash-and-key","text":"\u8fd9\u4e24\u4e2a\u5206\u533a\u6ca1\u6709\u5206\u533a\u540d\uff0c\u4e0d\u80fd\u4f7f\u7528\u548c\u5206\u533a\u540d\u76f8\u5173\u7684\u8bed\u53e5\u8fdb\u884c\u7ba1\u7406\u3002","title":"6.2 HASH and KEY \u7684\u7ba1\u7406"},{"location":"mysql/23. MySQL\u5206\u533a/#621","text":"\u4e0d\u53ef\u5220\u9664\u6307\u5b9a\u5206\u533a\uff0c\u4f7f\u7528\u5982\u4e0b\u8bed\u53e5\u5408\u5e76\u5206\u533a\uff1a ALTER TABLE table_name COALESCE PARTITION number number \u662f\u8981\u5408\u5e76\u5230\u5176\u4f59\u5206\u533a\u7684\u5206\u533a\u6570\uff0c\u5373\u5220\u9664\u7684\u5206\u533a\u6570\u3002 MariaDB [ MYISAM_TEST ] > ALTER TABLE hash_par COALESCE PARTITION 2 ; Query OK , 4 rows affected ( 0 . 11 sec ) Records : 4 Duplicates : 0 Warnings : 0","title":"6.2.1 \u5220\u9664"},{"location":"mysql/23. MySQL\u5206\u533a/#622","text":"ALTER TABLE table_name ADD PARTITION PARTITIONS number number \u662f\u6dfb\u52a0\u7684\u5206\u533a\u6570\u3002","title":"6.2.2 \u6dfb\u52a0"},{"location":"mysql/23. MySQL\u5206\u533a/#623","text":"\u901a\u8fc7\u5220\u9664\u548c\u6dfb\u52a0\u5b9e\u73b0\u3002 \u5b50\u5206\u533a\u4f1a\u81ea\u52a8\u7684\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff1a MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE sub_par_test \\ G ; CREATE TABLE `sub_par_test` ( `id` int ( 11 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (id) SUBPARTITION BY HASH (id) (PARTITION P0 VALUES LESS THAN (10) (SUBPARTITION S01 ENGINE = MyISAM, SUBPARTITION S02 ENGINE = MyISAM), PARTITION P1 VALUES LESS THAN MAXVALUE (SUBPARTITION S03 ENGINE = MyISAM, SUBPARTITION S04 ENGINE = MyISAM)) */ MariaDB [ MYISAM_TEST ] > ALTER TABLE sub_par_test REORGANIZE PARTITION P0 INTO ( PARTITION P00 VALUES LESS THAN ( 5 ), PARTITION P01 VALUES LESS THAN ( 10 )); Query OK , 2 rows affected ( 0 . 01 sec ) Records : 2 Duplicates : 0 Warnings : 0 MariaDB [ MYISAM_TEST ] > SHOW CREATE TABLE sub_par_test \\ G ; CREATE TABLE `sub_par_test` ( `id` int ( 11 ) DEFAULT NULL ) ENGINE = MyISAM DEFAULT CHARSET = utf8 /*!50100 PARTITION BY RANGE (id) SUBPARTITION BY HASH (id) (PARTITION P00 VALUES LESS THAN (5) (SUBPARTITION P00sp0 ENGINE = MyISAM, SUBPARTITION P00sp1 ENGINE = MyISAM), PARTITION P01 VALUES LESS THAN (10) (SUBPARTITION P01sp0 ENGINE = MyISAM, SUBPARTITION P01sp1 ENGINE = MyISAM), PARTITION P1 VALUES LESS THAN MAXVALUE (SUBPARTITION S03 ENGINE = MyISAM, SUBPARTITION S04 ENGINE = MyISAM)) */","title":"6.2.3 \u91cd\u7ec4"},{"location":"mysql/23. MySQL\u5206\u533a/#63","text":"\u7ef4\u62a4\u52a8\u4f5c\uff1a CHECK TABLE , OPTIMIZE TABLE , ANALYZE TABLE , and REPAIR TABLE \u3002 \u8bed\u6cd5\uff1a ALTER TABLE table_name action PARTITION { partition_names | ALL } \u91cd\u6784\u5206\u533a \uff1a\u4e22\u5f03\uff08drop\uff09\u5206\u533a\u6240\u6709\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u91cd\u65b0\u63d2\u5165\u6570\u636e\u3002\u5bf9\u4e8e\u788e\u7247\u6574\u7406\u5f88\u6709\u7528\u5904\u3002 ALTER TABLE t1 REBUILD PARTITION p0 , p1 ; \u4f18\u5316\u5206\u533a \uff1a\u82e5\u5220\u9664\u4e86\u4e00\u4e2a\u5206\u533a\u7684\u5927\u91cf\u6570\u636e\uff0c\u6216\u8005\u5728\u53ef\u53d8\u7c7b\u578b\u7684\u5b57\u6bb5\u505a\u51fa\u4e86\u5f88\u591a\u6539\u53d8\uff0c\u53ef\u4f7f\u7528\u6b64\u8bed\u53e5\u6765\u56de\u6536\u672a\u4f7f\u7528\u7684\u7a7a\u95f4\u548c\u4f18\u5316\u5206\u533a\u6570\u636e\u6587\u4ef6\u3002 ALTER TABLE t1 OPTIMIZE PARTITION p0 , p1 ; \u8fd0\u884c OPTIMIZE PARTITION \u4e0e\u8fd0\u884c CHECK PARTITION , ANALYZE PARTITION , and REPAIR PARTITION \u7b49\u4ef7\u3002 \u4e00\u4e9b\u5b58\u50a8\u5f15\u64ce\uff08\u5982InnoDB\uff09\uff0c\u4e0d\u652f\u6301\u5bf9\u5355\u72ec\u7684\u5206\u533a\u4f18\u5316\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6b64\u8bed\u53e5\u5c06\u91cd\u6784\u6574\u4e2a\u8868\u3002\u4eceMySQL 5.5.30\u5f00\u59cb\uff0c\u4f7f\u7528\u6b64\u8bed\u53e5\u5c06\u5bfc\u81f4\u4e00\u4e2abug\uff0c\u4f7f\u7528 ALTER TABLE ... REBUILD PARTITION and ALTER TABLE ... ANALYZE PARTITION \u6765\u907f\u514d\u6574\u4e2a\u95ee\u9898\u3002 \u5206\u6790\u5206\u533a \uff1a\u8bfb\u53d6\u5e76\u5b58\u50a8\u5206\u533a\u7684key\u5206\u5e03\u3002 ALTER TABLE t1 ANALYZE PARTITION p3 ; \u4fee\u590d\u5206\u533a \uff1a\u4fee\u590d\u635f\u574f\u7684\u5206\u533a\u3002 ALTER TABLE t1 REPAIR PARTITION p0 , p1 ; \u68c0\u67e5\u5206\u533a \uff1a\u68c0\u67e5\u5206\u533a\u662f\u5426\u5b58\u5728\u9519\u8bef\u3002\u5176\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5728\u975e\u5206\u533a\u8868\u4f7f\u7528CHECK TABLE\u7684\u65b9\u5f0f\u975e\u5e38\u76f8\u4f3c\u3002 ALTER TABLE trb3 CHECK PARTITION p1 ; \u6b64\u8bed\u53e5\u5c06\u544a\u8bc9\u8868\u4e2d\u7684\u6570\u636e\u6216\u7d22\u5f15\u662f\u5426\u5df2\u635f\u574f\u3002\u53ef\u4ee5\u4f7f\u7528 REPAIR PARTITION \u4fee\u590d\u3002 \u91cd\u5efa\u5206\u533a \uff1a\u5220\u9664\u6307\u5b9a\u5206\u533a\u4ee5\u53ca\u6240\u6709\u6307\u5b9a\u5206\u533a\u7684\u6570\u636e\u5e76\u521b\u5efa\u65b0\u5206\u533a\u3002\u5176\u4f7f\u7528\u65b9\u5f0f\u4e0e\u5728\u975e\u5206\u533a\u8868\u4f7f\u7528TRUNCATE TABLE\u7684\u65b9\u5f0f\u975e\u5e38\u76f8\u4f3c\u3002\u4eceMySQL 5.5.0\u5f00\u59cb\u3002 ALTER TABLE hash_par TRUNCATE PARTITION ALL ; mysqlcheck and myisamchk \u4e0d\u652f\u6301\u5206\u533a\u8868\u3002 ANALYZE , CHECK , OPTIMIZE , REBUILD , REPAIR , and TRUNCATE \u64cd\u4f5c\u4e0d\u652f\u6301\u5b50\u5206\u533a\u3002","title":"6.3 \u5206\u533a\u7684\u7ef4\u62a4"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/","text":"1. \u5206\u533a\u9650\u5236 1.1 \u5206\u533a\u952e\uff0c\u4e3b\u952e\uff0c\u552f\u4e00\u952e 1.2 \u4e0e\u5b58\u50a8\u5f15\u64ce\u76f8\u5173\u7684\u5206\u533a\u9650\u5236 1.3 \u4e0e\u51fd\u6570\u76f8\u5173\u7684\u5206\u533a\u9650\u5236 1.4 \u5206\u533a\u548c\u8868\u7ea7\u9501\u5b9a 1.4.1 DML \u8bed\u53e5 1.4.2 DDL \u8bed\u53e5 1.4.3 \u5176\u5b83\u8bed\u53e5 1. \u5206\u533a\u9650\u5236 \u00b6 \u5212\u5206\u8868\u8fbe\u5f0f\u4e0d\u5141\u8bb8\u7684\u7ed3\u6784\uff1a \u5b58\u50a8\u8fc7\u7a0b\uff0c\u5b58\u50a8\u51fd\u6570\uff0cUDFS\uff0c\u63d2\u4ef6 \u58f0\u660e\u6216\u4f7f\u7528\u53d8\u91cf \u90e8\u5206\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\u7b26\u4e0d\u5141\u8bb8\u5728\u5212\u5206\u8868\u8fbe\u5f0f\u4e2d\u51fa\u73b0\uff1a \u9664\u6cd5\u8fd0\u7b97\u7b26\uff1a / \u4f4d\u8fd0\u7b97\u7b26\uff1a |, &, ^, <<, >>, ~ MySQL 5.5 \u4e0d\u652f\u6301\u5728\u5206\u533a\u8868\u4e2d\u4f7f\u7528 HANDLER \u8bed\u53e5 \u521b\u5efa\u5206\u533a\u8868\u4e4b\u540e\u4e0d\u8981\u6539\u53d8\u6a21\u5f0f MySQL mode \u6027\u80fd\u65b9\u9762 \u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u3002\u5206\u533a\u4e0e\u91cd\u65b0\u5206\u533a\u7684\u64cd\u4f5c\u57fa\u4e8e\u6587\u4ef6\u7cfb\u7edf\u5bf9\u5b83\u4eec\u7684\u9650\u5236\uff0c\u6240\u4ee5\u901f\u5ea6\u7684\u5feb\u6162\u4e0e\u6587\u4ef6\u7cfb\u7edf\u7684\u7c7b\u578b\u3001\u5b57\u7b26\u96c6\u3001\u78c1\u76d8\u901f\u5ea6\u7b49\u90fd\u6709\u5173\u7cfb\u3002\u7279\u522b\u7684\uff0c\u5e94\u8be5\u4fdd\u8bc1 large_files_support \u53ef\u7528\u5e76\u4e14\u5408\u9002\u5730\u8bbe\u7f6e open_files_limit \u3002 MyISAM\u548c\u5206\u533a\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5\u3002MyISAM\u4e3a\u6bcf\u4e2a\u5206\u533a\u4f7f\u7528\u4e24\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c \u5e76\u4e14\u5728\u64cd\u4f5c\u6570\u636e\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u6240\u6709\u7684\u5206\u533a \u3002\u5728\u4f60\u91cd\u65b0\u5212\u5206\u5206\u533a\u540e\uff0cMyISAM\u4e0d\u4f1a\u5220\u9664\u539f\u6765\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u800c\u662f\u7ee7\u7eed\u6269\u5f20\u65b0\u7684\u5206\u533a\u5927\u5c0f\u7684\u6570\u91cf\uff0c\u8fd9\u662fMyISAM\u7684\u8bbe\u8ba1\u51b3\u5b9a\u7684\u3002\u6bd4\u5982\u539f\u6765\u6709100\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u5c31\u6709200\u4e2a\u6587\u4ef6\u53bb\u5b58\u50a8\uff0c\u73b0\u5728\u91cd\u65b0\u5212\u5206\uff0c\u53d8\u6210101\u4e2a\u5206\u533a\u3002\u6b64\u65f6\u6709402\u4e2a\u6587\u4ef6\u53bb\u5b58\u50a8\u3002 \u8868\u9501\u3002\u5206\u533a\u64cd\u4f5c\u4f1a\u5728\u8868\u4e0a\u83b7\u53d6\u5199\u9501\u3002\u8bfb\u53d6\u8868\u7684\u64cd\u4f5c\u51e0\u4e4e\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff1b\u4e00\u65e6\u5206\u533a\u64cd\u4f5c\u5b8c\u6210\uff0c\u5c31\u6267\u884c\u6302\u8d77\u7684INSERT\u548cUPDATE\u64cd\u4f5c\u3002 \u5b58\u50a8\u5f15\u64ce\u3002\u5bf9\u4e8eMyISAM\u8868\u800c\u8a00\uff0c\u5206\u533a\u64cd\u4f5c\uff0c\u67e5\u8be2\u548c\u66f4\u65b0\u64cd\u4f5c\u901a\u5e38\u6bd4\u4f7f\u7528InnoDB\u6216NDB\u8868\u66f4\u5feb\u3002 LOAD DATA\u3002\u5728MySQL 5.5\u4e2d\uff0cLOAD DATA\u4f7f\u7528\u7f13\u51b2\u6765\u63d0\u9ad8\u6027\u80fd\u3002\u60a8\u5e94\u8be5\u77e5\u9053\u6bcf\u4e2a\u5206\u533a\u7684\u7f13\u51b2\u533a\u4f7f\u7528130 KB\u5185\u5b58\u6765\u5b9e\u73b0\u6b64\u76ee\u7684\u3002 \u6700\u5927\u5206\u533a\u6570\u3002\u4e00\u5f20\u8868\u6700\u591a\u67091024\uff08\u5305\u62ec\u5b50\u5206\u533a\uff09\u4e2a\u5206\u533a\uff0cNDB\u5b58\u50a8\u5f15\u64ce\u4e0d\u53d7\u6b64\u9650\u5236\u3002 \u4e0d\u652f\u6301\u67e5\u8be2\u7f13\u5b58\u3002 \u6bcf\u4e2a\u5206\u533a\u7684 key caches \u3002\u5728MySQL 5.5\u4e2d\uff0cCACHE INDEX\u548cLOAD INDEX INTO CACHE\u8bed\u53e5\u652f\u6301MyISAM\u5206\u533a\u8868\u7684key caches\u3002 InnoDB\u5206\u533a\u8868\u4e0d\u652f\u6301\u5916\u952e\u3002 ALTER TABLE ... ORDER BY\u3002\u5bfc\u81f4\u4ec5\u5728\u6bcf\u4e2a\u5206\u533a\u5185\u5bf9\u8bb0\u5f55\u6392\u5e8f\u3002 \u901a\u8fc7\u4fee\u6539\u4e3b\u952e\u5bf9REPLACE\u8bed\u53e5\u7684\u5f71\u54cd\u3002see Section 19.5.1, \u201cPartitioning Keys, Primary Keys, and Unique Keys\u201d and REPLACE \u5b8c\u6574TEXT\u7d22\u5f15\u3002\u4e0d\u652f\u6301 FULLTEXT \u7d22\u5f15\u6216\u641c\u7d22\u3002 \u7a7a\u95f4\u7c7b\u578b\u7684\u5217\u3002\u5177\u6709\u7a7a\u95f4\u6570\u636e\u7c7b\u578b\uff08\u5982POINT\u6216GEOMETRY\uff09\u7684\u5217\u4e0d\u80fd\u5728\u5206\u533a\u8868\u4e2d\u4f7f\u7528\u3002 \u4e34\u65f6\u8868\u3001log\u8868\u4e0d\u80fd\u5206\u533a\u3002 \u5206\u533a\u952e\u7684\u7c7b\u578b\u3002\u5206\u533a\u952e\u5fc5\u987b\u662f\u6574\u6570\u5217\u6216\u89e3\u6790\u4e3a\u6574\u6570\u7684\u8868\u8fbe\u5f0f\u3002\u53ef\u4ee5\u63a5\u53d7NULL\u503c\u3002\u4e0d\u80fd\u662f\u5b50\u67e5\u8be2\u3002 \u5b50\u5206\u533a\u3002\u53ea\u6709 RANGE \u548c LIST \u8868\u652f\u6301\u5b50\u5206\u533a\uff0c\u5e76\u4e14\u5b50\u5206\u533a\u7684\u7c7b\u578b\u5fc5\u987b\u662f HASH \u6216 KEY \u5206\u533a\u3002 SUBPARTITION BY KEY \u8981\u6c42\u5fc5\u987b\u6307\u660e\u5206\u533a\u7684\u5b57\u6bb5\u6216\u5b57\u6bb5\u5217\u8868\u3002 \u4e0d\u652f\u6301 DELAYED \u9009\u9879\u3002\u4e0d\u652f\u6301 INSERT DELAYED \u3002 DATA DIRECTORY and INDEX DIRECTORY \u9009\u9879\u3002 \u7528\u4e8e\u8868\u7ea7\u9009\u9879\u4f1a\u88ab\u5ffd\u7565\u3002 Windows\u4e0d\u652f\u6301\u8fd9\u4e24\u4e2a\u9009\u9879\u3002 mysqlcheck , myisamchk , and myisampack \u4e0d\u652f\u6301\u5206\u533a\u8868\u3002 1.1 \u5206\u533a\u952e\uff0c\u4e3b\u952e\uff0c\u552f\u4e00\u952e \u00b6 \u4e09\u8005\u7684\u5173\u7cfb\uff1a\u5206\u533a\u8868\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u6240\u6709\u5217\u5fc5\u987b\u662f\u8868\u53ef\u80fd\u5177\u6709\u7684\u6bcf\u4e2a\u552f\u4e00\u952e\u7684\u4e00\u90e8\u5206\uff08\u4e3b\u952e\u88ab\u5b9a\u4e49\u4e3a\u552f\u4e00\u952e\uff09\u3002\u6362\u53e5\u8bdd\u8bf4\uff1a \u8868\u4e0a\u7684\u6bcf\u4e2a\u552f\u4e00\u952e\u5fc5\u987b\u4f7f\u7528\u8868\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u4e2d\u7684\u6bcf\u4e00\u5217\u3002 \u5982\u679c\u8868\u4e2d\u6ca1\u6709\u552f\u4e00\u952e\u5219\u4e0d\u53d7\u6b64\u7ea6\u675f\u3002 \u4f8b\u5982\u4e0b\u9762\u8fd9\u4e9b\u662f\u5408\u6cd5\u7684\uff1a CREATE TABLE t1 ( col1 INT NOT NULL , col2 DATE NOT NULL , col3 INT NOT NULL , col4 INT NOT NULL , UNIQUE KEY ( col1 , col2 , col3 ) ) PARTITION BY HASH ( col3 ) PARTITIONS 4 ; CREATE TABLE t2 ( col1 INT NOT NULL , col2 DATE NOT NULL , col3 INT NOT NULL , col4 INT NOT NULL , UNIQUE KEY ( col1 , col3 ) ) PARTITION BY HASH ( col1 + col3 ) PARTITIONS 4 ; 1.2 \u4e0e\u5b58\u50a8\u5f15\u64ce\u76f8\u5173\u7684\u5206\u533a\u9650\u5236 \u00b6 MERGE \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002\u5206\u533a\u8868\u4e5f\u4e0d\u80fd\u5408\u5e76\u3002 FEDERATED \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002 CSV \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002 InnoDB \uff1a\u8868\u4e2d\u4e0d\u80fd\u542b\u6709\u5916\u952e\uff0c\u4e5f\u4e0d\u80fd\u6709\u88ab\u5f15\u7528\u4e3a\u5916\u952e\u7684\u5b57\u6bb5\u3002\u5bf9\u4e8e\u5b50\u5206\u533a\u4e5f\u4e0d\u652f\u6301\u591a\u5757\u78c1\u76d8\u5b58\u50a8\u3002\u5b9e\u64cd\u53d1\u73b0MyISAM\u4e5f\u4e0d\u652f\u6301\u4e86\u3002\u4f18\u5316\u76f8\u5173\u53c2\u8003 \u524d\u6587 \u5206\u533a\u7ef4\u62a4\u7ae0\u8282\u3002 \u7528\u6237\u5b9a\u4e49\u7684\u5206\u533a\u548cNDB\u5b58\u50a8\u5f15\u64ce\uff08NDB\u96c6\u7fa4\uff09 \uff1aNDB\u53ea\u652f\u6301 [LINEAR] KEY \u5206\u533a\u7c7b\u578b\u3002 \u4e00\u5f20\u8868\u7684\u6700\u5927\u7684\u5206\u533a\u6570\u53d6\u51b3\u4e8e\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u6570\u636e\u8282\u70b9\u4e0e\u8282\u70b9\u7ec4\u7684\u6570\u91cf\u3001NDB\u96c6\u7fa4\u7684\u7248\u672c\u3001\u5176\u5b83\u5b9e\u9645\u60c5\u51b5\uff0c See NDB and user-defined partitioning \u3002 NDB\u8868\u4e2d\u6bcf\u4e2a\u5206\u533a\u53ef\u4ee5\u5b58\u50a8\u7684\u6700\u5927\u56fa\u5b9a\u5927\u5c0f\u6570\u636e\u91cf\u4e3a16 GB\u3002 \u5206\u533a\u8868\u5fc5\u987b\u5177\u6709\u663e\u5f0f\u4e3b\u952e\u3002 \u5347\u7ea7\u5206\u533a\u8868\uff1a\u6267\u884c\u5347\u7ea7\u65f6\uff0c\u5fc5\u987b\u8f6c\u50a8\u5e76\u91cd\u65b0\u52a0\u8f7d\u7531 KEY \u5206\u533a\u5e76\u4f7f\u7528\u9664NDB\u4e4b\u5916\u7684\u4efb\u4f55\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u3002 \u6240\u6709\u7684\u5206\u533a\u5fc5\u987b\u4f7f\u7528\u540c\u4e00\u4e2a\u5b58\u50a8\u5f15\u64ce\uff1a\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5e76\u4e14\u5b83\u5fc5\u987b\u4e0e\u6574\u4e2a\u8868\u4f7f\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u76f8\u540c\u3002\u53e6\u5916\uff0c\u5982\u679c\u5728\u521b\u5efa\u6216\u4fee\u6539\u8868\u7684\u65f6\u5019\u5728\u8868\u7684\u7ea7\u522b\u6ca1\u6709\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce\uff0c\u8981\u4e48\u4e0d\u6307\u5b9a\u4efb\u4f55\u4e00\u4e2a[\u5b50]\u5206\u533a\u7684\u5f15\u64ce\uff0c\u8981\u4e48\u5168\u90e8\u6307\u5b9a\u3002 1.3 \u4e0e\u51fd\u6570\u76f8\u5173\u7684\u5206\u533a\u9650\u5236 \u00b6 \u53c2\u8003 \u5206\u533a\u952e\u5141\u8bb8\u4f7f\u7528\u7684Functions 1.4 \u5206\u533a\u548c\u8868\u7ea7\u9501\u5b9a \u00b6 \u5bf9\u4e8e\u5728\u6267\u884cDML\u6216DDL\u8bed\u53e5\u65f6\u5b9e\u9645\u6267\u884c\u8868\u7ea7\u9501\u7684MyISAM\u7b49\u5b58\u50a8\u5f15\u64ce\uff0c\u5f71\u54cd\u5206\u533a\u8868\u7684\u8fd9\u79cd\u8bed\u53e5\u4f1a\u5bf9\u8868\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u9501\u5b9a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u5206\u533a\u90fd\u4f1a\u88ab\u9501\u5b9a\uff0c\u76f4\u5230\u8bed\u53e5\u7ed3\u675f\u3002\u4f8b\u5982\uff0c\u6765\u81eaMyISAM\u7684\u5206\u533a\u8868\u7684SELECT\u4f1a\u5bfc\u81f4\u6574\u4e2a\u8868\u7684\u9501\u5b9a\u3002 \u8fd9\u4f1a\u5bfc\u81f4\u968f\u7740\u5206\u533a\u6570\u91cf\u7684\u589e\u52a0\u4e0b\u9762\u8ba8\u8bba\u7684\u8bed\u53e5\u7684\u6267\u884c\u901f\u5ea6\u56de\u8d8a\u6765\u8d8a\u6162\u3002\u4f46\u662f\u5728MySQL 5.6.6 \u7248\u672c\u5f15\u5165\u4e86\u5206\u533a\u9501\u5b9a\u4fee\u526a\uff08 partition lock pruning \uff09\u5927\u5927\u51cf\u5c11\u4e86\u8fd9\u79cd\u5f71\u54cd\u3002 \u5bf9\u4e8e\u4f7f\u7528\u884c\u7ea7\u9501\u5b9a\u5e76\u4e14\u5728\u5206\u533a\u4fee\u526a\u4e4b\u524d\u4e0d\u4f1a\u5b9e\u9645\u6267\u884c\uff08\u6216\u9700\u8981\u6267\u884c\uff09\u9501\u5b9a\u7684\u5b58\u50a8\u5f15\u64ce\uff08\u5982InnoDB\uff09\uff0c\u60c5\u51b5\u4e0d\u4f1a\u5982\u6b64\u3002 \u4e0b\u9762\u8ba8\u8bba\u5728\u91c7\u7528\u8868\u7ea7\u9501\u5b9a\u7684\u5b58\u50a8\u5f15\u64ce\u7684\u5206\u533a\u8868\u4e0a\u4f7f\u7528MySQL\u8bed\u53e5\u7684\u5f71\u54cd\u3002 1.4.1 DML \u8bed\u53e5 \u00b6 SELECT \u9501\u5b9a\u6574\u4e2a\u8868\u3002\u5305\u62ec UNION \u548c JOIN \u8bed\u53e5\u5305\u542b\u7684\u8868\u3002 UPDATE \u9501\u5b9a\u6574\u4e2a\u8868\u3002 REPLACE \u9501\u5b9a\u6574\u4e2a\u8868\u3002 INSERT\uff08\u5305\u62ec INSERT ... ON DUPLICATE KEY UPDATE \uff09 \u9501\u5b9a\u6574\u4e2a\u8868\u3002 INSERT ... SELECT \u9501\u5b9a\u6e90\u4e0e\u76ee\u6807\u8868\u3002 LOAD DATA \u9501\u5b9a\u6574\u4e2a\u8868\u3002 \u89e6\u53d1\u5668\u6fc0\u6d3b\u65f6\u9501\u5b9a\u6574\u4e2a\u8868\u3002 1.4.2 DDL \u8bed\u53e5 \u00b6 CREATE VIEW \u9501\u5b9a\u5b83\u8bfb\u5230\u7684\u6240\u6709\u5206\u533a\u8868\u3002 ALTER TABLE \u9501\u5b9a\u5f71\u54cd\u5230\u7684\u5206\u533a\u8868\u3002 1.4.3 \u5176\u5b83\u8bed\u53e5 \u00b6 LOCK TABLES \u9501\u5b9a\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u3002 CALL stored_procedure( expr ) \u8c03\u7528\u65f6\u9501\u5b9a\u5728 expr \u4e2d\u6d89\u53ca\u5230\u7684\u6240\u6709\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u3002 ALTER TABLE \u8fd8\u5c06\u5728\u8868\u7ea7\u83b7\u53d6\u5143\u6570\u636e\u9501\u3002","title":"24. MySQL\u5206\u533a\u9650\u5236"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#1","text":"\u5212\u5206\u8868\u8fbe\u5f0f\u4e0d\u5141\u8bb8\u7684\u7ed3\u6784\uff1a \u5b58\u50a8\u8fc7\u7a0b\uff0c\u5b58\u50a8\u51fd\u6570\uff0cUDFS\uff0c\u63d2\u4ef6 \u58f0\u660e\u6216\u4f7f\u7528\u53d8\u91cf \u90e8\u5206\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\u7b26\u4e0d\u5141\u8bb8\u5728\u5212\u5206\u8868\u8fbe\u5f0f\u4e2d\u51fa\u73b0\uff1a \u9664\u6cd5\u8fd0\u7b97\u7b26\uff1a / \u4f4d\u8fd0\u7b97\u7b26\uff1a |, &, ^, <<, >>, ~ MySQL 5.5 \u4e0d\u652f\u6301\u5728\u5206\u533a\u8868\u4e2d\u4f7f\u7528 HANDLER \u8bed\u53e5 \u521b\u5efa\u5206\u533a\u8868\u4e4b\u540e\u4e0d\u8981\u6539\u53d8\u6a21\u5f0f MySQL mode \u6027\u80fd\u65b9\u9762 \u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u3002\u5206\u533a\u4e0e\u91cd\u65b0\u5206\u533a\u7684\u64cd\u4f5c\u57fa\u4e8e\u6587\u4ef6\u7cfb\u7edf\u5bf9\u5b83\u4eec\u7684\u9650\u5236\uff0c\u6240\u4ee5\u901f\u5ea6\u7684\u5feb\u6162\u4e0e\u6587\u4ef6\u7cfb\u7edf\u7684\u7c7b\u578b\u3001\u5b57\u7b26\u96c6\u3001\u78c1\u76d8\u901f\u5ea6\u7b49\u90fd\u6709\u5173\u7cfb\u3002\u7279\u522b\u7684\uff0c\u5e94\u8be5\u4fdd\u8bc1 large_files_support \u53ef\u7528\u5e76\u4e14\u5408\u9002\u5730\u8bbe\u7f6e open_files_limit \u3002 MyISAM\u548c\u5206\u533a\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5\u3002MyISAM\u4e3a\u6bcf\u4e2a\u5206\u533a\u4f7f\u7528\u4e24\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c \u5e76\u4e14\u5728\u64cd\u4f5c\u6570\u636e\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u6240\u6709\u7684\u5206\u533a \u3002\u5728\u4f60\u91cd\u65b0\u5212\u5206\u5206\u533a\u540e\uff0cMyISAM\u4e0d\u4f1a\u5220\u9664\u539f\u6765\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u800c\u662f\u7ee7\u7eed\u6269\u5f20\u65b0\u7684\u5206\u533a\u5927\u5c0f\u7684\u6570\u91cf\uff0c\u8fd9\u662fMyISAM\u7684\u8bbe\u8ba1\u51b3\u5b9a\u7684\u3002\u6bd4\u5982\u539f\u6765\u6709100\u4e2a\u5206\u533a\uff0c\u90a3\u4e48\u5c31\u6709200\u4e2a\u6587\u4ef6\u53bb\u5b58\u50a8\uff0c\u73b0\u5728\u91cd\u65b0\u5212\u5206\uff0c\u53d8\u6210101\u4e2a\u5206\u533a\u3002\u6b64\u65f6\u6709402\u4e2a\u6587\u4ef6\u53bb\u5b58\u50a8\u3002 \u8868\u9501\u3002\u5206\u533a\u64cd\u4f5c\u4f1a\u5728\u8868\u4e0a\u83b7\u53d6\u5199\u9501\u3002\u8bfb\u53d6\u8868\u7684\u64cd\u4f5c\u51e0\u4e4e\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff1b\u4e00\u65e6\u5206\u533a\u64cd\u4f5c\u5b8c\u6210\uff0c\u5c31\u6267\u884c\u6302\u8d77\u7684INSERT\u548cUPDATE\u64cd\u4f5c\u3002 \u5b58\u50a8\u5f15\u64ce\u3002\u5bf9\u4e8eMyISAM\u8868\u800c\u8a00\uff0c\u5206\u533a\u64cd\u4f5c\uff0c\u67e5\u8be2\u548c\u66f4\u65b0\u64cd\u4f5c\u901a\u5e38\u6bd4\u4f7f\u7528InnoDB\u6216NDB\u8868\u66f4\u5feb\u3002 LOAD DATA\u3002\u5728MySQL 5.5\u4e2d\uff0cLOAD DATA\u4f7f\u7528\u7f13\u51b2\u6765\u63d0\u9ad8\u6027\u80fd\u3002\u60a8\u5e94\u8be5\u77e5\u9053\u6bcf\u4e2a\u5206\u533a\u7684\u7f13\u51b2\u533a\u4f7f\u7528130 KB\u5185\u5b58\u6765\u5b9e\u73b0\u6b64\u76ee\u7684\u3002 \u6700\u5927\u5206\u533a\u6570\u3002\u4e00\u5f20\u8868\u6700\u591a\u67091024\uff08\u5305\u62ec\u5b50\u5206\u533a\uff09\u4e2a\u5206\u533a\uff0cNDB\u5b58\u50a8\u5f15\u64ce\u4e0d\u53d7\u6b64\u9650\u5236\u3002 \u4e0d\u652f\u6301\u67e5\u8be2\u7f13\u5b58\u3002 \u6bcf\u4e2a\u5206\u533a\u7684 key caches \u3002\u5728MySQL 5.5\u4e2d\uff0cCACHE INDEX\u548cLOAD INDEX INTO CACHE\u8bed\u53e5\u652f\u6301MyISAM\u5206\u533a\u8868\u7684key caches\u3002 InnoDB\u5206\u533a\u8868\u4e0d\u652f\u6301\u5916\u952e\u3002 ALTER TABLE ... ORDER BY\u3002\u5bfc\u81f4\u4ec5\u5728\u6bcf\u4e2a\u5206\u533a\u5185\u5bf9\u8bb0\u5f55\u6392\u5e8f\u3002 \u901a\u8fc7\u4fee\u6539\u4e3b\u952e\u5bf9REPLACE\u8bed\u53e5\u7684\u5f71\u54cd\u3002see Section 19.5.1, \u201cPartitioning Keys, Primary Keys, and Unique Keys\u201d and REPLACE \u5b8c\u6574TEXT\u7d22\u5f15\u3002\u4e0d\u652f\u6301 FULLTEXT \u7d22\u5f15\u6216\u641c\u7d22\u3002 \u7a7a\u95f4\u7c7b\u578b\u7684\u5217\u3002\u5177\u6709\u7a7a\u95f4\u6570\u636e\u7c7b\u578b\uff08\u5982POINT\u6216GEOMETRY\uff09\u7684\u5217\u4e0d\u80fd\u5728\u5206\u533a\u8868\u4e2d\u4f7f\u7528\u3002 \u4e34\u65f6\u8868\u3001log\u8868\u4e0d\u80fd\u5206\u533a\u3002 \u5206\u533a\u952e\u7684\u7c7b\u578b\u3002\u5206\u533a\u952e\u5fc5\u987b\u662f\u6574\u6570\u5217\u6216\u89e3\u6790\u4e3a\u6574\u6570\u7684\u8868\u8fbe\u5f0f\u3002\u53ef\u4ee5\u63a5\u53d7NULL\u503c\u3002\u4e0d\u80fd\u662f\u5b50\u67e5\u8be2\u3002 \u5b50\u5206\u533a\u3002\u53ea\u6709 RANGE \u548c LIST \u8868\u652f\u6301\u5b50\u5206\u533a\uff0c\u5e76\u4e14\u5b50\u5206\u533a\u7684\u7c7b\u578b\u5fc5\u987b\u662f HASH \u6216 KEY \u5206\u533a\u3002 SUBPARTITION BY KEY \u8981\u6c42\u5fc5\u987b\u6307\u660e\u5206\u533a\u7684\u5b57\u6bb5\u6216\u5b57\u6bb5\u5217\u8868\u3002 \u4e0d\u652f\u6301 DELAYED \u9009\u9879\u3002\u4e0d\u652f\u6301 INSERT DELAYED \u3002 DATA DIRECTORY and INDEX DIRECTORY \u9009\u9879\u3002 \u7528\u4e8e\u8868\u7ea7\u9009\u9879\u4f1a\u88ab\u5ffd\u7565\u3002 Windows\u4e0d\u652f\u6301\u8fd9\u4e24\u4e2a\u9009\u9879\u3002 mysqlcheck , myisamchk , and myisampack \u4e0d\u652f\u6301\u5206\u533a\u8868\u3002","title":"1. \u5206\u533a\u9650\u5236"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#11","text":"\u4e09\u8005\u7684\u5173\u7cfb\uff1a\u5206\u533a\u8868\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u6240\u6709\u5217\u5fc5\u987b\u662f\u8868\u53ef\u80fd\u5177\u6709\u7684\u6bcf\u4e2a\u552f\u4e00\u952e\u7684\u4e00\u90e8\u5206\uff08\u4e3b\u952e\u88ab\u5b9a\u4e49\u4e3a\u552f\u4e00\u952e\uff09\u3002\u6362\u53e5\u8bdd\u8bf4\uff1a \u8868\u4e0a\u7684\u6bcf\u4e2a\u552f\u4e00\u952e\u5fc5\u987b\u4f7f\u7528\u8868\u7684\u5206\u533a\u8868\u8fbe\u5f0f\u4e2d\u7684\u6bcf\u4e00\u5217\u3002 \u5982\u679c\u8868\u4e2d\u6ca1\u6709\u552f\u4e00\u952e\u5219\u4e0d\u53d7\u6b64\u7ea6\u675f\u3002 \u4f8b\u5982\u4e0b\u9762\u8fd9\u4e9b\u662f\u5408\u6cd5\u7684\uff1a CREATE TABLE t1 ( col1 INT NOT NULL , col2 DATE NOT NULL , col3 INT NOT NULL , col4 INT NOT NULL , UNIQUE KEY ( col1 , col2 , col3 ) ) PARTITION BY HASH ( col3 ) PARTITIONS 4 ; CREATE TABLE t2 ( col1 INT NOT NULL , col2 DATE NOT NULL , col3 INT NOT NULL , col4 INT NOT NULL , UNIQUE KEY ( col1 , col3 ) ) PARTITION BY HASH ( col1 + col3 ) PARTITIONS 4 ;","title":"1.1 \u5206\u533a\u952e\uff0c\u4e3b\u952e\uff0c\u552f\u4e00\u952e"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#12","text":"MERGE \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002\u5206\u533a\u8868\u4e5f\u4e0d\u80fd\u5408\u5e76\u3002 FEDERATED \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002 CSV \uff1a\u8868\u4e0d\u80fd\u5206\u533a\u3002 InnoDB \uff1a\u8868\u4e2d\u4e0d\u80fd\u542b\u6709\u5916\u952e\uff0c\u4e5f\u4e0d\u80fd\u6709\u88ab\u5f15\u7528\u4e3a\u5916\u952e\u7684\u5b57\u6bb5\u3002\u5bf9\u4e8e\u5b50\u5206\u533a\u4e5f\u4e0d\u652f\u6301\u591a\u5757\u78c1\u76d8\u5b58\u50a8\u3002\u5b9e\u64cd\u53d1\u73b0MyISAM\u4e5f\u4e0d\u652f\u6301\u4e86\u3002\u4f18\u5316\u76f8\u5173\u53c2\u8003 \u524d\u6587 \u5206\u533a\u7ef4\u62a4\u7ae0\u8282\u3002 \u7528\u6237\u5b9a\u4e49\u7684\u5206\u533a\u548cNDB\u5b58\u50a8\u5f15\u64ce\uff08NDB\u96c6\u7fa4\uff09 \uff1aNDB\u53ea\u652f\u6301 [LINEAR] KEY \u5206\u533a\u7c7b\u578b\u3002 \u4e00\u5f20\u8868\u7684\u6700\u5927\u7684\u5206\u533a\u6570\u53d6\u51b3\u4e8e\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u6570\u636e\u8282\u70b9\u4e0e\u8282\u70b9\u7ec4\u7684\u6570\u91cf\u3001NDB\u96c6\u7fa4\u7684\u7248\u672c\u3001\u5176\u5b83\u5b9e\u9645\u60c5\u51b5\uff0c See NDB and user-defined partitioning \u3002 NDB\u8868\u4e2d\u6bcf\u4e2a\u5206\u533a\u53ef\u4ee5\u5b58\u50a8\u7684\u6700\u5927\u56fa\u5b9a\u5927\u5c0f\u6570\u636e\u91cf\u4e3a16 GB\u3002 \u5206\u533a\u8868\u5fc5\u987b\u5177\u6709\u663e\u5f0f\u4e3b\u952e\u3002 \u5347\u7ea7\u5206\u533a\u8868\uff1a\u6267\u884c\u5347\u7ea7\u65f6\uff0c\u5fc5\u987b\u8f6c\u50a8\u5e76\u91cd\u65b0\u52a0\u8f7d\u7531 KEY \u5206\u533a\u5e76\u4f7f\u7528\u9664NDB\u4e4b\u5916\u7684\u4efb\u4f55\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u3002 \u6240\u6709\u7684\u5206\u533a\u5fc5\u987b\u4f7f\u7528\u540c\u4e00\u4e2a\u5b58\u50a8\u5f15\u64ce\uff1a\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5e76\u4e14\u5b83\u5fc5\u987b\u4e0e\u6574\u4e2a\u8868\u4f7f\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u76f8\u540c\u3002\u53e6\u5916\uff0c\u5982\u679c\u5728\u521b\u5efa\u6216\u4fee\u6539\u8868\u7684\u65f6\u5019\u5728\u8868\u7684\u7ea7\u522b\u6ca1\u6709\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce\uff0c\u8981\u4e48\u4e0d\u6307\u5b9a\u4efb\u4f55\u4e00\u4e2a[\u5b50]\u5206\u533a\u7684\u5f15\u64ce\uff0c\u8981\u4e48\u5168\u90e8\u6307\u5b9a\u3002","title":"1.2 \u4e0e\u5b58\u50a8\u5f15\u64ce\u76f8\u5173\u7684\u5206\u533a\u9650\u5236"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#13","text":"\u53c2\u8003 \u5206\u533a\u952e\u5141\u8bb8\u4f7f\u7528\u7684Functions","title":"1.3 \u4e0e\u51fd\u6570\u76f8\u5173\u7684\u5206\u533a\u9650\u5236"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#14","text":"\u5bf9\u4e8e\u5728\u6267\u884cDML\u6216DDL\u8bed\u53e5\u65f6\u5b9e\u9645\u6267\u884c\u8868\u7ea7\u9501\u7684MyISAM\u7b49\u5b58\u50a8\u5f15\u64ce\uff0c\u5f71\u54cd\u5206\u533a\u8868\u7684\u8fd9\u79cd\u8bed\u53e5\u4f1a\u5bf9\u8868\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u9501\u5b9a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u5206\u533a\u90fd\u4f1a\u88ab\u9501\u5b9a\uff0c\u76f4\u5230\u8bed\u53e5\u7ed3\u675f\u3002\u4f8b\u5982\uff0c\u6765\u81eaMyISAM\u7684\u5206\u533a\u8868\u7684SELECT\u4f1a\u5bfc\u81f4\u6574\u4e2a\u8868\u7684\u9501\u5b9a\u3002 \u8fd9\u4f1a\u5bfc\u81f4\u968f\u7740\u5206\u533a\u6570\u91cf\u7684\u589e\u52a0\u4e0b\u9762\u8ba8\u8bba\u7684\u8bed\u53e5\u7684\u6267\u884c\u901f\u5ea6\u56de\u8d8a\u6765\u8d8a\u6162\u3002\u4f46\u662f\u5728MySQL 5.6.6 \u7248\u672c\u5f15\u5165\u4e86\u5206\u533a\u9501\u5b9a\u4fee\u526a\uff08 partition lock pruning \uff09\u5927\u5927\u51cf\u5c11\u4e86\u8fd9\u79cd\u5f71\u54cd\u3002 \u5bf9\u4e8e\u4f7f\u7528\u884c\u7ea7\u9501\u5b9a\u5e76\u4e14\u5728\u5206\u533a\u4fee\u526a\u4e4b\u524d\u4e0d\u4f1a\u5b9e\u9645\u6267\u884c\uff08\u6216\u9700\u8981\u6267\u884c\uff09\u9501\u5b9a\u7684\u5b58\u50a8\u5f15\u64ce\uff08\u5982InnoDB\uff09\uff0c\u60c5\u51b5\u4e0d\u4f1a\u5982\u6b64\u3002 \u4e0b\u9762\u8ba8\u8bba\u5728\u91c7\u7528\u8868\u7ea7\u9501\u5b9a\u7684\u5b58\u50a8\u5f15\u64ce\u7684\u5206\u533a\u8868\u4e0a\u4f7f\u7528MySQL\u8bed\u53e5\u7684\u5f71\u54cd\u3002","title":"1.4 \u5206\u533a\u548c\u8868\u7ea7\u9501\u5b9a"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#141-dml","text":"SELECT \u9501\u5b9a\u6574\u4e2a\u8868\u3002\u5305\u62ec UNION \u548c JOIN \u8bed\u53e5\u5305\u542b\u7684\u8868\u3002 UPDATE \u9501\u5b9a\u6574\u4e2a\u8868\u3002 REPLACE \u9501\u5b9a\u6574\u4e2a\u8868\u3002 INSERT\uff08\u5305\u62ec INSERT ... ON DUPLICATE KEY UPDATE \uff09 \u9501\u5b9a\u6574\u4e2a\u8868\u3002 INSERT ... SELECT \u9501\u5b9a\u6e90\u4e0e\u76ee\u6807\u8868\u3002 LOAD DATA \u9501\u5b9a\u6574\u4e2a\u8868\u3002 \u89e6\u53d1\u5668\u6fc0\u6d3b\u65f6\u9501\u5b9a\u6574\u4e2a\u8868\u3002","title":"1.4.1 DML \u8bed\u53e5"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#142-ddl","text":"CREATE VIEW \u9501\u5b9a\u5b83\u8bfb\u5230\u7684\u6240\u6709\u5206\u533a\u8868\u3002 ALTER TABLE \u9501\u5b9a\u5f71\u54cd\u5230\u7684\u5206\u533a\u8868\u3002","title":"1.4.2 DDL \u8bed\u53e5"},{"location":"mysql/24. MySQL\u5206\u533a\u9650\u5236/#143","text":"LOCK TABLES \u9501\u5b9a\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u3002 CALL stored_procedure( expr ) \u8c03\u7528\u65f6\u9501\u5b9a\u5728 expr \u4e2d\u6d89\u53ca\u5230\u7684\u6240\u6709\u5206\u533a\u8868\u7684\u6240\u6709\u5206\u533a\u3002 ALTER TABLE \u8fd8\u5c06\u5728\u8868\u7ea7\u83b7\u53d6\u5143\u6570\u636e\u9501\u3002","title":"1.4.3 \u5176\u5b83\u8bed\u53e5"},{"location":"mysql/25. SQL\u4f18\u5316/","text":"1. \u4f18\u5316\u4e00\u822c\u6b65\u9aa4 1.1 \u4e86\u89e3SQL\u7684\u6267\u884c\u9891\u7387 1.2 \u5b9a\u4f4d\u6267\u884c\u6548\u7387\u8f83\u4f4e\u7684 SQL 1.3 \u5206\u6790\u4f4e\u6548 SQL \u7684\u6267\u884c\u8ba1\u5212 1.4 \u901a\u8fc7 SHOW PROFILE \u5206\u6790 SQL 2. \u7d22\u5f15 2.1 \u7d22\u5f15\u7684\u5b58\u50a8\u5206\u7c7b 2.2 \u4f7f\u7528\u7d22\u5f15 2.3 \u5b58\u5728\u7d22\u5f15\u4f46\u4e0d\u4f7f\u7528\u7d22\u5f15 2.4 \u67e5\u770b\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5 2.5 \u4e24\u4e2a\u7b80\u5355\u5b9e\u7528\u7684\u4f18\u5316\u65b9\u6cd5 2.5.1 \u5b9a\u671f\u5206\u6790\u8868\u548c\u68c0\u67e5\u8868 2.5.2 \u5b9a\u671f\u4f18\u5316\u8868 2.6 \u5e38\u7528 SQL \u7684\u4f18\u5316 2.6.1 \u5927\u6279\u91cf\u63d2\u5165\u6570\u636e 2.6.1.1 \u63d0\u9ad8MyISAM\u8868\u7684\u5bfc\u5165\u6548\u7387 2.6.1.2 \u63d0\u9ad8InnoDB\u8868\u7684\u5bfc\u5165\u6548\u7387 2.6.2 \u4f18\u5316 INSERT \u8bed\u53e5 2.6.3 \u4f18\u5316 GROUP BY \u8bed\u53e5 2.6.4 \u4f18\u5316 ORDER BY \u8bed\u53e5 2.6.4.1 MySQL\u7684\u4e24\u79cd\u6392\u5e8f\u65b9\u5f0f 2.6.4.2 filesort\u4f18\u5316 2.6.5 \u4f18\u5316\u5d4c\u5957\u67e5\u8be2 2.6.6 \u4f18\u5316 OR \u6761\u4ef6 2.6.7 \u4f18\u5316\u5206\u9875\u67e5\u8be2 2.6.7.1 \u601d\u8def\u4e00 2.6.7.2 \u601d\u8def\u4e8c 2.6.8 \u4f7f\u7528 SQL \u63d0\u793a 2.6.8.1 USE INDEX 2.6.8.2 IGNORE INDEX 2.6.8.3 FORCE INDEX 1. \u4f18\u5316\u4e00\u822c\u6b65\u9aa4 \u00b6 1.1 \u4e86\u89e3SQL\u7684\u6267\u884c\u9891\u7387 \u00b6 \u4f7f\u7528 show [session|global] status \u63d0\u4f9b\u670d\u52a1\u5668\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u9ed8\u8ba4\u662fsession\u7b49\u7ea7\u3002 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE \"Com_%\" ; Com_xxx \u8868\u793a\u6bcf\u4e2a xxx \u8bed\u53e5\u6267\u884c\u7684\u6b21\u6570\uff0c\u6211\u4eec\u901a\u5e38\u6bd4\u8f83\u5173\u5fc3\u7684\u662f\u4ee5\u4e0b\u51e0\u4e2a\u7edf\u8ba1\u53c2\u6570\u3002 Com_select\uff1a\u6267\u884c select \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u4e00\u6b21\u67e5\u8be2\u53ea\u7d2f\u52a0 1\u3002 Com_insert\uff1a \u6267\u884c INSERT \u64cd\u4f5c\u7684\u6b21\u6570\uff0c \u5bf9\u4e8e\u6279\u91cf\u63d2\u5165\u7684 INSERT \u64cd\u4f5c\uff0c \u53ea\u7d2f\u52a0\u4e00\u6b21\u3002 Com_update\uff1a\u6267\u884c UPDATE \u64cd\u4f5c\u7684\u6b21\u6570\u3002 Com_delete\uff1a\u6267\u884c DELETE \u64cd\u4f5c\u7684\u6b21\u6570\u3002 \u4e0a\u9762\u8fd9\u4e9b\u53c2\u6570\u5bf9\u4e8e\u6240\u6709\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u64cd\u4f5c\u90fd\u4f1a\u8fdb\u884c\u7d2f\u8ba1\u3002\u4e0b\u9762\u8fd9\u51e0\u4e2a\u53c2\u6570\u53ea\u662f\u9488\u5bf9InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\uff0c\u7d2f\u52a0\u7684\u7b97\u6cd5\u4e5f\u7565\u6709\u4e0d\u540c\u3002 Innodb_rows_read\uff1aselect \u67e5\u8be2\u8fd4\u56de\u7684\u884c\u6570\u3002 Innodb_rows_inserted\uff1a\u6267\u884c INSERT \u64cd\u4f5c\u63d2\u5165\u7684\u884c\u6570\u3002 Innodb_rows_updated\uff1a\u6267\u884c UPDATE \u64cd\u4f5c\u66f4\u65b0\u7684\u884c\u6570\u3002 Innodb_rows_deleted\uff1a\u6267\u884c DELETE \u64cd\u4f5c\u5220\u9664\u7684\u884c\u6570\u3002 \u5bf9\u4e8e\u66f4\u65b0\u64cd\u4f5c\u7684\u8ba1\u6570\uff0c\u662f\u5bf9\u6267\u884c\u6b21\u6570\u7684\u8ba1\u6570\uff0c\u4e0d\u8bba\u63d0\u4ea4\u8fd8\u662f\u56de\u6eda\u90fd\u4f1a\u8fdb\u884c\u7d2f\u52a0\u3002 \u5bf9\u4e8e\u4e8b\u52a1\u578b\u7684\u5e94\u7528\uff0c \u901a\u8fc7 Com_commit \u548c Com_rollback \u53ef\u4ee5\u4e86\u89e3\u4e8b\u52a1\u63d0\u4ea4\u548c\u56de\u6eda\u7684\u60c5\u51b5\u3002 \u6b64\u5916\uff0c\u4ee5\u4e0b\u51e0\u4e2a\u53c2\u6570\u4fbf\u4e8e\u7528\u6237\u4e86\u89e3\u6570\u636e\u5e93\u7684\u57fa\u672c\u60c5\u51b5\u3002 Connections\uff1a\u8bd5\u56fe\u8fde\u63a5 MySQL \u670d\u52a1\u5668\u7684\u6b21\u6570\u3002 Uptime\uff1a\u670d\u52a1\u5668\u5de5\u4f5c\u65f6\u95f4\u3002 Slow_queries\uff1a\u6162\u67e5\u8be2\u7684\u6b21\u6570\u3002 1.2 \u5b9a\u4f4d\u6267\u884c\u6548\u7387\u8f83\u4f4e\u7684 SQL \u00b6 \u4e24\u79cd\u65b9\u6cd5\uff1a \u901a\u8fc7\u6162\u67e5\u8be2\u65e5\u5fd7\u5b9a\u4f4d\u90a3\u4e9b\u6267\u884c\u6548\u7387\u8f83\u4f4e\u7684 SQL \u8bed\u53e5\uff0c\u7528 --log-slow-queries[=file_name] \u9009\u9879\u542f\u52a8\u65f6\uff0c mysqld \u5199\u4e00\u4e2a\u5305\u542b\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 long_query_time \uff08show variables like 'long_query_time';\uff09\u79d2\u7684 SQL \u8bed\u53e5\u7684\u65e5\u5fd7\u6587\u4ef6\u3002 \u4f7f\u7528 show processlist \u547d\u4ee4\u67e5\u770b\u5f53\u524d MySQL \u5728\u8fdb\u884c\u7684\u7ebf\u7a0b\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u72b6\u6001\u3001\u662f\u5426\u9501\u8868\u7b49\uff0c\u53ef\u4ee5\u5b9e\u65f6\u5730\u67e5\u770b SQL \u7684\u6267\u884c\u60c5\u51b5\uff0c\u540c\u65f6\u5bf9\u4e00\u4e9b\u9501\u8868\u64cd\u4f5c\u8fdb\u884c\u4f18\u5316\u3002 1.3 \u5206\u6790\u4f4e\u6548 SQL \u7684\u6267\u884c\u8ba1\u5212 \u00b6 \u5b9a\u4f4d\u5230\u6548\u7387\u4f4e\u7684 SQL \u8bed\u53e5\u540e\uff0c \u53ef\u4ee5\u901a\u8fc7 EXPLAIN \u6216\u8005 DESC \u547d\u4ee4\u83b7\u53d6 MySQL \u5982\u4f55\u6267\u884c SELECT \u8bed\u53e5\u7684\u4fe1\u606f\u3002 EXPLAIN [ explain_type ] SELECT select_options explain_type : EXTENDED | PARTITIONS Or : -- \u540c DESC tbl_name EXPLAIN tbl_name MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : CHILD type : index possible_keys : NULL key : PARENT_ID key_len : 3 ref : NULL rows : 5 Extra : Using index select_type\uff1aSIMPLE \uff08\u7b80\u5355\u8868\uff0c \u5373\u4e0d\u4f7f\u7528\u8868\u8fde\u63a5\u6216\u8005\u5b50\u67e5\u8be2\uff09\u3001PRIMARY\uff08\u4e3b\u67e5\u8be2\uff0c\u5373\u5916\u5c42\u7684\u67e5\u8be2\uff09\u3001UNION\uff08UNION \u4e2d\u7684\u7b2c\u4e8c\u4e2a\u6216 \u8005\u540e\u9762\u7684\u67e5\u8be2\u8bed\u53e5\uff09\u3001SUBQUERY\uff08\u5b50\u67e5\u8be2\u4e2d\u7684\u7b2c\u4e00\u4e2a SELECT\uff09\u7b49 type\uff1a\u8fde\u63a5\u7c7b\u578b\u3002\u6027\u80fd\u7531\u597d\u5230\u5dee\u7684\u8fde\u63a5\u7c7b\u578b\u4e3a system \uff08\u8868\u4e2d\u4ec5\u6709\u4e00\u884c\uff0c\u5373\u5e38\u91cf\u8868\uff09\u3001 const \uff08\u5355\u8868\u4e2d\u6700\u591a\u6709\u4e00\u4e2a\u5339\u914d\u884c\uff0c\u4f8b\u5982 primary key \u6216\u8005 unique index\uff09\u3001 eq_ref \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\uff0c\u5728\u6b64\u8868\u4e2d\u53ea\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u591a\u8868\u8fde\u63a5\u4e2d\u4f7f\u7528 primary key \u6216\u8005 unique index\uff09\u3001 ref \uff08\u4e0e eq_ref \u7c7b\u4f3c\uff0c \u533a\u522b\u5728\u4e8e\u4e0d\u662f\u4f7f\u7528 primary key \u6216\u8005 unique index\uff0c\u800c\u662f\u4f7f\u7528\u666e\u901a\u7684\u7d22\u5f15\uff09\u3001 ref_or_null \uff08\u4e0e ref \u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\u6761\u4ef6\u4e2d\u5305\u542b\u5bf9 NULL \u7684\u67e5\u8be2\uff09 \u3001 index_merge (\u7d22\u5f15\u5408\u5e76\u4f18\u5316)\u3001 unique_subquery \uff08in\u7684\u540e\u9762\u662f\u4e00\u4e2a\u67e5\u8be2\u4e3b\u952e\u5b57\u6bb5\u7684\u5b50\u67e5\u8be2\uff09\u3001 index_subquery \uff08\u4e0e unique_subquery \u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e in \u7684\u540e\u9762\u662f\u67e5\u8be2\u975e\u552f\u4e00\u7d22\u5f15\u5b57\u6bb5\u7684\u5b50\u67e5\u8be2\uff09\u3001 range \uff08\u5355\u8868\u4e2d\u7684\u8303\u56f4\u67e5\u8be2\uff09\u3001 index \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\uff0c \u90fd\u901a\u8fc7\u67e5\u8be2\u7d22\u5f15\u6765\u5f97\u5230\u6570\u636e\uff09\u3001 all \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\u90fd\u901a\u8fc7\u5168\u8868\u626b\u63cf\u6765\u5f97\u5230\u6570\u636e\uff09\u3002 key\uff1a\u8868\u793a\u5b9e\u9645\u4f7f\u7528\u7684\u7d22\u5f15\u3002 rows\uff1a\u626b\u63cf\u884c\u7684\u6570\u91cf\u3002 Extra\uff1a\u6267\u884c\u60c5\u51b5\u7684\u8bf4\u660e\u548c\u63cf\u8ff0\u3002 1.4 \u901a\u8fc7 SHOW PROFILE \u5206\u6790 SQL \u00b6 \u8bed\u6cd5\uff1a -- \u5217\u51fa\u6240\u6709\u7684\u8fdb\u7a0b\u53ca\u6d88\u8017\u65f6\u95f4 SHOW PROFILES ; -- \u5217\u51fa\u8fdb\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u5177\u4f53\u7684\u8017\u65f6 SHOW PROFILE [ type [, type ] ... ] [ FOR QUERY n ] [ LIMIT row_count [ OFFSET offset ]] type : { ALL | BLOCK IO | CONTEXT SWITCHES | CPU | IPC | MEMORY | PAGE FAULTS | SOURCE | SWAPS } \u663e\u793a\u5206\u6790\u4fe1\u606f\uff0c\u6307\u793a\u5728\u5f53\u524d\u4f1a\u8bdd\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u8bed\u53e5\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002 \u4f7f\u7528\u793a\u4f8b \u8fd8\u53ef\u4ee5\u901a\u8fc7 INFORMATION_SCHEMA.PROFILING \u8868\u83b7\u53d6\u4fe1\u606f\u3002 \u67e5\u770b\u662f\u5426\u652f\u6301\uff1a SELECT @@ HAVE_PROFILING ; \u6253\u5f00\u8be5\u529f\u80fd\uff1a -- \u67e5\u770b\u662f\u5426\u5f00\u542f SELECT @@ profiling ; -- \u5f00\u542f SET profiling = 1 ; Note Sending data \u8868\u793a\u7684\u662fMySQL\u7ebf\u7a0b\u4ece\u5f00\u59cb\u8bbf\u95ee\u6570\u636e\u884c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u65f6\u957f\u3002 2. \u7d22\u5f15 \u00b6 2.1 \u7d22\u5f15\u7684\u5b58\u50a8\u5206\u7c7b \u00b6 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u662f\u81ea\u52a8\u5206\u5f00\u5b58\u50a8\u7684\uff0c \u5404\u81ea\u662f\u72ec\u7acb\u7684\u4e00\u4e2a\u6587\u4ef6\uff1b InnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u662f\u5b58\u50a8\u5728\u540c\u4e00\u4e2a\u8868\u7a7a\u95f4\u91cc\u9762\uff0c\u4f46\u53ef\u4ee5\u6709\u591a\u4e2a\u6587\u4ef6\u7ec4\u6210\u3002 MySQL \u4e2d\u7d22\u5f15\u7684\u5b58\u50a8\u7c7b\u578b\uff1a BTREE\uff1aMyISAM\u3001InnoDB\u3001MEMORY\u3001HEAP\u5b58\u50a8\u5f15\u64ce\u90fd\u652f\u6301 BTREE \u7d22\u5f15 HASH\uff1aMEMORY/HEAP \u5b58\u50a8\u5f15\u64ce\u652f\u6301 HASH \u7d22\u5f15 RTREE\uff1a\u7a7a\u95f4\u7d22\u5f15\u3002MyISAM \u7279\u6b8a\u7684\u7d22\u5f15\u7c7b\u578b FULLTEXT\uff1a\u5168\u6587\u7d22\u5f15\u3002MyISAM \u7279\u6b8a\u7684\u7d22\u5f15\u7c7b\u578b\uff1bInnoDB\u4ece 5.6 \u7248\u672c\u652f\u6301\u3002 \u524d\u7f00\u7d22\u5f15 2.2 \u4f7f\u7528\u7d22\u5f15 \u00b6 \u67e5\u8be2\u8981\u4f7f\u7528\u7d22\u5f15\u6700\u4e3b\u8981\u7684\u6761\u4ef6\u662f \u67e5\u8be2\u6761\u4ef6\u4e2d\u9700\u8981\u4f7f\u7528\u7d22\u5f15\u5173\u952e\u5b57 \uff0c\u5982\u679c\u662f\u591a\u5217\u7d22\u5f15\uff0c\u90a3\u4e48\u53ea\u6709\u67e5\u8be2\u6761\u4ef6\u4f7f\u7528\u4e86\u591a\u5217\u5173\u952e\u5b57 \u7b2c\u4e00\u4e2a\u5173\u952e\u5b57 \u7684\u524d\u7f00\u65f6\uff0c \u624d\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\uff0c \u5426\u5219\u5c06\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\u3002 \u5bf9\u4e8e\u521b\u5efa\u7684\u591a\u5217\u7d22\u5f15\uff0c\u53ea\u8981\u67e5\u8be2\u7684\u6761\u4ef6\u4e2d\u7528\u5230\u4e86\u7b2c\u4e00\u5217\uff0c\u7d22\u5f15\u4e00\u822c\u5c31\u4f1a\u88ab\u4f7f\u7528 \u5bf9\u4e8e\u4f7f\u7528 like \u7684\u67e5\u8be2\uff0c\u540e\u9762\u5982\u679c\u662f\u5e38\u91cf\u5e76\u4e14\u53ea\u6709\uff05\u53f7\u4e0d\u5728\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u7d22\u5f15\u624d\u53ef\u80fd\u4f1a\u88ab\u4f7f\u7528 -- \u4f7f\u7528\u4e86\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME LIKE 'DS' \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : range possible_keys : mutil_index key : mutil_index key_len : 31 ref : NULL rows : 1 Extra : Using index condition 1 row in set ( 0 . 00 sec ) -- \u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME LIKE '%DS' \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ALL possible_keys : NULL key : NULL key_len : NULL ref : NULL rows : 1 Extra : Using where 1 row in set ( 0 . 00 sec ) \u5982\u679c\u5bf9\u5927\u7684\u6587\u672c\u8fdb\u884c\u641c\u7d22\uff0c\u4f7f\u7528\u5168\u6587\u7d22\u5f15\u800c\u4e0d\u8981\u4f7f\u7528 like \u2018%\u2026%\u2019 \u3002 \u76f8\u5173\u535a\u5ba2 \u3002 \u5982\u679c\u5217\u540d\u662f\u7d22\u5f15\uff0c\u4f7f\u7528 column_name is null \u5c06\u4f7f\u7528\u7d22\u5f15\u3002 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME IS NULL \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ref possible_keys : mutil_index key : mutil_index key_len : 31 ref : const rows : 1 Extra : Using index condition 1 row in set ( 0 . 00 sec ) -- \u867d\u7136 DESCRIPTION \u4e5f\u662f\u7d22\u5f15\u7684\u4e2d\u7684\u5173\u952e\u5b57\uff0c\u4f46\u662f\u4e0d\u662f\u7b2c\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE DESCRIPTION IS NULL \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ALL possible_keys : NULL key : NULL key_len : NULL ref : NULL rows : 1 Extra : Using where 1 row in set ( 0 . 00 sec ) \u4ec5\u4ec5\u5bf9\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\uff0c\u5f53\u67e5\u8be2\u7684\u5217\u90fd\u5728\u7d22\u5f15\u7684\u5b57\u6bb5\u4e2d\u65f6\uff08\u67e5\u8be2\u5b57\u6bb5\u4e2d\u7684\u7d22\u5f15\u5217\u8981\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u4f7f\u7528\u7684\u7d22\u5f15\u4e2d\uff09\uff0c\u67e5\u8be2\u7684\u6548\u7387\u66f4\u9ad8 2.3 \u5b58\u5728\u7d22\u5f15\u4f46\u4e0d\u4f7f\u7528\u7d22\u5f15 \u00b6 \u5982\u679c MySQL \u4f30\u8ba1\u4f7f\u7528\u7d22\u5f15\u6bd4\u5168\u8868\u626b\u63cf\u66f4\u6162\uff0c\u5219\u4e0d\u4f7f\u7528\u7d22\u5f15\u3002 \u5982\u679c\u4f7f\u7528 MEMORY/HEAP \u8868\u5e76\u4e14 where \u6761\u4ef6\u4e2d\u4e0d\u4f7f\u7528 = \u8fdb\u884c\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u3002heap \u8868\u53ea\u6709\u5728 = \u7684\u6761\u4ef6\u4e0b\u624d\u4f1a\u4f7f\u7528\u7d22\u5f15\u3002 \u7528 or \u5206\u5272\u5f00\u7684\u6761\u4ef6\uff0c \u5982\u679c or \u524d\u7684\u6761\u4ef6\u4e2d\u7684\u5217\u6709\u7d22\u5f15\uff0c \u800c\u540e\u9762\u7684\u5217\u4e2d\u6ca1\u6709\u7d22\u5f15\uff0c\u90a3\u4e48\u6d89\u53ca\u5230\u7684\u7d22\u5f15\u90fd\u4e0d\u4f1a\u88ab\u7528\u5230\u3002\u5373\u6709\u4e00\u4e2a\u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\u90a3\u4e48\u5c31\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\u3002 \u5982\u679c\u4e0d\u662f\u7d22\u5f15\u5217\u7684\u7b2c\u4e00\u5217 \u5982\u679c like \u662f\u4ee5 \uff05 \u5f00\u59cb \u5982\u679c\u5217\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u4e00\u5b9a\u8bb0\u5f97\u5728 where \u6761\u4ef6\u4e2d\u628a\u5b57\u7b26\u5e38\u91cf\u503c\u7528 \u5f15\u53f7 \u5f15\u8d77\u6765\uff0c\u5426\u5219\u7684\u8bdd\u5373\u4fbf\u8fd9\u4e2a\u5217\u4e0a\u6709\u7d22\u5f15\uff0cMySQL \u4e5f\u4e0d\u4f1a\u7528\u5230\u7684 2.4 \u67e5\u770b\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5 \u00b6 MYSQL > SHOW STATUS LIKE 'Handler_read%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | Handler_read_first | 3 | | Handler_read_key | 0 | | Handler_read_last | 0 | | Handler_read_next | 18 | | Handler_read_prev | 0 | | Handler_read_rnd | 0 | | Handler_read_rnd_deleted | 0 | | Handler_read_rnd_next | 36 | +--------------------------+-------+ \u5982\u679c\u7d22\u5f15\u6b63\u5728\u5de5\u4f5c\uff0c Handler_read_key \u7684\u503c\u5c06\u5f88\u9ad8\uff0c\u8fd9\u4e2a\u503c\u4ee3\u8868\u4e86\u4e00\u4e2a\u884c\u88ab\u7d22\u5f15\u503c\u8bfb\u7684\u6b21\u6570\uff0c\u5f88\u4f4e\u7684\u503c\u8868\u660e\u589e\u52a0\u7d22\u5f15\u5f97\u5230\u7684\u6027\u80fd\u6539\u5584\u4e0d\u9ad8\uff0c\u56e0\u4e3a\u7d22\u5f15\u5e76\u4e0d\u7ecf\u5e38\u4f7f\u7528\u3002 Handler_read_rnd_next \u7684\u503c\u9ad8\u5219\u610f\u5473\u7740\u67e5\u8be2\u8fd0\u884c\u4f4e\u6548\uff0c\u5e76\u4e14\u5e94\u8be5\u5efa\u7acb\u7d22\u5f15\u8865\u6551\u3002\u8fd9\u4e2a\u503c\u7684\u542b\u4e49\u662f\u5728\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u4e0b\u4e00\u884c\u7684\u8bf7\u6c42\u6570\u3002\u5982\u679c\u6b63\u8fdb\u884c\u5927\u91cf\u7684\u8868\u626b\u63cf\uff0c Handler_read_rnd_next \u7684\u503c\u8f83\u9ad8\uff0c \u5219\u901a\u5e38\u8bf4\u660e\u8868\u7d22\u5f15\u4e0d\u6b63\u786e\u6216\u5199\u5165\u7684\u67e5\u8be2\u6ca1\u6709\u5229\u7528\u7d22\u5f15\u3002 2.5 \u4e24\u4e2a\u7b80\u5355\u5b9e\u7528\u7684\u4f18\u5316\u65b9\u6cd5 \u00b6 \u8fd9\u4e9b\u7ef4\u62a4\u64cd\u4f5c \u4f1a\u9020\u6210\u8868\u7684\u9501\u5b9a \uff0c\u4e0d\u8981\u5728\u6570\u636e\u5e93\u7e41\u5fd9\u7684\u65f6\u5019\u6267\u884c\u3002 2.5.1 \u5b9a\u671f\u5206\u6790\u8868\u548c\u68c0\u67e5\u8868 \u00b6 ANALYZE [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... \u672c\u8bed\u53e5\u7528\u4e8e\u5206\u6790\u548c\u5b58\u50a8\u8868\u7684\u5173\u952e\u5b57\u5206\u5e03\uff0c \u5206\u6790\u7684\u7ed3\u679c\u5c06\u53ef\u4ee5\u4f7f\u5f97\u7cfb\u7edf\u5f97\u5230\u51c6\u786e\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f7f\u5f97 SQL \u80fd\u591f\u751f\u6210\u6b63\u786e\u7684\u6267\u884c\u8ba1\u5212\u3002 \u5982\u679c\u7528\u6237\u611f\u89c9\u5b9e\u9645\u6267\u884c\u8ba1\u5212\u5e76\u4e0d\u662f\u9884\u671f\u7684\u6267\u884c\u8ba1\u5212\uff0c \u6267\u884c\u4e00\u6b21\u5206\u6790\u8868\u53ef\u80fd\u4f1a\u89e3\u51b3\u95ee\u9898\u3002 \u5728\u5206\u6790\u671f\u95f4\uff0c \u4f7f\u7528\u4e00\u4e2a\u8bfb\u53d6\u9501\u5b9a\u5bf9\u8868\u8fdb\u884c\u9501\u5b9a\u3002 \u652f\u6301 InnoDB , NDB , MyISAM \u4ee5\u53ca\u5206\u533a\u8868\uff0c\u4e0d\u652f\u6301\u89c6\u56fe\u3002 CHECK TABLE tbl_name [, tbl_name ] ... [ option ] ... option = { FOR UPGRADE | QUICK | FAST | MEDIUM | EXTENDED | CHANGED } \u68c0\u67e5\u8868\u7684\u4f5c\u7528\u662f\u68c0\u67e5\u4e00\u4e2a\u6216\u591a\u4e2a \u8868/\u89c6\u56fe \u662f\u5426\u6709\u9519\u8bef\u3002 \u652f\u6301 InnoDB , MyISAM , ARCHIVE , CSV \u4ee5\u53ca\u5206\u533a\u8868\uff0c\u5bf9\u4e8eInnoDB\u6709 \u6ce8\u610f\u4e8b\u9879 \u3002 2.5.2 \u5b9a\u671f\u4f18\u5316\u8868 \u00b6 OPTIMIZE [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... \u5982\u679c\u5df2\u7ecf\u5220\u9664\u4e86\u8868\u7684\u4e00\u5927\u90e8\u5206\uff0c\u6216\u8005\u5982\u679c\u5df2\u7ecf\u5bf9\u542b\u6709\u53ef\u53d8\u957f\u5ea6\u884c\u7684\u8868\uff08\u542b\u6709 VARCHAR\u3001BLOB \u6216 TEXT \u5217\u7684\u8868\uff09 \u8fdb\u884c\u4e86\u5f88\u591a\u66f4\u6539\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u8bed\u53e5\u4f18\u5316\u3002 \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u5c06\u8868\u4e2d\u7684\u7a7a\u95f4\u788e\u7247\u8fdb\u884c\u5408\u5e76\uff0c \u5e76\u4e14\u53ef\u4ee5\u6d88\u9664\u7531\u4e8e\u5220\u9664\u6216\u8005\u66f4\u65b0\u9020\u6210\u7684\u7a7a\u95f4\u6d6a\u8d39\u3002 \u5bf9\u4e8eInnoDB\uff0c\u53ef\u4ee5\u8bbe\u7f6e innodb_file_per_table \u53c2\u6570\uff0c\u8fd9\u6837\u4f1a\u5bf9\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u6bcf\u4e2a\u8868\u751f\u6210\u4e00\u4e2a\u72ec\u7acb\u7684ibd\u6587\u4ef6\uff0c\u7528\u4e8e\u5b58\u50a8\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u3002\u53e6\u5916\u3002\u5728\u5220\u9664\u5927\u91cf\u6570\u636e\u4e4b\u540eInnoDB\u8868\u53ef\u4ee5\u901a\u8fc7 ALTER TABLE table_name ENGINE=Innodb \u4f46\u662f\u4e0d\u4fee\u6539\u5f15\u64ce\u7684\u65b9\u5f0f\u6765\u56de\u6536\u4e0d\u4f7f\u7528\u7684\u7a7a\u95f4\u3002 \u4f7f\u7528\u65f6\u6709\u8bf8\u591a\u9650\u5236\uff0c\u8be6\u60c5\u53c2\u8003 MySQL 5.5\u624b\u518c \u3002 2.6 \u5e38\u7528 SQL \u7684\u4f18\u5316 \u00b6 2.6.1 \u5927\u6279\u91cf\u63d2\u5165\u6570\u636e \u00b6 2.6.1.1 \u63d0\u9ad8MyISAM\u8868\u7684\u5bfc\u5165\u6548\u7387 \u00b6 \u5f53\u7528 load \u547d\u4ee4\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u9002\u5f53\u7684\u8bbe\u7f6e\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u901f\u5ea6\u3002 \u5bf9\u4e8e MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5feb\u901f\u7684\u5bfc\u5165\u5927\u91cf\u7684\u6570\u636e\u3002 -- \u5173\u95ed MyISAM \u8868\u975e\u552f\u4e00\u7d22\u5f15\u7684\u66f4\u65b0 ALTER TABLE tbl_name DISABLE KEYS ; loading the data -- \u6253\u5f00 MyISAM \u8868\u975e\u552f\u4e00\u7d22\u5f15\u7684\u66f4\u65b0 ALTER TABLE tbl_name ENABLE KEYS ; \u5728\u5bfc\u5165\u5927\u91cf\u7684\u6570\u636e\u5230\u4e00\u4e2a\u975e\u7a7a\u7684 MyISAM \u8868\u65f6\uff0c \u901a\u8fc7\u8bbe\u7f6e\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c \u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002 \u5bf9\u4e8e\u5bfc\u5165\u5927\u91cf\u6570\u636e\u5230\u4e00\u4e2a\u7a7a\u7684 MyISAM \u8868\uff0c \u9ed8\u8ba4\u5c31\u662f\u5148\u5bfc\u5165\u6570\u636e\u7136\u540e\u624d\u521b\u5efa\u7d22\u5f15\u7684\uff0c \u6240\u4ee5\u4e0d\u7528\u8fdb\u884c\u8bbe\u7f6e\u3002 2.6.1.2 \u63d0\u9ad8InnoDB\u8868\u7684\u5bfc\u5165\u6548\u7387 \u00b6 \u56e0\u4e3a InnoDB \u7c7b\u578b\u7684\u8868\u662f\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u4fdd\u5b58\u7684\uff0c \u6240\u4ee5\u5c06\u5bfc\u5165\u7684\u6570\u636e\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u6392\u5217\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u63d0\u9ad8\u5bfc\u5165\u6570\u636e\u7684\u6548\u7387\u3002 \u5728\u5bfc\u5165\u6570\u636e\u524d\u6267\u884c SET UNIQUE_CHECKS=0 \uff0c\u5173\u95ed\u552f\u4e00\u6027\u6821\u9a8c\uff0c\u5728\u5bfc\u5165\u7ed3\u675f\u540e\u6267\u884cSET UNIQUE_CHECKS=1\uff0c\u6062\u590d\u552f\u4e00\u6027\u6821\u9a8c\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002 \u5982\u679c\u5e94\u7528\u4f7f\u7528\u81ea\u52a8\u63d0\u4ea4\u7684\u65b9\u5f0f\uff0c\u5efa\u8bae\u5728\u5bfc\u5165\u524d\u6267\u884c SET AUTOCOMMIT=0 \uff0c\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\uff0c\u5bfc\u5165\u7ed3\u675f\u540e\u518d\u6267\u884c SET AUTOCOMMIT=1\uff0c\u6253\u5f00\u81ea\u52a8\u63d0\u4ea4\uff0c\u4e5f\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002 2.6.2 \u4f18\u5316 INSERT \u8bed\u53e5 \u00b6 \u5982\u679c\u540c\u65f6\u4ece\u540c\u4e00\u5ba2\u6237\u7aef\u63d2\u5165\u5f88\u591a\u884c\uff0c\u5c3d\u91cf\u4f7f\u7528\u591a\u503c\u63d2\u5165\u8bed\u53e5\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c06\u5927\u5927\u7f29\u51cf\u5ba2\u6237\u7aef\u4e0e\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u8fde\u63a5\u3001\u5173\u95ed\u7b49\u6d88\u8017 insert into table_name values ( 1 , 2 ),( 1 , 3 ),( 1 , 4 ) \u2026 \u5982\u679c\u4ece\u4e0d\u540c\u5ba2\u6237\u63d2\u5165\u5f88\u591a\u884c\uff0c\u80fd\u901a\u8fc7\u4f7f\u7528 INSERT DELAYED \u8bed\u53e5\u5f97\u5230\u66f4\u9ad8\u7684\u901f\u5ea6\u3002 DELAYED \u7684\u542b\u4e49\u662f\u8ba9 INSERT \u8bed\u53e5\u9a6c\u4e0a\u6267\u884c\uff0c\u5176\u5b9e\u6570\u636e\u90fd\u88ab\u653e\u5728\u5185\u5b58\u7684\u961f\u5217\u4e2d\uff0c\u5e76\u6ca1\u6709 \u771f\u6b63\u5199\u5165\u78c1\u76d8\uff0c\u8fd9\u6bd4\u6bcf\u6761\u8bed\u53e5\u5206\u522b\u63d2\u5165\u8981\u5feb\u7684\u591a\uff1bLOW_PRIORITY \u521a\u597d\u76f8\u53cd\uff0c\u5728\u6240\u6709\u5176 \u4ed6\u7528\u6237\u5bf9\u8868\u7684\u8bfb\u5199\u5b8c\u540e\u624d\u8fdb\u884c\u63d2\u5165\uff1b \u5c06\u7d22\u5f15\u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6\u5206\u5728\u4e0d\u540c\u7684\u78c1\u76d8\u4e0a\u5b58\u653e\uff08\u5229\u7528\u5efa\u8868\u4e2d\u7684\u9009\u9879\uff09\u3002 \u5982\u679c\u8fdb\u884c\u6279\u91cf\u63d2\u5165\uff0c\u53ef\u4ee5\u589e\u52a0 bulk_insert_buffer_size \u53d8\u91cf\u503c\u7684\u65b9\u6cd5\u6765\u63d0\u9ad8\u901f\u5ea6\uff0c\u4f46\u662f\uff0c\u8fd9\u53ea\u80fd\u5bf9 MyISAM \u8868\u4f7f\u7528\u3002 \u5f53\u4ece\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\u88c5\u8f7d\u4e00\u4e2a\u8868\u65f6\uff0c \u4f7f\u7528 LOAD DATA INFILE \u3002 \u8fd9\u901a\u5e38\u6bd4\u4f7f\u7528\u5f88\u591a INSERT \u8bed\u53e5\u5feb 20 \u500d\u3002 2.6.3 \u4f18\u5316 GROUP BY \u8bed\u53e5 \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c MySQL \u5bf9\u6240\u6709\u5b57\u6bb5 GROUP BY col1\uff0c col2.... \u8fdb\u884c\u6392\u5e8f\u3002 \u8fd9\u4e0e\u5728\u67e5\u8be2\u4e2d\u6307\u5b9aORDER BY col1\uff0ccol2... \u7c7b\u4f3c\u3002 \u5982\u679c\u67e5\u8be2\u5305\u62ec GROUP BY \u4f46\u7528\u6237\u60f3\u8981\u907f\u514d\u6392\u5e8f\u7ed3\u679c\u7684\u6d88\u8017\uff0c\u5219\u53ef\u4ee5\u6307\u5b9a ORDER BY NULL \u7981\u6b62\u6392\u5e8f\u3002 2.6.4 \u4f18\u5316 ORDER BY \u8bed\u53e5 \u00b6 \u4f18\u5316\u65b9\u5f0f\uff1a \u5c3d\u91cf\u51cf\u5c11\u989d\u5916\u7684\u6392\u5e8f\uff0c\u901a\u8fc7\u7d22\u5f15\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e \u3002 2.6.4.1 MySQL\u7684\u4e24\u79cd\u6392\u5e8f\u65b9\u5f0f \u00b6 \u7b2c\u4e00\u79cd\uff1a\u901a\u8fc7\u6709\u5e8f\u7d22\u5f15\u987a\u5e8f\u626b\u63cf\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e\uff08\u67e5\u8be2\u7684\u5b57\u6bb5\u662f\u7d22\u5f15\u5b57\u6bb5\uff0c\u4f46\u4f60\u4ecd\u7136\u9700\u8981\u6307\u5b9a\u6392\u5e8f\u89c4\u5219\uff09\u3002\u6b64\u65b9\u5f0f\u5728\u4f7f\u7528 EXPLAIN \u5206\u6790\u65f6\u663e\u793a\u4e3a Using Index \uff0c\u65e0\u9700\u989d\u5916\u6392\u5e8f\u3002 \u7b2c\u4e8c\u79cd\uff1a\u5bf9\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u5373 filesort \u3002\u6392\u5e8f\u7684\u64cd\u4f5c\u53d6\u51b3\u4e8eMySQL\u5bf9\u6392\u5e8f\u53c2\u6570\u7684\u8bbe\u7f6e\u548c\u6392\u5e8f\u6570\u636e\u5927\u5c0f\u3002 \u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\uff1aWHERE \u6761\u4ef6\u548c ORDER BY \u4f7f\u7528\u76f8\u540c\u7684\u7d22\u5f15\uff0c\u5e76\u4e14 ORDER BY \u7684\u987a\u5e8f\u548c\u7d22\u5f15\u987a\u5e8f\u76f8\u540c\uff0c\u5e76\u4e14 ORDER BY \u7684\u5b57\u6bb5\u90fd\u662f\u5347\u5e8f\u6216\u8005\u90fd\u662f\u964d\u5e8f\u3002 \u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u4e0b\u5219\u4e0d\u4f7f\u7528\u7d22\u5f15\uff1a order by \u7684\u5b57\u6bb5\u6df7\u5408 ASC \u548c DESC \u7528\u4e8e\u67e5\u8be2\u884c\u7684\u5173\u952e\u5b57\u4e0e ORDER BY \u4e2d\u6240\u4f7f\u7528\u7684\u4e0d\u76f8\u540c \u5bf9\u4e0d\u540c\u7684\u5173\u952e\u5b57\u4f7f\u7528 ORDER BY\u3002\uff1f\uff1f\uff1f 2.6.4.2 filesort\u4f18\u5316 \u00b6 \u901a\u8fc7\u6bd4\u8f83\u7cfb\u7edf\u53d8\u91cf max_length_for_sort_data \u7684\u5927\u5c0f\u548cquery\u8bed\u53e5\u53bb\u9664\u7684\u5b57\u6bb5\u603b\u5927\u5c0f\u6765\u5224\u65ad\u4f7f\u7528\u54ea\u79cd\u7b97\u6cd5\u3002\u524d\u8005\u5927\u4f7f\u7528\u4e00\u6b21\u626b\u63cf\u7b97\u6cd5\uff0c\u5426\u5219\u4f7f\u7528\u4e8c\u6b21\u626b\u63cf\u7b97\u6cd5\u3002https://dev.mysql.com/doc/refman/5.5/en/order-by-optimization.html#order-by-filesort \u9002\u5f53\u52a0\u5927\u7cfb\u7edf\u53d8\u91cf max_length_for_sort_data \u7684\u503c\uff0c\u8fbe\u5230CPU\u4e0eIO\u5229\u7528\u5e73\u8861\u3002 \u9002\u5f53\u52a0\u5927 sort_buffer_size \u6392\u5e8f\u533a\uff0c\u5c3d\u91cf\u8ba9\u6392\u5e8f\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u3002 2.6.5 \u4f18\u5316\u5d4c\u5957\u67e5\u8be2 \u00b6 SQL \u7684\u5b50\u67e5\u8be2\u3002 \u8fd9\u4e2a\u6280\u672f\u53ef\u4ee5\u4f7f\u7528 SELECT \u8bed\u53e5\u6765\u521b\u5efa\u4e00\u4e2a\u5355\u5217\u7684\u67e5\u8be2\u7ed3\u679c\uff0c \u7136\u540e\u628a\u8fd9\u4e2a\u7ed3\u679c\u4f5c\u4e3a\u8fc7\u6ee4\u6761\u4ef6\u7528\u5728\u53e6\u4e00\u4e2a\u67e5\u8be2\u4e2d\u3002\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b50\u67e5\u8be2\u53ef\u4ee5\u88ab\u66f4\u6709\u6548\u7387\u7684\u8fde\u63a5\uff08JOIN\uff09\u66ff\u4ee3\u3002 \u8fde\u63a5 \uff08JOIN\uff09 \u4e4b\u6240\u4ee5\u66f4\u6709\u6548\u7387\u4e00\u4e9b\uff0c \u662f\u56e0\u4e3a MySQL \u4e0d\u9700\u8981\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e34\u65f6\u8868\u6765\u5b8c\u6210\u8fd9\u4e2a\u903b\u8f91\u4e0a\u7684\u9700\u8981\u4e24\u4e2a\u6b65\u9aa4\u7684\u67e5\u8be2\u5de5\u4f5c\u3002 -- \u5b50\u67e5\u8be2 mysql > select * from sales2 where company_id not in ( select id from company2 ); -- \u8fde\u63a5 mysql > select * from sales2 left join company2 on sales2 . company_id = company2 . id where sales2 . company_id is null ; 2.6.6 \u4f18\u5316 OR \u6761\u4ef6 \u00b6 \u5bf9\u4e8e\u542b\u6709 OR \u7684\u67e5\u8be2\u5b50\u53e5\uff0c \u5982\u679c\u8981\u5229\u7528\u7d22\u5f15\uff0c \u5219 OR \u4e4b\u95f4\u7684 \u6bcf\u4e2a\u6761\u4ef6\u5217 \u90fd\u5fc5\u987b\u7528\u5230\u7d22\u5f15\uff1b\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0c\u5219\u5e94\u8be5\u8003\u8651\u589e\u52a0\u7d22\u5f15\u3002 2.6.7 \u4f18\u5316\u5206\u9875\u67e5\u8be2 \u00b6 2.6.7.1 \u601d\u8def\u4e00 \u00b6 \u5728\u7d22\u5f15\u4e0a\u5b8c\u6210\u6392\u5e8f\u5206\u9875\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u6839\u636e\u4e3b\u952e\u5173\u8054\u56de\u539f\u8868\u67e5\u8be2\u6240\u9700\u8981\u7684\u5176\u5b83\u5217\u5185\u5bb9\u3002\u4f8b\uff1a MariaDB [ MYISAM_TEST ] > explain select * from Scores order by id limit 2 offset 1 ; +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ | 1 | SIMPLE | Scores | ALL | NULL | NULL | NULL | NULL | 6 | Using filesort | +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ -- \u4f18\u5316\u5199\u6cd5 MariaDB [ MYISAM_TEST ] > explain select a . * from Scores a inner join ( select Id from Scores order by id limit 2 offset 1 ) b on a . id = b . id ; +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+ | 1 | PRIMARY | < derived2 > | ALL | NULL | NULL | NULL | NULL | 3 | | | 1 | PRIMARY | a | ALL | id_index | NULL | NULL | NULL | 6 | Using where ; Using join buffer ( flat , BNL join ) | | 2 | DERIVED | Scores | index | NULL | id_index | 5 | NULL | 3 | Using index | +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+ 2.6.7.2 \u601d\u8def\u4e8c \u00b6 \u628aLIMIT\u67e5\u8be2\u8f6c\u6362\u6210\u67d0\u4e2a\u4f4d\u7f6e\u7684\u67e5\u8be2\u3002 explain select * from scores order by score limit 410 , 10 ; select score from scores order by score desc limit 400 , 10 ; -- \u53d6\u51fa\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6 explain select * from scores where score < 4000 order by socre desc limit 10 ; 2.6.8 \u4f7f\u7528 SQL \u63d0\u793a \u00b6 \u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728 SQL \u8bed\u53e5\u4e2d\u52a0\u5165\u4e00\u4e9b\u4eba\u4e3a\u7684\u63d0\u793a\uff08 hint \uff09\u6765\u8fbe\u5230\u4f18\u5316\u64cd\u4f5c\u7684\u76ee\u7684\u3002 2.6.8.1 USE INDEX \u00b6 \u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u8868\u540d\u7684\u540e\u9762\uff0c \u6dfb\u52a0 USE INDEX \u6765\u63d0\u4f9b\u5e0c\u671b MySQL \u53bb\u53c2\u8003\u7684\u7d22\u5f15\u5217\u8868\uff0c \u5c31\u53ef\u4ee5\u8ba9 MySQL \u4e0d\u518d\u8003\u8651\u5176\u4ed6\u53ef\u7528\u7684\u7d22\u5f15\u3002 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD USE INDEX ( PRIMARY ) WHERE ID > 1 \\ G ; 2.6.8.2 IGNORE INDEX \u00b6 \u5982\u679c\u7528\u6237\u53ea\u662f\u5355\u7eaf\u5730\u60f3\u8ba9 MySQL \u5ffd\u7565\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7d22\u5f15\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 IGNORE INDEX \u4f5c\u4e3a HINT\u3002 2.6.8.3 FORCE INDEX \u00b6 \u4e3a\u5f3a\u5236 MySQL \u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u7684\u7d22\u5f15\uff0c\u53ef\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528 FORCE INDEX \u4f5c\u4e3a HINT\u3002","title":"25. SQL\u4f18\u5316"},{"location":"mysql/25. SQL\u4f18\u5316/#1","text":"","title":"1. \u4f18\u5316\u4e00\u822c\u6b65\u9aa4"},{"location":"mysql/25. SQL\u4f18\u5316/#11-sql","text":"\u4f7f\u7528 show [session|global] status \u63d0\u4f9b\u670d\u52a1\u5668\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u9ed8\u8ba4\u662fsession\u7b49\u7ea7\u3002 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE \"Com_%\" ; Com_xxx \u8868\u793a\u6bcf\u4e2a xxx \u8bed\u53e5\u6267\u884c\u7684\u6b21\u6570\uff0c\u6211\u4eec\u901a\u5e38\u6bd4\u8f83\u5173\u5fc3\u7684\u662f\u4ee5\u4e0b\u51e0\u4e2a\u7edf\u8ba1\u53c2\u6570\u3002 Com_select\uff1a\u6267\u884c select \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u4e00\u6b21\u67e5\u8be2\u53ea\u7d2f\u52a0 1\u3002 Com_insert\uff1a \u6267\u884c INSERT \u64cd\u4f5c\u7684\u6b21\u6570\uff0c \u5bf9\u4e8e\u6279\u91cf\u63d2\u5165\u7684 INSERT \u64cd\u4f5c\uff0c \u53ea\u7d2f\u52a0\u4e00\u6b21\u3002 Com_update\uff1a\u6267\u884c UPDATE \u64cd\u4f5c\u7684\u6b21\u6570\u3002 Com_delete\uff1a\u6267\u884c DELETE \u64cd\u4f5c\u7684\u6b21\u6570\u3002 \u4e0a\u9762\u8fd9\u4e9b\u53c2\u6570\u5bf9\u4e8e\u6240\u6709\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u64cd\u4f5c\u90fd\u4f1a\u8fdb\u884c\u7d2f\u8ba1\u3002\u4e0b\u9762\u8fd9\u51e0\u4e2a\u53c2\u6570\u53ea\u662f\u9488\u5bf9InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\uff0c\u7d2f\u52a0\u7684\u7b97\u6cd5\u4e5f\u7565\u6709\u4e0d\u540c\u3002 Innodb_rows_read\uff1aselect \u67e5\u8be2\u8fd4\u56de\u7684\u884c\u6570\u3002 Innodb_rows_inserted\uff1a\u6267\u884c INSERT \u64cd\u4f5c\u63d2\u5165\u7684\u884c\u6570\u3002 Innodb_rows_updated\uff1a\u6267\u884c UPDATE \u64cd\u4f5c\u66f4\u65b0\u7684\u884c\u6570\u3002 Innodb_rows_deleted\uff1a\u6267\u884c DELETE \u64cd\u4f5c\u5220\u9664\u7684\u884c\u6570\u3002 \u5bf9\u4e8e\u66f4\u65b0\u64cd\u4f5c\u7684\u8ba1\u6570\uff0c\u662f\u5bf9\u6267\u884c\u6b21\u6570\u7684\u8ba1\u6570\uff0c\u4e0d\u8bba\u63d0\u4ea4\u8fd8\u662f\u56de\u6eda\u90fd\u4f1a\u8fdb\u884c\u7d2f\u52a0\u3002 \u5bf9\u4e8e\u4e8b\u52a1\u578b\u7684\u5e94\u7528\uff0c \u901a\u8fc7 Com_commit \u548c Com_rollback \u53ef\u4ee5\u4e86\u89e3\u4e8b\u52a1\u63d0\u4ea4\u548c\u56de\u6eda\u7684\u60c5\u51b5\u3002 \u6b64\u5916\uff0c\u4ee5\u4e0b\u51e0\u4e2a\u53c2\u6570\u4fbf\u4e8e\u7528\u6237\u4e86\u89e3\u6570\u636e\u5e93\u7684\u57fa\u672c\u60c5\u51b5\u3002 Connections\uff1a\u8bd5\u56fe\u8fde\u63a5 MySQL \u670d\u52a1\u5668\u7684\u6b21\u6570\u3002 Uptime\uff1a\u670d\u52a1\u5668\u5de5\u4f5c\u65f6\u95f4\u3002 Slow_queries\uff1a\u6162\u67e5\u8be2\u7684\u6b21\u6570\u3002","title":"1.1 \u4e86\u89e3SQL\u7684\u6267\u884c\u9891\u7387"},{"location":"mysql/25. SQL\u4f18\u5316/#12-sql","text":"\u4e24\u79cd\u65b9\u6cd5\uff1a \u901a\u8fc7\u6162\u67e5\u8be2\u65e5\u5fd7\u5b9a\u4f4d\u90a3\u4e9b\u6267\u884c\u6548\u7387\u8f83\u4f4e\u7684 SQL \u8bed\u53e5\uff0c\u7528 --log-slow-queries[=file_name] \u9009\u9879\u542f\u52a8\u65f6\uff0c mysqld \u5199\u4e00\u4e2a\u5305\u542b\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7 long_query_time \uff08show variables like 'long_query_time';\uff09\u79d2\u7684 SQL \u8bed\u53e5\u7684\u65e5\u5fd7\u6587\u4ef6\u3002 \u4f7f\u7528 show processlist \u547d\u4ee4\u67e5\u770b\u5f53\u524d MySQL \u5728\u8fdb\u884c\u7684\u7ebf\u7a0b\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u72b6\u6001\u3001\u662f\u5426\u9501\u8868\u7b49\uff0c\u53ef\u4ee5\u5b9e\u65f6\u5730\u67e5\u770b SQL \u7684\u6267\u884c\u60c5\u51b5\uff0c\u540c\u65f6\u5bf9\u4e00\u4e9b\u9501\u8868\u64cd\u4f5c\u8fdb\u884c\u4f18\u5316\u3002","title":"1.2 \u5b9a\u4f4d\u6267\u884c\u6548\u7387\u8f83\u4f4e\u7684 SQL"},{"location":"mysql/25. SQL\u4f18\u5316/#13-sql","text":"\u5b9a\u4f4d\u5230\u6548\u7387\u4f4e\u7684 SQL \u8bed\u53e5\u540e\uff0c \u53ef\u4ee5\u901a\u8fc7 EXPLAIN \u6216\u8005 DESC \u547d\u4ee4\u83b7\u53d6 MySQL \u5982\u4f55\u6267\u884c SELECT \u8bed\u53e5\u7684\u4fe1\u606f\u3002 EXPLAIN [ explain_type ] SELECT select_options explain_type : EXTENDED | PARTITIONS Or : -- \u540c DESC tbl_name EXPLAIN tbl_name MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : CHILD type : index possible_keys : NULL key : PARENT_ID key_len : 3 ref : NULL rows : 5 Extra : Using index select_type\uff1aSIMPLE \uff08\u7b80\u5355\u8868\uff0c \u5373\u4e0d\u4f7f\u7528\u8868\u8fde\u63a5\u6216\u8005\u5b50\u67e5\u8be2\uff09\u3001PRIMARY\uff08\u4e3b\u67e5\u8be2\uff0c\u5373\u5916\u5c42\u7684\u67e5\u8be2\uff09\u3001UNION\uff08UNION \u4e2d\u7684\u7b2c\u4e8c\u4e2a\u6216 \u8005\u540e\u9762\u7684\u67e5\u8be2\u8bed\u53e5\uff09\u3001SUBQUERY\uff08\u5b50\u67e5\u8be2\u4e2d\u7684\u7b2c\u4e00\u4e2a SELECT\uff09\u7b49 type\uff1a\u8fde\u63a5\u7c7b\u578b\u3002\u6027\u80fd\u7531\u597d\u5230\u5dee\u7684\u8fde\u63a5\u7c7b\u578b\u4e3a system \uff08\u8868\u4e2d\u4ec5\u6709\u4e00\u884c\uff0c\u5373\u5e38\u91cf\u8868\uff09\u3001 const \uff08\u5355\u8868\u4e2d\u6700\u591a\u6709\u4e00\u4e2a\u5339\u914d\u884c\uff0c\u4f8b\u5982 primary key \u6216\u8005 unique index\uff09\u3001 eq_ref \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\uff0c\u5728\u6b64\u8868\u4e2d\u53ea\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u591a\u8868\u8fde\u63a5\u4e2d\u4f7f\u7528 primary key \u6216\u8005 unique index\uff09\u3001 ref \uff08\u4e0e eq_ref \u7c7b\u4f3c\uff0c \u533a\u522b\u5728\u4e8e\u4e0d\u662f\u4f7f\u7528 primary key \u6216\u8005 unique index\uff0c\u800c\u662f\u4f7f\u7528\u666e\u901a\u7684\u7d22\u5f15\uff09\u3001 ref_or_null \uff08\u4e0e ref \u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e\u6761\u4ef6\u4e2d\u5305\u542b\u5bf9 NULL \u7684\u67e5\u8be2\uff09 \u3001 index_merge (\u7d22\u5f15\u5408\u5e76\u4f18\u5316)\u3001 unique_subquery \uff08in\u7684\u540e\u9762\u662f\u4e00\u4e2a\u67e5\u8be2\u4e3b\u952e\u5b57\u6bb5\u7684\u5b50\u67e5\u8be2\uff09\u3001 index_subquery \uff08\u4e0e unique_subquery \u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e in \u7684\u540e\u9762\u662f\u67e5\u8be2\u975e\u552f\u4e00\u7d22\u5f15\u5b57\u6bb5\u7684\u5b50\u67e5\u8be2\uff09\u3001 range \uff08\u5355\u8868\u4e2d\u7684\u8303\u56f4\u67e5\u8be2\uff09\u3001 index \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\uff0c \u90fd\u901a\u8fc7\u67e5\u8be2\u7d22\u5f15\u6765\u5f97\u5230\u6570\u636e\uff09\u3001 all \uff08\u5bf9\u4e8e\u524d\u9762\u7684\u6bcf\u4e00\u884c\u90fd\u901a\u8fc7\u5168\u8868\u626b\u63cf\u6765\u5f97\u5230\u6570\u636e\uff09\u3002 key\uff1a\u8868\u793a\u5b9e\u9645\u4f7f\u7528\u7684\u7d22\u5f15\u3002 rows\uff1a\u626b\u63cf\u884c\u7684\u6570\u91cf\u3002 Extra\uff1a\u6267\u884c\u60c5\u51b5\u7684\u8bf4\u660e\u548c\u63cf\u8ff0\u3002","title":"1.3 \u5206\u6790\u4f4e\u6548 SQL \u7684\u6267\u884c\u8ba1\u5212"},{"location":"mysql/25. SQL\u4f18\u5316/#14-show-profile-sql","text":"\u8bed\u6cd5\uff1a -- \u5217\u51fa\u6240\u6709\u7684\u8fdb\u7a0b\u53ca\u6d88\u8017\u65f6\u95f4 SHOW PROFILES ; -- \u5217\u51fa\u8fdb\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u7ebf\u7a0b\u5177\u4f53\u7684\u8017\u65f6 SHOW PROFILE [ type [, type ] ... ] [ FOR QUERY n ] [ LIMIT row_count [ OFFSET offset ]] type : { ALL | BLOCK IO | CONTEXT SWITCHES | CPU | IPC | MEMORY | PAGE FAULTS | SOURCE | SWAPS } \u663e\u793a\u5206\u6790\u4fe1\u606f\uff0c\u6307\u793a\u5728\u5f53\u524d\u4f1a\u8bdd\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u8bed\u53e5\u7684\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002 \u4f7f\u7528\u793a\u4f8b \u8fd8\u53ef\u4ee5\u901a\u8fc7 INFORMATION_SCHEMA.PROFILING \u8868\u83b7\u53d6\u4fe1\u606f\u3002 \u67e5\u770b\u662f\u5426\u652f\u6301\uff1a SELECT @@ HAVE_PROFILING ; \u6253\u5f00\u8be5\u529f\u80fd\uff1a -- \u67e5\u770b\u662f\u5426\u5f00\u542f SELECT @@ profiling ; -- \u5f00\u542f SET profiling = 1 ; Note Sending data \u8868\u793a\u7684\u662fMySQL\u7ebf\u7a0b\u4ece\u5f00\u59cb\u8bbf\u95ee\u6570\u636e\u884c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u65f6\u957f\u3002","title":"1.4 \u901a\u8fc7 SHOW PROFILE \u5206\u6790 SQL"},{"location":"mysql/25. SQL\u4f18\u5316/#2","text":"","title":"2. \u7d22\u5f15"},{"location":"mysql/25. SQL\u4f18\u5316/#21","text":"MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u662f\u81ea\u52a8\u5206\u5f00\u5b58\u50a8\u7684\uff0c \u5404\u81ea\u662f\u72ec\u7acb\u7684\u4e00\u4e2a\u6587\u4ef6\uff1b InnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u662f\u5b58\u50a8\u5728\u540c\u4e00\u4e2a\u8868\u7a7a\u95f4\u91cc\u9762\uff0c\u4f46\u53ef\u4ee5\u6709\u591a\u4e2a\u6587\u4ef6\u7ec4\u6210\u3002 MySQL \u4e2d\u7d22\u5f15\u7684\u5b58\u50a8\u7c7b\u578b\uff1a BTREE\uff1aMyISAM\u3001InnoDB\u3001MEMORY\u3001HEAP\u5b58\u50a8\u5f15\u64ce\u90fd\u652f\u6301 BTREE \u7d22\u5f15 HASH\uff1aMEMORY/HEAP \u5b58\u50a8\u5f15\u64ce\u652f\u6301 HASH \u7d22\u5f15 RTREE\uff1a\u7a7a\u95f4\u7d22\u5f15\u3002MyISAM \u7279\u6b8a\u7684\u7d22\u5f15\u7c7b\u578b FULLTEXT\uff1a\u5168\u6587\u7d22\u5f15\u3002MyISAM \u7279\u6b8a\u7684\u7d22\u5f15\u7c7b\u578b\uff1bInnoDB\u4ece 5.6 \u7248\u672c\u652f\u6301\u3002 \u524d\u7f00\u7d22\u5f15","title":"2.1 \u7d22\u5f15\u7684\u5b58\u50a8\u5206\u7c7b"},{"location":"mysql/25. SQL\u4f18\u5316/#22","text":"\u67e5\u8be2\u8981\u4f7f\u7528\u7d22\u5f15\u6700\u4e3b\u8981\u7684\u6761\u4ef6\u662f \u67e5\u8be2\u6761\u4ef6\u4e2d\u9700\u8981\u4f7f\u7528\u7d22\u5f15\u5173\u952e\u5b57 \uff0c\u5982\u679c\u662f\u591a\u5217\u7d22\u5f15\uff0c\u90a3\u4e48\u53ea\u6709\u67e5\u8be2\u6761\u4ef6\u4f7f\u7528\u4e86\u591a\u5217\u5173\u952e\u5b57 \u7b2c\u4e00\u4e2a\u5173\u952e\u5b57 \u7684\u524d\u7f00\u65f6\uff0c \u624d\u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\uff0c \u5426\u5219\u5c06\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\u3002 \u5bf9\u4e8e\u521b\u5efa\u7684\u591a\u5217\u7d22\u5f15\uff0c\u53ea\u8981\u67e5\u8be2\u7684\u6761\u4ef6\u4e2d\u7528\u5230\u4e86\u7b2c\u4e00\u5217\uff0c\u7d22\u5f15\u4e00\u822c\u5c31\u4f1a\u88ab\u4f7f\u7528 \u5bf9\u4e8e\u4f7f\u7528 like \u7684\u67e5\u8be2\uff0c\u540e\u9762\u5982\u679c\u662f\u5e38\u91cf\u5e76\u4e14\u53ea\u6709\uff05\u53f7\u4e0d\u5728\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u7d22\u5f15\u624d\u53ef\u80fd\u4f1a\u88ab\u4f7f\u7528 -- \u4f7f\u7528\u4e86\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME LIKE 'DS' \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : range possible_keys : mutil_index key : mutil_index key_len : 31 ref : NULL rows : 1 Extra : Using index condition 1 row in set ( 0 . 00 sec ) -- \u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME LIKE '%DS' \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ALL possible_keys : NULL key : NULL key_len : NULL ref : NULL rows : 1 Extra : Using where 1 row in set ( 0 . 00 sec ) \u5982\u679c\u5bf9\u5927\u7684\u6587\u672c\u8fdb\u884c\u641c\u7d22\uff0c\u4f7f\u7528\u5168\u6587\u7d22\u5f15\u800c\u4e0d\u8981\u4f7f\u7528 like \u2018%\u2026%\u2019 \u3002 \u76f8\u5173\u535a\u5ba2 \u3002 \u5982\u679c\u5217\u540d\u662f\u7d22\u5f15\uff0c\u4f7f\u7528 column_name is null \u5c06\u4f7f\u7528\u7d22\u5f15\u3002 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE NAME IS NULL \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ref possible_keys : mutil_index key : mutil_index key_len : 31 ref : const rows : 1 Extra : Using index condition 1 row in set ( 0 . 00 sec ) -- \u867d\u7136 DESCRIPTION \u4e5f\u662f\u7d22\u5f15\u7684\u4e2d\u7684\u5173\u952e\u5b57\uff0c\u4f46\u662f\u4e0d\u662f\u7b2c\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM index_test WHERE DESCRIPTION IS NULL \\ G ; *************************** 1 . row *************************** id : 1 select_type : SIMPLE table : index_test type : ALL possible_keys : NULL key : NULL key_len : NULL ref : NULL rows : 1 Extra : Using where 1 row in set ( 0 . 00 sec ) \u4ec5\u4ec5\u5bf9\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\uff0c\u5f53\u67e5\u8be2\u7684\u5217\u90fd\u5728\u7d22\u5f15\u7684\u5b57\u6bb5\u4e2d\u65f6\uff08\u67e5\u8be2\u5b57\u6bb5\u4e2d\u7684\u7d22\u5f15\u5217\u8981\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u4f7f\u7528\u7684\u7d22\u5f15\u4e2d\uff09\uff0c\u67e5\u8be2\u7684\u6548\u7387\u66f4\u9ad8","title":"2.2 \u4f7f\u7528\u7d22\u5f15"},{"location":"mysql/25. SQL\u4f18\u5316/#23","text":"\u5982\u679c MySQL \u4f30\u8ba1\u4f7f\u7528\u7d22\u5f15\u6bd4\u5168\u8868\u626b\u63cf\u66f4\u6162\uff0c\u5219\u4e0d\u4f7f\u7528\u7d22\u5f15\u3002 \u5982\u679c\u4f7f\u7528 MEMORY/HEAP \u8868\u5e76\u4e14 where \u6761\u4ef6\u4e2d\u4e0d\u4f7f\u7528 = \u8fdb\u884c\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u4e0d\u4f1a\u7528\u5230\u7d22\u5f15\u3002heap \u8868\u53ea\u6709\u5728 = \u7684\u6761\u4ef6\u4e0b\u624d\u4f1a\u4f7f\u7528\u7d22\u5f15\u3002 \u7528 or \u5206\u5272\u5f00\u7684\u6761\u4ef6\uff0c \u5982\u679c or \u524d\u7684\u6761\u4ef6\u4e2d\u7684\u5217\u6709\u7d22\u5f15\uff0c \u800c\u540e\u9762\u7684\u5217\u4e2d\u6ca1\u6709\u7d22\u5f15\uff0c\u90a3\u4e48\u6d89\u53ca\u5230\u7684\u7d22\u5f15\u90fd\u4e0d\u4f1a\u88ab\u7528\u5230\u3002\u5373\u6709\u4e00\u4e2a\u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\u90a3\u4e48\u5c31\u4e0d\u4f1a\u4f7f\u7528\u7d22\u5f15\u3002 \u5982\u679c\u4e0d\u662f\u7d22\u5f15\u5217\u7684\u7b2c\u4e00\u5217 \u5982\u679c like \u662f\u4ee5 \uff05 \u5f00\u59cb \u5982\u679c\u5217\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u4e00\u5b9a\u8bb0\u5f97\u5728 where \u6761\u4ef6\u4e2d\u628a\u5b57\u7b26\u5e38\u91cf\u503c\u7528 \u5f15\u53f7 \u5f15\u8d77\u6765\uff0c\u5426\u5219\u7684\u8bdd\u5373\u4fbf\u8fd9\u4e2a\u5217\u4e0a\u6709\u7d22\u5f15\uff0cMySQL \u4e5f\u4e0d\u4f1a\u7528\u5230\u7684","title":"2.3 \u5b58\u5728\u7d22\u5f15\u4f46\u4e0d\u4f7f\u7528\u7d22\u5f15"},{"location":"mysql/25. SQL\u4f18\u5316/#24","text":"MYSQL > SHOW STATUS LIKE 'Handler_read%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | Handler_read_first | 3 | | Handler_read_key | 0 | | Handler_read_last | 0 | | Handler_read_next | 18 | | Handler_read_prev | 0 | | Handler_read_rnd | 0 | | Handler_read_rnd_deleted | 0 | | Handler_read_rnd_next | 36 | +--------------------------+-------+ \u5982\u679c\u7d22\u5f15\u6b63\u5728\u5de5\u4f5c\uff0c Handler_read_key \u7684\u503c\u5c06\u5f88\u9ad8\uff0c\u8fd9\u4e2a\u503c\u4ee3\u8868\u4e86\u4e00\u4e2a\u884c\u88ab\u7d22\u5f15\u503c\u8bfb\u7684\u6b21\u6570\uff0c\u5f88\u4f4e\u7684\u503c\u8868\u660e\u589e\u52a0\u7d22\u5f15\u5f97\u5230\u7684\u6027\u80fd\u6539\u5584\u4e0d\u9ad8\uff0c\u56e0\u4e3a\u7d22\u5f15\u5e76\u4e0d\u7ecf\u5e38\u4f7f\u7528\u3002 Handler_read_rnd_next \u7684\u503c\u9ad8\u5219\u610f\u5473\u7740\u67e5\u8be2\u8fd0\u884c\u4f4e\u6548\uff0c\u5e76\u4e14\u5e94\u8be5\u5efa\u7acb\u7d22\u5f15\u8865\u6551\u3002\u8fd9\u4e2a\u503c\u7684\u542b\u4e49\u662f\u5728\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u4e0b\u4e00\u884c\u7684\u8bf7\u6c42\u6570\u3002\u5982\u679c\u6b63\u8fdb\u884c\u5927\u91cf\u7684\u8868\u626b\u63cf\uff0c Handler_read_rnd_next \u7684\u503c\u8f83\u9ad8\uff0c \u5219\u901a\u5e38\u8bf4\u660e\u8868\u7d22\u5f15\u4e0d\u6b63\u786e\u6216\u5199\u5165\u7684\u67e5\u8be2\u6ca1\u6709\u5229\u7528\u7d22\u5f15\u3002","title":"2.4 \u67e5\u770b\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5"},{"location":"mysql/25. SQL\u4f18\u5316/#25","text":"\u8fd9\u4e9b\u7ef4\u62a4\u64cd\u4f5c \u4f1a\u9020\u6210\u8868\u7684\u9501\u5b9a \uff0c\u4e0d\u8981\u5728\u6570\u636e\u5e93\u7e41\u5fd9\u7684\u65f6\u5019\u6267\u884c\u3002","title":"2.5 \u4e24\u4e2a\u7b80\u5355\u5b9e\u7528\u7684\u4f18\u5316\u65b9\u6cd5"},{"location":"mysql/25. SQL\u4f18\u5316/#251","text":"ANALYZE [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... \u672c\u8bed\u53e5\u7528\u4e8e\u5206\u6790\u548c\u5b58\u50a8\u8868\u7684\u5173\u952e\u5b57\u5206\u5e03\uff0c \u5206\u6790\u7684\u7ed3\u679c\u5c06\u53ef\u4ee5\u4f7f\u5f97\u7cfb\u7edf\u5f97\u5230\u51c6\u786e\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f7f\u5f97 SQL \u80fd\u591f\u751f\u6210\u6b63\u786e\u7684\u6267\u884c\u8ba1\u5212\u3002 \u5982\u679c\u7528\u6237\u611f\u89c9\u5b9e\u9645\u6267\u884c\u8ba1\u5212\u5e76\u4e0d\u662f\u9884\u671f\u7684\u6267\u884c\u8ba1\u5212\uff0c \u6267\u884c\u4e00\u6b21\u5206\u6790\u8868\u53ef\u80fd\u4f1a\u89e3\u51b3\u95ee\u9898\u3002 \u5728\u5206\u6790\u671f\u95f4\uff0c \u4f7f\u7528\u4e00\u4e2a\u8bfb\u53d6\u9501\u5b9a\u5bf9\u8868\u8fdb\u884c\u9501\u5b9a\u3002 \u652f\u6301 InnoDB , NDB , MyISAM \u4ee5\u53ca\u5206\u533a\u8868\uff0c\u4e0d\u652f\u6301\u89c6\u56fe\u3002 CHECK TABLE tbl_name [, tbl_name ] ... [ option ] ... option = { FOR UPGRADE | QUICK | FAST | MEDIUM | EXTENDED | CHANGED } \u68c0\u67e5\u8868\u7684\u4f5c\u7528\u662f\u68c0\u67e5\u4e00\u4e2a\u6216\u591a\u4e2a \u8868/\u89c6\u56fe \u662f\u5426\u6709\u9519\u8bef\u3002 \u652f\u6301 InnoDB , MyISAM , ARCHIVE , CSV \u4ee5\u53ca\u5206\u533a\u8868\uff0c\u5bf9\u4e8eInnoDB\u6709 \u6ce8\u610f\u4e8b\u9879 \u3002","title":"2.5.1 \u5b9a\u671f\u5206\u6790\u8868\u548c\u68c0\u67e5\u8868"},{"location":"mysql/25. SQL\u4f18\u5316/#252","text":"OPTIMIZE [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... \u5982\u679c\u5df2\u7ecf\u5220\u9664\u4e86\u8868\u7684\u4e00\u5927\u90e8\u5206\uff0c\u6216\u8005\u5982\u679c\u5df2\u7ecf\u5bf9\u542b\u6709\u53ef\u53d8\u957f\u5ea6\u884c\u7684\u8868\uff08\u542b\u6709 VARCHAR\u3001BLOB \u6216 TEXT \u5217\u7684\u8868\uff09 \u8fdb\u884c\u4e86\u5f88\u591a\u66f4\u6539\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u8bed\u53e5\u4f18\u5316\u3002 \u8fd9\u4e2a\u547d\u4ee4\u53ef\u4ee5\u5c06\u8868\u4e2d\u7684\u7a7a\u95f4\u788e\u7247\u8fdb\u884c\u5408\u5e76\uff0c \u5e76\u4e14\u53ef\u4ee5\u6d88\u9664\u7531\u4e8e\u5220\u9664\u6216\u8005\u66f4\u65b0\u9020\u6210\u7684\u7a7a\u95f4\u6d6a\u8d39\u3002 \u5bf9\u4e8eInnoDB\uff0c\u53ef\u4ee5\u8bbe\u7f6e innodb_file_per_table \u53c2\u6570\uff0c\u8fd9\u6837\u4f1a\u5bf9\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u6bcf\u4e2a\u8868\u751f\u6210\u4e00\u4e2a\u72ec\u7acb\u7684ibd\u6587\u4ef6\uff0c\u7528\u4e8e\u5b58\u50a8\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u3002\u53e6\u5916\u3002\u5728\u5220\u9664\u5927\u91cf\u6570\u636e\u4e4b\u540eInnoDB\u8868\u53ef\u4ee5\u901a\u8fc7 ALTER TABLE table_name ENGINE=Innodb \u4f46\u662f\u4e0d\u4fee\u6539\u5f15\u64ce\u7684\u65b9\u5f0f\u6765\u56de\u6536\u4e0d\u4f7f\u7528\u7684\u7a7a\u95f4\u3002 \u4f7f\u7528\u65f6\u6709\u8bf8\u591a\u9650\u5236\uff0c\u8be6\u60c5\u53c2\u8003 MySQL 5.5\u624b\u518c \u3002","title":"2.5.2  \u5b9a\u671f\u4f18\u5316\u8868"},{"location":"mysql/25. SQL\u4f18\u5316/#26-sql","text":"","title":"2.6 \u5e38\u7528 SQL \u7684\u4f18\u5316"},{"location":"mysql/25. SQL\u4f18\u5316/#261","text":"","title":"2.6.1 \u5927\u6279\u91cf\u63d2\u5165\u6570\u636e"},{"location":"mysql/25. SQL\u4f18\u5316/#2611-myisam","text":"\u5f53\u7528 load \u547d\u4ee4\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u9002\u5f53\u7684\u8bbe\u7f6e\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u901f\u5ea6\u3002 \u5bf9\u4e8e MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5feb\u901f\u7684\u5bfc\u5165\u5927\u91cf\u7684\u6570\u636e\u3002 -- \u5173\u95ed MyISAM \u8868\u975e\u552f\u4e00\u7d22\u5f15\u7684\u66f4\u65b0 ALTER TABLE tbl_name DISABLE KEYS ; loading the data -- \u6253\u5f00 MyISAM \u8868\u975e\u552f\u4e00\u7d22\u5f15\u7684\u66f4\u65b0 ALTER TABLE tbl_name ENABLE KEYS ; \u5728\u5bfc\u5165\u5927\u91cf\u7684\u6570\u636e\u5230\u4e00\u4e2a\u975e\u7a7a\u7684 MyISAM \u8868\u65f6\uff0c \u901a\u8fc7\u8bbe\u7f6e\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c \u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002 \u5bf9\u4e8e\u5bfc\u5165\u5927\u91cf\u6570\u636e\u5230\u4e00\u4e2a\u7a7a\u7684 MyISAM \u8868\uff0c \u9ed8\u8ba4\u5c31\u662f\u5148\u5bfc\u5165\u6570\u636e\u7136\u540e\u624d\u521b\u5efa\u7d22\u5f15\u7684\uff0c \u6240\u4ee5\u4e0d\u7528\u8fdb\u884c\u8bbe\u7f6e\u3002","title":"2.6.1.1 \u63d0\u9ad8MyISAM\u8868\u7684\u5bfc\u5165\u6548\u7387"},{"location":"mysql/25. SQL\u4f18\u5316/#2612-innodb","text":"\u56e0\u4e3a InnoDB \u7c7b\u578b\u7684\u8868\u662f\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u4fdd\u5b58\u7684\uff0c \u6240\u4ee5\u5c06\u5bfc\u5165\u7684\u6570\u636e\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u6392\u5217\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u63d0\u9ad8\u5bfc\u5165\u6570\u636e\u7684\u6548\u7387\u3002 \u5728\u5bfc\u5165\u6570\u636e\u524d\u6267\u884c SET UNIQUE_CHECKS=0 \uff0c\u5173\u95ed\u552f\u4e00\u6027\u6821\u9a8c\uff0c\u5728\u5bfc\u5165\u7ed3\u675f\u540e\u6267\u884cSET UNIQUE_CHECKS=1\uff0c\u6062\u590d\u552f\u4e00\u6027\u6821\u9a8c\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002 \u5982\u679c\u5e94\u7528\u4f7f\u7528\u81ea\u52a8\u63d0\u4ea4\u7684\u65b9\u5f0f\uff0c\u5efa\u8bae\u5728\u5bfc\u5165\u524d\u6267\u884c SET AUTOCOMMIT=0 \uff0c\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\uff0c\u5bfc\u5165\u7ed3\u675f\u540e\u518d\u6267\u884c SET AUTOCOMMIT=1\uff0c\u6253\u5f00\u81ea\u52a8\u63d0\u4ea4\uff0c\u4e5f\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387\u3002","title":"2.6.1.2 \u63d0\u9ad8InnoDB\u8868\u7684\u5bfc\u5165\u6548\u7387"},{"location":"mysql/25. SQL\u4f18\u5316/#262-insert","text":"\u5982\u679c\u540c\u65f6\u4ece\u540c\u4e00\u5ba2\u6237\u7aef\u63d2\u5165\u5f88\u591a\u884c\uff0c\u5c3d\u91cf\u4f7f\u7528\u591a\u503c\u63d2\u5165\u8bed\u53e5\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c06\u5927\u5927\u7f29\u51cf\u5ba2\u6237\u7aef\u4e0e\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u8fde\u63a5\u3001\u5173\u95ed\u7b49\u6d88\u8017 insert into table_name values ( 1 , 2 ),( 1 , 3 ),( 1 , 4 ) \u2026 \u5982\u679c\u4ece\u4e0d\u540c\u5ba2\u6237\u63d2\u5165\u5f88\u591a\u884c\uff0c\u80fd\u901a\u8fc7\u4f7f\u7528 INSERT DELAYED \u8bed\u53e5\u5f97\u5230\u66f4\u9ad8\u7684\u901f\u5ea6\u3002 DELAYED \u7684\u542b\u4e49\u662f\u8ba9 INSERT \u8bed\u53e5\u9a6c\u4e0a\u6267\u884c\uff0c\u5176\u5b9e\u6570\u636e\u90fd\u88ab\u653e\u5728\u5185\u5b58\u7684\u961f\u5217\u4e2d\uff0c\u5e76\u6ca1\u6709 \u771f\u6b63\u5199\u5165\u78c1\u76d8\uff0c\u8fd9\u6bd4\u6bcf\u6761\u8bed\u53e5\u5206\u522b\u63d2\u5165\u8981\u5feb\u7684\u591a\uff1bLOW_PRIORITY \u521a\u597d\u76f8\u53cd\uff0c\u5728\u6240\u6709\u5176 \u4ed6\u7528\u6237\u5bf9\u8868\u7684\u8bfb\u5199\u5b8c\u540e\u624d\u8fdb\u884c\u63d2\u5165\uff1b \u5c06\u7d22\u5f15\u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6\u5206\u5728\u4e0d\u540c\u7684\u78c1\u76d8\u4e0a\u5b58\u653e\uff08\u5229\u7528\u5efa\u8868\u4e2d\u7684\u9009\u9879\uff09\u3002 \u5982\u679c\u8fdb\u884c\u6279\u91cf\u63d2\u5165\uff0c\u53ef\u4ee5\u589e\u52a0 bulk_insert_buffer_size \u53d8\u91cf\u503c\u7684\u65b9\u6cd5\u6765\u63d0\u9ad8\u901f\u5ea6\uff0c\u4f46\u662f\uff0c\u8fd9\u53ea\u80fd\u5bf9 MyISAM \u8868\u4f7f\u7528\u3002 \u5f53\u4ece\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\u88c5\u8f7d\u4e00\u4e2a\u8868\u65f6\uff0c \u4f7f\u7528 LOAD DATA INFILE \u3002 \u8fd9\u901a\u5e38\u6bd4\u4f7f\u7528\u5f88\u591a INSERT \u8bed\u53e5\u5feb 20 \u500d\u3002","title":"2.6.2 \u4f18\u5316 INSERT \u8bed\u53e5"},{"location":"mysql/25. SQL\u4f18\u5316/#263-group-by","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c MySQL \u5bf9\u6240\u6709\u5b57\u6bb5 GROUP BY col1\uff0c col2.... \u8fdb\u884c\u6392\u5e8f\u3002 \u8fd9\u4e0e\u5728\u67e5\u8be2\u4e2d\u6307\u5b9aORDER BY col1\uff0ccol2... \u7c7b\u4f3c\u3002 \u5982\u679c\u67e5\u8be2\u5305\u62ec GROUP BY \u4f46\u7528\u6237\u60f3\u8981\u907f\u514d\u6392\u5e8f\u7ed3\u679c\u7684\u6d88\u8017\uff0c\u5219\u53ef\u4ee5\u6307\u5b9a ORDER BY NULL \u7981\u6b62\u6392\u5e8f\u3002","title":"2.6.3 \u4f18\u5316 GROUP BY \u8bed\u53e5"},{"location":"mysql/25. SQL\u4f18\u5316/#264-order-by","text":"\u4f18\u5316\u65b9\u5f0f\uff1a \u5c3d\u91cf\u51cf\u5c11\u989d\u5916\u7684\u6392\u5e8f\uff0c\u901a\u8fc7\u7d22\u5f15\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e \u3002","title":"2.6.4 \u4f18\u5316 ORDER BY \u8bed\u53e5"},{"location":"mysql/25. SQL\u4f18\u5316/#2641-mysql","text":"\u7b2c\u4e00\u79cd\uff1a\u901a\u8fc7\u6709\u5e8f\u7d22\u5f15\u987a\u5e8f\u626b\u63cf\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e\uff08\u67e5\u8be2\u7684\u5b57\u6bb5\u662f\u7d22\u5f15\u5b57\u6bb5\uff0c\u4f46\u4f60\u4ecd\u7136\u9700\u8981\u6307\u5b9a\u6392\u5e8f\u89c4\u5219\uff09\u3002\u6b64\u65b9\u5f0f\u5728\u4f7f\u7528 EXPLAIN \u5206\u6790\u65f6\u663e\u793a\u4e3a Using Index \uff0c\u65e0\u9700\u989d\u5916\u6392\u5e8f\u3002 \u7b2c\u4e8c\u79cd\uff1a\u5bf9\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u5373 filesort \u3002\u6392\u5e8f\u7684\u64cd\u4f5c\u53d6\u51b3\u4e8eMySQL\u5bf9\u6392\u5e8f\u53c2\u6570\u7684\u8bbe\u7f6e\u548c\u6392\u5e8f\u6570\u636e\u5927\u5c0f\u3002 \u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\uff1aWHERE \u6761\u4ef6\u548c ORDER BY \u4f7f\u7528\u76f8\u540c\u7684\u7d22\u5f15\uff0c\u5e76\u4e14 ORDER BY \u7684\u987a\u5e8f\u548c\u7d22\u5f15\u987a\u5e8f\u76f8\u540c\uff0c\u5e76\u4e14 ORDER BY \u7684\u5b57\u6bb5\u90fd\u662f\u5347\u5e8f\u6216\u8005\u90fd\u662f\u964d\u5e8f\u3002 \u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u4e0b\u5219\u4e0d\u4f7f\u7528\u7d22\u5f15\uff1a order by \u7684\u5b57\u6bb5\u6df7\u5408 ASC \u548c DESC \u7528\u4e8e\u67e5\u8be2\u884c\u7684\u5173\u952e\u5b57\u4e0e ORDER BY \u4e2d\u6240\u4f7f\u7528\u7684\u4e0d\u76f8\u540c \u5bf9\u4e0d\u540c\u7684\u5173\u952e\u5b57\u4f7f\u7528 ORDER BY\u3002\uff1f\uff1f\uff1f","title":"2.6.4.1 MySQL\u7684\u4e24\u79cd\u6392\u5e8f\u65b9\u5f0f"},{"location":"mysql/25. SQL\u4f18\u5316/#2642-filesort","text":"\u901a\u8fc7\u6bd4\u8f83\u7cfb\u7edf\u53d8\u91cf max_length_for_sort_data \u7684\u5927\u5c0f\u548cquery\u8bed\u53e5\u53bb\u9664\u7684\u5b57\u6bb5\u603b\u5927\u5c0f\u6765\u5224\u65ad\u4f7f\u7528\u54ea\u79cd\u7b97\u6cd5\u3002\u524d\u8005\u5927\u4f7f\u7528\u4e00\u6b21\u626b\u63cf\u7b97\u6cd5\uff0c\u5426\u5219\u4f7f\u7528\u4e8c\u6b21\u626b\u63cf\u7b97\u6cd5\u3002https://dev.mysql.com/doc/refman/5.5/en/order-by-optimization.html#order-by-filesort \u9002\u5f53\u52a0\u5927\u7cfb\u7edf\u53d8\u91cf max_length_for_sort_data \u7684\u503c\uff0c\u8fbe\u5230CPU\u4e0eIO\u5229\u7528\u5e73\u8861\u3002 \u9002\u5f53\u52a0\u5927 sort_buffer_size \u6392\u5e8f\u533a\uff0c\u5c3d\u91cf\u8ba9\u6392\u5e8f\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\u3002","title":"2.6.4.2 filesort\u4f18\u5316"},{"location":"mysql/25. SQL\u4f18\u5316/#265","text":"SQL \u7684\u5b50\u67e5\u8be2\u3002 \u8fd9\u4e2a\u6280\u672f\u53ef\u4ee5\u4f7f\u7528 SELECT \u8bed\u53e5\u6765\u521b\u5efa\u4e00\u4e2a\u5355\u5217\u7684\u67e5\u8be2\u7ed3\u679c\uff0c \u7136\u540e\u628a\u8fd9\u4e2a\u7ed3\u679c\u4f5c\u4e3a\u8fc7\u6ee4\u6761\u4ef6\u7528\u5728\u53e6\u4e00\u4e2a\u67e5\u8be2\u4e2d\u3002\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b50\u67e5\u8be2\u53ef\u4ee5\u88ab\u66f4\u6709\u6548\u7387\u7684\u8fde\u63a5\uff08JOIN\uff09\u66ff\u4ee3\u3002 \u8fde\u63a5 \uff08JOIN\uff09 \u4e4b\u6240\u4ee5\u66f4\u6709\u6548\u7387\u4e00\u4e9b\uff0c \u662f\u56e0\u4e3a MySQL \u4e0d\u9700\u8981\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e34\u65f6\u8868\u6765\u5b8c\u6210\u8fd9\u4e2a\u903b\u8f91\u4e0a\u7684\u9700\u8981\u4e24\u4e2a\u6b65\u9aa4\u7684\u67e5\u8be2\u5de5\u4f5c\u3002 -- \u5b50\u67e5\u8be2 mysql > select * from sales2 where company_id not in ( select id from company2 ); -- \u8fde\u63a5 mysql > select * from sales2 left join company2 on sales2 . company_id = company2 . id where sales2 . company_id is null ;","title":"2.6.5 \u4f18\u5316\u5d4c\u5957\u67e5\u8be2"},{"location":"mysql/25. SQL\u4f18\u5316/#266-or","text":"\u5bf9\u4e8e\u542b\u6709 OR \u7684\u67e5\u8be2\u5b50\u53e5\uff0c \u5982\u679c\u8981\u5229\u7528\u7d22\u5f15\uff0c \u5219 OR \u4e4b\u95f4\u7684 \u6bcf\u4e2a\u6761\u4ef6\u5217 \u90fd\u5fc5\u987b\u7528\u5230\u7d22\u5f15\uff1b\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0c\u5219\u5e94\u8be5\u8003\u8651\u589e\u52a0\u7d22\u5f15\u3002","title":"2.6.6 \u4f18\u5316 OR \u6761\u4ef6"},{"location":"mysql/25. SQL\u4f18\u5316/#267","text":"","title":"2.6.7 \u4f18\u5316\u5206\u9875\u67e5\u8be2"},{"location":"mysql/25. SQL\u4f18\u5316/#2671","text":"\u5728\u7d22\u5f15\u4e0a\u5b8c\u6210\u6392\u5e8f\u5206\u9875\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u6839\u636e\u4e3b\u952e\u5173\u8054\u56de\u539f\u8868\u67e5\u8be2\u6240\u9700\u8981\u7684\u5176\u5b83\u5217\u5185\u5bb9\u3002\u4f8b\uff1a MariaDB [ MYISAM_TEST ] > explain select * from Scores order by id limit 2 offset 1 ; +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ | 1 | SIMPLE | Scores | ALL | NULL | NULL | NULL | NULL | 6 | Using filesort | +------+-------------+--------+------+---------------+------+---------+------+------+----------------+ -- \u4f18\u5316\u5199\u6cd5 MariaDB [ MYISAM_TEST ] > explain select a . * from Scores a inner join ( select Id from Scores order by id limit 2 offset 1 ) b on a . id = b . id ; +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+ | 1 | PRIMARY | < derived2 > | ALL | NULL | NULL | NULL | NULL | 3 | | | 1 | PRIMARY | a | ALL | id_index | NULL | NULL | NULL | 6 | Using where ; Using join buffer ( flat , BNL join ) | | 2 | DERIVED | Scores | index | NULL | id_index | 5 | NULL | 3 | Using index | +------+-------------+------------+-------+---------------+----------+---------+------+------+-------------------------------------------------+","title":"2.6.7.1 \u601d\u8def\u4e00"},{"location":"mysql/25. SQL\u4f18\u5316/#2672","text":"\u628aLIMIT\u67e5\u8be2\u8f6c\u6362\u6210\u67d0\u4e2a\u4f4d\u7f6e\u7684\u67e5\u8be2\u3002 explain select * from scores order by score limit 410 , 10 ; select score from scores order by score desc limit 400 , 10 ; -- \u53d6\u51fa\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6 explain select * from scores where score < 4000 order by socre desc limit 10 ;","title":"2.6.7.2 \u601d\u8def\u4e8c"},{"location":"mysql/25. SQL\u4f18\u5316/#268-sql","text":"\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5728 SQL \u8bed\u53e5\u4e2d\u52a0\u5165\u4e00\u4e9b\u4eba\u4e3a\u7684\u63d0\u793a\uff08 hint \uff09\u6765\u8fbe\u5230\u4f18\u5316\u64cd\u4f5c\u7684\u76ee\u7684\u3002","title":"2.6.8 \u4f7f\u7528 SQL \u63d0\u793a"},{"location":"mysql/25. SQL\u4f18\u5316/#2681-use-index","text":"\u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u8868\u540d\u7684\u540e\u9762\uff0c \u6dfb\u52a0 USE INDEX \u6765\u63d0\u4f9b\u5e0c\u671b MySQL \u53bb\u53c2\u8003\u7684\u7d22\u5f15\u5217\u8868\uff0c \u5c31\u53ef\u4ee5\u8ba9 MySQL \u4e0d\u518d\u8003\u8651\u5176\u4ed6\u53ef\u7528\u7684\u7d22\u5f15\u3002 MariaDB [ MYISAM_TEST ] > EXPLAIN SELECT * FROM CHILD USE INDEX ( PRIMARY ) WHERE ID > 1 \\ G ;","title":"2.6.8.1 USE INDEX"},{"location":"mysql/25. SQL\u4f18\u5316/#2682-ignore-index","text":"\u5982\u679c\u7528\u6237\u53ea\u662f\u5355\u7eaf\u5730\u60f3\u8ba9 MySQL \u5ffd\u7565\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7d22\u5f15\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 IGNORE INDEX \u4f5c\u4e3a HINT\u3002","title":"2.6.8.2 IGNORE INDEX"},{"location":"mysql/25. SQL\u4f18\u5316/#2683-force-index","text":"\u4e3a\u5f3a\u5236 MySQL \u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u7684\u7d22\u5f15\uff0c\u53ef\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528 FORCE INDEX \u4f5c\u4e3a HINT\u3002","title":"2.6.8.3 FORCE INDEX"},{"location":"mysql/26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61/","text":"1. \u4f18\u5316\u8868\u7684\u6570\u636e\u7c7b\u578b 2. \u901a\u8fc7\u62c6\u5206\u63d0\u9ad8\u8868\u7684\u8bbf\u95ee\u6548\u7387 3. \u9006\u89c4\u8303\u5316 4. \u4f7f\u7528\u4e2d\u95f4\u8868\u63d0\u9ad8\u7edf\u8ba1\u67e5\u8be2\u901f\u5ea6 1. \u4f18\u5316\u8868\u7684\u6570\u636e\u7c7b\u578b \u00b6 \u4e0d\u63a8\u8350\u8ba9\u5f88\u591a\u5b57\u6bb5\u90fd\u7559\u6709\u5927\u91cf\u7684\u5197\u4f59\uff0c\u65e2\u6d6a\u8d39\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\uff0c\u53c8\u6d6a\u8d39\u5185\u5b58\u3002 MySQL\u6709\u81ea\u5e26\u7684\u5206\u6790\u51fd\u6570\u7ed9\u51fa\u4f18\u5316\u5efa\u8bae\uff1a SELECT * FROM tbl_name PROCEDURE ANALYSE (); SELECT * FROM tbl_name PROCEDURE ANALYSE ( 16 , 256 ); \u7b2c\u4e8c\u4e2a\u7684\u610f\u601d\u662f\u4e0d\u8981\u4e3a\u90a3\u4e9b\u5305\u542b\u7684\u503c\u591a\u4e8e 16 \u4e2a\u6216\u8005 256 \u5b57\u8282\u7684 ENUM \u7c7b\u578b\u63d0\u51fa\u5efa\u8bae\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u9650\u5236\uff0c\u8f93\u51fa\u4fe1\u606f\u53ef\u80fd\u5f88\u957f\uff1bENUM \u5b9a\u4e49\u901a\u5e38\u5f88\u96be\u9605\u8bfb\u3002 \u5982\u679c\u662f\u5bf9\u4e00\u4e2a\u5927\u8868\u8fdb\u884c\u5206\u6790\uff0c\u63d0\u51fa\u7684\u5efa\u8bae\u4f1a\u66f4\u51c6\u786e\u3002 2. \u901a\u8fc7\u62c6\u5206\u63d0\u9ad8\u8868\u7684\u8bbf\u95ee\u6548\u7387 \u00b6 \u6307\u5bf9\u6570\u636e\u8868\u8fdb\u884c\u62c6\u5206\u3002\u5982\u679c\u9488\u5bf9 MyISAM \u7c7b\u578b\u7684\u8868\u8fdb\u884c\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u62c6\u5206\u65b9\u6cd5\uff1a \u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\u5782\u76f4\u62c6\u5206\uff0c \u5373\u628a\u4e3b\u7801\u548c\u4e00\u4e9b\u5217\u653e\u5230\u4e00\u4e2a\u8868\uff0c \u7136\u540e\u628a\u4e3b\u7801\u548c\u53e6\u5916\u7684\u5217\u653e\u5230\u53e6\u4e00\u4e2a\u8868\u4e2d\u3002 \u5782\u76f4\u62c6\u5206\u53ef\u4ee5\u4f7f\u5f97\u6570\u636e\u884c\u53d8\u5c0f\uff0c\u4e00\u4e2a\u6570\u636e\u9875\u5c31\u80fd\u5b58\u653e\u66f4\u591a\u7684\u6570\u636e\uff0c\u5728\u67e5\u8be2\u65f6\u5c31\u4f1a\u51cf\u5c11 I/O \u6b21\u6570\u3002\u5176\u7f3a\u70b9\u662f\u9700\u8981\u7ba1\u7406\u5197\u4f59\u5217\uff0c\u67e5\u8be2\u6240\u6709\u6570\u636e\u9700\u8981\u8054\u5408\uff08JOIN\uff09\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\u6c34\u5e73\u62c6\u5206\uff0c \u5373\u6839\u636e\u4e00\u5217\u6216\u591a\u5217\u6570\u636e\u7684\u503c\u628a\u6570\u636e\u884c\u653e\u5230\u4e24\u4e2a\u72ec\u7acb\u7684\u8868\u4e2d\u3002 \u6c34\u5e73\u62c6\u5206\u901a\u5e38\u5728\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u4e0b\u4f7f\u7528\uff1a \u8868\u5f88\u5927\uff0c \u5206\u5272\u540e\u53ef\u4ee5\u964d\u4f4e\u5728\u67e5\u8be2\u65f6\u9700\u8981\u8bfb\u7684\u6570\u636e\u548c\u7d22\u5f15\u7684\u9875\u6570\uff0c \u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u7d22\u5f15\u7684\u5c42\u6570\uff0c\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\u3002 \u8868\u4e2d\u7684\u6570\u636e\u672c\u6765\u5c31\u6709\u72ec\u7acb\u6027 \u9700\u8981\u628a\u6570\u636e\u5b58\u653e\u5230\u591a\u4e2a\u4ecb\u8d28\u4e0a\u3002 \u6c34\u5e73\u62c6\u5206\u4f1a\u7ed9\u5e94\u7528\u589e\u52a0\u590d\u6742\u5ea6\uff0c \u5b83\u901a\u5e38\u5728\u67e5\u8be2\u65f6\u9700\u8981\u591a\u4e2a\u8868\u540d\uff0c \u67e5\u8be2\u6240\u6709\u6570\u636e\u9700 \u8981 UNION \u64cd\u4f5c\u3002\u5728\u8bb8\u591a\u6570\u636e\u5e93\u5e94\u7528\u4e2d\uff0c\u8fd9\u79cd\u590d\u6742\u6027\u4f1a\u8d85\u8fc7\u5b83\u5e26\u6765\u7684\u4f18\u70b9\u3002\u6c34\u5e73\u62c6\u5206\u8981\u8003\u8651\u6570\u636e\u91cf\u7684\u589e\u957f\u901f\u5ea6\uff0c \u6839\u636e\u5b9e\u9645\u60c5\u51b5\u51b3\u5b9a\u662f\u5426\u9700\u8981\u5bf9\u8868\u8fdb\u884c\u6c34\u5e73\u62c6\u5206\u3002 3. \u9006\u89c4\u8303\u5316 \u00b6 \u56e0\u4e3a\u89c4\u8303\u5316\u8d8a\u9ad8\uff0c\u90a3\u4e48\u4ea7\u751f\u7684\u5173\u7cfb\u5c31\u8d8a\u591a\uff0c\u5173\u7cfb\u8fc7\u591a\u7684\u76f4\u63a5\u7ed3\u679c\u5c31\u662f\u5bfc\u81f4\u8868\u4e4b\u95f4\u7684\u8fde\u63a5\u64cd\u4f5c\u8d8a\u9891\u7e41\uff0c \u800c\u8868\u4e4b\u95f4\u7684\u8fde\u63a5\u64cd\u4f5c\u662f\u6027\u80fd\u8f83\u4f4e\u7684\u64cd\u4f5c\uff0c \u76f4\u63a5\u5f71\u54cd\u5230\u67e5\u8be2\u7684\u901f\u5ea6\u3002 \u53cd\u89c4\u8303\u7684\u597d\u5904\u662f\u964d\u4f4e\u8fde\u63a5\u64cd\u4f5c\u7684\u9700\u6c42\u3001\u964d\u4f4e\u5916\u7801\u548c\u7d22\u5f15\u7684\u6570\u76ee\uff0c\u8fd8\u53ef\u80fd\u51cf\u5c11\u8868\u7684\u6570\u76ee\uff0c \u76f8\u5e94\u5e26\u6765\u7684\u95ee\u9898\u662f\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u7684\u5b8c\u6574\u6027\u95ee\u9898\u3002 \u52a0\u5feb\u67e5\u8be2\u901f\u5ea6\uff0c \u4f46\u4f1a\u964d\u4f4e\u4fee\u6539\u901f\u5ea6\u3002 \u597d\u7684\u7d22\u5f15\u548c\u5176\u4ed6\u65b9\u6cd5\u7ecf\u5e38\u80fd\u591f\u89e3\u51b3\u6027\u80fd\u95ee\u9898\uff0c \u800c\u4e0d\u5fc5\u91c7\u7528\u53cd\u89c4\u8303\u8fd9\u79cd\u65b9\u6cd5\u3002 \u5728\u8fdb\u884c\u53cd\u89c4\u8303\u64cd\u4f5c\u4e4b\u524d\uff0c \u8981\u5145\u5206\u8003\u8651\u6570\u636e\u7684\u5b58\u53d6\u9700\u6c42\u3001 \u5e38\u7528\u8868\u7684\u5927\u5c0f\u3001 \u4e00\u4e9b\u7279\u6b8a\u7684\u8ba1\u7b97\uff08\u4f8b\u5982\u5408\u8ba1\uff09 \u3001\u6570\u636e\u7684\u7269\u7406\u5b58\u50a8\u4f4d\u7f6e\u7b49\u3002 \u6280\u672f\u624b\u6bb5\uff1a \u589e\u52a0\u5197\u4f59\u5217\uff1a\u6307\u5728\u591a\u4e2a\u8868\u4e2d\u5177\u6709\u76f8\u540c\u7684\u5217\uff0c\u5b83\u5e38\u7528\u6765\u5728\u67e5\u8be2\u65f6\u907f\u514d\u8fde\u63a5\u64cd\u4f5c\u3002 \u589e\u52a0\u6d3e\u751f\u5217\uff1a\u6307\u589e\u52a0\u7684\u5217\u6765\u81ea\u5176\u4ed6\u8868\u4e2d\u7684\u6570\u636e\uff0c\u7531\u5176\u4ed6\u8868\u4e2d\u7684\u6570\u636e\u7ecf\u8fc7\u8ba1\u7b97\u751f\u6210\u3002 \u91cd\u65b0\u7ec4\u8868\uff1a\u6307\u5982\u679c\u8bb8\u591a\u7528\u6237\u9700\u8981\u67e5\u770b\u4e24\u4e2a\u8868\u8fde\u63a5\u51fa\u6765\u7684\u7ed3\u679c\u6570\u636e\uff0c\u5219\u628a\u8fd9\u4e24\u4e2a\u8868\u91cd\u65b0\u7ec4\u6210\u4e00\u4e2a\u8868\u6765\u51cf\u5c11\u8fde\u63a5\u800c\u63d0\u9ad8\u6027\u80fd\u3002 \u5206\u5272\u8868\uff1a\u53c2\u8003\u4e0a\u4e00\u7ae0\u8282 \u65e0\u8bba\u4f7f\u7528\u4f55\u79cd\u53cd\u89c4\u8303\u6280\u672f\uff0c \u90fd\u9700\u8981\u4e00\u5b9a\u7684\u7ba1\u7406\u6765\u7ef4\u62a4\u6570\u636e\u7684\u5b8c\u6574\u6027\uff1a \u6279\u5904\u7406\u7ef4\u62a4\u662f\u6307\u5bf9\u590d\u5236\u5217\u6216\u6d3e\u751f\u5217\u7684\u4fee\u6539\u79ef\u7d2f\u4e00\u5b9a\u7684\u65f6\u95f4\u540e\uff0c \u8fd0\u884c\u4e00\u6279\u5904\u7406\u4f5c\u4e1a\u6216\u5b58\u50a8\u8fc7\u7a0b\u5bf9\u590d\u5236\u6216\u6d3e\u751f\u5217\u8fdb\u884c\u4fee\u6539\uff0c \u8fd9\u53ea\u80fd\u5728\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002 \u6570\u636e\u7684\u5b8c\u6574\u6027\u4e5f\u53ef\u7531\u5e94\u7528\u903b\u8f91\u6765\u5b9e\u73b0\uff0c\u6570\u636e\u7684\u5b8c\u6574\u6027\u98ce\u9669\u8f83\u5927\u3002 \u4f7f\u7528\u89e6\u53d1\u5668\uff0c \u5bf9\u6570\u636e\u7684\u4efb\u4f55\u4fee\u6539\u7acb\u5373\u89e6\u53d1\u5bf9\u590d\u5236\u5217\u6216\u6d3e\u751f\u5217\u7684\u76f8\u5e94\u4fee\u6539\u3002 4. \u4f7f\u7528\u4e2d\u95f4\u8868\u63d0\u9ad8\u7edf\u8ba1\u67e5\u8be2\u901f\u5ea6 \u00b6 \u5bf9\u4e8e\u6570\u636e\u91cf\u8f83\u5927\u7684\u8868\uff0c\u5728\u5176\u4e0a\u8fdb\u884c\u7edf\u8ba1\u67e5\u8be2\u901a\u5e38\u4f1a\u6548\u7387\u5f88\u4f4e\uff0c\u4f7f\u7528\u4e2d\u95f4\u8868\u53ef\u4ee5\u6539\u5584\u8fd9\u79cd\u60c5\u51b5\u3002 \u8f6c\u79fb\u8981\u7edf\u8ba1\u7684\u6570\u636e\u5230\u4e2d\u95f4\u8868,\u7136\u540e\u5728\u4e2d\u95f4\u8868\u4e0a\u8fdb\u884c\u7edf\u8ba1\uff0c\u4f46\u662f\u590d\u5236\u6570\u636e\u5f88\u8017\u65f6\u3002\u4f8b\uff1a -- \u521b\u5efa\u4e34\u65f6\u8868\uff0c\u548c\u539f\u8868\u7ed3\u6784\u4e00\u81f4 CREATE TABLE tmp_session ... -- \u590d\u5236\u6570\u636e insert into tmp_session select * from session where cust_date > adddate ( now (), - 7 ); -- \u7edf\u8ba1\u6570\u636e select sum ( cust_amount ) from tmp_session ; \u4e2d\u95f4\u8868\u5728\u7edf\u8ba1\u67e5\u8be2\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\uff0c\u5176\u4f18\u70b9\u5982\u4e0b: \u4e2d\u95f4\u8868\u590d\u5236\u6e90\u8868\u90e8\u5206\u6570\u636e\uff0c\u5e76\u4e14\u4e0e\u6e90\u8868\u76f8\u201c\u9694\u79bb\u201d \uff0c\u5728\u4e2d\u95f4\u8868\u4e0a\u505a\u7edf\u8ba1\u67e5\u8be2\u4e0d\u4f1a\u5bf9\u5728\u7ebf\u5e94\u7528\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002 \u4e2d\u95f4\u8868\u4e0a\u53ef\u4ee5\u7075\u6d3b\u7684\u6dfb\u52a0\u7d22\u5f15\u6216\u589e\u52a0\u4e34\u65f6\u7528\u7684\u65b0\u5b57\u6bb5,\u4ece\u800c\u8fbe\u5230\u63d0\u9ad8\u7edf\u8ba1\u67e5\u8be2\u6548\u7387\u548c\u8f85\u52a9\u7edf\u8ba1\u67e5\u8be2\u4f5c\u7528\u3002","title":"26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61"},{"location":"mysql/26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61/#1","text":"\u4e0d\u63a8\u8350\u8ba9\u5f88\u591a\u5b57\u6bb5\u90fd\u7559\u6709\u5927\u91cf\u7684\u5197\u4f59\uff0c\u65e2\u6d6a\u8d39\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\uff0c\u53c8\u6d6a\u8d39\u5185\u5b58\u3002 MySQL\u6709\u81ea\u5e26\u7684\u5206\u6790\u51fd\u6570\u7ed9\u51fa\u4f18\u5316\u5efa\u8bae\uff1a SELECT * FROM tbl_name PROCEDURE ANALYSE (); SELECT * FROM tbl_name PROCEDURE ANALYSE ( 16 , 256 ); \u7b2c\u4e8c\u4e2a\u7684\u610f\u601d\u662f\u4e0d\u8981\u4e3a\u90a3\u4e9b\u5305\u542b\u7684\u503c\u591a\u4e8e 16 \u4e2a\u6216\u8005 256 \u5b57\u8282\u7684 ENUM \u7c7b\u578b\u63d0\u51fa\u5efa\u8bae\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u9650\u5236\uff0c\u8f93\u51fa\u4fe1\u606f\u53ef\u80fd\u5f88\u957f\uff1bENUM \u5b9a\u4e49\u901a\u5e38\u5f88\u96be\u9605\u8bfb\u3002 \u5982\u679c\u662f\u5bf9\u4e00\u4e2a\u5927\u8868\u8fdb\u884c\u5206\u6790\uff0c\u63d0\u51fa\u7684\u5efa\u8bae\u4f1a\u66f4\u51c6\u786e\u3002","title":"1. \u4f18\u5316\u8868\u7684\u6570\u636e\u7c7b\u578b"},{"location":"mysql/26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61/#2","text":"\u6307\u5bf9\u6570\u636e\u8868\u8fdb\u884c\u62c6\u5206\u3002\u5982\u679c\u9488\u5bf9 MyISAM \u7c7b\u578b\u7684\u8868\u8fdb\u884c\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u62c6\u5206\u65b9\u6cd5\uff1a \u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\u5782\u76f4\u62c6\u5206\uff0c \u5373\u628a\u4e3b\u7801\u548c\u4e00\u4e9b\u5217\u653e\u5230\u4e00\u4e2a\u8868\uff0c \u7136\u540e\u628a\u4e3b\u7801\u548c\u53e6\u5916\u7684\u5217\u653e\u5230\u53e6\u4e00\u4e2a\u8868\u4e2d\u3002 \u5782\u76f4\u62c6\u5206\u53ef\u4ee5\u4f7f\u5f97\u6570\u636e\u884c\u53d8\u5c0f\uff0c\u4e00\u4e2a\u6570\u636e\u9875\u5c31\u80fd\u5b58\u653e\u66f4\u591a\u7684\u6570\u636e\uff0c\u5728\u67e5\u8be2\u65f6\u5c31\u4f1a\u51cf\u5c11 I/O \u6b21\u6570\u3002\u5176\u7f3a\u70b9\u662f\u9700\u8981\u7ba1\u7406\u5197\u4f59\u5217\uff0c\u67e5\u8be2\u6240\u6709\u6570\u636e\u9700\u8981\u8054\u5408\uff08JOIN\uff09\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\u6c34\u5e73\u62c6\u5206\uff0c \u5373\u6839\u636e\u4e00\u5217\u6216\u591a\u5217\u6570\u636e\u7684\u503c\u628a\u6570\u636e\u884c\u653e\u5230\u4e24\u4e2a\u72ec\u7acb\u7684\u8868\u4e2d\u3002 \u6c34\u5e73\u62c6\u5206\u901a\u5e38\u5728\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u4e0b\u4f7f\u7528\uff1a \u8868\u5f88\u5927\uff0c \u5206\u5272\u540e\u53ef\u4ee5\u964d\u4f4e\u5728\u67e5\u8be2\u65f6\u9700\u8981\u8bfb\u7684\u6570\u636e\u548c\u7d22\u5f15\u7684\u9875\u6570\uff0c \u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u7d22\u5f15\u7684\u5c42\u6570\uff0c\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\u3002 \u8868\u4e2d\u7684\u6570\u636e\u672c\u6765\u5c31\u6709\u72ec\u7acb\u6027 \u9700\u8981\u628a\u6570\u636e\u5b58\u653e\u5230\u591a\u4e2a\u4ecb\u8d28\u4e0a\u3002 \u6c34\u5e73\u62c6\u5206\u4f1a\u7ed9\u5e94\u7528\u589e\u52a0\u590d\u6742\u5ea6\uff0c \u5b83\u901a\u5e38\u5728\u67e5\u8be2\u65f6\u9700\u8981\u591a\u4e2a\u8868\u540d\uff0c \u67e5\u8be2\u6240\u6709\u6570\u636e\u9700 \u8981 UNION \u64cd\u4f5c\u3002\u5728\u8bb8\u591a\u6570\u636e\u5e93\u5e94\u7528\u4e2d\uff0c\u8fd9\u79cd\u590d\u6742\u6027\u4f1a\u8d85\u8fc7\u5b83\u5e26\u6765\u7684\u4f18\u70b9\u3002\u6c34\u5e73\u62c6\u5206\u8981\u8003\u8651\u6570\u636e\u91cf\u7684\u589e\u957f\u901f\u5ea6\uff0c \u6839\u636e\u5b9e\u9645\u60c5\u51b5\u51b3\u5b9a\u662f\u5426\u9700\u8981\u5bf9\u8868\u8fdb\u884c\u6c34\u5e73\u62c6\u5206\u3002","title":"2. \u901a\u8fc7\u62c6\u5206\u63d0\u9ad8\u8868\u7684\u8bbf\u95ee\u6548\u7387"},{"location":"mysql/26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61/#3","text":"\u56e0\u4e3a\u89c4\u8303\u5316\u8d8a\u9ad8\uff0c\u90a3\u4e48\u4ea7\u751f\u7684\u5173\u7cfb\u5c31\u8d8a\u591a\uff0c\u5173\u7cfb\u8fc7\u591a\u7684\u76f4\u63a5\u7ed3\u679c\u5c31\u662f\u5bfc\u81f4\u8868\u4e4b\u95f4\u7684\u8fde\u63a5\u64cd\u4f5c\u8d8a\u9891\u7e41\uff0c \u800c\u8868\u4e4b\u95f4\u7684\u8fde\u63a5\u64cd\u4f5c\u662f\u6027\u80fd\u8f83\u4f4e\u7684\u64cd\u4f5c\uff0c \u76f4\u63a5\u5f71\u54cd\u5230\u67e5\u8be2\u7684\u901f\u5ea6\u3002 \u53cd\u89c4\u8303\u7684\u597d\u5904\u662f\u964d\u4f4e\u8fde\u63a5\u64cd\u4f5c\u7684\u9700\u6c42\u3001\u964d\u4f4e\u5916\u7801\u548c\u7d22\u5f15\u7684\u6570\u76ee\uff0c\u8fd8\u53ef\u80fd\u51cf\u5c11\u8868\u7684\u6570\u76ee\uff0c \u76f8\u5e94\u5e26\u6765\u7684\u95ee\u9898\u662f\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u7684\u5b8c\u6574\u6027\u95ee\u9898\u3002 \u52a0\u5feb\u67e5\u8be2\u901f\u5ea6\uff0c \u4f46\u4f1a\u964d\u4f4e\u4fee\u6539\u901f\u5ea6\u3002 \u597d\u7684\u7d22\u5f15\u548c\u5176\u4ed6\u65b9\u6cd5\u7ecf\u5e38\u80fd\u591f\u89e3\u51b3\u6027\u80fd\u95ee\u9898\uff0c \u800c\u4e0d\u5fc5\u91c7\u7528\u53cd\u89c4\u8303\u8fd9\u79cd\u65b9\u6cd5\u3002 \u5728\u8fdb\u884c\u53cd\u89c4\u8303\u64cd\u4f5c\u4e4b\u524d\uff0c \u8981\u5145\u5206\u8003\u8651\u6570\u636e\u7684\u5b58\u53d6\u9700\u6c42\u3001 \u5e38\u7528\u8868\u7684\u5927\u5c0f\u3001 \u4e00\u4e9b\u7279\u6b8a\u7684\u8ba1\u7b97\uff08\u4f8b\u5982\u5408\u8ba1\uff09 \u3001\u6570\u636e\u7684\u7269\u7406\u5b58\u50a8\u4f4d\u7f6e\u7b49\u3002 \u6280\u672f\u624b\u6bb5\uff1a \u589e\u52a0\u5197\u4f59\u5217\uff1a\u6307\u5728\u591a\u4e2a\u8868\u4e2d\u5177\u6709\u76f8\u540c\u7684\u5217\uff0c\u5b83\u5e38\u7528\u6765\u5728\u67e5\u8be2\u65f6\u907f\u514d\u8fde\u63a5\u64cd\u4f5c\u3002 \u589e\u52a0\u6d3e\u751f\u5217\uff1a\u6307\u589e\u52a0\u7684\u5217\u6765\u81ea\u5176\u4ed6\u8868\u4e2d\u7684\u6570\u636e\uff0c\u7531\u5176\u4ed6\u8868\u4e2d\u7684\u6570\u636e\u7ecf\u8fc7\u8ba1\u7b97\u751f\u6210\u3002 \u91cd\u65b0\u7ec4\u8868\uff1a\u6307\u5982\u679c\u8bb8\u591a\u7528\u6237\u9700\u8981\u67e5\u770b\u4e24\u4e2a\u8868\u8fde\u63a5\u51fa\u6765\u7684\u7ed3\u679c\u6570\u636e\uff0c\u5219\u628a\u8fd9\u4e24\u4e2a\u8868\u91cd\u65b0\u7ec4\u6210\u4e00\u4e2a\u8868\u6765\u51cf\u5c11\u8fde\u63a5\u800c\u63d0\u9ad8\u6027\u80fd\u3002 \u5206\u5272\u8868\uff1a\u53c2\u8003\u4e0a\u4e00\u7ae0\u8282 \u65e0\u8bba\u4f7f\u7528\u4f55\u79cd\u53cd\u89c4\u8303\u6280\u672f\uff0c \u90fd\u9700\u8981\u4e00\u5b9a\u7684\u7ba1\u7406\u6765\u7ef4\u62a4\u6570\u636e\u7684\u5b8c\u6574\u6027\uff1a \u6279\u5904\u7406\u7ef4\u62a4\u662f\u6307\u5bf9\u590d\u5236\u5217\u6216\u6d3e\u751f\u5217\u7684\u4fee\u6539\u79ef\u7d2f\u4e00\u5b9a\u7684\u65f6\u95f4\u540e\uff0c \u8fd0\u884c\u4e00\u6279\u5904\u7406\u4f5c\u4e1a\u6216\u5b58\u50a8\u8fc7\u7a0b\u5bf9\u590d\u5236\u6216\u6d3e\u751f\u5217\u8fdb\u884c\u4fee\u6539\uff0c \u8fd9\u53ea\u80fd\u5728\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002 \u6570\u636e\u7684\u5b8c\u6574\u6027\u4e5f\u53ef\u7531\u5e94\u7528\u903b\u8f91\u6765\u5b9e\u73b0\uff0c\u6570\u636e\u7684\u5b8c\u6574\u6027\u98ce\u9669\u8f83\u5927\u3002 \u4f7f\u7528\u89e6\u53d1\u5668\uff0c \u5bf9\u6570\u636e\u7684\u4efb\u4f55\u4fee\u6539\u7acb\u5373\u89e6\u53d1\u5bf9\u590d\u5236\u5217\u6216\u6d3e\u751f\u5217\u7684\u76f8\u5e94\u4fee\u6539\u3002","title":"3. \u9006\u89c4\u8303\u5316"},{"location":"mysql/26. \u4f18\u5316\u6570\u636e\u5e93\u5bf9\u8c61/#4","text":"\u5bf9\u4e8e\u6570\u636e\u91cf\u8f83\u5927\u7684\u8868\uff0c\u5728\u5176\u4e0a\u8fdb\u884c\u7edf\u8ba1\u67e5\u8be2\u901a\u5e38\u4f1a\u6548\u7387\u5f88\u4f4e\uff0c\u4f7f\u7528\u4e2d\u95f4\u8868\u53ef\u4ee5\u6539\u5584\u8fd9\u79cd\u60c5\u51b5\u3002 \u8f6c\u79fb\u8981\u7edf\u8ba1\u7684\u6570\u636e\u5230\u4e2d\u95f4\u8868,\u7136\u540e\u5728\u4e2d\u95f4\u8868\u4e0a\u8fdb\u884c\u7edf\u8ba1\uff0c\u4f46\u662f\u590d\u5236\u6570\u636e\u5f88\u8017\u65f6\u3002\u4f8b\uff1a -- \u521b\u5efa\u4e34\u65f6\u8868\uff0c\u548c\u539f\u8868\u7ed3\u6784\u4e00\u81f4 CREATE TABLE tmp_session ... -- \u590d\u5236\u6570\u636e insert into tmp_session select * from session where cust_date > adddate ( now (), - 7 ); -- \u7edf\u8ba1\u6570\u636e select sum ( cust_amount ) from tmp_session ; \u4e2d\u95f4\u8868\u5728\u7edf\u8ba1\u67e5\u8be2\u4e2d\u7ecf\u5e38\u4f1a\u7528\u5230\uff0c\u5176\u4f18\u70b9\u5982\u4e0b: \u4e2d\u95f4\u8868\u590d\u5236\u6e90\u8868\u90e8\u5206\u6570\u636e\uff0c\u5e76\u4e14\u4e0e\u6e90\u8868\u76f8\u201c\u9694\u79bb\u201d \uff0c\u5728\u4e2d\u95f4\u8868\u4e0a\u505a\u7edf\u8ba1\u67e5\u8be2\u4e0d\u4f1a\u5bf9\u5728\u7ebf\u5e94\u7528\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002 \u4e2d\u95f4\u8868\u4e0a\u53ef\u4ee5\u7075\u6d3b\u7684\u6dfb\u52a0\u7d22\u5f15\u6216\u589e\u52a0\u4e34\u65f6\u7528\u7684\u65b0\u5b57\u6bb5,\u4ece\u800c\u8fbe\u5230\u63d0\u9ad8\u7edf\u8ba1\u67e5\u8be2\u6548\u7387\u548c\u8f85\u52a9\u7edf\u8ba1\u67e5\u8be2\u4f5c\u7528\u3002","title":"4. \u4f7f\u7528\u4e2d\u95f4\u8868\u63d0\u9ad8\u7edf\u8ba1\u67e5\u8be2\u901f\u5ea6"},{"location":"mysql/27. \u9501/","text":"1. MySQL \u9501\u6982\u8ff0 2. MyISAM \u8868\u9501 2.1 \u67e5\u8be2\u8868\u7ea7\u9501\u4e89\u7528\u60c5\u51b5 2.2 MySQL \u8868\u7ea7\u9501\u7684\u9501\u6a21\u5f0f 2.3 \u5982\u4f55\u52a0\u8868\u9501 2.4 \u5e76\u53d1\u63d2\u5165\uff08Concurrent Inserts\uff09 2.5 MyISAM \u7684\u9501\u8c03\u5ea6 3. InnoDB \u9501 3.1 \u4e8b\u52a1 3.2 \u83b7\u53d6 InnoDB \u884c\u9501\u4e89\u7528\u60c5\u51b5 3.3 \u9501\u7684\u7c7b\u578b 3.3.1 \u884c\u9501\uff1a\u5171\u4eab\u9501\u4e0e\u6392\u5b83\u9501 3.3.2 \u8868\u7ea7\u9501\uff1a\u610f\u5411\u9501 3.3.3 \u8bb0\u5f55\u9501 Record Lock 3.3.4 \u95f4\u9699\u9501 Gap Lock 3.3.5 Next-Key Lock 3.4 \u4f55\u65f6\u52a0\u9501 3.5 InnoDB \u884c\u9501\u5b9e\u73b0\u65b9\u5f0f 3.6 \u6062\u590d\u548c\u590d\u5236\u7684\u9700\u8981\uff0c\u5bf9 InnoDB \u9501\u673a\u5236\u7684\u5f71\u54cd 3.7 \u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u4e00\u81f4\u6027\u8bfb\u53ca\u9501\u7684\u5dee\u5f02 3.8 \u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u8868\u9501 3.9 \u6b7b\u9501 4. \u5c0f\u7ed3 1. MySQL \u9501\u6982\u8ff0 \u00b6 \u76f8\u5bf9\u5176\u4ed6\u6570\u636e\u5e93\u800c\u8a00\uff0c MySQL\u7684\u9501\u673a\u5236\u6bd4\u8f83\u7b80\u5355\uff0c \u5176\u6700\u663e\u8457\u7684\u7279\u70b9\u662f\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u4e0d \u540c\u7684\u9501\u673a\u5236\u3002 \u4e09\u79cd\u9501\u7279\u6027\uff1a \u8868\u7ea7\u9501\uff1a\u5f00\u9500\u5c0f\uff0c\u52a0\u9501\u5feb\uff1b\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u5927\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u9ad8,\u5e76\u53d1\u5ea6\u6700\u4f4e\u3002 \u884c\u7ea7\u9501\uff1a\u5f00\u9500\u5927\uff0c\u52a0\u9501\u6162\uff1b\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u6700\u5c0f\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u4f4e,\u5e76\u53d1\u5ea6\u4e5f\u6700\u9ad8\u3002 \u9875\u9762\u9501\uff1a \u5f00\u9500\u548c\u52a0\u9501\u65f6\u95f4\u754c\u4e8e\u8868\u9501\u548c\u884c\u9501\u4e4b\u95f4\uff1b \u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b \u9501\u5b9a\u7c92\u5ea6\u754c\u4e8e\u8868\u9501\u548c\u884c\u9501 \u4e4b\u95f4\uff0c\u5e76\u53d1\u5ea6\u4e00\u822c\u3002 \u4ec5\u4ece\u9501\u7684\u89d2\u5ea6\u6765\u8bf4\uff1a \u8868\u7ea7\u9501\u66f4\u9002\u5408\u4e8e\u4ee5\u67e5\u8be2\u4e3a\u4e3b\uff0c \u53ea\u6709\u5c11\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u66f4\u65b0\u6570\u636e\u7684\u5e94\u7528\uff0c \u5982 Web \u5e94\u7528\uff1b\u800c\u884c\u7ea7\u9501\u5219\u66f4\u9002\u5408\u4e8e\u6709\u5927\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u5e76\u53d1\u66f4\u65b0\u5c11\u91cf\u4e0d\u540c\u6570\u636e\uff0c\u540c\u65f6\u53c8\u6709\u5e76\u53d1\u67e5\u8be2\u7684\u5e94\u7528\uff0c\u5982\u4e00\u4e9b\u5728\u7ebf\u4e8b\u52a1\u5904\u7406\uff08OLTP\uff09\u7cfb\u7edf\u3002 2. MyISAM \u8868\u9501 \u00b6 MyISAM \u5b58\u50a8\u5f15\u64ce\u53ea\u652f\u6301\u8868\u9501\u3002 2.1 \u67e5\u8be2\u8868\u7ea7\u9501\u4e89\u7528\u60c5\u51b5 \u00b6 \u901a\u8fc7\u68c0\u67e5 table_locks_waited \u548c table_locks_immediate \u72b6\u6001\u53d8\u91cf\u6765\u5206\u6790\u7cfb\u7edf\u4e0a\u7684\u8868\u9501\u5b9a\u4e89\u593a\uff1a MariaDB [ MYISAM_TEST ] > SHOW STATUS LIKE \"TABLE%\" ; +-----------------------+-------+ | Variable_name | Value | +-----------------------+-------+ | Table_locks_immediate | 84 | | Table_locks_waited | 0 | +-----------------------+-------+ Table_locks_waites \u8d8a\u5927\uff0c\u4e89\u593a\u60c5\u51b5\u8d8a\u4e25\u91cd\u3002 2.2 MySQL \u8868\u7ea7\u9501\u7684\u9501\u6a21\u5f0f \u00b6 MySQL \u7684\u8868\u7ea7\u9501\u6709\u4e24\u79cd\u6a21\u5f0f\uff1a \u8868\u5171\u4eab\u8bfb\u9501 \uff08Table Read Lock\uff09 \u548c\u8868\u72ec\u5360\u5199\u9501 \uff08Table Write Lock\uff09\u3002 \u53ef\u89c1\uff0c \u5bf9 MyISAM \u8868\u7684\u8bfb\u64cd\u4f5c\uff0c \u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u8bf7\u6c42\uff0c \u4f46\u4f1a\u963b\u585e\u5bf9\u540c\u4e00\u8868\u7684 \u5199\u8bf7\u6c42\uff1b\u5bf9 MyISAM \u8868\u7684\u5199\u64cd\u4f5c\uff0c\u5219\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u548c\u5199\u64cd\u4f5c\uff1bMyISAM \u8868\u7684\u8bfb\u64cd\u4f5c\u4e0e\u5199\u64cd\u4f5c\u4e4b\u95f4\uff0c\u4ee5\u53ca\u5199\u64cd\u4f5c\u4e4b\u95f4\u662f \u4e32\u884c\u7684 \uff01 2.3 \u5982\u4f55\u52a0\u8868\u9501 \u00b6 MyISAM \u5728\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff08SELECT\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u6240\u6709\u8868\u52a0\u8bfb\u9501\uff0c\u5728\u6267\u884c\u66f4\u65b0\u64cd\u4f5c \uff08UPDATE\u3001DELETE\u3001INSERT \u7b49\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u8868\u52a0\u5199\u9501\u3002 \u7ed9 MyISAM \u8868\u663e\u793a\u52a0\u9501\uff0c \u4e00\u822c\u662f\u4e3a\u4e86\u5728\u4e00\u5b9a\u7a0b\u5ea6\u6a21\u62df\u4e8b\u52a1\u64cd\u4f5c\uff0c \u5b9e\u73b0\u5bf9\u67d0\u4e00\u65f6\u95f4\u70b9\u591a\u4e2a\u8868\u7684 \u4e00\u81f4\u6027\u8bfb\u53d6\u3002\u4f8b\uff1a Lock tables orders read local , order_detail read local ; Select sum ( total ) from orders ; Select sum ( subtotal ) from order_detail ; Unlock tables ; Important \u5728\u7528 LOCK TABLES \u7ed9\u8868\u663e\u5f0f\u52a0\u8868\u9501\u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u53d6\u5f97\u6240\u6709\u6d89\u53ca\u5230\u8868\u7684\u9501\uff0c\u5e76\u4e14 MySQL \u4e0d \u652f\u6301\u9501\u5347\u7ea7\u3002\u5728\u6267\u884c LOCK TABLES \u540e\uff0c\u53ea\u80fd\u8bbf\u95ee\u663e\u5f0f\u52a0\u9501\u7684\u8fd9\u4e9b\u8868\uff0c\u4e0d\u80fd\u8bbf\u95ee\u672a\u52a0\u9501\u7684\u8868\uff1b\u540c\u65f6\uff0c\u5982\u679c\u52a0\u7684\u662f\u8bfb\u9501\uff0c\u90a3\u4e48\u53ea\u80fd\u6267\u884c\u67e5\u8be2\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 MyISAM \u603b\u662f\u4e00\u6b21\u83b7\u5f97 SQL \u8bed\u53e5\u6240\u9700\u8981\u7684\u5168\u90e8\u9501\uff0c\u8fd9\u4e5f\u6b63\u662f\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\u7684\u539f\u56e0\u3002 Warning \u5f53\u4f7f\u7528 LOCK TABLES \u65f6\uff0c\u4e0d\u4ec5\u9700\u8981\u4e00\u6b21\u9501\u5b9a\u7528\u5230\u7684\u6240\u6709\u8868\uff0c\u800c\u4e14\uff0c\u540c\u4e00\u4e2a\u8868\u5728 SQL \u8bed\u53e5 \u4e2d\u51fa\u73b0\u591a\u5c11\u6b21\uff0c\u5c31\u8981\u901a\u8fc7\u4e0e SQL \u8bed\u53e5\u4e2d\u76f8\u540c\u7684\u522b\u540d\u9501\u5b9a\u591a\u5c11\u6b21\uff0c\u5426\u5219\u4e5f\u4f1a\u51fa\u9519\uff01 \u6b63\u786e\u5199\u6cd5\uff1a mysql> lock table actor as a read,actor as b read; 2.4 \u5e76\u53d1\u63d2\u5165\uff08Concurrent Inserts\uff09 \u00b6 \u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0cMyISAM \u8868\u4e5f\u652f\u6301\u67e5\u8be2\u548c\u63d2\u5165\u64cd\u4f5c\u7684\u5e76\u53d1\u8fdb\u884c\uff08 \u5220\u9664\u548c\u66f4\u65b0\u64cd\u4f5c\u4f1a\u963b\u585e\uff01 \uff09\u3002 \u63a7\u5236\u8be5\u6743\u9650\u7684\u7cfb\u7edf\u53d8\u91cf\u662f concurrent_insert \uff1a \u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u4e0d\u5141\u8bb8\u5e76\u53d1\u63d2\u5165\u3002 \u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5982\u679cMyISAM\u8868\u4e2d\u6ca1\u6709\u7a7a\u6d1e\uff08\u5373\u8868\u7684\u4e2d\u95f4\u6ca1\u6709\u88ab\u5220\u9664\u7684\u884c\uff09\uff0c MyISAM\u5141\u8bb8\u5728\u4e00\u4e2a\u8fdb\u7a0b\u8bfb\u8868\u7684\u540c\u65f6\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u8868\u5c3e\u63d2\u5165\u8bb0\u5f55\u3002\u8fd9\u4e5f\u662f MySQL \u7684 \u9ed8\u8ba4\u8bbe\u7f6e \u3002 \u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u65e0\u8bbaMyISAM\u8868\u4e2d\u6709\u6ca1\u6709\u7a7a\u6d1e\uff0c\u90fd\u5141\u8bb8\u5728\u8868\u5c3e\u5e76\u53d1\u63d2\u5165\u8bb0\u5f55\u3002 2.5 MyISAM \u7684\u9501\u8c03\u5ea6 \u00b6 \u5373\u4f7f\u8bfb\u8bf7\u6c42\u5148\u5230\u9501\u7b49\u5f85\u961f\u5217\uff0c \u5199\u8bf7\u6c42\u540e\u5230\uff0c \u5199\u9501\u4e5f\u4f1a\u63d2\u5230\u8bfb\u9501\u8bf7\u6c42\u4e4b\u524d\uff01\u8fd9\u662f\u56e0\u4e3a MySQL \u8ba4\u4e3a \u5199\u8bf7\u6c42\u4e00\u822c\u6bd4\u8bfb\u8bf7\u6c42\u4f18\u5148\u7ea7\u66f4\u9ad8 \u3002 \u8fd9\u4e5f\u6b63\u662f MyISAM \u8868\u4e0d\u592a\u9002\u5408\u4e8e\u6709\u5927\u91cf\u66f4\u65b0\u64cd\u4f5c\u548c\u67e5\u8be2\u64cd\u4f5c\u5e94\u7528\u7684\u539f\u56e0\uff0c \u56e0\u4e3a\u5927\u91cf\u7684\u66f4\u65b0\u64cd\u4f5c\u4f1a\u9020\u6210\u67e5\u8be2\u64cd\u4f5c\u5f88\u96be\u83b7\u5f97\u8bfb\u9501\uff0c \u4ece\u800c\u53ef\u80fd\u6c38\u8fdc\u963b\u585e\u3002 \u5982\u4f55\u8c03\u8282 \uff1a \u901a\u8fc7\u6307\u5b9a\u542f\u52a8\u53c2\u6570 low-priority-updates\uff0c\u4f7fMyISAM\u5f15\u64ce\u9ed8\u8ba4\u7ed9\u4e88\u8bfb\u8bf7\u6c42\u4ee5\u4f18\u5148\u7684\u6743\u5229\u3002 \u901a\u8fc7\u6267\u884c\u547d\u4ee4SET LOW_PRIORITY_UPDATES=1\uff0c\u4f7f\u8be5\u8fde\u63a5\u53d1\u51fa\u7684\u66f4\u65b0\u8bf7\u6c42\u4f18\u5148\u7ea7\u964d\u4f4e\u3002 \u901a\u8fc7\u6307\u5b9aINSERT\u3001UPDATE\u3001DELETE\u8bed\u53e5\u7684LOW_PRIORITY\u5c5e\u6027\uff0c\u964d\u4f4e\u8be5\u8bed\u53e5\u7684\u4f18\u5148\u7ea7\u3002 \u7ed9\u7cfb\u7edf\u53c2\u6570 max_write_lock_count \u8bbe\u7f6e\u4e00\u4e2a\u5408\u9002\u7684\u503c\uff0c\u5f53\u4e00\u4e2a\u8868\u7684\u8bfb\u9501\u8fbe\u5230\u8fd9\u4e2a\u503c\u540e\uff0cMySQL\u5c31\u6682\u65f6\u5c06\u5199\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\u964d\u4f4e\uff0c\u7ed9\u8bfb\u8fdb\u7a0b\u4e00\u5b9a\u83b7\u5f97\u9501\u7684\u673a\u4f1a\u3002 \u5e94\u7528\u4e2d\u5e94 \u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u67e5\u8be2\u64cd\u4f5c \uff0c\u4e0d\u8981\u603b\u60f3\u7528\u4e00\u6761SELECT\u8bed\u53e5\u6765\u89e3\u51b3\u95ee\u9898\u3002 3. InnoDB \u9501 \u00b6 3.1 \u4e8b\u52a1 \u00b6 \u53c2\u8003 6. \u4e8b\u52a1 3.2 \u83b7\u53d6 InnoDB \u884c\u9501\u4e89\u7528\u60c5\u51b5 \u00b6 \u68c0\u67e5\u72b6\u6001\u53d8\u91cf InnoDB_row_lock \uff1a MariaDB [ blog ] > SHOW STATUS LIKE 'INNODB_ROW_LOCK%' ; +-------------------------------+-------+ | Variable_name | Value | +-------------------------------+-------+ | Innodb_row_lock_current_waits | 0 | | Innodb_row_lock_time | 0 | | Innodb_row_lock_time_avg | 0 | | Innodb_row_lock_time_max | 0 | | Innodb_row_lock_waits | 0 | +-------------------------------+-------+ \u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e InnoDB Monitors \u6765\u8fdb\u4e00\u6b65\u89c2\u5bdf\u53d1\u751f\u9501\u51b2\u7a81\u7684\u8868\u3001\u6570\u636e\u884c\u7b49\uff0c\u5e76\u5206\u6790\u9501\u4e89\u7528\u7684\u539f\u56e0\u3002 \u66f4\u591a\u76d1\u89c6\u5668\uff08\u6807\u51c6\u76d1\u89c6\u5668\u3001\u9501\u76d1\u89c6\u5668\u3001\u8868\u7a7a\u95f4\u76d1\u89c6\u5668\u3001\u8868\u76d1\u89c6\u5668\uff09 -- \u901a\u8fc7\u5efa\u8868\u8bed\u53e5\u5f00\u542f\u76d1\u89c6\u5668 CREATE TABLE innodb_monitor ( a INT ) ENGINE = INNODB ; -- \u7528\u4e0b\u9762\u7684\u8bed\u53e5\u6765\u8fdb\u884c\u67e5\u770b SHOW ENGINE INNODB STATUS \\ G ; -- \u901a\u8fc7\u5220\u8868\u8bed\u53e5\u505c\u6b62\u76d1\u89c6\u5668 DROP TABLE innodb_monitor ; \u5982\u679c\u5f00\u542f\u4e86\u9501\u76d1\u89c6\u5668 InnoDB Lock Monitor \uff0c\u8f93\u51fa\u4e5f\u4f1a\u5305\u62ec\u5b83\u3002 \u5982\u679c\u5f00\u542f\u4e86\u76d1\u89c6\u5668\uff0c\u6bcf\u8fc715s\uff0c\u4f1a\u5411mysqld\u670d\u52a1\u7684\u6807\u51c6\u9519\u8bef\u8f93\u51fa stderr \u3002\u5177\u4f53\u8f93\u51fa\u5230\u54ea\u91cc\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\uff1a Windows\uff1astderr\u91cd\u5b9a\u5411\u5230\u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6 Unix&Unix-like\uff1astderr\u901a\u5e38\u88ab\u5b9a\u5411\u5230\u7ec8\u7aef \u4e24\u8005\u90fd\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6539\u53d8\u3002 3.3 \u9501\u7684\u7c7b\u578b \u00b6 3.3.1 \u884c\u9501\uff1a\u5171\u4eab\u9501\u4e0e\u6392\u5b83\u9501 \u00b6 shared ( S ) lock \uff1a\u5141\u8bb8\u6301\u6709\u9501\u7684\u4e8b\u52a1\u8bfb\u53d6\u4e00\u884c\u3002\u5141\u8bb8\u5176\u4ed6\u4e8b\u52a1\u8bfb\u53d6\u9501\u5b9a\u5bf9\u8c61\u548c\u83b7\u53d6\u5171\u4eab\u9501\uff0c\u4f46\u662f\u4e0d\u80fd\u5199\u5165\u3002 exclusive ( X ) lock \uff1a\u5141\u8bb8\u6301\u6709\u9501\u7684\u4e8b\u52a1\u66f4\u65b0\u6216\u5220\u9664\u884c\u3002\u963b\u6b62\u4efb\u4f55\u5176\u4ed6\u7684\u4e8b\u52a1\u9501\u5b9a\u540c\u4e00\u884c\u3002 \u5982\u679c\u4e8b\u52a1 T1 \u83b7\u53d6\u4e86 r \u884c\u7684\u5171\u4eab\u9501\uff0c\u4ece\u72ec\u7acb\u7684\u4e8b\u52a1 T2 \u83b7\u53d6 r \u884c\u7684\u9501\u8bf7\u6c42\u7684\u5904\u7406\u65b9\u5f0f\u5982\u4e0b\uff1a T2 \u53d1\u51fa\u7684\u5171\u4eab\u9501\u8bf7\u6c42\u53ef\u4ee5\u7acb\u5373\u88ab\u6ee1\u8db3\u3002 T1 \u4e0e T2 \u90fd\u6301\u6709 r \u884c\u7684\u5171\u4eab\u9501\u3002 T2 \u53d1\u51fa\u7684\u6392\u5b83\u9501\u8bf7\u6c42\u4e0d\u80fd\u7acb\u5373\u6ee1\u8db3\u3002 \u5982\u679c\u4e8b\u52a1 T1 \u83b7\u53d6\u4e86 r \u884c\u7684\u6392\u5b83\u9501\uff0c\u4ece\u72ec\u7acb\u7684\u4e8b\u52a1 T2 \u83b7\u53d6 r \u884c\u7684\u9501\u8bf7\u6c42\u4e0d\u80fd\u88ab\u6ee1\u8db3\u3002\u53ea\u80fd\u7b49\u5f85 T1 \u91ca\u653e\u5728 r \u884c\u7684\u9501\u3002 3.3.2 \u8868\u7ea7\u9501\uff1a\u610f\u5411\u9501 \u00b6 InnoDB\u652f\u6301\u591a\u7c92\u5ea6\u9501\u5b9a\uff08 multiple granularity locking \uff09\uff0c\u5141\u8bb8\u884c\u9501\u4e0e\u8868\u9501\u5171\u5b58\u3002 \u5b83\u6307\u793a\u4e8b\u52a1\u7a0d\u540e\u5bf9\u8868\u4e2d\u7684\u884c\u6240\u9700\u7684\u9501\uff08\u5171\u4eabS\u6216\u72ec\u5360X\uff09\u7c7b\u578b\u3002For example, a statement such as LOCK TABLES ... WRITE takes an exclusive lock (an X lock) on the specified table. intention shared lock ( IS )\uff1a\u8868\u793a\u4e8b\u52a1\u6253\u7b97\u5728\u8868\u4e2d\u7684\u5404\u4e2a\u884c\u4e0a\u8bbe\u7f6e\u5171\u4eab\u9501\u3002 intention exclusive lock ( IX )\uff1a\u4e0e\u4e0a\u8ff0\u7c7b\u4f3c\u3002 For example, SELECT ... LOCK IN SHARE MODE sets an IS lock, and SELECT ... FOR UPDATE sets an IX lock. \u610f\u56fe\u9501\u5b9a\u534f\u8bae\u5982\u4e0b\uff1a \u5728\u4e8b\u52a1\u83b7\u53d6\u4e00\u884c\u7684 S \u4e4b\u524d\uff0c\u5fc5\u987b\u83b7\u53d6\u8868\u7684 IS \u9501\u6216\u66f4\u9ad8\u7b49\u7ea7\u7684\u9501\u3002 \u5728\u4e8b\u52a1\u83b7\u53d6\u4e00\u884c\u7684 X \u4e4b\u524d\uff0c\u5fc5\u987b\u83b7\u53d6\u8868\u7684 Ix \u9501\u3002 \u8868\u7ea7\u9501\u7c7b\u578b\u517c\u5bb9\u6027\uff1a \u5f53\u524d\u9501\u6a21\u5f0f\u2193 \u8bf7\u6c42\u9501\u6a21\u5f0f\u2192 X IX S IS X Conflict Conflict Conflict Conflict IX Conflict Compatible Conflict Compatible S Conflict Conflict Compatible Compatible IS Conflict Compatible Compatible Compatible \u4e8b\u52a1\u7684\u9501\u8bf7\u6c42\u5982\u679c\u548c\u5df2\u5b58\u5728\u7684\u9501\u517c\u5bb9\u5219\u4f1a\u88ab\u6ee1\u8db3\u3002 \u53ef\u901a\u8fc7\u76d1\u89c6\u5668\u8f93\u51fa\u8bed\u53e5\u67e5\u770b\uff1a SHOW ENGINE INNODB STATUS 3.3.3 \u8bb0\u5f55\u9501 Record Lock \u00b6 \u8bb0\u5f55\u9501\u662f\u4e00\u4e2a\u7d22\u5f15\u8bb0\u5f55\u4e0a\u7684\u9501\u3002\u4f8b\u5982\uff0c SELECT c1 FROM t WHERE c1 = 10 FOR UPDATE; \u963b\u6b62\u4efb\u4f55\u5176\u4ed6\u4e8b\u52a1\u5728 c1 = 10 \u884c\u7684\u63d2\u5165\u3001\u5220\u9664\u3001\u66f4\u65b0\u3002 \u5373\u4f7f\u5b9a\u4e49\u4e86\u6ca1\u6709\u7d22\u5f15\u7684\u8868\uff0c\u8bb0\u5f55\u9501\u4e5f\u59cb\u7ec8\u9501\u5b9a\u7d22\u5f15\u8bb0\u5f55\u3002 3.3.4 \u95f4\u9699\u9501 Gap Lock \u00b6 \u5728 \u7d22\u5f15\u8bb0\u5f55\u4e4b\u95f4\u7684\u95f4\u9699 \u6216 \u5728\u7b2c\u4e00\u4e2a\u4e4b\u524d\u6216\u6700\u540e\u4e00\u4e2a\u7d22\u5f15\u8bb0\u5f55\u4e4b\u540e\u7684\u95f4\u9699 \u4e0a\u7684\u9501\u3002\u4e0d\u8bba\u8bb0\u5f55\u5b58\u5728\u4e0e\u5426\u90fd\u4f1a\u963b\u6b62\u5176\u5b83\u4e8b\u52a1\u7684 \u63d2\u5165 \u64cd\u4f5c\uff0c\u56e0\u4e3a\u8be5 \u8303\u56f4 \u5185\u6240\u6709\u73b0\u6709\u503c\u4e4b\u95f4\u7684\u95f4\u9699\u662f\u9501\u5b9a\u7684\u3002 \u95f4\u9699\u53ef\u80fd\u8de8\u8d8a\u5355\u4e2a\u7d22\u5f15\u503c\uff0c\u591a\u4e2a\u7d22\u5f15\u503c\uff0c\u751a\u81f3\u53ef\u80fd\u4e3a\u7a7a\u3002 3.3.5 Next-Key Lock \u00b6 \u4e00\u4e2a next-key \u9501\u662f\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\u7684\u8bb0\u5f55\u9501\u4e0e\u5728\u6b64\u8bb0\u5f55\u4e4b\u524d\u7684\u95f4\u9699\u7684\u95f4\u9699\u9501\u7684\u7ec4\u5408\u3002 InnoDB\u6267\u884c\u884c\u7ea7\u9501\u5b9a\uff0c\u5f53\u5b83\u641c\u7d22\u6216\u626b\u63cf\u4e00\u5f20\u8868\u7684\u7d22\u5f15\u65f6\uff0c\u5728\u5b83\u547d\u4e2d\u7684\u7d22\u5f15\u8bb0\u5f55\u4e0a\u8bbe\u7f6e\u5171\u4eab\u9501\u6216\u6392\u5b83\u9501\u3002 Warning \u5728\u4f7f\u7528\u8303\u56f4\u6761\u4ef6\u68c0\u7d22\u5e76\u9501\u5b9a\u8bb0\u5f55\u65f6\uff0cInnoDB \u8fd9\u79cd\u52a0\u9501\u673a\u5236\u4f1a\u963b\u585e \u7b26\u5408\u6761\u4ef6\u8303\u56f4\u5185 \u952e\u503c\u7684\u5e76\u53d1\u63d2\u5165\uff0c \u8fd9\u5f80\u5f80\u4f1a\u9020\u6210\u4e25\u91cd\u7684\u9501\u7b49\u5f85\u3002 InnoDB \u9664\u4e86\u901a\u8fc7\u8303\u56f4\u6761\u4ef6\u52a0\u9501\u65f6\u4f7f\u7528\u95f4\u9699\u9501\u5916\uff0c\u5982\u679c\u4f7f\u7528\u76f8\u7b49\u6761\u4ef6\u8bf7\u6c42\u7ed9\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u9501\uff0cInnoDB \u4e5f\u4f1a\u4f7f\u7528\u95f4\u9699\u9501\uff01 3.4 \u4f55\u65f6\u52a0\u9501 \u00b6 \u610f\u5411\u9501\u662f InnoDB \u81ea\u52a8\u52a0\u7684\uff0c \u4e0d\u9700\u7528\u6237\u5e72\u9884\u3002 \u5bf9\u4e8e UPDATE\u3001 DELETE \u548c INSERT \u8bed\u53e5\uff0c InnoDB\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u6570\u636e\u96c6\u52a0\u6392\u4ed6\u9501\uff08X)\uff1b\u5bf9\u4e8e\u666e\u901a SELECT \u8bed\u53e5\uff0cInnoDB \u4e0d\u4f1a\u52a0\u4efb\u4f55\u9501\uff1b\u4e8b\u52a1\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u663e\u793a\u7ed9\u8bb0\u5f55\u96c6\u52a0\u5171\u4eab\u9501\u6216\u6392\u4ed6\u9501\u3002 \u5171\u4eab\u9501\uff08S\uff09\uff1a SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE \u6392\u4ed6\u9501\uff08X)\uff1a SELECT * FROM table_name WHERE ... FOR UPDATE \u7528 SELECT ... IN SHARE MODE \u83b7\u5f97\u5171\u4eab\u9501\uff0c\u4e3b\u8981\u7528\u5728\u9700\u8981\u6570\u636e\u4f9d\u5b58\u5173\u7cfb\u65f6\u6765\u786e\u8ba4\u67d0\u884c\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5e76\u786e\u4fdd\u6ca1\u6709\u4eba\u5bf9\u8fd9\u4e2a\u8bb0\u5f55\u8fdb\u884c UPDATE \u6216\u8005 DELETE \u64cd\u4f5c\u3002\u4f46\u662f\u5982\u679c\u5f53\u524d\u4e8b\u52a1\u4e5f\u9700\u8981\u5bf9\u8be5\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c \u5219\u5f88\u6709\u53ef\u80fd\u9020\u6210\u6b7b\u9501\uff0c \u5bf9\u4e8e \u9501\u5b9a\u884c\u8bb0\u5f55\u540e\u9700\u8981\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u7684\u5e94\u7528 \uff0c\u5e94\u8be5\u4f7f\u7528 SELECT... FOR UPDATE \u65b9\u5f0f\u83b7\u5f97\u6392\u4ed6\u9501\u3002 3.5 InnoDB \u884c\u9501\u5b9e\u73b0\u65b9\u5f0f \u00b6 InnoDB \u884c\u9501\u662f\u901a\u8fc7\u7ed9\u7d22\u5f15\u4e0a\u7684\u7d22\u5f15\u9879\u52a0\u9501\u6765\u5b9e\u73b0\u7684\u3002 Important \u53ea\u6709\u901a\u8fc7\u7d22\u5f15\u6761\u4ef6\u68c0\u7d22\u6570\u636e\uff0cInnoDB \u624d\u4f7f\u7528\u884c\u7ea7\u9501\uff0c\u5426\u5219\uff0cInnoDB \u5c06\u4f7f\u7528\u8868\u9501\uff01 \u867d\u7136\u662f\u8bbf\u95ee\u4e0d\u540c\u884c\u7684\u8bb0\u5f55\uff0c \u4f46\u662f\u5982\u679c\u662f\u4f7f\u7528\u76f8\u540c\u7684\u7d22\u5f15\u952e\uff08\u5373\uff0c\u4f7f\u7528\u540c\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\uff09\uff0c\u662f\u4f1a\u51fa\u73b0\u9501\u51b2\u7a81\u7684\uff08\u963b\u585e\uff09\u3002 \u5f53\u8868\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u7d22\u5f15\u9501\u5b9a\u4e0d\u540c\u7684\u884c\uff0c\u53e6\u5916\uff0c\u4e0d\u8bba\u662f\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u6216\u666e\u901a\u7d22\u5f15\uff0cInnoDB \u90fd\u4f1a\u4f7f\u7528\u884c\u9501\u6765\u5bf9\u6570\u636e\u52a0\u9501\u3002\u5373\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u7d22\u5f15\u8bbf\u95ee\u4e86\u540c\u4e00\u6761\u6570\u636e\uff0c\u4e5f\u4f1a\u9020\u6210\u963b\u585e\u3002 \u5373\u4fbf\u5728\u6761\u4ef6\u4e2d\u4f7f\u7528\u4e86\u7d22\u5f15\u5b57\u6bb5\uff0c \u4f46\u662f\u5426\u4f7f\u7528\u7d22\u5f15\u6765\u68c0\u7d22\u6570\u636e\u662f\u7531MySQL \u901a\u8fc7\u5224\u65ad\u4e0d\u540c\u6267\u884c\u8ba1\u5212\u7684\u4ee3\u4ef7\u6765\u51b3\u5b9a\u7684\u3002\u4e0d\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\u4e0bInnoDB \u5c06\u4f7f\u7528\u8868\u9501\uff0c\u800c\u4e0d\u662f\u884c\u9501\u3002 3.6 \u6062\u590d\u548c\u590d\u5236\u7684\u9700\u8981\uff0c\u5bf9 InnoDB \u9501\u673a\u5236\u7684\u5f71\u54cd \u00b6 MySQL \u7684\u6062\u590d\u673a\u5236\uff08\u590d\u5236\u5176\u5b9e\u5c31\u662f\u5728 Slave Mysql \u4e0d\u65ad\u505a\u57fa\u4e8e BINLOG \u7684\u6062\u590d\uff09\u6709\u4ee5\u4e0b\u7279\u70b9: MySQL \u7684\u6062\u590d\u662f SQL \u8bed\u53e5\u7ea7\u7684\uff0c\u4e5f\u5c31\u662f\u91cd\u65b0\u6267\u884c BINLOG \u4e2d\u7684 SQL \u8bed\u53e5\u3002\u8fd9\u4e0eOracle \u6570\u636e\u5e93\u4e0d\u540c\uff0cOracle \u662f\u57fa\u4e8e\u6570\u636e\u5e93\u6587\u4ef6\u5757\u7684\u3002 MySQL \u7684 Binlog \u662f\u6309\u7167\u4e8b\u52a1\u63d0\u4ea4\u7684\u5148\u540e\u987a\u5e8f\u8bb0\u5f55\u7684\uff0c \u6062\u590d\u4e5f\u662f\u6309\u8fd9\u4e2a\u987a\u5e8f\u8fdb\u884c\u7684\u3002\u8fd9\u70b9\u4e5f\u4e0e Oralce \u4e0d\u540c\uff0cOracle \u662f\u6309\u7167\u7cfb\u7edf\u66f4\u65b0\u53f7\uff08System Change Number\uff0cSCN\uff09\u6765\u6062\u590d\u6570\u636e\u7684\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5f00\u59cb\u65f6\uff0cOracle \u90fd\u4f1a\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 SCN\uff0cSCN \u7684\u987a\u5e8f\u4e0e\u4e8b\u52a1 \u5f00\u59cb\u7684\u65f6\u95f4\u987a\u5e8f\u662f\u4e00\u81f4\u7684\u3002 \u4ece\u4e0a\u9762\u4e24\u70b9\u53ef\u77e5\uff0cMySQL \u7684\u6062\u590d\u673a\u5236\u8981\u6c42\uff1a\u5728\u4e00\u4e2a\u4e8b\u52a1\u672a\u63d0\u4ea4\u524d\uff0c\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u4e0d\u80fd\u63d2\u5165\u6ee1\u8db3\u5176\u9501\u5b9a\u6761\u4ef6\u7684\u4efb\u4f55\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u51fa\u73b0\u5e7b\u8bfb\uff0c\u5b9e\u9645\u4e0a\u662f\u8981\u6c42\u4e8b\u52a1\u8981\u4e32\u884c\u5316\u3002 Warning Insert into target_tab select * from source_tab where ... \u548c create table new_tab ...select ... From source_tab where ... \u65f6\u4f1a\u7ed9 source_tab \u52a0\u9501\u3002 \u8fd8\u8981\u7279\u522b\u8bf4\u660e\u7684\u662f\uff0c \u5982\u679c\u4e0a\u8ff0\u8bed\u53e5\u7684 SELECT \u662f\u8303\u56f4\u6761\u4ef6\uff0c InnoDB \u8fd8\u4f1a\u7ed9\u6e90\u8868\u52a0\u95f4\u9699\u9501 \uff08Next-Lock\uff09\u3002 INSERT...SELECT...\u548cCREATE TABLE...SELECT...\u8bed\u53e5\uff0c\u53ef\u80fd\u4f1a\u963b\u6b62\u5bf9\u6e90\u8868\u7684\u5e76\u53d1\u66f4\u65b0\uff0c \u9020\u6210\u5bf9\u6e90\u8868\u9501\u7684\u7b49\u5f85\u3002MySQL\u5c06\u8fd9\u79cdSQL\u53eb\u4f5c\u4e0d\u786e\u5b9a\uff08non-deterministic\uff09\u7684SQL\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 \u5982\u679c\u5e94\u7528\u4e2d\u4e00\u5b9a\u8981\u7528\u8fd9\u79cd SQL \u6765\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\uff0c\u53c8\u4e0d\u5e0c\u671b\u5bf9\u6e90\u8868\u7684\u5e76\u53d1\u66f4\u65b0\u4ea7\u751f\u5f71\u54cd\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u4e24\u79cd\u63aa\u65bd\uff1a \u4e00\u662f\u91c7\u53d6\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684\u505a\u6cd5\uff0c\u5c06 innodb_locks_unsafe_for_binlog \u7684\u503c\u8bbe\u7f6e\u4e3a on \uff0c\u5f3a\u5236 MySQL \u4f7f\u7528\u591a\u7248\u672c\u6570\u636e\u4e00\u81f4\u6027\u8bfb\u3002\u4f46\u4ed8\u51fa\u7684\u4ee3\u4ef7\u662f\u53ef\u80fd\u65e0\u6cd5\u7528 binlog \u6b63\u786e\u5730\u6062\u590d\u6216\u590d\u5236\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002 \u4e8c\u662f\u901a\u8fc7\u4f7f\u7528 select * from source_tab ... Into outfile \u548c load data infile ... \u8bed\u53e5\u7ec4\u5408\u6765\u95f4\u63a5\u5b9e\u73b0\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f MySQL \u4e0d\u4f1a\u7ed9 source_tab \u52a0\u9501\u3002 3.7 \u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u4e00\u81f4\u6027\u8bfb\u53ca\u9501\u7684\u5dee\u5f02 \u00b6 3.8 \u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u8868\u9501 \u00b6 \u5bf9\u4e8e InnoDB \u8868\uff0c\u5728\u7edd\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u5e94\u8be5\u4f7f\u7528\u884c\u7ea7\u9501\uff0c\u56e0\u4e3a\u4e8b\u52a1\u548c\u884c\u9501\u5f80\u5f80\u662f\u6211\u4eec\u4e4b\u6240\u4ee5\u9009\u62e9 InnoDB \u8868\u7684\u7406\u7531\u3002\u4f46\u5728\u4e2a\u522b\u7279\u6b8a\u4e8b\u52a1\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8868\u7ea7\u9501\uff1a \u4e8b\u52a1\u9700\u8981\u66f4\u65b0\u5927\u90e8\u5206\u6216\u5168\u90e8\u6570\u636e\uff0c\u8868\u53c8\u6bd4\u8f83\u5927 \u4e8b\u52a1\u6d89\u53ca\u591a\u4e2a\u8868\uff0c\u6bd4\u8f83\u590d\u6742\uff0c\u5f88\u53ef\u80fd\u5f15\u8d77\u6b7b\u9501\uff0c\u9020\u6210\u5927\u91cf\u4e8b\u52a1\u56de\u6eda\u3002 \u5728 InnoDB \u4e0b\uff0c\u4f7f\u7528\u8868\u9501\u8981\u6ce8\u610f\u4ee5\u4e0b\u4e24\u70b9\uff1a \u4ec5\u5f53 autocommit=0 \u3001innodb_table_locks=1\uff08\u9ed8\u8ba4\u8bbe\u7f6e\uff09\u65f6\uff0cInnoDB \u5c42\u624d\u80fd\u77e5\u9053 MySQL \u52a0\u7684\u8868\u9501\u3002 \u5728\u7528 LOCK TABLES \u5bf9 InnoDB \u8868\u52a0\u9501\u65f6\u8981\u6ce8\u610f\uff0c\u8981\u5c06 AUTOCOMMIT \u8bbe\u4e3a 0\uff0c\u5426\u5219 MySQL \u4e0d\u4f1a\u7ed9\u8868\u52a0\u9501\uff1b \u4e8b\u52a1\u7ed3\u675f\u524d\uff0c \u4e0d\u8981\u7528 UNLOCK TABLES \u91ca\u653e\u8868\u9501\uff0c \u56e0\u4e3a UNLOCK TABLES \u4f1a\u9690\u542b\u5730\u63d0\u4ea4\u4e8b\u52a1 \uff1b COMMIT \u6216 ROLLBACK \u5e76\u4e0d\u80fd\u91ca\u653e\u7528 LOCK TABLES \u52a0\u7684\u8868\u7ea7\u9501\uff0c\u5fc5\u987b\u7528 UNLOCK TABLES \u91ca\u653e\u8868\u9501\u3002 -- \u4f8b\u5982\uff0c\u5982\u679c\u9700\u8981\u5199\u8868 t1 \u5e76\u4ece\u8868 t \u8bfb\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u505a\uff1a SET AUTOCOMMIT = 0 ; LOCK TABLES t1 WRITE , t2 READ , ...; [ do something with tables t1 and t2 here ]; COMMIT ; UNLOCK TABLES 3.9 \u6b7b\u9501 \u00b6 MyISAM \u603b\u662f\u4e00\u6b21\u83b7\u5f97\u6240\u9700\u7684\u5168\u90e8\u9501\uff0c\u8981\u4e48\u5168\u90e8\u6ee1\u8db3\uff0c\u8981\u4e48\u7b49\u5f85\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002 InnoDB \u4e2d\uff0c \u9664\u5355\u4e2a SQL \u7ec4\u6210\u7684\u4e8b\u52a1\u5916\uff0c\u9501\u662f\u9010\u6b65\u83b7\u5f97\u7684\uff0c\u8fd9\u5c31\u51b3\u5b9a\u4e86\u5728 InnoDB \u4e2d\u53d1\u751f\u6b7b\u9501\u662f\u53ef\u80fd\u7684\u3002 \u200b \u53d1\u751f\u6b7b\u9501\u540e\uff0cInnoDB \u4e00\u822c\u90fd\u80fd\u81ea\u52a8\u68c0\u6d4b\u5230\uff0c\u5e76\u4f7f\u4e00\u4e2a\u4e8b\u52a1\u91ca\u653e\u9501\u5e76\u56de\u9000\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u5f97\u9501\uff0c\u7ee7\u7eed\u5b8c\u6210\u4e8b\u52a1\u3002\u4f46\u5728\u6d89\u53ca\u5916\u90e8\u9501\uff0c\u6216\u6d89\u53ca\u8868\u9501\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5e76\u4e0d\u80fd\u5b8c\u5168\u81ea\u52a8\u68c0\u6d4b \u5230\u6b7b\u9501\uff0c \u8fd9\u9700\u8981\u901a\u8fc7\u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6\u53c2\u6570 innodb_lock_wait_timeout \u6765\u89e3\u51b3\u3002 \u200b \u901a\u5e38\u6765\u8bf4\uff0c\u6b7b\u9501\u90fd\u662f\u5e94\u7528\u8bbe\u8ba1\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u8c03\u6574\u4e1a\u52a1\u6d41\u7a0b\u3001\u6570\u636e\u5e93\u5bf9\u8c61\u8bbe\u8ba1\u3001\u4e8b\u52a1\u5927\u5c0f\uff0c\u4ee5\u53ca\u8bbf\u95ee\u6570\u636e\u5e93\u7684 SQL \u8bed\u53e5\uff0c\u7edd\u5927\u90e8\u5206\u6b7b\u9501\u90fd\u53ef\u4ee5\u907f\u514d\u3002 \u907f\u514d\u6b7b\u9501\u7684\u5e38\u7528\u65b9\u6cd5\uff1a \u5728\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u540c\u7684\u7a0b\u5e8f\u4f1a\u5e76\u53d1\u5b58\u53d6\u591a\u4e2a\u8868\uff0c\u5e94\u5c3d\u91cf\u7ea6\u5b9a\u4ee5\u76f8\u540c\u7684\u987a\u5e8f\u6765\u8bbf\u95ee\u8868\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u4ea7\u751f\u6b7b\u9501\u7684\u673a\u4f1a\u3002 \u5728\u7a0b\u5e8f\u4ee5\u6279\u91cf\u65b9\u5f0f\u5904\u7406\u6570\u636e\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e8b\u5148\u5bf9\u6570\u636e\u6392\u5e8f\uff0c\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u6309\u56fa\u5b9a\u7684\u987a\u5e8f\u6765\u5904\u7406\u8bb0\u5f55\uff0c\u4e5f\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u51fa\u73b0\u6b7b\u9501\u7684\u53ef\u80fd\u3002 \u5982\u679c\u8981\u66f4\u65b0\u8bb0\u5f55\uff0c\u5e94\u8be5\u76f4\u63a5\u7533\u8bf7\u8db3\u591f\u7ea7\u522b\u7684\u9501\uff0c\u5373\u6392\u4ed6\u9501\uff0c\u800c\u4e0d\u5e94\u5148\u7533\u8bf7\u5171\u4eab\u9501\uff0c \u66f4\u65b0\u65f6\u518d\u7533\u8bf7\u6392\u4ed6\u9501\uff0c \u56e0\u4e3a\u5f53\u7528\u6237\u7533\u8bf7\u6392\u4ed6\u9501\u65f6\uff0c \u5176\u4ed6\u4e8b\u52a1\u53ef\u80fd\u53c8\u5df2\u7ecf\u83b7\u5f97\u4e86\u76f8\u540c\u8bb0\u5f55\u7684\u5171\u4eab\u9501\uff0c\u4ece\u800c\u9020\u6210\u9501\u51b2\u7a81\uff0c\u751a\u81f3\u6b7b\u9501\u3002 \u5728 REPEATABLE-READ \u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5982\u679c\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5bf9\u76f8\u540c\u6761\u4ef6\u8bb0\u5f55\u7528 SELECT...FOR UPDATE \u52a0\u6392\u4ed6\u9501\uff0c \u5728\u6ca1\u6709\u7b26\u5408\u8be5\u6761\u4ef6\u8bb0\u5f55\u60c5\u51b5\u4e0b\uff0c \u4e24\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u52a0\u9501\u6210\u529f\u3002\u7a0b\u5e8f\u53d1\u73b0\u8bb0\u5f55\u5c1a\u4e0d\u5b58\u5728\uff0c\u5c31\u8bd5\u56fe\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u5982\u679c\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u8fd9\u4e48\u505a\uff0c\u5c31\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u9694\u79bb\u7ea7\u522b\u6539\u6210 READ COMMITTED \uff0c\u5c31\u53ef\u907f\u514d\u95ee\u9898\u3002 \u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u603b\u662f\u6355\u83b7\u5e76\u5904\u7406\u6b7b\u9501\u5f02\u5e38 \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7f16\u7a0b\u4e60\u60ef\u3002 \u5982\u679c\u51fa\u73b0\u6b7b\u9501\uff0c \u53ef\u4ee5\u7528 SHOW INNODB STATUS \u547d\u4ee4\u6765\u786e\u5b9a\u6700\u540e\u4e00\u4e2a\u6b7b\u9501\u4ea7\u751f\u7684\u539f\u56e0\u3002 \u8fd4\u56de\u7ed3\u679c\u4e2d\u5305\u62ec\u6b7b\u9501\u76f8\u5173\u4e8b\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f\u3002 4. \u5c0f\u7ed3 \u00b6 \u5bf9\u4e8e MyISAM \u7684\u8868\u9501\uff1a \u5171\u4eab\u8bfb\u9501\uff08S\uff09\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u4f46\u5171\u4eab\u8bfb\u9501\uff08S\uff09\u4e0e\u6392\u4ed6\u5199\u9501\uff08X\uff09\u4e4b\u95f4\uff0c\u4ee5\u53ca\u6392\u4ed6\u5199\u9501\uff08X\uff09\u4e4b\u95f4\u662f\u4e92\u65a5\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u548c\u5199\u662f\u4e32\u884c\u7684\u3002 \u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0cMyISAM \u5141\u8bb8\u67e5\u8be2\u548c\u63d2\u5165\u5e76\u53d1\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u70b9\u6765\u89e3\u51b3\u5e94\u7528\u4e2d\u5bf9\u540c\u4e00\u8868\u67e5\u8be2\u548c\u63d2\u5165\u7684\u9501\u4e89\u7528\u95ee\u9898\u3002 MyISAM \u9ed8\u8ba4\u7684\u9501\u8c03\u5ea6\u673a\u5236\u662f\u5199\u4f18\u5148\uff0c\u8fd9\u5e76\u4e0d\u4e00\u5b9a\u9002\u5408\u6240\u6709\u5e94\u7528\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e LOW_PRIORITY_UPDATES \u53c2\u6570\uff0c \u6216\u5728 INSERT \u3001 UPDATE \u3001 DELETE \u8bed\u53e5\u4e2d\u6307\u5b9aLOW_PRIORITY \u9009\u9879\u6765\u8c03\u8282\u8bfb\u5199\u9501\u7684\u4e89\u7528\u3002 \u7531\u4e8e\u8868\u9501\u7684\u9501\u5b9a\u7c92\u5ea6\u5927\uff0c \u8bfb\u5199\u4e4b\u95f4\u53c8\u662f\u4e32\u884c\u7684\uff0c \u56e0\u6b64\uff0c \u5982\u679c\u66f4\u65b0\u64cd\u4f5c\u8f83\u591a\uff0c MyISAM \u8868\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e25\u91cd\u7684\u9501\u7b49\u5f85\uff0c\u53ef\u4ee5\u8003\u8651\u91c7\u7528 InnoDB \u8868\u6765\u51cf\u5c11\u9501\u51b2\u7a81\u3002 \u5bf9\u4e8e InnoDB \u8868\uff1a InnoDB \u7684\u884c\u9501\u662f\u57fa\u4e8e\u9501\u5f15\u5b9e\u73b0\u7684\uff0c \u5982\u679c\u4e0d\u901a\u8fc7\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c InnoDB \u4f1a\u4f7f\u7528\u8868\u9501\u3002 \u5728\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\u4e0b\uff0cInnoDB \u7684\u9501\u673a\u5236\u548c\u4e00\u81f4\u6027\u8bfb\u7b56\u7565\u4e0d\u540c\u3002 MySQL \u7684\u6062\u590d\u548c\u590d\u5236\u5bf9 InnoDB \u9501\u673a\u5236\u548c\u4e00\u81f4\u6027\u8bfb\u7b56\u7565\u4e5f\u6709\u8f83\u5927\u5f71\u54cd\u3002 \u9501\u51b2\u7a81\u751a\u81f3\u6b7b\u9501\u5f88\u96be\u5b8c\u5168\u907f\u514d\u3002 \u53ef\u4ee5\u901a\u8fc7\u8bbe\u8ba1\u548c SQL \u8c03\u6574\u7b49\u63aa\u65bd\u51cf\u5c11\u9501\u51b2\u7a81\u548c\u6b7b\u9501\uff0c\u5305\u62ec\uff1a \u5c3d\u91cf\u4f7f\u7528\u8f83\u4f4e\u7684\u9694\u79bb\u7ea7\u522b\uff1b \u7cbe\u5fc3\u8bbe\u8ba1\u7d22\u5f15\uff0c \u5e76\u5c3d\u91cf\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c \u4f7f\u52a0\u9501\u66f4\u7cbe\u786e\uff0c \u4ece\u800c\u51cf\u5c11\u9501\u51b2\u7a81\u7684\u673a\u4f1a\uff1b \u9009\u62e9\u5408\u7406\u7684\u4e8b\u52a1\u5927\u5c0f\uff0c\u5c0f\u4e8b\u52a1\u53d1\u751f\u9501\u51b2\u7a81\u7684\u51e0\u7387\u4e5f\u66f4\u5c0f\uff1b \u7ed9\u8bb0\u5f55\u96c6\u663e\u793a\u52a0\u9501\u65f6\uff0c \u6700\u597d\u4e00\u6b21\u6027\u8bf7\u6c42\u8db3\u591f\u7ea7\u522b\u7684\u9501\u3002 \u6bd4\u5982\u8981\u4fee\u6539\u6570\u636e\u7684\u8bdd\uff0c \u6700\u597d\u76f4\u63a5\u7533\u8bf7\u6392\u4ed6\u9501\uff0c\u800c\u4e0d\u662f\u5148\u7533\u8bf7\u5171\u4eab\u9501\uff0c\u4fee\u6539\u65f6\u518d\u8bf7\u6c42\u6392\u4ed6\u9501\uff0c\u8fd9\u6837\u5bb9\u6613\u4ea7\u751f\u6b7b\u9501\uff1b \u4e0d\u540c\u7684\u7a0b\u5e8f\u8bbf\u95ee\u4e00\u7ec4\u8868\u65f6\uff0c \u5e94\u5c3d\u91cf\u7ea6\u5b9a\u4ee5\u76f8\u540c\u7684\u987a\u5e8f\u8bbf\u95ee\u5404\u8868\uff0c \u5bf9\u4e00\u4e2a\u8868\u800c\u8a00\uff0c \u5c3d\u53ef\u80fd\u4ee5\u56fa\u5b9a\u7684\u987a\u5e8f\u5b58\u53d6\u8868\u4e2d\u7684\u884c\u3002\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u6b7b\u9501\u7684\u673a\u4f1a\uff1b \u5c3d\u91cf\u7528\u76f8\u7b49\u6761\u4ef6\u8bbf\u95ee\u6570\u636e\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u95f4\u9699\u9501\u5bf9\u5e76\u53d1\u63d2\u5165\u7684\u5f71\u54cd\uff1b \u4e0d\u8981\u7533\u8bf7\u8d85\u8fc7\u5b9e\u9645\u9700\u8981\u7684\u9501\u7ea7\u522b\uff1b\u9664\u975e\u5fc5\u987b\uff0c\u67e5\u8be2\u65f6\u4e0d\u8981\u663e\u793a\u52a0\u9501\uff1b \u5bf9\u4e8e\u4e00\u4e9b\u7279\u5b9a\u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u4f7f\u7528\u8868\u9501\u6765\u63d0\u9ad8\u5904\u7406\u901f\u5ea6\u6216\u51cf\u5c11\u6b7b\u9501\u7684\u53ef\u80fd\u3002","title":"27. \u9501"},{"location":"mysql/27. \u9501/#1-mysql","text":"\u76f8\u5bf9\u5176\u4ed6\u6570\u636e\u5e93\u800c\u8a00\uff0c MySQL\u7684\u9501\u673a\u5236\u6bd4\u8f83\u7b80\u5355\uff0c \u5176\u6700\u663e\u8457\u7684\u7279\u70b9\u662f\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u4e0d \u540c\u7684\u9501\u673a\u5236\u3002 \u4e09\u79cd\u9501\u7279\u6027\uff1a \u8868\u7ea7\u9501\uff1a\u5f00\u9500\u5c0f\uff0c\u52a0\u9501\u5feb\uff1b\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u5927\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u9ad8,\u5e76\u53d1\u5ea6\u6700\u4f4e\u3002 \u884c\u7ea7\u9501\uff1a\u5f00\u9500\u5927\uff0c\u52a0\u9501\u6162\uff1b\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u6700\u5c0f\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u4f4e,\u5e76\u53d1\u5ea6\u4e5f\u6700\u9ad8\u3002 \u9875\u9762\u9501\uff1a \u5f00\u9500\u548c\u52a0\u9501\u65f6\u95f4\u754c\u4e8e\u8868\u9501\u548c\u884c\u9501\u4e4b\u95f4\uff1b \u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b \u9501\u5b9a\u7c92\u5ea6\u754c\u4e8e\u8868\u9501\u548c\u884c\u9501 \u4e4b\u95f4\uff0c\u5e76\u53d1\u5ea6\u4e00\u822c\u3002 \u4ec5\u4ece\u9501\u7684\u89d2\u5ea6\u6765\u8bf4\uff1a \u8868\u7ea7\u9501\u66f4\u9002\u5408\u4e8e\u4ee5\u67e5\u8be2\u4e3a\u4e3b\uff0c \u53ea\u6709\u5c11\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u66f4\u65b0\u6570\u636e\u7684\u5e94\u7528\uff0c \u5982 Web \u5e94\u7528\uff1b\u800c\u884c\u7ea7\u9501\u5219\u66f4\u9002\u5408\u4e8e\u6709\u5927\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u5e76\u53d1\u66f4\u65b0\u5c11\u91cf\u4e0d\u540c\u6570\u636e\uff0c\u540c\u65f6\u53c8\u6709\u5e76\u53d1\u67e5\u8be2\u7684\u5e94\u7528\uff0c\u5982\u4e00\u4e9b\u5728\u7ebf\u4e8b\u52a1\u5904\u7406\uff08OLTP\uff09\u7cfb\u7edf\u3002","title":"1. MySQL \u9501\u6982\u8ff0"},{"location":"mysql/27. \u9501/#2-myisam","text":"MyISAM \u5b58\u50a8\u5f15\u64ce\u53ea\u652f\u6301\u8868\u9501\u3002","title":"2. MyISAM \u8868\u9501"},{"location":"mysql/27. \u9501/#21","text":"\u901a\u8fc7\u68c0\u67e5 table_locks_waited \u548c table_locks_immediate \u72b6\u6001\u53d8\u91cf\u6765\u5206\u6790\u7cfb\u7edf\u4e0a\u7684\u8868\u9501\u5b9a\u4e89\u593a\uff1a MariaDB [ MYISAM_TEST ] > SHOW STATUS LIKE \"TABLE%\" ; +-----------------------+-------+ | Variable_name | Value | +-----------------------+-------+ | Table_locks_immediate | 84 | | Table_locks_waited | 0 | +-----------------------+-------+ Table_locks_waites \u8d8a\u5927\uff0c\u4e89\u593a\u60c5\u51b5\u8d8a\u4e25\u91cd\u3002","title":"2.1 \u67e5\u8be2\u8868\u7ea7\u9501\u4e89\u7528\u60c5\u51b5"},{"location":"mysql/27. \u9501/#22-mysql","text":"MySQL \u7684\u8868\u7ea7\u9501\u6709\u4e24\u79cd\u6a21\u5f0f\uff1a \u8868\u5171\u4eab\u8bfb\u9501 \uff08Table Read Lock\uff09 \u548c\u8868\u72ec\u5360\u5199\u9501 \uff08Table Write Lock\uff09\u3002 \u53ef\u89c1\uff0c \u5bf9 MyISAM \u8868\u7684\u8bfb\u64cd\u4f5c\uff0c \u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u8bf7\u6c42\uff0c \u4f46\u4f1a\u963b\u585e\u5bf9\u540c\u4e00\u8868\u7684 \u5199\u8bf7\u6c42\uff1b\u5bf9 MyISAM \u8868\u7684\u5199\u64cd\u4f5c\uff0c\u5219\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u548c\u5199\u64cd\u4f5c\uff1bMyISAM \u8868\u7684\u8bfb\u64cd\u4f5c\u4e0e\u5199\u64cd\u4f5c\u4e4b\u95f4\uff0c\u4ee5\u53ca\u5199\u64cd\u4f5c\u4e4b\u95f4\u662f \u4e32\u884c\u7684 \uff01","title":"2.2 MySQL \u8868\u7ea7\u9501\u7684\u9501\u6a21\u5f0f"},{"location":"mysql/27. \u9501/#23","text":"MyISAM \u5728\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff08SELECT\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u6240\u6709\u8868\u52a0\u8bfb\u9501\uff0c\u5728\u6267\u884c\u66f4\u65b0\u64cd\u4f5c \uff08UPDATE\u3001DELETE\u3001INSERT \u7b49\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u8868\u52a0\u5199\u9501\u3002 \u7ed9 MyISAM \u8868\u663e\u793a\u52a0\u9501\uff0c \u4e00\u822c\u662f\u4e3a\u4e86\u5728\u4e00\u5b9a\u7a0b\u5ea6\u6a21\u62df\u4e8b\u52a1\u64cd\u4f5c\uff0c \u5b9e\u73b0\u5bf9\u67d0\u4e00\u65f6\u95f4\u70b9\u591a\u4e2a\u8868\u7684 \u4e00\u81f4\u6027\u8bfb\u53d6\u3002\u4f8b\uff1a Lock tables orders read local , order_detail read local ; Select sum ( total ) from orders ; Select sum ( subtotal ) from order_detail ; Unlock tables ; Important \u5728\u7528 LOCK TABLES \u7ed9\u8868\u663e\u5f0f\u52a0\u8868\u9501\u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u53d6\u5f97\u6240\u6709\u6d89\u53ca\u5230\u8868\u7684\u9501\uff0c\u5e76\u4e14 MySQL \u4e0d \u652f\u6301\u9501\u5347\u7ea7\u3002\u5728\u6267\u884c LOCK TABLES \u540e\uff0c\u53ea\u80fd\u8bbf\u95ee\u663e\u5f0f\u52a0\u9501\u7684\u8fd9\u4e9b\u8868\uff0c\u4e0d\u80fd\u8bbf\u95ee\u672a\u52a0\u9501\u7684\u8868\uff1b\u540c\u65f6\uff0c\u5982\u679c\u52a0\u7684\u662f\u8bfb\u9501\uff0c\u90a3\u4e48\u53ea\u80fd\u6267\u884c\u67e5\u8be2\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\u3002 MyISAM \u603b\u662f\u4e00\u6b21\u83b7\u5f97 SQL \u8bed\u53e5\u6240\u9700\u8981\u7684\u5168\u90e8\u9501\uff0c\u8fd9\u4e5f\u6b63\u662f\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\u7684\u539f\u56e0\u3002 Warning \u5f53\u4f7f\u7528 LOCK TABLES \u65f6\uff0c\u4e0d\u4ec5\u9700\u8981\u4e00\u6b21\u9501\u5b9a\u7528\u5230\u7684\u6240\u6709\u8868\uff0c\u800c\u4e14\uff0c\u540c\u4e00\u4e2a\u8868\u5728 SQL \u8bed\u53e5 \u4e2d\u51fa\u73b0\u591a\u5c11\u6b21\uff0c\u5c31\u8981\u901a\u8fc7\u4e0e SQL \u8bed\u53e5\u4e2d\u76f8\u540c\u7684\u522b\u540d\u9501\u5b9a\u591a\u5c11\u6b21\uff0c\u5426\u5219\u4e5f\u4f1a\u51fa\u9519\uff01 \u6b63\u786e\u5199\u6cd5\uff1a mysql> lock table actor as a read,actor as b read;","title":"2.3 \u5982\u4f55\u52a0\u8868\u9501"},{"location":"mysql/27. \u9501/#24-concurrent-inserts","text":"\u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0cMyISAM \u8868\u4e5f\u652f\u6301\u67e5\u8be2\u548c\u63d2\u5165\u64cd\u4f5c\u7684\u5e76\u53d1\u8fdb\u884c\uff08 \u5220\u9664\u548c\u66f4\u65b0\u64cd\u4f5c\u4f1a\u963b\u585e\uff01 \uff09\u3002 \u63a7\u5236\u8be5\u6743\u9650\u7684\u7cfb\u7edf\u53d8\u91cf\u662f concurrent_insert \uff1a \u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u4e0d\u5141\u8bb8\u5e76\u53d1\u63d2\u5165\u3002 \u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5982\u679cMyISAM\u8868\u4e2d\u6ca1\u6709\u7a7a\u6d1e\uff08\u5373\u8868\u7684\u4e2d\u95f4\u6ca1\u6709\u88ab\u5220\u9664\u7684\u884c\uff09\uff0c MyISAM\u5141\u8bb8\u5728\u4e00\u4e2a\u8fdb\u7a0b\u8bfb\u8868\u7684\u540c\u65f6\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4ece\u8868\u5c3e\u63d2\u5165\u8bb0\u5f55\u3002\u8fd9\u4e5f\u662f MySQL \u7684 \u9ed8\u8ba4\u8bbe\u7f6e \u3002 \u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u65e0\u8bbaMyISAM\u8868\u4e2d\u6709\u6ca1\u6709\u7a7a\u6d1e\uff0c\u90fd\u5141\u8bb8\u5728\u8868\u5c3e\u5e76\u53d1\u63d2\u5165\u8bb0\u5f55\u3002","title":"2.4 \u5e76\u53d1\u63d2\u5165\uff08Concurrent Inserts\uff09"},{"location":"mysql/27. \u9501/#25-myisam","text":"\u5373\u4f7f\u8bfb\u8bf7\u6c42\u5148\u5230\u9501\u7b49\u5f85\u961f\u5217\uff0c \u5199\u8bf7\u6c42\u540e\u5230\uff0c \u5199\u9501\u4e5f\u4f1a\u63d2\u5230\u8bfb\u9501\u8bf7\u6c42\u4e4b\u524d\uff01\u8fd9\u662f\u56e0\u4e3a MySQL \u8ba4\u4e3a \u5199\u8bf7\u6c42\u4e00\u822c\u6bd4\u8bfb\u8bf7\u6c42\u4f18\u5148\u7ea7\u66f4\u9ad8 \u3002 \u8fd9\u4e5f\u6b63\u662f MyISAM \u8868\u4e0d\u592a\u9002\u5408\u4e8e\u6709\u5927\u91cf\u66f4\u65b0\u64cd\u4f5c\u548c\u67e5\u8be2\u64cd\u4f5c\u5e94\u7528\u7684\u539f\u56e0\uff0c \u56e0\u4e3a\u5927\u91cf\u7684\u66f4\u65b0\u64cd\u4f5c\u4f1a\u9020\u6210\u67e5\u8be2\u64cd\u4f5c\u5f88\u96be\u83b7\u5f97\u8bfb\u9501\uff0c \u4ece\u800c\u53ef\u80fd\u6c38\u8fdc\u963b\u585e\u3002 \u5982\u4f55\u8c03\u8282 \uff1a \u901a\u8fc7\u6307\u5b9a\u542f\u52a8\u53c2\u6570 low-priority-updates\uff0c\u4f7fMyISAM\u5f15\u64ce\u9ed8\u8ba4\u7ed9\u4e88\u8bfb\u8bf7\u6c42\u4ee5\u4f18\u5148\u7684\u6743\u5229\u3002 \u901a\u8fc7\u6267\u884c\u547d\u4ee4SET LOW_PRIORITY_UPDATES=1\uff0c\u4f7f\u8be5\u8fde\u63a5\u53d1\u51fa\u7684\u66f4\u65b0\u8bf7\u6c42\u4f18\u5148\u7ea7\u964d\u4f4e\u3002 \u901a\u8fc7\u6307\u5b9aINSERT\u3001UPDATE\u3001DELETE\u8bed\u53e5\u7684LOW_PRIORITY\u5c5e\u6027\uff0c\u964d\u4f4e\u8be5\u8bed\u53e5\u7684\u4f18\u5148\u7ea7\u3002 \u7ed9\u7cfb\u7edf\u53c2\u6570 max_write_lock_count \u8bbe\u7f6e\u4e00\u4e2a\u5408\u9002\u7684\u503c\uff0c\u5f53\u4e00\u4e2a\u8868\u7684\u8bfb\u9501\u8fbe\u5230\u8fd9\u4e2a\u503c\u540e\uff0cMySQL\u5c31\u6682\u65f6\u5c06\u5199\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\u964d\u4f4e\uff0c\u7ed9\u8bfb\u8fdb\u7a0b\u4e00\u5b9a\u83b7\u5f97\u9501\u7684\u673a\u4f1a\u3002 \u5e94\u7528\u4e2d\u5e94 \u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u67e5\u8be2\u64cd\u4f5c \uff0c\u4e0d\u8981\u603b\u60f3\u7528\u4e00\u6761SELECT\u8bed\u53e5\u6765\u89e3\u51b3\u95ee\u9898\u3002","title":"2.5 MyISAM \u7684\u9501\u8c03\u5ea6"},{"location":"mysql/27. \u9501/#3-innodb","text":"","title":"3. InnoDB \u9501"},{"location":"mysql/27. \u9501/#31","text":"\u53c2\u8003 6. \u4e8b\u52a1","title":"3.1 \u4e8b\u52a1"},{"location":"mysql/27. \u9501/#32-innodb","text":"\u68c0\u67e5\u72b6\u6001\u53d8\u91cf InnoDB_row_lock \uff1a MariaDB [ blog ] > SHOW STATUS LIKE 'INNODB_ROW_LOCK%' ; +-------------------------------+-------+ | Variable_name | Value | +-------------------------------+-------+ | Innodb_row_lock_current_waits | 0 | | Innodb_row_lock_time | 0 | | Innodb_row_lock_time_avg | 0 | | Innodb_row_lock_time_max | 0 | | Innodb_row_lock_waits | 0 | +-------------------------------+-------+ \u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e InnoDB Monitors \u6765\u8fdb\u4e00\u6b65\u89c2\u5bdf\u53d1\u751f\u9501\u51b2\u7a81\u7684\u8868\u3001\u6570\u636e\u884c\u7b49\uff0c\u5e76\u5206\u6790\u9501\u4e89\u7528\u7684\u539f\u56e0\u3002 \u66f4\u591a\u76d1\u89c6\u5668\uff08\u6807\u51c6\u76d1\u89c6\u5668\u3001\u9501\u76d1\u89c6\u5668\u3001\u8868\u7a7a\u95f4\u76d1\u89c6\u5668\u3001\u8868\u76d1\u89c6\u5668\uff09 -- \u901a\u8fc7\u5efa\u8868\u8bed\u53e5\u5f00\u542f\u76d1\u89c6\u5668 CREATE TABLE innodb_monitor ( a INT ) ENGINE = INNODB ; -- \u7528\u4e0b\u9762\u7684\u8bed\u53e5\u6765\u8fdb\u884c\u67e5\u770b SHOW ENGINE INNODB STATUS \\ G ; -- \u901a\u8fc7\u5220\u8868\u8bed\u53e5\u505c\u6b62\u76d1\u89c6\u5668 DROP TABLE innodb_monitor ; \u5982\u679c\u5f00\u542f\u4e86\u9501\u76d1\u89c6\u5668 InnoDB Lock Monitor \uff0c\u8f93\u51fa\u4e5f\u4f1a\u5305\u62ec\u5b83\u3002 \u5982\u679c\u5f00\u542f\u4e86\u76d1\u89c6\u5668\uff0c\u6bcf\u8fc715s\uff0c\u4f1a\u5411mysqld\u670d\u52a1\u7684\u6807\u51c6\u9519\u8bef\u8f93\u51fa stderr \u3002\u5177\u4f53\u8f93\u51fa\u5230\u54ea\u91cc\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\uff1a Windows\uff1astderr\u91cd\u5b9a\u5411\u5230\u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6 Unix&Unix-like\uff1astderr\u901a\u5e38\u88ab\u5b9a\u5411\u5230\u7ec8\u7aef \u4e24\u8005\u90fd\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6539\u53d8\u3002","title":"3.2 \u83b7\u53d6 InnoDB \u884c\u9501\u4e89\u7528\u60c5\u51b5"},{"location":"mysql/27. \u9501/#33","text":"","title":"3.3 \u9501\u7684\u7c7b\u578b"},{"location":"mysql/27. \u9501/#331","text":"shared ( S ) lock \uff1a\u5141\u8bb8\u6301\u6709\u9501\u7684\u4e8b\u52a1\u8bfb\u53d6\u4e00\u884c\u3002\u5141\u8bb8\u5176\u4ed6\u4e8b\u52a1\u8bfb\u53d6\u9501\u5b9a\u5bf9\u8c61\u548c\u83b7\u53d6\u5171\u4eab\u9501\uff0c\u4f46\u662f\u4e0d\u80fd\u5199\u5165\u3002 exclusive ( X ) lock \uff1a\u5141\u8bb8\u6301\u6709\u9501\u7684\u4e8b\u52a1\u66f4\u65b0\u6216\u5220\u9664\u884c\u3002\u963b\u6b62\u4efb\u4f55\u5176\u4ed6\u7684\u4e8b\u52a1\u9501\u5b9a\u540c\u4e00\u884c\u3002 \u5982\u679c\u4e8b\u52a1 T1 \u83b7\u53d6\u4e86 r \u884c\u7684\u5171\u4eab\u9501\uff0c\u4ece\u72ec\u7acb\u7684\u4e8b\u52a1 T2 \u83b7\u53d6 r \u884c\u7684\u9501\u8bf7\u6c42\u7684\u5904\u7406\u65b9\u5f0f\u5982\u4e0b\uff1a T2 \u53d1\u51fa\u7684\u5171\u4eab\u9501\u8bf7\u6c42\u53ef\u4ee5\u7acb\u5373\u88ab\u6ee1\u8db3\u3002 T1 \u4e0e T2 \u90fd\u6301\u6709 r \u884c\u7684\u5171\u4eab\u9501\u3002 T2 \u53d1\u51fa\u7684\u6392\u5b83\u9501\u8bf7\u6c42\u4e0d\u80fd\u7acb\u5373\u6ee1\u8db3\u3002 \u5982\u679c\u4e8b\u52a1 T1 \u83b7\u53d6\u4e86 r \u884c\u7684\u6392\u5b83\u9501\uff0c\u4ece\u72ec\u7acb\u7684\u4e8b\u52a1 T2 \u83b7\u53d6 r \u884c\u7684\u9501\u8bf7\u6c42\u4e0d\u80fd\u88ab\u6ee1\u8db3\u3002\u53ea\u80fd\u7b49\u5f85 T1 \u91ca\u653e\u5728 r \u884c\u7684\u9501\u3002","title":"3.3.1 \u884c\u9501\uff1a\u5171\u4eab\u9501\u4e0e\u6392\u5b83\u9501"},{"location":"mysql/27. \u9501/#332","text":"InnoDB\u652f\u6301\u591a\u7c92\u5ea6\u9501\u5b9a\uff08 multiple granularity locking \uff09\uff0c\u5141\u8bb8\u884c\u9501\u4e0e\u8868\u9501\u5171\u5b58\u3002 \u5b83\u6307\u793a\u4e8b\u52a1\u7a0d\u540e\u5bf9\u8868\u4e2d\u7684\u884c\u6240\u9700\u7684\u9501\uff08\u5171\u4eabS\u6216\u72ec\u5360X\uff09\u7c7b\u578b\u3002For example, a statement such as LOCK TABLES ... WRITE takes an exclusive lock (an X lock) on the specified table. intention shared lock ( IS )\uff1a\u8868\u793a\u4e8b\u52a1\u6253\u7b97\u5728\u8868\u4e2d\u7684\u5404\u4e2a\u884c\u4e0a\u8bbe\u7f6e\u5171\u4eab\u9501\u3002 intention exclusive lock ( IX )\uff1a\u4e0e\u4e0a\u8ff0\u7c7b\u4f3c\u3002 For example, SELECT ... LOCK IN SHARE MODE sets an IS lock, and SELECT ... FOR UPDATE sets an IX lock. \u610f\u56fe\u9501\u5b9a\u534f\u8bae\u5982\u4e0b\uff1a \u5728\u4e8b\u52a1\u83b7\u53d6\u4e00\u884c\u7684 S \u4e4b\u524d\uff0c\u5fc5\u987b\u83b7\u53d6\u8868\u7684 IS \u9501\u6216\u66f4\u9ad8\u7b49\u7ea7\u7684\u9501\u3002 \u5728\u4e8b\u52a1\u83b7\u53d6\u4e00\u884c\u7684 X \u4e4b\u524d\uff0c\u5fc5\u987b\u83b7\u53d6\u8868\u7684 Ix \u9501\u3002 \u8868\u7ea7\u9501\u7c7b\u578b\u517c\u5bb9\u6027\uff1a \u5f53\u524d\u9501\u6a21\u5f0f\u2193 \u8bf7\u6c42\u9501\u6a21\u5f0f\u2192 X IX S IS X Conflict Conflict Conflict Conflict IX Conflict Compatible Conflict Compatible S Conflict Conflict Compatible Compatible IS Conflict Compatible Compatible Compatible \u4e8b\u52a1\u7684\u9501\u8bf7\u6c42\u5982\u679c\u548c\u5df2\u5b58\u5728\u7684\u9501\u517c\u5bb9\u5219\u4f1a\u88ab\u6ee1\u8db3\u3002 \u53ef\u901a\u8fc7\u76d1\u89c6\u5668\u8f93\u51fa\u8bed\u53e5\u67e5\u770b\uff1a SHOW ENGINE INNODB STATUS","title":"3.3.2 \u8868\u7ea7\u9501\uff1a\u610f\u5411\u9501"},{"location":"mysql/27. \u9501/#333-record-lock","text":"\u8bb0\u5f55\u9501\u662f\u4e00\u4e2a\u7d22\u5f15\u8bb0\u5f55\u4e0a\u7684\u9501\u3002\u4f8b\u5982\uff0c SELECT c1 FROM t WHERE c1 = 10 FOR UPDATE; \u963b\u6b62\u4efb\u4f55\u5176\u4ed6\u4e8b\u52a1\u5728 c1 = 10 \u884c\u7684\u63d2\u5165\u3001\u5220\u9664\u3001\u66f4\u65b0\u3002 \u5373\u4f7f\u5b9a\u4e49\u4e86\u6ca1\u6709\u7d22\u5f15\u7684\u8868\uff0c\u8bb0\u5f55\u9501\u4e5f\u59cb\u7ec8\u9501\u5b9a\u7d22\u5f15\u8bb0\u5f55\u3002","title":"3.3.3 \u8bb0\u5f55\u9501 Record Lock"},{"location":"mysql/27. \u9501/#334-gap-lock","text":"\u5728 \u7d22\u5f15\u8bb0\u5f55\u4e4b\u95f4\u7684\u95f4\u9699 \u6216 \u5728\u7b2c\u4e00\u4e2a\u4e4b\u524d\u6216\u6700\u540e\u4e00\u4e2a\u7d22\u5f15\u8bb0\u5f55\u4e4b\u540e\u7684\u95f4\u9699 \u4e0a\u7684\u9501\u3002\u4e0d\u8bba\u8bb0\u5f55\u5b58\u5728\u4e0e\u5426\u90fd\u4f1a\u963b\u6b62\u5176\u5b83\u4e8b\u52a1\u7684 \u63d2\u5165 \u64cd\u4f5c\uff0c\u56e0\u4e3a\u8be5 \u8303\u56f4 \u5185\u6240\u6709\u73b0\u6709\u503c\u4e4b\u95f4\u7684\u95f4\u9699\u662f\u9501\u5b9a\u7684\u3002 \u95f4\u9699\u53ef\u80fd\u8de8\u8d8a\u5355\u4e2a\u7d22\u5f15\u503c\uff0c\u591a\u4e2a\u7d22\u5f15\u503c\uff0c\u751a\u81f3\u53ef\u80fd\u4e3a\u7a7a\u3002","title":"3.3.4 \u95f4\u9699\u9501 Gap Lock"},{"location":"mysql/27. \u9501/#335-next-key-lock","text":"\u4e00\u4e2a next-key \u9501\u662f\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\u7684\u8bb0\u5f55\u9501\u4e0e\u5728\u6b64\u8bb0\u5f55\u4e4b\u524d\u7684\u95f4\u9699\u7684\u95f4\u9699\u9501\u7684\u7ec4\u5408\u3002 InnoDB\u6267\u884c\u884c\u7ea7\u9501\u5b9a\uff0c\u5f53\u5b83\u641c\u7d22\u6216\u626b\u63cf\u4e00\u5f20\u8868\u7684\u7d22\u5f15\u65f6\uff0c\u5728\u5b83\u547d\u4e2d\u7684\u7d22\u5f15\u8bb0\u5f55\u4e0a\u8bbe\u7f6e\u5171\u4eab\u9501\u6216\u6392\u5b83\u9501\u3002 Warning \u5728\u4f7f\u7528\u8303\u56f4\u6761\u4ef6\u68c0\u7d22\u5e76\u9501\u5b9a\u8bb0\u5f55\u65f6\uff0cInnoDB \u8fd9\u79cd\u52a0\u9501\u673a\u5236\u4f1a\u963b\u585e \u7b26\u5408\u6761\u4ef6\u8303\u56f4\u5185 \u952e\u503c\u7684\u5e76\u53d1\u63d2\u5165\uff0c \u8fd9\u5f80\u5f80\u4f1a\u9020\u6210\u4e25\u91cd\u7684\u9501\u7b49\u5f85\u3002 InnoDB \u9664\u4e86\u901a\u8fc7\u8303\u56f4\u6761\u4ef6\u52a0\u9501\u65f6\u4f7f\u7528\u95f4\u9699\u9501\u5916\uff0c\u5982\u679c\u4f7f\u7528\u76f8\u7b49\u6761\u4ef6\u8bf7\u6c42\u7ed9\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u9501\uff0cInnoDB \u4e5f\u4f1a\u4f7f\u7528\u95f4\u9699\u9501\uff01","title":"3.3.5 Next-Key Lock"},{"location":"mysql/27. \u9501/#34","text":"\u610f\u5411\u9501\u662f InnoDB \u81ea\u52a8\u52a0\u7684\uff0c \u4e0d\u9700\u7528\u6237\u5e72\u9884\u3002 \u5bf9\u4e8e UPDATE\u3001 DELETE \u548c INSERT \u8bed\u53e5\uff0c InnoDB\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u6570\u636e\u96c6\u52a0\u6392\u4ed6\u9501\uff08X)\uff1b\u5bf9\u4e8e\u666e\u901a SELECT \u8bed\u53e5\uff0cInnoDB \u4e0d\u4f1a\u52a0\u4efb\u4f55\u9501\uff1b\u4e8b\u52a1\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u663e\u793a\u7ed9\u8bb0\u5f55\u96c6\u52a0\u5171\u4eab\u9501\u6216\u6392\u4ed6\u9501\u3002 \u5171\u4eab\u9501\uff08S\uff09\uff1a SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE \u6392\u4ed6\u9501\uff08X)\uff1a SELECT * FROM table_name WHERE ... FOR UPDATE \u7528 SELECT ... IN SHARE MODE \u83b7\u5f97\u5171\u4eab\u9501\uff0c\u4e3b\u8981\u7528\u5728\u9700\u8981\u6570\u636e\u4f9d\u5b58\u5173\u7cfb\u65f6\u6765\u786e\u8ba4\u67d0\u884c\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5e76\u786e\u4fdd\u6ca1\u6709\u4eba\u5bf9\u8fd9\u4e2a\u8bb0\u5f55\u8fdb\u884c UPDATE \u6216\u8005 DELETE \u64cd\u4f5c\u3002\u4f46\u662f\u5982\u679c\u5f53\u524d\u4e8b\u52a1\u4e5f\u9700\u8981\u5bf9\u8be5\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c \u5219\u5f88\u6709\u53ef\u80fd\u9020\u6210\u6b7b\u9501\uff0c \u5bf9\u4e8e \u9501\u5b9a\u884c\u8bb0\u5f55\u540e\u9700\u8981\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u7684\u5e94\u7528 \uff0c\u5e94\u8be5\u4f7f\u7528 SELECT... FOR UPDATE \u65b9\u5f0f\u83b7\u5f97\u6392\u4ed6\u9501\u3002","title":"3.4 \u4f55\u65f6\u52a0\u9501"},{"location":"mysql/27. \u9501/#35-innodb","text":"InnoDB \u884c\u9501\u662f\u901a\u8fc7\u7ed9\u7d22\u5f15\u4e0a\u7684\u7d22\u5f15\u9879\u52a0\u9501\u6765\u5b9e\u73b0\u7684\u3002 Important \u53ea\u6709\u901a\u8fc7\u7d22\u5f15\u6761\u4ef6\u68c0\u7d22\u6570\u636e\uff0cInnoDB \u624d\u4f7f\u7528\u884c\u7ea7\u9501\uff0c\u5426\u5219\uff0cInnoDB \u5c06\u4f7f\u7528\u8868\u9501\uff01 \u867d\u7136\u662f\u8bbf\u95ee\u4e0d\u540c\u884c\u7684\u8bb0\u5f55\uff0c \u4f46\u662f\u5982\u679c\u662f\u4f7f\u7528\u76f8\u540c\u7684\u7d22\u5f15\u952e\uff08\u5373\uff0c\u4f7f\u7528\u540c\u4e00\u6761\u7d22\u5f15\u8bb0\u5f55\uff09\uff0c\u662f\u4f1a\u51fa\u73b0\u9501\u51b2\u7a81\u7684\uff08\u963b\u585e\uff09\u3002 \u5f53\u8868\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u7d22\u5f15\u9501\u5b9a\u4e0d\u540c\u7684\u884c\uff0c\u53e6\u5916\uff0c\u4e0d\u8bba\u662f\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u6216\u666e\u901a\u7d22\u5f15\uff0cInnoDB \u90fd\u4f1a\u4f7f\u7528\u884c\u9501\u6765\u5bf9\u6570\u636e\u52a0\u9501\u3002\u5373\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u7d22\u5f15\u8bbf\u95ee\u4e86\u540c\u4e00\u6761\u6570\u636e\uff0c\u4e5f\u4f1a\u9020\u6210\u963b\u585e\u3002 \u5373\u4fbf\u5728\u6761\u4ef6\u4e2d\u4f7f\u7528\u4e86\u7d22\u5f15\u5b57\u6bb5\uff0c \u4f46\u662f\u5426\u4f7f\u7528\u7d22\u5f15\u6765\u68c0\u7d22\u6570\u636e\u662f\u7531MySQL \u901a\u8fc7\u5224\u65ad\u4e0d\u540c\u6267\u884c\u8ba1\u5212\u7684\u4ee3\u4ef7\u6765\u51b3\u5b9a\u7684\u3002\u4e0d\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\u4e0bInnoDB \u5c06\u4f7f\u7528\u8868\u9501\uff0c\u800c\u4e0d\u662f\u884c\u9501\u3002","title":"3.5 InnoDB \u884c\u9501\u5b9e\u73b0\u65b9\u5f0f"},{"location":"mysql/27. \u9501/#36-innodb","text":"MySQL \u7684\u6062\u590d\u673a\u5236\uff08\u590d\u5236\u5176\u5b9e\u5c31\u662f\u5728 Slave Mysql \u4e0d\u65ad\u505a\u57fa\u4e8e BINLOG \u7684\u6062\u590d\uff09\u6709\u4ee5\u4e0b\u7279\u70b9: MySQL \u7684\u6062\u590d\u662f SQL \u8bed\u53e5\u7ea7\u7684\uff0c\u4e5f\u5c31\u662f\u91cd\u65b0\u6267\u884c BINLOG \u4e2d\u7684 SQL \u8bed\u53e5\u3002\u8fd9\u4e0eOracle \u6570\u636e\u5e93\u4e0d\u540c\uff0cOracle \u662f\u57fa\u4e8e\u6570\u636e\u5e93\u6587\u4ef6\u5757\u7684\u3002 MySQL \u7684 Binlog \u662f\u6309\u7167\u4e8b\u52a1\u63d0\u4ea4\u7684\u5148\u540e\u987a\u5e8f\u8bb0\u5f55\u7684\uff0c \u6062\u590d\u4e5f\u662f\u6309\u8fd9\u4e2a\u987a\u5e8f\u8fdb\u884c\u7684\u3002\u8fd9\u70b9\u4e5f\u4e0e Oralce \u4e0d\u540c\uff0cOracle \u662f\u6309\u7167\u7cfb\u7edf\u66f4\u65b0\u53f7\uff08System Change Number\uff0cSCN\uff09\u6765\u6062\u590d\u6570\u636e\u7684\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5f00\u59cb\u65f6\uff0cOracle \u90fd\u4f1a\u5206\u914d\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 SCN\uff0cSCN \u7684\u987a\u5e8f\u4e0e\u4e8b\u52a1 \u5f00\u59cb\u7684\u65f6\u95f4\u987a\u5e8f\u662f\u4e00\u81f4\u7684\u3002 \u4ece\u4e0a\u9762\u4e24\u70b9\u53ef\u77e5\uff0cMySQL \u7684\u6062\u590d\u673a\u5236\u8981\u6c42\uff1a\u5728\u4e00\u4e2a\u4e8b\u52a1\u672a\u63d0\u4ea4\u524d\uff0c\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u4e0d\u80fd\u63d2\u5165\u6ee1\u8db3\u5176\u9501\u5b9a\u6761\u4ef6\u7684\u4efb\u4f55\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u4e0d\u5141\u8bb8\u51fa\u73b0\u5e7b\u8bfb\uff0c\u5b9e\u9645\u4e0a\u662f\u8981\u6c42\u4e8b\u52a1\u8981\u4e32\u884c\u5316\u3002 Warning Insert into target_tab select * from source_tab where ... \u548c create table new_tab ...select ... From source_tab where ... \u65f6\u4f1a\u7ed9 source_tab \u52a0\u9501\u3002 \u8fd8\u8981\u7279\u522b\u8bf4\u660e\u7684\u662f\uff0c \u5982\u679c\u4e0a\u8ff0\u8bed\u53e5\u7684 SELECT \u662f\u8303\u56f4\u6761\u4ef6\uff0c InnoDB \u8fd8\u4f1a\u7ed9\u6e90\u8868\u52a0\u95f4\u9699\u9501 \uff08Next-Lock\uff09\u3002 INSERT...SELECT...\u548cCREATE TABLE...SELECT...\u8bed\u53e5\uff0c\u53ef\u80fd\u4f1a\u963b\u6b62\u5bf9\u6e90\u8868\u7684\u5e76\u53d1\u66f4\u65b0\uff0c \u9020\u6210\u5bf9\u6e90\u8868\u9501\u7684\u7b49\u5f85\u3002MySQL\u5c06\u8fd9\u79cdSQL\u53eb\u4f5c\u4e0d\u786e\u5b9a\uff08non-deterministic\uff09\u7684SQL\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 \u5982\u679c\u5e94\u7528\u4e2d\u4e00\u5b9a\u8981\u7528\u8fd9\u79cd SQL \u6765\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\uff0c\u53c8\u4e0d\u5e0c\u671b\u5bf9\u6e90\u8868\u7684\u5e76\u53d1\u66f4\u65b0\u4ea7\u751f\u5f71\u54cd\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u4e24\u79cd\u63aa\u65bd\uff1a \u4e00\u662f\u91c7\u53d6\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684\u505a\u6cd5\uff0c\u5c06 innodb_locks_unsafe_for_binlog \u7684\u503c\u8bbe\u7f6e\u4e3a on \uff0c\u5f3a\u5236 MySQL \u4f7f\u7528\u591a\u7248\u672c\u6570\u636e\u4e00\u81f4\u6027\u8bfb\u3002\u4f46\u4ed8\u51fa\u7684\u4ee3\u4ef7\u662f\u53ef\u80fd\u65e0\u6cd5\u7528 binlog \u6b63\u786e\u5730\u6062\u590d\u6216\u590d\u5236\u6570\u636e\uff0c\u56e0\u6b64\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002 \u4e8c\u662f\u901a\u8fc7\u4f7f\u7528 select * from source_tab ... Into outfile \u548c load data infile ... \u8bed\u53e5\u7ec4\u5408\u6765\u95f4\u63a5\u5b9e\u73b0\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f MySQL \u4e0d\u4f1a\u7ed9 source_tab \u52a0\u9501\u3002","title":"3.6 \u6062\u590d\u548c\u590d\u5236\u7684\u9700\u8981\uff0c\u5bf9 InnoDB \u9501\u673a\u5236\u7684\u5f71\u54cd"},{"location":"mysql/27. \u9501/#37","text":"","title":"3.7 \u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u4e00\u81f4\u6027\u8bfb\u53ca\u9501\u7684\u5dee\u5f02"},{"location":"mysql/27. \u9501/#38","text":"\u5bf9\u4e8e InnoDB \u8868\uff0c\u5728\u7edd\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u5e94\u8be5\u4f7f\u7528\u884c\u7ea7\u9501\uff0c\u56e0\u4e3a\u4e8b\u52a1\u548c\u884c\u9501\u5f80\u5f80\u662f\u6211\u4eec\u4e4b\u6240\u4ee5\u9009\u62e9 InnoDB \u8868\u7684\u7406\u7531\u3002\u4f46\u5728\u4e2a\u522b\u7279\u6b8a\u4e8b\u52a1\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8868\u7ea7\u9501\uff1a \u4e8b\u52a1\u9700\u8981\u66f4\u65b0\u5927\u90e8\u5206\u6216\u5168\u90e8\u6570\u636e\uff0c\u8868\u53c8\u6bd4\u8f83\u5927 \u4e8b\u52a1\u6d89\u53ca\u591a\u4e2a\u8868\uff0c\u6bd4\u8f83\u590d\u6742\uff0c\u5f88\u53ef\u80fd\u5f15\u8d77\u6b7b\u9501\uff0c\u9020\u6210\u5927\u91cf\u4e8b\u52a1\u56de\u6eda\u3002 \u5728 InnoDB \u4e0b\uff0c\u4f7f\u7528\u8868\u9501\u8981\u6ce8\u610f\u4ee5\u4e0b\u4e24\u70b9\uff1a \u4ec5\u5f53 autocommit=0 \u3001innodb_table_locks=1\uff08\u9ed8\u8ba4\u8bbe\u7f6e\uff09\u65f6\uff0cInnoDB \u5c42\u624d\u80fd\u77e5\u9053 MySQL \u52a0\u7684\u8868\u9501\u3002 \u5728\u7528 LOCK TABLES \u5bf9 InnoDB \u8868\u52a0\u9501\u65f6\u8981\u6ce8\u610f\uff0c\u8981\u5c06 AUTOCOMMIT \u8bbe\u4e3a 0\uff0c\u5426\u5219 MySQL \u4e0d\u4f1a\u7ed9\u8868\u52a0\u9501\uff1b \u4e8b\u52a1\u7ed3\u675f\u524d\uff0c \u4e0d\u8981\u7528 UNLOCK TABLES \u91ca\u653e\u8868\u9501\uff0c \u56e0\u4e3a UNLOCK TABLES \u4f1a\u9690\u542b\u5730\u63d0\u4ea4\u4e8b\u52a1 \uff1b COMMIT \u6216 ROLLBACK \u5e76\u4e0d\u80fd\u91ca\u653e\u7528 LOCK TABLES \u52a0\u7684\u8868\u7ea7\u9501\uff0c\u5fc5\u987b\u7528 UNLOCK TABLES \u91ca\u653e\u8868\u9501\u3002 -- \u4f8b\u5982\uff0c\u5982\u679c\u9700\u8981\u5199\u8868 t1 \u5e76\u4ece\u8868 t \u8bfb\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u505a\uff1a SET AUTOCOMMIT = 0 ; LOCK TABLES t1 WRITE , t2 READ , ...; [ do something with tables t1 and t2 here ]; COMMIT ; UNLOCK TABLES","title":"3.8 \u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u8868\u9501"},{"location":"mysql/27. \u9501/#39","text":"MyISAM \u603b\u662f\u4e00\u6b21\u83b7\u5f97\u6240\u9700\u7684\u5168\u90e8\u9501\uff0c\u8981\u4e48\u5168\u90e8\u6ee1\u8db3\uff0c\u8981\u4e48\u7b49\u5f85\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002 InnoDB \u4e2d\uff0c \u9664\u5355\u4e2a SQL \u7ec4\u6210\u7684\u4e8b\u52a1\u5916\uff0c\u9501\u662f\u9010\u6b65\u83b7\u5f97\u7684\uff0c\u8fd9\u5c31\u51b3\u5b9a\u4e86\u5728 InnoDB \u4e2d\u53d1\u751f\u6b7b\u9501\u662f\u53ef\u80fd\u7684\u3002 \u200b \u53d1\u751f\u6b7b\u9501\u540e\uff0cInnoDB \u4e00\u822c\u90fd\u80fd\u81ea\u52a8\u68c0\u6d4b\u5230\uff0c\u5e76\u4f7f\u4e00\u4e2a\u4e8b\u52a1\u91ca\u653e\u9501\u5e76\u56de\u9000\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u5f97\u9501\uff0c\u7ee7\u7eed\u5b8c\u6210\u4e8b\u52a1\u3002\u4f46\u5728\u6d89\u53ca\u5916\u90e8\u9501\uff0c\u6216\u6d89\u53ca\u8868\u9501\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5e76\u4e0d\u80fd\u5b8c\u5168\u81ea\u52a8\u68c0\u6d4b \u5230\u6b7b\u9501\uff0c \u8fd9\u9700\u8981\u901a\u8fc7\u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6\u53c2\u6570 innodb_lock_wait_timeout \u6765\u89e3\u51b3\u3002 \u200b \u901a\u5e38\u6765\u8bf4\uff0c\u6b7b\u9501\u90fd\u662f\u5e94\u7528\u8bbe\u8ba1\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u8c03\u6574\u4e1a\u52a1\u6d41\u7a0b\u3001\u6570\u636e\u5e93\u5bf9\u8c61\u8bbe\u8ba1\u3001\u4e8b\u52a1\u5927\u5c0f\uff0c\u4ee5\u53ca\u8bbf\u95ee\u6570\u636e\u5e93\u7684 SQL \u8bed\u53e5\uff0c\u7edd\u5927\u90e8\u5206\u6b7b\u9501\u90fd\u53ef\u4ee5\u907f\u514d\u3002 \u907f\u514d\u6b7b\u9501\u7684\u5e38\u7528\u65b9\u6cd5\uff1a \u5728\u5e94\u7528\u4e2d\uff0c\u5982\u679c\u4e0d\u540c\u7684\u7a0b\u5e8f\u4f1a\u5e76\u53d1\u5b58\u53d6\u591a\u4e2a\u8868\uff0c\u5e94\u5c3d\u91cf\u7ea6\u5b9a\u4ee5\u76f8\u540c\u7684\u987a\u5e8f\u6765\u8bbf\u95ee\u8868\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u4ea7\u751f\u6b7b\u9501\u7684\u673a\u4f1a\u3002 \u5728\u7a0b\u5e8f\u4ee5\u6279\u91cf\u65b9\u5f0f\u5904\u7406\u6570\u636e\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e8b\u5148\u5bf9\u6570\u636e\u6392\u5e8f\uff0c\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u6309\u56fa\u5b9a\u7684\u987a\u5e8f\u6765\u5904\u7406\u8bb0\u5f55\uff0c\u4e5f\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u51fa\u73b0\u6b7b\u9501\u7684\u53ef\u80fd\u3002 \u5982\u679c\u8981\u66f4\u65b0\u8bb0\u5f55\uff0c\u5e94\u8be5\u76f4\u63a5\u7533\u8bf7\u8db3\u591f\u7ea7\u522b\u7684\u9501\uff0c\u5373\u6392\u4ed6\u9501\uff0c\u800c\u4e0d\u5e94\u5148\u7533\u8bf7\u5171\u4eab\u9501\uff0c \u66f4\u65b0\u65f6\u518d\u7533\u8bf7\u6392\u4ed6\u9501\uff0c \u56e0\u4e3a\u5f53\u7528\u6237\u7533\u8bf7\u6392\u4ed6\u9501\u65f6\uff0c \u5176\u4ed6\u4e8b\u52a1\u53ef\u80fd\u53c8\u5df2\u7ecf\u83b7\u5f97\u4e86\u76f8\u540c\u8bb0\u5f55\u7684\u5171\u4eab\u9501\uff0c\u4ece\u800c\u9020\u6210\u9501\u51b2\u7a81\uff0c\u751a\u81f3\u6b7b\u9501\u3002 \u5728 REPEATABLE-READ \u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5982\u679c\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5bf9\u76f8\u540c\u6761\u4ef6\u8bb0\u5f55\u7528 SELECT...FOR UPDATE \u52a0\u6392\u4ed6\u9501\uff0c \u5728\u6ca1\u6709\u7b26\u5408\u8be5\u6761\u4ef6\u8bb0\u5f55\u60c5\u51b5\u4e0b\uff0c \u4e24\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u52a0\u9501\u6210\u529f\u3002\u7a0b\u5e8f\u53d1\u73b0\u8bb0\u5f55\u5c1a\u4e0d\u5b58\u5728\uff0c\u5c31\u8bd5\u56fe\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u5982\u679c\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u8fd9\u4e48\u505a\uff0c\u5c31\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u9694\u79bb\u7ea7\u522b\u6539\u6210 READ COMMITTED \uff0c\u5c31\u53ef\u907f\u514d\u95ee\u9898\u3002 \u5728\u7a0b\u5e8f\u8bbe\u8ba1\u4e2d\u603b\u662f\u6355\u83b7\u5e76\u5904\u7406\u6b7b\u9501\u5f02\u5e38 \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7f16\u7a0b\u4e60\u60ef\u3002 \u5982\u679c\u51fa\u73b0\u6b7b\u9501\uff0c \u53ef\u4ee5\u7528 SHOW INNODB STATUS \u547d\u4ee4\u6765\u786e\u5b9a\u6700\u540e\u4e00\u4e2a\u6b7b\u9501\u4ea7\u751f\u7684\u539f\u56e0\u3002 \u8fd4\u56de\u7ed3\u679c\u4e2d\u5305\u62ec\u6b7b\u9501\u76f8\u5173\u4e8b\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f\u3002","title":"3.9 \u6b7b\u9501"},{"location":"mysql/27. \u9501/#4","text":"\u5bf9\u4e8e MyISAM \u7684\u8868\u9501\uff1a \u5171\u4eab\u8bfb\u9501\uff08S\uff09\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u4f46\u5171\u4eab\u8bfb\u9501\uff08S\uff09\u4e0e\u6392\u4ed6\u5199\u9501\uff08X\uff09\u4e4b\u95f4\uff0c\u4ee5\u53ca\u6392\u4ed6\u5199\u9501\uff08X\uff09\u4e4b\u95f4\u662f\u4e92\u65a5\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u548c\u5199\u662f\u4e32\u884c\u7684\u3002 \u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0cMyISAM \u5141\u8bb8\u67e5\u8be2\u548c\u63d2\u5165\u5e76\u53d1\u6267\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u70b9\u6765\u89e3\u51b3\u5e94\u7528\u4e2d\u5bf9\u540c\u4e00\u8868\u67e5\u8be2\u548c\u63d2\u5165\u7684\u9501\u4e89\u7528\u95ee\u9898\u3002 MyISAM \u9ed8\u8ba4\u7684\u9501\u8c03\u5ea6\u673a\u5236\u662f\u5199\u4f18\u5148\uff0c\u8fd9\u5e76\u4e0d\u4e00\u5b9a\u9002\u5408\u6240\u6709\u5e94\u7528\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e LOW_PRIORITY_UPDATES \u53c2\u6570\uff0c \u6216\u5728 INSERT \u3001 UPDATE \u3001 DELETE \u8bed\u53e5\u4e2d\u6307\u5b9aLOW_PRIORITY \u9009\u9879\u6765\u8c03\u8282\u8bfb\u5199\u9501\u7684\u4e89\u7528\u3002 \u7531\u4e8e\u8868\u9501\u7684\u9501\u5b9a\u7c92\u5ea6\u5927\uff0c \u8bfb\u5199\u4e4b\u95f4\u53c8\u662f\u4e32\u884c\u7684\uff0c \u56e0\u6b64\uff0c \u5982\u679c\u66f4\u65b0\u64cd\u4f5c\u8f83\u591a\uff0c MyISAM \u8868\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e25\u91cd\u7684\u9501\u7b49\u5f85\uff0c\u53ef\u4ee5\u8003\u8651\u91c7\u7528 InnoDB \u8868\u6765\u51cf\u5c11\u9501\u51b2\u7a81\u3002 \u5bf9\u4e8e InnoDB \u8868\uff1a InnoDB \u7684\u884c\u9501\u662f\u57fa\u4e8e\u9501\u5f15\u5b9e\u73b0\u7684\uff0c \u5982\u679c\u4e0d\u901a\u8fc7\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c InnoDB \u4f1a\u4f7f\u7528\u8868\u9501\u3002 \u5728\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\u4e0b\uff0cInnoDB \u7684\u9501\u673a\u5236\u548c\u4e00\u81f4\u6027\u8bfb\u7b56\u7565\u4e0d\u540c\u3002 MySQL \u7684\u6062\u590d\u548c\u590d\u5236\u5bf9 InnoDB \u9501\u673a\u5236\u548c\u4e00\u81f4\u6027\u8bfb\u7b56\u7565\u4e5f\u6709\u8f83\u5927\u5f71\u54cd\u3002 \u9501\u51b2\u7a81\u751a\u81f3\u6b7b\u9501\u5f88\u96be\u5b8c\u5168\u907f\u514d\u3002 \u53ef\u4ee5\u901a\u8fc7\u8bbe\u8ba1\u548c SQL \u8c03\u6574\u7b49\u63aa\u65bd\u51cf\u5c11\u9501\u51b2\u7a81\u548c\u6b7b\u9501\uff0c\u5305\u62ec\uff1a \u5c3d\u91cf\u4f7f\u7528\u8f83\u4f4e\u7684\u9694\u79bb\u7ea7\u522b\uff1b \u7cbe\u5fc3\u8bbe\u8ba1\u7d22\u5f15\uff0c \u5e76\u5c3d\u91cf\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c \u4f7f\u52a0\u9501\u66f4\u7cbe\u786e\uff0c \u4ece\u800c\u51cf\u5c11\u9501\u51b2\u7a81\u7684\u673a\u4f1a\uff1b \u9009\u62e9\u5408\u7406\u7684\u4e8b\u52a1\u5927\u5c0f\uff0c\u5c0f\u4e8b\u52a1\u53d1\u751f\u9501\u51b2\u7a81\u7684\u51e0\u7387\u4e5f\u66f4\u5c0f\uff1b \u7ed9\u8bb0\u5f55\u96c6\u663e\u793a\u52a0\u9501\u65f6\uff0c \u6700\u597d\u4e00\u6b21\u6027\u8bf7\u6c42\u8db3\u591f\u7ea7\u522b\u7684\u9501\u3002 \u6bd4\u5982\u8981\u4fee\u6539\u6570\u636e\u7684\u8bdd\uff0c \u6700\u597d\u76f4\u63a5\u7533\u8bf7\u6392\u4ed6\u9501\uff0c\u800c\u4e0d\u662f\u5148\u7533\u8bf7\u5171\u4eab\u9501\uff0c\u4fee\u6539\u65f6\u518d\u8bf7\u6c42\u6392\u4ed6\u9501\uff0c\u8fd9\u6837\u5bb9\u6613\u4ea7\u751f\u6b7b\u9501\uff1b \u4e0d\u540c\u7684\u7a0b\u5e8f\u8bbf\u95ee\u4e00\u7ec4\u8868\u65f6\uff0c \u5e94\u5c3d\u91cf\u7ea6\u5b9a\u4ee5\u76f8\u540c\u7684\u987a\u5e8f\u8bbf\u95ee\u5404\u8868\uff0c \u5bf9\u4e00\u4e2a\u8868\u800c\u8a00\uff0c \u5c3d\u53ef\u80fd\u4ee5\u56fa\u5b9a\u7684\u987a\u5e8f\u5b58\u53d6\u8868\u4e2d\u7684\u884c\u3002\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u6b7b\u9501\u7684\u673a\u4f1a\uff1b \u5c3d\u91cf\u7528\u76f8\u7b49\u6761\u4ef6\u8bbf\u95ee\u6570\u636e\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u95f4\u9699\u9501\u5bf9\u5e76\u53d1\u63d2\u5165\u7684\u5f71\u54cd\uff1b \u4e0d\u8981\u7533\u8bf7\u8d85\u8fc7\u5b9e\u9645\u9700\u8981\u7684\u9501\u7ea7\u522b\uff1b\u9664\u975e\u5fc5\u987b\uff0c\u67e5\u8be2\u65f6\u4e0d\u8981\u663e\u793a\u52a0\u9501\uff1b \u5bf9\u4e8e\u4e00\u4e9b\u7279\u5b9a\u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u4f7f\u7528\u8868\u9501\u6765\u63d0\u9ad8\u5904\u7406\u901f\u5ea6\u6216\u51cf\u5c11\u6b7b\u9501\u7684\u53ef\u80fd\u3002","title":"4. \u5c0f\u7ed3"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/","text":"1. \u67e5\u770b MySQL Server \u53c2\u6570 2. MySQL \u5185\u5b58\u7ba1\u7406\u53ca\u4f18\u5316 2.1 \u5185\u5b58\u4f18\u5316\u539f\u5219 2.2 MyISAM \u5185\u5b58\u4f18\u5316 2.2.1 \u8bbe\u7f6e key_buffer_size 2.2.2 \u4f7f\u7528\u591a\u4e2a\u7d22\u5f15\u7f13\u5b58 2.2.3 \u8c03\u6574\u201c\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u201d 2.2.4 table_cache 2.3 InnoDB \u5185\u5b58\u4f18\u5316 2.3.1 \u7f13\u5b58\u673a\u5236 2.3.1.1 Buffer Pool LRU Algorithm 2.3.2 innodb_buffer_pool_instances \u4e0e innodb_buffer_pool_size 2.3.3 \u8c03\u6574 old sublist \u5927\u5c0f 2.3.4 \u8c03\u6574innodb_old_blocks_time\u7684\u5927\u5c0f 2.3.5 \u63a7\u5236innodb_buffer\u5237\u65b0\uff0c\u5ef6\u957f\u6570\u636e\u7f13\u51b2\u65f6\u95f4\uff0c\u51cf\u7f13\u78c1\u76d8I/O 2.3.6 \u8c03\u6574\u7528\u6237\u670d\u52a1\u7ebf\u7a0b\u6392\u5e8f\u7f13\u5b58\u533a 2.4 InnoDB \u673a\u5236\u53ca\u4f18\u5316 2.4.1 InnoDB \u91cd\u505a\u65e5\u5fd7 2.4.2 innodb_flush_log_at_trx_commit 2.4.3 innodb_log_buffer_size 2.4.4 innodb_log_file_size 2.5 MySQL \u5e76\u53d1\u76f8\u5173\u53c2\u6570 2.5.1 max_connections 2.5.2 back_log 2.5.3 table_open_cache 2.5.4 thread_cache_size 2.5.5 innodb_additional_mem_pool_size 2.5.6 innodb_lock_wait_timeout 2.5.7 innodb_support_xa \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL\u67097\u7ec4\u7ebf\u7a0b\uff081\u4e2a\u4e3b\u7ebf\u7a0b\u30014\u7ec4IO\u7ebf\u7a0b\u30011\u4e2a\u9501\u7ebf\u7a0b\u30011\u4e2a\u9519\u8bef\u76d1\u63a7\u7ebf\u7a0b\uff09\uff0c5.5\u4e4b\u540e\u65b0\u589e\u4e00\u4e2apurge\u7ebf\u7a0b\uff1a master thread\uff1a\u4e3b\u8981\u8d1f\u8d23\u5c06\u810f\u9875\u7f13\u5b58\u5237\u65b0\u5230\u6570\u636e\u6587\u4ef6\uff0c\u6267\u884cpurge\u64cd\u4f5c\uff0c\u89e6\u53d1\u68c0\u67e5\u70b9\uff0c\u5408\u5e76\u63d2\u5165\u7f13\u51b2\u533a\u7b49 insert buffer thread\uff1a\u6ce8\u610f\u8d1f\u8d23\u63d2\u5165\u7f13\u51b2\u533a\u7684\u5408\u5e76\u64cd\u4f5c read thread\uff1a\u8d1f\u8d23\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u64cd\u4f5c\uff0c\u53ef\u914d\u7f6e\u591a\u4e2a\u8bfb\u7ebf\u7a0b write thread\uff1a\u8d1f\u8d23\u6570\u636e\u5e93\u7684\u5199\u64cd\u4f5c\uff0c\u53ef\u914d\u7f6e\u591a\u4e2a log thread\uff1a\u7528\u4e8e\u5c06\u91cd\u505a\u65e5\u5fd7\u5237\u65b0\u5230logfile\u4e2d purge thread\uff1aMySQL5.5 \u4e4b\u540e\u7528\u5355\u72ec\u7684\u989dpurge thread\u6267\u884cpurge\u64cd\u4f5c lock thread\uff1a\u8d1f\u8d23\u9501\u63a7\u5236\u548c\u6b7b\u9501\u68c0\u6d4b\u7b49 \u9519\u8bef\u76d1\u63a7\u7ebf\u7a0b\uff1a\u8d1f\u8d23\u9519\u8bef\u76d1\u63a7\u548c\u9519\u8bef\u5904\u7406 \u901a\u8fc7 show engine innodb status \u67e5\u770b\u8fd9\u4e9b\u7ebf\u7a0b\u7684\u72b6\u6001\u3002 \u548c\u5927\u591a\u6570\u6570\u636e\u5e93\u4e00\u6837\uff0cMySQL \u4e5f\u63d0\u4f9b\u4e86\u5f88\u591a\u53c2\u6570\u6765\u8fdb\u884c\u670d\u52a1\u5668\u7684\u8bbe\u7f6e\u3002 1. \u67e5\u770b MySQL Server \u53c2\u6570 \u00b6 \u7528 SHOW VARIABLES \u548c SHOW STATUS \u547d\u4ee4\u67e5\u770b MySQL \u7684\u670d\u52a1\u5668\u9759\u6001\u53c2\u6570\u503c\u548c\u52a8\u6001\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u3002 \u5176\u4e2d\u524d\u8005\u662f\u5728\u6570\u636e\u5e93\u542f\u52a8\u540e \u4e0d\u4f1a\u52a8\u6001\u66f4\u6539 \u7684\u503c\uff0c \u6bd4\u5982\u7f13\u51b2\u533a\u5927\u5c0f\u3001 \u5b57\u7b26\u96c6\u3001 \u6570\u636e\u6587\u4ef6\u540d\u79f0\u7b49\uff1b \u540e\u8005\u662f\u6570\u636e\u5e93\u8fd0\u884c\u671f\u95f4\u7684 \u52a8\u6001\u53d8\u5316 \u7684\u4fe1\u606f\uff0c \u6bd4\u5982\u9501\u7b49\u5f85\u3001\u5f53\u524d\u8fde\u63a5\u6570\u7b49\u3002 \u4e5f\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u76f4\u63a5\u67e5\u770b\u6570\u636e\u5e93\u53c2\u6570\u6216\u6570\u636e\u5e93\u72b6\u6001\u4fe1\u606f: # \u5c55\u793a\u5168\u90e8\u4fe1\u606f $ mysqladmin -uroot -p variables # \u5c55\u793a\u7edf\u8ba1\u4fe1\u606f $ mysqladmin -uroot -p status Uptime: 404366 Threads: 2 Questions: 44 Slow queries: 0 Opens: 9 Flush tables: 2 Open tables: 35 Queries per second avg: 0 .000 \u5982\u679c\u9700\u8981\u4e86\u89e3\u67d0\u4e2a\u53c2\u6570\u7684\u8be6\u7ec6\u5b9a\u4e49\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff08MariaDB\u6ca1\u6709\u8be5\u547d\u4ee4\uff09\uff1a mysqld --verbose --help | more 2. MySQL \u5185\u5b58\u7ba1\u7406\u53ca\u4f18\u5316 \u00b6 InnoDB \u542f\u52a8\u9009\u9879\u548c\u7cfb\u7edf\u53d8\u91cf 2.1 \u5185\u5b58\u4f18\u5316\u539f\u5219 \u00b6 \u5c06 \u5c3d\u91cf\u591a \u7684\u5185\u5b58\u5206\u914d\u7ed9MySQL\u505a\u7f13\u5b58\uff0c\u4f46\u8981\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u548c\u5176\u4ed6\u7a0b\u5e8f\u7684\u8fd0\u884c\u9884\u7559\u8db3\u591f\u7684\u5185\u5b58\uff0c\u5426\u5219\u5982\u679c\u4ea7\u751fSWAO\u9875\u4ea4\u6362\uff0c\u5c06\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002 MyISAM\u7684\u6570\u636e\u6587\u4ef6\u8bfb\u53d6\u4f9d\u8d56\u4e8e \u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab \u7684IO\u7f13\u5b58\uff0c\u56e0\u6b64\u5bf9\u4e8eMyISAM\u6765\u8bf4\u5e94\u9884\u7559\u66f4\u591a\u7684\u5185\u5b58\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u505aIO\u7f13\u5b58\u3002 \u6392\u5e8f\u533a\u3001\u8fde\u63a5\u533a\u7b49\u7f13\u5b58\u662f\u5206\u914d\u7ed9\u6bcf\u4e2a\u6570\u636e\u5e93\u4f1a\u8bdd\uff08session\uff09\u4e13\u7528\u7684\uff0c\u5176\u9ed8\u8ba4\u503c\u7684\u8bbe\u7f6e\u8981\u6839\u636e\u6700\u5927\u8fde\u63a5\u6811\u5408\u7406\u5206\u914d\uff0c\u5982\u679c\u8bbe\u7f6e\u592a\u5927\uff0c\u4e0d\u4f46\u6d6a\u8d39\u5185\u5b58\u8d44\u6e90\uff0c\u800c\u4e14\u5728\u5e76\u53d1\u8fde\u63a5\u8f83\u9ad8\u65f6\u4f1a\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u8017\u5c3d\u3002 2.2 MyISAM \u5185\u5b58\u4f18\u5316 \u00b6 2.2.1 \u8bbe\u7f6e key_buffer_size \u00b6 \u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6765\u8bbe\u7f6e\u7d22\u5f15\u5757\uff08Index Blocks\uff09\u7f13\u5b58\u7684\u5927\u5c0f\uff0c\u5b83\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u3002 \u5bf9\u4e8e\u6570\u636e\u5757\uff0c\u5b8c\u5168\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684IO\u7f13\u5b58\u3002 \u5bf9\u4e8e\u4e00\u822c\u7684MyISAM\u6570\u636e\u5e93\uff0c\u5efa\u8bae\u81f3\u5c11 key_buffer_size \u8bbe\u7f6e\u4e3a1/4\u7684\u5185\u5b58\u3002 \u53ef\u901a\u8fc7\u5168\u5c40\u53d8\u91cf\u67e5\u8be2\uff1a SHOW GLOBAL variables LIKE '%KEY%'; \u3002 \u53ef\u4ee5\u68c0\u67e5MySQL\u7684 Key_read_requests\u3001Key_reads\u3001Key_write_requests\u3001Key_writes \u72b6\u6001\u53d8\u91cf\u6765\u8bc4\u4f30\u7d22\u5f15\u7f13\u5b58\u6548\u7387\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7d22\u5f15\u5757\u7269\u7406\u8bfb\u6bd4\u7387 Key_reads/Key_read_requests \u5e94\u5c0f\u4e8e0.01\uff1b\u7d22\u5f15\u5757\u7269\u7406\u8bfb\u6bd4\u7387 Key_writes/Key_write_requests \u4e5f\u5e94\u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u4f46\u8fd9\u4e0e\u5e94\u7528\u7279\u70b9\u6709\u5173\uff0c\u5bf9\u4e8e\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u7279\u522b\u591a\u7684\u5e94\u7528\uff0c\u8be5\u503c\u53ef\u80fd\u4f1a\u63a5\u8fd11\u3002 \u9664\u4e86\u4f7f\u7528\u8bfb\u5199\u6bd4\u7387\u8861\u91cf\u6548\u7387\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bc4\u4f30 key buffer \u7684\u4f7f\u7528\u7387\uff1a 1 - (( key_blocks_unused * key_cache_block_size ) / key_buffer_size ) \u4e00\u822c\u6765\u8bf4\uff0c\u4f7f\u7528\u7387\u5927\u6982\u572880%\u6bd4\u8f83\u5408\u9002\u3002\u5927\u4e8e80%\uff0c\u53ef\u80fd\u56e0\u7d22\u5f15\u7f13\u5b58\u4e0d\u8db3\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff1b\u5c0f\u4e8e80%\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\u3002 2.2.2 \u4f7f\u7528\u591a\u4e2a\u7d22\u5f15\u7f13\u5b58 \u00b6 \u5404\u4e2asession\u662f\u5171\u4eabkey buffer\u7684\uff0c\u63d0\u9ad8\u4e86\u7d22\u5f15\u5b58\u53d6\u7684\u6027\u80fd\uff0c\u5374\u5bfc\u81f4\u4e86session\u5bf9key buffer\u7684\u7ade\u4e89\u3002MySQL\u63d0\u4f9b\u4e86\u591a\u7d22\u5f15\u7f13\u5b58\u673a\u5236\uff0c\u53ef\u4ee5\u5c06\u4e0d\u540c\u8868\u7684\u7d22\u5f15\u7f13\u5b58\u5230\u4e0d\u540c\u7684buffer\u4e2d\u3002 \u52a8\u6001\u65b0\u5efa\u4e00\u4e2a\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > SET GLOBAL cache_test . key_buffer_size = 512 * 1024 ; GLOBAL \u8868\u793a\u5bf9\u6bcf\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\uff0c \u6b64\u53c2\u6570\u90fd\u5c06\u751f\u6548\u3002 cache_test \u662f\u65b0\u7684 key_buffer \u540d\u79f0\u3002 \u5982\u679c\u9700\u8981\u66f4\u6539\u53c2\u6570\u503c\uff0c\u53ef\u4ee5\u968f\u65f6\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8fdb\u884c\u91cd\u5efa\u3002\u503c\u4e3a0\u65f6\uff0c\u8868\u793a\u5220\u9664\u6b64buffer\u3002 \u52a8\u6001\u6307\u5b9a\u8868\u7684\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > CACHE INDEX sub_par_test IN cache_test ; \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5728MySQL\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa\u5e76\u52a0\u8f7d\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > [ root @ dataBase ~ ] # cat /etc/my.cnf \u2026 key_buffer_size = 4 G hot_cache . key_buffer_size = 2 G cold_cache . key_buffer_size = 2 G init_file =/ path / to / data - directory / mysqld_init . sql \u2026 -- \u901a\u8fc7CACHE INDEX\u5206\u914d\u7d22\u5f15\u7f13\u5b58 -- \u901a\u8fc7LOAD INDEX INTO CACHE\u8fdb\u884c\u7d22\u5f15\u9884\u52a0\u8f7d\uff0c\u9884\u5148\u52a0\u8f7d\u8868\u7684\u7d22\u5f15\u7f13\u5b58\u5230\u7f13\u5b58\u533a\uff08\u4e00\u822c\u5bf9\u8868\u64cd\u4f5c\u540e\u624d\u4f1a\u5efa\u7acb\u7f13\u5b58\uff09\u3002 [ root @ dataBase ~ ] # cat mysqld_init.sql CACHE INDEX a . t1 , a . t2 , b . t3 IN hot_cache ; CACHE INDEX a . t4 , b . t5 , b . t6 IN cold_cache ; LOAD INDEX INTO CACHE a , b ; \u5220\u9664\u7d22\u5f15\u7f13\u5b58: MariaDB [ MYISAM_TEST ] > SET GLOBAL cache_test . key_buffer_size = 0 ; \u6ce8\u610f\uff1a\u4e0d\u80fd\u5220\u9664\u9ed8\u8ba4 key_buffer\u3002 2.2.3 \u8c03\u6574\u201c\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u201d \u00b6 MySQL\u9ed8\u8ba4\u4f7f\u7528LRU\uff08least recently used\uff09\u7b56\u7565\u9009\u62e9\u8981\u6dd8\u6c70\u7684\u7d22\u5f15\u6570\u636e\u5757\u3002\u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u56de\u5bfc\u81f4\u771f\u6b63\u7684\u70ed\u5757\u88ab\u6dd8\u6c70\u3002 \u53ef\u4ee5\u4f7f\u7528 \u4e2d\u70b9\u63d2\u5165\u7b56\u7565 \uff08Midpoint Insertion Strategy\uff09\u6765\u4f18\u5316\u3002 \u300a\u6df1\u5165\u6d45\u51faMySQL\u7b2c\u4e8c\u7248\u300b21.2.2MyISAM\u5185\u5b58\u4f18\u5316 \u7ae0\u8282\u6709\u7b80\u5355\u8bf4\u660e\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u8282 key_cache_division_limit \u6765\u63a7\u5236\u591a\u5927\u6bd4\u4f8b\u7684\u7f13\u5b58\u7528\u4f5cwarm\u5b50\u8868\uff0c\u9ed8\u8ba4\u503c\u662f100\uff0c\u5373\u5168\u90e8\u7684\u7f13\u5b58\u5757\u90fd\u653e\u5728warm\u5b50\u8868\uff0c\u4e0d\u542f\u7528\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u3002 \u4e3e\u4f8b\uff1a\u5c0630%\u7684\u7f13\u5b58\u7528\u4e8ecache\u6700\u70ed\u7684\u7d22\u5f15\u5757\uff0c\u53ef\u4ee5\u8fd9\u6837\u8bbe\u7f6e\uff1a MariaDB [ MYISAM_TEST ] > SET GLOBAL key_cache_division_limit = 70 ; MariaDB [ MYISAM_TEST ] > SET GLOBAL hot_cache . key_cache_division_limit = 70 ; \u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 key_cache_age_threshold \u63a7\u5236\u6570\u636e\u5757\u7531hot\u5b50\u8868\u5411warm\u5b50\u8868\u964d\u7ea7\u7684\u65f6\u95f4\uff0c\u503c\u8d8a\u5c0f\uff0c\u964d\u7ea7\u8d8a\u5feb\u3002\u5bf9\u4e8e\u6709 N \u4e2a\u5757\u7684\u7d22\u5f15\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u5728hot\u5b50\u8868\u5934\u90e8\u7684\u7d22\u5f15\u5757\uff0c\u5728\u6700\u540e\u7684 N * key_cache_age_threshold / 100 \u6b21\u7f13\u5b58\u547d\u4e2d\u5185\u672a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u5c31\u4f1a\u88ab\u964d\u7ea7\u3002 2.2.4 table_cache \u00b6 MySQL\u624b\u518c\u4e2d\u5df2\u7ecf\u6ca1\u6709\u8fd9\u4e2a\u53d8\u91cf\u4e86\uff0c\u540c\u4e49\u53d8\u91cf\uff1a table_open_cache \u3002 \u8fd9\u4e2a\u53c2\u6570\u8868\u793a\u6570\u636e\u5e93\u7528\u6237\u6253\u5f00\u8868\u7684\u7f13\u5b58\u6570\u91cf\u3002 \u6bcf\u4e2a\u8fde\u63a5\u8fdb\u6765\uff0c \u90fd\u4f1a\u81f3\u5c11\u6253\u5f00\u4e00\u4e2a\u8868\u7f13\u5b58\u3002 \u56e0\u6b64\uff0c table_cache \u4e0e max_connections \u6709\u5173 \u3002\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u4e3a\u4e34\u65f6\u8868\u548c\u6587\u4ef6\u4fdd\u7559\u4e00\u4e9b\u989d\u5916\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep table_cache = --table_cache = # The number of open tables for all threads. \u53ef\u4ee5\u901a\u8fc7\u68c0\u67e5 mysqld \u7684\u72b6\u6001\u53d8\u91cf open_tables (\u5f53\u524d\u6253\u5f00\u7684\u8868\u7f13\u5b58\u6570)\u548c opened_tables \u786e\u5b9a\u8fd9\u4e2a\u53c2\u6570\u662f\u5426\u8fc7\u5c0f\uff0c\u5982\u679c\u6267\u884c FLUSH TABLES \u64cd\u4f5c\uff0c\u5219\u6b64\u7cfb\u7edf\u4f1a\u5173\u95ed\u4e00\u4e9b\u5f53\u524d\u6ca1\u6709\u4f7f\u7528\u7684\u8868\u7f13\u5b58\u800c\u4f7f\u5f97\u6b64\u72b6\u6001\u503c\u51cf\u5c0f\u3002 -- \u6e05\u7a7a\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > FLUSH TABLES ; -- \u67e5\u770b\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE 'Open%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Open_tables | 0 | | Opened_tables | 13 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 +--------------------------+-------+ -- \u6253\u5f00\u4e00\u5f20\u8868 MariaDB [ MYISAM_TEST ] > SELECT * FROM CHILD ; -- \u67e5\u770b\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE 'Open%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Open_tables | 1 | | Opened_tables | 14 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 +--------------------------+-------+ \u518d\u6b21\u6267\u884c\u521a\u624d\u5bf9\u8868 t \u7684\u67e5\u8be2\u65f6\uff0c\u4e24\u4e2a\u503c\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u4e3a\u5df2\u7ecf\u5bf9\u8fd9\u5f20\u8868\u8fdb\u884c\u4e86\u7f13\u5b58\u3002\u72b6\u6001\u503c open_tables \u5bf9\u4e8e\u8bbe\u7f6e table_cache \u503c\u6709\u7740\u66f4\u6709\u4ef7\u503c\u7684\u53c2\u8003\u3002 2.3 InnoDB \u5185\u5b58\u4f18\u5316 \u00b6 2.3.1 \u7f13\u5b58\u673a\u5236 \u00b6 InnoDB\u7528\u4e00\u5757 \u5185\u5b58 \u505aIO\u7f13\u5b58\u6c60\uff0c \u540c\u65f6\u7f13\u5b58\u7d22\u5f15\u5757\u548c\u6570\u636e\u5757 \u3002 \u7f13\u5b58\u6c60\u903b\u8f91\u4e0a\u7531\u51e0\u4e2a\u5217\u8868\u7ec4\u6210\uff1a free list\uff1a\u7a7a\u95f2\u7684\u7f13\u5b58\u5757\u5217\u8868\u3002\u4eceLRU list\u6dd8\u6c70\u7684\u6570\u636e\u9875\u4f1a\u88ab\u653e\u5728\u8fd9\u91cc\u3002 flush list\uff1a\u9700\u8981\u5237\u65b0\u5230\u78c1\u76d8\u7684\u7f13\u5b58\u5757\u5217\u8868\u3002 LRU list\uff1a\u6b63\u5728\u4f7f\u7528\u7684\u7f13\u5b58\u5757\uff0c\u662fInnoDB buffer pool\u7684\u6838\u5fc3\u3002 2.3.1.1 Buffer Pool LRU Algorithm \u00b6 InnoDB\u7684\u4e2d\u70b9\u63d2\u5165\u7b56\u7565 \u3002 \u300a\u6df1\u5165\u6d45\u51faMySQL\u7b2c\u4e8c\u7248\u300b21.2.3InnoDB\u5185\u5b58\u4f18\u5316 \u7ae0\u8282\u6709\u7b80\u5355\u8bf4\u660e\u3002 \u4f7f\u7528LRU\u7b97\u6cd5\u7684\u53d8\u4f53\uff0c\u4f7f\u7528\u7684\u6570\u636e\u5f88\u5c11\u5728\u7f13\u5b58\u4e2d\u8001\u5316\u3002 \u5f53\u9700\u8981\u5411\u7f13\u5b58\u6c60\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u9875\uff08page\uff09\u7684\u7a7a\u95f4\u65f6\uff0c\u6700\u5c11\u88ab\u4f7f\u7528\u7684\u9875\u88ab\u9a71\u9010\uff0c\u65b0\u9875\u6dfb\u52a0\u5230\u94fe\u8868\u7684\u4e2d\u90e8\u3002\u8fd9\u4e2a\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u5c06\u94fe\u8868\u5212\u5206\u4e3a\u4e24\u4e2a\u5b50\u94fe\u8868\uff1a \u5934\u90e8\u662f\u8bbf\u95ee\u65b0\u9875\u7684\u5b50\u94fe\u8868\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574InnoDB buffer pool\u7684\u5927\u5c0f\u3001\u6539\u53d8young sublist\u548cold sublist\u7684\u5206\u914d\u6bd4\u4f8b\u3001\u63a7\u5236\u810f\u7f13\u5b58\u7684\u5237\u65b0\u6d3b\u52a8\u3001\u4f7f\u7528\u591a\u4e2aInnoDB\u7f13\u5b58\u6c60\u7b49\u65b9\u6cd5\u4f18\u5316InnoDB\u7684\u6027\u80fd\u3002 2.3.2 innodb_buffer_pool_instances \u4e0e innodb_buffer_pool_size \u00b6 innodb_buffer_pool_size \u5b9a\u4e49\u4e86 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u6570\u636e\u548c\u7d22\u5f15\u6570\u636e\u7684\u6700\u5927\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\uff08\u4ee5 byte \u4e3a\u5355\u4f4d\uff0c\u9ed8\u8ba4\u662f128MB\uff09\u3002\u8fd9\u4e2a\u503c\u8bbe\u5f97\u8d8a\u9ad8\uff0c\u8bbf\u95ee\u8868\u4e2d\u6570\u636e\u9700\u8981\u7684\u78c1\u76d8 I/O \u5c31\u8d8a\u5c11\u3002\u5728\u4e13\u7528\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\u8bfe\u5206\u914d80%\u7684\u7269\u7406\u5185\u5b58\u7ed9\u8be5\u503c\uff0c\u4f46\u8981\u6ce8\u610f\u907f\u514d\u8bbe\u7f6e\u8fc7\u5927\u5bfc\u81f4\u9875\u4ea4\u6362\u3002 innodb_buffer_pool_instances \u662fInnoDB\u7f13\u51b2\u6c60\u5206\u533a\u7684\u6570\u91cf\u3002\u5bf9\u5177\u6709GB\u8303\u56f4\u7f13\u51b2\u6c60\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u5c06\u7f13\u51b2\u6c60\u5212\u5206\u4e3a\u51e0\u4e2a\u72ec\u7acb\u7684\u5b9e\u4f8b\u53ef\u4ee5\u63d0\u9ad8\u6548\u7387\uff0c\u901a\u8fc7\u51cf\u5c11\u56e0\u4e3a\u4e0d\u540c\u7684\u7ebf\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u7f13\u5b58\u7684\u9875\u9762\u7684\u4e89\u7528\u3002\u8981\u548c innodb_buffer_pool_size \uff08\u81f3\u5c11\u662f1GB\uff09\u914d\u5408\u4f7f\u7528\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_buffer_pool_size\" -A 2 --innodb_buffer_pool_size = # The size of the memory buffer InnoDB uses to cache data and indexes of its tables. MariaDB [ MYISAM_TEST ] > SHOW VARIABLES LIKE '%innodb_buffer%' ; +---------------------------------------+-----------+ | Variable_name | Value | +---------------------------------------+-----------+ | innodb_buffer_pool_instances | 1 | | innodb_buffer_pool_populate | OFF | | innodb_buffer_pool_restore_at_startup | 0 | | innodb_buffer_pool_shm_checksum | ON | | innodb_buffer_pool_shm_key | 0 | | innodb_buffer_pool_size | 134217728 | +---------------------------------------+-----------+ innodb_buffer_pool_size \u662f\u53ea\u8bfb\u53d8\u91cf\uff0c\u53ef\u4ee5\u5728 /etc/my.conf \u4e2d\u7684 [mysqld] \u4e0b\u5199\u5165 innodb_buffer_pool_size = 2GB \u7136\u540e\u91cd\u542f\u6570\u636e\u5e93\u3002 \u67e5\u770b\u7f13\u5b58\u6c60\u7684\u547d\u4e2d\u7387\uff1a [ root@dataBase ~ ] # mysqladmin -uroot -pabcd1234 -S /var/lib/mysql/mysql.sock ext | grep -i innodb_buffer_pool | Innodb_buffer_pool_bytes_data | 6946816 | | Innodb_buffer_pool_bytes_dirty | 0 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Innodb_buffer_pool_read_requests | 7676 | | Innodb_buffer_pool_reads | 425 | | Innodb_buffer_pool_wait_free | 0 | | Innodb_buffer_pool_write_requests | 0 | \u8ba1\u7b97\u516c\u5f0f\uff1a 1 - Innodb_buffer_pool_reads/Innodb_buffer_pool_read_requests * 100% \u547d\u4e2d\u7387\u592a\u4f4e\u65f6\u53ef\u8003\u8651\u589e\u52a0\u8be5\u503c\u3002 2.3.3 \u8c03\u6574 old sublist \u5927\u5c0f \u00b6 \u5728LRU list\u4e2d\uff0cold sublist\u7684\u6bd4\u4f8b\u7531\u7cfb\u7edf\u53c2\u6570 innodb_old_blocks_pct \u51b3\u5b9a\uff085~37\uff0c\u9ed8\u8ba4\u662f37\uff09\u3002\u67e5\u770b\u5f53\u524d\u8bbe\u7f6e\uff1a MariaDB [ MYISAM_TEST ] > SHOW GLOBAL VARIABLES LIKE '%innodb_old_blocks%' ; +------------------------+-------+ | Variable_name | Value | +------------------------+-------+ | innodb_old_blocks_pct | 37 | | innodb_old_blocks_time | 0 | +------------------------+-------+ innodb_old_blocks_time \u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\u53ef\u9632\u6b62\u7f13\u51b2\u6c60\u88ab\u4ec5\u5728\u77ed\u65f6\u95f4\u5185\u5f15\u7528\u7684\u6570\u636e\u586b\u5145\uff0c\u4f8b\u5982\u5728\u5168\u8868\u626b\u63cf\u671f\u95f4\u3002\u589e\u52a0\u6b64\u503c\u53ef\u63d0\u4f9b\u66f4\u591a\u4fdd\u62a4\uff0c\u9632\u6b62\u5168\u8868\u626b\u63cf\u5e72\u6270\u7f13\u51b2\u6c60\u4e2d\u7f13\u5b58\u7684\u6570\u636e\u3002 \u53ef\u4ee5\u6839\u636e \u76d1\u89c6\u5668 \u8f93\u51fa\u7684\u4fe1\u606f\u8c03\u6574 innodb_old_blocks_pct \u7684\u5927\u5c0f\u3002 2.3.4 \u8c03\u6574innodb_old_blocks_time\u7684\u5927\u5c0f \u00b6 innodb_old_blocks_time \u51b3\u5b9a\u4e86\u7f13\u5b58\u6570\u636e\u5757\u7531 old sublist \u8f6c\u79fb\u5230 young sublist \u7684\u5feb\u6162\uff08\u53ef\u4ee5\u52a8\u6001\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u5bf9\u5927\u7684\u8868\u626b\u63cf\u505a\u4e34\u65f6\u8c03\u6574\uff09\u3002\u5f53\u4e00\u4e2a\u7f13\u5b58\u6570\u636e\u5757\u88ab\u63d2\u5165\u5230midpoint\uff08old sublist\uff09\u540e\uff0c\u81f3\u5c11\u5728\u5176\u4e2d\u505c\u7559 innodb_old_blocks_time \u6beb\u79d2\u7684\u65f6\u957f\u624d\u53ef\u80fd\u4f1a\u88ab\u8f6c\u79fb\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u7684\u907f\u514d\u8868\u626b\u63cf\u6c61\u67d3 buffer pool \u7684\u60c5\u51b5\u3002 \u4ee5\u4e0b\u4e24\u4e2a\u7edf\u8ba1\u53d8\u91cf\uff08\u53ef\u4ee5\u901a\u8fc7\u76d1\u89c6\u5668\u6765\u67e5\u770b\uff09\u53ef\u4ee5\u53cd\u5e94\u6570\u636e\u5757\u88ab\u8f6c\u79fb\u7684\u60c5\u51b5\uff1a \u540d\u79f0 \u63cf\u8ff0 youngs/s The per second average of accesses to old pages in the buffer pool LRU list that have resulted in making pages young. non-youngs/s The per second average of accesses to old pages in the buffer pool LRU list that have resulted in not making pages young. \u5982\u679c youngs/s \u5f88\u9ad8\uff0c non-young/s \u5f88\u4f4e\uff0c\u90a3\u4e48\u5e94\u8be5\u8003\u8651\u52a0\u5927 innodb_old_blocks_time \u3002 2.3.5 \u63a7\u5236innodb_buffer\u5237\u65b0\uff0c\u5ef6\u957f\u6570\u636e\u7f13\u51b2\u65f6\u95f4\uff0c\u51cf\u7f13\u78c1\u76d8I/O \u00b6 \u5728InnoDB\u627e\u4e0d\u5230\u5e72\u51c0\u7684\u53ef\u7528\u7f13\u5b58\u9875\u6216\u68c0\u67e5\u70b9\u88ab\u89e6\u53d1\u7b49\u60c5\u51b5\u4e0b\uff0cInnoDB\u7684\u540e\u53f0\u7ebf\u7a0b\u4f1a\u5f00\u59cb\u628a\u201c\u810f\u7684\u7f13\u5b58\u9875\u201d\u56de\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb \u7f13\u5b58\u5237\u65b0 \u3002 InnoDB buffer pool \u7684\u5237\u65b0\u5feb\u6162\u4e3b\u8981\u53d6\u51b3\u4e8e\u4e24\u4e2a\u53c2\u6570\uff1a innodb_max_dirty_pages_pct \uff1a\u7f13\u5b58\u6c60\u4e2d\u810f\u9875\u7684\u6700\u5927\u6bd4\u4f8b\u3002\u82e5\u810f\u9875\u7684\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e\u8be5\u503c\uff0cInnoDB\u7684\u540e\u53f0\u7ebf\u7a0b\u5c06\u5f00\u59cb\u5237\u65b0\u7f13\u5b58\u3002 innodb_io_capacity \uff1a\u78c1\u76d8\u7cfb\u7edf\u7684IO\u80fd\u529b\u3002\u5bf9\u4e8e\u8f6c\u901f\u8f83\u4f4e\u7684\u78c1\u76d8\uff0c\u59827200RPM\u7684\u78c1\u76d8\uff0c\u53ef\u964d\u4f4e\u81f3100\uff1b\u82e5\u662f\u56fa\u6001\u6216\u78c1\u76d8\u9635\u5217\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u5927\u3002 innodb_io_capacity \u51b3\u5b9a\u4e00\u6279\u5237\u65b0\u810f\u9875\u7684\u6570\u91cf\uff0c\u5f53\u7f13\u5b58\u9875\u6bd4\u4f8b\u8fbe\u5230 innodb_max_dirty_pages_pct \u65f6\uff0cInnoDB\u5c06\u5927\u7ea6 innodb_io_capacity \u4e2a\u5df2\u6539\u53d8\u7684\u7f13\u5b58\u9875\u5237\u65b0\u5230\u78c1\u76d8\u3002\u5f53\u810f\u9875\u6bd4\u4f8b\u5c0f\u4e8e innodb_max_dirty_pages_pct \u65f6\uff0c\u82e5 innodb_adaptive_flushing=true \uff0cInnoDB\u8bb2\u6839\u636e\u51fd\u6570 buf_flush_get_desired_flush_rate \u8fd4\u56de\u7684\u91cd\u505a\u65e5\u5fd7\u4ea7\u751f\u901f\u5ea6\u6765\u786e\u5b9a\u8981\u5237\u65b0\u7684\u810f\u9875\u6570\u3002\u5728\u5408\u5e76\u63d2\u5165\u7f13\u5b58\u65f6\uff0cInnoDB\u6bcf\u6b21\u5408\u5e76\u7684\u9875\u6570\u662f 0.05 * innodb_io_capacity \u3002 2.3.6 \u8c03\u6574\u7528\u6237\u670d\u52a1\u7ebf\u7a0b\u6392\u5e8f\u7f13\u5b58\u533a \u00b6 \u5982\u679c\u770b\u5230\u5168\u5c40\u72b6\u6001\u53d8\u91cf Sort_merge_passes \u5f88\u5927\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u5927\u53c2\u6570 sort_buffer_size \u6765\u589e\u52a0\u6392\u5e8f\u7f13\u5b58\u533a\uff0c\u4ee5\u6539\u5584 ORDER BY \u548c GROUP \u5b57\u53e5\u7684\u6027\u80fd\u3002 \u5bf9\u4e8e\u65e0\u6cd5\u901a\u8fc7\u7d22\u5f15\u8fdb\u884c\u8fde\u63a5\u64cd\u4f5c\u7684\u67e5\u8be2\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7\u589e\u5927 join_buffer_size \u7684\u503c\u6539\u5584\u3002 \u4e24\u8005\u90fd\u662f\u9762\u5411\u5ba2\u6237\u670d\u52a1\u7ebf\u7a0b\u5206\u914d\u7684\uff0c\u82e5\u8bbe\u7f6e\u8fc7\u5927\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\uff0c\u751a\u81f3\u5185\u5b58\u4ea4\u6362\u3002\u6700\u597d\u7684\u7b56\u7565\u662f\u8bbe\u7f6e\u8f83\u5c0f\u7684\u5168\u5c40 join_buffer_size \uff0c\u800c\u5bf9\u4e8e\u9700\u8981\u590d\u6742\u8fde\u63a5\u7684session\u5355\u72ec\u8bbe\u7f6e\u8f83\u5927\u7684 join_buffer_size \u3002 2.4 InnoDB \u673a\u5236\u53ca\u4f18\u5316 \u00b6 2.4.1 InnoDB \u91cd\u505a\u65e5\u5fd7 \u00b6 redo log \u662fInnoDB\u4fdd\u8bc1\u4e8b\u52a1ACID\u5c5e\u6027\u7684\u91cd\u8981\u673a\u5236\u3002 \u66f4\u65b0\u6570\u636e\u65f6\uff0c\u5927\u81f4\u7684\u64cd\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a \u5c06\u6570\u636e\u8bfb\u5165 InnoDB buffer pool\uff0c\u5e76\u5bf9\u76f8\u5173\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u3002 \u5c06UNDO\u4fe1\u606f\u5199\u5165undo \u8868\u7a7a\u95f4\u7684\u56de\u6eda\u6bb5\u4e2d\u3002 \u66f4\u6539\u7f13\u5b58\u9875\u4e2d\u7684\u6570\u636e\uff0c\u5e76\u5c06\u66f4\u65b0\u8bb0\u5f55\u5199\u5165 redo buffer \u4e2d\u3002 \u63d0\u4ea4\u65f6\uff0c\u6839\u636e innodb_flush_log_at_trx_commit \u7684\u8bbe\u7f6e\uff0c\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\u5c06 redo buffer \u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u5237\u65b0\u5230 InnoDB redo log file \u4e2d\uff0c\u7136\u540e\u91ca\u653e\u72ec\u5360\u9501\u3002 \u6700\u540e\uff0c\u540e\u53f0IO\u7ebf\u7a0b\u6839\u636e\u9700\u8981\u62e9\u673a\u5c06\u7f13\u5b58\u4e2d\u66f4\u65b0\u8fc7\u7684\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\u3002 \u4e0b\u9762\u9488\u5bf9\u51e0\u4e2a\u53c2\u6570\u5bf9InnoDB\u7684\u6027\u80fd\u8fdb\u884c\u4f18\u5316\u3002 2.4.2 innodb_flush_log_at_trx_commit \u00b6 \u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6765\u63a7\u5236 redo buffer \u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u5199\u5165\u5230\u65e5\u5fd7\u6587\u4ef6\u4ee5\u53ca\u65e5\u5fd7\u6587\u4ef6\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\u65f6\u673a\u3002\u5bf9\u8fd9\u4e2a\u53c2\u6570\u7684\u8bbe\u7f6e\u53ef\u4ee5\u5bf9\u6570\u636e\u5e93\u5728\u6027\u80fd\u4e0e\u6570\u636e\u5b89\u5168\u4e4b\u95f4\u8fdb\u884c\u6298\u4e2d\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_flush_log_at_trx_commit\" -A 3 --innodb_flush_log_at_trx_commit [= #] Set to 0 ( write and flush once per second ) , 1 ( write and flush at each commit ) or 2 ( write at commit, flush once per second ) . 0\uff1a\u6bcf\u79d2\u8fdb\u884c\u4e00\u6b21\u65e5\u5fd7\u7f13\u5b58\u7684\u5199\u64cd\u4f5c\u548c\u5237\u65b0\u65e5\u5fd7\u6587\u4ef6\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\uff0c\u4f46\u5728\u4e8b\u52a1\u4e2d\u4e0d\u505a\u64cd\u4f5c\u3002\u82e5\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff1b\u6700\u4e0d\u5b89\u5168\uff0c\u6548\u7387\u6700\u9ad8\u3002 1\uff1a\u5728\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u65f6\u3002 \u9ed8\u8ba4\u503c \u3002\u6700\u5b89\u5168\uff0c\u6548\u7387\u6700\u4f4e\u3002 2\uff1a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u8fdb\u884c\u5199\u64cd\u4f5c\uff1b\u6bcf\u79d2\u8fdb\u884c\u4e00\u6b21\u5237\u65b0\u65e5\u5fd7\u6587\u4ef6\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\u3002\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931\u3002 2.4.3 innodb_log_buffer_size \u00b6 \u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u6c60\u7684\u5927\u5c0f\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_log_buffer_size\" -A2 --innodb_log_buffer_size = # The size of the buffer which InnoDB uses to write log to the log files on disk. \u9ed8\u8ba4\u503c\u662f 8MB\uff0c\u5728\u4e2d\u7b49\u5f3a\u5ea6\u5199\u5165\u8d1f\u8f7d\u4ee5\u53ca\u8f83\u77ed\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c \u4e00\u822c\u90fd\u53ef\u4ee5\u6ee1\u8db3\u670d\u52a1\u5668\u7684\u6027\u80fd\u8981\u6c42\u3002 \u5982\u679c\u5b83\u7684\u503c\u8bbe\u7f6e\u592a\u9ad8\u4e86\uff0c \u53ef\u80fd\u4f1a\u6d6a\u8d39\u5185\u5b58\uff0c \u56e0\u4e3a\u5b83\u6bcf\u79d2\u90fd\u4f1a\u5237\u65b0\u4e00\u6b21\uff0c \u56e0\u6b64\u65e0\u9700\u8bbe\u7f6e\u8d85\u8fc7 1 \u79d2\u6240\u9700\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u901a\u5e38\u8bbe\u7f6e\u4e3a 8\uff5e16MB \u5c31\u8db3\u591f\u4e86\uff0c\u8d8a\u5c0f\u7684\u7cfb\u7edf\u5b83\u7684\u503c\u8d8a\u5c0f\u3002 \u5bf9\u4e8e\u53ef\u80fd\u4ea7\u751f\u5927\u91cf\u6570\u636e\u66f4\u65b0\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u5927\u6765\u51cf\u5c11\u65e5\u5fd7\u5199\u78c1\u76d8\u7684\u64cd\u4f5c\u3002 2.4.4 innodb_log_file_size \u00b6 \u8be5\u53c2\u6570\u542b\u4e49\u662f\u4e00\u4e2a\u65e5\u5fd7\u7ec4\uff08log group\uff09\u4e2d\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\u3002\u9ed8\u8ba4\u503c\u662f 5MB\u3002 \u5f53\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u5199\u6ee1\u540e\uff0cInnoDB\u4f1a\u81ea\u52a8\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\uff0c\u4f46\u5207\u6362\u65f6\u4f1a\u89e6\u53d1\u6570\u636e\u5e93 \u68c0\u67e5\u70b9 \uff08Checkpoint\uff09\uff0c\u8fd9\u5c06\u5bfc\u81f4\u7f13\u5b58\u810f\u9875\u7684\u5c0f\u6279\u91cf\u5237\u65b0\uff0c\u4f1a\u660e\u663e\u964d\u4f4eInnoDB\u7684\u6027\u80fd\u3002** [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_log_file_size\" -A1 --innodb_log_file_size = # Size of each log file in a log group. \u4f46\u5982\u679c\u8bbe\u7f6e\u8fc7\u5927\uff0c\u6062\u590d\u65f6\u5c06\u9700\u8981\u66f4\u957f\u65f6\u95f4\uff0c\u540c\u65f6\u9875\u4e0d\u4fbf\u4e8e\u7ba1\u7406\u3002\u4e00\u822c\u6765\u8bf4\uff0c \u5e73\u5747\u6bcf\u534a\u4e2a\u5c0f\u65f6\u5199\u6ee1\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u6bd4\u8f83\u5408\u9002\u3002 \u8ba1\u7b97\u65b9\u5f0f\uff1a \u9996\u5148\u8ba1\u7b97\u6bcf\u5206\u949f\u4ea7\u751f\u7684\u65e5\u5fd7\u91cf\uff1a MariaDB [ MYISAM_TEST ] > pager grep - i \"Log sequence number\" PAGER set to 'grep -i \"Log sequence number\"' MariaDB [ MYISAM_TEST ] > SHOW ENGINE INNODB STATUS \\ G SELECT SLEEP ( 60 ); SHOW ENGINE INNODB STATUS \\ G Log sequence number 2680452 1 row in set ( 0 . 00 sec ) 1 row in set ( 1 min 0 . 00 sec ) -- \u56e0\u4e3a\u6211\u8fd9\u6570\u636e\u5e93\u6ca1\u6709\u6570\u636e\u64cd\u4f5c\u53ca\u67e5\u8be2\uff0c\u6240\u4ee5\u4e0d\u4f1a\u6539\u53d8 Log sequence number 2680452 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > nopager PAGER set to stdout MariaDB [ MYISAM_TEST ] > SELECT ROUND (( 2680452 - 2680452 ) / 1024 / 1024 ) AS MB ; +------+ | MB | +------+ | 0 | +------+ 1 row in set ( 0 . 00 sec ) \u90a3\u4e48\u534a\u5c0f\u65f6\u7684\u5c31\u662f\u4e58\u4ee530\u7684\u6570\u503c\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f97\u51fa innodb_log_file_size \u7684\u6700\u4f4e\u5927\u5c0f\u3002 2.5 MySQL \u5e76\u53d1\u76f8\u5173\u53c2\u6570 \u00b6 2.5.1 max_connections \u00b6 \u63a7\u5236\u5141\u8bb8\u8fde\u63a5\u5230MySQL\u7684\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba4214\u3002 \u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4f1a\u5f71\u54cd\u6700\u5927\u8fde\u63a5\u6570\u3002 \u8fd8\u9700\u8981\u6ce8\u610f open_file_limit \u662f\u5426\u591f\u7528\u3002 2.5.2 back_log \u00b6 \u63a7\u5236\u76d1\u542cTCP\u7aef\u53e3\u65f6\u8bbe\u7f6e\u7684\u79ef\u538b\u8bf7\u6c42\u6808\u5927\u5c0f\u3002 \u82e5\u9700\u8981\u6570\u636e\u5e93\u5728\u8f83\u77ed\u7684\u65f6\u95f4\u5185\u5904\u7406\u5927\u91cf\u8fde\u63a5\u8bf7\u6c42\uff0c\u53ef\u8003\u8651\u9002\u5f53\u589e\u5927\u3002 2.5.3 table_open_cache \u00b6 \u6bcf\u4e2asql\u6267\u884c\u7ebf\u7a0b\u90fd\u81f3\u5c11\u9700\u8981\u6253\u5f00\u4e00\u4e2a\u8868\u7f13\u5b58\uff0c\u8be5\u53c2\u6570\u63a7\u5236\u6240\u6709sql\u6267\u884c\u7ebf\u7a0b\u53ef\u6253\u5f00\u7684\u8868\u7f13\u5b58\u7684\u6570\u91cf\u3002\u82e5\u6bcf\u4e2a\u8fde\u63a5\u6267\u884c\u5173\u8054\u67e5\u8be2\u4e2d\u6240\u6d89\u53ca\u5230\u7684\u8868\u7684\u6700\u5927\u4e2a\u6570\u4e3a N \uff0c\u90a3\u4e48\u8be5\u503c\u5e94\u8bbe\u7f6e\u4e3a\uff1a max_connections * N \u3002 \u5728\u672a\u6267\u884c flush tables \u7684\u547d\u4ee4\u4e0b\uff0c\u82e5\u72b6\u6001\u53d8\u91cf opened_tables \u8f83\u5927\uff0c\u5e94\u9002\u5f53\u589e\u5927 table_open_cache \u3002\u8fd8\u9700\u8981\u6ce8\u610f open_file_limit \u662f\u5426\u591f\u7528\u3002 2.5.4 thread_cache_size \u00b6 \u8be5\u53c2\u6570\u63a7\u5236\u7f13\u5b58\u5ba2\u6237\u670d\u52a1\u7ebf\u7a0b\uff08\u53ef\u52a0\u5feb\u8fde\u63a5\u6570\u636e\u5e93\u7684\u901f\u5ea6\uff09\u7684\u6570\u91cf\u3002 \u8ba1\u7b97\u5931\u6548\u7387 threads_created/connections \u6765\u8861\u91cf\u8be5\u503c\u662f\u5426\u5408\u9002\uff0c\u8d8a\u63a5\u8fd11\uff0c\u5219\u8bf4\u660e\u547d\u4e2d\u7387\u8d8a\u4f4e\uff0c\u6b64\u65f6\u53ef\u8003\u8651\u589e\u52a0\u8be5\u503c\u3002 2.5.5 innodb_additional_mem_pool_size \u00b6 \u8fd9\u4e2a\u53c2\u6570\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\u7528\u6765\u5b58\u50a8\u6570\u636e\u5e93\u7ed3\u6784\u548c\u5176\u4ed6\u5185\u90e8\u6570\u636e\u7ed3\u6784\u7684\u5185\u5b58\u6c60\u7684\u5927\u5c0f\uff0c\u5176\u9ed8\u8ba4\u503c\u662f 1MB\u3002\u5e94\u7528\u7a0b\u5e8f\u91cc\u7684\u8868\u8d8a\u591a\uff0c\u5219\u9700\u8981\u5728\u8fd9\u91cc\u5206\u914d\u8d8a\u591a\u7684\u5185\u5b58\u3002\u5982\u679c InnoDB \u7528\u5149\u4e86\u8fd9\u4e2a\u6c60\u5185\u7684\u5185\u5b58\uff0c \u5219 InnoDB \u5f00\u59cb\u4ece\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u5185\u5b58\uff0c \u5e76\u4e14\u5f80 MySQL \u9519\u8bef\u65e5\u5fd7\u5199\u8b66\u544a\u4fe1\u606f\u3002 \u6ca1\u6709\u5fc5\u8981\u7ed9\u8fd9\u4e2a\u7f13\u51b2\u6c60\u5206\u914d\u975e\u5e38\u5927\u7684\u7a7a\u95f4\uff0c \u5728\u5e94\u7528\u76f8\u5bf9\u7a33\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c \u8fd9\u4e2a\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\u4e5f\u76f8\u5bf9\u7a33\u5b9a\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_additional_mem_pool_size\" -A 2 --innodb_additional_mem_pool_size = # Size of a memory pool InnoDB uses to store data dictionary information and other internal data 2.5.6 innodb_lock_wait_timeout \u00b6 InnoDB\u4e8b\u52a1\u653e\u5f03\u7b49\u5f85\u4e00\u4e2a\u884c\u9501\u7684\u65f6\u95f4\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_lock_wait_timeout\" -A 2 --innodb_lock_wait_timeout = # Timeout in seconds an InnoDB transaction may wait for a row lock before being rolled back. \u9ed8\u8ba4\u503c\u662f 50 \u79d2\u3002 \u5bf9\u4e8e\u9700\u8981\u5feb\u901f\u53cd\u9988\u7684\u4ea4\u4e92\u5f0fOLTP\u5e94\u7528\uff0c\u53ef\u5c06\u5176\u8c03\u5c0f\uff0c\u907f\u514d\u4e8b\u52a1\u957f\u65f6\u95f4\u6302\u8d77\uff1b\u5bf9\u4e8e\u540e\u53f0\u6279\u5904\u7406\u64cd\u4f5c\uff0c\u53ef\u4ee5\u589e\u5927\uff0c\u4ee5\u907f\u514d\u53d1\u751f\u5927\u7684\u56de\u6eda\u64cd\u4f5c\u3002 \u6ce8\u610f \uff1a\u5728InnoDB\u5185\u90e8\u4e0d\u4f1a\u53d1\u751fMySQL\u8868\u9501\u5b9a\uff0c\u5e76\u4e14\u6b64\u8d85\u65f6\u4e0d\u9002\u7528\u4e8e\u7b49\u5f85\u8868\u9501\u5b9a\u3002 2.5.7 innodb_support_xa \u00b6 \u901a\u8fc7\u8be5\u53c2\u6570\u8bbe\u7f6e\u662f\u5426\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u9ed8\u8ba4\u503c\u662f ON \u6216\u8005 1\uff0c\u8868\u793a\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_support_xa\" --innodb_support_xa Enable InnoDB support for the XA two-phase commit \u5982\u679c\u786e\u8ba4\u5e94\u7528\u4e2d\u4e0d\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c \u5219\u53ef\u4ee5\u5173\u95ed\u8fd9\u4e2a\u53c2\u6570\uff0c \u51cf\u5c11\u78c1\u76d8\u5237\u65b0\u7684\u6b21\u6570\u5e76\u83b7\u5f97\u66f4\u597d\u7684 InnoDB \u6027\u80fd\u3002","title":"28. MySQL Server\u7684\u4f18\u5316"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#1-mysql-server","text":"\u7528 SHOW VARIABLES \u548c SHOW STATUS \u547d\u4ee4\u67e5\u770b MySQL \u7684\u670d\u52a1\u5668\u9759\u6001\u53c2\u6570\u503c\u548c\u52a8\u6001\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\u3002 \u5176\u4e2d\u524d\u8005\u662f\u5728\u6570\u636e\u5e93\u542f\u52a8\u540e \u4e0d\u4f1a\u52a8\u6001\u66f4\u6539 \u7684\u503c\uff0c \u6bd4\u5982\u7f13\u51b2\u533a\u5927\u5c0f\u3001 \u5b57\u7b26\u96c6\u3001 \u6570\u636e\u6587\u4ef6\u540d\u79f0\u7b49\uff1b \u540e\u8005\u662f\u6570\u636e\u5e93\u8fd0\u884c\u671f\u95f4\u7684 \u52a8\u6001\u53d8\u5316 \u7684\u4fe1\u606f\uff0c \u6bd4\u5982\u9501\u7b49\u5f85\u3001\u5f53\u524d\u8fde\u63a5\u6570\u7b49\u3002 \u4e5f\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u76f4\u63a5\u67e5\u770b\u6570\u636e\u5e93\u53c2\u6570\u6216\u6570\u636e\u5e93\u72b6\u6001\u4fe1\u606f: # \u5c55\u793a\u5168\u90e8\u4fe1\u606f $ mysqladmin -uroot -p variables # \u5c55\u793a\u7edf\u8ba1\u4fe1\u606f $ mysqladmin -uroot -p status Uptime: 404366 Threads: 2 Questions: 44 Slow queries: 0 Opens: 9 Flush tables: 2 Open tables: 35 Queries per second avg: 0 .000 \u5982\u679c\u9700\u8981\u4e86\u89e3\u67d0\u4e2a\u53c2\u6570\u7684\u8be6\u7ec6\u5b9a\u4e49\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff08MariaDB\u6ca1\u6709\u8be5\u547d\u4ee4\uff09\uff1a mysqld --verbose --help | more","title":"1. \u67e5\u770b MySQL Server \u53c2\u6570"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#2-mysql","text":"InnoDB \u542f\u52a8\u9009\u9879\u548c\u7cfb\u7edf\u53d8\u91cf","title":"2. MySQL \u5185\u5b58\u7ba1\u7406\u53ca\u4f18\u5316"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#21","text":"\u5c06 \u5c3d\u91cf\u591a \u7684\u5185\u5b58\u5206\u914d\u7ed9MySQL\u505a\u7f13\u5b58\uff0c\u4f46\u8981\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u548c\u5176\u4ed6\u7a0b\u5e8f\u7684\u8fd0\u884c\u9884\u7559\u8db3\u591f\u7684\u5185\u5b58\uff0c\u5426\u5219\u5982\u679c\u4ea7\u751fSWAO\u9875\u4ea4\u6362\uff0c\u5c06\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002 MyISAM\u7684\u6570\u636e\u6587\u4ef6\u8bfb\u53d6\u4f9d\u8d56\u4e8e \u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab \u7684IO\u7f13\u5b58\uff0c\u56e0\u6b64\u5bf9\u4e8eMyISAM\u6765\u8bf4\u5e94\u9884\u7559\u66f4\u591a\u7684\u5185\u5b58\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u505aIO\u7f13\u5b58\u3002 \u6392\u5e8f\u533a\u3001\u8fde\u63a5\u533a\u7b49\u7f13\u5b58\u662f\u5206\u914d\u7ed9\u6bcf\u4e2a\u6570\u636e\u5e93\u4f1a\u8bdd\uff08session\uff09\u4e13\u7528\u7684\uff0c\u5176\u9ed8\u8ba4\u503c\u7684\u8bbe\u7f6e\u8981\u6839\u636e\u6700\u5927\u8fde\u63a5\u6811\u5408\u7406\u5206\u914d\uff0c\u5982\u679c\u8bbe\u7f6e\u592a\u5927\uff0c\u4e0d\u4f46\u6d6a\u8d39\u5185\u5b58\u8d44\u6e90\uff0c\u800c\u4e14\u5728\u5e76\u53d1\u8fde\u63a5\u8f83\u9ad8\u65f6\u4f1a\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u8017\u5c3d\u3002","title":"2.1 \u5185\u5b58\u4f18\u5316\u539f\u5219"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#22-myisam","text":"","title":"2.2 MyISAM \u5185\u5b58\u4f18\u5316"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#221-key_buffer_size","text":"\u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6765\u8bbe\u7f6e\u7d22\u5f15\u5757\uff08Index Blocks\uff09\u7f13\u5b58\u7684\u5927\u5c0f\uff0c\u5b83\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u3002 \u5bf9\u4e8e\u6570\u636e\u5757\uff0c\u5b8c\u5168\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684IO\u7f13\u5b58\u3002 \u5bf9\u4e8e\u4e00\u822c\u7684MyISAM\u6570\u636e\u5e93\uff0c\u5efa\u8bae\u81f3\u5c11 key_buffer_size \u8bbe\u7f6e\u4e3a1/4\u7684\u5185\u5b58\u3002 \u53ef\u901a\u8fc7\u5168\u5c40\u53d8\u91cf\u67e5\u8be2\uff1a SHOW GLOBAL variables LIKE '%KEY%'; \u3002 \u53ef\u4ee5\u68c0\u67e5MySQL\u7684 Key_read_requests\u3001Key_reads\u3001Key_write_requests\u3001Key_writes \u72b6\u6001\u53d8\u91cf\u6765\u8bc4\u4f30\u7d22\u5f15\u7f13\u5b58\u6548\u7387\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7d22\u5f15\u5757\u7269\u7406\u8bfb\u6bd4\u7387 Key_reads/Key_read_requests \u5e94\u5c0f\u4e8e0.01\uff1b\u7d22\u5f15\u5757\u7269\u7406\u8bfb\u6bd4\u7387 Key_writes/Key_write_requests \u4e5f\u5e94\u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u4f46\u8fd9\u4e0e\u5e94\u7528\u7279\u70b9\u6709\u5173\uff0c\u5bf9\u4e8e\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u7279\u522b\u591a\u7684\u5e94\u7528\uff0c\u8be5\u503c\u53ef\u80fd\u4f1a\u63a5\u8fd11\u3002 \u9664\u4e86\u4f7f\u7528\u8bfb\u5199\u6bd4\u7387\u8861\u91cf\u6548\u7387\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bc4\u4f30 key buffer \u7684\u4f7f\u7528\u7387\uff1a 1 - (( key_blocks_unused * key_cache_block_size ) / key_buffer_size ) \u4e00\u822c\u6765\u8bf4\uff0c\u4f7f\u7528\u7387\u5927\u6982\u572880%\u6bd4\u8f83\u5408\u9002\u3002\u5927\u4e8e80%\uff0c\u53ef\u80fd\u56e0\u7d22\u5f15\u7f13\u5b58\u4e0d\u8db3\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff1b\u5c0f\u4e8e80%\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\u3002","title":"2.2.1 \u8bbe\u7f6e key_buffer_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#222","text":"\u5404\u4e2asession\u662f\u5171\u4eabkey buffer\u7684\uff0c\u63d0\u9ad8\u4e86\u7d22\u5f15\u5b58\u53d6\u7684\u6027\u80fd\uff0c\u5374\u5bfc\u81f4\u4e86session\u5bf9key buffer\u7684\u7ade\u4e89\u3002MySQL\u63d0\u4f9b\u4e86\u591a\u7d22\u5f15\u7f13\u5b58\u673a\u5236\uff0c\u53ef\u4ee5\u5c06\u4e0d\u540c\u8868\u7684\u7d22\u5f15\u7f13\u5b58\u5230\u4e0d\u540c\u7684buffer\u4e2d\u3002 \u52a8\u6001\u65b0\u5efa\u4e00\u4e2a\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > SET GLOBAL cache_test . key_buffer_size = 512 * 1024 ; GLOBAL \u8868\u793a\u5bf9\u6bcf\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\uff0c \u6b64\u53c2\u6570\u90fd\u5c06\u751f\u6548\u3002 cache_test \u662f\u65b0\u7684 key_buffer \u540d\u79f0\u3002 \u5982\u679c\u9700\u8981\u66f4\u6539\u53c2\u6570\u503c\uff0c\u53ef\u4ee5\u968f\u65f6\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u8fdb\u884c\u91cd\u5efa\u3002\u503c\u4e3a0\u65f6\uff0c\u8868\u793a\u5220\u9664\u6b64buffer\u3002 \u52a8\u6001\u6307\u5b9a\u8868\u7684\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > CACHE INDEX sub_par_test IN cache_test ; \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5728MySQL\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa\u5e76\u52a0\u8f7d\u7d22\u5f15\u7f13\u5b58\uff1a MariaDB [ MYISAM_TEST ] > [ root @ dataBase ~ ] # cat /etc/my.cnf \u2026 key_buffer_size = 4 G hot_cache . key_buffer_size = 2 G cold_cache . key_buffer_size = 2 G init_file =/ path / to / data - directory / mysqld_init . sql \u2026 -- \u901a\u8fc7CACHE INDEX\u5206\u914d\u7d22\u5f15\u7f13\u5b58 -- \u901a\u8fc7LOAD INDEX INTO CACHE\u8fdb\u884c\u7d22\u5f15\u9884\u52a0\u8f7d\uff0c\u9884\u5148\u52a0\u8f7d\u8868\u7684\u7d22\u5f15\u7f13\u5b58\u5230\u7f13\u5b58\u533a\uff08\u4e00\u822c\u5bf9\u8868\u64cd\u4f5c\u540e\u624d\u4f1a\u5efa\u7acb\u7f13\u5b58\uff09\u3002 [ root @ dataBase ~ ] # cat mysqld_init.sql CACHE INDEX a . t1 , a . t2 , b . t3 IN hot_cache ; CACHE INDEX a . t4 , b . t5 , b . t6 IN cold_cache ; LOAD INDEX INTO CACHE a , b ; \u5220\u9664\u7d22\u5f15\u7f13\u5b58: MariaDB [ MYISAM_TEST ] > SET GLOBAL cache_test . key_buffer_size = 0 ; \u6ce8\u610f\uff1a\u4e0d\u80fd\u5220\u9664\u9ed8\u8ba4 key_buffer\u3002","title":"2.2.2 \u4f7f\u7528\u591a\u4e2a\u7d22\u5f15\u7f13\u5b58"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#223","text":"MySQL\u9ed8\u8ba4\u4f7f\u7528LRU\uff08least recently used\uff09\u7b56\u7565\u9009\u62e9\u8981\u6dd8\u6c70\u7684\u7d22\u5f15\u6570\u636e\u5757\u3002\u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u56de\u5bfc\u81f4\u771f\u6b63\u7684\u70ed\u5757\u88ab\u6dd8\u6c70\u3002 \u53ef\u4ee5\u4f7f\u7528 \u4e2d\u70b9\u63d2\u5165\u7b56\u7565 \uff08Midpoint Insertion Strategy\uff09\u6765\u4f18\u5316\u3002 \u300a\u6df1\u5165\u6d45\u51faMySQL\u7b2c\u4e8c\u7248\u300b21.2.2MyISAM\u5185\u5b58\u4f18\u5316 \u7ae0\u8282\u6709\u7b80\u5355\u8bf4\u660e\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u8282 key_cache_division_limit \u6765\u63a7\u5236\u591a\u5927\u6bd4\u4f8b\u7684\u7f13\u5b58\u7528\u4f5cwarm\u5b50\u8868\uff0c\u9ed8\u8ba4\u503c\u662f100\uff0c\u5373\u5168\u90e8\u7684\u7f13\u5b58\u5757\u90fd\u653e\u5728warm\u5b50\u8868\uff0c\u4e0d\u542f\u7528\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u3002 \u4e3e\u4f8b\uff1a\u5c0630%\u7684\u7f13\u5b58\u7528\u4e8ecache\u6700\u70ed\u7684\u7d22\u5f15\u5757\uff0c\u53ef\u4ee5\u8fd9\u6837\u8bbe\u7f6e\uff1a MariaDB [ MYISAM_TEST ] > SET GLOBAL key_cache_division_limit = 70 ; MariaDB [ MYISAM_TEST ] > SET GLOBAL hot_cache . key_cache_division_limit = 70 ; \u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 key_cache_age_threshold \u63a7\u5236\u6570\u636e\u5757\u7531hot\u5b50\u8868\u5411warm\u5b50\u8868\u964d\u7ea7\u7684\u65f6\u95f4\uff0c\u503c\u8d8a\u5c0f\uff0c\u964d\u7ea7\u8d8a\u5feb\u3002\u5bf9\u4e8e\u6709 N \u4e2a\u5757\u7684\u7d22\u5f15\u7f13\u5b58\u6765\u8bf4\uff0c\u5982\u679c\u4e00\u4e2a\u5728hot\u5b50\u8868\u5934\u90e8\u7684\u7d22\u5f15\u5757\uff0c\u5728\u6700\u540e\u7684 N * key_cache_age_threshold / 100 \u6b21\u7f13\u5b58\u547d\u4e2d\u5185\u672a\u88ab\u8bbf\u95ee\u8fc7\uff0c\u5c31\u4f1a\u88ab\u964d\u7ea7\u3002","title":"2.2.3 \u8c03\u6574\u201c\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u201d"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#224-table_cache","text":"MySQL\u624b\u518c\u4e2d\u5df2\u7ecf\u6ca1\u6709\u8fd9\u4e2a\u53d8\u91cf\u4e86\uff0c\u540c\u4e49\u53d8\u91cf\uff1a table_open_cache \u3002 \u8fd9\u4e2a\u53c2\u6570\u8868\u793a\u6570\u636e\u5e93\u7528\u6237\u6253\u5f00\u8868\u7684\u7f13\u5b58\u6570\u91cf\u3002 \u6bcf\u4e2a\u8fde\u63a5\u8fdb\u6765\uff0c \u90fd\u4f1a\u81f3\u5c11\u6253\u5f00\u4e00\u4e2a\u8868\u7f13\u5b58\u3002 \u56e0\u6b64\uff0c table_cache \u4e0e max_connections \u6709\u5173 \u3002\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u4e3a\u4e34\u65f6\u8868\u548c\u6587\u4ef6\u4fdd\u7559\u4e00\u4e9b\u989d\u5916\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep table_cache = --table_cache = # The number of open tables for all threads. \u53ef\u4ee5\u901a\u8fc7\u68c0\u67e5 mysqld \u7684\u72b6\u6001\u53d8\u91cf open_tables (\u5f53\u524d\u6253\u5f00\u7684\u8868\u7f13\u5b58\u6570)\u548c opened_tables \u786e\u5b9a\u8fd9\u4e2a\u53c2\u6570\u662f\u5426\u8fc7\u5c0f\uff0c\u5982\u679c\u6267\u884c FLUSH TABLES \u64cd\u4f5c\uff0c\u5219\u6b64\u7cfb\u7edf\u4f1a\u5173\u95ed\u4e00\u4e9b\u5f53\u524d\u6ca1\u6709\u4f7f\u7528\u7684\u8868\u7f13\u5b58\u800c\u4f7f\u5f97\u6b64\u72b6\u6001\u503c\u51cf\u5c0f\u3002 -- \u6e05\u7a7a\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > FLUSH TABLES ; -- \u67e5\u770b\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE 'Open%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Open_tables | 0 | | Opened_tables | 13 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 +--------------------------+-------+ -- \u6253\u5f00\u4e00\u5f20\u8868 MariaDB [ MYISAM_TEST ] > SELECT * FROM CHILD ; -- \u67e5\u770b\u7f13\u5b58 MariaDB [ MYISAM_TEST ] > SHOW GLOBAL STATUS LIKE 'Open%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Open_tables | 1 | | Opened_tables | 14 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 +--------------------------+-------+ \u518d\u6b21\u6267\u884c\u521a\u624d\u5bf9\u8868 t \u7684\u67e5\u8be2\u65f6\uff0c\u4e24\u4e2a\u503c\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u4e3a\u5df2\u7ecf\u5bf9\u8fd9\u5f20\u8868\u8fdb\u884c\u4e86\u7f13\u5b58\u3002\u72b6\u6001\u503c open_tables \u5bf9\u4e8e\u8bbe\u7f6e table_cache \u503c\u6709\u7740\u66f4\u6709\u4ef7\u503c\u7684\u53c2\u8003\u3002","title":"2.2.4 table_cache"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#23-innodb","text":"","title":"2.3 InnoDB \u5185\u5b58\u4f18\u5316"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#231","text":"InnoDB\u7528\u4e00\u5757 \u5185\u5b58 \u505aIO\u7f13\u5b58\u6c60\uff0c \u540c\u65f6\u7f13\u5b58\u7d22\u5f15\u5757\u548c\u6570\u636e\u5757 \u3002 \u7f13\u5b58\u6c60\u903b\u8f91\u4e0a\u7531\u51e0\u4e2a\u5217\u8868\u7ec4\u6210\uff1a free list\uff1a\u7a7a\u95f2\u7684\u7f13\u5b58\u5757\u5217\u8868\u3002\u4eceLRU list\u6dd8\u6c70\u7684\u6570\u636e\u9875\u4f1a\u88ab\u653e\u5728\u8fd9\u91cc\u3002 flush list\uff1a\u9700\u8981\u5237\u65b0\u5230\u78c1\u76d8\u7684\u7f13\u5b58\u5757\u5217\u8868\u3002 LRU list\uff1a\u6b63\u5728\u4f7f\u7528\u7684\u7f13\u5b58\u5757\uff0c\u662fInnoDB buffer pool\u7684\u6838\u5fc3\u3002","title":"2.3.1 \u7f13\u5b58\u673a\u5236"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#2311-buffer-pool-lru-algorithm","text":"InnoDB\u7684\u4e2d\u70b9\u63d2\u5165\u7b56\u7565 \u3002 \u300a\u6df1\u5165\u6d45\u51faMySQL\u7b2c\u4e8c\u7248\u300b21.2.3InnoDB\u5185\u5b58\u4f18\u5316 \u7ae0\u8282\u6709\u7b80\u5355\u8bf4\u660e\u3002 \u4f7f\u7528LRU\u7b97\u6cd5\u7684\u53d8\u4f53\uff0c\u4f7f\u7528\u7684\u6570\u636e\u5f88\u5c11\u5728\u7f13\u5b58\u4e2d\u8001\u5316\u3002 \u5f53\u9700\u8981\u5411\u7f13\u5b58\u6c60\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u9875\uff08page\uff09\u7684\u7a7a\u95f4\u65f6\uff0c\u6700\u5c11\u88ab\u4f7f\u7528\u7684\u9875\u88ab\u9a71\u9010\uff0c\u65b0\u9875\u6dfb\u52a0\u5230\u94fe\u8868\u7684\u4e2d\u90e8\u3002\u8fd9\u4e2a\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u5c06\u94fe\u8868\u5212\u5206\u4e3a\u4e24\u4e2a\u5b50\u94fe\u8868\uff1a \u5934\u90e8\u662f\u8bbf\u95ee\u65b0\u9875\u7684\u5b50\u94fe\u8868\u3002 \u53ef\u4ee5\u901a\u8fc7\u8c03\u6574InnoDB buffer pool\u7684\u5927\u5c0f\u3001\u6539\u53d8young sublist\u548cold sublist\u7684\u5206\u914d\u6bd4\u4f8b\u3001\u63a7\u5236\u810f\u7f13\u5b58\u7684\u5237\u65b0\u6d3b\u52a8\u3001\u4f7f\u7528\u591a\u4e2aInnoDB\u7f13\u5b58\u6c60\u7b49\u65b9\u6cd5\u4f18\u5316InnoDB\u7684\u6027\u80fd\u3002","title":"2.3.1.1 Buffer Pool LRU Algorithm"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#232-innodb_buffer_pool_instances-innodb_buffer_pool_size","text":"innodb_buffer_pool_size \u5b9a\u4e49\u4e86 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u6570\u636e\u548c\u7d22\u5f15\u6570\u636e\u7684\u6700\u5927\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\uff08\u4ee5 byte \u4e3a\u5355\u4f4d\uff0c\u9ed8\u8ba4\u662f128MB\uff09\u3002\u8fd9\u4e2a\u503c\u8bbe\u5f97\u8d8a\u9ad8\uff0c\u8bbf\u95ee\u8868\u4e2d\u6570\u636e\u9700\u8981\u7684\u78c1\u76d8 I/O \u5c31\u8d8a\u5c11\u3002\u5728\u4e13\u7528\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\u8bfe\u5206\u914d80%\u7684\u7269\u7406\u5185\u5b58\u7ed9\u8be5\u503c\uff0c\u4f46\u8981\u6ce8\u610f\u907f\u514d\u8bbe\u7f6e\u8fc7\u5927\u5bfc\u81f4\u9875\u4ea4\u6362\u3002 innodb_buffer_pool_instances \u662fInnoDB\u7f13\u51b2\u6c60\u5206\u533a\u7684\u6570\u91cf\u3002\u5bf9\u5177\u6709GB\u8303\u56f4\u7f13\u51b2\u6c60\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u5c06\u7f13\u51b2\u6c60\u5212\u5206\u4e3a\u51e0\u4e2a\u72ec\u7acb\u7684\u5b9e\u4f8b\u53ef\u4ee5\u63d0\u9ad8\u6548\u7387\uff0c\u901a\u8fc7\u51cf\u5c11\u56e0\u4e3a\u4e0d\u540c\u7684\u7ebf\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u7f13\u5b58\u7684\u9875\u9762\u7684\u4e89\u7528\u3002\u8981\u548c innodb_buffer_pool_size \uff08\u81f3\u5c11\u662f1GB\uff09\u914d\u5408\u4f7f\u7528\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_buffer_pool_size\" -A 2 --innodb_buffer_pool_size = # The size of the memory buffer InnoDB uses to cache data and indexes of its tables. MariaDB [ MYISAM_TEST ] > SHOW VARIABLES LIKE '%innodb_buffer%' ; +---------------------------------------+-----------+ | Variable_name | Value | +---------------------------------------+-----------+ | innodb_buffer_pool_instances | 1 | | innodb_buffer_pool_populate | OFF | | innodb_buffer_pool_restore_at_startup | 0 | | innodb_buffer_pool_shm_checksum | ON | | innodb_buffer_pool_shm_key | 0 | | innodb_buffer_pool_size | 134217728 | +---------------------------------------+-----------+ innodb_buffer_pool_size \u662f\u53ea\u8bfb\u53d8\u91cf\uff0c\u53ef\u4ee5\u5728 /etc/my.conf \u4e2d\u7684 [mysqld] \u4e0b\u5199\u5165 innodb_buffer_pool_size = 2GB \u7136\u540e\u91cd\u542f\u6570\u636e\u5e93\u3002 \u67e5\u770b\u7f13\u5b58\u6c60\u7684\u547d\u4e2d\u7387\uff1a [ root@dataBase ~ ] # mysqladmin -uroot -pabcd1234 -S /var/lib/mysql/mysql.sock ext | grep -i innodb_buffer_pool | Innodb_buffer_pool_bytes_data | 6946816 | | Innodb_buffer_pool_bytes_dirty | 0 | \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 | Innodb_buffer_pool_read_requests | 7676 | | Innodb_buffer_pool_reads | 425 | | Innodb_buffer_pool_wait_free | 0 | | Innodb_buffer_pool_write_requests | 0 | \u8ba1\u7b97\u516c\u5f0f\uff1a 1 - Innodb_buffer_pool_reads/Innodb_buffer_pool_read_requests * 100% \u547d\u4e2d\u7387\u592a\u4f4e\u65f6\u53ef\u8003\u8651\u589e\u52a0\u8be5\u503c\u3002","title":"2.3.2 innodb_buffer_pool_instances \u4e0e innodb_buffer_pool_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#233-old-sublist","text":"\u5728LRU list\u4e2d\uff0cold sublist\u7684\u6bd4\u4f8b\u7531\u7cfb\u7edf\u53c2\u6570 innodb_old_blocks_pct \u51b3\u5b9a\uff085~37\uff0c\u9ed8\u8ba4\u662f37\uff09\u3002\u67e5\u770b\u5f53\u524d\u8bbe\u7f6e\uff1a MariaDB [ MYISAM_TEST ] > SHOW GLOBAL VARIABLES LIKE '%innodb_old_blocks%' ; +------------------------+-------+ | Variable_name | Value | +------------------------+-------+ | innodb_old_blocks_pct | 37 | | innodb_old_blocks_time | 0 | +------------------------+-------+ innodb_old_blocks_time \u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\u53ef\u9632\u6b62\u7f13\u51b2\u6c60\u88ab\u4ec5\u5728\u77ed\u65f6\u95f4\u5185\u5f15\u7528\u7684\u6570\u636e\u586b\u5145\uff0c\u4f8b\u5982\u5728\u5168\u8868\u626b\u63cf\u671f\u95f4\u3002\u589e\u52a0\u6b64\u503c\u53ef\u63d0\u4f9b\u66f4\u591a\u4fdd\u62a4\uff0c\u9632\u6b62\u5168\u8868\u626b\u63cf\u5e72\u6270\u7f13\u51b2\u6c60\u4e2d\u7f13\u5b58\u7684\u6570\u636e\u3002 \u53ef\u4ee5\u6839\u636e \u76d1\u89c6\u5668 \u8f93\u51fa\u7684\u4fe1\u606f\u8c03\u6574 innodb_old_blocks_pct \u7684\u5927\u5c0f\u3002","title":"2.3.3 \u8c03\u6574 old sublist \u5927\u5c0f"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#234-innodb_old_blocks_time","text":"innodb_old_blocks_time \u51b3\u5b9a\u4e86\u7f13\u5b58\u6570\u636e\u5757\u7531 old sublist \u8f6c\u79fb\u5230 young sublist \u7684\u5feb\u6162\uff08\u53ef\u4ee5\u52a8\u6001\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u5bf9\u5927\u7684\u8868\u626b\u63cf\u505a\u4e34\u65f6\u8c03\u6574\uff09\u3002\u5f53\u4e00\u4e2a\u7f13\u5b58\u6570\u636e\u5757\u88ab\u63d2\u5165\u5230midpoint\uff08old sublist\uff09\u540e\uff0c\u81f3\u5c11\u5728\u5176\u4e2d\u505c\u7559 innodb_old_blocks_time \u6beb\u79d2\u7684\u65f6\u957f\u624d\u53ef\u80fd\u4f1a\u88ab\u8f6c\u79fb\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u7684\u907f\u514d\u8868\u626b\u63cf\u6c61\u67d3 buffer pool \u7684\u60c5\u51b5\u3002 \u4ee5\u4e0b\u4e24\u4e2a\u7edf\u8ba1\u53d8\u91cf\uff08\u53ef\u4ee5\u901a\u8fc7\u76d1\u89c6\u5668\u6765\u67e5\u770b\uff09\u53ef\u4ee5\u53cd\u5e94\u6570\u636e\u5757\u88ab\u8f6c\u79fb\u7684\u60c5\u51b5\uff1a \u540d\u79f0 \u63cf\u8ff0 youngs/s The per second average of accesses to old pages in the buffer pool LRU list that have resulted in making pages young. non-youngs/s The per second average of accesses to old pages in the buffer pool LRU list that have resulted in not making pages young. \u5982\u679c youngs/s \u5f88\u9ad8\uff0c non-young/s \u5f88\u4f4e\uff0c\u90a3\u4e48\u5e94\u8be5\u8003\u8651\u52a0\u5927 innodb_old_blocks_time \u3002","title":"2.3.4 \u8c03\u6574innodb_old_blocks_time\u7684\u5927\u5c0f"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#235-innodb_bufferio","text":"\u5728InnoDB\u627e\u4e0d\u5230\u5e72\u51c0\u7684\u53ef\u7528\u7f13\u5b58\u9875\u6216\u68c0\u67e5\u70b9\u88ab\u89e6\u53d1\u7b49\u60c5\u51b5\u4e0b\uff0cInnoDB\u7684\u540e\u53f0\u7ebf\u7a0b\u4f1a\u5f00\u59cb\u628a\u201c\u810f\u7684\u7f13\u5b58\u9875\u201d\u56de\u5199\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb \u7f13\u5b58\u5237\u65b0 \u3002 InnoDB buffer pool \u7684\u5237\u65b0\u5feb\u6162\u4e3b\u8981\u53d6\u51b3\u4e8e\u4e24\u4e2a\u53c2\u6570\uff1a innodb_max_dirty_pages_pct \uff1a\u7f13\u5b58\u6c60\u4e2d\u810f\u9875\u7684\u6700\u5927\u6bd4\u4f8b\u3002\u82e5\u810f\u9875\u7684\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e\u8be5\u503c\uff0cInnoDB\u7684\u540e\u53f0\u7ebf\u7a0b\u5c06\u5f00\u59cb\u5237\u65b0\u7f13\u5b58\u3002 innodb_io_capacity \uff1a\u78c1\u76d8\u7cfb\u7edf\u7684IO\u80fd\u529b\u3002\u5bf9\u4e8e\u8f6c\u901f\u8f83\u4f4e\u7684\u78c1\u76d8\uff0c\u59827200RPM\u7684\u78c1\u76d8\uff0c\u53ef\u964d\u4f4e\u81f3100\uff1b\u82e5\u662f\u56fa\u6001\u6216\u78c1\u76d8\u9635\u5217\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u5927\u3002 innodb_io_capacity \u51b3\u5b9a\u4e00\u6279\u5237\u65b0\u810f\u9875\u7684\u6570\u91cf\uff0c\u5f53\u7f13\u5b58\u9875\u6bd4\u4f8b\u8fbe\u5230 innodb_max_dirty_pages_pct \u65f6\uff0cInnoDB\u5c06\u5927\u7ea6 innodb_io_capacity \u4e2a\u5df2\u6539\u53d8\u7684\u7f13\u5b58\u9875\u5237\u65b0\u5230\u78c1\u76d8\u3002\u5f53\u810f\u9875\u6bd4\u4f8b\u5c0f\u4e8e innodb_max_dirty_pages_pct \u65f6\uff0c\u82e5 innodb_adaptive_flushing=true \uff0cInnoDB\u8bb2\u6839\u636e\u51fd\u6570 buf_flush_get_desired_flush_rate \u8fd4\u56de\u7684\u91cd\u505a\u65e5\u5fd7\u4ea7\u751f\u901f\u5ea6\u6765\u786e\u5b9a\u8981\u5237\u65b0\u7684\u810f\u9875\u6570\u3002\u5728\u5408\u5e76\u63d2\u5165\u7f13\u5b58\u65f6\uff0cInnoDB\u6bcf\u6b21\u5408\u5e76\u7684\u9875\u6570\u662f 0.05 * innodb_io_capacity \u3002","title":"2.3.5 \u63a7\u5236innodb_buffer\u5237\u65b0\uff0c\u5ef6\u957f\u6570\u636e\u7f13\u51b2\u65f6\u95f4\uff0c\u51cf\u7f13\u78c1\u76d8I/O"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#236","text":"\u5982\u679c\u770b\u5230\u5168\u5c40\u72b6\u6001\u53d8\u91cf Sort_merge_passes \u5f88\u5927\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u5927\u53c2\u6570 sort_buffer_size \u6765\u589e\u52a0\u6392\u5e8f\u7f13\u5b58\u533a\uff0c\u4ee5\u6539\u5584 ORDER BY \u548c GROUP \u5b57\u53e5\u7684\u6027\u80fd\u3002 \u5bf9\u4e8e\u65e0\u6cd5\u901a\u8fc7\u7d22\u5f15\u8fdb\u884c\u8fde\u63a5\u64cd\u4f5c\u7684\u67e5\u8be2\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7\u589e\u5927 join_buffer_size \u7684\u503c\u6539\u5584\u3002 \u4e24\u8005\u90fd\u662f\u9762\u5411\u5ba2\u6237\u670d\u52a1\u7ebf\u7a0b\u5206\u914d\u7684\uff0c\u82e5\u8bbe\u7f6e\u8fc7\u5927\u4f1a\u5bfc\u81f4\u5185\u5b58\u6d6a\u8d39\uff0c\u751a\u81f3\u5185\u5b58\u4ea4\u6362\u3002\u6700\u597d\u7684\u7b56\u7565\u662f\u8bbe\u7f6e\u8f83\u5c0f\u7684\u5168\u5c40 join_buffer_size \uff0c\u800c\u5bf9\u4e8e\u9700\u8981\u590d\u6742\u8fde\u63a5\u7684session\u5355\u72ec\u8bbe\u7f6e\u8f83\u5927\u7684 join_buffer_size \u3002","title":"2.3.6 \u8c03\u6574\u7528\u6237\u670d\u52a1\u7ebf\u7a0b\u6392\u5e8f\u7f13\u5b58\u533a"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#24-innodb","text":"","title":"2.4 InnoDB \u673a\u5236\u53ca\u4f18\u5316"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#241-innodb","text":"redo log \u662fInnoDB\u4fdd\u8bc1\u4e8b\u52a1ACID\u5c5e\u6027\u7684\u91cd\u8981\u673a\u5236\u3002 \u66f4\u65b0\u6570\u636e\u65f6\uff0c\u5927\u81f4\u7684\u64cd\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a \u5c06\u6570\u636e\u8bfb\u5165 InnoDB buffer pool\uff0c\u5e76\u5bf9\u76f8\u5173\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u3002 \u5c06UNDO\u4fe1\u606f\u5199\u5165undo \u8868\u7a7a\u95f4\u7684\u56de\u6eda\u6bb5\u4e2d\u3002 \u66f4\u6539\u7f13\u5b58\u9875\u4e2d\u7684\u6570\u636e\uff0c\u5e76\u5c06\u66f4\u65b0\u8bb0\u5f55\u5199\u5165 redo buffer \u4e2d\u3002 \u63d0\u4ea4\u65f6\uff0c\u6839\u636e innodb_flush_log_at_trx_commit \u7684\u8bbe\u7f6e\uff0c\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\u5c06 redo buffer \u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u5237\u65b0\u5230 InnoDB redo log file \u4e2d\uff0c\u7136\u540e\u91ca\u653e\u72ec\u5360\u9501\u3002 \u6700\u540e\uff0c\u540e\u53f0IO\u7ebf\u7a0b\u6839\u636e\u9700\u8981\u62e9\u673a\u5c06\u7f13\u5b58\u4e2d\u66f4\u65b0\u8fc7\u7684\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\u3002 \u4e0b\u9762\u9488\u5bf9\u51e0\u4e2a\u53c2\u6570\u5bf9InnoDB\u7684\u6027\u80fd\u8fdb\u884c\u4f18\u5316\u3002","title":"2.4.1 InnoDB \u91cd\u505a\u65e5\u5fd7"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#242-innodb_flush_log_at_trx_commit","text":"\u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6765\u63a7\u5236 redo buffer \u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u5199\u5165\u5230\u65e5\u5fd7\u6587\u4ef6\u4ee5\u53ca\u65e5\u5fd7\u6587\u4ef6\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\u65f6\u673a\u3002\u5bf9\u8fd9\u4e2a\u53c2\u6570\u7684\u8bbe\u7f6e\u53ef\u4ee5\u5bf9\u6570\u636e\u5e93\u5728\u6027\u80fd\u4e0e\u6570\u636e\u5b89\u5168\u4e4b\u95f4\u8fdb\u884c\u6298\u4e2d\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_flush_log_at_trx_commit\" -A 3 --innodb_flush_log_at_trx_commit [= #] Set to 0 ( write and flush once per second ) , 1 ( write and flush at each commit ) or 2 ( write at commit, flush once per second ) . 0\uff1a\u6bcf\u79d2\u8fdb\u884c\u4e00\u6b21\u65e5\u5fd7\u7f13\u5b58\u7684\u5199\u64cd\u4f5c\u548c\u5237\u65b0\u65e5\u5fd7\u6587\u4ef6\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\uff0c\u4f46\u5728\u4e8b\u52a1\u4e2d\u4e0d\u505a\u64cd\u4f5c\u3002\u82e5\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff1b\u6700\u4e0d\u5b89\u5168\uff0c\u6548\u7387\u6700\u9ad8\u3002 1\uff1a\u5728\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u65f6\u3002 \u9ed8\u8ba4\u503c \u3002\u6700\u5b89\u5168\uff0c\u6548\u7387\u6700\u4f4e\u3002 2\uff1a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u8fdb\u884c\u5199\u64cd\u4f5c\uff1b\u6bcf\u79d2\u8fdb\u884c\u4e00\u6b21\u5237\u65b0\u65e5\u5fd7\u6587\u4ef6\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\u3002\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931\u3002","title":"2.4.2 innodb_flush_log_at_trx_commit"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#243-innodb_log_buffer_size","text":"\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u6c60\u7684\u5927\u5c0f\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_log_buffer_size\" -A2 --innodb_log_buffer_size = # The size of the buffer which InnoDB uses to write log to the log files on disk. \u9ed8\u8ba4\u503c\u662f 8MB\uff0c\u5728\u4e2d\u7b49\u5f3a\u5ea6\u5199\u5165\u8d1f\u8f7d\u4ee5\u53ca\u8f83\u77ed\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c \u4e00\u822c\u90fd\u53ef\u4ee5\u6ee1\u8db3\u670d\u52a1\u5668\u7684\u6027\u80fd\u8981\u6c42\u3002 \u5982\u679c\u5b83\u7684\u503c\u8bbe\u7f6e\u592a\u9ad8\u4e86\uff0c \u53ef\u80fd\u4f1a\u6d6a\u8d39\u5185\u5b58\uff0c \u56e0\u4e3a\u5b83\u6bcf\u79d2\u90fd\u4f1a\u5237\u65b0\u4e00\u6b21\uff0c \u56e0\u6b64\u65e0\u9700\u8bbe\u7f6e\u8d85\u8fc7 1 \u79d2\u6240\u9700\u7684\u5185\u5b58\u7a7a\u95f4\u3002 \u901a\u5e38\u8bbe\u7f6e\u4e3a 8\uff5e16MB \u5c31\u8db3\u591f\u4e86\uff0c\u8d8a\u5c0f\u7684\u7cfb\u7edf\u5b83\u7684\u503c\u8d8a\u5c0f\u3002 \u5bf9\u4e8e\u53ef\u80fd\u4ea7\u751f\u5927\u91cf\u6570\u636e\u66f4\u65b0\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u9002\u5f53\u589e\u5927\u6765\u51cf\u5c11\u65e5\u5fd7\u5199\u78c1\u76d8\u7684\u64cd\u4f5c\u3002","title":"2.4.3 innodb_log_buffer_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#244-innodb_log_file_size","text":"\u8be5\u53c2\u6570\u542b\u4e49\u662f\u4e00\u4e2a\u65e5\u5fd7\u7ec4\uff08log group\uff09\u4e2d\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\u3002\u9ed8\u8ba4\u503c\u662f 5MB\u3002 \u5f53\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u5199\u6ee1\u540e\uff0cInnoDB\u4f1a\u81ea\u52a8\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\uff0c\u4f46\u5207\u6362\u65f6\u4f1a\u89e6\u53d1\u6570\u636e\u5e93 \u68c0\u67e5\u70b9 \uff08Checkpoint\uff09\uff0c\u8fd9\u5c06\u5bfc\u81f4\u7f13\u5b58\u810f\u9875\u7684\u5c0f\u6279\u91cf\u5237\u65b0\uff0c\u4f1a\u660e\u663e\u964d\u4f4eInnoDB\u7684\u6027\u80fd\u3002** [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_log_file_size\" -A1 --innodb_log_file_size = # Size of each log file in a log group. \u4f46\u5982\u679c\u8bbe\u7f6e\u8fc7\u5927\uff0c\u6062\u590d\u65f6\u5c06\u9700\u8981\u66f4\u957f\u65f6\u95f4\uff0c\u540c\u65f6\u9875\u4e0d\u4fbf\u4e8e\u7ba1\u7406\u3002\u4e00\u822c\u6765\u8bf4\uff0c \u5e73\u5747\u6bcf\u534a\u4e2a\u5c0f\u65f6\u5199\u6ee1\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u6bd4\u8f83\u5408\u9002\u3002 \u8ba1\u7b97\u65b9\u5f0f\uff1a \u9996\u5148\u8ba1\u7b97\u6bcf\u5206\u949f\u4ea7\u751f\u7684\u65e5\u5fd7\u91cf\uff1a MariaDB [ MYISAM_TEST ] > pager grep - i \"Log sequence number\" PAGER set to 'grep -i \"Log sequence number\"' MariaDB [ MYISAM_TEST ] > SHOW ENGINE INNODB STATUS \\ G SELECT SLEEP ( 60 ); SHOW ENGINE INNODB STATUS \\ G Log sequence number 2680452 1 row in set ( 0 . 00 sec ) 1 row in set ( 1 min 0 . 00 sec ) -- \u56e0\u4e3a\u6211\u8fd9\u6570\u636e\u5e93\u6ca1\u6709\u6570\u636e\u64cd\u4f5c\u53ca\u67e5\u8be2\uff0c\u6240\u4ee5\u4e0d\u4f1a\u6539\u53d8 Log sequence number 2680452 1 row in set ( 0 . 00 sec ) MariaDB [ MYISAM_TEST ] > nopager PAGER set to stdout MariaDB [ MYISAM_TEST ] > SELECT ROUND (( 2680452 - 2680452 ) / 1024 / 1024 ) AS MB ; +------+ | MB | +------+ | 0 | +------+ 1 row in set ( 0 . 00 sec ) \u90a3\u4e48\u534a\u5c0f\u65f6\u7684\u5c31\u662f\u4e58\u4ee530\u7684\u6570\u503c\u4e86\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f97\u51fa innodb_log_file_size \u7684\u6700\u4f4e\u5927\u5c0f\u3002","title":"2.4.4 innodb_log_file_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#25-mysql","text":"","title":"2.5 MySQL \u5e76\u53d1\u76f8\u5173\u53c2\u6570"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#251-max_connections","text":"\u63a7\u5236\u5141\u8bb8\u8fde\u63a5\u5230MySQL\u7684\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba4214\u3002 \u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4f1a\u5f71\u54cd\u6700\u5927\u8fde\u63a5\u6570\u3002 \u8fd8\u9700\u8981\u6ce8\u610f open_file_limit \u662f\u5426\u591f\u7528\u3002","title":"2.5.1 max_connections"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#252-back_log","text":"\u63a7\u5236\u76d1\u542cTCP\u7aef\u53e3\u65f6\u8bbe\u7f6e\u7684\u79ef\u538b\u8bf7\u6c42\u6808\u5927\u5c0f\u3002 \u82e5\u9700\u8981\u6570\u636e\u5e93\u5728\u8f83\u77ed\u7684\u65f6\u95f4\u5185\u5904\u7406\u5927\u91cf\u8fde\u63a5\u8bf7\u6c42\uff0c\u53ef\u8003\u8651\u9002\u5f53\u589e\u5927\u3002","title":"2.5.2 back_log"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#253-table_open_cache","text":"\u6bcf\u4e2asql\u6267\u884c\u7ebf\u7a0b\u90fd\u81f3\u5c11\u9700\u8981\u6253\u5f00\u4e00\u4e2a\u8868\u7f13\u5b58\uff0c\u8be5\u53c2\u6570\u63a7\u5236\u6240\u6709sql\u6267\u884c\u7ebf\u7a0b\u53ef\u6253\u5f00\u7684\u8868\u7f13\u5b58\u7684\u6570\u91cf\u3002\u82e5\u6bcf\u4e2a\u8fde\u63a5\u6267\u884c\u5173\u8054\u67e5\u8be2\u4e2d\u6240\u6d89\u53ca\u5230\u7684\u8868\u7684\u6700\u5927\u4e2a\u6570\u4e3a N \uff0c\u90a3\u4e48\u8be5\u503c\u5e94\u8bbe\u7f6e\u4e3a\uff1a max_connections * N \u3002 \u5728\u672a\u6267\u884c flush tables \u7684\u547d\u4ee4\u4e0b\uff0c\u82e5\u72b6\u6001\u53d8\u91cf opened_tables \u8f83\u5927\uff0c\u5e94\u9002\u5f53\u589e\u5927 table_open_cache \u3002\u8fd8\u9700\u8981\u6ce8\u610f open_file_limit \u662f\u5426\u591f\u7528\u3002","title":"2.5.3 table_open_cache"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#254-thread_cache_size","text":"\u8be5\u53c2\u6570\u63a7\u5236\u7f13\u5b58\u5ba2\u6237\u670d\u52a1\u7ebf\u7a0b\uff08\u53ef\u52a0\u5feb\u8fde\u63a5\u6570\u636e\u5e93\u7684\u901f\u5ea6\uff09\u7684\u6570\u91cf\u3002 \u8ba1\u7b97\u5931\u6548\u7387 threads_created/connections \u6765\u8861\u91cf\u8be5\u503c\u662f\u5426\u5408\u9002\uff0c\u8d8a\u63a5\u8fd11\uff0c\u5219\u8bf4\u660e\u547d\u4e2d\u7387\u8d8a\u4f4e\uff0c\u6b64\u65f6\u53ef\u8003\u8651\u589e\u52a0\u8be5\u503c\u3002","title":"2.5.4 thread_cache_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#255-innodb_additional_mem_pool_size","text":"\u8fd9\u4e2a\u53c2\u6570\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\u7528\u6765\u5b58\u50a8\u6570\u636e\u5e93\u7ed3\u6784\u548c\u5176\u4ed6\u5185\u90e8\u6570\u636e\u7ed3\u6784\u7684\u5185\u5b58\u6c60\u7684\u5927\u5c0f\uff0c\u5176\u9ed8\u8ba4\u503c\u662f 1MB\u3002\u5e94\u7528\u7a0b\u5e8f\u91cc\u7684\u8868\u8d8a\u591a\uff0c\u5219\u9700\u8981\u5728\u8fd9\u91cc\u5206\u914d\u8d8a\u591a\u7684\u5185\u5b58\u3002\u5982\u679c InnoDB \u7528\u5149\u4e86\u8fd9\u4e2a\u6c60\u5185\u7684\u5185\u5b58\uff0c \u5219 InnoDB \u5f00\u59cb\u4ece\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u5185\u5b58\uff0c \u5e76\u4e14\u5f80 MySQL \u9519\u8bef\u65e5\u5fd7\u5199\u8b66\u544a\u4fe1\u606f\u3002 \u6ca1\u6709\u5fc5\u8981\u7ed9\u8fd9\u4e2a\u7f13\u51b2\u6c60\u5206\u914d\u975e\u5e38\u5927\u7684\u7a7a\u95f4\uff0c \u5728\u5e94\u7528\u76f8\u5bf9\u7a33\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c \u8fd9\u4e2a\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\u4e5f\u76f8\u5bf9\u7a33\u5b9a\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_additional_mem_pool_size\" -A 2 --innodb_additional_mem_pool_size = # Size of a memory pool InnoDB uses to store data dictionary information and other internal data","title":"2.5.5 innodb_additional_mem_pool_size"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#256-innodb_lock_wait_timeout","text":"InnoDB\u4e8b\u52a1\u653e\u5f03\u7b49\u5f85\u4e00\u4e2a\u884c\u9501\u7684\u65f6\u95f4\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_lock_wait_timeout\" -A 2 --innodb_lock_wait_timeout = # Timeout in seconds an InnoDB transaction may wait for a row lock before being rolled back. \u9ed8\u8ba4\u503c\u662f 50 \u79d2\u3002 \u5bf9\u4e8e\u9700\u8981\u5feb\u901f\u53cd\u9988\u7684\u4ea4\u4e92\u5f0fOLTP\u5e94\u7528\uff0c\u53ef\u5c06\u5176\u8c03\u5c0f\uff0c\u907f\u514d\u4e8b\u52a1\u957f\u65f6\u95f4\u6302\u8d77\uff1b\u5bf9\u4e8e\u540e\u53f0\u6279\u5904\u7406\u64cd\u4f5c\uff0c\u53ef\u4ee5\u589e\u5927\uff0c\u4ee5\u907f\u514d\u53d1\u751f\u5927\u7684\u56de\u6eda\u64cd\u4f5c\u3002 \u6ce8\u610f \uff1a\u5728InnoDB\u5185\u90e8\u4e0d\u4f1a\u53d1\u751fMySQL\u8868\u9501\u5b9a\uff0c\u5e76\u4e14\u6b64\u8d85\u65f6\u4e0d\u9002\u7528\u4e8e\u7b49\u5f85\u8868\u9501\u5b9a\u3002","title":"2.5.6 innodb_lock_wait_timeout"},{"location":"mysql/28. MySQL Server\u7684\u4f18\u5316/#257-innodb_support_xa","text":"\u901a\u8fc7\u8be5\u53c2\u6570\u8bbe\u7f6e\u662f\u5426\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u9ed8\u8ba4\u503c\u662f ON \u6216\u8005 1\uff0c\u8868\u793a\u652f\u6301\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 [ zzx@localhost ~ ] $ mysqld --verbose --help | grep \"\\-\\-innodb_support_xa\" --innodb_support_xa Enable InnoDB support for the XA two-phase commit \u5982\u679c\u786e\u8ba4\u5e94\u7528\u4e2d\u4e0d\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c \u5219\u53ef\u4ee5\u5173\u95ed\u8fd9\u4e2a\u53c2\u6570\uff0c \u51cf\u5c11\u78c1\u76d8\u5237\u65b0\u7684\u6b21\u6570\u5e76\u83b7\u5f97\u66f4\u597d\u7684 InnoDB \u6027\u80fd\u3002","title":"2.5.7 innodb_support_xa"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/","text":"\u524d\u9762\u63d0\u5230\u7684 SQL \u4f18\u5316\u3001\u6570\u636e\u5e93\u5bf9\u8c61\u4f18\u5316\u3001\u6570\u636e\u5e93\u53c2\u6570\u4f18\u5316\uff0c\u4ee5\u53ca\u5e94\u7528\u7a0b\u5e8f\u4f18\u5316\u7b49\uff0c \u5927\u90e8\u5206\u90fd\u662f\u60f3\u901a\u8fc7 \u51cf\u5c11\u6216\u5ef6\u7f13\u78c1\u76d8\u8bfb\u5199 \u6765\u51cf\u8f7b\u78c1\u76d8 I/O \u7684\u538b\u529b\u53ca\u5176\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002 1. \u4f7f\u7528\u78c1\u76d8\u9635\u5217 \u00b6 RAID(Redundant Array of Inexpensive Disks)\uff1a\u5ec9\u4ef7\u78c1\u76d8\u5197\u4f59\u9635\u5217\uff0c\u901a\u5e38\u5c31\u53eb\u505a\u78c1\u76d8\u9635\u5217\u3002 RAID \u7ea7\u522b \u7279\u6027 \u4f18\u70b9 \u7f3a\u70b9 RAID 0 \u4e5f\u53eb\u6761\u5e26\u5316\uff08Stripe\uff09\uff0c\u6309\u4e00\u5b9a \u7684\u6761\u5e26\u5927\u5c0f\uff08Chunk Size)\u5c06\u6570 \u636e\u4f9d\u6b21\u5206\u5e03\u5230\u5404\u4e2a\u78c1\u76d8\uff0c\u6ca1\u6709 \u6570\u636e\u5197\u4f59 \u6570\u636e\u5e76\u53d1\u8bfb\u5199\u901f\u5ea6\u5feb\uff0c\u65e0\u989d \u5916\u78c1\u76d8\u7a7a\u95f4\u5f00\u9500\uff0c\u6295\u8d44\u7701 \u6570\u636e\u65e0\u5197\u4f59\u4fdd\u62a4\uff0c\u53ef\u9760\u6027 \u5dee RAID 1 \u4e5f\u53eb\u78c1\u76d8\u955c\u50cf\uff08Mirror\uff09\uff0c\u4e24\u4e2a \u78c1\u76d8\u4e00\u7ec4\uff0c\u6240\u6709\u6570\u636e\u90fd\u540c\u65f6\u5199 \u5165\u4e24\u4e2a\u78c1\u76d8\uff0c\u4f46\u8bfb\u65f6\u4ece\u4efb\u4e00\u78c1 \u76d8\u8bfb\u90fd\u53ef\u4ee5 \u6570\u636e\u6709\u5b8c\u5168\u5197\u4f59\u4fdd\u62a4\uff0c\u53ea\u8981 \u4e0d\u51fa\u73b0\u4e24\u5757\u955c\u50cf\u78c1\u76d8\u540c\u65f6\u635f \u574f\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4f7f\u7528\uff1b\u53ef\u4ee5\u63d0 \u9ad8\u5e76\u53d1\u8bfb\u6027\u80fd \u5bb9\u91cf\u4e00\u5b9a\u7684\u8bdd\uff0c\u9700\u8981 2 \u966a \u7684\u78c1\u76d8\uff0c\u6295\u8d44\u6bd4\u8f83\u5927 RAID 10 \u662f RAID 1 \u548c RAID 0 \u7684\u7ed3\u5408\uff0c\u4e5f \u53eb RAID 1+0\u3002\u5148\u5bf9\u78c1\u76d8\u505a\u955c\u50cf\uff0c \u518d\u6761\u5e26\u8bdd\uff0c\u4f7f\u5176\u517c\u5177 RAID 1 \u7684\u53ef\u9760\u6027\u548cRAID 0\u7684\u4f18\u826f\u5e76\u53d1\u8bfb\u5199\u6027\u80fd \u53ef\u9760\u6027\u9ad8\uff0c\u5e76\u53d1\u8bfb\u5199\u6027\u80fd\u4f18 \u826f \u5bb9\u91cf\u4e00\u5b9a\u7684\u8bdd\uff0c\u9700\u8981 2 \u966a \u7684\u78c1\u76d8\uff0c\u6295\u8d44\u6bd4\u8f83\u5927 RAID 4 \u8c61 RAID 0 \u4e00\u6837\u5bf9\u78c1\u76d8\u7ec4\u6761\u5e26 \u5316\uff0c\u4e0d\u540c\u7684\u662f\uff1a\u9700\u8981\u989d\u5916\u589e\u52a0 \u4e00\u4e2a\u78c1\u76d8\uff0c\u7528\u6765\u5199\u5404 Stripe \u7684 \u6821\u9a8c\u7ea0\u9519\u6570\u636e RAID \u4e2d\u7684\u4e00\u4e2a\u78c1\u76d8\u635f\u574f\uff0c\u5176 \u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u6821\u9a8c\u7ea0\u9519\u6570\u636e \u8ba1\u7b97\u51fa\u6765\uff0c\u5177\u6709\u4e00\u5b9a\u5bb9\u9519\u4fdd \u62a4\u80fd\u529b\uff1b\u8bfb\u6570\u636e\u901f\u5ea6\u5feb \u6bcf\u4e2a Stripe \u4e0a\u6570\u636e\u7684\u4fee\u6539 \u90fd\u8981\u5199\u6821\u9a8c\u7ea0\u9519\u5757\uff0c\u5199\u6027 \u80fd\u53d7\u5f71\u54cd\uff1b\u6240\u6709\u7ea0\u9519\u6570\u636e \u90fd\u5728\u540c\u4e00\u78c1\u76d8\u4e0a\uff0c\u98ce\u9669\u5927\uff0c \u4e5f\u4f1a\u5f62\u6210\u4e00\u4e2a\u6027\u80fd\u74f6\u9888\uff1b \u5728\u51fa\u73b0\u574f\u76d8\u65f6\uff0c\u8bfb\u6027\u80fd\u4f1a\u4e0b\u964d RAID 5 \u662f\u5bf9 RAID 4 \u7684\u6539\u8fdb\uff1a\u5c06\u6bcf\u4e00\u4e2a \u6761\u5e26\uff08Stripe\uff09\u7684\u6821\u9a8c\u7ea0\u9519\u6570\u636e \u5757\u4e5f\u5206\u5e03\u5199\u5230\u5404\u4e2a\u78c1\u76d8\uff0c\u800c\u4e0d \u662f\u5199\u5230\u4e00\u4e2a\u7279\u5b9a\u7684\u78c1\u76d8 \u57fa\u672c\u540c RAID 4\uff0c\u53ea\u662f\u5176\u5199\u6027 \u80fd\u548c\u6570\u636e\u4fdd\u62a4\u80fd\u529b\u8981\u66f4\u5f3a\u4e00 \u70b9 \u5199\u6027\u80fd\u4e0d\u53ca RAID 0\u3001RAID 1 \u548c RAID 10\uff0c\u5bb9\u9519\u80fd\u529b\u4e5f\u4e0d \u53ca RAID 1\uff1b\u5728\u51fa\u73b0\u574f\u76d8\u65f6\uff0c \u8bfb\u6027\u80fd\u4f1a\u4e0b\u964d \u6839\u636e\u6570\u636e\u8bfb\u5199\u7684\u7279\u70b9\u3001\u53ef\u9760\u6027\u8981\u6c42\uff0c\u4ee5\u53ca\u6295\u8d44\u9884\u7b97\u7b49\u6765\u9009\u62e9\u5408\u9002\u7684 RAID \u7ea7\u522b\uff0c\u6bd4\u5982\uff1a \u6570\u636e\u8bfb\u5199\u90fd\u5f88\u9891\u7e41\uff0c\u53ef\u9760\u6027\u8981\u6c42\u4e5f\u5f88\u9ad8\uff0c\u6700\u597d\u9009\u62e9 RAID 10\uff1b \u6570\u636e\u8bfb\u5f88\u9891\u7e41\uff0c\u5199\u76f8\u5bf9\u8f83\u5c11\uff0c\u5bf9\u53ef\u9760\u6027\u6709\u4e00\u5b9a\u8981\u6c42\uff0c\u53ef\u4ee5\u9009\u62e9 RAID 5\uff1b \u6570\u636e\u8bfb\u5199\u90fd\u5f88\u9891\u7e41\uff0c\u4f46\u53ef\u9760\u6027\u8981\u6c42\u4e0d\u9ad8\uff0c\u53ef\u4ee5\u9009\u62e9 RAID 0\u3002 1.1 \u865a\u62df\u6587\u4ef6\u5377\u6216\u8f6f RAID \u00b6 \u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u63d0\u4f9b\u7684\u8f6f\u4ef6\u5305\uff0c\u4e5f\u6a21\u62df\u5b9e\u73b0\u4e86\u4e00\u4e9b RAID \u7684\u7279\u6027\uff0c\u4f46\u6027\u80fd\u4e0a\u4e0d\u5982\u786c RAID \u3002 \u6bd4\u5982\uff0cLinux \u4e0b\u7684\u903b\u8f91\u5377\uff08Logical Volume\uff09\u7cfb\u7edf lvm2\uff0c\u652f\u6301\u6761\u5e26\u5316\uff08Stripe\uff09\uff1bLinux \u4e0b\u7684 MD\uff08Multiple Device\uff09\u9a71\u52a8\uff0c\u652f\u6301 RAID 0\u3001RAID 1\u3001RAID 4\u3001RAID 5\u3001RAID 6 \u7b49\u3002 2. \u4f7f\u7528 Symbolic Links \u5206\u5e03 I/O \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u521b\u5efa\u7684\u6570\u636e\u5e93\u548c\u8868\u90fd\u5b58\u653e\u5728\u53c2\u6570 datadir \u5b9a\u4e49\u7684\u76ee\u5f55\u4e0b\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684 \u7b26\u53f7\u8fde\u63a5 \uff08Symbolic Links\uff09\u5c06\u4e0d\u540c\u7684\u6570\u636e\u5e93\u6216\u8868\u3001\u7d22\u5f15\u6307\u5411\u4e0d\u540c\u7684\u7269\u7406\u78c1\u76d8\uff0c\u4ece\u800c\u8fbe\u5230\u5206\u5e03\u78c1\u76d8 I/O \u7684\u76ee\u7684\u3002 \u5c06\u4e00\u4e2a\u6570\u636e\u5e93\u6307\u5411\u5176\u4ed6\u7269\u7406\u78c1\u76d8\u3002 \u5176\u65b9\u6cd5\u662f\u5148\u5728\u76ee\u6807\u78c1\u76d8\u4e0a\u521b\u5efa\u76ee\u5f55\uff0c\u7136\u540e\u518d\u521b\u5efa\u4ece MySQL \u6570\u636e\u76ee\u5f55\u5230\u76ee\u6807\u76ee\u5f55\u7684\u7b26\u53f7\u8fde\u63a5\uff1a shell> mkdir /otherdisk/databases/test shell> ln -s /otherdisk/databases/test /path/to/datadir 2 . \u5c06 MyISAM \uff08\u5176\u4ed6\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u4e0d\u652f\u6301\uff09\u8868\u7684\u6570\u636e\u6587\u4ef6\u6216\u7d22\u5f15\u6587\u4ef6\u6307\u5411\u5176\u4ed6\u7269\u7406\u78c1\u76d8\u3002 1 . \u5bf9\u4e8e\u65b0\u5efa\u7684\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 CREATE TABLE\u8bed\u53e5\u4e2d\u589e\u52a0 ` DATA DIRECTORY ` \u548c ` INDEX DIRECTORY ` \u9009\u9879\u6765\u5b8c\u6210\uff08\u5bf9\u4e8e\u5206\u533a\u8868\u65e0\u6548\uff09\uff0c\u4f8b\u5982\uff1a Create table test ( id int primary key , Name varchar ( 20 )) Type = myisam DATA DIRECTORY = '/disk2/data' INDEX DIRECTORY = '/disk3/index' \u200b 2. \u5bf9\u4e8e\u5df2\u6709\u7684\u8868\uff0c\u53ef\u4ee5\u5148\u5c06\u5176\u6570\u636e\u6587\u4ef6\uff08.MYD\uff09\u6216\u7d22\u5f15\u6587\u4ef6\uff08.MYI\uff09\u8f6c\u79fb\u5230\u76ee\u6807\u78c1\u76d8\uff0c\u7136\u540e\u518d\u5efa\u7acb\u7b26\u53f7\u8fde\u63a5\u5373\u53ef\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\u8868\u5b9a\u4e49\u6587\u4ef6\uff08.frm\uff09\u5fc5\u987b\u4f4d\u4e8eMySQL\u6570\u636e\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0c\u4e0d\u80fd\u7528\u7b26\u53f7\u8fde\u63a5\u3002 \u6ce8\u610f \uff1a\u4f7f\u7528Symbolic Links\u5b58\u5728\u4e00\u5b9a\u7684\u5b89\u5168\u98ce\u9669\uff0c\u5982\u679c\u4e0d\u4f7f\u7528Symbolic Links\uff0c\u5e94\u901a\u8fc7\u542f\u52a8\u53c2\u6570 skip-symbolic-links \u7981\u7528\u8fd9\u4e00\u529f\u80fd\u3002 3. \u7981\u6b62\u64cd\u4f5c\u7cfb\u7edf\u66f4\u65b0\u6587\u4ef6\u7684 atime \u5c5e\u6027 \u00b6 atime \u662f Linux/UNIX \u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5c5e\u6027\uff0c\u6bcf\u5f53\u8bfb\u53d6\u6587\u4ef6\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4f1a\u5c06\u8bfb\u64cd\u4f5c\u53d1\u751f\u7684\u65f6\u95f4\u56de\u5199\u5230\u78c1\u76d8\u4e0a\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u6587\u4ef6\u7cfb\u7edf\u7684 mount \u5c5e\u6027\uff0c\u963b\u6b62\u64cd\u4f5c\u7cfb\u7edf\u5199 atime \u4fe1\u606f\uff0c\u4ee5\u51cf\u8f7b\u78c1\u76d8 I/O \u7684\u8d1f\u62c5\u3002\u5728 Linux \u4e0b\u7684\u5177\u4f53\u505a\u6cd5\u662f\uff1a \u4fee\u6539\u6587\u4ef6\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6 /etc/fstab \uff0c\u6307\u5b9a noatime \u9009\u9879\uff1a LABEL=/home /home ext3 noatime 1 2 \u7136\u540e\u91cd\u65b0 mount \u6587\u4ef6\u7cfb\u7edf\uff1a shell mount -oremount /home \u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u4ee5\u540e\u8bfb /home \u4e0b\u6587\u4ef6\u5c31\u4e0d\u4f1a\u518d\u5199\u78c1\u76d8\u4e86 \u3002 4. \u7528\u88f8\u8bbe\u5907\uff08Raw Device\uff09\u5b58\u653e InnoDB \u7684\u5171\u4eab\u8868\u7a7a\u95f4 \u00b6 MyISAM \u5b58\u50a8\u5f15\u64ce\u6709\u81ea\u5df1\u7684\u7d22\u5f15\u7f13\u5b58\u673a\u5236\uff0c\u4f46 \u6570\u636e\u6587\u4ef6\u7684\u8bfb\u5199\u5b8c\u5168\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf \uff0c\u64cd\u4f5c\u7cfb\u7edf\u78c1\u76d8 I/O \u7f13\u5b58\u5bf9 MyISAM \u8868\u7684\u5b58\u53d6\u5f88\u91cd\u8981\u3002 \u4f46 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e0e MyISAM \u4e0d\u540c\u5b83\u91c7\u7528\u7c7b\u4f3c Oracle \u7684\u6570\u636e\u7f13\u5b58\u673a\u5236\u6765 Cache \u7d22\u5f15\u548c\u6570\u636e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u78c1\u76d8 I/O \u7f13\u5b58\u5bf9\u5176\u6027\u80fd\u4e0d\u4ec5\u6ca1\u6709\u5e2e\u52a9\uff0c\u751a\u81f3\u8fd8\u6709\u53cd\u4f5c\u7528\u3002 \u56e0\u6b64\uff0c\u5728 InnoDB \u7f13\u5b58\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Raw device \u6765\u5b58\u653e InnoDB \u5171\u4eab\u8868\u7a7a\u95f4\uff1a \u4fee\u6539MySQL\u914d\u7f6e\u6587\u4ef6\uff0c\u5728 innodb_data_file_path \u53c2\u6570\u4e2d\u589e\u52a0\u88f8\u8bbe\u5907\u6587\u4ef6\u540d\u5e76\u6307\u5b9anewraw\u5c5e\u6027\uff1a [mysqld] innodb_data_home_dir = innodb_data_file_path = /dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw \u542f\u52a8MySQL\uff0c\u4f7f\u5176\u5b8c\u6210\u5206\u533a\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u5173\u95edMySQL\u3002\u6b64\u65f6\u8fd8\u4e0d\u80fd\u521b\u5efa\u6216\u4fee\u6539InnoDB\u8868\u3002 \u5c06 innodb_data_file_path \u4e2d\u7684newraw\u6539\u6210raw \uff1a ...... class = programlisting [ mysqld ] innodb_data_home_dir = innodb_data_file_path =/ dev / hdd1 : 3 Graw ; / dev / hdd2 : 2 Graw ...... \u91cd\u65b0\u542f\u52a8\u5373\u53ef\u5f00\u59cb\u4f7f\u7528\u3002","title":"29. MySQL\u78c1\u76d8 IO \u95ee\u9898"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/#1","text":"RAID(Redundant Array of Inexpensive Disks)\uff1a\u5ec9\u4ef7\u78c1\u76d8\u5197\u4f59\u9635\u5217\uff0c\u901a\u5e38\u5c31\u53eb\u505a\u78c1\u76d8\u9635\u5217\u3002 RAID \u7ea7\u522b \u7279\u6027 \u4f18\u70b9 \u7f3a\u70b9 RAID 0 \u4e5f\u53eb\u6761\u5e26\u5316\uff08Stripe\uff09\uff0c\u6309\u4e00\u5b9a \u7684\u6761\u5e26\u5927\u5c0f\uff08Chunk Size)\u5c06\u6570 \u636e\u4f9d\u6b21\u5206\u5e03\u5230\u5404\u4e2a\u78c1\u76d8\uff0c\u6ca1\u6709 \u6570\u636e\u5197\u4f59 \u6570\u636e\u5e76\u53d1\u8bfb\u5199\u901f\u5ea6\u5feb\uff0c\u65e0\u989d \u5916\u78c1\u76d8\u7a7a\u95f4\u5f00\u9500\uff0c\u6295\u8d44\u7701 \u6570\u636e\u65e0\u5197\u4f59\u4fdd\u62a4\uff0c\u53ef\u9760\u6027 \u5dee RAID 1 \u4e5f\u53eb\u78c1\u76d8\u955c\u50cf\uff08Mirror\uff09\uff0c\u4e24\u4e2a \u78c1\u76d8\u4e00\u7ec4\uff0c\u6240\u6709\u6570\u636e\u90fd\u540c\u65f6\u5199 \u5165\u4e24\u4e2a\u78c1\u76d8\uff0c\u4f46\u8bfb\u65f6\u4ece\u4efb\u4e00\u78c1 \u76d8\u8bfb\u90fd\u53ef\u4ee5 \u6570\u636e\u6709\u5b8c\u5168\u5197\u4f59\u4fdd\u62a4\uff0c\u53ea\u8981 \u4e0d\u51fa\u73b0\u4e24\u5757\u955c\u50cf\u78c1\u76d8\u540c\u65f6\u635f \u574f\uff0c\u4e0d\u4f1a\u5f71\u54cd\u4f7f\u7528\uff1b\u53ef\u4ee5\u63d0 \u9ad8\u5e76\u53d1\u8bfb\u6027\u80fd \u5bb9\u91cf\u4e00\u5b9a\u7684\u8bdd\uff0c\u9700\u8981 2 \u966a \u7684\u78c1\u76d8\uff0c\u6295\u8d44\u6bd4\u8f83\u5927 RAID 10 \u662f RAID 1 \u548c RAID 0 \u7684\u7ed3\u5408\uff0c\u4e5f \u53eb RAID 1+0\u3002\u5148\u5bf9\u78c1\u76d8\u505a\u955c\u50cf\uff0c \u518d\u6761\u5e26\u8bdd\uff0c\u4f7f\u5176\u517c\u5177 RAID 1 \u7684\u53ef\u9760\u6027\u548cRAID 0\u7684\u4f18\u826f\u5e76\u53d1\u8bfb\u5199\u6027\u80fd \u53ef\u9760\u6027\u9ad8\uff0c\u5e76\u53d1\u8bfb\u5199\u6027\u80fd\u4f18 \u826f \u5bb9\u91cf\u4e00\u5b9a\u7684\u8bdd\uff0c\u9700\u8981 2 \u966a \u7684\u78c1\u76d8\uff0c\u6295\u8d44\u6bd4\u8f83\u5927 RAID 4 \u8c61 RAID 0 \u4e00\u6837\u5bf9\u78c1\u76d8\u7ec4\u6761\u5e26 \u5316\uff0c\u4e0d\u540c\u7684\u662f\uff1a\u9700\u8981\u989d\u5916\u589e\u52a0 \u4e00\u4e2a\u78c1\u76d8\uff0c\u7528\u6765\u5199\u5404 Stripe \u7684 \u6821\u9a8c\u7ea0\u9519\u6570\u636e RAID \u4e2d\u7684\u4e00\u4e2a\u78c1\u76d8\u635f\u574f\uff0c\u5176 \u6570\u636e\u53ef\u4ee5\u901a\u8fc7\u6821\u9a8c\u7ea0\u9519\u6570\u636e \u8ba1\u7b97\u51fa\u6765\uff0c\u5177\u6709\u4e00\u5b9a\u5bb9\u9519\u4fdd \u62a4\u80fd\u529b\uff1b\u8bfb\u6570\u636e\u901f\u5ea6\u5feb \u6bcf\u4e2a Stripe \u4e0a\u6570\u636e\u7684\u4fee\u6539 \u90fd\u8981\u5199\u6821\u9a8c\u7ea0\u9519\u5757\uff0c\u5199\u6027 \u80fd\u53d7\u5f71\u54cd\uff1b\u6240\u6709\u7ea0\u9519\u6570\u636e \u90fd\u5728\u540c\u4e00\u78c1\u76d8\u4e0a\uff0c\u98ce\u9669\u5927\uff0c \u4e5f\u4f1a\u5f62\u6210\u4e00\u4e2a\u6027\u80fd\u74f6\u9888\uff1b \u5728\u51fa\u73b0\u574f\u76d8\u65f6\uff0c\u8bfb\u6027\u80fd\u4f1a\u4e0b\u964d RAID 5 \u662f\u5bf9 RAID 4 \u7684\u6539\u8fdb\uff1a\u5c06\u6bcf\u4e00\u4e2a \u6761\u5e26\uff08Stripe\uff09\u7684\u6821\u9a8c\u7ea0\u9519\u6570\u636e \u5757\u4e5f\u5206\u5e03\u5199\u5230\u5404\u4e2a\u78c1\u76d8\uff0c\u800c\u4e0d \u662f\u5199\u5230\u4e00\u4e2a\u7279\u5b9a\u7684\u78c1\u76d8 \u57fa\u672c\u540c RAID 4\uff0c\u53ea\u662f\u5176\u5199\u6027 \u80fd\u548c\u6570\u636e\u4fdd\u62a4\u80fd\u529b\u8981\u66f4\u5f3a\u4e00 \u70b9 \u5199\u6027\u80fd\u4e0d\u53ca RAID 0\u3001RAID 1 \u548c RAID 10\uff0c\u5bb9\u9519\u80fd\u529b\u4e5f\u4e0d \u53ca RAID 1\uff1b\u5728\u51fa\u73b0\u574f\u76d8\u65f6\uff0c \u8bfb\u6027\u80fd\u4f1a\u4e0b\u964d \u6839\u636e\u6570\u636e\u8bfb\u5199\u7684\u7279\u70b9\u3001\u53ef\u9760\u6027\u8981\u6c42\uff0c\u4ee5\u53ca\u6295\u8d44\u9884\u7b97\u7b49\u6765\u9009\u62e9\u5408\u9002\u7684 RAID \u7ea7\u522b\uff0c\u6bd4\u5982\uff1a \u6570\u636e\u8bfb\u5199\u90fd\u5f88\u9891\u7e41\uff0c\u53ef\u9760\u6027\u8981\u6c42\u4e5f\u5f88\u9ad8\uff0c\u6700\u597d\u9009\u62e9 RAID 10\uff1b \u6570\u636e\u8bfb\u5f88\u9891\u7e41\uff0c\u5199\u76f8\u5bf9\u8f83\u5c11\uff0c\u5bf9\u53ef\u9760\u6027\u6709\u4e00\u5b9a\u8981\u6c42\uff0c\u53ef\u4ee5\u9009\u62e9 RAID 5\uff1b \u6570\u636e\u8bfb\u5199\u90fd\u5f88\u9891\u7e41\uff0c\u4f46\u53ef\u9760\u6027\u8981\u6c42\u4e0d\u9ad8\uff0c\u53ef\u4ee5\u9009\u62e9 RAID 0\u3002","title":"1. \u4f7f\u7528\u78c1\u76d8\u9635\u5217"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/#11-raid","text":"\u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u63d0\u4f9b\u7684\u8f6f\u4ef6\u5305\uff0c\u4e5f\u6a21\u62df\u5b9e\u73b0\u4e86\u4e00\u4e9b RAID \u7684\u7279\u6027\uff0c\u4f46\u6027\u80fd\u4e0a\u4e0d\u5982\u786c RAID \u3002 \u6bd4\u5982\uff0cLinux \u4e0b\u7684\u903b\u8f91\u5377\uff08Logical Volume\uff09\u7cfb\u7edf lvm2\uff0c\u652f\u6301\u6761\u5e26\u5316\uff08Stripe\uff09\uff1bLinux \u4e0b\u7684 MD\uff08Multiple Device\uff09\u9a71\u52a8\uff0c\u652f\u6301 RAID 0\u3001RAID 1\u3001RAID 4\u3001RAID 5\u3001RAID 6 \u7b49\u3002","title":"1.1 \u865a\u62df\u6587\u4ef6\u5377\u6216\u8f6f RAID"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/#2-symbolic-links-io","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u521b\u5efa\u7684\u6570\u636e\u5e93\u548c\u8868\u90fd\u5b58\u653e\u5728\u53c2\u6570 datadir \u5b9a\u4e49\u7684\u76ee\u5f55\u4e0b\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684 \u7b26\u53f7\u8fde\u63a5 \uff08Symbolic Links\uff09\u5c06\u4e0d\u540c\u7684\u6570\u636e\u5e93\u6216\u8868\u3001\u7d22\u5f15\u6307\u5411\u4e0d\u540c\u7684\u7269\u7406\u78c1\u76d8\uff0c\u4ece\u800c\u8fbe\u5230\u5206\u5e03\u78c1\u76d8 I/O \u7684\u76ee\u7684\u3002 \u5c06\u4e00\u4e2a\u6570\u636e\u5e93\u6307\u5411\u5176\u4ed6\u7269\u7406\u78c1\u76d8\u3002 \u5176\u65b9\u6cd5\u662f\u5148\u5728\u76ee\u6807\u78c1\u76d8\u4e0a\u521b\u5efa\u76ee\u5f55\uff0c\u7136\u540e\u518d\u521b\u5efa\u4ece MySQL \u6570\u636e\u76ee\u5f55\u5230\u76ee\u6807\u76ee\u5f55\u7684\u7b26\u53f7\u8fde\u63a5\uff1a shell> mkdir /otherdisk/databases/test shell> ln -s /otherdisk/databases/test /path/to/datadir 2 . \u5c06 MyISAM \uff08\u5176\u4ed6\u5b58\u50a8\u5f15\u64ce\u7684\u8868\u4e0d\u652f\u6301\uff09\u8868\u7684\u6570\u636e\u6587\u4ef6\u6216\u7d22\u5f15\u6587\u4ef6\u6307\u5411\u5176\u4ed6\u7269\u7406\u78c1\u76d8\u3002 1 . \u5bf9\u4e8e\u65b0\u5efa\u7684\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 CREATE TABLE\u8bed\u53e5\u4e2d\u589e\u52a0 ` DATA DIRECTORY ` \u548c ` INDEX DIRECTORY ` \u9009\u9879\u6765\u5b8c\u6210\uff08\u5bf9\u4e8e\u5206\u533a\u8868\u65e0\u6548\uff09\uff0c\u4f8b\u5982\uff1a Create table test ( id int primary key , Name varchar ( 20 )) Type = myisam DATA DIRECTORY = '/disk2/data' INDEX DIRECTORY = '/disk3/index' \u200b 2. \u5bf9\u4e8e\u5df2\u6709\u7684\u8868\uff0c\u53ef\u4ee5\u5148\u5c06\u5176\u6570\u636e\u6587\u4ef6\uff08.MYD\uff09\u6216\u7d22\u5f15\u6587\u4ef6\uff08.MYI\uff09\u8f6c\u79fb\u5230\u76ee\u6807\u78c1\u76d8\uff0c\u7136\u540e\u518d\u5efa\u7acb\u7b26\u53f7\u8fde\u63a5\u5373\u53ef\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\u8868\u5b9a\u4e49\u6587\u4ef6\uff08.frm\uff09\u5fc5\u987b\u4f4d\u4e8eMySQL\u6570\u636e\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0c\u4e0d\u80fd\u7528\u7b26\u53f7\u8fde\u63a5\u3002 \u6ce8\u610f \uff1a\u4f7f\u7528Symbolic Links\u5b58\u5728\u4e00\u5b9a\u7684\u5b89\u5168\u98ce\u9669\uff0c\u5982\u679c\u4e0d\u4f7f\u7528Symbolic Links\uff0c\u5e94\u901a\u8fc7\u542f\u52a8\u53c2\u6570 skip-symbolic-links \u7981\u7528\u8fd9\u4e00\u529f\u80fd\u3002","title":"2. \u4f7f\u7528 Symbolic Links \u5206\u5e03 I/O"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/#3-atime","text":"atime \u662f Linux/UNIX \u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5c5e\u6027\uff0c\u6bcf\u5f53\u8bfb\u53d6\u6587\u4ef6\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4f1a\u5c06\u8bfb\u64cd\u4f5c\u53d1\u751f\u7684\u65f6\u95f4\u56de\u5199\u5230\u78c1\u76d8\u4e0a\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u6587\u4ef6\u7cfb\u7edf\u7684 mount \u5c5e\u6027\uff0c\u963b\u6b62\u64cd\u4f5c\u7cfb\u7edf\u5199 atime \u4fe1\u606f\uff0c\u4ee5\u51cf\u8f7b\u78c1\u76d8 I/O \u7684\u8d1f\u62c5\u3002\u5728 Linux \u4e0b\u7684\u5177\u4f53\u505a\u6cd5\u662f\uff1a \u4fee\u6539\u6587\u4ef6\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6 /etc/fstab \uff0c\u6307\u5b9a noatime \u9009\u9879\uff1a LABEL=/home /home ext3 noatime 1 2 \u7136\u540e\u91cd\u65b0 mount \u6587\u4ef6\u7cfb\u7edf\uff1a shell mount -oremount /home \u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u4ee5\u540e\u8bfb /home \u4e0b\u6587\u4ef6\u5c31\u4e0d\u4f1a\u518d\u5199\u78c1\u76d8\u4e86 \u3002","title":"3. \u7981\u6b62\u64cd\u4f5c\u7cfb\u7edf\u66f4\u65b0\u6587\u4ef6\u7684 atime \u5c5e\u6027"},{"location":"mysql/29. MySQL\u78c1\u76d8 IO \u95ee\u9898/#4-raw-device-innodb","text":"MyISAM \u5b58\u50a8\u5f15\u64ce\u6709\u81ea\u5df1\u7684\u7d22\u5f15\u7f13\u5b58\u673a\u5236\uff0c\u4f46 \u6570\u636e\u6587\u4ef6\u7684\u8bfb\u5199\u5b8c\u5168\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf \uff0c\u64cd\u4f5c\u7cfb\u7edf\u78c1\u76d8 I/O \u7f13\u5b58\u5bf9 MyISAM \u8868\u7684\u5b58\u53d6\u5f88\u91cd\u8981\u3002 \u4f46 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e0e MyISAM \u4e0d\u540c\u5b83\u91c7\u7528\u7c7b\u4f3c Oracle \u7684\u6570\u636e\u7f13\u5b58\u673a\u5236\u6765 Cache \u7d22\u5f15\u548c\u6570\u636e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u78c1\u76d8 I/O \u7f13\u5b58\u5bf9\u5176\u6027\u80fd\u4e0d\u4ec5\u6ca1\u6709\u5e2e\u52a9\uff0c\u751a\u81f3\u8fd8\u6709\u53cd\u4f5c\u7528\u3002 \u56e0\u6b64\uff0c\u5728 InnoDB \u7f13\u5b58\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 Raw device \u6765\u5b58\u653e InnoDB \u5171\u4eab\u8868\u7a7a\u95f4\uff1a \u4fee\u6539MySQL\u914d\u7f6e\u6587\u4ef6\uff0c\u5728 innodb_data_file_path \u53c2\u6570\u4e2d\u589e\u52a0\u88f8\u8bbe\u5907\u6587\u4ef6\u540d\u5e76\u6307\u5b9anewraw\u5c5e\u6027\uff1a [mysqld] innodb_data_home_dir = innodb_data_file_path = /dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw \u542f\u52a8MySQL\uff0c\u4f7f\u5176\u5b8c\u6210\u5206\u533a\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u5173\u95edMySQL\u3002\u6b64\u65f6\u8fd8\u4e0d\u80fd\u521b\u5efa\u6216\u4fee\u6539InnoDB\u8868\u3002 \u5c06 innodb_data_file_path \u4e2d\u7684newraw\u6539\u6210raw \uff1a ...... class = programlisting [ mysqld ] innodb_data_home_dir = innodb_data_file_path =/ dev / hdd1 : 3 Graw ; / dev / hdd2 : 2 Graw ...... \u91cd\u65b0\u542f\u52a8\u5373\u53ef\u5f00\u59cb\u4f7f\u7528\u3002","title":"4. \u7528\u88f8\u8bbe\u5907\uff08Raw Device\uff09\u5b58\u653e InnoDB \u7684\u5171\u4eab\u8868\u7a7a\u95f4"},{"location":"mysql/3. \u7ba1\u7406\u6570\u636e\u5e93/","text":"1. \u6570\u636e\u5e93 \u00b6 \u5217\u51fa\u6240\u6709\u7684\u6570\u636e\u5e93\uff1a SHOW DATABASES; \u5207\u6362\u6570\u636e\u5e93\uff1a USE <database-name>; \u521b\u5efa\u6570\u636e\u5e93\uff1a CREATE DATABASE <database-name>; \u5220\u9664\u6570\u636e\u5e93\uff1a DROP DATABASE <database-name>; \u6ce8\u610f \uff1a\u5220\u9664\u4e00\u4e2a\u6570\u636e\u5e93\u5c06\u5bfc\u81f4\u8be5\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\u5168\u90e8\u88ab\u5220\u9664\u3002 2. \u8868 \u00b6 \u9700\u8981\u5148\u5207\u6362\u6570\u636e\u5e93\u3002 \u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u7684\u6240\u6709\u7684\u8868\uff1a SHOW TABLES; \u521b\u5efa\u8868\uff1a CREATE TABLE <table-name>; \u5220\u9664\u8868\uff1a DROP TABLE <table-name>; \u67e5\u770b\u8868\u7ed3\u6784\uff1a DESC <table-name> \u6216 DESCRIBE <table-name>; \u67e5\u770b\u521b\u5efa\u8868\u7684SQL\u8bed\u53e5\uff1a SHOW CREATE TABLE <table-name>; \u67e5\u770b\u8868\u4e2d\u6240\u6709\u7684\u7d22\u5f15\uff1a SHOW INDEX FROM CHILD; \u4fee\u6539\u8868\uff1a \u589e\u52a0\u5217\uff1a ALTER TABLE <table-name> ADD COLUMN <column-define>; \u4fee\u6539\u5217\uff1a ALTER TABLE <table-name> MODIFY COLUMN <column-name> <column-define>; \u5220\u9664\u5217\uff1a ALTER TABLE <table-name> DROP COLUMN <column-name>; \u6e05\u7a7a\u8868\uff1a TRUNCATE [TABLE] tbl_name \u200b \u6e05\u7a7a\u8868\u5b9e\u9645\u4e0a\u662f\u5148\u5220\u9664\u8868\u7136\u540e\u518d\u4ece\u65b0\u521b\u5efa\u8868\uff0c\u6bd4\u4e00\u884c\u884c\u5730\u5220\u9664\u6570\u636e\u8981\u5feb\uff0c\u4e5f\u56e0\u6b64\u4e0d\u53ef\u56de\u6eda\u3002\u8981\u6c42\u5f53\u524d\u7528\u6237\u6709\u5220\u9664\u8868\u7684\u6743\u9650\u3002","title":"3. \u7ba1\u7406\u6570\u636e\u5e93"},{"location":"mysql/3. \u7ba1\u7406\u6570\u636e\u5e93/#1","text":"\u5217\u51fa\u6240\u6709\u7684\u6570\u636e\u5e93\uff1a SHOW DATABASES; \u5207\u6362\u6570\u636e\u5e93\uff1a USE <database-name>; \u521b\u5efa\u6570\u636e\u5e93\uff1a CREATE DATABASE <database-name>; \u5220\u9664\u6570\u636e\u5e93\uff1a DROP DATABASE <database-name>; \u6ce8\u610f \uff1a\u5220\u9664\u4e00\u4e2a\u6570\u636e\u5e93\u5c06\u5bfc\u81f4\u8be5\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\u5168\u90e8\u88ab\u5220\u9664\u3002","title":"1. \u6570\u636e\u5e93"},{"location":"mysql/3. \u7ba1\u7406\u6570\u636e\u5e93/#2","text":"\u9700\u8981\u5148\u5207\u6362\u6570\u636e\u5e93\u3002 \u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u7684\u6240\u6709\u7684\u8868\uff1a SHOW TABLES; \u521b\u5efa\u8868\uff1a CREATE TABLE <table-name>; \u5220\u9664\u8868\uff1a DROP TABLE <table-name>; \u67e5\u770b\u8868\u7ed3\u6784\uff1a DESC <table-name> \u6216 DESCRIBE <table-name>; \u67e5\u770b\u521b\u5efa\u8868\u7684SQL\u8bed\u53e5\uff1a SHOW CREATE TABLE <table-name>; \u67e5\u770b\u8868\u4e2d\u6240\u6709\u7684\u7d22\u5f15\uff1a SHOW INDEX FROM CHILD; \u4fee\u6539\u8868\uff1a \u589e\u52a0\u5217\uff1a ALTER TABLE <table-name> ADD COLUMN <column-define>; \u4fee\u6539\u5217\uff1a ALTER TABLE <table-name> MODIFY COLUMN <column-name> <column-define>; \u5220\u9664\u5217\uff1a ALTER TABLE <table-name> DROP COLUMN <column-name>; \u6e05\u7a7a\u8868\uff1a TRUNCATE [TABLE] tbl_name \u200b \u6e05\u7a7a\u8868\u5b9e\u9645\u4e0a\u662f\u5148\u5220\u9664\u8868\u7136\u540e\u518d\u4ece\u65b0\u521b\u5efa\u8868\uff0c\u6bd4\u4e00\u884c\u884c\u5730\u5220\u9664\u6570\u636e\u8981\u5feb\uff0c\u4e5f\u56e0\u6b64\u4e0d\u53ef\u56de\u6eda\u3002\u8981\u6c42\u5f53\u524d\u7528\u6237\u6709\u5220\u9664\u8868\u7684\u6743\u9650\u3002","title":"2. \u8868"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/","text":"MySQL\u5de5\u5177\u96c6 1. mysql\uff08\u5ba2\u6237\u7aef\u8fde\u63a5\u5de5\u5177\uff09 \u00b6 mysql [ OPTIONS ] [ database ] \u5e38\u7528\u8fde\u63a5\u9009\u9879\uff1a - u , --user=name \u6307\u5b9a\u7528\u6237\u540d - p , --password[=name] \u6307\u5b9a\u5bc6\u7801 - h , --host=name \u6307\u5b9a\u670d\u52a1\u5668 IP \u6216\u8005\u57df\u540d - P , --port=# \u6307\u5b9a\u8fde\u63a5\u7aef\u53e3 - e , --execute=SQL \u6267\u884c SQL \u8bed\u53e5\u5e76\u9000\u51fa f , -- force \u5f3a\u5236\u6267\u884c SQL - v , -- verbose \u663e\u793a\u66f4\u591a\u4fe1\u606f -- show - warnings \u663e\u793a\u8b66\u544a\u4fe1\u606f \u5728\u4e00\u4e2a\u6279\u91cf\u6267\u884c\u7684 SQL \u4e2d\uff0c\u5982\u679c\u6709\u5176\u4e2d\u4e00\u4e2a SQL \u6267\u884c\u51fa\u9519\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8be5\u6279\u5904\u7406\u5c06\u505c\u6b62\u9000\u51fa\u3002\u52a0\u4e0a-f \u9009\u9879\uff0c\u5219\u8df3\u8fc7\u51fa\u9519 SQL\uff0c\u5f3a\u5236\u6267\u884c\u540e\u9762 SQL\uff1b\u52a0\u4e0a-v \u9009\u9879\uff0c\u5219\u663e\u793a\u51fa\u9519\u7684 SQL \u8bed\u53e5\uff1b\u52a0\u4e0a--show-warnings\uff0c\u5219\u4f1a\u663e\u793a\u5168\u90e8\u9519\u8bef\u4fe1\u606f\u3002 2. myisampack\uff08MyISAM \u8868\u538b\u7f29\u5de5\u5177\uff09 \u00b6 \u53ef\u4ee5\u4f7f\u7528\u5f88\u9ad8\u7684\u538b\u7f29\u7387\u6765\u5bf9 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u8fdb\u884c\u538b\u7f29\uff0c\u4f7f\u5f97\u538b\u7f29\u540e\u7684\u8868\u5360\u7528\u6bd4\u538b\u7f29\u524d\u5c0f\u5f97\u591a\u7684\u78c1\u76d8\u7a7a\u95f4\u3002\u4f46\u662f\u538b\u7f29\u540e\u7684\u8868\u4e5f\u5c06\u6210\u4e3a\u4e00\u4e2a\u53ea\u8bfb\u8868\uff0c\u4e0d\u80fd\u8fdb\u884c DML \u64cd\u4f5c\u3002 myisampack [ OPTIONS ] filename ... filename\u662f\u8868\u540d\u3002 3. mysqladmin\uff08MySQL \u7ba1\u7406\u5de5\u5177\uff09 \u00b6 mysqladmin \u662f\u4e00\u4e2a\u6267\u884c\u7ba1\u7406\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\u3002\u53ef\u4ee5\u7528\u5b83\u6765\u68c0\u67e5\u670d\u52a1\u5668\u7684\u914d\u7f6e\u548c\u5f53\u524d\u7684\u72b6\u6001\uff0c\u521b\u5efa\u5e76\u5220\u9664\u6570\u636e\u5e93\u7b49\u3002 \u4e0e mysql \u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5b83\u66f4\u4fa7\u91cd\u4e8e\u4e00\u4e9b\u7ba1\u7406\u65b9\u9762\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u5173\u95ed\u6570\u636e\u5e93\u3002 4. mysqlbinlog\uff08\u65e5\u5fd7\u7ba1\u7406\u5de5\u5177\uff09 \u00b6 \u67e5\u770b\u670d\u52a1\u5668\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08 /var/lib/mysql \u4e0b\u7684 binlog.XXX \uff09\u3002 mysqlbinlog [ options ] log - files \u5e38\u7528\u9009\u9879\uff1a - d , --database=name \u6307\u5b9a\u6570\u636e\u5e93\u540d\u79f0\uff0c\u53ea\u5217\u51fa\u6307\u5b9a\u7684\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c\u3002 - o , --offset=# \u5ffd\u7565\u6389\u65e5\u5fd7\u4e2d\u7684\u524d n \u884c\u547d\u4ee4 - r , --result-file=name \u5c06\u8f93\u51fa\u7684\u6587\u672c\u683c\u5f0f\u65e5\u5fd7\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6 - s , --short-form \u663e\u793a\u7b80\u5355\u683c\u5f0f\uff0c\u7701\u7565\u6389\u4e00\u4e9b\u4fe1\u606f --set-charset=char-name\uff1a\u5728\u8f93\u51fa\u4e3a\u6587\u672c\u683c\u5f0f\u65f6\uff0c\u5728\u6587\u4ef6\u7b2c\u4e00\u884c\u52a0\u4e0a\"set names char-name\"\uff0c\u8fd9\u4e2a\u9009\u9879\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u88c5\u8f7d\u6570\u636e\u65f6\uff0c\u975e\u5e38\u6709\u7528\u3002 --start-datetime=name --stop-datetime=name\uff1a\u6307\u5b9a\u65e5\u671f\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7 --start-position=# --stop-position=#\uff1a\u6307\u5b9a\u4f4d\u7f6e\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7 5. mysqlcheck\uff08\u8868\u7ef4\u62a4\u5de5\u5177\uff09 \u00b6 mysqlcheck \u5ba2\u6237\u7aef\u6267\u884c\u8868\u7ef4\u62a4\uff1a\u5b83\u68c0\u67e5\uff0c\u4fee\u590d\uff0c\u4f18\u5316\u6216\u5206\u6790\u8868\u3002 mysqlcheck [ OPTIONS ] database [ tables ] mysqlcheck [ OPTIONS ] --databases DB1 [DB2 DB3...] mysqlcheck [ OPTIONS ] --all-databases \u5e38\u7528\u9009\u9879\uff1a - c , --check \u68c0\u67e5\u8868\u3002\u9ed8\u8ba4\u9009\u9879\u3002 - r , --repair \u4fee\u590d\u8868 - a , --analyze \u5206\u6790\u8868 - o , --optimize \u4f18\u5316\u8868 6. mysqldump\uff08\u6570\u636e\u5907\u4efd\u5de5\u5177\uff09 \u00b6 mysqldump \u5ba2\u6237\u7aef\u5de5\u5177\u7528\u6765\u5907\u4efd\u6570\u636e\u5e93\u6216\u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5907\u4efd\u5185\u5bb9\u5305\u542b\u521b\u5efa\u8868\u6216\u88c5\u8f7d\u8868\u7684 SQL \u8bed\u53e5\u3002 mysqldump [ OPTIONS ] database [ tables ] mysqldump [ OPTIONS ] --databases [OPTIONS] DB1 [DB2 DB3...] mysqldump [ OPTIONS ] --all-databases [OPTIONS] \u9ed8\u8ba4\u8f93\u51fa\u5230 \u6807\u51c6\u8f93\u51fa \u3002 \u5e38\u7528\u9009\u9879\uff1a - u , --user=name \u6307\u5b9a\u7528\u6237\u540d \u2013 p , --password[=name] \u6307\u5b9a\u5bc6\u7801 \u2013 h , --host=name \u6307\u5b9a\u670d\u52a1\u5668 IP \u6216\u8005\u57df\u540d \u2013 P , --port=# \u6307\u5b9a\u8fde\u63a5\u7aef\u53e3 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u4f1a\u81ea\u52a8\u6dfb\u52a0 --add-drop-database \u6bcf\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a DROP DATABASE \u8bed\u53e5 --add-drop-table \u5728\u6bcf\u4e2a\u8868\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a DROP TABLE \u8bed\u53e5 - n , --no-create-db \u4e0d\u5305\u542b\u6570\u636e\u5e93\u7684\u521b\u5efa\u8bed\u53e5 - t , --no-create-info \u4e0d\u5305\u542b\u6570\u636e\u8868\u7684\u521b\u5efa\u8bed\u53e5 d , --no-data \u4e0d\u5305\u542b\u6570\u636e - T , --tab=name\uff08\u5907\u4efd\u6570\u636e\u548c\u5efa\u8868\u8bed\u53e5\uff09 --fields-terminated-by=name\uff08\u57df\u5206\u9694\u7b26\uff09 --fields-enclosed-by=name\uff08\u57df\u5f15\u7528\u7b26\uff09 --fields-optionally-enclosed-by=name\uff08\u57df\u53ef\u9009\u5f15\u7528\u7b26\uff09 --fields-escaped-by=name\uff08\u8f6c\u4e49\u5b57\u7b26\uff09 --default-character-set=name \u8bbe\u7f6e\u5bfc\u51fa\u7684\u5ba2\u6237\u7aef\u5b57\u7b26\u96c6\uff0c\u8fd9\u4e2a\u9009\u9879\u5728\u5bfc\u51fa\u6570\u636e\u5e93\u7684\u65f6\u5019\u975e\u5e38\u91cd\u8981\u3002\u6700\u597d\u4e0e\u8868\u7684\u5b57\u7b26\u96c6\u4e00\u81f4\u3002 - F --flush-logs \u5907\u4efd\u524d\u5237\u65b0\u65e5\u5fd7\u3002\u5907\u4efd\u524d\u5c06\u5173\u95ed\u65e7\u65e5\u5fd7\uff0c\u751f\u6210\u65b0\u65e5\u5fd7\u3002\u4f7f\u5f97\u8fdb\u884c\u6062\u590d\u7684\u65f6\u5019\u76f4\u63a5\u4ece\u65b0\u65e5\u5fd7\u5f00\u59cb\u8fdb\u884c\u91cd\u505a\uff0c\u5927\u5927\u65b9\u4fbf\u4e86\u6062\u590d\u8fc7\u7a0b\u3002\u5173\u95ed\u5f53\u524d\u4f7f\u7528\u7684binary log\uff0c\u7136\u540e\u6253\u5f00\u4e00\u4e2a\u65b0\u7684binary log\u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5e8f\u53f7\u52a01\u3002https://www.cnblogs.com/chuanzhang053/p/8709954.html - l --lock-tables \u7ed9\u6240\u6709\u8868\u52a0\u8bfb\u9501 $ mysqldump -uroot -pMyNewPassword1! blog t1 > a 7. mysqlpump\uff08\u6570\u636e\u5907\u4efd\u5de5\u5177\uff09 \u00b6 // TODO 8. mysqlimport\uff08\u6570\u636e\u5bfc\u5165\u5de5\u5177\uff09 \u00b6 \u5ba2\u6237\u7aef\u6570\u636e\u5bfc\u5165\u5de5\u5177\uff0c\u7528\u6765\u5bfc\u5165 mysqldump \u52a0-T \u9009\u9879\u540e\u5bfc\u51fa\u7684\u6587\u672c\u6587\u4ef6\u3002\u5b83\u5b9e\u9645\u4e0a\u662f\u5ba2\u6237\u7aef\u63d0\u4f9b\u4e86 LOAD DATA INFILEQL \u8bed\u53e5\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u63a5\u53e3\u3002 mysqlimport [ OPTIONS ] database textfile ... 9. mysqlshow\uff08\u6570\u636e\u5e93\u5bf9\u8c61\u67e5\u770b\u5de5\u5177\uff09 \u00b6 \u5c55\u793a\u4e00\u4e2aMySQL\u6570\u636e\u5e93\u7684\u7ed3\u6784\uff08databases, tables, and columns\uff09\u3002 mysqlshow [ OPTIONS ] [ database [table [column ] ]] \u5e38\u7528\u9009\u9879 \uff1a -- count \u663e\u793a\u6570\u636e\u5e93\u548c\u8868\u7684\u7edf\u8ba1\u4fe1\u606f - k -- keys \u663e\u793a\u6307\u5b9a\u8868\u4e2d\u7684\u6240\u6709\u7d22\u5f15 - i -- status \u663e\u793a\u8868\u7684\u4e00\u4e9b\u72b6\u6001\u4fe1\u606f\u3002\u548c mysql \u5ba2\u6237\u7aef\u6267\u884c\u201c show table status from test like ' emp ' \u201d\u7684\u7ed3\u679c\u5b8c\u5168\u4e00\u81f4 10. mysqlslap\uff08\u6570\u636e\u5e93\u8bca\u65ad\u5de5\u5177\uff09 \u00b6 mysqlslap\u662f\u4e00\u4e2a\u8bca\u65ad\u7a0b\u5e8f\uff0c\u65e8\u5728\u6a21\u62dfMySQL\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5e76\u62a5\u544a\u6bcf\u4e2a\u9636\u6bb5\u7684\u65f6\u95f4\u3002\u5b83\u5c31\u50cf\u591a\u4e2a\u5ba2\u6237\u7aef\u6b63\u5728\u8bbf\u95ee\u670d\u52a1\u5668\u4e00\u6837\u3002 // TODO 11. perror\uff08\u9519\u8bef\u4ee3\u7801\u67e5\u770b\u5de5\u5177\uff09 \u00b6 \u6253\u5370\u7cfb\u7edf\u9519\u8bef\u4ee3\u7801\u6216 MySQL \u9519\u8bef\u4ee3\u7801\u7684\u8bf4\u660e\u3002 perror [ OPTIONS ] [ ERRORCODE [ERRORCODE... ] ]","title":"30. MySQL \u5e38\u7528\u5de5\u5177"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#1-mysql","text":"mysql [ OPTIONS ] [ database ] \u5e38\u7528\u8fde\u63a5\u9009\u9879\uff1a - u , --user=name \u6307\u5b9a\u7528\u6237\u540d - p , --password[=name] \u6307\u5b9a\u5bc6\u7801 - h , --host=name \u6307\u5b9a\u670d\u52a1\u5668 IP \u6216\u8005\u57df\u540d - P , --port=# \u6307\u5b9a\u8fde\u63a5\u7aef\u53e3 - e , --execute=SQL \u6267\u884c SQL \u8bed\u53e5\u5e76\u9000\u51fa f , -- force \u5f3a\u5236\u6267\u884c SQL - v , -- verbose \u663e\u793a\u66f4\u591a\u4fe1\u606f -- show - warnings \u663e\u793a\u8b66\u544a\u4fe1\u606f \u5728\u4e00\u4e2a\u6279\u91cf\u6267\u884c\u7684 SQL \u4e2d\uff0c\u5982\u679c\u6709\u5176\u4e2d\u4e00\u4e2a SQL \u6267\u884c\u51fa\u9519\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u8be5\u6279\u5904\u7406\u5c06\u505c\u6b62\u9000\u51fa\u3002\u52a0\u4e0a-f \u9009\u9879\uff0c\u5219\u8df3\u8fc7\u51fa\u9519 SQL\uff0c\u5f3a\u5236\u6267\u884c\u540e\u9762 SQL\uff1b\u52a0\u4e0a-v \u9009\u9879\uff0c\u5219\u663e\u793a\u51fa\u9519\u7684 SQL \u8bed\u53e5\uff1b\u52a0\u4e0a--show-warnings\uff0c\u5219\u4f1a\u663e\u793a\u5168\u90e8\u9519\u8bef\u4fe1\u606f\u3002","title":"1. mysql\uff08\u5ba2\u6237\u7aef\u8fde\u63a5\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#2-myisampackmyisam","text":"\u53ef\u4ee5\u4f7f\u7528\u5f88\u9ad8\u7684\u538b\u7f29\u7387\u6765\u5bf9 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u8fdb\u884c\u538b\u7f29\uff0c\u4f7f\u5f97\u538b\u7f29\u540e\u7684\u8868\u5360\u7528\u6bd4\u538b\u7f29\u524d\u5c0f\u5f97\u591a\u7684\u78c1\u76d8\u7a7a\u95f4\u3002\u4f46\u662f\u538b\u7f29\u540e\u7684\u8868\u4e5f\u5c06\u6210\u4e3a\u4e00\u4e2a\u53ea\u8bfb\u8868\uff0c\u4e0d\u80fd\u8fdb\u884c DML \u64cd\u4f5c\u3002 myisampack [ OPTIONS ] filename ... filename\u662f\u8868\u540d\u3002","title":"2. myisampack\uff08MyISAM \u8868\u538b\u7f29\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#3-mysqladminmysql","text":"mysqladmin \u662f\u4e00\u4e2a\u6267\u884c\u7ba1\u7406\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\u3002\u53ef\u4ee5\u7528\u5b83\u6765\u68c0\u67e5\u670d\u52a1\u5668\u7684\u914d\u7f6e\u548c\u5f53\u524d\u7684\u72b6\u6001\uff0c\u521b\u5efa\u5e76\u5220\u9664\u6570\u636e\u5e93\u7b49\u3002 \u4e0e mysql \u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5b83\u66f4\u4fa7\u91cd\u4e8e\u4e00\u4e9b\u7ba1\u7406\u65b9\u9762\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u5173\u95ed\u6570\u636e\u5e93\u3002","title":"3. mysqladmin\uff08MySQL \u7ba1\u7406\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#4-mysqlbinlog","text":"\u67e5\u770b\u670d\u52a1\u5668\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08 /var/lib/mysql \u4e0b\u7684 binlog.XXX \uff09\u3002 mysqlbinlog [ options ] log - files \u5e38\u7528\u9009\u9879\uff1a - d , --database=name \u6307\u5b9a\u6570\u636e\u5e93\u540d\u79f0\uff0c\u53ea\u5217\u51fa\u6307\u5b9a\u7684\u6570\u636e\u5e93\u76f8\u5173\u64cd\u4f5c\u3002 - o , --offset=# \u5ffd\u7565\u6389\u65e5\u5fd7\u4e2d\u7684\u524d n \u884c\u547d\u4ee4 - r , --result-file=name \u5c06\u8f93\u51fa\u7684\u6587\u672c\u683c\u5f0f\u65e5\u5fd7\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6 - s , --short-form \u663e\u793a\u7b80\u5355\u683c\u5f0f\uff0c\u7701\u7565\u6389\u4e00\u4e9b\u4fe1\u606f --set-charset=char-name\uff1a\u5728\u8f93\u51fa\u4e3a\u6587\u672c\u683c\u5f0f\u65f6\uff0c\u5728\u6587\u4ef6\u7b2c\u4e00\u884c\u52a0\u4e0a\"set names char-name\"\uff0c\u8fd9\u4e2a\u9009\u9879\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u88c5\u8f7d\u6570\u636e\u65f6\uff0c\u975e\u5e38\u6709\u7528\u3002 --start-datetime=name --stop-datetime=name\uff1a\u6307\u5b9a\u65e5\u671f\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7 --start-position=# --stop-position=#\uff1a\u6307\u5b9a\u4f4d\u7f6e\u95f4\u9694\u5185\u7684\u6240\u6709\u65e5\u5fd7","title":"4. mysqlbinlog\uff08\u65e5\u5fd7\u7ba1\u7406\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#5-mysqlcheck","text":"mysqlcheck \u5ba2\u6237\u7aef\u6267\u884c\u8868\u7ef4\u62a4\uff1a\u5b83\u68c0\u67e5\uff0c\u4fee\u590d\uff0c\u4f18\u5316\u6216\u5206\u6790\u8868\u3002 mysqlcheck [ OPTIONS ] database [ tables ] mysqlcheck [ OPTIONS ] --databases DB1 [DB2 DB3...] mysqlcheck [ OPTIONS ] --all-databases \u5e38\u7528\u9009\u9879\uff1a - c , --check \u68c0\u67e5\u8868\u3002\u9ed8\u8ba4\u9009\u9879\u3002 - r , --repair \u4fee\u590d\u8868 - a , --analyze \u5206\u6790\u8868 - o , --optimize \u4f18\u5316\u8868","title":"5. mysqlcheck\uff08\u8868\u7ef4\u62a4\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#6-mysqldump","text":"mysqldump \u5ba2\u6237\u7aef\u5de5\u5177\u7528\u6765\u5907\u4efd\u6570\u636e\u5e93\u6216\u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u8fc1\u79fb\u3002\u5907\u4efd\u5185\u5bb9\u5305\u542b\u521b\u5efa\u8868\u6216\u88c5\u8f7d\u8868\u7684 SQL \u8bed\u53e5\u3002 mysqldump [ OPTIONS ] database [ tables ] mysqldump [ OPTIONS ] --databases [OPTIONS] DB1 [DB2 DB3...] mysqldump [ OPTIONS ] --all-databases [OPTIONS] \u9ed8\u8ba4\u8f93\u51fa\u5230 \u6807\u51c6\u8f93\u51fa \u3002 \u5e38\u7528\u9009\u9879\uff1a - u , --user=name \u6307\u5b9a\u7528\u6237\u540d \u2013 p , --password[=name] \u6307\u5b9a\u5bc6\u7801 \u2013 h , --host=name \u6307\u5b9a\u670d\u52a1\u5668 IP \u6216\u8005\u57df\u540d \u2013 P , --port=# \u6307\u5b9a\u8fde\u63a5\u7aef\u53e3 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u4f1a\u81ea\u52a8\u6dfb\u52a0 --add-drop-database \u6bcf\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a DROP DATABASE \u8bed\u53e5 --add-drop-table \u5728\u6bcf\u4e2a\u8868\u521b\u5efa\u8bed\u53e5\u524d\u52a0\u4e0a DROP TABLE \u8bed\u53e5 - n , --no-create-db \u4e0d\u5305\u542b\u6570\u636e\u5e93\u7684\u521b\u5efa\u8bed\u53e5 - t , --no-create-info \u4e0d\u5305\u542b\u6570\u636e\u8868\u7684\u521b\u5efa\u8bed\u53e5 d , --no-data \u4e0d\u5305\u542b\u6570\u636e - T , --tab=name\uff08\u5907\u4efd\u6570\u636e\u548c\u5efa\u8868\u8bed\u53e5\uff09 --fields-terminated-by=name\uff08\u57df\u5206\u9694\u7b26\uff09 --fields-enclosed-by=name\uff08\u57df\u5f15\u7528\u7b26\uff09 --fields-optionally-enclosed-by=name\uff08\u57df\u53ef\u9009\u5f15\u7528\u7b26\uff09 --fields-escaped-by=name\uff08\u8f6c\u4e49\u5b57\u7b26\uff09 --default-character-set=name \u8bbe\u7f6e\u5bfc\u51fa\u7684\u5ba2\u6237\u7aef\u5b57\u7b26\u96c6\uff0c\u8fd9\u4e2a\u9009\u9879\u5728\u5bfc\u51fa\u6570\u636e\u5e93\u7684\u65f6\u5019\u975e\u5e38\u91cd\u8981\u3002\u6700\u597d\u4e0e\u8868\u7684\u5b57\u7b26\u96c6\u4e00\u81f4\u3002 - F --flush-logs \u5907\u4efd\u524d\u5237\u65b0\u65e5\u5fd7\u3002\u5907\u4efd\u524d\u5c06\u5173\u95ed\u65e7\u65e5\u5fd7\uff0c\u751f\u6210\u65b0\u65e5\u5fd7\u3002\u4f7f\u5f97\u8fdb\u884c\u6062\u590d\u7684\u65f6\u5019\u76f4\u63a5\u4ece\u65b0\u65e5\u5fd7\u5f00\u59cb\u8fdb\u884c\u91cd\u505a\uff0c\u5927\u5927\u65b9\u4fbf\u4e86\u6062\u590d\u8fc7\u7a0b\u3002\u5173\u95ed\u5f53\u524d\u4f7f\u7528\u7684binary log\uff0c\u7136\u540e\u6253\u5f00\u4e00\u4e2a\u65b0\u7684binary log\u6587\u4ef6\uff0c\u6587\u4ef6\u7684\u5e8f\u53f7\u52a01\u3002https://www.cnblogs.com/chuanzhang053/p/8709954.html - l --lock-tables \u7ed9\u6240\u6709\u8868\u52a0\u8bfb\u9501 $ mysqldump -uroot -pMyNewPassword1! blog t1 > a","title":"6. mysqldump\uff08\u6570\u636e\u5907\u4efd\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#7-mysqlpump","text":"// TODO","title":"7. mysqlpump\uff08\u6570\u636e\u5907\u4efd\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#8-mysqlimport","text":"\u5ba2\u6237\u7aef\u6570\u636e\u5bfc\u5165\u5de5\u5177\uff0c\u7528\u6765\u5bfc\u5165 mysqldump \u52a0-T \u9009\u9879\u540e\u5bfc\u51fa\u7684\u6587\u672c\u6587\u4ef6\u3002\u5b83\u5b9e\u9645\u4e0a\u662f\u5ba2\u6237\u7aef\u63d0\u4f9b\u4e86 LOAD DATA INFILEQL \u8bed\u53e5\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u63a5\u53e3\u3002 mysqlimport [ OPTIONS ] database textfile ...","title":"8. mysqlimport\uff08\u6570\u636e\u5bfc\u5165\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#9-mysqlshow","text":"\u5c55\u793a\u4e00\u4e2aMySQL\u6570\u636e\u5e93\u7684\u7ed3\u6784\uff08databases, tables, and columns\uff09\u3002 mysqlshow [ OPTIONS ] [ database [table [column ] ]] \u5e38\u7528\u9009\u9879 \uff1a -- count \u663e\u793a\u6570\u636e\u5e93\u548c\u8868\u7684\u7edf\u8ba1\u4fe1\u606f - k -- keys \u663e\u793a\u6307\u5b9a\u8868\u4e2d\u7684\u6240\u6709\u7d22\u5f15 - i -- status \u663e\u793a\u8868\u7684\u4e00\u4e9b\u72b6\u6001\u4fe1\u606f\u3002\u548c mysql \u5ba2\u6237\u7aef\u6267\u884c\u201c show table status from test like ' emp ' \u201d\u7684\u7ed3\u679c\u5b8c\u5168\u4e00\u81f4","title":"9. mysqlshow\uff08\u6570\u636e\u5e93\u5bf9\u8c61\u67e5\u770b\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#10-mysqlslap","text":"mysqlslap\u662f\u4e00\u4e2a\u8bca\u65ad\u7a0b\u5e8f\uff0c\u65e8\u5728\u6a21\u62dfMySQL\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8d1f\u8f7d\u5e76\u62a5\u544a\u6bcf\u4e2a\u9636\u6bb5\u7684\u65f6\u95f4\u3002\u5b83\u5c31\u50cf\u591a\u4e2a\u5ba2\u6237\u7aef\u6b63\u5728\u8bbf\u95ee\u670d\u52a1\u5668\u4e00\u6837\u3002 // TODO","title":"10. mysqlslap\uff08\u6570\u636e\u5e93\u8bca\u65ad\u5de5\u5177\uff09"},{"location":"mysql/30. MySQL \u5e38\u7528\u5de5\u5177/#11-perror","text":"\u6253\u5370\u7cfb\u7edf\u9519\u8bef\u4ee3\u7801\u6216 MySQL \u9519\u8bef\u4ee3\u7801\u7684\u8bf4\u660e\u3002 perror [ OPTIONS ] [ ERRORCODE [ERRORCODE... ] ]","title":"11. perror\uff08\u9519\u8bef\u4ee3\u7801\u67e5\u770b\u5de5\u5177\uff09"},{"location":"mysql/31. MySQL \u65e5\u5fd7/","text":"Log Type Information Written to Log Error log \u5728mysqld\u542f\u52a8\u3001\u8fd0\u884c\u3001\u505c\u6b62\u65f6\u53d1\u751f\u7684\u9519\u8bef General query log \u5efa\u7acb\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u548c\u4ece\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u7684\u8bed\u53e5 Binary log \u66f4\u6539\u6570\u636e\u7684\u8bed\u53e5(\u4e5f\u7528\u4e8e\u590d\u5236) Relay log \u4ece\u590d\u5236\u4e3b\u670d\u52a1\u5668\u63a5\u6536\u7684\u6570\u636e\u66f4\u6539 Slow query log \u6267\u884c\u65f6\u95f4\u8d85\u8fc7 long_query_time \u79d2\u7684\u67e5\u8be2\u8bed\u53e5 DDL log (metadata log) DDL \u8bed\u53e5\u6267\u884c\u7684\u5143\u6570\u636e\u64cd\u4f5c \u4e0b\u9762\u4ecb\u7ecd\u56db\u79cd\u65e5\u5fd7\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528\u5e02\u9762\u4e0a\u7684mysql\u5206\u6790\u5de5\u5177\u6839\u636e\u8fd9\u4e9b\u65e5\u5fd7\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5404\u79cd\u7ef4\u62a4\u548c\u8c03\u4f18 \u3002 1. \u9519\u8bef\u65e5\u5fd7 \u00b6 \u5b83\u8bb0\u5f55\u4e86\u5f53 mysqld \u542f\u52a8\u548c\u505c\u6b62\u65f6\uff0c\u4ee5\u53ca\u670d\u52a1\u5668\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4efb\u4f55\u4e25\u91cd\u9519\u8bef\u65f6\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u53ef\u4ee5\u7528 --log-error[=file_name] \u9009\u9879\u6765\u6307\u5b9a mysqld\uff08MySQL \u670d\u52a1\u5668\uff09\u4fdd\u5b58\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u7684\u4f4d\u7f6e\uff08\u4e0d\u6307\u5b9a\u8be5\u53c2\u6570\u65f6\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff09\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u5b9a file_name \u503c\uff0cmysqld \u4f7f\u7528\u9519\u8bef\u65e5\u5fd7\u540d host_name.err \uff08host_name \u4e3a\u4e3b\u673a\u540d\uff09\u5e76\u9ed8\u8ba4\u5728\u53c2\u6570 DATADIR \uff08\u6570\u636e\u76ee\u5f55 /var/lib/mysql \uff09\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\u3002 2. \u4e8c\u8fdb\u5236\u65e5\u5fd7 \u00b6 \u4e8c\u8fdb\u5236\u65e5\u5fd7\uff08BINLOG\uff09\u8bb0\u5f55\u4e86\u6240\u6709\u7684 DDL \uff08\u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff09\u8bed\u53e5\u548c DML \uff08\u6570\u636e\u64cd\u7eb5\u8bed\u8a00\uff09\u8bed\u53e5\uff0c\u4f46\u662f \u4e0d\u5305\u62ec\u6570\u636e\u67e5\u8be2\u8bed\u53e5 \u3002 \u6b64\u65e5\u5fd7\u5bf9\u4e8e\u707e\u96be\u65f6\u7684\u6570\u636e\u6062\u590d\u8d77\u7740\u6781\u5176\u91cd\u8981\u7684\u4f5c\u7528\u3002 2.1 \u65e5\u5fd7\u7684\u5b58\u653e \u00b6 \u9ed8\u8ba4\u5199\u5230 /var/lib/mysql \u76ee\u5f55\u4e2d\u7684 binlog.xxxxxx \u6587\u4ef6\u4e2d\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 --log-bin[=file_name] \u6307\u5b9a\u3002 \u53ef\u901a\u8fc7 mysqlbinlog \u8bfb\u53d6\u65e5\u5fd7\u3002 2.2 \u65e5\u5fd7\u7684\u683c\u5f0f \u00b6 --binlog-format=name \uff0cname\u6709\u4ee5\u4e0b\u4e09\u79cd\uff1a ROW\uff1a\u57fa\u4e8e\u884c\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u5c06\u6bcf\u4e00\u884c\u7684\u53d8\u66f4\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u800c\u4e0d\u662fsql\u8bed\u53e5\u3002\u5373\u53ea\u8981\u67d0\u884c\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5c31\u5c06\u6b64\u884c\u8bb0\u5f55\u8fdb\u53bb\u3002\u4f18\u70b9\u662f\u4f1a\u8bb0\u5f55\u6bcf\u4e00\u884c\u7684\u6570\u636e\u7684\u53d8\u5316\u7ec6\u8282\uff0c\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e9b\u60c5\u51b5\u4e0b\u65e0\u6cd5\u590d\u5236\u7684\u60c5\u51b5\u3002\u7f3a\u70b9\u662f\u65e5\u5fd7\u91cf\u5927\uff0c\u5bf9IO\u5f71\u54cd\u8f83\u5927\u3002 STATEMENT\uff1a\u57fa\u4e8esql\u8bed\u53e5\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u4f18\u70b9\u662f\u65e5\u5fd7\u8bb0\u5f55\u6e05\u6670\u6613\u8bfb\uff0c\u65e5\u5fd7\u91cf\u5c11\uff0c\u5bf9IO\u5f71\u54cd\u5c0f\u3002\u7f3a\u70b9\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0bslave\u7684\u65e5\u5fd7\u590d\u5236\u4f1a\u51fa\u9519\u3002 MIXED\uff1a\u6df7\u5408\u4e86\u524d\u4e24\u79cd\u7684\u65e5\u5fd7\u5f62\u5f0f\u3002\u9ed8\u8ba4\u65e5\u5fd7\u683c\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u91c7\u7528 STATEMENT \uff0c\u7279\u6b8a\u60c5\u51b5\u4e0b\u91c7\u7528 ROW \u3002\u6bd4\u5982\u91c7\u7528NDB\u5f15\u64ce\u65f6\uff0c\u5bf9\u8868\u7684DML\u8bed\u53e5\u5168\u90e8\u91c7\u7528ROW\uff1b\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u4e34\u65f6\u8868\uff1b\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u4e0d\u786e\u5b9a\u51fd\u6570\uff08CURRENT_USER()\u7b49\uff09\u3002\u8be5\u65e5\u5fd7\u683c\u5f0f\u5c3d\u91cf\u5229\u7528\u524d\u4e24\u8005\u7684\u4f18\u70b9\uff0c\u800c\u907f\u5f00\u7f3a\u70b9\u3002 2.3 \u65e5\u5fd7\u7684\u5220\u9664 \u00b6 \u5bf9\u4e8e\u6bd4\u8f83\u7e41\u5fd9\u7684 OLTP\uff08\u5728\u7ebf\u4e8b\u52a1\u5904\u7406\uff09\u7cfb\u7edf\uff0c\u7531\u4e8e\u6bcf\u5929\u751f\u6210\u65e5\u5fd7\u91cf\u5927\uff0c\u8fd9\u4e9b\u65e5\u5fd7\u5982\u679c\u957f\u65f6\u95f4\u4e0d\u6e05\u9664\uff0c\u5c06\u4f1a\u5bf9\u78c1\u76d8\u7a7a\u95f4\u5e26\u6765\u5f88\u5927\u7684\u6d6a\u8d39\u3002 2.3.1 \u65b9\u6cd5 1 \u00b6 \u5229\u7528MySQL\u7684 RESET MASTER \u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u5c06\u5220\u9664\u6240\u6709 BINLOG \u65e5\u5fd7\uff0c\u65b0\u65e5\u5fd7\u7f16\u53f7\u4ece 000001 \u5f00\u59cb\u3002 2.3.2 \u65b9\u6cd5 2 \u00b6 PURGE { BINARY | MASTER } LOGS { TO 'log_name' | BEFORE datetime_expr } \u8be5\u547d\u4ee4\u5c06\u5220\u9664 xxxxxx \u7f16\u53f7\u4e4b\u524d\u6216 datetime_expr \u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7\u3002 PURGE BINARY LOGS TO 'mysql-bin.010' ; PURGE BINARY LOGS BEFORE '2008-04-02 22:46:26' ; 2.3.3 \u65b9\u6cd5 3 \u00b6 \u8bbe\u7f6e\u53c2\u6570 --expire_logs_days=# \uff0c\u6b64\u53c2\u6570\u7684\u542b\u4e49\u662f\u8bbe\u7f6e\u65e5\u5fd7\u7684\u8fc7\u671f\u5929\u6570\uff0c\u8fc7\u4e86\u6307\u5b9a\u7684\u5929\u6570\u540e\u65e5\u5fd7\u5c06\u4f1a\u88ab\u81ea\u52a8\u5220\u9664 \u3002 \u8fd8\u6709\u4e00\u4e2a\u76f8\u4f3c\u7684\u53c2\u6570\uff1a --binlog-expire-logs-seconds \uff0c\u9ed8\u8ba4\u503c\u662f30\u5929\uff0c\u4e24\u8005\u540c\u65f6\u8bbe\u7f6e\u65f6\uff0c\u8be5\u53c2\u6570\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002 2.4 \u5176\u4ed6\u9009\u9879 \u00b6 MySQL \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5176\u4ed6\u53c2\u6570\u9009\u9879\u6765\u8fdb\u884c\u66f4\u5c0f\u7c92\u5ea6\u7684\u7ba1\u7406 \u3002 --binlog-do-db=db_name \u4f5c\u7528\u662f\u544a\u77e5\u4e3b\u670d\u52a1\u5668\uff0c\u5982\u679c\u5f53\u524d\u4f7f\u7528\u7684\u6570\u636e\u5e93\uff08\u5373USE database\u8bed\u53e5\uff09\u662f db_name \uff0c\u90a3\u4e48\u8bb0\u5f55\u66f4\u65b0\u3002 --binlog-ignore-db=db_name \u4e0e\u4e0a\u9762\u7684\u9009\u9879\u76f8\u53cd\u3002\u4e24\u8005\u53ef\u540c\u65f6\u3001\u591a\u6b21\u4f7f\u7528\u3002 --innodb-safe-binlog \u6b64\u9009\u9879\u7ecf\u5e38\u548c--sync-binlog\uff1dN\uff08\u6bcf\u5199 N \u6b21\u65e5\u5fd7\u5c31\u540c\u6b65\u78c1\u76d8\uff09\u4e00\u8d77\u914d\u5408\u4f7f\u7528\uff0c\u4f7f\u5f97\u4e8b\u52a1\u5728\u65e5\u5fd7\u4e2d\u7684\u8bb0\u5f55\u66f4\u52a0\u5b89\u5168\u3002 SET SQL_LOG_BIN=0 \u5177\u6709 SUPER \u6743\u9650\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u6b64\u8bed\u53e5\u7981\u6b62\u5c06\u81ea\u5df1\u7684\u8bed\u53e5\u8bb0\u5165\u4e8c\u8fdb\u5236\u8bb0\u5f55\u3002 3. \u67e5\u8be2\u65e5\u5fd7 \u00b6 \u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u5ba2\u6237\u7aef\u7684 \u6240\u6709\u8bed\u53e5 \uff0c\u800c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u5305\u542b\u53ea\u67e5\u8be2\u6570\u636e\u7684\u8bed\u53e5\u3002 \u5173\u95ed\u548c\u5f00\u542f\u65e5\u5fd7\u8bb0\u5f55\uff1a --general-log[={0|1}] \u3002\u9ed8\u8ba4\u5173\u95ed\u3002\u5982\u679c\u540c\u65f6\u4f7f\u7528\u4e86\u9009\u9879 --log-output=TABLE \uff0c\u90a3\u4e48\u9ed8\u8ba4\u8f93\u51fa\u5230 mysql.general_log \u3002 \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\uff1a --general-log-file=file_name \u3002\u9ed8\u8ba4\u503c\u662f host_name.log \u6307\u5b9a\u67e5\u8be2\u65e5\u5fd7\u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u8f93\u51fa\u76ee\u7684\uff1a\u4f7f\u7528 log-output \u7cfb\u7edf\u53d8\u91cf\u3002 \u65e5\u5fd7\u7684\u8bfb\u53d6\uff1a\u65e5\u5fd7\u662f\u7eaf\u6587\u672c\uff0c\u53ef\u76f4\u63a5\u8bfb\u53d6\u3002 4. \u6162\u67e5\u8be2\u65e5\u5fd7 \u00b6 \u6162\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u5305\u542b\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u53c2\u6570 long_query_time \uff08\u5355\u4f4d\uff1a\u79d2\uff09\u6240\u8bbe\u7f6e\u503c\u7684 SQL \u8bed\u53e5\u7684\u65e5\u5fd7\u3002 \u83b7\u5f97\u8868\u9501\u5b9a\u7684\u65f6\u95f4\u4e0d\u7b97\u4f5c\u6267\u884c\u65f6\u95f4\u3002 \u5173\u95ed\u548c\u5f00\u542f\u65e5\u5fd7\u8bb0\u5f55\uff1a --slow-query-log[={0|1}] \u3002\u9ed8\u8ba4\u5173\u95ed\u3002\u5176\u4ed6\u9009\u9879\u53ef\u7528\u7684\u524d\u63d0\u3002 \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\uff1a --slow-query-log-file=name \u3002\u9ed8\u8ba4\u503c\u662f hostname-slow.log \u3002\u5176\u4ed6\u9009\u9879\u53ef\u7528\u7684\u524d\u63d0\u3002 4.1 \u65e5\u5fd7\u5206\u6790 \u00b6 \u5982\u679c\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u5185\u5bb9\u5f88\u591a\uff0c\u53ef\u4ee5\u4f7f\u7528 mysqldumpslow \u5de5\u5177\u6765\u5bf9\u6162\u67e5\u8be2\u65e5\u5fd7\u8fdb\u884c\u7edf\u8ba1\u3002 mysqldumpslow bj37 - slow . log \u5bf9\u4e8e SQL \u6587\u672c\u5b8c\u5168\u4e00\u81f4\uff0c\u53ea\u662f\u53d8\u91cf\u4e0d\u540c\u7684\u8bed\u53e5\uff0cmysqldumpslow \u5c06\u4f1a\u81ea\u52a8\u89c6\u4e3a\u540c\u4e00\u4e2a\u8bed\u53e5\u8fdb\u884c\u7edf\u8ba1\uff0c\u53d8\u91cf\u503c\u7528 N \u6765\u4ee3\u66ff\u3002 \u901a\u8fc7 --log-slow-admin-statements \u670d\u52a1\u5668\u9009\u9879\uff0c\u53ef\u4ee5\u8bf7\u6c42\u5c06\u6162\u7ba1\u7406\u8bed\u53e5\uff0c\u4f8b\u5982 OPTIMIZE TABLE\u3001ANALYZE TABLE \u548c ALTER TABLE \u5199\u5165\u6162\u67e5\u8be2\u65e5\u5fd7\u3002 \u8bbe\u7f6e\u5fae\u79d2\u7ea7\u522b\uff1a set global long_query_time = 0 . 01 ;","title":"31. MySQL \u65e5\u5fd7"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#1","text":"\u5b83\u8bb0\u5f55\u4e86\u5f53 mysqld \u542f\u52a8\u548c\u505c\u6b62\u65f6\uff0c\u4ee5\u53ca\u670d\u52a1\u5668\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4efb\u4f55\u4e25\u91cd\u9519\u8bef\u65f6\u7684\u76f8\u5173\u4fe1\u606f\u3002 \u53ef\u4ee5\u7528 --log-error[=file_name] \u9009\u9879\u6765\u6307\u5b9a mysqld\uff08MySQL \u670d\u52a1\u5668\uff09\u4fdd\u5b58\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u7684\u4f4d\u7f6e\uff08\u4e0d\u6307\u5b9a\u8be5\u53c2\u6570\u65f6\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff09\u3002\u5982\u679c\u6ca1\u6709\u7ed9\u5b9a file_name \u503c\uff0cmysqld \u4f7f\u7528\u9519\u8bef\u65e5\u5fd7\u540d host_name.err \uff08host_name \u4e3a\u4e3b\u673a\u540d\uff09\u5e76\u9ed8\u8ba4\u5728\u53c2\u6570 DATADIR \uff08\u6570\u636e\u76ee\u5f55 /var/lib/mysql \uff09\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\u3002","title":"1. \u9519\u8bef\u65e5\u5fd7"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#2","text":"\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff08BINLOG\uff09\u8bb0\u5f55\u4e86\u6240\u6709\u7684 DDL \uff08\u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff09\u8bed\u53e5\u548c DML \uff08\u6570\u636e\u64cd\u7eb5\u8bed\u8a00\uff09\u8bed\u53e5\uff0c\u4f46\u662f \u4e0d\u5305\u62ec\u6570\u636e\u67e5\u8be2\u8bed\u53e5 \u3002 \u6b64\u65e5\u5fd7\u5bf9\u4e8e\u707e\u96be\u65f6\u7684\u6570\u636e\u6062\u590d\u8d77\u7740\u6781\u5176\u91cd\u8981\u7684\u4f5c\u7528\u3002","title":"2. \u4e8c\u8fdb\u5236\u65e5\u5fd7"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#21","text":"\u9ed8\u8ba4\u5199\u5230 /var/lib/mysql \u76ee\u5f55\u4e2d\u7684 binlog.xxxxxx \u6587\u4ef6\u4e2d\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 --log-bin[=file_name] \u6307\u5b9a\u3002 \u53ef\u901a\u8fc7 mysqlbinlog \u8bfb\u53d6\u65e5\u5fd7\u3002","title":"2.1 \u65e5\u5fd7\u7684\u5b58\u653e"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#22","text":"--binlog-format=name \uff0cname\u6709\u4ee5\u4e0b\u4e09\u79cd\uff1a ROW\uff1a\u57fa\u4e8e\u884c\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u5c06\u6bcf\u4e00\u884c\u7684\u53d8\u66f4\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u800c\u4e0d\u662fsql\u8bed\u53e5\u3002\u5373\u53ea\u8981\u67d0\u884c\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5c31\u5c06\u6b64\u884c\u8bb0\u5f55\u8fdb\u53bb\u3002\u4f18\u70b9\u662f\u4f1a\u8bb0\u5f55\u6bcf\u4e00\u884c\u7684\u6570\u636e\u7684\u53d8\u5316\u7ec6\u8282\uff0c\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e9b\u60c5\u51b5\u4e0b\u65e0\u6cd5\u590d\u5236\u7684\u60c5\u51b5\u3002\u7f3a\u70b9\u662f\u65e5\u5fd7\u91cf\u5927\uff0c\u5bf9IO\u5f71\u54cd\u8f83\u5927\u3002 STATEMENT\uff1a\u57fa\u4e8esql\u8bed\u53e5\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u4f18\u70b9\u662f\u65e5\u5fd7\u8bb0\u5f55\u6e05\u6670\u6613\u8bfb\uff0c\u65e5\u5fd7\u91cf\u5c11\uff0c\u5bf9IO\u5f71\u54cd\u5c0f\u3002\u7f3a\u70b9\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0bslave\u7684\u65e5\u5fd7\u590d\u5236\u4f1a\u51fa\u9519\u3002 MIXED\uff1a\u6df7\u5408\u4e86\u524d\u4e24\u79cd\u7684\u65e5\u5fd7\u5f62\u5f0f\u3002\u9ed8\u8ba4\u65e5\u5fd7\u683c\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u91c7\u7528 STATEMENT \uff0c\u7279\u6b8a\u60c5\u51b5\u4e0b\u91c7\u7528 ROW \u3002\u6bd4\u5982\u91c7\u7528NDB\u5f15\u64ce\u65f6\uff0c\u5bf9\u8868\u7684DML\u8bed\u53e5\u5168\u90e8\u91c7\u7528ROW\uff1b\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u4e34\u65f6\u8868\uff1b\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u4e0d\u786e\u5b9a\u51fd\u6570\uff08CURRENT_USER()\u7b49\uff09\u3002\u8be5\u65e5\u5fd7\u683c\u5f0f\u5c3d\u91cf\u5229\u7528\u524d\u4e24\u8005\u7684\u4f18\u70b9\uff0c\u800c\u907f\u5f00\u7f3a\u70b9\u3002","title":"2.2 \u65e5\u5fd7\u7684\u683c\u5f0f"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#23","text":"\u5bf9\u4e8e\u6bd4\u8f83\u7e41\u5fd9\u7684 OLTP\uff08\u5728\u7ebf\u4e8b\u52a1\u5904\u7406\uff09\u7cfb\u7edf\uff0c\u7531\u4e8e\u6bcf\u5929\u751f\u6210\u65e5\u5fd7\u91cf\u5927\uff0c\u8fd9\u4e9b\u65e5\u5fd7\u5982\u679c\u957f\u65f6\u95f4\u4e0d\u6e05\u9664\uff0c\u5c06\u4f1a\u5bf9\u78c1\u76d8\u7a7a\u95f4\u5e26\u6765\u5f88\u5927\u7684\u6d6a\u8d39\u3002","title":"2.3 \u65e5\u5fd7\u7684\u5220\u9664"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#231-1","text":"\u5229\u7528MySQL\u7684 RESET MASTER \u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u5c06\u5220\u9664\u6240\u6709 BINLOG \u65e5\u5fd7\uff0c\u65b0\u65e5\u5fd7\u7f16\u53f7\u4ece 000001 \u5f00\u59cb\u3002","title":"2.3.1 \u65b9\u6cd5 1"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#232-2","text":"PURGE { BINARY | MASTER } LOGS { TO 'log_name' | BEFORE datetime_expr } \u8be5\u547d\u4ee4\u5c06\u5220\u9664 xxxxxx \u7f16\u53f7\u4e4b\u524d\u6216 datetime_expr \u4e4b\u524d\u7684\u6240\u6709\u65e5\u5fd7\u3002 PURGE BINARY LOGS TO 'mysql-bin.010' ; PURGE BINARY LOGS BEFORE '2008-04-02 22:46:26' ;","title":"2.3.2 \u65b9\u6cd5 2"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#233-3","text":"\u8bbe\u7f6e\u53c2\u6570 --expire_logs_days=# \uff0c\u6b64\u53c2\u6570\u7684\u542b\u4e49\u662f\u8bbe\u7f6e\u65e5\u5fd7\u7684\u8fc7\u671f\u5929\u6570\uff0c\u8fc7\u4e86\u6307\u5b9a\u7684\u5929\u6570\u540e\u65e5\u5fd7\u5c06\u4f1a\u88ab\u81ea\u52a8\u5220\u9664 \u3002 \u8fd8\u6709\u4e00\u4e2a\u76f8\u4f3c\u7684\u53c2\u6570\uff1a --binlog-expire-logs-seconds \uff0c\u9ed8\u8ba4\u503c\u662f30\u5929\uff0c\u4e24\u8005\u540c\u65f6\u8bbe\u7f6e\u65f6\uff0c\u8be5\u53c2\u6570\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002","title":"2.3.3 \u65b9\u6cd5 3"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#24","text":"MySQL \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5176\u4ed6\u53c2\u6570\u9009\u9879\u6765\u8fdb\u884c\u66f4\u5c0f\u7c92\u5ea6\u7684\u7ba1\u7406 \u3002 --binlog-do-db=db_name \u4f5c\u7528\u662f\u544a\u77e5\u4e3b\u670d\u52a1\u5668\uff0c\u5982\u679c\u5f53\u524d\u4f7f\u7528\u7684\u6570\u636e\u5e93\uff08\u5373USE database\u8bed\u53e5\uff09\u662f db_name \uff0c\u90a3\u4e48\u8bb0\u5f55\u66f4\u65b0\u3002 --binlog-ignore-db=db_name \u4e0e\u4e0a\u9762\u7684\u9009\u9879\u76f8\u53cd\u3002\u4e24\u8005\u53ef\u540c\u65f6\u3001\u591a\u6b21\u4f7f\u7528\u3002 --innodb-safe-binlog \u6b64\u9009\u9879\u7ecf\u5e38\u548c--sync-binlog\uff1dN\uff08\u6bcf\u5199 N \u6b21\u65e5\u5fd7\u5c31\u540c\u6b65\u78c1\u76d8\uff09\u4e00\u8d77\u914d\u5408\u4f7f\u7528\uff0c\u4f7f\u5f97\u4e8b\u52a1\u5728\u65e5\u5fd7\u4e2d\u7684\u8bb0\u5f55\u66f4\u52a0\u5b89\u5168\u3002 SET SQL_LOG_BIN=0 \u5177\u6709 SUPER \u6743\u9650\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u6b64\u8bed\u53e5\u7981\u6b62\u5c06\u81ea\u5df1\u7684\u8bed\u53e5\u8bb0\u5165\u4e8c\u8fdb\u5236\u8bb0\u5f55\u3002","title":"2.4 \u5176\u4ed6\u9009\u9879"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#3","text":"\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u5ba2\u6237\u7aef\u7684 \u6240\u6709\u8bed\u53e5 \uff0c\u800c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u5305\u542b\u53ea\u67e5\u8be2\u6570\u636e\u7684\u8bed\u53e5\u3002 \u5173\u95ed\u548c\u5f00\u542f\u65e5\u5fd7\u8bb0\u5f55\uff1a --general-log[={0|1}] \u3002\u9ed8\u8ba4\u5173\u95ed\u3002\u5982\u679c\u540c\u65f6\u4f7f\u7528\u4e86\u9009\u9879 --log-output=TABLE \uff0c\u90a3\u4e48\u9ed8\u8ba4\u8f93\u51fa\u5230 mysql.general_log \u3002 \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\uff1a --general-log-file=file_name \u3002\u9ed8\u8ba4\u503c\u662f host_name.log \u6307\u5b9a\u67e5\u8be2\u65e5\u5fd7\u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u8f93\u51fa\u76ee\u7684\uff1a\u4f7f\u7528 log-output \u7cfb\u7edf\u53d8\u91cf\u3002 \u65e5\u5fd7\u7684\u8bfb\u53d6\uff1a\u65e5\u5fd7\u662f\u7eaf\u6587\u672c\uff0c\u53ef\u76f4\u63a5\u8bfb\u53d6\u3002","title":"3. \u67e5\u8be2\u65e5\u5fd7"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#4","text":"\u6162\u67e5\u8be2\u65e5\u5fd7\u8bb0\u5f55\u4e86\u5305\u542b\u6240\u6709\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u53c2\u6570 long_query_time \uff08\u5355\u4f4d\uff1a\u79d2\uff09\u6240\u8bbe\u7f6e\u503c\u7684 SQL \u8bed\u53e5\u7684\u65e5\u5fd7\u3002 \u83b7\u5f97\u8868\u9501\u5b9a\u7684\u65f6\u95f4\u4e0d\u7b97\u4f5c\u6267\u884c\u65f6\u95f4\u3002 \u5173\u95ed\u548c\u5f00\u542f\u65e5\u5fd7\u8bb0\u5f55\uff1a --slow-query-log[={0|1}] \u3002\u9ed8\u8ba4\u5173\u95ed\u3002\u5176\u4ed6\u9009\u9879\u53ef\u7528\u7684\u524d\u63d0\u3002 \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\uff1a --slow-query-log-file=name \u3002\u9ed8\u8ba4\u503c\u662f hostname-slow.log \u3002\u5176\u4ed6\u9009\u9879\u53ef\u7528\u7684\u524d\u63d0\u3002","title":"4. \u6162\u67e5\u8be2\u65e5\u5fd7"},{"location":"mysql/31. MySQL \u65e5\u5fd7/#41","text":"\u5982\u679c\u6162\u67e5\u8be2\u65e5\u5fd7\u4e2d\u8bb0\u5f55\u5185\u5bb9\u5f88\u591a\uff0c\u53ef\u4ee5\u4f7f\u7528 mysqldumpslow \u5de5\u5177\u6765\u5bf9\u6162\u67e5\u8be2\u65e5\u5fd7\u8fdb\u884c\u7edf\u8ba1\u3002 mysqldumpslow bj37 - slow . log \u5bf9\u4e8e SQL \u6587\u672c\u5b8c\u5168\u4e00\u81f4\uff0c\u53ea\u662f\u53d8\u91cf\u4e0d\u540c\u7684\u8bed\u53e5\uff0cmysqldumpslow \u5c06\u4f1a\u81ea\u52a8\u89c6\u4e3a\u540c\u4e00\u4e2a\u8bed\u53e5\u8fdb\u884c\u7edf\u8ba1\uff0c\u53d8\u91cf\u503c\u7528 N \u6765\u4ee3\u66ff\u3002 \u901a\u8fc7 --log-slow-admin-statements \u670d\u52a1\u5668\u9009\u9879\uff0c\u53ef\u4ee5\u8bf7\u6c42\u5c06\u6162\u7ba1\u7406\u8bed\u53e5\uff0c\u4f8b\u5982 OPTIMIZE TABLE\u3001ANALYZE TABLE \u548c ALTER TABLE \u5199\u5165\u6162\u67e5\u8be2\u65e5\u5fd7\u3002 \u8bbe\u7f6e\u5fae\u79d2\u7ea7\u522b\uff1a set global long_query_time = 0 . 01 ;","title":"4.1 \u65e5\u5fd7\u5206\u6790"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/","text":"\u548c\u5f88\u591a\u6570\u636e\u5e93\u7c7b\u4f3c\uff0cMySQL \u7684\u5907\u4efd\u4e5f\u4e3b\u8981\u5206\u4e3a\u903b\u8f91\u5907\u4efd\u548c\u7269\u7406\u5907\u4efd\u3002 1. \u5907\u4efd/\u6062\u590d\u7b56\u7565 \u00b6 \u5bf9\u4e8e\u4e00\u4e2a DBA \u6765\u8bf4\uff0c\u5b9a\u5236\u5408\u7406\u7684\u5907\u4efd\u7b56\u7565\u65e0\u7591\u662f\u5f88\u91cd\u8981\u7684\uff0c\u4ee5\u4e0b\u662f\u6211\u4eec\u5728\u8fdb\u884c\u5907\u4efd\u6216\u6062\u590d\u64cd\u4f5c\u65f6\u9700\u8981\u8003\u8651\u7684\u4e00\u4e9b\u56e0\u7d20\u3002 \u786e\u5b9a\u8981\u5907\u4efd\u7684\u8868\u7684\u5b58\u50a8\u5f15\u64ce\u662f\u4e8b\u52a1\u578b\u8fd8\u662f\u975e\u4e8b\u52a1\u6027\uff0c\u4e24\u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5907\u4efd\u65b9\u5f0f\u5728\u5904\u7406\u6570\u636e\u4e00\u81f4\u6027\u65b9\u9762\u662f\u4e0d\u592a\u4e00\u6837\u7684\u3002 \u786e\u5b9a\u4f7f\u7528\u5168\u5907\u4efd\u8fd8\u662f\u589e\u91cf\u5907\u4efd\u3002\u5168\u5907\u4efd\u7684\u4f18\u70b9\u662f\u5907\u4efd\u4fdd\u6301\u6700\u65b0\u5907\u4efd\uff0c\u6062\u590d\u7684\u65f6\u5019\u53ef\u4ee5\u82b1\u8d39\u66f4\u5c11\u7684\u65f6\u95f4\uff1b\u7f3a\u70b9\u662f\u5982\u679c\u6570\u636e\u91cf\u5927\uff0c\u5c06\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u5e76\u5bf9\u7cfb\u7edf\u9020\u6210\u8f83\u957f\u65f6\u95f4\u7684\u538b\u529b\u3002\u589e\u91cf\u5907\u4efd\u5219\u6070\u6070\u76f8\u53cd\uff0c\u53ea\u9700\u8981\u5907\u4efd\u6bcf\u5929\u7684\u589e\u91cf\u65e5\u5fd7\uff0c\u5907\u4efd\u65f6\u95f4\u5c11\uff0c\u5bf9\u8d1f\u8f7d\u538b\u529b\u4e5f\u5c0f\uff1b\u7f3a\u70b9\u5c31\u662f\u6062\u590d\u7684\u65f6\u5019\u9700\u8981\u5168\u5907\u4efd\u52a0\u4e0a\u6b21\u5907\u4efd\u5230\u6545\u969c\u524d\u7684\u6240\u6709\u65e5\u5fd7\uff0c\u6062\u590d\u65f6\u95f4\u4f1a\u957f\u4e9b\u3002 \u53ef\u4ee5\u8003\u8651\u91c7\u53d6\u590d\u5236\u7684\u65b9\u6cd5\u6765\u505a\u5f02\u5730\u5907\u4efd\uff0c\u4f46\u662f\u8bb0\u4f4f\uff0c\u590d\u5236\u4e0d\u80fd\u4ee3\u66ff\u5907\u4efd\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u7684\u8bef\u64cd\u4f5c\u4e5f\u65e0\u80fd\u4e3a\u529b\u3002 \u8981\u5b9a\u671f\u505a\u5907\u4efd\uff0c\u5907\u4efd\u7684\u5468\u671f\u8981\u5145\u5206\u8003\u8651\u7cfb\u7edf\u53ef\u4ee5\u627f\u53d7\u7684\u6062\u590d\u65f6\u95f4\u3002\u5907\u4efd\u8981\u5728\u7cfb\u7edf\u8d1f\u8f7d\u8f83\u5c0f\u7684\u65f6\u5019\u8fdb\u884c\u3002 \u786e\u4fdd MySQL \u6253\u5f00 log-bin \u9009\u9879\uff0c\u6709\u4e86 BINLOG\uff0cMySQL \u624d\u53ef\u4ee5\u5728\u5fc5\u8981\u7684\u65f6\u5019\u505a\u5b8c\u6574\u6062\u590d\uff0c\u6216\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\uff0c\u6216\u57fa\u4e8e\u4f4d\u7f6e\u7684\u6062\u590d\u3002 \u8981\u7ecf\u5e38\u505a\u5907\u4efd\u6062\u590d\u6d4b\u8bd5\uff0c\u786e\u4fdd\u5907\u4efd\u662f\u6709\u6548\u7684\uff0c\u5e76\u4e14\u662f\u53ef\u4ee5\u6062\u590d\u7684\u3002 2. \u903b\u8f91\u5907\u4efd\u548c\u6062\u590d \u00b6 \u5728 MySQL \u91cc\u9762\uff0c\u903b\u8f91\u5907\u4efd\u7684\u6700\u5927\u4f18\u70b9\u662f \u5bf9\u4e8e\u5404\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u90fd\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u6cd5\u6765\u5907\u4efd \uff1b\u800c\u7269\u7406\u5907\u4efd\u5219\u4e0d\u540c\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u6709\u7740\u4e0d\u540c\u7684\u5907\u4efd\u65b9\u6cd5\u3002 2.1 \u5907\u4efd \u00b6 MySQL \u4e2d\u7684\u903b\u8f91\u5907\u4efd\u662f\u5c06\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5907\u4efd\u4e3a\u4e00\u4e2a \u6587\u672c\u6587\u4ef6 \uff0c\u5907\u4efd\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u67e5\u770b\u548c\u7f16\u8f91\u3002\u5728 MySQL \u4e2d\uff0c\u4f7f\u7528 mysqldump \u5de5\u5177\u6765\u5b8c\u6210\u903b\u8f91\u5907\u4efd\u3002 -- \u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93\u8bed\u53e5 mysqldump [ OPTIONS ] database [ tables ] -- \u5305\u542b\u521b\u5efa\u6570\u636e\u5e93\u8bed\u53e5 mysqldump [ OPTIONS ] -- databases [ OPTIONS ] DB1 [ DB2 DB3 ...] -- \u4f1a\u5c06\u6570\u636e\u5e93\u7684\u6743\u9650\u8868\u7b49\u4e5f\u590d\u5236\u51fa\u6765\uff0c\u4e0d\u9002\u7528\u4e0d\u540c\u7248\u672c\u6570\u636e\u5e93\u76f4\u63a5\u7684\u590d\u5236 mysqldump [ OPTIONS ] -- all - databases [ OPTIONS ] \u4f8b\uff1a mysqldump - uroot - p --databases blog > blog-dump.sql 2.2 \u5b8c\u5168\u6062\u590d \u00b6 \u5c06\u5907\u4efd\u4f5c\u4e3a\u8f93\u5165\u6267\u884c\u5373\u53ef \u3002 mysql \u2013 uroot \u2013 p blog < blog - dump . sql \u6ce8\u610f\uff0c\u5c06\u5907\u4efd\u6062\u590d\u540e\u6570\u636e\u5e76\u4e0d\u5b8c\u6574\uff0c\u8fd8\u9700\u8981\u5c06\u5907\u4efd\u540e\u6267\u884c\u7684\u65e5\u5fd7\u8fdb\u884c\u91cd\u505a\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a mysqlbinlog binlog_file | mysql - u root \u2013 p 2.3 \u4e0d\u5b8c\u5168\u6062\u590d \u00b6 \u7531\u4e8e\u8bef\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bef\u5220\u9664\u4e86\u4e00\u5f20\u8868\uff0c\u8fd9\u65f6\u4f7f\u7528\u5b8c\u5168\u6062\u590d\u662f\u6ca1\u6709\u7528\u7684\uff0c\u56e0\u4e3a\u65e5\u5fd7\u91cc\u9762\u8fd8\u5b58\u5728\u8bef\u64cd\u4f5c\u7684\u8bed\u53e5\uff0c\u6211\u4eec\u9700\u8981\u7684\u662f\u6062\u590d\u5230\u8bef\u64cd\u4f5c\u4e4b\u524d\u7684\u72b6\u6001\uff0c\u7136\u540e \u8df3\u8fc7\u8bef\u64cd\u4f5c\u8bed\u53e5 \uff0c\u518d\u6062\u590d\u540e\u9762\u6267\u884c\u7684\u8bed\u53e5\uff0c\u5b8c\u6210\u6211\u4eec\u7684\u6062\u590d\u3002\u8fd9\u79cd\u6062\u590d\u53eb\u4e0d\u5b8c\u5168\u6062\u590d\uff0c\u5728 MySQL \u4e2d\uff0c\u4e0d\u5b8c\u5168\u6062\u590d\u5206\u4e3a\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\u548c\u57fa\u4e8e\u4f4d\u7f6e\u7684\u6062\u590d\u3002 2.3.1 \u57fa\u4e8e\u65f6\u95f4\u70b9\u6062\u590d \u00b6 \u4f7f\u7528 mysqlbinlog \u9009\u9879\u7684 --start-datetime=name \u548c --stop-datetime=name \u6062\u590d\u6570\u636e\u3002 mysqlbinlog -- stop - date = \"2005-04-20 9:59:59\" / var / log / mysql / binlog . 123456 | mysql - u root \u2013 p -- \u8df3\u8fc7\u6545\u969c\u65f6\u7684\u65f6\u95f4\u70b9\uff0c\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684 BINLOG\uff0c\u5b8c\u6210\u6062\u590d\u3002 mysqlbinlog -- start - date = \"2005-04-20 10:01:00\" / var / log / mysql / binlog . 123456 | mysql - u root - p 2.3.2 \u57fa\u4e8e\u4f4d\u7f6e\u6062\u590d \u00b6 \u548c\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\u7c7b\u4f3c\uff0c\u4f46\u662f\u66f4\u7cbe\u786e\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\u53ef\u80fd\u6709\u5f88\u591a\u6761 SQL \u8bed\u53e5\u540c\u65f6\u6267\u884c\u3002 -- \u8be5\u547d\u4ee4\u5c06\u5728/tmp \u76ee\u5f55\u521b\u5efa\u5c0f\u7684\u6587\u672c\u6587\u4ef6\uff0c\u7f16\u8f91\u6b64\u6587\u4ef6\uff0c\u627e\u5230\u51fa\u9519\u8bed\u53e5\u524d\u540e\u7684\u4f4d\u7f6e\u53f7 mysqlbinlog -- start - date = \"2005-04-20 9:55:00\" -- stop - date = \"2005-04-20 10:05:00\" / var / log / mysql / binlog . 123456 > / tmp / mysql_restore . sql -- \u8df3\u8fc7 368312~368315 \u4e4b\u95f4\u7684\u6545\u969c\u8bed\u53e5 mysqlbinlog -- stop - position = \"368312\" / var / log / mysql / binlog . 123456 | mysql - u root - p mysqlbinlog -- start - position = \"368315\" / var / log / mysql / binlog . 123456 | mysql - u root - p 3. \u7269\u7406\u5907\u4efd\u548c\u6062\u590d \u00b6 \u7269\u7406\u5907\u4efd\u53c8\u5206\u4e3a\u51b7\u5907\u4efd\u548c\u70ed\u5907\u4efd\u4e24\u79cd\uff0c\u548c\u903b\u8f91\u5907\u4efd\u76f8\u6bd4\uff0c\u5b83\u7684\u6700\u5927\u4f18\u70b9\u662f\u5907\u4efd\u548c\u6062\u590d\u7684\u901f\u5ea6\u66f4\u5feb\uff0c\u56e0\u4e3a\u7269\u7406\u5907\u4efd\u7684\u539f\u7406\u90fd\u662f\u57fa\u4e8e\u6587\u4ef6\u7684 cp\u3002 3.1 \u51b7\u5907\u4efd \u00b6 \u505c\u6389\u6570\u636e\u5e93\u670d\u52a1\uff0ccp \u6570\u636e\u6587\u4ef6\u7684\u65b9\u6cd5\u3002 \u79cd\u65b9\u6cd5\u5bf9 MyISAM \u548c InnoDB \u5b58\u50a8\u5f15\u64ce\u90fd\u9002\u5408\u3002 \u5907\u4efd\u7684\u64cd\u4f5c\uff1a\u505c\u6389 MySQL \u670d\u52a1\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u5907\u4efd MySQL \u7684\u6570\u636e\u6587\u4ef6\u548c\u65e5\u5fd7\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u3002 \u6062\u590d\u7684\u64cd\u4f5c\uff1a\u9996\u5148\u505c\u6389 MySQL \u670d\u52a1\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u6062\u590d MySQL \u7684\u6570\u636e\u6587\u4ef6\uff1b\u7136\u540e\u91cd\u542f MySQL \u670d\u52a1\uff0c\u4f7f\u7528 mysqlbinlog \u5de5\u5177\u6062\u590d\u81ea\u5907\u4efd\u4ee5\u6765\u7684\u6240\u6709 BINLOG\u3002 3.2 \u70ed\u5907\u4efd \u00b6 3.2.1 MyISAM \u00b6 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u70ed\u5907\u4efd\u6709\u5f88\u591a\u65b9\u6cd5\uff0c\u672c\u8d28\u5176\u5b9e\u5c31\u662f\u5c06\u8981\u5907\u4efd\u7684\u8868\u52a0\u8bfb\u9501\uff0c\u7136\u540e\u518d cp \u6570\u636e\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u3002 3.2.1.1 mysqlhotcopy \u5de5\u5177 \u00b6 3.2.1.2 \u624b\u5de5\u9501\u8868 copy \u00b6 \u9996\u5148\u6570\u636e\u5e93\u4e2d\u6240\u6709\u8868\u52a0\u8bfb\u9501 \uff1a flush tables for read ; \u7136\u540e cp \u6570\u636e\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u5373\u53ef\u3002 3.2.2 InnoDB \u00b6 3.2.2.1 ibbackup \u70ed\u5907\u4efd\u5de5\u5177 \u00b6 \u6536\u8d39 3.2.2.2 XtraBackup \u70ed\u5907\u4efd\u5de5\u5177 \u00b6 4. \u8868\u7684\u5bfc\u5165\u5bfc\u51fa \u00b6 4.1 \u5bfc\u51fa \u00b6 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u4e00\u4e9b\u7279\u5b9a\u7684\u76ee\u7684\uff0c\u7ecf\u5e38\u9700\u8981\u5c06\u8868\u91cc\u7684\u6570\u636e\u5bfc\u51fa\u4e3a\u67d0\u4e9b\u7b26\u53f7\u5206\u5272\u7684\u7eaf\u6570\u636e\u6587\u672c\uff0c\u800c\u4e0d\u662f SQL \u8bed\u53e5\u3002\u8fd9\u4e9b\u5e94\u7528\u53ef\u80fd\u6709\u4ee5\u4e0b\u4e00\u4e9b\uff1a \u7528\u6765\u4f5c\u4e3a EXCEL \u663e\u793a\uff1b \u5355\u7eaf\u4e3a\u4e86\u8282\u7701\u5907\u4efd\u7a7a\u95f4\uff1b \u4e3a\u4e86\u5feb\u901f\u7684\u52a0\u8f7d\u6570\u636e\uff0cLOAD DATA \u7684\u52a0\u8f7d\u901f\u5ea6\u6bd4\u666e\u901a\u7684 SQL \u52a0\u8f7d\u8981\u5feb 20 \u500d\u4ee5\u4e0a\u3002 \u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e9b\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u529e\u6cd5\u6765\u5b9e\u73b0 \u4f7f\u7528 SELECT INTO FILE \u8bed\u53e5 SELECT ...... [ INTO OUTFILE 'file_name' [ CHARACTER SET charset_name ] export_options | INTO DUMPFILE 'file_name' | INTO var_name [, var_name ]] export_options \u548c LOAD DATA \u8bed\u53e5\u7684 FIELDS and LINES \u8bed\u6cd5\u4e00\u6837\uff1a [ { FIELDS | COLUMNS } -- \u5b57\u6bb5\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u5236\u8868\u7b26\u2019\\t\u2019 [ TERMINATED BY 'string' ] -- \u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u5982\u679c\u52a0 OPTIONALLY \u9009\u9879\u5219\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a\u3002\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u5f15\u7528\u7b26 [[ OPTIONALLY ] ENCLOSED BY 'char' ] -- \u8f6c\u4e49\u5b57\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u2019\\\u2019 [ ESCAPED BY 'char' ] ] [ LINES -- \u6bcf\u884c\u524d\u90fd\u52a0\u6b64\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32'' [ STARTING BY 'string' ] -- \u884c\u7ed3\u675f\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u2019\\n\u2019 [ TERMINATED BY 'string' ] ] \u4f46\u5982\u679c\u6307\u5b9a\u4e86\u4e24\u8005\uff0c\u5219FIELDS\u5fc5\u987b\u5728LINES\u4e4b\u524d\u3002 \u5176\u4e2d char \u8868\u793a\u6b64\u7b26\u53f7\u53ea\u80fd\u662f\u5355\u4e2a\u5b57\u7b26\uff0cstring \u8868\u793a\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3002 mysql > SELECT * FROM t1 INTO OUTFILE '/tmp/t1_data' FIELDS OPTIONALLY ENCLOSED BY '\"' ; -- \u5982\u679c\u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\uff0c\u53ef\u5728my.cnf\u4e2d\u6dfb\u52a0\u201csecure-file-priv=\u201d\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\u5373\u53ef ERROR 1290 ( HY000 ): The MySQL server is running with the -- secure - file - priv option so it cannot execute this statement \u5f53\u5bfc\u51fa\u547d\u4ee4\u4e2d\u5305\u542b\u5b57\u6bb5\u5f15\u7528\u7b26\u65f6\uff0c\u6570\u636e\u4e2d\u542b\u6709 \u8f6c\u4e49\u5b57\u7b26\u672c\u8eab\u548c\u5b57\u6bb5\u5f15\u7528\u7b26 \u7684\u5b57\u7b26\u9700\u8981\u88ab\u8f6c\u4e49\uff1b \u5f53\u5bfc\u51fa\u547d\u4ee4\u4e2d\u4e0d\u5305\u542b\u5b57\u6bb5\u5f15\u7528\u7b26\u65f6\uff0c\u6570\u636e\u4e2d\u542b\u6709 \u8f6c\u4e49\u5b57\u7b26\u672c\u8eab\u548c\u5b57\u6bb5\u5206\u9694\u7b26 \u7684\u5b57\u7b26\u9700\u8981\u88ab\u8f6c\u4e49\u3002 \u4f7f\u7528 mysqldump \u547d\u4ee4 mysqldump [ OPTIONS ] database [ tables ] mysqldump [ OPTIONS ] --databases [OPTIONS] DB1 [DB2 DB3...] mysqldump [ OPTIONS ] --all-databases [OPTIONS] OPTIONS\u53c2\u6570\u6709\u597d\u591a\uff0c\u4e0b\u9762\u662f\u548c\u5206\u9694\u7b26\u6709\u5173\u7684\uff1a --fields-terminated-by=name\uff1a\u5b57\u6bb5\u5206\u9694\u7b26 --fields-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26 --fields-optionally-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a --fields-escaped-by=name\uff1a\u8f6c\u4e49\u5b57\u7b26 --lines-terminated-by=name\uff1a\u8bb0\u5f55\u7ed3\u675f\u7b26 $ mysqldump -uroot -p -T /tmp blog t1 --fields-terminated-by \",\" $ ll /tmp -rw-r--r--. 1 root root 1384 Jul 23 03 :39 t1.sql -rw-rw-rw-. 1 mysql mysql 279 Jul 23 03 :39 t1.txt \u5176\u5b9e\uff0cmysqldump \u5b9e\u9645\u8c03\u7528\u7684\u5c31\u662f SELECT INTO \u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u5e76\u5728\u5176\u4e0a\u9762\u6dfb\u52a0\u4e86\u4e00\u4e9b\u65b0\u7684\u529f\u80fd\u800c\u5df2\u3002 4.2 \u5bfc\u5165 \u00b6 \u672c\u8282\u53ea\u8ba8\u8bba\u7528 SELECT\u2026 INTO OUTFILE \u6216\u8005 mysqldump \u5bfc\u51fa\u7684\u7eaf\u6570\u636e\u6587\u672c\u7684\u5bfc\u5165\u65b9\u6cd5\u3002 \u5bfc\u5165\u4e5f\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f LOAD DATA INFILE\u2026 \u548c mysqlimport \uff0c\u5b83\u4eec\u7684\u672c\u8d28\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u53ea\u662f\u5728\u4e8e\u4e00\u4e2a\u5728 MySQL \u5185\u90e8\u6267\u884c\uff0c\u53e6\u4e00\u4e2a\u5728 MySQL \u5916\u90e8\u6267\u884c\u3002 \u4f7f\u7528 LOAD DAT \u547d\u4ee4 LOAD DATA INFILE 'file_name' [ REPLACE | IGNORE ] INTO TABLE tbl_name [ { FIELDS | COLUMNS } [ TERMINATED BY 'string' ] [[ OPTIONALLY ] ENCLOSED BY 'char' ] [ ESCAPED BY 'char' ] ] [ LINES [ STARTING BY 'string' ] [ TERMINATED BY 'string' ] ] -- \u5ffd\u7565\u524dN\u884c\u6570\u636e [ IGNORE number { LINES | ROWS } ] -- \u52a0\u8f7d\u7684\u5217\u53ca\u5217\u7684\u987a\u5e8f [( col_name_or_user_var [, col_name_or_user_var ] ...)] -- \u5c06\u5217\u4f5c\u4e00\u5b9a\u7684\u6570\u503c\u8f6c\u6362\u540e\u518d\u52a0\u8f7d [ SET col_name = { expr | DEFAULT } , [, col_name = { expr | DEFAULT } ] ...] \u5728\u8f7d\u5165\u4e4b\u524d\uff0c\u8868\u4e00\u5b9a\u8981\u5b58\u5728\u3002 LOAD DATA INFILE '/tmp/t1_data' INTO TABLE t1 ( id ) SET id = id + 2 ; \u4f7f\u7528 mysqlimport \u547d\u4ee4 mysqlimport [ OPTIONS ] database textfile ... OPTIONS\u53c2\u6570\u6709\u597d\u591a\uff0c\u4e0b\u9762\u662f\u548c\u5206\u9694\u7b26\u6709\u5173\u7684\uff1a --fields-terminated-by=name\uff1a\u5b57\u6bb5\u5206\u9694\u7b26 --fields-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26 --fields-optionally-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a --fields-escaped-by=name\uff1a\u8f6c\u4e49\u5b57\u7b26 --lines-terminated-by=name\uff1a\u8bb0\u5f55\u7ed3\u675f\u7b26 --ignore-lines=#\uff1a\u5ffd\u7565\u524dN\u884c\u6570\u636e mysqlimport - uroot - p -- fields - terminated - by = ',' blog / tmp / t1 . txt Note \u5982\u679c\u5bfc\u5165\u548c\u5bfc\u51fa\u662f\u8de8\u5e73\u53f0\u64cd\u4f5c\u7684 \uff08Windows \u548c Linux\uff09\uff0c\u90a3\u4e48\u8981\u6ce8\u610f\u8bbe\u7f6e\u53c2\u6570 line-terminated-by \uff0c Windows \u4e0a \u8bbe \u7f6e \u4e3a line-terminated-by=\u2019\\r\\n\u2019 \uff0c Linux \u4e0a \u8bbe \u7f6e \u4e3a line-terminated-by=\u2019\\n\u2019\u3002 \u6570\u636e\u7684\u5bfc\u5165\u5bfc\u51fa \u5728\u6570\u636e\u5e93\u7684\u7ba1\u7406\u7ef4\u62a4\u4e2d\u4f7f\u7528\u975e\u5e38\u9891\u7e41\uff0c\u800c LOAD DATA INFILE \u662f\u52a0\u8f7d\u6570\u636e\u6700\u5feb\u7684\u65b9\u6cd5\uff0c\u56e0\u6b64\u5e94\u91cd\u70b9\u638c\u63e1\u3002","title":"32. MySQL\u5907\u4efd\u4e0e\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#1","text":"\u5bf9\u4e8e\u4e00\u4e2a DBA \u6765\u8bf4\uff0c\u5b9a\u5236\u5408\u7406\u7684\u5907\u4efd\u7b56\u7565\u65e0\u7591\u662f\u5f88\u91cd\u8981\u7684\uff0c\u4ee5\u4e0b\u662f\u6211\u4eec\u5728\u8fdb\u884c\u5907\u4efd\u6216\u6062\u590d\u64cd\u4f5c\u65f6\u9700\u8981\u8003\u8651\u7684\u4e00\u4e9b\u56e0\u7d20\u3002 \u786e\u5b9a\u8981\u5907\u4efd\u7684\u8868\u7684\u5b58\u50a8\u5f15\u64ce\u662f\u4e8b\u52a1\u578b\u8fd8\u662f\u975e\u4e8b\u52a1\u6027\uff0c\u4e24\u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5907\u4efd\u65b9\u5f0f\u5728\u5904\u7406\u6570\u636e\u4e00\u81f4\u6027\u65b9\u9762\u662f\u4e0d\u592a\u4e00\u6837\u7684\u3002 \u786e\u5b9a\u4f7f\u7528\u5168\u5907\u4efd\u8fd8\u662f\u589e\u91cf\u5907\u4efd\u3002\u5168\u5907\u4efd\u7684\u4f18\u70b9\u662f\u5907\u4efd\u4fdd\u6301\u6700\u65b0\u5907\u4efd\uff0c\u6062\u590d\u7684\u65f6\u5019\u53ef\u4ee5\u82b1\u8d39\u66f4\u5c11\u7684\u65f6\u95f4\uff1b\u7f3a\u70b9\u662f\u5982\u679c\u6570\u636e\u91cf\u5927\uff0c\u5c06\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u5e76\u5bf9\u7cfb\u7edf\u9020\u6210\u8f83\u957f\u65f6\u95f4\u7684\u538b\u529b\u3002\u589e\u91cf\u5907\u4efd\u5219\u6070\u6070\u76f8\u53cd\uff0c\u53ea\u9700\u8981\u5907\u4efd\u6bcf\u5929\u7684\u589e\u91cf\u65e5\u5fd7\uff0c\u5907\u4efd\u65f6\u95f4\u5c11\uff0c\u5bf9\u8d1f\u8f7d\u538b\u529b\u4e5f\u5c0f\uff1b\u7f3a\u70b9\u5c31\u662f\u6062\u590d\u7684\u65f6\u5019\u9700\u8981\u5168\u5907\u4efd\u52a0\u4e0a\u6b21\u5907\u4efd\u5230\u6545\u969c\u524d\u7684\u6240\u6709\u65e5\u5fd7\uff0c\u6062\u590d\u65f6\u95f4\u4f1a\u957f\u4e9b\u3002 \u53ef\u4ee5\u8003\u8651\u91c7\u53d6\u590d\u5236\u7684\u65b9\u6cd5\u6765\u505a\u5f02\u5730\u5907\u4efd\uff0c\u4f46\u662f\u8bb0\u4f4f\uff0c\u590d\u5236\u4e0d\u80fd\u4ee3\u66ff\u5907\u4efd\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u7684\u8bef\u64cd\u4f5c\u4e5f\u65e0\u80fd\u4e3a\u529b\u3002 \u8981\u5b9a\u671f\u505a\u5907\u4efd\uff0c\u5907\u4efd\u7684\u5468\u671f\u8981\u5145\u5206\u8003\u8651\u7cfb\u7edf\u53ef\u4ee5\u627f\u53d7\u7684\u6062\u590d\u65f6\u95f4\u3002\u5907\u4efd\u8981\u5728\u7cfb\u7edf\u8d1f\u8f7d\u8f83\u5c0f\u7684\u65f6\u5019\u8fdb\u884c\u3002 \u786e\u4fdd MySQL \u6253\u5f00 log-bin \u9009\u9879\uff0c\u6709\u4e86 BINLOG\uff0cMySQL \u624d\u53ef\u4ee5\u5728\u5fc5\u8981\u7684\u65f6\u5019\u505a\u5b8c\u6574\u6062\u590d\uff0c\u6216\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\uff0c\u6216\u57fa\u4e8e\u4f4d\u7f6e\u7684\u6062\u590d\u3002 \u8981\u7ecf\u5e38\u505a\u5907\u4efd\u6062\u590d\u6d4b\u8bd5\uff0c\u786e\u4fdd\u5907\u4efd\u662f\u6709\u6548\u7684\uff0c\u5e76\u4e14\u662f\u53ef\u4ee5\u6062\u590d\u7684\u3002","title":"1. \u5907\u4efd/\u6062\u590d\u7b56\u7565"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#2","text":"\u5728 MySQL \u91cc\u9762\uff0c\u903b\u8f91\u5907\u4efd\u7684\u6700\u5927\u4f18\u70b9\u662f \u5bf9\u4e8e\u5404\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u90fd\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u6cd5\u6765\u5907\u4efd \uff1b\u800c\u7269\u7406\u5907\u4efd\u5219\u4e0d\u540c\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u6709\u7740\u4e0d\u540c\u7684\u5907\u4efd\u65b9\u6cd5\u3002","title":"2. \u903b\u8f91\u5907\u4efd\u548c\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#21","text":"MySQL \u4e2d\u7684\u903b\u8f91\u5907\u4efd\u662f\u5c06\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5907\u4efd\u4e3a\u4e00\u4e2a \u6587\u672c\u6587\u4ef6 \uff0c\u5907\u4efd\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u67e5\u770b\u548c\u7f16\u8f91\u3002\u5728 MySQL \u4e2d\uff0c\u4f7f\u7528 mysqldump \u5de5\u5177\u6765\u5b8c\u6210\u903b\u8f91\u5907\u4efd\u3002 -- \u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93\u8bed\u53e5 mysqldump [ OPTIONS ] database [ tables ] -- \u5305\u542b\u521b\u5efa\u6570\u636e\u5e93\u8bed\u53e5 mysqldump [ OPTIONS ] -- databases [ OPTIONS ] DB1 [ DB2 DB3 ...] -- \u4f1a\u5c06\u6570\u636e\u5e93\u7684\u6743\u9650\u8868\u7b49\u4e5f\u590d\u5236\u51fa\u6765\uff0c\u4e0d\u9002\u7528\u4e0d\u540c\u7248\u672c\u6570\u636e\u5e93\u76f4\u63a5\u7684\u590d\u5236 mysqldump [ OPTIONS ] -- all - databases [ OPTIONS ] \u4f8b\uff1a mysqldump - uroot - p --databases blog > blog-dump.sql","title":"2.1 \u5907\u4efd"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#22","text":"\u5c06\u5907\u4efd\u4f5c\u4e3a\u8f93\u5165\u6267\u884c\u5373\u53ef \u3002 mysql \u2013 uroot \u2013 p blog < blog - dump . sql \u6ce8\u610f\uff0c\u5c06\u5907\u4efd\u6062\u590d\u540e\u6570\u636e\u5e76\u4e0d\u5b8c\u6574\uff0c\u8fd8\u9700\u8981\u5c06\u5907\u4efd\u540e\u6267\u884c\u7684\u65e5\u5fd7\u8fdb\u884c\u91cd\u505a\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a mysqlbinlog binlog_file | mysql - u root \u2013 p","title":"2.2 \u5b8c\u5168\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#23","text":"\u7531\u4e8e\u8bef\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bef\u5220\u9664\u4e86\u4e00\u5f20\u8868\uff0c\u8fd9\u65f6\u4f7f\u7528\u5b8c\u5168\u6062\u590d\u662f\u6ca1\u6709\u7528\u7684\uff0c\u56e0\u4e3a\u65e5\u5fd7\u91cc\u9762\u8fd8\u5b58\u5728\u8bef\u64cd\u4f5c\u7684\u8bed\u53e5\uff0c\u6211\u4eec\u9700\u8981\u7684\u662f\u6062\u590d\u5230\u8bef\u64cd\u4f5c\u4e4b\u524d\u7684\u72b6\u6001\uff0c\u7136\u540e \u8df3\u8fc7\u8bef\u64cd\u4f5c\u8bed\u53e5 \uff0c\u518d\u6062\u590d\u540e\u9762\u6267\u884c\u7684\u8bed\u53e5\uff0c\u5b8c\u6210\u6211\u4eec\u7684\u6062\u590d\u3002\u8fd9\u79cd\u6062\u590d\u53eb\u4e0d\u5b8c\u5168\u6062\u590d\uff0c\u5728 MySQL \u4e2d\uff0c\u4e0d\u5b8c\u5168\u6062\u590d\u5206\u4e3a\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\u548c\u57fa\u4e8e\u4f4d\u7f6e\u7684\u6062\u590d\u3002","title":"2.3 \u4e0d\u5b8c\u5168\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#231","text":"\u4f7f\u7528 mysqlbinlog \u9009\u9879\u7684 --start-datetime=name \u548c --stop-datetime=name \u6062\u590d\u6570\u636e\u3002 mysqlbinlog -- stop - date = \"2005-04-20 9:59:59\" / var / log / mysql / binlog . 123456 | mysql - u root \u2013 p -- \u8df3\u8fc7\u6545\u969c\u65f6\u7684\u65f6\u95f4\u70b9\uff0c\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684 BINLOG\uff0c\u5b8c\u6210\u6062\u590d\u3002 mysqlbinlog -- start - date = \"2005-04-20 10:01:00\" / var / log / mysql / binlog . 123456 | mysql - u root - p","title":"2.3.1 \u57fa\u4e8e\u65f6\u95f4\u70b9\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#232","text":"\u548c\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d\u7c7b\u4f3c\uff0c\u4f46\u662f\u66f4\u7cbe\u786e\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\u53ef\u80fd\u6709\u5f88\u591a\u6761 SQL \u8bed\u53e5\u540c\u65f6\u6267\u884c\u3002 -- \u8be5\u547d\u4ee4\u5c06\u5728/tmp \u76ee\u5f55\u521b\u5efa\u5c0f\u7684\u6587\u672c\u6587\u4ef6\uff0c\u7f16\u8f91\u6b64\u6587\u4ef6\uff0c\u627e\u5230\u51fa\u9519\u8bed\u53e5\u524d\u540e\u7684\u4f4d\u7f6e\u53f7 mysqlbinlog -- start - date = \"2005-04-20 9:55:00\" -- stop - date = \"2005-04-20 10:05:00\" / var / log / mysql / binlog . 123456 > / tmp / mysql_restore . sql -- \u8df3\u8fc7 368312~368315 \u4e4b\u95f4\u7684\u6545\u969c\u8bed\u53e5 mysqlbinlog -- stop - position = \"368312\" / var / log / mysql / binlog . 123456 | mysql - u root - p mysqlbinlog -- start - position = \"368315\" / var / log / mysql / binlog . 123456 | mysql - u root - p","title":"2.3.2 \u57fa\u4e8e\u4f4d\u7f6e\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#3","text":"\u7269\u7406\u5907\u4efd\u53c8\u5206\u4e3a\u51b7\u5907\u4efd\u548c\u70ed\u5907\u4efd\u4e24\u79cd\uff0c\u548c\u903b\u8f91\u5907\u4efd\u76f8\u6bd4\uff0c\u5b83\u7684\u6700\u5927\u4f18\u70b9\u662f\u5907\u4efd\u548c\u6062\u590d\u7684\u901f\u5ea6\u66f4\u5feb\uff0c\u56e0\u4e3a\u7269\u7406\u5907\u4efd\u7684\u539f\u7406\u90fd\u662f\u57fa\u4e8e\u6587\u4ef6\u7684 cp\u3002","title":"3. \u7269\u7406\u5907\u4efd\u548c\u6062\u590d"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#31","text":"\u505c\u6389\u6570\u636e\u5e93\u670d\u52a1\uff0ccp \u6570\u636e\u6587\u4ef6\u7684\u65b9\u6cd5\u3002 \u79cd\u65b9\u6cd5\u5bf9 MyISAM \u548c InnoDB \u5b58\u50a8\u5f15\u64ce\u90fd\u9002\u5408\u3002 \u5907\u4efd\u7684\u64cd\u4f5c\uff1a\u505c\u6389 MySQL \u670d\u52a1\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u5907\u4efd MySQL \u7684\u6570\u636e\u6587\u4ef6\u548c\u65e5\u5fd7\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u3002 \u6062\u590d\u7684\u64cd\u4f5c\uff1a\u9996\u5148\u505c\u6389 MySQL \u670d\u52a1\uff0c\u5728\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u6062\u590d MySQL \u7684\u6570\u636e\u6587\u4ef6\uff1b\u7136\u540e\u91cd\u542f MySQL \u670d\u52a1\uff0c\u4f7f\u7528 mysqlbinlog \u5de5\u5177\u6062\u590d\u81ea\u5907\u4efd\u4ee5\u6765\u7684\u6240\u6709 BINLOG\u3002","title":"3.1 \u51b7\u5907\u4efd"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#32","text":"","title":"3.2 \u70ed\u5907\u4efd"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#321-myisam","text":"MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u70ed\u5907\u4efd\u6709\u5f88\u591a\u65b9\u6cd5\uff0c\u672c\u8d28\u5176\u5b9e\u5c31\u662f\u5c06\u8981\u5907\u4efd\u7684\u8868\u52a0\u8bfb\u9501\uff0c\u7136\u540e\u518d cp \u6570\u636e\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u3002","title":"3.2.1 MyISAM"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#3211-mysqlhotcopy","text":"","title":"3.2.1.1 mysqlhotcopy \u5de5\u5177"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#3212-copy","text":"\u9996\u5148\u6570\u636e\u5e93\u4e2d\u6240\u6709\u8868\u52a0\u8bfb\u9501 \uff1a flush tables for read ; \u7136\u540e cp \u6570\u636e\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\u5373\u53ef\u3002","title":"3.2.1.2 \u624b\u5de5\u9501\u8868 copy"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#322-innodb","text":"","title":"3.2.2 InnoDB"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#3221-ibbackup","text":"\u6536\u8d39","title":"3.2.2.1 ibbackup \u70ed\u5907\u4efd\u5de5\u5177"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#3222-xtrabackup","text":"","title":"3.2.2.2 XtraBackup \u70ed\u5907\u4efd\u5de5\u5177"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#4","text":"","title":"4. \u8868\u7684\u5bfc\u5165\u5bfc\u51fa"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#41","text":"\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e3a\u4e86\u4e00\u4e9b\u7279\u5b9a\u7684\u76ee\u7684\uff0c\u7ecf\u5e38\u9700\u8981\u5c06\u8868\u91cc\u7684\u6570\u636e\u5bfc\u51fa\u4e3a\u67d0\u4e9b\u7b26\u53f7\u5206\u5272\u7684\u7eaf\u6570\u636e\u6587\u672c\uff0c\u800c\u4e0d\u662f SQL \u8bed\u53e5\u3002\u8fd9\u4e9b\u5e94\u7528\u53ef\u80fd\u6709\u4ee5\u4e0b\u4e00\u4e9b\uff1a \u7528\u6765\u4f5c\u4e3a EXCEL \u663e\u793a\uff1b \u5355\u7eaf\u4e3a\u4e86\u8282\u7701\u5907\u4efd\u7a7a\u95f4\uff1b \u4e3a\u4e86\u5feb\u901f\u7684\u52a0\u8f7d\u6570\u636e\uff0cLOAD DATA \u7684\u52a0\u8f7d\u901f\u5ea6\u6bd4\u666e\u901a\u7684 SQL \u52a0\u8f7d\u8981\u5feb 20 \u500d\u4ee5\u4e0a\u3002 \u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e9b\u5e94\u7528\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u529e\u6cd5\u6765\u5b9e\u73b0 \u4f7f\u7528 SELECT INTO FILE \u8bed\u53e5 SELECT ...... [ INTO OUTFILE 'file_name' [ CHARACTER SET charset_name ] export_options | INTO DUMPFILE 'file_name' | INTO var_name [, var_name ]] export_options \u548c LOAD DATA \u8bed\u53e5\u7684 FIELDS and LINES \u8bed\u6cd5\u4e00\u6837\uff1a [ { FIELDS | COLUMNS } -- \u5b57\u6bb5\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u5236\u8868\u7b26\u2019\\t\u2019 [ TERMINATED BY 'string' ] -- \u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u5982\u679c\u52a0 OPTIONALLY \u9009\u9879\u5219\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a\u3002\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u5f15\u7528\u7b26 [[ OPTIONALLY ] ENCLOSED BY 'char' ] -- \u8f6c\u4e49\u5b57\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u2019\\\u2019 [ ESCAPED BY 'char' ] ] [ LINES -- \u6bcf\u884c\u524d\u90fd\u52a0\u6b64\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u5b57\u7b26\u4e32'' [ STARTING BY 'string' ] -- \u884c\u7ed3\u675f\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u2019\\n\u2019 [ TERMINATED BY 'string' ] ] \u4f46\u5982\u679c\u6307\u5b9a\u4e86\u4e24\u8005\uff0c\u5219FIELDS\u5fc5\u987b\u5728LINES\u4e4b\u524d\u3002 \u5176\u4e2d char \u8868\u793a\u6b64\u7b26\u53f7\u53ea\u80fd\u662f\u5355\u4e2a\u5b57\u7b26\uff0cstring \u8868\u793a\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3002 mysql > SELECT * FROM t1 INTO OUTFILE '/tmp/t1_data' FIELDS OPTIONALLY ENCLOSED BY '\"' ; -- \u5982\u679c\u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\uff0c\u53ef\u5728my.cnf\u4e2d\u6dfb\u52a0\u201csecure-file-priv=\u201d\uff0c\u7136\u540e\u91cd\u542f\u670d\u52a1\u5373\u53ef ERROR 1290 ( HY000 ): The MySQL server is running with the -- secure - file - priv option so it cannot execute this statement \u5f53\u5bfc\u51fa\u547d\u4ee4\u4e2d\u5305\u542b\u5b57\u6bb5\u5f15\u7528\u7b26\u65f6\uff0c\u6570\u636e\u4e2d\u542b\u6709 \u8f6c\u4e49\u5b57\u7b26\u672c\u8eab\u548c\u5b57\u6bb5\u5f15\u7528\u7b26 \u7684\u5b57\u7b26\u9700\u8981\u88ab\u8f6c\u4e49\uff1b \u5f53\u5bfc\u51fa\u547d\u4ee4\u4e2d\u4e0d\u5305\u542b\u5b57\u6bb5\u5f15\u7528\u7b26\u65f6\uff0c\u6570\u636e\u4e2d\u542b\u6709 \u8f6c\u4e49\u5b57\u7b26\u672c\u8eab\u548c\u5b57\u6bb5\u5206\u9694\u7b26 \u7684\u5b57\u7b26\u9700\u8981\u88ab\u8f6c\u4e49\u3002 \u4f7f\u7528 mysqldump \u547d\u4ee4 mysqldump [ OPTIONS ] database [ tables ] mysqldump [ OPTIONS ] --databases [OPTIONS] DB1 [DB2 DB3...] mysqldump [ OPTIONS ] --all-databases [OPTIONS] OPTIONS\u53c2\u6570\u6709\u597d\u591a\uff0c\u4e0b\u9762\u662f\u548c\u5206\u9694\u7b26\u6709\u5173\u7684\uff1a --fields-terminated-by=name\uff1a\u5b57\u6bb5\u5206\u9694\u7b26 --fields-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26 --fields-optionally-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a --fields-escaped-by=name\uff1a\u8f6c\u4e49\u5b57\u7b26 --lines-terminated-by=name\uff1a\u8bb0\u5f55\u7ed3\u675f\u7b26 $ mysqldump -uroot -p -T /tmp blog t1 --fields-terminated-by \",\" $ ll /tmp -rw-r--r--. 1 root root 1384 Jul 23 03 :39 t1.sql -rw-rw-rw-. 1 mysql mysql 279 Jul 23 03 :39 t1.txt \u5176\u5b9e\uff0cmysqldump \u5b9e\u9645\u8c03\u7528\u7684\u5c31\u662f SELECT INTO \u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u5e76\u5728\u5176\u4e0a\u9762\u6dfb\u52a0\u4e86\u4e00\u4e9b\u65b0\u7684\u529f\u80fd\u800c\u5df2\u3002","title":"4.1 \u5bfc\u51fa"},{"location":"mysql/32. MySQL\u5907\u4efd\u4e0e\u6062\u590d/#42","text":"\u672c\u8282\u53ea\u8ba8\u8bba\u7528 SELECT\u2026 INTO OUTFILE \u6216\u8005 mysqldump \u5bfc\u51fa\u7684\u7eaf\u6570\u636e\u6587\u672c\u7684\u5bfc\u5165\u65b9\u6cd5\u3002 \u5bfc\u5165\u4e5f\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f LOAD DATA INFILE\u2026 \u548c mysqlimport \uff0c\u5b83\u4eec\u7684\u672c\u8d28\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u53ea\u662f\u5728\u4e8e\u4e00\u4e2a\u5728 MySQL \u5185\u90e8\u6267\u884c\uff0c\u53e6\u4e00\u4e2a\u5728 MySQL \u5916\u90e8\u6267\u884c\u3002 \u4f7f\u7528 LOAD DAT \u547d\u4ee4 LOAD DATA INFILE 'file_name' [ REPLACE | IGNORE ] INTO TABLE tbl_name [ { FIELDS | COLUMNS } [ TERMINATED BY 'string' ] [[ OPTIONALLY ] ENCLOSED BY 'char' ] [ ESCAPED BY 'char' ] ] [ LINES [ STARTING BY 'string' ] [ TERMINATED BY 'string' ] ] -- \u5ffd\u7565\u524dN\u884c\u6570\u636e [ IGNORE number { LINES | ROWS } ] -- \u52a0\u8f7d\u7684\u5217\u53ca\u5217\u7684\u987a\u5e8f [( col_name_or_user_var [, col_name_or_user_var ] ...)] -- \u5c06\u5217\u4f5c\u4e00\u5b9a\u7684\u6570\u503c\u8f6c\u6362\u540e\u518d\u52a0\u8f7d [ SET col_name = { expr | DEFAULT } , [, col_name = { expr | DEFAULT } ] ...] \u5728\u8f7d\u5165\u4e4b\u524d\uff0c\u8868\u4e00\u5b9a\u8981\u5b58\u5728\u3002 LOAD DATA INFILE '/tmp/t1_data' INTO TABLE t1 ( id ) SET id = id + 2 ; \u4f7f\u7528 mysqlimport \u547d\u4ee4 mysqlimport [ OPTIONS ] database textfile ... OPTIONS\u53c2\u6570\u6709\u597d\u591a\uff0c\u4e0b\u9762\u662f\u548c\u5206\u9694\u7b26\u6709\u5173\u7684\uff1a --fields-terminated-by=name\uff1a\u5b57\u6bb5\u5206\u9694\u7b26 --fields-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26 --fields-optionally-enclosed-by=name\uff1a\u5b57\u6bb5\u5f15\u7528\u7b26\uff0c\u53ea\u7528\u5728 char\u3001varchar\u3001enum \u548c text \u7b49\u5b57\u7b26\u578b\u5b57\u6bb5\u4e0a --fields-escaped-by=name\uff1a\u8f6c\u4e49\u5b57\u7b26 --lines-terminated-by=name\uff1a\u8bb0\u5f55\u7ed3\u675f\u7b26 --ignore-lines=#\uff1a\u5ffd\u7565\u524dN\u884c\u6570\u636e mysqlimport - uroot - p -- fields - terminated - by = ',' blog / tmp / t1 . txt Note \u5982\u679c\u5bfc\u5165\u548c\u5bfc\u51fa\u662f\u8de8\u5e73\u53f0\u64cd\u4f5c\u7684 \uff08Windows \u548c Linux\uff09\uff0c\u90a3\u4e48\u8981\u6ce8\u610f\u8bbe\u7f6e\u53c2\u6570 line-terminated-by \uff0c Windows \u4e0a \u8bbe \u7f6e \u4e3a line-terminated-by=\u2019\\r\\n\u2019 \uff0c Linux \u4e0a \u8bbe \u7f6e \u4e3a line-terminated-by=\u2019\\n\u2019\u3002 \u6570\u636e\u7684\u5bfc\u5165\u5bfc\u51fa \u5728\u6570\u636e\u5e93\u7684\u7ba1\u7406\u7ef4\u62a4\u4e2d\u4f7f\u7528\u975e\u5e38\u9891\u7e41\uff0c\u800c LOAD DATA INFILE \u662f\u52a0\u8f7d\u6570\u636e\u6700\u5feb\u7684\u65b9\u6cd5\uff0c\u56e0\u6b64\u5e94\u91cd\u70b9\u638c\u63e1\u3002","title":"4.2 \u5bfc\u5165"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/","text":"MySQL \u7684\u6743\u9650\u7cfb\u7edf\u4e3b\u8981\u7528\u6765\u5bf9\u8fde\u63a5\u5230\u6570\u636e\u5e93\u7684\u7528\u6237\u8fdb\u884c\u6743\u9650\u7684\u9a8c\u8bc1\uff0c\u4ee5\u6b64\u6765\u5224\u65ad\u6b64\u7528\u6237\u662f \u5426\u5c5e\u4e8e\u5408\u6cd5\u7684\u7528\u6237\uff0c\u5982\u679c\u662f\u5408\u6cd5\u7528\u6237\u5219\u8d4b\u4e88\u76f8\u5e94\u7684\u6570\u636e\u5e93\u6743\u9650\u3002 1. MySQL \u6743\u9650\u7ba1\u7406 \u00b6 MySQL \u6743\u9650\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406\u548c\u8d26\u53f7\u7ba1\u7406 \u3002 1.1 \u6743\u9650\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406 \u00b6 MySQL \u6743\u9650\u7cfb\u7edf\u901a\u8fc7\u4e0b\u9762\u4e24\u4e2a\u9636\u6bb5\u8fdb\u884c\u8ba4\u8bc1\uff1a \u5bf9\u8fde\u63a5\u7684\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u5408\u6cd5\u7684\u7528\u6237\u901a\u8fc7\u8ba4\u8bc1\uff0c\u4e0d\u5408\u6cd5\u7684\u7528\u6237\u62d2\u7edd\u8fde\u63a5\uff1b \u5bf9\u901a\u8fc7\u8ba4\u8bc1\u7684\u5408\u6cd5\u7528\u6237\u8d4b\u4e88\u76f8\u5e94\u7684\u6743\u9650\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u4e9b\u6743\u9650\u8303\u56f4\u5185\u5bf9\u6570\u636e\u5e93\u505a\u76f8\u5e94\u7684\u64cd\u4f5c\u3002 MySQL \u7684\u6743\u9650\u8868\u5728\u6570\u636e\u5e93\u542f\u52a8\u7684\u65f6\u5019\u5c31\u8f7d\u5165\u5185\u5b58\uff0c\u5f53\u7528\u6237\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u540e\uff0c\u5c31\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u76f8\u5e94\u6743\u9650\u7684\u5b58\u53d6\uff0c\u8fd9\u6837\uff0c\u6b64\u7528\u6237\u5c31\u53ef\u4ee5\u5728\u6570\u636e\u5e93\u4e2d\u505a\u6743\u9650\u8303\u56f4\u5185\u7684\u5404\u79cd\u64cd\u4f5c\u4e86\u3002 \u5f53\u7528\u6237\u8fdb\u884c\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u6743\u9650\u8868\u7684\u5b58\u53d6\u8fc7\u7a0b\u6709\u4ee5\u4e0b\u4e24\u4e2a\u9636\u6bb5\uff1a \u5148\u4ece user \u8868\u4e2d\u7684 host\u3001user \u548c password \u8fd9 3 \u4e2a\u5b57\u6bb5\u4e2d\u5224\u65ad\u8fde\u63a5\u7684 IP\u3001\u7528\u6237\u540d\u548c\u5bc6\u7801\u662f\u5426\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5219\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5426\u5219\u62d2\u7edd\u8fde\u63a5\u3002 \u5982 \u679c \u901a \u8fc7 \u8eab \u4efd \u9a8c \u8bc1 \uff0c \u5219 \u6309 \u7167 \u4ee5 \u4e0b \u6743 \u9650 \u8868 \u7684 \u987a \u5e8f \u5f97 \u5230 \u6570 \u636e \u5e93 \u6743 \u9650 \uff1a user->db->tables_priv->columns_priv \u3002 \u5728\u8fd9\u4e9b\u6743\u9650\u8868\u4e2d\uff0c\u6743\u9650\u8303\u56f4\u4f9d\u6b21\u9012\u51cf\uff0c\u5168\u5c40\u6743\u9650\u8986\u76d6\u5c40\u90e8\u6743\u9650\u3002 1.2 \u8d26\u53f7\u7ba1\u7406 \u00b6 1.3 \u521b\u5efa\u8d26\u53f7\u4e0e\u5206\u914d\u6743\u9650 \u00b6 CREATE USER [ IF NOT EXISTS ] user [ auth_option ] [, user [ auth_option ]] ... DEFAULT ROLE role [, role ] ... [ REQUIRE { NONE | tls_option [[ AND ] tls_option ] ... } ] [ WITH resource_option [ resource_option ] ...] [ password_option | lock_option ] ... user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) auth_option : { IDENTIFIED BY 'auth_string' | IDENTIFIED WITH auth_plugin | IDENTIFIED WITH auth_plugin BY 'auth_string' | IDENTIFIED WITH auth_plugin AS 'hash_string' } tls_option : { SSL | X509 | CIPHER 'cipher' | ISSUER 'issuer' | SUBJECT 'subject' } -- \u8d26\u53f7\u8d44\u6e90\u9650\u5236 resource_option : { -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u67e5\u8be2\u6b21\u6570\uff0c\u9690\u5f0f\u67e5\u8be2\u548c\u5f88\u591a\u975eselect\u8bed\u53e5\u4e5f\u7b97\u5728\u5185 MAX_QUERIES_PER_HOUR count -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u66f4\u65b0\u6b21\u6570 | MAX_UPDATES_PER_HOUR count -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u8fde\u63a5\u6b21\u6570 | MAX_CONNECTIONS_PER_HOUR count -- \u6700\u5927\u7528\u6237\u8fde\u63a5\u6570\uff0c\u6307\u77ac\u95f4\u7684\u5e76\u53d1\u6570 | MAX_USER_CONNECTIONS count } -- \u5982\u679c\u8fbe\u5230\u9650\u5236\uff0c\u53ef\u4ee5\u6267\u884c\"flush user_resources/flush privileges/mysqladmin reload\"\u4e09\u4e2a\u547d\u4ee4\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u6e05\u9664\u3002\u91cd\u542f\u6570\u636e\u5e93\u4e5f\u53ef\u4ee5\u3002 -- \u5982\u679c\u8981\u5bf9\u8d44\u6e90\u89e3\u9664\u9650\u5236\uff0c\u53ef\u4ee5\u5c06\u76f8\u5e94\u53c2\u6570\u8bbe\u7f6e\u4e3a0 password_option : { PASSWORD EXPIRE [ DEFAULT | NEVER | INTERVAL N DAY ] | PASSWORD HISTORY { DEFAULT | N } | PASSWORD REUSE INTERVAL { DEFAULT | N DAY } | PASSWORD REQUIRE CURRENT [ DEFAULT | OPTIONAL ] } lock_option : { ACCOUNT LOCK | ACCOUNT UNLOCK } GRANT priv_type [( column_list )] [, priv_type [( column_list )]] ... ON [ object_type ] priv_level TO user_or_role [, user_or_role ] ... [ WITH GRANT OPTION ] GRANT PROXY ON user_or_role TO user_or_role [, user_or_role ] ... [ WITH GRANT OPTION ] GRANT role [, role ] ... TO user_or_role [, user_or_role ] ... [ WITH ADMIN OPTION ] priv_type : ( see https : // dev . mysql . com / doc / refman / 8 . 0 / en / privileges - provided . html ) object_type : { TABLE | FUNCTION | PROCEDURE } priv_level : { * | * . * | db_name . * | db_name . tbl_name | tbl_name | db_name . routine_name } user_or_role : { user | role } user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) role : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / role - names . html ) MySQL 8.0.11\u4e4b\u540e\u79fb\u9664\u4e86 GRANT \u6dfb\u52a0\u7528\u6237\u7684\u529f\u80fd\uff0c\u8981\u5148\u521b\u5efa\u7528\u6237\uff0c\u7136\u540e\u518d\u5206\u914d\u6743\u9650\uff1a CREATE USER test_user @ localhost IDENTIFIED BY 'MyNewPass2!' ; -- \u8d4b\u4e88\u6240\u6709\u6570\u636e\u5e93\u4e0a\u7684\u6240\u6709\u8868\u7684 select \u6743\u9650\uff0c\u6b64\u65f6user\u8868\u7684 Select_priv = Y\uff0c\u800cdb\u8868\u7684 Select_priv = N GRANT SELECT ON * . * TO test_user @ localhost ; -- \u6536\u56de\u6743\u9650 REVOKE SELECT ON * . * FROM test_user @ localhost ; -- \u8d4b\u4e88blog\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\u7684select\u6743\u9650\uff0c\u6b64\u65f6db\u8868\u7684 Select_priv = Y\uff0c\u800cuser\u8868\u7684 Select_priv = N GRANT SELECT ON blog . * TO test_user @ localhost ; \u4e3e\u4f8b -- \u8d4b\u4e88\u6240\u6709\u8868\u7684\u6240\u6709\u6743\u9650 GRANT ALL ON * . * TO test_user @ localhost ; -- \u67e5\u8be2\u53d1\u73b0\u9664\u4e86 Grant_priv = N\uff0c\u5176\u4f59\u7684\u6743\u9650\u90fd\u662fY SELECT * FROM user WHERE USER = 'test_user' \\ G ; -- \u540c\u65f6\u8d4b\u4e88 Grant_priv\u6743\u9650\uff0c\u6b64\u65f6\u518d\u6b21\u67e5\u8be2\uff0cGrant_priv = Y GRANT ALL ON * . * TO test_user @ localhost WITH GRANT OPTION ; \u7528\u6237\u540d\u7684 host \u90e8\u5206\uff1a \u53ef\u4ee5\u662f\u4e3b\u673a\u540d\u6216IP\uff0c\u6216\u2018localhost\u2019\u3002 \u53ef\u4ee5\u4f7f\u7528 LIKE \u7684\u901a\u914d\u7b26 % \u548c _ \u3002 '%' \u7684host\u503c\u4e0e\u6240\u6709\u7684\u4e3b\u673a\u540d\u5339\u914d\uff0c\u7a7a\u503c\u7b49\u4ef7\u4e8e '%' \u3002\u4f46\u662f\u4e0d\u9002\u7528\u672c\u5730\u4e3b\u673a\uff0c\u5fc5\u987b\u5355\u72ec\u4e3a localhost \u8d4b\u4e88\u6743\u9650\u3002 \u7a7a\u7684 username \u90e8\u5206\u8868\u793a\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8fde\u63a5 \u5f53\u6709\u591a\u4e2a\u5339\u914d\u7684\u89c4\u5219\u53ef\u4ee5\u5339\u914d\u65f6\uff0c\u6309\u4ee5\u4e0b\u539f\u5219\u9009\u53d6\uff1a \u5f53\u670d\u52a1\u5668\u8bfb\u53d6\u8868\u65f6\uff0c\u5b83\u9996\u5148\u4ee5\u6700\u5177\u4f53\u7684 Host \u503c\u6392\u5e8f\uff0c\u6709\u76f8\u540c Host \u503c\u7684\u6761\u76ee\u9996\u5148\u4ee5\u6700\u5177\u4f53\u7684 User \u503c\u6392\u5e8f \u3002 \u7ba1\u7406\u6743\u9650\uff08SUPER\u3001PROCESS\u3001FILE \uff09\u4e0d\u80fd\u591f\u6307\u5b9a\u67d0\u4e2a\u6570\u636e\u5e93\uff0con \u540e\u9762\u5fc5\u987b\u8ddf\u201c . \u201d \uff1a mysql > GRANT SUPER ON blog . * TO test_user @ localhost WITH GRANT OPTION ; ERROR 1221 ( HY000 ): Incorrect usage of DB GRANT and GLOBAL PRIVILEGES 1.4 \u67e5\u770b\u548c\u66f4\u6539\u8d26\u53f7\u6743\u9650 \u00b6 1.4.1 \u67e5\u770b\u6743\u9650 \u00b6 SHOW GRANTS FOR 'username' @ 'host' ; SHOW GRANTS FOR test_user @ localhost \\ G ; host \u53ef\u4ee5\u4e0d\u5199\uff0c\u9ed8\u8ba4\u662f\u201c%\u201d (\u5fc5\u987b\u6709 'username'@'host' \u8fd9\u4e2a\u7528\u6237\u624d\u53ef\u4ee5)\uff1a SHOW GRANTS FOR test_user ; 1.4.2 \u66f4\u6539\u6743\u9650 \u00b6 \u53ef\u4ee5\u518d\u6b21\u4f7f\u7528 GRANT \u8bed\u53e5\u66f4\u6539\u7528\u6237\u7684\u6743\u9650\u3002\u6ce8\u610f\uff0c\u662f\u76f4\u63a5\u66f4\u6539\uff0c\u800c\u4e0d\u662f\u589e\u52a0\u6743\u9650\u3002 \u56de\u6536\u6743\u9650\u53ef\u4ee5\u4f7f\u7528 REVOKE \u8bed\u53e5: REVOKE priv_type [( column_list )] [, priv_type [( column_list )]] ... ON [ object_type ] priv_level FROM user_or_role [, user_or_role ] ... REVOKE ALL [ PRIVILEGES ], GRANT OPTION FROM user_or_role [, user_or_role ] ... REVOKE PROXY ON user_or_role FROM user_or_role [, user_or_role ] ... REVOKE role [, role ] ... FROM user_or_role [, user_or_role ] ... user_or_role : { user | role } user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) role : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / role - names . html ) \u6ce8\u610f\uff1aREVOKE \u4e0d\u80fd\u56de\u6536\u7528\u6237\u7684 USAGE \uff08\u767b\u5f55\u6743\u9650\uff09\u6743\u9650\uff0c\u5373\u4e0d\u80fd\u5220\u9664\u7528\u6237\u3002 1.4.3 \u4fee\u6539\u5bc6\u7801 \u00b6 \u65b9\u6cd51\uff1a\u4f7f\u7528 mysqladmin \u547d\u4ee4 $ mysqladmin -u root -p -h localhost password 'MyPass1!' \u65b9\u6cd52\uff1a\u6267\u884c SET PASSWORD \u8bed\u53e5 SET PASSWORD [ FOR user ] = 'auth_string' [ REPLACE 'current_auth_string' ] [ RETAIN CURRENT PASSWORD ] SET PASSWORD FOR 'user3' @ 'www.ht.com' = 'xxxx' ; \u5982\u679c\u662f\u66f4\u6539\u81ea\u5df1\u7684\u5bc6\u7801\uff0c\u53ef\u4ee5\u7701\u7565 for \u8bed\u53e5 \u3002 \u65b9\u6cd5 3\uff1a\u76f4\u63a5\u66f4\u6539\u6570\u636e\u5e93\u7684 user \u8868\u3002 shell > mysql - u root mysql mysql > INSERT INTO user ( Host , User , Password ) -> VALUES ( '%' , 'jeffrey' , PASSWORD ( 'biscuit' )); mysql > FLUSH PRIVILEGES ; shell > mysql - u root mysql mysql > UPDATE user SET Password = PASSWORD ( 'bagel' ) WHERE Host = '%' AND User = 'francis' ; mysql > FLUSH PRIVILEGES ; PASSWORD(str) \u51fd\u6570\u5728MySQL 8.0.11\u88ab\u79fb\u9664\u4e86\u3002 \u65b9\u6cd54\uff1a\u4ee5\u4e0a\u65b9\u6cd5\u5728\u4fee\u6539\u5bc6\u7801\u65f6\u4f7f\u7528\u7684\u662f\u660e\u6587\uff0c\u5b58\u5728\u98ce\u9669\u3002\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528MD5\u5bc6\u7801\u503c\u5bf9\u5bc6\u7801\u8fdb\u884c\u66f4\u6539\uff1a GRANT USAGE ON * . * TO 'test_user' @ '%' IDENTIFIED BY PASSWORD 'XXXXXXXXX' ; \u6216 SET PASSWORD = 'xxxxxxxxxxxxxxxxxxxxxxxx' ; 1.4.4 \u5220\u9664\u8d26\u53f7 \u00b6 DROP USER [ IF EXISTS ] user [, user ] ... 2. MySQL \u5b89\u5168\u95ee\u9898 \u00b6 2.1 \u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173 \u00b6 \u4e3b\u8981\u51fa\u73b0\u5728 MySQL \u7684\u5b89\u88c5\u548c\u542f\u52a8\u8fc7\u7a0b\u4e2d \u3002 2.1.1 \u4e25\u683c\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\u8d26\u53f7\u548c\u6743\u9650 \u00b6 \u5728\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\u8981\u4e25\u683c\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\u7684\u8d26\u53f7\u548c\u6743\u9650\uff0c\u6bd4\u5982\uff1a \u9501\u5b9a mysql \u7528\u6237\uff1b \u5176\u4ed6\u4efb\u4f55\u7528\u6237\u90fd\u91c7\u53d6\u72ec\u7acb\u7684\u8d26\u53f7\u767b\u5f55\uff0c\u7ba1\u7406\u5458\u901a\u8fc7 mysql \u4e13\u6709\u7528\u6237\u7ba1\u7406 MySQL\uff0c\u6216\u8005\u901a\u8fc7 root su \u5230 mysql \u7528\u6237\u4e0b\u8fdb\u884c\u7ba1\u7406\uff1b mysql \u7528\u6237\u76ee\u5f55\u4e0b\uff0c\u9664\u4e86\u6570\u636e\u6587\u4ef6\u76ee\u5f55\uff0c\u5176\u4ed6\u6587\u4ef6\u548c\u76ee\u5f55\u5c5e\u4e3b\u90fd\u6539\u4e3a root\u3002 2.1.2 \u5c3d\u91cf\u907f\u514d\u4ee5 root \u6743\u9650\u8fd0\u884c MySQL \u00b6 MySQL \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u4e00\u822c\u4f1a\u5c06\u6570\u636e\u76ee\u5f55\u5c5e\u4e3b\u8bbe\u7f6e\u4e3a mysql \u7528\u6237\uff0c\u800c\u5c06 MySQL \u8f6f\u4ef6\u76ee\u5f55\u7684\u5c5e\u4e3b\u8bbe\u7f6e\u4e3a root\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5f53\u4f7f\u7528 mysql \u7528\u6237\u542f\u52a8\u6570\u636e\u5e93\u65f6\uff0c\u53ef\u4ee5\u9632\u6b62\u4efb\u4f55\u5177\u6709 FILE \u6743\u9650\uff08\u4f8b\u5982\u5bfc\u51fa\u6570\u636e\u5230\u6587\u4ef6\u4e2d\uff09\u7684\u7528\u6237\u80fd\u591f\u7528 root \u521b\u5efa\u6587\u4ef6\u3002\u800c\u5982\u679c\u4f7f\u7528 root \u7528\u6237\u542f\u52a8\u6570\u636e\u5e93\uff0c \u5219\u4efb\u4f55\u5177\u6709 FILE \u6743\u9650\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u8bfb\u5199 root \u7528\u6237\u7684\u6587\u4ef6 \uff0c\u8fd9\u6837\u4f1a\u7ed9\u7cfb\u7edf\u9020\u6210\u4e25\u91cd\u7684\u5b89\u5168\u9690\u60a3\u3002 \u5bf9\u4e8e\u67d0\u4e9b Linux \u5e73\u53f0,\u4ece RPM \u6216 Debian \u8f6f\u4ef6\u5305\u5b89\u88c5\u7684 MySQL \u5305\u62ec\u7528\u4e8e\u7ba1\u7406 MySQL \u670d\u52a1\u5668\u542f\u52a8\u548c\u5173\u95ed\u7684 systemd \u652f\u6301\u3002\u8fd9\u4e9b\u5e73\u53f0\u4e0a\u4e0d\u4f1a\u5b89\u88c5 mysqld_safe \uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u3002see Managing MySQL Server with systemd . 2.1.3 \u9632\u6b62 DNS \u6b3a\u9a97 \u00b6 \u521b\u5efa\u7528\u6237\u65f6\uff0chost \u53ef\u4ee5\u6307\u5b9a\u57df\u540d\u6216\u8005 IP \u5730\u5740\u3002\u4f46\u662f\uff0c\u5982\u679c\u6307\u5b9a\u57df\u540d\uff0c\u5c31\u53ef\u80fd\u5e26\u6765\u5982\u4e0b\u5b89\u5168\u9690\u60a3\uff1a\u5982\u679c\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\u88ab\u6076\u610f\u4fee\u6539\uff0c\u5219\u6570\u636e\u5e93\u5c31\u4f1a\u88ab\u6076\u610f\u7684 IP \u5730\u5740\u8fdb\u884c\u8bbf\u95ee\uff0c\u5bfc\u81f4\u5b89\u5168\u9690\u60a3\u3002 2.2 \u6570\u636e\u5e93\u76f8\u5173 \u00b6 \u95ee\u9898\u5927\u591a\u6570\u662f\u7531\u4e8e\u8d26\u53f7\u7684\u7ba1\u7406\u4e0d\u5f53\u9020\u6210\u7684\u3002 2.2.1 \u5220\u9664\u533f\u540d\u8d26\u53f7 \u00b6 \u5728\u67d0\u4e9b\u7248\u672c\u4e2d\uff0c\u5b89\u88c5\u5b8c\u6bd5 MySQL \u540e\uff0c\u4f1a\u81ea\u52a8\u5b89\u88c5\u4e00\u4e2a\u7a7a\u8d26\u53f7\uff0c\u6b64\u8d26\u53f7\u5177\u6709\u5bf9 test \u6570\u636e\u5e93\u7684\u5168\u90e8\u6743\u9650 \u3002\u666e\u901a\u7528\u6237\u53ea\u9700\u8981\u6267\u884c mysql \u547d\u4ee4\u5373\u53ef\u767b\u5f55 MySQL \u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u65f6\u5019\u9ed8\u8ba4\u4f7f\u7528\u4e86\u7a7a\u7528\u6237\uff0c\u53ef\u4ee5\u5728 test \u6570\u636e\u5e93\u91cc\u9762\u505a\u5404\u79cd\u64cd\u4f5c\uff0c\u6bd4\u5982\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5927\u8868\uff0c\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\uff0c\u8fd9\u6837\u5c06\u7ed9\u7cfb\u7edf\u9020\u6210\u5b89\u5168\u9690\u60a3 \u3002 \u5efa\u8bae\u5220\u9664\u6b64\u7a7a\u8d26\u53f7\uff0c\u6216\u8005\u5bf9\u6b64\u8d26\u53f7\u52a0\u5bc6\u7801 \u3002 DROP USER '' @ 'localhost' ; 2.2.2 \u7ed9 root \u8d26\u53f7\u8bbe\u7f6e\u53e3\u4ee4 \u00b6 \u67d0\u4e9b MySQL \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0croot \u9ed8\u8ba4\u53e3\u4ee4\u4e3a\u7a7a\uff0c\u9700\u8981\u9a6c\u4e0a\u4fee\u6539 root \u53e3\u4ee4 \u3002 2.2.3 \u8bbe\u7f6e\u5b89\u5168\u5bc6\u7801 \u00b6 \u4f7f\u7528\u5bc6\u7801\u671f\u95f4\u5c3d\u91cf\u4fdd\u8bc1\u4f7f\u7528\u8fc7\u7a0b\u5b89\u5168\uff0c\u4e0d\u4f1a\u88ab\u522b\u4eba\u7a83\u53d6\u3002 \u4f7f\u7528\u5bc6\u7801\u4e00\u822c\u662f\u91c7\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a \u76f4\u63a5\u5c06\u5bc6\u7801\u5199\u5728\u547d\u4ee4\u884c\u4e2d\u3002 \u4ea4\u4e92\u5f0f\u65b9\u5f0f\u8f93\u5165\u5bc6\u7801\u3002 \u5c06\u7528\u6237\u540d\u548c\u5bc6\u7801\u5199\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff0c\u8fde\u63a5\u7684\u65f6\u5019\u81ea\u52a8\u8bfb\u53d6\u3002\u6bd4\u5982\u5e94\u7528\u8fde\u63a5\u6570\u636e\u5e93\u6216\u8005\u6267\u884c\u4e00\u4e9b\u6279\u5904\u7406\u811a\u672c\u3002\u5bf9\u4e8e\u8fd9\u79cd\u65b9\u5f0f\uff0cMySQL \u4f9b\u4e86\u4e00\u79cd\u65b9\u6cd5\uff0c\u5728 my.cnf \u91cc\u9762\u5199\u5165\u8fde\u63a5\u4fe1\u606f\u3002 [client] user = username password = password \u7136\u540e\u5bf9\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u4e25\u683c\u7684\u6743\u9650\u9650\u5236 \uff1a chmod +600 my.cnf \u5f88\u663e\u7136\uff0c\u7b2c 1 \u79cd\u6700\u4e0d\u5b89\u5168\uff0c\u56e0\u4e3a\u5b83\u5c06\u5bc6\u7801\u5199\u6210\u4e3a\u660e\u6587\uff1b\u7b2c2 \u79cd\u6bd4\u8f83\u5b89\u5168\uff0c\u4f46\u662f\u53ea\u80fd\u4f7f\u7528\u5728\u4ea4\u4e92\u5f0f\u7684\u754c\u9762\u4e0b\uff1b\u7b2c 3 \u79cd\u4f7f\u7528\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4f46\u662f\u9700\u8981\u5c06\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u4e25\u683c\u7684\u5b58\u53d6\u6743\u9650\uff0c\u800c\u4e14\u4efb\u4f55\u53ea\u8981\u53ef\u4ee5\u767b\u5f55\u64cd\u4f5c\u7cfb\u7edf\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u81ea\u52a8\u767b\u5f55\uff0c\u5b58\u5728\u4e00\u5b9a\u7684\u5b89\u5168\u9690\u60a3\u3002 2.2.4 \u53ea\u6388\u4e88\u8d26\u53f7\u5fc5\u987b\u7684\u6743\u9650 \u00b6 \u53ea\u9700\u8981\u8d4b\u4e88\u666e\u901a\u7528\u6237\u5fc5\u987b\u7684\u6743\u9650\uff0c\u6bd4\u5982\uff1a Grant select , insert , update , delete on tablename to \u2018 username \u2019 @ \u2019 hostname \u2019 ; \u8d4b\u4e88\u7528\u6237\u6743\u9650\u7684\u65f6\u5019\u8d8a\u5177\u4f53\uff0c\u5219\u5bf9\u6570\u636e\u5e93\u8d8a\u5b89\u5168\u3002 2.2.5 \u9664 root \u5916\uff0c\u4efb\u4f55\u7528\u6237\u4e0d\u5e94\u6709 mysql \u5e93 user \u8868\u7684\u5b58\u53d6\u6743\u9650 \u00b6 \u7531\u4e8e MySQL \u4e2d\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539 mysql \u6570\u636e\u5e93\u7684 user \u8868\u8fdb\u884c\u6743\u9650\u7684\u589e\u52a0\u3001\u5220\u9664\u3001\u53d8\u66f4\u7b49\u64cd\u4f5c\uff0c\u56e0\u6b64\uff0c\u9664\u4e86 root \u4ee5\u5916\uff0c \u4efb\u4f55\u7528\u6237\u90fd\u4e0d\u5e94\u8be5 \u62e5\u6709\u5bf9 user \u8868\u7684\u5b58\u53d6\u6743\u9650\uff08SELECT\u3001UPDATE\u3001INSERT\u3001DELETE \u7b49\uff09\uff0c\u9020\u6210\u7cfb\u7edf\u7684\u5b89\u5168\u9690\u60a3\u3002 2.2.6 \u4e0d\u8981\u628a FILE\u3001PROCESS \u6216 SUPER \u6743\u9650\u6388\u4e88\u7ba1\u7406\u5458\u4ee5\u5916\u7684\u8d26\u53f7 \u00b6 FILE \u6743\u9650\u4e3b\u8981\u4ee5\u4e0b\u4f5c\u7528\uff1a \u5c06\u6570\u636e\u5e93\u7684\u4fe1\u606f\u901a\u8fc7 SELECT \u2026INTO OUTFILE\u2026\u5199\u5230\u670d\u52a1\u5668\u4e0a\u6709\u5199\u6743\u9650\u7684\u76ee\u5f55\u4e0b\uff0c\u4f5c\u4e3a\u6587\u672c\u683c\u5f0f\u5b58\u653e\u3002\u5177\u6709\u6743\u9650\u7684\u76ee\u5f55\u4e5f\u5c31\u662f\u542f\u52a8 MySQL \u65f6\u7684\u7528\u6237\u6743\u9650\u76ee\u5f55\u3002 \u53ef\u4ee5\u5c06\u6709\u8bfb\u6743\u9650\u7684\u6587\u672c\u6587\u4ef6\u901a\u8fc7 LOAD DATA INFILE\u2026\u547d\u4ee4\u5199\u5165\u6570\u636e\u5e93\u8868\uff0c\u5982\u679c\u8fd9\u4e9b\u8868\u4e2d\u5b58\u653e\u4e86\u5f88\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u5c06\u5bf9\u7cfb\u7edf\u9020\u6210\u5f88\u5927\u7684\u5b89\u5168\u9690\u60a3\u3002 PROCESS \u6743\u9650\u80fd\u88ab\u7528\u6765\u6267\u884c show processlist \u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u6240\u6709\u7528\u6237\u6267\u884c\u7684\u67e5\u8be2\u7684\u660e\u6587\u6587\u672c\uff0c\u5305\u62ec\u8bbe\u5b9a\u6216\u6539\u53d8\u5bc6\u7801\u7684\u67e5\u8be2\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u7528\u6237\u90fd\u53ef\u4ee5\u6267\u884c show processlist \u547d\u4ee4\uff0c\u4f46\u662f\u53ea\u80fd\u67e5\u8be2\u672c\u7528\u6237\u7684\u8fdb\u7a0b\u3002 SUPER \u6743\u9650\u80fd\u6267\u884c kill \u547d\u4ee4\uff0c\u7ec8\u6b62\u5176\u4ed6\u7528\u6237\u8fdb\u7a0b\u3002 mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+------------------------+------------------+ | 4 | event_scheduler | localhost | NULL | Daemon | 614 | Waiting on empty queue | NULL | | 9 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | +----+-----------------+-----------+------+---------+------+------------------------+------------------+ 2 rows in set ( 0 . 01 sec ) mysql > KILL 4 ; ERROR 2006 ( HY000 ): MySQL server has gone away No connection . Trying to reconnect ... Connection id : 10 Current database : blog ERROR 1094 ( HY000 ): Unknown thread id : 4 mysql > 2.2.7 LOAD DATA LOCAL \u5e26\u6765\u7684\u5b89\u5168\u95ee\u9898 \u00b6 LOAD DATA \u9ed8\u8ba4\u8bfb\u7684\u662f\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u52a0\u4e0a LOCAL \u53c2\u6570\u540e\uff0c\u5c31\u53ef\u4ee5\u5c06\u672c\u5730\u5177\u6709\u8bbf\u95ee\u6743\u9650\u7684\u6587\u4ef6\u52a0\u8f7d\u5230\u6570\u636e\u5e93\u4e2d\u3002\u8fd9\u5728\u5e26\u6765\u65b9\u4fbf\u7684\u540c\u65f6\uff0c\u4e5f\u5e26\u6765\u4e86\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898\u3002 \u53ef\u4ee5\u4efb\u610f\u52a0\u8f7d\u672c\u5730\u6587\u4ef6\u5230\u6570\u636e\u5e93\u3002 \u5728 Web \u73af\u5883\u4e2d\uff0c\u5ba2\u6237\u4ece Web \u670d\u52a1\u5668\u8fde\u63a5\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 LOAD DATA LOCAL \u8bed\u53e5\u6765\u8bfb\u53d6 Web \u670d\u52a1\u5668\u8fdb\u7a0b\u6709\u8bfb\u8bbf\u95ee\u6743\u9650\u7684\u4efb\u4f55\u6587\u4ef6\uff08\u5047\u5b9a\u7528\u6237\u53ef\u4ee5\u8fd0\u884c SQL \u670d\u52a1\u5668\u7684\u4efb\u4f55\u547d\u4ee4\uff09\u3002\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0cMySQL \u670d\u52a1\u5668\u7684\u5ba2\u6237\u5b9e\u9645\u4e0a\u662f Web \u670d\u52a1\u5668\uff0c\u800c\u4e0d\u662f\u8fde\u63a5 Web \u670d\u52a1\u5668\u7684\u7528\u6237\u8fd0\u884c\u7684\u7a0b\u5e8f\u3002 \u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u53ef\u4ee5\u7528 --local-infile=0 \u9009\u9879\u542f\u52a8 mysqld \u4ece\u670d\u52a1\u5668\u7aef\u7981\u7528\u6240\u6709 LOAD DATA LOCAL \u547d\u4ee4\u3002 \u5bf9\u4e8e mysql \u547d\u4ee4\u884c\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a --local-infile[=1] \u9009\u9879\u542f\u7528 LOAD DATA LOCAL \uff0c\u6216\u901a\u8fc7 --local-infile=0 \u9009\u9879\u7981\u7528\u3002\u7c7b\u4f3c\u5730\uff0c\u5bf9\u4e8e mysqlimport\uff0c --local or -L \u9009\u9879\u542f\u7528\u672c\u5730\u6570\u636e\u6587\u4ef6\u88c5\u8f7d\u3002\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u6210\u529f\u8fdb\u884c\u672c\u5730\u88c5\u8f7d\u9700\u8981\u670d\u52a1\u5668\u542f\u7528\u76f8\u5173\u9009\u9879\u3002 2.2.8 \u4f7f\u7528 MERGE \u5b58\u50a8\u5f15\u64ce\u6f5c\u85cf\u7684\u5b89\u5168\u6f0f\u6d1e \u00b6 MERGE \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u5728\u67d0\u4e9b\u7248\u672c\u4e2d\u53ef\u80fd\u5b58\u5728\u4ee5\u4e0b\u5b89\u5168\u6f0f\u6d1e\uff1a \u7528\u6237 A \u8d4b\u4e88\u8868 T \u7684\u6743\u9650\u7ed9\u7528\u6237 B\uff1b \u7528\u6237 B \u521b\u5efa\u4e00\u4e2a\u5305\u542b T \u7684 MERGE \u8868\uff0c\u505a\u5404\u79cd\u64cd\u4f5c\uff1b \u7528\u6237 A \u6536\u56de\u5bf9 T \u7684\u6743\u9650\u3002 \u5b58\u5728\u7684\u5b89\u5168\u9690\u60a3\u662f\u7528\u6237 B \u901a\u8fc7 merge \u8868\u4ecd\u7136\u53ef\u4ee5\u8bbf\u95ee\u8868 A \u4e2d\u7684\u6570\u636e\u3002 2.2.9 DROP TABLE \u547d\u4ee4\u5e76\u4e0d\u6536\u56de\u4ee5\u524d\u7684\u76f8\u5173\u8bbf\u95ee\u6388\u6743 \u00b6 DROP \u8868\u7684\u65f6\u5019\uff0c \u5176\u4ed6\u7528\u6237\u5bf9\u6b64\u8868\u7684\u6743\u9650\u5e76\u6ca1\u6709\u88ab\u6536\u56de \uff0c\u8fd9\u6837\u5bfc\u81f4\u91cd\u65b0\u521b\u5efa\u540c\u540d\u7684\u8868\u65f6\uff0c\u4ee5\u524d\u5176\u4ed6\u7528\u6237\u5bf9\u6b64\u8868\u7684\u6743\u9650\u4f1a\u81ea\u52a8\u8d4b\u4e88\uff0c\u8fdb\u800c\u4ea7\u751f\u6743\u9650\u5916\u6d41\u3002\u56e0\u6b64\uff0c\u5728\u5220\u9664\u8868\u65f6\uff0c\u8981\u540c\u65f6\u53d6\u6d88\u5176\u4ed6\u7528\u6237\u5728\u6b64\u8868\u4e0a\u7684\u76f8\u5e94\u6743\u9650 2.2.10 \u4f7f\u7528 SSL \u00b6 SSL\uff08Secure Socket Layer\uff0c\u5b89\u5168\u5957\u63a5\u5b57\u5c42\uff09\u662f\u4e00\u79cd\u5b89\u5168\u7f51\u7edc\u4f20\u8f93\u534f\u8bae \u3002 SSL \u534f\u8bae\u63d0\u4f9b\u7684\u670d\u52a1\u4e3b\u8981\u6709\uff1a \uff081\uff09\u8ba4\u8bc1\u7528\u6237\u548c\u670d\u52a1\u5668\uff0c\u786e\u4fdd\u6570\u636e\u53d1\u9001\u5230\u6b63\u786e\u7684\u5ba2\u6237\u673a\u548c\u670d\u52a1\u5668\uff1b \uff082\uff09\u52a0\u5bc6\u6570\u636e\u4ee5\u9632\u6b62\u6570\u636e\u4e2d\u9014\u88ab\u7a83\u53d6\uff1b \uff083\uff09\u7ef4\u62a4\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u786e\u4fdd\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u4e0d\u88ab\u6539\u53d8\u3002 \u5728 MySQL \u4e2d\uff0c\u8981\u60f3\u4f7f\u7528 SSL \u8fdb\u884c\u5b89\u5168\u4f20\u8f93\uff0c\u9700\u8981\u5728\u547d\u4ee4\u884c\u4e2d\u6216\u9009\u9879\u6587\u4ef6\u4e2d\u8bbe\u7f6e --ssl \u9009\u9879\uff1a \u5bf9\u4e8e\u670d\u52a1\u5668\uff0c\u201c--ssl\u201d\u9009\u9879\u89c4\u5b9a\u8be5\u670d\u52a1\u5668\u5141\u8bb8 SSL \u8fde\u63a5\u3002 \u5bf9\u4e8e\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5b83\u5141\u8bb8\u5ba2\u6237\u4f7f\u7528SSL \u8fde\u63a5\u670d\u52a1\u5668\u3002 \u5355\u5355\u8be5\u9009\u9879\u4e0d\u8db3\u4ee5\u4f7f\u7528 SSL \u8fde\u63a5\u3002\u8fd8\u5fc5\u987b\u6307\u5b9a --ssl-ca\u3001--ssl-cert\u3001--ssl-key \u9009\u9879\u3002 --ssl-ca=file_name \u542b\u53ef\u4fe1 SSL CA \u7684\u6e05\u5355\u7684\u6587\u4ef6\u7684\u8def\u5f84\u3002 --ssl-cert=file_name SSL \u8bc1\u4e66\u6587\u4ef6\u540d\uff0c\u7528\u4e8e\u5efa\u7acb\u5b89\u5168\u8fde\u63a5\u3002 --ssl-key=file_name SSL \u5bc6\u94a5\u6587\u4ef6\u540d\uff0c\u7528\u4e8e\u5efa\u7acb\u5b89\u5168\u8fde\u63a5\u3002 \u786e\u4fdd\u4f7f\u7528 SSL \u8fde\u63a5\u7684\u5b89\u5168\u65b9\u5f0f\u662f\uff0c\u4f7f\u7528\u542b REQUIRE SSL \u5b50\u53e5\u7684 GRANT \u8bed\u53e5\u5728\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u4e00 \u4e2a\u8d26\u6237\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u8d26\u6237\u6765\u8fde\u63a5\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u5747\u5e94\u542f\u7528 SSL \u652f\u6301\u3002 mysql > grant select on * . * to z4 identified by '123' REQUIRE ssl ; 2.2.11 \u5982\u679c\u53ef\u80fd\uff0c\u7ed9\u6240\u6709\u7528\u6237\u52a0\u4e0a\u8bbf\u95ee IP \u9650\u5236 \u00b6 2.2.12 REVOKE \u547d\u4ee4\u7684\u6f0f\u6d1e \u00b6 \u5f53\u7528\u6237\u5bf9\u591a\u6b21\u8d4b\u4e88\u6743\u9650\u540e\uff0c\u7531\u4e8e\u5404\u79cd\u539f\u56e0\uff0c\u9700\u8981\u5c06\u6b64\u7528\u6237\u7684\u6743\u9650\u5168\u90e8\u53d6\u6d88\uff0c\u6b64\u65f6\uff0cREVOKE \u547d\u4ee4\u53ef\u80fd\u5e76\u4e0d\u4f1a\u6309\u7167\u6211\u4eec\u7684\u610f\u613f\u6267\u884c \u3002 \u5728\u4e00\u4e2a\u6570\u636e\u5e93\u4e0a\u591a\u6b21\u8d4b\u4e88\u6743\u9650\uff0c\u6743\u9650\u4f1a\u81ea\u52a8\u5408\u5e76\uff1b\u4f46\u662f\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e0a\u591a\u6b21\u8d4b\u4e88\u6743\u9650\uff0c\u6bcf\u4e2a\u6570\u636e\u5e93\u4e0a\u90fd\u4f1a\u8ba4\u4e3a\u662f\u5355\u72ec\u7684\u4e00\u7ec4\u6743\u9650\uff0c\u5fc5\u987b\u5728\u6b64\u6570\u636e\u5e93\u4e0a\u7528 REVOKE \u547d\u4ee4\u6765\u5355\u72ec\u8fdb\u884c\u6743\u9650\u6536\u56de\uff0c\u800c REVOKE ALL PRIVILEGES ON *.* \u5e76\u4e0d\u4f1a\u66ff\u7528\u6237\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e2a\u8fc7\u7a0b\u3002 3. \u5176\u4ed6\u5b89\u5168\u8bbe\u7f6e\u9009\u9879 \u00b6 \u9664\u4e86\u4e0a\u9762\u4ecb\u7ecd\u7684\u90a3\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5b89\u5168\u9690\u60a3\u5916\uff0cMySQL \u672c\u8eab\u8fd8\u5e26\u7740\u4e00\u4e9b\u9009\u9879\uff0c\u9002\u5f53\u5730\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u5c06\u4f1a\u4f7f\u6570\u636e\u5e93\u66f4\u52a0\u5b89\u5168\u3002 3.1 old-passwords \u00b6 \u5728 MySQL 4.1 \u7248\u672c\u4e4b\u524d\uff0cPASSWORD \u51fd\u6570\u751f\u6210\u7684\u5bc6\u7801\u662f 16 \u4f4d\u30024.1 \u4ee5\u540e\uff0cMySQL \u6539\u8fdb\u4e86\u5bc6\u7801\u7b97\u6cd5\uff0c\u751f\u6210\u7684\u51fd\u6570\u503c\u53d8\u6210\u4e86 41 \u4f4d \u3002\u5728MySQL 8.0.11\u540e\u88ab\u79fb\u9664\u3002 \u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53 4.1 \u4ee5\u540e\u7684\u5ba2\u6237\u7aef\u8fde\u63a5 4.1 \u4ee5\u524d\u7684\u5ba2\u6237\u7aef\u65f6\uff0c\u6ca1\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u65b0\u5ba2\u6237\u7aef\u53ef\u4ee5\u7406\u89e3\u65b0\u65e7\u4e24\u79cd\u52a0\u5bc6\u7b97\u6cd5\u3002\u4f46\u662f\u53cd\u8fc7\u6765\uff0c\u5f53 4.1 \u4ee5\u524d\u7684\u5ba2\u6237\u7aef\u9700\u8981\u8fde\u63a5 4.1 \u4ee5\u540e\u7684\u670d\u52a1\u5668\u65f6\u5019\uff0c\u7531\u4e8e\u65e0\u6cd5\u7406\u89e3\u65b0\u7684\u5bc6\u7801\u7b97\u6cd5\uff0c\u53d1\u5230\u670d\u52a1\u5668\u7aef\u7684\u5bc6\u7801\u8fd8\u662f\u65e7\u7684\u7b97\u6cd5\u52a0\u5bc6\u540e\u7684\u7ed3\u679c\uff0c\u4e8e\u662f\u5bfc\u81f4\u5728\u65b0\u7684\u670d\u52a1\u5668\u4e0a\u51fa\u73b0\u4e0b\u9762\u65e0\u6cd5\u8ba4\u8bc1\u7684\u60c5\u51b5\u3002 \u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u529e\u6cd5\u89e3\u51b3\uff1a \uff081\uff09\u5728\u670d\u52a1\u5668\u7aef\u7528 OLD_PASSWORD \u51fd\u6570\u66f4\u6539\u5bc6\u7801\u4e3a\u65e7\u5bc6\u7801\u683c\u5f0f\uff0c\u5ba2\u6237\u7aef\u5148\u53ef\u4ee5\u8fdb\u884c\u6b63 \u5e38\u8fde\u63a5\uff1a mysql > SET PASSWORD FOR 'some_user' @ 'some_host' = OLD_PASSWORD ( 'mypass' ); \uff082\uff09\u5728 my.cnf \u7684[mysqld]\u4e2d\u589e\u52a0 old-passwords \u53c2\u6570\u5e76\u91cd\u542f\u670d\u52a1\u5668\uff0c\u8fd9\u6837\u65b0\u7684\u6570\u636e\u5e93\u8fde\u63a5 \u6210\u529f\u4e4b\u540e\u505a\u7684 set password\u3001grant\u3001password() \u64cd\u4f5c\u540e\uff0c\u751f\u6210\u7684\u65b0\u5bc6\u7801\u5168\u90e8\u53d8\u6210\u65e7\u7684\u5bc6\u7801\u683c\u5f0f\u3002 3.2 safe-user-create \u00b6 mysqld_safe \uff08\u4e00\u4e9b\u7cfb\u7edf\u6258\u7ba1\u7ed9systemd\u7ba1\u7406\uff09\u7684\u9009\u9879 --safe-user-create \u5982\u679c\u542f\u7528\uff0c\u7528\u6237\u5c06\u4e0d\u80fd\u7528 GRANT \u8bed\u53e5\u521b\u5efa\u65b0\u7528\u6237\uff0c\u9664\u975e\u7528\u6237\u6709 mysql \u6570\u636e\u5e93\u4e2duser \u8868\u7684 INSERT \u6743\u9650\u3002\u5982\u679c\u60f3\u8ba9\u7528\u6237\u5177\u6709\u6388\u6743\u6743\u9650\u6765\u521b\u5efa\u65b0\u7528\u6237\uff0c\u5e94\u7ed9\u7528\u6237\u6388\u4e88\u4e0b\u9762\u7684\u6743\u9650\uff1a mysql > GRANT INSERT ( user ) ON mysql . user TO 'user_name' @ 'host_name' ; \u8fd9\u6837\u786e\u4fdd\u7528\u6237\u4e0d\u80fd\u76f4\u63a5\u66f4\u6539\u6743\u9650\u5217\uff0c\u5fc5\u987b\u4f7f\u7528 GRANT \u8bed\u53e5\u7ed9\u5176\u4ed6\u7528\u6237\u6388\u4e88\u8be5\u6743\u9650\u3002 $ mysqld_safe --safe-user-create 3.3 secure-auth \u00b6 \u4f5c\u7528\u662f\u8ba9 MySQL 4.1 \u4ee5\u524d\u5ba2\u6237\u7aef\u65e0\u6cd5\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u3002\u5373\u4f7f\u4f7f\u7528\u4e86old-passwords \u53c2\u6570\u4e5f\u4e0d\u80fd\u8ba4\u8bc1\u3002 This option was removed in MySQL 8.0.3\u3002 3.4 skip-grant-tables \u00b6 mysqld_safe \u7684\u9009\u9879 --skip-grant-tables \u8fd9\u4e2a\u9009\u9879\u5bfc\u81f4\u670d\u52a1\u5668\u6839\u672c\u4e0d\u4f7f\u7528\u6743\u9650\u7cfb\u7edf\uff0c\u4ece\u800c\u7ed9\u6bcf\u4e2a\u4eba\u4ee5\u5b8c\u5168\u8bbf\u95ee\u6240\u6709\u6570\u636e\u5e93\u7684\u6743\u529b\u3002\u901a\u8fc7\u6267\u884c mysqladmin flush-privileges \u6216 mysqladmin reload \u6216 flush privileges \u8bed\u53e5\uff0c\u90fd\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\u5668\u518d\u6b21\u5f00\u59cb\u4f7f\u7528\u6388\u6743\u8868\u3002 $ mysqld_safe --skip-grant-tables 3.5 skip-networking \u00b6 --skip-networking \u5728\u7f51\u7edc\u4e0a\u4e0d\u5141\u8bb8 TCP/IP \u8fde\u63a5\uff0c\u6240\u6709\u5230\u6570\u636e\u5e93\u7684\u8fde\u63a5\u5fc5\u987b\u7ecf\u7531\u547d\u540d\u7ba1\u9053\uff08Named Pipes\uff09\u6216\u5171\u4eab\u5185\u5b58\uff08Shared Memory\uff09\u6216 UNIX \u5957\u63a5\u5b57\uff08SOCKET\uff09\u6587\u4ef6\u8fdb\u884c\u3002 \u8fd9\u4e2a\u9009\u9879\u9002\u5408\u5e94\u7528\u548c\u6570\u636e\u5e93\u5171\u7528\u4e00\u53f0\u670d\u52a1\u5668\u7684\u60c5\u51b5\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u5c06\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u8fdc\u7a0b\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5927\u5927\u589e\u5f3a\u4e86\u6570\u636e\u5e93\u7684\u5b89\u5168\u6027\uff0c\u4f46\u7ba1\u7406\u4e0d\u4fbf \u3002 3.6 skip-show-database \u00b6 \u4f7f\u7528 --skip-show-database \u9009\u9879\uff0c\u53ea\u5141\u8bb8\u6709 show databases \u6743\u9650\u7684\u7528\u6237\u6267\u884c show databases \u8bed\u53e5\uff0c\u8be5\u8bed\u53e5\u663e\u793a\u6240\u6709\u6570\u636e\u5e93\u540d\u3002","title":"33. MySQL \u6743\u9650\u4e0e\u5b89\u5168"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#1-mysql","text":"MySQL \u6743\u9650\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406\u548c\u8d26\u53f7\u7ba1\u7406 \u3002","title":"1. MySQL \u6743\u9650\u7ba1\u7406"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#11","text":"MySQL \u6743\u9650\u7cfb\u7edf\u901a\u8fc7\u4e0b\u9762\u4e24\u4e2a\u9636\u6bb5\u8fdb\u884c\u8ba4\u8bc1\uff1a \u5bf9\u8fde\u63a5\u7684\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u5408\u6cd5\u7684\u7528\u6237\u901a\u8fc7\u8ba4\u8bc1\uff0c\u4e0d\u5408\u6cd5\u7684\u7528\u6237\u62d2\u7edd\u8fde\u63a5\uff1b \u5bf9\u901a\u8fc7\u8ba4\u8bc1\u7684\u5408\u6cd5\u7528\u6237\u8d4b\u4e88\u76f8\u5e94\u7684\u6743\u9650\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u4e9b\u6743\u9650\u8303\u56f4\u5185\u5bf9\u6570\u636e\u5e93\u505a\u76f8\u5e94\u7684\u64cd\u4f5c\u3002 MySQL \u7684\u6743\u9650\u8868\u5728\u6570\u636e\u5e93\u542f\u52a8\u7684\u65f6\u5019\u5c31\u8f7d\u5165\u5185\u5b58\uff0c\u5f53\u7528\u6237\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u540e\uff0c\u5c31\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u76f8\u5e94\u6743\u9650\u7684\u5b58\u53d6\uff0c\u8fd9\u6837\uff0c\u6b64\u7528\u6237\u5c31\u53ef\u4ee5\u5728\u6570\u636e\u5e93\u4e2d\u505a\u6743\u9650\u8303\u56f4\u5185\u7684\u5404\u79cd\u64cd\u4f5c\u4e86\u3002 \u5f53\u7528\u6237\u8fdb\u884c\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u6743\u9650\u8868\u7684\u5b58\u53d6\u8fc7\u7a0b\u6709\u4ee5\u4e0b\u4e24\u4e2a\u9636\u6bb5\uff1a \u5148\u4ece user \u8868\u4e2d\u7684 host\u3001user \u548c password \u8fd9 3 \u4e2a\u5b57\u6bb5\u4e2d\u5224\u65ad\u8fde\u63a5\u7684 IP\u3001\u7528\u6237\u540d\u548c\u5bc6\u7801\u662f\u5426\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5219\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5426\u5219\u62d2\u7edd\u8fde\u63a5\u3002 \u5982 \u679c \u901a \u8fc7 \u8eab \u4efd \u9a8c \u8bc1 \uff0c \u5219 \u6309 \u7167 \u4ee5 \u4e0b \u6743 \u9650 \u8868 \u7684 \u987a \u5e8f \u5f97 \u5230 \u6570 \u636e \u5e93 \u6743 \u9650 \uff1a user->db->tables_priv->columns_priv \u3002 \u5728\u8fd9\u4e9b\u6743\u9650\u8868\u4e2d\uff0c\u6743\u9650\u8303\u56f4\u4f9d\u6b21\u9012\u51cf\uff0c\u5168\u5c40\u6743\u9650\u8986\u76d6\u5c40\u90e8\u6743\u9650\u3002","title":"1.1 \u6743\u9650\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#12","text":"","title":"1.2 \u8d26\u53f7\u7ba1\u7406"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#13","text":"CREATE USER [ IF NOT EXISTS ] user [ auth_option ] [, user [ auth_option ]] ... DEFAULT ROLE role [, role ] ... [ REQUIRE { NONE | tls_option [[ AND ] tls_option ] ... } ] [ WITH resource_option [ resource_option ] ...] [ password_option | lock_option ] ... user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) auth_option : { IDENTIFIED BY 'auth_string' | IDENTIFIED WITH auth_plugin | IDENTIFIED WITH auth_plugin BY 'auth_string' | IDENTIFIED WITH auth_plugin AS 'hash_string' } tls_option : { SSL | X509 | CIPHER 'cipher' | ISSUER 'issuer' | SUBJECT 'subject' } -- \u8d26\u53f7\u8d44\u6e90\u9650\u5236 resource_option : { -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u67e5\u8be2\u6b21\u6570\uff0c\u9690\u5f0f\u67e5\u8be2\u548c\u5f88\u591a\u975eselect\u8bed\u53e5\u4e5f\u7b97\u5728\u5185 MAX_QUERIES_PER_HOUR count -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u66f4\u65b0\u6b21\u6570 | MAX_UPDATES_PER_HOUR count -- \u5355\u4e2a\u8d26\u53f7\u6bcf\u5c0f\u65f6\u6700\u5927\u8fde\u63a5\u6b21\u6570 | MAX_CONNECTIONS_PER_HOUR count -- \u6700\u5927\u7528\u6237\u8fde\u63a5\u6570\uff0c\u6307\u77ac\u95f4\u7684\u5e76\u53d1\u6570 | MAX_USER_CONNECTIONS count } -- \u5982\u679c\u8fbe\u5230\u9650\u5236\uff0c\u53ef\u4ee5\u6267\u884c\"flush user_resources/flush privileges/mysqladmin reload\"\u4e09\u4e2a\u547d\u4ee4\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u6e05\u9664\u3002\u91cd\u542f\u6570\u636e\u5e93\u4e5f\u53ef\u4ee5\u3002 -- \u5982\u679c\u8981\u5bf9\u8d44\u6e90\u89e3\u9664\u9650\u5236\uff0c\u53ef\u4ee5\u5c06\u76f8\u5e94\u53c2\u6570\u8bbe\u7f6e\u4e3a0 password_option : { PASSWORD EXPIRE [ DEFAULT | NEVER | INTERVAL N DAY ] | PASSWORD HISTORY { DEFAULT | N } | PASSWORD REUSE INTERVAL { DEFAULT | N DAY } | PASSWORD REQUIRE CURRENT [ DEFAULT | OPTIONAL ] } lock_option : { ACCOUNT LOCK | ACCOUNT UNLOCK } GRANT priv_type [( column_list )] [, priv_type [( column_list )]] ... ON [ object_type ] priv_level TO user_or_role [, user_or_role ] ... [ WITH GRANT OPTION ] GRANT PROXY ON user_or_role TO user_or_role [, user_or_role ] ... [ WITH GRANT OPTION ] GRANT role [, role ] ... TO user_or_role [, user_or_role ] ... [ WITH ADMIN OPTION ] priv_type : ( see https : // dev . mysql . com / doc / refman / 8 . 0 / en / privileges - provided . html ) object_type : { TABLE | FUNCTION | PROCEDURE } priv_level : { * | * . * | db_name . * | db_name . tbl_name | tbl_name | db_name . routine_name } user_or_role : { user | role } user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) role : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / role - names . html ) MySQL 8.0.11\u4e4b\u540e\u79fb\u9664\u4e86 GRANT \u6dfb\u52a0\u7528\u6237\u7684\u529f\u80fd\uff0c\u8981\u5148\u521b\u5efa\u7528\u6237\uff0c\u7136\u540e\u518d\u5206\u914d\u6743\u9650\uff1a CREATE USER test_user @ localhost IDENTIFIED BY 'MyNewPass2!' ; -- \u8d4b\u4e88\u6240\u6709\u6570\u636e\u5e93\u4e0a\u7684\u6240\u6709\u8868\u7684 select \u6743\u9650\uff0c\u6b64\u65f6user\u8868\u7684 Select_priv = Y\uff0c\u800cdb\u8868\u7684 Select_priv = N GRANT SELECT ON * . * TO test_user @ localhost ; -- \u6536\u56de\u6743\u9650 REVOKE SELECT ON * . * FROM test_user @ localhost ; -- \u8d4b\u4e88blog\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\u7684select\u6743\u9650\uff0c\u6b64\u65f6db\u8868\u7684 Select_priv = Y\uff0c\u800cuser\u8868\u7684 Select_priv = N GRANT SELECT ON blog . * TO test_user @ localhost ; \u4e3e\u4f8b -- \u8d4b\u4e88\u6240\u6709\u8868\u7684\u6240\u6709\u6743\u9650 GRANT ALL ON * . * TO test_user @ localhost ; -- \u67e5\u8be2\u53d1\u73b0\u9664\u4e86 Grant_priv = N\uff0c\u5176\u4f59\u7684\u6743\u9650\u90fd\u662fY SELECT * FROM user WHERE USER = 'test_user' \\ G ; -- \u540c\u65f6\u8d4b\u4e88 Grant_priv\u6743\u9650\uff0c\u6b64\u65f6\u518d\u6b21\u67e5\u8be2\uff0cGrant_priv = Y GRANT ALL ON * . * TO test_user @ localhost WITH GRANT OPTION ; \u7528\u6237\u540d\u7684 host \u90e8\u5206\uff1a \u53ef\u4ee5\u662f\u4e3b\u673a\u540d\u6216IP\uff0c\u6216\u2018localhost\u2019\u3002 \u53ef\u4ee5\u4f7f\u7528 LIKE \u7684\u901a\u914d\u7b26 % \u548c _ \u3002 '%' \u7684host\u503c\u4e0e\u6240\u6709\u7684\u4e3b\u673a\u540d\u5339\u914d\uff0c\u7a7a\u503c\u7b49\u4ef7\u4e8e '%' \u3002\u4f46\u662f\u4e0d\u9002\u7528\u672c\u5730\u4e3b\u673a\uff0c\u5fc5\u987b\u5355\u72ec\u4e3a localhost \u8d4b\u4e88\u6743\u9650\u3002 \u7a7a\u7684 username \u90e8\u5206\u8868\u793a\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8fde\u63a5 \u5f53\u6709\u591a\u4e2a\u5339\u914d\u7684\u89c4\u5219\u53ef\u4ee5\u5339\u914d\u65f6\uff0c\u6309\u4ee5\u4e0b\u539f\u5219\u9009\u53d6\uff1a \u5f53\u670d\u52a1\u5668\u8bfb\u53d6\u8868\u65f6\uff0c\u5b83\u9996\u5148\u4ee5\u6700\u5177\u4f53\u7684 Host \u503c\u6392\u5e8f\uff0c\u6709\u76f8\u540c Host \u503c\u7684\u6761\u76ee\u9996\u5148\u4ee5\u6700\u5177\u4f53\u7684 User \u503c\u6392\u5e8f \u3002 \u7ba1\u7406\u6743\u9650\uff08SUPER\u3001PROCESS\u3001FILE \uff09\u4e0d\u80fd\u591f\u6307\u5b9a\u67d0\u4e2a\u6570\u636e\u5e93\uff0con \u540e\u9762\u5fc5\u987b\u8ddf\u201c . \u201d \uff1a mysql > GRANT SUPER ON blog . * TO test_user @ localhost WITH GRANT OPTION ; ERROR 1221 ( HY000 ): Incorrect usage of DB GRANT and GLOBAL PRIVILEGES","title":"1.3 \u521b\u5efa\u8d26\u53f7\u4e0e\u5206\u914d\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#14","text":"","title":"1.4 \u67e5\u770b\u548c\u66f4\u6539\u8d26\u53f7\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#141","text":"SHOW GRANTS FOR 'username' @ 'host' ; SHOW GRANTS FOR test_user @ localhost \\ G ; host \u53ef\u4ee5\u4e0d\u5199\uff0c\u9ed8\u8ba4\u662f\u201c%\u201d (\u5fc5\u987b\u6709 'username'@'host' \u8fd9\u4e2a\u7528\u6237\u624d\u53ef\u4ee5)\uff1a SHOW GRANTS FOR test_user ;","title":"1.4.1 \u67e5\u770b\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#142","text":"\u53ef\u4ee5\u518d\u6b21\u4f7f\u7528 GRANT \u8bed\u53e5\u66f4\u6539\u7528\u6237\u7684\u6743\u9650\u3002\u6ce8\u610f\uff0c\u662f\u76f4\u63a5\u66f4\u6539\uff0c\u800c\u4e0d\u662f\u589e\u52a0\u6743\u9650\u3002 \u56de\u6536\u6743\u9650\u53ef\u4ee5\u4f7f\u7528 REVOKE \u8bed\u53e5: REVOKE priv_type [( column_list )] [, priv_type [( column_list )]] ... ON [ object_type ] priv_level FROM user_or_role [, user_or_role ] ... REVOKE ALL [ PRIVILEGES ], GRANT OPTION FROM user_or_role [, user_or_role ] ... REVOKE PROXY ON user_or_role FROM user_or_role [, user_or_role ] ... REVOKE role [, role ] ... FROM user_or_role [, user_or_role ] ... user_or_role : { user | role } user : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / account - names . html ) role : ( see http : // dev . mysql . com / doc / refman / 8 . 0 / en / role - names . html ) \u6ce8\u610f\uff1aREVOKE \u4e0d\u80fd\u56de\u6536\u7528\u6237\u7684 USAGE \uff08\u767b\u5f55\u6743\u9650\uff09\u6743\u9650\uff0c\u5373\u4e0d\u80fd\u5220\u9664\u7528\u6237\u3002","title":"1.4.2 \u66f4\u6539\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#143","text":"\u65b9\u6cd51\uff1a\u4f7f\u7528 mysqladmin \u547d\u4ee4 $ mysqladmin -u root -p -h localhost password 'MyPass1!' \u65b9\u6cd52\uff1a\u6267\u884c SET PASSWORD \u8bed\u53e5 SET PASSWORD [ FOR user ] = 'auth_string' [ REPLACE 'current_auth_string' ] [ RETAIN CURRENT PASSWORD ] SET PASSWORD FOR 'user3' @ 'www.ht.com' = 'xxxx' ; \u5982\u679c\u662f\u66f4\u6539\u81ea\u5df1\u7684\u5bc6\u7801\uff0c\u53ef\u4ee5\u7701\u7565 for \u8bed\u53e5 \u3002 \u65b9\u6cd5 3\uff1a\u76f4\u63a5\u66f4\u6539\u6570\u636e\u5e93\u7684 user \u8868\u3002 shell > mysql - u root mysql mysql > INSERT INTO user ( Host , User , Password ) -> VALUES ( '%' , 'jeffrey' , PASSWORD ( 'biscuit' )); mysql > FLUSH PRIVILEGES ; shell > mysql - u root mysql mysql > UPDATE user SET Password = PASSWORD ( 'bagel' ) WHERE Host = '%' AND User = 'francis' ; mysql > FLUSH PRIVILEGES ; PASSWORD(str) \u51fd\u6570\u5728MySQL 8.0.11\u88ab\u79fb\u9664\u4e86\u3002 \u65b9\u6cd54\uff1a\u4ee5\u4e0a\u65b9\u6cd5\u5728\u4fee\u6539\u5bc6\u7801\u65f6\u4f7f\u7528\u7684\u662f\u660e\u6587\uff0c\u5b58\u5728\u98ce\u9669\u3002\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528MD5\u5bc6\u7801\u503c\u5bf9\u5bc6\u7801\u8fdb\u884c\u66f4\u6539\uff1a GRANT USAGE ON * . * TO 'test_user' @ '%' IDENTIFIED BY PASSWORD 'XXXXXXXXX' ; \u6216 SET PASSWORD = 'xxxxxxxxxxxxxxxxxxxxxxxx' ;","title":"1.4.3 \u4fee\u6539\u5bc6\u7801"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#144","text":"DROP USER [ IF EXISTS ] user [, user ] ...","title":"1.4.4 \u5220\u9664\u8d26\u53f7"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#2-mysql","text":"","title":"2. MySQL \u5b89\u5168\u95ee\u9898"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#21","text":"\u4e3b\u8981\u51fa\u73b0\u5728 MySQL \u7684\u5b89\u88c5\u548c\u542f\u52a8\u8fc7\u7a0b\u4e2d \u3002","title":"2.1 \u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#211","text":"\u5728\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\u8981\u4e25\u683c\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\u7684\u8d26\u53f7\u548c\u6743\u9650\uff0c\u6bd4\u5982\uff1a \u9501\u5b9a mysql \u7528\u6237\uff1b \u5176\u4ed6\u4efb\u4f55\u7528\u6237\u90fd\u91c7\u53d6\u72ec\u7acb\u7684\u8d26\u53f7\u767b\u5f55\uff0c\u7ba1\u7406\u5458\u901a\u8fc7 mysql \u4e13\u6709\u7528\u6237\u7ba1\u7406 MySQL\uff0c\u6216\u8005\u901a\u8fc7 root su \u5230 mysql \u7528\u6237\u4e0b\u8fdb\u884c\u7ba1\u7406\uff1b mysql \u7528\u6237\u76ee\u5f55\u4e0b\uff0c\u9664\u4e86\u6570\u636e\u6587\u4ef6\u76ee\u5f55\uff0c\u5176\u4ed6\u6587\u4ef6\u548c\u76ee\u5f55\u5c5e\u4e3b\u90fd\u6539\u4e3a root\u3002","title":"2.1.1 \u4e25\u683c\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\u8d26\u53f7\u548c\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#212-root-mysql","text":"MySQL \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u4e00\u822c\u4f1a\u5c06\u6570\u636e\u76ee\u5f55\u5c5e\u4e3b\u8bbe\u7f6e\u4e3a mysql \u7528\u6237\uff0c\u800c\u5c06 MySQL \u8f6f\u4ef6\u76ee\u5f55\u7684\u5c5e\u4e3b\u8bbe\u7f6e\u4e3a root\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u5f53\u4f7f\u7528 mysql \u7528\u6237\u542f\u52a8\u6570\u636e\u5e93\u65f6\uff0c\u53ef\u4ee5\u9632\u6b62\u4efb\u4f55\u5177\u6709 FILE \u6743\u9650\uff08\u4f8b\u5982\u5bfc\u51fa\u6570\u636e\u5230\u6587\u4ef6\u4e2d\uff09\u7684\u7528\u6237\u80fd\u591f\u7528 root \u521b\u5efa\u6587\u4ef6\u3002\u800c\u5982\u679c\u4f7f\u7528 root \u7528\u6237\u542f\u52a8\u6570\u636e\u5e93\uff0c \u5219\u4efb\u4f55\u5177\u6709 FILE \u6743\u9650\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u8bfb\u5199 root \u7528\u6237\u7684\u6587\u4ef6 \uff0c\u8fd9\u6837\u4f1a\u7ed9\u7cfb\u7edf\u9020\u6210\u4e25\u91cd\u7684\u5b89\u5168\u9690\u60a3\u3002 \u5bf9\u4e8e\u67d0\u4e9b Linux \u5e73\u53f0,\u4ece RPM \u6216 Debian \u8f6f\u4ef6\u5305\u5b89\u88c5\u7684 MySQL \u5305\u62ec\u7528\u4e8e\u7ba1\u7406 MySQL \u670d\u52a1\u5668\u542f\u52a8\u548c\u5173\u95ed\u7684 systemd \u652f\u6301\u3002\u8fd9\u4e9b\u5e73\u53f0\u4e0a\u4e0d\u4f1a\u5b89\u88c5 mysqld_safe \uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u3002see Managing MySQL Server with systemd .","title":"2.1.2 \u5c3d\u91cf\u907f\u514d\u4ee5 root \u6743\u9650\u8fd0\u884c MySQL"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#213-dns","text":"\u521b\u5efa\u7528\u6237\u65f6\uff0chost \u53ef\u4ee5\u6307\u5b9a\u57df\u540d\u6216\u8005 IP \u5730\u5740\u3002\u4f46\u662f\uff0c\u5982\u679c\u6307\u5b9a\u57df\u540d\uff0c\u5c31\u53ef\u80fd\u5e26\u6765\u5982\u4e0b\u5b89\u5168\u9690\u60a3\uff1a\u5982\u679c\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\u88ab\u6076\u610f\u4fee\u6539\uff0c\u5219\u6570\u636e\u5e93\u5c31\u4f1a\u88ab\u6076\u610f\u7684 IP \u5730\u5740\u8fdb\u884c\u8bbf\u95ee\uff0c\u5bfc\u81f4\u5b89\u5168\u9690\u60a3\u3002","title":"2.1.3 \u9632\u6b62 DNS \u6b3a\u9a97"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#22","text":"\u95ee\u9898\u5927\u591a\u6570\u662f\u7531\u4e8e\u8d26\u53f7\u7684\u7ba1\u7406\u4e0d\u5f53\u9020\u6210\u7684\u3002","title":"2.2 \u6570\u636e\u5e93\u76f8\u5173"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#221","text":"\u5728\u67d0\u4e9b\u7248\u672c\u4e2d\uff0c\u5b89\u88c5\u5b8c\u6bd5 MySQL \u540e\uff0c\u4f1a\u81ea\u52a8\u5b89\u88c5\u4e00\u4e2a\u7a7a\u8d26\u53f7\uff0c\u6b64\u8d26\u53f7\u5177\u6709\u5bf9 test \u6570\u636e\u5e93\u7684\u5168\u90e8\u6743\u9650 \u3002\u666e\u901a\u7528\u6237\u53ea\u9700\u8981\u6267\u884c mysql \u547d\u4ee4\u5373\u53ef\u767b\u5f55 MySQL \u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u65f6\u5019\u9ed8\u8ba4\u4f7f\u7528\u4e86\u7a7a\u7528\u6237\uff0c\u53ef\u4ee5\u5728 test \u6570\u636e\u5e93\u91cc\u9762\u505a\u5404\u79cd\u64cd\u4f5c\uff0c\u6bd4\u5982\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5927\u8868\uff0c\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\uff0c\u8fd9\u6837\u5c06\u7ed9\u7cfb\u7edf\u9020\u6210\u5b89\u5168\u9690\u60a3 \u3002 \u5efa\u8bae\u5220\u9664\u6b64\u7a7a\u8d26\u53f7\uff0c\u6216\u8005\u5bf9\u6b64\u8d26\u53f7\u52a0\u5bc6\u7801 \u3002 DROP USER '' @ 'localhost' ;","title":"2.2.1 \u5220\u9664\u533f\u540d\u8d26\u53f7"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#222-root","text":"\u67d0\u4e9b MySQL \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0croot \u9ed8\u8ba4\u53e3\u4ee4\u4e3a\u7a7a\uff0c\u9700\u8981\u9a6c\u4e0a\u4fee\u6539 root \u53e3\u4ee4 \u3002","title":"2.2.2 \u7ed9 root \u8d26\u53f7\u8bbe\u7f6e\u53e3\u4ee4"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#223","text":"\u4f7f\u7528\u5bc6\u7801\u671f\u95f4\u5c3d\u91cf\u4fdd\u8bc1\u4f7f\u7528\u8fc7\u7a0b\u5b89\u5168\uff0c\u4e0d\u4f1a\u88ab\u522b\u4eba\u7a83\u53d6\u3002 \u4f7f\u7528\u5bc6\u7801\u4e00\u822c\u662f\u91c7\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a \u76f4\u63a5\u5c06\u5bc6\u7801\u5199\u5728\u547d\u4ee4\u884c\u4e2d\u3002 \u4ea4\u4e92\u5f0f\u65b9\u5f0f\u8f93\u5165\u5bc6\u7801\u3002 \u5c06\u7528\u6237\u540d\u548c\u5bc6\u7801\u5199\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff0c\u8fde\u63a5\u7684\u65f6\u5019\u81ea\u52a8\u8bfb\u53d6\u3002\u6bd4\u5982\u5e94\u7528\u8fde\u63a5\u6570\u636e\u5e93\u6216\u8005\u6267\u884c\u4e00\u4e9b\u6279\u5904\u7406\u811a\u672c\u3002\u5bf9\u4e8e\u8fd9\u79cd\u65b9\u5f0f\uff0cMySQL \u4f9b\u4e86\u4e00\u79cd\u65b9\u6cd5\uff0c\u5728 my.cnf \u91cc\u9762\u5199\u5165\u8fde\u63a5\u4fe1\u606f\u3002 [client] user = username password = password \u7136\u540e\u5bf9\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u4e25\u683c\u7684\u6743\u9650\u9650\u5236 \uff1a chmod +600 my.cnf \u5f88\u663e\u7136\uff0c\u7b2c 1 \u79cd\u6700\u4e0d\u5b89\u5168\uff0c\u56e0\u4e3a\u5b83\u5c06\u5bc6\u7801\u5199\u6210\u4e3a\u660e\u6587\uff1b\u7b2c2 \u79cd\u6bd4\u8f83\u5b89\u5168\uff0c\u4f46\u662f\u53ea\u80fd\u4f7f\u7528\u5728\u4ea4\u4e92\u5f0f\u7684\u754c\u9762\u4e0b\uff1b\u7b2c 3 \u79cd\u4f7f\u7528\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4f46\u662f\u9700\u8981\u5c06\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u4e25\u683c\u7684\u5b58\u53d6\u6743\u9650\uff0c\u800c\u4e14\u4efb\u4f55\u53ea\u8981\u53ef\u4ee5\u767b\u5f55\u64cd\u4f5c\u7cfb\u7edf\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u81ea\u52a8\u767b\u5f55\uff0c\u5b58\u5728\u4e00\u5b9a\u7684\u5b89\u5168\u9690\u60a3\u3002","title":"2.2.3 \u8bbe\u7f6e\u5b89\u5168\u5bc6\u7801"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#224","text":"\u53ea\u9700\u8981\u8d4b\u4e88\u666e\u901a\u7528\u6237\u5fc5\u987b\u7684\u6743\u9650\uff0c\u6bd4\u5982\uff1a Grant select , insert , update , delete on tablename to \u2018 username \u2019 @ \u2019 hostname \u2019 ; \u8d4b\u4e88\u7528\u6237\u6743\u9650\u7684\u65f6\u5019\u8d8a\u5177\u4f53\uff0c\u5219\u5bf9\u6570\u636e\u5e93\u8d8a\u5b89\u5168\u3002","title":"2.2.4 \u53ea\u6388\u4e88\u8d26\u53f7\u5fc5\u987b\u7684\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#225-root-mysql-user","text":"\u7531\u4e8e MySQL \u4e2d\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539 mysql \u6570\u636e\u5e93\u7684 user \u8868\u8fdb\u884c\u6743\u9650\u7684\u589e\u52a0\u3001\u5220\u9664\u3001\u53d8\u66f4\u7b49\u64cd\u4f5c\uff0c\u56e0\u6b64\uff0c\u9664\u4e86 root \u4ee5\u5916\uff0c \u4efb\u4f55\u7528\u6237\u90fd\u4e0d\u5e94\u8be5 \u62e5\u6709\u5bf9 user \u8868\u7684\u5b58\u53d6\u6743\u9650\uff08SELECT\u3001UPDATE\u3001INSERT\u3001DELETE \u7b49\uff09\uff0c\u9020\u6210\u7cfb\u7edf\u7684\u5b89\u5168\u9690\u60a3\u3002","title":"2.2.5 \u9664 root \u5916\uff0c\u4efb\u4f55\u7528\u6237\u4e0d\u5e94\u6709 mysql \u5e93 user \u8868\u7684\u5b58\u53d6\u6743\u9650"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#226-fileprocess-super","text":"FILE \u6743\u9650\u4e3b\u8981\u4ee5\u4e0b\u4f5c\u7528\uff1a \u5c06\u6570\u636e\u5e93\u7684\u4fe1\u606f\u901a\u8fc7 SELECT \u2026INTO OUTFILE\u2026\u5199\u5230\u670d\u52a1\u5668\u4e0a\u6709\u5199\u6743\u9650\u7684\u76ee\u5f55\u4e0b\uff0c\u4f5c\u4e3a\u6587\u672c\u683c\u5f0f\u5b58\u653e\u3002\u5177\u6709\u6743\u9650\u7684\u76ee\u5f55\u4e5f\u5c31\u662f\u542f\u52a8 MySQL \u65f6\u7684\u7528\u6237\u6743\u9650\u76ee\u5f55\u3002 \u53ef\u4ee5\u5c06\u6709\u8bfb\u6743\u9650\u7684\u6587\u672c\u6587\u4ef6\u901a\u8fc7 LOAD DATA INFILE\u2026\u547d\u4ee4\u5199\u5165\u6570\u636e\u5e93\u8868\uff0c\u5982\u679c\u8fd9\u4e9b\u8868\u4e2d\u5b58\u653e\u4e86\u5f88\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u5c06\u5bf9\u7cfb\u7edf\u9020\u6210\u5f88\u5927\u7684\u5b89\u5168\u9690\u60a3\u3002 PROCESS \u6743\u9650\u80fd\u88ab\u7528\u6765\u6267\u884c show processlist \u547d\u4ee4\uff0c\u67e5\u770b\u5f53\u524d\u6240\u6709\u7528\u6237\u6267\u884c\u7684\u67e5\u8be2\u7684\u660e\u6587\u6587\u672c\uff0c\u5305\u62ec\u8bbe\u5b9a\u6216\u6539\u53d8\u5bc6\u7801\u7684\u67e5\u8be2\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u7528\u6237\u90fd\u53ef\u4ee5\u6267\u884c show processlist \u547d\u4ee4\uff0c\u4f46\u662f\u53ea\u80fd\u67e5\u8be2\u672c\u7528\u6237\u7684\u8fdb\u7a0b\u3002 SUPER \u6743\u9650\u80fd\u6267\u884c kill \u547d\u4ee4\uff0c\u7ec8\u6b62\u5176\u4ed6\u7528\u6237\u8fdb\u7a0b\u3002 mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+------------------------+------------------+ | 4 | event_scheduler | localhost | NULL | Daemon | 614 | Waiting on empty queue | NULL | | 9 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | +----+-----------------+-----------+------+---------+------+------------------------+------------------+ 2 rows in set ( 0 . 01 sec ) mysql > KILL 4 ; ERROR 2006 ( HY000 ): MySQL server has gone away No connection . Trying to reconnect ... Connection id : 10 Current database : blog ERROR 1094 ( HY000 ): Unknown thread id : 4 mysql >","title":"2.2.6 \u4e0d\u8981\u628a FILE\u3001PROCESS \u6216 SUPER \u6743\u9650\u6388\u4e88\u7ba1\u7406\u5458\u4ee5\u5916\u7684\u8d26\u53f7"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#227-load-data-local","text":"LOAD DATA \u9ed8\u8ba4\u8bfb\u7684\u662f\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u52a0\u4e0a LOCAL \u53c2\u6570\u540e\uff0c\u5c31\u53ef\u4ee5\u5c06\u672c\u5730\u5177\u6709\u8bbf\u95ee\u6743\u9650\u7684\u6587\u4ef6\u52a0\u8f7d\u5230\u6570\u636e\u5e93\u4e2d\u3002\u8fd9\u5728\u5e26\u6765\u65b9\u4fbf\u7684\u540c\u65f6\uff0c\u4e5f\u5e26\u6765\u4e86\u4ee5\u4e0b\u5b89\u5168\u95ee\u9898\u3002 \u53ef\u4ee5\u4efb\u610f\u52a0\u8f7d\u672c\u5730\u6587\u4ef6\u5230\u6570\u636e\u5e93\u3002 \u5728 Web \u73af\u5883\u4e2d\uff0c\u5ba2\u6237\u4ece Web \u670d\u52a1\u5668\u8fde\u63a5\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 LOAD DATA LOCAL \u8bed\u53e5\u6765\u8bfb\u53d6 Web \u670d\u52a1\u5668\u8fdb\u7a0b\u6709\u8bfb\u8bbf\u95ee\u6743\u9650\u7684\u4efb\u4f55\u6587\u4ef6\uff08\u5047\u5b9a\u7528\u6237\u53ef\u4ee5\u8fd0\u884c SQL \u670d\u52a1\u5668\u7684\u4efb\u4f55\u547d\u4ee4\uff09\u3002\u5728\u8fd9\u79cd\u73af\u5883\u4e2d\uff0cMySQL \u670d\u52a1\u5668\u7684\u5ba2\u6237\u5b9e\u9645\u4e0a\u662f Web \u670d\u52a1\u5668\uff0c\u800c\u4e0d\u662f\u8fde\u63a5 Web \u670d\u52a1\u5668\u7684\u7528\u6237\u8fd0\u884c\u7684\u7a0b\u5e8f\u3002 \u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u53ef\u4ee5\u7528 --local-infile=0 \u9009\u9879\u542f\u52a8 mysqld \u4ece\u670d\u52a1\u5668\u7aef\u7981\u7528\u6240\u6709 LOAD DATA LOCAL \u547d\u4ee4\u3002 \u5bf9\u4e8e mysql \u547d\u4ee4\u884c\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a --local-infile[=1] \u9009\u9879\u542f\u7528 LOAD DATA LOCAL \uff0c\u6216\u901a\u8fc7 --local-infile=0 \u9009\u9879\u7981\u7528\u3002\u7c7b\u4f3c\u5730\uff0c\u5bf9\u4e8e mysqlimport\uff0c --local or -L \u9009\u9879\u542f\u7528\u672c\u5730\u6570\u636e\u6587\u4ef6\u88c5\u8f7d\u3002\u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u6210\u529f\u8fdb\u884c\u672c\u5730\u88c5\u8f7d\u9700\u8981\u670d\u52a1\u5668\u542f\u7528\u76f8\u5173\u9009\u9879\u3002","title":"2.2.7 LOAD DATA LOCAL \u5e26\u6765\u7684\u5b89\u5168\u95ee\u9898"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#228-merge","text":"MERGE \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u5728\u67d0\u4e9b\u7248\u672c\u4e2d\u53ef\u80fd\u5b58\u5728\u4ee5\u4e0b\u5b89\u5168\u6f0f\u6d1e\uff1a \u7528\u6237 A \u8d4b\u4e88\u8868 T \u7684\u6743\u9650\u7ed9\u7528\u6237 B\uff1b \u7528\u6237 B \u521b\u5efa\u4e00\u4e2a\u5305\u542b T \u7684 MERGE \u8868\uff0c\u505a\u5404\u79cd\u64cd\u4f5c\uff1b \u7528\u6237 A \u6536\u56de\u5bf9 T \u7684\u6743\u9650\u3002 \u5b58\u5728\u7684\u5b89\u5168\u9690\u60a3\u662f\u7528\u6237 B \u901a\u8fc7 merge \u8868\u4ecd\u7136\u53ef\u4ee5\u8bbf\u95ee\u8868 A \u4e2d\u7684\u6570\u636e\u3002","title":"2.2.8 \u4f7f\u7528 MERGE \u5b58\u50a8\u5f15\u64ce\u6f5c\u85cf\u7684\u5b89\u5168\u6f0f\u6d1e"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#229-drop-table","text":"DROP \u8868\u7684\u65f6\u5019\uff0c \u5176\u4ed6\u7528\u6237\u5bf9\u6b64\u8868\u7684\u6743\u9650\u5e76\u6ca1\u6709\u88ab\u6536\u56de \uff0c\u8fd9\u6837\u5bfc\u81f4\u91cd\u65b0\u521b\u5efa\u540c\u540d\u7684\u8868\u65f6\uff0c\u4ee5\u524d\u5176\u4ed6\u7528\u6237\u5bf9\u6b64\u8868\u7684\u6743\u9650\u4f1a\u81ea\u52a8\u8d4b\u4e88\uff0c\u8fdb\u800c\u4ea7\u751f\u6743\u9650\u5916\u6d41\u3002\u56e0\u6b64\uff0c\u5728\u5220\u9664\u8868\u65f6\uff0c\u8981\u540c\u65f6\u53d6\u6d88\u5176\u4ed6\u7528\u6237\u5728\u6b64\u8868\u4e0a\u7684\u76f8\u5e94\u6743\u9650","title":"2.2.9 DROP TABLE \u547d\u4ee4\u5e76\u4e0d\u6536\u56de\u4ee5\u524d\u7684\u76f8\u5173\u8bbf\u95ee\u6388\u6743"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#2210-ssl","text":"SSL\uff08Secure Socket Layer\uff0c\u5b89\u5168\u5957\u63a5\u5b57\u5c42\uff09\u662f\u4e00\u79cd\u5b89\u5168\u7f51\u7edc\u4f20\u8f93\u534f\u8bae \u3002 SSL \u534f\u8bae\u63d0\u4f9b\u7684\u670d\u52a1\u4e3b\u8981\u6709\uff1a \uff081\uff09\u8ba4\u8bc1\u7528\u6237\u548c\u670d\u52a1\u5668\uff0c\u786e\u4fdd\u6570\u636e\u53d1\u9001\u5230\u6b63\u786e\u7684\u5ba2\u6237\u673a\u548c\u670d\u52a1\u5668\uff1b \uff082\uff09\u52a0\u5bc6\u6570\u636e\u4ee5\u9632\u6b62\u6570\u636e\u4e2d\u9014\u88ab\u7a83\u53d6\uff1b \uff083\uff09\u7ef4\u62a4\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u786e\u4fdd\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u4e0d\u88ab\u6539\u53d8\u3002 \u5728 MySQL \u4e2d\uff0c\u8981\u60f3\u4f7f\u7528 SSL \u8fdb\u884c\u5b89\u5168\u4f20\u8f93\uff0c\u9700\u8981\u5728\u547d\u4ee4\u884c\u4e2d\u6216\u9009\u9879\u6587\u4ef6\u4e2d\u8bbe\u7f6e --ssl \u9009\u9879\uff1a \u5bf9\u4e8e\u670d\u52a1\u5668\uff0c\u201c--ssl\u201d\u9009\u9879\u89c4\u5b9a\u8be5\u670d\u52a1\u5668\u5141\u8bb8 SSL \u8fde\u63a5\u3002 \u5bf9\u4e8e\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5b83\u5141\u8bb8\u5ba2\u6237\u4f7f\u7528SSL \u8fde\u63a5\u670d\u52a1\u5668\u3002 \u5355\u5355\u8be5\u9009\u9879\u4e0d\u8db3\u4ee5\u4f7f\u7528 SSL \u8fde\u63a5\u3002\u8fd8\u5fc5\u987b\u6307\u5b9a --ssl-ca\u3001--ssl-cert\u3001--ssl-key \u9009\u9879\u3002 --ssl-ca=file_name \u542b\u53ef\u4fe1 SSL CA \u7684\u6e05\u5355\u7684\u6587\u4ef6\u7684\u8def\u5f84\u3002 --ssl-cert=file_name SSL \u8bc1\u4e66\u6587\u4ef6\u540d\uff0c\u7528\u4e8e\u5efa\u7acb\u5b89\u5168\u8fde\u63a5\u3002 --ssl-key=file_name SSL \u5bc6\u94a5\u6587\u4ef6\u540d\uff0c\u7528\u4e8e\u5efa\u7acb\u5b89\u5168\u8fde\u63a5\u3002 \u786e\u4fdd\u4f7f\u7528 SSL \u8fde\u63a5\u7684\u5b89\u5168\u65b9\u5f0f\u662f\uff0c\u4f7f\u7528\u542b REQUIRE SSL \u5b50\u53e5\u7684 GRANT \u8bed\u53e5\u5728\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u4e00 \u4e2a\u8d26\u6237\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u8d26\u6237\u6765\u8fde\u63a5\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u5747\u5e94\u542f\u7528 SSL \u652f\u6301\u3002 mysql > grant select on * . * to z4 identified by '123' REQUIRE ssl ;","title":"2.2.10 \u4f7f\u7528 SSL"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#2211-ip","text":"","title":"2.2.11 \u5982\u679c\u53ef\u80fd\uff0c\u7ed9\u6240\u6709\u7528\u6237\u52a0\u4e0a\u8bbf\u95ee IP \u9650\u5236"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#2212-revoke","text":"\u5f53\u7528\u6237\u5bf9\u591a\u6b21\u8d4b\u4e88\u6743\u9650\u540e\uff0c\u7531\u4e8e\u5404\u79cd\u539f\u56e0\uff0c\u9700\u8981\u5c06\u6b64\u7528\u6237\u7684\u6743\u9650\u5168\u90e8\u53d6\u6d88\uff0c\u6b64\u65f6\uff0cREVOKE \u547d\u4ee4\u53ef\u80fd\u5e76\u4e0d\u4f1a\u6309\u7167\u6211\u4eec\u7684\u610f\u613f\u6267\u884c \u3002 \u5728\u4e00\u4e2a\u6570\u636e\u5e93\u4e0a\u591a\u6b21\u8d4b\u4e88\u6743\u9650\uff0c\u6743\u9650\u4f1a\u81ea\u52a8\u5408\u5e76\uff1b\u4f46\u662f\u5728\u591a\u4e2a\u6570\u636e\u5e93\u4e0a\u591a\u6b21\u8d4b\u4e88\u6743\u9650\uff0c\u6bcf\u4e2a\u6570\u636e\u5e93\u4e0a\u90fd\u4f1a\u8ba4\u4e3a\u662f\u5355\u72ec\u7684\u4e00\u7ec4\u6743\u9650\uff0c\u5fc5\u987b\u5728\u6b64\u6570\u636e\u5e93\u4e0a\u7528 REVOKE \u547d\u4ee4\u6765\u5355\u72ec\u8fdb\u884c\u6743\u9650\u6536\u56de\uff0c\u800c REVOKE ALL PRIVILEGES ON *.* \u5e76\u4e0d\u4f1a\u66ff\u7528\u6237\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e2a\u8fc7\u7a0b\u3002","title":"2.2.12 REVOKE \u547d\u4ee4\u7684\u6f0f\u6d1e"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#3","text":"\u9664\u4e86\u4e0a\u9762\u4ecb\u7ecd\u7684\u90a3\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5b89\u5168\u9690\u60a3\u5916\uff0cMySQL \u672c\u8eab\u8fd8\u5e26\u7740\u4e00\u4e9b\u9009\u9879\uff0c\u9002\u5f53\u5730\u4f7f\u7528\u8fd9\u4e9b\u9009\u9879\u5c06\u4f1a\u4f7f\u6570\u636e\u5e93\u66f4\u52a0\u5b89\u5168\u3002","title":"3. \u5176\u4ed6\u5b89\u5168\u8bbe\u7f6e\u9009\u9879"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#31-old-passwords","text":"\u5728 MySQL 4.1 \u7248\u672c\u4e4b\u524d\uff0cPASSWORD \u51fd\u6570\u751f\u6210\u7684\u5bc6\u7801\u662f 16 \u4f4d\u30024.1 \u4ee5\u540e\uff0cMySQL \u6539\u8fdb\u4e86\u5bc6\u7801\u7b97\u6cd5\uff0c\u751f\u6210\u7684\u51fd\u6570\u503c\u53d8\u6210\u4e86 41 \u4f4d \u3002\u5728MySQL 8.0.11\u540e\u88ab\u79fb\u9664\u3002 \u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53 4.1 \u4ee5\u540e\u7684\u5ba2\u6237\u7aef\u8fde\u63a5 4.1 \u4ee5\u524d\u7684\u5ba2\u6237\u7aef\u65f6\uff0c\u6ca1\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u65b0\u5ba2\u6237\u7aef\u53ef\u4ee5\u7406\u89e3\u65b0\u65e7\u4e24\u79cd\u52a0\u5bc6\u7b97\u6cd5\u3002\u4f46\u662f\u53cd\u8fc7\u6765\uff0c\u5f53 4.1 \u4ee5\u524d\u7684\u5ba2\u6237\u7aef\u9700\u8981\u8fde\u63a5 4.1 \u4ee5\u540e\u7684\u670d\u52a1\u5668\u65f6\u5019\uff0c\u7531\u4e8e\u65e0\u6cd5\u7406\u89e3\u65b0\u7684\u5bc6\u7801\u7b97\u6cd5\uff0c\u53d1\u5230\u670d\u52a1\u5668\u7aef\u7684\u5bc6\u7801\u8fd8\u662f\u65e7\u7684\u7b97\u6cd5\u52a0\u5bc6\u540e\u7684\u7ed3\u679c\uff0c\u4e8e\u662f\u5bfc\u81f4\u5728\u65b0\u7684\u670d\u52a1\u5668\u4e0a\u51fa\u73b0\u4e0b\u9762\u65e0\u6cd5\u8ba4\u8bc1\u7684\u60c5\u51b5\u3002 \u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u91c7\u7528\u4ee5\u4e0b\u4e24\u79cd\u529e\u6cd5\u89e3\u51b3\uff1a \uff081\uff09\u5728\u670d\u52a1\u5668\u7aef\u7528 OLD_PASSWORD \u51fd\u6570\u66f4\u6539\u5bc6\u7801\u4e3a\u65e7\u5bc6\u7801\u683c\u5f0f\uff0c\u5ba2\u6237\u7aef\u5148\u53ef\u4ee5\u8fdb\u884c\u6b63 \u5e38\u8fde\u63a5\uff1a mysql > SET PASSWORD FOR 'some_user' @ 'some_host' = OLD_PASSWORD ( 'mypass' ); \uff082\uff09\u5728 my.cnf \u7684[mysqld]\u4e2d\u589e\u52a0 old-passwords \u53c2\u6570\u5e76\u91cd\u542f\u670d\u52a1\u5668\uff0c\u8fd9\u6837\u65b0\u7684\u6570\u636e\u5e93\u8fde\u63a5 \u6210\u529f\u4e4b\u540e\u505a\u7684 set password\u3001grant\u3001password() \u64cd\u4f5c\u540e\uff0c\u751f\u6210\u7684\u65b0\u5bc6\u7801\u5168\u90e8\u53d8\u6210\u65e7\u7684\u5bc6\u7801\u683c\u5f0f\u3002","title":"3.1 old-passwords"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#32-safe-user-create","text":"mysqld_safe \uff08\u4e00\u4e9b\u7cfb\u7edf\u6258\u7ba1\u7ed9systemd\u7ba1\u7406\uff09\u7684\u9009\u9879 --safe-user-create \u5982\u679c\u542f\u7528\uff0c\u7528\u6237\u5c06\u4e0d\u80fd\u7528 GRANT \u8bed\u53e5\u521b\u5efa\u65b0\u7528\u6237\uff0c\u9664\u975e\u7528\u6237\u6709 mysql \u6570\u636e\u5e93\u4e2duser \u8868\u7684 INSERT \u6743\u9650\u3002\u5982\u679c\u60f3\u8ba9\u7528\u6237\u5177\u6709\u6388\u6743\u6743\u9650\u6765\u521b\u5efa\u65b0\u7528\u6237\uff0c\u5e94\u7ed9\u7528\u6237\u6388\u4e88\u4e0b\u9762\u7684\u6743\u9650\uff1a mysql > GRANT INSERT ( user ) ON mysql . user TO 'user_name' @ 'host_name' ; \u8fd9\u6837\u786e\u4fdd\u7528\u6237\u4e0d\u80fd\u76f4\u63a5\u66f4\u6539\u6743\u9650\u5217\uff0c\u5fc5\u987b\u4f7f\u7528 GRANT \u8bed\u53e5\u7ed9\u5176\u4ed6\u7528\u6237\u6388\u4e88\u8be5\u6743\u9650\u3002 $ mysqld_safe --safe-user-create","title":"3.2 safe-user-create"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#33-secure-auth","text":"\u4f5c\u7528\u662f\u8ba9 MySQL 4.1 \u4ee5\u524d\u5ba2\u6237\u7aef\u65e0\u6cd5\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u3002\u5373\u4f7f\u4f7f\u7528\u4e86old-passwords \u53c2\u6570\u4e5f\u4e0d\u80fd\u8ba4\u8bc1\u3002 This option was removed in MySQL 8.0.3\u3002","title":"3.3 secure-auth"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#34-skip-grant-tables","text":"mysqld_safe \u7684\u9009\u9879 --skip-grant-tables \u8fd9\u4e2a\u9009\u9879\u5bfc\u81f4\u670d\u52a1\u5668\u6839\u672c\u4e0d\u4f7f\u7528\u6743\u9650\u7cfb\u7edf\uff0c\u4ece\u800c\u7ed9\u6bcf\u4e2a\u4eba\u4ee5\u5b8c\u5168\u8bbf\u95ee\u6240\u6709\u6570\u636e\u5e93\u7684\u6743\u529b\u3002\u901a\u8fc7\u6267\u884c mysqladmin flush-privileges \u6216 mysqladmin reload \u6216 flush privileges \u8bed\u53e5\uff0c\u90fd\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\u5668\u518d\u6b21\u5f00\u59cb\u4f7f\u7528\u6388\u6743\u8868\u3002 $ mysqld_safe --skip-grant-tables","title":"3.4 skip-grant-tables"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#35-skip-networking","text":"--skip-networking \u5728\u7f51\u7edc\u4e0a\u4e0d\u5141\u8bb8 TCP/IP \u8fde\u63a5\uff0c\u6240\u6709\u5230\u6570\u636e\u5e93\u7684\u8fde\u63a5\u5fc5\u987b\u7ecf\u7531\u547d\u540d\u7ba1\u9053\uff08Named Pipes\uff09\u6216\u5171\u4eab\u5185\u5b58\uff08Shared Memory\uff09\u6216 UNIX \u5957\u63a5\u5b57\uff08SOCKET\uff09\u6587\u4ef6\u8fdb\u884c\u3002 \u8fd9\u4e2a\u9009\u9879\u9002\u5408\u5e94\u7528\u548c\u6570\u636e\u5e93\u5171\u7528\u4e00\u53f0\u670d\u52a1\u5668\u7684\u60c5\u51b5\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u5c06\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u8fdc\u7a0b\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5927\u5927\u589e\u5f3a\u4e86\u6570\u636e\u5e93\u7684\u5b89\u5168\u6027\uff0c\u4f46\u7ba1\u7406\u4e0d\u4fbf \u3002","title":"3.5 skip-networking"},{"location":"mysql/33. MySQL \u6743\u9650\u4e0e\u5b89\u5168/#36-skip-show-database","text":"\u4f7f\u7528 --skip-show-database \u9009\u9879\uff0c\u53ea\u5141\u8bb8\u6709 show databases \u6743\u9650\u7684\u7528\u6237\u6267\u884c show databases \u8bed\u53e5\uff0c\u8be5\u8bed\u53e5\u663e\u793a\u6240\u6709\u6570\u636e\u5e93\u540d\u3002","title":"3.6 skip-show-database"},{"location":"mysql/34. MySQL \u76d1\u63a7/","text":"1. \u5982\u4f55\u9009\u62e9\u76d1\u63a7\u65b9\u6848 \u00b6 1.1 \u76d1\u63a7\u65b9\u5f0f \u00b6 \u81ea\u5df1\u5199\u7a0b\u5e8f\u6216\u811a\u672c\u8fdb\u884c\u76d1\u63a7\uff1b \u9002\u7528\u4e8e\u673a\u5668\u5f88\u5c11\u7684\u60c5\u51b5\u3002\u968f\u7740\u8d8a\u53d1\u7ec6\u5316\uff0c\u57fa\u672c\u65e0\u6cd5\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u811a\u672c\u540e\u671f\u7ef4\u62a4\u6210\u672c\u5f88\u5927\u3002 \u91c7\u7528\u5546\u4e1a\u89e3\u51b3\u65b9\u6848 \u4f18\u70b9\u662f\u77ed\u65f6\u95f4\u5185\u642d\u5efa\u4e00\u5957\u76d1\u63a7\u5e73\u53f0\uff0c\u5c55\u73b0\u65b9\u5f0f\u7f8e\u89c2\uff1b\u7f3a\u70b9\u662f\u6210\u672c\u9ad8\uff0c\u53ef\u80fd\u65e0\u6cd5\u6269\u5c55\u7b49 \u5f00\u6e90\u8f6f\u4ef6\u65b9\u6848 \u4f18\u52bf\uff1a\u514d\u8d39\u3001\u5b9a\u5236\u80fd\u529b\u5f3a\u3001\u5b8c\u5168\u53ef\u63a7\u3001\u96c6\u4e2d\u5316\u7ba1\u7406\u3001\u53ef\u89c6\u6027\u597d\uff1b\u7f3a\u70b9\uff1a\u53ef\u80fd\u9700\u8981\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u9605\u8bfb\u6587\u6863\u7b49\u3002 1.2 \u5982\u4f55\u9009\u62e9\u76d1\u63a7\u5de5\u5177 \u00b6 \u51fa\u4e8e\u6210\u672c\u8003\u8651\uff0c\u9009\u62e9\u4f7f\u7528\u5f00\u6e90\u8f6f\u4ef6\u3002\u5728\u8f6f\u4ef6\u9009\u578b\u65f6\u9700\u8981\u9009\u62e9\u7684\u76d1\u63a7\u7cfb\u7edf\u8f6f\u4ef6\u5177\u5907\u4ee5\u4e0b\u51e0\u9879\u529f\u80fd\uff1a \u5fc5\u987b\u5177\u6709\u5bf9\u4e3b\u673a\u7684\u76d1\u63a7\u3002\u5305\u62ecCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u6574\u4f53\u8d1f\u8f7d\u3001\u76f8\u5173\u8fdb\u7a0b\u6570\u7684\u76d1\u63a7\u7b49\u3002 \u5fc5\u987b\u5177\u6709\u5bf9\u6570\u636e\u5e93\u7684\u76d1\u63a7\u3002\u4e3b\u8981\u662f\u6570\u636e\u5e93\u81ea\u8eab\u7684\u6027\u80fd\u6307\u6807\u8fdb\u884c\u76d1\u63a7\uff0c\u6bd4\u5982\u7f13\u51b2\u6c60\u547d\u4e2d\u7387\u3001\u67e5\u8be2\u7684\u547d\u4e2d\u7387\u7b49\u3002 \u8981\u505a\u5230\u76d1\u63a7\u7684\u5b9e\u65f6\u6027\uff0c\u5177\u6709\u89e6\u53d1\u8b66\u62a5\u7684\u529f\u80fd\u3002\u5f53\u5728\u4e3b\u673a\u6216\u6570\u636e\u5e93\u5f02\u5e38\u65f6\uff0c\u8981\u7b2c\u4e00\u65f6\u95f4\u8fdb\u884c\u77ed\u4fe1\u3001\u90ae\u4ef6\u62a5\u8b66\u7b49\u3002 \u5728\u6570\u636e\u7684\u8868\u73b0\u5f62\u5f0f\u4e0a\uff0c\u9700\u8981\u6709\u826f\u597d\u7684\u56fe\u5f62\u5c55\u793a\u529f\u80fd\u3002\u6570\u636e\u5e93\u5f02\u5e38\u65f6\uff0c\u6570\u636e\u5e93\u7ba1\u7406\u5458\u80fd\u6839\u636e\u76d1\u63a7\u7cfb\u7edf\u4e2d\u5f02\u5e38\u65f6\u523b\u7684\u8d8b\u52bf\u56fe\u8fc5\u901f\u5b9a\u4f4d\u5230\u6545\u969c\u7684\u4ea7\u751f\u539f\u56e0\u3002 \u534f\u8bae\u652f\u6301\u65b9\u9762\uff0c\u76d1\u63a7\u7cfb\u7edf\u5ba2\u6237\u7aef\u9700\u8981\u652f\u6301\u73b0\u6709\u534f\u8bae\uff0c\u5982IPMI\u3001SNMP\u7b49\u3002 \u6570\u636e\u5b58\u50a8\u65b9\u9762\uff0c\u8981\u5145\u5206\u4e86\u89e3\u76d1\u63a7\u7cfb\u7edf\u76d1\u63a7\u6570\u636e\u7684\u5b58\u53d6\uff0c\u5305\u62ec\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u50a8\u3001\u6570\u636e\u5e93\u5f62\u5f0f\u5b58\u50a8\u7b49\uff0c\u5728\u90e8\u7f72\u76d1\u63a7\u7cfb\u7edf\u65f6\u63d0\u524d\u5bf9\u6570\u636e\u8fdb\u884c\u89c4\u5212\u3002 \u76d1\u63a7\u7cfb\u7edf\u7684\u90e8\u7f72\u548c\u914d\u7f6e\u590d\u6742\u5ea6\u3001\u754c\u9762\u53cb\u597d\u6027\u4ee5\u53ca\u5bf9\u4e2d\u6587\u7684\u652f\u6301\u3002 \u5e38\u89c1\u7684\u5f00\u6e90\u76d1\u63a7\u7cfb\u7edf\uff1aNagios\u3001Cacti\u3001Zabbix\u3001Ganglia\u7b49\u3002 1.3 \u5f00\u6e90\u8f6f\u4ef6\u6bd4\u8f83 \u00b6 Cacti\uff1a\u5728\u76d1\u63a7\u65b9\u9762\u6709\u826f\u597d\u7684\u7ed8\u56fe\u529f\u80fd\uff0c\u5728\u6d41\u91cf\u548c\u56fe\u5f62\u5851\u9020\u4e0a\u5f3a\u4e8eNagios\uff1b\u4f46\u5728\u6545\u969c\u5206\u6790\u4e0a\u7565\u900a\uff0c\u62a5\u8b66\u673a\u5236\u6709\u5f85\u5b8c\u5584\u3002 Nagios\uff1a\u9002\u5408\u76d1\u63a7\u5927\u91cf\u670d\u52a1\u5668\u4e0a\u7684\u5927\u6279\u670d\u52a1\u662f\u5426\u6b63\u5e38\u3002 Zabbix\uff1a\u5f00\u6e90\uff1b\u5bf9Server\u7684\u8bbe\u5907\u6027\u80fd\u8981\u6c42\u4f4e\uff0c\u652f\u6301\u8bbe\u5907\u591a\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u96c6\u4e2d\u7ba1\u7406\uff0c\u5f00\u653e\u5f0f\u63a5\u53e3\uff0c\u6269\u5c55\u6027\u5f3a\uff0c\u7b2c\u4e09\u65b9\u6570\u636e\u5e93Fromdual\u5b9a\u5236\u4e86\u5bf9\u6570\u636e\u5e93\u7684\u76d1\u63a7\u3002\u7f3a\u70b9\u662f\u6570\u636e\u91cf\u592a\u5927\u65f6\uff0c\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u6e05\u7406\u4e0d\u592a\u65b9\u4fbf \u4e3b\u8981\u91c7\u7528\u4e24\u79cd\u65b9\u6848\u5bf9\u6570\u636e\u5e93\u4e3b\u673a\u8fdb\u884c\u76d1\u63a7\uff1a Zabbix + Fromdual Nagios + Cacti + percona-monitor-plugin 2. zabbix\u90e8\u7f72 \u00b6 \u89d2\u8272 IP/Host-name OS zabbix server 192.168.1.6/sink kali 2019.2 zabbix agent 192.168.1.11/centos7 centos7.6 \u5173\u95ed\u9632\u706b\u5899\u3002 2.1 zabbix server \u00b6 \u4e5f\u8981\u5b89\u88c5zabbix agent\u3002 apt-get install -y zabbix-server-mysql zabbix-frontend-php zabbix server \u6570\u636e\u5e93\u914d\u7f6e\uff1a # mysql \u7248\u672c\uff1a10.3.15-MariaDB-1 Debian 10 mysql > CREATE SCHEMA zabbix CHARACTER SET utf8 ; mysql > CREATE USER zabbix IDENTIFIED BY 'zabbix' ; mysql > GRANT ALL ON zabbix . * TO 'zabbix' @ '%' ; mysql > FLUSH PRIVILEGES ; \u521d\u59cb\u5316\u6570\u636e\u5e93\uff08\u4e0ezabbix server\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff09\uff1a # \u627e\u5230zabbix server\u7684sql\u6587\u4ef6 $ cd /usr/share/zabbix-server-mysql $ ls data.sql.gz images.sql.gz schema.sql.gz $ gzip -d schema.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < schema.sql $ gzip -d images.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < images.sql $ gzip -d data.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < data.sql \u4fee\u6539zabbix server\u914d\u7f6e\u6587\u4ef6 $ vi /etc/zabbix/zabbix_server.conf # \u4fee\u6539\u4ee5\u4e0b\u51e0\u9879 DBName = zabbix DBUser = zabbix DBPassword = zabbix DBSocket = /run/mysqld/mysqld.sock Fpinglocation = /usr/bin/fping \u5f00\u542f\u670d\u52a1 $ systemctl start zabbix-server 2.2 zabbix web \u00b6 apt-get install -y zabbix-frontend-php \u524d\u7aef\u914d\u7f6e\u6587\u4ef6\uff1a $ cp /etc/apache2/conf-available/zabbix-frontend-php.conf /etc/apache2/conf-enabled/ # \u4fee\u6539\u7aef\u53e3\u53f7\uff0c\u542f\u52a8apache2 $ vi /etc/apache2/ports.conf Listen 8081 $ systemctl restart apache2 \u6b64\u65f6\u8bbf\u95ee http://192.168.1.6:8081/zabbix \u9875\u9762\u5373\u53ef\u8fdb\u5165web\u914d\u7f6e\u754c\u9762\uff0c\u63a5\u4e0b\u6765\u6309\u7167\u63d0\u793a\u505a\u5373\u53ef\u3002\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u767b\u5f55\u7684\u9ed8\u8ba4\u7684 \u7528\u6237\u540d/\u5bc6\u7801 \u4e3a Admin/zabbix \u3002 2.3 zabbix agent \u00b6 yum install -y zabbix40-agent.x86_64 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff1a $ vi /etc/zabbix_agentd.conf Server = 192 .168.1.6 ServerActive = 192 .168.1.6 Hostname = sink \u542f\u52a8 $ systemctl start zabbix-agent","title":"34. MySQL \u76d1\u63a7"},{"location":"mysql/34. MySQL \u76d1\u63a7/#1","text":"","title":"1. \u5982\u4f55\u9009\u62e9\u76d1\u63a7\u65b9\u6848"},{"location":"mysql/34. MySQL \u76d1\u63a7/#11","text":"\u81ea\u5df1\u5199\u7a0b\u5e8f\u6216\u811a\u672c\u8fdb\u884c\u76d1\u63a7\uff1b \u9002\u7528\u4e8e\u673a\u5668\u5f88\u5c11\u7684\u60c5\u51b5\u3002\u968f\u7740\u8d8a\u53d1\u7ec6\u5316\uff0c\u57fa\u672c\u65e0\u6cd5\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u811a\u672c\u540e\u671f\u7ef4\u62a4\u6210\u672c\u5f88\u5927\u3002 \u91c7\u7528\u5546\u4e1a\u89e3\u51b3\u65b9\u6848 \u4f18\u70b9\u662f\u77ed\u65f6\u95f4\u5185\u642d\u5efa\u4e00\u5957\u76d1\u63a7\u5e73\u53f0\uff0c\u5c55\u73b0\u65b9\u5f0f\u7f8e\u89c2\uff1b\u7f3a\u70b9\u662f\u6210\u672c\u9ad8\uff0c\u53ef\u80fd\u65e0\u6cd5\u6269\u5c55\u7b49 \u5f00\u6e90\u8f6f\u4ef6\u65b9\u6848 \u4f18\u52bf\uff1a\u514d\u8d39\u3001\u5b9a\u5236\u80fd\u529b\u5f3a\u3001\u5b8c\u5168\u53ef\u63a7\u3001\u96c6\u4e2d\u5316\u7ba1\u7406\u3001\u53ef\u89c6\u6027\u597d\uff1b\u7f3a\u70b9\uff1a\u53ef\u80fd\u9700\u8981\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u9605\u8bfb\u6587\u6863\u7b49\u3002","title":"1.1 \u76d1\u63a7\u65b9\u5f0f"},{"location":"mysql/34. MySQL \u76d1\u63a7/#12","text":"\u51fa\u4e8e\u6210\u672c\u8003\u8651\uff0c\u9009\u62e9\u4f7f\u7528\u5f00\u6e90\u8f6f\u4ef6\u3002\u5728\u8f6f\u4ef6\u9009\u578b\u65f6\u9700\u8981\u9009\u62e9\u7684\u76d1\u63a7\u7cfb\u7edf\u8f6f\u4ef6\u5177\u5907\u4ee5\u4e0b\u51e0\u9879\u529f\u80fd\uff1a \u5fc5\u987b\u5177\u6709\u5bf9\u4e3b\u673a\u7684\u76d1\u63a7\u3002\u5305\u62ecCPU\u3001\u5185\u5b58\u3001\u7f51\u7edc\u3001\u6574\u4f53\u8d1f\u8f7d\u3001\u76f8\u5173\u8fdb\u7a0b\u6570\u7684\u76d1\u63a7\u7b49\u3002 \u5fc5\u987b\u5177\u6709\u5bf9\u6570\u636e\u5e93\u7684\u76d1\u63a7\u3002\u4e3b\u8981\u662f\u6570\u636e\u5e93\u81ea\u8eab\u7684\u6027\u80fd\u6307\u6807\u8fdb\u884c\u76d1\u63a7\uff0c\u6bd4\u5982\u7f13\u51b2\u6c60\u547d\u4e2d\u7387\u3001\u67e5\u8be2\u7684\u547d\u4e2d\u7387\u7b49\u3002 \u8981\u505a\u5230\u76d1\u63a7\u7684\u5b9e\u65f6\u6027\uff0c\u5177\u6709\u89e6\u53d1\u8b66\u62a5\u7684\u529f\u80fd\u3002\u5f53\u5728\u4e3b\u673a\u6216\u6570\u636e\u5e93\u5f02\u5e38\u65f6\uff0c\u8981\u7b2c\u4e00\u65f6\u95f4\u8fdb\u884c\u77ed\u4fe1\u3001\u90ae\u4ef6\u62a5\u8b66\u7b49\u3002 \u5728\u6570\u636e\u7684\u8868\u73b0\u5f62\u5f0f\u4e0a\uff0c\u9700\u8981\u6709\u826f\u597d\u7684\u56fe\u5f62\u5c55\u793a\u529f\u80fd\u3002\u6570\u636e\u5e93\u5f02\u5e38\u65f6\uff0c\u6570\u636e\u5e93\u7ba1\u7406\u5458\u80fd\u6839\u636e\u76d1\u63a7\u7cfb\u7edf\u4e2d\u5f02\u5e38\u65f6\u523b\u7684\u8d8b\u52bf\u56fe\u8fc5\u901f\u5b9a\u4f4d\u5230\u6545\u969c\u7684\u4ea7\u751f\u539f\u56e0\u3002 \u534f\u8bae\u652f\u6301\u65b9\u9762\uff0c\u76d1\u63a7\u7cfb\u7edf\u5ba2\u6237\u7aef\u9700\u8981\u652f\u6301\u73b0\u6709\u534f\u8bae\uff0c\u5982IPMI\u3001SNMP\u7b49\u3002 \u6570\u636e\u5b58\u50a8\u65b9\u9762\uff0c\u8981\u5145\u5206\u4e86\u89e3\u76d1\u63a7\u7cfb\u7edf\u76d1\u63a7\u6570\u636e\u7684\u5b58\u53d6\uff0c\u5305\u62ec\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u50a8\u3001\u6570\u636e\u5e93\u5f62\u5f0f\u5b58\u50a8\u7b49\uff0c\u5728\u90e8\u7f72\u76d1\u63a7\u7cfb\u7edf\u65f6\u63d0\u524d\u5bf9\u6570\u636e\u8fdb\u884c\u89c4\u5212\u3002 \u76d1\u63a7\u7cfb\u7edf\u7684\u90e8\u7f72\u548c\u914d\u7f6e\u590d\u6742\u5ea6\u3001\u754c\u9762\u53cb\u597d\u6027\u4ee5\u53ca\u5bf9\u4e2d\u6587\u7684\u652f\u6301\u3002 \u5e38\u89c1\u7684\u5f00\u6e90\u76d1\u63a7\u7cfb\u7edf\uff1aNagios\u3001Cacti\u3001Zabbix\u3001Ganglia\u7b49\u3002","title":"1.2 \u5982\u4f55\u9009\u62e9\u76d1\u63a7\u5de5\u5177"},{"location":"mysql/34. MySQL \u76d1\u63a7/#13","text":"Cacti\uff1a\u5728\u76d1\u63a7\u65b9\u9762\u6709\u826f\u597d\u7684\u7ed8\u56fe\u529f\u80fd\uff0c\u5728\u6d41\u91cf\u548c\u56fe\u5f62\u5851\u9020\u4e0a\u5f3a\u4e8eNagios\uff1b\u4f46\u5728\u6545\u969c\u5206\u6790\u4e0a\u7565\u900a\uff0c\u62a5\u8b66\u673a\u5236\u6709\u5f85\u5b8c\u5584\u3002 Nagios\uff1a\u9002\u5408\u76d1\u63a7\u5927\u91cf\u670d\u52a1\u5668\u4e0a\u7684\u5927\u6279\u670d\u52a1\u662f\u5426\u6b63\u5e38\u3002 Zabbix\uff1a\u5f00\u6e90\uff1b\u5bf9Server\u7684\u8bbe\u5907\u6027\u80fd\u8981\u6c42\u4f4e\uff0c\u652f\u6301\u8bbe\u5907\u591a\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u96c6\u4e2d\u7ba1\u7406\uff0c\u5f00\u653e\u5f0f\u63a5\u53e3\uff0c\u6269\u5c55\u6027\u5f3a\uff0c\u7b2c\u4e09\u65b9\u6570\u636e\u5e93Fromdual\u5b9a\u5236\u4e86\u5bf9\u6570\u636e\u5e93\u7684\u76d1\u63a7\u3002\u7f3a\u70b9\u662f\u6570\u636e\u91cf\u592a\u5927\u65f6\uff0c\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u6e05\u7406\u4e0d\u592a\u65b9\u4fbf \u4e3b\u8981\u91c7\u7528\u4e24\u79cd\u65b9\u6848\u5bf9\u6570\u636e\u5e93\u4e3b\u673a\u8fdb\u884c\u76d1\u63a7\uff1a Zabbix + Fromdual Nagios + Cacti + percona-monitor-plugin","title":"1.3 \u5f00\u6e90\u8f6f\u4ef6\u6bd4\u8f83"},{"location":"mysql/34. MySQL \u76d1\u63a7/#2-zabbix","text":"\u89d2\u8272 IP/Host-name OS zabbix server 192.168.1.6/sink kali 2019.2 zabbix agent 192.168.1.11/centos7 centos7.6 \u5173\u95ed\u9632\u706b\u5899\u3002","title":"2. zabbix\u90e8\u7f72"},{"location":"mysql/34. MySQL \u76d1\u63a7/#21-zabbix-server","text":"\u4e5f\u8981\u5b89\u88c5zabbix agent\u3002 apt-get install -y zabbix-server-mysql zabbix-frontend-php zabbix server \u6570\u636e\u5e93\u914d\u7f6e\uff1a # mysql \u7248\u672c\uff1a10.3.15-MariaDB-1 Debian 10 mysql > CREATE SCHEMA zabbix CHARACTER SET utf8 ; mysql > CREATE USER zabbix IDENTIFIED BY 'zabbix' ; mysql > GRANT ALL ON zabbix . * TO 'zabbix' @ '%' ; mysql > FLUSH PRIVILEGES ; \u521d\u59cb\u5316\u6570\u636e\u5e93\uff08\u4e0ezabbix server\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff09\uff1a # \u627e\u5230zabbix server\u7684sql\u6587\u4ef6 $ cd /usr/share/zabbix-server-mysql $ ls data.sql.gz images.sql.gz schema.sql.gz $ gzip -d schema.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < schema.sql $ gzip -d images.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < images.sql $ gzip -d data.sql.bz $ mysql -S /run/mysqld/mysqld.sock zabbix < data.sql \u4fee\u6539zabbix server\u914d\u7f6e\u6587\u4ef6 $ vi /etc/zabbix/zabbix_server.conf # \u4fee\u6539\u4ee5\u4e0b\u51e0\u9879 DBName = zabbix DBUser = zabbix DBPassword = zabbix DBSocket = /run/mysqld/mysqld.sock Fpinglocation = /usr/bin/fping \u5f00\u542f\u670d\u52a1 $ systemctl start zabbix-server","title":"2.1 zabbix server"},{"location":"mysql/34. MySQL \u76d1\u63a7/#22-zabbix-web","text":"apt-get install -y zabbix-frontend-php \u524d\u7aef\u914d\u7f6e\u6587\u4ef6\uff1a $ cp /etc/apache2/conf-available/zabbix-frontend-php.conf /etc/apache2/conf-enabled/ # \u4fee\u6539\u7aef\u53e3\u53f7\uff0c\u542f\u52a8apache2 $ vi /etc/apache2/ports.conf Listen 8081 $ systemctl restart apache2 \u6b64\u65f6\u8bbf\u95ee http://192.168.1.6:8081/zabbix \u9875\u9762\u5373\u53ef\u8fdb\u5165web\u914d\u7f6e\u754c\u9762\uff0c\u63a5\u4e0b\u6765\u6309\u7167\u63d0\u793a\u505a\u5373\u53ef\u3002\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u767b\u5f55\u7684\u9ed8\u8ba4\u7684 \u7528\u6237\u540d/\u5bc6\u7801 \u4e3a Admin/zabbix \u3002","title":"2.2 zabbix web"},{"location":"mysql/34. MySQL \u76d1\u63a7/#23-zabbix-agent","text":"yum install -y zabbix40-agent.x86_64 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff1a $ vi /etc/zabbix_agentd.conf Server = 192 .168.1.6 ServerActive = 192 .168.1.6 Hostname = sink \u542f\u52a8 $ systemctl start zabbix-agent","title":"2.3 zabbix agent"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/","text":"1. \u5fd8\u8bb0 MySQL \u7684 root \u5bc6\u7801 \u00b6 1\uff09\u9996\u5148\u767b\u5f55\u5230\u6570\u636e\u5e93\u6240\u5728\u670d\u52a1\u5668\uff0c\u624b\u5de5 kill \u6389 MySQL \u8fdb\u7a0b\uff08MySQL 8.0\u6ca1\u6709\u8be5\u6587\u4ef6\uff09\uff1a kill ` cat /mysql-data-directory/hostname.pid ` 2\uff09\u4f7f\u7528 --skip-grant-tables \u9009\u9879\u8df3\u8fc7\u6743\u9650\u8868\u8ba4\u8bc1\uff0c\u91cd\u542f MySQL \u670d\u52a1\uff1a mysqld_safe --skip-grant-tables --user = zzx & 3\uff09\u65e0\u9700\u6307\u5b9aroot\u7684\u5bc6\u7801\u5373\u53ef\u767b\u5f55\uff0c\u4fee\u6539\u5bc6\u7801\uff1a -- \u6b64\u65f6\u4e0d\u53ef\u6267\u884c\u8be5\u8bed\u53e5\uff0c\u4e5f\u4e0d\u80fd\u6267\u884c \u201cALTER USER 'root'@'localhost' IDENTIFIED BY 'MyPass';\u201d \u8bed\u53e5 mysql > set password = password ( '123' ); -- \u76f4\u63a5\u4fee\u6539\u6743\u9650\u8868 mysql > update user set password = password ( '123' ) where user = 'root' and host = 'localhost' ; 4\uff09\u5237\u65b0\u6743\u9650\u8868\uff0c\u4f7f\u5f97\u6743\u9650\u8ba4\u8bc1\u91cd\u65b0\u751f\u6548\uff1a mysql > FLUSH PRIVILEGES ; 5) \u91cd\u65b0\u7528 root \u767b\u5f55\u65f6\uff0c\u5fc5\u987b\u8f93\u5165\u65b0\u53e3\u4ee4 \u3002 MySQL 8.0 \u5fd8\u8bb0\u5bc6\u7801\u4fee\u6539\u65b9\u6cd5 : 1) \u505c\u6b62MySQL\u670d\u52a1\uff0c\u7528 --skip-grant-tables \u9009\u9879\u8df3\u8fc7\u6743\u9650\u8868\u8ba4\u8bc1\uff0c\u91cd\u542f MySQL \u670d\u52a1\uff1a $ systemctl stop mysqld $ systemctl set-environment MYSQLD_OPTS = \"--skip-grant-tables\" $ systemctl start mysqld 2) \u5c06\u5bc6\u7801\u5b57\u6bb5\u8bbe\u4e3a\u7a7a\uff1a $ mysql - u root mysql > UPDATE mysql . user SET authentication_string = null WHERE User = 'root' ; mysql > FLUSH PRIVILEGES ; 3\uff09\u91cd\u7f6e\u5bc6\u7801\uff1a mysql > ALTER USER 'root' @ 'localhost' IDENTIFIED WITH caching_sha2_password BY 'yourpasswd' ; mysql > exit ; 4\uff09\u91cd\u542fMySQL\u670d\u52a1\uff1a $ systemctl stop mysqld $ systemctl unset-environment MYSQLD_OPTS $ systemctl start mysqld 2. \u5904\u7406 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u635f\u574f \u00b6 \u4e00\u5f20\u635f\u574f\u7684\u8868\u7684\u75c7\u72b6\u901a\u5e38\u662f\u67e5\u8be2\u610f\u5916\u4e2d\u65ad\u5e76\u4e14\u80fd\u770b\u5230\u4e0b\u8ff0\u9519\u8bef\uff1a \u201ctbl_name.frm\u201d\u88ab\u9501\u5b9a\u4e0d\u80fd\u66f4\u6539\uff1b \u4e0d\u80fd\u627e\u5230\u6587\u4ef6\u201ctbl_name.MYI\u201d\uff08Errcode\uff1annn\uff09\uff1b \u6587\u4ef6\u610f\u5916\u7ed3\u675f\uff1b \u8bb0\u5f55\u6587\u4ef6\u88ab\u6bc1\u574f\uff1b \u4ece\u8868\u5904\u7406\u5668\u5f97\u5230\u9519\u8bef nnn\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u65b9\u6cd5\u4e00 \u4f7f\u7528 MySQL \u81ea\u5e26\u7684 myisamchk \u5de5\u5177\u8fdb\u884c\u4fee\u590d\uff0c\u662f\u4e13\u95e8\u7528\u6765\u4fee\u590d MyISAM \u7684\u8868\u7684\u5de5\u5177\u3002 $ myisamchk -r tablename # \u5982\u679c\u4e0d\u80fd\u4fee\u590d\u5219\u6539\u4e3a\u4f7f\u7528\u201c-o\u201d\u9009\u9879 # -o --safe-recover\uff0c\u53ef\u4ee5\u8fdb\u884c\u66f4\u5b89\u5168\u7684\u4fee\u590d $ myisamchk -o tablename \u65b9\u6cd5\u4e8c \u4f7f\u7528MySQL\u7684 CHECK TABLE \u548c REPAIR TABLE \u547d\u4ee4\u4e00\u8d77\u8fdb\u884c\u4fee\u590d\u3002 -- InnoDB, MyISAM, ARCHIVE, and CSV tables. CHECK TABLE tbl_name [, tbl_name ] ... [ option ] ... option : { FOR UPGRADE | QUICK | FAST | MEDIUM | EXTENDED | CHANGED } -- \u8be5\u8bed\u53e5\u98ce\u9669\u5f88\u5927\uff0c\u6700\u597d\u4e0d\u8981\u6267\u884c\u3002\u53c2\u8003MySQL\u6587\u6863\u3002 REPAIR [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... [ QUICK ] [ EXTENDED ] [ USE_FRM ] 3. MyISAM \u8868\u8d85\u8fc7 4GB \u65e0\u6cd5\u8bbf\u95ee \u00b6 \u5728 MySQL 5.0 \u7248\u672c\u4e4b\u524d\uff0cMyISAM \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u7684\u8868\u5927\u5c0f\u53ea\u652f\u6301\u5230 4GB \u3002\u4f7f\u7528\u547d\u4ee4\u67e5\u770b\uff1a $ myisamchk -dv t1 MyISAM file: t1 Record format: Packed Character set: utf8mb4_0900_ai_ci ( 255 ) File-version: 1 Creation time: 2019 -07-23 4 :07:39 Recover time: 2019 -08-02 3 :13:51 Status: checked,analyzed Auto increment key: 1 Last value: 42 Data records: 42 Deleted blocks: 0 Datafile parts: 42 Deleted data: 0 Datafile pointer ( bytes ) : 6 Keyfile pointer ( bytes ) : 6 Datafile length: 840 Keyfile length: 2048 Max datafile length: 281474976710654 Max keyfile length: 288230376151710719 Recordlength: 47 table description: Key Start Len Index Type Rec/key Root Blocksize 1 2 4 unique long 1 1024 1024 \u5176\u4e2d Max datafile length \u548c Max keyfile length \u662f\u6700\u5927\u6570\u636e\u548c\u7d22\u5f15\u6587\u4ef6\u5927\u5c0f\u3002 \u4fee\u6539\uff1a mysql > ALTER TABLE tbl_name MAX_ROWS = 1000000000 AVG_ROW_LENGTH = 15000 ; \u6b64\u547d\u4ee4\u53ef\u4ee5\u4fee\u6539\u8868\u7684\u6700\u5927\u8bb0\u5f55\u6570\u548c\u5e73\u5747\u8bb0\u5f55\u957f\u5ea6\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u6587\u4ef6\u7684\u6700\u5927 size\u3002 4. \u6570\u636e\u76ee\u5f55\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3 \u00b6 4.1 MyISAM \u5b58\u50a8\u5f15\u64ce \u00b6 \u5728\u5efa\u8868\u65f6\u53ef\u4ee5\u7528\u5982\u4e0b\u9009\u9879\u5206\u522b\u6307\u5b9a\u6570\u636e\u76ee\u5f55\u548c\u7d22\u5f15\u76ee\u5f55\u5b58\u50a8\u5230\u4e0d\u540c\u7684\u78c1\u76d8\u7a7a\u95f4\uff08\u5b9e\u9a8c\u6ca1\u6709\u6210\u529f\uff09\uff0c\u800c\u9ed8\u8ba4\u4f1a\u540c\u65f6\u653e\u5728\u6570\u636e\u76ee\u5f55\u4e0b\uff1a DATA DIRECTORY = 'absolute path to directory INDEX DIRECTORY = ' absolute path to directory ' \u8868\u521b\u5efa\u4e4b\u540e\u4e0d\u80fd\u518d\u4f7f\u7528 ALTER TABLE \u4fee\u6539\u8def\u5f84\u3002\u6b64\u65f6\u53ef\u4ee5\u5c06\u8868\u7684\u6570\u636e\u6587\u4ef6\u548c\u7d22\u5f15\u6587\u4ef6 mv \u5230\u78c1\u76d8\u5145\u8db3\u7684\u5206\u533a\u4e0a\uff0c\u7136\u540e\u5728\u539f\u6587\u4ef6\u5904\u521b\u5efa\u7b26\u53f7\u94fe\u63a5\u5373\u53ef\u3002\u5f53\u7136\uff0cmv \u524d\u5fc5\u987b\u8981\u505c\u673a\u6216\u8005\u5c06\u8868\u9501\u5b9a\uff0c\u4ee5\u9632\u6b62\u8868\u7684\u66f4\u6539\u3002 4.2 InnoDB \u5b58\u50a8\u5f15\u64ce \u00b6 \u5728MySQL\u670d\u52a1\u542f\u52a8\u53c2\u6570 innodb_data_file_path \u4e2d\u589e\u52a0\u6587\u4ef6\uff0c\u8def\u5f84\u5199\u4e3a\u65b0\u78c1\u76d8\u7684\u7edd\u5bf9\u8def\u5f84\u3002 \u5728 /home1 \u4e0b\u65b0\u589e\u52a0\u4e00\u4e2a\u53ef\u81ea\u52a8\u6269\u5145\u6570\u636e\u6587\u4ef6 \uff1a innodb_data_file_path = / home / ibdata1 : 2000M ;/ home1 / ibdata2 : 2000M : autoextend \u91cd\u542f\u6570\u636e\u5e93\u751f\u6548\u3002 https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html 5. DNS \u53cd\u5411\u89e3\u6790\u7684\u95ee\u9898 \u00b6 \u5728 MySQL 5.0 \u4ee5\u524d\u7684\u7248\u672c\u4e2d\u6267\u884c show processlist \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u6709\u65f6\u4f1a\u51fa\u73b0\u5f88\u591a\u8fdb\u7a0b\uff0c\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u60c5\u51b5\uff1a unauthenticated user | 192 . 168 . 5 . 71 : 57857 | NULL | Connect | NULL | login | NULL \u8fd9\u4e9b\u8fdb\u7a0b\u4f1a\u7d2f\u8ba1\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c\u5e76\u4e14\u4e0d\u4f1a\u6d88\u5931\uff0c\u5e94\u7528\u65e0\u6cd5\u6b63\u5e38\u54cd\u5e94\uff0c\u5bfc\u81f4\u7cfb\u7edf\u762b\u75ea\u3002 \u5bf9\u4e8e\u8fdc\u7a0b\u8fde\u63a5\u8fc7\u6765\u7684 IP \u5730\u5740\uff0c\u4f1a\u8fdb\u884c\u57df\u540d\u7684\u9006\u5411\u89e3\u6790\uff0c\u5982\u679c\u7cfb\u7edf\u7684 hosts \u6587\u4ef6\u4e2d\u6ca1\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u57df\u540d\uff0cMySQL \u5c31\u4f1a\u5c06\u6b64\u8fde\u63a5\u8ba4\u4e3a\u662f\u65e0\u6548\u7528\u6237\uff0c\u6240\u4ee5\u5728\u8fdb\u7a0b\u4e2d\u51fa\u73b0 unauthenticated user \u5e76\u5bfc\u81f4\u8fdb\u7a0b\u963b\u585e\u3002 \u5728\u542f\u52a8\u7684\u65f6\u5019\u52a0\u4e0a --skip-name-resolve \u9009\u9879\u5373\u53ef\u8df3\u8fc7\u3002 \u5728 MySQL 5.0 \u4ee5\u540e\u7248\u672c\uff0c\u9ed8\u8ba4\u90fd\u4f1a\u8df3\u8fc7\u57df\u540d\u9006\u5411\u89e3\u6790\u3002 6. mysql.sock \u4e22\u5931\u540e\u5982\u4f55\u8fde\u63a5\u6570\u636e\u5e93 \u00b6 \u5982\u679c\u6307\u5b9a localhost \u4f5c\u4e3a\u4e00\u4e2a\u4e3b\u673a\u540d\uff0c\u5219 mysqladmin \u9ed8\u8ba4\u4f7f\u7528 UNIX \u5957\u63a5\u5b57\u6587\u4ef6 mysql.sock \u8fde\u63a5\uff0c\u800c\u4e0d\u662fTCP/IP\u3002 \u4ece MySQL 4.1 \u5f00\u59cb\uff0c\u901a\u8fc7 --protocol= {tcp| socket| pipe| memory} \u9009\u9879\uff0c\u7528\u6237\u53ef\u4ee5\u663e\u5f0f\u5730\u6307\u5b9a\u8fde\u63a5\u534f\u8bae \uff1a # TCP \u8fde\u63a5\uff1a [ zzx@zzx mysql ] $ mysql --protocol = TCP -uroot -p -P3306 -hlocalhost 7. \u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fd0\u884c\u591a\u4e2a MySQL \u6570\u636e\u5e93 \u00b6 \u53c2\u8003https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html \u53ca\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b30.7\u7ae0\u8282\u3002 \u4e0b\u9762\u662f\u7ed3\u5408\u53c2\u8003\u5b98\u7f51\uff08https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html\u3001https://dev.mysql.com/doc/refman/8.0/en/data-directory-initialization.html\uff09\u5b9e\u8df5\u7684\u6b65\u9aa4\uff1a # \u5148\u505c\u6b62\u539f\u5148yum\u5b89\u88c5\u7684MySQL $ systemctl stop mysqld $ useradd -g mysql mysql2 $ cd /home/mysql2 $ tar -zvxf mysql-8.0.17-el7-x86_64.tar.gz mysql $ ln -s /home/mysql2/mysql/mysql-8.0.17-el7-x86_64 mysql $ cd mysql # \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 $ cp /etc/my.cnf . $ cat my.cnf [ mysqld ] basedir = /home/mysql2/mysql datadir = /home/mysql2/mysql/var/lib/mysql socket = /home/mysql2/mysql/var/lib/mysql/mysql.sock log-error = /home/mysql2/mysql/var/log/mysqld.log pid-file = /home/mysql2/mysql/var/run/mysqld/mysqld.pid character-set-server = utf8mb4 secure-file-priv = port = 3307 [ client ] socket = /home/mysql2/mysql/var/lib/mysql/mysql.sock port = 3307 # \u5efa\u7acb\u5bf9\u5e94\u7684\u76ee\u5f55 $ mkdir var/log $ mkdir -p var/run/mysqld $ mkdir mysql-files $ chown -R mysql2:mysql ../mysql-8.0.17-el7-x86_64 ; chown -R mysql2:mysql ../mysql $ chmod 750 mysql-files # \u521d\u59cb\u5316MySQL $ bin/mysqld --defaults-file = my.cnf --initialize --user = mysql2 # \u67e5\u770b\u662f\u5426\u6210\u529f\u53ca\u83b7\u53d6\u5bc6\u7801 $ vi var/log/mysqld.log # \u542f\u52a8\u670d\u52a1 $ bin/mysqld_safe --defaults-file = my.cnf --user = mysql2 & # \u53ef\u4ee5\u67e5\u770bMySQL\u540e\u53f0\u8fdb\u7a0b $ ps -ef | grep mysqld # \u5ba2\u6237\u7aef\u8fde\u63a5 $ bin/mysql --defaults-file = my.cnf -uroot -p # \u767b\u5f55\u4e4b\u540e\u9700\u8981\u4fee\u6539\u5bc6\u7801 mysql> ALTER USER root@localhost IDENTIFIED BY \"xxx\" ; # \u542f\u52a8\u539f\u5148\u7684MySQL\u670d\u52a1 $ systemctl start mysqld 8. \u5ba2\u6237\u7aef\u600e\u4e48\u8bbf\u95ee\u5185\u7f51\u6570\u636e\u5e93 \u00b6 \u4f7f\u7528 secureCRT \u5ba2\u6237\u7aef\u5de5\u5177 \u4f7f\u7528 MySQL Proxy\uff08MySQL \u4ee3\u7406\uff09\u5de5\u5177 \u53c2\u8003\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b30.8\u7ae0\u8282\u3002","title":"35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#1-mysql-root","text":"1\uff09\u9996\u5148\u767b\u5f55\u5230\u6570\u636e\u5e93\u6240\u5728\u670d\u52a1\u5668\uff0c\u624b\u5de5 kill \u6389 MySQL \u8fdb\u7a0b\uff08MySQL 8.0\u6ca1\u6709\u8be5\u6587\u4ef6\uff09\uff1a kill ` cat /mysql-data-directory/hostname.pid ` 2\uff09\u4f7f\u7528 --skip-grant-tables \u9009\u9879\u8df3\u8fc7\u6743\u9650\u8868\u8ba4\u8bc1\uff0c\u91cd\u542f MySQL \u670d\u52a1\uff1a mysqld_safe --skip-grant-tables --user = zzx & 3\uff09\u65e0\u9700\u6307\u5b9aroot\u7684\u5bc6\u7801\u5373\u53ef\u767b\u5f55\uff0c\u4fee\u6539\u5bc6\u7801\uff1a -- \u6b64\u65f6\u4e0d\u53ef\u6267\u884c\u8be5\u8bed\u53e5\uff0c\u4e5f\u4e0d\u80fd\u6267\u884c \u201cALTER USER 'root'@'localhost' IDENTIFIED BY 'MyPass';\u201d \u8bed\u53e5 mysql > set password = password ( '123' ); -- \u76f4\u63a5\u4fee\u6539\u6743\u9650\u8868 mysql > update user set password = password ( '123' ) where user = 'root' and host = 'localhost' ; 4\uff09\u5237\u65b0\u6743\u9650\u8868\uff0c\u4f7f\u5f97\u6743\u9650\u8ba4\u8bc1\u91cd\u65b0\u751f\u6548\uff1a mysql > FLUSH PRIVILEGES ; 5) \u91cd\u65b0\u7528 root \u767b\u5f55\u65f6\uff0c\u5fc5\u987b\u8f93\u5165\u65b0\u53e3\u4ee4 \u3002 MySQL 8.0 \u5fd8\u8bb0\u5bc6\u7801\u4fee\u6539\u65b9\u6cd5 : 1) \u505c\u6b62MySQL\u670d\u52a1\uff0c\u7528 --skip-grant-tables \u9009\u9879\u8df3\u8fc7\u6743\u9650\u8868\u8ba4\u8bc1\uff0c\u91cd\u542f MySQL \u670d\u52a1\uff1a $ systemctl stop mysqld $ systemctl set-environment MYSQLD_OPTS = \"--skip-grant-tables\" $ systemctl start mysqld 2) \u5c06\u5bc6\u7801\u5b57\u6bb5\u8bbe\u4e3a\u7a7a\uff1a $ mysql - u root mysql > UPDATE mysql . user SET authentication_string = null WHERE User = 'root' ; mysql > FLUSH PRIVILEGES ; 3\uff09\u91cd\u7f6e\u5bc6\u7801\uff1a mysql > ALTER USER 'root' @ 'localhost' IDENTIFIED WITH caching_sha2_password BY 'yourpasswd' ; mysql > exit ; 4\uff09\u91cd\u542fMySQL\u670d\u52a1\uff1a $ systemctl stop mysqld $ systemctl unset-environment MYSQLD_OPTS $ systemctl start mysqld","title":"1. \u5fd8\u8bb0 MySQL \u7684 root \u5bc6\u7801"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#2-myisam","text":"\u4e00\u5f20\u635f\u574f\u7684\u8868\u7684\u75c7\u72b6\u901a\u5e38\u662f\u67e5\u8be2\u610f\u5916\u4e2d\u65ad\u5e76\u4e14\u80fd\u770b\u5230\u4e0b\u8ff0\u9519\u8bef\uff1a \u201ctbl_name.frm\u201d\u88ab\u9501\u5b9a\u4e0d\u80fd\u66f4\u6539\uff1b \u4e0d\u80fd\u627e\u5230\u6587\u4ef6\u201ctbl_name.MYI\u201d\uff08Errcode\uff1annn\uff09\uff1b \u6587\u4ef6\u610f\u5916\u7ed3\u675f\uff1b \u8bb0\u5f55\u6587\u4ef6\u88ab\u6bc1\u574f\uff1b \u4ece\u8868\u5904\u7406\u5668\u5f97\u5230\u9519\u8bef nnn\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a \u65b9\u6cd5\u4e00 \u4f7f\u7528 MySQL \u81ea\u5e26\u7684 myisamchk \u5de5\u5177\u8fdb\u884c\u4fee\u590d\uff0c\u662f\u4e13\u95e8\u7528\u6765\u4fee\u590d MyISAM \u7684\u8868\u7684\u5de5\u5177\u3002 $ myisamchk -r tablename # \u5982\u679c\u4e0d\u80fd\u4fee\u590d\u5219\u6539\u4e3a\u4f7f\u7528\u201c-o\u201d\u9009\u9879 # -o --safe-recover\uff0c\u53ef\u4ee5\u8fdb\u884c\u66f4\u5b89\u5168\u7684\u4fee\u590d $ myisamchk -o tablename \u65b9\u6cd5\u4e8c \u4f7f\u7528MySQL\u7684 CHECK TABLE \u548c REPAIR TABLE \u547d\u4ee4\u4e00\u8d77\u8fdb\u884c\u4fee\u590d\u3002 -- InnoDB, MyISAM, ARCHIVE, and CSV tables. CHECK TABLE tbl_name [, tbl_name ] ... [ option ] ... option : { FOR UPGRADE | QUICK | FAST | MEDIUM | EXTENDED | CHANGED } -- \u8be5\u8bed\u53e5\u98ce\u9669\u5f88\u5927\uff0c\u6700\u597d\u4e0d\u8981\u6267\u884c\u3002\u53c2\u8003MySQL\u6587\u6863\u3002 REPAIR [ NO_WRITE_TO_BINLOG | LOCAL ] TABLE tbl_name [, tbl_name ] ... [ QUICK ] [ EXTENDED ] [ USE_FRM ]","title":"2. \u5904\u7406 MyISAM \u5b58\u50a8\u5f15\u64ce\u7684\u8868\u635f\u574f"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#3-myisam-4gb","text":"\u5728 MySQL 5.0 \u7248\u672c\u4e4b\u524d\uff0cMyISAM \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u7684\u8868\u5927\u5c0f\u53ea\u652f\u6301\u5230 4GB \u3002\u4f7f\u7528\u547d\u4ee4\u67e5\u770b\uff1a $ myisamchk -dv t1 MyISAM file: t1 Record format: Packed Character set: utf8mb4_0900_ai_ci ( 255 ) File-version: 1 Creation time: 2019 -07-23 4 :07:39 Recover time: 2019 -08-02 3 :13:51 Status: checked,analyzed Auto increment key: 1 Last value: 42 Data records: 42 Deleted blocks: 0 Datafile parts: 42 Deleted data: 0 Datafile pointer ( bytes ) : 6 Keyfile pointer ( bytes ) : 6 Datafile length: 840 Keyfile length: 2048 Max datafile length: 281474976710654 Max keyfile length: 288230376151710719 Recordlength: 47 table description: Key Start Len Index Type Rec/key Root Blocksize 1 2 4 unique long 1 1024 1024 \u5176\u4e2d Max datafile length \u548c Max keyfile length \u662f\u6700\u5927\u6570\u636e\u548c\u7d22\u5f15\u6587\u4ef6\u5927\u5c0f\u3002 \u4fee\u6539\uff1a mysql > ALTER TABLE tbl_name MAX_ROWS = 1000000000 AVG_ROW_LENGTH = 15000 ; \u6b64\u547d\u4ee4\u53ef\u4ee5\u4fee\u6539\u8868\u7684\u6700\u5927\u8bb0\u5f55\u6570\u548c\u5e73\u5747\u8bb0\u5f55\u957f\u5ea6\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u6587\u4ef6\u7684\u6700\u5927 size\u3002","title":"3. MyISAM \u8868\u8d85\u8fc7 4GB \u65e0\u6cd5\u8bbf\u95ee"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#4","text":"","title":"4. \u6570\u636e\u76ee\u5f55\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#41-myisam","text":"\u5728\u5efa\u8868\u65f6\u53ef\u4ee5\u7528\u5982\u4e0b\u9009\u9879\u5206\u522b\u6307\u5b9a\u6570\u636e\u76ee\u5f55\u548c\u7d22\u5f15\u76ee\u5f55\u5b58\u50a8\u5230\u4e0d\u540c\u7684\u78c1\u76d8\u7a7a\u95f4\uff08\u5b9e\u9a8c\u6ca1\u6709\u6210\u529f\uff09\uff0c\u800c\u9ed8\u8ba4\u4f1a\u540c\u65f6\u653e\u5728\u6570\u636e\u76ee\u5f55\u4e0b\uff1a DATA DIRECTORY = 'absolute path to directory INDEX DIRECTORY = ' absolute path to directory ' \u8868\u521b\u5efa\u4e4b\u540e\u4e0d\u80fd\u518d\u4f7f\u7528 ALTER TABLE \u4fee\u6539\u8def\u5f84\u3002\u6b64\u65f6\u53ef\u4ee5\u5c06\u8868\u7684\u6570\u636e\u6587\u4ef6\u548c\u7d22\u5f15\u6587\u4ef6 mv \u5230\u78c1\u76d8\u5145\u8db3\u7684\u5206\u533a\u4e0a\uff0c\u7136\u540e\u5728\u539f\u6587\u4ef6\u5904\u521b\u5efa\u7b26\u53f7\u94fe\u63a5\u5373\u53ef\u3002\u5f53\u7136\uff0cmv \u524d\u5fc5\u987b\u8981\u505c\u673a\u6216\u8005\u5c06\u8868\u9501\u5b9a\uff0c\u4ee5\u9632\u6b62\u8868\u7684\u66f4\u6539\u3002","title":"4.1 MyISAM \u5b58\u50a8\u5f15\u64ce"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#42-innodb","text":"\u5728MySQL\u670d\u52a1\u542f\u52a8\u53c2\u6570 innodb_data_file_path \u4e2d\u589e\u52a0\u6587\u4ef6\uff0c\u8def\u5f84\u5199\u4e3a\u65b0\u78c1\u76d8\u7684\u7edd\u5bf9\u8def\u5f84\u3002 \u5728 /home1 \u4e0b\u65b0\u589e\u52a0\u4e00\u4e2a\u53ef\u81ea\u52a8\u6269\u5145\u6570\u636e\u6587\u4ef6 \uff1a innodb_data_file_path = / home / ibdata1 : 2000M ;/ home1 / ibdata2 : 2000M : autoextend \u91cd\u542f\u6570\u636e\u5e93\u751f\u6548\u3002 https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html","title":"4.2 InnoDB \u5b58\u50a8\u5f15\u64ce"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#5-dns","text":"\u5728 MySQL 5.0 \u4ee5\u524d\u7684\u7248\u672c\u4e2d\u6267\u884c show processlist \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u6709\u65f6\u4f1a\u51fa\u73b0\u5f88\u591a\u8fdb\u7a0b\uff0c\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u60c5\u51b5\uff1a unauthenticated user | 192 . 168 . 5 . 71 : 57857 | NULL | Connect | NULL | login | NULL \u8fd9\u4e9b\u8fdb\u7a0b\u4f1a\u7d2f\u8ba1\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c\u5e76\u4e14\u4e0d\u4f1a\u6d88\u5931\uff0c\u5e94\u7528\u65e0\u6cd5\u6b63\u5e38\u54cd\u5e94\uff0c\u5bfc\u81f4\u7cfb\u7edf\u762b\u75ea\u3002 \u5bf9\u4e8e\u8fdc\u7a0b\u8fde\u63a5\u8fc7\u6765\u7684 IP \u5730\u5740\uff0c\u4f1a\u8fdb\u884c\u57df\u540d\u7684\u9006\u5411\u89e3\u6790\uff0c\u5982\u679c\u7cfb\u7edf\u7684 hosts \u6587\u4ef6\u4e2d\u6ca1\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u57df\u540d\uff0cMySQL \u5c31\u4f1a\u5c06\u6b64\u8fde\u63a5\u8ba4\u4e3a\u662f\u65e0\u6548\u7528\u6237\uff0c\u6240\u4ee5\u5728\u8fdb\u7a0b\u4e2d\u51fa\u73b0 unauthenticated user \u5e76\u5bfc\u81f4\u8fdb\u7a0b\u963b\u585e\u3002 \u5728\u542f\u52a8\u7684\u65f6\u5019\u52a0\u4e0a --skip-name-resolve \u9009\u9879\u5373\u53ef\u8df3\u8fc7\u3002 \u5728 MySQL 5.0 \u4ee5\u540e\u7248\u672c\uff0c\u9ed8\u8ba4\u90fd\u4f1a\u8df3\u8fc7\u57df\u540d\u9006\u5411\u89e3\u6790\u3002","title":"5. DNS \u53cd\u5411\u89e3\u6790\u7684\u95ee\u9898"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#6-mysqlsock","text":"\u5982\u679c\u6307\u5b9a localhost \u4f5c\u4e3a\u4e00\u4e2a\u4e3b\u673a\u540d\uff0c\u5219 mysqladmin \u9ed8\u8ba4\u4f7f\u7528 UNIX \u5957\u63a5\u5b57\u6587\u4ef6 mysql.sock \u8fde\u63a5\uff0c\u800c\u4e0d\u662fTCP/IP\u3002 \u4ece MySQL 4.1 \u5f00\u59cb\uff0c\u901a\u8fc7 --protocol= {tcp| socket| pipe| memory} \u9009\u9879\uff0c\u7528\u6237\u53ef\u4ee5\u663e\u5f0f\u5730\u6307\u5b9a\u8fde\u63a5\u534f\u8bae \uff1a # TCP \u8fde\u63a5\uff1a [ zzx@zzx mysql ] $ mysql --protocol = TCP -uroot -p -P3306 -hlocalhost","title":"6. mysql.sock \u4e22\u5931\u540e\u5982\u4f55\u8fde\u63a5\u6570\u636e\u5e93"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#7-mysql","text":"\u53c2\u8003https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html \u53ca\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b30.7\u7ae0\u8282\u3002 \u4e0b\u9762\u662f\u7ed3\u5408\u53c2\u8003\u5b98\u7f51\uff08https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html\u3001https://dev.mysql.com/doc/refman/8.0/en/data-directory-initialization.html\uff09\u5b9e\u8df5\u7684\u6b65\u9aa4\uff1a # \u5148\u505c\u6b62\u539f\u5148yum\u5b89\u88c5\u7684MySQL $ systemctl stop mysqld $ useradd -g mysql mysql2 $ cd /home/mysql2 $ tar -zvxf mysql-8.0.17-el7-x86_64.tar.gz mysql $ ln -s /home/mysql2/mysql/mysql-8.0.17-el7-x86_64 mysql $ cd mysql # \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 $ cp /etc/my.cnf . $ cat my.cnf [ mysqld ] basedir = /home/mysql2/mysql datadir = /home/mysql2/mysql/var/lib/mysql socket = /home/mysql2/mysql/var/lib/mysql/mysql.sock log-error = /home/mysql2/mysql/var/log/mysqld.log pid-file = /home/mysql2/mysql/var/run/mysqld/mysqld.pid character-set-server = utf8mb4 secure-file-priv = port = 3307 [ client ] socket = /home/mysql2/mysql/var/lib/mysql/mysql.sock port = 3307 # \u5efa\u7acb\u5bf9\u5e94\u7684\u76ee\u5f55 $ mkdir var/log $ mkdir -p var/run/mysqld $ mkdir mysql-files $ chown -R mysql2:mysql ../mysql-8.0.17-el7-x86_64 ; chown -R mysql2:mysql ../mysql $ chmod 750 mysql-files # \u521d\u59cb\u5316MySQL $ bin/mysqld --defaults-file = my.cnf --initialize --user = mysql2 # \u67e5\u770b\u662f\u5426\u6210\u529f\u53ca\u83b7\u53d6\u5bc6\u7801 $ vi var/log/mysqld.log # \u542f\u52a8\u670d\u52a1 $ bin/mysqld_safe --defaults-file = my.cnf --user = mysql2 & # \u53ef\u4ee5\u67e5\u770bMySQL\u540e\u53f0\u8fdb\u7a0b $ ps -ef | grep mysqld # \u5ba2\u6237\u7aef\u8fde\u63a5 $ bin/mysql --defaults-file = my.cnf -uroot -p # \u767b\u5f55\u4e4b\u540e\u9700\u8981\u4fee\u6539\u5bc6\u7801 mysql> ALTER USER root@localhost IDENTIFIED BY \"xxx\" ; # \u542f\u52a8\u539f\u5148\u7684MySQL\u670d\u52a1 $ systemctl start mysqld","title":"7. \u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fd0\u884c\u591a\u4e2a MySQL \u6570\u636e\u5e93"},{"location":"mysql/35. MySQL \u5e38\u89c1\u95ee\u9898\u548c\u5e94\u7528\u6280\u5de7/#8","text":"\u4f7f\u7528 secureCRT \u5ba2\u6237\u7aef\u5de5\u5177 \u4f7f\u7528 MySQL Proxy\uff08MySQL \u4ee3\u7406\uff09\u5de5\u5177 \u53c2\u8003\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b30.8\u7ae0\u8282\u3002","title":"8. \u5ba2\u6237\u7aef\u600e\u4e48\u8bbf\u95ee\u5185\u7f51\u6570\u636e\u5e93"},{"location":"mysql/36. MySQL \u590d\u5236/","text":"\u590d\u5236\u662f\u6307\u5c06\u4e3b\u6570\u636e\u5e93\u7684 DDL \u548c DML \u64cd\u4f5c\u901a\u8fc7\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u5230\u590d\u5236\u670d\u52a1\u5668\uff08\u4e5f\u53eb\u4ece\u670d\u52a1\u5668\uff09\u4e0a\u91cd\u65b0\u6267\u884c\u3002 MySQL \u652f\u6301\u4e00\u53f0\u4e3b\u670d\u52a1\u5668\u540c\u65f6\u5411\u591a\u53f0\u4ece\u670d\u52a1\u5668\u8fdb\u884c\u590d\u5236\uff0c\u4ece\u670d\u52a1\u5668\u540c\u65f6\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5176\u4ed6\u670d\u52a1\u5668\u7684\u4e3b\u670d\u52a1\u5668\uff0c\u5b9e\u73b0\u94fe\u72b6\u7684\u590d\u5236\u3002 \u4f18\u70b9 \uff1a \u5982\u679c\u4e3b\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\uff0c\u53ef\u4ee5\u5feb\u901f\u5207\u6362\u5230\u4ece\u670d\u52a1\u5668\u63d0\u4f9b\u670d\u52a1\u3002 \u53ef\u4ee5\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u6267\u884c\u67e5\u8be2\u64cd\u4f5c\uff0c\u964d\u4f4e\u4e3b\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u538b\u529b\u3002\u66f4\u65b0\u4e0d\u9891\u7e41\u548c\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u6570\u636e\u624d\u53ef\u3002 \u53ef\u4ee5\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u6267\u884c\u5907\u4efd\uff0c\u4ee5\u907f\u514d\u5907\u4efd\u671f\u95f4\u5f71\u54cd\u4e3b\u670d\u52a1\u5668\u7684\u670d\u52a1 \u3002 1. \u539f\u7406 \u00b6 MySQL\u901a\u8fc7\u4e09\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\uff1a\u4e3b\u5e93\u4e0a\u7684 Binlog Dump \u7ebf\u7a0b\uff0c\u4ece\u5e93\u4e0a\u7684 I/O \u7ebf\u7a0b\u548c SQL \u7ebf\u7a0b\u3002\u5f53\u5728\u4ece\u5e93\u4e0a\u542f\u52a8\u590d\u5236\u65f6\uff08START SLAVE\uff09\uff0c\u9996\u5148\u521b\u5efaI/O\u7ebf\u7a0b\u8fde\u63a5\u4e3b\u5e93\uff0c\u4e3b\u5e93\u518d\u521b\u5efaBinlog Dump\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u5e93\u4e8b\u4ef6\u5e76 \u53d1\u9001 \u7ed9I/O\u7ebf\u7a0b\uff0cI/O\u7ebf\u7a0b\u83b7\u53d6\u5230\u4e8b\u4ef6\u6570\u636e\u4e4b\u540e\u66f4\u65b0\u5230\u4ece\u5e93\u7684\u4e2d\u7ee7\u65e5\u5fd7 Relay Log \u4e2d\u53bb\uff0c\u4e4b\u540e\u4ece\u5e93\u4e0a\u7684SQL\u7ebf\u7a0b\u8bfb\u53d6\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u66f4\u65b0\u7684\u6570\u636e\u5e93\u4e8b\u4ef6\u5e76\u5e94\u7528\u3002 \u67e5\u770b binglog \u7684\u683c\u5f0f\uff1a mysql > SHOW VARIABLES LIKE 'binlog_format' ; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | binlog_format | ROW | +---------------+-------+ RAW\u683c\u5f0f\u7684\u65e5\u5fd7\u4f1a\u7ecf\u8fc7\u7f16\u7801\u5b58\u50a8\uff0c\u67e5\u770b\u65f6\u53ef\u89e3\u7801\u67e5\u770b\uff1a $ mysqlbinlog /var/lib/mysql/binlog.000033 ... BINLOG ' bhpLXQ8BAAAAeAAAAHwAAAAAAAQAOC4wLjE2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAABuGktdEwANAAgAAAAABAAEAAAAYAAEGggAAAAICAgCAAAACgoKKioAEjQA CgGju2nB ... $ mysqlbinlog -vv bin.000033 --base64-output = DECODE-ROWS \u66f4\u6539\u6539\u503c\uff1a -- \u4e09\u79cd\u53ef\u9009\u503c\uff1aSTATMENT, ROW, MIXED mysql > SET GLOBAL BINLOG_FORMAT = 'MIXED' ; 2. \u4e09\u79cd\u5e38\u89c1\u67b6\u6784 \u00b6 2.1 \u4e00\u4e3b\u591a\u4ece\u67b6\u6784 \u00b6 \u9002\u7528\u4e8e\u4e3b\u5e93\u8bfb\u53d6\u538b\u529b\u975e\u5e38\u5927\u4e14\u8bfb\u8bf7\u6c42\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u3002 2.2 \u591a\u7ea7\u590d\u5236\u67b6\u6784 \u00b6 \u5728\u4e00\u4e3b\u591a\u4ece\u7684\u67b6\u6784\u4e0b\uff0c\u4e3b\u5e93\u7684I/O\u538b\u529b\u548c\u7f51\u7edc\u538b\u529b\u4f1a\u968f\u7740\u4ece\u5e93\u7684\u589e\u52a0\u800c\u589e\u957f\uff08\u6bcf\u4e2a\u4ece\u5e93\u90fd\u4f1a\u5728\u4e3b\u5e93\u4e0a\u6709\u4e00\u4e2a\u72ec\u7acb\u7684Binlog Dump\u7ebf\u7a0b\u6765\u63a8\u9001\u65e5\u5fd7\u5230\u4ece\u5e93\uff09\uff0c\u591a\u7ea7\u590d\u5236\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002 Master1\u53ea\u7ed9Master2\uff08\u9700\u8981\u6253\u5f00 --log-slave-updates \u9009\u9879\uff09\u63a8\u9001\u65e5\u5fd7\uff0c\u51cf\u8f7b\u5176\u63a8\u9001\u538b\u529b\uff1b\u4f46\u662f\u63a8\u9001\u5ef6\u65f6\u4f1a\u6bd4\u4e00\u4e3b\u591a\u4ece\u5927\u3002 \u964d\u4f4e\u5ef6\u65f6\u7684\u65b9\u6cd5\uff1a \u200b \u5c06Master2\u7684\u8868\u5f15\u64ce\u9009\u4e3a BLACKHOLE \u6765\u964d\u4f4e\u591a\u7ea7\u590d\u5236\u5ef6\u65f6\u3002\u5199\u5165\u8be5\u5f15\u64ce\u7684\u6570\u636e\u4e0d\u4f1a\u56de\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u8868\u6c38\u8fdc\u90fd\u662f\u4e00\u4e2a\u7a7a\u8868\uff0c\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u53ea\u5728Binlog\u4e2d\u8bb0\u5f55\u4e8b\u4ef6\u3002 2.3 \u53cc\u4e3b\u590d\u5236/Dual Master\u67b6\u6784 \u00b6 \u8be5\u67b6\u6784\u9002\u5408DBA\u505a\u7ef4\u62a4\u7b49\u9700\u8981\u4e3b\u4ece\u5207\u6362\u7684\u573a\u666f\uff0c\u907f\u514d\u4e86\u91cd\u590d\u642d\u5efa\u4ece\u5e93\u7684\u9ebb\u70e6\u3002 \u4e24\u8005\u4e92\u4e3a\u4e3b\u4ece\uff0c\u5199\u8bf7\u6c42\u8bbf\u95eeMaster1\uff0c\u8bfb\u8bf7\u6c42\u53ef\u8bbf\u95ee\u4e24\u8005\u3002 \u907f\u514d\u5f71\u54cd\u670d\u52a1\u7684\u7ef4\u62a4\u64cd\u4f5c\u6b65\u9aa4\uff1a \u505c\u6b62Master1\u7684slave\u7ebf\u7a0b\uff0c\u907f\u514d\u5bf9Master2\u7ef4\u62a4\u65f6\u5f71\u54cdMaster1\uff1b \u505c\u6b62Master2\u7684slave\u7ebf\u7a0b\uff0c\u6682\u505c\u63a5\u6536Master1\u7684\u66f4\u65b0\uff0c\u5f00\u59cb\u7ef4\u62a4\u64cd\u4f5c\uff1b \u5728Master2\u7684\u64cd\u4f5c\u5b8c\u6210\u4e4b\u540e\uff0c\u6253\u5f00Master2\u7684slave\u7ebf\u7a0b\uff0c\u540c\u6b65Master1\u7684\u6570\u636e\u5230Master2\uff0c\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\uff0c\u5c06\u5e94\u7528\u7684 \u8bfb\u5199 \u64cd\u4f5c\u5207\u6362\u5230Master2\u4e0a\u9762\uff1b \u786e\u8ba4Master1\u65e0\u5e94\u7528\u8bbf\u95ee\u4e4b\u540e\uff0c\u6253\u5f00Master1\u7684slave\u7ebf\u7a0b\uff0c\u540c\u6b65\u6570\u636e\uff0c\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u5c31\u53ef\u4ee5\u7ee7\u7eed\u54cd\u5e94\u8bfb\u8bf7\u6c42\u4e86\u3002 \u8be5\u67b6\u6784\u8fd8\u53ef\u4ee5\u4e0e\u4e3b\u4ece\u67b6\u6784\u7ed3\u5408\u4f7f\u7528\uff1a MySQL\u7684Binlog\u8bb0\u5f55\u7684\u662f\u4e8b\u4ef6\u521d\u59cb\u53d1\u751f\u7684server id\uff0c\u5728\u590d\u5236\u65f6\u53ea\u5e94\u7528\u548c\u81ea\u5df1server id\u4e0d\u540c\u7684Binlog\u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u5faa\u73af\u590d\u5236\u7684\u60c5\u51b5 3. \u5f02\u6b65\u590d\u5236\u5b9e\u8df5 \u00b6 \u5b98\u7f51\u5f02\u6b65\u590d\u5236\u8fc7\u7a0b \u4e0b\u9762\u662fMySQL8.0\u7684\u5f02\u6b65\u590d\u5236\u5b9e\u8df5\u8fc7\u7a0b\uff1a master\uff1a\u6dfb\u52a0\u7528\u4e8e\u590d\u5236\u7684\u7528\u6237\uff08 \u8fd9\u4e00\u6b65\u53c2\u8003\u535a\u5ba2 \u4e0d\u4f7f\u7528\u63d2\u4ef6\u521b\u5efa\u7528\u6237\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff09 mysql > CREATE USER copy_user IDENTIFIED WITH 'mysql_native_password' BY 'xxx' ; mysql > GRANT REPLICATION SLAVE ON * . * TO 'copy_user' ; master\uff1a\u8bbe\u7f6e --server-id=1 \u73af\u5883\u53d8\u91cf\uff0c\u91cd\u542f\u670d\u52a1 $ systemctl set-environment MYSQLD_OPTS = \"--server-id=1\" $ systemctl restart mysqld master\uff1a\u8bbe\u7f6e\u8bfb\u9501\u5b9a\u6709\u6548\uff0c\u83b7\u53d6\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f4d\u7f6e mysql > FLUSH TABLES WITH READ LOCK ; mysql > SHOW MASTER STATUS ; +---------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +---------------+----------+--------------+------------------+-------------------+ | binlog . 000044 | 155 | | | | +---------------+----------+--------------+------------------+-------------------+ master\uff1a\u4f7f\u7528 mysqldump \u590d\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u591a\u79cd\u65b9\u5f0f\u590d\u5236\u6570\u636e\u3002\u6ce8\u610f\uff1a\u5982\u679c\u4e3b\u4ece\u6570\u636e\u5e93\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u6700\u597d\u4e0d\u8981\u590d\u5236\u5168\u90e8\u7684\u6570\u636e\u5e93\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u628a\u6743\u9650\u8868\u4e5f\u590d\u5236\u8fc7\u53bb\uff0c\u5bfc\u81f4\u4ece\u6570\u636e\u5e93\u65e0\u6cd5\u542f\u52a8\u3002 $ mysqldump -u root -p --databases blog > blog-dump.log master\uff1a\u89e3\u9664\u9501\u5b9a mysql > UNLOCK TABLES ; slave\uff1a\u8bfb\u53d6\u6570\u636e $ /home/mysql2/mysql/bin/mysql --defaults-file = /home/mysql2/mysql/my.cnf -uroot -p < blog-dump.log slave\uff1aMySQL\u670d\u52a1\u6dfb\u52a0 --server-id \u9009\u9879\uff0c\u8be5\u503c\u5fc5\u987b\u552f\u4e00\uff08\u76f8\u5bf9\u4e8e\u5176\u4ed6\u4ece\u6570\u636e\u5e93\u6765\u8bf4\uff09\u4e14\u548cmaster\u7684\u4e0d\u540c\uff1b\u6dfb\u52a0 --skip-slave-start \u9009\u9879\uff0c\u6682\u505c\u670d\u52a1\u5668\u7684\u590d\u5236\u8fdb\u7a0b\uff1a $ /home/mysql2/mysql/bin/mysqld_safe --defaults-file = /home/mysql2/mysql/my.cnf --server-id = 2 --skip-slave-start --user = mysql2 & slave\uff1a\u6307\u5b9amaster\u7684\u914d\u7f6e\uff1a mysql > CHANGE MASTER TO MASTER_HOST = '192.168.17.10' , MASTER_PORT = 3306 , MASTER_USER = 'copy_user' , MASTER_PASSWORD = 'MyPass3#' , MASTER_LOG_FILE = 'binlog.000044' , MASTER_LOG_POS = 155 ; mysql > START SLAVE ; -- \u5217\u51fa\u8fdb\u7a0b\u72b6\u6001 mysql > SHOW PROCESSLIST ; -- Connecting to master\u662f\u5f02\u5e38\u72b6\u6001 +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 1073 | Waiting on empty queue | NULL | | 16 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 17 | system user | | NULL | Connect | 7 | Connecting to master | NULL | | 18 | system user | | NULL | Query | 7 | Slave has read all relay log ; waiting for more updates | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ \u53ef\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\u67e5\u770bslave\u8fde\u63a5master\u5931\u8d25\u7684\u539f\u56e0\uff1a mysql > SHOW SLAVE STATUS \\ G ; Last_IO_Errno : 2061 -- \u5bc6\u7801\u63d2\u4ef6\u5bfc\u81f4\u7684\u65e0\u6cd5\u9a8c\u8bc1\uff0c\u597d\u50cf\u662f\u4e2abug Last_IO_Error : error connecting to master 'copy_user@192.168.17.10:3306' - retry - time : 60 retries : 2 message : Authentication plugin 'caching_sha2_password' reported error : Authentication requires secure connection . Last_SQL_Errno : 0 Last_SQL_Error \u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\u65f6\uff0c\u53ef\u4ee5\u67e5\u627e\u662f\u5426\u662f\u7f51\u7edc\u3001\u9632\u706b\u5899\u7b49\u95ee\u9898 Last_IO_Error : error connecting to master ' copy_user @192.168.17.10 : 3306 ' - retry - time : 60 retries : 2 message : Can ' t connect to MySQL server on ' 192.168.17.10 ' ( 113 ) slave\uff1a\u6b63\u5e38\u72b6\u6001 mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 1480 | Waiting on empty queue | NULL | | 16 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 17 | system user | | NULL | Connect | 414 | Waiting for master to send event | NULL | | 18 | system user | | NULL | Query | 234 | Slave has read all relay log ; waiting for more updates | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ master\uff1a\u6b63\u5e38\u72b6\u6001 mysql > SHOW PROCESSLIST ; +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ | 4 | event_scheduler | localhost | NULL | Daemon | 4714 | Waiting on empty queue | NULL | | 8 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 14 | copy_user | 192 . 168 . 17 . 11 : 46538 | NULL | Binlog Dump | 309 | Master has sent all binlog to slave ; waiting for more updates | NULL | +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ \u6b64\u65f6\u5df2\u7ecf\u5f02\u6b65\u590d\u5236\u914d\u7f6e\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728master\u4e0a\u9762\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\u6765\u9a8c\u8bc1\u662f\u5426\u4f1a\u540c\u6b65\u5230slave\uff08\u4f1a\u6709\u5ef6\u8fdf\uff09\u3002 4. \u534a\u540c\u6b65\u590d\u5236\u5b9e\u8df5 \u00b6 MySQL5.5\u4e4b\u524d\u662f\u5f02\u6b65\u590d\u5236\uff0c\u662f\u6ca1\u6709\u6b64\u673a\u5236\u7684\u3002 \u5f02\u6b65\u590d\u5236\u5b58\u5728\u7684\u9690\u60a3\uff1a\u4e3b\u5e93\u4e0a\u5199\u4e00\u4e2a\u4e8b\u52a1\u5e76\u63d0\u4ea4\u6210\u529f\uff0c\u4f46\u662f\u4ece\u5e93\u5c1a\u672a\u83b7\u53d6\uff0c\u6b64\u65f6\u4e3b\u5e93\u5b95\u673a\u9020\u6210\u4e86\u8be5\u4e8b\u52a1\u7684Binlog\u4e22\u5931\uff0c\u4ece\u5e93\u5c31\u4f1a\u635f\u5931\u8be5\u4e8b\u52a1\uff0c\u9020\u6210\u4e3b\u4ece\u4e0d\u4e00\u81f4\u3002 \u5f02\u6b65\u590d\u5236\u6d41\u7a0b\uff1a \u534a\u540c\u6b65\u590d\u5236\u6d41\u7a0b\uff1a \u534a\u540c\u6b65\u590d\u5236\uff1a\u4e3b\u5e93\u5728\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u65f6\uff0c\u5148\u7b49\u5f85\u5176\u4e2d\u4e00\u4e2a\u4ece\u5e93\u63a5\u6536\u5230Binlog\u5e76\u6210\u529f\u5199\u5165\u5230\u4e2d\u7ee7\u65e5\u5fd7\u540e\uff0c\u4e3b\u5e93\u624d\u8fd4\u56deCommit\u64cd\u4f5c\u7ed9\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u5728\u6b65\u9aa44\u8fde\u63a5\u4e0d\u4e0a\u4ece\u5e93\uff0c\u4e3b\u5e93\u4f1a\u7b49\u5f85\u4e00\u4f1a\u513f\uff08 rpl_semi_sync_master_timeout \u53d8\u91cf\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff09\uff0c\u82e5\u8d85\u65f6\uff0c\u81ea\u52a8\u8c03\u6574\u4e3a\u5f02\u6b65\u590d\u5236\u6a21\u5f0f\uff1b\u4ece\u5e93\u540e\u6765\u6b63\u5e38\u8fde\u63a5\u65f6\uff0c\u53c8\u4f1a\u81ea\u52a8\u5207\u6362\u4e3a\u534a\u540c\u6b65\u6a21\u5f0f\u3002 \u5b9e\u8df5\u6b65\u9aa4 \uff1a \u5224\u65adMySQL\u662f\u5426\u652f\u6301\u52a8\u6001\u589e\u52a0\u63d2\u4ef6 mysql > SELECT @@ have_dynamic_loading ; +------------------------+ | @@ have_dynamic_loading | +------------------------+ | YES | +------------------------+ \u68c0\u67e5\u5b89\u88c5\u76ee\u5f55\u662f\u5426\u5b58\u5728\u534a\u540c\u6b65\u590d\u5236\u63d2\u4ef6 # \u5305\u7ba1\u7406\u5668\u5b89\u88c5\u8def\u5f84 /usr/lib64/mysql/plugin/semisync_master.so /usr/lib64/mysql/plugin/semisync_slave.so # \u4e8c\u8fdb\u5236\u5305\u5b89\u88c5\u8def\u5f84 /home/mysql2/mysql-8.0.17-el7-x86_64/lib/plugin/semisync_master.so /home/mysql2/mysql-8.0.17-el7-x86_64/lib/plugin/semisync_slave.so \u5b89\u88c5\u63d2\u4ef6 # \u4e3b\u5e93 mysql > INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so' ; mysql > SELECT * FROM mysql . plugin ; +----------------------+--------------------+ | name | dl | +----------------------+--------------------+ | rpl_semi_sync_master | semisync_master . so | +----------------------+--------------------+ #\u4ece\u5e93 mysql > INSTALL PLUGIN rpl_semi_sync_slave SONAME 'semisync_slave.so' ; mysql > SELECT * FROM mysql . plugin ; +---------------------+-------------------+ | name | dl | +---------------------+-------------------+ | rpl_semi_sync_slave | semisync_slave . so | +---------------------+-------------------+ \u6253\u5f00\u534a\u540c\u6b65\u914d\u7f6e # \u4e3b\u5e93 mysql > SET GLOBAL rpl_semi_sync_master_enabled = ON ; mysql > SET GLOBAL rpl_semi_sync_master_timeout = 30000 ; # \u4ece\u5e93 mysql > SET GLOBAL rpl_semi_sync_slave_enabled = ON ; \u4e5f\u53ef\u4ee5\u5728 my.cnf \u4e2d\u914d\u7f6e\uff0c\u8fd9\u6837\u5728\u6bcf\u6b21\u6570\u636e\u5e93\u91cd\u542f\u65f6\u5c31\u4e0d\u5fc5\u624b\u52a8\u5f00\u542f\u4e86\uff1a # master [ mysqld ] rpl_semi_sync_master_enabled = 1 rpl_semi_sync_master_timeout = 1000 # 1 second # slave [ mysqld ] rpl_semi_sync_slave_enabled = 1 \u82e5\u4e4b\u524d\u662f\u5f02\u6b65\u590d\u5236\uff0c\u5219\u9700\u8981\u91cd\u542f\u4ece\u5e93\u7684I/O\u7ebf\u7a0b mysql > STOP SLAVE IO_THREAD ; START SLAVE IO_THREAD ; \u5728\u4e3b\u5e93\u4e0a\u68c0\u67e5\u72b6\u6001 mysql > SHOW VARIABLES LIKE '%SEMI%' ; mysql > SHOW STATUS LIKE '%SEMI%' ; \u9700\u8981\u89c2\u5bdf\u7684\u662f\u8fd9\u4e9b\u503c\u7684\u53d8\u5316\uff0c\u800c\u4e0d\u662f\u521d\u59cb\u503c\u3002 \u7740\u91cd\u5173\u6ce8\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a Rpl_semi_sync_master_status \uff1a\u534a\u540c\u6b65\u6a21\u5f0f\u7684\u72b6\u6001 Rpl_semi_sync_master_yes_tx \uff1a\u8868\u793a\u6709\u51e0\u4e2a\u4e8b\u52a1\u662f\u901a\u8fc7\u6b64\u673a\u5236\u540c\u6b65\u7684 Rpl_semi_sync_master_no_tx \uff1a\u8868\u793a\u6709\u51e0\u4e2a\u4e8b\u52a1\u4e0d\u662f\u5728\u8be5\u6a21\u5f0f\u4e0b\u540c\u6b65\u7684 5. \u4e3b\u8981\u590d\u5236\u542f\u52a8\u9009\u9879 \u00b6 \u548c\u590d\u5236\u6709\u5173\u7684\u5e38\u7528\u542f\u52a8\u9009\u9879\u3002 5.1 --log-slave-updates \u00b6 master\u7684\u9009\u9879\u3002\u7528\u6765\u914d\u7f6e\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u66f4\u65b0\u64cd\u4f5c\u662f\u5426\u5199\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0cMySQL>= 8.0.3\u7684\u9ed8\u8ba4\u503c\u662f ON \uff0cMySQL<= 8.0.2\u7684\u9ed8\u8ba4\u503c\u662f OFF \u3002 \u4f46\u662f\uff0c\u5982\u679c\u8fd9\u4e2a\u4ece\u670d\u52a1\u5668\u540c\u65f6\u4e5f\u8981\u4f5c\u4e3a\u5176\u4ed6\u670d\u52a1\u5668\u7684\u4e3b\u670d\u52a1\u5668\uff0c\u642d\u5efa\u4e00\u4e2a\u94fe\u5f0f\u7684\u590d\u5236\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6253\u5f00\u8fd9\u4e2a\u9009\u9879\u3002 A -> B -> C \u53ef\u4ee5\u4f7f\u7528 --skip-log-bin \u5173\u95edmaster\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u6b64\u65f6\u9ed8\u8ba4\u4e5f\u4f1a\u5173\u95edslave\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u5982\u679c\u60f3\u8981\u7981\u7528slave\u66f4\u65b0binlog\u65e5\u5fd7\u800c\u542f\u7528master\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4f7f\u7528 --skip-log-slave-updates \u9009\u9879\u3002 5.2 --master-connect-retry \u00b6 \u8bbe\u7f6e\u5728\u548c\u4e3b\u670d\u52a1\u5668\u7684\u8fde\u63a5\u4e22\u5931\u7684\u65f6\u5019\uff0c\u91cd\u8bd5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f 60 \u79d2\uff0c\u5373\u6bcf 60 \u79d2\u91cd\u8bd5\u4e00\u6b21\u3002 \u5728MySQL 5.5\u4e2d\u5e9f\u5f03\u4e86\uff0c\u4f7f\u7528 \u201cCHANGE MASTER TO Syntax\u201d \uff1a CHANGE MASTER TO MASTER_CONNECT_RETRY = 10 ; --master-retry-count \u9650\u5236\u91cd\u8bd5\u6b21\u6570\u3002 5.3 --read-only \u00b6 \u4f7f\u6240\u6709\u975e\u4e34\u65f6\u8868\u90fd\u4e3a\u53ea\u8bfb\uff0c\u4f46\u590d\u5236\uff08slave\uff09\u7ebf\u7a0b\u548c\u5177\u6709 SUPER \u7279\u6743\u7684\u7528\u6237\u9664\u5916\u3002 $ ./bin/mysqld_safe --read-only & \u4f7f\u7528 read-only \u542f\u52a8\u7684\u4ece\u6570\u636e\u5e93\u4f1a\u62d2\u7edd\u666e\u901a\u7528\u6237\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4ee5\u786e\u4fdd\u4ece\u6570\u636e\u5e93\u7684\u5b89\u5168\u6027\u3002 5.4 \u6307\u5b9a\u590d\u5236\u7684\u6570\u636e\u5e93\u6216\u8005\u8868 \u00b6 --replicate-do-db=db_name \u3001 --replicate-ignore-db=*db_name* \u3001 --replicate-do-table=db_name.tbl_name \u3001 --replicate-ignore-table=db_name.tbl_name \u3001 --replicate-wild-do-table=db_name.tbl_name \u3001 --replicate-wild-ignore-table=db_name.tbl_name \u3002 \u4ee5\u4e0a\u8fd9\u4e9b\u8bed\u53e5\u53ef\u4ee5\u6307\u5b9a\u4ece\u4e3b\u6570\u636e\u5e93\u590d\u5236\u5230\u4ece\u6570\u636e\u5e93\u7684\u6570\u636e\u5e93\u6216\u8005\u8868\u3002 \u4ece\u5e93\u542f\u52a8\u65f6\u4f7f\u7528\uff1a $ ./bin/mysqld_safe --replicate-do-table = blog.test & 5.4.1 --replicate-wild-do-table \u00b6 \u4e0e\u6307\u5b9a\u7684\u6570\u636e\u5e93\u548c\u8868\u540d\u6a21\u5f0f\u5339\u914d\u7684\u8bed\u53e5\u6765\u521b\u5efa\u590d\u5236\u8fc7\u6ee4\u5668\uff0c\u6a21\u5f0f\u53ef\u4ee5\u5305\u542b \uff05 \u548c _ \u901a\u914d\u7b26\u3002 $ . / bin / mysqld_safe -- replicate - wild - do - table = foo % . bar % & \u6b64\u9009\u9879\u9002\u7528\u4e8e tables, views, and triggers \u3002 \u8868\u540d\u6216\u6570\u636e\u5e93\u540d\u4e2d\u6709\u7279\u6b8a\u5b57\u7b26\u65f6\u9700\u8981\u8f6c\u79fb\u7b26\u3002\u4f8b\u5982\uff0c\u8981\u590d\u5236\u540d\u4e3a my_own%db \u7684\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\uff0c\u800c\u4e0d\u590d\u5236my5ownAABCdb\u6570\u636e\u5e93\u4e2d\u7684\u590d\u5236\u8868\uff0c\u5219\u5e94\u8be5\u8f6c\u4e49 _ \u548c \uff05 \u5b57\u7b26\uff0c\u5982\u4e0b\u6240\u793a\uff1a --replicate-wild-do-table=my\\_own\\%db \uff1b\u5982\u679c\u5728shell\u4e2d\u6307\u5b9a\u5219\u9700\u8981\u53cc\u8f6c\u4e49\u5b57\u7b26\uff1a --replicate-wild-do-table=my\\\\_own\\\\%db \u3002 5.5 --slave-skip-errors \u00b6 slave\u53ef\u80fd\u4f1a\u9047\u5230\u6267\u884c BINLOG \u4e2d\u7684 SQL \u51fa\u9519\u7684\u60c5\u51b5\uff08\u6bd4\u5982\u4e3b\u952e\u51b2\u7a81\uff09\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ece\u670d\u52a1\u5668\u5c06\u4f1a\u505c\u6b62\u590d\u5236\u8fdb\u7a0b\uff0c\u4e0d\u518d\u8fdb\u884c\u540c\u6b65\uff0c\u7b49\u5f85\u7528\u6237\u4ecb\u5165\u5904\u7406\u3002 \u6b64\u53c2\u6570\u7684\u4f5c\u7528\u5c31\u662f\u7528\u6765\u5b9a\u4e49\u590d\u5236\u8fc7\u7a0b\u4e2d\u4ece\u670d\u52a1\u5668\u53ef\u4ee5\u81ea\u52a8\u8df3\u8fc7\u7684\u9519\u8bef\u53f7\uff0c\u8fd9\u6837\u5f53\u590d\u5236\u8fc7\u7a0b\u4e2d\u9047\u5230\u5b9a\u4e49\u4e2d\u7684\u9519\u8bef\u53f7\u65f6\uff0c\u4fbf\u53ef\u4ee5\u81ea\u52a8\u8df3\u8fc7\uff0c\u76f4\u63a5\u6267\u884c\u540e\u9762\u7684 SQL \u8bed\u53e5\uff0c\u4ee5\u6b64\u6765\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u4eba\u5de5\u5e72\u9884\u3002 -- slave - skip - errors = [ err_code1 , err_code2 ,... | all | ddl_exist_errors ] \u901f\u8bb0\u503c ddl_exist_errors \u7b49\u540c\u4e8e\u9519\u8bef\u4ee3\u7801\u5217\u8868 1007,1008,1050,1051,1054,1060,1061,1068,1094,1146 \u3002 \u6700\u597d\u53ea\u5728\u4ece\u6570\u636e\u5e93\u4ec5\u4ec5\u662f\u4e3a\u4e86\u5206\u62c5\u4e3b\u6570\u636e\u5e93\u7684\u67e5\u8be2\u538b\u529b\uff0c\u4e14\u5bf9\u6570\u636e\u7684\u5b8c\u6574\u6027\u8981\u6c42\u4e0d\u662f\u5f88\u4e25\u683c\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002\u5982\u679c\u4ece\u6570\u636e\u5e93\u4e3b\u8981\u662f\u4f5c\u4e3a\u4e3b\u6570\u636e\u5e93\u7684\u5907\u4efd\uff0c\u90a3\u4e48\u5c31\u4e0d\u5e94\u8be5\u4f7f\u7528\u8fd9\u4e2a\u542f\u52a8\u53c2\u6570\uff0c\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u5f88\u53ef\u80fd\u9020\u6210\u4e3b\u4ece\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u540c\u6b65\u3002 6. \u65e5\u5e38\u7ba1\u7406\u7ef4\u62a4 \u00b6 6.1 \u67e5\u770b\u4ece\u5e93\u72b6\u6001 \u00b6 \u4e3a\u4e86\u9632\u6b62\u590d\u5236\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u6545\u969c\u4ece\u800c\u5bfc\u81f4\u590d\u5236\u8fdb\u7a0b\u505c\u6b62\uff0c\u6211\u4eec\u9700\u8981\u7ecf\u5e38\u68c0\u67e5slave\u7684\u590d\u5236\u72b6\u6001\u3002 mysql > SHOW SLAVE STATUS \\ G ; \u4e3b\u8981\u5173\u6ce8\u4e24\u4e2a\u9009\u9879\uff1a Slave_IO_Running\uff1a\u6b64\u8fdb\u7a0b\u8d1f\u8d23Slave\u4eceMaster\u4e0a\u8bfb\u53d6 BINLOG \u65e5\u5fd7\uff0c\u5e76\u5199\u5165\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u3002 Slave_SQL_Running\uff1a\u6b64\u8fdb\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u5e76\u4e14\u6267\u884c\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u7684 BINLOG \u65e5\u5fd7\u3002 6.2 \u4e3b\u4ece\u5e93\u540c\u6b65\u7ef4\u62a4 \u00b6 \u5728\u67d0\u4e9b\u7e41\u5fd9\u7684 OLTP(\u5728\u7ebf\u4e8b\u52a1\u5904\u7406)\u7cfb\u7edf\u4e0a\uff0c\u7531\u4e8e\u4e3b\u670d\u52a1\u5668\u66f4\u65b0\u9891\u7e41\uff0c\u800c\u4ece\u670d\u52a1\u5668\u7531\u4e8e\u5404\u79cd\u539f\u56e0\uff08\u6bd4\u5982\u786c\u4ef6\u6027\u80fd\u8f83\u5dee\uff09\u5bfc\u81f4\u66f4\u65b0\u901f\u5ea6\u8f83\u6162\uff0c\u4ece\u800c\u4f7f\u5f97\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u5dee\u8ddd\u8d8a\u6765\u8d8a\u5927\uff0c\u6700\u7ec8\u5bf9\u67d0\u4e9b\u5e94\u7528\u4ea7\u751f\u5f71\u54cd\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5b9a\u671f\u5730\u8fdb\u884c\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u540c\u6b65\uff0c\u4f7f\u5f97\u4e3b\u4ece\u6570\u636e\u5dee\u8ddd\u80fd\u591f\u51cf\u5230\u6700\u5c0f\u3002\u5e38\u7528\u7684\u65b9\u6cd5\u662f\uff1a \u5728\u8d1f\u8f7d\u8f83\u4f4e\u7684\u65f6\u5019\u6682\u65f6\u963b\u585e\u4e3b\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u5f3a\u5236\u4e3b\u4ece\u6570\u636e\u5e93\u66f4\u65b0\u540c\u6b65 \u3002 \u6b65\u9aa4\u5982\u4e0b\uff1a master\uff1a\u9501\u5b9a\u8868 mysql > FLUSH TABLES WITH READ LOCK ; # \u8bb0\u5f55\u65e5\u5fd7\u4f4d\u7f6e mysql > SHOW MASTER STATUS ; +---------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +---------------+----------+--------------+------------------+-------------------+ | binlog . 000048 | 155 | | | | +---------------+----------+--------------+------------------+-------------------+ slave\uff1a\u540c\u6b65\u6570\u636e mysql > SELECT MASTER_POS_WAIT ( 'binlog.000048' , 155 ); +---------------------------------------+ | MASTER_POS_WAIT ( 'binlog.000048' , 155 ) | +---------------------------------------+ | 0 | +---------------------------------------+ \u8fd9\u4e2a SELECT \u8bed\u53e5\u4f1a\u963b\u585e\u76f4\u5230\u4ece\u670d\u52a1\u5668\u8fbe\u5230\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u504f\u79fb\u91cf\u540e\uff0c\u8fd4\u56de 0\uff1b\u5982\u679c\u8fd4\u56de-1\uff0c\u5219\u8868\u793a\u8d85\u65f6\u9000\u51fa\u3002 master\uff1a\u89e3\u9664\u9501\u5b9a mysql > UNLOCK TABLES ; 6.3 \u4ece\u670d\u52a1\u5668\u590d\u5236\u51fa\u9519\u7684\u5904\u7406 \u00b6 \u5982\u679c\u662f\u8868\u7ed3\u6784\u4e0d\u540c\u5bfc\u81f4\u7684\uff0c\u5219\u4fee\u6539\u4ece\u670d\u52a1\u5668\u7684\u8868\u4e0e\u4e3b\u670d\u52a1\u5668\u7684\u76f8\u540c\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884c START SLAVE \u8bed\u53e5\u3002 \u5982\u679c\u4e0d\u662f\u8868\u7ed3\u6784\u4e0d\u540c\u5bfc\u81f4\u7684\u66f4\u65b0\u5931\u8d25\uff0c\u5219\u9700\u8981\u786e\u8ba4\u624b\u52a8\u66f4\u65b0\u662f\u5426\u5b89\u5168\uff0c\u7136\u540e\u5ffd\u89c6\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u66f4\u65b0\u5931\u8d25\u7684\u8bed \u53e5\u3002\u8df3\u8fc7\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u8bed\u53e5\u7684\u547d\u4ee4\u4e3a \uff1a mysql > SET GLOBAL sql_slave_skip_counter = N ; N \u7684\u53d6\u503c\uff1a\u5982\u679c\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u66f4\u65b0\u8bed\u53e5\u4e0d\u4f7f\u7528 AUTO_INCREMENT \u6216 LAST_INSERT_ID() \uff0cN \u503c\u5e94\u4e3a 1\uff08\u8df3\u8fc7\u4e00\u6761sql\u8bed\u53e5\u7684\u6267\u884c\uff09\uff0c\u5426\u5219\uff0c\u503c\u5e94\u4e3a 2\u3002 \u56e0\u4e3a\u8fd9\u4e24\u4e2a\u8bed\u53e5\u9700\u8981\u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u53d6\u4e24\u4e2a\u4e8b\u4ef6\u3002 \u5b9e\u8df5\u6b65\u9aa4\uff1a \u5173\u95edslave\u7684\u590d\u5236\u7ebf\u7a0b\uff0c\u8bbe\u7f6e\u8df3\u8fc7\u8bed\u53e5\u6570\u91cf mysql > STOP SLAVE ; mysql > SET GLOBAL sql_slave_skip_counter = 2 ; \u5728master\u66f4\u65b0\u6570\u636e # \u66f4\u65b0\u4e00\u6761\u5e26\u6709\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e mysql > DESC t1 ; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int ( 11 ) | NO | PRI | NULL | auto_increment | | name | varchar ( 10 ) | YES | | NULL | | +-------+-------------+------+-----+---------+----------------+ mysql > INSERT INTO t1 ( name ) VALUES ( \"abcd\" ); # \u66f4\u65b0\u4e00\u6761\u4e0d\u5e26\u6709\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e mysql > DESC test ; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int ( 11 ) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ mysql > INSERT INTO test VALUES ( 78 ); \u6253\u5f00slave\u7684\u590d\u5236\u7ebf\u7a0b\uff0c\u67e5\u770b\u66f4\u65b0\u7ed3\u679c mysql > START SLAVE ; # \u524d\u4e24\u5929\u6570\u636e\u672a\u66f4\u65b0\uff0c\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e\u672a\u590d\u5236\u5230slave mysql > SELECT * FROM t1 WHERE name = \"abcd\" ; Empty set ( 0 . 00 sec ) # \u66f4\u65b0\u4e86\u7b2c\u4e09\u6761\u6570\u636e mysql > SELECT * FROM test WHERE id = 78 ; +------+ | id | +------+ | 78 | +------+ 6.4 log event entry exceeded max_allowed_packet \u00b6 \u5982\u679c\u5e94\u7528\u4e2d\u4f7f\u7528\u5927\u7684 BLOG \u5217\u6216\u8005\u957f\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u6062\u590d\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0 log event entry exceeded max_allowed_packet \u9519\u8bef\uff0c\u5e76\u4e14\u4f1a\u5bfc\u81f4slave\u7684IO\u7ebf\u7a0b\u505c\u6b62\uff0c\u8fd9\u662f\u56e0\u4e3a\u542b\u6709\u5927\u6587\u672c\u7684\u8bb0\u5f55\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u4f20\u8f93\u5bfc\u81f4\u3002 \u89e3\u51b3\u7684\u529e\u6cd5\u5c31\u662f\u5728\u4e3b\u4ece\u670d\u52a1\u5668\u4e0a\u589e\u52a0 max_allowed_packet \uff08\u9650\u5236\u8868\u7684\u6bcf\u4e00\u5217\u7684\u5927\u5c0f\uff0c\u6b64\u53c2\u6570\u4e5f\u4f1a\u9650\u5236\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u4f20\u8f93\uff09\u53c2\u6570\u7684\u5927\u5c0f\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u4e3a \uff1aMySQL>= 8.0.3\uff0c64 MB \uff1bMySQL<= 8.0.2\uff0c1MB\u3002 mysql > SHOW VARIABLES LIKE '%max_allowed%' ; +---------------------------+------------+ | Variable_name | Value | +---------------------------+------------+ | max_allowed_packet | 67108864 | | mysqlx_max_allowed_packet | 67108864 | | slave_max_allowed_packet | 1073741824 | +---------------------------+------------+ -- \u4e0d\u4f1a\u5f71\u54cd\u5230\u5df2\u7ecf\u6253\u5f00\u7684session\uff0c\u53ea\u6709\u65b0\u5f00\u7684session\u624d\u4f1a\u751f\u6548 -- \u5bf9global\u4f5c\u7528\u57df\u7684\u53d8\u91cf\u5efa\u8bae\u662f\uff1a\u5728my.cnf\u4e2d\u6307\u5b9a\uff0c\u91cd\u542f\u670d\u52a1\u540e\u751f\u6548 mysql > SET GLOBAL max_allowed_packet = 1073741824 ; \u4e3b\u4ece\u670d\u52a1\u5668\u540c\u65f6\u5728 my.cnf \u4e2d\u8bbe\u7f6e\uff1a -- \u6700\u5927\u503c [ mysqld ] max_allowed_packet = 1 GB \u590d\u5236\u4ece\u7ad9\u5b9e\u9645\u4e0a\u63a5\u53d7\u7684\u6570\u636e\u5305\u8fbe\u5230\u5176 slave_max_allowed_packet \u8bbe\u7f6e\u6240\u8bbe\u7f6e\u7684\u9650\u5236\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a1GB\u7684\u6700\u5927\u503c\uff0c\u4ee5\u9632\u6b62\u7531\u4e8e\u5927\u6570\u636e\u5305\u800c\u5bfc\u81f4\u590d\u5236\u5931\u8d25\u3002 6.5 \u591a\u4e3b\u590d\u5236\u65f6\u7684\u81ea\u589e\u957f\u53d8\u91cf\u51b2\u7a81\u95ee\u9898 \u00b6 \u591a\u4e3b\u590d\u5236\uff1a\u591a\u53f0\u4e3b\u670d\u52a1\u5668\u5bf9\u4e00\u53f0\u4ece\u670d\u52a1\u5668\u3002 \u6b64\u65f6\u9700\u8981\u5b9a\u5236 auto_increment_increment \u548c auto_increment_offset \uff0c\u4fdd\u8bc1\u591a\u4e3b\u4e4b\u95f4\u590d\u5236\u5230\u4ece\u6570\u636e\u5e93\u4e0d\u4f1a\u6709\u91cd\u590d\u51b2\u7a81\u3002 \u6bd4\u5982\uff0c\u4e24\u4e2a master \u7684\u60c5\u51b5\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u8bbe\u7f6e\uff1a Master1 \u4e0a\uff1aauto_increment_increment = 2\uff0cauto_increment_offset = 1\uff1b\uff081,3,5,7\u2026\u5e8f \u5217\uff09\u3002 Master2 \u4e0a\uff1aauto_increment_increment = 2\uff0cauto_increment_offset = 2\uff1b\uff082,4,6\u2026\u5e8f \u5217\uff09\u3002 mysql > SHOW VARIABLES LIKE 'auto_inc%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | | auto_increment_offset | 1 | +--------------------------+-------+ -- \u5df2\u6253\u5f00\u7684session\u8bbe\u7f6e\u65e0\u6548 mysql > SET GLOBAL auto_increment_increment = 1 ; -- SET SESSION auto_increment_increment \u7684\u7b80\u6613\u5199\u6cd5\uff0c\u7acb\u5373\u751f\u6548 mysql > SET @@ auto_increment_increment = 3 ; mysql > SHOW SESSION VARIABLES LIKE 'auto_inc%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 3 | | auto_increment_offset | 1 | +--------------------------+-------+ 6.6 \u67e5\u770b\u4ece\u670d\u52a1\u5668\u7684\u590d\u5236\u8fdb\u5ea6 \u00b6 Binlog dump thread \uff1amaster\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4ee5\u4fbf\u5728slave\u8fde\u63a5\u65f6\u5c06\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5185\u5bb9\u53d1\u9001\u5230slave\u3002 Slave I/O thread \uff1a\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u53d1\u51fa START SLAVE \u8bed\u53e5\u65f6\uff0c\u4ece\u670d\u52a1\u5668\u4f1a\u521b\u5efa\u4e00\u4e2aI/O\u7ebf\u7a0b\uff0c\u8be5\u7ebf\u7a0b\u8fde\u63a5\u5230\u4e3b\u670d\u52a1\u5668\u5e76\u8981\u6c42\u5b83\u53d1\u9001\u5728\u5176\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u3002 Slave SQL thread \uff1aslave\u521b\u5efa\u4e00\u4e2aSQL\u7ebf\u7a0b\u6765\u8bfb\u53d6\u7531\u4ece\u670d\u52a1\u5668I/O\u7ebf\u7a0b\u5199\u5165\u7684\u4e2d\u7ee7\u65e5\u5fd7\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u5305\u542b\u7684\u4e8b\u4ef6\u3002 \u5bf9\u4e8e\u4ece\u670d\u52a1\u5668\u7684SQL\u7ebf\u7a0b\uff0c SHOW [FULL] PROCESSLIST \u7684 Time \u662f\u6700\u540e\u4e00\u4e2a\u590d\u5236\u4e8b\u4ef6\u7684\u65f6\u95f4\u6233\u4e0e\u4ece\u5c5e\u673a\u5668\u7684\u5b9e\u65f6\u4e4b\u95f4\u7684\u79d2\u6570\u3002\u7531\u4e8e MySQL \u590d\u5236\u7684\u673a\u5236\u662f\u6267\u884c\u4e3b\u670d\u52a1\u5668\u4f20\u8f93\u8fc7\u6765\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u6bcf\u4e2a\u8bed\u53e5\u901a\u8fc7\u8bbe\u7f6e\u65f6\u95f4\u6233\u6765\u4fdd\u8bc1\u6267\u884c\u65f6\u95f4\u548c\u987a\u5e8f\u7684\u6b63\u786e\u6027\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8bed\u53e5\u6267\u884c\u4e4b\u524d\u90fd\u4f1a\u9996\u5148\u8bbe\u7f6e\u65f6\u95f4\u6233\uff0c\u800c\u901a\u8fc7\u67e5\u8be2\u8fd9\u4e2a\u8fdb\u7a0b\u7684Time \u5c31\u53ef\u4ee5\u77e5\u9053\u6700\u540e\u8bbe\u7f6e\u7684\u65f6\u95f4\u6233\u548c\u5f53\u524d\u65f6\u95f4\u7684\u5dee\u8ddd\u3002 6.7 \u63d0\u9ad8\u590d\u5236\u6027\u80fd \u00b6 SHOW SLAVE STATUS \\G \u4e2d\u7684 Seconds_Behind_Master \u5b57\u6bb5\u8868\u793a\u9884\u4f30\u7684slave\u843d\u540emaster\u7684\u65f6\u95f4\u3002 6.7.1 \u65b9\u6848\u4e00 \u00b6 \u901a\u8fc7\u62c6\u5206\u51cf\u5c11\u4e00\u4e2aslave\u4e0a\u9700\u8981\u540c\u6b65\u7684\u8868\u6765\u89e3\u51b3\u3002\u901a\u8fc7\u4e0a\u6587\u7684 \u6307\u5b9a\u590d\u5236\u7684\u6570\u636e\u5e93\u6216\u8868 \u7ae0\u8282\u7684\u9009\u9879\u6765\u6307\u5b9aslave\u590d\u5236\u7684\u8868\u5e76\u5206\u914d\u7ed9\u5176\u4ed6slave\uff0c\u51cf\u5c11slave\u9700\u8981\u5199\u5165\u7684\u6570\u636e\u3002 \u6b64\u65f6master\u7684IO\u548c\u7f51\u7edc\u538b\u529b\u53ef\u80fd\u4f1a\u589e\u5927\uff0c\u53ef\u901a\u8fc7\u4e0a\u6587\u7684 \u53cc\u4e3b\u590d\u5236\u67b6\u6784 \u6765\u7ee7\u7eed\u4f18\u5316\u3002 \u4f18\u70b9\uff1a\u81ea\u7531\u62c6\u5206\u4ece\u5e93\u3002 \u7f3a\u70b9\uff1a\u7ef4\u62a4\u9ebb\u70e6\uff0cmaster\u5b95\u673a\u65f6\u5904\u7406\u9ebb\u70e6\u3002 6.7.2 \u65b9\u6848\u4e8c \u00b6 \u5728\u4ece\u5e93\u590d\u5236\u65f6 \u542f\u52a8\u591a\u4e2aSQL\u7ebf\u7a0b \u5728\u4ece\u5e93\u4e0a\u542f\u7528\u591a\u7ebf\u7a0b\uff0c\u5e76\u8bbe\u7f6e\u4ece\u5e93\u5e94\u7528\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u4ee5\u4fbf\u5e76\u884c\u6267\u884c\u590d\u5236\u4e8b\u52a1\u3002 mysql > SHOW VARIABLES LIKE \"%WORKERS\" ; +------------------------+-------+ | Variable_name | Value | +------------------------+-------+ | slave_parallel_workers | 0 | +------------------------+-------+ mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 4 | system user | | NULL | Connect | 2482 | Waiting for master to send event | NULL | | 5 | system user | | NULL | Query | 2421 | Slave has read all relay log ; waiting for more updates | NULL | | 6 | event_scheduler | localhost | NULL | Daemon | 2482 | Waiting on empty queue | NULL | | 10 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ -- \u53ef\u4ee5\u5728 my.cnf \u4e2d\u914d\u7f6e mysql > SET GLOBAL slave_parallel_workers = 2 ; -- \u4fee\u6539\u4e0d\u4f1a\u7acb\u5373\u751f\u6548\uff0c\u91cd\u542f\u590d\u5236\u7ebf\u7a0b\u4e4b\u540e\u751f\u6548 mysql > stop slave ; mysql > start slave ; mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 2678 | Waiting on empty queue | NULL | | 10 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 12 | system user | | NULL | Connect | 38 | Waiting for master to send event | NULL | | 13 | system user | | NULL | Query | 38 | Slave has read all relay log ; waiting for more updates | NULL | | 14 | system user | | NULL | Connect | 38 | Waiting for an event from Coordinator | NULL | | 15 | system user | | NULL | Connect | 38 | Waiting for an event from Coordinator | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ 7. \u5207\u6362\u4e3b\u4ece\u670d\u52a1\u5668 \u00b6 \u770b\u8fc7\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b\u4e4b\u540e\u81ea\u5df1\u7684\u601d\u8def\uff0c\u4e0d\u4fdd\u8bc1\u6b63\u786e\u6027\uff01\uff01\uff01 \u9996\u5148\u4fdd\u8bc1\u6240\u6709slave\u7684\u4e2d\u7ee7\u65e5\u5fd7\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u7136\u540e\u5728\u6240\u6709slave\u4e0a\u505c\u6b62\u590d\u5236\u7ebf\u7a0b\uff0c\u5e76\u5c06\u5b8c\u6574\u7684\u6570\u636e\u540c\u6b65\u5230\u8be5slave\u4e0a\u9762\uff0c\u5728\u8981\u5207\u6362\u4e3amaster\u7684slave\u4e0a\u6267\u884c RESET MASTER \u91cd\u7f6emaster\uff08\u91cd\u7f6ebinlog\uff0c\u4f1a\u6e05\u7a7abinlog\u5e76\u5f00\u542f\u65b0\u7684binlog\uff09\uff0c\u6267\u884c RESET SLAVE \u91cd\u7f6eslave\uff08\u91cd\u7f6erelaylog\uff0c\u4f1a\u6e05\u7a7arelaylog\u5e76\u5f00\u542f\u65b0\u7684relaylog\uff09\uff0c\u5176\u4ed6\u7684slave\u5219\u901a\u8fc7 CHANGE MASTER TO \u91cd\u65b0\u8bbe\u7f6emaster\u4e3a\u8be5slave\u3002\u901a\u77e5\u6240\u6709\u7684\u5ba2\u6237\u7aef\u5c06\u5e94\u7528\u6307\u5411\u65b0\u7684master\u3002","title":"36. MySQL \u590d\u5236"},{"location":"mysql/36. MySQL \u590d\u5236/#1","text":"MySQL\u901a\u8fc7\u4e09\u4e2a\u7ebf\u7a0b\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\uff1a\u4e3b\u5e93\u4e0a\u7684 Binlog Dump \u7ebf\u7a0b\uff0c\u4ece\u5e93\u4e0a\u7684 I/O \u7ebf\u7a0b\u548c SQL \u7ebf\u7a0b\u3002\u5f53\u5728\u4ece\u5e93\u4e0a\u542f\u52a8\u590d\u5236\u65f6\uff08START SLAVE\uff09\uff0c\u9996\u5148\u521b\u5efaI/O\u7ebf\u7a0b\u8fde\u63a5\u4e3b\u5e93\uff0c\u4e3b\u5e93\u518d\u521b\u5efaBinlog Dump\u7ebf\u7a0b\u8bfb\u53d6\u6570\u636e\u5e93\u4e8b\u4ef6\u5e76 \u53d1\u9001 \u7ed9I/O\u7ebf\u7a0b\uff0cI/O\u7ebf\u7a0b\u83b7\u53d6\u5230\u4e8b\u4ef6\u6570\u636e\u4e4b\u540e\u66f4\u65b0\u5230\u4ece\u5e93\u7684\u4e2d\u7ee7\u65e5\u5fd7 Relay Log \u4e2d\u53bb\uff0c\u4e4b\u540e\u4ece\u5e93\u4e0a\u7684SQL\u7ebf\u7a0b\u8bfb\u53d6\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u66f4\u65b0\u7684\u6570\u636e\u5e93\u4e8b\u4ef6\u5e76\u5e94\u7528\u3002 \u67e5\u770b binglog \u7684\u683c\u5f0f\uff1a mysql > SHOW VARIABLES LIKE 'binlog_format' ; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | binlog_format | ROW | +---------------+-------+ RAW\u683c\u5f0f\u7684\u65e5\u5fd7\u4f1a\u7ecf\u8fc7\u7f16\u7801\u5b58\u50a8\uff0c\u67e5\u770b\u65f6\u53ef\u89e3\u7801\u67e5\u770b\uff1a $ mysqlbinlog /var/lib/mysql/binlog.000033 ... BINLOG ' bhpLXQ8BAAAAeAAAAHwAAAAAAAQAOC4wLjE2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAABuGktdEwANAAgAAAAABAAEAAAAYAAEGggAAAAICAgCAAAACgoKKioAEjQA CgGju2nB ... $ mysqlbinlog -vv bin.000033 --base64-output = DECODE-ROWS \u66f4\u6539\u6539\u503c\uff1a -- \u4e09\u79cd\u53ef\u9009\u503c\uff1aSTATMENT, ROW, MIXED mysql > SET GLOBAL BINLOG_FORMAT = 'MIXED' ;","title":"1. \u539f\u7406"},{"location":"mysql/36. MySQL \u590d\u5236/#2","text":"","title":"2. \u4e09\u79cd\u5e38\u89c1\u67b6\u6784"},{"location":"mysql/36. MySQL \u590d\u5236/#21","text":"\u9002\u7528\u4e8e\u4e3b\u5e93\u8bfb\u53d6\u538b\u529b\u975e\u5e38\u5927\u4e14\u8bfb\u8bf7\u6c42\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u3002","title":"2.1 \u4e00\u4e3b\u591a\u4ece\u67b6\u6784"},{"location":"mysql/36. MySQL \u590d\u5236/#22","text":"\u5728\u4e00\u4e3b\u591a\u4ece\u7684\u67b6\u6784\u4e0b\uff0c\u4e3b\u5e93\u7684I/O\u538b\u529b\u548c\u7f51\u7edc\u538b\u529b\u4f1a\u968f\u7740\u4ece\u5e93\u7684\u589e\u52a0\u800c\u589e\u957f\uff08\u6bcf\u4e2a\u4ece\u5e93\u90fd\u4f1a\u5728\u4e3b\u5e93\u4e0a\u6709\u4e00\u4e2a\u72ec\u7acb\u7684Binlog Dump\u7ebf\u7a0b\u6765\u63a8\u9001\u65e5\u5fd7\u5230\u4ece\u5e93\uff09\uff0c\u591a\u7ea7\u590d\u5236\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002 Master1\u53ea\u7ed9Master2\uff08\u9700\u8981\u6253\u5f00 --log-slave-updates \u9009\u9879\uff09\u63a8\u9001\u65e5\u5fd7\uff0c\u51cf\u8f7b\u5176\u63a8\u9001\u538b\u529b\uff1b\u4f46\u662f\u63a8\u9001\u5ef6\u65f6\u4f1a\u6bd4\u4e00\u4e3b\u591a\u4ece\u5927\u3002 \u964d\u4f4e\u5ef6\u65f6\u7684\u65b9\u6cd5\uff1a \u200b \u5c06Master2\u7684\u8868\u5f15\u64ce\u9009\u4e3a BLACKHOLE \u6765\u964d\u4f4e\u591a\u7ea7\u590d\u5236\u5ef6\u65f6\u3002\u5199\u5165\u8be5\u5f15\u64ce\u7684\u6570\u636e\u4e0d\u4f1a\u56de\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u8868\u6c38\u8fdc\u90fd\u662f\u4e00\u4e2a\u7a7a\u8868\uff0c\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u53ea\u5728Binlog\u4e2d\u8bb0\u5f55\u4e8b\u4ef6\u3002","title":"2.2 \u591a\u7ea7\u590d\u5236\u67b6\u6784"},{"location":"mysql/36. MySQL \u590d\u5236/#23-dual-master","text":"\u8be5\u67b6\u6784\u9002\u5408DBA\u505a\u7ef4\u62a4\u7b49\u9700\u8981\u4e3b\u4ece\u5207\u6362\u7684\u573a\u666f\uff0c\u907f\u514d\u4e86\u91cd\u590d\u642d\u5efa\u4ece\u5e93\u7684\u9ebb\u70e6\u3002 \u4e24\u8005\u4e92\u4e3a\u4e3b\u4ece\uff0c\u5199\u8bf7\u6c42\u8bbf\u95eeMaster1\uff0c\u8bfb\u8bf7\u6c42\u53ef\u8bbf\u95ee\u4e24\u8005\u3002 \u907f\u514d\u5f71\u54cd\u670d\u52a1\u7684\u7ef4\u62a4\u64cd\u4f5c\u6b65\u9aa4\uff1a \u505c\u6b62Master1\u7684slave\u7ebf\u7a0b\uff0c\u907f\u514d\u5bf9Master2\u7ef4\u62a4\u65f6\u5f71\u54cdMaster1\uff1b \u505c\u6b62Master2\u7684slave\u7ebf\u7a0b\uff0c\u6682\u505c\u63a5\u6536Master1\u7684\u66f4\u65b0\uff0c\u5f00\u59cb\u7ef4\u62a4\u64cd\u4f5c\uff1b \u5728Master2\u7684\u64cd\u4f5c\u5b8c\u6210\u4e4b\u540e\uff0c\u6253\u5f00Master2\u7684slave\u7ebf\u7a0b\uff0c\u540c\u6b65Master1\u7684\u6570\u636e\u5230Master2\uff0c\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\uff0c\u5c06\u5e94\u7528\u7684 \u8bfb\u5199 \u64cd\u4f5c\u5207\u6362\u5230Master2\u4e0a\u9762\uff1b \u786e\u8ba4Master1\u65e0\u5e94\u7528\u8bbf\u95ee\u4e4b\u540e\uff0c\u6253\u5f00Master1\u7684slave\u7ebf\u7a0b\uff0c\u540c\u6b65\u6570\u636e\uff0c\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u5c31\u53ef\u4ee5\u7ee7\u7eed\u54cd\u5e94\u8bfb\u8bf7\u6c42\u4e86\u3002 \u8be5\u67b6\u6784\u8fd8\u53ef\u4ee5\u4e0e\u4e3b\u4ece\u67b6\u6784\u7ed3\u5408\u4f7f\u7528\uff1a MySQL\u7684Binlog\u8bb0\u5f55\u7684\u662f\u4e8b\u4ef6\u521d\u59cb\u53d1\u751f\u7684server id\uff0c\u5728\u590d\u5236\u65f6\u53ea\u5e94\u7528\u548c\u81ea\u5df1server id\u4e0d\u540c\u7684Binlog\u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u5faa\u73af\u590d\u5236\u7684\u60c5\u51b5","title":"2.3 \u53cc\u4e3b\u590d\u5236/Dual Master\u67b6\u6784"},{"location":"mysql/36. MySQL \u590d\u5236/#3","text":"\u5b98\u7f51\u5f02\u6b65\u590d\u5236\u8fc7\u7a0b \u4e0b\u9762\u662fMySQL8.0\u7684\u5f02\u6b65\u590d\u5236\u5b9e\u8df5\u8fc7\u7a0b\uff1a master\uff1a\u6dfb\u52a0\u7528\u4e8e\u590d\u5236\u7684\u7528\u6237\uff08 \u8fd9\u4e00\u6b65\u53c2\u8003\u535a\u5ba2 \u4e0d\u4f7f\u7528\u63d2\u4ef6\u521b\u5efa\u7528\u6237\uff0c\u5426\u5219\u4f1a\u62a5\u9519\uff09 mysql > CREATE USER copy_user IDENTIFIED WITH 'mysql_native_password' BY 'xxx' ; mysql > GRANT REPLICATION SLAVE ON * . * TO 'copy_user' ; master\uff1a\u8bbe\u7f6e --server-id=1 \u73af\u5883\u53d8\u91cf\uff0c\u91cd\u542f\u670d\u52a1 $ systemctl set-environment MYSQLD_OPTS = \"--server-id=1\" $ systemctl restart mysqld master\uff1a\u8bbe\u7f6e\u8bfb\u9501\u5b9a\u6709\u6548\uff0c\u83b7\u53d6\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f4d\u7f6e mysql > FLUSH TABLES WITH READ LOCK ; mysql > SHOW MASTER STATUS ; +---------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +---------------+----------+--------------+------------------+-------------------+ | binlog . 000044 | 155 | | | | +---------------+----------+--------------+------------------+-------------------+ master\uff1a\u4f7f\u7528 mysqldump \u590d\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u591a\u79cd\u65b9\u5f0f\u590d\u5236\u6570\u636e\u3002\u6ce8\u610f\uff1a\u5982\u679c\u4e3b\u4ece\u6570\u636e\u5e93\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u6700\u597d\u4e0d\u8981\u590d\u5236\u5168\u90e8\u7684\u6570\u636e\u5e93\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u628a\u6743\u9650\u8868\u4e5f\u590d\u5236\u8fc7\u53bb\uff0c\u5bfc\u81f4\u4ece\u6570\u636e\u5e93\u65e0\u6cd5\u542f\u52a8\u3002 $ mysqldump -u root -p --databases blog > blog-dump.log master\uff1a\u89e3\u9664\u9501\u5b9a mysql > UNLOCK TABLES ; slave\uff1a\u8bfb\u53d6\u6570\u636e $ /home/mysql2/mysql/bin/mysql --defaults-file = /home/mysql2/mysql/my.cnf -uroot -p < blog-dump.log slave\uff1aMySQL\u670d\u52a1\u6dfb\u52a0 --server-id \u9009\u9879\uff0c\u8be5\u503c\u5fc5\u987b\u552f\u4e00\uff08\u76f8\u5bf9\u4e8e\u5176\u4ed6\u4ece\u6570\u636e\u5e93\u6765\u8bf4\uff09\u4e14\u548cmaster\u7684\u4e0d\u540c\uff1b\u6dfb\u52a0 --skip-slave-start \u9009\u9879\uff0c\u6682\u505c\u670d\u52a1\u5668\u7684\u590d\u5236\u8fdb\u7a0b\uff1a $ /home/mysql2/mysql/bin/mysqld_safe --defaults-file = /home/mysql2/mysql/my.cnf --server-id = 2 --skip-slave-start --user = mysql2 & slave\uff1a\u6307\u5b9amaster\u7684\u914d\u7f6e\uff1a mysql > CHANGE MASTER TO MASTER_HOST = '192.168.17.10' , MASTER_PORT = 3306 , MASTER_USER = 'copy_user' , MASTER_PASSWORD = 'MyPass3#' , MASTER_LOG_FILE = 'binlog.000044' , MASTER_LOG_POS = 155 ; mysql > START SLAVE ; -- \u5217\u51fa\u8fdb\u7a0b\u72b6\u6001 mysql > SHOW PROCESSLIST ; -- Connecting to master\u662f\u5f02\u5e38\u72b6\u6001 +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 1073 | Waiting on empty queue | NULL | | 16 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 17 | system user | | NULL | Connect | 7 | Connecting to master | NULL | | 18 | system user | | NULL | Query | 7 | Slave has read all relay log ; waiting for more updates | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ \u53ef\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\u67e5\u770bslave\u8fde\u63a5master\u5931\u8d25\u7684\u539f\u56e0\uff1a mysql > SHOW SLAVE STATUS \\ G ; Last_IO_Errno : 2061 -- \u5bc6\u7801\u63d2\u4ef6\u5bfc\u81f4\u7684\u65e0\u6cd5\u9a8c\u8bc1\uff0c\u597d\u50cf\u662f\u4e2abug Last_IO_Error : error connecting to master 'copy_user@192.168.17.10:3306' - retry - time : 60 retries : 2 message : Authentication plugin 'caching_sha2_password' reported error : Authentication requires secure connection . Last_SQL_Errno : 0 Last_SQL_Error \u51fa\u73b0\u4e0b\u9762\u7684\u9519\u8bef\u65f6\uff0c\u53ef\u4ee5\u67e5\u627e\u662f\u5426\u662f\u7f51\u7edc\u3001\u9632\u706b\u5899\u7b49\u95ee\u9898 Last_IO_Error : error connecting to master ' copy_user @192.168.17.10 : 3306 ' - retry - time : 60 retries : 2 message : Can ' t connect to MySQL server on ' 192.168.17.10 ' ( 113 ) slave\uff1a\u6b63\u5e38\u72b6\u6001 mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 1480 | Waiting on empty queue | NULL | | 16 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 17 | system user | | NULL | Connect | 414 | Waiting for master to send event | NULL | | 18 | system user | | NULL | Query | 234 | Slave has read all relay log ; waiting for more updates | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ master\uff1a\u6b63\u5e38\u72b6\u6001 mysql > SHOW PROCESSLIST ; +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ | 4 | event_scheduler | localhost | NULL | Daemon | 4714 | Waiting on empty queue | NULL | | 8 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 14 | copy_user | 192 . 168 . 17 . 11 : 46538 | NULL | Binlog Dump | 309 | Master has sent all binlog to slave ; waiting for more updates | NULL | +----+-----------------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+ \u6b64\u65f6\u5df2\u7ecf\u5f02\u6b65\u590d\u5236\u914d\u7f6e\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728master\u4e0a\u9762\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\u6765\u9a8c\u8bc1\u662f\u5426\u4f1a\u540c\u6b65\u5230slave\uff08\u4f1a\u6709\u5ef6\u8fdf\uff09\u3002","title":"3. \u5f02\u6b65\u590d\u5236\u5b9e\u8df5"},{"location":"mysql/36. MySQL \u590d\u5236/#4","text":"MySQL5.5\u4e4b\u524d\u662f\u5f02\u6b65\u590d\u5236\uff0c\u662f\u6ca1\u6709\u6b64\u673a\u5236\u7684\u3002 \u5f02\u6b65\u590d\u5236\u5b58\u5728\u7684\u9690\u60a3\uff1a\u4e3b\u5e93\u4e0a\u5199\u4e00\u4e2a\u4e8b\u52a1\u5e76\u63d0\u4ea4\u6210\u529f\uff0c\u4f46\u662f\u4ece\u5e93\u5c1a\u672a\u83b7\u53d6\uff0c\u6b64\u65f6\u4e3b\u5e93\u5b95\u673a\u9020\u6210\u4e86\u8be5\u4e8b\u52a1\u7684Binlog\u4e22\u5931\uff0c\u4ece\u5e93\u5c31\u4f1a\u635f\u5931\u8be5\u4e8b\u52a1\uff0c\u9020\u6210\u4e3b\u4ece\u4e0d\u4e00\u81f4\u3002 \u5f02\u6b65\u590d\u5236\u6d41\u7a0b\uff1a \u534a\u540c\u6b65\u590d\u5236\u6d41\u7a0b\uff1a \u534a\u540c\u6b65\u590d\u5236\uff1a\u4e3b\u5e93\u5728\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u65f6\uff0c\u5148\u7b49\u5f85\u5176\u4e2d\u4e00\u4e2a\u4ece\u5e93\u63a5\u6536\u5230Binlog\u5e76\u6210\u529f\u5199\u5165\u5230\u4e2d\u7ee7\u65e5\u5fd7\u540e\uff0c\u4e3b\u5e93\u624d\u8fd4\u56deCommit\u64cd\u4f5c\u7ed9\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u5728\u6b65\u9aa44\u8fde\u63a5\u4e0d\u4e0a\u4ece\u5e93\uff0c\u4e3b\u5e93\u4f1a\u7b49\u5f85\u4e00\u4f1a\u513f\uff08 rpl_semi_sync_master_timeout \u53d8\u91cf\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff09\uff0c\u82e5\u8d85\u65f6\uff0c\u81ea\u52a8\u8c03\u6574\u4e3a\u5f02\u6b65\u590d\u5236\u6a21\u5f0f\uff1b\u4ece\u5e93\u540e\u6765\u6b63\u5e38\u8fde\u63a5\u65f6\uff0c\u53c8\u4f1a\u81ea\u52a8\u5207\u6362\u4e3a\u534a\u540c\u6b65\u6a21\u5f0f\u3002 \u5b9e\u8df5\u6b65\u9aa4 \uff1a \u5224\u65adMySQL\u662f\u5426\u652f\u6301\u52a8\u6001\u589e\u52a0\u63d2\u4ef6 mysql > SELECT @@ have_dynamic_loading ; +------------------------+ | @@ have_dynamic_loading | +------------------------+ | YES | +------------------------+ \u68c0\u67e5\u5b89\u88c5\u76ee\u5f55\u662f\u5426\u5b58\u5728\u534a\u540c\u6b65\u590d\u5236\u63d2\u4ef6 # \u5305\u7ba1\u7406\u5668\u5b89\u88c5\u8def\u5f84 /usr/lib64/mysql/plugin/semisync_master.so /usr/lib64/mysql/plugin/semisync_slave.so # \u4e8c\u8fdb\u5236\u5305\u5b89\u88c5\u8def\u5f84 /home/mysql2/mysql-8.0.17-el7-x86_64/lib/plugin/semisync_master.so /home/mysql2/mysql-8.0.17-el7-x86_64/lib/plugin/semisync_slave.so \u5b89\u88c5\u63d2\u4ef6 # \u4e3b\u5e93 mysql > INSTALL PLUGIN rpl_semi_sync_master SONAME 'semisync_master.so' ; mysql > SELECT * FROM mysql . plugin ; +----------------------+--------------------+ | name | dl | +----------------------+--------------------+ | rpl_semi_sync_master | semisync_master . so | +----------------------+--------------------+ #\u4ece\u5e93 mysql > INSTALL PLUGIN rpl_semi_sync_slave SONAME 'semisync_slave.so' ; mysql > SELECT * FROM mysql . plugin ; +---------------------+-------------------+ | name | dl | +---------------------+-------------------+ | rpl_semi_sync_slave | semisync_slave . so | +---------------------+-------------------+ \u6253\u5f00\u534a\u540c\u6b65\u914d\u7f6e # \u4e3b\u5e93 mysql > SET GLOBAL rpl_semi_sync_master_enabled = ON ; mysql > SET GLOBAL rpl_semi_sync_master_timeout = 30000 ; # \u4ece\u5e93 mysql > SET GLOBAL rpl_semi_sync_slave_enabled = ON ; \u4e5f\u53ef\u4ee5\u5728 my.cnf \u4e2d\u914d\u7f6e\uff0c\u8fd9\u6837\u5728\u6bcf\u6b21\u6570\u636e\u5e93\u91cd\u542f\u65f6\u5c31\u4e0d\u5fc5\u624b\u52a8\u5f00\u542f\u4e86\uff1a # master [ mysqld ] rpl_semi_sync_master_enabled = 1 rpl_semi_sync_master_timeout = 1000 # 1 second # slave [ mysqld ] rpl_semi_sync_slave_enabled = 1 \u82e5\u4e4b\u524d\u662f\u5f02\u6b65\u590d\u5236\uff0c\u5219\u9700\u8981\u91cd\u542f\u4ece\u5e93\u7684I/O\u7ebf\u7a0b mysql > STOP SLAVE IO_THREAD ; START SLAVE IO_THREAD ; \u5728\u4e3b\u5e93\u4e0a\u68c0\u67e5\u72b6\u6001 mysql > SHOW VARIABLES LIKE '%SEMI%' ; mysql > SHOW STATUS LIKE '%SEMI%' ; \u9700\u8981\u89c2\u5bdf\u7684\u662f\u8fd9\u4e9b\u503c\u7684\u53d8\u5316\uff0c\u800c\u4e0d\u662f\u521d\u59cb\u503c\u3002 \u7740\u91cd\u5173\u6ce8\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a Rpl_semi_sync_master_status \uff1a\u534a\u540c\u6b65\u6a21\u5f0f\u7684\u72b6\u6001 Rpl_semi_sync_master_yes_tx \uff1a\u8868\u793a\u6709\u51e0\u4e2a\u4e8b\u52a1\u662f\u901a\u8fc7\u6b64\u673a\u5236\u540c\u6b65\u7684 Rpl_semi_sync_master_no_tx \uff1a\u8868\u793a\u6709\u51e0\u4e2a\u4e8b\u52a1\u4e0d\u662f\u5728\u8be5\u6a21\u5f0f\u4e0b\u540c\u6b65\u7684","title":"4. \u534a\u540c\u6b65\u590d\u5236\u5b9e\u8df5"},{"location":"mysql/36. MySQL \u590d\u5236/#5","text":"\u548c\u590d\u5236\u6709\u5173\u7684\u5e38\u7528\u542f\u52a8\u9009\u9879\u3002","title":"5. \u4e3b\u8981\u590d\u5236\u542f\u52a8\u9009\u9879"},{"location":"mysql/36. MySQL \u590d\u5236/#51-log-slave-updates","text":"master\u7684\u9009\u9879\u3002\u7528\u6765\u914d\u7f6e\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u66f4\u65b0\u64cd\u4f5c\u662f\u5426\u5199\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0cMySQL>= 8.0.3\u7684\u9ed8\u8ba4\u503c\u662f ON \uff0cMySQL<= 8.0.2\u7684\u9ed8\u8ba4\u503c\u662f OFF \u3002 \u4f46\u662f\uff0c\u5982\u679c\u8fd9\u4e2a\u4ece\u670d\u52a1\u5668\u540c\u65f6\u4e5f\u8981\u4f5c\u4e3a\u5176\u4ed6\u670d\u52a1\u5668\u7684\u4e3b\u670d\u52a1\u5668\uff0c\u642d\u5efa\u4e00\u4e2a\u94fe\u5f0f\u7684\u590d\u5236\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6253\u5f00\u8fd9\u4e2a\u9009\u9879\u3002 A -> B -> C \u53ef\u4ee5\u4f7f\u7528 --skip-log-bin \u5173\u95edmaster\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u6b64\u65f6\u9ed8\u8ba4\u4e5f\u4f1a\u5173\u95edslave\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u3002\u5982\u679c\u60f3\u8981\u7981\u7528slave\u66f4\u65b0binlog\u65e5\u5fd7\u800c\u542f\u7528master\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4f7f\u7528 --skip-log-slave-updates \u9009\u9879\u3002","title":"5.1 --log-slave-updates"},{"location":"mysql/36. MySQL \u590d\u5236/#52-master-connect-retry","text":"\u8bbe\u7f6e\u5728\u548c\u4e3b\u670d\u52a1\u5668\u7684\u8fde\u63a5\u4e22\u5931\u7684\u65f6\u5019\uff0c\u91cd\u8bd5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u662f 60 \u79d2\uff0c\u5373\u6bcf 60 \u79d2\u91cd\u8bd5\u4e00\u6b21\u3002 \u5728MySQL 5.5\u4e2d\u5e9f\u5f03\u4e86\uff0c\u4f7f\u7528 \u201cCHANGE MASTER TO Syntax\u201d \uff1a CHANGE MASTER TO MASTER_CONNECT_RETRY = 10 ; --master-retry-count \u9650\u5236\u91cd\u8bd5\u6b21\u6570\u3002","title":"5.2 --master-connect-retry"},{"location":"mysql/36. MySQL \u590d\u5236/#53-read-only","text":"\u4f7f\u6240\u6709\u975e\u4e34\u65f6\u8868\u90fd\u4e3a\u53ea\u8bfb\uff0c\u4f46\u590d\u5236\uff08slave\uff09\u7ebf\u7a0b\u548c\u5177\u6709 SUPER \u7279\u6743\u7684\u7528\u6237\u9664\u5916\u3002 $ ./bin/mysqld_safe --read-only & \u4f7f\u7528 read-only \u542f\u52a8\u7684\u4ece\u6570\u636e\u5e93\u4f1a\u62d2\u7edd\u666e\u901a\u7528\u6237\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4ee5\u786e\u4fdd\u4ece\u6570\u636e\u5e93\u7684\u5b89\u5168\u6027\u3002","title":"5.3 --read-only"},{"location":"mysql/36. MySQL \u590d\u5236/#54","text":"--replicate-do-db=db_name \u3001 --replicate-ignore-db=*db_name* \u3001 --replicate-do-table=db_name.tbl_name \u3001 --replicate-ignore-table=db_name.tbl_name \u3001 --replicate-wild-do-table=db_name.tbl_name \u3001 --replicate-wild-ignore-table=db_name.tbl_name \u3002 \u4ee5\u4e0a\u8fd9\u4e9b\u8bed\u53e5\u53ef\u4ee5\u6307\u5b9a\u4ece\u4e3b\u6570\u636e\u5e93\u590d\u5236\u5230\u4ece\u6570\u636e\u5e93\u7684\u6570\u636e\u5e93\u6216\u8005\u8868\u3002 \u4ece\u5e93\u542f\u52a8\u65f6\u4f7f\u7528\uff1a $ ./bin/mysqld_safe --replicate-do-table = blog.test &","title":"5.4 \u6307\u5b9a\u590d\u5236\u7684\u6570\u636e\u5e93\u6216\u8005\u8868"},{"location":"mysql/36. MySQL \u590d\u5236/#541-replicate-wild-do-table","text":"\u4e0e\u6307\u5b9a\u7684\u6570\u636e\u5e93\u548c\u8868\u540d\u6a21\u5f0f\u5339\u914d\u7684\u8bed\u53e5\u6765\u521b\u5efa\u590d\u5236\u8fc7\u6ee4\u5668\uff0c\u6a21\u5f0f\u53ef\u4ee5\u5305\u542b \uff05 \u548c _ \u901a\u914d\u7b26\u3002 $ . / bin / mysqld_safe -- replicate - wild - do - table = foo % . bar % & \u6b64\u9009\u9879\u9002\u7528\u4e8e tables, views, and triggers \u3002 \u8868\u540d\u6216\u6570\u636e\u5e93\u540d\u4e2d\u6709\u7279\u6b8a\u5b57\u7b26\u65f6\u9700\u8981\u8f6c\u79fb\u7b26\u3002\u4f8b\u5982\uff0c\u8981\u590d\u5236\u540d\u4e3a my_own%db \u7684\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\uff0c\u800c\u4e0d\u590d\u5236my5ownAABCdb\u6570\u636e\u5e93\u4e2d\u7684\u590d\u5236\u8868\uff0c\u5219\u5e94\u8be5\u8f6c\u4e49 _ \u548c \uff05 \u5b57\u7b26\uff0c\u5982\u4e0b\u6240\u793a\uff1a --replicate-wild-do-table=my\\_own\\%db \uff1b\u5982\u679c\u5728shell\u4e2d\u6307\u5b9a\u5219\u9700\u8981\u53cc\u8f6c\u4e49\u5b57\u7b26\uff1a --replicate-wild-do-table=my\\\\_own\\\\%db \u3002","title":"5.4.1 --replicate-wild-do-table"},{"location":"mysql/36. MySQL \u590d\u5236/#55-slave-skip-errors","text":"slave\u53ef\u80fd\u4f1a\u9047\u5230\u6267\u884c BINLOG \u4e2d\u7684 SQL \u51fa\u9519\u7684\u60c5\u51b5\uff08\u6bd4\u5982\u4e3b\u952e\u51b2\u7a81\uff09\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4ece\u670d\u52a1\u5668\u5c06\u4f1a\u505c\u6b62\u590d\u5236\u8fdb\u7a0b\uff0c\u4e0d\u518d\u8fdb\u884c\u540c\u6b65\uff0c\u7b49\u5f85\u7528\u6237\u4ecb\u5165\u5904\u7406\u3002 \u6b64\u53c2\u6570\u7684\u4f5c\u7528\u5c31\u662f\u7528\u6765\u5b9a\u4e49\u590d\u5236\u8fc7\u7a0b\u4e2d\u4ece\u670d\u52a1\u5668\u53ef\u4ee5\u81ea\u52a8\u8df3\u8fc7\u7684\u9519\u8bef\u53f7\uff0c\u8fd9\u6837\u5f53\u590d\u5236\u8fc7\u7a0b\u4e2d\u9047\u5230\u5b9a\u4e49\u4e2d\u7684\u9519\u8bef\u53f7\u65f6\uff0c\u4fbf\u53ef\u4ee5\u81ea\u52a8\u8df3\u8fc7\uff0c\u76f4\u63a5\u6267\u884c\u540e\u9762\u7684 SQL \u8bed\u53e5\uff0c\u4ee5\u6b64\u6765\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u4eba\u5de5\u5e72\u9884\u3002 -- slave - skip - errors = [ err_code1 , err_code2 ,... | all | ddl_exist_errors ] \u901f\u8bb0\u503c ddl_exist_errors \u7b49\u540c\u4e8e\u9519\u8bef\u4ee3\u7801\u5217\u8868 1007,1008,1050,1051,1054,1060,1061,1068,1094,1146 \u3002 \u6700\u597d\u53ea\u5728\u4ece\u6570\u636e\u5e93\u4ec5\u4ec5\u662f\u4e3a\u4e86\u5206\u62c5\u4e3b\u6570\u636e\u5e93\u7684\u67e5\u8be2\u538b\u529b\uff0c\u4e14\u5bf9\u6570\u636e\u7684\u5b8c\u6574\u6027\u8981\u6c42\u4e0d\u662f\u5f88\u4e25\u683c\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002\u5982\u679c\u4ece\u6570\u636e\u5e93\u4e3b\u8981\u662f\u4f5c\u4e3a\u4e3b\u6570\u636e\u5e93\u7684\u5907\u4efd\uff0c\u90a3\u4e48\u5c31\u4e0d\u5e94\u8be5\u4f7f\u7528\u8fd9\u4e2a\u542f\u52a8\u53c2\u6570\uff0c\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u5f88\u53ef\u80fd\u9020\u6210\u4e3b\u4ece\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u540c\u6b65\u3002","title":"5.5 --slave-skip-errors"},{"location":"mysql/36. MySQL \u590d\u5236/#6","text":"","title":"6. \u65e5\u5e38\u7ba1\u7406\u7ef4\u62a4"},{"location":"mysql/36. MySQL \u590d\u5236/#61","text":"\u4e3a\u4e86\u9632\u6b62\u590d\u5236\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u6545\u969c\u4ece\u800c\u5bfc\u81f4\u590d\u5236\u8fdb\u7a0b\u505c\u6b62\uff0c\u6211\u4eec\u9700\u8981\u7ecf\u5e38\u68c0\u67e5slave\u7684\u590d\u5236\u72b6\u6001\u3002 mysql > SHOW SLAVE STATUS \\ G ; \u4e3b\u8981\u5173\u6ce8\u4e24\u4e2a\u9009\u9879\uff1a Slave_IO_Running\uff1a\u6b64\u8fdb\u7a0b\u8d1f\u8d23Slave\u4eceMaster\u4e0a\u8bfb\u53d6 BINLOG \u65e5\u5fd7\uff0c\u5e76\u5199\u5165\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u3002 Slave_SQL_Running\uff1a\u6b64\u8fdb\u7a0b\u8d1f\u8d23\u8bfb\u53d6\u5e76\u4e14\u6267\u884c\u4e2d\u7ee7\u65e5\u5fd7\u4e2d\u7684 BINLOG \u65e5\u5fd7\u3002","title":"6.1 \u67e5\u770b\u4ece\u5e93\u72b6\u6001"},{"location":"mysql/36. MySQL \u590d\u5236/#62","text":"\u5728\u67d0\u4e9b\u7e41\u5fd9\u7684 OLTP(\u5728\u7ebf\u4e8b\u52a1\u5904\u7406)\u7cfb\u7edf\u4e0a\uff0c\u7531\u4e8e\u4e3b\u670d\u52a1\u5668\u66f4\u65b0\u9891\u7e41\uff0c\u800c\u4ece\u670d\u52a1\u5668\u7531\u4e8e\u5404\u79cd\u539f\u56e0\uff08\u6bd4\u5982\u786c\u4ef6\u6027\u80fd\u8f83\u5dee\uff09\u5bfc\u81f4\u66f4\u65b0\u901f\u5ea6\u8f83\u6162\uff0c\u4ece\u800c\u4f7f\u5f97\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u5dee\u8ddd\u8d8a\u6765\u8d8a\u5927\uff0c\u6700\u7ec8\u5bf9\u67d0\u4e9b\u5e94\u7528\u4ea7\u751f\u5f71\u54cd\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5b9a\u671f\u5730\u8fdb\u884c\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u540c\u6b65\uff0c\u4f7f\u5f97\u4e3b\u4ece\u6570\u636e\u5dee\u8ddd\u80fd\u591f\u51cf\u5230\u6700\u5c0f\u3002\u5e38\u7528\u7684\u65b9\u6cd5\u662f\uff1a \u5728\u8d1f\u8f7d\u8f83\u4f4e\u7684\u65f6\u5019\u6682\u65f6\u963b\u585e\u4e3b\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u5f3a\u5236\u4e3b\u4ece\u6570\u636e\u5e93\u66f4\u65b0\u540c\u6b65 \u3002 \u6b65\u9aa4\u5982\u4e0b\uff1a master\uff1a\u9501\u5b9a\u8868 mysql > FLUSH TABLES WITH READ LOCK ; # \u8bb0\u5f55\u65e5\u5fd7\u4f4d\u7f6e mysql > SHOW MASTER STATUS ; +---------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +---------------+----------+--------------+------------------+-------------------+ | binlog . 000048 | 155 | | | | +---------------+----------+--------------+------------------+-------------------+ slave\uff1a\u540c\u6b65\u6570\u636e mysql > SELECT MASTER_POS_WAIT ( 'binlog.000048' , 155 ); +---------------------------------------+ | MASTER_POS_WAIT ( 'binlog.000048' , 155 ) | +---------------------------------------+ | 0 | +---------------------------------------+ \u8fd9\u4e2a SELECT \u8bed\u53e5\u4f1a\u963b\u585e\u76f4\u5230\u4ece\u670d\u52a1\u5668\u8fbe\u5230\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u504f\u79fb\u91cf\u540e\uff0c\u8fd4\u56de 0\uff1b\u5982\u679c\u8fd4\u56de-1\uff0c\u5219\u8868\u793a\u8d85\u65f6\u9000\u51fa\u3002 master\uff1a\u89e3\u9664\u9501\u5b9a mysql > UNLOCK TABLES ;","title":"6.2 \u4e3b\u4ece\u5e93\u540c\u6b65\u7ef4\u62a4"},{"location":"mysql/36. MySQL \u590d\u5236/#63","text":"\u5982\u679c\u662f\u8868\u7ed3\u6784\u4e0d\u540c\u5bfc\u81f4\u7684\uff0c\u5219\u4fee\u6539\u4ece\u670d\u52a1\u5668\u7684\u8868\u4e0e\u4e3b\u670d\u52a1\u5668\u7684\u76f8\u540c\uff0c\u7136\u540e\u91cd\u65b0\u8fd0\u884c START SLAVE \u8bed\u53e5\u3002 \u5982\u679c\u4e0d\u662f\u8868\u7ed3\u6784\u4e0d\u540c\u5bfc\u81f4\u7684\u66f4\u65b0\u5931\u8d25\uff0c\u5219\u9700\u8981\u786e\u8ba4\u624b\u52a8\u66f4\u65b0\u662f\u5426\u5b89\u5168\uff0c\u7136\u540e\u5ffd\u89c6\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u66f4\u65b0\u5931\u8d25\u7684\u8bed \u53e5\u3002\u8df3\u8fc7\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u8bed\u53e5\u7684\u547d\u4ee4\u4e3a \uff1a mysql > SET GLOBAL sql_slave_skip_counter = N ; N \u7684\u53d6\u503c\uff1a\u5982\u679c\u6765\u81ea\u4e3b\u670d\u52a1\u5668\u7684\u66f4\u65b0\u8bed\u53e5\u4e0d\u4f7f\u7528 AUTO_INCREMENT \u6216 LAST_INSERT_ID() \uff0cN \u503c\u5e94\u4e3a 1\uff08\u8df3\u8fc7\u4e00\u6761sql\u8bed\u53e5\u7684\u6267\u884c\uff09\uff0c\u5426\u5219\uff0c\u503c\u5e94\u4e3a 2\u3002 \u56e0\u4e3a\u8fd9\u4e24\u4e2a\u8bed\u53e5\u9700\u8981\u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u53d6\u4e24\u4e2a\u4e8b\u4ef6\u3002 \u5b9e\u8df5\u6b65\u9aa4\uff1a \u5173\u95edslave\u7684\u590d\u5236\u7ebf\u7a0b\uff0c\u8bbe\u7f6e\u8df3\u8fc7\u8bed\u53e5\u6570\u91cf mysql > STOP SLAVE ; mysql > SET GLOBAL sql_slave_skip_counter = 2 ; \u5728master\u66f4\u65b0\u6570\u636e # \u66f4\u65b0\u4e00\u6761\u5e26\u6709\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e mysql > DESC t1 ; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int ( 11 ) | NO | PRI | NULL | auto_increment | | name | varchar ( 10 ) | YES | | NULL | | +-------+-------------+------+-----+---------+----------------+ mysql > INSERT INTO t1 ( name ) VALUES ( \"abcd\" ); # \u66f4\u65b0\u4e00\u6761\u4e0d\u5e26\u6709\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e mysql > DESC test ; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int ( 11 ) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ mysql > INSERT INTO test VALUES ( 78 ); \u6253\u5f00slave\u7684\u590d\u5236\u7ebf\u7a0b\uff0c\u67e5\u770b\u66f4\u65b0\u7ed3\u679c mysql > START SLAVE ; # \u524d\u4e24\u5929\u6570\u636e\u672a\u66f4\u65b0\uff0c\u81ea\u589e\u5c5e\u6027\u7684\u6570\u636e\u672a\u590d\u5236\u5230slave mysql > SELECT * FROM t1 WHERE name = \"abcd\" ; Empty set ( 0 . 00 sec ) # \u66f4\u65b0\u4e86\u7b2c\u4e09\u6761\u6570\u636e mysql > SELECT * FROM test WHERE id = 78 ; +------+ | id | +------+ | 78 | +------+","title":"6.3 \u4ece\u670d\u52a1\u5668\u590d\u5236\u51fa\u9519\u7684\u5904\u7406"},{"location":"mysql/36. MySQL \u590d\u5236/#64-log-event-entry-exceeded-max_allowed_packet","text":"\u5982\u679c\u5e94\u7528\u4e2d\u4f7f\u7528\u5927\u7684 BLOG \u5217\u6216\u8005\u957f\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u6062\u590d\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0 log event entry exceeded max_allowed_packet \u9519\u8bef\uff0c\u5e76\u4e14\u4f1a\u5bfc\u81f4slave\u7684IO\u7ebf\u7a0b\u505c\u6b62\uff0c\u8fd9\u662f\u56e0\u4e3a\u542b\u6709\u5927\u6587\u672c\u7684\u8bb0\u5f55\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u4f20\u8f93\u5bfc\u81f4\u3002 \u89e3\u51b3\u7684\u529e\u6cd5\u5c31\u662f\u5728\u4e3b\u4ece\u670d\u52a1\u5668\u4e0a\u589e\u52a0 max_allowed_packet \uff08\u9650\u5236\u8868\u7684\u6bcf\u4e00\u5217\u7684\u5927\u5c0f\uff0c\u6b64\u53c2\u6570\u4e5f\u4f1a\u9650\u5236\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u4f20\u8f93\uff09\u53c2\u6570\u7684\u5927\u5c0f\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u4e3a \uff1aMySQL>= 8.0.3\uff0c64 MB \uff1bMySQL<= 8.0.2\uff0c1MB\u3002 mysql > SHOW VARIABLES LIKE '%max_allowed%' ; +---------------------------+------------+ | Variable_name | Value | +---------------------------+------------+ | max_allowed_packet | 67108864 | | mysqlx_max_allowed_packet | 67108864 | | slave_max_allowed_packet | 1073741824 | +---------------------------+------------+ -- \u4e0d\u4f1a\u5f71\u54cd\u5230\u5df2\u7ecf\u6253\u5f00\u7684session\uff0c\u53ea\u6709\u65b0\u5f00\u7684session\u624d\u4f1a\u751f\u6548 -- \u5bf9global\u4f5c\u7528\u57df\u7684\u53d8\u91cf\u5efa\u8bae\u662f\uff1a\u5728my.cnf\u4e2d\u6307\u5b9a\uff0c\u91cd\u542f\u670d\u52a1\u540e\u751f\u6548 mysql > SET GLOBAL max_allowed_packet = 1073741824 ; \u4e3b\u4ece\u670d\u52a1\u5668\u540c\u65f6\u5728 my.cnf \u4e2d\u8bbe\u7f6e\uff1a -- \u6700\u5927\u503c [ mysqld ] max_allowed_packet = 1 GB \u590d\u5236\u4ece\u7ad9\u5b9e\u9645\u4e0a\u63a5\u53d7\u7684\u6570\u636e\u5305\u8fbe\u5230\u5176 slave_max_allowed_packet \u8bbe\u7f6e\u6240\u8bbe\u7f6e\u7684\u9650\u5236\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a1GB\u7684\u6700\u5927\u503c\uff0c\u4ee5\u9632\u6b62\u7531\u4e8e\u5927\u6570\u636e\u5305\u800c\u5bfc\u81f4\u590d\u5236\u5931\u8d25\u3002","title":"6.4 log event entry exceeded max_allowed_packet"},{"location":"mysql/36. MySQL \u590d\u5236/#65","text":"\u591a\u4e3b\u590d\u5236\uff1a\u591a\u53f0\u4e3b\u670d\u52a1\u5668\u5bf9\u4e00\u53f0\u4ece\u670d\u52a1\u5668\u3002 \u6b64\u65f6\u9700\u8981\u5b9a\u5236 auto_increment_increment \u548c auto_increment_offset \uff0c\u4fdd\u8bc1\u591a\u4e3b\u4e4b\u95f4\u590d\u5236\u5230\u4ece\u6570\u636e\u5e93\u4e0d\u4f1a\u6709\u91cd\u590d\u51b2\u7a81\u3002 \u6bd4\u5982\uff0c\u4e24\u4e2a master \u7684\u60c5\u51b5\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u8bbe\u7f6e\uff1a Master1 \u4e0a\uff1aauto_increment_increment = 2\uff0cauto_increment_offset = 1\uff1b\uff081,3,5,7\u2026\u5e8f \u5217\uff09\u3002 Master2 \u4e0a\uff1aauto_increment_increment = 2\uff0cauto_increment_offset = 2\uff1b\uff082,4,6\u2026\u5e8f \u5217\uff09\u3002 mysql > SHOW VARIABLES LIKE 'auto_inc%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | | auto_increment_offset | 1 | +--------------------------+-------+ -- \u5df2\u6253\u5f00\u7684session\u8bbe\u7f6e\u65e0\u6548 mysql > SET GLOBAL auto_increment_increment = 1 ; -- SET SESSION auto_increment_increment \u7684\u7b80\u6613\u5199\u6cd5\uff0c\u7acb\u5373\u751f\u6548 mysql > SET @@ auto_increment_increment = 3 ; mysql > SHOW SESSION VARIABLES LIKE 'auto_inc%' ; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 3 | | auto_increment_offset | 1 | +--------------------------+-------+","title":"6.5 \u591a\u4e3b\u590d\u5236\u65f6\u7684\u81ea\u589e\u957f\u53d8\u91cf\u51b2\u7a81\u95ee\u9898"},{"location":"mysql/36. MySQL \u590d\u5236/#66","text":"Binlog dump thread \uff1amaster\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4ee5\u4fbf\u5728slave\u8fde\u63a5\u65f6\u5c06\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5185\u5bb9\u53d1\u9001\u5230slave\u3002 Slave I/O thread \uff1a\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u53d1\u51fa START SLAVE \u8bed\u53e5\u65f6\uff0c\u4ece\u670d\u52a1\u5668\u4f1a\u521b\u5efa\u4e00\u4e2aI/O\u7ebf\u7a0b\uff0c\u8be5\u7ebf\u7a0b\u8fde\u63a5\u5230\u4e3b\u670d\u52a1\u5668\u5e76\u8981\u6c42\u5b83\u53d1\u9001\u5728\u5176\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u66f4\u65b0\u8bb0\u5f55\u3002 Slave SQL thread \uff1aslave\u521b\u5efa\u4e00\u4e2aSQL\u7ebf\u7a0b\u6765\u8bfb\u53d6\u7531\u4ece\u670d\u52a1\u5668I/O\u7ebf\u7a0b\u5199\u5165\u7684\u4e2d\u7ee7\u65e5\u5fd7\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u5305\u542b\u7684\u4e8b\u4ef6\u3002 \u5bf9\u4e8e\u4ece\u670d\u52a1\u5668\u7684SQL\u7ebf\u7a0b\uff0c SHOW [FULL] PROCESSLIST \u7684 Time \u662f\u6700\u540e\u4e00\u4e2a\u590d\u5236\u4e8b\u4ef6\u7684\u65f6\u95f4\u6233\u4e0e\u4ece\u5c5e\u673a\u5668\u7684\u5b9e\u65f6\u4e4b\u95f4\u7684\u79d2\u6570\u3002\u7531\u4e8e MySQL \u590d\u5236\u7684\u673a\u5236\u662f\u6267\u884c\u4e3b\u670d\u52a1\u5668\u4f20\u8f93\u8fc7\u6765\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684\u6bcf\u4e2a\u8bed\u53e5\u901a\u8fc7\u8bbe\u7f6e\u65f6\u95f4\u6233\u6765\u4fdd\u8bc1\u6267\u884c\u65f6\u95f4\u548c\u987a\u5e8f\u7684\u6b63\u786e\u6027\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8bed\u53e5\u6267\u884c\u4e4b\u524d\u90fd\u4f1a\u9996\u5148\u8bbe\u7f6e\u65f6\u95f4\u6233\uff0c\u800c\u901a\u8fc7\u67e5\u8be2\u8fd9\u4e2a\u8fdb\u7a0b\u7684Time \u5c31\u53ef\u4ee5\u77e5\u9053\u6700\u540e\u8bbe\u7f6e\u7684\u65f6\u95f4\u6233\u548c\u5f53\u524d\u65f6\u95f4\u7684\u5dee\u8ddd\u3002","title":"6.6 \u67e5\u770b\u4ece\u670d\u52a1\u5668\u7684\u590d\u5236\u8fdb\u5ea6"},{"location":"mysql/36. MySQL \u590d\u5236/#67","text":"SHOW SLAVE STATUS \\G \u4e2d\u7684 Seconds_Behind_Master \u5b57\u6bb5\u8868\u793a\u9884\u4f30\u7684slave\u843d\u540emaster\u7684\u65f6\u95f4\u3002","title":"6.7 \u63d0\u9ad8\u590d\u5236\u6027\u80fd"},{"location":"mysql/36. MySQL \u590d\u5236/#671","text":"\u901a\u8fc7\u62c6\u5206\u51cf\u5c11\u4e00\u4e2aslave\u4e0a\u9700\u8981\u540c\u6b65\u7684\u8868\u6765\u89e3\u51b3\u3002\u901a\u8fc7\u4e0a\u6587\u7684 \u6307\u5b9a\u590d\u5236\u7684\u6570\u636e\u5e93\u6216\u8868 \u7ae0\u8282\u7684\u9009\u9879\u6765\u6307\u5b9aslave\u590d\u5236\u7684\u8868\u5e76\u5206\u914d\u7ed9\u5176\u4ed6slave\uff0c\u51cf\u5c11slave\u9700\u8981\u5199\u5165\u7684\u6570\u636e\u3002 \u6b64\u65f6master\u7684IO\u548c\u7f51\u7edc\u538b\u529b\u53ef\u80fd\u4f1a\u589e\u5927\uff0c\u53ef\u901a\u8fc7\u4e0a\u6587\u7684 \u53cc\u4e3b\u590d\u5236\u67b6\u6784 \u6765\u7ee7\u7eed\u4f18\u5316\u3002 \u4f18\u70b9\uff1a\u81ea\u7531\u62c6\u5206\u4ece\u5e93\u3002 \u7f3a\u70b9\uff1a\u7ef4\u62a4\u9ebb\u70e6\uff0cmaster\u5b95\u673a\u65f6\u5904\u7406\u9ebb\u70e6\u3002","title":"6.7.1 \u65b9\u6848\u4e00"},{"location":"mysql/36. MySQL \u590d\u5236/#672","text":"\u5728\u4ece\u5e93\u590d\u5236\u65f6 \u542f\u52a8\u591a\u4e2aSQL\u7ebf\u7a0b \u5728\u4ece\u5e93\u4e0a\u542f\u7528\u591a\u7ebf\u7a0b\uff0c\u5e76\u8bbe\u7f6e\u4ece\u5e93\u5e94\u7528\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u4ee5\u4fbf\u5e76\u884c\u6267\u884c\u590d\u5236\u4e8b\u52a1\u3002 mysql > SHOW VARIABLES LIKE \"%WORKERS\" ; +------------------------+-------+ | Variable_name | Value | +------------------------+-------+ | slave_parallel_workers | 0 | +------------------------+-------+ mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 4 | system user | | NULL | Connect | 2482 | Waiting for master to send event | NULL | | 5 | system user | | NULL | Query | 2421 | Slave has read all relay log ; waiting for more updates | NULL | | 6 | event_scheduler | localhost | NULL | Daemon | 2482 | Waiting on empty queue | NULL | | 10 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ -- \u53ef\u4ee5\u5728 my.cnf \u4e2d\u914d\u7f6e mysql > SET GLOBAL slave_parallel_workers = 2 ; -- \u4fee\u6539\u4e0d\u4f1a\u7acb\u5373\u751f\u6548\uff0c\u91cd\u542f\u590d\u5236\u7ebf\u7a0b\u4e4b\u540e\u751f\u6548 mysql > stop slave ; mysql > start slave ; mysql > SHOW PROCESSLIST ; +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | Id | User | Host | db | Command | Time | State | Info | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+ | 6 | event_scheduler | localhost | NULL | Daemon | 2678 | Waiting on empty queue | NULL | | 10 | root | localhost | blog | Query | 0 | starting | SHOW PROCESSLIST | | 12 | system user | | NULL | Connect | 38 | Waiting for master to send event | NULL | | 13 | system user | | NULL | Query | 38 | Slave has read all relay log ; waiting for more updates | NULL | | 14 | system user | | NULL | Connect | 38 | Waiting for an event from Coordinator | NULL | | 15 | system user | | NULL | Connect | 38 | Waiting for an event from Coordinator | NULL | +----+-----------------+-----------+------+---------+------+--------------------------------------------------------+------------------+","title":"6.7.2 \u65b9\u6848\u4e8c"},{"location":"mysql/36. MySQL \u590d\u5236/#7","text":"\u770b\u8fc7\u300a\u6df1\u5165\u6d45\u51faMySQL\u300b\u4e4b\u540e\u81ea\u5df1\u7684\u601d\u8def\uff0c\u4e0d\u4fdd\u8bc1\u6b63\u786e\u6027\uff01\uff01\uff01 \u9996\u5148\u4fdd\u8bc1\u6240\u6709slave\u7684\u4e2d\u7ee7\u65e5\u5fd7\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u7136\u540e\u5728\u6240\u6709slave\u4e0a\u505c\u6b62\u590d\u5236\u7ebf\u7a0b\uff0c\u5e76\u5c06\u5b8c\u6574\u7684\u6570\u636e\u540c\u6b65\u5230\u8be5slave\u4e0a\u9762\uff0c\u5728\u8981\u5207\u6362\u4e3amaster\u7684slave\u4e0a\u6267\u884c RESET MASTER \u91cd\u7f6emaster\uff08\u91cd\u7f6ebinlog\uff0c\u4f1a\u6e05\u7a7abinlog\u5e76\u5f00\u542f\u65b0\u7684binlog\uff09\uff0c\u6267\u884c RESET SLAVE \u91cd\u7f6eslave\uff08\u91cd\u7f6erelaylog\uff0c\u4f1a\u6e05\u7a7arelaylog\u5e76\u5f00\u542f\u65b0\u7684relaylog\uff09\uff0c\u5176\u4ed6\u7684slave\u5219\u901a\u8fc7 CHANGE MASTER TO \u91cd\u65b0\u8bbe\u7f6emaster\u4e3a\u8be5slave\u3002\u901a\u77e5\u6240\u6709\u7684\u5ba2\u6237\u7aef\u5c06\u5e94\u7528\u6307\u5411\u65b0\u7684master\u3002","title":"7. \u5207\u6362\u4e3b\u4ece\u670d\u52a1\u5668"},{"location":"mysql/37. MySQL Cluster/","text":"MySQL NDB Cluster\u662f\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u8ba1\u7b97\u73af\u5883\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u9ad8\u5197\u4f59\u7248\u672c\u7684MySQL\u3002 MySQL \u4f7f\u7528 NDB \u5b58\u50a8\u5f15\u64ce\uff08NDBCLUSTER\uff08\u4e5f\u79f0\u4e3aNDB\uff09\u662f\u4e00\u79cd\u5185\u5b58\u5b58\u50a8\u5f15\u64ce\uff0c\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\u548c\u6570\u636e\u6301\u4e45\u6027\u529f\u80fd\uff09\u6765\u5bf9\u6570\u636e\u8282\u70b9\u7684\u6570\u636e\u8fdb\u884c\u5b58\u50a8\u3002 MySQL Cluster \u901a\u8fc7\u6570\u636e\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u548c\u53ef\u6269\u5c55\u7684\u7cfb\u7edf\u67b6\u6784\uff0c\u53ef\u4ee5\u6ee1\u8db3\u66f4\u5927\u89c4\u6a21\u7684\u5e94\u7528\uff1b\u800c\u4e14\u901a\u8fc7\u5197\u4f59\u7b56\u7565\uff0c\u53ef\u4ee5\u5927\u5927\u5730\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u6570\u636e\u7684\u6709\u6548\u6027\u3002 MySQL Cluster \u6309\u7167\u8282\u70b9\u7c7b\u578b\u53ef\u4ee5\u5206\u4e3a 3 \u90e8\u5206 \uff1a \u7ba1\u7406\u8282\u70b9\u3002\u7ba1\u7406\u8282\u70b9\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u914d\u7f6e\u8981\u6c42\u4e0d\u9ad8\u3002 SQL\u8282\u70b9\u3002\u5e94\u7528\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u8282\u70b9\uff0c\u53ea\u80fd\u5148\u8bbf\u95eeSQL\u8282\u70b9\uff0c\u7136\u540eSQL\u8282\u70b9\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u8282\u70b9\u6765\u8fd4\u56de\u6570\u636e\u3002 \u6570\u636e\u8282\u70b9\u3002 1. \u5b89\u88c5 \u00b6 \u5b98\u7f51\u5feb\u901f\u5b89\u88c5\u6587\u6863 MySQL Server\u4e0d\u5305\u542bCLuster\u7248\u672c\uff0c\u9700\u8981\u4e0b\u8f7d\u989d\u5916\u7684\u5305\u3002 \u6ca1\u6709\u5fc5\u8981\u5728\u7ba1\u7406\u8282\u70b9\u4e3b\u673a\u548c\u6570\u636e\u8282\u70b9\u4e3b\u673a\u4e0a\u5b89\u88c5MySQL Server\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002SQL\u8282\u70b9\u4e0d\u80fd\u5b89\u88c5MySQL Server\uff0c\u4f1a\u76f8\u4e92\u51b2\u7a81\u3002\u5efa\u8bae\u5728\u7ba1\u7406\u670d\u52a1\u5668\u4e3b\u673a\u4e0a\u5b89\u88c5\u7ba1\u7406\u5ba2\u6237\u7aef\uff08ndb_mgm\uff09\u3002 yum update mysql80-community-release yum-config-manager --disable mysql80-community # \u53ef\u4ee5\u8bbf\u95ee\u7f51\u770b\u4e0b\u6709\u54ea\u4e9b\u4ed3\u5e93\uff1ahttps://repo.mysql.com/yum/ # \u4e5f\u53ef\u4ee5\u624b\u52a8\u7f16\u8f91 mysql-community.repo \u6587\u4ef6\u6253\u5f00\u4ed3\u5e93 yum-config-manager --enable mysql-cluster-8.0-community # \u5b89\u88c5\u7ba1\u7406\u8282\u70b9 yum install mysql-cluster-community-management-server # \u5b89\u88c5SQL\u8282\u70b9\uff0c\u5b8c\u6bd5\u4e4b\u540e\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u548c MySQL Server \u4e00\u6837\uff1ahttps://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/#repo-qg-starting-server # mysql\u521d\u59cb\u5316\u65f6\u4e0d\u80fd\u6709\u6587\u4ef6\u5728\u6587\u4ef6\u5939\u91cc\u9762 # \u6ce8\u610f\uff0c\u4e00\u5b9a\u4e0d\u80fd\u548c MySQL Server \u4e00\u8d77\u5b89\u88c5 yum install mysql-cluster-community-server # \u5b89\u88c5\u6570\u636e\u8282\u70b9 yum install mysql-cluster-community-data-node # \u5b89\u88c5\u7ba1\u7406\u5ba2\u6237\u7aef\uff08\u4e0eMySQL Server\u7684\u5ba2\u6237\u7aef\u51b2\u7a81\uff09 # \u5b89\u88c5SQL\u8282\u70b9\u65f6\u4f1a\u4f5c\u4e3a\u4f9d\u8d56\u5b89\u88c5 yum install mysql-cluster-community-client 2. \u914d\u7f6e \u00b6 \u5b98\u7f51\u6700\u7b80\u914d\u7f6e\u6587\u6863 \u8282\u70b9 IP \u7ba1\u7406\u8282\u70b9 192.168.17.10 SQL\u8282\u70b9 192.168.17.12 192.168.17.13 \u6570\u636e\u8282\u70b9 192.168.17.12 192.168.17.13 \u672a\u8fde\u63a5\u5230NDB\u96c6\u7fa4\u7684MySQL\u670d\u52a1\u5668\u65e0\u6cd5\u4f7f\u7528NDB\u5b58\u50a8\u5f15\u64ce\uff0c\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u4efb\u4f55NDB\u96c6\u7fa4\u6570\u636e\u3002 2.1 SQL\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9 \u00b6 SQL\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9\u7684 my.cnf \u6587\u4ef6\u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u6761\u76ee\uff1a [ mysqld ] # Options for mysqld process: # \u867d\u7136\u8fd9\u91cc\u8bbe\u7f6e\u4e86NDB\u5b58\u50a8\u5f15\u64ce\uff0c\u4f46\u662f\u53ea\u6709\u662f\u7528NDB\u5b58\u50a8\u5f15\u64ce\u5b58\u50a8\u7684\u8868\u624d\u4f1a\u88ab\u540c\u6b65 ndbcluster # run NDB storage engine [ mysql_cluster ] # Options for NDB Cluster processes: ndb - connectstring = 198 . 168 . 17 . 10 # location of management server Note \u5f53\u4f60\u4f7f\u7528\u4e86\u4ee5\u4e0a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u53c2\u6570\u5f00\u542f\u4e86mysqld\u8fdb\u7a0b\u4e4b\u540e\uff0c\u5982\u679ccluster\u6ca1\u6709\u542f\u52a8\uff0c\u90a3\u4e48\u5c31\u4e0d\u80fd\u518d\u6267\u884c\u521b\u5efa\u8868\u548c\u4fee\u6539\u8868\u7684\u8bed\u53e5\u4e86\u3002 2.2 \u7ba1\u7406\u8282\u70b9 \u00b6 $ mkdir /var/lib/mysql-cluster $ cd /var/lib/mysql-cluster $ vi config.ini [ ndb_mgmd ] # Management process options: HostName = 192 .168.17.10 # Hostname or IP address of MGM node DataDir = /var/lib/mysql-cluster # Directory for MGM node log files [ ndbd default ] # Options affecting ndbd processes on all data nodes: NoOfReplicas = 2 # Number of replicas DataMemory = 100M # How much memory to allocate for data storage [ ndbd ] # Options for data node \"A\": # (one [ndbd] section per data node) HostName = 192 .168.17.12 # Hostname or IP address NodeId = 2 # Node ID for this data node # \u9700\u8981\u5728\u6570\u636e\u8282\u70b9\u4e0a\u81ea\u884c\u521b\u5efa DataDir = /var/lib/mysql/data # Directory for this data node's data files [ ndbd ] # Options for data node \"B\": HostName = 192 .168.17.13 # Hostname or IP address NodeId = 3 # Node ID for this data node DataDir = /var/lib/mysql/data # Directory for this data node's data files [ mysqld ] # SQL node options: HostName = 192 .168.17.12 # Hostname or IP address # (additional mysqld connections can be # specified for this node for various # purposes such as running ndb_restore) [ mysqld ] HostName = 192 .168.17.13 # \u7559\u4e00\u4e2a\u7f6e\u7a7a\uff0c\u8fd9\u6837\u53ef\u4ee5\u4e3aSQL\u8282\u70b9\u7ee7\u7eed\u5206\u914dNodeId [ mysqld ] HostName = 3. \u542f\u52a8\u4e0e\u5173\u95ed \u00b6 3.1 \u542f\u52a8 \u00b6 \u670d\u52a1\u7684\u542f\u52a8\u987a\u5e8f\u5f88\u91cd\u8981 \uff0c\u9996\u5148\u542f\u52a8\u7ba1\u7406\u8282\u70b9\uff0c\u770b\u5230\u65e5\u5fd7\u542f\u52a8\u5b8c\u6bd5\u4e4b\u540e\u518d\u542f\u52a8\u6570\u636e\u8282\u70b9\u3002\u770b\u5230\u65e5\u5fd7\u4e2d\u6570\u636e\u8282\u70b9\u51c6\u5907\u548cSQL\u8282\u70b9\u901a\u4fe1\u4e4b\u540e\u518d\u542f\u52a8SQL\u8282\u70b9\uff08\u6216\u8005\u91cd\u542fmysqld\uff0c\u4efb\u610f\u987a\u5e8f\u542f\u52a8\u90fd\u53ef\uff09\u3002 \u5b89\u88c5\u5e76\u914d\u7f6e\u5b8c\u4e09\u4e2a\u8282\u70b9\u4e4b\u540e\uff0cSQL\u8282\u70b9\u8981\u521d\u59cb\u5316\uff0c\u7136\u540e\u5728\u7ba1\u7406\u8282\u70b9\uff08\u5173\u95ed\u9632\u706b\u5899\uff0cfixme\uff09\u542f\u52a8cluster\uff1a # \u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u65f6\u9700\u8981\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u53ca\u521d\u59cb\u5316\u9009\u9879\uff0c\u4ee5\u540e\u518d\u542f\u52a8\u65f6\u65e0\u9700\u6307\u5b9a\u4e86 $ ndb_mgmd --initial -f /var/lib/mysql-cluster/config.ini \u5728\u6bcf\u4e2a\u6570\u636e\u8282\u70b9\u8fd0\u884c\uff1a # \u9700\u8981\u5173\u95ed\u9632\u706b\u5899\uff0c\u5426\u5219\u8282\u70b9\u4f1a\u4e00\u76f4\u5c1d\u8bd5\u4e92\u76f8\u8fde\u63a5\u5bf9\u65b9 $ ndbd \u5728\u6bcf\u4e2aSQL\u8282\u70b9\u8fd0\u884c\uff1a # \u9700\u8981\u5173\u95ed\u9632\u706b\u5899 $ systemctl start mysqld \u5728\u7ba1\u7406\u5ba2\u6237\u7aef\u4e0a\u67e5\u770b\u662f\u5426\u542f\u52a8\u6210\u529f $ ndb_mgm Connected to Management Server at: 192 .168.17.10:1186 Cluster Configuration --------------------- [ ndbd ( NDB )] 2 node ( s ) id = 2 @192.168.17.12 ( mysql-8.0.17 ndb-8.0.17, Nodegroup: 0 , * ) id = 3 @192.168.17.13 ( mysql-8.0.17 ndb-8.0.17, Nodegroup: 0 ) [ ndb_mgmd ( MGM )] 1 node ( s ) id = 1 @192.168.17.10 ( mysql-8.0.17 ndb-8.0.17 ) [ mysqld ( API )] 1 node ( s ) id = 4 @192.168.17.12 ( mysql-8.0.17 ndb-8.0.17 ) id = 5 @192.168.17.13 ( mysql-8.0.17 ndb-8.0.17 ) \u5f88\u6709\u53ef\u80fd\u770b\u5230SQL\u8282\u70b9\u672a\u8fde\u63a5\u7684\u9519\u8bef\uff1a id=4 (not connected, accepting connect from xxx) \uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u5173\u95edSQL\u8282\u70b9\u7684selinux\uff1a setenforce 0 \uff08\u4e34\u65f6\u751f\u6548\uff09\uff0c\u6216\u8005\u7f16\u8f91 /etc/selinux/config \u6587\u4ef6\uff08\u91cd\u542f\u751f\u6548\uff09\u3002\u5173\u95ed\u4e4b\u540e\u5c31\u53ef\u4ee5\u770b\u7684\u65e5\u5fd7\u4e2d\u7684node 4\u8fde\u63a5\u4e0a\u4e86\u3002 3.2 \u5173\u95ed \u00b6 ndb_mgm> SHUTDOWN \u6216 $ ndb_mgm -e SHUTDOWN 4. \u7ef4\u62a4 \u00b6 4.1 \u6570\u636e\u5907\u4efd \u00b6 4.1.1 \u903b\u8f91\u5907\u4efd \u00b6 \u4f7f\u7528 mysqldump \u8fdb\u884c\u903b\u8f91\u5907\u4efd\u540c\u6837\u9002\u7528\u4e8ecluster\u3002\u53c2\u8003 32. MySQL\u5907\u4efd\u4e0e\u6062\u590d 4.1.2 \u7269\u7406\u5907\u4efd \u00b6 \u542f\u52a8\u7ba1\u7406\u63a7\u5236\u53f0\uff0c\u6267\u884c\u5907\u4efd\u547d\u4ee4\uff1a # \u7b2c\u4e00\u6b21\u5907\u4efd ndb_mgm > START BACKUP WAIT COMPLETED Waiting for completed , this may take several minutes Node 2 : Backup 1 started from node 1 Node 2 : Backup 1 started from node 1 completed StartGCP : 1761 StopGCP : 1764 #Records: 2060 #LogRecords: 0 Data : 51672 bytes Log : 0 bytes # \u7b2c\u4e8c\u6b21\u5907\u4efd ndb_mgm > START BACKUP WAIT COMPLETED Waiting for completed , this may take several minutes Node 2 : Backup 2 started from node 1 Node 2 : Backup 2 started from node 1 completed StartGCP : 1826 StopGCP : 1829 #Records: 2060 #LogRecords: 0 Data : 51672 bytes Log : 0 bytes Backup\u4f1a\u968f\u7740\u5907\u4efd\u6b21\u6570\u800c\u53d1\u751f\u53d8\u5316\u3002\u5907\u4efd\u6570\u636e\u4fdd\u5b58\u5728\u6bcf\u4e2a\u6570\u636e\u8282\u70b9\u4e0a\u9762\uff0c\u8def\u5f84\u662f\u5728\u7ba1\u7406\u8282\u70b9\u7684\u914d\u7f6e\u6587\u4ef6 config.ini \u4e2d\u6307\u5b9a\u7684\uff1a [ ndbd ] # Options for data node \"A\": ...... DataDir =/ var / lib / mysql / data / # Directory for this data node's data files [ root@centos7 data ] # pwd /var/lib/mysql/data [ root@centos7 data ] # tree BACKUP/ BACKUP/ \u251c\u2500\u2500 BACKUP-1 \u2502 \u251c\u2500\u2500 BACKUP-1-0.2.Data \u2502 \u251c\u2500\u2500 BACKUP-1.2.ctl \u2502 \u2514\u2500\u2500 BACKUP-1.2.log \u2514\u2500\u2500 BACKUP-2 \u251c\u2500\u2500 BACKUP-2-0.2.Data \u251c\u2500\u2500 BACKUP-2.2.ctl \u2514\u2500\u2500 BACKUP-2.2.log 2 directories, 6 files \u5bf9\u4e8e\u5927\u6570\u636e\u91cf\u7684\u5907\u4efd\uff0cMySQL Cluster \u8fd8\u63d0\u4f9b\u4e86\u51e0\u4e2a\u5907\u4efd\u7684\u53c2\u6570\u53ef\u4f9b\u8c03\u6574\uff08\u5728 [ndbd] \u6216 [ndbd default] \u4e2d\u914d\u7f6e\uff09\uff1a BackupDataBufferSize\uff1a\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u4e4b\u524d\u7528\u4e8e\u5bf9\u6570\u636e\u8fdb\u884c\u7f13\u51b2\u5904\u7406\u7684\u5185\u5b58\u91cf\u3002 BackupLogBufferSize\uff1a \u5c06\u65e5\u5fd7\u8bb0\u5f55\u5199\u5165\u78c1\u76d8\u4e4b\u524d\u7528\u4e8e\u5bf9\u5176\u8fdb\u884c\u7f13\u51b2\u5904\u7406\u7684\u5185\u5b58\u91cf\u3002 BackupMemory\uff1a\u5728\u6570\u636e\u8282\u70b9\u4e2d\u4e3a\u5907\u4efd\u5206\u914d\u7684\u603b\u5185\u5b58\u3002\u5b83\u5e94\u662f\u5206\u914d\u7ed9\u5907\u4efd\u6570\u636e\u7f13\u51b2\u7684\u5185\u5b58\u548c\u5206\u914d\u7ed9\u5907\u4efd\u65e5\u5fd7\u7f13\u51b2\u7684\u5185\u5b58\u4e4b\u548c\u3002 BackupWriteSize\uff1a\u6bcf\u6b21\u5199\u5165\u78c1\u76d8\u7684\u5757\u5927\u5c0f\uff0c\u9002\u7528\u4e8e\u5907\u4efd\u6570\u636e\u7f13\u51b2\u548c\u5907\u4efd\u65e5\u5fd7\u7f13\u51b2\u3002 BackupMaxWriteSize \uff1a\u6bcf\u6b21\u6700\u5927\u5199\u5165\u78c1\u76d8\u7684\u5757\u5927\u5c0f\uff0c\u9002\u7528\u8303\u56f4\u540c\u4e0a\u3002 \u8be6\u7ec6\u7684\u8bf4\u660e\u53c2\u8003\uff1ahttps://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-ndbd-definition.html#mysql-cluster-backup-parameters 4.1.3 \u6570\u636e\u6062\u590d \u00b6 \u4f7f\u7528 START BACKUP \u5907\u4efd\u7684\u6570\u636e\u5fc5\u987b\u4f7f\u7528 ndb_restore \u5de5\u5177\u6062\u590d\u3002 \u9996\u5148\uff0c\u5728\u7ba1\u7406\u8282\u70b9\u7684 config.ini \u4e2d\u5fc5\u987b\u5b58\u5728\u4ee5\u4e0b\u7f6e\u7a7a\u8282\u70b9\uff0c\u5426\u5219\u5907\u4efd\u7ba1\u7406\u8282\u70b9\u65e0\u6cd5\u4e3aSQL\u8282\u70b9\u5206\u914dNodeId\uff0c\u5bfc\u81f4\u6062\u590d\u5931\u8d25\uff1a [ mysqld ] HostName = \u5f00\u59cb\u5b9e\u8df5\u6b65\u9aa4\uff1a 1.\u5220\u9664\u8868\uff0c\u6a21\u62df\u6570\u636e\u7834\u574f\uff1a mysql > DROP TABLE t1 ; 2.\u5728\u4e00\u4e2aSQL\u8282\u70b9\u4e0a\u8fd0\u884c ndb_restore \uff0c\u8fd9\u91cc\u9009\u62e9\u3010node 3, 192.168.17.13\u3011\uff1a [ root@centos7 data ] # ndb_restore -n 3 -b 3 -r -m --backup_path=BACKUP/BACKUP-3 -n\uff1a\u6307\u5b9a\u8282\u70b9id\uff0c\u5fc5\u987b\u662f\u672c\u8282\u70b9id -b\uff1a\u5907\u4efd\u6587\u4ef6\u7684id\uff0c\u5373BACKUP-ID -r\uff1a\u6062\u590d table data/logs into NDB Cluster using NDBAPI -m\uff1a\u6062\u590d\u8868\u7684\u5b9a\u4e49\u3002\u8868\u7684\u5b9a\u4e49\u6062\u590d\u4e4b\u540e\u518d\u591a\u6b21\u8fd0\u884c\u8be5\u5de5\u5177\u65f6\u4e0d\u53ef\u518d\u6b21\u6dfb\u52a0\u8be5\u9009\u9879\uff0c\u5426\u5219\u4f1a\u62a5\u9519 --backup_path\uff1a\u5907\u4efd\u6587\u4ef6\u7684\u8def\u5f84 3.\u67e5\u770b\u662f\u5426\u6062\u590d\uff1a # \u5f00\u59cb\u65f6\u4e0d\u4f1a\u67e5\u8be2\u5230\u8868\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\"SHOW TABLES\"\u8fd8\u662f\u67e5\u8be2\u4e0d\u5230\u7684\uff0c\u4f46\u76f4\u63a5\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u540e\u5c31\u53ef\u67e5\u5230\u4e86 mysql > select * from t1 ; +----+ | id | +----+ | 1 | +----+ 4.2 \u65e5\u5fd7\u7ba1\u7406 \u00b6 \u5584\u7528 ndb_mgm \uff0c\u67e5\u770b\u4f7f\u7528\u8bf4\u660e\uff0c\u5176\u4e2d\u6709\u65e5\u5fd7\u76f8\u5173\u9009\u9879\u3002 ndb_mgm> ? --------------------------------------------------------------------------- NDB Cluster -- Management Client -- Help --------------------------------------------------------------------------- HELP Print help text HELP COMMAND Print detailed help for COMMAND ( e.g. SHOW ) SHOW Print information about cluster CREATE NODEGROUP <id>,<id>... Add a Nodegroup containing nodes DROP NODEGROUP <NG> Drop nodegroup with id NG START BACKUP [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] START BACKUP [ <backup id> ] [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] START BACKUP [ <backup id> ] [ SNAPSHOTSTART | SNAPSHOTEND ] [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] Start backup ( default WAIT COMPLETED,SNAPSHOTEND ) ABORT BACKUP <backup id> Abort backup SHUTDOWN Shutdown all processes in cluster PROMPT [ <prompt-string> ] Toggle the prompt between string specified or default prompt if no string specified # \u6253\u5f00\u65e5\u5fd7 CLUSTERLOG ON [ <severity> ] ... Enable Cluster logging CLUSTERLOG OFF [ <severity> ] ... Disable Cluster logging # \u5207\u6362\u65e5\u5fd7\u4e25\u91cd\u6027\u8fc7\u6ee4\u7684\u5f00\u5173 CLUSTERLOG TOGGLE [ <severity> ] ... Toggle severity filter on/off # \u67e5\u770b\u54ea\u4e9b\u65e5\u5fd7\u4f1a\u88ab\u8bb0\u5f55 CLUSTERLOG INFO Print cluster log information <id> START Start data node ( started with -n ) <id> RESTART [ -n ] [ -i ] [ -a ] [ -f ] Restart data or management server node <id> STOP [ -a ] [ -f ] Stop data or management server node <id> NODELOG DEBUG ON Enable Debug logging in node log <id> NODELOG DEBUG OFF Disable Debug logging in node log ENTER SINGLE USER MODE <id> Enter single user mode EXIT SINGLE USER MODE Exit single user mode <id> STATUS Print status # \u8bb0\u5f55\u5c0f\u4e8e\u7b49\u4e8elevel\u4f18\u5148\u7ea7\u7684category\u7684\u65e5\u5fd7 <id> CLUSTERLOG { <category> = <level> } + Set log level for cluster log PURGE STALE SESSIONS Reset reserved nodeid ' s in the mgmt server CONNECT [ <connectstring> ] Connect to management server ( reconnect if already connected ) <id> REPORT <report-type> Display report for <report-type> QUIT Quit management client <severity> = ALERT | CRITICAL | ERROR | WARNING | INFO | DEBUG <category> = STARTUP | SHUTDOWN | STATISTICS | CHECKPOINT | NODERESTART | CONNECTION | INFO | ERROR | CONGESTION | DEBUG | BACKUP | SCHEMA <report-type> = BACKUPSTATUS | MEMORYUSAGE | EVENTLOG # \u6700\u91cd\u8981 - \u6700\u4e0d\u91cd\u8981 <level> = 0 - 15 <id> = ALL | Any database node id For detailed help on COMMAND, use HELP COMMAND.","title":"37. MySQL Cluster"},{"location":"mysql/37. MySQL Cluster/#1","text":"\u5b98\u7f51\u5feb\u901f\u5b89\u88c5\u6587\u6863 MySQL Server\u4e0d\u5305\u542bCLuster\u7248\u672c\uff0c\u9700\u8981\u4e0b\u8f7d\u989d\u5916\u7684\u5305\u3002 \u6ca1\u6709\u5fc5\u8981\u5728\u7ba1\u7406\u8282\u70b9\u4e3b\u673a\u548c\u6570\u636e\u8282\u70b9\u4e3b\u673a\u4e0a\u5b89\u88c5MySQL Server\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002SQL\u8282\u70b9\u4e0d\u80fd\u5b89\u88c5MySQL Server\uff0c\u4f1a\u76f8\u4e92\u51b2\u7a81\u3002\u5efa\u8bae\u5728\u7ba1\u7406\u670d\u52a1\u5668\u4e3b\u673a\u4e0a\u5b89\u88c5\u7ba1\u7406\u5ba2\u6237\u7aef\uff08ndb_mgm\uff09\u3002 yum update mysql80-community-release yum-config-manager --disable mysql80-community # \u53ef\u4ee5\u8bbf\u95ee\u7f51\u770b\u4e0b\u6709\u54ea\u4e9b\u4ed3\u5e93\uff1ahttps://repo.mysql.com/yum/ # \u4e5f\u53ef\u4ee5\u624b\u52a8\u7f16\u8f91 mysql-community.repo \u6587\u4ef6\u6253\u5f00\u4ed3\u5e93 yum-config-manager --enable mysql-cluster-8.0-community # \u5b89\u88c5\u7ba1\u7406\u8282\u70b9 yum install mysql-cluster-community-management-server # \u5b89\u88c5SQL\u8282\u70b9\uff0c\u5b8c\u6bd5\u4e4b\u540e\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u548c MySQL Server \u4e00\u6837\uff1ahttps://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/#repo-qg-starting-server # mysql\u521d\u59cb\u5316\u65f6\u4e0d\u80fd\u6709\u6587\u4ef6\u5728\u6587\u4ef6\u5939\u91cc\u9762 # \u6ce8\u610f\uff0c\u4e00\u5b9a\u4e0d\u80fd\u548c MySQL Server \u4e00\u8d77\u5b89\u88c5 yum install mysql-cluster-community-server # \u5b89\u88c5\u6570\u636e\u8282\u70b9 yum install mysql-cluster-community-data-node # \u5b89\u88c5\u7ba1\u7406\u5ba2\u6237\u7aef\uff08\u4e0eMySQL Server\u7684\u5ba2\u6237\u7aef\u51b2\u7a81\uff09 # \u5b89\u88c5SQL\u8282\u70b9\u65f6\u4f1a\u4f5c\u4e3a\u4f9d\u8d56\u5b89\u88c5 yum install mysql-cluster-community-client","title":"1. \u5b89\u88c5"},{"location":"mysql/37. MySQL Cluster/#2","text":"\u5b98\u7f51\u6700\u7b80\u914d\u7f6e\u6587\u6863 \u8282\u70b9 IP \u7ba1\u7406\u8282\u70b9 192.168.17.10 SQL\u8282\u70b9 192.168.17.12 192.168.17.13 \u6570\u636e\u8282\u70b9 192.168.17.12 192.168.17.13 \u672a\u8fde\u63a5\u5230NDB\u96c6\u7fa4\u7684MySQL\u670d\u52a1\u5668\u65e0\u6cd5\u4f7f\u7528NDB\u5b58\u50a8\u5f15\u64ce\uff0c\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u4efb\u4f55NDB\u96c6\u7fa4\u6570\u636e\u3002","title":"2. \u914d\u7f6e"},{"location":"mysql/37. MySQL Cluster/#21-sql","text":"SQL\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9\u7684 my.cnf \u6587\u4ef6\u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u6761\u76ee\uff1a [ mysqld ] # Options for mysqld process: # \u867d\u7136\u8fd9\u91cc\u8bbe\u7f6e\u4e86NDB\u5b58\u50a8\u5f15\u64ce\uff0c\u4f46\u662f\u53ea\u6709\u662f\u7528NDB\u5b58\u50a8\u5f15\u64ce\u5b58\u50a8\u7684\u8868\u624d\u4f1a\u88ab\u540c\u6b65 ndbcluster # run NDB storage engine [ mysql_cluster ] # Options for NDB Cluster processes: ndb - connectstring = 198 . 168 . 17 . 10 # location of management server Note \u5f53\u4f60\u4f7f\u7528\u4e86\u4ee5\u4e0a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u53c2\u6570\u5f00\u542f\u4e86mysqld\u8fdb\u7a0b\u4e4b\u540e\uff0c\u5982\u679ccluster\u6ca1\u6709\u542f\u52a8\uff0c\u90a3\u4e48\u5c31\u4e0d\u80fd\u518d\u6267\u884c\u521b\u5efa\u8868\u548c\u4fee\u6539\u8868\u7684\u8bed\u53e5\u4e86\u3002","title":"2.1 SQL\u8282\u70b9\u548c\u6570\u636e\u8282\u70b9"},{"location":"mysql/37. MySQL Cluster/#22","text":"$ mkdir /var/lib/mysql-cluster $ cd /var/lib/mysql-cluster $ vi config.ini [ ndb_mgmd ] # Management process options: HostName = 192 .168.17.10 # Hostname or IP address of MGM node DataDir = /var/lib/mysql-cluster # Directory for MGM node log files [ ndbd default ] # Options affecting ndbd processes on all data nodes: NoOfReplicas = 2 # Number of replicas DataMemory = 100M # How much memory to allocate for data storage [ ndbd ] # Options for data node \"A\": # (one [ndbd] section per data node) HostName = 192 .168.17.12 # Hostname or IP address NodeId = 2 # Node ID for this data node # \u9700\u8981\u5728\u6570\u636e\u8282\u70b9\u4e0a\u81ea\u884c\u521b\u5efa DataDir = /var/lib/mysql/data # Directory for this data node's data files [ ndbd ] # Options for data node \"B\": HostName = 192 .168.17.13 # Hostname or IP address NodeId = 3 # Node ID for this data node DataDir = /var/lib/mysql/data # Directory for this data node's data files [ mysqld ] # SQL node options: HostName = 192 .168.17.12 # Hostname or IP address # (additional mysqld connections can be # specified for this node for various # purposes such as running ndb_restore) [ mysqld ] HostName = 192 .168.17.13 # \u7559\u4e00\u4e2a\u7f6e\u7a7a\uff0c\u8fd9\u6837\u53ef\u4ee5\u4e3aSQL\u8282\u70b9\u7ee7\u7eed\u5206\u914dNodeId [ mysqld ] HostName =","title":"2.2 \u7ba1\u7406\u8282\u70b9"},{"location":"mysql/37. MySQL Cluster/#3","text":"","title":"3. \u542f\u52a8\u4e0e\u5173\u95ed"},{"location":"mysql/37. MySQL Cluster/#31","text":"\u670d\u52a1\u7684\u542f\u52a8\u987a\u5e8f\u5f88\u91cd\u8981 \uff0c\u9996\u5148\u542f\u52a8\u7ba1\u7406\u8282\u70b9\uff0c\u770b\u5230\u65e5\u5fd7\u542f\u52a8\u5b8c\u6bd5\u4e4b\u540e\u518d\u542f\u52a8\u6570\u636e\u8282\u70b9\u3002\u770b\u5230\u65e5\u5fd7\u4e2d\u6570\u636e\u8282\u70b9\u51c6\u5907\u548cSQL\u8282\u70b9\u901a\u4fe1\u4e4b\u540e\u518d\u542f\u52a8SQL\u8282\u70b9\uff08\u6216\u8005\u91cd\u542fmysqld\uff0c\u4efb\u610f\u987a\u5e8f\u542f\u52a8\u90fd\u53ef\uff09\u3002 \u5b89\u88c5\u5e76\u914d\u7f6e\u5b8c\u4e09\u4e2a\u8282\u70b9\u4e4b\u540e\uff0cSQL\u8282\u70b9\u8981\u521d\u59cb\u5316\uff0c\u7136\u540e\u5728\u7ba1\u7406\u8282\u70b9\uff08\u5173\u95ed\u9632\u706b\u5899\uff0cfixme\uff09\u542f\u52a8cluster\uff1a # \u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u65f6\u9700\u8981\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u53ca\u521d\u59cb\u5316\u9009\u9879\uff0c\u4ee5\u540e\u518d\u542f\u52a8\u65f6\u65e0\u9700\u6307\u5b9a\u4e86 $ ndb_mgmd --initial -f /var/lib/mysql-cluster/config.ini \u5728\u6bcf\u4e2a\u6570\u636e\u8282\u70b9\u8fd0\u884c\uff1a # \u9700\u8981\u5173\u95ed\u9632\u706b\u5899\uff0c\u5426\u5219\u8282\u70b9\u4f1a\u4e00\u76f4\u5c1d\u8bd5\u4e92\u76f8\u8fde\u63a5\u5bf9\u65b9 $ ndbd \u5728\u6bcf\u4e2aSQL\u8282\u70b9\u8fd0\u884c\uff1a # \u9700\u8981\u5173\u95ed\u9632\u706b\u5899 $ systemctl start mysqld \u5728\u7ba1\u7406\u5ba2\u6237\u7aef\u4e0a\u67e5\u770b\u662f\u5426\u542f\u52a8\u6210\u529f $ ndb_mgm Connected to Management Server at: 192 .168.17.10:1186 Cluster Configuration --------------------- [ ndbd ( NDB )] 2 node ( s ) id = 2 @192.168.17.12 ( mysql-8.0.17 ndb-8.0.17, Nodegroup: 0 , * ) id = 3 @192.168.17.13 ( mysql-8.0.17 ndb-8.0.17, Nodegroup: 0 ) [ ndb_mgmd ( MGM )] 1 node ( s ) id = 1 @192.168.17.10 ( mysql-8.0.17 ndb-8.0.17 ) [ mysqld ( API )] 1 node ( s ) id = 4 @192.168.17.12 ( mysql-8.0.17 ndb-8.0.17 ) id = 5 @192.168.17.13 ( mysql-8.0.17 ndb-8.0.17 ) \u5f88\u6709\u53ef\u80fd\u770b\u5230SQL\u8282\u70b9\u672a\u8fde\u63a5\u7684\u9519\u8bef\uff1a id=4 (not connected, accepting connect from xxx) \uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u5173\u95edSQL\u8282\u70b9\u7684selinux\uff1a setenforce 0 \uff08\u4e34\u65f6\u751f\u6548\uff09\uff0c\u6216\u8005\u7f16\u8f91 /etc/selinux/config \u6587\u4ef6\uff08\u91cd\u542f\u751f\u6548\uff09\u3002\u5173\u95ed\u4e4b\u540e\u5c31\u53ef\u4ee5\u770b\u7684\u65e5\u5fd7\u4e2d\u7684node 4\u8fde\u63a5\u4e0a\u4e86\u3002","title":"3.1 \u542f\u52a8"},{"location":"mysql/37. MySQL Cluster/#32","text":"ndb_mgm> SHUTDOWN \u6216 $ ndb_mgm -e SHUTDOWN","title":"3.2 \u5173\u95ed"},{"location":"mysql/37. MySQL Cluster/#4","text":"","title":"4. \u7ef4\u62a4"},{"location":"mysql/37. MySQL Cluster/#41","text":"","title":"4.1 \u6570\u636e\u5907\u4efd"},{"location":"mysql/37. MySQL Cluster/#411","text":"\u4f7f\u7528 mysqldump \u8fdb\u884c\u903b\u8f91\u5907\u4efd\u540c\u6837\u9002\u7528\u4e8ecluster\u3002\u53c2\u8003 32. MySQL\u5907\u4efd\u4e0e\u6062\u590d","title":"4.1.1 \u903b\u8f91\u5907\u4efd"},{"location":"mysql/37. MySQL Cluster/#412","text":"\u542f\u52a8\u7ba1\u7406\u63a7\u5236\u53f0\uff0c\u6267\u884c\u5907\u4efd\u547d\u4ee4\uff1a # \u7b2c\u4e00\u6b21\u5907\u4efd ndb_mgm > START BACKUP WAIT COMPLETED Waiting for completed , this may take several minutes Node 2 : Backup 1 started from node 1 Node 2 : Backup 1 started from node 1 completed StartGCP : 1761 StopGCP : 1764 #Records: 2060 #LogRecords: 0 Data : 51672 bytes Log : 0 bytes # \u7b2c\u4e8c\u6b21\u5907\u4efd ndb_mgm > START BACKUP WAIT COMPLETED Waiting for completed , this may take several minutes Node 2 : Backup 2 started from node 1 Node 2 : Backup 2 started from node 1 completed StartGCP : 1826 StopGCP : 1829 #Records: 2060 #LogRecords: 0 Data : 51672 bytes Log : 0 bytes Backup\u4f1a\u968f\u7740\u5907\u4efd\u6b21\u6570\u800c\u53d1\u751f\u53d8\u5316\u3002\u5907\u4efd\u6570\u636e\u4fdd\u5b58\u5728\u6bcf\u4e2a\u6570\u636e\u8282\u70b9\u4e0a\u9762\uff0c\u8def\u5f84\u662f\u5728\u7ba1\u7406\u8282\u70b9\u7684\u914d\u7f6e\u6587\u4ef6 config.ini \u4e2d\u6307\u5b9a\u7684\uff1a [ ndbd ] # Options for data node \"A\": ...... DataDir =/ var / lib / mysql / data / # Directory for this data node's data files [ root@centos7 data ] # pwd /var/lib/mysql/data [ root@centos7 data ] # tree BACKUP/ BACKUP/ \u251c\u2500\u2500 BACKUP-1 \u2502 \u251c\u2500\u2500 BACKUP-1-0.2.Data \u2502 \u251c\u2500\u2500 BACKUP-1.2.ctl \u2502 \u2514\u2500\u2500 BACKUP-1.2.log \u2514\u2500\u2500 BACKUP-2 \u251c\u2500\u2500 BACKUP-2-0.2.Data \u251c\u2500\u2500 BACKUP-2.2.ctl \u2514\u2500\u2500 BACKUP-2.2.log 2 directories, 6 files \u5bf9\u4e8e\u5927\u6570\u636e\u91cf\u7684\u5907\u4efd\uff0cMySQL Cluster \u8fd8\u63d0\u4f9b\u4e86\u51e0\u4e2a\u5907\u4efd\u7684\u53c2\u6570\u53ef\u4f9b\u8c03\u6574\uff08\u5728 [ndbd] \u6216 [ndbd default] \u4e2d\u914d\u7f6e\uff09\uff1a BackupDataBufferSize\uff1a\u5c06\u6570\u636e\u5199\u5165\u78c1\u76d8\u4e4b\u524d\u7528\u4e8e\u5bf9\u6570\u636e\u8fdb\u884c\u7f13\u51b2\u5904\u7406\u7684\u5185\u5b58\u91cf\u3002 BackupLogBufferSize\uff1a \u5c06\u65e5\u5fd7\u8bb0\u5f55\u5199\u5165\u78c1\u76d8\u4e4b\u524d\u7528\u4e8e\u5bf9\u5176\u8fdb\u884c\u7f13\u51b2\u5904\u7406\u7684\u5185\u5b58\u91cf\u3002 BackupMemory\uff1a\u5728\u6570\u636e\u8282\u70b9\u4e2d\u4e3a\u5907\u4efd\u5206\u914d\u7684\u603b\u5185\u5b58\u3002\u5b83\u5e94\u662f\u5206\u914d\u7ed9\u5907\u4efd\u6570\u636e\u7f13\u51b2\u7684\u5185\u5b58\u548c\u5206\u914d\u7ed9\u5907\u4efd\u65e5\u5fd7\u7f13\u51b2\u7684\u5185\u5b58\u4e4b\u548c\u3002 BackupWriteSize\uff1a\u6bcf\u6b21\u5199\u5165\u78c1\u76d8\u7684\u5757\u5927\u5c0f\uff0c\u9002\u7528\u4e8e\u5907\u4efd\u6570\u636e\u7f13\u51b2\u548c\u5907\u4efd\u65e5\u5fd7\u7f13\u51b2\u3002 BackupMaxWriteSize \uff1a\u6bcf\u6b21\u6700\u5927\u5199\u5165\u78c1\u76d8\u7684\u5757\u5927\u5c0f\uff0c\u9002\u7528\u8303\u56f4\u540c\u4e0a\u3002 \u8be6\u7ec6\u7684\u8bf4\u660e\u53c2\u8003\uff1ahttps://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-ndbd-definition.html#mysql-cluster-backup-parameters","title":"4.1.2 \u7269\u7406\u5907\u4efd"},{"location":"mysql/37. MySQL Cluster/#413","text":"\u4f7f\u7528 START BACKUP \u5907\u4efd\u7684\u6570\u636e\u5fc5\u987b\u4f7f\u7528 ndb_restore \u5de5\u5177\u6062\u590d\u3002 \u9996\u5148\uff0c\u5728\u7ba1\u7406\u8282\u70b9\u7684 config.ini \u4e2d\u5fc5\u987b\u5b58\u5728\u4ee5\u4e0b\u7f6e\u7a7a\u8282\u70b9\uff0c\u5426\u5219\u5907\u4efd\u7ba1\u7406\u8282\u70b9\u65e0\u6cd5\u4e3aSQL\u8282\u70b9\u5206\u914dNodeId\uff0c\u5bfc\u81f4\u6062\u590d\u5931\u8d25\uff1a [ mysqld ] HostName = \u5f00\u59cb\u5b9e\u8df5\u6b65\u9aa4\uff1a 1.\u5220\u9664\u8868\uff0c\u6a21\u62df\u6570\u636e\u7834\u574f\uff1a mysql > DROP TABLE t1 ; 2.\u5728\u4e00\u4e2aSQL\u8282\u70b9\u4e0a\u8fd0\u884c ndb_restore \uff0c\u8fd9\u91cc\u9009\u62e9\u3010node 3, 192.168.17.13\u3011\uff1a [ root@centos7 data ] # ndb_restore -n 3 -b 3 -r -m --backup_path=BACKUP/BACKUP-3 -n\uff1a\u6307\u5b9a\u8282\u70b9id\uff0c\u5fc5\u987b\u662f\u672c\u8282\u70b9id -b\uff1a\u5907\u4efd\u6587\u4ef6\u7684id\uff0c\u5373BACKUP-ID -r\uff1a\u6062\u590d table data/logs into NDB Cluster using NDBAPI -m\uff1a\u6062\u590d\u8868\u7684\u5b9a\u4e49\u3002\u8868\u7684\u5b9a\u4e49\u6062\u590d\u4e4b\u540e\u518d\u591a\u6b21\u8fd0\u884c\u8be5\u5de5\u5177\u65f6\u4e0d\u53ef\u518d\u6b21\u6dfb\u52a0\u8be5\u9009\u9879\uff0c\u5426\u5219\u4f1a\u62a5\u9519 --backup_path\uff1a\u5907\u4efd\u6587\u4ef6\u7684\u8def\u5f84 3.\u67e5\u770b\u662f\u5426\u6062\u590d\uff1a # \u5f00\u59cb\u65f6\u4e0d\u4f1a\u67e5\u8be2\u5230\u8868\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\"SHOW TABLES\"\u8fd8\u662f\u67e5\u8be2\u4e0d\u5230\u7684\uff0c\u4f46\u76f4\u63a5\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u540e\u5c31\u53ef\u67e5\u5230\u4e86 mysql > select * from t1 ; +----+ | id | +----+ | 1 | +----+","title":"4.1.3 \u6570\u636e\u6062\u590d"},{"location":"mysql/37. MySQL Cluster/#42","text":"\u5584\u7528 ndb_mgm \uff0c\u67e5\u770b\u4f7f\u7528\u8bf4\u660e\uff0c\u5176\u4e2d\u6709\u65e5\u5fd7\u76f8\u5173\u9009\u9879\u3002 ndb_mgm> ? --------------------------------------------------------------------------- NDB Cluster -- Management Client -- Help --------------------------------------------------------------------------- HELP Print help text HELP COMMAND Print detailed help for COMMAND ( e.g. SHOW ) SHOW Print information about cluster CREATE NODEGROUP <id>,<id>... Add a Nodegroup containing nodes DROP NODEGROUP <NG> Drop nodegroup with id NG START BACKUP [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] START BACKUP [ <backup id> ] [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] START BACKUP [ <backup id> ] [ SNAPSHOTSTART | SNAPSHOTEND ] [ NOWAIT | WAIT STARTED | WAIT COMPLETED ] Start backup ( default WAIT COMPLETED,SNAPSHOTEND ) ABORT BACKUP <backup id> Abort backup SHUTDOWN Shutdown all processes in cluster PROMPT [ <prompt-string> ] Toggle the prompt between string specified or default prompt if no string specified # \u6253\u5f00\u65e5\u5fd7 CLUSTERLOG ON [ <severity> ] ... Enable Cluster logging CLUSTERLOG OFF [ <severity> ] ... Disable Cluster logging # \u5207\u6362\u65e5\u5fd7\u4e25\u91cd\u6027\u8fc7\u6ee4\u7684\u5f00\u5173 CLUSTERLOG TOGGLE [ <severity> ] ... Toggle severity filter on/off # \u67e5\u770b\u54ea\u4e9b\u65e5\u5fd7\u4f1a\u88ab\u8bb0\u5f55 CLUSTERLOG INFO Print cluster log information <id> START Start data node ( started with -n ) <id> RESTART [ -n ] [ -i ] [ -a ] [ -f ] Restart data or management server node <id> STOP [ -a ] [ -f ] Stop data or management server node <id> NODELOG DEBUG ON Enable Debug logging in node log <id> NODELOG DEBUG OFF Disable Debug logging in node log ENTER SINGLE USER MODE <id> Enter single user mode EXIT SINGLE USER MODE Exit single user mode <id> STATUS Print status # \u8bb0\u5f55\u5c0f\u4e8e\u7b49\u4e8elevel\u4f18\u5148\u7ea7\u7684category\u7684\u65e5\u5fd7 <id> CLUSTERLOG { <category> = <level> } + Set log level for cluster log PURGE STALE SESSIONS Reset reserved nodeid ' s in the mgmt server CONNECT [ <connectstring> ] Connect to management server ( reconnect if already connected ) <id> REPORT <report-type> Display report for <report-type> QUIT Quit management client <severity> = ALERT | CRITICAL | ERROR | WARNING | INFO | DEBUG <category> = STARTUP | SHUTDOWN | STATISTICS | CHECKPOINT | NODERESTART | CONNECTION | INFO | ERROR | CONGESTION | DEBUG | BACKUP | SCHEMA <report-type> = BACKUPSTATUS | MEMORYUSAGE | EVENTLOG # \u6700\u91cd\u8981 - \u6700\u4e0d\u91cd\u8981 <level> = 0 - 15 <id> = ALL | Any database node id For detailed help on COMMAND, use HELP COMMAND.","title":"4.2 \u65e5\u5fd7\u7ba1\u7406"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/","text":"1. MMM\u67b6\u6784 \u00b6 \u5b98\u7f51 \u3002\u53ea\u9002\u7528\u4e8e\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u3002 2. MHA\u67b6\u6784 \u00b6 Master Hight Available\u3002MHA-node\u8fd0\u884c\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u4e0a\u9762\u3002MHA-master\u5b9a\u65f6\u63a2\u6d4b\u96c6\u7fa4\u4e2d\u7684master\u8282\u70b9\uff0c\u5f53master\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u5c06\u6700\u65b0\u6570\u636e\u7684slave\u63d0\u5347\u4e3a\u65b0\u7684master\uff0c\u7136\u540e\u5c06\u6240\u6709\u5176\u4ed6\u7684slave\u91cd\u65b0\u6307\u5411\u65b0\u7684master\u3002 \u5f3a\u70c8\u5efa\u8bae\u548c\u534a\u540c\u6b65\u590d\u5236\u4e00\u8d77\u4f7f\u7528\u964d\u4f4e\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669 \u3002 2.1 \u8f6f\u4ef6\u7684\u7ec4\u6210 \u00b6 \u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a Manager\u5de5\u5177\u5305 masterha_check_ssh masterha_check_repl\uff1a\u68c0\u67e5MySQL\u7684\u590d\u5236\u72b6\u51b5 masterha_manager\uff1a\u542f\u52a8MHA masterha_check_status\uff1a\u68c0\u6d4b\u5f53\u524dMHA\u8fd0\u884c\u72b6\u6001 masterha_master_monitor\uff1a\u76d1\u6d4bmaster\u662f\u5426\u5b95\u673a masterha_master_switch\uff1a\u63a7\u5236\u6545\u969c\u8f6c\u79fb\uff08\u81ea\u52a8|\u624b\u52a8\uff09 masterha_conf_host\uff1a\u6dfb\u52a0\u6216\u5220\u9664\u914d\u7f6e\u7684server\u4fe1\u606f Node\u5de5\u5177\u5305\uff08\u65e0\u9700\u624b\u52a8\u64cd\u4f5c\uff09 save_binary_logs\uff1a\u4fdd\u5b58\u548c\u590d\u5236master\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 apply_diff_relay_logs\uff1a\u8bc6\u522b\u5dee\u5f02\u7684\u4e2d\u7ee7\u65e5\u5fd7\u4e8b\u4ef6\u5e76\u5e94\u7528\u5230\u5176\u5b83slave filter_mysqlbinlog\uff1a\u53bb\u9664\u4e0d\u5fc5\u8981\u7684ROLLBACK\u4e8b\u4ef6 purge_relay_logs\uff1a\u6e05\u9664\u4e2d\u7ee7\u65e5\u5fd7\uff08\u4e0d\u4f1a\u963b\u585eSQL\u7ebf\u7a0b\uff09 2.2 \u5b89\u88c5\u4e0e\u90e8\u7f72 \u00b6 \u89d2\u8272 IP server id \u4f5c\u7528 master 192.168.17.10 1 \u5199\u5165 \u5907\u9009master 192.168.17.11 2 \u8bfb slave1 192.168.17.14 3 \u8bfb \u76d1\u63a7master 192.168.17.14 \u76d1\u63a7\u96c6\u7fa4\u7ec4 2.2.1 \u5b89\u88c5MHA node \u00b6 \u6240\u6709\u7684MySQL\u670d\u52a1\u5668\u4e0a\u90fd\u9700\u8981\u5b89\u88c5\u3002\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/yoshinorim/mha4mysql-node/releases 1.\u5b89\u88c5node\u9700\u8981\u7684perl\u6a21\u5757\uff08DBD::mysql\uff09\uff1a $ wget http://xrl.us/cpanm --no-check-certificate $ chmod +x cpanm $ mv cpanm /usr/bin/ $ yum install -y perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-CPAN.noarch $ yum install -y gcc $ cpanm install DBD::mysql 2.\u4e0b\u8f7drpm\u5305\uff1a $ wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm 2.2.2 \u5b89\u88c5MHA master \u00b6 $ wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm","title":"38. \u9ad8\u53ef\u7528\u67b6\u6784"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#1-mmm","text":"\u5b98\u7f51 \u3002\u53ea\u9002\u7528\u4e8e\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u573a\u666f\u3002","title":"1. MMM\u67b6\u6784"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#2-mha","text":"Master Hight Available\u3002MHA-node\u8fd0\u884c\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u4e0a\u9762\u3002MHA-master\u5b9a\u65f6\u63a2\u6d4b\u96c6\u7fa4\u4e2d\u7684master\u8282\u70b9\uff0c\u5f53master\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u5c06\u6700\u65b0\u6570\u636e\u7684slave\u63d0\u5347\u4e3a\u65b0\u7684master\uff0c\u7136\u540e\u5c06\u6240\u6709\u5176\u4ed6\u7684slave\u91cd\u65b0\u6307\u5411\u65b0\u7684master\u3002 \u5f3a\u70c8\u5efa\u8bae\u548c\u534a\u540c\u6b65\u590d\u5236\u4e00\u8d77\u4f7f\u7528\u964d\u4f4e\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669 \u3002","title":"2. MHA\u67b6\u6784"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#21","text":"\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a Manager\u5de5\u5177\u5305 masterha_check_ssh masterha_check_repl\uff1a\u68c0\u67e5MySQL\u7684\u590d\u5236\u72b6\u51b5 masterha_manager\uff1a\u542f\u52a8MHA masterha_check_status\uff1a\u68c0\u6d4b\u5f53\u524dMHA\u8fd0\u884c\u72b6\u6001 masterha_master_monitor\uff1a\u76d1\u6d4bmaster\u662f\u5426\u5b95\u673a masterha_master_switch\uff1a\u63a7\u5236\u6545\u969c\u8f6c\u79fb\uff08\u81ea\u52a8|\u624b\u52a8\uff09 masterha_conf_host\uff1a\u6dfb\u52a0\u6216\u5220\u9664\u914d\u7f6e\u7684server\u4fe1\u606f Node\u5de5\u5177\u5305\uff08\u65e0\u9700\u624b\u52a8\u64cd\u4f5c\uff09 save_binary_logs\uff1a\u4fdd\u5b58\u548c\u590d\u5236master\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 apply_diff_relay_logs\uff1a\u8bc6\u522b\u5dee\u5f02\u7684\u4e2d\u7ee7\u65e5\u5fd7\u4e8b\u4ef6\u5e76\u5e94\u7528\u5230\u5176\u5b83slave filter_mysqlbinlog\uff1a\u53bb\u9664\u4e0d\u5fc5\u8981\u7684ROLLBACK\u4e8b\u4ef6 purge_relay_logs\uff1a\u6e05\u9664\u4e2d\u7ee7\u65e5\u5fd7\uff08\u4e0d\u4f1a\u963b\u585eSQL\u7ebf\u7a0b\uff09","title":"2.1 \u8f6f\u4ef6\u7684\u7ec4\u6210"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#22","text":"\u89d2\u8272 IP server id \u4f5c\u7528 master 192.168.17.10 1 \u5199\u5165 \u5907\u9009master 192.168.17.11 2 \u8bfb slave1 192.168.17.14 3 \u8bfb \u76d1\u63a7master 192.168.17.14 \u76d1\u63a7\u96c6\u7fa4\u7ec4","title":"2.2 \u5b89\u88c5\u4e0e\u90e8\u7f72"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#221-mha-node","text":"\u6240\u6709\u7684MySQL\u670d\u52a1\u5668\u4e0a\u90fd\u9700\u8981\u5b89\u88c5\u3002\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/yoshinorim/mha4mysql-node/releases 1.\u5b89\u88c5node\u9700\u8981\u7684perl\u6a21\u5757\uff08DBD::mysql\uff09\uff1a $ wget http://xrl.us/cpanm --no-check-certificate $ chmod +x cpanm $ mv cpanm /usr/bin/ $ yum install -y perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-CPAN.noarch $ yum install -y gcc $ cpanm install DBD::mysql 2.\u4e0b\u8f7drpm\u5305\uff1a $ wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm","title":"2.2.1 \u5b89\u88c5MHA node"},{"location":"mysql/38. \u9ad8\u53ef\u7528\u67b6\u6784/#222-mha-master","text":"$ wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm","title":"2.2.2 \u5b89\u88c5MHA master"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/","text":"1. \u57fa\u672c\u67e5\u8be2 2. \u6761\u4ef6\u67e5\u8be2 2.1 \u6761\u4ef6\u8868\u8fbe\u5f0f 2.1.1 \u4e0e\u3001\u6216\u3001\u975e\u6761\u4ef6 2.1.2 \u76f8\u7b49\u3001\u4e0d\u7b49\u6761\u4ef6 2.1.3 \u8303\u56f4\u6761\u4ef6 2.1.4 \u6210\u5458\u6761\u4ef6 2.1.5 \u5339\u914d\u6761\u4ef6\uff08\u6a21\u7cca\u67e5\u8be2\uff09 2.1.6 \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d 3. \u6295\u5f71\u67e5\u8be2 4. \u6392\u5e8f 5. \u5206\u9875\u67e5\u8be2 6. \u805a\u5408\u67e5\u8be2 6.1 \u5206\u7ec4\u67e5\u8be2 7. \u8fde\u63a5\u67e5\u8be2 7.1 \u5185\u8fde\u63a5\uff08INNER JOIN\uff09 7.2 \u5de6\u5916\u8fde\u63a5\uff08LEFT OUTER JOIN\uff09 7.3 \u53f3\u5916\u8fde\u63a5\uff08RIGHT OUTER JOIN\uff09 7.4 \u5168\u5916\u8fde\u63a5\uff08FULL OUTER JOIN\uff09 8. \u5b50\u67e5\u8be2 9. \u8054\u5408\u8bb0\u5f55 \u5411\u4e0a\u53d6\u6574\u51fd\u6570\uff1aCEILING \u5411\u4e0b\u53d6\u6574\u51fd\u6570\uff1aFLOOR 1. \u57fa\u672c\u67e5\u8be2 \u00b6 SELECT * FROM < table > \u4f7f\u7528 DISTINCT \u53bb\u9664\u91cd\u590d\u7684\u6570\u636e\uff0c\u5b83\u662f\u4fee\u9970\u5b57\u6bb5\u7684\uff1a # \u67e5\u8be2\u6bcf\u79cd\u65e5\u671f SELECT DISTINCT createDate FROM user ; # \u67e5\u8be2\u6709\u591a\u5c11\u79cd\u65e5\u671f SELECT COUNT ( DISTINCT createDate ) FROM user ; SELECT \u8bed\u53e5\u8fd8\u62e5\u6709\u8ba1\u7b97\u80fd\u529b\uff1a SELECT 101 + 59 ; \u4e0d\u5e26 FROM \u5b50\u53e5\u7684 SELECT \u8bed\u53e5\u7528\u6765\u5224\u65ad\u5f53\u524d\u6570\u636e\u5e93\u7684\u8fde\u63a5\u662f\u5426\u6709\u6548\u3002\u8bb8\u591a\u68c0\u6d4b\u5de5\u5177\u4f1a\u6267\u884c\u4e00\u6761 SELECT 1; \u6765 \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5 \u3002 2. \u6761\u4ef6\u67e5\u8be2 \u00b6 SELECT * FROM < table > WHERE < condition - expression > WHERE \u540e\u8ddf\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002 2.1 \u6761\u4ef6\u8868\u8fbe\u5f0f \u00b6 2.1.1 \u4e0e\u3001\u6216\u3001\u975e\u6761\u4ef6 \u00b6 \u7528\u4e8e\u6761\u4ef6\u7684\u62fc\u63a5\u3002 AND \u4e24\u8fb9\u90fd\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a\u771f OR \u4e24\u8fb9\u53ea\u8981\u4e00\u4e2a\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a\u771f\uff1b NOT \u5373\u4e3a\u975e\u8fd0\u7b97\uff0c\u5b83\u4f7f\u6761\u4ef6\u53d6\u53cd\u3002 NOT \u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u5176\u6b21\u662f AND \uff0c\u6700\u540e\u662f OR \u3002\u52a0\u4e0a\u62ec\u53f7\u53ef\u4ee5\u6539\u53d8\u4f18\u5148\u7ea7\u3002 2.1.2 \u76f8\u7b49\u3001\u4e0d\u7b49\u6761\u4ef6 \u00b6 \u76f8\u7b49\uff1a = \u4e0d\u7b49\uff1a <> \u6216 != 2.1.3 \u8303\u56f4\u6761\u4ef6 \u00b6 <, >, <=, >=, BETWEEN...AND...\u3002 BETWEEN...AND... \u5728\u6570\u636e\u5e93\u6267\u884c\u65f6\u88ab\u8f6c\u5316\u4e3a <= \u548c >= \u4e24\u4e2a\u64cd\u4f5c\u6761\u4ef6\u3002 2.1.4 \u6210\u5458\u6761\u4ef6 \u00b6 IN SELECT * FROM user WHERE name IN ( 'shihr' , 'aaaa' ); 2.1.5 \u5339\u914d\u6761\u4ef6\uff08\u6a21\u7cca\u67e5\u8be2\uff09 \u00b6 LIKE NOT LIKE _\uff1a\u5339\u914d\u4e00\u4e2a\u5b57\u7b26 %\uff1a\u5339\u914d\u4efb\u610f\u4e2a\u5b57\u7b26\uff08\u5305\u62ec0\u4e2a\u5b57\u7b26\uff09 SELECT * FROM blog WHERE title LIKE '%super%' ; \u9ed8\u8ba4\u7684\u8f6c\u4e49\u5b57\u7b26\u662f \\ \uff0c\u53ef\u4ee5\u901a\u8fc7 ESCAPE \u6539\u53d8\uff1a mysql > SELECT 'David_' LIKE 'David|_' ESCAPE '|' ; -> 1 \u4f7f\u7528 \\\\\\\\ \u8868\u793a\u4e00\u4e2a\u666e\u901a\u7684 \\ \u3002 \u6ce8\u610f \uff1a\u6bd4\u8f83\u5b57\u7b26\u4e5f\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u533a\u5206\u5927\u5c0f\u5199\uff1a mysql > SELECT 'abc' LIKE 'ABC' ; -> 1 mysql > SELECT 'abc' LIKE BINARY 'ABC' ; -> 0 2.1.6 \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d \u00b6 REGEXP \u3001 RELIKE NOT REGEXP mysql > SELECT 'a' REGEXP '^[a-d]' ; -> 1 3. \u6295\u5f71\u67e5\u8be2 \u00b6 SELECT < column1 , column2 column - alias > FROM < table > < table - alias > column-alias\uff1a\u5217\u7684\u522b\u540d table-alias\uff1a\u8868\u7684\u522b\u540d 4. \u6392\u5e8f \u00b6 \u67e5\u8be2\u7ed3\u679c\u4e00\u822c\u6839\u636e\u4e3b\u952e\u6392\u5e8f\u3002\u4f7f\u7528 ORDER BY \u53ef\u4ee5\u6539\u53d8\u8fd9\u4e00\u884c\u4e3a\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u6309\u7167\u5347\u5e8f\u6392\u5e8f\uff1b\u52a0\u4e0a DESC \u8868\u793a \u5012\u5e8f \u3002\u53ef\u6dfb\u52a0\u591a\u4e2a\u5b57\u6bb5\u6392\u5e8f\u3002 SELECT * FROM user ORDER BY name ; SELECT * FROM user ORDER BY name DESC , createDate ; \u5982\u679c\u6709 WHERE \u8981\u653e\u5728 WHERE \u540e\u9762\u3002 5. \u5206\u9875\u67e5\u8be2 \u00b6 LIMIT \u662fMySQL\u7684\u6269\u5c55\u8bed\u6cd5\u3002 LIMIT <page-size> OFFSET <result-index> page-size\uff1a\u6bcf\u9875\u7684\u7ed3\u679c\u96c6\u6761\u6570 result-index\uff1a\u4ece\u7ed3\u679c\u96c6\u7684\u7b2c\u51e0\u6761\u5f00\u59cb\uff08\u7b2c\u4e00\u6761\u662f0\uff09 result-index = page-size * \uff08page-index - 1\uff09 SELECT * FROM user LIMIT 5 OFFSET 0 ; result-index \u8d85\u8fc7\u4e86\u67e5\u8be2\u7684\u6700\u5927\u6570\u91cf\u5e76\u4e0d\u4f1a\u62a5\u9519\uff0c\u800c\u662f\u5f97\u5230\u4e00\u4e2a\u7a7a\u7684\u7ed3\u679c\u96c6\u3002 \u4f7f\u7528 LIMIT <M> OFFSET <N> \u5206\u9875\u65f6\uff0c\u968f\u7740\u504f\u79fb\u91cf N \u8d8a\u6765\u8d8a\u5927\uff0c\u67e5\u8be2\u6548\u7387\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u4f4e\u3002 6. \u805a\u5408\u67e5\u8be2 \u00b6 \u901a\u5e38\uff0c\u4f7f\u7528\u805a\u5408\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u7ed9\u5217\u540d\u8bbe\u7f6e\u4e00\u4e2a\u522b\u540d\uff0c\u4fbf\u4e8e\u5904\u7406\u7ed3\u679c\u3002 \u805a\u5408\u51fd\u6570 \u8bf4\u660e COUNT \u8ba1\u7b97\u7ed3\u679c\u96c6\u7684\u6761\u76ee\u6570\u91cf SUM \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u5408\u8ba1\u503c\uff0c\u5fc5\u987b\u662f\u6570\u503c/\u65f6\u95f4\u7c7b\u578b AVG \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u5e73\u5747\u503c\uff0c\u5fc5\u987b\u662f\u6570\u503c/\u65f6\u95f4\u7c7b\u578b MAX \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u6700\u5927\u503c MIN \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u6700\u5c0f\u503c BIT_AND \u6309\u4f4d\u4e0e\uff0c\u8ba1\u7b97\u4ee564\u4f4d\uff08BIGINT\uff09\u7cbe\u5ea6\u6267\u884c\u3002 BIT_OR \u6309\u4f4d\u6216 BIT_XOR \u6309\u4f4d\u5f02\u6216 \u6ce8\u610f \uff1a\u5982\u679c\u805a\u5408\u67e5\u8be2\u7684 WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u884c\uff0c COUNT() \u4f1a\u8fd4\u56de0\uff0c\u800c SUM() \u3001 AVG() \u3001 MAX() \u548c MIN() \u4f1a\u8fd4\u56de NULL \u3002 SELECT column1 , func_name , ... FROM table_name [ GROUP BY column1 , ... [ WITH ROLLUP ]] [ HAVING contition_expression ]; GROUP BY\uff1a\u5206\u7ec4\u67e5\u8be2 WITH ROLLUP\uff1a\u5bf9\u7ed3\u679c\u8fdb\u884c\u6c47\u603b HAVING\uff1a\u5bf9\u805a\u5408\u540e\u7684\u7ed3\u679c\u8fdb\u884c\u6761\u4ef6\u8fc7\u6ee4\uff1bWHERE\u662f\u5728\u805a\u5408\u524d\u8fdb\u884c\u6761\u4ef6\u8fc7\u6ee4\u3002\u5c3d\u53ef\u80fd\u5730\u4f7f\u7528WHERE\u5148\u8fc7\u6ee4\u3002 SELECT createDate , COUNT ( createDate ) nums FROM user GROUP BY createDate WITH ROLLUP ; + ------------+------+ | createDate | nums | + ------------+------+ | 2019 - 04 - 01 | 1 | | 2019 - 04 - 02 | 2 | | 2019 - 04 - 08 | 11 | | 2019 - 04 - 09 | 1 | | 2019 - 04 - 11 | 1 | | NULL | 16 | + ------------+------+ SELECT createDate , COUNT ( createDate ) nums FROM user GROUP BY createDate WITH ROLLUP HAVING nums > 5 ; + ------------+------+ | createDate | nums | + ------------+------+ | 2019 - 04 - 08 | 11 | | NULL | 16 | + ------------+------+ \u6ce8\u610f\uff1a \u5f53\u4f7f\u7528 ROLLUP \u65f6, \u4e0d\u80fd\u540c\u65f6\u4f7f\u7528 ORDER BY \u5b50\u53e5\u8fdb\u884c\u7ed3\u679c\u6392\u5e8f\u3002 \u6362\u8a00\u4e4b\uff0c ROLLUP \u548c ORDER BY \u662f\u4e92\u76f8\u6392\u65a5\u7684 LIMIT \u7528\u5728 ROLLUP \u540e\u9762\u3002 6.1 \u5206\u7ec4\u67e5\u8be2 \u00b6 \u5bf9\u4e8e\u805a\u5408\u67e5\u8be2\uff0cSQL\u8fd8\u63d0\u4f9b\u4e86 \u5206\u7ec4\u805a\u5408 \u7684\u529f\u80fd\uff0c\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u5206\u7ec4\u3002 SELECT userID , COUNT ( * ) num FROM blog GROUP BY userId ; + --------+-----+ | userID | num | + --------+-----+ | 46 | 3 | | 47 | 1 | + --------+-----+ 2 rows in set ( 0 . 01 sec ) \u805a\u5408\u67e5\u8be2\u7684\u5b57\u6bb5\u4e2d\uff0c\u53ea\u80fd\u653e\u5165\u5206\u7ec4\u7684\u5b57\u6bb5 \u3002\u540e\u53ef\u8ddf\u591a\u4e2a\u5b57\u6bb5\u3002 SELECT userID , title , COUNT ( * ) num FROM blog GROUP BY userId , title ; 7. \u8fde\u63a5\u67e5\u8be2 \u00b6 7.1 \u5185\u8fde\u63a5\uff08INNER JOIN\uff09 \u00b6 \u53ea\u8fd4\u56de\u540c\u65f6\u5b58\u5728\u4e8e\u4e24\u5f20\u8868\u7684\u884c\u6570\u636e\u3002 SELECT u . id , u . name , b . title blog_title FROM user u INNER JOIN blog b ON b . userId = u . id ; \u5199\u6cd5\uff1a \u5148\u786e\u5b9a\u4e3b\u8868\uff0c FROM <table> \u518d\u786e\u5b9a\u8fde\u63a5\u7684\u8868\uff0c INNER JOIN <other-table> \u7136\u540e\u662f\u8fde\u63a5\u6761\u4ef6\uff0c ON ... \u53ef\u9009\u5b50\u53e5\uff0c WHERE \u7b49 7.2 \u5de6\u5916\u8fde\u63a5\uff08LEFT OUTER JOIN\uff09 \u00b6 \u8fd4\u56de\u5de6\u8868\u90fd\u5b58\u5728\u7684\u884c\u3002\u5982\u679c\u67d0\u4e00\u884c\u4ec5\u5728\u5de6\u8868\u5b58\u5728\uff0c\u90a3\u4e48\u7ed3\u679c\u96c6\u5c31\u4f1a\u4ee5 NULL \u586b\u5145\u5269\u4e0b\u7684\u5b57\u6bb5\u3002 7.3 \u53f3\u5916\u8fde\u63a5\uff08RIGHT OUTER JOIN\uff09 \u00b6 \u8fd4\u56de\u53f3\u8868\u90fd\u5b58\u5728\u7684\u884c\u3002\u5982\u679c\u67d0\u4e00\u884c\u4ec5\u5728\u53f3\u8868\u5b58\u5728\uff0c\u90a3\u4e48\u7ed3\u679c\u96c6\u5c31\u4f1a\u4ee5 NULL \u586b\u5145\u5269\u4e0b\u7684\u5b57\u6bb5\u3002 7.4 \u5168\u5916\u8fde\u63a5\uff08FULL OUTER JOIN\uff09 \u00b6 \u4f1a\u628a\u4e24\u5f20\u8868\u7684\u6240\u6709\u8bb0\u5f55\u5168\u90e8\u9009\u62e9\u51fa\u6765\uff0c\u5e76\u4e14\uff0c\u81ea\u52a8\u628a\u5bf9\u65b9\u4e0d\u5b58\u5728\u7684\u5217\u586b\u5145\u4e3aNULL\u3002 MySQL\u4e0d\u652f\u6301\uff0c\u53ef\u4f7f\u7528 UNION \u8054\u5408\u5de6\u5916\u3001\u53f3\u5916\u8fde\u63a5\u4ee3\u66ff\uff1a SELECT u . id , u . name , b . title blog_title FROM user u LEFT OUTER JOIN blog b ON b . userId = u . id UNION SELECT u . id , u . name , b . title blog_title FROM user u RIGHT OUTER JOIN blog b ON b . userId = u . id ; 8. \u5b50\u67e5\u8be2 \u00b6 \u5173\u952e\u5b57\u4e3b\u8981\u5305\u62ec IN, NOT IN, =, !=, EXISTS, NOT EXISTS \u3002 SELECT * FROM user WHERE id IN ( 2 , 3 ); \u5b50\u67e5\u8be2\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8f6c\u5316\u4e3a\u8868\u8fde\u63a5\uff0c\u8868\u8fde\u63a5\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u7528\u4e8e\u4f18\u5316\u5b50\u67e5\u8be2\u3002 9. \u8054\u5408\u8bb0\u5f55 \u00b6 \u4f7f\u7528 UNION \u6216 UNION ALL \u5c06\u67e5\u8be2\u7ed3\u679c\u5408\u5e76\u8d77\u6765\u3002 SELECT ... UNION [ ALL | DISTINCT ] SELECT ... [ UNION [ ALL | DISTINCT ] SELECT ...] \u533a\u522b\uff1aUNION\u4f1a\u5bf9\u7ed3\u679c\u53bb\u91cd\uff0c\u5373DISTINCT\uff1bUNION ALL\u5219\u4e0d\u4f1a\u3002","title":"4. \u67e5\u8be2\u6570\u636e"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#1","text":"SELECT * FROM < table > \u4f7f\u7528 DISTINCT \u53bb\u9664\u91cd\u590d\u7684\u6570\u636e\uff0c\u5b83\u662f\u4fee\u9970\u5b57\u6bb5\u7684\uff1a # \u67e5\u8be2\u6bcf\u79cd\u65e5\u671f SELECT DISTINCT createDate FROM user ; # \u67e5\u8be2\u6709\u591a\u5c11\u79cd\u65e5\u671f SELECT COUNT ( DISTINCT createDate ) FROM user ; SELECT \u8bed\u53e5\u8fd8\u62e5\u6709\u8ba1\u7b97\u80fd\u529b\uff1a SELECT 101 + 59 ; \u4e0d\u5e26 FROM \u5b50\u53e5\u7684 SELECT \u8bed\u53e5\u7528\u6765\u5224\u65ad\u5f53\u524d\u6570\u636e\u5e93\u7684\u8fde\u63a5\u662f\u5426\u6709\u6548\u3002\u8bb8\u591a\u68c0\u6d4b\u5de5\u5177\u4f1a\u6267\u884c\u4e00\u6761 SELECT 1; \u6765 \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5 \u3002","title":"1. \u57fa\u672c\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#2","text":"SELECT * FROM < table > WHERE < condition - expression > WHERE \u540e\u8ddf\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002","title":"2. \u6761\u4ef6\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#21","text":"","title":"2.1 \u6761\u4ef6\u8868\u8fbe\u5f0f"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#211","text":"\u7528\u4e8e\u6761\u4ef6\u7684\u62fc\u63a5\u3002 AND \u4e24\u8fb9\u90fd\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a\u771f OR \u4e24\u8fb9\u53ea\u8981\u4e00\u4e2a\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a\u771f\uff1b NOT \u5373\u4e3a\u975e\u8fd0\u7b97\uff0c\u5b83\u4f7f\u6761\u4ef6\u53d6\u53cd\u3002 NOT \u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u5176\u6b21\u662f AND \uff0c\u6700\u540e\u662f OR \u3002\u52a0\u4e0a\u62ec\u53f7\u53ef\u4ee5\u6539\u53d8\u4f18\u5148\u7ea7\u3002","title":"2.1.1 \u4e0e\u3001\u6216\u3001\u975e\u6761\u4ef6"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#212","text":"\u76f8\u7b49\uff1a = \u4e0d\u7b49\uff1a <> \u6216 !=","title":"2.1.2 \u76f8\u7b49\u3001\u4e0d\u7b49\u6761\u4ef6"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#213","text":"<, >, <=, >=, BETWEEN...AND...\u3002 BETWEEN...AND... \u5728\u6570\u636e\u5e93\u6267\u884c\u65f6\u88ab\u8f6c\u5316\u4e3a <= \u548c >= \u4e24\u4e2a\u64cd\u4f5c\u6761\u4ef6\u3002","title":"2.1.3 \u8303\u56f4\u6761\u4ef6"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#214","text":"IN SELECT * FROM user WHERE name IN ( 'shihr' , 'aaaa' );","title":"2.1.4 \u6210\u5458\u6761\u4ef6"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#215","text":"LIKE NOT LIKE _\uff1a\u5339\u914d\u4e00\u4e2a\u5b57\u7b26 %\uff1a\u5339\u914d\u4efb\u610f\u4e2a\u5b57\u7b26\uff08\u5305\u62ec0\u4e2a\u5b57\u7b26\uff09 SELECT * FROM blog WHERE title LIKE '%super%' ; \u9ed8\u8ba4\u7684\u8f6c\u4e49\u5b57\u7b26\u662f \\ \uff0c\u53ef\u4ee5\u901a\u8fc7 ESCAPE \u6539\u53d8\uff1a mysql > SELECT 'David_' LIKE 'David|_' ESCAPE '|' ; -> 1 \u4f7f\u7528 \\\\\\\\ \u8868\u793a\u4e00\u4e2a\u666e\u901a\u7684 \\ \u3002 \u6ce8\u610f \uff1a\u6bd4\u8f83\u5b57\u7b26\u4e5f\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u6bd4\u8f83\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u533a\u5206\u5927\u5c0f\u5199\uff1a mysql > SELECT 'abc' LIKE 'ABC' ; -> 1 mysql > SELECT 'abc' LIKE BINARY 'ABC' ; -> 0","title":"2.1.5 \u5339\u914d\u6761\u4ef6\uff08\u6a21\u7cca\u67e5\u8be2\uff09"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#216","text":"REGEXP \u3001 RELIKE NOT REGEXP mysql > SELECT 'a' REGEXP '^[a-d]' ; -> 1","title":"2.1.6 \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#3","text":"SELECT < column1 , column2 column - alias > FROM < table > < table - alias > column-alias\uff1a\u5217\u7684\u522b\u540d table-alias\uff1a\u8868\u7684\u522b\u540d","title":"3. \u6295\u5f71\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#4","text":"\u67e5\u8be2\u7ed3\u679c\u4e00\u822c\u6839\u636e\u4e3b\u952e\u6392\u5e8f\u3002\u4f7f\u7528 ORDER BY \u53ef\u4ee5\u6539\u53d8\u8fd9\u4e00\u884c\u4e3a\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u6309\u7167\u5347\u5e8f\u6392\u5e8f\uff1b\u52a0\u4e0a DESC \u8868\u793a \u5012\u5e8f \u3002\u53ef\u6dfb\u52a0\u591a\u4e2a\u5b57\u6bb5\u6392\u5e8f\u3002 SELECT * FROM user ORDER BY name ; SELECT * FROM user ORDER BY name DESC , createDate ; \u5982\u679c\u6709 WHERE \u8981\u653e\u5728 WHERE \u540e\u9762\u3002","title":"4. \u6392\u5e8f"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#5","text":"LIMIT \u662fMySQL\u7684\u6269\u5c55\u8bed\u6cd5\u3002 LIMIT <page-size> OFFSET <result-index> page-size\uff1a\u6bcf\u9875\u7684\u7ed3\u679c\u96c6\u6761\u6570 result-index\uff1a\u4ece\u7ed3\u679c\u96c6\u7684\u7b2c\u51e0\u6761\u5f00\u59cb\uff08\u7b2c\u4e00\u6761\u662f0\uff09 result-index = page-size * \uff08page-index - 1\uff09 SELECT * FROM user LIMIT 5 OFFSET 0 ; result-index \u8d85\u8fc7\u4e86\u67e5\u8be2\u7684\u6700\u5927\u6570\u91cf\u5e76\u4e0d\u4f1a\u62a5\u9519\uff0c\u800c\u662f\u5f97\u5230\u4e00\u4e2a\u7a7a\u7684\u7ed3\u679c\u96c6\u3002 \u4f7f\u7528 LIMIT <M> OFFSET <N> \u5206\u9875\u65f6\uff0c\u968f\u7740\u504f\u79fb\u91cf N \u8d8a\u6765\u8d8a\u5927\uff0c\u67e5\u8be2\u6548\u7387\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u4f4e\u3002","title":"5. \u5206\u9875\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#6","text":"\u901a\u5e38\uff0c\u4f7f\u7528\u805a\u5408\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u7ed9\u5217\u540d\u8bbe\u7f6e\u4e00\u4e2a\u522b\u540d\uff0c\u4fbf\u4e8e\u5904\u7406\u7ed3\u679c\u3002 \u805a\u5408\u51fd\u6570 \u8bf4\u660e COUNT \u8ba1\u7b97\u7ed3\u679c\u96c6\u7684\u6761\u76ee\u6570\u91cf SUM \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u5408\u8ba1\u503c\uff0c\u5fc5\u987b\u662f\u6570\u503c/\u65f6\u95f4\u7c7b\u578b AVG \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u5e73\u5747\u503c\uff0c\u5fc5\u987b\u662f\u6570\u503c/\u65f6\u95f4\u7c7b\u578b MAX \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u6700\u5927\u503c MIN \u8ba1\u7b97\u67d0\u4e00\u5217\u7684\u6700\u5c0f\u503c BIT_AND \u6309\u4f4d\u4e0e\uff0c\u8ba1\u7b97\u4ee564\u4f4d\uff08BIGINT\uff09\u7cbe\u5ea6\u6267\u884c\u3002 BIT_OR \u6309\u4f4d\u6216 BIT_XOR \u6309\u4f4d\u5f02\u6216 \u6ce8\u610f \uff1a\u5982\u679c\u805a\u5408\u67e5\u8be2\u7684 WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u884c\uff0c COUNT() \u4f1a\u8fd4\u56de0\uff0c\u800c SUM() \u3001 AVG() \u3001 MAX() \u548c MIN() \u4f1a\u8fd4\u56de NULL \u3002 SELECT column1 , func_name , ... FROM table_name [ GROUP BY column1 , ... [ WITH ROLLUP ]] [ HAVING contition_expression ]; GROUP BY\uff1a\u5206\u7ec4\u67e5\u8be2 WITH ROLLUP\uff1a\u5bf9\u7ed3\u679c\u8fdb\u884c\u6c47\u603b HAVING\uff1a\u5bf9\u805a\u5408\u540e\u7684\u7ed3\u679c\u8fdb\u884c\u6761\u4ef6\u8fc7\u6ee4\uff1bWHERE\u662f\u5728\u805a\u5408\u524d\u8fdb\u884c\u6761\u4ef6\u8fc7\u6ee4\u3002\u5c3d\u53ef\u80fd\u5730\u4f7f\u7528WHERE\u5148\u8fc7\u6ee4\u3002 SELECT createDate , COUNT ( createDate ) nums FROM user GROUP BY createDate WITH ROLLUP ; + ------------+------+ | createDate | nums | + ------------+------+ | 2019 - 04 - 01 | 1 | | 2019 - 04 - 02 | 2 | | 2019 - 04 - 08 | 11 | | 2019 - 04 - 09 | 1 | | 2019 - 04 - 11 | 1 | | NULL | 16 | + ------------+------+ SELECT createDate , COUNT ( createDate ) nums FROM user GROUP BY createDate WITH ROLLUP HAVING nums > 5 ; + ------------+------+ | createDate | nums | + ------------+------+ | 2019 - 04 - 08 | 11 | | NULL | 16 | + ------------+------+ \u6ce8\u610f\uff1a \u5f53\u4f7f\u7528 ROLLUP \u65f6, \u4e0d\u80fd\u540c\u65f6\u4f7f\u7528 ORDER BY \u5b50\u53e5\u8fdb\u884c\u7ed3\u679c\u6392\u5e8f\u3002 \u6362\u8a00\u4e4b\uff0c ROLLUP \u548c ORDER BY \u662f\u4e92\u76f8\u6392\u65a5\u7684 LIMIT \u7528\u5728 ROLLUP \u540e\u9762\u3002","title":"6. \u805a\u5408\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#61","text":"\u5bf9\u4e8e\u805a\u5408\u67e5\u8be2\uff0cSQL\u8fd8\u63d0\u4f9b\u4e86 \u5206\u7ec4\u805a\u5408 \u7684\u529f\u80fd\uff0c\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u5206\u7ec4\u3002 SELECT userID , COUNT ( * ) num FROM blog GROUP BY userId ; + --------+-----+ | userID | num | + --------+-----+ | 46 | 3 | | 47 | 1 | + --------+-----+ 2 rows in set ( 0 . 01 sec ) \u805a\u5408\u67e5\u8be2\u7684\u5b57\u6bb5\u4e2d\uff0c\u53ea\u80fd\u653e\u5165\u5206\u7ec4\u7684\u5b57\u6bb5 \u3002\u540e\u53ef\u8ddf\u591a\u4e2a\u5b57\u6bb5\u3002 SELECT userID , title , COUNT ( * ) num FROM blog GROUP BY userId , title ;","title":"6.1 \u5206\u7ec4\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#7","text":"","title":"7. \u8fde\u63a5\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#71-inner-join","text":"\u53ea\u8fd4\u56de\u540c\u65f6\u5b58\u5728\u4e8e\u4e24\u5f20\u8868\u7684\u884c\u6570\u636e\u3002 SELECT u . id , u . name , b . title blog_title FROM user u INNER JOIN blog b ON b . userId = u . id ; \u5199\u6cd5\uff1a \u5148\u786e\u5b9a\u4e3b\u8868\uff0c FROM <table> \u518d\u786e\u5b9a\u8fde\u63a5\u7684\u8868\uff0c INNER JOIN <other-table> \u7136\u540e\u662f\u8fde\u63a5\u6761\u4ef6\uff0c ON ... \u53ef\u9009\u5b50\u53e5\uff0c WHERE \u7b49","title":"7.1 \u5185\u8fde\u63a5\uff08INNER JOIN\uff09"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#72-left-outer-join","text":"\u8fd4\u56de\u5de6\u8868\u90fd\u5b58\u5728\u7684\u884c\u3002\u5982\u679c\u67d0\u4e00\u884c\u4ec5\u5728\u5de6\u8868\u5b58\u5728\uff0c\u90a3\u4e48\u7ed3\u679c\u96c6\u5c31\u4f1a\u4ee5 NULL \u586b\u5145\u5269\u4e0b\u7684\u5b57\u6bb5\u3002","title":"7.2 \u5de6\u5916\u8fde\u63a5\uff08LEFT OUTER JOIN\uff09"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#73-right-outer-join","text":"\u8fd4\u56de\u53f3\u8868\u90fd\u5b58\u5728\u7684\u884c\u3002\u5982\u679c\u67d0\u4e00\u884c\u4ec5\u5728\u53f3\u8868\u5b58\u5728\uff0c\u90a3\u4e48\u7ed3\u679c\u96c6\u5c31\u4f1a\u4ee5 NULL \u586b\u5145\u5269\u4e0b\u7684\u5b57\u6bb5\u3002","title":"7.3 \u53f3\u5916\u8fde\u63a5\uff08RIGHT OUTER JOIN\uff09"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#74-full-outer-join","text":"\u4f1a\u628a\u4e24\u5f20\u8868\u7684\u6240\u6709\u8bb0\u5f55\u5168\u90e8\u9009\u62e9\u51fa\u6765\uff0c\u5e76\u4e14\uff0c\u81ea\u52a8\u628a\u5bf9\u65b9\u4e0d\u5b58\u5728\u7684\u5217\u586b\u5145\u4e3aNULL\u3002 MySQL\u4e0d\u652f\u6301\uff0c\u53ef\u4f7f\u7528 UNION \u8054\u5408\u5de6\u5916\u3001\u53f3\u5916\u8fde\u63a5\u4ee3\u66ff\uff1a SELECT u . id , u . name , b . title blog_title FROM user u LEFT OUTER JOIN blog b ON b . userId = u . id UNION SELECT u . id , u . name , b . title blog_title FROM user u RIGHT OUTER JOIN blog b ON b . userId = u . id ;","title":"7.4 \u5168\u5916\u8fde\u63a5\uff08FULL OUTER JOIN\uff09"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#8","text":"\u5173\u952e\u5b57\u4e3b\u8981\u5305\u62ec IN, NOT IN, =, !=, EXISTS, NOT EXISTS \u3002 SELECT * FROM user WHERE id IN ( 2 , 3 ); \u5b50\u67e5\u8be2\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8f6c\u5316\u4e3a\u8868\u8fde\u63a5\uff0c\u8868\u8fde\u63a5\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u7528\u4e8e\u4f18\u5316\u5b50\u67e5\u8be2\u3002","title":"8. \u5b50\u67e5\u8be2"},{"location":"mysql/4. \u67e5\u8be2\u6570\u636e/#9","text":"\u4f7f\u7528 UNION \u6216 UNION ALL \u5c06\u67e5\u8be2\u7ed3\u679c\u5408\u5e76\u8d77\u6765\u3002 SELECT ... UNION [ ALL | DISTINCT ] SELECT ... [ UNION [ ALL | DISTINCT ] SELECT ...] \u533a\u522b\uff1aUNION\u4f1a\u5bf9\u7ed3\u679c\u53bb\u91cd\uff0c\u5373DISTINCT\uff1bUNION ALL\u5219\u4e0d\u4f1a\u3002","title":"9. \u8054\u5408\u8bb0\u5f55"},{"location":"mysql/5. \u4fee\u6539\u6570\u636e/","text":"1. \u63d2\u5165\u6570\u636e 2. \u66f4\u65b0\u6570\u636e 3. \u5220\u9664\u6570\u636e 1. \u63d2\u5165\u6570\u636e \u00b6 INSERT INTO < table > [( column1 , column2 , ...)] VALUES ( value1 , value2 , ...), ( value1 , value2 , ...), ...; 2. \u66f4\u65b0\u6570\u636e \u00b6 \u53ef\u4ee5\u4f7f\u7528\u503c\u6216\u8005\u8868\u8fbe\u5f0f\u66f4\u65b0\u3002 UPDATE < table1 , ... > SET column1 = value1 | expression1 , column2 = value2 | expression2 , ... [ WHERE ...]; UPDATE students SET score = score + 10 WHERE score < 80 ; \u5982\u679c WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c UPDATE \u8bed\u53e5\u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u8bb0\u5f55\u88ab\u66f4\u65b0\uff1b\u5982\u679c\u6ca1\u6709 WHERE \u5b50\u53e5\uff0c\u90a3\u4e48\u4f1a\u66f4\u65b0\u6574\u4e2a\u8868\u7684\u8bb0\u5f55\u3002 3. \u5220\u9664\u6570\u636e \u00b6 \u5355\u8868\u5220\u9664\uff1a DELETE FROM < table > WHERE ...; \u591a\u8868\u5220\u9664\uff1a DELETE < table1 , ... > FROM < table1 , ... > WHERE ...; \u5982\u679c WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c DELETE \u8bed\u53e5\u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u8bb0\u5f55\u88ab\u5220\u9664\u3002\u5982\u679c\u6ca1\u6709 WHERE \u5b50\u53e5\uff0c\u90a3\u4e48\u4f1a\u5220\u9664\u6574\u4e2a\u8868\u7684\u8bb0\u5f55\u3002","title":"5. \u4fee\u6539\u6570\u636e"},{"location":"mysql/5. \u4fee\u6539\u6570\u636e/#1","text":"INSERT INTO < table > [( column1 , column2 , ...)] VALUES ( value1 , value2 , ...), ( value1 , value2 , ...), ...;","title":"1. \u63d2\u5165\u6570\u636e"},{"location":"mysql/5. \u4fee\u6539\u6570\u636e/#2","text":"\u53ef\u4ee5\u4f7f\u7528\u503c\u6216\u8005\u8868\u8fbe\u5f0f\u66f4\u65b0\u3002 UPDATE < table1 , ... > SET column1 = value1 | expression1 , column2 = value2 | expression2 , ... [ WHERE ...]; UPDATE students SET score = score + 10 WHERE score < 80 ; \u5982\u679c WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c UPDATE \u8bed\u53e5\u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u8bb0\u5f55\u88ab\u66f4\u65b0\uff1b\u5982\u679c\u6ca1\u6709 WHERE \u5b50\u53e5\uff0c\u90a3\u4e48\u4f1a\u66f4\u65b0\u6574\u4e2a\u8868\u7684\u8bb0\u5f55\u3002","title":"2. \u66f4\u65b0\u6570\u636e"},{"location":"mysql/5. \u4fee\u6539\u6570\u636e/#3","text":"\u5355\u8868\u5220\u9664\uff1a DELETE FROM < table > WHERE ...; \u591a\u8868\u5220\u9664\uff1a DELETE < table1 , ... > FROM < table1 , ... > WHERE ...; \u5982\u679c WHERE \u6761\u4ef6\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c DELETE \u8bed\u53e5\u4e0d\u4f1a\u62a5\u9519\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u8bb0\u5f55\u88ab\u5220\u9664\u3002\u5982\u679c\u6ca1\u6709 WHERE \u5b50\u53e5\uff0c\u90a3\u4e48\u4f1a\u5220\u9664\u6574\u4e2a\u8868\u7684\u8bb0\u5f55\u3002","title":"3. \u5220\u9664\u6570\u636e"},{"location":"mysql/6. \u4e8b\u52a1/","text":"1. ACID\u7279\u6027 2. \u9694\u79bb\u7ea7\u522b 2.1 Read Uncommitted 2.2 Read Committed 2.3 Repeatable Read 2.4 Serializable 2.5 \u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b \u628a\u591a\u6761\u8bed\u53e5\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u64cd\u4f5c\u7684\u529f\u80fd\uff0c\u88ab\u79f0\u4e3a\u6570\u636e\u5e93 \u4e8b\u52a1 \u3002 1. ACID\u7279\u6027 \u00b6 A\uff1aatomicity\uff0c\u539f\u5b50\u6027\uff0c\u5c06\u6240\u6709SQL\u4f5c\u4e3a\u539f\u5b50\u5de5\u4f5c\u5355\u5143\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\uff1b C\uff1aconsistency\uff0c\u4e00\u81f4\u6027\uff0c\u4e8b\u52a1\u5b8c\u6210\u540e\uff0c\u6240\u6709\u6570\u636e\u7684\u72b6\u6001\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u5373A\u8d26\u6237\u53ea\u8981\u51cf\u53bb\u4e86100\uff0cB\u8d26\u6237\u5219\u5fc5\u5b9a\u52a0\u4e0a\u4e86100\uff1b I\uff1aisolation\uff0c\u9694\u79bb\u6027\uff0c\u5982\u679c\u6709\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u4f5c\u51fa\u7684\u4fee\u6539\u5fc5\u987b\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\uff1b D\uff1adurability\uff0c\u6301\u4e45\u6027\uff0c\u5373\u4e8b\u52a1\u5b8c\u6210\u540e\uff0c\u5bf9\u6570\u636e\u5e93\u6570\u636e\u7684\u4fee\u6539\u88ab\u6301\u4e45\u5316\u5b58\u50a8\u3002 \u5bf9\u4e8e\u5355\u6761SQL\u8bed\u53e5\uff0c\u6570\u636e\u5e93\u7cfb\u7edf\u81ea\u52a8\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\uff0c\u8fd9\u79cd\u4e8b\u52a1\u88ab\u79f0\u4e3a \u9690\u5f0f\u4e8b\u52a1 \u3002 \u8981\u624b\u52a8\u628a\u591a\u6761SQL\u8bed\u53e5\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\uff0c\u4f7f\u7528 BEGIN \u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u4f7f\u7528 COMMIT \u63d0\u4ea4\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8fd9\u79cd\u4e8b\u52a1\u88ab\u79f0\u4e3a \u663e\u5f0f\u4e8b\u52a1 \u3002 BEGIN ; < SQL > ; COMMIT ; \u6709\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u4e3b\u52a8\u8ba9\u4e8b\u52a1\u5931\u8d25\uff0c\u8fd9\u65f6\uff0c\u53ef\u4ee5\u7528 ROLLBACK \u56de\u6eda\u4e8b\u52a1\uff0c\u6574\u4e2a\u4e8b\u52a1\u4f1a\u5931\u8d25\uff1a BEGIN ; < SQL > ; ROLLBACK ; 2. \u9694\u79bb\u7ea7\u522b \u00b6 Transaction Isolation Levels \u9488\u5bf9\u9694\u79bb\u6027\uff0cSQL\u6807\u51c6\u5b9a\u4e49\u4e864\u79cd\u9694\u79bb\u7ea7\u522b\uff1a Isolation Level \u810f\u8bfb\uff08Dirty Read\uff09 \u4e0d\u53ef\u91cd\u590d\u8bfb\uff08Non Repeatable Read\uff09 \u5e7b\u8bfb\uff08Phantom Read\uff09 Read Uncommitted May May May Read Committed - May May Repeatable Read - - May Serializable - - - 2.1 Read Uncommitted \u00b6 \u5728\u8fd9\u79cd\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e00\u4e2a\u4e8b\u52a1\u4f1a\u8bfb\u5230\u53e6\u4e00\u4e2a\u4e8b\u52a1\u66f4\u65b0\u540e\u4f46\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u5982\u679c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u56de\u6eda\uff0c\u90a3\u4e48\u5f53\u524d\u4e8b\u52a1\u8bfb\u5230\u7684\u6570\u636e\u5c31\u662f\u810f\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u810f\u8bfb\uff08Dirty Read\uff09\u3002 2.2 Read Committed \u00b6 \u4e0d\u53ef\u91cd\u590d\u8bfb\u662f\u6307\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\uff0c\u591a\u6b21\u8bfb\u540c\u4e00\u6570\u636e\uff0c\u5728\u8fd9\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u6709\u7ed3\u675f\u65f6\uff0c\u5982\u679c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u6070\u597d\u4fee\u6539\u4e86\u8fd9\u4e2a\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u5728\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u5c31\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002 \u6240\u4ee5\u6b63\u786e\u505a\u6cd5\u5c31\u662f\u53ea\u8bfb\u4e00\u6b21\uff0c\u4e0d\u8981\u518d\u53bb\u8bfb\u4e86\u3002 2.3 Repeatable Read \u00b6 \u5e7b\u8bfb\u662f\u6307\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u7b2c\u4e00\u6b21\u67e5\u8be2\u67d0\u6761\u8bb0\u5f55\uff0c\u53d1\u73b0\u6ca1\u6709\uff0c\u4f46\u662f\uff0c\u5f53\u8bd5\u56fe\u66f4\u65b0\u8fd9\u6761\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u65f6\uff0c\u7adf\u7136\u80fd\u6210\u529f\uff0c\u5e76\u4e14\uff0c\u518d\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u8bb0\u5f55\uff0c\u5b83\u5c31\u795e\u5947\u5730\u51fa\u73b0\u4e86\u3002 \u5e7b\u8bfb\u51fa\u73b0\u7684\u539f\u56e0\uff1a\u56e0\u4e3aRepeatable Read\u4e0b\u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\u7684\u67e5\u8be2\u90fd\u662f\u4e0e\u4e8b\u52a1\u5f00\u59cb\u65f6\u523b\u4e00\u81f4\uff0c\u6240\u4ee5\u5728B\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u662f\u4e0d\u4f1a\u8bfb\u5230\u671f\u95f4A\u4e2dinsert\u7684\u503c\u7684\u3002 2.4 Serializable \u00b6 \u6240\u6709\u4e8b\u52a1\u6309\u7167\u6b21\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u56e0\u6b64\uff0c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u90fd\u4e0d\u4f1a\u51fa\u73b0\u3002\u4f46\u662f\u6548\u7387\u4f1a\u5927\u5927\u4e0b\u964d\u3002 2.5 \u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b \u00b6 \u5728MySQL\u4e2d\uff0c\u5982\u679c\u4f7f\u7528InnoDB\uff0c\u9ed8\u8ba4\u7684\u9694\u79bb\u7ea7\u522b\u662fRepeatable Read\u3002","title":"6. \u4e8b\u52a1"},{"location":"mysql/6. \u4e8b\u52a1/#1-acid","text":"A\uff1aatomicity\uff0c\u539f\u5b50\u6027\uff0c\u5c06\u6240\u6709SQL\u4f5c\u4e3a\u539f\u5b50\u5de5\u4f5c\u5355\u5143\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\uff1b C\uff1aconsistency\uff0c\u4e00\u81f4\u6027\uff0c\u4e8b\u52a1\u5b8c\u6210\u540e\uff0c\u6240\u6709\u6570\u636e\u7684\u72b6\u6001\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u5373A\u8d26\u6237\u53ea\u8981\u51cf\u53bb\u4e86100\uff0cB\u8d26\u6237\u5219\u5fc5\u5b9a\u52a0\u4e0a\u4e86100\uff1b I\uff1aisolation\uff0c\u9694\u79bb\u6027\uff0c\u5982\u679c\u6709\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u4f5c\u51fa\u7684\u4fee\u6539\u5fc5\u987b\u4e0e\u5176\u4ed6\u4e8b\u52a1\u9694\u79bb\uff1b D\uff1adurability\uff0c\u6301\u4e45\u6027\uff0c\u5373\u4e8b\u52a1\u5b8c\u6210\u540e\uff0c\u5bf9\u6570\u636e\u5e93\u6570\u636e\u7684\u4fee\u6539\u88ab\u6301\u4e45\u5316\u5b58\u50a8\u3002 \u5bf9\u4e8e\u5355\u6761SQL\u8bed\u53e5\uff0c\u6570\u636e\u5e93\u7cfb\u7edf\u81ea\u52a8\u5c06\u5176\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\uff0c\u8fd9\u79cd\u4e8b\u52a1\u88ab\u79f0\u4e3a \u9690\u5f0f\u4e8b\u52a1 \u3002 \u8981\u624b\u52a8\u628a\u591a\u6761SQL\u8bed\u53e5\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\uff0c\u4f7f\u7528 BEGIN \u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u4f7f\u7528 COMMIT \u63d0\u4ea4\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8fd9\u79cd\u4e8b\u52a1\u88ab\u79f0\u4e3a \u663e\u5f0f\u4e8b\u52a1 \u3002 BEGIN ; < SQL > ; COMMIT ; \u6709\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u4e3b\u52a8\u8ba9\u4e8b\u52a1\u5931\u8d25\uff0c\u8fd9\u65f6\uff0c\u53ef\u4ee5\u7528 ROLLBACK \u56de\u6eda\u4e8b\u52a1\uff0c\u6574\u4e2a\u4e8b\u52a1\u4f1a\u5931\u8d25\uff1a BEGIN ; < SQL > ; ROLLBACK ;","title":"1. ACID\u7279\u6027"},{"location":"mysql/6. \u4e8b\u52a1/#2","text":"Transaction Isolation Levels \u9488\u5bf9\u9694\u79bb\u6027\uff0cSQL\u6807\u51c6\u5b9a\u4e49\u4e864\u79cd\u9694\u79bb\u7ea7\u522b\uff1a Isolation Level \u810f\u8bfb\uff08Dirty Read\uff09 \u4e0d\u53ef\u91cd\u590d\u8bfb\uff08Non Repeatable Read\uff09 \u5e7b\u8bfb\uff08Phantom Read\uff09 Read Uncommitted May May May Read Committed - May May Repeatable Read - - May Serializable - - -","title":"2. \u9694\u79bb\u7ea7\u522b"},{"location":"mysql/6. \u4e8b\u52a1/#21-read-uncommitted","text":"\u5728\u8fd9\u79cd\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e00\u4e2a\u4e8b\u52a1\u4f1a\u8bfb\u5230\u53e6\u4e00\u4e2a\u4e8b\u52a1\u66f4\u65b0\u540e\u4f46\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u5982\u679c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u56de\u6eda\uff0c\u90a3\u4e48\u5f53\u524d\u4e8b\u52a1\u8bfb\u5230\u7684\u6570\u636e\u5c31\u662f\u810f\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u810f\u8bfb\uff08Dirty Read\uff09\u3002","title":"2.1 Read Uncommitted"},{"location":"mysql/6. \u4e8b\u52a1/#22-read-committed","text":"\u4e0d\u53ef\u91cd\u590d\u8bfb\u662f\u6307\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\uff0c\u591a\u6b21\u8bfb\u540c\u4e00\u6570\u636e\uff0c\u5728\u8fd9\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u6709\u7ed3\u675f\u65f6\uff0c\u5982\u679c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u6070\u597d\u4fee\u6539\u4e86\u8fd9\u4e2a\u6570\u636e\uff0c\u90a3\u4e48\uff0c\u5728\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u5c31\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002 \u6240\u4ee5\u6b63\u786e\u505a\u6cd5\u5c31\u662f\u53ea\u8bfb\u4e00\u6b21\uff0c\u4e0d\u8981\u518d\u53bb\u8bfb\u4e86\u3002","title":"2.2 Read Committed"},{"location":"mysql/6. \u4e8b\u52a1/#23-repeatable-read","text":"\u5e7b\u8bfb\u662f\u6307\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u7b2c\u4e00\u6b21\u67e5\u8be2\u67d0\u6761\u8bb0\u5f55\uff0c\u53d1\u73b0\u6ca1\u6709\uff0c\u4f46\u662f\uff0c\u5f53\u8bd5\u56fe\u66f4\u65b0\u8fd9\u6761\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u65f6\uff0c\u7adf\u7136\u80fd\u6210\u529f\uff0c\u5e76\u4e14\uff0c\u518d\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u8bb0\u5f55\uff0c\u5b83\u5c31\u795e\u5947\u5730\u51fa\u73b0\u4e86\u3002 \u5e7b\u8bfb\u51fa\u73b0\u7684\u539f\u56e0\uff1a\u56e0\u4e3aRepeatable Read\u4e0b\u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u5185\u7684\u67e5\u8be2\u90fd\u662f\u4e0e\u4e8b\u52a1\u5f00\u59cb\u65f6\u523b\u4e00\u81f4\uff0c\u6240\u4ee5\u5728B\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u662f\u4e0d\u4f1a\u8bfb\u5230\u671f\u95f4A\u4e2dinsert\u7684\u503c\u7684\u3002","title":"2.3 Repeatable Read"},{"location":"mysql/6. \u4e8b\u52a1/#24-serializable","text":"\u6240\u6709\u4e8b\u52a1\u6309\u7167\u6b21\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u56e0\u6b64\uff0c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u90fd\u4e0d\u4f1a\u51fa\u73b0\u3002\u4f46\u662f\u6548\u7387\u4f1a\u5927\u5927\u4e0b\u964d\u3002","title":"2.4 Serializable"},{"location":"mysql/6. \u4e8b\u52a1/#25","text":"\u5728MySQL\u4e2d\uff0c\u5982\u679c\u4f7f\u7528InnoDB\uff0c\u9ed8\u8ba4\u7684\u9694\u79bb\u7ea7\u522b\u662fRepeatable Read\u3002","title":"2.5 \u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/","text":"1. \u63d2\u5165\u6216\u66ff\u6362 2. \u63d2\u5165\u6216\u66f4\u65b0 3. \u63d2\u5165\u6216\u5ffd\u7565 4. \u5feb\u7167 5. \u5199\u5165\u67e5\u8be2\u7ed3\u679c\u96c6 \u4e00\u4e9b\u6280\u5de7\u3002 1. \u63d2\u5165\u6216\u66ff\u6362 \u00b6 \u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u5148\u5220\u9664\u539f\u8bb0\u5f55\uff0c\u518d\u63d2\u5165\u65b0\u8bb0\u5f55\u3002\u4e0d\u5b58\u5728\u7684\u8bdd\u5c31\u63d2\u5165\u65b0\u8bb0\u5f55\u3002 REPLACE INTO < table - name > ( column1 , ...) VALUES ( value1 , ...); 2. \u63d2\u5165\u6216\u66f4\u65b0 \u00b6 \u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u66f4\u65b0\u8be5\u8bb0\u5f55\u3002 INSERT INTO < table - name > ( column1 , ...) VALUES ( value1 , ...) ON DUPLICATE KEY UPDATE column1 = value1 , ...; 3. \u63d2\u5165\u6216\u5ffd\u7565 \u00b6 \u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u5565\u4e8b\u4e5f\u4e0d\u5e72\u76f4\u63a5\u5ffd\u7565\u3002 INSERT IGNORE INTO < table - name > ( column1 , ...) VALUES ( value1 , ...); 4. \u5feb\u7167 \u00b6 \u5bf9\u4e00\u4e2a\u8868\u8fdb\u884c\u5feb\u7167\uff0c\u5373\u590d\u5236\u4e00\u4efd\u5f53\u524d\u8868\u7684\u6570\u636e\u5230\u4e00\u4e2a\u65b0\u8868\u3002 CREATE TABLE < new - table - name > SELECT * FROM < table - name > WHERE ...; \u65b0\u521b\u5efa\u7684\u8868\u7ed3\u6784\u548c SELECT \u4f7f\u7528\u7684\u8868\u7ed3\u6784\u53ca\u6570\u636e\u5b8c\u5168\u4e00\u81f4\u3002\u4f46\u662f\u6ca1\u6709\u4e86\u7ea6\u675f\uff08\u5305\u62ec\u4e3b\u952e\u3001\u81ea\u52a8\u9012\u589e\u7b49\uff09\u3002 5. \u5199\u5165\u67e5\u8be2\u7ed3\u679c\u96c6 \u00b6 \u5c06\u67e5\u8be2\u7ed3\u679c\u96c6\u9700\u8981\u5199\u5165\u5230\u8868\u4e2d\u3002 INSERT INTO < table - name > ( column1 , ...) SELECT ... \u9700\u8981\u786e\u4fdd INSERT \u8bed\u53e5\u7684\u5b57\u6bb5\u548c SELECT \u8bed\u53e5\u7684\u5b57\u6bb5\u80fd\u4e00\u4e00\u5bf9\u5e94\u3002","title":"7. \u5b9e\u7528SQL\u8bed\u53e5"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/#1","text":"\u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u5148\u5220\u9664\u539f\u8bb0\u5f55\uff0c\u518d\u63d2\u5165\u65b0\u8bb0\u5f55\u3002\u4e0d\u5b58\u5728\u7684\u8bdd\u5c31\u63d2\u5165\u65b0\u8bb0\u5f55\u3002 REPLACE INTO < table - name > ( column1 , ...) VALUES ( value1 , ...);","title":"1. \u63d2\u5165\u6216\u66ff\u6362"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/#2","text":"\u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u66f4\u65b0\u8be5\u8bb0\u5f55\u3002 INSERT INTO < table - name > ( column1 , ...) VALUES ( value1 , ...) ON DUPLICATE KEY UPDATE column1 = value1 , ...;","title":"2. \u63d2\u5165\u6216\u66f4\u65b0"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/#3","text":"\u5982\u679c\u8bb0\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u5565\u4e8b\u4e5f\u4e0d\u5e72\u76f4\u63a5\u5ffd\u7565\u3002 INSERT IGNORE INTO < table - name > ( column1 , ...) VALUES ( value1 , ...);","title":"3. \u63d2\u5165\u6216\u5ffd\u7565"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/#4","text":"\u5bf9\u4e00\u4e2a\u8868\u8fdb\u884c\u5feb\u7167\uff0c\u5373\u590d\u5236\u4e00\u4efd\u5f53\u524d\u8868\u7684\u6570\u636e\u5230\u4e00\u4e2a\u65b0\u8868\u3002 CREATE TABLE < new - table - name > SELECT * FROM < table - name > WHERE ...; \u65b0\u521b\u5efa\u7684\u8868\u7ed3\u6784\u548c SELECT \u4f7f\u7528\u7684\u8868\u7ed3\u6784\u53ca\u6570\u636e\u5b8c\u5168\u4e00\u81f4\u3002\u4f46\u662f\u6ca1\u6709\u4e86\u7ea6\u675f\uff08\u5305\u62ec\u4e3b\u952e\u3001\u81ea\u52a8\u9012\u589e\u7b49\uff09\u3002","title":"4. \u5feb\u7167"},{"location":"mysql/7. \u5b9e\u7528SQL\u8bed\u53e5/#5","text":"\u5c06\u67e5\u8be2\u7ed3\u679c\u96c6\u9700\u8981\u5199\u5165\u5230\u8868\u4e2d\u3002 INSERT INTO < table - name > ( column1 , ...) SELECT ... \u9700\u8981\u786e\u4fdd INSERT \u8bed\u53e5\u7684\u5b57\u6bb5\u548c SELECT \u8bed\u53e5\u7684\u5b57\u6bb5\u80fd\u4e00\u4e00\u5bf9\u5e94\u3002","title":"5. \u5199\u5165\u67e5\u8be2\u7ed3\u679c\u96c6"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/","text":"1. \u6570\u503c\u7c7b\u578b 1.1 \u6574\u578b 1.2 \u6d6e\u70b9\u6570\u548c\u5b9a\u70b9\u6570 2. BIT\u7c7b\u578b 3. \u65e5\u671f\u65f6\u95f4\u7c7b\u578b 4. \u5b57\u7b26\u4e32\u7c7b\u578b 4.1 CHAR VARCHAR 4.2 BINARY VARBINARY 4.3 BLOB TEXT 4.4 ENUM 4.5 SET 1. \u6570\u503c\u7c7b\u578b \u00b6 1.1 \u6574\u578b \u00b6 Type Storage (Bytes\uff0c\u5b57\u8282) TINYINT 1 SMALLINT 2 MEDIUMINT 3 INT 4 BIGINT 8 INT [( M )] [ UNSIGNED ] [ ZEROFILL ] \u5bf9\u4e8e\u6574\u578b\u6570\u636e\uff0c\u652f\u6301\u5728\u540d\u79f0\u540e\u9762\u6307\u5b9a\u663e\u793a\u5bbd\u5ea6\u3002 \u4f8b\uff1a int(3) \u63d2\u51655666\u65f6\uff0c\u5e76\u4e0d\u4f1a\u622a\u53d6\u7cbe\u5ea6\uff0c\u800c\u662f\u6309\u7167\u5b9e\u9645\u7cbe\u5ea6\u5b58\u50a8\u3002 \u8fd9\u4e2a\u4f5c\u7528\u662f\u6570\u503c\u5bbd\u5ea6\u4e0d\u8db3\u65f6\u5728\u6570\u5b57\u524d\u9762\u586b\u6ee1\u5bbd\u5ea6\u3002\u4e00\u822c\u914d\u5408 ZEROFILL \u4f7f\u7528\u3002 ALTER TABLE user MODIFY age int ( 3 ) ZEROFILL ; SELECT * FROM user ; + ----+--------------+------------+----------------+-------+ | id | name | createDate | introduction | age | + ----+--------------+------------+----------------+-------+ | 2 | chenchm | 2019 - 04 - 01 | newer | 000 | | 67 | AGESD | 2019 - 05 - 06 | NULL | 45662 | + ----+--------------+------------+----------------+-------+ \u6ce8\u610f \uff1a\u6307\u5b9a\u4e86ZEROFILL\u65f6\uff0c\u4f1a\u81ea\u52a8\u6dfb\u52a0UNSIGNED\u3002 \u6b64\u7c7b\u578b\u8fd8\u652f\u6301 AUTO_INCREMENT \uff0c\u4e00\u4e2a\u8868\u4e2d\u6700\u591a\u53ea\u80fd\u6709\u4e00\u4e2a AUTO_INCREMENT \u5b57\u6bb5\u5e76\u5e94\u8be5\u5b9a\u4e49\u4e3a NOT NULL\u3001PRIMARY KEY|UNIQUE KEY \u3002 1.2 \u6d6e\u70b9\u6570\u548c\u5b9a\u70b9\u6570 \u00b6 # 4 \u5b57\u8282 FLOAT [( M , D )] [ UNSIGNED ] [ ZEROFILL ] # 8 \u5b57\u8282 DOUBLE [( M , D )] [ UNSIGNED ] [ ZEROFILL ] # M + 2 \u5b57\u8282 \u5b9a\u70b9\u6570 \u5728 MySQL\u5185\u90e8\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u653e \uff0c\u7cbe\u5ea6\u66f4\u9ad8 DECIMAL [( M [, D ])] [ UNSIGNED ] [ ZEROFILL ] M\uff1a\u7cbe\u5ea6\u3002\u8868\u793a\u603b\u5171\u591a\u5c11\u4f4d\u6570\u5b57\u3002 D\uff1a\u6807\u5ea6\u3002\u8868\u793a\u5c0f\u6570\u70b9\u540e\u9762\u6709\u51e0\u4f4d\u3002 \u7cbe\u5ea6\u8d85\u8fc7\u65f6\uff0c\u6d6e\u70b9\u6570\u56db\u820d\u4e94\u5165\u540e\u5b58\u50a8\uff0c\u4e0d\u4f1a\u53d1\u51fa\u8b66\u544a\uff1b\u5b9a\u70b9\u6570\u4f1a\u56db\u820d\u4e94\u5165\u540e\u5b58\u50a8\uff0c\u53d1\u51fa\u622a\u65ad\u8b66\u544a\u3002 2. BIT\u7c7b\u578b \u00b6 BIT [( M )] M\uff1a\u6307\u5b9a\u4e8c\u8fdb\u5236\u6570\u5b58\u653e\u7684\u6700\u5927\u4f4d\u6570\u3002 \u63d2\u5165\u65f6\u5148\u5c06\u5176\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u6570\uff0c\u7cbe\u5ea6\u4e0d\u8db3\u5219\u63d2\u5165\u5931\u8d25\u5e76\u4f7f\u7528 1 \u586b\u6ee1\u4f4d\u6570\u3002 \u4e0d\u80fd\u76f4\u63a5\u663e\u793a\uff0c\u4f7f\u7528 BIN \uff08\u4e8c\u8fdb\u5236\uff09\u6216 HEX \uff08\u5341\u516d\u8fdb\u5236\uff09\u51fd\u6570\u663e\u793a\u3002 MariaDB [ blog ] > UPDATE test SET id4 = 2 ; Query OK , 1 row affected ( 0 . 00 sec ) Rows matched : 1 Changed : 1 Warnings : 0 MariaDB [ blog ] > SELECT BIN ( id4 ) FROM test ; + ----------+ | BIN ( id4 ) | + ----------+ | 10 | + ----------+ 1 row in set ( 0 . 00 sec ) # \u7cbe\u5ea6\u4e0d\u591f\uff0c\u63d2\u5165\u5931\u8d25 MariaDB [ blog ] > UPDATE test SET id4 = 6 ; Query OK , 1 row affected , 1 warning ( 0 . 00 sec ) Rows matched : 1 Changed : 1 Warnings : 1 MariaDB [ blog ] > show warnings ; + ---------+------+----------------------------------------------+ | Level | Code | Message | + ---------+------+----------------------------------------------+ | Warning | 1264 | Out of range value for column 'id4' at row 1 | + ---------+------+----------------------------------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ blog ] > SELECT BIN ( id4 ) FROM test ; + ----------+ | BIN ( id4 ) | + ----------+ | 11 | + ----------+ 1 row in set ( 0 . 00 sec ) 3. \u65e5\u671f\u65f6\u95f4\u7c7b\u578b \u00b6 Data Type \u201cZero\u201d Value DATE '0000-00-00' TIME '00:00:00' DATETIME '0000-00-00 00:00:00' TIMESTAMP '0000-00-00 00:00:00' YEAR 0000 TIMESTAMP \u4f1a\u5728\u521d\u59cb\u5316\u548c\u66f4\u65b0\u65f6\u81ea\u52a8\u66f4\u65b0\u5230\u5f53\u524d\u65f6\u95f4\u6233\uff08\u63d2\u5165 NULL/CURRENT_TIMESTAMP \u65f6\u81ea\u52a8\u66f4\u65b0\uff09\uff0c\u5728\u5b58\u50a8\u548c\u68c0\u7d22\u65f6\u4f1a\u81ea\u52a8\u8f6c\u6362\uff0c\u5e76\u4e14\u4f1a\u8ddf\u7740\u7cfb\u7edf\u65f6\u533a\u6539\u53d8\u3002 \u6ce8\u610f \uff1aMySQL\u53ea\u7ed9\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2aTIMESTAMP \u5b57\u6bb5\u8bbe\u7f6e\u9ed8\u8ba4\u503cCURRENT_TIMESTAMP\uff0c\u7b2c\u4e8c\u4e2a\u9ed8\u8ba4\u503c\u8bbe\u4e3a 0000-00-00 00:00:00 \u5e76\u4e14\u4e0d\u80fd\u518d\u4fee\u6539\u6210\u9ed8\u8ba4\u503cCURRENT_TIMESTAMP\u3002 TIMESTAMP \u4e0e DATETIME \u7684\u4e3b\u8981\u533a\u522b\uff1a TIMESTAMP \u80fd\u8868\u793a\u7684\u8303\u56f4\u6bd4\u8f83\u5c0f\uff0c1970-xxx ~ 2038-xxx\uff0c\u8d85\u51fa\u8303\u56f4\u5219\u7f6e\u4e3a0000-00-00 00:00:00\uff1bDATETIME\u7684\u8303\u56f4\u5927\uff0c1000-01-01 ~ 9999-12-31\u3002 TIMESTAMP \u4e0e\u65f6\u533a\u6709\u5173 TIMESTAMP \u5728\u66f4\u65b0\u6216\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u4f46\u4e0d\u660e\u786e\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u65f6\u4e5f\u4f1a\u81ea\u52a8\u66f4\u65b0\u6210\u5f53\u524d\u65f6\u95f4\uff08\u53ef\u4fee\u6539\uff09 \u63d2\u5165 DATETIME \u7684\u5408\u6cd5\u503c\uff0c\u4e0d\u8db3\u7684\u4f4d\u7528 0 \u8865\u9f50\uff0c\u5b58\u5728\u975e\u6cd5\u503c\u7528\u201cZero\u201d Value\u66ff\u6362\uff1a \u5b57\u7b26\u4e32\u683c\u5f0f YYYY-MM-DD HH:MM:SS YY-MM-DD HH:MM:SS YYYYMMDDHHMMSS YYMMDDHHMMSS YYYYMMDD YYMMDD \u6570\u5b57\u683c\u5f0f YYYYMMDDHHMMSS YYMMDDHHMMSS YYYYMMDD YYMMDD \u51fd\u6570\u8fd4\u56de\u7ed3\u679c NOW() CURRENT_DATE \u7b49 \u5176\u5b83\u65f6\u95f4\u7c7b\u578b\u4e0e\u4e4b\u7c7b\u4f3c\u3002 \u6ce8\u610f \uff1a\u65f6\u95f4\u7c7b\u578b\u7684\u8ba1\u7b97\u8981\u901a\u8fc7 \u65f6\u95f4\u51fd\u6570 \u8fdb\u884c\u8ba1\u7b97\uff0c\u666e\u901a\u7684\u8fd0\u7b97\u4f1a\u5bfc\u81f4\u7ed3\u679c\u9519\u8bef\u3002 4. \u5b57\u7b26\u4e32\u7c7b\u578b \u00b6 MySQL5.0 4.1 CHAR VARCHAR \u00b6 \u68c0\u7d22\u65f6\uff0cVARCHAR\u4fdd\u7559\u5c3e\u90e8\u7a7a\u683c\uff0cCHAR\u4e0d\u4fdd\u7559\u3002 MariaDB [ blog ] > ALTER TABLE test ADD COLUMN str1 CHAR ( 4 ), ADD COLUMN str2 VARCHAR ( 4 ); MariaDB [ blog ] > SELECT CONCAT ( str1 , '+' ), CONCAT ( str2 , '+' ) FROM test ; + -------------------+-------------------+ | CONCAT ( str1 , '+' ) | CONCAT ( str2 , '+' ) | + -------------------+-------------------+ | NULL | NULL | | NULL | NULL | | ABC + | ABC + | + -------------------+-------------------+ 3 rows in set ( 0 . 00 sec ) 4.2 BINARY VARBINARY \u00b6 \u4e0eCHAR\u3001VARCHAR\u7c7b\u4f3c\uff0c\u4f46\u662f\u5b58\u50a8\u7684\u662f\u5b57\u8282\u5b57\u7b26\u4e32\u800c\u4e0d\u662f\u5b57\u7b26\u5b57\u7b26\u4e32\u3002\u610f\u5473\u7740\u5b83\u4eec\u5177\u6709\u4e8c\u8fdb\u5236\u5b57\u7b26\u96c6\u548c\u6392\u5e8f\u89c4\u5219\uff0c\u5e76\u4e14\u6bd4\u8f83\u548c\u6392\u5e8f\u57fa\u4e8e\u503c\u4e2d\u5b57\u8282\u7684\u6570\u503c\u3002 mysql > CREATE TABLE t ( c BINARY ( 3 )); Query OK , 0 rows affected ( 0 . 01 sec ) mysql > INSERT INTO t SET c = 'a' ; Query OK , 1 row affected ( 0 . 01 sec ) mysql > SELECT HEX ( c ), c = 'a' , c = 'a\\0\\0' from t ; + --------+---------+-------------+ | HEX ( c ) | c = 'a' | c = 'a\\0\\0' | + --------+---------+-------------+ | 610000 | 0 | 1 | + --------+---------+-------------+ 1 row in set ( 0 . 09 sec ) 4.3 BLOB TEXT \u00b6 BLOB \u7528\u4e8e\u5b58\u50a8\u53ef\u53d8\u6570\u636e\u91cf\u7684\u5927\u578b\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u503c\u662f\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u8282\u5b57\u7b26\u4e32\uff09\u3002 TEXT \u7528\u4e8e\u5b58\u50a8\u53ef\u53d8\u6570\u636e\u91cf\u7684\u5927\u578b\u975e\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u503c\u662f\u975e\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u7b26\u5b57\u7b26\u4e32\uff09\u3002 \u7c7b\u4f3c\u4e8e VARBINARY \u548c VARCHAR \u7684\u653e\u5927\u7248\uff1f 4.4 ENUM \u00b6 \u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u89c4\u5b9a\u5176\u53d6\u503c\u8303\u56f4\u3002\u679a\u4e3e\u503c\u5fc5\u987b\u662f\u5f15\u53f7\u5f15\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5e76\u4e14\u5728\u68c0\u7d22\u65f6\u4f7f\u7528\u5b9a\u4e49\u65f6\u7684\u5927\u5c0f\u5199\u3002 MariaDB [ blog ] > ALTER TABLE test MODIFY COLUMN size ENUM ( 'S' , 'l' ); MariaDB [ blog ] > INSERT INTO test VALUES ( 'C' , 'L' ); MariaDB [ blog ] > SELECT * FROM test ; + ---------+------+ | bin_str | size | + ---------+------+ | C | l | + ---------+------+ \u679a\u4e3e\u503c\u7684\u5b58\u50a8\u683c\u5f0f\u5982\u4e0b\uff1a Value Index NULL NULL '' 0 'value1' 1 ... ... \u771f\u6b63\u7684\u679a\u4e3e\u503c\u4ece\u5e8f\u53f71\u5f00\u59cb\u5b58\u50a8\uff0c \u6392\u5e8f\u7684\u65f6\u5019\u662f\u6839\u636e\u5e8f\u53f7\u8fdb\u884c\u6392\u5e8f\u7684 \uff0c\u53ef\u4ee5\u901a\u8fc7 ORDER BY CAST(col AS CHAR) or ORDER BY CONCAT(col) \u6765\u4f7f\u7528\u503c\u8fdb\u884c\u6392\u5e8f\u3002 4.5 SET \u00b6 \u4e0eENUM\u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f\u53ef\u4ee5\u9009\u53d6\u591a\u4e2a\u503c\uff0c\u800cENUM\u6bcf\u6b21\u53ea\u80fd\u9009\u53d6\u4e00\u4e2a\u3002\u5b58\u50a8\u8303\u56f4\uff1a0~64\u4e2a\u4e0d\u91cd\u590d\u7684\u503c\u3002 \u5c3e\u90e8\u7a7a\u683c\u4f1a\u88ab\u5220\u9664\u3002 \u68c0\u7d22\u65f6\u4f7f\u7528\u5b9a\u4e49\u65f6\u7684\u5927\u5c0f\u5199\u3002 MariaDB [ blog ] > ALTER TABLE test ADD COLUMN set_str SET ( 'A' , 'B' , 'C' ); MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 'a' ); MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 1 ); # \u53d6\u591a\u503c\uff0c\u9017\u53f7\u4e24\u8fb9\u4e00\u5b9a\u4e0d\u8981\u6709\u7a7a\u683c MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 'a,b' ); MariaDB [ blog ] > SELECT set_str FROM test WHERE set_str != 'NULL' ; + ---------+ | set_str | + ---------+ | A | | A | | A , B | + ---------+","title":"8. MySQL\u6570\u636e\u7c7b\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#1","text":"","title":"1. \u6570\u503c\u7c7b\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#11","text":"Type Storage (Bytes\uff0c\u5b57\u8282) TINYINT 1 SMALLINT 2 MEDIUMINT 3 INT 4 BIGINT 8 INT [( M )] [ UNSIGNED ] [ ZEROFILL ] \u5bf9\u4e8e\u6574\u578b\u6570\u636e\uff0c\u652f\u6301\u5728\u540d\u79f0\u540e\u9762\u6307\u5b9a\u663e\u793a\u5bbd\u5ea6\u3002 \u4f8b\uff1a int(3) \u63d2\u51655666\u65f6\uff0c\u5e76\u4e0d\u4f1a\u622a\u53d6\u7cbe\u5ea6\uff0c\u800c\u662f\u6309\u7167\u5b9e\u9645\u7cbe\u5ea6\u5b58\u50a8\u3002 \u8fd9\u4e2a\u4f5c\u7528\u662f\u6570\u503c\u5bbd\u5ea6\u4e0d\u8db3\u65f6\u5728\u6570\u5b57\u524d\u9762\u586b\u6ee1\u5bbd\u5ea6\u3002\u4e00\u822c\u914d\u5408 ZEROFILL \u4f7f\u7528\u3002 ALTER TABLE user MODIFY age int ( 3 ) ZEROFILL ; SELECT * FROM user ; + ----+--------------+------------+----------------+-------+ | id | name | createDate | introduction | age | + ----+--------------+------------+----------------+-------+ | 2 | chenchm | 2019 - 04 - 01 | newer | 000 | | 67 | AGESD | 2019 - 05 - 06 | NULL | 45662 | + ----+--------------+------------+----------------+-------+ \u6ce8\u610f \uff1a\u6307\u5b9a\u4e86ZEROFILL\u65f6\uff0c\u4f1a\u81ea\u52a8\u6dfb\u52a0UNSIGNED\u3002 \u6b64\u7c7b\u578b\u8fd8\u652f\u6301 AUTO_INCREMENT \uff0c\u4e00\u4e2a\u8868\u4e2d\u6700\u591a\u53ea\u80fd\u6709\u4e00\u4e2a AUTO_INCREMENT \u5b57\u6bb5\u5e76\u5e94\u8be5\u5b9a\u4e49\u4e3a NOT NULL\u3001PRIMARY KEY|UNIQUE KEY \u3002","title":"1.1 \u6574\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#12","text":"# 4 \u5b57\u8282 FLOAT [( M , D )] [ UNSIGNED ] [ ZEROFILL ] # 8 \u5b57\u8282 DOUBLE [( M , D )] [ UNSIGNED ] [ ZEROFILL ] # M + 2 \u5b57\u8282 \u5b9a\u70b9\u6570 \u5728 MySQL\u5185\u90e8\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u5b58\u653e \uff0c\u7cbe\u5ea6\u66f4\u9ad8 DECIMAL [( M [, D ])] [ UNSIGNED ] [ ZEROFILL ] M\uff1a\u7cbe\u5ea6\u3002\u8868\u793a\u603b\u5171\u591a\u5c11\u4f4d\u6570\u5b57\u3002 D\uff1a\u6807\u5ea6\u3002\u8868\u793a\u5c0f\u6570\u70b9\u540e\u9762\u6709\u51e0\u4f4d\u3002 \u7cbe\u5ea6\u8d85\u8fc7\u65f6\uff0c\u6d6e\u70b9\u6570\u56db\u820d\u4e94\u5165\u540e\u5b58\u50a8\uff0c\u4e0d\u4f1a\u53d1\u51fa\u8b66\u544a\uff1b\u5b9a\u70b9\u6570\u4f1a\u56db\u820d\u4e94\u5165\u540e\u5b58\u50a8\uff0c\u53d1\u51fa\u622a\u65ad\u8b66\u544a\u3002","title":"1.2 \u6d6e\u70b9\u6570\u548c\u5b9a\u70b9\u6570"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#2-bit","text":"BIT [( M )] M\uff1a\u6307\u5b9a\u4e8c\u8fdb\u5236\u6570\u5b58\u653e\u7684\u6700\u5927\u4f4d\u6570\u3002 \u63d2\u5165\u65f6\u5148\u5c06\u5176\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u6570\uff0c\u7cbe\u5ea6\u4e0d\u8db3\u5219\u63d2\u5165\u5931\u8d25\u5e76\u4f7f\u7528 1 \u586b\u6ee1\u4f4d\u6570\u3002 \u4e0d\u80fd\u76f4\u63a5\u663e\u793a\uff0c\u4f7f\u7528 BIN \uff08\u4e8c\u8fdb\u5236\uff09\u6216 HEX \uff08\u5341\u516d\u8fdb\u5236\uff09\u51fd\u6570\u663e\u793a\u3002 MariaDB [ blog ] > UPDATE test SET id4 = 2 ; Query OK , 1 row affected ( 0 . 00 sec ) Rows matched : 1 Changed : 1 Warnings : 0 MariaDB [ blog ] > SELECT BIN ( id4 ) FROM test ; + ----------+ | BIN ( id4 ) | + ----------+ | 10 | + ----------+ 1 row in set ( 0 . 00 sec ) # \u7cbe\u5ea6\u4e0d\u591f\uff0c\u63d2\u5165\u5931\u8d25 MariaDB [ blog ] > UPDATE test SET id4 = 6 ; Query OK , 1 row affected , 1 warning ( 0 . 00 sec ) Rows matched : 1 Changed : 1 Warnings : 1 MariaDB [ blog ] > show warnings ; + ---------+------+----------------------------------------------+ | Level | Code | Message | + ---------+------+----------------------------------------------+ | Warning | 1264 | Out of range value for column 'id4' at row 1 | + ---------+------+----------------------------------------------+ 1 row in set ( 0 . 00 sec ) MariaDB [ blog ] > SELECT BIN ( id4 ) FROM test ; + ----------+ | BIN ( id4 ) | + ----------+ | 11 | + ----------+ 1 row in set ( 0 . 00 sec )","title":"2. BIT\u7c7b\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#3","text":"Data Type \u201cZero\u201d Value DATE '0000-00-00' TIME '00:00:00' DATETIME '0000-00-00 00:00:00' TIMESTAMP '0000-00-00 00:00:00' YEAR 0000 TIMESTAMP \u4f1a\u5728\u521d\u59cb\u5316\u548c\u66f4\u65b0\u65f6\u81ea\u52a8\u66f4\u65b0\u5230\u5f53\u524d\u65f6\u95f4\u6233\uff08\u63d2\u5165 NULL/CURRENT_TIMESTAMP \u65f6\u81ea\u52a8\u66f4\u65b0\uff09\uff0c\u5728\u5b58\u50a8\u548c\u68c0\u7d22\u65f6\u4f1a\u81ea\u52a8\u8f6c\u6362\uff0c\u5e76\u4e14\u4f1a\u8ddf\u7740\u7cfb\u7edf\u65f6\u533a\u6539\u53d8\u3002 \u6ce8\u610f \uff1aMySQL\u53ea\u7ed9\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2aTIMESTAMP \u5b57\u6bb5\u8bbe\u7f6e\u9ed8\u8ba4\u503cCURRENT_TIMESTAMP\uff0c\u7b2c\u4e8c\u4e2a\u9ed8\u8ba4\u503c\u8bbe\u4e3a 0000-00-00 00:00:00 \u5e76\u4e14\u4e0d\u80fd\u518d\u4fee\u6539\u6210\u9ed8\u8ba4\u503cCURRENT_TIMESTAMP\u3002 TIMESTAMP \u4e0e DATETIME \u7684\u4e3b\u8981\u533a\u522b\uff1a TIMESTAMP \u80fd\u8868\u793a\u7684\u8303\u56f4\u6bd4\u8f83\u5c0f\uff0c1970-xxx ~ 2038-xxx\uff0c\u8d85\u51fa\u8303\u56f4\u5219\u7f6e\u4e3a0000-00-00 00:00:00\uff1bDATETIME\u7684\u8303\u56f4\u5927\uff0c1000-01-01 ~ 9999-12-31\u3002 TIMESTAMP \u4e0e\u65f6\u533a\u6709\u5173 TIMESTAMP \u5728\u66f4\u65b0\u6216\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u4f46\u4e0d\u660e\u786e\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u65f6\u4e5f\u4f1a\u81ea\u52a8\u66f4\u65b0\u6210\u5f53\u524d\u65f6\u95f4\uff08\u53ef\u4fee\u6539\uff09 \u63d2\u5165 DATETIME \u7684\u5408\u6cd5\u503c\uff0c\u4e0d\u8db3\u7684\u4f4d\u7528 0 \u8865\u9f50\uff0c\u5b58\u5728\u975e\u6cd5\u503c\u7528\u201cZero\u201d Value\u66ff\u6362\uff1a \u5b57\u7b26\u4e32\u683c\u5f0f YYYY-MM-DD HH:MM:SS YY-MM-DD HH:MM:SS YYYYMMDDHHMMSS YYMMDDHHMMSS YYYYMMDD YYMMDD \u6570\u5b57\u683c\u5f0f YYYYMMDDHHMMSS YYMMDDHHMMSS YYYYMMDD YYMMDD \u51fd\u6570\u8fd4\u56de\u7ed3\u679c NOW() CURRENT_DATE \u7b49 \u5176\u5b83\u65f6\u95f4\u7c7b\u578b\u4e0e\u4e4b\u7c7b\u4f3c\u3002 \u6ce8\u610f \uff1a\u65f6\u95f4\u7c7b\u578b\u7684\u8ba1\u7b97\u8981\u901a\u8fc7 \u65f6\u95f4\u51fd\u6570 \u8fdb\u884c\u8ba1\u7b97\uff0c\u666e\u901a\u7684\u8fd0\u7b97\u4f1a\u5bfc\u81f4\u7ed3\u679c\u9519\u8bef\u3002","title":"3. \u65e5\u671f\u65f6\u95f4\u7c7b\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#4","text":"MySQL5.0","title":"4. \u5b57\u7b26\u4e32\u7c7b\u578b"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#41-char-varchar","text":"\u68c0\u7d22\u65f6\uff0cVARCHAR\u4fdd\u7559\u5c3e\u90e8\u7a7a\u683c\uff0cCHAR\u4e0d\u4fdd\u7559\u3002 MariaDB [ blog ] > ALTER TABLE test ADD COLUMN str1 CHAR ( 4 ), ADD COLUMN str2 VARCHAR ( 4 ); MariaDB [ blog ] > SELECT CONCAT ( str1 , '+' ), CONCAT ( str2 , '+' ) FROM test ; + -------------------+-------------------+ | CONCAT ( str1 , '+' ) | CONCAT ( str2 , '+' ) | + -------------------+-------------------+ | NULL | NULL | | NULL | NULL | | ABC + | ABC + | + -------------------+-------------------+ 3 rows in set ( 0 . 00 sec )","title":"4.1 CHAR VARCHAR"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#42-binary-varbinary","text":"\u4e0eCHAR\u3001VARCHAR\u7c7b\u4f3c\uff0c\u4f46\u662f\u5b58\u50a8\u7684\u662f\u5b57\u8282\u5b57\u7b26\u4e32\u800c\u4e0d\u662f\u5b57\u7b26\u5b57\u7b26\u4e32\u3002\u610f\u5473\u7740\u5b83\u4eec\u5177\u6709\u4e8c\u8fdb\u5236\u5b57\u7b26\u96c6\u548c\u6392\u5e8f\u89c4\u5219\uff0c\u5e76\u4e14\u6bd4\u8f83\u548c\u6392\u5e8f\u57fa\u4e8e\u503c\u4e2d\u5b57\u8282\u7684\u6570\u503c\u3002 mysql > CREATE TABLE t ( c BINARY ( 3 )); Query OK , 0 rows affected ( 0 . 01 sec ) mysql > INSERT INTO t SET c = 'a' ; Query OK , 1 row affected ( 0 . 01 sec ) mysql > SELECT HEX ( c ), c = 'a' , c = 'a\\0\\0' from t ; + --------+---------+-------------+ | HEX ( c ) | c = 'a' | c = 'a\\0\\0' | + --------+---------+-------------+ | 610000 | 0 | 1 | + --------+---------+-------------+ 1 row in set ( 0 . 09 sec )","title":"4.2 BINARY VARBINARY"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#43-blob-text","text":"BLOB \u7528\u4e8e\u5b58\u50a8\u53ef\u53d8\u6570\u636e\u91cf\u7684\u5927\u578b\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u503c\u662f\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u8282\u5b57\u7b26\u4e32\uff09\u3002 TEXT \u7528\u4e8e\u5b58\u50a8\u53ef\u53d8\u6570\u636e\u91cf\u7684\u5927\u578b\u975e\u4e8c\u8fdb\u5236\u5bf9\u8c61\uff0c\u503c\u662f\u975e\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u7b26\u5b57\u7b26\u4e32\uff09\u3002 \u7c7b\u4f3c\u4e8e VARBINARY \u548c VARCHAR \u7684\u653e\u5927\u7248\uff1f","title":"4.3 BLOB TEXT"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#44-enum","text":"\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u89c4\u5b9a\u5176\u53d6\u503c\u8303\u56f4\u3002\u679a\u4e3e\u503c\u5fc5\u987b\u662f\u5f15\u53f7\u5f15\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5e76\u4e14\u5728\u68c0\u7d22\u65f6\u4f7f\u7528\u5b9a\u4e49\u65f6\u7684\u5927\u5c0f\u5199\u3002 MariaDB [ blog ] > ALTER TABLE test MODIFY COLUMN size ENUM ( 'S' , 'l' ); MariaDB [ blog ] > INSERT INTO test VALUES ( 'C' , 'L' ); MariaDB [ blog ] > SELECT * FROM test ; + ---------+------+ | bin_str | size | + ---------+------+ | C | l | + ---------+------+ \u679a\u4e3e\u503c\u7684\u5b58\u50a8\u683c\u5f0f\u5982\u4e0b\uff1a Value Index NULL NULL '' 0 'value1' 1 ... ... \u771f\u6b63\u7684\u679a\u4e3e\u503c\u4ece\u5e8f\u53f71\u5f00\u59cb\u5b58\u50a8\uff0c \u6392\u5e8f\u7684\u65f6\u5019\u662f\u6839\u636e\u5e8f\u53f7\u8fdb\u884c\u6392\u5e8f\u7684 \uff0c\u53ef\u4ee5\u901a\u8fc7 ORDER BY CAST(col AS CHAR) or ORDER BY CONCAT(col) \u6765\u4f7f\u7528\u503c\u8fdb\u884c\u6392\u5e8f\u3002","title":"4.4 ENUM"},{"location":"mysql/8. MySQL\u6570\u636e\u7c7b\u578b/#45-set","text":"\u4e0eENUM\u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f\u53ef\u4ee5\u9009\u53d6\u591a\u4e2a\u503c\uff0c\u800cENUM\u6bcf\u6b21\u53ea\u80fd\u9009\u53d6\u4e00\u4e2a\u3002\u5b58\u50a8\u8303\u56f4\uff1a0~64\u4e2a\u4e0d\u91cd\u590d\u7684\u503c\u3002 \u5c3e\u90e8\u7a7a\u683c\u4f1a\u88ab\u5220\u9664\u3002 \u68c0\u7d22\u65f6\u4f7f\u7528\u5b9a\u4e49\u65f6\u7684\u5927\u5c0f\u5199\u3002 MariaDB [ blog ] > ALTER TABLE test ADD COLUMN set_str SET ( 'A' , 'B' , 'C' ); MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 'a' ); MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 1 ); # \u53d6\u591a\u503c\uff0c\u9017\u53f7\u4e24\u8fb9\u4e00\u5b9a\u4e0d\u8981\u6709\u7a7a\u683c MariaDB [ blog ] > INSERT INTO test ( set_str ) VALUES ( 'a,b' ); MariaDB [ blog ] > SELECT set_str FROM test WHERE set_str != 'NULL' ; + ---------+ | set_str | + ---------+ | A | | A | | A , B | + ---------+","title":"4.5 SET"},{"location":"mysql/9. MySQL\u7684\u8fd0\u7b97\u7b26/","text":"1. \u7b97\u672f\u8fd0\u7b97\u7b26 2. \u6bd4\u8f83\u8fd0\u7b97\u7b26 3. \u903b\u8f91/\u5e03\u5c14\u8fd0\u7b97\u7b26 4. \u4f4d\u8fd0\u7b97\u7b26 1. \u7b97\u672f\u8fd0\u7b97\u7b26 \u00b6 + - * / \u6216 n1 DIV n2 % \u6216 MOD(n1, n2) \u9664\u6570\u4e3a0\u65f6\uff0c\u8fd4\u56deNULL\u3002 2. \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u00b6 \u5b57\u7b26\u4e32\u4ee5\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u65b9\u5f0f\u6bd4\u8f83 NULL\u4e0d\u80fd\u7528 = \u6bd4\u8f83 <=> \u548c = \u7684\u533a\u522b\u662f\u53ef\u4ee5\u8fdb\u884cNULL\u7684\u6bd4\u8f83 MariaDB [ blog ] > SELECT 10 = 2 . 3 , 'a' = 'A' , NULL = 0 , NULL <=> NULL ; + --------+---------+--------+-------------+ | 10 = 2 . 3 | 'a' = 'A' | NULL = 0 | NULL <=> NULL | + --------+---------+--------+-------------+ | 0 | 1 | NULL | 1 | + --------+---------+--------+-------------+ 3. \u903b\u8f91/\u5e03\u5c14\u8fd0\u7b97\u7b26 \u00b6 AND \u6216 && \uff1a\u4efb\u610f\u4e00\u4e2a\u4e3aNULL\uff0c\u5219\u7ed3\u679c\u4e3aNULL OR \u6216 || \uff1a\u4e00\u4e2a\u4e3aNULL\uff0c\u53e6\u4e00\u4e2a\u4e3a\u975e\u96f6\u503c\uff0c\u5219\u7ed3\u679c\u4e3a1\uff0c\u5426\u5219\u4e3aNULL NOT \u6216 ! XOR \uff1a\u903b\u8f91\u5f02\u6216 MariaDB [ blog ] > SELECT 1 AND 0 , NULL AND 1 ; + ---------+------------+ | 1 AND 0 | NULL AND 1 | + ---------+------------+ | 0 | NULL | + ---------+------------+ MariaDB [ blog ] > SELECT 1 OR 0 , 1 OR NULL , 0 OR NULL , NULL OR NULL ; + --------+-----------+-----------+--------------+ | 1 OR 0 | 1 OR NULL | 0 OR NULL | NULL OR NULL | + --------+-----------+-----------+--------------+ | 1 | 1 | NULL | NULL | + --------+-----------+-----------+--------------+ MariaDB [ blog ] > SELECT NOT NULL , NOT 2 . 3 ; + ----------+---------+ | NOT NULL | NOT 2 . 3 | + ----------+---------+ | NULL | 0 | + ----------+---------+ MariaDB [ blog ] > SELECT 1 XOR 0 , NULL XOR 0 ; + ---------+------------+ | 1 XOR 0 | NULL XOR 0 | + ---------+------------+ | 1 | NULL | + ---------+------------+ 4. \u4f4d\u8fd0\u7b97\u7b26 \u00b6 \u5c06\u64cd\u4f5c\u6570\u8f6c\u5316\u4e3a\u4e8c\u8fdb\u5236\u540e\u5bf9\u6bcf\u4e00\u4f4d\u8fdb\u884c\u6307\u5b9a\u7684\u4f4d\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u518d\u8f6c\u5316\u4e3a\u5341\u8fdb\u5236\u6570\u3002 & | ~ \uff1a\u4f4d\u53d6\u53cd ^ \uff1a\u4f4d\u5f02\u6216 << \uff1a\u4f4d\u5de6\u79fb >> \uff1a\u4f4d\u53f3\u79fb \u4e0d\u591f\u7684\u75280\u8865\u4f4d\u3002 MariaDB [ blog ] > SELECT ~ 1 ; + ----------------------+ | ~ 1 | + ----------------------+ | 18446744073709551614 | + ----------------------+","title":"9. MySQL\u7684\u8fd0\u7b97\u7b26"},{"location":"mysql/9. MySQL\u7684\u8fd0\u7b97\u7b26/#1","text":"+ - * / \u6216 n1 DIV n2 % \u6216 MOD(n1, n2) \u9664\u6570\u4e3a0\u65f6\uff0c\u8fd4\u56deNULL\u3002","title":"1. \u7b97\u672f\u8fd0\u7b97\u7b26"},{"location":"mysql/9. MySQL\u7684\u8fd0\u7b97\u7b26/#2","text":"\u5b57\u7b26\u4e32\u4ee5\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u65b9\u5f0f\u6bd4\u8f83 NULL\u4e0d\u80fd\u7528 = \u6bd4\u8f83 <=> \u548c = \u7684\u533a\u522b\u662f\u53ef\u4ee5\u8fdb\u884cNULL\u7684\u6bd4\u8f83 MariaDB [ blog ] > SELECT 10 = 2 . 3 , 'a' = 'A' , NULL = 0 , NULL <=> NULL ; + --------+---------+--------+-------------+ | 10 = 2 . 3 | 'a' = 'A' | NULL = 0 | NULL <=> NULL | + --------+---------+--------+-------------+ | 0 | 1 | NULL | 1 | + --------+---------+--------+-------------+","title":"2. \u6bd4\u8f83\u8fd0\u7b97\u7b26"},{"location":"mysql/9. MySQL\u7684\u8fd0\u7b97\u7b26/#3","text":"AND \u6216 && \uff1a\u4efb\u610f\u4e00\u4e2a\u4e3aNULL\uff0c\u5219\u7ed3\u679c\u4e3aNULL OR \u6216 || \uff1a\u4e00\u4e2a\u4e3aNULL\uff0c\u53e6\u4e00\u4e2a\u4e3a\u975e\u96f6\u503c\uff0c\u5219\u7ed3\u679c\u4e3a1\uff0c\u5426\u5219\u4e3aNULL NOT \u6216 ! XOR \uff1a\u903b\u8f91\u5f02\u6216 MariaDB [ blog ] > SELECT 1 AND 0 , NULL AND 1 ; + ---------+------------+ | 1 AND 0 | NULL AND 1 | + ---------+------------+ | 0 | NULL | + ---------+------------+ MariaDB [ blog ] > SELECT 1 OR 0 , 1 OR NULL , 0 OR NULL , NULL OR NULL ; + --------+-----------+-----------+--------------+ | 1 OR 0 | 1 OR NULL | 0 OR NULL | NULL OR NULL | + --------+-----------+-----------+--------------+ | 1 | 1 | NULL | NULL | + --------+-----------+-----------+--------------+ MariaDB [ blog ] > SELECT NOT NULL , NOT 2 . 3 ; + ----------+---------+ | NOT NULL | NOT 2 . 3 | + ----------+---------+ | NULL | 0 | + ----------+---------+ MariaDB [ blog ] > SELECT 1 XOR 0 , NULL XOR 0 ; + ---------+------------+ | 1 XOR 0 | NULL XOR 0 | + ---------+------------+ | 1 | NULL | + ---------+------------+","title":"3. \u903b\u8f91/\u5e03\u5c14\u8fd0\u7b97\u7b26"},{"location":"mysql/9. MySQL\u7684\u8fd0\u7b97\u7b26/#4","text":"\u5c06\u64cd\u4f5c\u6570\u8f6c\u5316\u4e3a\u4e8c\u8fdb\u5236\u540e\u5bf9\u6bcf\u4e00\u4f4d\u8fdb\u884c\u6307\u5b9a\u7684\u4f4d\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u518d\u8f6c\u5316\u4e3a\u5341\u8fdb\u5236\u6570\u3002 & | ~ \uff1a\u4f4d\u53d6\u53cd ^ \uff1a\u4f4d\u5f02\u6216 << \uff1a\u4f4d\u5de6\u79fb >> \uff1a\u4f4d\u53f3\u79fb \u4e0d\u591f\u7684\u75280\u8865\u4f4d\u3002 MariaDB [ blog ] > SELECT ~ 1 ; + ----------------------+ | ~ 1 | + ----------------------+ | 18446744073709551614 | + ----------------------+","title":"4. \u4f4d\u8fd0\u7b97\u7b26"},{"location":"python/@Property/","text":"@Property \u662fpython\u5185\u7f6e\u7684\u88c5\u9970\u5668\u3002\u7528\u4e8e\u9650\u5236\u5c5e\u6027\u7684\u8bbf\u95ee\u3002 \u5728\u4e00\u4e2a\u5c5e\u6027\u4e0a\u9762\u52a0\u4e86\u8be5\u88c5\u9970\u5668\u540e\uff0c\u8be5\u5c5e\u6027\u53d8\u4e3a\u53ea\u8bfb\uff0c\u76f8\u5f53\u4e8e getter \u65b9\u6cd5\u3002 class Student ( object ): @Property def name ( self ): return self . _name \u5f53\u7136\u4e5f\u53ef\u4ee5\u8bbe\u7f6e setter \u65b9\u6cd5\uff1a class Student ( object ): @Property def name ( self ): return self . _name @name.setter def name ( self , value ): # \u4e00\u4e9b\u68c0\u67e5\u4ee3\u7801... self . _name = value","title":"@Property"},{"location":"python/asyncore\u6a21\u5757/","text":"1. \u6982\u5ff5 2. asyncore.loop([timeout[, use_poll[, map[, count]]]]) 3. class asyncore.dispatcher 4. class asyncore.dispatcher_with_send 5. class asyncore.file_dispatcher 6. class asyncore.file_wrapper 7. \u4e3e\u4f8b 1. \u6982\u5ff5 \u00b6 asyncore \u662fPython\u7684\u5f02\u6b65\u901a\u4fe1\u6a21\u5757\u3002 \u6b64\u6a21\u5757\u63d0\u4f9b\u4e86\u7f16\u5199\u5f02\u6b65\u5957\u63a5\u5b57\u670d\u52a1\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u57fa\u672c\u7ed3\u6784\u3002 \u662f\u7c7b\u6bd4\u591a\u7ebf\u7a0b\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u5728I/O\u53d7\u9650\u7684\u60c5\u51b5\u4e0b\u5f88\u5b9e\u7528\u3002\u591a\u7ebf\u7a0b\u9002\u7528\u53d7\u9650\u4e8e\u5904\u7406\u5668\u7684\u7a0b\u5e8f\u3002 \u8be5\u6a21\u5757\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7c7b\uff0c\u5b83\u4eec\u7684\u57fa\u672c\u601d\u60f3\u662f\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u7f51\u7edc\u901a\u9053 channel \u3002 \u4e00\u65e6\u521d\u59cbchannel\u88ab\u521b\u5efa\uff0c\u5c31\u8c03\u7528 loop() \u65b9\u6cd5\uff0c\u5c06\u4e00\u76f4\u6301\u7eed\u5230\u6700\u540e\u4e00\u4e2achannel\uff08\u5305\u62ec\u5728\u5f02\u6b65\u670d\u52a1\u671f\u95f4\u6dfb\u52a0\u5230map\u4e2d\u7684channel\uff09\u5173\u95ed\u3002 \u4e0b\u9762\u662f\u4e00\u4e9b\u65b9\u6cd5\u548c\u7c7b\u3002 2. asyncore.loop([timeout[, use_poll[, map[, count]]]]) \u00b6 \u8fdb\u5165\u4e00\u4e2apolling\u5faa\u73af\uff0c\u76f4\u5230\u5230\u8fbe\u4e86\u5faa\u73af\u6b21\u6570 count \u6216\u6240\u6709\u7684channel\u5173\u95ed\u3002 timeout \u7528\u4e8e\u8bbe\u7f6e\u76f8\u5e94\u7684 select() or poll() \u8c03\u7528\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u9ed8\u8ba430\u79d2\u3002 use_poll \u4e3a True \u65f6\uff0c\u4f18\u5148\u4f7f\u7528 poll() \uff0c\u9ed8\u8ba4\u4e3a False \u3002 map \u662f\u5c06socket.id\u4e0e\u76d1\u89c6\u7684channel\u6620\u5c04\u8d77\u6765\u7684\u5b57\u5178\u3002channels\u88ab\u5173\u95ed\u65f6\u5c06\u4ecemap\u4e2d\u5220\u9664\u3002channels\uff08 asyncore.dispatcher , asynchat.async_chat \u53ca\u5b83\u4eec\u5b50\u7c7b\u7684\u5b9e\u4f8b\uff09\u53ef\u4ee5\u88ab\u81ea\u7531\u6df7\u5408\u3002 3. class asyncore.dispatcher \u00b6 \u5b83\u662f\u5bf9\u4f4e\u7ea7\u7684 socket \u5bf9\u8c61\u7684\u7b80\u5355\u5c01\u88c5\u3002\u5b83\u6709\u51e0\u4e2a\u7b80\u5355\u7684 event-handling \u65b9\u6cd5\u7528\u4e8e\u5f02\u6b65\u5faa\u73af\u7684\u8c03\u7528\u3002\u5b83\u53ef\u4ee5\u88ab\u770b\u4f5c\u662f\u6b63\u5e38\u7684\u975e\u963b\u585e\u5f0f\u7684socket\u5bf9\u8c61\u3002 \u5728\u67d0\u4e9b\u65f6\u95f4\u6216\u67d0\u4e9b\u8fde\u63a5\u72b6\u6001\u89e6\u53d1\u7684 \u4f4e\u7ea7\u522b\u4e8b\u4ef6 \uff08\u5982\u53ef\u8bfb\u3001\u53ef\u5199\u72b6\u6001\uff09\u4f1a\u544a\u8bc9\u5f02\u6b65\u5faa\u73af\u67d0\u4e9b \u66f4\u9ad8\u7ea7\u522b\u7684\u4e8b\u4ef6 \uff08\u5982\u8fde\u63a5\u72b6\u6001\uff09\u5df2\u7ecf\u53d1\u751f\uff08\u6bd4\u5982\uff0csocket\u53ef\u5199\u65f6\u8be5socket\u8fde\u63a5\u5df2\u7ecf\u88ab\u5efa\u7acb\u4e86\uff09\u3002\u9690\u542b\u7684\u66f4\u9ad8\u7ea7\u522b\u4e8b\u4ef6\u662f\uff1a Event Description handle_connect() \u6697\u793a\u5728 the first read or write event \u65f6\u5df2\u7ecf\u53d1\u751f handle_close() \u6697\u793a\u5728 a read event with no data available\u65f6\u5df2\u7ecf\u53d1\u751f handle_accept() \u6697\u793a\u5728 a read event on a listening socket\u65f6\u5df2\u7ecf\u53d1\u751f \u5728\u5f02\u6b65\u5904\u7406\u671f\u95f4\uff0c\u6bcf\u4e2a\u88ab\u6620\u5c04\u7684channel\u7684 readable() and writable() \u65b9\u6cd5\u7528\u4e8e\u6307\u793a\u662f\u5426channel\u7684socket\u5e94\u8be5\u88ab\u52a0\u5165\u5230\u8bfb\u5199\u4e8b\u4ef6\u5217\u8868\u3002 \u4e8e\u662f\uff0cchannel\u7684\u4e8b\u4ef6\u8303\u56f4\u8981\u6bd4\u57fa\u672c\u7684socket\u4e8b\u4ef6\u5927\u3002\u4e0b\u65b9\u5217\u8868\u7684\u65b9\u6cd5\u53ef\u5728\u5b50\u7c7b\u4e2d\u91cd\u5199\uff1a handle_read () \u5f53\u5f02\u6b65\u5faa\u73af\u68c0\u6d4b\u5230\u901a\u9053\u5957\u63a5\u5b57\u4e0a\u7684read()\u8c03\u7528\u4f1a\u6210\u529f\u65f6\u8c03\u7528\u3002 handle_write () \u5f53\u5f02\u6b65\u5faa\u73af\u68c0\u6d4b\u5230\u4e00\u4e2a\u53ef\u5199\u7684socket\u80fd\u88ab\u5199\u5165\u65f6\u8c03\u7528\u3002\u901a\u5e38\uff0c\u6b64\u65b9\u6cd5\u4e3a\u4e86\u6027\u80fd\u8003\u8651\u5c06\u5b9e\u73b0\u5fc5\u8981\u7684\u7f13\u51b2\u3002\u4f8b\u5982\uff1a def handle_write ( self ): sent = self . send ( self . buffer ) self . buffer = self . buffer [ sent :] handle_expt () \u5f53socket\u8fde\u63a5\u5e26\u6709out of band (OOB)\u6570\u636e\u7684\u65f6\u5019\u8c03\u7528\u3002OOB\u652f\u6301\u5f88\u5c11\uff0c\u51e0\u4e4e\u4e0d\u7528\u3002 handle_connect () handle_close () handle_error () \u5728\u5f15\u53d1\u5f02\u5e38\u5e76\u4e14\u672a\u4ee5\u5176\u4ed6\u65b9\u5f0f\u5904\u7406\u65f6\u8c03\u7528\u3002\u9ed8\u8ba4\u6253\u5370\u7cbe\u7b80\u56de\u6eaf\u4fe1\u606f\u3002 handle_accept () readable () \u9ed8\u8ba4\u662f True \u3002 writable () \u9ed8\u8ba4\u662f True \u3002 \u6b64\u5916\uff0c\u6bcf\u4e2a\u901a\u9053\u90fd\u59d4\u6258\u6216\u6269\u5c55\u4e86\u8bb8\u591a \u5957\u63a5\u5b57\u65b9\u6cd5 \u3002\u5176\u4e2d\u5927\u591a\u6570\u4e0e\u5176\u5957\u63a5\u5b57\u51e0\u4e4e\u5b8c\u5168\u76f8\u540c\u3002\u5982\u4e0b\uff1a create_socket ( family , type ) connect ( address ) \u4f5c\u4e3a\u4e00\u4e2a\u6b63\u5e38\u7684socket\u5bf9\u8c61\u3002 address \u662f\u5143\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u4e3b\u673a\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u65f6\u7aef\u53e3\u53f7\u3002 send ( data ) recv ( buffer_size ) \u4ecesocket\u7684\u7ec8\u7aef\u8bfb\u53d6\u6700\u5927 buffer_size \u4e2a\u5b57\u8282\u3002\u7a7a\u5b57\u7b26\u4e32\u610f\u5473\u7740channel\u5df2\u7ecf\u4ece\u53e6\u4e00\u7aef\u88ab\u5173\u95ed\u4e86\u3002\u6ce8\u610f\uff0crecv()\u4f7f\u7528 EAGAIN or EWOULDBLOCK \u53ef\u80fd\u4f1a\u5f15\u53d1 socket.error \uff0c\u5373\u4f7fselect.select()\u6216select.poll()\u5df2\u62a5\u544a\u5957\u63a5\u5b57\u5df2\u51c6\u5907\u597d\u8fdb\u884c\u8bfb\u53d6\u3002 listen ( backlog ) \u4fa6\u542c\u5bf9\u5957\u63a5\u5b57\u7684\u8fde\u63a5\u3002 backlog \u6307\u5b9a\u4e86\u6700\u5927\u6392\u961f\u8fde\u63a5\u6570\u91cf\uff0c\u81f3\u5c11\u4e3a1\uff1b\u6700\u5927\u7684\u8fde\u63a5\u6570\u91cf\u662f\u7cfb\u7edf\u51b3\u5b9a\u7684\uff08\u901a\u5e38\u662f5\uff09\u3002 bind ( address ) accept () close () 4. class asyncore.dispatcher_with_send \u00b6 dispatcher\u7684\u5b50\u7c7b\uff0c\u6dfb\u52a0\u4e86\u7b80\u5355\u7684\u7f13\u51b2\u8f93\u51fa\u80fd\u529b\u3002\u66f4\u590d\u6742\u7684\u7528\u6cd5\u4f7f\u7528 asynchat.async_chat \u3002 5. class asyncore.file_dispatcher \u00b6 file_dispatcher\u63a5\u53d7\u6587\u4ef6\u63cf\u8ff0\u7b26\u6216\u6587\u4ef6\u5bf9\u8c61\u4ee5\u53ca\u53ef\u9009\u7684map\u53c2\u6570\uff0c\u5e76\u5c06\u5176\u5305\u88c5\u4ee5\u4e0epoll()\u6216loop()\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\u3002 \u5982\u679c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\u6216\u4efb\u4f55\u5e26\u6709 fileno() \u65b9\u6cd5\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u8be5\u65b9\u6cd5\u5c06\u88ab\u8c03\u7528\u5e76\u4f20\u9012\u7ed9 file_wrapper \u6784\u9020\u5668\u3002\u53ea\u5728UNIX\u53ef\u7528\u3002 6. class asyncore.file_wrapper \u00b6 file_wrapper\u91c7\u7528\u6574\u6570\u6587\u4ef6\u63cf\u8ff0\u7b26\u5e76\u8c03\u7528 os.dup() \u6765\u590d\u5236\u53e5\u67c4\uff0c\u4ee5\u4fbf\u539f\u59cb\u53e5\u67c4\u53ef\u4ee5\u72ec\u7acb\u4e8efile_wrapper\u800c\u5173\u95ed\u3002 \u6b64\u7c7b\u5b9e\u73b0\u4e86\u8db3\u591f\u7684\u65b9\u6cd5\u6765\u6a21\u62dfsocket\u4ee5\u4f9b file_dispatcher \u7c7b\u4f7f\u7528\u3002\u53ea\u5728UNIX\u53ef\u7528\u3002 7. \u4e3e\u4f8b \u00b6 \u5ba2\u6237\u7aef\u5411socket\u4e2d\u5199\u6570\u636e\uff1a from asyncore import dispatcher import asyncore import socket _map = {} # \u63a5\u6536\u7684\u4fe1\u606f\u7ecf\u5e38\u4e0d\u5b8c\u6574\uff0cwhy class EchoClient ( dispatcher ): def __init__ ( self , addr , data ): dispatcher . __init__ ( self ) self . data = data self . create_socket ( socket . AF_INET , socket . SOCK_STREAM ) self . connect ( addr ) def handle_write ( self ): while self . writable (): sent = self . send ( self . data ) print \"send %d data.\" % sent self . data = self . data [ sent :] def writable ( self ): return len ( self . data ) > 0 def handle_read ( self ): re = self . recv ( 8192 ) print \" %s recv %d : %s \" % ( repr ( self . socket ), len ( re ), re ) # self.handle_close() def handle_close ( self ): print \"close client %s \" % repr ( self . addr ) self . close () echoClient1 = EchoClient (( \"127.0.0.1\" , 9001 ), \"abcdefg\" ) echoClient2 = EchoClient (( \"127.0.0.1\" , 9001 ), \"hijklmn\" ) _map [ echoClient1 . _fileno ] = echoClient1 _map [ echoClient2 . _fileno ] = echoClient2 # asyncore.loop(map=_map, count=2) asyncore . loop ( use_poll = True , map = _map , timeout =. 5 , count = 2 ) for dis in _map . values (): dis . handle_close () _map . clear () \u670d\u52a1\u7aef\u76d1\u542c\u5e76\u8bfb\u53d6\u6570\u636e\uff1a import asyncore from asyncore import dispatcher as dispatcher import socket # \u8fd9\u91cc\u5fc5\u987b\u53e6\u5199\u4e00\u4e2a\u5904\u7406\u7684\u670d\u52a1\u5668\uff0c\u5426\u5219\u670d\u52a1\u7aef\u4e0d\u4f1a\u5173\u95edsocket class EchoHandler ( dispatcher ): _data = '' def handle_read ( self ): data = self . recv ( 1024 ) self . _data += data # self.send(\"send %d from server: %s\" % (len(data), data)) # self.send(\"send %d from server: %s\" % (len(self._data), self._data)) # self._data = '' def handle_write ( self ): while self . writable (): sent = self . send ( self . _data ) msg = \" \\n send %d from server.\" % ( len ( self . _data )) self . _data = self . _data [ sent :] self . send ( msg ) def writable ( self ): return len ( self . _data ) > 0 def handle_close ( self ): print ( \"close %s \" % repr ( self . addr )) self . close () class EchoServer ( dispatcher ): def __init__ ( self , host , port ): dispatcher . __init__ ( self ) self . create_socket ( socket . AF_INET , socket . SOCK_STREAM ) self . set_reuse_addr () self . bind (( host , port )) self . listen ( 2 ) def handle_accept ( self ): cli = self . accept () if cli is not None : conn , addr = cli print ( \"get connect from %s . \\n \" % repr ( addr )) EchoHandler ( conn ) server = EchoServer ( \"127.0.0.1\" , 9001 ) asyncore . loop ()","title":"Asyncore\u6a21\u5757"},{"location":"python/asyncore\u6a21\u5757/#1","text":"asyncore \u662fPython\u7684\u5f02\u6b65\u901a\u4fe1\u6a21\u5757\u3002 \u6b64\u6a21\u5757\u63d0\u4f9b\u4e86\u7f16\u5199\u5f02\u6b65\u5957\u63a5\u5b57\u670d\u52a1\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u57fa\u672c\u7ed3\u6784\u3002 \u662f\u7c7b\u6bd4\u591a\u7ebf\u7a0b\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u5728I/O\u53d7\u9650\u7684\u60c5\u51b5\u4e0b\u5f88\u5b9e\u7528\u3002\u591a\u7ebf\u7a0b\u9002\u7528\u53d7\u9650\u4e8e\u5904\u7406\u5668\u7684\u7a0b\u5e8f\u3002 \u8be5\u6a21\u5757\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7c7b\uff0c\u5b83\u4eec\u7684\u57fa\u672c\u601d\u60f3\u662f\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u7f51\u7edc\u901a\u9053 channel \u3002 \u4e00\u65e6\u521d\u59cbchannel\u88ab\u521b\u5efa\uff0c\u5c31\u8c03\u7528 loop() \u65b9\u6cd5\uff0c\u5c06\u4e00\u76f4\u6301\u7eed\u5230\u6700\u540e\u4e00\u4e2achannel\uff08\u5305\u62ec\u5728\u5f02\u6b65\u670d\u52a1\u671f\u95f4\u6dfb\u52a0\u5230map\u4e2d\u7684channel\uff09\u5173\u95ed\u3002 \u4e0b\u9762\u662f\u4e00\u4e9b\u65b9\u6cd5\u548c\u7c7b\u3002","title":"1. \u6982\u5ff5"},{"location":"python/asyncore\u6a21\u5757/#2-asyncorelooptimeout-use_poll-map-count","text":"\u8fdb\u5165\u4e00\u4e2apolling\u5faa\u73af\uff0c\u76f4\u5230\u5230\u8fbe\u4e86\u5faa\u73af\u6b21\u6570 count \u6216\u6240\u6709\u7684channel\u5173\u95ed\u3002 timeout \u7528\u4e8e\u8bbe\u7f6e\u76f8\u5e94\u7684 select() or poll() \u8c03\u7528\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u9ed8\u8ba430\u79d2\u3002 use_poll \u4e3a True \u65f6\uff0c\u4f18\u5148\u4f7f\u7528 poll() \uff0c\u9ed8\u8ba4\u4e3a False \u3002 map \u662f\u5c06socket.id\u4e0e\u76d1\u89c6\u7684channel\u6620\u5c04\u8d77\u6765\u7684\u5b57\u5178\u3002channels\u88ab\u5173\u95ed\u65f6\u5c06\u4ecemap\u4e2d\u5220\u9664\u3002channels\uff08 asyncore.dispatcher , asynchat.async_chat \u53ca\u5b83\u4eec\u5b50\u7c7b\u7684\u5b9e\u4f8b\uff09\u53ef\u4ee5\u88ab\u81ea\u7531\u6df7\u5408\u3002","title":"2. asyncore.loop([timeout[, use_poll[, map[, count]]]])"},{"location":"python/asyncore\u6a21\u5757/#3-class-asyncoredispatcher","text":"\u5b83\u662f\u5bf9\u4f4e\u7ea7\u7684 socket \u5bf9\u8c61\u7684\u7b80\u5355\u5c01\u88c5\u3002\u5b83\u6709\u51e0\u4e2a\u7b80\u5355\u7684 event-handling \u65b9\u6cd5\u7528\u4e8e\u5f02\u6b65\u5faa\u73af\u7684\u8c03\u7528\u3002\u5b83\u53ef\u4ee5\u88ab\u770b\u4f5c\u662f\u6b63\u5e38\u7684\u975e\u963b\u585e\u5f0f\u7684socket\u5bf9\u8c61\u3002 \u5728\u67d0\u4e9b\u65f6\u95f4\u6216\u67d0\u4e9b\u8fde\u63a5\u72b6\u6001\u89e6\u53d1\u7684 \u4f4e\u7ea7\u522b\u4e8b\u4ef6 \uff08\u5982\u53ef\u8bfb\u3001\u53ef\u5199\u72b6\u6001\uff09\u4f1a\u544a\u8bc9\u5f02\u6b65\u5faa\u73af\u67d0\u4e9b \u66f4\u9ad8\u7ea7\u522b\u7684\u4e8b\u4ef6 \uff08\u5982\u8fde\u63a5\u72b6\u6001\uff09\u5df2\u7ecf\u53d1\u751f\uff08\u6bd4\u5982\uff0csocket\u53ef\u5199\u65f6\u8be5socket\u8fde\u63a5\u5df2\u7ecf\u88ab\u5efa\u7acb\u4e86\uff09\u3002\u9690\u542b\u7684\u66f4\u9ad8\u7ea7\u522b\u4e8b\u4ef6\u662f\uff1a Event Description handle_connect() \u6697\u793a\u5728 the first read or write event \u65f6\u5df2\u7ecf\u53d1\u751f handle_close() \u6697\u793a\u5728 a read event with no data available\u65f6\u5df2\u7ecf\u53d1\u751f handle_accept() \u6697\u793a\u5728 a read event on a listening socket\u65f6\u5df2\u7ecf\u53d1\u751f \u5728\u5f02\u6b65\u5904\u7406\u671f\u95f4\uff0c\u6bcf\u4e2a\u88ab\u6620\u5c04\u7684channel\u7684 readable() and writable() \u65b9\u6cd5\u7528\u4e8e\u6307\u793a\u662f\u5426channel\u7684socket\u5e94\u8be5\u88ab\u52a0\u5165\u5230\u8bfb\u5199\u4e8b\u4ef6\u5217\u8868\u3002 \u4e8e\u662f\uff0cchannel\u7684\u4e8b\u4ef6\u8303\u56f4\u8981\u6bd4\u57fa\u672c\u7684socket\u4e8b\u4ef6\u5927\u3002\u4e0b\u65b9\u5217\u8868\u7684\u65b9\u6cd5\u53ef\u5728\u5b50\u7c7b\u4e2d\u91cd\u5199\uff1a handle_read () \u5f53\u5f02\u6b65\u5faa\u73af\u68c0\u6d4b\u5230\u901a\u9053\u5957\u63a5\u5b57\u4e0a\u7684read()\u8c03\u7528\u4f1a\u6210\u529f\u65f6\u8c03\u7528\u3002 handle_write () \u5f53\u5f02\u6b65\u5faa\u73af\u68c0\u6d4b\u5230\u4e00\u4e2a\u53ef\u5199\u7684socket\u80fd\u88ab\u5199\u5165\u65f6\u8c03\u7528\u3002\u901a\u5e38\uff0c\u6b64\u65b9\u6cd5\u4e3a\u4e86\u6027\u80fd\u8003\u8651\u5c06\u5b9e\u73b0\u5fc5\u8981\u7684\u7f13\u51b2\u3002\u4f8b\u5982\uff1a def handle_write ( self ): sent = self . send ( self . buffer ) self . buffer = self . buffer [ sent :] handle_expt () \u5f53socket\u8fde\u63a5\u5e26\u6709out of band (OOB)\u6570\u636e\u7684\u65f6\u5019\u8c03\u7528\u3002OOB\u652f\u6301\u5f88\u5c11\uff0c\u51e0\u4e4e\u4e0d\u7528\u3002 handle_connect () handle_close () handle_error () \u5728\u5f15\u53d1\u5f02\u5e38\u5e76\u4e14\u672a\u4ee5\u5176\u4ed6\u65b9\u5f0f\u5904\u7406\u65f6\u8c03\u7528\u3002\u9ed8\u8ba4\u6253\u5370\u7cbe\u7b80\u56de\u6eaf\u4fe1\u606f\u3002 handle_accept () readable () \u9ed8\u8ba4\u662f True \u3002 writable () \u9ed8\u8ba4\u662f True \u3002 \u6b64\u5916\uff0c\u6bcf\u4e2a\u901a\u9053\u90fd\u59d4\u6258\u6216\u6269\u5c55\u4e86\u8bb8\u591a \u5957\u63a5\u5b57\u65b9\u6cd5 \u3002\u5176\u4e2d\u5927\u591a\u6570\u4e0e\u5176\u5957\u63a5\u5b57\u51e0\u4e4e\u5b8c\u5168\u76f8\u540c\u3002\u5982\u4e0b\uff1a create_socket ( family , type ) connect ( address ) \u4f5c\u4e3a\u4e00\u4e2a\u6b63\u5e38\u7684socket\u5bf9\u8c61\u3002 address \u662f\u5143\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u4e3b\u673a\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u65f6\u7aef\u53e3\u53f7\u3002 send ( data ) recv ( buffer_size ) \u4ecesocket\u7684\u7ec8\u7aef\u8bfb\u53d6\u6700\u5927 buffer_size \u4e2a\u5b57\u8282\u3002\u7a7a\u5b57\u7b26\u4e32\u610f\u5473\u7740channel\u5df2\u7ecf\u4ece\u53e6\u4e00\u7aef\u88ab\u5173\u95ed\u4e86\u3002\u6ce8\u610f\uff0crecv()\u4f7f\u7528 EAGAIN or EWOULDBLOCK \u53ef\u80fd\u4f1a\u5f15\u53d1 socket.error \uff0c\u5373\u4f7fselect.select()\u6216select.poll()\u5df2\u62a5\u544a\u5957\u63a5\u5b57\u5df2\u51c6\u5907\u597d\u8fdb\u884c\u8bfb\u53d6\u3002 listen ( backlog ) \u4fa6\u542c\u5bf9\u5957\u63a5\u5b57\u7684\u8fde\u63a5\u3002 backlog \u6307\u5b9a\u4e86\u6700\u5927\u6392\u961f\u8fde\u63a5\u6570\u91cf\uff0c\u81f3\u5c11\u4e3a1\uff1b\u6700\u5927\u7684\u8fde\u63a5\u6570\u91cf\u662f\u7cfb\u7edf\u51b3\u5b9a\u7684\uff08\u901a\u5e38\u662f5\uff09\u3002 bind ( address ) accept () close ()","title":"3. class asyncore.dispatcher"},{"location":"python/asyncore\u6a21\u5757/#4-class-asyncoredispatcher_with_send","text":"dispatcher\u7684\u5b50\u7c7b\uff0c\u6dfb\u52a0\u4e86\u7b80\u5355\u7684\u7f13\u51b2\u8f93\u51fa\u80fd\u529b\u3002\u66f4\u590d\u6742\u7684\u7528\u6cd5\u4f7f\u7528 asynchat.async_chat \u3002","title":"4. class asyncore.dispatcher_with_send"},{"location":"python/asyncore\u6a21\u5757/#5-class-asyncorefile_dispatcher","text":"file_dispatcher\u63a5\u53d7\u6587\u4ef6\u63cf\u8ff0\u7b26\u6216\u6587\u4ef6\u5bf9\u8c61\u4ee5\u53ca\u53ef\u9009\u7684map\u53c2\u6570\uff0c\u5e76\u5c06\u5176\u5305\u88c5\u4ee5\u4e0epoll()\u6216loop()\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\u3002 \u5982\u679c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\u6216\u4efb\u4f55\u5e26\u6709 fileno() \u65b9\u6cd5\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u8be5\u65b9\u6cd5\u5c06\u88ab\u8c03\u7528\u5e76\u4f20\u9012\u7ed9 file_wrapper \u6784\u9020\u5668\u3002\u53ea\u5728UNIX\u53ef\u7528\u3002","title":"5. class asyncore.file_dispatcher"},{"location":"python/asyncore\u6a21\u5757/#6-class-asyncorefile_wrapper","text":"file_wrapper\u91c7\u7528\u6574\u6570\u6587\u4ef6\u63cf\u8ff0\u7b26\u5e76\u8c03\u7528 os.dup() \u6765\u590d\u5236\u53e5\u67c4\uff0c\u4ee5\u4fbf\u539f\u59cb\u53e5\u67c4\u53ef\u4ee5\u72ec\u7acb\u4e8efile_wrapper\u800c\u5173\u95ed\u3002 \u6b64\u7c7b\u5b9e\u73b0\u4e86\u8db3\u591f\u7684\u65b9\u6cd5\u6765\u6a21\u62dfsocket\u4ee5\u4f9b file_dispatcher \u7c7b\u4f7f\u7528\u3002\u53ea\u5728UNIX\u53ef\u7528\u3002","title":"6. class asyncore.file_wrapper"},{"location":"python/asyncore\u6a21\u5757/#7","text":"\u5ba2\u6237\u7aef\u5411socket\u4e2d\u5199\u6570\u636e\uff1a from asyncore import dispatcher import asyncore import socket _map = {} # \u63a5\u6536\u7684\u4fe1\u606f\u7ecf\u5e38\u4e0d\u5b8c\u6574\uff0cwhy class EchoClient ( dispatcher ): def __init__ ( self , addr , data ): dispatcher . __init__ ( self ) self . data = data self . create_socket ( socket . AF_INET , socket . SOCK_STREAM ) self . connect ( addr ) def handle_write ( self ): while self . writable (): sent = self . send ( self . data ) print \"send %d data.\" % sent self . data = self . data [ sent :] def writable ( self ): return len ( self . data ) > 0 def handle_read ( self ): re = self . recv ( 8192 ) print \" %s recv %d : %s \" % ( repr ( self . socket ), len ( re ), re ) # self.handle_close() def handle_close ( self ): print \"close client %s \" % repr ( self . addr ) self . close () echoClient1 = EchoClient (( \"127.0.0.1\" , 9001 ), \"abcdefg\" ) echoClient2 = EchoClient (( \"127.0.0.1\" , 9001 ), \"hijklmn\" ) _map [ echoClient1 . _fileno ] = echoClient1 _map [ echoClient2 . _fileno ] = echoClient2 # asyncore.loop(map=_map, count=2) asyncore . loop ( use_poll = True , map = _map , timeout =. 5 , count = 2 ) for dis in _map . values (): dis . handle_close () _map . clear () \u670d\u52a1\u7aef\u76d1\u542c\u5e76\u8bfb\u53d6\u6570\u636e\uff1a import asyncore from asyncore import dispatcher as dispatcher import socket # \u8fd9\u91cc\u5fc5\u987b\u53e6\u5199\u4e00\u4e2a\u5904\u7406\u7684\u670d\u52a1\u5668\uff0c\u5426\u5219\u670d\u52a1\u7aef\u4e0d\u4f1a\u5173\u95edsocket class EchoHandler ( dispatcher ): _data = '' def handle_read ( self ): data = self . recv ( 1024 ) self . _data += data # self.send(\"send %d from server: %s\" % (len(data), data)) # self.send(\"send %d from server: %s\" % (len(self._data), self._data)) # self._data = '' def handle_write ( self ): while self . writable (): sent = self . send ( self . _data ) msg = \" \\n send %d from server.\" % ( len ( self . _data )) self . _data = self . _data [ sent :] self . send ( msg ) def writable ( self ): return len ( self . _data ) > 0 def handle_close ( self ): print ( \"close %s \" % repr ( self . addr )) self . close () class EchoServer ( dispatcher ): def __init__ ( self , host , port ): dispatcher . __init__ ( self ) self . create_socket ( socket . AF_INET , socket . SOCK_STREAM ) self . set_reuse_addr () self . bind (( host , port )) self . listen ( 2 ) def handle_accept ( self ): cli = self . accept () if cli is not None : conn , addr = cli print ( \"get connect from %s . \\n \" % repr ( addr )) EchoHandler ( conn ) server = EchoServer ( \"127.0.0.1\" , 9001 ) asyncore . loop ()","title":"7. \u4e3e\u4f8b"},{"location":"python/event\u7ebf\u7a0b/","text":"1. \u7528 threading.Event \u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1 \u00b6 \u4f7f\u7528threading.Event\u53ef\u4ee5\u4f7f\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u7684\u901a\u77e5\uff0c Event\u9ed8\u8ba4\u5185\u7f6e\u4e86\u4e00\u4e2a\u6807\u5fd7\uff0c\u521d\u59cb\u503c\u4e3aFalse\u3002 \u4e00\u65e6\u8be5\u7ebf\u7a0b\u901a\u8fc7 wait() \u65b9\u6cd5\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u8be5Event\u7684 set() \u65b9\u6cd5\u5c06\u5185\u7f6e\u6807\u5fd7\u8bbe\u7f6e\u4e3aTrue\u65f6\uff0c\u8be5Event\u4f1a\u901a\u77e5\u6240\u6709\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u6062\u590d\u8fd0\u884c\u3002 clear() \u65b9\u6cd5\u5219\u76f8\u53cd\u3002","title":"event\u7ebf\u7a0b"},{"location":"python/event\u7ebf\u7a0b/#1-threadingevent","text":"\u4f7f\u7528threading.Event\u53ef\u4ee5\u4f7f\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u7684\u901a\u77e5\uff0c Event\u9ed8\u8ba4\u5185\u7f6e\u4e86\u4e00\u4e2a\u6807\u5fd7\uff0c\u521d\u59cb\u503c\u4e3aFalse\u3002 \u4e00\u65e6\u8be5\u7ebf\u7a0b\u901a\u8fc7 wait() \u65b9\u6cd5\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u8be5Event\u7684 set() \u65b9\u6cd5\u5c06\u5185\u7f6e\u6807\u5fd7\u8bbe\u7f6e\u4e3aTrue\u65f6\uff0c\u8be5Event\u4f1a\u901a\u77e5\u6240\u6709\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u6062\u590d\u8fd0\u884c\u3002 clear() \u65b9\u6cd5\u5219\u76f8\u53cd\u3002","title":"1. \u7528 threading.Event \u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1"},{"location":"python/json\u683c\u5f0f\u5904\u7406/","text":"json.dumps() \u548c json.loads() \u662fjson\u683c\u5f0f\u5904\u7406\u51fd\u6570\uff08\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff0cjson\u662f\u5b57\u7b26\u4e32\uff09 (1) json.dumps()\u51fd\u6570\u662f\u5c06\u4e00\u4e2aPython\u6570\u636e\u7c7b\u578b\u5217\u8868\u8fdb\u884cjson\u683c\u5f0f\u7684\u7f16\u7801\uff08\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff0cjson.dumps()\u51fd\u6570\u662f\u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\uff09 (2) json.loads()\u51fd\u6570\u662f\u5c06json\u683c\u5f0f\u6570\u636e\u8f6c\u6362\u4e3a\u5b57\u5178\uff08\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff0cjson.loads()\u51fd\u6570\u662f\u5c06\u5b57\u7b26\u4e32\u8f6c\u5316\u4e3a\u5b57\u5178\uff09 json.dump() \u548c json.load() \u4e3b\u8981\u7528\u6765\u8bfb\u5199json\u6587\u4ef6","title":"json\u683c\u5f0f\u5904\u7406"},{"location":"python/mkdown2reStructuredText/","text":"\u7f16\u5199\u7684\u4e00\u4e2a\u5c0f\u811a\u672c\uff0c\u5c06mkdown\u6587\u6863\u8f6c\u6362\u4e3areStructuredText \u6587\u6863\u3002 \u652f\u6301\u7684\u8bed\u6cd5\uff1a \u659c\u4f53 \u7c97\u4f53 \u5f15\u7528 \u56fe\u7247 \u8d85\u8fde\u63a5 \u4ee3\u7801\u5757 \u6807\u9898 \u4e0d\u652f\u6301\u5d4c\u5957\u8bed\u6cd5\uff0c\u6bd4\u5982 \u7c97\u4e9b\u4f53 \u3002 \u652f\u6301\u76ee\u5f55\u6216\u5355\u4e2a\u6587\u4ef6\u7684\u8f6c\u6362\u3002 # coding=utf-8 import os def _replace ( string , old , sub , start , count = None ): string_left = string [ 0 : start ] string_right = string [ start :] if count is not None : string_right = string_right . replace ( old , sub , count ) else : string_right = string_right . replace ( old , sub ) return string_left + string_right class mkdown2ReStructuredText : def __init__ ( self ): pass _replace_level_char = { 1 : '=' , 2 : '-' , 3 : '^' , 4 : \"'\" , 5 : \"'\" , 6 : \"'\" , } def _nums_head ( self , tmp_string ): n = 0 while tmp_string [ n : n + 1 ] == '#' : n += 1 return n def _replace_line_block ( self , line ): left_right = 'left' location = - 3 while location <= len ( line ): location = line . find ( \"`\" , location + 3 ) if location == - 1 : break if left_right == 'left' : left_right = 'right' if location != 0 : line = _replace ( line , \"`\" , \" ``\" , location , 1 ) else : line = _replace ( line , \"`\" , \"``\" , location , 1 ) else : left_right = 'left' line = _replace ( line , \"`\" , \"`` \" , location , 1 ) return line def _replace_img ( self , line ): location_left = line . find ( \"![\" ) if location_left != - 1 : location_tmp_left = line . find ( \"](\" , location_left ) # location_right = line.find(\")\", location_tmp_left) line = line . replace ( line [ location_left : location_tmp_left + 2 ], \" .. image:: \" , 1 ) line = line . replace ( \")\" , \"\" ) return line def _replace_link ( self , line ): img = line . find ( '![' ) if img != - 1 : return line mid = line . find ( '](' ) while mid != - 1 : left = line . rfind ( '[' , 0 , mid ) right = line . find ( ')' , mid ) if left == 0 : line = _replace ( line , '[' , '`' , left , 1 ) else : line = _replace ( line , '[' , ' `' , left , 1 ) line = _replace ( line , ')' , '>`_ ' , right , 1 ) line = _replace ( line , '](' , ' <' , mid , 1 ) mid = line . find ( '](' , right + 2 ) return line def _replace_quote ( self , line ): if line . startswith ( \">\" ): line = line . replace ( \">\" , \" \" , 1 ) if line . startswith ( \" >\" ): line = line . replace ( \" >\" , \" \" , 1 ) if line . startswith ( \" \\t >\" ): line = line . replace ( \" \\t >\" , \" \" , 1 ) return line def _replace_header ( self , line ): if line . startswith ( '#' ): level = self . _nums_head ( line ) line = line . replace ( \"#\" * level , '' , 1 ) return ' \\r\\n ' + line . lstrip () + \\ self . _replace_level_char [ level ] * 80 + ' \\r\\n ' return line def _replace_bold ( self , line ): left_right = 'left' location = - 3 while location <= len ( line ): location = line . find ( \"**\" , location + 3 ) if location == - 1 : break if line [ location : location + 3 ] == '***' \\ or line [ location - 1 : location + 2 ] == '***' \\ or line [ location - 2 : location + 1 ] == '***' : continue if left_right == 'left' : left_right = 'right' if location != 0 : line = _replace ( line , \"**\" , \" **\" , location , 1 ) else : left_right = 'left' line = _replace ( line , \"**\" , \"** \" , location , 1 ) return line # convert italic def _replace_italic ( self , line ): left_right = 'left' location = - 2 while location <= len ( line ): location = line . find ( \"*\" , location + 2 ) if location == - 1 : break if line [ location + 1 ] == '*' or line [ location - 1 ] == '*' : continue if line [ location : location + 3 ] == '***' \\ or line [ location - 1 : location + 2 ] == '***' \\ or line [ location - 2 : location + 1 ] == '***' : continue if left_right == 'left' : left_right = 'right' if location != 0 : line = _replace ( line , \"*\" , \" *\" , location , 1 ) else : left_right = 'left' line = _replace ( line , \"*\" , \"* \" , location , 1 ) return line # convert bold_italic to bold def _replace_bold_italic ( self , line ): left_right = 'left' location = - 4 while location <= len ( line ): location = line . find ( \"***\" , location + 4 ) if location == - 1 : break if left_right == 'left' : left_right = 'right' if location != 0 : line = _replace ( line , \"***\" , \" **\" , location , 1 ) else : line = _replace ( line , \"***\" , \"**\" , location , 1 ) else : left_right = 'left' line = _replace ( line , \"***\" , \"** \" , location , 1 ) return line def _handle_line_inner ( self , line ): line = self . _replace_line_block ( line ) line = self . _replace_img ( line ) line = self . _replace_quote ( line ) line = self . _replace_link ( line ) line = self . _replace_header ( line ) line = self . _replace_italic ( line ) line = self . _replace_bold ( line ) line = self . _replace_bold_italic ( line ) return line def _convert ( self , source_path , dst_path ): with open ( source_path , 'r' ) as f : origin_lines = f . readlines () result_lines = [] inner_block = False start_block = False for line in origin_lines : if line . startswith ( \"```\" ): inner_block = not inner_block if not start_block : result_lines . append ( ':: \\n\\t\\r\\n ' ) start_block = not start_block else : result_lines . append ( ' \\r\\n ' ) start_block = not start_block continue if inner_block : result_lines . append ( ' ' + line ) continue result_lines . append ( self . _handle_line_inner ( line )) tpm_file = os . path . basename ( source_path ) with open ( os . path . join ( dst_path , tpm_file [: len ( tpm_file ) - 2 ] + \"rst\" ), 'w' ) as f : f . writelines ( result_lines ) def _list_dir ( self , source_dir , dst_dir ): source_files = os . listdir ( source_dir ) for f in source_files : current_f = os . path . join ( source_dir , f ) if os . path . isdir ( current_f ): current_dst_dir = os . path . join ( dst_dir , f ) if not os . path . exists ( current_dst_dir ): os . mkdir ( current_dst_dir ) self . _list_dir ( current_f , current_dst_dir ) elif os . path . isfile ( current_f ): if f . endswith ( '.md' ): self . _convert ( current_f , dst_dir ) else : with open ( os . path . join ( dst_dir , f ), \"wb\" ) as copy_file : with open ( current_f , \"rb\" ) as copied_file : copy_file . write ( copied_file . read ()) def convert_from_dir ( self , source_path , destination_path ): self . _list_dir ( os . path . normpath ( source_path ), os . path . normpath ( destination_path )) def convert_from_file ( self , source_file , destination_path ): self . _convert ( os . path . normpath ( source_file ), os . path . normpath ( destination_path )) # \u8def\u5f84\u4e2d\u5b58\u5728\u4e2d\u6587\u65f6\u9700\u8981\u89e3\u7801 # c = mkdown2ReStructuredText() # c.convert_from_dir('D:/mkdocs/work/docs/\u865a\u62df\u673a\u8f6c\u6362'.decode('utf-8'), 'D:\\AtomDoc\\docs\\source\\Operation\\Vm_convert') # c.convert_from_file('D:/mkdocs/work/docs/\u865a\u62df\u673a\u8f6c\u6362/virt-p2v\u4ecb\u7ecd.md'.decode('utf-8'), 'D:\\AtomDoc\\docs\\source\\Operation\\Vm_convert')","title":"mkdown2reStructuredText"},{"location":"python/select\u6a21\u5757/","text":"1. select\u6a21\u5757 2. epoll \u5bf9\u8c61 3. polling \u5bf9\u8c61 4. \u4e3e\u4f8b 1. select\u6a21\u5757 \u00b6 select \u6a21\u5757\u63d0\u4f9b\u7cfb\u7edf\u65b9\u6cd5 select() \u548c poll() \u7684\u8c03\u7528\uff0c\u5728linux 2.5+\u4e2d epoll() \u53ef\u7528\u3002 \u5728Windows\uff0c\u53ea\u652f\u6301socket\uff1b\u5728\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u652f\u6301\u5176\u4ed6\u7684\u6587\u4ef6\u7c7b\u578b\u3002 \u8be5\u6a21\u5757\u5b9a\u4e49\u4e86\u4ee5\u4e0b\u65b9\u6cd5\uff1a select.error \u5f02\u5e38 \u9519\u8bef\u53d1\u751f\u65f6\u6355\u83b7\u5f02\u5e38\u3002\u9644\u5e26\u7684\u503c\u662f\u4e00\u5bf9\u5305\u542b\u6765\u81ea errno \u7684\u6570\u5b57\u9519\u8bef\u4ee3\u7801\u548c\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u3002 select.epoll ([ sizehint=-1 ]) \u8fd4\u56de\u8fb9\u7f18\u8f6e\u8be2\u5bf9\u8c61\uff08\u53ef\u7528\u4f5cI/O\u4e8b\u4ef6\u7684Edge\u6216Level Triggered\u63a5\u53e3\uff09\u3002 select.poll () \u8fd4\u56de\u8f6e\u8be2\u5bf9\u8c61\uff08\u652f\u6301\u6ce8\u518c\u548c\u53d6\u6d88\u6ce8\u518c\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u7136\u540e\u4eceI/O\u4e8b\u4ef6\u8f6e\u8be2\u5b83\u4eec\uff09\u3002 select.select ( rlist , wlist , xlist [, timeout ]) \u8fd9\u662f\u76f4\u63a5\u6307\u5411Unix select() \u7cfb\u7edf\u8c03\u7528\u7684\u63a5\u53e3\u3002\u524d\u4e09\u4e2a\u53c2\u6570\u662f \u53ef\u7b49\u5f85\u5bf9\u8c61 \u5e8f\u5217\uff1a\u65e2\u53ef\u4ee5\u662f\u4ee3\u8868\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6574\u6570\u503c\uff0c\u4e5f\u53ef\u4ee5\u662f\u542b\u6709\u8fd4\u56de\u6574\u6570\u503c\u7684\u65e0\u53c2 fileno() \u65b9\u6cd5\u7684\u5bf9\u8c61\uff1a rlist \uff1a\u7b49\u5f85\u76f4\u5230\u53ef\u8bfb wlist \uff1a\u7b49\u5f85\u76f4\u5230\u53ef\u5199 xlist \uff1a\u7b49\u5f85\u4e00\u4e2a\u5f02\u5e38 exceptional condition \uff08\u67e5\u770b\u64cd\u4f5c\u7cfb\u7edf\u624b\u518c\uff09 \u5141\u8bb8\u7a7a\u5e8f\u5217\uff0c\u4f46\u662f\u4e09\u4e2a\u90fd\u4e3a\u7a7a\u8981\u770b\u7cfb\u7edf\u662f\u5426\u652f\u6301\uff08Unix\u652f\u6301\uff0cWindows\u4e0d\u652f\u6301\uff09\u3002 timeout \uff1a\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u6d6e\u70b9\u6570\u3002\u6b64\u53c2\u6570\u88ab\u5ffd\u7565\u65f6\uff0c\u6b64\u65b9\u6cd5\u88ab\u963b\u585e\u76f4\u5230\u81f3\u5c11\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u51c6\u5907\u5b8c\u6bd5\u3002\u4e3a 0 \u65f6\u6307\u5b9a\u4e00\u4e2a\u8f6e\u8be2\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u963b\u585e\u3002 \u8fd4\u56de\u503c\u662f\u51c6\u5907\u597d\u7684\u5bf9\u8c61\u5217\u8868\uff1a\u5b50\u96c6\u5bf9\u5e94\u7740\u4e09\u4e2a\u4e0a\u8ff0\u5217\u8868\u3002\u8fbe\u5230\u8d85\u65f6\u65f6\u95f4\u5374\u6ca1\u6709\u51c6\u5907\u597d\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5c06\u8fd4\u56de\u4e09\u4e2a\u7a7a\u5217\u8868\u3002 \u5728\u5e8f\u5217\u4e2d\u53ef\u63a5\u53d7\u7684\u6587\u4ef6\u7c7b\u578b\u6709\uff1apython\u6587\u4ef6\u5bf9\u8c61\uff0csocket.socket()\u8fd4\u56de\u7684\u5bf9\u8c61\uff0c\u81ea\u5b9a\u4e49\u7684\u7c7b\uff08\u5e26\u6709\u5c5e\u6027 fileno() \u65b9\u6cd5\uff0c\u5e76\u4e14\u8fd4\u56de\u7684\u662f\u771f\u6b63\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff09\u3002 2. epoll \u5bf9\u8c61 \u00b6 epoll - I/O event notification facility\u3002 The epoll API performs a similar task to poll(2): monitoring multiple file descriptors to see if I/O is possible on any of them. The epoll API can be used either as an edge-triggered or a level-triggered interface and scales well to large numbers of watched file descriptors. \u4e8b\u4ef6\u63a9\u7801 eventmask \uff1a Constant Meaning EPOLLIN Available for read EPOLLOUT Available for write EPOLLPRI Urgent data for read EPOLLERR Error condition happened on the assoc. fd EPOLLHUP Hang up happened on the assoc. fd EPOLLET Set Edge Trigger behavior, the default is Level Trigger behavior EPOLLONESHOT Set one-shot behavior. After one event is pulled out, the fd is internally disabled EPOLLRDNORM Equivalent to EPOLLIN EPOLLRDBAND Priority data band can be read. EPOLLWRNORM Equivalent to EPOLLOUT EPOLLWRBAND Priority data may be written. EPOLLMSG Ignored. epoll.close () \u5173\u95edepoll \u5bf9\u8c61\u7684\u63a7\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.fileno () \u8fd4\u56de\u63a7\u5236fd\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u53f7\u7801 epoll.fromfd ( fd ) \u4ece\u7ed9\u5b9a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u521b\u5efaepoll \u5bf9\u8c61 epoll.register ( fd [, eventmask ]) \u7528epoll \u5bf9\u8c61\u6ce8\u518c\u4e00\u4e2afd\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6ce8\u518c\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f1a\u5f15\u8d77\u4e00\u4e2a IOError \u3002 epoll.modify ( fd , eventmask ) \u4fee\u6539\u4e00\u4e2a\u6ce8\u518c\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.unregister ( fd ) \u4eceepoll \u5bf9\u8c61\u79fb\u9664\u6ce8\u518c\u8fc7\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.poll ([ timeout=-1 [, maxevents=-1 ]]) \u7b49\u5f85\u4e8b\u4ef6\u3002\u662f\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u6d6e\u70b9\u6570\u3002 3. polling \u5bf9\u8c61 \u00b6 poll() \u7cfb\u7edf\u8c03\u7528\uff0c\u5728\u5927\u90e8\u5206\u7684Unix\u7cfb\u7edf\u4e0a\u652f\u6301\uff0c\u4e3a\u540c\u65f6\u4e3a\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4f9b\u670d\u52a1\u7684\u7f51\u7edc\u670d\u52a1\u5668\u63d0\u4f9b\u66f4\u597d\u7684\u53ef\u6269\u5c55\u6027\u3002 poll() \u6bd4 select() \u66f4\u597d\u5730\u6269\u5c55\u3002 select() is O(highest file descriptor), while poll() is O(number of file descriptors). \u4e8b\u4ef6\u63a9\u7801 eventmask s \u662f\u53ef\u9009\u7684\u4e8c\u8fdb\u5236\u63a9\u7801\uff0c\u63cf\u8ff0\u4e86\u60f3\u8981\u68c0\u67e5\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u5e76\u4e14\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e8b\u4ef6\u7684\u7ec4\u5408\uff08\u901a\u8fc7 \u4f4d\u6216 \u64cd\u4f5c\uff09\uff0c\u9ed8\u8ba4\u68c0\u67e5\u524d\u4e09\u79cd\u7c7b\u578b\uff1a Constant Meaning POLLIN There is data to read POLLPRI There is urgent data to read POLLOUT Ready for output: writing will not block POLLERR Error condition of some sort POLLHUP Hung up POLLNVAL Invalid request: descriptor not open poll.register ( fd [, eventmask ]) \u4f7f\u7528polling \u5bf9\u8c61\u6ce8\u518c\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6ce8\u518c\u5df2\u6ce8\u518c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e0d\u662f\u9519\u8bef\uff0c\u5e76\u4e14\u4e0e\u4ec5\u4ec5\u6ce8\u518c\u63cf\u8ff0\u7b26\u4e00\u6837\u5177\u6709\u76f8\u540c\u7684\u6548\u679c\u3002 poll.modify ( fd , eventmask ) \u4fee\u6539\u5df2\u7ecf\u6ce8\u518c\u8fc7\u7684fd\u3002\u548c register \u65b9\u6cd5\u6709\u4e00\u6837\u7684\u6548\u679c\u3002\u82e5\u4fee\u6539\u672a\u6ce8\u518c\u8fc7\u7684\u5219\u4f1a\u5f15\u8d77\u4e00\u4e2a IOError \u5f02\u5e38\uff0cerrno\u662f ENOENT \u3002 poll.unregister ( fd ) \u79fb\u9664\u4e00\u4e2a\u88abpolling \u5bf9\u8c61\u8ffd\u8e2a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u5982\u679c\u79fb\u9664\u4e0d\u5b58\u5728\u7684fd\u5219\u4f1a\u5f15\u8d77 KeyError \u5f02\u5e38\u3002 poll.poll ([ timeout ]) \u8f6e\u8be2\u6ce8\u518c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd4\u56de\u53ef\u80fd\u4e3a\u7a7a\u7684\u5305\u542b\u4e24\u4e2a\u5143\u7d20 (fd, eventmask) \u7684\u5143\u7ec4\u5217\u8868\uff0c\u7528\u4e8e\u5177\u6709\u8981\u62a5\u544a\u7684\u4e8b\u4ef6\u6216\u9519\u8bef\u7684\u63cf\u8ff0\u7b26\u3002\u7a7a\u5217\u8868\u8868\u660e\u8c03\u7528\u8d85\u65f6\u5e76\u4e14\u6ca1\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\u6709\u4e8b\u4ef6\u8981\u62a5\u544a\u3002\u82e5\u7ed9\u4e86 timeout \uff0c\u5219\u6307\u5b9a\u7cfb\u7edf\u5728\u8fd4\u56de\u4e4b\u524d\u7b49\u5f85\u4e8b\u4ef6\u7684\u65f6\u95f4\u957f\u5ea6\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\uff1b\u82e5 timeout \u88ab\u5ffd\u7565\u3001\u8d1f\u6570\u6216None\uff0c\u8c03\u7528\u4f1a\u963b\u585e\u76f4\u5230\u6709\u4e8b\u4ef6\u53d1\u751f\u3002 4. \u4e3e\u4f8b \u00b6 \u5ba2\u6237\u7aef\u901a\u8fc7socket\u53d1\u9001\u6570\u636e\uff1a import socket cli = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) cli . connect (( '127.0.0.1' , 9002 )) while True : msg = raw_input ( '> ' ) cli . send ( msg ) # close socket after sent exit message if msg == 'exit' : cli . close () break else : print cli . recv ( 8192 ) \u670d\u52a1\u7aef\u901a\u8fc7poll\u76d1\u542csocket\u5e76\u63a5\u6536\u6570\u636e\uff1a import select import socket READ_ONLY_MASK = ( select . POLLIN | select . POLLPRI | select . POLLHUP | select . POLLERR ) server_soc = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) server_soc . bind (( '127.0.0.1' , 9002 )) server_soc . listen ( 2 ) # \u5728\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u82e5\u8c03\u7528recv()\u65b9\u6cd5\u4e0d\u80fd\u627e\u5230\u4efb\u4f55\u6570\u636e\u6216send()\u65b9\u6cd5\u4e0d\u80fd\u7acb\u5373\u5904\u7406\u6570\u636e\uff0c\u4f1a\u53d1\u751f\u5f02\u5e38\uff0c\u7b49\u4ef7\u4e8e s.settimeout(0.0)\uff1b\u5728\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u8c03\u7528\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u5b83\u4eec\u53ef\u4ee5\u88ab\u5904\u7406\u7b49\u4ef7\u4e8e s.settimeout(None)\u3002 server_soc . setblocking ( False ) poller = select . poll () poller . register ( server_soc , select . POLLIN ) _map = {} while True : events = poller . poll ( 20000 ) if len ( events ) > 0 : for fd , event in events : if fd == server_soc . fileno (): print \"server event: %d \" % event cli , addr = server_soc . accept () print \"get connect from %s .\" % repr ( addr ) cli . setblocking ( False ) poller . register ( cli , READ_ONLY_MASK ) _map [ cli . fileno ()] = cli else : print \"cli event: %d \" % event cli = _map [ fd ] if event == select . POLLIN : data = cli . recv ( 1024 ) print \"get data from %s : %s \" % ( repr ( cli . getpeername ()), data ) if data == 'exit' : poller . unregister ( cli ) del _map [ fd ] cli . close () continue cli . send ( data ) else : print \"there is no events, exit.\" break server_soc . close ()","title":"Select\u6a21\u5757"},{"location":"python/select\u6a21\u5757/#1-select","text":"select \u6a21\u5757\u63d0\u4f9b\u7cfb\u7edf\u65b9\u6cd5 select() \u548c poll() \u7684\u8c03\u7528\uff0c\u5728linux 2.5+\u4e2d epoll() \u53ef\u7528\u3002 \u5728Windows\uff0c\u53ea\u652f\u6301socket\uff1b\u5728\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u652f\u6301\u5176\u4ed6\u7684\u6587\u4ef6\u7c7b\u578b\u3002 \u8be5\u6a21\u5757\u5b9a\u4e49\u4e86\u4ee5\u4e0b\u65b9\u6cd5\uff1a select.error \u5f02\u5e38 \u9519\u8bef\u53d1\u751f\u65f6\u6355\u83b7\u5f02\u5e38\u3002\u9644\u5e26\u7684\u503c\u662f\u4e00\u5bf9\u5305\u542b\u6765\u81ea errno \u7684\u6570\u5b57\u9519\u8bef\u4ee3\u7801\u548c\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u3002 select.epoll ([ sizehint=-1 ]) \u8fd4\u56de\u8fb9\u7f18\u8f6e\u8be2\u5bf9\u8c61\uff08\u53ef\u7528\u4f5cI/O\u4e8b\u4ef6\u7684Edge\u6216Level Triggered\u63a5\u53e3\uff09\u3002 select.poll () \u8fd4\u56de\u8f6e\u8be2\u5bf9\u8c61\uff08\u652f\u6301\u6ce8\u518c\u548c\u53d6\u6d88\u6ce8\u518c\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u7136\u540e\u4eceI/O\u4e8b\u4ef6\u8f6e\u8be2\u5b83\u4eec\uff09\u3002 select.select ( rlist , wlist , xlist [, timeout ]) \u8fd9\u662f\u76f4\u63a5\u6307\u5411Unix select() \u7cfb\u7edf\u8c03\u7528\u7684\u63a5\u53e3\u3002\u524d\u4e09\u4e2a\u53c2\u6570\u662f \u53ef\u7b49\u5f85\u5bf9\u8c61 \u5e8f\u5217\uff1a\u65e2\u53ef\u4ee5\u662f\u4ee3\u8868\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6574\u6570\u503c\uff0c\u4e5f\u53ef\u4ee5\u662f\u542b\u6709\u8fd4\u56de\u6574\u6570\u503c\u7684\u65e0\u53c2 fileno() \u65b9\u6cd5\u7684\u5bf9\u8c61\uff1a rlist \uff1a\u7b49\u5f85\u76f4\u5230\u53ef\u8bfb wlist \uff1a\u7b49\u5f85\u76f4\u5230\u53ef\u5199 xlist \uff1a\u7b49\u5f85\u4e00\u4e2a\u5f02\u5e38 exceptional condition \uff08\u67e5\u770b\u64cd\u4f5c\u7cfb\u7edf\u624b\u518c\uff09 \u5141\u8bb8\u7a7a\u5e8f\u5217\uff0c\u4f46\u662f\u4e09\u4e2a\u90fd\u4e3a\u7a7a\u8981\u770b\u7cfb\u7edf\u662f\u5426\u652f\u6301\uff08Unix\u652f\u6301\uff0cWindows\u4e0d\u652f\u6301\uff09\u3002 timeout \uff1a\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u6d6e\u70b9\u6570\u3002\u6b64\u53c2\u6570\u88ab\u5ffd\u7565\u65f6\uff0c\u6b64\u65b9\u6cd5\u88ab\u963b\u585e\u76f4\u5230\u81f3\u5c11\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u51c6\u5907\u5b8c\u6bd5\u3002\u4e3a 0 \u65f6\u6307\u5b9a\u4e00\u4e2a\u8f6e\u8be2\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u963b\u585e\u3002 \u8fd4\u56de\u503c\u662f\u51c6\u5907\u597d\u7684\u5bf9\u8c61\u5217\u8868\uff1a\u5b50\u96c6\u5bf9\u5e94\u7740\u4e09\u4e2a\u4e0a\u8ff0\u5217\u8868\u3002\u8fbe\u5230\u8d85\u65f6\u65f6\u95f4\u5374\u6ca1\u6709\u51c6\u5907\u597d\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5c06\u8fd4\u56de\u4e09\u4e2a\u7a7a\u5217\u8868\u3002 \u5728\u5e8f\u5217\u4e2d\u53ef\u63a5\u53d7\u7684\u6587\u4ef6\u7c7b\u578b\u6709\uff1apython\u6587\u4ef6\u5bf9\u8c61\uff0csocket.socket()\u8fd4\u56de\u7684\u5bf9\u8c61\uff0c\u81ea\u5b9a\u4e49\u7684\u7c7b\uff08\u5e26\u6709\u5c5e\u6027 fileno() \u65b9\u6cd5\uff0c\u5e76\u4e14\u8fd4\u56de\u7684\u662f\u771f\u6b63\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff09\u3002","title":"1. select\u6a21\u5757"},{"location":"python/select\u6a21\u5757/#2-epoll","text":"epoll - I/O event notification facility\u3002 The epoll API performs a similar task to poll(2): monitoring multiple file descriptors to see if I/O is possible on any of them. The epoll API can be used either as an edge-triggered or a level-triggered interface and scales well to large numbers of watched file descriptors. \u4e8b\u4ef6\u63a9\u7801 eventmask \uff1a Constant Meaning EPOLLIN Available for read EPOLLOUT Available for write EPOLLPRI Urgent data for read EPOLLERR Error condition happened on the assoc. fd EPOLLHUP Hang up happened on the assoc. fd EPOLLET Set Edge Trigger behavior, the default is Level Trigger behavior EPOLLONESHOT Set one-shot behavior. After one event is pulled out, the fd is internally disabled EPOLLRDNORM Equivalent to EPOLLIN EPOLLRDBAND Priority data band can be read. EPOLLWRNORM Equivalent to EPOLLOUT EPOLLWRBAND Priority data may be written. EPOLLMSG Ignored. epoll.close () \u5173\u95edepoll \u5bf9\u8c61\u7684\u63a7\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.fileno () \u8fd4\u56de\u63a7\u5236fd\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u53f7\u7801 epoll.fromfd ( fd ) \u4ece\u7ed9\u5b9a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u521b\u5efaepoll \u5bf9\u8c61 epoll.register ( fd [, eventmask ]) \u7528epoll \u5bf9\u8c61\u6ce8\u518c\u4e00\u4e2afd\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6ce8\u518c\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f1a\u5f15\u8d77\u4e00\u4e2a IOError \u3002 epoll.modify ( fd , eventmask ) \u4fee\u6539\u4e00\u4e2a\u6ce8\u518c\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.unregister ( fd ) \u4eceepoll \u5bf9\u8c61\u79fb\u9664\u6ce8\u518c\u8fc7\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 epoll.poll ([ timeout=-1 [, maxevents=-1 ]]) \u7b49\u5f85\u4e8b\u4ef6\u3002\u662f\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u6d6e\u70b9\u6570\u3002","title":"2. epoll \u5bf9\u8c61"},{"location":"python/select\u6a21\u5757/#3-polling","text":"poll() \u7cfb\u7edf\u8c03\u7528\uff0c\u5728\u5927\u90e8\u5206\u7684Unix\u7cfb\u7edf\u4e0a\u652f\u6301\uff0c\u4e3a\u540c\u65f6\u4e3a\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4f9b\u670d\u52a1\u7684\u7f51\u7edc\u670d\u52a1\u5668\u63d0\u4f9b\u66f4\u597d\u7684\u53ef\u6269\u5c55\u6027\u3002 poll() \u6bd4 select() \u66f4\u597d\u5730\u6269\u5c55\u3002 select() is O(highest file descriptor), while poll() is O(number of file descriptors). \u4e8b\u4ef6\u63a9\u7801 eventmask s \u662f\u53ef\u9009\u7684\u4e8c\u8fdb\u5236\u63a9\u7801\uff0c\u63cf\u8ff0\u4e86\u60f3\u8981\u68c0\u67e5\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u5e76\u4e14\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e8b\u4ef6\u7684\u7ec4\u5408\uff08\u901a\u8fc7 \u4f4d\u6216 \u64cd\u4f5c\uff09\uff0c\u9ed8\u8ba4\u68c0\u67e5\u524d\u4e09\u79cd\u7c7b\u578b\uff1a Constant Meaning POLLIN There is data to read POLLPRI There is urgent data to read POLLOUT Ready for output: writing will not block POLLERR Error condition of some sort POLLHUP Hung up POLLNVAL Invalid request: descriptor not open poll.register ( fd [, eventmask ]) \u4f7f\u7528polling \u5bf9\u8c61\u6ce8\u518c\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6ce8\u518c\u5df2\u6ce8\u518c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e0d\u662f\u9519\u8bef\uff0c\u5e76\u4e14\u4e0e\u4ec5\u4ec5\u6ce8\u518c\u63cf\u8ff0\u7b26\u4e00\u6837\u5177\u6709\u76f8\u540c\u7684\u6548\u679c\u3002 poll.modify ( fd , eventmask ) \u4fee\u6539\u5df2\u7ecf\u6ce8\u518c\u8fc7\u7684fd\u3002\u548c register \u65b9\u6cd5\u6709\u4e00\u6837\u7684\u6548\u679c\u3002\u82e5\u4fee\u6539\u672a\u6ce8\u518c\u8fc7\u7684\u5219\u4f1a\u5f15\u8d77\u4e00\u4e2a IOError \u5f02\u5e38\uff0cerrno\u662f ENOENT \u3002 poll.unregister ( fd ) \u79fb\u9664\u4e00\u4e2a\u88abpolling \u5bf9\u8c61\u8ffd\u8e2a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u5982\u679c\u79fb\u9664\u4e0d\u5b58\u5728\u7684fd\u5219\u4f1a\u5f15\u8d77 KeyError \u5f02\u5e38\u3002 poll.poll ([ timeout ]) \u8f6e\u8be2\u6ce8\u518c\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd4\u56de\u53ef\u80fd\u4e3a\u7a7a\u7684\u5305\u542b\u4e24\u4e2a\u5143\u7d20 (fd, eventmask) \u7684\u5143\u7ec4\u5217\u8868\uff0c\u7528\u4e8e\u5177\u6709\u8981\u62a5\u544a\u7684\u4e8b\u4ef6\u6216\u9519\u8bef\u7684\u63cf\u8ff0\u7b26\u3002\u7a7a\u5217\u8868\u8868\u660e\u8c03\u7528\u8d85\u65f6\u5e76\u4e14\u6ca1\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\u6709\u4e8b\u4ef6\u8981\u62a5\u544a\u3002\u82e5\u7ed9\u4e86 timeout \uff0c\u5219\u6307\u5b9a\u7cfb\u7edf\u5728\u8fd4\u56de\u4e4b\u524d\u7b49\u5f85\u4e8b\u4ef6\u7684\u65f6\u95f4\u957f\u5ea6\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\uff1b\u82e5 timeout \u88ab\u5ffd\u7565\u3001\u8d1f\u6570\u6216None\uff0c\u8c03\u7528\u4f1a\u963b\u585e\u76f4\u5230\u6709\u4e8b\u4ef6\u53d1\u751f\u3002","title":"3. polling \u5bf9\u8c61"},{"location":"python/select\u6a21\u5757/#4","text":"\u5ba2\u6237\u7aef\u901a\u8fc7socket\u53d1\u9001\u6570\u636e\uff1a import socket cli = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) cli . connect (( '127.0.0.1' , 9002 )) while True : msg = raw_input ( '> ' ) cli . send ( msg ) # close socket after sent exit message if msg == 'exit' : cli . close () break else : print cli . recv ( 8192 ) \u670d\u52a1\u7aef\u901a\u8fc7poll\u76d1\u542csocket\u5e76\u63a5\u6536\u6570\u636e\uff1a import select import socket READ_ONLY_MASK = ( select . POLLIN | select . POLLPRI | select . POLLHUP | select . POLLERR ) server_soc = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) server_soc . bind (( '127.0.0.1' , 9002 )) server_soc . listen ( 2 ) # \u5728\u975e\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u82e5\u8c03\u7528recv()\u65b9\u6cd5\u4e0d\u80fd\u627e\u5230\u4efb\u4f55\u6570\u636e\u6216send()\u65b9\u6cd5\u4e0d\u80fd\u7acb\u5373\u5904\u7406\u6570\u636e\uff0c\u4f1a\u53d1\u751f\u5f02\u5e38\uff0c\u7b49\u4ef7\u4e8e s.settimeout(0.0)\uff1b\u5728\u963b\u585e\u6a21\u5f0f\u4e0b\uff0c\u8c03\u7528\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u5b83\u4eec\u53ef\u4ee5\u88ab\u5904\u7406\u7b49\u4ef7\u4e8e s.settimeout(None)\u3002 server_soc . setblocking ( False ) poller = select . poll () poller . register ( server_soc , select . POLLIN ) _map = {} while True : events = poller . poll ( 20000 ) if len ( events ) > 0 : for fd , event in events : if fd == server_soc . fileno (): print \"server event: %d \" % event cli , addr = server_soc . accept () print \"get connect from %s .\" % repr ( addr ) cli . setblocking ( False ) poller . register ( cli , READ_ONLY_MASK ) _map [ cli . fileno ()] = cli else : print \"cli event: %d \" % event cli = _map [ fd ] if event == select . POLLIN : data = cli . recv ( 1024 ) print \"get data from %s : %s \" % ( repr ( cli . getpeername ()), data ) if data == 'exit' : poller . unregister ( cli ) del _map [ fd ] cli . close () continue cli . send ( data ) else : print \"there is no events, exit.\" break server_soc . close ()","title":"4. \u4e3e\u4f8b"},{"location":"python/subprocess\u6a21\u5757/","text":"\u8be5\u6a21\u5757\u8ba9\u4f60\u4ea7\u751f\u65b0\u7684\u8fdb\u7a0b\uff0c\u8fde\u63a5\u5230\u5b83\u4eec\u7684 input/output/error \u7ba1\u9053\uff0c\u83b7\u53d6\u5b83\u4eec\u7684\u8fd4\u56de\u7801\u3002\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u8c03\u7528\u547d\u4ee4\uff0c\u5e76\u83b7\u53d6\u8f93\u51fa\u548c\u9000\u51fa\u7684\u72b6\u6001\u7801\u3002 \u5b98\u65b9\u5f3a\u70c8\u63a8\u8350POSIX\u7528\u6237\u4f7f\u7528\u7b2c\u4e09\u65b9\u6a21\u5757\uff1a subprocess32 \uff08\u7528\u4e8ePython 2\u7684Python 3\u5b50\u8fdb\u7a0b\u6a21\u5757\u7684\u540e\u7aef\u63a5\u53e3\u3002\uff09\u3002 1. \u4f7f\u7528subprocess\u6a21\u5757 \u00b6 \u4ee5\u4e0b\u662f\u7b80\u5355\u4f7f\u7528\u65b9\u6cd5\uff0c\u672c\u8d28\u4e0a\u8c03\u7528\u4e86 Popen \u63a5\u53e3\uff0c\u9ad8\u7ea7\u7528\u6cd5\u67e5\u9605\u4e0b\u6587\u7684 Popen \u63a5\u53e3\u3002 1.1 subprocess.call ( args , *, stdin=None , stdout=None , stderr=None , shell=False ) \u00b6 \u8fd0\u884c args \u547d\u4ee4\u3002\u7b49\u5f85\u547d\u4ee4\u5b8c\u6210\uff0c\u7136\u540e\u8fd4\u56de returncode \u5c5e\u6027\u3002 >>> subprocess . call ([ \"ls\" , \"-l\" ]) 0 >>> subprocess . call ( \"exit 1\" , shell = True ) 1 Warning \u4e0d\u8981\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u4f7f\u7528 stdout=PIPE \u6216 stderr=PIPE \u3002 1.2 subprocess.check_call ( args , *, stdin=None , stdout=None , stderr=None , shell=False ) \u00b6 \u540c\u4e0a\uff0c\u8fd4\u56de\u503c\u4e3a0\u65f6\u5219\u8fd4\u56de\uff0c\u5426\u5219\u629b\u51fa CalledProcessError \u5f02\u5e38\uff0c\u5f02\u5e38\u4e2d\u6709 returncode \u5c5e\u6027\u3002 >>> subprocess . check_call ([ \"ls\" , \"-l\" ]) 0 >>> subprocess . check_call ( \"exit 1\" , shell = True ) Traceback ( most recent call last ): File \"<stdin>\" , line 1 , in < module > File \"/usr/lib64/python2.7/subprocess.py\" , line 542 , in check_call raise CalledProcessError ( retcode , cmd ) subprocess . CalledProcessError : Command 'exit 1' returned non - zero exit status 1 \u8b66\u544a\u540c\u4e0a\u3002 1.3 subprocess.check_output ( args , *, stdin=None , stderr=None , shell=False , universal_newlines=False ) \u00b6 \u5c06\u8f93\u51fa\u4f5c\u4e3a\u5b57\u8282\u5b57\u7b26\u4e32\u8fd4\u56de\u3002\u8fd4\u56de\u503c\u975e0\u65f6\u629b\u51fa CalledProcessError \u5f02\u5e38\uff0c\u5f02\u5e38\u5bf9\u8c61\u4e2d\u6709 returncode \u548c output \u5c5e\u6027\u3002 >>> subprocess . check_output ( \"echo 123456\" , shell = True ) '123456 \\n ' >>> subprocess . check_output ( \"ll\" , shell = True ) / bin / sh : ll : command not found Traceback ( most recent call last ): File \"<stdin>\" , line 1 , in < module > File \"/usr/lib64/python2.7/subprocess.py\" , line 575 , in check_output raise CalledProcessError ( retcode , cmd , output = output ) subprocess . CalledProcessError : Command 'll' returned non - zero exit status 127 \u4e5f\u53ef\u4ee5\u5c06\u6807\u51c6\u9519\u8bef\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u6ce8\u610f exit 0 \uff1a >>> subprocess . check_output ( \"ll; exit 0\" , stderr = subprocess . STDOUT , shell = True ) '/bin/sh: ll: command not found \\n ' Warning \u4e0d\u8981\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u4f7f\u7528 stderr=PIPE \u3002 1.4 subprocess.PIPE \u00b6 \u53ef\u7528\u4f5cPopen\u7684 stdin \uff0c stdout \uff0c stderr \u53c2\u6570\u7684\u7279\u6b8a\u503c\uff0c\u8868\u793a\u5e94\u6253\u5f00\u6807\u51c6\u6d41\u7684\u7ba1\u9053\u3002 1.5 subprocess.STDOUT \u00b6 \u53ef\u4ee5\u7528\u4f5cPopen\u7684 stderr \u53c2\u6570\u7684\u7279\u6b8a\u503c\uff0c\u8868\u793a\u6807\u51c6\u9519\u8bef\u5e94\u8be5\u4e0e\u6807\u51c6\u8f93\u51fa\u8fdb\u5165\u76f8\u540c\u7684\u53e5\u67c4\u3002 1.6 returncode \u00b6 \u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u72b6\u6001 2. \u7ecf\u5e38\u4f7f\u7528\u7684\u53c2\u6570 \u00b6 Popen \u62e5\u6709\u4f17\u591a\u7684\u53c2\u6570\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4f7f\u7528\u9891\u7387\u6700\u9ad8\u7684\u51e0\u4e2a\u3002 args \uff1a\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5fc5\u8981\u53c2\u6570\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u8005\u5e8f\u5217\uff08\u5217\u8868\uff0c\u63a8\u8350\u503c\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u6a21\u5757\u5904\u7406\u4efb\u4f55\u6240\u9700\u7684\u8f6c\u4e49\u548c\u5f15\u7528\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5141\u8bb8\u6587\u4ef6\u540d\u4e2d\u7684\u7a7a\u683c\uff09\u3002\u82e5\u662f\u5b57\u7b26\u4e32\uff0c\u5fc5\u987b\u4f7f\u7528 shell=True \u9009\u9879 \u6216\u8005 \u547d\u4ee4\u6ca1\u6709\u9644\u5e26\u4efb\u4f55\u53c2\u6570 \u3002 stdin \uff0c stdout \uff0c stderr \uff1a\u6307\u5b9a\u547d\u4ee4\u7684\u6807\u51c6\u8f93\u5165\u3001\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u7684\u6587\u4ef6\u53e5\u67c4\u3002\u53ef\u9009\u7684\u503c\u6709\u56db\u4e2a\uff1a PIPE \uff1a\u6307\u793a\u5b50\u8fdb\u7a0b\u5e94\u8be5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ba1\u9053\u3002 \u5b58\u5728\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08\u4e00\u4e2a\u6b63\u6570\uff09 \u5b58\u5728\u7684\u6587\u4ef6\u5bf9\u8c61 None \uff1a\u4e0d\u4f1a\u8fdb\u884c\u91cd\u5b9a\u5411\u7684\u64cd\u4f5c\uff1b\u5b50\u8fdb\u7a0b\u7684\u6587\u4ef6\u53e5\u67c4\u4ece\u7236\u8fdb\u7a0b\u7ee7\u627f\u3002 \u53e6\u5916\uff0c stderr \u7684\u503c\u53ef\u4ee5\u662f subprocess.STDOUT \u3002 \u5f53stdout\u6216stderr\u7684\u503c\u662fPIPE\u4e14universal_newlines\u4e3aTrue\u65f6\uff0c\u6240\u6709\u884c\u7684\u7ed3\u5c3e\u5c06\u8f6c\u6362\u4e3a \\n \u3002 shell \uff1a\u63a7\u5236\u662f\u5426\u901a\u8fc7shell\u6267\u884c\u547d\u4ee4\u3002\u503c\u4e3a True \u65f6\uff0c\u5c06\u652f\u6301shell\u7279\u6027\uff08\u6bd4\u5982shell\u7ba1\u9053\u3001\u6587\u4ef6\u540d\u901a\u914d\u7b26\u3001\u73af\u5883\u53d8\u91cf\u6269\u5c55\u3001 ~ \u6269\u5c55\u7b49\uff09\u3002\u4f46\u662fpython\u4e5f\u63d0\u4f9b\u4e86\u8bb8\u591a\u7c7bshell\u7279\u6027\u7684\u5b9e\u73b0\u3002 Warning \u4ece\u4e0d\u4fe1\u4efb\u7684\u8f93\u5165\u6e90\u4e0d\u63a5\u53d7\u8f93\u5165\u540e\u672a\u7ecf\u5904\u7406\u76f4\u63a5\u4f5c\u4e3a\u547d\u4ee4\u7684\u8f93\u5165\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u6f0f\u6d1e shell injection \u3002\u56e0\u6b64\uff0c\u5728\u4ece\u5916\u90e8\u8f93\u5165\u6784\u9020\u547d\u4ee4\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 shell=True \u3002 shell=False \u4f1a\u7981\u7528\u6240\u6709\u7684\u57fa\u672cshell\u529f\u80fd\uff0c\u4f46\u4e0d\u4f1a\u5f15\u8d77\u8fd9\u4e2a\u6f0f\u6d1e\u3002 >>> from subprocess import call >>> filename = input ( \"What file would you like to display? \\n \" ) What file would you like to display ? # \u9ad8\u5371\u52a8\u4f5c\uff01\uff01\uff01 non_existent ; rm - rf / # >>> call ( \"cat \" + filename , shell = True ) # Uh-oh. This will end badly... 3. Popen \u6784\u9020\u5668 \u00b6 class subprocess . Popen ( args , bufsize = 0 , executable = None , stdin = None , stdout = None , stderr = None , preexec_fn = None , close_fds = False , shell = False , cwd = None , env = None , universal_newlines = False , startupinfo = None , creationflags = 0 ) args \u5e94\u8be5\u662f\u5217\u8868\u6216\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u662f\u5217\u8868\u5219\u6267\u884c\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6761\u76ee\uff1b\u5982\u679c\u662f\u5b57\u7b26\u4e32\u5219\u89c6\u5e73\u53f0\u51b3\u5b9a\u3002 args \u662f\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\uff1a Unix\uff1a\u8be5\u5b57\u7b26\u4e32\u88ab\u89e3\u91ca\u4e3a\u8981\u6267\u884c\u7684\u7a0b\u5e8f\u7684\u540d\u79f0\u6216\u8def\u5f84\u3002\u4f46\u662f\uff0c\u8fd9\u53ea\u9002\u7528\u4e8e\u6ca1\u6709\u5411\u8fd9\u4e2a\u7a0b\u5e8f\u4f20\u53c2\u7684\u60c5\u51b5\u3002 args \u662f\u5217\u8868\u7684\u60c5\u51b5\uff1a Windows\uff1a\u88ab\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002 shell=True \u65f6\uff0c\u5efa\u8bae\u5c06 args \u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u800c\u4e0d\u662f\u5217\u8868\u4f20\u5165 \uff1a Unix\uff1ashell\u9ed8\u8ba4\u662f /bin/sh \uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a executable \u53c2\u6570\u6765\u66ff\u6362\u3002\u82e5 args \u662f\u5b57\u7b26\u4e32\uff0c\u5219\u5fc5\u987b\u5b89\u7167\u5b9e\u9645\u5728shell\u64cd\u4f5c\u65f6\u7684\u683c\u5f0f\u6765\u5199\u5b57\u7b26\u4e32\uff08\u6bd4\u5982\u6587\u4ef6\u540d\u4e2d\u7684\u7a7a\u683c\u8981\u4f7f\u7528\u8f6c\u4e49\u7b26\u53f7\u6216\u8005\u7528\u5f15\u53f7\u5305\u56f4\uff09\uff1b\u82e5 args \u662f\u5217\u8868\uff0c\u5219\u7b2c\u4e00\u9879\u6307\u5b9a\u547d\u4ee4\uff0c\u5176\u5b83\u9879\u88ab\u89c6\u4e3ashell\u672c\u8eab\u7684\u53c2\u6570\uff0c \u800c\u4e0d\u662f\u547d\u4ee4\u7684\u53c2\u6570 \u3002\u76f8\u5f53\u4e8e\uff1a Popen ([ '/bin/sh' , '-c' , args [ 0 ], args [ 1 ], ... ]) Windows\uff1a\u73af\u5883\u53d8\u91cf COMSPEC \u6307\u5b9a\u9ed8\u8ba4shell\u3002\u552f\u4e00\u9700\u8981 shell=True \u7684\u60c5\u51b5\u5c31\u662f\u6267\u884c\u5185\u7f6eWindows\u547d\u4ee4\uff08dir\u3001copy\u7b49\uff09\u7684\u65f6\u5019\u3002\u8fd0\u884c\u6279\u91cf\u811a\u672c\u6216\u57fa\u4e8e\u63a7\u5236\u53f0\u7684\u53ef\u6267\u884c\u6587\u4ef6\u65f6\u4e0d\u9700\u8981\u8bbe\u7f6e\u6b64\u53c2\u6570\u3002","title":"Subprocess\u6a21\u5757"},{"location":"python/subprocess\u6a21\u5757/#1-subprocess","text":"\u4ee5\u4e0b\u662f\u7b80\u5355\u4f7f\u7528\u65b9\u6cd5\uff0c\u672c\u8d28\u4e0a\u8c03\u7528\u4e86 Popen \u63a5\u53e3\uff0c\u9ad8\u7ea7\u7528\u6cd5\u67e5\u9605\u4e0b\u6587\u7684 Popen \u63a5\u53e3\u3002","title":"1. \u4f7f\u7528subprocess\u6a21\u5757"},{"location":"python/subprocess\u6a21\u5757/#11-subprocesscallargs-42-stdinnone-stdoutnone-stderrnone-shellfalse","text":"\u8fd0\u884c args \u547d\u4ee4\u3002\u7b49\u5f85\u547d\u4ee4\u5b8c\u6210\uff0c\u7136\u540e\u8fd4\u56de returncode \u5c5e\u6027\u3002 >>> subprocess . call ([ \"ls\" , \"-l\" ]) 0 >>> subprocess . call ( \"exit 1\" , shell = True ) 1 Warning \u4e0d\u8981\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u4f7f\u7528 stdout=PIPE \u6216 stderr=PIPE \u3002","title":"1.1 subprocess.call(args, *, stdin=None, stdout=None, stderr=None, shell=False)"},{"location":"python/subprocess\u6a21\u5757/#12-subprocesscheck_callargs-42-stdinnone-stdoutnone-stderrnone-shellfalse","text":"\u540c\u4e0a\uff0c\u8fd4\u56de\u503c\u4e3a0\u65f6\u5219\u8fd4\u56de\uff0c\u5426\u5219\u629b\u51fa CalledProcessError \u5f02\u5e38\uff0c\u5f02\u5e38\u4e2d\u6709 returncode \u5c5e\u6027\u3002 >>> subprocess . check_call ([ \"ls\" , \"-l\" ]) 0 >>> subprocess . check_call ( \"exit 1\" , shell = True ) Traceback ( most recent call last ): File \"<stdin>\" , line 1 , in < module > File \"/usr/lib64/python2.7/subprocess.py\" , line 542 , in check_call raise CalledProcessError ( retcode , cmd ) subprocess . CalledProcessError : Command 'exit 1' returned non - zero exit status 1 \u8b66\u544a\u540c\u4e0a\u3002","title":"1.2 subprocess.check_call(args, *, stdin=None, stdout=None, stderr=None, shell=False)"},{"location":"python/subprocess\u6a21\u5757/#13-subprocesscheck_outputargs-42-stdinnone-stderrnone-shellfalse-universal_newlinesfalse","text":"\u5c06\u8f93\u51fa\u4f5c\u4e3a\u5b57\u8282\u5b57\u7b26\u4e32\u8fd4\u56de\u3002\u8fd4\u56de\u503c\u975e0\u65f6\u629b\u51fa CalledProcessError \u5f02\u5e38\uff0c\u5f02\u5e38\u5bf9\u8c61\u4e2d\u6709 returncode \u548c output \u5c5e\u6027\u3002 >>> subprocess . check_output ( \"echo 123456\" , shell = True ) '123456 \\n ' >>> subprocess . check_output ( \"ll\" , shell = True ) / bin / sh : ll : command not found Traceback ( most recent call last ): File \"<stdin>\" , line 1 , in < module > File \"/usr/lib64/python2.7/subprocess.py\" , line 575 , in check_output raise CalledProcessError ( retcode , cmd , output = output ) subprocess . CalledProcessError : Command 'll' returned non - zero exit status 127 \u4e5f\u53ef\u4ee5\u5c06\u6807\u51c6\u9519\u8bef\u91cd\u5b9a\u5411\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u6ce8\u610f exit 0 \uff1a >>> subprocess . check_output ( \"ll; exit 0\" , stderr = subprocess . STDOUT , shell = True ) '/bin/sh: ll: command not found \\n ' Warning \u4e0d\u8981\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u4f7f\u7528 stderr=PIPE \u3002","title":"1.3 subprocess.check_output(args, *, stdin=None, stderr=None, shell=False, universal_newlines=False)"},{"location":"python/subprocess\u6a21\u5757/#14-subprocesspipe","text":"\u53ef\u7528\u4f5cPopen\u7684 stdin \uff0c stdout \uff0c stderr \u53c2\u6570\u7684\u7279\u6b8a\u503c\uff0c\u8868\u793a\u5e94\u6253\u5f00\u6807\u51c6\u6d41\u7684\u7ba1\u9053\u3002","title":"1.4 subprocess.PIPE"},{"location":"python/subprocess\u6a21\u5757/#15-subprocessstdout","text":"\u53ef\u4ee5\u7528\u4f5cPopen\u7684 stderr \u53c2\u6570\u7684\u7279\u6b8a\u503c\uff0c\u8868\u793a\u6807\u51c6\u9519\u8bef\u5e94\u8be5\u4e0e\u6807\u51c6\u8f93\u51fa\u8fdb\u5165\u76f8\u540c\u7684\u53e5\u67c4\u3002","title":"1.5 subprocess.STDOUT"},{"location":"python/subprocess\u6a21\u5757/#16-returncode","text":"\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u72b6\u6001","title":"1.6 returncode"},{"location":"python/subprocess\u6a21\u5757/#2","text":"Popen \u62e5\u6709\u4f17\u591a\u7684\u53c2\u6570\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4f7f\u7528\u9891\u7387\u6700\u9ad8\u7684\u51e0\u4e2a\u3002 args \uff1a\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5fc5\u8981\u53c2\u6570\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u8005\u5e8f\u5217\uff08\u5217\u8868\uff0c\u63a8\u8350\u503c\uff0c\u56e0\u4e3a\u5b83\u5141\u8bb8\u6a21\u5757\u5904\u7406\u4efb\u4f55\u6240\u9700\u7684\u8f6c\u4e49\u548c\u5f15\u7528\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5141\u8bb8\u6587\u4ef6\u540d\u4e2d\u7684\u7a7a\u683c\uff09\u3002\u82e5\u662f\u5b57\u7b26\u4e32\uff0c\u5fc5\u987b\u4f7f\u7528 shell=True \u9009\u9879 \u6216\u8005 \u547d\u4ee4\u6ca1\u6709\u9644\u5e26\u4efb\u4f55\u53c2\u6570 \u3002 stdin \uff0c stdout \uff0c stderr \uff1a\u6307\u5b9a\u547d\u4ee4\u7684\u6807\u51c6\u8f93\u5165\u3001\u6807\u51c6\u8f93\u51fa\u548c\u6807\u51c6\u9519\u8bef\u7684\u6587\u4ef6\u53e5\u67c4\u3002\u53ef\u9009\u7684\u503c\u6709\u56db\u4e2a\uff1a PIPE \uff1a\u6307\u793a\u5b50\u8fdb\u7a0b\u5e94\u8be5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ba1\u9053\u3002 \u5b58\u5728\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff08\u4e00\u4e2a\u6b63\u6570\uff09 \u5b58\u5728\u7684\u6587\u4ef6\u5bf9\u8c61 None \uff1a\u4e0d\u4f1a\u8fdb\u884c\u91cd\u5b9a\u5411\u7684\u64cd\u4f5c\uff1b\u5b50\u8fdb\u7a0b\u7684\u6587\u4ef6\u53e5\u67c4\u4ece\u7236\u8fdb\u7a0b\u7ee7\u627f\u3002 \u53e6\u5916\uff0c stderr \u7684\u503c\u53ef\u4ee5\u662f subprocess.STDOUT \u3002 \u5f53stdout\u6216stderr\u7684\u503c\u662fPIPE\u4e14universal_newlines\u4e3aTrue\u65f6\uff0c\u6240\u6709\u884c\u7684\u7ed3\u5c3e\u5c06\u8f6c\u6362\u4e3a \\n \u3002 shell \uff1a\u63a7\u5236\u662f\u5426\u901a\u8fc7shell\u6267\u884c\u547d\u4ee4\u3002\u503c\u4e3a True \u65f6\uff0c\u5c06\u652f\u6301shell\u7279\u6027\uff08\u6bd4\u5982shell\u7ba1\u9053\u3001\u6587\u4ef6\u540d\u901a\u914d\u7b26\u3001\u73af\u5883\u53d8\u91cf\u6269\u5c55\u3001 ~ \u6269\u5c55\u7b49\uff09\u3002\u4f46\u662fpython\u4e5f\u63d0\u4f9b\u4e86\u8bb8\u591a\u7c7bshell\u7279\u6027\u7684\u5b9e\u73b0\u3002 Warning \u4ece\u4e0d\u4fe1\u4efb\u7684\u8f93\u5165\u6e90\u4e0d\u63a5\u53d7\u8f93\u5165\u540e\u672a\u7ecf\u5904\u7406\u76f4\u63a5\u4f5c\u4e3a\u547d\u4ee4\u7684\u8f93\u5165\u4f1a\u5bfc\u81f4\u7a0b\u5e8f\u6f0f\u6d1e shell injection \u3002\u56e0\u6b64\uff0c\u5728\u4ece\u5916\u90e8\u8f93\u5165\u6784\u9020\u547d\u4ee4\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\u4e0b\uff0c\u5f3a\u70c8\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528 shell=True \u3002 shell=False \u4f1a\u7981\u7528\u6240\u6709\u7684\u57fa\u672cshell\u529f\u80fd\uff0c\u4f46\u4e0d\u4f1a\u5f15\u8d77\u8fd9\u4e2a\u6f0f\u6d1e\u3002 >>> from subprocess import call >>> filename = input ( \"What file would you like to display? \\n \" ) What file would you like to display ? # \u9ad8\u5371\u52a8\u4f5c\uff01\uff01\uff01 non_existent ; rm - rf / # >>> call ( \"cat \" + filename , shell = True ) # Uh-oh. This will end badly...","title":"2. \u7ecf\u5e38\u4f7f\u7528\u7684\u53c2\u6570"},{"location":"python/subprocess\u6a21\u5757/#3-popen","text":"class subprocess . Popen ( args , bufsize = 0 , executable = None , stdin = None , stdout = None , stderr = None , preexec_fn = None , close_fds = False , shell = False , cwd = None , env = None , universal_newlines = False , startupinfo = None , creationflags = 0 ) args \u5e94\u8be5\u662f\u5217\u8868\u6216\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u662f\u5217\u8868\u5219\u6267\u884c\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6761\u76ee\uff1b\u5982\u679c\u662f\u5b57\u7b26\u4e32\u5219\u89c6\u5e73\u53f0\u51b3\u5b9a\u3002 args \u662f\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\uff1a Unix\uff1a\u8be5\u5b57\u7b26\u4e32\u88ab\u89e3\u91ca\u4e3a\u8981\u6267\u884c\u7684\u7a0b\u5e8f\u7684\u540d\u79f0\u6216\u8def\u5f84\u3002\u4f46\u662f\uff0c\u8fd9\u53ea\u9002\u7528\u4e8e\u6ca1\u6709\u5411\u8fd9\u4e2a\u7a0b\u5e8f\u4f20\u53c2\u7684\u60c5\u51b5\u3002 args \u662f\u5217\u8868\u7684\u60c5\u51b5\uff1a Windows\uff1a\u88ab\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002 shell=True \u65f6\uff0c\u5efa\u8bae\u5c06 args \u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u800c\u4e0d\u662f\u5217\u8868\u4f20\u5165 \uff1a Unix\uff1ashell\u9ed8\u8ba4\u662f /bin/sh \uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a executable \u53c2\u6570\u6765\u66ff\u6362\u3002\u82e5 args \u662f\u5b57\u7b26\u4e32\uff0c\u5219\u5fc5\u987b\u5b89\u7167\u5b9e\u9645\u5728shell\u64cd\u4f5c\u65f6\u7684\u683c\u5f0f\u6765\u5199\u5b57\u7b26\u4e32\uff08\u6bd4\u5982\u6587\u4ef6\u540d\u4e2d\u7684\u7a7a\u683c\u8981\u4f7f\u7528\u8f6c\u4e49\u7b26\u53f7\u6216\u8005\u7528\u5f15\u53f7\u5305\u56f4\uff09\uff1b\u82e5 args \u662f\u5217\u8868\uff0c\u5219\u7b2c\u4e00\u9879\u6307\u5b9a\u547d\u4ee4\uff0c\u5176\u5b83\u9879\u88ab\u89c6\u4e3ashell\u672c\u8eab\u7684\u53c2\u6570\uff0c \u800c\u4e0d\u662f\u547d\u4ee4\u7684\u53c2\u6570 \u3002\u76f8\u5f53\u4e8e\uff1a Popen ([ '/bin/sh' , '-c' , args [ 0 ], args [ 1 ], ... ]) Windows\uff1a\u73af\u5883\u53d8\u91cf COMSPEC \u6307\u5b9a\u9ed8\u8ba4shell\u3002\u552f\u4e00\u9700\u8981 shell=True \u7684\u60c5\u51b5\u5c31\u662f\u6267\u884c\u5185\u7f6eWindows\u547d\u4ee4\uff08dir\u3001copy\u7b49\uff09\u7684\u65f6\u5019\u3002\u8fd0\u884c\u6279\u91cf\u811a\u672c\u6216\u57fa\u4e8e\u63a7\u5236\u53f0\u7684\u53ef\u6267\u884c\u6587\u4ef6\u65f6\u4e0d\u9700\u8981\u8bbe\u7f6e\u6b64\u53c2\u6570\u3002","title":"3. Popen \u6784\u9020\u5668"},{"location":"python/\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668/","text":"\u53c2\u8003\uff1ahttps://www.jianshu.com/p/7bae11eaf84d","title":"\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668"},{"location":"python/\u6267\u884cshell\u547d\u4ee4/","text":"\u963b\u585e\u5f0f\u547d\u4ee4\u8c03\u7528\u65b9\u6cd5\uff1a # \u8fd9\u79cd\u65b9\u6cd5\u4e0d\u80fd\u4f7f\u7528\u8d85\u65f6\u88c5\u9970\u5668 def _executeCmd ( cmd , isSudo = False ) : if isSudo : cmd . insert ( 0 , ' sudo ' ) status , output = commands . getstatusoutput ( ' ' . join ( cmd )) if status : raise Exception ( output ) return output \u5229\u7528\u5b50\u8fdb\u7a0b\u6267\u884c\u547d\u4ee4\u8c03\u7528\u65b9\u6cd5\uff08\u8be6\u7ec6\u4f7f\u7528\u65b9\u6cd5\u53c2\u89c1\uff1asubprocess\u6a21\u5757\uff09\uff1a @ setTimeout () def aaa () : sub = subprocess . Popen ( \"ssh root@172.16.7.210 df /home\" , shell = True , stdout = subprocess . PIPE ) try : sub . wait () return sub . stdout . read () except : print \"aaa kill\" sub . terminate ()","title":"\u6267\u884cshell\u547d\u4ee4"},{"location":"python/\u7c7b\u5c5e\u6027\u548c\u5b9e\u4f8b\u5c5e\u6027/","text":"\u539f\u6587 python\u662f\u52a8\u6001\u52a0\u8f7d\u5c5e\u6027\u7684\u3002 python\u4f1a\u4f18\u5148\u67e5\u627e\u5b9e\u4f8b\u5c5e\u6027\uff0c\u7136\u540e\u5728\u67e5\u627e\u7c7b\u5c5e\u6027\u3002 class A ( object ): a = 1 o1 = A () o2 = A () # (1) print ( o1 . a , o2 . a , A . a ) # (1, 1, 1) # (2) o1 . a = 2 print ( o1 . a , o2 . a , A . a ) # (2, 1, 1) # (3) A . a = 3 print ( o1 . a , o2 . a , A . a ) # (2, 3, 3) (1)\uff1a\u6b64\u65f6o1\u548co2\u662f\u90fd\u6ca1\u6709\u5b9e\u4f8b\u5c5e\u6027\u7684\uff0c\u6240\u4ee5\u7ee7\u7eed\u5411\u4e0a\u67e5\u627e\u7c7b\u5c5e\u6027\u5f97\u5230a = 1 (2)\uff1a\u5bf9o1.a\u8d4b\u503c\uff0c\u6b64\u65f6\u624d\u4f1a\u7ed9o1\u4e00\u4e2a\u5b9e\u4f8b\u5c5e\u6027 print ( o1 . __dict__ , o2 . __dict__ ) # ({'a': 2}, {}) (3)\uff1a\u56e0\u4e3ao1\u5148\u627e\u5230\u4e86\u5b9e\u4f8b\u5c5e\u6027\uff0c\u6240\u4ee5\u4e0d\u4f1a\u6539\u53d8a\u7684\u503c","title":"\u7c7b\u5c5e\u6027\u548c\u5b9e\u4f8b\u5c5e\u6027"},{"location":"python/\u7f51\u7edc\u7f16\u7a0b/","text":"python2.x \u7f16\u7801\u8bf4\u660e\uff1a https://www.jianshu.com/p/5017d8342dd2 http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html \u7b80\u5355\u7684socket\u7f51\u7edc\u7f16\u7a0b\uff1a https://github.com/ignorantshr/socket-communication","title":"\u7f51\u7edc\u7f16\u7a0b"},{"location":"python/\u83b7\u53d6\u547d\u4ee4\u884c\u53c2\u6570/","text":"\u901a\u8fc7 sys \u6a21\u5757\u83b7\u53d6\u547d\u4ee4\u884c\u4f20\u53c2\uff0c\u4ece\u6587\u4ef6\u5f00\u59cb\uff0c\u4ece0\u8ba1\u6570\uff1b\u901a\u8fc7 getopt \u6a21\u5757\u683c\u5f0f\u5316\u4f20\u53c2\uff0c\u4f7f\u5176\u53ef\u4ee5\u89e3\u6790\u9009\u9879\uff1a import sys import getopt # opts\u662f\u5e26\u9009\u9879\u7684\u53c2\u6570\uff0cargs\u662f\u4e0d\u5e26\u9009\u9879\u7684\u53c2\u6570 opts , args = getopt . getopt ( sys . argv [ 1 :], \"hn:c:\" ) for op , value in opts : if op == \"-n\" : ids = str . split ( value , \";\" ) elif op == \"-c\" : cmds = str . split ( value , \";\" ) elif op == \"-h\" : sys . exit ()","title":"\u83b7\u53d6\u547d\u4ee4\u884c\u53c2\u6570"},{"location":"python/\u8d85\u65f6\u88c5\u9970\u5668/","text":"\u8d85\u65f6\u88c5\u9970\u5668 def setTimeout ( second = 5 ): def wrap ( function ): def handle ( signal , frame ): raise RuntimeError def timing ( second ): while second != 0 : second -= 1 time . sleep ( 1 ) def to_do ( * args , ** kwargs ): try : signal . signal ( signal . SIGALRM , handle ) signal . alarm ( second ) re = function ( * args , ** kwargs ) signal . alarm ( 0 ) return re except RuntimeError as e : raise e return to_do return wrap \u5982\u679cfunction\u662f\u5f53\u524d\u7ebf\u7a0b\u963b\u585e\u5f0f\u7684\uff0c\u90a3\u4e48\u8fd9\u6bb5\u4ee3\u7801\u4e0d\u4f1a\u53d1\u751f\u4f5c\u7528\u3002 \u4e0eshell\u547d\u4ee4\u7ed3\u5408\u4f7f\u7528\uff1a \u6267\u884cshell\u547d\u4ee4 \u9644 \uff1a\u65e0\u6cd5\u4f7f\u7528signal\u5224\u65ad\u7684\u60c5\u51b5 \u4f46\u662f\uff0c\u5728vdsm\u4e2d\u8c03\u7528\u65f6\uff0c\u5374\u63d0\u793a signal \u4e0d\u80fd\u5728\u5b50\u7ebf\u7a0b\u4e2d\u4f7f\u7528\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u6539\u5199\u6210\u4e0b\u9762\u8fd9\u79cd\u65b9\u6cd5\uff1a def _isSSHEnable ( remoteIP ): cmd = [ \"ssh root@\" + remoteIP , 'df /' ] flag = 'unknown' def timer ( pro ): n = 5 while n != 0 : n -= 1 time . sleep ( 1 ) if flag is not 'ok' : pro . terminate () sub = subprocess . Popen ( ' ' . join ( cmd ), shell = True , stdout = subprocess . PIPE ) timeout = threading . Thread ( target = timer , args = ( sub ,)) timeout . start () timeout . join () code = sub . wait () flag = 'ok' if code != 0 : return False return True \u8fd9\u79cd\u65b9\u6cd5\u7684\u95ee\u9898\u5c31\u662f\u4e0d\u7ba1\u8be5\u7a0b\u5e8f\u662f\u4e0d\u662f\u8d85\u65f6\u8fd0\u884c\uff0c\u90fd\u8981\u7b49\u5f855\u79d2\u7684\u65f6\u95f4\u3002","title":"\u8d85\u65f6\u88c5\u9970\u5668"},{"location":"python/\u9ad8\u9636\u51fd\u6570/","text":"1. \u9ad8\u9636\u51fd\u6570 \u00b6 1.1 map \u00b6 map() \u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f f \uff0c\u5373\u51fd\u6570\u5bf9\u8c61\u672c\u8eab\u3002\u7531\u4e8e\u7ed3\u679c r \u662f\u4e00\u4e2a Iterator \uff0c Iterator \u662f\u60f0\u6027\u5e8f\u5217\uff0c\u56e0\u6b64\u901a\u8fc7 list() \u51fd\u6570\u8ba9\u5b83\u628a\u6574\u4e2a\u5e8f\u5217\u90fd\u8ba1\u7b97\u51fa\u6765\u5e76\u8fd4\u56de\u4e00\u4e2alist\u3002 from concurrent.futures import ThreadPoolExecutor import urllib.request urls = [ 'https://www.baidu.com/' , 'https://github.com/' , 'http://www.ht.com/' ] def load_url ( url ): with urllib . request . urlopen ( url , timeout = 60 ) as conn : print ( ' %r page is %d bytes' % ( url , len ( conn . read ()))) executor = ThreadPoolExecutor ( max_workers = 3 ) #for url in urls: # future = executor.submit(load_url, url) # print(future.done()) list ( map ( load_url , urls )) #executor.map(load_url, urls) print ( 'main thread' ) 1.2 reduce \u00b6 reduce \u628a\u4e00\u4e2a\u51fd\u6570\u4f5c\u7528\u5728\u4e00\u4e2a\u5e8f\u5217 [x1, x2, x3, ...] \u4e0a\uff0c\u8fd9\u4e2a\u51fd\u6570\u5fc5\u987b\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c reduce \u628a\u7ed3\u679c\u7ee7\u7eed\u548c\u5e8f\u5217\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\u505a\u7d2f\u79ef\u8ba1\u7b97\u3002 from functools import reduce nums = [ 1 , 2 , 3 ] def my_add ( x , y ): return x + y print ( reduce ( my_add , nums )) 1.3 filter \u00b6 filter() \u7684\u4f5c\u7528\u662f\u4ece\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7b5b\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u3002\u7531\u4e8e filter() \u4f7f\u7528\u4e86\u60f0\u6027\u8ba1\u7b97\uff0c\u6240\u4ee5\u53ea\u6709\u5728\u53d6 filter() \u7ed3\u679c\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u771f\u6b63\u7b5b\u9009\u5e76\u6bcf\u6b21\u8fd4\u56de\u4e0b\u4e00\u4e2a\u7b5b\u51fa\u7684\u5143\u7d20\u3002 \u5229\u7528filter\u6c42\u7d20\u6570\uff1a # \u5947\u6570\u5e8f\u5217 def _odd_iter (): n = 1 while True : n = n + 2 yield n # \u4e0d\u80fd\u88abn\u6574\u9664\u7684x def _not_divisible ( n ): return lambda x : x % n > 0 # \u7d20\u6570\u5e8f\u5217 def primes (): yield 2 it = _odd_iter () while True : n = next ( it ) yield n it = filter ( _not_divisible ( n ), it ) for n in primes (): if n < 1000 : print ( n ) continue break 1.4 sorted \u00b6 sorted() \u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a\u51fd\u6570\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6392\u5e8f\uff1a sorted ([ 36 , 5 , - 12 , 9 , - 21 ], key = abs ) # [5, 9, -12, -21, 36] \u53cd\u5411\u6392\u5e8f reverse=True \uff1a sorted ([ 'bob' , 'about' , 'Zoo' , 'Credit' ], key = str . lower , reverse = True ) # ['Zoo', 'Credit', 'bob', 'about']","title":"\u9ad8\u9636\u51fd\u6570"},{"location":"python/\u9ad8\u9636\u51fd\u6570/#1","text":"","title":"1. \u9ad8\u9636\u51fd\u6570"},{"location":"python/\u9ad8\u9636\u51fd\u6570/#11-map","text":"map() \u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f f \uff0c\u5373\u51fd\u6570\u5bf9\u8c61\u672c\u8eab\u3002\u7531\u4e8e\u7ed3\u679c r \u662f\u4e00\u4e2a Iterator \uff0c Iterator \u662f\u60f0\u6027\u5e8f\u5217\uff0c\u56e0\u6b64\u901a\u8fc7 list() \u51fd\u6570\u8ba9\u5b83\u628a\u6574\u4e2a\u5e8f\u5217\u90fd\u8ba1\u7b97\u51fa\u6765\u5e76\u8fd4\u56de\u4e00\u4e2alist\u3002 from concurrent.futures import ThreadPoolExecutor import urllib.request urls = [ 'https://www.baidu.com/' , 'https://github.com/' , 'http://www.ht.com/' ] def load_url ( url ): with urllib . request . urlopen ( url , timeout = 60 ) as conn : print ( ' %r page is %d bytes' % ( url , len ( conn . read ()))) executor = ThreadPoolExecutor ( max_workers = 3 ) #for url in urls: # future = executor.submit(load_url, url) # print(future.done()) list ( map ( load_url , urls )) #executor.map(load_url, urls) print ( 'main thread' )","title":"1.1 map"},{"location":"python/\u9ad8\u9636\u51fd\u6570/#12-reduce","text":"reduce \u628a\u4e00\u4e2a\u51fd\u6570\u4f5c\u7528\u5728\u4e00\u4e2a\u5e8f\u5217 [x1, x2, x3, ...] \u4e0a\uff0c\u8fd9\u4e2a\u51fd\u6570\u5fc5\u987b\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c reduce \u628a\u7ed3\u679c\u7ee7\u7eed\u548c\u5e8f\u5217\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\u505a\u7d2f\u79ef\u8ba1\u7b97\u3002 from functools import reduce nums = [ 1 , 2 , 3 ] def my_add ( x , y ): return x + y print ( reduce ( my_add , nums ))","title":"1.2 reduce"},{"location":"python/\u9ad8\u9636\u51fd\u6570/#13-filter","text":"filter() \u7684\u4f5c\u7528\u662f\u4ece\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7b5b\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u3002\u7531\u4e8e filter() \u4f7f\u7528\u4e86\u60f0\u6027\u8ba1\u7b97\uff0c\u6240\u4ee5\u53ea\u6709\u5728\u53d6 filter() \u7ed3\u679c\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u771f\u6b63\u7b5b\u9009\u5e76\u6bcf\u6b21\u8fd4\u56de\u4e0b\u4e00\u4e2a\u7b5b\u51fa\u7684\u5143\u7d20\u3002 \u5229\u7528filter\u6c42\u7d20\u6570\uff1a # \u5947\u6570\u5e8f\u5217 def _odd_iter (): n = 1 while True : n = n + 2 yield n # \u4e0d\u80fd\u88abn\u6574\u9664\u7684x def _not_divisible ( n ): return lambda x : x % n > 0 # \u7d20\u6570\u5e8f\u5217 def primes (): yield 2 it = _odd_iter () while True : n = next ( it ) yield n it = filter ( _not_divisible ( n ), it ) for n in primes (): if n < 1000 : print ( n ) continue break","title":"1.3 filter"},{"location":"python/\u9ad8\u9636\u51fd\u6570/#14-sorted","text":"sorted() \u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a\u51fd\u6570\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6392\u5e8f\uff1a sorted ([ 36 , 5 , - 12 , 9 , - 21 ], key = abs ) # [5, 9, -12, -21, 36] \u53cd\u5411\u6392\u5e8f reverse=True \uff1a sorted ([ 'bob' , 'about' , 'Zoo' , 'Credit' ], key = str . lower , reverse = True ) # ['Zoo', 'Credit', 'bob', 'about']","title":"1.4 sorted"},{"location":"rpm/00 \u793a\u4f8b/","text":"\u5b98\u65b9\u6587\u6863 1. RPM \u4f18\u52bf \u00b6 \u4f7f\u7528RPM\uff0c\u4f60\u53ef\u4ee5\uff1a \u5b89\u88c5\u3001\u91cd\u65b0\u5b89\u88c5\u3001\u5220\u9664\u3001\u5347\u7ea7\u548c\u9a8c\u8bc1\u5305 \u4f7f\u7528\u5b89\u88c5\u8fc7\u7684\u5305\u7684\u6570\u636e\u5e93\u6765\u67e5\u8be2\u548c\u9a8c\u8bc1\u5305 \u4f7f\u7528\u5143\u6570\u636e\u63cf\u8ff0\u5305\uff0c\u548c\u5305\u7684\u5b89\u88c5\u624b\u518c\uff0c\u7b49\u7b49 \u5c06\u6e90\u7801\u6253\u5305\u5230\u6e90\u7801\u5305\u548c\u4e8c\u8fdb\u5236\u5305 \u5411yum\u4ed3\u5e93\u6dfb\u52a0\u5305 \u5bf9\u5305\u8fdb\u884c\u6570\u5b57\u7b7e\u540d 2. \u793a\u4f8b \u00b6 \u7b80\u5355\u7684 hello-world.spec \u6587\u4ef6\uff1a Name : hello - world Version : 1 Release : 1 Summary : Most simple RPM package License : FIXME %description This is my first RPM package , which does nothing . %prep # we have no source, so nothing here %build cat > hello - world . sh << EOF #!/usr/bin/bash echo Hello world EOF %install mkdir - p % { buildroot } / usr / bin / install - m 755 hello - world . sh % { buildroot } / usr / bin / hello - world . sh %files / usr / bin / hello - world . sh %changelog # let's skip this for now \u6784\u5efaRPM\u5305\uff1a $ rpmbuild -ba hello-world.spec","title":"00 \u793a\u4f8b"},{"location":"rpm/00 \u793a\u4f8b/#1-rpm","text":"\u4f7f\u7528RPM\uff0c\u4f60\u53ef\u4ee5\uff1a \u5b89\u88c5\u3001\u91cd\u65b0\u5b89\u88c5\u3001\u5220\u9664\u3001\u5347\u7ea7\u548c\u9a8c\u8bc1\u5305 \u4f7f\u7528\u5b89\u88c5\u8fc7\u7684\u5305\u7684\u6570\u636e\u5e93\u6765\u67e5\u8be2\u548c\u9a8c\u8bc1\u5305 \u4f7f\u7528\u5143\u6570\u636e\u63cf\u8ff0\u5305\uff0c\u548c\u5305\u7684\u5b89\u88c5\u624b\u518c\uff0c\u7b49\u7b49 \u5c06\u6e90\u7801\u6253\u5305\u5230\u6e90\u7801\u5305\u548c\u4e8c\u8fdb\u5236\u5305 \u5411yum\u4ed3\u5e93\u6dfb\u52a0\u5305 \u5bf9\u5305\u8fdb\u884c\u6570\u5b57\u7b7e\u540d","title":"1. RPM \u4f18\u52bf"},{"location":"rpm/00 \u793a\u4f8b/#2","text":"\u7b80\u5355\u7684 hello-world.spec \u6587\u4ef6\uff1a Name : hello - world Version : 1 Release : 1 Summary : Most simple RPM package License : FIXME %description This is my first RPM package , which does nothing . %prep # we have no source, so nothing here %build cat > hello - world . sh << EOF #!/usr/bin/bash echo Hello world EOF %install mkdir - p % { buildroot } / usr / bin / install - m 755 hello - world . sh % { buildroot } / usr / bin / hello - world . sh %files / usr / bin / hello - world . sh %changelog # let's skip this for now \u6784\u5efaRPM\u5305\uff1a $ rpmbuild -ba hello-world.spec","title":"2. \u793a\u4f8b"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/","text":"1. \u5982\u4f55\u5236\u4f5c\u7a0b\u5e8f \u00b6 \u867d\u7136\u6709\u5f88\u591a\u65b9\u6cd5\u5c06\u4eba\u7c7b\u9605\u8bfb\u7684\u6e90\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u7801\uff0c\u4f46\u662f\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u4ee5\u4e0b\u4e09\u79cd\uff1a The program is natively compiled. The program is interpreted by raw interpreting. The program is interpreted by byte compiling. \u7a0b\u5e8f\u662f\u672c\u5730\u7f16\u8bd1\u7684 \u7a0b\u5e8f\u901a\u8fc7\u539f\u59cb\u89e3\u91ca\u5668\u89e3\u91ca \u7a0b\u5e8f\u901a\u8fc7\u5b57\u8282\u7f16\u8bd1\u89e3\u91ca 1.1 Natively Compiled Code \u00b6 \u672c\u673a\u7f16\u8bd1\u7684\u8f6f\u4ef6\u662f\u6307\u7528\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u7684\u8f6f\u4ef6\uff0c\u7f16\u8bd1\u6210\u673a\u5668\u4ee3\u7801\uff0c\u751f\u6210\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u79cd\u8f6f\u4ef6\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u3002 \u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6784\u5efa\u7684RPM\u5305\u662f\u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u3002\u610f\u5473\u7740\u5982\u679c\u4f60\u572864-bit\u67b6\u6784\u7684\u673a\u5668\u4e0a\u7f16\u8bd1\uff0c\u5219\u4e0d\u80fd\u572832-bit\u67b6\u6784\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u3002\u6253\u5305\u7684\u7ed3\u679c\u4f1a\u5728\u540d\u5b57\u4e2d\u542b\u6709\u7279\u5b9a\u7684\u67b6\u6784\u3002 1.2 Interpreted Code \u00b6 \u4e00\u4e9b\u7f16\u7a0b\u8bed\u8a00\uff08bash\u3001python\u7b49\uff09\u4e0d\u4f1a\u7f16\u8bd1\u6210\u673a\u5668\u7801\u3002\u76f8\u53cd\uff0c\u4ed6\u4eec\u7684\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u662f\u7531\u8bed\u8a00\u89e3\u91ca\u5668\u6216\u8bed\u8a00\u865a\u62df\u673a\u9010\u6b65\u6267\u884c\u7684\uff0c\u65e0\u9700\u4e8b\u5148\u8f6c\u6362\u3002 \u5b8c\u5168\u7528\u89e3\u91ca\u578b\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u7684\u8f6f\u4ef6\u4e0d\u662f\u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u3002\u4e8e\u662fRPM\u5305\u540d\u4e2d\u4f1a\u542b\u6709 noarch \u3002 \u89e3\u91ca\u578b\u8bed\u8a00\u53c8\u5206\u4e3a\u4e24\u79cd\uff0c\u8fd9\u4e24\u79cd\u7c7b\u578b\u5728\u7a0b\u5e8f\u6784\u5efa\u8fc7\u7a0b\u548c\u6253\u5305\u8fc7\u7a0b\u4e2d\u6709\u6240\u4e0d\u540c\uff1a raw-interpreted\uff1a Raw-interpreted \u8bed\u8a00\u7a0b\u5e8f\u5b8c\u5168\u4e0d\u9700\u8981\u7f16\u8bd1\uff0c\u76f4\u63a5\u88ab\u89e3\u91ca\u5668\u6267\u884c\u3002 byte-compiled Byte-compiled \u8bed\u8a00\u9700\u8981\u88ab\u7f16\u8bd1\u4e3a\u5b57\u8282\u7801\uff0c\u7136\u540e\u5728\u865a\u62df\u673a\u4e2d\u6267\u884c\u3002 \u6ce8\u610f\uff1a\u67d0\u4e9b\u8bed\u8a00\u53ef\u4ee5\u9009\u62e9\u4e24\u79cd\u6a21\u5f0f\u4e2d\u7684\u4e00\u79cd\u3002 2. \u4e09\u79cd\u8bed\u8a00\u7c7b\u578b\u6784\u5efa\u8fc7\u7a0b\u4e3e\u4f8b \u00b6 2.1 Natively Compiled Code \u00b6 C\u8bed\u8a00\u6e90\u7801 cello.c \uff1a #include <stdio.h> int main ( void ) { printf ( \"Hello World \\n \" ); return 0 ; } 2.1.1 \u624b\u52a8\u6784\u5efa \u00b6 gcc -g -o cello cello.c \u6267\u884c\uff1a $ ./cello Hello World 2.1.2 \u81ea\u52a8\u6784\u5efa \u00b6 Makefile \uff1a cello : gcc -g -o cello cello.c clean : rm cello \u6784\u5efa\uff1a $ make make: 'cello' is up to date. \u6267\u884c\uff1a $ ./cello Hello World 2.2 Interpreted Code \u00b6 2.2.1 Raw Interpreted Code \u00b6 bello \uff1a #!/bin/bash printf \"Hello World\\n\" \u8fd0\u884c\uff1a $ chmod +x bello $ ./bello Hello World 2.2.2 Byte-Compiled Code \u00b6 python\u6e90\u7801\u53ef\u4ee5\u662f raw-interpreted \uff0c\u4f46\u662f byte-compiled \u7248\u672c\u66f4\u5feb\u3002\u56e0\u6b64\uff0cRPM\u503e\u5411\u4e8e\u6253\u5305 byte-compiled \u7248\u672c\u4ee5\u53d1\u5e03\u7ed9\u6700\u7ec8\u7528\u6237\u3002 pello.py \uff1a #!/usr/bin/env python print ( \"Hello World\" ) Byte-compile pello.py \uff1a $ python -m compileall pello.py $ file pello.pyc pello.pyc: python 2 .7 byte-compiled \u6267\u884c\uff1a $ python pello.pyc Hello World 3. \u4e3a\u8f6f\u4ef6\u6253\u8865\u4e01 \u00b6 \u4f7f\u7528 diff \u5de5\u5177\u68c0\u67e5\u4e0d\u540c\uff0c\u8f93\u51fa\u8865\u4e01\u6587\u4ef6\uff1b\u4f7f\u7528 patch \u5de5\u5177\u5bf9\u6587\u4ef6\u6253\u8865\u4e01\u3002\u7c7b\u4f3c\u4e8e\u7248\u672c\u63a7\u5236\u7cfb\u7edf git \u3002 \u4e3a cello.c \u6587\u4ef6\u6253\u8865\u4e01\u4e3e\u4f8b\uff1a \u4fdd\u5b58\u539f\u6587\u4ef6 $ cp cello.c cello.c.orig \u4fee\u6539\u6e90\u7801 cello.c #include <stdio.h> int main ( void ) { printf ( \"Hello World from my very first patch! \\n \" ); return 0 ; } \u4f7f\u7528 diff \u751f\u6210\u4e00\u4e2a\u8865\u4e01 $ diff -Naur cello.c.orig cello.c --- cello.c.orig 2016 -05-26 17 :21:30.478523360 -0500 +++ cello.c 2016 -05-27 14 :53:20.668588245 -0500 @@ -1,6 +1,6 @@ #include<stdio.h> int main ( void ){ - printf ( \"Hello World!\\n\" ) ; + printf ( \"Hello World from my very first patch!\\n\" ) ; return 0 ; } \u5c06\u8865\u4e01\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d $ diff -Naur cello.c.orig cello.c > cello-output-first-patch.patch \u6062\u590d\u539f\u6587\u4ef6 $ cp cello.c.orig cello.c \u4f7f\u7528 patch \u5e94\u7528\u8865\u4e01 $ patch < cello-output-first-patch.patch patching file cello.c 4. \u5b89\u88c5\u4efb\u610f\u90e8\u4ef6 \u00b6 linux\u4f7f\u7528\u4e86 Filesystem Hierarchy Standard (FHS)\u6765\u89c4\u5b9a\u4f55\u79cd\u6587\u4ef6\u5b58\u653e\u5728\u54ea\u91cc\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e24\u79cd\u65b9\u6cd5\u5c06\u4efb\u610f\u6587\u4ef6\u653e\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u3002 4.1 \u4f7f\u7528 install \u547d\u4ee4 \u00b6 \u6709\u65f6\u4f7f\u7528\u81ea\u52a8\u6784\u5efa\u5de5\u5177\uff08make\u7b49\uff09\u5e76\u4e0d\u662f\u6700\u4f18\u9009\u62e9\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u6253\u5305\u7684\u7a0b\u5e8f\u7b80\u5355\u800c\u4e14\u4e0d\u9700\u8981\u63d0\u53d6\u5f00\u9500\u3002\u6b64\u65f6\u7ecf\u5e38\u4f7f\u7528 install \u547d\u4ee4\u5c06\u6587\u4ef6\u4ee5\u6307\u5b9a\u6743\u9650\u653e\u5728\u6307\u5b9a\u76ee\u5f55\u3002 $ sudo install -m 0755 bello /usr/bin/bello 4.2 \u4f7f\u7528 make install \u547d\u4ee4 \u00b6 \u5728 Makefile \u4e2d\u6dfb\u52a0 install \u90e8\u5206\uff1a cello : gcc -g -o cello cello.c clean : rm cello install : mkdir -p $( DESTDIR ) /usr/bin install -m 0755 cello $( DESTDIR ) /usr/bin/cello \u6784\u5efa\u4e0e\u5b89\u88c5\uff1a $ make gcc -g -o cello cello.c $ sudo make install install -m 0755 cello /usr/bin/cello 5. \u4e3a\u6253\u5305\u51c6\u5907\u6e90\u7801 \u00b6 \u5f00\u53d1\u8005\u7ecf\u5e38\u53d1\u5e03\u8f6f\u4ef6\u65b9\u5f0f\u662f\u538b\u7f29\u6253\u5305\u6e90\u7801\u3002 \u8f6f\u4ef6\u5e94\u4e0e \u8f6f\u4ef6\u8bb8\u53ef\u8bc1 \uff08license\uff09\u4e00\u8d77\u5206\u53d1\uff0c\u4e00\u822c\u5199\u5728 LICENSE \u6587\u4ef6\u4e2d\u3002GPLv3 license\uff1a $ cat /tmp/LICENSE This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or ( at your option ) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY ; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program. If not, see <http://www.gnu.org/licenses/>. 5.1 \u5c06\u6e90\u7801\u653e\u5230\u538b\u7f29\u5305\u4e2d \u00b6 \u4e0b\u9762\u7684\u4f8b\u5b50\u4f7f\u7528 gzip \u538b\u7f29\u5305\u3002 5.1.1 cello \u00b6 \u5c06\u6587\u4ef6\u653e\u5728\u5355\u72ec\u7684\u6587\u4ef6\u4e2d\uff0c\u7248\u672c\u662f1.0 # \u6ce8\u610f\uff0c\u6587\u4ef6\u5939\u540d\u79f0\u5fc5\u987b\u548c \u201cname-version\u201d \u4e00\u81f4 $ mkdir /tmp/cello-1.0 $ mv ~/cello.c /tmp/cello-1.0/ $ mv ~/Makefile /tmp/cello-1.0/ $ cp /tmp/LICENSE /tmp/cello-1.0/ \u521b\u5efa\u7528\u4e8e\u53d1\u5e03\u7684\u6253\u5305\u6587\u4ef6\u5e76\u79fb\u52a8\u5230 ~/rpmbuild/SOURCES/ $ cd /tmp/ $ tar -cvzf cello-1.0.tar.gz cello-1.0 cello-1.0/ cello-1.0/Makefile cello-1.0/cello.c cello-1.0/LICENSE $ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/ \u6dfb\u52a0\u8865\u4e01 \u5982\u679c\u6709\u8865\u4e01\u6587\u4ef6\u7684\u8bdd\uff0c\u5c06\u8865\u4e01\u6587\u4ef6\u4e5f\u653e\u5728 ~/rpmbuild/SOURCES/ \u4e0b\uff08\u5982\u679c\u4e0d\u624b\u52a8\u7f16\u5199\u89c4\u5219\uff0c\u597d\u50cf\u4e0d\u4f1a\u5e94\u7528\u8865\u4e01\uff09\u3002 $ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/ \u73b0\u5728\uff0c\u6e90\u7801\u5df2\u7ecf\u51c6\u5907\u597d\u6253\u5305\u5230RPM\u4e2d\u4e86\u3002","title":"01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#1","text":"\u867d\u7136\u6709\u5f88\u591a\u65b9\u6cd5\u5c06\u4eba\u7c7b\u9605\u8bfb\u7684\u6e90\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u7801\uff0c\u4f46\u662f\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u4ee5\u4e0b\u4e09\u79cd\uff1a The program is natively compiled. The program is interpreted by raw interpreting. The program is interpreted by byte compiling. \u7a0b\u5e8f\u662f\u672c\u5730\u7f16\u8bd1\u7684 \u7a0b\u5e8f\u901a\u8fc7\u539f\u59cb\u89e3\u91ca\u5668\u89e3\u91ca \u7a0b\u5e8f\u901a\u8fc7\u5b57\u8282\u7f16\u8bd1\u89e3\u91ca","title":"1. \u5982\u4f55\u5236\u4f5c\u7a0b\u5e8f"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#11-natively-compiled-code","text":"\u672c\u673a\u7f16\u8bd1\u7684\u8f6f\u4ef6\u662f\u6307\u7528\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u7684\u8f6f\u4ef6\uff0c\u7f16\u8bd1\u6210\u673a\u5668\u4ee3\u7801\uff0c\u751f\u6210\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u79cd\u8f6f\u4ef6\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u3002 \u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6784\u5efa\u7684RPM\u5305\u662f\u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u3002\u610f\u5473\u7740\u5982\u679c\u4f60\u572864-bit\u67b6\u6784\u7684\u673a\u5668\u4e0a\u7f16\u8bd1\uff0c\u5219\u4e0d\u80fd\u572832-bit\u67b6\u6784\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u3002\u6253\u5305\u7684\u7ed3\u679c\u4f1a\u5728\u540d\u5b57\u4e2d\u542b\u6709\u7279\u5b9a\u7684\u67b6\u6784\u3002","title":"1.1 Natively Compiled Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#12-interpreted-code","text":"\u4e00\u4e9b\u7f16\u7a0b\u8bed\u8a00\uff08bash\u3001python\u7b49\uff09\u4e0d\u4f1a\u7f16\u8bd1\u6210\u673a\u5668\u7801\u3002\u76f8\u53cd\uff0c\u4ed6\u4eec\u7684\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u662f\u7531\u8bed\u8a00\u89e3\u91ca\u5668\u6216\u8bed\u8a00\u865a\u62df\u673a\u9010\u6b65\u6267\u884c\u7684\uff0c\u65e0\u9700\u4e8b\u5148\u8f6c\u6362\u3002 \u5b8c\u5168\u7528\u89e3\u91ca\u578b\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u7684\u8f6f\u4ef6\u4e0d\u662f\u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u3002\u4e8e\u662fRPM\u5305\u540d\u4e2d\u4f1a\u542b\u6709 noarch \u3002 \u89e3\u91ca\u578b\u8bed\u8a00\u53c8\u5206\u4e3a\u4e24\u79cd\uff0c\u8fd9\u4e24\u79cd\u7c7b\u578b\u5728\u7a0b\u5e8f\u6784\u5efa\u8fc7\u7a0b\u548c\u6253\u5305\u8fc7\u7a0b\u4e2d\u6709\u6240\u4e0d\u540c\uff1a raw-interpreted\uff1a Raw-interpreted \u8bed\u8a00\u7a0b\u5e8f\u5b8c\u5168\u4e0d\u9700\u8981\u7f16\u8bd1\uff0c\u76f4\u63a5\u88ab\u89e3\u91ca\u5668\u6267\u884c\u3002 byte-compiled Byte-compiled \u8bed\u8a00\u9700\u8981\u88ab\u7f16\u8bd1\u4e3a\u5b57\u8282\u7801\uff0c\u7136\u540e\u5728\u865a\u62df\u673a\u4e2d\u6267\u884c\u3002 \u6ce8\u610f\uff1a\u67d0\u4e9b\u8bed\u8a00\u53ef\u4ee5\u9009\u62e9\u4e24\u79cd\u6a21\u5f0f\u4e2d\u7684\u4e00\u79cd\u3002","title":"1.2 Interpreted Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#2","text":"","title":"2. \u4e09\u79cd\u8bed\u8a00\u7c7b\u578b\u6784\u5efa\u8fc7\u7a0b\u4e3e\u4f8b"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#21-natively-compiled-code","text":"C\u8bed\u8a00\u6e90\u7801 cello.c \uff1a #include <stdio.h> int main ( void ) { printf ( \"Hello World \\n \" ); return 0 ; }","title":"2.1 Natively Compiled Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#211","text":"gcc -g -o cello cello.c \u6267\u884c\uff1a $ ./cello Hello World","title":"2.1.1 \u624b\u52a8\u6784\u5efa"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#212","text":"Makefile \uff1a cello : gcc -g -o cello cello.c clean : rm cello \u6784\u5efa\uff1a $ make make: 'cello' is up to date. \u6267\u884c\uff1a $ ./cello Hello World","title":"2.1.2 \u81ea\u52a8\u6784\u5efa"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#22-interpreted-code","text":"","title":"2.2 Interpreted Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#221-raw-interpreted-code","text":"bello \uff1a #!/bin/bash printf \"Hello World\\n\" \u8fd0\u884c\uff1a $ chmod +x bello $ ./bello Hello World","title":"2.2.1 Raw Interpreted Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#222-byte-compiled-code","text":"python\u6e90\u7801\u53ef\u4ee5\u662f raw-interpreted \uff0c\u4f46\u662f byte-compiled \u7248\u672c\u66f4\u5feb\u3002\u56e0\u6b64\uff0cRPM\u503e\u5411\u4e8e\u6253\u5305 byte-compiled \u7248\u672c\u4ee5\u53d1\u5e03\u7ed9\u6700\u7ec8\u7528\u6237\u3002 pello.py \uff1a #!/usr/bin/env python print ( \"Hello World\" ) Byte-compile pello.py \uff1a $ python -m compileall pello.py $ file pello.pyc pello.pyc: python 2 .7 byte-compiled \u6267\u884c\uff1a $ python pello.pyc Hello World","title":"2.2.2 Byte-Compiled Code"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#3","text":"\u4f7f\u7528 diff \u5de5\u5177\u68c0\u67e5\u4e0d\u540c\uff0c\u8f93\u51fa\u8865\u4e01\u6587\u4ef6\uff1b\u4f7f\u7528 patch \u5de5\u5177\u5bf9\u6587\u4ef6\u6253\u8865\u4e01\u3002\u7c7b\u4f3c\u4e8e\u7248\u672c\u63a7\u5236\u7cfb\u7edf git \u3002 \u4e3a cello.c \u6587\u4ef6\u6253\u8865\u4e01\u4e3e\u4f8b\uff1a \u4fdd\u5b58\u539f\u6587\u4ef6 $ cp cello.c cello.c.orig \u4fee\u6539\u6e90\u7801 cello.c #include <stdio.h> int main ( void ) { printf ( \"Hello World from my very first patch! \\n \" ); return 0 ; } \u4f7f\u7528 diff \u751f\u6210\u4e00\u4e2a\u8865\u4e01 $ diff -Naur cello.c.orig cello.c --- cello.c.orig 2016 -05-26 17 :21:30.478523360 -0500 +++ cello.c 2016 -05-27 14 :53:20.668588245 -0500 @@ -1,6 +1,6 @@ #include<stdio.h> int main ( void ){ - printf ( \"Hello World!\\n\" ) ; + printf ( \"Hello World from my very first patch!\\n\" ) ; return 0 ; } \u5c06\u8865\u4e01\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d $ diff -Naur cello.c.orig cello.c > cello-output-first-patch.patch \u6062\u590d\u539f\u6587\u4ef6 $ cp cello.c.orig cello.c \u4f7f\u7528 patch \u5e94\u7528\u8865\u4e01 $ patch < cello-output-first-patch.patch patching file cello.c","title":"3. \u4e3a\u8f6f\u4ef6\u6253\u8865\u4e01"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#4","text":"linux\u4f7f\u7528\u4e86 Filesystem Hierarchy Standard (FHS)\u6765\u89c4\u5b9a\u4f55\u79cd\u6587\u4ef6\u5b58\u653e\u5728\u54ea\u91cc\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e24\u79cd\u65b9\u6cd5\u5c06\u4efb\u610f\u6587\u4ef6\u653e\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u3002","title":"4. \u5b89\u88c5\u4efb\u610f\u90e8\u4ef6"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#41-install","text":"\u6709\u65f6\u4f7f\u7528\u81ea\u52a8\u6784\u5efa\u5de5\u5177\uff08make\u7b49\uff09\u5e76\u4e0d\u662f\u6700\u4f18\u9009\u62e9\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u6253\u5305\u7684\u7a0b\u5e8f\u7b80\u5355\u800c\u4e14\u4e0d\u9700\u8981\u63d0\u53d6\u5f00\u9500\u3002\u6b64\u65f6\u7ecf\u5e38\u4f7f\u7528 install \u547d\u4ee4\u5c06\u6587\u4ef6\u4ee5\u6307\u5b9a\u6743\u9650\u653e\u5728\u6307\u5b9a\u76ee\u5f55\u3002 $ sudo install -m 0755 bello /usr/bin/bello","title":"4.1 \u4f7f\u7528 install \u547d\u4ee4"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#42-make-install","text":"\u5728 Makefile \u4e2d\u6dfb\u52a0 install \u90e8\u5206\uff1a cello : gcc -g -o cello cello.c clean : rm cello install : mkdir -p $( DESTDIR ) /usr/bin install -m 0755 cello $( DESTDIR ) /usr/bin/cello \u6784\u5efa\u4e0e\u5b89\u88c5\uff1a $ make gcc -g -o cello cello.c $ sudo make install install -m 0755 cello /usr/bin/cello","title":"4.2 \u4f7f\u7528 make install \u547d\u4ee4"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#5","text":"\u5f00\u53d1\u8005\u7ecf\u5e38\u53d1\u5e03\u8f6f\u4ef6\u65b9\u5f0f\u662f\u538b\u7f29\u6253\u5305\u6e90\u7801\u3002 \u8f6f\u4ef6\u5e94\u4e0e \u8f6f\u4ef6\u8bb8\u53ef\u8bc1 \uff08license\uff09\u4e00\u8d77\u5206\u53d1\uff0c\u4e00\u822c\u5199\u5728 LICENSE \u6587\u4ef6\u4e2d\u3002GPLv3 license\uff1a $ cat /tmp/LICENSE This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or ( at your option ) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY ; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program. If not, see <http://www.gnu.org/licenses/>.","title":"5. \u4e3a\u6253\u5305\u51c6\u5907\u6e90\u7801"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#51","text":"\u4e0b\u9762\u7684\u4f8b\u5b50\u4f7f\u7528 gzip \u538b\u7f29\u5305\u3002","title":"5.1 \u5c06\u6e90\u7801\u653e\u5230\u538b\u7f29\u5305\u4e2d"},{"location":"rpm/01 \u6253\u5305\u524d\u7684\u51c6\u5907\u5de5\u4f5c/#511-cello","text":"\u5c06\u6587\u4ef6\u653e\u5728\u5355\u72ec\u7684\u6587\u4ef6\u4e2d\uff0c\u7248\u672c\u662f1.0 # \u6ce8\u610f\uff0c\u6587\u4ef6\u5939\u540d\u79f0\u5fc5\u987b\u548c \u201cname-version\u201d \u4e00\u81f4 $ mkdir /tmp/cello-1.0 $ mv ~/cello.c /tmp/cello-1.0/ $ mv ~/Makefile /tmp/cello-1.0/ $ cp /tmp/LICENSE /tmp/cello-1.0/ \u521b\u5efa\u7528\u4e8e\u53d1\u5e03\u7684\u6253\u5305\u6587\u4ef6\u5e76\u79fb\u52a8\u5230 ~/rpmbuild/SOURCES/ $ cd /tmp/ $ tar -cvzf cello-1.0.tar.gz cello-1.0 cello-1.0/ cello-1.0/Makefile cello-1.0/cello.c cello-1.0/LICENSE $ mv /tmp/cello-1.0.tar.gz ~/rpmbuild/SOURCES/ \u6dfb\u52a0\u8865\u4e01 \u5982\u679c\u6709\u8865\u4e01\u6587\u4ef6\u7684\u8bdd\uff0c\u5c06\u8865\u4e01\u6587\u4ef6\u4e5f\u653e\u5728 ~/rpmbuild/SOURCES/ \u4e0b\uff08\u5982\u679c\u4e0d\u624b\u52a8\u7f16\u5199\u89c4\u5219\uff0c\u597d\u50cf\u4e0d\u4f1a\u5e94\u7528\u8865\u4e01\uff09\u3002 $ mv ~/cello-output-first-patch.patch ~/rpmbuild/SOURCES/ \u73b0\u5728\uff0c\u6e90\u7801\u5df2\u7ecf\u51c6\u5907\u597d\u6253\u5305\u5230RPM\u4e2d\u4e86\u3002","title":"5.1.1 cello"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/","text":"1. RPM \u5305 \u00b6 \u6709\u4e24\u79cdRPM\u5305\uff1a source RPM (SRPM) binary RPM \u4e24\u8005\u7684\u6587\u4ef6\u683c\u5f0f\u548c\u5de5\u5177\u662f\u76f8\u540c\u7684\uff0c\u4f46\u6709\u4e0d\u540c\u7684\u5185\u5bb9\uff0c\u670d\u52a1\u4e8e\u4e0d\u540c\u7684\u76ee\u7684\u3002SRPM\u5305\u542b\u6e90\u4ee3\u7801\uff0c\u53ef\u9009\u7684\u8865\u4e01\u548cSPEC\u6587\u4ef6\uff0c\u5b83\u63cf\u8ff0\u4e86\u5982\u4f55\u5c06\u6e90\u4ee3\u7801\u6784\u5efa\u4e3a\u4e8c\u8fdb\u5236RPM\u3002\u4e8c\u8fdb\u5236RPM\u5305\u542b\u4ece\u6e90\u7801\u548c\u8865\u4e01\u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002 1.1 RPM \u6253\u5305\u5de5\u5177 \u00b6 rpmdevtools \u63d0\u4f9b\u4e86\u4e00\u4e9b\u6253\u5305\u5de5\u5177\uff0c\u67e5\u770b\u8fd9\u4e9b\u5de5\u5177\uff1a $ rpm -ql rpmdevtools | grep bin 1.2 RPM \u6253\u5305\u5de5\u4f5c\u533a \u00b6 \u4f7f\u7528 rpmdev-setuptree \u8bbe\u7f6e\u76ee\u5f55\u5e03\u5c40\uff0c\u5373RPM\u6253\u5305\u5de5\u4f5c\u533a: $ rpmdev-setuptree $ tree ~/rpmbuild/ /home/user/rpmbuild/ \u251c\u2500\u2500 BUILD \u251c\u2500\u2500 RPMS \u251c\u2500\u2500 SOURCES \u251c\u2500\u2500 SPECS \u2514\u2500\u2500 SRPMS 5 directories, 0 files \u76ee\u5f55 Purpose BUILD \u5f53\u521b\u5efa\u5305\u65f6\uff0c\u5404\u79cd %buildroot \u76ee\u5f55\u5728\u8fd9\u91cc\u521b\u5efa\u3002\u5982\u679c\u521b\u5efa\u5931\u8d25\u65f6\uff0c\u800c\u65e5\u5fd7\u8f93\u51fa\u53c8\u6ca1\u6709\u63d0\u4f9b\u8db3\u591f\u7684\u4fe1\u606f\uff0c\u8fd9\u5c06\u5f88\u6709\u7528\u5904\u3002 RPMS \u4e8c\u8fdb\u5236 RPMs \u5728\u8fd9\u91cc\u521b\u5efa\uff0c\u5b50\u76ee\u5f55\u8868\u793a\u4e0d\u540c\u7684\u67b6\u6784, \u6bd4\u5982 x86_64 \u548c noarch \u3002 SOURCES \u538b\u7f29\u6e90\u7801\u5305\u548c\u8865\u4e01\u5b58\u653e\u5730\uff0c rpmbuild \u547d\u4ee4\u4ece\u8fd9\u91cc\u5bfb\u627e\u5b83\u4eec\u3002 SPECS SPEC\u6587\u4ef6\u5b58\u653e\u5730 SRPMS rpmbuild \u521b\u5efa SRPM \u65f6\uff0c SRPM \u5728\u8fd9\u91cc\u521b\u5efa 1.3 SPEC \u6587\u4ef6 \u00b6 \u5b83\u901a\u8fc7\u5728\u4e00\u7cfb\u5217\u7ae0\u8282\u4e2d\u5b9a\u4e49\u6307\u4ee4\u6765\u544a\u8bc9\u6784\u5efa\u7cfb\u7edf\u8981\u505a\u4ec0\u4e48\u3002 \u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a Preamble \uff08\u5305\u542bBody\u4e2d\u4f7f\u7528\u7684\u4e00\u7cfb\u5217\u5143\u6570\u636e\u9879\u3002\uff09\u548c Body \uff08\u5305\u542b\u6307\u4ee4\u7684\u4e3b\u8981\u90e8\u5206\uff09\u3002 1.3.1 Preamble \u00b6 SPEC \u6307\u4ee4 \u5b9a\u4e49 Name \u5305\u7684\u57fa\u7840\u540d\uff0c\u5e94\u8be5\u548c SPEC \u6587\u4ef6\u540d\u5339\u914d\u3002 Version \u8f6f\u4ef6\u7684\u4e0a\u6e38\u7248\u672c Release \u6b64\u7248\u672c\u7684\u8f6f\u4ef6\u53d1\u5e03\u7684\u6b21\u6570\u3002 \u901a\u5e38\uff0c\u8bbe\u7f6e\u521d\u59cb\u503c\u4e3a 1%{?dist} \uff0c\u6bcf\u6b21\u53d1\u5e03\u65b0\u7684\u65f6\u5019\u5c31\u589e\u52a0\u5b83\u3002\u5f53\u65b0\u7684 Version \u6784\u5efa\u65f6\u91cd\u7f6e\u4e3a 1 \u3002 Summary \u5305\u7684\u5728\u7ebf\u7b80\u8981\u4ecb\u7ecd License \u88ab\u6253\u5305\u8f6f\u4ef6\u7684 license \u3002 URL \u5173\u4e8e\u8f6f\u4ef6\u7684\u66f4\u591a\u4fe1\u606f\u7684\u5b8c\u6574 URL\u3002 Source0 \u8fdc\u7aef\u6e90\u4ee3\u7801\u7684\u538b\u7f29\u5b58\u6863\u7684\u8def\u5f84\u6216 URL(\u672a\u4fee\u8865,\u4fee\u8865\u7a0b\u5e8f\u5728\u5176\u4ed6\u5730\u65b9\u5904\u7406)\u3002\u8fd9\u5e94\u8be5\u6307\u5411\u5b58\u6863\u7684\u53ef\u8bbf\u95ee\u548c\u53ef\u9760\u7684\u5b58\u50a8\uff0c\u4f8b\u5982\u4e0a\u6e38\u9875\u9762\uff0c\u800c\u4e0d\u662f\u6253\u5305\u7684\u7a0b\u5e8f\u7684\u672c\u5730\u5b58\u50a8\u3002Path or URL to the compressed archive of the upstream source code (unpatched, patches are handled elsewhere). This should point to an accessible and reliable storage of the archive, for example, the upstream page and not the packager\u2019s local storage. If needed, more SourceX directives can be added, incrementing the number each time, for example: Source1, Source2, Source3, and so on. Patch0 \u5e94\u7528\u5230\u6e90\u7801\u7684\u7b2c\u4e00\u4e2a\u8865\u4e01\u3002 If needed, more PatchX directives can be added, incrementing the number each time, for example: Patch1, Patch2, Patch3, and so on. \u4f7f\u7528\u65b9\u6cd5\u4e3e\u4f8b\uff1a %patch0 -p1 BuildArch \u5982\u679c\u5305\u4e0d\u4f9d\u8d56\u67b6\u6784\uff0c\u6bd4\u5982\u5168\u90e8\u4f7f\u7528\u89e3\u91ca\u578b\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\uff0c\u8bbe\u7f6e\u4e3a BuildArch: noarch \u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5305\u81ea\u52a8\u7ee7\u627f\u6784\u5efa\u673a\u5668\u7684\u67b6\u6784\uff0c\u6bd4\u5982 x86_64 \u3002 BuildRequires \u6784\u5efa\u65f6\u7528\u7f16\u8bd1\u8bed\u8a00\u7f16\u5199\u7684\u7a0b\u5e8f\u6240\u9700\u7684\u5305\u5217\u8868\u3002\u4f7f\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u9694\u3002There can be multiple entries of BuildRequires , each on its own line in the SPEC file. Requires \u8f6f\u4ef6\u5728\u5b89\u88c5\u540e\u8fd0\u884c\u65f6\u6240\u9700\u7684\u8f6f\u4ef6\u5305\u3002\u4f7f\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u9694\u3002 There can be multiple entries of Requires , each on its own line in the SPEC file. ExcludeArch \u5982\u679c\u8f6f\u4ef6\u65e0\u6cd5\u5728\u7279\u5b9a\u5904\u7406\u5668\u67b6\u6784\u4e0a\u8fd0\u884c,\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u6392\u9664\u8be5\u4f53\u7cfb\u7ed3\u6784\u3002 1.3.2 Body \u00b6 SPEC \u6307\u4ee4 \u5b9a\u4e49 %description RPM\u4e2d\u6253\u5305\u7684\u8f6f\u4ef6\u7684\u5b8c\u6574\u63cf\u8ff0\u3002\u8be5\u63cf\u8ff0\u53ef\u4ee5\u8de8\u8d8a\u591a\u884c\u5e76\u4e14\u53ef\u4ee5\u5206\u6210\u6bb5\u843d\u3002 %prep \u7528\u4e8e\u51c6\u5907\u8981\u6784\u5efa\u7684\u8f6f\u4ef6\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u5728Source0\u4e2d\u89e3\u538b\u7f29\u5f52\u6863\u6587\u4ef6\u3002\u8be5\u6307\u4ee4\u53ef\u4ee5\u5305\u542bshell\u811a\u672c\u3002\u4e3b\u8981\u52a8\u4f5c\uff08\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\uff09\uff1a 1. \u8fdb\u884c\u8f6f\u4ef6\u7684\u8865\u4e01 (patch) \u7b49\u76f8\u5173\u5de5\u4f5c\uff1b 2. \u5bfb\u627e\u8f6f\u4ef6\u6240\u9700\u8981\u7684\u76ee\u5f55\u662f\u5426\u5df2\u7ecf\u5b58\u5728\uff1f 3. \u4e8b\u5148\u5efa\u7acb\u4f60\u7684\u8f6f\u4ef6\u6240\u9700\u8981\u7684\u76ee\u5f55\uff0c\u6216\u8005\u4e8b\u5148\u9700\u8981\u8fdb\u884c\u7684\u4efb\u52a1\uff1b 4. \u5982\u679c\u5f85\u5b89\u88c5\u7684 Linux \u7cfb\u7edf\u5185\u5df2\u7ecf\u6709\u5b89\u88c5\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u6389\u7684\u6587\u4ef6\u65f6\uff0c\u90a3\u4e48\u5c31\u5fc5\u9700\u8981\u8fdb\u884c\u5907\u4efd(backup)\u7684\u5de5\u4f5c\u3002 %build \u7528\u4e8e\u5c06\u8f6f\u4ef6\u6784\u5efa\u4e3a\u673a\u5668\u7801\uff08\u7528\u4e8e\u7f16\u8bd1\u8bed\u8a00\uff09\u6216\u5b57\u8282\u7801\uff08\u7528\u4e8e\u67d0\u4e9b\u89e3\u91ca\u8bed\u8a00\uff09\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002 %install \u7528\u4e8e\u5c06\u6240\u9700\u6784\u5efa\u5de5\u4ef6\u4ece %builddir \uff08\u6784\u5efa\u53d1\u751f\u7684\u4f4d\u7f6e\uff09\u590d\u5236\u5230 %buildroot \u76ee\u5f55\uff08\u5305\u542b\u8981\u6253\u5305\u7684\u6587\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784\uff09\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002\u901a\u5e38\u610f\u5473\u7740\u4ece ~/rpmbuild/BUILD \u590d\u5236\u6587\u4ef6\u5230 ~/rpmbuild/BUILDROOT \u5e76\u521b\u5efa\u5728 ~/rpmbuild/BUILDROOT \u4e2d\u7684\u5fc5\u9700\u7684\u76ee\u5f55\u3002\u8fd9\u53ea\u5728\u521b\u5efa\u5305\u7684\u65f6\u5019\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u6700\u7ec8\u7528\u6237\u5b89\u88c5\u5305\u7684\u65f6\u5019\u3002 See Working with SPEC files for details. %check \u6d4b\u8bd5\u8f6f\u4ef6\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002\u901a\u5e38\u5305\u542b\u5355\u5143\u6d4b\u8bd5\u3002 %files \u5c06\u5728\u6700\u7ec8\u7528\u6237\u7684\u7cfb\u7edf\u4e2d\u5b89\u88c5\u7684\u6587\u4ef6\u5217\u8868\u3002 %changelog \u4e0d\u540c\u7248\u672c\u6216\u53d1\u5e03\u7248\u672c\u4e4b\u95f4\u7684\u5305\u53d1\u751f\u7684\u66f4\u6539\u8bb0\u5f55\u3002\u8bb0\u5f55\u7684\u662f\u6253\u5305\u7684\u6539\u53d8\uff0c\u800c\u4e0d\u662f\u8f6f\u4ef6\u7684\u6539\u53d8\u3002 1.4 BuildRoots \u00b6 \u5145\u5f53\u5728\u6784\u5efa\u65f6\u6700\u7ec8\u7528\u6237\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\u3002\u6784\u5efa\u6587\u4ef6\u7684\u653e\u7f6e\u5e94\u7b26\u5408\u6700\u7ec8\u7528\u6237\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6\u3002 \u5728 buildroot \u4e2d\u7684\u6587\u4ef6\u5f85\u4f1a\u4f1a\u88ab\u653e\u5230\u4e00\u4e2a cpio \u7684\u6253\u5305\u6587\u4ef6\uff0c\u5c06\u6210\u4e3a RPM \u7684\u4e3b\u8981\u90e8\u5206\u3002\u5f53RPM\u5b89\u88c5\u4e4b\u540e\uff0c\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u88ab\u63d0\u53d6\u5230\u6839\u76ee\u5f55\uff0c\u5e76\u4fdd\u7559\u5f53\u524d\u7684\u76ee\u5f55\u7ed3\u6784\u3002 1.5 RPM \u5b8f \u00b6 rpm macro \u662f\u76f4\u63a5\u6587\u672c\u66ff\u6362\u3002\u88ab\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u8ba9RPM\u4e3a\u60a8\u6267\u884c\u6587\u672c\u66ff\u6362\u3002 \u82e5\u4e0d\u77e5\u9053\u67d0\u4e2a\u5b8f\u7684\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528 rpm --eval %{_MACRO} \u67e5\u770b\uff1a $ rpm --eval % { _bindir } /usr/bin $ rpm --eval % { _libexecdir } /usr/libexec 1.6 \u4f7f\u7528 SPEC \u6587\u4ef6 \u00b6 \u4e0d\u5fc5\u624b\u52a8\u521b\u5efa\uff0c\u53ef\u4ee5\u4f7f\u7528 rpmdev-newspec \u5de5\u5177\u521b\u5efa\u672a\u586b\u5199\u5185\u5bb9\u7684 SPEC \u6587\u4ef6\u3002 $ rpmdev-newspec cello \u4e0b\u9762\u4e3e\u4f8b\u8bf4\u660e\u4e09\u79cd\u6e90\u7801\u7684 SPEC \u6587\u4ef6\u3002 1.6.1 Natively Compiled Code \u00b6 Name : cello Version : 1.0 Release : 1 % { ? dist } Summary : hello world example implemented in C . License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz Patch0 : cello - output - first - patch . patch BuildRequires : gcc make %description long description in C . %prep %setup - q %build make % { ? _smp_mflags } %install %make_install %files %license LICENSE % { _bindir } /% { name } %changelog * Tue Jul 23 2019 sharkshark < xxx @ example . com > - 1.0 - 1 - First cello package 1.6.2 Raw Interpreted Code \u00b6 Name : bello Version : 0.1 Release : 1 % { ? dist } Summary : hello world programed in bash . License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz BuildArch : noarch Requires : bash %description assume there is a long description %prep %setup - q %build %install mkdir - p % { buildroot } /% { _bindir } install - m 0755 % { name } % { buildroot } /% { _bindir } /% { name } %files %license LICENSE % { _bindir } /% { name } %changelog * Mon Jul 22 2019 sharkshark < xxx @ example . com > - 0.1 - 1 - First bello package - Example secod item in the changlog for version - release 0.1 - 1 1.6.3 Byte-Compiled Code \u00b6 Name : pello Version : 0.1.1 Release : 1 % { ? dist } Summary : Hello World example implemented in Python License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz BuildRequires : python Requires : python , bash BuildArch : noarch %description assume this is a long description . %prep %setup - q %build python - m compileall pello . py %install mkdir - p % { buildroot } /% { _bindir } mkdir - p % { buildroot } / usr / lib /% { name } cat > % { buildroot } /% { _bindir } /% { name } <<- EOF #!/bin/bash / usr / bin / python / usr / lib /% { name } /% { name }. pyc EOF chmod 0755 % { buildroot } /% { _bindir } /% { name } install - m 0644 % { name }. py * % { buildroot } / usr / lib /% { name } / %files %license LICENSE %dir / usr / lib /% { name } / % { _bindir } /% { name } / usr / lib /% { name } /% { name }. py * %changelog * Tue Jul 23 2019 sharkshark < xxx @ example . com > - 0.1.1 - 1 - First pello package 2. \u6784\u5efa RPM \u5305 \u00b6 2.1 Source RPMs \u00b6 \u4e3a\u4ec0\u4e48\u8981\u6784\u5efa\u6e90\u7801\u5305\uff1f \u4e3a\u4e86\u4fdd\u5b58\u4e00\u4e2aRPM\u5305\u7684\u67d0\u4e9b\u6e90\u6587\u4ef6\u3002\u5305\u62ec SPEC \u6587\u4ef6\u3001\u6e90\u7801\u3001\u6240\u6709\u7684\u8865\u4e01\u3002\u8fd9\u5bf9\u56de\u6eaf\u5386\u53f2\u548cdebug\u5f88\u6709\u7528\u3002 \u4e3a\u4e86\u80fd\u591f\u5728\u4e0d\u540c\u7684\u786c\u4ef6\u5e73\u53f0\u6216\u67b6\u6784\u4e0a\u6784\u5efa\u4e8c\u8fdb\u5236\u5305\u3002 $ rpmbuild -bs _SPECFILE_ $ cd ~/rpmbuild/SPECS/ $ rpmbuild -bs bello.spec warning: bogus date in %changelog: Mon Jun 22 2019 sharkshark <xxx@example.com> - 0 .1-1 Wrote: /home/study/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm 2.2 Binary RPMS \u00b6 \u4e24\u79cd\u6784\u5efa\u4e8c\u8fdb\u5236RPM\u7684\u65b9\u6cd5\uff1a \u4f7f\u7528 rpmbuild --rebuild \u547d\u4ee4\u4eceSRPM\u91cd\u65b0\u6784\u5efa \u4f7f\u7528 rpmbuild -bb \u547d\u4ee4\u4ece SPEC \u6587\u4ef6\u6784\u5efa 2.2.1 \u4ece\u6e90\u7801\u5305\u6784\u5efa \u00b6 rpmbuild --bs cello.spec rpmbuild --rebuild ../SRPMS/cello-1.0-1.el7.src.rpm \u8c03\u7528 rpmbuild --rebuild \u5305\u62ec\u4ee5\u4e0b\u51e0\u70b9\uff1a \u5b89\u88c5SRPM\u7684\u5185\u5bb9\uff08 SPEC \u6587\u4ef6\u548c\u6e90\u7801\uff09\u5b89\u88c5\u5230 rpmbuild \u76ee\u5f55 \u4f7f\u7528\u5df2\u5b89\u88c5\u7684\u5185\u5bb9\u6784\u5efa\u3002 \u79fb\u9664SPEC \u6587\u4ef6\u548c\u6e90\u7801\u3002\u5982\u679c\u60f3\u4fdd\u7559\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u6709\u4e0b\u9762\u4e24\u79cd\u65b9\u6cd5\uff1a \u4f7f\u7528 --recompile \u9009\u9879\u4ee3\u66ff --rebuild \u3002 \u4f7f\u7528 rpm -Uvh SRPM \u547d\u4ee4\u5b89\u88c5\u6e90\u7801\u5305\uff0c\u8fd9\u6837\u4e24\u4e2a\u6587\u4ef6\u53c8\u4f1a\u91cd\u65b0\u51fa\u73b0\u5728\u5bf9\u5e94\u76ee\u5f55\u4e86\u3002 2.2.2 \u4ece SPEC \u6587\u4ef6\u6784\u5efa \u00b6 rpmbuild --bb bello.spec 3. \u68c0\u67e5RPMs\u662f\u5426\u5408\u7406 \u00b6 \u68c0\u67e5\u7684\u662fRPM\u5305\u7684\u8d28\u91cf\uff0c\u800c\u4e0d\u662f\u8f6f\u4ef6\u672c\u8eab\u7684\u8d28\u91cf\u3002\u4e3b\u8981\u4f7f\u7528 rpmlint \u5de5\u5177\uff0c\u53ef\u4ee5\u68c0\u67e5\uff1aRPMs\u3001SRPMs\u3001 SPEC \u6587\u4ef6\u3002 rpmlint\u7684\u89c4\u5219\u5f88\u4e25\u683c\uff0c\u6709\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e00\u4e9b\u9519\u8bef\u548c\u8b66\u544a\u3002 yum install -y rpmlint","title":"02 \u6253\u5305\u8f6f\u4ef6"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#1-rpm","text":"\u6709\u4e24\u79cdRPM\u5305\uff1a source RPM (SRPM) binary RPM \u4e24\u8005\u7684\u6587\u4ef6\u683c\u5f0f\u548c\u5de5\u5177\u662f\u76f8\u540c\u7684\uff0c\u4f46\u6709\u4e0d\u540c\u7684\u5185\u5bb9\uff0c\u670d\u52a1\u4e8e\u4e0d\u540c\u7684\u76ee\u7684\u3002SRPM\u5305\u542b\u6e90\u4ee3\u7801\uff0c\u53ef\u9009\u7684\u8865\u4e01\u548cSPEC\u6587\u4ef6\uff0c\u5b83\u63cf\u8ff0\u4e86\u5982\u4f55\u5c06\u6e90\u4ee3\u7801\u6784\u5efa\u4e3a\u4e8c\u8fdb\u5236RPM\u3002\u4e8c\u8fdb\u5236RPM\u5305\u542b\u4ece\u6e90\u7801\u548c\u8865\u4e01\u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002","title":"1. RPM \u5305"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#11-rpm","text":"rpmdevtools \u63d0\u4f9b\u4e86\u4e00\u4e9b\u6253\u5305\u5de5\u5177\uff0c\u67e5\u770b\u8fd9\u4e9b\u5de5\u5177\uff1a $ rpm -ql rpmdevtools | grep bin","title":"1.1 RPM \u6253\u5305\u5de5\u5177"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#12-rpm","text":"\u4f7f\u7528 rpmdev-setuptree \u8bbe\u7f6e\u76ee\u5f55\u5e03\u5c40\uff0c\u5373RPM\u6253\u5305\u5de5\u4f5c\u533a: $ rpmdev-setuptree $ tree ~/rpmbuild/ /home/user/rpmbuild/ \u251c\u2500\u2500 BUILD \u251c\u2500\u2500 RPMS \u251c\u2500\u2500 SOURCES \u251c\u2500\u2500 SPECS \u2514\u2500\u2500 SRPMS 5 directories, 0 files \u76ee\u5f55 Purpose BUILD \u5f53\u521b\u5efa\u5305\u65f6\uff0c\u5404\u79cd %buildroot \u76ee\u5f55\u5728\u8fd9\u91cc\u521b\u5efa\u3002\u5982\u679c\u521b\u5efa\u5931\u8d25\u65f6\uff0c\u800c\u65e5\u5fd7\u8f93\u51fa\u53c8\u6ca1\u6709\u63d0\u4f9b\u8db3\u591f\u7684\u4fe1\u606f\uff0c\u8fd9\u5c06\u5f88\u6709\u7528\u5904\u3002 RPMS \u4e8c\u8fdb\u5236 RPMs \u5728\u8fd9\u91cc\u521b\u5efa\uff0c\u5b50\u76ee\u5f55\u8868\u793a\u4e0d\u540c\u7684\u67b6\u6784, \u6bd4\u5982 x86_64 \u548c noarch \u3002 SOURCES \u538b\u7f29\u6e90\u7801\u5305\u548c\u8865\u4e01\u5b58\u653e\u5730\uff0c rpmbuild \u547d\u4ee4\u4ece\u8fd9\u91cc\u5bfb\u627e\u5b83\u4eec\u3002 SPECS SPEC\u6587\u4ef6\u5b58\u653e\u5730 SRPMS rpmbuild \u521b\u5efa SRPM \u65f6\uff0c SRPM \u5728\u8fd9\u91cc\u521b\u5efa","title":"1.2 RPM \u6253\u5305\u5de5\u4f5c\u533a"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#13-spec","text":"\u5b83\u901a\u8fc7\u5728\u4e00\u7cfb\u5217\u7ae0\u8282\u4e2d\u5b9a\u4e49\u6307\u4ee4\u6765\u544a\u8bc9\u6784\u5efa\u7cfb\u7edf\u8981\u505a\u4ec0\u4e48\u3002 \u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a Preamble \uff08\u5305\u542bBody\u4e2d\u4f7f\u7528\u7684\u4e00\u7cfb\u5217\u5143\u6570\u636e\u9879\u3002\uff09\u548c Body \uff08\u5305\u542b\u6307\u4ee4\u7684\u4e3b\u8981\u90e8\u5206\uff09\u3002","title":"1.3 SPEC \u6587\u4ef6"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#131-preamble","text":"SPEC \u6307\u4ee4 \u5b9a\u4e49 Name \u5305\u7684\u57fa\u7840\u540d\uff0c\u5e94\u8be5\u548c SPEC \u6587\u4ef6\u540d\u5339\u914d\u3002 Version \u8f6f\u4ef6\u7684\u4e0a\u6e38\u7248\u672c Release \u6b64\u7248\u672c\u7684\u8f6f\u4ef6\u53d1\u5e03\u7684\u6b21\u6570\u3002 \u901a\u5e38\uff0c\u8bbe\u7f6e\u521d\u59cb\u503c\u4e3a 1%{?dist} \uff0c\u6bcf\u6b21\u53d1\u5e03\u65b0\u7684\u65f6\u5019\u5c31\u589e\u52a0\u5b83\u3002\u5f53\u65b0\u7684 Version \u6784\u5efa\u65f6\u91cd\u7f6e\u4e3a 1 \u3002 Summary \u5305\u7684\u5728\u7ebf\u7b80\u8981\u4ecb\u7ecd License \u88ab\u6253\u5305\u8f6f\u4ef6\u7684 license \u3002 URL \u5173\u4e8e\u8f6f\u4ef6\u7684\u66f4\u591a\u4fe1\u606f\u7684\u5b8c\u6574 URL\u3002 Source0 \u8fdc\u7aef\u6e90\u4ee3\u7801\u7684\u538b\u7f29\u5b58\u6863\u7684\u8def\u5f84\u6216 URL(\u672a\u4fee\u8865,\u4fee\u8865\u7a0b\u5e8f\u5728\u5176\u4ed6\u5730\u65b9\u5904\u7406)\u3002\u8fd9\u5e94\u8be5\u6307\u5411\u5b58\u6863\u7684\u53ef\u8bbf\u95ee\u548c\u53ef\u9760\u7684\u5b58\u50a8\uff0c\u4f8b\u5982\u4e0a\u6e38\u9875\u9762\uff0c\u800c\u4e0d\u662f\u6253\u5305\u7684\u7a0b\u5e8f\u7684\u672c\u5730\u5b58\u50a8\u3002Path or URL to the compressed archive of the upstream source code (unpatched, patches are handled elsewhere). This should point to an accessible and reliable storage of the archive, for example, the upstream page and not the packager\u2019s local storage. If needed, more SourceX directives can be added, incrementing the number each time, for example: Source1, Source2, Source3, and so on. Patch0 \u5e94\u7528\u5230\u6e90\u7801\u7684\u7b2c\u4e00\u4e2a\u8865\u4e01\u3002 If needed, more PatchX directives can be added, incrementing the number each time, for example: Patch1, Patch2, Patch3, and so on. \u4f7f\u7528\u65b9\u6cd5\u4e3e\u4f8b\uff1a %patch0 -p1 BuildArch \u5982\u679c\u5305\u4e0d\u4f9d\u8d56\u67b6\u6784\uff0c\u6bd4\u5982\u5168\u90e8\u4f7f\u7528\u89e3\u91ca\u578b\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\uff0c\u8bbe\u7f6e\u4e3a BuildArch: noarch \u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5305\u81ea\u52a8\u7ee7\u627f\u6784\u5efa\u673a\u5668\u7684\u67b6\u6784\uff0c\u6bd4\u5982 x86_64 \u3002 BuildRequires \u6784\u5efa\u65f6\u7528\u7f16\u8bd1\u8bed\u8a00\u7f16\u5199\u7684\u7a0b\u5e8f\u6240\u9700\u7684\u5305\u5217\u8868\u3002\u4f7f\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u9694\u3002There can be multiple entries of BuildRequires , each on its own line in the SPEC file. Requires \u8f6f\u4ef6\u5728\u5b89\u88c5\u540e\u8fd0\u884c\u65f6\u6240\u9700\u7684\u8f6f\u4ef6\u5305\u3002\u4f7f\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u9694\u3002 There can be multiple entries of Requires , each on its own line in the SPEC file. ExcludeArch \u5982\u679c\u8f6f\u4ef6\u65e0\u6cd5\u5728\u7279\u5b9a\u5904\u7406\u5668\u67b6\u6784\u4e0a\u8fd0\u884c,\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u6392\u9664\u8be5\u4f53\u7cfb\u7ed3\u6784\u3002","title":"1.3.1 Preamble"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#132-body","text":"SPEC \u6307\u4ee4 \u5b9a\u4e49 %description RPM\u4e2d\u6253\u5305\u7684\u8f6f\u4ef6\u7684\u5b8c\u6574\u63cf\u8ff0\u3002\u8be5\u63cf\u8ff0\u53ef\u4ee5\u8de8\u8d8a\u591a\u884c\u5e76\u4e14\u53ef\u4ee5\u5206\u6210\u6bb5\u843d\u3002 %prep \u7528\u4e8e\u51c6\u5907\u8981\u6784\u5efa\u7684\u8f6f\u4ef6\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\uff0c\u4f8b\u5982\uff0c\u5728Source0\u4e2d\u89e3\u538b\u7f29\u5f52\u6863\u6587\u4ef6\u3002\u8be5\u6307\u4ee4\u53ef\u4ee5\u5305\u542bshell\u811a\u672c\u3002\u4e3b\u8981\u52a8\u4f5c\uff08\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\uff09\uff1a 1. \u8fdb\u884c\u8f6f\u4ef6\u7684\u8865\u4e01 (patch) \u7b49\u76f8\u5173\u5de5\u4f5c\uff1b 2. \u5bfb\u627e\u8f6f\u4ef6\u6240\u9700\u8981\u7684\u76ee\u5f55\u662f\u5426\u5df2\u7ecf\u5b58\u5728\uff1f 3. \u4e8b\u5148\u5efa\u7acb\u4f60\u7684\u8f6f\u4ef6\u6240\u9700\u8981\u7684\u76ee\u5f55\uff0c\u6216\u8005\u4e8b\u5148\u9700\u8981\u8fdb\u884c\u7684\u4efb\u52a1\uff1b 4. \u5982\u679c\u5f85\u5b89\u88c5\u7684 Linux \u7cfb\u7edf\u5185\u5df2\u7ecf\u6709\u5b89\u88c5\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u6389\u7684\u6587\u4ef6\u65f6\uff0c\u90a3\u4e48\u5c31\u5fc5\u9700\u8981\u8fdb\u884c\u5907\u4efd(backup)\u7684\u5de5\u4f5c\u3002 %build \u7528\u4e8e\u5c06\u8f6f\u4ef6\u6784\u5efa\u4e3a\u673a\u5668\u7801\uff08\u7528\u4e8e\u7f16\u8bd1\u8bed\u8a00\uff09\u6216\u5b57\u8282\u7801\uff08\u7528\u4e8e\u67d0\u4e9b\u89e3\u91ca\u8bed\u8a00\uff09\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002 %install \u7528\u4e8e\u5c06\u6240\u9700\u6784\u5efa\u5de5\u4ef6\u4ece %builddir \uff08\u6784\u5efa\u53d1\u751f\u7684\u4f4d\u7f6e\uff09\u590d\u5236\u5230 %buildroot \u76ee\u5f55\uff08\u5305\u542b\u8981\u6253\u5305\u7684\u6587\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784\uff09\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002\u901a\u5e38\u610f\u5473\u7740\u4ece ~/rpmbuild/BUILD \u590d\u5236\u6587\u4ef6\u5230 ~/rpmbuild/BUILDROOT \u5e76\u521b\u5efa\u5728 ~/rpmbuild/BUILDROOT \u4e2d\u7684\u5fc5\u9700\u7684\u76ee\u5f55\u3002\u8fd9\u53ea\u5728\u521b\u5efa\u5305\u7684\u65f6\u5019\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u6700\u7ec8\u7528\u6237\u5b89\u88c5\u5305\u7684\u65f6\u5019\u3002 See Working with SPEC files for details. %check \u6d4b\u8bd5\u8f6f\u4ef6\u7684\u547d\u4ee4\u6216\u4e00\u7cfb\u5217\u547d\u4ee4\u3002\u901a\u5e38\u5305\u542b\u5355\u5143\u6d4b\u8bd5\u3002 %files \u5c06\u5728\u6700\u7ec8\u7528\u6237\u7684\u7cfb\u7edf\u4e2d\u5b89\u88c5\u7684\u6587\u4ef6\u5217\u8868\u3002 %changelog \u4e0d\u540c\u7248\u672c\u6216\u53d1\u5e03\u7248\u672c\u4e4b\u95f4\u7684\u5305\u53d1\u751f\u7684\u66f4\u6539\u8bb0\u5f55\u3002\u8bb0\u5f55\u7684\u662f\u6253\u5305\u7684\u6539\u53d8\uff0c\u800c\u4e0d\u662f\u8f6f\u4ef6\u7684\u6539\u53d8\u3002","title":"1.3.2 Body"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#14-buildroots","text":"\u5145\u5f53\u5728\u6784\u5efa\u65f6\u6700\u7ec8\u7528\u6237\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\u3002\u6784\u5efa\u6587\u4ef6\u7684\u653e\u7f6e\u5e94\u7b26\u5408\u6700\u7ec8\u7528\u6237\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u5c42\u6b21\u7ed3\u6784\u6807\u51c6\u3002 \u5728 buildroot \u4e2d\u7684\u6587\u4ef6\u5f85\u4f1a\u4f1a\u88ab\u653e\u5230\u4e00\u4e2a cpio \u7684\u6253\u5305\u6587\u4ef6\uff0c\u5c06\u6210\u4e3a RPM \u7684\u4e3b\u8981\u90e8\u5206\u3002\u5f53RPM\u5b89\u88c5\u4e4b\u540e\uff0c\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u88ab\u63d0\u53d6\u5230\u6839\u76ee\u5f55\uff0c\u5e76\u4fdd\u7559\u5f53\u524d\u7684\u76ee\u5f55\u7ed3\u6784\u3002","title":"1.4 BuildRoots"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#15-rpm","text":"rpm macro \u662f\u76f4\u63a5\u6587\u672c\u66ff\u6362\u3002\u88ab\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u8ba9RPM\u4e3a\u60a8\u6267\u884c\u6587\u672c\u66ff\u6362\u3002 \u82e5\u4e0d\u77e5\u9053\u67d0\u4e2a\u5b8f\u7684\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528 rpm --eval %{_MACRO} \u67e5\u770b\uff1a $ rpm --eval % { _bindir } /usr/bin $ rpm --eval % { _libexecdir } /usr/libexec","title":"1.5 RPM \u5b8f"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#16-spec","text":"\u4e0d\u5fc5\u624b\u52a8\u521b\u5efa\uff0c\u53ef\u4ee5\u4f7f\u7528 rpmdev-newspec \u5de5\u5177\u521b\u5efa\u672a\u586b\u5199\u5185\u5bb9\u7684 SPEC \u6587\u4ef6\u3002 $ rpmdev-newspec cello \u4e0b\u9762\u4e3e\u4f8b\u8bf4\u660e\u4e09\u79cd\u6e90\u7801\u7684 SPEC \u6587\u4ef6\u3002","title":"1.6 \u4f7f\u7528 SPEC \u6587\u4ef6"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#161-natively-compiled-code","text":"Name : cello Version : 1.0 Release : 1 % { ? dist } Summary : hello world example implemented in C . License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz Patch0 : cello - output - first - patch . patch BuildRequires : gcc make %description long description in C . %prep %setup - q %build make % { ? _smp_mflags } %install %make_install %files %license LICENSE % { _bindir } /% { name } %changelog * Tue Jul 23 2019 sharkshark < xxx @ example . com > - 1.0 - 1 - First cello package","title":"1.6.1 Natively Compiled Code"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#162-raw-interpreted-code","text":"Name : bello Version : 0.1 Release : 1 % { ? dist } Summary : hello world programed in bash . License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz BuildArch : noarch Requires : bash %description assume there is a long description %prep %setup - q %build %install mkdir - p % { buildroot } /% { _bindir } install - m 0755 % { name } % { buildroot } /% { _bindir } /% { name } %files %license LICENSE % { _bindir } /% { name } %changelog * Mon Jul 22 2019 sharkshark < xxx @ example . com > - 0.1 - 1 - First bello package - Example secod item in the changlog for version - release 0.1 - 1","title":"1.6.2 Raw Interpreted Code"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#163-byte-compiled-code","text":"Name : pello Version : 0.1.1 Release : 1 % { ? dist } Summary : Hello World example implemented in Python License : GPLv3 URL : http : //www.sharkshark.xyz/%{name} Source0 : http : //www.sharkshark.xyz/%{name}/release/%{name}-%{version}.tar.gz BuildRequires : python Requires : python , bash BuildArch : noarch %description assume this is a long description . %prep %setup - q %build python - m compileall pello . py %install mkdir - p % { buildroot } /% { _bindir } mkdir - p % { buildroot } / usr / lib /% { name } cat > % { buildroot } /% { _bindir } /% { name } <<- EOF #!/bin/bash / usr / bin / python / usr / lib /% { name } /% { name }. pyc EOF chmod 0755 % { buildroot } /% { _bindir } /% { name } install - m 0644 % { name }. py * % { buildroot } / usr / lib /% { name } / %files %license LICENSE %dir / usr / lib /% { name } / % { _bindir } /% { name } / usr / lib /% { name } /% { name }. py * %changelog * Tue Jul 23 2019 sharkshark < xxx @ example . com > - 0.1.1 - 1 - First pello package","title":"1.6.3 Byte-Compiled Code"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#2-rpm","text":"","title":"2. \u6784\u5efa RPM \u5305"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#21-source-rpms","text":"\u4e3a\u4ec0\u4e48\u8981\u6784\u5efa\u6e90\u7801\u5305\uff1f \u4e3a\u4e86\u4fdd\u5b58\u4e00\u4e2aRPM\u5305\u7684\u67d0\u4e9b\u6e90\u6587\u4ef6\u3002\u5305\u62ec SPEC \u6587\u4ef6\u3001\u6e90\u7801\u3001\u6240\u6709\u7684\u8865\u4e01\u3002\u8fd9\u5bf9\u56de\u6eaf\u5386\u53f2\u548cdebug\u5f88\u6709\u7528\u3002 \u4e3a\u4e86\u80fd\u591f\u5728\u4e0d\u540c\u7684\u786c\u4ef6\u5e73\u53f0\u6216\u67b6\u6784\u4e0a\u6784\u5efa\u4e8c\u8fdb\u5236\u5305\u3002 $ rpmbuild -bs _SPECFILE_ $ cd ~/rpmbuild/SPECS/ $ rpmbuild -bs bello.spec warning: bogus date in %changelog: Mon Jun 22 2019 sharkshark <xxx@example.com> - 0 .1-1 Wrote: /home/study/rpmbuild/SRPMS/bello-0.1-1.el7.src.rpm","title":"2.1 Source RPMs"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#22-binary-rpms","text":"\u4e24\u79cd\u6784\u5efa\u4e8c\u8fdb\u5236RPM\u7684\u65b9\u6cd5\uff1a \u4f7f\u7528 rpmbuild --rebuild \u547d\u4ee4\u4eceSRPM\u91cd\u65b0\u6784\u5efa \u4f7f\u7528 rpmbuild -bb \u547d\u4ee4\u4ece SPEC \u6587\u4ef6\u6784\u5efa","title":"2.2 Binary RPMS"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#221","text":"rpmbuild --bs cello.spec rpmbuild --rebuild ../SRPMS/cello-1.0-1.el7.src.rpm \u8c03\u7528 rpmbuild --rebuild \u5305\u62ec\u4ee5\u4e0b\u51e0\u70b9\uff1a \u5b89\u88c5SRPM\u7684\u5185\u5bb9\uff08 SPEC \u6587\u4ef6\u548c\u6e90\u7801\uff09\u5b89\u88c5\u5230 rpmbuild \u76ee\u5f55 \u4f7f\u7528\u5df2\u5b89\u88c5\u7684\u5185\u5bb9\u6784\u5efa\u3002 \u79fb\u9664SPEC \u6587\u4ef6\u548c\u6e90\u7801\u3002\u5982\u679c\u60f3\u4fdd\u7559\u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u6709\u4e0b\u9762\u4e24\u79cd\u65b9\u6cd5\uff1a \u4f7f\u7528 --recompile \u9009\u9879\u4ee3\u66ff --rebuild \u3002 \u4f7f\u7528 rpm -Uvh SRPM \u547d\u4ee4\u5b89\u88c5\u6e90\u7801\u5305\uff0c\u8fd9\u6837\u4e24\u4e2a\u6587\u4ef6\u53c8\u4f1a\u91cd\u65b0\u51fa\u73b0\u5728\u5bf9\u5e94\u76ee\u5f55\u4e86\u3002","title":"2.2.1 \u4ece\u6e90\u7801\u5305\u6784\u5efa"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#222-spec","text":"rpmbuild --bb bello.spec","title":"2.2.2 \u4ece SPEC \u6587\u4ef6\u6784\u5efa"},{"location":"rpm/02 \u6253\u5305\u8f6f\u4ef6/#3-rpms","text":"\u68c0\u67e5\u7684\u662fRPM\u5305\u7684\u8d28\u91cf\uff0c\u800c\u4e0d\u662f\u8f6f\u4ef6\u672c\u8eab\u7684\u8d28\u91cf\u3002\u4e3b\u8981\u4f7f\u7528 rpmlint \u5de5\u5177\uff0c\u53ef\u4ee5\u68c0\u67e5\uff1aRPMs\u3001SRPMs\u3001 SPEC \u6587\u4ef6\u3002 rpmlint\u7684\u89c4\u5219\u5f88\u4e25\u683c\uff0c\u6709\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e00\u4e9b\u9519\u8bef\u548c\u8b66\u544a\u3002 yum install -y rpmlint","title":"3. \u68c0\u67e5RPMs\u662f\u5426\u5408\u7406"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/","text":"1. \u5bf9\u5305\u8fdb\u884c\u7b7e\u540d \u00b6 \u9632\u6b62\u5df2\u4e0b\u8f7d\u5907\u7528\u7684\u5305\u88ab\u7b2c\u4e09\u65b9\u7be1\u6539\u3002 \u4e09\u79cd\u65b9\u6cd5\uff1a \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u6dfb\u52a0\u7b7e\u540d \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u66ff\u6362\u7b7e\u540d \u5728\u6784\u5efa\u7684\u65f6\u5019\u5bf9\u5305\u7b7e\u540d 1.1 \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u6dfb\u52a0\u7b7e\u540d \u00b6 \u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u662f\u5148\u6784\u5efa\u597d\u5305\uff0c\u518d\u8fdb\u884c\u7b7e\u540d\uff08\u53ef\u4ee5\u8fdb\u884c\u591a\u6b21\u548c\u91cd\u590d\u7b7e\u540d\uff09\uff0c\u6700\u540e\u53d1\u5e03\u3002 \u5728\u9605\u8bfb\u672c\u7ae0\u4e4b\u524d\uff0c\u9700\u8981\u5148\u4e86\u89e3 GPG \u5de5\u5177\u751f\u6210\u5bc6\u94a5\uff0c\u7b80\u5355\u7684\u4f7f\u7528\u8bf4\u660e\u53ef\u53c2\u8003github\uff1a https://help.github.com/en/articles/managing-commit-signature-verification \u4f7f\u7528 gpg \u751f\u6210\u5bc6\u94a5\u4e4b\u540e\uff0c\u9700\u8981\u5728 ~/.rpmmacros \u4e2d\u7f16\u5199\u5b8f\uff08%_gpg_name\uff09\u6307\u5b9a\u5bc6\u94a5\u540d\u79f0\uff08\u4e5f\u53ef\u4ee5\u662f\u7528\u6237\u540d\uff09\uff1a $ cat ~/.rpmmacros %_gpg_name D2C6AF4B 1.1.1 \u5b98\u65b9\u6587\u6863\u8bf4\u660e \u00b6 \u4f7f\u7528 --addsign \u9009\u9879\u6dfb\u52a0\u7b7e\u540d\uff1a $ rpm --addsign blather-7.9-1.i386.rpm Enter pass phrase: Pass phrase is good. blather-7.9-1.i386.rpm: \u4f7f\u7528 --checksig \u9009\u9879\u9a8c\u8bc1\u7b7e\u540d\uff1a $ rpm --checksig blather-7.9-1.i386.rpm blather-7.9-1.i386.rpm: size pgp pgp md5 OK \u4e24\u4e2a pgp pgp \u4ee3\u8868\u88ab\u7b7e\u540d\u4e86\u4e24\u6b21\u3002 1.1.2 centos 7.5\u8bf4\u660e \u00b6 \u6ca1\u6709\u627e\u5230\u5b98\u65b9\u6587\u6863\u4e2d\u63d0\u5230\u7684\u9009\u9879\uff0c\u4f7f\u7528 rpmsign \u548c rpmkeys \u4ee3\u66ff\u3002 $ rpmsign --addsign cello-1.0-1.el7.x86_64.rpm Enter pass phrase: Pass phrase is good. cello-1.0-1.el7.x86_64.rpm: \u9a8c\u8bc1\u65f6\u9700\u8981\u5148\u5bfc\u5165\u516c\u94a5\uff0c\u516c\u94a5\u7684\u83b7\u53d6\u65b9\u6cd5\uff1a $ gpg --export -a -o pub-key D2C6AF4B \u5bfc\u5165\u516c\u94a5\uff1a $ rpmkeys --import pub-key \u9a8c\u8bc1\u7b7e\u540d\uff1a $ rpmkeys -K cello-1.0-1.el7.x86_64.rpm cello-1.0-1.el7.x86_64.rpm: RSA sha1 (( MD5 ) PGP ) md5 NOT OK 1.2 \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u66ff\u6362\u7b7e\u540d \u00b6 --resign \u9009\u9879\uff1a $ rpm --resign b*.rpm Enter pass phrase: Pass phrase is good. blather-7.9-1.i386.rpm: bother-3.5-1.i386.rpm: 1.3 \u5728\u6784\u5efa\u7684\u65f6\u5019\u5bf9\u5305\u7b7e\u540d \u00b6 --sign \u9009\u9879\uff08\u5df2\u5e9f\u5f03\uff09\uff0c\u53ea\u80fd\u4e0e --bb \u6216 --ba \u4e00\u8d77\u4f7f\u7528\uff1a $ rpmbuild -ba --sign blather-7.9.spec Enter pass phrase: Pass phrase is good. * Package: blather \u2026 Binary Packaging: blather-7.9-1 Finding dependencies... \u2026 Generating signature: 1002 Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm \u2026 Source Packaging: blather-7.9-1 \u2026 Generating signature: 1002 Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm \u8fd8\u53ef\u540c\u65f6\u6784\u5efa\u591a\u4e2a\u5305\uff1a $ rpmbuild -ba --sign b*.spec 2. Mock \u00b6 mock \u662f\u6784\u5efa\u5305\u7684\u5de5\u5177\u3002\u53ef\u4ee5\u6784\u5efa\u4e0d\u540c\u4e8e\u6784\u5efa\u4e3b\u673a\u7684 \u67b6\u6784\u548c\u7248\u672c \u7684\u5305\u3002 centos\u9700\u8981\u4eceepel\u4e2d\u5b89\u88c5\u3002\u53ef\u4ee5\u67e5\u770b /etc/mock/ \u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\u770b\u652f\u6301\u54ea\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u53ca\u7248\u672c\u3002 $ mock --r epel-6-x86_64 cello-1.0-1.el7.src.rpm mock\u8fd8\u4f1a\u89e3\u51b3\u4e00\u4e9bBuildRequires\u7684\u4f9d\u8d56\u95ee\u9898\uff08\u6bd4\u5982gcc\uff09\u3002 3. \u4e00\u4e9b\u5b8f \u00b6 3.1 \u81ea\u5b9a\u4e49\u5b8f \u00b6 RPM Official Documentation %global < name > [( opts )] < body > 3.2 %setup \u00b6 %setup \u53ef\u7528\u4e8e\u4ece\u6e90\u7801\u538b\u7f29\u5305\u6784\u5efaRPM\u5305\u3002\u5176\u6267\u884c\u7684\u52a8\u4f5c\u53ef\u4ee5\u5728 rpmbuild --dubug \u7684\u8f93\u51fa\u4e2d\u770b\u5230\u3002 [ root@study SPECS ] # rpmbuild --debug -bb cello.spec Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.y404KC + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + rm -rf cello-1.0 # -c\u7684\u610f\u601d\u65f6\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u4e0d\u6539\u53d8\u6e90\u6587\u4ef6 + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xvvf - drwxr-xr-x root/root 0 2019 -07-24 09 :56 cello/ -rw-r--r-- root/root 612 2019 -07-22 17 :03 cello/LICENSE -rw-r--r-- root/root 85 2019 -07-23 10 :40 cello/cello.c -rw-r--r-- root/root 135 2019 -07-23 10 :49 cello/Makefile -rw-r--r-- root/root 249 2019 -07-24 09 :56 cello/cello-output-first-patch.patch + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello-1.0 + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 \u4e0b\u9762\u662f\u6539\u53d8 %setup \u884c\u4e3a\u7684\u9009\u9879\u3002 3.2.1 %setup -q \u00b6 \u9650\u5236\u8be5\u5b8f\u7684\u8f93\u51fa\uff0c\u5c06 tar -xvvf \u66ff\u6362\u4e3a tar -xf \u3002\u5fc5\u987b\u9996\u5148\u4f7f\u7528\u6b64\u9009\u9879\u3002 3.2.2 %setup -n \u00b6 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u89e3\u538b\u7684tar\u5305\u7684\u6587\u4ef6\u67b6\u7684\u540d\u5b57\u4e0e %{name}-%{version} \u683c\u5f0f\u4e0d\u540c\uff0c\u4f1a\u5bfc\u81f4\u8be5\u5b8f\u9519\u8bef\u3002 \u6b64\u65f6\u53ef\u4ee5\u6307\u5b9a\u6587\u4ef6\u5939\u7684\u540d\u5b57\uff1a -n directory_name \u3002 $ tar -zcf cello-1.0.tar.gz cello/ $ cat cello.spec Name: cello Version: 1 .0 Release: 1 % { ?dist } ... %prep %setup -n cello 3.2.3 %setup -c \u00b6 \u9002\u7528\u4e8e\u6e90\u7801\u5305\u4e0d\u5305\u542b\u4efb\u4f55\u5b50\u76ee\u5f55\u7684\u60c5\u51b5\u3002\u5373\u76f4\u63a5\u5c06\u6587\u4ef6\u6253\u6210\u6e90\u7801\u5305\u3002 $ tar -tf cello-1.0.tar.gz cello.c cello-output-first-patch.patch LICENSE Makefile $ cat cello.spec %prep %setup -n cello -c $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.Na0EvS + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + rm -rf cello + /usr/bin/mkdir -p cello + cd cello + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xvvf - -rw-r--r-- root/root 85 2019 -07-23 10 :40 cello.c -rw-r--r-- root/root 249 2019 -07-24 09 :56 cello-output-first-patch.patch -rw-r--r-- root/root 612 2019 -07-22 17 :03 LICENSE -rw-r--r-- root/root 135 2019 -07-23 10 :49 Makefile + STATUS = 0 + '[' 0 -ne 0 ']' 3.2.4 %setup -D and -T \u00b6 -D \u9009\u9879\u8868\u793a\u4e0d\u5220\u9664\u6e90\u7801\u6587\u4ef6\u5939\u3002\u82e5\u591a\u6b21\u4f7f\u7528 %setup \u5b8f\u7684\u60c5\u51b5\u4e0b\u5f88\u6709\u7528\u3002\u5728 %prep \u9636\u6bb5\u5c06\u4e0d\u4f1a\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\uff1a rm -rf 'cello-1.0' -T \u9009\u9879\u8868\u793a\u7981\u6b62\u6e90\u7801\u5305\u7684\u89e3\u538b\uff0c\u5c06\u4e0b\u9762\u7684\u8bed\u53e5\u4ece\u811a\u672c\u4e2d\u79fb\u9664\uff1a /usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xvvf - 3.2.5 %setup -a and -b \u00b6 -b \uff1a\u5728\u8fdb\u5165\u5de5\u4f5c\u76ee\u5f55\u4e4b\u524d\uff08before\uff09\u6269\u5c55\u6307\u5b9a\u6e90\u3002 -a \uff1a\u5728\u8fdb\u5165\u5de5\u4f5c\u76ee\u5f55\u4e4b\u540e\uff08after\uff09\u6269\u5c55\u6307\u5b9a\u6e90\u3002 \u5b83\u4eec\u7684\u53c2\u6570\u662fspec\u6587\u4ef6\u5934\u90e8\u9884\u5b9a\u4e49\u7684Source\u53f7\u7801\u3002 $ cat cello.spec Source0: http://www.sharkshark.xyz/% { name } /release/% { name } -% { version } .tar.gz Source1: cello-extra.tar.gz %prep #%setup -q -D -n cello -a 1 %setup -q -D -n cello -b 1 $ tree ../SOURCES/ ../SOURCES/ \u251c\u2500\u2500 bello-0.1.tar.gz \u251c\u2500\u2500 cello-1.0.tar.gz \u251c\u2500\u2500 cello-extra.tar.gz \u251c\u2500\u2500 cello-output-first-patch.patch \u2514\u2500\u2500 pello-0.1.1.tar.gz -b \u9009\u9879\u6548\u679c\uff1a $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.jfuaQ1 + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-extra.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 $ tree ../BUILD ../BUILD \u251c\u2500\u2500 cello \u2502 \u251c\u2500\u2500 cello \u2502 \u251c\u2500\u2500 cello.c \u2502 \u251c\u2500\u2500 cello-output-first-patch.patch \u2502 \u251c\u2500\u2500 debugfiles.list \u2502 \u251c\u2500\u2500 debuglinks.list \u2502 \u251c\u2500\u2500 debugsources.list \u2502 \u251c\u2500\u2500 elfbins.list \u2502 \u251c\u2500\u2500 LICENSE \u2502 \u2514\u2500\u2500 Makefile \u2514\u2500\u2500 cello-extra \u2514\u2500\u2500 test.sh -a \u9009\u9879\u6548\u679c\uff1a $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.JcZtHp + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-extra.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 $ tree ../BUILD ../BUILD \u2514\u2500\u2500 cello \u251c\u2500\u2500 cello \u251c\u2500\u2500 cello.c \u251c\u2500\u2500 cello-extra \u2502 \u2514\u2500\u2500 test.sh \u251c\u2500\u2500 cello-output-first-patch.patch \u251c\u2500\u2500 debugfiles.list \u251c\u2500\u2500 debuglinks.list \u251c\u2500\u2500 debugsources.list \u251c\u2500\u2500 elfbins.list \u251c\u2500\u2500 LICENSE \u2514\u2500\u2500 Makefile 3.3 %files \u00b6 %files \u90e8\u5206\u4e2d\u5e38\u89c1\u7684\u9ad8\u7ea7\u5b8f\uff1a \u5b8f \u5b9a\u4e49 %license \u6307\u5b9a\u4f5c\u4e3a LICENSE \u7684\u6587\u4ef6\uff0c\u5b83\u5c06\u7531RPM\u5b89\u88c5\u548c\u6807\u8bb0\u3002Example: %license LICENSE %doc \u6307\u5b9a\u4f5c\u4e3a \u6587\u6863 \u7684\u6587\u4ef6\uff0c\u5b83\u5c06\u7531RPM\u5b89\u88c5\u548c\u6807\u8bb0\u3002 \u8fd8\u7528\u4e8e\u4ee3\u7801\u793a\u4f8b\u548c\u6587\u6863\u9644\u5e26\u7684\u5404\u79cd\u9879\u76ee\u3002 \u5982\u679c\u5305\u542b\u4ee3\u7801\u793a\u4f8b\uff0c\u5219\u5e94\u6ce8\u610f\u4ece\u6587\u4ef6\u4e2d\u5220\u9664\u53ef\u6267\u884c\u6a21\u5f0f\u3002 Example: %doc README %dir \u6807\u8bc6\u8be5\u8def\u5f84\u662f\u8be5RPM\u5e94\u5305\u542b\u7684\u76ee\u5f55\u3002\u8fd9\u5f88\u91cd\u8981\uff0c\u4ee5\u4fbfRPM\u6587\u4ef6\u6e05\u5355\u51c6\u786e\u5730\u77e5\u9053\u5378\u8f7d\u65f6\u8981\u6e05\u7406\u7684\u76ee\u5f55\u3002Example: %dir %{_libdir}/%{name} %config(noreplace) \u6307\u5b9a\u4ee5\u4e0b\u6587\u4ef6\u662f\u914d\u7f6e\u6587\u4ef6\uff0c\u56e0\u6b64\u5982\u679c\u5df2\u4ece\u539f\u59cb\u5b89\u88c5\u6821\u9a8c\u4e2d\u4fee\u6539\u6587\u4ef6\uff0c\u5219\u4e0d\u5e94\u5728RPM\u5305\u5b89\u88c5\u65f6\u6216\u66f4\u65b0\u65f6\u8986\u76d6\uff08\u6216\u66ff\u6362\uff09\u8be5\u6587\u4ef6\u3002\u5982\u679c\u53d1\u751f\u66f4\u6539\uff0c\u5c06\u5728\u5347\u7ea7\u6216\u5b89\u88c5\u65f6\u4f7f\u7528 .rpmnew \u9644\u52a0\u5230\u6587\u4ef6\u540d\u672b\u5c3e\u521b\u5efa\u6587\u4ef6\uff0c\u4ee5\u4fbf\u4e0d\u4fee\u6539\u76ee\u6807\u7cfb\u7edf\u4e0a\u9884\u5148\u5b58\u5728\u6216\u5df2\u4fee\u6539\u7684\u6587\u4ef6\u3002Example: %config(noreplace) %{_sysconfdir}/%{name}/%{name}.conf 3.4 \u8986\u76d6\u4e0e\u81ea\u5b9a\u4e49\u5b8f \u00b6 \u53ef\u4ee5\u5728 ~/.rpmmacros \u6587\u4ef6\u4e2d\u8986\u76d6\u5b8f\u548c\u81ea\u5b9a\u4e49\u5b8f\uff08\u4e0d\u63a8\u8350\uff09\u3002 %_topdir / opt / some / working / directory / rpmbuild %_smp_mflags - l3 4. Scriptlets and Triggers \u00b6 \u5728RPM\u8f6f\u4ef6\u5305\u4e2d\uff0c\u6709\u4e00\u7cfb\u5217\u6307\u4ee4\u53ef\u7528\u4e8e\u5728RPM\u5b89\u88c5\u671f\u95f4\u5bf9\u7cfb\u7edf\u8fdb\u884c\u5fc5\u8981\u6216\u6240\u9700\u7684\u66f4\u6539\u3002\u5b83\u4eec\u88ab\u79f0\u4e3a scriptlets \u3002 \u4e00\u90e8\u5206\u6307\u4ee4\u5982\u4e0b\uff1a \u6307\u4ee4 \u5b9a\u4e49 %pre \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5RPM\u5305\u4e4b\u524d\u6267\u884c\u7684\u6307\u4ee4\u3002 %post \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5RPM\u5305\u4e4b\u540e\u6267\u884c\u7684\u6307\u4ee4\u3002 %preun \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5378\u8f7dRPM\u5305\u4e4b\u524d\u6267\u884c\u7684\u6307\u4ee4\u3002 %postun \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5378\u8f7dRPM\u5305\u4e4b\u540e\u6267\u884c\u7684\u6307\u4ee4\u3002 \u53e6\u4e00\u4e2a\u5bf9RPM\u4e8b\u52a1\u63d0\u4f9b\u66f4\u7ec6\u7c92\u5ea6\u63a7\u5236\u7684\u9879\u76ee\u5c31\u662f\u6240\u8c13\u7684\u89e6\u53d1\u5668\u3002 \u8fd9\u4e9b\u4e0escriptlet\u5b9e\u9645\u4e0a\u662f\u76f8\u540c\u7684\uff0c\u4f46\u5728RPM\u5b89\u88c5\u6216\u5347\u7ea7\u4e8b\u52a1\u671f\u95f4\u4ee5\u975e\u5e38\u7279\u5b9a\u7684\u64cd\u4f5c\u987a\u5e8f\u6267\u884c\uff0c\u5141\u8bb8\u5bf9\u6574\u4e2a\u8fc7\u7a0b\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002 \u53c2\u8003 /usr/share/doc/rpm-4.*/triggers \u6587\u4ef6\u4f7f\u7528\u3002 4.1 \u5728spec\u6587\u4ef6\u4e2d\u4f7f\u7528\u975eshell\u811a\u672c \u00b6 scriptlet\u7684 -p \u9009\u9879\u8fd0\u884c\u4f7f\u7528\u6307\u5b9a\u7684\u89e3\u91ca\u5668\u4ee3\u66ff\u9ed8\u8ba4\u7684 -p /bin/sh \u3002 $ cat cello.spec # RPM\u5305\u5b89\u88c5\u5b8c\u6210\u540e\u4f7f\u7528python\u8f93\u51fa\u4fe1\u606f %post -p /usr/bin/python print \"this is a scriplet by python\" $ rpm -Uvh ../RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm --force Preparing... ################################# [100%] Updating / installing... 1 :cello-1.0-1.el7 ################################# [100%] this is a scriplet by python 5. RPM\u6761\u4ef6\u8bed\u53e5 \u00b6 \u6761\u4ef6\u8bed\u53e5\u4e00\u822c\u9002\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a \u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u90e8\u5206 \u7279\u5b9a\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u90e8\u5206 \u5404\u79cd\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898 \u5b8f\u7684\u5b58\u5728\u548c\u5b9a\u4e49 5.1 \u8bed\u6cd5 \u00b6 %if expression ... %endif %if expression ... %else ... %endif 5.2 \u793a\u4f8b \u00b6 %if 0 % { ? rhel } == 6 sed - i ' / AS_FUNCTION_DESCRIBE / s /^/ # / ' configure . in sed - i ' / AS_FUNCTION_DESCRIBE / s /^/ # / ' acinclude . m4 %endif \u8868\u8fbe\u5f0f\u4e0e\u4e0a\u9762\u7684\u4f8b\u5b50\u7b49\u4ef7\uff1a %if 0 % { ? el6 } %global ruby_sitearch % ( ruby - rrbconfig - e ' puts Config :: CONFIG [ \"sitearchdir\" ] ' ) %endif %if 0 % { ? fedora } >= 19 %global with_rubypick 1 %endif %define ruby_archive % { name } -% { ruby_version } %if 0 % { ? milestone : 1 } % { ? revision : 1 } != 0 %define ruby_archive % { ruby_archive } -% { ? milestone } % { ?! milestone : % { ? revision : r % { revision }}} %endif 5.3 \u53d8\u79cd \u00b6 %ifarch \u3001 %ifnarch \u548c %ifos \u662f\u6761\u4ef6\u8bed\u53e5\u7684\u7279\u6b8a\u53d8\u79cd\u3002 %ifarch\u53ef\u4ee5\u8ddf\u591a\u4e2a\u4f53\u7cfb\u67b6\u6784\uff0c\u6bcf\u4e2a\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u5f00\uff1a %ifarch i386 sparc ... %endif %ifnarch\u4e0e%ifarch\u903b\u8f91\u76f8\u53cd\u3002 %ifos\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\uff1a %ifos linux ... %endif","title":"03 \u9ad8\u7ea7\u8bdd\u9898"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#1","text":"\u9632\u6b62\u5df2\u4e0b\u8f7d\u5907\u7528\u7684\u5305\u88ab\u7b2c\u4e09\u65b9\u7be1\u6539\u3002 \u4e09\u79cd\u65b9\u6cd5\uff1a \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u6dfb\u52a0\u7b7e\u540d \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u66ff\u6362\u7b7e\u540d \u5728\u6784\u5efa\u7684\u65f6\u5019\u5bf9\u5305\u7b7e\u540d","title":"1. \u5bf9\u5305\u8fdb\u884c\u7b7e\u540d"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#11","text":"\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u90fd\u662f\u5148\u6784\u5efa\u597d\u5305\uff0c\u518d\u8fdb\u884c\u7b7e\u540d\uff08\u53ef\u4ee5\u8fdb\u884c\u591a\u6b21\u548c\u91cd\u590d\u7b7e\u540d\uff09\uff0c\u6700\u540e\u53d1\u5e03\u3002 \u5728\u9605\u8bfb\u672c\u7ae0\u4e4b\u524d\uff0c\u9700\u8981\u5148\u4e86\u89e3 GPG \u5de5\u5177\u751f\u6210\u5bc6\u94a5\uff0c\u7b80\u5355\u7684\u4f7f\u7528\u8bf4\u660e\u53ef\u53c2\u8003github\uff1a https://help.github.com/en/articles/managing-commit-signature-verification \u4f7f\u7528 gpg \u751f\u6210\u5bc6\u94a5\u4e4b\u540e\uff0c\u9700\u8981\u5728 ~/.rpmmacros \u4e2d\u7f16\u5199\u5b8f\uff08%_gpg_name\uff09\u6307\u5b9a\u5bc6\u94a5\u540d\u79f0\uff08\u4e5f\u53ef\u4ee5\u662f\u7528\u6237\u540d\uff09\uff1a $ cat ~/.rpmmacros %_gpg_name D2C6AF4B","title":"1.1 \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u6dfb\u52a0\u7b7e\u540d"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#111","text":"\u4f7f\u7528 --addsign \u9009\u9879\u6dfb\u52a0\u7b7e\u540d\uff1a $ rpm --addsign blather-7.9-1.i386.rpm Enter pass phrase: Pass phrase is good. blather-7.9-1.i386.rpm: \u4f7f\u7528 --checksig \u9009\u9879\u9a8c\u8bc1\u7b7e\u540d\uff1a $ rpm --checksig blather-7.9-1.i386.rpm blather-7.9-1.i386.rpm: size pgp pgp md5 OK \u4e24\u4e2a pgp pgp \u4ee3\u8868\u88ab\u7b7e\u540d\u4e86\u4e24\u6b21\u3002","title":"1.1.1 \u5b98\u65b9\u6587\u6863\u8bf4\u660e"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#112-centos-75","text":"\u6ca1\u6709\u627e\u5230\u5b98\u65b9\u6587\u6863\u4e2d\u63d0\u5230\u7684\u9009\u9879\uff0c\u4f7f\u7528 rpmsign \u548c rpmkeys \u4ee3\u66ff\u3002 $ rpmsign --addsign cello-1.0-1.el7.x86_64.rpm Enter pass phrase: Pass phrase is good. cello-1.0-1.el7.x86_64.rpm: \u9a8c\u8bc1\u65f6\u9700\u8981\u5148\u5bfc\u5165\u516c\u94a5\uff0c\u516c\u94a5\u7684\u83b7\u53d6\u65b9\u6cd5\uff1a $ gpg --export -a -o pub-key D2C6AF4B \u5bfc\u5165\u516c\u94a5\uff1a $ rpmkeys --import pub-key \u9a8c\u8bc1\u7b7e\u540d\uff1a $ rpmkeys -K cello-1.0-1.el7.x86_64.rpm cello-1.0-1.el7.x86_64.rpm: RSA sha1 (( MD5 ) PGP ) md5 NOT OK","title":"1.1.2 centos 7.5\u8bf4\u660e"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#12","text":"--resign \u9009\u9879\uff1a $ rpm --resign b*.rpm Enter pass phrase: Pass phrase is good. blather-7.9-1.i386.rpm: bother-3.5-1.i386.rpm:","title":"1.2 \u5bf9\u5df2\u5b58\u5728\u7684\u5305\u66ff\u6362\u7b7e\u540d"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#13","text":"--sign \u9009\u9879\uff08\u5df2\u5e9f\u5f03\uff09\uff0c\u53ea\u80fd\u4e0e --bb \u6216 --ba \u4e00\u8d77\u4f7f\u7528\uff1a $ rpmbuild -ba --sign blather-7.9.spec Enter pass phrase: Pass phrase is good. * Package: blather \u2026 Binary Packaging: blather-7.9-1 Finding dependencies... \u2026 Generating signature: 1002 Wrote: /usr/src/redhat/RPMS/i386/blather-7.9-1.i386.rpm \u2026 Source Packaging: blather-7.9-1 \u2026 Generating signature: 1002 Wrote: /usr/src/redhat/SRPMS/blather-7.9-1.src.rpm \u8fd8\u53ef\u540c\u65f6\u6784\u5efa\u591a\u4e2a\u5305\uff1a $ rpmbuild -ba --sign b*.spec","title":"1.3 \u5728\u6784\u5efa\u7684\u65f6\u5019\u5bf9\u5305\u7b7e\u540d"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#2-mock","text":"mock \u662f\u6784\u5efa\u5305\u7684\u5de5\u5177\u3002\u53ef\u4ee5\u6784\u5efa\u4e0d\u540c\u4e8e\u6784\u5efa\u4e3b\u673a\u7684 \u67b6\u6784\u548c\u7248\u672c \u7684\u5305\u3002 centos\u9700\u8981\u4eceepel\u4e2d\u5b89\u88c5\u3002\u53ef\u4ee5\u67e5\u770b /etc/mock/ \u76ee\u5f55\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\u770b\u652f\u6301\u54ea\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u53ca\u7248\u672c\u3002 $ mock --r epel-6-x86_64 cello-1.0-1.el7.src.rpm mock\u8fd8\u4f1a\u89e3\u51b3\u4e00\u4e9bBuildRequires\u7684\u4f9d\u8d56\u95ee\u9898\uff08\u6bd4\u5982gcc\uff09\u3002","title":"2. Mock"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#3","text":"","title":"3. \u4e00\u4e9b\u5b8f"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#31","text":"RPM Official Documentation %global < name > [( opts )] < body >","title":"3.1 \u81ea\u5b9a\u4e49\u5b8f"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#32-setup","text":"%setup \u53ef\u7528\u4e8e\u4ece\u6e90\u7801\u538b\u7f29\u5305\u6784\u5efaRPM\u5305\u3002\u5176\u6267\u884c\u7684\u52a8\u4f5c\u53ef\u4ee5\u5728 rpmbuild --dubug \u7684\u8f93\u51fa\u4e2d\u770b\u5230\u3002 [ root@study SPECS ] # rpmbuild --debug -bb cello.spec Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.y404KC + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + rm -rf cello-1.0 # -c\u7684\u610f\u601d\u65f6\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u4e0d\u6539\u53d8\u6e90\u6587\u4ef6 + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xvvf - drwxr-xr-x root/root 0 2019 -07-24 09 :56 cello/ -rw-r--r-- root/root 612 2019 -07-22 17 :03 cello/LICENSE -rw-r--r-- root/root 85 2019 -07-23 10 :40 cello/cello.c -rw-r--r-- root/root 135 2019 -07-23 10 :49 cello/Makefile -rw-r--r-- root/root 249 2019 -07-24 09 :56 cello/cello-output-first-patch.patch + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello-1.0 + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 \u4e0b\u9762\u662f\u6539\u53d8 %setup \u884c\u4e3a\u7684\u9009\u9879\u3002","title":"3.2 %setup"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#321-setup-q","text":"\u9650\u5236\u8be5\u5b8f\u7684\u8f93\u51fa\uff0c\u5c06 tar -xvvf \u66ff\u6362\u4e3a tar -xf \u3002\u5fc5\u987b\u9996\u5148\u4f7f\u7528\u6b64\u9009\u9879\u3002","title":"3.2.1 %setup -q"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#322-setup-n","text":"\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u89e3\u538b\u7684tar\u5305\u7684\u6587\u4ef6\u67b6\u7684\u540d\u5b57\u4e0e %{name}-%{version} \u683c\u5f0f\u4e0d\u540c\uff0c\u4f1a\u5bfc\u81f4\u8be5\u5b8f\u9519\u8bef\u3002 \u6b64\u65f6\u53ef\u4ee5\u6307\u5b9a\u6587\u4ef6\u5939\u7684\u540d\u5b57\uff1a -n directory_name \u3002 $ tar -zcf cello-1.0.tar.gz cello/ $ cat cello.spec Name: cello Version: 1 .0 Release: 1 % { ?dist } ... %prep %setup -n cello","title":"3.2.2 %setup -n"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#323-setup-c","text":"\u9002\u7528\u4e8e\u6e90\u7801\u5305\u4e0d\u5305\u542b\u4efb\u4f55\u5b50\u76ee\u5f55\u7684\u60c5\u51b5\u3002\u5373\u76f4\u63a5\u5c06\u6587\u4ef6\u6253\u6210\u6e90\u7801\u5305\u3002 $ tar -tf cello-1.0.tar.gz cello.c cello-output-first-patch.patch LICENSE Makefile $ cat cello.spec %prep %setup -n cello -c $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.Na0EvS + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + rm -rf cello + /usr/bin/mkdir -p cello + cd cello + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xvvf - -rw-r--r-- root/root 85 2019 -07-23 10 :40 cello.c -rw-r--r-- root/root 249 2019 -07-24 09 :56 cello-output-first-patch.patch -rw-r--r-- root/root 612 2019 -07-22 17 :03 LICENSE -rw-r--r-- root/root 135 2019 -07-23 10 :49 Makefile + STATUS = 0 + '[' 0 -ne 0 ']'","title":"3.2.3 %setup -c"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#324-setup-d-and-t","text":"-D \u9009\u9879\u8868\u793a\u4e0d\u5220\u9664\u6e90\u7801\u6587\u4ef6\u5939\u3002\u82e5\u591a\u6b21\u4f7f\u7528 %setup \u5b8f\u7684\u60c5\u51b5\u4e0b\u5f88\u6709\u7528\u3002\u5728 %prep \u9636\u6bb5\u5c06\u4e0d\u4f1a\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\uff1a rm -rf 'cello-1.0' -T \u9009\u9879\u8868\u793a\u7981\u6b62\u6e90\u7801\u5305\u7684\u89e3\u538b\uff0c\u5c06\u4e0b\u9762\u7684\u8bed\u53e5\u4ece\u811a\u672c\u4e2d\u79fb\u9664\uff1a /usr/bin/gzip -dc '/builddir/build/SOURCES/cello-1.0.tar.gz' | /usr/bin/tar -xvvf -","title":"3.2.4 %setup -D and -T"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#325-setup-a-and-b","text":"-b \uff1a\u5728\u8fdb\u5165\u5de5\u4f5c\u76ee\u5f55\u4e4b\u524d\uff08before\uff09\u6269\u5c55\u6307\u5b9a\u6e90\u3002 -a \uff1a\u5728\u8fdb\u5165\u5de5\u4f5c\u76ee\u5f55\u4e4b\u540e\uff08after\uff09\u6269\u5c55\u6307\u5b9a\u6e90\u3002 \u5b83\u4eec\u7684\u53c2\u6570\u662fspec\u6587\u4ef6\u5934\u90e8\u9884\u5b9a\u4e49\u7684Source\u53f7\u7801\u3002 $ cat cello.spec Source0: http://www.sharkshark.xyz/% { name } /release/% { name } -% { version } .tar.gz Source1: cello-extra.tar.gz %prep #%setup -q -D -n cello -a 1 %setup -q -D -n cello -b 1 $ tree ../SOURCES/ ../SOURCES/ \u251c\u2500\u2500 bello-0.1.tar.gz \u251c\u2500\u2500 cello-1.0.tar.gz \u251c\u2500\u2500 cello-extra.tar.gz \u251c\u2500\u2500 cello-output-first-patch.patch \u2514\u2500\u2500 pello-0.1.1.tar.gz -b \u9009\u9879\u6548\u679c\uff1a $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.jfuaQ1 + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-extra.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 $ tree ../BUILD ../BUILD \u251c\u2500\u2500 cello \u2502 \u251c\u2500\u2500 cello \u2502 \u251c\u2500\u2500 cello.c \u2502 \u251c\u2500\u2500 cello-output-first-patch.patch \u2502 \u251c\u2500\u2500 debugfiles.list \u2502 \u251c\u2500\u2500 debuglinks.list \u2502 \u251c\u2500\u2500 debugsources.list \u2502 \u251c\u2500\u2500 elfbins.list \u2502 \u251c\u2500\u2500 LICENSE \u2502 \u2514\u2500\u2500 Makefile \u2514\u2500\u2500 cello-extra \u2514\u2500\u2500 test.sh -a \u9009\u9879\u6548\u679c\uff1a $ rpmbuild -bb cello.spec --debug Executing ( %prep ) : /bin/sh -e /var/tmp/rpm-tmp.JcZtHp + umask 022 + cd /home/study/rpmbuild/BUILD + cd /home/study/rpmbuild/BUILD + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-1.0.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + cd cello + /usr/bin/gzip -dc /home/study/rpmbuild/SOURCES/cello-extra.tar.gz + /usr/bin/tar -xf - + STATUS = 0 + '[' 0 -ne 0 ']' + /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w . + exit 0 $ tree ../BUILD ../BUILD \u2514\u2500\u2500 cello \u251c\u2500\u2500 cello \u251c\u2500\u2500 cello.c \u251c\u2500\u2500 cello-extra \u2502 \u2514\u2500\u2500 test.sh \u251c\u2500\u2500 cello-output-first-patch.patch \u251c\u2500\u2500 debugfiles.list \u251c\u2500\u2500 debuglinks.list \u251c\u2500\u2500 debugsources.list \u251c\u2500\u2500 elfbins.list \u251c\u2500\u2500 LICENSE \u2514\u2500\u2500 Makefile","title":"3.2.5 %setup -a and -b"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#33-files","text":"%files \u90e8\u5206\u4e2d\u5e38\u89c1\u7684\u9ad8\u7ea7\u5b8f\uff1a \u5b8f \u5b9a\u4e49 %license \u6307\u5b9a\u4f5c\u4e3a LICENSE \u7684\u6587\u4ef6\uff0c\u5b83\u5c06\u7531RPM\u5b89\u88c5\u548c\u6807\u8bb0\u3002Example: %license LICENSE %doc \u6307\u5b9a\u4f5c\u4e3a \u6587\u6863 \u7684\u6587\u4ef6\uff0c\u5b83\u5c06\u7531RPM\u5b89\u88c5\u548c\u6807\u8bb0\u3002 \u8fd8\u7528\u4e8e\u4ee3\u7801\u793a\u4f8b\u548c\u6587\u6863\u9644\u5e26\u7684\u5404\u79cd\u9879\u76ee\u3002 \u5982\u679c\u5305\u542b\u4ee3\u7801\u793a\u4f8b\uff0c\u5219\u5e94\u6ce8\u610f\u4ece\u6587\u4ef6\u4e2d\u5220\u9664\u53ef\u6267\u884c\u6a21\u5f0f\u3002 Example: %doc README %dir \u6807\u8bc6\u8be5\u8def\u5f84\u662f\u8be5RPM\u5e94\u5305\u542b\u7684\u76ee\u5f55\u3002\u8fd9\u5f88\u91cd\u8981\uff0c\u4ee5\u4fbfRPM\u6587\u4ef6\u6e05\u5355\u51c6\u786e\u5730\u77e5\u9053\u5378\u8f7d\u65f6\u8981\u6e05\u7406\u7684\u76ee\u5f55\u3002Example: %dir %{_libdir}/%{name} %config(noreplace) \u6307\u5b9a\u4ee5\u4e0b\u6587\u4ef6\u662f\u914d\u7f6e\u6587\u4ef6\uff0c\u56e0\u6b64\u5982\u679c\u5df2\u4ece\u539f\u59cb\u5b89\u88c5\u6821\u9a8c\u4e2d\u4fee\u6539\u6587\u4ef6\uff0c\u5219\u4e0d\u5e94\u5728RPM\u5305\u5b89\u88c5\u65f6\u6216\u66f4\u65b0\u65f6\u8986\u76d6\uff08\u6216\u66ff\u6362\uff09\u8be5\u6587\u4ef6\u3002\u5982\u679c\u53d1\u751f\u66f4\u6539\uff0c\u5c06\u5728\u5347\u7ea7\u6216\u5b89\u88c5\u65f6\u4f7f\u7528 .rpmnew \u9644\u52a0\u5230\u6587\u4ef6\u540d\u672b\u5c3e\u521b\u5efa\u6587\u4ef6\uff0c\u4ee5\u4fbf\u4e0d\u4fee\u6539\u76ee\u6807\u7cfb\u7edf\u4e0a\u9884\u5148\u5b58\u5728\u6216\u5df2\u4fee\u6539\u7684\u6587\u4ef6\u3002Example: %config(noreplace) %{_sysconfdir}/%{name}/%{name}.conf","title":"3.3 %files"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#34","text":"\u53ef\u4ee5\u5728 ~/.rpmmacros \u6587\u4ef6\u4e2d\u8986\u76d6\u5b8f\u548c\u81ea\u5b9a\u4e49\u5b8f\uff08\u4e0d\u63a8\u8350\uff09\u3002 %_topdir / opt / some / working / directory / rpmbuild %_smp_mflags - l3","title":"3.4 \u8986\u76d6\u4e0e\u81ea\u5b9a\u4e49\u5b8f"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#4-scriptlets-and-triggers","text":"\u5728RPM\u8f6f\u4ef6\u5305\u4e2d\uff0c\u6709\u4e00\u7cfb\u5217\u6307\u4ee4\u53ef\u7528\u4e8e\u5728RPM\u5b89\u88c5\u671f\u95f4\u5bf9\u7cfb\u7edf\u8fdb\u884c\u5fc5\u8981\u6216\u6240\u9700\u7684\u66f4\u6539\u3002\u5b83\u4eec\u88ab\u79f0\u4e3a scriptlets \u3002 \u4e00\u90e8\u5206\u6307\u4ee4\u5982\u4e0b\uff1a \u6307\u4ee4 \u5b9a\u4e49 %pre \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5RPM\u5305\u4e4b\u524d\u6267\u884c\u7684\u6307\u4ee4\u3002 %post \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5RPM\u5305\u4e4b\u540e\u6267\u884c\u7684\u6307\u4ee4\u3002 %preun \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5378\u8f7dRPM\u5305\u4e4b\u524d\u6267\u884c\u7684\u6307\u4ee4\u3002 %postun \u5728\u76ee\u6807\u64cd\u4f5c\u7cfb\u7edf\u5378\u8f7dRPM\u5305\u4e4b\u540e\u6267\u884c\u7684\u6307\u4ee4\u3002 \u53e6\u4e00\u4e2a\u5bf9RPM\u4e8b\u52a1\u63d0\u4f9b\u66f4\u7ec6\u7c92\u5ea6\u63a7\u5236\u7684\u9879\u76ee\u5c31\u662f\u6240\u8c13\u7684\u89e6\u53d1\u5668\u3002 \u8fd9\u4e9b\u4e0escriptlet\u5b9e\u9645\u4e0a\u662f\u76f8\u540c\u7684\uff0c\u4f46\u5728RPM\u5b89\u88c5\u6216\u5347\u7ea7\u4e8b\u52a1\u671f\u95f4\u4ee5\u975e\u5e38\u7279\u5b9a\u7684\u64cd\u4f5c\u987a\u5e8f\u6267\u884c\uff0c\u5141\u8bb8\u5bf9\u6574\u4e2a\u8fc7\u7a0b\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002 \u53c2\u8003 /usr/share/doc/rpm-4.*/triggers \u6587\u4ef6\u4f7f\u7528\u3002","title":"4. Scriptlets and Triggers"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#41-specshell","text":"scriptlet\u7684 -p \u9009\u9879\u8fd0\u884c\u4f7f\u7528\u6307\u5b9a\u7684\u89e3\u91ca\u5668\u4ee3\u66ff\u9ed8\u8ba4\u7684 -p /bin/sh \u3002 $ cat cello.spec # RPM\u5305\u5b89\u88c5\u5b8c\u6210\u540e\u4f7f\u7528python\u8f93\u51fa\u4fe1\u606f %post -p /usr/bin/python print \"this is a scriplet by python\" $ rpm -Uvh ../RPMS/x86_64/cello-1.0-1.el7.x86_64.rpm --force Preparing... ################################# [100%] Updating / installing... 1 :cello-1.0-1.el7 ################################# [100%] this is a scriplet by python","title":"4.1 \u5728spec\u6587\u4ef6\u4e2d\u4f7f\u7528\u975eshell\u811a\u672c"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#5-rpm","text":"\u6761\u4ef6\u8bed\u53e5\u4e00\u822c\u9002\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a \u7279\u5b9a\u4e8e\u67b6\u6784\u7684\u90e8\u5206 \u7279\u5b9a\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u90e8\u5206 \u5404\u79cd\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898 \u5b8f\u7684\u5b58\u5728\u548c\u5b9a\u4e49","title":"5. RPM\u6761\u4ef6\u8bed\u53e5"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#51","text":"%if expression ... %endif %if expression ... %else ... %endif","title":"5.1 \u8bed\u6cd5"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#52","text":"%if 0 % { ? rhel } == 6 sed - i ' / AS_FUNCTION_DESCRIBE / s /^/ # / ' configure . in sed - i ' / AS_FUNCTION_DESCRIBE / s /^/ # / ' acinclude . m4 %endif \u8868\u8fbe\u5f0f\u4e0e\u4e0a\u9762\u7684\u4f8b\u5b50\u7b49\u4ef7\uff1a %if 0 % { ? el6 } %global ruby_sitearch % ( ruby - rrbconfig - e ' puts Config :: CONFIG [ \"sitearchdir\" ] ' ) %endif %if 0 % { ? fedora } >= 19 %global with_rubypick 1 %endif %define ruby_archive % { name } -% { ruby_version } %if 0 % { ? milestone : 1 } % { ? revision : 1 } != 0 %define ruby_archive % { ruby_archive } -% { ? milestone } % { ?! milestone : % { ? revision : r % { revision }}} %endif","title":"5.2 \u793a\u4f8b"},{"location":"rpm/03 \u9ad8\u7ea7\u8bdd\u9898/#53","text":"%ifarch \u3001 %ifnarch \u548c %ifos \u662f\u6761\u4ef6\u8bed\u53e5\u7684\u7279\u6b8a\u53d8\u79cd\u3002 %ifarch\u53ef\u4ee5\u8ddf\u591a\u4e2a\u4f53\u7cfb\u67b6\u6784\uff0c\u6bcf\u4e2a\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u5f00\uff1a %ifarch i386 sparc ... %endif %ifnarch\u4e0e%ifarch\u903b\u8f91\u76f8\u53cd\u3002 %ifos\u63a7\u5236\u64cd\u4f5c\u7cfb\u7edf\uff1a %ifos linux ... %endif","title":"5.3 \u53d8\u79cd"},{"location":"servlet/1.\u7b80\u4ecb/","text":"1. servlet \u662f\u4ec0\u4e48 \u00b6 Java Servlet \u662f\u8fd0\u884c\u5728 Web \u670d\u52a1\u5668\u6216\u5e94\u7528\u670d\u52a1\u5668\u4e0a\u7684\u7a0b\u5e8f\uff0c\u5b83\u662f\u4f5c\u4e3a\u6765\u81ea Web \u6d4f\u89c8\u5668\u6216\u5176\u4ed6 HTTP \u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u548c HTTP \u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u5e93\u6216\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u4e2d\u95f4\u5c42\u3002 2. servlet \u4f4d\u7f6e \u00b6 3. \u5305 \u00b6 <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --> <dependency> <groupId> javax.servlet </groupId> <artifactId> javax.servlet-api </artifactId> <version> 4.0.1 </version> <scope> provided </scope> </dependency>","title":"1.\u7b80\u4ecb"},{"location":"servlet/1.\u7b80\u4ecb/#1-servlet","text":"Java Servlet \u662f\u8fd0\u884c\u5728 Web \u670d\u52a1\u5668\u6216\u5e94\u7528\u670d\u52a1\u5668\u4e0a\u7684\u7a0b\u5e8f\uff0c\u5b83\u662f\u4f5c\u4e3a\u6765\u81ea Web \u6d4f\u89c8\u5668\u6216\u5176\u4ed6 HTTP \u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u548c HTTP \u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u5e93\u6216\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u7684\u4e2d\u95f4\u5c42\u3002","title":"1. servlet \u662f\u4ec0\u4e48"},{"location":"servlet/1.\u7b80\u4ecb/#2-servlet","text":"","title":"2. servlet \u4f4d\u7f6e"},{"location":"servlet/1.\u7b80\u4ecb/#3","text":"<!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --> <dependency> <groupId> javax.servlet </groupId> <artifactId> javax.servlet-api </artifactId> <version> 4.0.1 </version> <scope> provided </scope> </dependency>","title":"3. \u5305"},{"location":"servlet/10.\u4f5c\u7528\u57df/","text":"1. application\uff08ServletContext\uff09 \u00b6 1\u3001\u751f\u547d\u5468\u671f\uff1a\u5f53Web\u5e94\u7528\u88ab\u52a0\u8f7d\u8fdb\u5bb9\u5668\u65f6\u521b\u5efa\u4ee3\u8868\u6574\u4e2aweb\u5e94\u7528\u7684application\u5bf9\u8c61\uff0c\u5f53\u670d\u52a1\u5668\u5173\u95ed\u6216Web\u5e94\u7528\u88ab\u79fb\u9664\u65f6\uff0capplication\u5bf9\u8c61\u8ddf\u7740\u9500\u6bc1\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2aWeb\u5e94\u7528\u3002 3\u3001\u4f5c\u7528\uff1a application.setAttribute(\u201ckey\u201d,Object value):\u5b58\u50a8\u6574\u4e2aweb\u5e94\u7528\u516c\u7528\u7684\u6570\u636e \u5728\u4e0d\u540cServlet \u4e4b\u95f4\u8f6c\u53d1\uff08\u4e0d\u5e38\u7528\uff09 this . getServletContext (). getRequestDispatcher ( \"/servlet/Demo10Servlet\" ). forward ( request , response ); \u65b9\u6cd5\u6267\u884c\u7ed3\u675f\uff0cservice\u5c31\u4f1a\u8fd4\u56de\u5230\u670d\u52a1\u5668\uff0c\u518d\u6709\u670d\u52a1\u5668\u53bb\u8c03\u7528\u76ee\u6807servlet\uff0c\u5176\u4e2drequest\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u5e76\u5c06\u4e4b\u524d\u7684request\u7684\u6570\u636e\u62f7\u8d1d\u8fdb\u53bb\u3002 \u6ce8\u610f\uff1a\u7531\u4e8e request \u5bf9\u8c61\u4e5f\u6709getRequestDispatcher(\"**\")\u65b9\u6cd5\uff0c\u6240\u6709\u6211\u4eec\u5f00\u53d1\u662f\u901a\u5e38\u4f7f\u7528request\u8c03\u7528\u8be5\u65b9\u6cd5\u5b9e\u73b0\u91cd\u5b9a\u5411\u3002 \u8bfb\u53d6\u8d44\u6e90\u6587\u4ef6\u3002 1\u3001\u7531\u4e8e\u76f8\u5bf9\u8def\u5f84\u9ed8\u8ba4\u76f8\u5bf9\u7684\u662fjava\u865a\u62df\u673a\u542f\u52a8\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5199\u76f8\u5bf9\u8def\u5f84\u5c06\u4f1a\u662f\u76f8\u5bf9\u4e8etomcat/bin\u76ee\u5f55\uff0c\u6240\u4ee5\u662f\u62ff\u4e0d\u5230\u8d44\u6e90\u7684\u3002\u5982\u679c\u5728\u4ee3\u7801\u4e2d\u5199\u6b7b\u6210\u7edd\u5bf9\u8def\u5f84\uff0c\u5f53\u9879\u76ee\u53d1\u5e03\u5230\u5176\u4ed6\u73af\u5883\u65f6\uff0c\u7edd\u5bf9\u8def\u5f84\u5c31\u9519\u4e86\u3002 2\u3001\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898ServletContext\u63d0\u4f9b\u4e86\uff1a this.getServletContext().getRealPath(\"/1.properties\") \uff0c\u7ed9\u8fdb\u4e00\u4e2a\u8d44\u6e90\u7684\u865a\u62df\u8def\u5f84\uff0c\u5c06\u4f1a\u8fd4\u56de\u8be5\u8d44\u6e90\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u771f\u5b9e\u8def\u5f84\u3002 \u200b this.getServletContext().getResourceAsStream(\"/1.properties\") \uff0c\u7ed9\u4e00\u4e2a\u8d44\u6e90\u7684\u865a\u62df\u8def\u5f84\u8fd4\u56de\u5230\u8be5\u8d44\u6e90\u771f\u5b9e\u8def\u5f84\u7684\u6d41\u3002 \u200b 3\u3001\u5f53\u5728\u975eservlet\u4e0b\u83b7\u53d6\u8d44\u6e90\u6587\u4ef6\u65f6\uff0c\u5c31\u6ca1\u6709ServletContext\u5bf9\u8c61\u7528\u4e86\uff0c\u6b64\u65f6\u53ea\u80fd\u7528\u7c7b\u52a0\u8f7d\u5668 classLoader.getResourceAsStream(\"../../1.properties\") \uff0c\u6b64\u65b9\u6cd5\u5229\u7528\u7c7b\u52a0\u8f7d\u5668\u76f4\u63a5\u5c06\u8d44\u6e90\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6709\u66f4\u65b0\u5ef6\u8fdf\u7684\u95ee\u9898\uff0c\u4ee5\u53ca\u5982\u679c\u6587\u4ef6\u592a\u5927\uff0c\u5360\u7528\u5185\u5b58\u8fc7\u5927\u3002 classLoader.getResource(\"../1.properties\").getPath() \uff0c\u76f4\u63a5\u8fd4\u56de\u8d44\u6e90\u7684\u771f\u5b9e\u8def\u5f84\uff0c\u6ca1\u6709\u66f4\u65b0\u5ef6\u8fdf\u7684\u95ee\u9898\u3002 2. session \u57df (HttpSession) \u00b6 HttpSession \u5728\u670d\u52a1\u5668\u4e2d\uff0c\u4e3a\u6d4f\u89c8\u5668\u521b\u5efa\u72ec\u4e00\u65e0\u4e8c\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5176\u4e2d\u4fdd\u5b58\u4f1a\u8bdd\u76f8\u5173\u7684\u4fe1\u606f\u3002 1\u3001\u751f\u547d\u5468\u671f\uff1a\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 request.getSession() \u65b9\u6cd5\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u6709\u5bf9\u5e94\u7684session,\u5982\u679c\u6ca1\u6709\u5c31\u5728\u5185\u5b58 \u4e2d\u521b\u5efa\u4e00\u4e2asession\u5e76\u8fd4\u56de\u3002 \u5f53\u4e00\u6bb5\u65f6\u95f4\u5185session\u6ca1\u6709\u88ab\u4f7f\u7528\uff08tomcat\u9ed8\u8ba4\u4e3a30\u5206\u949f\uff09\uff0c\u5219\u670d\u52a1\u5668\u4f1a\u9500\u6bc1\u8be5session\u3002 \u5982\u679c\u670d\u52a1\u5668\u975e\u6b63\u5e38\u5173\u95ed\uff08\u5f3a\u884c\u5173\u95ed\uff09\uff0c\u6ca1\u6709\u5230\u671f\u7684session\u4e5f\u4f1a\u8ddf\u7740\u9500\u6bc1\u3002 \u5982\u679c\u8c03\u7528session\u63d0\u4f9b\u7684invalidate\uff08\uff09 \uff0c\u53ef\u4ee5\u7acb\u5373\u9500\u6bc1session\u3002 \u6ce8\u610f \uff1a\u670d\u52a1\u5668\u6b63\u5e38\u5173\u95ed\uff0c\u518d\u542f\u52a8\uff0cSession\u5bf9\u8c61\u4f1a\u8fdb\u884c\u949d\u5316\u548c\u6d3b\u5316\u64cd\u4f5c\u3002\u540c\u65f6\u5982\u679c\u670d\u52a1\u5668\u949d\u5316\u7684\u65f6\u95f4\u5728session \u9ed8\u8ba4\u9500\u6bc1\u65f6\u95f4\u4e4b\u5185\uff0c\u5219\u6d3b\u5316\u540esession\u8fd8\u662f\u5b58\u5728\u7684\u3002\u5426\u5219Session\u4e0d\u5b58\u5728\u3002 \u5982\u679cJavaBean \u6570\u636e\u5728session\u949d\u5316\u65f6\uff0c\u6ca1\u6709\u5b9e\u73b0Serializable \u5219\u5f53Session\u6d3b\u5316\u65f6\uff0c\u4f1a\u6d88\u5931\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u4e00\u6b21\u4f1a\u8bdd\u3002 3\u3001\u4f5c\u7528\uff1a\u4fdd\u5b58\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\u3001\u8d2d\u7269\u8f66\u4fe1\u606f\u7b49 3. request\u57df --(HttpServletRequest) \u00b6 1\u3001\u751f\u547d\u5468\u671f\uff1a\u5728service \u65b9\u6cd5\u8c03\u7528\u524d\u7531\u670d\u52a1\u5668\u521b\u5efa\uff0c\u4f20\u5165service\u65b9\u6cd5\u3002\u6574\u4e2a\u8bf7\u6c42\u7ed3\u675f\uff0crequest\u751f\u547d\u7ed3\u675f\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2a\u8bf7\u6c42\u94fe\uff08 \u8bf7\u6c42\u8f6c\u53d1 \u4e5f\u5b58\u5728\uff09\u3002 3\u3001\u4f5c\u7528\uff1a \u5728\u6574\u4e2a\u8bf7\u6c42\u94fe\u4e2d\u5171\u4eab\u6570\u636e\u3002\u6700\u5e38\u7528\u5230\uff1a\u5728Servlet \u4e2d\u5904\u7406\u597d\u7684\u6570\u636e\u4ea4\u7ed9Jsp\u663e\u793a\uff0c\u6b64\u65f6\u53c2\u6570\u5c31\u53ef\u4ee5\u653e\u7f6e\u5728Request\u57df\u4e2d\u5e26\u8fc7\u53bb\u3002 4. pageContext\u57df\u2014(PageContext) \u00b6 1\u3001\u751f\u547d\u5468\u671f\uff1a\u5f53\u5bf9JSP\u7684\u8bf7\u6c42\u65f6\u5f00\u59cb\uff0c\u5f53\u54cd\u5e94\u7ed3\u675f\u65f6\u9500\u6bc1\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2aJSP\u9875\u9762\uff0c\u662f\u56db\u5927\u4f5c\u7528\u57df\u4e2d\u6700\u5c0f\u7684\u4e00\u4e2a\u3002 3\u3001\u4f5c\u7528\uff1a \uff081\uff09\u83b7\u53d6\u5176\u5b83\u516b\u5927\u9690\u5f0f\u5bf9\u8c61\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u5165\u53e3\u5bf9\u8c61\u3002 \uff082\uff09\u83b7\u53d6\u5176\u6240\u6709\u57df\u4e2d\u7684\u6570\u636e pageContext\u64cd\u4f5c\u6240\u6709\u57df\u4e2d\u5c5e\u6027\u7684\u65b9\u6cd5\uff1a public java.lang.Object getAttribute(java.lang.String name,int scope) public void setAttribute(java.lang.String name, java.lang.Object value,int scope) public void removeAttribute(java.lang.String name,int scope) pageContext \u4e2d\u4ee3\u8868\u57df\u7684\u5e38\u91cf PageContext.APPLICATION_SCOPE PageContext.SESSION_SCOPE PageContext.REQUEST_SCOPE PageContext.PAGE_SCOPE findAttribute\u65b9\u6cd5,\u5728\u56db\u5927\u57df\u4e2d\u641c\u5bfb\u5c5e\u6027\uff0c\u641c\u5bfb\u7684\u987a\u5e8f\u662fpage\u57df\u3001request\u57df\u3001session\u57df\u3001application\u57df\uff0c\u4ece\u5c0f\u57df\u5230\u5927\u57df\u5f00\u59cb\u641c\u7d22\uff0c\u5982\u679c\u641c\u7d22\u5230\u5c31\u76f4\u63a5\u83b7\u53d6\u8be5\u503c\uff0c\u5982\u679c\u6240\u6709\u57df\u4e2d\u90fd\u627e\u4e0d\u5230\uff0c\u8fd4\u56de\u4e00\u4e2anull(\u4e0eel\u8868\u8fbe\u5f0f\u4e0d\u540c\uff0c\u6b64\u5904\u8fd4\u56denull\uff0c\u5bf9\u7f51\u9875\u662f\u4e0d\u53cb\u597d\u7684) \u200b \uff083\uff09\u8df3\u8f6c\u5230\u5176\u4ed6\u8d44\u6e90 \u5176\u8eab\u4e0a\u63d0\u4f9b\u4e86forward\u548cinclude\u65b9\u6cd5\uff0c\u7b80\u5316\u91cd\u5b9a\u5411\u548c\u8f6c\u53d1\u7684\u64cd\u4f5c","title":"10.\u4f5c\u7528\u57df"},{"location":"servlet/10.\u4f5c\u7528\u57df/#1-applicationservletcontext","text":"1\u3001\u751f\u547d\u5468\u671f\uff1a\u5f53Web\u5e94\u7528\u88ab\u52a0\u8f7d\u8fdb\u5bb9\u5668\u65f6\u521b\u5efa\u4ee3\u8868\u6574\u4e2aweb\u5e94\u7528\u7684application\u5bf9\u8c61\uff0c\u5f53\u670d\u52a1\u5668\u5173\u95ed\u6216Web\u5e94\u7528\u88ab\u79fb\u9664\u65f6\uff0capplication\u5bf9\u8c61\u8ddf\u7740\u9500\u6bc1\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2aWeb\u5e94\u7528\u3002 3\u3001\u4f5c\u7528\uff1a application.setAttribute(\u201ckey\u201d,Object value):\u5b58\u50a8\u6574\u4e2aweb\u5e94\u7528\u516c\u7528\u7684\u6570\u636e \u5728\u4e0d\u540cServlet \u4e4b\u95f4\u8f6c\u53d1\uff08\u4e0d\u5e38\u7528\uff09 this . getServletContext (). getRequestDispatcher ( \"/servlet/Demo10Servlet\" ). forward ( request , response ); \u65b9\u6cd5\u6267\u884c\u7ed3\u675f\uff0cservice\u5c31\u4f1a\u8fd4\u56de\u5230\u670d\u52a1\u5668\uff0c\u518d\u6709\u670d\u52a1\u5668\u53bb\u8c03\u7528\u76ee\u6807servlet\uff0c\u5176\u4e2drequest\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u5e76\u5c06\u4e4b\u524d\u7684request\u7684\u6570\u636e\u62f7\u8d1d\u8fdb\u53bb\u3002 \u6ce8\u610f\uff1a\u7531\u4e8e request \u5bf9\u8c61\u4e5f\u6709getRequestDispatcher(\"**\")\u65b9\u6cd5\uff0c\u6240\u6709\u6211\u4eec\u5f00\u53d1\u662f\u901a\u5e38\u4f7f\u7528request\u8c03\u7528\u8be5\u65b9\u6cd5\u5b9e\u73b0\u91cd\u5b9a\u5411\u3002 \u8bfb\u53d6\u8d44\u6e90\u6587\u4ef6\u3002 1\u3001\u7531\u4e8e\u76f8\u5bf9\u8def\u5f84\u9ed8\u8ba4\u76f8\u5bf9\u7684\u662fjava\u865a\u62df\u673a\u542f\u52a8\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5199\u76f8\u5bf9\u8def\u5f84\u5c06\u4f1a\u662f\u76f8\u5bf9\u4e8etomcat/bin\u76ee\u5f55\uff0c\u6240\u4ee5\u662f\u62ff\u4e0d\u5230\u8d44\u6e90\u7684\u3002\u5982\u679c\u5728\u4ee3\u7801\u4e2d\u5199\u6b7b\u6210\u7edd\u5bf9\u8def\u5f84\uff0c\u5f53\u9879\u76ee\u53d1\u5e03\u5230\u5176\u4ed6\u73af\u5883\u65f6\uff0c\u7edd\u5bf9\u8def\u5f84\u5c31\u9519\u4e86\u3002 2\u3001\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898ServletContext\u63d0\u4f9b\u4e86\uff1a this.getServletContext().getRealPath(\"/1.properties\") \uff0c\u7ed9\u8fdb\u4e00\u4e2a\u8d44\u6e90\u7684\u865a\u62df\u8def\u5f84\uff0c\u5c06\u4f1a\u8fd4\u56de\u8be5\u8d44\u6e90\u5728\u5f53\u524d\u73af\u5883\u4e0b\u7684\u771f\u5b9e\u8def\u5f84\u3002 \u200b this.getServletContext().getResourceAsStream(\"/1.properties\") \uff0c\u7ed9\u4e00\u4e2a\u8d44\u6e90\u7684\u865a\u62df\u8def\u5f84\u8fd4\u56de\u5230\u8be5\u8d44\u6e90\u771f\u5b9e\u8def\u5f84\u7684\u6d41\u3002 \u200b 3\u3001\u5f53\u5728\u975eservlet\u4e0b\u83b7\u53d6\u8d44\u6e90\u6587\u4ef6\u65f6\uff0c\u5c31\u6ca1\u6709ServletContext\u5bf9\u8c61\u7528\u4e86\uff0c\u6b64\u65f6\u53ea\u80fd\u7528\u7c7b\u52a0\u8f7d\u5668 classLoader.getResourceAsStream(\"../../1.properties\") \uff0c\u6b64\u65b9\u6cd5\u5229\u7528\u7c7b\u52a0\u8f7d\u5668\u76f4\u63a5\u5c06\u8d44\u6e90\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u6709\u66f4\u65b0\u5ef6\u8fdf\u7684\u95ee\u9898\uff0c\u4ee5\u53ca\u5982\u679c\u6587\u4ef6\u592a\u5927\uff0c\u5360\u7528\u5185\u5b58\u8fc7\u5927\u3002 classLoader.getResource(\"../1.properties\").getPath() \uff0c\u76f4\u63a5\u8fd4\u56de\u8d44\u6e90\u7684\u771f\u5b9e\u8def\u5f84\uff0c\u6ca1\u6709\u66f4\u65b0\u5ef6\u8fdf\u7684\u95ee\u9898\u3002","title":"1. application\uff08ServletContext\uff09"},{"location":"servlet/10.\u4f5c\u7528\u57df/#2-session-httpsession","text":"HttpSession \u5728\u670d\u52a1\u5668\u4e2d\uff0c\u4e3a\u6d4f\u89c8\u5668\u521b\u5efa\u72ec\u4e00\u65e0\u4e8c\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5176\u4e2d\u4fdd\u5b58\u4f1a\u8bdd\u76f8\u5173\u7684\u4fe1\u606f\u3002 1\u3001\u751f\u547d\u5468\u671f\uff1a\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 request.getSession() \u65b9\u6cd5\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u6709\u5bf9\u5e94\u7684session,\u5982\u679c\u6ca1\u6709\u5c31\u5728\u5185\u5b58 \u4e2d\u521b\u5efa\u4e00\u4e2asession\u5e76\u8fd4\u56de\u3002 \u5f53\u4e00\u6bb5\u65f6\u95f4\u5185session\u6ca1\u6709\u88ab\u4f7f\u7528\uff08tomcat\u9ed8\u8ba4\u4e3a30\u5206\u949f\uff09\uff0c\u5219\u670d\u52a1\u5668\u4f1a\u9500\u6bc1\u8be5session\u3002 \u5982\u679c\u670d\u52a1\u5668\u975e\u6b63\u5e38\u5173\u95ed\uff08\u5f3a\u884c\u5173\u95ed\uff09\uff0c\u6ca1\u6709\u5230\u671f\u7684session\u4e5f\u4f1a\u8ddf\u7740\u9500\u6bc1\u3002 \u5982\u679c\u8c03\u7528session\u63d0\u4f9b\u7684invalidate\uff08\uff09 \uff0c\u53ef\u4ee5\u7acb\u5373\u9500\u6bc1session\u3002 \u6ce8\u610f \uff1a\u670d\u52a1\u5668\u6b63\u5e38\u5173\u95ed\uff0c\u518d\u542f\u52a8\uff0cSession\u5bf9\u8c61\u4f1a\u8fdb\u884c\u949d\u5316\u548c\u6d3b\u5316\u64cd\u4f5c\u3002\u540c\u65f6\u5982\u679c\u670d\u52a1\u5668\u949d\u5316\u7684\u65f6\u95f4\u5728session \u9ed8\u8ba4\u9500\u6bc1\u65f6\u95f4\u4e4b\u5185\uff0c\u5219\u6d3b\u5316\u540esession\u8fd8\u662f\u5b58\u5728\u7684\u3002\u5426\u5219Session\u4e0d\u5b58\u5728\u3002 \u5982\u679cJavaBean \u6570\u636e\u5728session\u949d\u5316\u65f6\uff0c\u6ca1\u6709\u5b9e\u73b0Serializable \u5219\u5f53Session\u6d3b\u5316\u65f6\uff0c\u4f1a\u6d88\u5931\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u4e00\u6b21\u4f1a\u8bdd\u3002 3\u3001\u4f5c\u7528\uff1a\u4fdd\u5b58\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\u3001\u8d2d\u7269\u8f66\u4fe1\u606f\u7b49","title":"2. session \u57df (HttpSession)"},{"location":"servlet/10.\u4f5c\u7528\u57df/#3-request-httpservletrequest","text":"1\u3001\u751f\u547d\u5468\u671f\uff1a\u5728service \u65b9\u6cd5\u8c03\u7528\u524d\u7531\u670d\u52a1\u5668\u521b\u5efa\uff0c\u4f20\u5165service\u65b9\u6cd5\u3002\u6574\u4e2a\u8bf7\u6c42\u7ed3\u675f\uff0crequest\u751f\u547d\u7ed3\u675f\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2a\u8bf7\u6c42\u94fe\uff08 \u8bf7\u6c42\u8f6c\u53d1 \u4e5f\u5b58\u5728\uff09\u3002 3\u3001\u4f5c\u7528\uff1a \u5728\u6574\u4e2a\u8bf7\u6c42\u94fe\u4e2d\u5171\u4eab\u6570\u636e\u3002\u6700\u5e38\u7528\u5230\uff1a\u5728Servlet \u4e2d\u5904\u7406\u597d\u7684\u6570\u636e\u4ea4\u7ed9Jsp\u663e\u793a\uff0c\u6b64\u65f6\u53c2\u6570\u5c31\u53ef\u4ee5\u653e\u7f6e\u5728Request\u57df\u4e2d\u5e26\u8fc7\u53bb\u3002","title":"3. request\u57df  --(HttpServletRequest)"},{"location":"servlet/10.\u4f5c\u7528\u57df/#4-pagecontextpagecontext","text":"1\u3001\u751f\u547d\u5468\u671f\uff1a\u5f53\u5bf9JSP\u7684\u8bf7\u6c42\u65f6\u5f00\u59cb\uff0c\u5f53\u54cd\u5e94\u7ed3\u675f\u65f6\u9500\u6bc1\u3002 2\u3001\u4f5c\u7528\u8303\u56f4\uff1a\u6574\u4e2aJSP\u9875\u9762\uff0c\u662f\u56db\u5927\u4f5c\u7528\u57df\u4e2d\u6700\u5c0f\u7684\u4e00\u4e2a\u3002 3\u3001\u4f5c\u7528\uff1a \uff081\uff09\u83b7\u53d6\u5176\u5b83\u516b\u5927\u9690\u5f0f\u5bf9\u8c61\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u5165\u53e3\u5bf9\u8c61\u3002 \uff082\uff09\u83b7\u53d6\u5176\u6240\u6709\u57df\u4e2d\u7684\u6570\u636e pageContext\u64cd\u4f5c\u6240\u6709\u57df\u4e2d\u5c5e\u6027\u7684\u65b9\u6cd5\uff1a public java.lang.Object getAttribute(java.lang.String name,int scope) public void setAttribute(java.lang.String name, java.lang.Object value,int scope) public void removeAttribute(java.lang.String name,int scope) pageContext \u4e2d\u4ee3\u8868\u57df\u7684\u5e38\u91cf PageContext.APPLICATION_SCOPE PageContext.SESSION_SCOPE PageContext.REQUEST_SCOPE PageContext.PAGE_SCOPE findAttribute\u65b9\u6cd5,\u5728\u56db\u5927\u57df\u4e2d\u641c\u5bfb\u5c5e\u6027\uff0c\u641c\u5bfb\u7684\u987a\u5e8f\u662fpage\u57df\u3001request\u57df\u3001session\u57df\u3001application\u57df\uff0c\u4ece\u5c0f\u57df\u5230\u5927\u57df\u5f00\u59cb\u641c\u7d22\uff0c\u5982\u679c\u641c\u7d22\u5230\u5c31\u76f4\u63a5\u83b7\u53d6\u8be5\u503c\uff0c\u5982\u679c\u6240\u6709\u57df\u4e2d\u90fd\u627e\u4e0d\u5230\uff0c\u8fd4\u56de\u4e00\u4e2anull(\u4e0eel\u8868\u8fbe\u5f0f\u4e0d\u540c\uff0c\u6b64\u5904\u8fd4\u56denull\uff0c\u5bf9\u7f51\u9875\u662f\u4e0d\u53cb\u597d\u7684) \u200b \uff083\uff09\u8df3\u8f6c\u5230\u5176\u4ed6\u8d44\u6e90 \u5176\u8eab\u4e0a\u63d0\u4f9b\u4e86forward\u548cinclude\u65b9\u6cd5\uff0c\u7b80\u5316\u91cd\u5b9a\u5411\u548c\u8f6c\u53d1\u7684\u64cd\u4f5c","title":"4. pageContext\u57df\u2014(PageContext)"},{"location":"servlet/11.\u76d1\u542c\u5668/","text":"\u76d1\u542c\u5668\u7528\u4e8e\u76d1\u542cweb\u4e2d\u7684\u5bf9\u8c61\u7684\u521b\u5efa\u3001\u53d8\u5316\uff08\u5c5e\u6027\u53d8\u5316\uff09\u3001\u9500\u6bc1\u7b49\u52a8\u4f5c\uff0c\u7136\u540e\u505a\u51fa\u54cd\u5e94\u3002 \u53c2\u8003\u535a\u5ba2 1. \u5206\u7c7b \u00b6 \u6309\u76d1\u542c\u7684\u5bf9\u8c61\u5212\u5206\uff0c\u53ef\u4ee5\u5206\u4e3a ServletContext\u5bf9\u8c61\u76d1\u542c\u5668 HttpSession\u5bf9\u8c61\u76d1\u542c\u5668 ServletRequest\u5bf9\u8c61\u76d1\u542c\u5668 \u6309\u76d1\u542c\u7684\u4e8b\u4ef6\u5212\u5206 \u5bf9\u8c61\u81ea\u8eab\u7684\u521b\u5efa\u548c\u9500\u6bc1\u7684\u76d1\u542c\u5668 \u5bf9\u8c61\u4e2d\u5c5e\u6027\u7684\u521b\u5efa\u548c\u6d88\u9664\u7684\u76d1\u542c\u5668 session\u4e2d\u7684\u67d0\u4e2a\u5bf9\u8c61\u7684\u72b6\u6001\u53d8\u5316\u7684\u76d1\u542c\u5668 \u5b9e\u73b0\u63a5\u53e3\u5e76\u914d\u7f6e\u4e4b\u540e\u5373\u53ef\u6ce8\u518c\u76d1\u542c\u5668\u3002 2. \u5bf9\u8c61\u53d8\u66f4\u76d1\u542c\u5668 \u00b6 HttpSessionListener ServletContextListener ServletRequestListener \u4e09\u79cd\u90fd\u6709\u4e14\u4ec5\u6709\u521d\u59cb\u5316\u548c\u9500\u6bc1\u7684\u76d1\u542c\u65b9\u6cd5\uff0c\u53ea\u662f\u4f20\u53c2\u662f\u5404\u81ea\u7684event\u4e8b\u4ef6\u3002 //HttpSessionListener public void sessionCreated ( HttpSessionEvent se ); public void sessionDestroyed ( HttpSessionEvent se ); //ServletContextListener public void contextInitialized ( ServletContextEvent sce ); public void contextDestroyed ( ServletContextEvent sce ); //ServletRequestListener public void requestInitialized ( ServletRequestEvent sre ); public void requestDestroyed ( ServletRequestEvent sre ); 3. \u5c5e\u6027\u53d8\u66f4\u76d1\u542c\u5668 \u00b6 ServletContextAttributeListener HttpSessionAttributeListener ServletRequestAttributeListener \u76d1\u542c\u5c5e\u6027\u6539\u53d8\u65f6\u7684\u4e8b\u4ef6\u3002 \u4e09\u4e2a\u63a5\u53e3\u90fd\u6709\u540c\u6837\u7684\u4e09\u4e2a\u65b9\u6cd5\uff08\u53c2\u6570\u4e0d\u540c\uff09\uff1a //HttpSessionAttributeListener public void attributeAdded ( HttpSessionBindingEvent event ); public void attributeRemoved ( HttpSessionBindingEvent event ); public void attributeReplaced ( HttpSessionBindingEvent event ); //ServletContextAttributeListener public void attributeAdded ( ServletContextAttributeEvent event ); public void attributeRemoved ( ServletContextAttributeEvent event ); public void attributeReplaced ( ServletContextAttributeEvent event ); //ServletRequestAttributeListener public void attributeAdded ( ServletRequestAttributeEvent srae ); public void attributeRemoved ( ServletRequestAttributeEvent srae ); public void attributeReplaced ( ServletRequestAttributeEvent srae ); 4. \u611f\u77e5Session\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u76d1\u542c\u5668 \u00b6 \u4fdd\u5b58\u5728Session\u57df\u4e2d\u7684\u5bf9\u8c61\u53ef\u4ee5\u6709\u591a\u79cd\u72b6\u6001\uff1a\u7ed1\u5b9a(session.setAttribute(\"bean\",Object))\u5230Session\u4e2d\uff1b\u4ece Session\u57df\u4e2d\u89e3\u9664(session.removeAttribute(\"bean\"))\u7ed1\u5b9a\uff1b\u968fSession\u5bf9\u8c61\u6301\u4e45\u5316\u5230\u4e00\u4e2a\u5b58\u50a8\u8bbe\u5907\u4e2d\uff08\u949d\u5316/\u5e8f\u5217\u5316\uff09\uff1b\u968fSession\u5bf9\u8c61\u4ece\u4e00\u4e2a\u5b58\u50a8\u8bbe\u5907\u4e2d\u6062\u590d\uff08\u6d3b\u5316/\u53cd\u5e8f\u5217\u5316\uff09\u3002 Servlet \u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86 \u4e24\u4e2a\u7279\u6b8a\u7684\u76d1\u542c\u5668\u63a5\u53e3\"HttpSessionBindingListener\u548cHttpSessionActivationListener\" \u6765\u5e2e\u52a9JavaBean \u5bf9\u8c61\u4e86\u89e3\u81ea\u5df1\u5728Session\u57df\u4e2d\u7684\u8fd9\u4e9b\u72b6\u6001\u3002\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u63a5\u53e3\u7684\u7c7b \u4e0d\u9700\u8981 web.xml \u6587\u4ef6\u4e2d\u8fdb\u884c\u6ce8\u518c \u3002 4.1 HttpSessionBindingListener\u63a5\u53e3 \u00b6 public void valueBound ( HttpSessionBindingEvent event ); public void valueUnbound ( HttpSessionBindingEvent event ); 4.2 HttpSessionActivationListener\u63a5\u53e3 \u00b6 package me.gacl.domain ; import java.io.Serializable ; import javax.servlet.http.HttpSessionActivationListener ; import javax.servlet.http.HttpSessionEvent ; /** \u5b9e\u73b0\u4e86HttpSessionActivationListener\u63a5\u53e3\u7684 JavaBean \u5bf9\u8c61\u53ef\u4ee5\u611f\u77e5\u81ea\u5df1\u88ab\u6d3b\u5316\u548c\u949d\u5316\u7684\u4e8b\u4ef6 \u6d3b\u5316:javabean\u5bf9\u8c61\u548cSession\u4e00\u8d77\u88ab\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u5230\u5185\u5b58\u4e2d\u3002 \u949d\u5316:javabean\u5bf9\u8c61\u5b58\u5728Session\u4e2d\uff0c\u5f53\u670d\u52a1\u5668\u628asession\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e0a\u65f6\uff0c\u5982\u679cSession\u4e2d\u7684javabean\u5bf9\u8c61\u5b9e\u73b0\u4e86Serializable\u63a5\u53e3 \u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u628asession\u4e2d\u7684javabean\u5bf9\u8c61\u4e00\u8d77\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e0a\uff0cjavabean\u5bf9\u8c61\u548cSession\u4e00\u8d77\u88ab\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e2d\u7684\u8fd9\u4e2a\u64cd\u4f5c\u79f0\u4e4b\u4e3a\u949d\u5316 \u5982\u679cSession\u4e2d\u7684javabean\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u5148\u628aSession\u4e2d\u6ca1\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\u7684javabean\u5bf9\u8c61\u79fb\u9664\uff0c\u7136\u540e\u518d\u628aSession\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e2d \u5f53\u7ed1\u5b9a\u5230 HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u5c06\u8981\u968f HttpSession\u5bf9\u8c61\u88ab\u949d\u5316\u4e4b\u524d\uff0c web\u670d\u52a1\u5668\u8c03\u7528\u8be5javabean\u5bf9\u8c61\u7684 void sessionWillPassivate(HttpSessionEvent event)\u65b9\u6cd5 \u8fd9\u6837javabean\u5bf9\u8c61\u5c31\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u5c06\u8981\u548c HttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e2d \u5f53\u7ed1\u5b9a\u5230HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u5c06\u8981\u968f HttpSession\u5bf9\u8c61\u88ab\u6d3b\u5316\u4e4b\u540e\uff0c web\u670d\u52a1\u5668\u8c03\u7528\u8be5javabean\u5bf9\u8c61\u7684 void sessionDidActive(HttpSessionEvent event)\u65b9\u6cd5 \u8fd9\u6837javabean\u5bf9\u8c61\u5c31\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u5c06\u8981\u548c HttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u56de\u5230\u5185\u5b58\u4e2d * */ public class JavaBeanDemo2 implements HttpSessionActivationListener , Serializable { private static final long serialVersionUID = 7589841135210272124L ; private String name ; @Override public void sessionWillPassivate ( HttpSessionEvent se ) { System . out . println ( name + \"\u548csession\u4e00\u8d77\u88ab\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e86\uff0csession\u7684id\u662f\uff1a\" + se . getSession (). getId ()); } @Override public void sessionDidActivate ( HttpSessionEvent se ) { System . out . println ( name + \"\u548csession\u4e00\u8d77\u4ece\u786c\u76d8\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u56de\u5230\u5185\u5b58\u4e86\uff0csession\u7684id\u662f\uff1a\" + se . getSession (). getId ()); } public String getName () { return name ; } public void setName ( String name ) { this . name = name ; } public JavaBeanDemo2 ( String name ) { this . name = name ; } } \u4e3a\u4e86\u89c2\u5bdf\u7ed1\u5b9a\u5230HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u968fHttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u949d\u5316\u5230\u786c\u76d8\u4e0a\u548c\u4ece\u786c\u76d8\u4e0a\u91cd\u65b0\u6d3b\u5316\u56de\u5230\u5185\u5b58\u4e2d\u7684\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9tomcat\u670d\u52a1\u5668\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210HttpSession\u5bf9\u8c61\u7684\u949d\u5316\u548c\u6d3b\u5316\u8fc7\u7a0b\uff0c\u5177\u4f53\u505a\u6cd5\u5982\u4e0b\uff1a \u5728WebRoot\\META-INF\u6587\u4ef6\u5939\u4e0b\u521b\u5efa\u4e00\u4e2acontext.xml\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <Context> <Manager className= \"org.apache.catalina.session.PersistentManager\" maxIdleSwap= \"1\" > <Store className= \"org.apache.catalina.session.FileStore\" directory= \"gacl\" /> </Manager> </Context> \u5728context.xml\u6587\u4ef6\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e861\u5206\u949f\u4e4b\u540e\u5c31\u5c06HttpSession\u5bf9\u8c61\u949d\u5316\u5230\u672c\u5730\u786c\u76d8\u7684\u4e00\u4e2agacl\u6587\u4ef6\u5939\u4e2d 5. \u914d\u7f6e\u76d1\u542c\u5668 \u00b6 <!--\u6ce8\u518c\u9488\u5bf9HttpSession\u5bf9\u8c61\u8fdb\u884c\u76d1\u542c\u7684\u76d1\u542c\u5668--> <listener> <description> HttpSessionListener\u76d1\u542c\u5668 </description> <listener-class> me.gacl.web.listener.MyHttpSessionListener </listener-class> </listener> <!-- \u914d\u7f6eHttpSession\u5bf9\u8c61\u7684\u9500\u6bc1\u65f6\u673a --> <session-config> <!--\u914d\u7f6eHttpSession\u5bf9\u8c61\u76841\u5206\u949f\u4e4b\u540e\u9500\u6bc1 --> <session-timeout> 1 </session-timeout> </session-config>","title":"11.\u76d1\u542c\u5668"},{"location":"servlet/11.\u76d1\u542c\u5668/#1","text":"\u6309\u76d1\u542c\u7684\u5bf9\u8c61\u5212\u5206\uff0c\u53ef\u4ee5\u5206\u4e3a ServletContext\u5bf9\u8c61\u76d1\u542c\u5668 HttpSession\u5bf9\u8c61\u76d1\u542c\u5668 ServletRequest\u5bf9\u8c61\u76d1\u542c\u5668 \u6309\u76d1\u542c\u7684\u4e8b\u4ef6\u5212\u5206 \u5bf9\u8c61\u81ea\u8eab\u7684\u521b\u5efa\u548c\u9500\u6bc1\u7684\u76d1\u542c\u5668 \u5bf9\u8c61\u4e2d\u5c5e\u6027\u7684\u521b\u5efa\u548c\u6d88\u9664\u7684\u76d1\u542c\u5668 session\u4e2d\u7684\u67d0\u4e2a\u5bf9\u8c61\u7684\u72b6\u6001\u53d8\u5316\u7684\u76d1\u542c\u5668 \u5b9e\u73b0\u63a5\u53e3\u5e76\u914d\u7f6e\u4e4b\u540e\u5373\u53ef\u6ce8\u518c\u76d1\u542c\u5668\u3002","title":"1. \u5206\u7c7b"},{"location":"servlet/11.\u76d1\u542c\u5668/#2","text":"HttpSessionListener ServletContextListener ServletRequestListener \u4e09\u79cd\u90fd\u6709\u4e14\u4ec5\u6709\u521d\u59cb\u5316\u548c\u9500\u6bc1\u7684\u76d1\u542c\u65b9\u6cd5\uff0c\u53ea\u662f\u4f20\u53c2\u662f\u5404\u81ea\u7684event\u4e8b\u4ef6\u3002 //HttpSessionListener public void sessionCreated ( HttpSessionEvent se ); public void sessionDestroyed ( HttpSessionEvent se ); //ServletContextListener public void contextInitialized ( ServletContextEvent sce ); public void contextDestroyed ( ServletContextEvent sce ); //ServletRequestListener public void requestInitialized ( ServletRequestEvent sre ); public void requestDestroyed ( ServletRequestEvent sre );","title":"2. \u5bf9\u8c61\u53d8\u66f4\u76d1\u542c\u5668"},{"location":"servlet/11.\u76d1\u542c\u5668/#3","text":"ServletContextAttributeListener HttpSessionAttributeListener ServletRequestAttributeListener \u76d1\u542c\u5c5e\u6027\u6539\u53d8\u65f6\u7684\u4e8b\u4ef6\u3002 \u4e09\u4e2a\u63a5\u53e3\u90fd\u6709\u540c\u6837\u7684\u4e09\u4e2a\u65b9\u6cd5\uff08\u53c2\u6570\u4e0d\u540c\uff09\uff1a //HttpSessionAttributeListener public void attributeAdded ( HttpSessionBindingEvent event ); public void attributeRemoved ( HttpSessionBindingEvent event ); public void attributeReplaced ( HttpSessionBindingEvent event ); //ServletContextAttributeListener public void attributeAdded ( ServletContextAttributeEvent event ); public void attributeRemoved ( ServletContextAttributeEvent event ); public void attributeReplaced ( ServletContextAttributeEvent event ); //ServletRequestAttributeListener public void attributeAdded ( ServletRequestAttributeEvent srae ); public void attributeRemoved ( ServletRequestAttributeEvent srae ); public void attributeReplaced ( ServletRequestAttributeEvent srae );","title":"3. \u5c5e\u6027\u53d8\u66f4\u76d1\u542c\u5668"},{"location":"servlet/11.\u76d1\u542c\u5668/#4-session","text":"\u4fdd\u5b58\u5728Session\u57df\u4e2d\u7684\u5bf9\u8c61\u53ef\u4ee5\u6709\u591a\u79cd\u72b6\u6001\uff1a\u7ed1\u5b9a(session.setAttribute(\"bean\",Object))\u5230Session\u4e2d\uff1b\u4ece Session\u57df\u4e2d\u89e3\u9664(session.removeAttribute(\"bean\"))\u7ed1\u5b9a\uff1b\u968fSession\u5bf9\u8c61\u6301\u4e45\u5316\u5230\u4e00\u4e2a\u5b58\u50a8\u8bbe\u5907\u4e2d\uff08\u949d\u5316/\u5e8f\u5217\u5316\uff09\uff1b\u968fSession\u5bf9\u8c61\u4ece\u4e00\u4e2a\u5b58\u50a8\u8bbe\u5907\u4e2d\u6062\u590d\uff08\u6d3b\u5316/\u53cd\u5e8f\u5217\u5316\uff09\u3002 Servlet \u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86 \u4e24\u4e2a\u7279\u6b8a\u7684\u76d1\u542c\u5668\u63a5\u53e3\"HttpSessionBindingListener\u548cHttpSessionActivationListener\" \u6765\u5e2e\u52a9JavaBean \u5bf9\u8c61\u4e86\u89e3\u81ea\u5df1\u5728Session\u57df\u4e2d\u7684\u8fd9\u4e9b\u72b6\u6001\u3002\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u63a5\u53e3\u7684\u7c7b \u4e0d\u9700\u8981 web.xml \u6587\u4ef6\u4e2d\u8fdb\u884c\u6ce8\u518c \u3002","title":"4. \u611f\u77e5Session\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u76d1\u542c\u5668"},{"location":"servlet/11.\u76d1\u542c\u5668/#41-httpsessionbindinglistener","text":"public void valueBound ( HttpSessionBindingEvent event ); public void valueUnbound ( HttpSessionBindingEvent event );","title":"4.1 HttpSessionBindingListener\u63a5\u53e3"},{"location":"servlet/11.\u76d1\u542c\u5668/#42-httpsessionactivationlistener","text":"package me.gacl.domain ; import java.io.Serializable ; import javax.servlet.http.HttpSessionActivationListener ; import javax.servlet.http.HttpSessionEvent ; /** \u5b9e\u73b0\u4e86HttpSessionActivationListener\u63a5\u53e3\u7684 JavaBean \u5bf9\u8c61\u53ef\u4ee5\u611f\u77e5\u81ea\u5df1\u88ab\u6d3b\u5316\u548c\u949d\u5316\u7684\u4e8b\u4ef6 \u6d3b\u5316:javabean\u5bf9\u8c61\u548cSession\u4e00\u8d77\u88ab\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u5230\u5185\u5b58\u4e2d\u3002 \u949d\u5316:javabean\u5bf9\u8c61\u5b58\u5728Session\u4e2d\uff0c\u5f53\u670d\u52a1\u5668\u628asession\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e0a\u65f6\uff0c\u5982\u679cSession\u4e2d\u7684javabean\u5bf9\u8c61\u5b9e\u73b0\u4e86Serializable\u63a5\u53e3 \u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u628asession\u4e2d\u7684javabean\u5bf9\u8c61\u4e00\u8d77\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e0a\uff0cjavabean\u5bf9\u8c61\u548cSession\u4e00\u8d77\u88ab\u5e8f\u5217\u5316\u5230\u786c\u76d8\u4e2d\u7684\u8fd9\u4e2a\u64cd\u4f5c\u79f0\u4e4b\u4e3a\u949d\u5316 \u5982\u679cSession\u4e2d\u7684javabean\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u5148\u628aSession\u4e2d\u6ca1\u6709\u5b9e\u73b0Serializable\u63a5\u53e3\u7684javabean\u5bf9\u8c61\u79fb\u9664\uff0c\u7136\u540e\u518d\u628aSession\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e2d \u5f53\u7ed1\u5b9a\u5230 HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u5c06\u8981\u968f HttpSession\u5bf9\u8c61\u88ab\u949d\u5316\u4e4b\u524d\uff0c web\u670d\u52a1\u5668\u8c03\u7528\u8be5javabean\u5bf9\u8c61\u7684 void sessionWillPassivate(HttpSessionEvent event)\u65b9\u6cd5 \u8fd9\u6837javabean\u5bf9\u8c61\u5c31\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u5c06\u8981\u548c HttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e2d \u5f53\u7ed1\u5b9a\u5230HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u5c06\u8981\u968f HttpSession\u5bf9\u8c61\u88ab\u6d3b\u5316\u4e4b\u540e\uff0c web\u670d\u52a1\u5668\u8c03\u7528\u8be5javabean\u5bf9\u8c61\u7684 void sessionDidActive(HttpSessionEvent event)\u65b9\u6cd5 \u8fd9\u6837javabean\u5bf9\u8c61\u5c31\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u5c06\u8981\u548c HttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u56de\u5230\u5185\u5b58\u4e2d * */ public class JavaBeanDemo2 implements HttpSessionActivationListener , Serializable { private static final long serialVersionUID = 7589841135210272124L ; private String name ; @Override public void sessionWillPassivate ( HttpSessionEvent se ) { System . out . println ( name + \"\u548csession\u4e00\u8d77\u88ab\u5e8f\u5217\u5316(\u949d\u5316)\u5230\u786c\u76d8\u4e86\uff0csession\u7684id\u662f\uff1a\" + se . getSession (). getId ()); } @Override public void sessionDidActivate ( HttpSessionEvent se ) { System . out . println ( name + \"\u548csession\u4e00\u8d77\u4ece\u786c\u76d8\u53cd\u5e8f\u5217\u5316(\u6d3b\u5316)\u56de\u5230\u5185\u5b58\u4e86\uff0csession\u7684id\u662f\uff1a\" + se . getSession (). getId ()); } public String getName () { return name ; } public void setName ( String name ) { this . name = name ; } public JavaBeanDemo2 ( String name ) { this . name = name ; } } \u4e3a\u4e86\u89c2\u5bdf\u7ed1\u5b9a\u5230HttpSession\u5bf9\u8c61\u4e2d\u7684javabean\u5bf9\u8c61\u968fHttpSession\u5bf9\u8c61\u4e00\u8d77\u88ab\u949d\u5316\u5230\u786c\u76d8\u4e0a\u548c\u4ece\u786c\u76d8\u4e0a\u91cd\u65b0\u6d3b\u5316\u56de\u5230\u5185\u5b58\u4e2d\u7684\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9tomcat\u670d\u52a1\u5668\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210HttpSession\u5bf9\u8c61\u7684\u949d\u5316\u548c\u6d3b\u5316\u8fc7\u7a0b\uff0c\u5177\u4f53\u505a\u6cd5\u5982\u4e0b\uff1a \u5728WebRoot\\META-INF\u6587\u4ef6\u5939\u4e0b\u521b\u5efa\u4e00\u4e2acontext.xml\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <Context> <Manager className= \"org.apache.catalina.session.PersistentManager\" maxIdleSwap= \"1\" > <Store className= \"org.apache.catalina.session.FileStore\" directory= \"gacl\" /> </Manager> </Context> \u5728context.xml\u6587\u4ef6\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e861\u5206\u949f\u4e4b\u540e\u5c31\u5c06HttpSession\u5bf9\u8c61\u949d\u5316\u5230\u672c\u5730\u786c\u76d8\u7684\u4e00\u4e2agacl\u6587\u4ef6\u5939\u4e2d","title":"4.2  HttpSessionActivationListener\u63a5\u53e3"},{"location":"servlet/11.\u76d1\u542c\u5668/#5","text":"<!--\u6ce8\u518c\u9488\u5bf9HttpSession\u5bf9\u8c61\u8fdb\u884c\u76d1\u542c\u7684\u76d1\u542c\u5668--> <listener> <description> HttpSessionListener\u76d1\u542c\u5668 </description> <listener-class> me.gacl.web.listener.MyHttpSessionListener </listener-class> </listener> <!-- \u914d\u7f6eHttpSession\u5bf9\u8c61\u7684\u9500\u6bc1\u65f6\u673a --> <session-config> <!--\u914d\u7f6eHttpSession\u5bf9\u8c61\u76841\u5206\u949f\u4e4b\u540e\u9500\u6bc1 --> <session-timeout> 1 </session-timeout> </session-config>","title":"5. \u914d\u7f6e\u76d1\u542c\u5668"},{"location":"servlet/2.\u751f\u547d\u5468\u671f/","text":"Servlet \u751f\u547d\u5468\u671f\u53ef\u88ab\u5b9a\u4e49\u4e3a\u4ece\u521b\u5efa\u76f4\u5230\u6bc1\u706d\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002 Servlet \u901a\u8fc7\u8c03\u7528 init(ServletConfig var1) \u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316\u3002 Servlet \u8c03\u7528 service() \u65b9\u6cd5\u6765\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u3002 Servlet \u901a\u8fc7\u8c03\u7528 destroy() \u65b9\u6cd5\u7ec8\u6b62\uff08\u7ed3\u675f\uff09\u3002 \u6700\u540e\uff0cServlet \u662f\u7531 JVM \u7684\u5783\u573e\u56de\u6536\u5668\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u3002 \u6bcf\u6b21\u670d\u52a1\u5668\u63a5\u6536\u5230\u4e00\u4e2a Servlet \u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u5e76\u8c03\u7528\u670d\u52a1\u3002 1. init(ServletConfig var1) \u00b6 \u5b83\u5728\u7b2c\u4e00\u6b21\u521b\u5efa Servlet \u65f6\u88ab\u8c03\u7528\uff0c\u5728\u540e\u7eed\u6bcf\u6b21\u7528\u6237\u8bf7\u6c42\u65f6\u4e0d\u518d\u8c03\u7528\u3002 Servlet \u521b\u5efa\u4e8e\u7528\u6237\u7b2c\u4e00\u6b21\u8c03\u7528\u5bf9\u5e94\u4e8e\u8be5 Servlet \u7684 URL \u65f6\uff0c\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u6307\u5b9a Servlet \u5728\u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6\u88ab\u52a0\u8f7d\u3002 \u5f53\u7528\u6237\u8c03\u7528\u4e00\u4e2a Servlet \u65f6\uff0c\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a Servlet \u5b9e\u4f8b\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u8bf7\u6c42\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u9002\u5f53\u7684\u65f6\u5019\u79fb\u4ea4\u7ed9 doGet \u6216 doPost \u65b9\u6cd5\u3002init() \u65b9\u6cd5\u7b80\u5355\u5730\u521b\u5efa\u6216\u52a0\u8f7d\u4e00\u4e9b\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5c06\u88ab\u7528\u4e8e Servlet \u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u3002 public void init ( ServletConfig var1 ) throws ServletException { // \u521d\u59cb\u5316\u4ee3\u7801... } 2. service() \u00b6 \u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u7684\u8bf7\u6c42\uff0c\u5e76\u628a\u683c\u5f0f\u5316\u7684\u54cd\u5e94\u5199\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 service() \u65b9\u6cd5\u68c0\u67e5 HTTP \u8bf7\u6c42\u7c7b\u578b\uff08GET\u3001POST\u3001PUT\u3001DELETE \u7b49\uff09\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528 doGet\u3001doPost\u3001doPut\uff0cdoDelete \u7b49\u65b9\u6cd5\u3002 public void service ( ServletRequest request , ServletResponse response ) throws ServletException , IOException { } service() \u65b9\u6cd5\u7531\u5bb9\u5668\u8c03\u7528\uff0c\u53ea\u9700\u8981\u6839\u636e\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u7c7b\u578b\u6765\u91cd\u5199 doGet() \u6216 doPost() \u5373\u53ef\u3002 public void doGet ( HttpServletRequest request , HttpServletResponse response ) throws ServletException , IOException { // Servlet \u4ee3\u7801 } public void doPost ( HttpServletRequest request , HttpServletResponse response ) throws ServletException , IOException { // Servlet \u4ee3\u7801 } 3. destroy() \u00b6 destroy() \u65b9\u6cd5\u53ea\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21\uff0c\u5728 Servlet \u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u88ab\u8c03\u7528\u3002destroy() \u65b9\u6cd5\u53ef\u4ee5\u8ba9\u60a8\u7684 Servlet \u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u3001\u505c\u6b62\u540e\u53f0\u7ebf\u7a0b\u3001\u628a Cookie \u5217\u8868\u6216\u70b9\u51fb\u8ba1\u6570\u5668\u5199\u5165\u5230\u78c1\u76d8\uff0c\u5e76\u6267\u884c\u5176\u4ed6\u7c7b\u4f3c\u7684\u6e05\u7406\u6d3b\u52a8\u3002 public void destroy () { // \u7ec8\u6b62\u5316\u4ee3\u7801... }","title":"2.\u751f\u547d\u5468\u671f"},{"location":"servlet/2.\u751f\u547d\u5468\u671f/#1-initservletconfig-var1","text":"\u5b83\u5728\u7b2c\u4e00\u6b21\u521b\u5efa Servlet \u65f6\u88ab\u8c03\u7528\uff0c\u5728\u540e\u7eed\u6bcf\u6b21\u7528\u6237\u8bf7\u6c42\u65f6\u4e0d\u518d\u8c03\u7528\u3002 Servlet \u521b\u5efa\u4e8e\u7528\u6237\u7b2c\u4e00\u6b21\u8c03\u7528\u5bf9\u5e94\u4e8e\u8be5 Servlet \u7684 URL \u65f6\uff0c\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u6307\u5b9a Servlet \u5728\u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6\u88ab\u52a0\u8f7d\u3002 \u5f53\u7528\u6237\u8c03\u7528\u4e00\u4e2a Servlet \u65f6\uff0c\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a Servlet \u5b9e\u4f8b\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u8bf7\u6c42\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u9002\u5f53\u7684\u65f6\u5019\u79fb\u4ea4\u7ed9 doGet \u6216 doPost \u65b9\u6cd5\u3002init() \u65b9\u6cd5\u7b80\u5355\u5730\u521b\u5efa\u6216\u52a0\u8f7d\u4e00\u4e9b\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u5c06\u88ab\u7528\u4e8e Servlet \u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u3002 public void init ( ServletConfig var1 ) throws ServletException { // \u521d\u59cb\u5316\u4ee3\u7801... }","title":"1. init(ServletConfig var1)"},{"location":"servlet/2.\u751f\u547d\u5468\u671f/#2-service","text":"\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u7684\u8bf7\u6c42\uff0c\u5e76\u628a\u683c\u5f0f\u5316\u7684\u54cd\u5e94\u5199\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 service() \u65b9\u6cd5\u68c0\u67e5 HTTP \u8bf7\u6c42\u7c7b\u578b\uff08GET\u3001POST\u3001PUT\u3001DELETE \u7b49\uff09\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528 doGet\u3001doPost\u3001doPut\uff0cdoDelete \u7b49\u65b9\u6cd5\u3002 public void service ( ServletRequest request , ServletResponse response ) throws ServletException , IOException { } service() \u65b9\u6cd5\u7531\u5bb9\u5668\u8c03\u7528\uff0c\u53ea\u9700\u8981\u6839\u636e\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u7c7b\u578b\u6765\u91cd\u5199 doGet() \u6216 doPost() \u5373\u53ef\u3002 public void doGet ( HttpServletRequest request , HttpServletResponse response ) throws ServletException , IOException { // Servlet \u4ee3\u7801 } public void doPost ( HttpServletRequest request , HttpServletResponse response ) throws ServletException , IOException { // Servlet \u4ee3\u7801 }","title":"2. service()"},{"location":"servlet/2.\u751f\u547d\u5468\u671f/#3-destroy","text":"destroy() \u65b9\u6cd5\u53ea\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21\uff0c\u5728 Servlet \u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u88ab\u8c03\u7528\u3002destroy() \u65b9\u6cd5\u53ef\u4ee5\u8ba9\u60a8\u7684 Servlet \u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u3001\u505c\u6b62\u540e\u53f0\u7ebf\u7a0b\u3001\u628a Cookie \u5217\u8868\u6216\u70b9\u51fb\u8ba1\u6570\u5668\u5199\u5165\u5230\u78c1\u76d8\uff0c\u5e76\u6267\u884c\u5176\u4ed6\u7c7b\u4f3c\u7684\u6e05\u7406\u6d3b\u52a8\u3002 public void destroy () { // \u7ec8\u6b62\u5316\u4ee3\u7801... }","title":"3. destroy()"},{"location":"servlet/3.\u793a\u4f8b/","text":"1. \u793a\u4f8b \u00b6 Web \u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4eba\u5458\u901a\u5e38\u7f16\u5199 Servlet \u6765\u6269\u5c55 javax.servlet.http.HttpServlet\uff0c\u5e76\u5b9e\u73b0 Servlet \u63a5\u53e3\u7684\u62bd\u8c61\u7c7b\u4e13\u95e8\u7528\u6765\u5904\u7406 HTTP \u8bf7\u6c42\u3002 package servlets ; import javax.servlet.ServletException ; import javax.servlet.annotation.WebServlet ; import javax.servlet.http.HttpServlet ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; import java.io.PrintWriter ; @WebServlet ( \"/user\" ) public class User extends HttpServlet { private String msg ; @Override public void init () throws ServletException { msg = \"Who are you ?\" ; } @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { resp . setContentType ( \"text/html\" ); PrintWriter pw = resp . getWriter (); pw . write ( \"#\" + msg ); } } \u6ce8\u610f\uff1a\u53ea\u6709\u8bbe\u7f6e\u4e86\u8fd4\u56de\u5185\u5bb9\u7684\u7c7b\u578b\u540e\uff0c\u5176\u5b57\u7b26\u96c6\u8bbe\u7f6e\u624d\u4f1a\u751f\u6548\uff0c\u5426\u5219\u4ecd\u4f1a\u5bfc\u81f4\u4e71\u7801\u3002 1.1 Servlet \u90e8\u7f72 \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cServlet \u5e94\u7528\u7a0b\u5e8f\u4f4d\u4e8e\u8def\u5f84 /webapps/ROOT \u4e0b\uff0c\u4e14\u7c7b\u6587\u4ef6\u653e\u5728 /webapps/ROOT/WEB-INF/classes \u4e2d\u3002 \u5982\u679c\u60a8\u6709\u4e00\u4e2a\u5b8c\u5168\u5408\u683c\u7684\u7c7b\u540d\u79f0 com.myorg.MyServlet \uff0c\u90a3\u4e48\u8fd9\u4e2a Servlet \u7c7b\u5fc5\u987b\u4f4d\u4e8e WEB-INF/classes/com/myorg/MyServlet.class \u4e2d\u3002 URL\u7684\u6620\u5c04\u914d\u7f6e\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 @WebServlet(/user) \u6ce8\u89e3\uff0c\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u5df2\u4f7f\u7528\uff1b\u4e00\u79cd\u662f\u914d\u7f6e web.xml \uff1a <web-app> <servlet> <servlet-name> User </servlet-name> <servlet-class> servlets.User </servlet-class> </servlet> <servlet-mapping> <servlet-name> User </servlet-name> <url-pattern> /user </url-pattern> </servlet-mapping> </web-app> \u6ce8\u610f \uff1a\u8fd9\u4e24\u79cd\u65b9\u5f0f\u4e0d\u80fd\u91cd\u590d\u914d\u7f6e\uff0c\u5373\u914d\u7f6e\u4e86\u4e24\u79cd\u65b9\u5f0f\u6307\u5411\u4e86\u540c\u4e00\u4e2aURL\uff0c\u8fd9\u6837\u505a\u4f1a\u5bfc\u81f4Tomcat\u542f\u52a8\u5931\u8d25\u3002 \u81f3\u6b64\u90e8\u7f72\u5b8c\u6210\uff0c\u542f\u52a8Tomcat\uff1a \\bin\\startup.bat\uff08\u5728 Windows \u4e0a\uff09\u6216 /bin/startup.sh\uff08\u5728 Linux/Solaris \u7b49\u4e0a\uff09\u3002 \u8bbf\u95ee\uff1a http://localhost:8080/user","title":"3.\u793a\u4f8b"},{"location":"servlet/3.\u793a\u4f8b/#1","text":"Web \u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u4eba\u5458\u901a\u5e38\u7f16\u5199 Servlet \u6765\u6269\u5c55 javax.servlet.http.HttpServlet\uff0c\u5e76\u5b9e\u73b0 Servlet \u63a5\u53e3\u7684\u62bd\u8c61\u7c7b\u4e13\u95e8\u7528\u6765\u5904\u7406 HTTP \u8bf7\u6c42\u3002 package servlets ; import javax.servlet.ServletException ; import javax.servlet.annotation.WebServlet ; import javax.servlet.http.HttpServlet ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; import java.io.PrintWriter ; @WebServlet ( \"/user\" ) public class User extends HttpServlet { private String msg ; @Override public void init () throws ServletException { msg = \"Who are you ?\" ; } @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { resp . setContentType ( \"text/html\" ); PrintWriter pw = resp . getWriter (); pw . write ( \"#\" + msg ); } } \u6ce8\u610f\uff1a\u53ea\u6709\u8bbe\u7f6e\u4e86\u8fd4\u56de\u5185\u5bb9\u7684\u7c7b\u578b\u540e\uff0c\u5176\u5b57\u7b26\u96c6\u8bbe\u7f6e\u624d\u4f1a\u751f\u6548\uff0c\u5426\u5219\u4ecd\u4f1a\u5bfc\u81f4\u4e71\u7801\u3002","title":"1. \u793a\u4f8b"},{"location":"servlet/3.\u793a\u4f8b/#11-servlet","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cServlet \u5e94\u7528\u7a0b\u5e8f\u4f4d\u4e8e\u8def\u5f84 /webapps/ROOT \u4e0b\uff0c\u4e14\u7c7b\u6587\u4ef6\u653e\u5728 /webapps/ROOT/WEB-INF/classes \u4e2d\u3002 \u5982\u679c\u60a8\u6709\u4e00\u4e2a\u5b8c\u5168\u5408\u683c\u7684\u7c7b\u540d\u79f0 com.myorg.MyServlet \uff0c\u90a3\u4e48\u8fd9\u4e2a Servlet \u7c7b\u5fc5\u987b\u4f4d\u4e8e WEB-INF/classes/com/myorg/MyServlet.class \u4e2d\u3002 URL\u7684\u6620\u5c04\u914d\u7f6e\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 @WebServlet(/user) \u6ce8\u89e3\uff0c\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u5df2\u4f7f\u7528\uff1b\u4e00\u79cd\u662f\u914d\u7f6e web.xml \uff1a <web-app> <servlet> <servlet-name> User </servlet-name> <servlet-class> servlets.User </servlet-class> </servlet> <servlet-mapping> <servlet-name> User </servlet-name> <url-pattern> /user </url-pattern> </servlet-mapping> </web-app> \u6ce8\u610f \uff1a\u8fd9\u4e24\u79cd\u65b9\u5f0f\u4e0d\u80fd\u91cd\u590d\u914d\u7f6e\uff0c\u5373\u914d\u7f6e\u4e86\u4e24\u79cd\u65b9\u5f0f\u6307\u5411\u4e86\u540c\u4e00\u4e2aURL\uff0c\u8fd9\u6837\u505a\u4f1a\u5bfc\u81f4Tomcat\u542f\u52a8\u5931\u8d25\u3002 \u81f3\u6b64\u90e8\u7f72\u5b8c\u6210\uff0c\u542f\u52a8Tomcat\uff1a \\bin\\startup.bat\uff08\u5728 Windows \u4e0a\uff09\u6216 /bin/startup.sh\uff08\u5728 Linux/Solaris \u7b49\u4e0a\uff09\u3002 \u8bbf\u95ee\uff1a http://localhost:8080/user","title":"1.1 Servlet \u90e8\u7f72"},{"location":"servlet/4.\u8fc7\u6ee4\u5668/","text":"Servlet \u8fc7\u6ee4\u5668\u662f\u53ef\u7528\u4e8e Servlet \u7f16\u7a0b\u7684 Java \u7c7b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u76ee\u7684\uff1a \u5728\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8bbf\u95ee\u540e\u7aef\u8d44\u6e90\u4e4b\u524d\uff0c\u62e6\u622a\u8fd9\u4e9b\u8bf7\u6c42\u3002 \u5728\u670d\u52a1\u5668\u7684\u54cd\u5e94\u53d1\u9001\u56de\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u5904\u7406\u8fd9\u4e9b\u54cd\u5e94\u3002 \u6839\u636e\u89c4\u8303\u5efa\u8bae\u7684\u5404\u79cd\u7c7b\u578b\u7684\u8fc7\u6ee4\u5668\uff1a \u8eab\u4efd\u9a8c\u8bc1\u8fc7\u6ee4\u5668\uff08Authentication Filters\uff09\u3002 \u6570\u636e\u538b\u7f29\u8fc7\u6ee4\u5668\uff08Data compression Filters\uff09\u3002 \u52a0\u5bc6\u8fc7\u6ee4\u5668\uff08Encryption Filters\uff09\u3002 \u89e6\u53d1\u8d44\u6e90\u8bbf\u95ee\u4e8b\u4ef6\u8fc7\u6ee4\u5668\u3002 \u56fe\u50cf\u8f6c\u6362\u8fc7\u6ee4\u5668\uff08Image Conversion Filters\uff09\u3002 \u65e5\u5fd7\u8bb0\u5f55\u548c\u5ba1\u6838\u8fc7\u6ee4\u5668\uff08Logging and Auditing Filters\uff09\u3002 MIME-TYPE \u94fe\u8fc7\u6ee4\u5668\uff08MIME-TYPE Chain Filters\uff09\u3002 \u6807\u8bb0\u5316\u8fc7\u6ee4\u5668\uff08Tokenizing Filters\uff09\u3002 XSL/T \u8fc7\u6ee4\u5668\uff08XSL/T Filters\uff09\uff0c\u8f6c\u6362 XML \u5185\u5bb9\u3002 Filter\u7684\u6267\u884c\u987a\u5e8f\u4e0e\u5728web.xml\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u987a\u5e8f\u4e00\u81f4\uff0c\u4e00\u822c\u628aFilter\u914d\u7f6e\u5728\u6240\u6709\u7684Servlet\u4e4b\u524d\u3002 1. Servlet \u8fc7\u6ee4\u5668\u65b9\u6cd5 \u00b6 \u8fc7\u6ee4\u5668\u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 javax.servlet.Filter \u63a5\u53e3\u7684 Java \u7c7b\u3002javax.servlet.Filter \u63a5\u53e3\u5b9a\u4e49\u4e86\u4e09\u4e2a\u65b9\u6cd5\uff1a 1 public void doFilter (ServletRequest, ServletResponse, FilterChain) \u8be5\u65b9\u6cd5\u5b8c\u6210\u5b9e\u9645\u7684\u8fc7\u6ee4\u64cd\u4f5c\uff0c\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u65b9\u6cd5\u4e0e\u8fc7\u6ee4\u5668\u8bbe\u7f6e\u5339\u914d\u7684URL\u65f6\uff0cServlet\u5bb9\u5668\u5c06\u5148\u8c03\u7528\u8fc7\u6ee4\u5668\u7684doFilter\u65b9\u6cd5\u3002FilterChain\u7528\u6237\u8bbf\u95ee\u540e\u7eed\u8fc7\u6ee4\u5668\u3002 2 public void init(FilterConfig filterConfig) web \u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0cweb \u670d\u52a1\u5668\u5c06\u521b\u5efaFilter \u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u5176init\u65b9\u6cd5\uff0c\u8bfb\u53d6web.xml\u914d\u7f6e\uff0c\u5b8c\u6210\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u529f\u80fd\uff0c\u4ece\u800c\u4e3a\u540e\u7eed\u7684\u7528\u6237\u8bf7\u6c42\u4f5c\u597d\u62e6\u622a\u7684\u51c6\u5907\u5de5\u4f5c\uff08filter\u5bf9\u8c61\u53ea\u4f1a\u521b\u5efa\u4e00\u6b21\uff0cinit\u65b9\u6cd5\u4e5f\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff09\u3002\u5f00\u53d1\u4eba\u5458\u901a\u8fc7init\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u53ef\u83b7\u5f97\u4ee3\u8868\u5f53\u524dfilter\u914d\u7f6e\u4fe1\u606f\u7684FilterConfig\u5bf9\u8c61\u3002 3 public void destroy() Servlet\u5bb9\u5668\u5728\u9500\u6bc1\u8fc7\u6ee4\u5668\u5b9e\u4f8b\u524d\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u91ca\u653eServlet\u8fc7\u6ee4\u5668\u5360\u7528\u7684\u8d44\u6e90\u3002 2. \u914d\u7f6e\u8fc7\u6ee4\u5668 \u00b6 web.xml \u4e2d\u7684 filter-mapping \u5143\u7d20\u7684\u987a\u5e8f\u51b3\u5b9a\u4e86 Web \u5bb9\u5668\u5e94\u7528\u8fc7\u6ee4\u5668\u5230 Servlet \u7684\u987a\u5e8f\u3002 package filter ; import javax.servlet.* ; import java.io.IOException ; public class CharacterFilter implements Filter { private static String character ; @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { servletRequest . setCharacterEncoding ( character ); servletResponse . setCharacterEncoding ( character ); filterChain . doFilter ( servletRequest , servletResponse ); } @Override public void init ( FilterConfig filterConfig ) throws ServletException { character = filterConfig . getInitParameter ( \"character\" ); } @Override public void destroy () { } } web.xml\uff1a <!--\u8fc7\u6ee4\u5668--> <filter> <filter-name> characterFilter </filter-name> <filter-class> filter.CharacterFilter </filter-class> <init-param> <param-name> character </param-name> <param-value> UTF-8 </param-value> </init-param> </filter> <filter-mapping> <filter-name> characterFilter </filter-name> <url-pattern> /* </url-pattern> </filter-mapping> <filter-mapping> \u5143\u7d20\u7528\u4e8e\u8bbe\u7f6e\u4e00\u4e2a Filter \u6240\u8d1f\u8d23\u62e6\u622a\u7684\u8d44\u6e90\u3002\u4e00\u4e2aFilter\u62e6\u622a\u7684\u8d44\u6e90\u53ef\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u6307\u5b9a\uff1aServlet \u540d\u79f0\uff08 \uff09\u548c\u8d44\u6e90\u8bbf\u95ee\u7684\u8bf7\u6c42\u8def\u5f84\uff08 \uff09\u3002 \u5176\u8fd8\u6709\u4e00\u4e2a\u5b50\u6807\u7b7e <dispatcher> \u8868\u793a\u62e6\u622a\u4ec0\u4e48\u6837\u7684 Servlet \u5bb9\u5668\u8c03\u7528\uff0c\u53ef\u4ee5\u53d6\u4ee5\u4e0b\u56db\u79cd\u503c\uff1a REQUEST \uff1a\u5f53\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\u9875\u9762\u65f6\uff0cWeb\u5bb9\u5668\u5c06\u4f1a\u8c03\u7528\u8fc7\u6ee4\u5668\u3002\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684include()\u6216forward()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c31\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 INCLUDE \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684include()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8be5\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 FORWARD \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684forward()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8be5\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 ERROR \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7\u58f0\u660e\u5f0f\u5f02\u5e38\u5904\u7406\u673a\u5236\u8c03\u7528\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002","title":"4.\u8fc7\u6ee4\u5668"},{"location":"servlet/4.\u8fc7\u6ee4\u5668/#1-servlet","text":"\u8fc7\u6ee4\u5668\u662f\u4e00\u4e2a\u5b9e\u73b0\u4e86 javax.servlet.Filter \u63a5\u53e3\u7684 Java \u7c7b\u3002javax.servlet.Filter \u63a5\u53e3\u5b9a\u4e49\u4e86\u4e09\u4e2a\u65b9\u6cd5\uff1a 1 public void doFilter (ServletRequest, ServletResponse, FilterChain) \u8be5\u65b9\u6cd5\u5b8c\u6210\u5b9e\u9645\u7684\u8fc7\u6ee4\u64cd\u4f5c\uff0c\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u65b9\u6cd5\u4e0e\u8fc7\u6ee4\u5668\u8bbe\u7f6e\u5339\u914d\u7684URL\u65f6\uff0cServlet\u5bb9\u5668\u5c06\u5148\u8c03\u7528\u8fc7\u6ee4\u5668\u7684doFilter\u65b9\u6cd5\u3002FilterChain\u7528\u6237\u8bbf\u95ee\u540e\u7eed\u8fc7\u6ee4\u5668\u3002 2 public void init(FilterConfig filterConfig) web \u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0cweb \u670d\u52a1\u5668\u5c06\u521b\u5efaFilter \u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u5176init\u65b9\u6cd5\uff0c\u8bfb\u53d6web.xml\u914d\u7f6e\uff0c\u5b8c\u6210\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u529f\u80fd\uff0c\u4ece\u800c\u4e3a\u540e\u7eed\u7684\u7528\u6237\u8bf7\u6c42\u4f5c\u597d\u62e6\u622a\u7684\u51c6\u5907\u5de5\u4f5c\uff08filter\u5bf9\u8c61\u53ea\u4f1a\u521b\u5efa\u4e00\u6b21\uff0cinit\u65b9\u6cd5\u4e5f\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\uff09\u3002\u5f00\u53d1\u4eba\u5458\u901a\u8fc7init\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u53ef\u83b7\u5f97\u4ee3\u8868\u5f53\u524dfilter\u914d\u7f6e\u4fe1\u606f\u7684FilterConfig\u5bf9\u8c61\u3002 3 public void destroy() Servlet\u5bb9\u5668\u5728\u9500\u6bc1\u8fc7\u6ee4\u5668\u5b9e\u4f8b\u524d\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u91ca\u653eServlet\u8fc7\u6ee4\u5668\u5360\u7528\u7684\u8d44\u6e90\u3002","title":"1. Servlet \u8fc7\u6ee4\u5668\u65b9\u6cd5"},{"location":"servlet/4.\u8fc7\u6ee4\u5668/#2","text":"web.xml \u4e2d\u7684 filter-mapping \u5143\u7d20\u7684\u987a\u5e8f\u51b3\u5b9a\u4e86 Web \u5bb9\u5668\u5e94\u7528\u8fc7\u6ee4\u5668\u5230 Servlet \u7684\u987a\u5e8f\u3002 package filter ; import javax.servlet.* ; import java.io.IOException ; public class CharacterFilter implements Filter { private static String character ; @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { servletRequest . setCharacterEncoding ( character ); servletResponse . setCharacterEncoding ( character ); filterChain . doFilter ( servletRequest , servletResponse ); } @Override public void init ( FilterConfig filterConfig ) throws ServletException { character = filterConfig . getInitParameter ( \"character\" ); } @Override public void destroy () { } } web.xml\uff1a <!--\u8fc7\u6ee4\u5668--> <filter> <filter-name> characterFilter </filter-name> <filter-class> filter.CharacterFilter </filter-class> <init-param> <param-name> character </param-name> <param-value> UTF-8 </param-value> </init-param> </filter> <filter-mapping> <filter-name> characterFilter </filter-name> <url-pattern> /* </url-pattern> </filter-mapping> <filter-mapping> \u5143\u7d20\u7528\u4e8e\u8bbe\u7f6e\u4e00\u4e2a Filter \u6240\u8d1f\u8d23\u62e6\u622a\u7684\u8d44\u6e90\u3002\u4e00\u4e2aFilter\u62e6\u622a\u7684\u8d44\u6e90\u53ef\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u6307\u5b9a\uff1aServlet \u540d\u79f0\uff08 \uff09\u548c\u8d44\u6e90\u8bbf\u95ee\u7684\u8bf7\u6c42\u8def\u5f84\uff08 \uff09\u3002 \u5176\u8fd8\u6709\u4e00\u4e2a\u5b50\u6807\u7b7e <dispatcher> \u8868\u793a\u62e6\u622a\u4ec0\u4e48\u6837\u7684 Servlet \u5bb9\u5668\u8c03\u7528\uff0c\u53ef\u4ee5\u53d6\u4ee5\u4e0b\u56db\u79cd\u503c\uff1a REQUEST \uff1a\u5f53\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\u9875\u9762\u65f6\uff0cWeb\u5bb9\u5668\u5c06\u4f1a\u8c03\u7528\u8fc7\u6ee4\u5668\u3002\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684include()\u6216forward()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c31\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 INCLUDE \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684include()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8be5\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 FORWARD \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7RequestDispatcher\u7684forward()\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8be5\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002 ERROR \uff1a\u5982\u679c\u76ee\u6807\u8d44\u6e90\u662f\u901a\u8fc7\u58f0\u660e\u5f0f\u5f02\u5e38\u5904\u7406\u673a\u5236\u8c03\u7528\u65f6\uff0c\u90a3\u4e48\u8be5\u8fc7\u6ee4\u5668\u5c06\u88ab\u8c03\u7528\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fc7\u6ee4\u5668\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002","title":"2. \u914d\u7f6e\u8fc7\u6ee4\u5668"},{"location":"servlet/5.\u5f02\u5e38\u5904\u7406/","text":"\u5728 web.xml \u4e2d\u4f7f\u7528 error-page \u5143\u7d20\u6765\u6307\u5b9a\u5bf9\u7279\u5b9a \u5f02\u5e38 \u6216 HTTP \u72b6\u6001\u7801 \u4f5c\u51fa\u76f8\u5e94\u7684 Servlet \u8c03\u7528\u3002 \u4f8b\uff1a <!--\u5bf9IE\u65e0\u6548--> <error-page> <error-code> 404 </error-code> <location> /NotFound </location> </error-page> <!--\u6355\u83b7\u629b\u51fa\u7684\u6240\u6709\u5f02\u5e38--> <error-page> <exception-type> java.lang.Throwable </exception-type> <location> /Error </location> </error-page> @WebServlet ( \"/NotFound\" ) public class NotFoundHandler extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { resp . getWriter (). write ( \"\u4e0d\u80fd\u627e\u5230\u6240\u9700\u8d44\u6e90\uff01\" ); } @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { doGet ( req , resp ); } } \u5f53\u9875\u9762\u53d1\u9001404\u9519\u8bef\u65f6\uff0c\u4f1a\u7531 servlet NotFoundHandler\u6765\u5904\u7406\u3002 \u5bf9IE\u65e0\u6548 \uff1aIE\u53ea\u80fd\u663e\u793a\u81ea\u5df1\u7684\u9519\u8bef\u9875\u9762\uff0c\u4e0d\u4f1a\u663e\u793a\u81ea\u5b9a\u4e49\u7684\u8fd4\u56de\u5185\u5bb9\u3002","title":"5.\u5f02\u5e38\u5904\u7406"},{"location":"servlet/6.Cookie/","text":"Cookie \u662f\u5b58\u50a8\u5728\u5ba2\u6237\u7aef\u8ba1\u7b97\u673a\u4e0a\u7684\u6587\u672c\u6587\u4ef6\uff0c\u5e76\u4fdd\u7559\u4e86\u5404\u79cd\u8ddf\u8e2a\u4fe1\u606f\u3002 \u5982\u679c\u6d4f\u89c8\u5668\u88ab\u914d\u7f6e\u4e3a\u5b58\u50a8 Cookie\uff0c\u5b83\u5c06\u4f1a\u4fdd\u7559\u6b64\u4fe1\u606f\u76f4\u5230\u5230\u671f\u65e5\u671f\u3002\u5982\u679c\u7528\u6237\u7684\u6d4f\u89c8\u5668\u6307\u5411\u4efb\u4f55\u5339\u914d\u8be5 Cookie \u7684\u8def\u5f84\u548c\u57df\u7684\u9875\u9762\uff0c\u5b83\u4f1a\u91cd\u65b0\u53d1\u9001 Cookie \u5230\u670d\u52a1\u5668\u3002 \u53ef\u5728servlet\u4e2d\u6dfb\u52a0\u3001\u8bfb\u53d6\u3001\u5220\u9664cookie\u3002 Servlet Cookie \u5904\u7406\u9700\u8981\u5bf9\u4e2d\u6587\u8fdb\u884c\u7f16\u7801\u4e0e\u89e3\u7801\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a String str = java . net . URLEncoder . encode ( \"\u4e2d\u6587\" \uff0c \"UTF-8\" ); //\u7f16\u7801 String str = java . net . URLDecoder . decode ( \"\u7f16\u7801\u540e\u7684\u5b57\u7b26\u4e32\" , \"UTF-8\" ); // \u89e3\u7801 1. \u901a\u8fc7 Servlet \u6dfb\u52a0 Cookie \u00b6 @WebServlet ( \"/HelloForm\" ) public class HelloForm extends HttpServlet { @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { PrintWriter out = resp . getWriter (); resp . setContentType ( \"text/html\" ); String name = req . getParameter ( \"name\" ); String url = req . getParameter ( \"url\" ); Cookie nameCookie = new Cookie ( \"name\" , URLEncoder . encode ( name , \"UTF-8\" )); //\u4e2d\u6587\u9700\u8981\u8f6c\u7801\u5b58\u50a8 Cookie urlCookie = new Cookie ( \"url\" , url ); nameCookie . setMaxAge ( 60 ); nameCookie . setComment ( \"storaged name\" ); urlCookie . setMaxAge ( 60 ); urlCookie . setComment ( \"storaged url\" ); resp . addCookie ( nameCookie ); resp . addCookie ( urlCookie ); //\u91cd\u5b9a\u5411 resp . sendRedirect ( \"/ReadCookie\" ); // throw new ServletException(); } } 2. \u901a\u8fc7 Servlet \u8bfb\u53d6Cookie \u00b6 @WebServlet ( \"/ReadCookie\" ) public class ReadCookie extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { PrintWriter out = resp . getWriter (); resp . setContentType ( \"text/html\" ); Cookie [] cookies = req . getCookies (); out . write ( \"<ul>\\n\" ); for ( Cookie cookie : cookies ){ //\u8bfb\u53d6\u7f16\u7801\u7684cookie\u9700\u8981\u89e3\u7801 out . write ( cookie . getName () + \":<li>\" + URLDecoder . decode ( cookie . getValue (), \"UTF-8\" ) + \"</li>\\n\" ); } out . write ( \"</ul>\\n\" ); } } 3. \u901a\u8fc7 Servlet \u5220\u9664 Cookie \u00b6 \u5982\u679c\u60f3\u5220\u9664\u4e00\u4e2a cookie\uff0c\u90a3\u4e48\u60a8\u53ea\u9700\u8981\u6309\u7167\u4ee5\u4e0b\u4e09\u4e2a\u6b65\u9aa4\u8fdb\u884c\uff1a \u8bfb\u53d6\u4e00\u4e2a\u73b0\u6709\u7684 cookie\uff0c\u5e76\u628a\u5b83\u5b58\u50a8\u5728 Cookie \u5bf9\u8c61\u4e2d\u3002 \u4f7f\u7528 setMaxAge() \u65b9\u6cd5\u8bbe\u7f6e cookie \u7684\u5e74\u9f84\u4e3a\u96f6\uff0c\u6765\u5220\u9664\u73b0\u6709\u7684 cookie\u3002 \u628a\u8fd9\u4e2a cookie \u6dfb\u52a0\u5230\u54cd\u5e94\u5934\u3002","title":"6.Cookie"},{"location":"servlet/6.Cookie/#1-servlet-cookie","text":"@WebServlet ( \"/HelloForm\" ) public class HelloForm extends HttpServlet { @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { PrintWriter out = resp . getWriter (); resp . setContentType ( \"text/html\" ); String name = req . getParameter ( \"name\" ); String url = req . getParameter ( \"url\" ); Cookie nameCookie = new Cookie ( \"name\" , URLEncoder . encode ( name , \"UTF-8\" )); //\u4e2d\u6587\u9700\u8981\u8f6c\u7801\u5b58\u50a8 Cookie urlCookie = new Cookie ( \"url\" , url ); nameCookie . setMaxAge ( 60 ); nameCookie . setComment ( \"storaged name\" ); urlCookie . setMaxAge ( 60 ); urlCookie . setComment ( \"storaged url\" ); resp . addCookie ( nameCookie ); resp . addCookie ( urlCookie ); //\u91cd\u5b9a\u5411 resp . sendRedirect ( \"/ReadCookie\" ); // throw new ServletException(); } }","title":"1. \u901a\u8fc7 Servlet \u6dfb\u52a0 Cookie"},{"location":"servlet/6.Cookie/#2-servlet-cookie","text":"@WebServlet ( \"/ReadCookie\" ) public class ReadCookie extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { PrintWriter out = resp . getWriter (); resp . setContentType ( \"text/html\" ); Cookie [] cookies = req . getCookies (); out . write ( \"<ul>\\n\" ); for ( Cookie cookie : cookies ){ //\u8bfb\u53d6\u7f16\u7801\u7684cookie\u9700\u8981\u89e3\u7801 out . write ( cookie . getName () + \":<li>\" + URLDecoder . decode ( cookie . getValue (), \"UTF-8\" ) + \"</li>\\n\" ); } out . write ( \"</ul>\\n\" ); } }","title":"2. \u901a\u8fc7 Servlet \u8bfb\u53d6Cookie"},{"location":"servlet/6.Cookie/#3-servlet-cookie","text":"\u5982\u679c\u60f3\u5220\u9664\u4e00\u4e2a cookie\uff0c\u90a3\u4e48\u60a8\u53ea\u9700\u8981\u6309\u7167\u4ee5\u4e0b\u4e09\u4e2a\u6b65\u9aa4\u8fdb\u884c\uff1a \u8bfb\u53d6\u4e00\u4e2a\u73b0\u6709\u7684 cookie\uff0c\u5e76\u628a\u5b83\u5b58\u50a8\u5728 Cookie \u5bf9\u8c61\u4e2d\u3002 \u4f7f\u7528 setMaxAge() \u65b9\u6cd5\u8bbe\u7f6e cookie \u7684\u5e74\u9f84\u4e3a\u96f6\uff0c\u6765\u5220\u9664\u73b0\u6709\u7684 cookie\u3002 \u628a\u8fd9\u4e2a cookie \u6dfb\u52a0\u5230\u54cd\u5e94\u5934\u3002","title":"3. \u901a\u8fc7 Servlet \u5220\u9664 Cookie"},{"location":"servlet/7.Session \u8ddf\u8e2a/","text":"HTTP \u662f\u4e00\u79cd\"\u65e0\u72b6\u6001\"\u534f\u8bae\uff0c\u8fd9\u610f\u5473\u7740\u6bcf\u6b21\u5ba2\u6237\u7aef\u68c0\u7d22\u7f51\u9875\u65f6\uff0c\u5ba2\u6237\u7aef\u6253\u5f00\u4e00\u4e2a\u5355\u72ec\u7684\u8fde\u63a5\u5230 Web \u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u4e0d\u4fdd\u7559\u4e4b\u524d\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u4efb\u4f55\u8bb0\u5f55\u3002 \u4f46\u662f\u4ecd\u7136\u6709\u4ee5\u4e0b\u56db\u79cd\u65b9\u5f0f\u6765\u7ef4\u6301 Web \u5ba2\u6237\u7aef\u548c Web \u670d\u52a1\u5668\u4e4b\u95f4\u7684 session \u4f1a\u8bdd\uff1a 1. Cookies \u00b6 \u4e00\u4e2a Web \u670d\u52a1\u5668\u53ef\u4ee5\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684 session \u4f1a\u8bdd ID \u4f5c\u4e3a\u6bcf\u4e2a Web \u5ba2\u6237\u7aef\u7684 cookie\uff0c\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7684\u540e\u7eed\u8bf7\u6c42\u53ef\u4ee5\u4f7f\u7528\u63a5\u6536\u5230\u7684 cookie \u6765\u8bc6\u522b\u3002 \u8fd9\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5f88\u591a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 cookie\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u7ef4\u6301 session \u4f1a\u8bdd\u3002 2. \u9690\u85cf\u7684\u8868\u5355\u5b57\u6bb5 \u00b6 \u4e00\u4e2a Web \u670d\u52a1\u5668\u53ef\u4ee5\u53d1\u9001\u4e00\u4e2a\u9690\u85cf\u7684 HTML \u8868\u5355\u5b57\u6bb5\uff0c\u4ee5\u53ca\u4e00\u4e2a\u552f\u4e00\u7684 session \u4f1a\u8bdd ID\uff0c\u5982\u4e0b\u6240\u793a\uff1a < input type = \"hidden\" name = \"sessionid\" value = \"12345\" > 3. URL \u91cd\u5199 \u00b6 \u60a8\u53ef\u4ee5\u5728\u6bcf\u4e2a URL \u672b\u5c3e\u8ffd\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u6570\u636e\u6765\u6807\u8bc6 session \u4f1a\u8bdd\uff0c\u670d\u52a1\u5668\u4f1a\u628a\u8be5 session \u4f1a\u8bdd\u6807\u8bc6\u7b26\u4e0e\u5df2\u5b58\u50a8\u7684\u6709\u5173 session \u4f1a\u8bdd\u7684\u6570\u636e\u76f8\u5173\u8054\u3002 4. HttpSession \u5bf9\u8c61 \u00b6 \u9664\u4e86\u4e0a\u8ff0\u7684\u4e09\u79cd\u65b9\u5f0f\uff0cServlet \u8fd8\u63d0\u4f9b\u4e86 HttpSession \u63a5\u53e3\u3002Servlet \u5bb9\u5668\u4f7f\u7528\u8fd9\u4e2a\u63a5\u53e3\u6765\u521b\u5efa\u4e00\u4e2a HTTP \u5ba2\u6237\u7aef\u548c HTTP \u670d\u52a1\u5668\u4e4b\u95f4\u7684 session \u4f1a\u8bdd\u3002\u4f1a\u8bdd\u6301\u7eed\u4e00\u4e2a\u6307\u5b9a\u7684\u65f6\u95f4\u6bb5\uff0c\u8de8\u591a\u4e2a\u8fde\u63a5\u6216\u9875\u9762\u8bf7\u6c42\u3002 @WebServlet ( \"/SessionTrack\" ) public class SessionTrack extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { //\u6ca1\u6709session\u7684\u8bdd\u5c31\u65b0\u5efa\u4e00\u4e2a HttpSession session = req . getSession ( true ); //\u8bbf\u95ee\u6b21\u6570\u8ba1\u6570\u5668 String count = \"count\" ; int num ; if ( session . isNew ()){ session . setAttribute ( count , 1 ); } else { num = ( int ) session . getAttribute ( count ); num ++; session . setAttribute ( count , num ); } Date createTime = new Date ( session . getCreationTime ()); Date lastTime = new Date ( session . getLastAccessedTime ()); SimpleDateFormat formatter = new SimpleDateFormat ( \"yyyy-MM-dd HH:mm:ss\" ); resp . setContentType ( \"text/html\" ); PrintWriter out = resp . getWriter (); out . write ( \"<ul>\\n\" ); out . write ( \"createTime: <li>\" + formatter . format ( createTime ) + \"</li>\\n\" ); out . write ( \"lastTime: <li>\" + formatter . format ( lastTime ) + \"</li>\\n\" ); out . write ( \"count: <li>\" + session . getAttribute ( \"count\" ) + \"</li>\\n\" ); out . write ( \"</ul>\\n\" ); } } \u6ce8\u610f \uff1a\u4f60\u9700\u8981\u5728\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4efb\u4f55\u6587\u6863\u5185\u5bb9\u4e4b\u524d\u8c03\u7528 request.getSession() 5. \u5220\u9664 Session \u4f1a\u8bdd\u6570\u636e \u00b6 \u5f53\u60a8\u5b8c\u6210\u4e86\u4e00\u4e2a\u7528\u6237\u7684 session \u4f1a\u8bdd\u6570\u636e\uff0c\u60a8\u6709\u4ee5\u4e0b\u51e0\u79cd\u9009\u62e9\uff1a \u79fb\u9664\u4e00\u4e2a\u7279\u5b9a\u7684\u5c5e\u6027\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void removeAttribute(String name) \u65b9\u6cd5\u6765\u5220\u9664\u4e0e\u7279\u5b9a\u7684\u952e\u76f8\u5173\u8054\u7684\u503c\u3002 \u5220\u9664\u6574\u4e2a session \u4f1a\u8bdd\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void invalidate() \u65b9\u6cd5\u6765\u4e22\u5f03\u6574\u4e2a session \u4f1a\u8bdd\u3002 \u8bbe\u7f6e session \u4f1a\u8bdd\u8fc7\u671f\u65f6\u95f4\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void setMaxInactiveInterval(int interval) \u65b9\u6cd5\u6765\u5355\u72ec\u8bbe\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\u3002 \u6ce8\u9500\u7528\u6237\uff1a \u5982\u679c\u4f7f\u7528\u7684\u662f\u652f\u6301 servlet 2.4 \u7684\u670d\u52a1\u5668\uff0c\u60a8\u53ef\u4ee5\u8c03\u7528 logout \u6765\u6ce8\u9500 Web \u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\uff0c\u5e76\u628a\u5c5e\u4e8e\u6240\u6709\u7528\u6237\u7684\u6240\u6709 session \u4f1a\u8bdd\u8bbe\u7f6e\u4e3a\u65e0\u6548\u3002 web.xml \u914d\u7f6e\uff1a \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Tomcat\uff0c\u9664\u4e86\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728 web.xml \u6587\u4ef6\u4e2d\u914d\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <session-config> <session-timeout> 15 </session-timeout> </session-config> \u4e0a\u9762\u5b9e\u4f8b\u4e2d\u7684\u8d85\u65f6\u65f6\u95f4\u662f\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\uff0c\u5c06\u8986\u76d6 Tomcat \u4e2d\u9ed8\u8ba4\u7684 30 \u5206\u949f\u8d85\u65f6\u65f6\u95f4\u3002 \u5728\u4e00\u4e2a Servlet \u4e2d\u7684 getMaxInactiveInterval() \u65b9\u6cd5\u4f1a\u8fd4\u56de session \u4f1a\u8bdd\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5728 web.xml \u4e2d\u914d\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\u4e3a 15 \u5206\u949f\uff0c\u90a3\u4e48 getMaxInactiveInterval() \u4f1a\u8fd4\u56de 900\u3002","title":"7.Session \u8ddf\u8e2a"},{"location":"servlet/7.Session \u8ddf\u8e2a/#1-cookies","text":"\u4e00\u4e2a Web \u670d\u52a1\u5668\u53ef\u4ee5\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684 session \u4f1a\u8bdd ID \u4f5c\u4e3a\u6bcf\u4e2a Web \u5ba2\u6237\u7aef\u7684 cookie\uff0c\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7684\u540e\u7eed\u8bf7\u6c42\u53ef\u4ee5\u4f7f\u7528\u63a5\u6536\u5230\u7684 cookie \u6765\u8bc6\u522b\u3002 \u8fd9\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5f88\u591a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 cookie\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u7ef4\u6301 session \u4f1a\u8bdd\u3002","title":"1. Cookies"},{"location":"servlet/7.Session \u8ddf\u8e2a/#2","text":"\u4e00\u4e2a Web \u670d\u52a1\u5668\u53ef\u4ee5\u53d1\u9001\u4e00\u4e2a\u9690\u85cf\u7684 HTML \u8868\u5355\u5b57\u6bb5\uff0c\u4ee5\u53ca\u4e00\u4e2a\u552f\u4e00\u7684 session \u4f1a\u8bdd ID\uff0c\u5982\u4e0b\u6240\u793a\uff1a < input type = \"hidden\" name = \"sessionid\" value = \"12345\" >","title":"2. \u9690\u85cf\u7684\u8868\u5355\u5b57\u6bb5"},{"location":"servlet/7.Session \u8ddf\u8e2a/#3-url","text":"\u60a8\u53ef\u4ee5\u5728\u6bcf\u4e2a URL \u672b\u5c3e\u8ffd\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u6570\u636e\u6765\u6807\u8bc6 session \u4f1a\u8bdd\uff0c\u670d\u52a1\u5668\u4f1a\u628a\u8be5 session \u4f1a\u8bdd\u6807\u8bc6\u7b26\u4e0e\u5df2\u5b58\u50a8\u7684\u6709\u5173 session \u4f1a\u8bdd\u7684\u6570\u636e\u76f8\u5173\u8054\u3002","title":"3. URL \u91cd\u5199"},{"location":"servlet/7.Session \u8ddf\u8e2a/#4-httpsession","text":"\u9664\u4e86\u4e0a\u8ff0\u7684\u4e09\u79cd\u65b9\u5f0f\uff0cServlet \u8fd8\u63d0\u4f9b\u4e86 HttpSession \u63a5\u53e3\u3002Servlet \u5bb9\u5668\u4f7f\u7528\u8fd9\u4e2a\u63a5\u53e3\u6765\u521b\u5efa\u4e00\u4e2a HTTP \u5ba2\u6237\u7aef\u548c HTTP \u670d\u52a1\u5668\u4e4b\u95f4\u7684 session \u4f1a\u8bdd\u3002\u4f1a\u8bdd\u6301\u7eed\u4e00\u4e2a\u6307\u5b9a\u7684\u65f6\u95f4\u6bb5\uff0c\u8de8\u591a\u4e2a\u8fde\u63a5\u6216\u9875\u9762\u8bf7\u6c42\u3002 @WebServlet ( \"/SessionTrack\" ) public class SessionTrack extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { //\u6ca1\u6709session\u7684\u8bdd\u5c31\u65b0\u5efa\u4e00\u4e2a HttpSession session = req . getSession ( true ); //\u8bbf\u95ee\u6b21\u6570\u8ba1\u6570\u5668 String count = \"count\" ; int num ; if ( session . isNew ()){ session . setAttribute ( count , 1 ); } else { num = ( int ) session . getAttribute ( count ); num ++; session . setAttribute ( count , num ); } Date createTime = new Date ( session . getCreationTime ()); Date lastTime = new Date ( session . getLastAccessedTime ()); SimpleDateFormat formatter = new SimpleDateFormat ( \"yyyy-MM-dd HH:mm:ss\" ); resp . setContentType ( \"text/html\" ); PrintWriter out = resp . getWriter (); out . write ( \"<ul>\\n\" ); out . write ( \"createTime: <li>\" + formatter . format ( createTime ) + \"</li>\\n\" ); out . write ( \"lastTime: <li>\" + formatter . format ( lastTime ) + \"</li>\\n\" ); out . write ( \"count: <li>\" + session . getAttribute ( \"count\" ) + \"</li>\\n\" ); out . write ( \"</ul>\\n\" ); } } \u6ce8\u610f \uff1a\u4f60\u9700\u8981\u5728\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4efb\u4f55\u6587\u6863\u5185\u5bb9\u4e4b\u524d\u8c03\u7528 request.getSession()","title":"4. HttpSession \u5bf9\u8c61"},{"location":"servlet/7.Session \u8ddf\u8e2a/#5-session","text":"\u5f53\u60a8\u5b8c\u6210\u4e86\u4e00\u4e2a\u7528\u6237\u7684 session \u4f1a\u8bdd\u6570\u636e\uff0c\u60a8\u6709\u4ee5\u4e0b\u51e0\u79cd\u9009\u62e9\uff1a \u79fb\u9664\u4e00\u4e2a\u7279\u5b9a\u7684\u5c5e\u6027\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void removeAttribute(String name) \u65b9\u6cd5\u6765\u5220\u9664\u4e0e\u7279\u5b9a\u7684\u952e\u76f8\u5173\u8054\u7684\u503c\u3002 \u5220\u9664\u6574\u4e2a session \u4f1a\u8bdd\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void invalidate() \u65b9\u6cd5\u6765\u4e22\u5f03\u6574\u4e2a session \u4f1a\u8bdd\u3002 \u8bbe\u7f6e session \u4f1a\u8bdd\u8fc7\u671f\u65f6\u95f4\uff1a \u60a8\u53ef\u4ee5\u8c03\u7528 public void setMaxInactiveInterval(int interval) \u65b9\u6cd5\u6765\u5355\u72ec\u8bbe\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\u3002 \u6ce8\u9500\u7528\u6237\uff1a \u5982\u679c\u4f7f\u7528\u7684\u662f\u652f\u6301 servlet 2.4 \u7684\u670d\u52a1\u5668\uff0c\u60a8\u53ef\u4ee5\u8c03\u7528 logout \u6765\u6ce8\u9500 Web \u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\uff0c\u5e76\u628a\u5c5e\u4e8e\u6240\u6709\u7528\u6237\u7684\u6240\u6709 session \u4f1a\u8bdd\u8bbe\u7f6e\u4e3a\u65e0\u6548\u3002 web.xml \u914d\u7f6e\uff1a \u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f Tomcat\uff0c\u9664\u4e86\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728 web.xml \u6587\u4ef6\u4e2d\u914d\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\uff0c\u5982\u4e0b\u6240\u793a\uff1a <session-config> <session-timeout> 15 </session-timeout> </session-config> \u4e0a\u9762\u5b9e\u4f8b\u4e2d\u7684\u8d85\u65f6\u65f6\u95f4\u662f\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\uff0c\u5c06\u8986\u76d6 Tomcat \u4e2d\u9ed8\u8ba4\u7684 30 \u5206\u949f\u8d85\u65f6\u65f6\u95f4\u3002 \u5728\u4e00\u4e2a Servlet \u4e2d\u7684 getMaxInactiveInterval() \u65b9\u6cd5\u4f1a\u8fd4\u56de session \u4f1a\u8bdd\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u6240\u4ee5\uff0c\u5982\u679c\u5728 web.xml \u4e2d\u914d\u7f6e session \u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\u4e3a 15 \u5206\u949f\uff0c\u90a3\u4e48 getMaxInactiveInterval() \u4f1a\u8fd4\u56de 900\u3002","title":"5. \u5220\u9664 Session \u4f1a\u8bdd\u6570\u636e"},{"location":"servlet/8.1\u6587\u4ef6\u4e0b\u8f7d/","text":"\u53c2\u8003 \u535a\u5ba2 \u524d\u53f0\u6784\u9020\u8d85\u94fe\u63a5\uff1a < a href = \"http://localhost:9898/blog/blog/Download?fileName=xxx.docx\" > download </ a > \u540e\u53f0\u5904\u7406\u903b\u8f91\uff1a\u5c06\u6587\u4ef6\u5199\u5230response\u7684\u8f93\u51fa\u6d41 @WebServlet ( \"/Download\" ) public class Download extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { String fileName = req . getParameter ( \"fileName\" ); ServletContext servletContext = req . getServletContext (); resp . setContentType ( servletContext . getMimeType ( fileName )); resp . setHeader ( \"Content-Disposition\" , \"attachment;filename=\" + fileName ); // String dir = servletContext.getRealPath(\"/WEB-INF/classes/files\"); String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; System . out . println ( \"download file: \" + fullFileNmame ); FileInputStream fi = new FileInputStream ( fullFileNmame ); ServletOutputStream so = resp . getOutputStream (); int len ; byte [] buffer = new byte [ 4096 ]; //4k while (( len = fi . read ( buffer )) != - 1 ){ so . write ( buffer , 0 , len ); } so . flush (); fi . close (); so . close (); } @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { doGet ( req , resp ); } } \u6216 @WebServlet ( \"/Download\" ) public class Download extends HttpServlet { @Override protected void doGet ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { String fileName = req . getParameter ( \"fileName\" ); ServletContext servletContext = req . getServletContext (); resp . setContentType ( servletContext . getMimeType ( fileName )); resp . setHeader ( \"Content-Disposition\" , \"attachment;filename=\" + new String ( fileName . getBytes ( \"utf-8\" ), \"ISO8859-1\" )); // String dir = servletContext.getRealPath(\"/WEB-INF/classes/files\"); String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; System . out . println ( \"download file: \" + fullFileNmame ); try ( FileInputStream fi = new FileInputStream ( fullFileNmame ); BufferedInputStream bi = new BufferedInputStream ( fi ); //\u81ea\u5e26\u7f13\u51b2\u533a ServletOutputStream so = resp . getOutputStream ()){ int len ; while (( len = bi . read ()) != - 1 ){ so . write ( len ); } so . flush (); } } } IE\u56e0\u4e3a\u7f16\u7801\u95ee\u9898\u89e3\u6790request URL\u5931\u8d25\u3002","title":"8.1\u6587\u4ef6\u4e0b\u8f7d"},{"location":"servlet/8.\u6587\u4ef6\u4e0a\u4f20/","text":"\u9700\u8981\u7684\u5305\uff1a commons-fileupload \uff0c \u4f7f\u7528\u8bf4\u660e \u3002 \u53c2\u8003 \u535a\u5ba2 1. \u521b\u5efa\u6587\u4ef6\u4e0a\u4f20\u8868\u5355 \u00b6 < form action = \"/UploadFile\" method = \"post\" enctype = \"multipart/form-data\" > \u6587\u4ef6\u4e0a\u4f20 < input type = \"file\" name = \"any\" >< br > < button type = \"submit\" > \u4e0a\u4f20 </ button > </ form > \u65b9\u6cd5\u5fc5\u987b\u662f post \uff0c\u4e00\u5b9a\u8981\u6709 enctype=\"multipart/form-data\" \uff0c type=\"file\" \u3002 \u8fd8\u6709\u4e00\u79cd\u65b9\u6cd5\u662f\u6784\u9020\u8868\u5355\uff1a <input type= \"file\" id= \"blog\" placeholder= \"\u9009\u62e9\u6587\u4ef6\" /> <button @ click= \"uploadBlog\" > \u4e0a\u4f20\u535a\u5ba2 </button> uploadBlog: function () { let file = document.getElementById('blog').files[0] let param = new FormData() param.append('any', file) console.log(param.get('any')) this.$axios.post('/api/blog/blog/UploadFile3', param, { headers: { 'Content-Type': 'multipart/form-data' } }) } 2. \u7f16\u5199servlet \u00b6 package servlet ; import exception.ContentTypeException ; import exception.UploadFileException ; import org.apache.commons.fileupload.FileItem ; import org.apache.commons.fileupload.disk.DiskFileItemFactory ; import org.apache.commons.fileupload.servlet.ServletFileUpload ; import javax.servlet.ServletException ; import javax.servlet.annotation.WebServlet ; import javax.servlet.http.HttpServlet ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.File ; import java.io.FileNotFoundException ; import java.io.IOException ; import java.util.List ; @WebServlet ( \"/UploadFile\" ) public class UploadFile extends HttpServlet { private static final String UPLOAD_DIRECTORY = \"D:/logs/uploadFiles\" ; //\u5185\u5b58\u4e34\u754c\u503c - \u8d85\u8fc7\u540e\u5c06\u4ea7\u751f\u4e34\u65f6\u6587\u4ef6\u5e76\u5b58\u50a8\u4e8e\u4e34\u65f6\u76ee\u5f55\u4e2d private static final int MEM_SIZE = 1024 * 1024 * 2 ; //\u6700\u5927\u8bf7\u6587\u4ef6\u5927\u5c0f private static final long MAX_FILE_SIZE = 1024 * 1024 * 40 ; //\u6700\u5927\u8bf7\u6c42\u503c (\u5305\u542b\u6587\u4ef6\u548c\u8868\u5355\u6570\u636e) private static final long MAX_REQUEST_SIZE = 1024 * 1024 * 50 ; @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { //\u662f\u5426\u4e3a\u591a\u5a92\u4f53\u7c7b\u578b if (! ServletFileUpload . isMultipartContent ( req )){ throw new ContentTypeException ( \"\u8bf7\u6c42\u5185\u5bb9\u7c7b\u578b\u9519\u8bef\" ); } // \u914d\u7f6e\u4e0a\u4f20\u53c2\u6570 DiskFileItemFactory dfif = new DiskFileItemFactory (); dfif . setDefaultCharset ( \"UTF-8\" ); dfif . setSizeThreshold ( MEM_SIZE ); //\u4e34\u65f6\u5b58\u50a8\u76ee\u5f55 dfif . setRepository ( new File ( System . getProperty ( \"java.io.tmpdir\" ))); ServletFileUpload sfu = new ServletFileUpload (); sfu . setFileItemFactory ( dfif ); sfu . setFileSizeMax ( MAX_FILE_SIZE ); sfu . setHeaderEncoding ( \"UTF-8\" ); sfu . setSizeMax ( MAX_REQUEST_SIZE ); // \u6784\u9020\u4e34\u65f6\u8def\u5f84\u6765\u5b58\u50a8\u4e0a\u4f20\u7684\u6587\u4ef6 File uploadDir = new File ( UPLOAD_DIRECTORY ); if (! uploadDir . exists ()){ if (! uploadDir . mkdir ()){ throw new FileNotFoundException ( \"\u65e0\u6cd5\u521b\u5efa\u6587\u4ef6\u5939\" ); } } try { //\u8fed\u4ee3\u8868\u5355\u6570\u636e List < FileItem > fileItems = sfu . parseRequest ( req ); //\u5904\u7406\u4e0d\u5728\u8868\u5355\u4e2d\u7684\u5b57\u6bb5\uff0c\u5373\u6587\u4ef6 if ( fileItems != null && fileItems . size () > 0 ){ for ( FileItem fileItem : fileItems ){ if (! fileItem . isFormField ()){ //\u6b63\u5e38\u5316\u6587\u4ef6\u540d String fileName = new File ( fileItem . getName ()). getName (); String filePath = UPLOAD_DIRECTORY + File . separator + fileName ; File storeFile = new File ( filePath ); System . out . println ( filePath ); //\u5199\u6587\u4ef6 fileItem . write ( storeFile ); } } } } catch ( Exception e ){ throw new UploadFileException ( e . getMessage ()); } //\u4e0d\u8bbe\u7f6e\u8fd9\u4e2a\u4f1a\u5bfc\u81f4\u4e71\u7801 resp . setContentType ( \"text/html\" ); String data = \"\u4e0a\u4f20\u6210\u529f\" ; resp . getWriter (). write ( data ); } } 3. \u5df2\u77e5\u7f3a\u9677 \u00b6 \u4e0d\u80fd\u91cd\u590d\u4e0a\u4f20\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002","title":"8.\u6587\u4ef6\u4e0a\u4f20"},{"location":"servlet/8.\u6587\u4ef6\u4e0a\u4f20/#1","text":"< form action = \"/UploadFile\" method = \"post\" enctype = \"multipart/form-data\" > \u6587\u4ef6\u4e0a\u4f20 < input type = \"file\" name = \"any\" >< br > < button type = \"submit\" > \u4e0a\u4f20 </ button > </ form > \u65b9\u6cd5\u5fc5\u987b\u662f post \uff0c\u4e00\u5b9a\u8981\u6709 enctype=\"multipart/form-data\" \uff0c type=\"file\" \u3002 \u8fd8\u6709\u4e00\u79cd\u65b9\u6cd5\u662f\u6784\u9020\u8868\u5355\uff1a <input type= \"file\" id= \"blog\" placeholder= \"\u9009\u62e9\u6587\u4ef6\" /> <button @ click= \"uploadBlog\" > \u4e0a\u4f20\u535a\u5ba2 </button> uploadBlog: function () { let file = document.getElementById('blog').files[0] let param = new FormData() param.append('any', file) console.log(param.get('any')) this.$axios.post('/api/blog/blog/UploadFile3', param, { headers: { 'Content-Type': 'multipart/form-data' } }) }","title":"1. \u521b\u5efa\u6587\u4ef6\u4e0a\u4f20\u8868\u5355"},{"location":"servlet/8.\u6587\u4ef6\u4e0a\u4f20/#2-servlet","text":"package servlet ; import exception.ContentTypeException ; import exception.UploadFileException ; import org.apache.commons.fileupload.FileItem ; import org.apache.commons.fileupload.disk.DiskFileItemFactory ; import org.apache.commons.fileupload.servlet.ServletFileUpload ; import javax.servlet.ServletException ; import javax.servlet.annotation.WebServlet ; import javax.servlet.http.HttpServlet ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.File ; import java.io.FileNotFoundException ; import java.io.IOException ; import java.util.List ; @WebServlet ( \"/UploadFile\" ) public class UploadFile extends HttpServlet { private static final String UPLOAD_DIRECTORY = \"D:/logs/uploadFiles\" ; //\u5185\u5b58\u4e34\u754c\u503c - \u8d85\u8fc7\u540e\u5c06\u4ea7\u751f\u4e34\u65f6\u6587\u4ef6\u5e76\u5b58\u50a8\u4e8e\u4e34\u65f6\u76ee\u5f55\u4e2d private static final int MEM_SIZE = 1024 * 1024 * 2 ; //\u6700\u5927\u8bf7\u6587\u4ef6\u5927\u5c0f private static final long MAX_FILE_SIZE = 1024 * 1024 * 40 ; //\u6700\u5927\u8bf7\u6c42\u503c (\u5305\u542b\u6587\u4ef6\u548c\u8868\u5355\u6570\u636e) private static final long MAX_REQUEST_SIZE = 1024 * 1024 * 50 ; @Override protected void doPost ( HttpServletRequest req , HttpServletResponse resp ) throws ServletException , IOException { //\u662f\u5426\u4e3a\u591a\u5a92\u4f53\u7c7b\u578b if (! ServletFileUpload . isMultipartContent ( req )){ throw new ContentTypeException ( \"\u8bf7\u6c42\u5185\u5bb9\u7c7b\u578b\u9519\u8bef\" ); } // \u914d\u7f6e\u4e0a\u4f20\u53c2\u6570 DiskFileItemFactory dfif = new DiskFileItemFactory (); dfif . setDefaultCharset ( \"UTF-8\" ); dfif . setSizeThreshold ( MEM_SIZE ); //\u4e34\u65f6\u5b58\u50a8\u76ee\u5f55 dfif . setRepository ( new File ( System . getProperty ( \"java.io.tmpdir\" ))); ServletFileUpload sfu = new ServletFileUpload (); sfu . setFileItemFactory ( dfif ); sfu . setFileSizeMax ( MAX_FILE_SIZE ); sfu . setHeaderEncoding ( \"UTF-8\" ); sfu . setSizeMax ( MAX_REQUEST_SIZE ); // \u6784\u9020\u4e34\u65f6\u8def\u5f84\u6765\u5b58\u50a8\u4e0a\u4f20\u7684\u6587\u4ef6 File uploadDir = new File ( UPLOAD_DIRECTORY ); if (! uploadDir . exists ()){ if (! uploadDir . mkdir ()){ throw new FileNotFoundException ( \"\u65e0\u6cd5\u521b\u5efa\u6587\u4ef6\u5939\" ); } } try { //\u8fed\u4ee3\u8868\u5355\u6570\u636e List < FileItem > fileItems = sfu . parseRequest ( req ); //\u5904\u7406\u4e0d\u5728\u8868\u5355\u4e2d\u7684\u5b57\u6bb5\uff0c\u5373\u6587\u4ef6 if ( fileItems != null && fileItems . size () > 0 ){ for ( FileItem fileItem : fileItems ){ if (! fileItem . isFormField ()){ //\u6b63\u5e38\u5316\u6587\u4ef6\u540d String fileName = new File ( fileItem . getName ()). getName (); String filePath = UPLOAD_DIRECTORY + File . separator + fileName ; File storeFile = new File ( filePath ); System . out . println ( filePath ); //\u5199\u6587\u4ef6 fileItem . write ( storeFile ); } } } } catch ( Exception e ){ throw new UploadFileException ( e . getMessage ()); } //\u4e0d\u8bbe\u7f6e\u8fd9\u4e2a\u4f1a\u5bfc\u81f4\u4e71\u7801 resp . setContentType ( \"text/html\" ); String data = \"\u4e0a\u4f20\u6210\u529f\" ; resp . getWriter (). write ( data ); } }","title":"2. \u7f16\u5199servlet"},{"location":"servlet/8.\u6587\u4ef6\u4e0a\u4f20/#3","text":"\u4e0d\u80fd\u91cd\u590d\u4e0a\u4f20\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002","title":"3. \u5df2\u77e5\u7f3a\u9677"},{"location":"servlet/9.\u91cd\u5b9a\u5411/","text":"\u65b9\u5f0f\u4e00\uff1a response . sendRedirect ( \"/ReadCookie\" ); \u65b9\u5f0f\u4e8c\uff1a response . setStatus ( 200 ); response . setHeader ( \"Location\" , \"http://localhost:9797/ReadCookie\" );","title":"9.\u91cd\u5b9a\u5411"},{"location":"shell/shell\u811a\u672c\u81ea\u52a8\u8f93\u5165/","text":"shell\u81ea\u52a8\u5316\u8f93\u5165\u7684\u4e09\u79cd\u65b9\u5f0f\uff1a \u91cd\u5b9a\u5411 \u7ba1\u9053 expect \u524d\u4e24\u79cd\u7684\u524d\u63d0\u662f\u6307\u4ee4\u9700\u8981\u6709\u53c2\u6570\u6765\u6307\u5b9a\u5bc6\u7801\u8f93\u5165\u65b9\u5f0f\uff0c\u5177\u4f53\u4f7f\u7528\u53ef\u53c2\u8003\u535a\u5ba2\uff1a https://blog.csdn.net/zhangjikuan/article/details/51105166 \u4e0b\u9762\u8bb2\u4e00\u4e0bexpect\u65b9\u5f0f\u7684\u4f7f\u7528 \u5f53\u4e0d\u60f3\u8981\u624b\u52a8\u8f93\u5165\u65f6\uff08\u5982\uff1a\u5bc6\u7801\uff09\uff0c\u53ef\u4f7f\u7528 expect \u6765\u5b9e\u73b0\u811a\u672c\u81ea\u52a8\u8f93\u5165\u3002 \u5b89\u88c5 yum install expect -y \u5728shell\u811a\u672c\u5185\u4f7f\u7528 if [[ \"x ${ use_v2v_local_cmd } \" == \"xtrue\" ]] ; then display \" ${ v2v_local_cmd } \" if [[ \"x ${ password_file } \" ! = \"x\" && \"x ${ mode } \" == \"xESXi\" ]] ; then passwd = ` cat ${ password_file } ` expect <<-EOF set timeout -1 spawn ${v2v_local_cmd} expect { \"*password*\" { send \"${passwd}\\r\" exp_continue } \"*error*\" { exit 1 } } EOF else eval ${ v2v_local_cmd } fi fi \u8fd9\u79cd\u65b9\u5f0f\u867d\u597d\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u53d1\u73b0\u4e86\u4e00\u4e2a \u9650\u5236 \uff1a \u200b \u4f20\u5165\u7684\u547d\u4ee4 \u4e0d\u80fd\u5e26\u6709\u5f15\u53f7 \uff0c\u5426\u5219\u6267\u884c\u5931\u8d25\u3002\u6bd4\u5982\uff1a spawn virsh -c 'esx://root@172.16.2.179?no_verify=1' list --all \uff0c\u4f1a\u62a5\u9519\uff1a no such file or directory \u3002\u5b9e\u9645\u5de5\u4f5c\u4e2d\u514d\u4e0d\u4e86\u8981\u5c06\u4e00\u4e9b\u5e26\u6709\u7279\u6b8a\u5b57\u7b26\u7684\u53c2\u6570\u7528\u5f15\u53f7\u5305\u8d77\u6765\uff0c\u8fd9\u65f6\u53ef\u4ee5\u7ed5\u4e00\u4e0b\uff0c\u5c06\u547d\u4ee4\u5199\u5230\u6587\u4ef6\u4e2d\u518d\u6267\u884c\uff1a expect\u6267\u884c\u811a\u672c\uff1a pass.sh #!/bin/expect set command [ lindex $argv 0 ] set passwd [ lindex $argv 1 ] spawn ${ command } expect { \"*password*\" { send \" ${ passwd } \\r\" exp_continue } \"*error*\" { exit 1 } eof { exit } } \u5b58\u50a8\u547d\u4ee4\u7684\u53ef\u6267\u884c\u811a\u672c\uff1a commond.sh #!/bin/bash virsh -c 'esx://root@172.16.2.179?no_verify=1' list --all \u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\uff1a ./pass.sh ./commond.sh ABCDabcd.1234 \u6b64\u65f6\u5c31\u8fbe\u5230\u4e86\u81ea\u52a8\u5316\u8f93\u5165\u7684\u76ee\u7684\u3002 \u8be6\u7ec6\u7684expect\u4f7f\u7528\u53c2\u8003\u535a\u5ba2\uff1ahttps://www.cnblogs.com/lixigang/articles/4849527.html","title":"Shell\u811a\u672c\u81ea\u52a8\u8f93\u5165"},{"location":"shell/\u53d8\u91cf\u7684\u622a\u53d6\u4e0e\u66ff\u6362/","text":"\u8fd9\u4e2a\u7f51\u7ad9\u7684\u603b\u7ed3\u6709\u9519\u8bef\u4e4b\u5904\uff0c\u4e88\u4ee5\u4fee\u6539\uff1a \u683c\u5f0f \u8bf4\u660e ${string: start :length} \u4ece string \u5b57\u7b26\u4e32\u7684\u5de6\u8fb9\u7b2c start \u4e2a\uff08\u4ece0\u5f00\u59cb\u8ba1\u6570\uff09\u5b57\u7b26\u5f00\u59cb\uff0c\u5411\u53f3\u622a\u53d6 length \u4e2a\u5b57\u7b26\u3002 ${string: start} \u4ece string \u5b57\u7b26\u4e32\u7684\u5de6\u8fb9\u7b2c start \u4e2a\u5b57\u7b26\u5f00\u59cb\u622a\u53d6\uff0c\u76f4\u5230\u6700\u540e\u3002 ${string: 0-start :length} \u4ece string \u5b57\u7b26\u4e32\u7684\u53f3\u8fb9\u7b2c start \u4e2a\u5b57\u7b26\u5f00\u59cb\uff0c\u5411\u53f3\u622a\u53d6 length \u4e2a\u5b57\u7b26\u3002 ${string: 0-start} \u4ece string \u5b57\u7b26\u4e32\u7684\u53f3\u8fb9\u7b2c start \u4e2a\u5b57\u7b26\u5f00\u59cb\u622a\u53d6\uff0c\u76f4\u5230\u6700\u540e\u3002 ${string#*chars} \u4ece string \u5b57\u7b26\u4e32\u7b2c\u4e00\u6b21\u51fa\u73b0 chars \u7684\u4f4d\u7f6e\u5f00\u59cb\uff0c\u622a\u53d6 chars \u53f3\u8fb9\u7684\u6240\u6709\u5b57\u7b26\u3002 ${string##*chars} \u4ece string \u5b57\u7b26\u4e32\u6700\u540e\u4e00\u6b21\u51fa\u73b0 chars \u7684\u4f4d\u7f6e\u5f00\u59cb\uff0c\u622a\u53d6 chars \u53f3\u8fb9\u7684\u6240\u6709\u5b57\u7b26\u3002 ${string%chars*} \u4ece string \u5b57\u7b26\u4e32\u6700\u540e\u4e00\u6b21\u51fa\u73b0 chars \u7684\u4f4d\u7f6e\u5f00\u59cb\uff0c\u622a\u53d6 chars \u5de6\u8fb9\u7684\u6240\u6709\u5b57\u7b26\u3002 ${string%%chars*} \u4ece string \u5b57\u7b26\u4e32\u7b2c\u4e00\u6b21\u51fa\u73b0 chars \u7684\u4f4d\u7f6e\u5f00\u59cb\uff0c\u622a\u53d6 chars \u5de6\u8fb9\u7684\u6240\u6709\u5b57\u7b26\u3002 1. \u622a\u53d6 \u00b6 \u7b26\u53f7 \u610f\u4e49 # \u4ece\u5de6\u8fb9\u975e\u8d2a\u5a6a\u5220\u9664\u5339\u914d\u7684\u5b57\u7b26\u4e32 ## \u4ece\u5de6\u8fb9\u8d2a\u5a6a\u5220\u9664\u5339\u914d\u7684\u5b57\u7b26\u4e32 %\u3001%% \u4ece\u53f3\u8fb9\u540c\u4e0a [ shark@linux ~ ] $ str = \"123456.89\" [ shark@linux ~ ] $ echo ${ str : 2 } 3456 .89 [ shark@linux ~ ] $ echo ${ str : 0 : 2 } 12 [ shark@linux ~ ] $ echo ${ str : 2 : 2 } 34 [ shark@linux ~ ] $ echo ${ str : 0 -9 } 123456 .89 [ shark@linux ~ ] $ echo ${ str : 0 -9: 5 } 12345 [ shark@linux ~ ] $ str = 123123 .321321 [ shark@linux ~ ] $ echo ${ str : 0 : 5 } 12312 [ shark@linux ~ ] $ echo ${ str : 0 -0: 5 } 12312 [ sink@dev ~ ] $ echo ${ MAIL } /var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL #*/ } var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL ##*/ } sink [ sink@dev ~ ] $ echo ${ MAIL #/var } /spool/mail/sink # \u53ef\u89c1\u5fc5\u987b\u662f\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5c31\u5f00\u59cb\u5339\u914d [ sink@dev ~ ] $ echo ${ MAIL #/mail } /var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL #/var*/ } spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL ##/var*/ } sink 2. \u66ff\u6362 \u00b6 \u7b26\u53f7 \u610f\u4e49 / \u66ff\u6362\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5b57\u7b26\u4e32 // \u66ff\u6362\u6240\u6709\u5339\u914d\u7684\u5b57\u7b26\u4e32 [ sink@dev ~ ] $ echo ${ PATH /sbin/SBIN/ } /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/SBIN/:/usr/sbin:/home/sink/.local/bin:/home/sink/bin [ sink@dev ~ ] $ echo ${ PATH //sbin/SBIN/ } /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/SBIN/:/usr/SBIN/:/home/sink/.local/bin:/home/sink/bin 3. \u6d4b\u8bd5\u4e0e\u66ff\u6362 \u00b6 \u7b26\u53f7 \u610f\u4e49 \u4e0d\u52a0\u201c\uff1a\u201d \u6d4b\u8bd5\u8be5\u503c\u672a\u8bbe\u7f6e \u52a0\u201c\uff1a\u201d \u6d4b\u8bd5\u8be5\u503c\u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u5b57\u7b26\u4e32 # -\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u6709\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :-\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u8d4b\u503c # +\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u5219\u4e0d \u8fdb\u884c\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var +new_value } [ sink@dev ~ ] $ declare -p new_var old_var declare -- new_var = \"\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u6709\u503c\u7684\u60c5\u51b5\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var +new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var +new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"old_value\" # :+\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c\u5219\u4e0d \u8fdb\u884c\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u672a\u8bbe\u7f6e\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"old_value\" # =\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u5168\u90e8\u8d4b\u65b0\u503c\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u672a\u8bbe\u7f6e\uff0c\u5168\u90e8\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u7a7a\u503c=\u6709\u503c\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c=\u7a7a\u503c\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :=\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u5168\u90e8\u8d4b\u65b0\u503c\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u672a\u8bbe\u7f6e [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u7a7a\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u6709\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # ?\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u5c06\u503c\u8f93\u51fa\u5230 \u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u7a7a\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } -bash: old_var: error_info [ sink@dev ~ ] $ echo $? 1 [ sink@dev ~ ] $ declare -p new_var old_var -bash: declare: new_var: not found -bash: declare: old_var: not found # \u7a7a\u503c=\u6709\u503c\uff0c\u5168\u90e8\u8d4b\u65e7\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u7a7a\u503c=\u6709\u503c\uff0c\u5168\u90e8\u8d4b\u65e7\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :?\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u5c06\u503c\u8f93\u51fa\u5230 \u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c","title":"\u53d8\u91cf\u7684\u622a\u53d6\u4e0e\u66ff\u6362"},{"location":"shell/\u53d8\u91cf\u7684\u622a\u53d6\u4e0e\u66ff\u6362/#1","text":"\u7b26\u53f7 \u610f\u4e49 # \u4ece\u5de6\u8fb9\u975e\u8d2a\u5a6a\u5220\u9664\u5339\u914d\u7684\u5b57\u7b26\u4e32 ## \u4ece\u5de6\u8fb9\u8d2a\u5a6a\u5220\u9664\u5339\u914d\u7684\u5b57\u7b26\u4e32 %\u3001%% \u4ece\u53f3\u8fb9\u540c\u4e0a [ shark@linux ~ ] $ str = \"123456.89\" [ shark@linux ~ ] $ echo ${ str : 2 } 3456 .89 [ shark@linux ~ ] $ echo ${ str : 0 : 2 } 12 [ shark@linux ~ ] $ echo ${ str : 2 : 2 } 34 [ shark@linux ~ ] $ echo ${ str : 0 -9 } 123456 .89 [ shark@linux ~ ] $ echo ${ str : 0 -9: 5 } 12345 [ shark@linux ~ ] $ str = 123123 .321321 [ shark@linux ~ ] $ echo ${ str : 0 : 5 } 12312 [ shark@linux ~ ] $ echo ${ str : 0 -0: 5 } 12312 [ sink@dev ~ ] $ echo ${ MAIL } /var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL #*/ } var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL ##*/ } sink [ sink@dev ~ ] $ echo ${ MAIL #/var } /spool/mail/sink # \u53ef\u89c1\u5fc5\u987b\u662f\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5c31\u5f00\u59cb\u5339\u914d [ sink@dev ~ ] $ echo ${ MAIL #/mail } /var/spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL #/var*/ } spool/mail/sink [ sink@dev ~ ] $ echo ${ MAIL ##/var*/ } sink","title":"1. \u622a\u53d6"},{"location":"shell/\u53d8\u91cf\u7684\u622a\u53d6\u4e0e\u66ff\u6362/#2","text":"\u7b26\u53f7 \u610f\u4e49 / \u66ff\u6362\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u5b57\u7b26\u4e32 // \u66ff\u6362\u6240\u6709\u5339\u914d\u7684\u5b57\u7b26\u4e32 [ sink@dev ~ ] $ echo ${ PATH /sbin/SBIN/ } /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/SBIN/:/usr/sbin:/home/sink/.local/bin:/home/sink/bin [ sink@dev ~ ] $ echo ${ PATH //sbin/SBIN/ } /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/SBIN/:/usr/SBIN/:/home/sink/.local/bin:/home/sink/bin","title":"2. \u66ff\u6362"},{"location":"shell/\u53d8\u91cf\u7684\u622a\u53d6\u4e0e\u66ff\u6362/#3","text":"\u7b26\u53f7 \u610f\u4e49 \u4e0d\u52a0\u201c\uff1a\u201d \u6d4b\u8bd5\u8be5\u503c\u672a\u8bbe\u7f6e \u52a0\u201c\uff1a\u201d \u6d4b\u8bd5\u8be5\u503c\u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u5b57\u7b26\u4e32 # -\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u6709\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var -new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :-\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u8d4b\u503c # +\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u5219\u4e0d \u8fdb\u884c\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var +new_value } [ sink@dev ~ ] $ declare -p new_var old_var declare -- new_var = \"\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u6709\u503c\u7684\u60c5\u51b5\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var +new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var +new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"old_value\" # :+\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c\u5219\u4e0d \u8fdb\u884c\u8d4b\u503c # \u672a\u8bbe\u7f6e\uff0c\u7b49\u540c\u4e8e\u7a7a\u503c\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"\" -bash: declare: old_var: not found # \u7a7a\u503c\uff0c\u7b49\u540c\u4e8e\u672a\u8bbe\u7f6e\u7684\u60c5\u51b5\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c\uff0c\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var :+new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"old_value\" # =\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u5168\u90e8\u8d4b\u65b0\u503c\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u672a\u8bbe\u7f6e\uff0c\u5168\u90e8\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u7a7a\u503c=\u6709\u503c\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u6709\u503c=\u7a7a\u503c\uff0c\u4e0d\u8d4b\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var =new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :=\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u5168\u90e8\u8d4b\u65b0\u503c\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u672a\u8bbe\u7f6e [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u7a7a\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"new_value\" declare -- old_var = \"new_value\" # \u6709\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var :=new_value } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # ?\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e \u5219\u5c06\u503c\u8f93\u51fa\u5230 \u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c # \u7a7a\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } -bash: old_var: error_info [ sink@dev ~ ] $ echo $? 1 [ sink@dev ~ ] $ declare -p new_var old_var -bash: declare: new_var: not found -bash: declare: old_var: not found # \u7a7a\u503c=\u6709\u503c\uff0c\u5168\u90e8\u8d4b\u65e7\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"\" [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } ; declare -p new_var old_var declare -- new_var = \"\" declare -- old_var = \"\" # \u7a7a\u503c=\u6709\u503c\uff0c\u5168\u90e8\u8d4b\u65e7\u503c [ sink@dev ~ ] $ unset old_var ; unset new_var ; old_var = \"old_value\" [ sink@dev ~ ] $ new_var = ${ old_var ?error_info } ; declare -p new_var old_var declare -- new_var = \"old_value\" declare -- old_var = \"old_value\" # :?\uff0c\u82e5\u53d8\u91cf \u672a\u8bbe\u7f6e\u6216\u4e3a\u7a7a\u503c \u5219\u5c06\u503c\u8f93\u51fa\u5230 \u6807\u51c6\u9519\u8bef\u8f93\u51fa\uff1b\u5426\u5219 \u5168\u90e8\u8d4b\u65e7\u503c","title":"3. \u6d4b\u8bd5\u4e0e\u66ff\u6362"},{"location":"shell/\u547d\u4ee4\u884c\u7f16\u5199\u5faa\u73af\u4f53/","text":"\u6709\u65f6\u4e0d\u60f3\u5728\u811a\u672c\u91cc\u9762\u7f16\u5199\u547d\u4ee4\uff0c\u9700\u8981\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u7f16\u5199\u53ef\u5305\u542b\u591a\u6761\u547d\u4ee4\u7684\u8bed\u53e5\uff0c\u53ef\u4ee5\u5c06\u6bcf\u6761\u8bed\u53e5\u7528 ; \u9694\u5f00\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u6548\u679c\u5566\uff01 $ i = 0 $ while true ; do echo $i ; sleep 1 ; i = $( expr $i + 1 ) ; done","title":"\u547d\u4ee4\u884c\u7f16\u5199\u5faa\u73af\u4f53"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/","text":"https://www.ibm.com/developerworks/cn/linux/l-cn-nohup/ \u5982\u679c\u4e0d\u662f\u540e\u53f0\u8fdb\u7a0b\uff0c\u53ef\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u5c06\u8fdb\u7a0b\u53d8\u4e3a\u4f5c\u4e1a\uff1a \u6309\u4e0b Ctrl+Z \u6302\u8d77\u5f53\u524d\u8fdb\u7a0b \u4f7f\u7528 jobs \u67e5\u770b\u4f5c\u4e1aid \u4f7f\u7528 bg %id \u7ee7\u7eed\u8fd0\u884c \u4e0b\u9762\u8fd9\u4e9b\u65b9\u6cd5\u4f7f\u5f97\u5728\u5f53\u524dsession\u65ad\u5f00\u540e\u4e5f\u80fd\u7ee7\u7eed\u6267\u884c\u547d\u4ee4\u3002 1. nohup \u547d\u4ee4 \u00b6 nohup COMMAND [ ARG ] ... If standard input is a terminal, redirect it from /dev/null. If standard output is a terminal, append output to 'nohup.out' if possible, '$HOME/nohup.out' otherwise. If standard error is a terminal, redirect it to standard output. To save output to FILE, use 'nohup COMMAND > FILE'. \u4e0d\u652f\u6301 bash \u5185\u5efa\u7684\u6307\u4ee4\u3002 $ nohup ping baidu.com 2 > & 1 >ping.out & 2. setsid \u547d\u4ee4 \u00b6 setsid [ options ] < program > [ arguments ... ] [ shark@linux ~ ] $ setsid ping baidu.com & # \u53ef\u4ee5\u770b\u5230\u7236id\u662f1 [ shark@linux ~ ] $ ps -ef | grep ping shark 19124 1 0 15 :05 ? 00 :00:00 ping baidu.com 3. (\\ &) \u547d\u4ee4\u6267\u884c\u683c\u5f0f \u00b6 [ shark@linux ~ ] $ ( ping baidu.com & ) # \u4e0esetsid\u539f\u7406\u76f8\u540c [ shark@linux ~ ] $ ps -ef | grep ping shark 19176 1 0 15 :08 pts/0 00 :00:00 ping baidu.com 4. disown \u547d\u4ee4 \u00b6 \u9002\u7528\u4e8e\u7a0b\u5e8f\u5df2\u7ecf\u5728\u6267\u884c\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u64cd\u4f5c\u5bf9\u8c61\u662f\u4f5c\u4e1a\u3002 disown [ - ar ] [ - h ] [ jobspec ...] \u7528 disown -h jobspec \u6765\u4f7f \u67d0\u4e2a\u4f5c\u4e1a \u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u7528 disown -ah \u6765\u4f7f \u6240\u6709\u7684\u4f5c\u4e1a \u90fd\u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u7528 disown -rh \u6765\u4f7f \u6b63\u5728\u8fd0\u884c\u7684\u4f5c\u4e1a \u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u4f7f\u7528\u8fc7 disown \u4e4b\u540e\u5e76\u4e14\u5f53\u524d\u7ec8\u7aef\u9000\u51fa\u540e\uff0c\u4f1a\u5c06\u8fdb\u7a0b\u53d8\u4e3a 1 \u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u4f1a\u5c06\u628a\u76ee\u6807\u4f5c\u4e1a\u4ece\u4f5c\u4e1a\u5217\u8868\u4e2d\u79fb\u9664\uff0c\u5c06\u4e0d\u80fd\u518d\u4f7f\u7528jobs\u6765\u67e5\u770b\u5b83\uff0c\u4f46\u662f\u4f9d\u7136\u80fd\u591f\u7528 ps -ef \u67e5\u627e\u5230\u5b83\u3002 [ shark@linux ~ ] $ ping baidu.com > ping.out & [ 1 ] 19292 [ shark@linux ~ ] $ jobs [ 1 ] + Running ping baidu.com > ping.out & [ shark@linux ~ ] $ ps -ef | grep ping shark 19292 17782 0 15 :26 pts/0 00 :00:00 ping baidu.com [ shark@linux ~ ] $ disown -h %1 # \u6b64\u65f6\u4ecd\u7136\u662f\u4e00\u4e2ajob [ shark@linux ~ ] $ jobs [ 1 ] + Running ping baidu.com > ping.out & # \u7ec8\u7aef\u9000\u51fa\u4e4b\u540e\uff1a [ shark@linux ~ ] $ ps -ef | grep ping shark 19292 1 0 15 :26 ? 00 :00:00 ping baidu.com 5. screen \u547d\u4ee4 \u00b6 \u9002\u7528\u4e8e\u5927\u6279\u91cf\u64cd\u4f5c\u3002\u80fd\u591f\u5728\u4e00\u4e2a\u771f\u5b9e\u7ec8\u7aef\u4e0b\u8fd0\u884c\u591a\u4e2a\u5168\u5c4f\u7684\u4f2a\u7ec8\u7aef\u3002 screen [ - options ] [ cmd [ args ] ] screen - r [[ pid .] tty [. host ]] screen - r sessionowner / [[ pid .] tty [. host ]] \u7528 screen -dmS session_name \u6765\u5efa\u7acb\u4e00\u4e2a\u5904\u4e8e\u65ad\u5f00\u6a21\u5f0f\u4e0b\u7684\u4f1a\u8bdd\uff08\u5e76\u6307\u5b9a\u5176\u4f1a\u8bdd\u540d\uff09\u3002 \u7528 screen -list \u6765\u5217\u51fa\u6240\u6709\u4f1a\u8bdd\u3002 \u7528 screen -r session_name \u6765\u91cd\u65b0\u8fde\u63a5\u6307\u5b9a\u4f1a\u8bdd\u3002 \u7528\u5feb\u6377\u952e CTRL-a d \u6765\u6682\u65f6\u65ad\u5f00\u5f53\u524d\u4f1a\u8bdd\u3002 \u9700\u8981\u5148\u5b89\u88c5\uff1a $ yum install screen.x86_64","title":"\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/#1-nohup","text":"nohup COMMAND [ ARG ] ... If standard input is a terminal, redirect it from /dev/null. If standard output is a terminal, append output to 'nohup.out' if possible, '$HOME/nohup.out' otherwise. If standard error is a terminal, redirect it to standard output. To save output to FILE, use 'nohup COMMAND > FILE'. \u4e0d\u652f\u6301 bash \u5185\u5efa\u7684\u6307\u4ee4\u3002 $ nohup ping baidu.com 2 > & 1 >ping.out &","title":"1. nohup \u547d\u4ee4"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/#2-setsid","text":"setsid [ options ] < program > [ arguments ... ] [ shark@linux ~ ] $ setsid ping baidu.com & # \u53ef\u4ee5\u770b\u5230\u7236id\u662f1 [ shark@linux ~ ] $ ps -ef | grep ping shark 19124 1 0 15 :05 ? 00 :00:00 ping baidu.com","title":"2. setsid \u547d\u4ee4"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/#3","text":"[ shark@linux ~ ] $ ( ping baidu.com & ) # \u4e0esetsid\u539f\u7406\u76f8\u540c [ shark@linux ~ ] $ ps -ef | grep ping shark 19176 1 0 15 :08 pts/0 00 :00:00 ping baidu.com","title":"3. (\\ &amp;) \u547d\u4ee4\u6267\u884c\u683c\u5f0f"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/#4-disown","text":"\u9002\u7528\u4e8e\u7a0b\u5e8f\u5df2\u7ecf\u5728\u6267\u884c\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u64cd\u4f5c\u5bf9\u8c61\u662f\u4f5c\u4e1a\u3002 disown [ - ar ] [ - h ] [ jobspec ...] \u7528 disown -h jobspec \u6765\u4f7f \u67d0\u4e2a\u4f5c\u4e1a \u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u7528 disown -ah \u6765\u4f7f \u6240\u6709\u7684\u4f5c\u4e1a \u90fd\u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u7528 disown -rh \u6765\u4f7f \u6b63\u5728\u8fd0\u884c\u7684\u4f5c\u4e1a \u5ffd\u7565HUP\u4fe1\u53f7\u3002 \u4f7f\u7528\u8fc7 disown \u4e4b\u540e\u5e76\u4e14\u5f53\u524d\u7ec8\u7aef\u9000\u51fa\u540e\uff0c\u4f1a\u5c06\u8fdb\u7a0b\u53d8\u4e3a 1 \u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u4f1a\u5c06\u628a\u76ee\u6807\u4f5c\u4e1a\u4ece\u4f5c\u4e1a\u5217\u8868\u4e2d\u79fb\u9664\uff0c\u5c06\u4e0d\u80fd\u518d\u4f7f\u7528jobs\u6765\u67e5\u770b\u5b83\uff0c\u4f46\u662f\u4f9d\u7136\u80fd\u591f\u7528 ps -ef \u67e5\u627e\u5230\u5b83\u3002 [ shark@linux ~ ] $ ping baidu.com > ping.out & [ 1 ] 19292 [ shark@linux ~ ] $ jobs [ 1 ] + Running ping baidu.com > ping.out & [ shark@linux ~ ] $ ps -ef | grep ping shark 19292 17782 0 15 :26 pts/0 00 :00:00 ping baidu.com [ shark@linux ~ ] $ disown -h %1 # \u6b64\u65f6\u4ecd\u7136\u662f\u4e00\u4e2ajob [ shark@linux ~ ] $ jobs [ 1 ] + Running ping baidu.com > ping.out & # \u7ec8\u7aef\u9000\u51fa\u4e4b\u540e\uff1a [ shark@linux ~ ] $ ps -ef | grep ping shark 19292 1 0 15 :26 ? 00 :00:00 ping baidu.com","title":"4. disown \u547d\u4ee4"},{"location":"shell/\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4/#5-screen","text":"\u9002\u7528\u4e8e\u5927\u6279\u91cf\u64cd\u4f5c\u3002\u80fd\u591f\u5728\u4e00\u4e2a\u771f\u5b9e\u7ec8\u7aef\u4e0b\u8fd0\u884c\u591a\u4e2a\u5168\u5c4f\u7684\u4f2a\u7ec8\u7aef\u3002 screen [ - options ] [ cmd [ args ] ] screen - r [[ pid .] tty [. host ]] screen - r sessionowner / [[ pid .] tty [. host ]] \u7528 screen -dmS session_name \u6765\u5efa\u7acb\u4e00\u4e2a\u5904\u4e8e\u65ad\u5f00\u6a21\u5f0f\u4e0b\u7684\u4f1a\u8bdd\uff08\u5e76\u6307\u5b9a\u5176\u4f1a\u8bdd\u540d\uff09\u3002 \u7528 screen -list \u6765\u5217\u51fa\u6240\u6709\u4f1a\u8bdd\u3002 \u7528 screen -r session_name \u6765\u91cd\u65b0\u8fde\u63a5\u6307\u5b9a\u4f1a\u8bdd\u3002 \u7528\u5feb\u6377\u952e CTRL-a d \u6765\u6682\u65f6\u65ad\u5f00\u5f53\u524d\u4f1a\u8bdd\u3002 \u9700\u8981\u5148\u5b89\u88c5\uff1a $ yum install screen.x86_64","title":"5. screen \u547d\u4ee4"},{"location":"shell/\u901a\u8fc7shell\u547d\u4ee4\u5199\u6587\u4ef6/","text":"cat >conftest.l <<EOF \u5185\u5bb9 # EOF \u4e00\u5b9a\u8981\u9876\u683c EOF","title":"\u901a\u8fc7shell\u547d\u4ee4\u5199\u6587\u4ef6"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/","text":"1. \u5fc5\u8981\u7684\u914d\u7f6e 2. \u6d41 3. MultipartFile 4. CommonsMultipartResolver 5. \u4f7f\u7528vue\u3001axio\u4e0a\u4f20\u6587\u4ef6 \u539f\u6587 Spring MVC\u4e0a\u4f20\u6587\u4ef6\u7684\u4e09\u79cd\u65b9\u5f0f\uff1a \u6d41 MultipartFile CommonsMultipartResolver servlet\u7684\u6587\u4ef6\u4e0a\u4f20\u53c2\u8003 servlet\u6587\u4ef6\u4e0a\u4f20 \u3002 1. \u5fc5\u8981\u7684\u914d\u7f6e \u00b6 \u5b83\u4eec\u4e5f\u4f7f\u7528\u4e86 commons-fileupload \uff0c\u6240\u4ee5\u540c\u6837\u9700\u8981\u5bfc\u5165\u6b64\u5305\uff1a <!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --> <dependency> <groupId> commons-fileupload </groupId> <artifactId> commons-fileupload </artifactId> <version> 1.4 </version> </dependency> \u90fd\u9700\u8981\u914d\u7f6e CommonsMultipartResolver \uff1a <!-- \u591a\u90e8\u5206\u6587\u4ef6\u4e0a\u4f20 --> <bean id= \"multipartResolver\" class= \"org.springframework.web.multipart.commons.CommonsMultipartResolver\" > <property name= \"defaultEncoding\" value= \"UTF-8\" /> <!--100MB--> <property name= \"maxUploadSize\" value= \"104857600\" /> <!--4KB--> <property name= \"maxInMemorySize\" value= \"4096\" /> <!--10MB--> <property name= \"maxUploadSizePerFile\" value= \"10485760\" /> </bean> html\u9875\u9762\uff1a < form action = \"/blog/blog/UploadFile1\" method = \"post\" enctype = \"multipart/form-data\" > \u6587\u4ef6\u4e0a\u4f20 < input type = \"file\" name = \"any\" >< br > < button type = \"submit\" > \u4e0a\u4f20 </ button > </ form > 2. \u6d41 \u00b6 /** * \u4ee5\u6d41\u7684\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6 * @param multipartFile \u6587\u4ef6 */ @PostMapping ( \"/UploadFile1\" ) public Result uplodFile1 ( @RequestParam ( \"any\" ) MultipartFile multipartFile ) { FileOutputStream fo = null ; InputStream is = null ; boolean flag = false ; try { ServletContext context = request . getServletContext (); String path = context . getRealPath ( \"/WEB-INF/classes/files\" ); //\u8f93\u51fa\u6d41 fo = new FileOutputStream ( path + File . separator + multipartFile . getOriginalFilename ()); //\u8f93\u5165\u6d41 is = multipartFile . getInputStream (); int len ; byte [] buffer = new byte [ 1024 ]; while (( len = is . read ( buffer )) != - 1 ) { fo . write ( buffer , 0 , len ); } fo . flush (); flag = true ; } catch ( IOException e ){ e . printStackTrace (); } finally { if ( fo != null ){ try { fo . close (); } catch ( IOException e ){ System . out . println ( \"close failed\" ); } } if ( is != null ){ try { is . close (); } catch ( IOException e ){ System . out . println ( \"close failed\" ); } } } if ( flag ){ return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); } else { return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } } 3. MultipartFile \u00b6 /** * file.transferTo \u4fdd\u5b58 */ @PostMapping ( \"/UploadFile2\" ) public Result uploadFile2 ( @RequestParam ( \"any\" ) MultipartFile multipartFile ){ File file = new File ( \"D:/logs/\" + multipartFile . getOriginalFilename ()); try { multipartFile . transferTo ( file ); } catch ( IOException e ){ e . printStackTrace (); return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); } 4. CommonsMultipartResolver \u00b6 /** * \u91c7\u7528spring\u63d0\u4f9b\u7684\u4e0a\u4f20\u6587\u4ef6\u7684\u65b9\u6cd5 */ @PostMapping ( \"/UploadFile3\" ) public Result uploadFile3 ( HttpServletRequest request ){ CommonsMultipartResolver resolver = new CommonsMultipartResolver ( request . getServletContext ()); if (! resolver . isMultipart ( request )){ return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5185\u5bb9\u7c7b\u578b\u9519\u8bef\" ); } MultipartHttpServletRequest multipartRequest = ( MultipartHttpServletRequest ) request ; Iterator < String > iterator = multipartRequest . getFileNames (); try { while ( iterator . hasNext ()){ MultipartFile multipartFile = multipartRequest . getFile ( iterator . next ()); multipartFile . transferTo ( new File ( \"D:/logs/\" + multipartFile . getOriginalFilename ())); } } catch ( IOException e ){ e . printStackTrace (); return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); } 5. \u4f7f\u7528vue\u3001axio\u4e0a\u4f20\u6587\u4ef6 \u00b6 <input type= \"file\" id= \"blog\" placeholder= \"\u9009\u62e9\u6587\u4ef6\" /> <button @ click= \"uploadBlog\" > \u4e0a\u4f20\u535a\u5ba2 </button> uploadBlog: function () { let file = document.getElementById('blog').files[0] let param = new FormData() param.append('any', file) console.log(param.get('any')) this.$axios.post('/api/blog/blog/UploadFile3', param, { headers: { 'Content-Type': 'multipart/form-data' } }) }","title":"\u6587\u4ef6\u4e0a\u4f20"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/#1","text":"\u5b83\u4eec\u4e5f\u4f7f\u7528\u4e86 commons-fileupload \uff0c\u6240\u4ee5\u540c\u6837\u9700\u8981\u5bfc\u5165\u6b64\u5305\uff1a <!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --> <dependency> <groupId> commons-fileupload </groupId> <artifactId> commons-fileupload </artifactId> <version> 1.4 </version> </dependency> \u90fd\u9700\u8981\u914d\u7f6e CommonsMultipartResolver \uff1a <!-- \u591a\u90e8\u5206\u6587\u4ef6\u4e0a\u4f20 --> <bean id= \"multipartResolver\" class= \"org.springframework.web.multipart.commons.CommonsMultipartResolver\" > <property name= \"defaultEncoding\" value= \"UTF-8\" /> <!--100MB--> <property name= \"maxUploadSize\" value= \"104857600\" /> <!--4KB--> <property name= \"maxInMemorySize\" value= \"4096\" /> <!--10MB--> <property name= \"maxUploadSizePerFile\" value= \"10485760\" /> </bean> html\u9875\u9762\uff1a < form action = \"/blog/blog/UploadFile1\" method = \"post\" enctype = \"multipart/form-data\" > \u6587\u4ef6\u4e0a\u4f20 < input type = \"file\" name = \"any\" >< br > < button type = \"submit\" > \u4e0a\u4f20 </ button > </ form >","title":"1. \u5fc5\u8981\u7684\u914d\u7f6e"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/#2","text":"/** * \u4ee5\u6d41\u7684\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6 * @param multipartFile \u6587\u4ef6 */ @PostMapping ( \"/UploadFile1\" ) public Result uplodFile1 ( @RequestParam ( \"any\" ) MultipartFile multipartFile ) { FileOutputStream fo = null ; InputStream is = null ; boolean flag = false ; try { ServletContext context = request . getServletContext (); String path = context . getRealPath ( \"/WEB-INF/classes/files\" ); //\u8f93\u51fa\u6d41 fo = new FileOutputStream ( path + File . separator + multipartFile . getOriginalFilename ()); //\u8f93\u5165\u6d41 is = multipartFile . getInputStream (); int len ; byte [] buffer = new byte [ 1024 ]; while (( len = is . read ( buffer )) != - 1 ) { fo . write ( buffer , 0 , len ); } fo . flush (); flag = true ; } catch ( IOException e ){ e . printStackTrace (); } finally { if ( fo != null ){ try { fo . close (); } catch ( IOException e ){ System . out . println ( \"close failed\" ); } } if ( is != null ){ try { is . close (); } catch ( IOException e ){ System . out . println ( \"close failed\" ); } } } if ( flag ){ return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); } else { return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } }","title":"2. \u6d41"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/#3-multipartfile","text":"/** * file.transferTo \u4fdd\u5b58 */ @PostMapping ( \"/UploadFile2\" ) public Result uploadFile2 ( @RequestParam ( \"any\" ) MultipartFile multipartFile ){ File file = new File ( \"D:/logs/\" + multipartFile . getOriginalFilename ()); try { multipartFile . transferTo ( file ); } catch ( IOException e ){ e . printStackTrace (); return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); }","title":"3. MultipartFile"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/#4-commonsmultipartresolver","text":"/** * \u91c7\u7528spring\u63d0\u4f9b\u7684\u4e0a\u4f20\u6587\u4ef6\u7684\u65b9\u6cd5 */ @PostMapping ( \"/UploadFile3\" ) public Result uploadFile3 ( HttpServletRequest request ){ CommonsMultipartResolver resolver = new CommonsMultipartResolver ( request . getServletContext ()); if (! resolver . isMultipart ( request )){ return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5185\u5bb9\u7c7b\u578b\u9519\u8bef\" ); } MultipartHttpServletRequest multipartRequest = ( MultipartHttpServletRequest ) request ; Iterator < String > iterator = multipartRequest . getFileNames (); try { while ( iterator . hasNext ()){ MultipartFile multipartFile = multipartRequest . getFile ( iterator . next ()); multipartFile . transferTo ( new File ( \"D:/logs/\" + multipartFile . getOriginalFilename ())); } } catch ( IOException e ){ e . printStackTrace (); return new Result ( StatusCode . FAILED , \"\u4e0a\u4f20\u5931\u8d25\" ); } return new Result ( StatusCode . SUCCESS , \"\u4e0a\u4f20\u6210\u529f\" ); }","title":"4. CommonsMultipartResolver"},{"location":"spring/\u6587\u4ef6\u4e0a\u4f20/#5-vueaxio","text":"<input type= \"file\" id= \"blog\" placeholder= \"\u9009\u62e9\u6587\u4ef6\" /> <button @ click= \"uploadBlog\" > \u4e0a\u4f20\u535a\u5ba2 </button> uploadBlog: function () { let file = document.getElementById('blog').files[0] let param = new FormData() param.append('any', file) console.log(param.get('any')) this.$axios.post('/api/blog/blog/UploadFile3', param, { headers: { 'Content-Type': 'multipart/form-data' } }) }","title":"5. \u4f7f\u7528vue\u3001axio\u4e0a\u4f20\u6587\u4ef6"},{"location":"spring/\u6587\u4ef6\u4e0b\u8f7d/","text":"\u524d\u53f0\u6784\u9020\u8d85\u94fe\u63a5\uff1a < a href = \"http://localhost:9898/blog/blog/Download?fileName=xxx.docx\" > download </ a > 1. \u4f7f\u7528servlet\u7684\u65b9\u5f0f \u00b6 \u7b2c\u4e00\u79cd\u8ddf servlet\u7684\u5b9e\u73b0\u65b9\u6cd5 \u4e00\u81f4\uff0c\u6ce8\u610f\u4e00\u4e0b\u53c2\u6570\u7684\u83b7\u53d6 @GetMapping ( \"/Download\" ) @PostMapping ( \"/Download\" ) public void download ( @RequestParam ( \"fileName\" ) String fileName , HttpServletRequest req , HttpServletResponse resp ) { // String fileName = req.getParameter(\"fileName\"); ServletContext servletContext = req . getServletContext (); resp . setContentType ( servletContext . getMimeType ( fileName )); // HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder // .getRequestAttributes()).getRequest(); // String dir = servletContext.getRealPath(\"/WEB-INF/classes/files\"); String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; System . out . println ( \"download file: \" + fullFileNmame ); try ( FileInputStream fi = new FileInputStream ( fullFileNmame ); BufferedInputStream bi = new BufferedInputStream ( fi ); ServletOutputStream so = resp . getOutputStream ()) { resp . setHeader ( \"Content-Disposition\" , \"attachment;filename=\" + new String ( fileName . getBytes ( \"utf-8\" ), \"ISO8859-1\" )); int len ; while (( len = bi . read ()) != - 1 ) { so . write ( len ); } } catch ( IOException e ) { e . printStackTrace (); } } 2. \u4f7f\u7528Spring\u7684\u65b9\u5f0f \u00b6 @GetMapping ( \"/Download/{fileName}\" ) @PostMapping ( \"/Download/{fileName}\" ) public ResponseEntity < org . springframework . core . io . Resource > downloadResponse ( @PathVariable String fileName , HttpServletRequest request ) { String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; File file = new File ( fullFileNmame ); org . springframework . core . io . Resource body = new FileSystemResource ( file ); // HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder // .getRequestAttributes()).getRequest(); String header = request . getHeader ( \"User-Agent\" ). toUpperCase (); HttpStatus status = HttpStatus . CREATED ; try { if ( header . contains ( \"MSIE\" ) || header . contains ( \"TRIDENT\" ) || header . contains ( \"EDGE\" )) { fileName = URLEncoder . encode ( fileName , \"UTF-8\" ); fileName = fileName . replace ( \"+\" , \"%20\" ); // IE\u4e0b\u8f7d\u6587\u4ef6\u540d\u7a7a\u683c\u53d8+\u53f7\u95ee\u9898 status = HttpStatus . OK ; } else { fileName = new String ( fileName . getBytes ( \"UTF-8\" ), \"ISO8859-1\" ); } } catch ( UnsupportedEncodingException e ) {} HttpHeaders headers = new HttpHeaders (); //\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528 MediaType.parseMediaType(String mediaType) \u81ea\u52a8\u89e3\u6790 headers . setContentType ( MediaType . APPLICATION_OCTET_STREAM ); headers . setContentDispositionFormData ( \"attachment\" , fileName ); headers . setContentLength ( file . length ()); return new ResponseEntity <>( body , headers , status ); } \u6b64\u65b9\u5f0f\u80fd\u591f\u89e3\u6790\u7684\u6587\u4ef6\u7c7b\u578b\u6709\u9650\u3002 MediaType \u6307\u7684\u662f\u8981\u4f20\u9012\u7684\u6570\u636e\u7684MIME\u7c7b\u578b\uff0cMediaType\u5bf9\u8c61\u5305\u542b\u4e86\u4e09\u79cd\u4fe1\u606f\uff1atype \u3001subtype\u4ee5\u53cacharset\uff0c\u4e00\u822c\u5c06\u8fd9\u4e9b\u4fe1\u606f\u4f20\u5165parse()\u65b9\u6cd5\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u6790\u51faMediaType\u5bf9\u8c61\uff0c\u6bd4\u5982 \"text/x-markdown; charset=utf-8\" \uff0ctype\u503c\u662ftext\uff0c\u8868\u793a\u662f\u6587\u672c\u8fd9\u4e00\u5927\u7c7b\uff1b/\u540e\u9762\u7684x-markdown\u662fsubtype\uff0c\u8868\u793a\u662f\u6587\u672c\u8fd9\u4e00\u5927\u7c7b\u4e0b\u7684markdown\u8fd9\u4e00\u5c0f\u7c7b\uff1b charset=utf-8 \u5219\u8868\u793a\u91c7\u7528UTF-8\u7f16\u7801\u3002\u539f\u6587\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/4721d7b5e780","title":"\u6587\u4ef6\u4e0b\u8f7d"},{"location":"spring/\u6587\u4ef6\u4e0b\u8f7d/#1-servlet","text":"\u7b2c\u4e00\u79cd\u8ddf servlet\u7684\u5b9e\u73b0\u65b9\u6cd5 \u4e00\u81f4\uff0c\u6ce8\u610f\u4e00\u4e0b\u53c2\u6570\u7684\u83b7\u53d6 @GetMapping ( \"/Download\" ) @PostMapping ( \"/Download\" ) public void download ( @RequestParam ( \"fileName\" ) String fileName , HttpServletRequest req , HttpServletResponse resp ) { // String fileName = req.getParameter(\"fileName\"); ServletContext servletContext = req . getServletContext (); resp . setContentType ( servletContext . getMimeType ( fileName )); // HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder // .getRequestAttributes()).getRequest(); // String dir = servletContext.getRealPath(\"/WEB-INF/classes/files\"); String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; System . out . println ( \"download file: \" + fullFileNmame ); try ( FileInputStream fi = new FileInputStream ( fullFileNmame ); BufferedInputStream bi = new BufferedInputStream ( fi ); ServletOutputStream so = resp . getOutputStream ()) { resp . setHeader ( \"Content-Disposition\" , \"attachment;filename=\" + new String ( fileName . getBytes ( \"utf-8\" ), \"ISO8859-1\" )); int len ; while (( len = bi . read ()) != - 1 ) { so . write ( len ); } } catch ( IOException e ) { e . printStackTrace (); } }","title":"1. \u4f7f\u7528servlet\u7684\u65b9\u5f0f"},{"location":"spring/\u6587\u4ef6\u4e0b\u8f7d/#2-spring","text":"@GetMapping ( \"/Download/{fileName}\" ) @PostMapping ( \"/Download/{fileName}\" ) public ResponseEntity < org . springframework . core . io . Resource > downloadResponse ( @PathVariable String fileName , HttpServletRequest request ) { String dir = \"D:/logs/uploadFiles/\" ; String fullFileNmame = dir + fileName ; File file = new File ( fullFileNmame ); org . springframework . core . io . Resource body = new FileSystemResource ( file ); // HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder // .getRequestAttributes()).getRequest(); String header = request . getHeader ( \"User-Agent\" ). toUpperCase (); HttpStatus status = HttpStatus . CREATED ; try { if ( header . contains ( \"MSIE\" ) || header . contains ( \"TRIDENT\" ) || header . contains ( \"EDGE\" )) { fileName = URLEncoder . encode ( fileName , \"UTF-8\" ); fileName = fileName . replace ( \"+\" , \"%20\" ); // IE\u4e0b\u8f7d\u6587\u4ef6\u540d\u7a7a\u683c\u53d8+\u53f7\u95ee\u9898 status = HttpStatus . OK ; } else { fileName = new String ( fileName . getBytes ( \"UTF-8\" ), \"ISO8859-1\" ); } } catch ( UnsupportedEncodingException e ) {} HttpHeaders headers = new HttpHeaders (); //\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528 MediaType.parseMediaType(String mediaType) \u81ea\u52a8\u89e3\u6790 headers . setContentType ( MediaType . APPLICATION_OCTET_STREAM ); headers . setContentDispositionFormData ( \"attachment\" , fileName ); headers . setContentLength ( file . length ()); return new ResponseEntity <>( body , headers , status ); } \u6b64\u65b9\u5f0f\u80fd\u591f\u89e3\u6790\u7684\u6587\u4ef6\u7c7b\u578b\u6709\u9650\u3002 MediaType \u6307\u7684\u662f\u8981\u4f20\u9012\u7684\u6570\u636e\u7684MIME\u7c7b\u578b\uff0cMediaType\u5bf9\u8c61\u5305\u542b\u4e86\u4e09\u79cd\u4fe1\u606f\uff1atype \u3001subtype\u4ee5\u53cacharset\uff0c\u4e00\u822c\u5c06\u8fd9\u4e9b\u4fe1\u606f\u4f20\u5165parse()\u65b9\u6cd5\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u6790\u51faMediaType\u5bf9\u8c61\uff0c\u6bd4\u5982 \"text/x-markdown; charset=utf-8\" \uff0ctype\u503c\u662ftext\uff0c\u8868\u793a\u662f\u6587\u672c\u8fd9\u4e00\u5927\u7c7b\uff1b/\u540e\u9762\u7684x-markdown\u662fsubtype\uff0c\u8868\u793a\u662f\u6587\u672c\u8fd9\u4e00\u5927\u7c7b\u4e0b\u7684markdown\u8fd9\u4e00\u5c0f\u7c7b\uff1b charset=utf-8 \u5219\u8868\u793a\u91c7\u7528UTF-8\u7f16\u7801\u3002\u539f\u6587\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/4721d7b5e780","title":"2. \u4f7f\u7528Spring\u7684\u65b9\u5f0f"},{"location":"springboot/1.\u8bf4\u660e/","text":"Spring Boot\u5b98\u65b9\u6587\u6863\uff1ahttps://spring.io/projects/spring-boot/#learn Spring Boot1.4.1\u7248\u672c\u4e2d\u6587\u7ffb\u8bd1\uff1ahttps://qbgbook.gitbooks.io/spring-boot-reference-guide-zh/content/ Spring MVC\u5b98\u65b9\u6587\u6863\uff1ahttps://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/web.html#mvc \u4e00\u4e9b\u6ce8\u89e3\u7684\u8bf4\u660e\uff1a @RestController \u662fSpring\u7684\u7ec4\u5408\u6ce8\u89e3\uff0c\u7531 Controller \u548c ResponseBody \u7ec4\u6210\u3002 ResponseBody \u4f7f\u8fd4\u56de\u5bf9\u8c61\u901a\u8fc7 HttpMessageConverters \u5e8f\u5217\u5316\u3002 @EnableAutoConfiguration \u544a\u8bc9Spring Boot\u57fa\u4e8e\u4f60\u6dfb\u52a0\u7684jar\u5305\u4f9d\u8d56\u53bb\u201c\u731c\u6d4b\u201d\u4f60\u60f3\u8981\u5982\u4f55\u914d\u7f6eSpring\u3002 @Import \uff1a\u5bfc\u5165\u989d\u5916\u7684\u914d\u7f6e\u7c7b\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 @ComponentScan \u81ea\u52a8\u626b\u63cf\u3002 @ImportResource \uff1a\u5bfc\u5165xml\u914d\u7f6e\u6587\u4ef6\u3002","title":"1.\u8bf4\u660e"},{"location":"springboot/2.Maven/","text":"\u4f7f\u7528maven\u53ef\u4ee5\u4ece spring-boot-starter-parent \u9879\u76ee\u7ee7\u627f\u4e00\u4e9b\u9ed8\u8ba4\u914d\u7f6e\u3002\u5b83\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u7279\u6027\uff1a Java 1.8 as the default compiler level. UTF-8 source encoding. A Dependency Management section , inherited from the spring-boot-dependencies pom, that manages the versions of common dependencies. This dependency management lets you omit tags for those dependencies when used in your own pom. An execution of the repackage goal with a repackage execution id.\u4e00\u4e2amaven\u7684\u63d2\u4ef6 Sensible resource filtering .\u667a\u80fd\u5b57\u7b26\u66ff\u6362 Sensible plugin configuration ( exec plugin , Git commit ID , and shade ).\u667a\u80fd\u63d2\u4ef6\u914d\u7f6e Sensible resource filtering for application.properties and application.yml including profile-specific files (for example, application-dev.properties and application-dev.yml ) \u6ce8\u610f \uff1a\u56e0\u4e3a application.properties and application.yml \u4f7f\u7528\u4e86\u5360\u4f4d\u7b26 ${\u2026} \uff0c\u6240\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528Maven\u7684\u5c5e\u6027\u65f6\u5176\u5360\u4f4d\u7b26\u88ab\u66ff\u6362\u4e3a @..@ \u3002\uff08You can override that by setting a Maven property called resource.delimiter .\uff09 1. \u7ee7\u627f\u81ea Starter Parent \u00b6 pom.xml\uff1a <!-- Inherit defaults from Spring Boot --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.4.RELEASE </version> </parent> \u8fd9\u91cc\u53ef\u4ee5\u7edf\u4e00\u7248\u672c\u7ba1\u7406\u3002 \u60f3\u8981\u66ff\u6362\u67d0\u4e2a\u5c5e\u6027\u7684\u8bdd\uff0c\u5728properties\u4e2d\u5b9a\u4e49\uff1a <properties> <spring-data-releasetrain.version> Fowler-SR2 </spring-data-releasetrain.version> </properties> \u5728 spring-boot-dependencies pom \u67e5\u770b\u6709\u54ea\u4e9b\u5c5e\u6027\u3002 2. \u975e\u7ee7\u627f\u65b9\u5f0f\u4f7f\u7528 Spring Boot \u00b6 \u4e0d\u4f7f\u7528 spring-boot-starter-parent \uff0c\u901a\u8fc7\u4f7f\u7528 scope=import \u4f9d\u8d56\u4ecd\u7136\u53ef\u4ee5\u4fdd\u7559\u4f9d\u8d56\u7ba1\u7406\u7684\u597d\u5904\uff08\u4f46\u662f\u6ca1\u6709\u4e86\u63d2\u4ef6\u7ba1\u7406\uff09: <dependencyManagement> <dependencies> <dependency> <!-- Import dependency management from Spring Boot --> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-dependencies </artifactId> <version> 2.1.4.RELEASE </version> <type> pom </type> <scope> import </scope> </dependency> </dependencies> </dependencyManagement> \u60f3\u8981\u66ff\u6362\u67d0\u4e2a\u5c5e\u6027\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5728\u8be5\u4f9d\u8d56\u4e4b\u524d\u8986\u76d6\uff1a <dependencyManagement> <dependencies> <!-- Override Spring Data release train provided by Spring Boot --> <dependency> <groupId> org.springframework.data </groupId> <artifactId> spring-data-releasetrain </artifactId> <version> Fowler-SR2 </version> <type> pom </type> <scope> import </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-dependencies </artifactId> <version> 2.1.4.RELEASE </version> <type> pom </type> <scope> import </scope> </dependency> </dependencies> </dependencyManagement> 3. \u53ef\u6267\u884c\u63d2\u4ef6 \u00b6 \u4f7f\u7528\u8be5\u63d2\u4ef6\u8ba9\u9879\u76ee\u53d8\u4e3a\u53ef\u6267\u884c\u7684jar\u5305\uff1a <build> <plugins> <plugin> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-maven-plugin </artifactId> </plugin> </plugins> </build>","title":"2.Maven"},{"location":"springboot/2.Maven/#1-starter-parent","text":"pom.xml\uff1a <!-- Inherit defaults from Spring Boot --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.4.RELEASE </version> </parent> \u8fd9\u91cc\u53ef\u4ee5\u7edf\u4e00\u7248\u672c\u7ba1\u7406\u3002 \u60f3\u8981\u66ff\u6362\u67d0\u4e2a\u5c5e\u6027\u7684\u8bdd\uff0c\u5728properties\u4e2d\u5b9a\u4e49\uff1a <properties> <spring-data-releasetrain.version> Fowler-SR2 </spring-data-releasetrain.version> </properties> \u5728 spring-boot-dependencies pom \u67e5\u770b\u6709\u54ea\u4e9b\u5c5e\u6027\u3002","title":"1. \u7ee7\u627f\u81ea Starter Parent"},{"location":"springboot/2.Maven/#2-spring-boot","text":"\u4e0d\u4f7f\u7528 spring-boot-starter-parent \uff0c\u901a\u8fc7\u4f7f\u7528 scope=import \u4f9d\u8d56\u4ecd\u7136\u53ef\u4ee5\u4fdd\u7559\u4f9d\u8d56\u7ba1\u7406\u7684\u597d\u5904\uff08\u4f46\u662f\u6ca1\u6709\u4e86\u63d2\u4ef6\u7ba1\u7406\uff09: <dependencyManagement> <dependencies> <dependency> <!-- Import dependency management from Spring Boot --> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-dependencies </artifactId> <version> 2.1.4.RELEASE </version> <type> pom </type> <scope> import </scope> </dependency> </dependencies> </dependencyManagement> \u60f3\u8981\u66ff\u6362\u67d0\u4e2a\u5c5e\u6027\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5728\u8be5\u4f9d\u8d56\u4e4b\u524d\u8986\u76d6\uff1a <dependencyManagement> <dependencies> <!-- Override Spring Data release train provided by Spring Boot --> <dependency> <groupId> org.springframework.data </groupId> <artifactId> spring-data-releasetrain </artifactId> <version> Fowler-SR2 </version> <type> pom </type> <scope> import </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-dependencies </artifactId> <version> 2.1.4.RELEASE </version> <type> pom </type> <scope> import </scope> </dependency> </dependencies> </dependencyManagement>","title":"2. \u975e\u7ee7\u627f\u65b9\u5f0f\u4f7f\u7528 Spring Boot"},{"location":"springboot/2.Maven/#3","text":"\u4f7f\u7528\u8be5\u63d2\u4ef6\u8ba9\u9879\u76ee\u53d8\u4e3a\u53ef\u6267\u884c\u7684jar\u5305\uff1a <build> <plugins> <plugin> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-maven-plugin </artifactId> </plugin> </plugins> </build>","title":"3. \u53ef\u6267\u884c\u63d2\u4ef6"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/","text":"1. \u52a0\u8f7d\u987a\u5e8f 2. Profile-specific \u5c5e\u6027 3. \u5c5e\u6027\u5360\u4f4d\u7b26 4. YAML 5. \u7c7b\u578b\u5b89\u5168\u7684\u914d\u7f6e\u5c5e\u6027 5.1 \u7b2c\u4e09\u65b9\u914d\u7f6e 5.2 \u5bbd\u677e\u7684\u7ed1\u5b9a\u89c4\u5219 5.3 \u5408\u5e76\u590d\u6742\u7c7b\u578b 5.4 @ConfigurationProperties \u9a8c\u8bc1 1. \u52a0\u8f7d\u987a\u5e8f \u00b6 \u6309\u4ee5\u4e0b\u4f18\u5148\u7ea7\u987a\u5e8f\uff08\u4ece\u9ad8\u5230\u4f4e\uff09\u52a0\u8f7d application.properties \u6587\u4ef6\uff1a A /config subdirectory of the current directory The current directory A classpath /config package The classpath root \u53ef\u901a\u8fc7\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\u7ea7\u522b\u7684\uff08\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u3001\u7cfb\u7edf\u5c5e\u6027\u3001\u547d\u4ee4\u884c\u53c2\u6570\uff09 spring.config.additional-location \u6dfb\u52a0\u989d\u5916\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u5e76\u62e5\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\u3002 \u4f8b\uff1a $ java -jar myproject.jar --spring.config.name = myproject --spring.config.additional-location = classpath:/custom-config/,file:./custom-config/ \u90a3\u4e48\u52a0\u8f7d\u4f18\u5148\u7ea7\u5c31\u662f\uff1a file:./custom-config/ classpath:custom-config/ file:./config/ file:./ classpath:/config/ classpath:/ \u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u7684\u73af\u5883\u53d8\u91cf\u9700\u8981\u6539\u5199\u4e3a \u5927\u5199\u5b57\u6bcd+\u4e0b\u5212\u7ebf \u7684\u7ec4\u6210\u683c\u5f0f(for example, SPRING_CONFIG_NAME instead of spring.config.name )\u3002 2. Profile-specific \u5c5e\u6027 \u00b6 \u6b64\u7c7b\u6587\u4ef6\u7684\u547d\u540d\u683c\u5f0f\u4e3a application-{profile}.properties \u3002 Application \u73af\u5883\u4e2d\u6709\u4e00\u7cfb\u5217\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709\u6fc0\u6d3b\u7279\u522b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u90a3\u4e48\u4f7f\u7528\u9ed8\u8ba4\u7684\u3002 profile-specific \u4e0e application.properties \u4e00\u8d77\u52a0\u8f7d\uff0c\u5e76\u4e14\u65e0\u8bba\u5728jar\u5305\u91cc\u9762\u6216\u5916\u9762\u90fd\u4f1a\u8986\u76d6\u6389 application.properties\u7684\u5c5e\u6027\u3002 \u6ce8\u610f \uff1a\u5982\u679c\u4f7f\u7528\u4e86 spring.config.location \u6307\u5b9a\u4e86\u4efb\u4f55\u6587\u4ef6\uff0c\u90a3\u4e48\u8be5\u914d\u7f6e\u6587\u4ef6\u7684\u53d8\u79cd\u4f1a\u5931\u6548\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u5939\u7684\u5f62\u5f0f\u9632\u6b62\u3002 3. \u5c5e\u6027\u5360\u4f4d\u7b26 \u00b6 \u5728\u73af\u5883\u4e2d\u5b9a\u4e49\u4e86\u5c5e\u6027\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728 application.properties \u4e2d\u4f7f\u7528\uff1a app.name = MyApp app.description = ${app.name} is a Spring Boot application 4. YAML \u00b6 SnakeYAML \u5728classpath\u4e2d\u5c31\u53ef\u4ee5\u4f7f\u7528YAML\u4ee3\u66ffproperties\u505a\u914d\u7f6e\u3002 If you use \u201cStarters\u201d, SnakeYAML is automatically provided by spring-boot-starter . \u7f3a\u70b9 \uff1a \u4e0d\u80fd\u901a\u8fc7 @PropertySource \u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\u3002 \u914d\u7f6e\u6587\u4ef6\u5426\u5b9a\u548c\u914d\u7f6e\u6587\u4ef6\u8868\u8fbe\u5f0f\u5c06\u4e0d\u4f1a\u6309\u9884\u671f\u8fd0\u884c\u3002 5. \u7c7b\u578b\u5b89\u5168\u7684\u914d\u7f6e\u5c5e\u6027 \u00b6 \u5c06\u4e00\u5806\u5c5e\u6027\u914d\u7f6e\u6ce8\u5165\u5230 \u5c5e\u6027\u7c7b \u4e0a\u9762\u3002 @Component @ConfigurationProperties ( prefix = \"acme\" ) public class AcmeProperties { \u5c5e\u6027 ... getter setter function } acme\u5c31\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5c5e\u6027\u3002 \u4ee5\u4e0b\u4e2d\u60c5\u51b5\u4e0d\u9700\u8981\u5c5e\u6027\u7684setter\u65b9\u6cd5\uff1a map \u5d4c\u5957\u7684POJO\u7c7b\u578b\u7684\u5c5e\u6027\u5df2\u7ecf\u88ab\u521d\u59cb\u5316\u4e86\u3002\u5982\u679c\u60a8\u5e0c\u671b\u7ed1\u5b9a\u5668\u4f7f\u7528\u5176\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b\uff0c\u5219\u9700\u8981\u4e00\u4e2asetter\u3002 5.1 \u7b2c\u4e09\u65b9\u914d\u7f6e \u00b6 @ConfigurationProperties \u53ef\u4ee5\u7528\u5728\u7c7b\u548cpublic @Bean \u65b9\u6cd5\u4e0a\u9762\u3002 @ConfigurationProperties ( prefix = \"another\" ) @Bean public AnotherComponent anotherComponent () { ... } 5.2 \u5bbd\u677e\u7684\u7ed1\u5b9a\u89c4\u5219 \u00b6 Spring Boot\u5c06 Environment \u5c5e\u6027\u7ed1\u5b9a\u5230 @ConfigurationProperties beans\u65f6\u4f1a\u4f7f\u7528\u4e00\u4e9b\u5bbd\u677e\u7684\u89c4\u5219\uff0c\u6240\u4ee5 Environment \u5c5e\u6027\u540d\u548cbean\u5c5e\u6027\u540d\u4e0d\u9700\u8981\u7cbe\u786e\u5339\u914d\u3002 \u56db\u79cd\u683c\u5f0f\u7684\u5e94\u7528\u8303\u56f4\uff1a Property Note acme.my-project.person.first-name Kebab case, which is recommended for use in .properties and .yml files. acme.myProject.person.firstName Standard camel case syntax. acme.my_project.person.first_name Underscore notation, which is an alternative format for use in .properties and .yml files. ACME_MYPROJECT_PERSON_FIRSTNAME Upper case format, which is recommended when using system environment variables. \u6ce8\u610f \uff1a prefix \u7684\u503c\u5fc5\u987b\u662f\u865a\u7ebf\u5206\u9694\u683c\u5f0f\u3002 \u56db\u79cd\u5c5e\u6027\u5b9a\u4e49\u65b9\u5f0f\u7684\u53ef\u7528\u5c5e\u6027\u547d\u540d\u89c4\u8303\uff1a Property Source Simple List Properties Files Camel case, kebab case, or underscore notation Standard list syntax using [ ] or comma-separated values YAML Files Camel case, kebab case, or underscore notation Standard YAML list syntax or comma-separated values Environment Variables Upper case format with underscore as the delimiter. _ should not be used within a property name Numeric values surrounded by underscores, such as MY_ACME_1_OTHER = my.acme[1].other System properties Camel case, kebab case, or underscore notation Standard list syntax using [ ] or comma-separated values \u5f53\u7ed1\u5b9a Map \u5c5e\u6027\u65f6\uff0c\u5982\u679c key \u4e2d\u6709\u5b57\u7b26\u7684\u8303\u56f4\u4e0d\u5728\uff1a\u5c0f\u5199\u5b57\u6bcd\u6570\u5b57\u3001 - \uff0c\u5c31\u8981\u4f7f\u7528 [] \u5305\u56f4\u3002 acme : map : \"[/key1]\" : value1 \u5426\u5219\u8fd9\u4e9b\u8d85\u8303\u56f4\u5b57\u7b26\u4f1a\u88ab\u53bb\u9664\u3002 5.3 \u5408\u5e76\u590d\u6742\u7c7b\u578b \u00b6 \u5bf9\u4e8e list \u7c7b\u578b\u6765\u8bf4\uff0c\u53ea\u4f1a\u4f7f\u7528\u591a\u4e2a\u914d\u7f6e\u6e90\u4e2d\u7684\u4e00\u4e2a\u3002 \u5bf9\u4e8e map \u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u5408\u5e76\u591a\u4e2a\u914d\u7f6e\u6e90\u3002 \u4f8b\uff1a acme : map : key1 : name : my name 1 description : my description 1 --- spring : profiles : dev acme : map : key1 : name : dev name 1 key2 : name : dev name 2 description : dev description 2 \u82e5\u6fc0\u6d3b\u4e86dev\uff0ckey1\u7684\u503c\u4e3a\uff1aname: dev name 1\uff1bdescription: my description 1\u3002 5.4 @ConfigurationProperties \u9a8c\u8bc1 \u00b6 Spring Boot\u4f1a\u9a8c\u8bc1\u6dfb\u52a0\u4e86Spring @Validated \u6ce8\u89e3\u7684 @ConfigurationProperties \u7c7b\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528JSR-303 javax.validation \u7684\u6ce8\u89e3\u3002 @ConfigurationProperties ( prefix = \"acme\" ) @Validated public class AcmeProperties { @NotNull private InetAddress remoteAddress ; @Valid private final Security security = new Security (); // ... getters and setters public static class Security { @NotEmpty public String username ; // ... getters and setters } // ... getters and setters } \u5d4c\u5957\u5c5e\u6027\u6700\u597d\u52a0\u4e0a @Valid \u6ce8\u89e3\u3002 \u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u53eb\u505a configurationPropertiesValidator \u7684bean\u6765\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684Spring Validator \u3002 @Bean \u65b9\u6cd5\u9700\u8981\u58f0\u660e\u4e3a static \u3002 \u793a\u4f8b \u3002","title":"24.Application \u5c5e\u6027\u6587\u4ef6"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#1","text":"\u6309\u4ee5\u4e0b\u4f18\u5148\u7ea7\u987a\u5e8f\uff08\u4ece\u9ad8\u5230\u4f4e\uff09\u52a0\u8f7d application.properties \u6587\u4ef6\uff1a A /config subdirectory of the current directory The current directory A classpath /config package The classpath root \u53ef\u901a\u8fc7\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\u7ea7\u522b\u7684\uff08\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u3001\u7cfb\u7edf\u5c5e\u6027\u3001\u547d\u4ee4\u884c\u53c2\u6570\uff09 spring.config.additional-location \u6dfb\u52a0\u989d\u5916\u7684\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u5e76\u62e5\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\u3002 \u4f8b\uff1a $ java -jar myproject.jar --spring.config.name = myproject --spring.config.additional-location = classpath:/custom-config/,file:./custom-config/ \u90a3\u4e48\u52a0\u8f7d\u4f18\u5148\u7ea7\u5c31\u662f\uff1a file:./custom-config/ classpath:custom-config/ file:./config/ file:./ classpath:/config/ classpath:/ \u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u7684\u73af\u5883\u53d8\u91cf\u9700\u8981\u6539\u5199\u4e3a \u5927\u5199\u5b57\u6bcd+\u4e0b\u5212\u7ebf \u7684\u7ec4\u6210\u683c\u5f0f(for example, SPRING_CONFIG_NAME instead of spring.config.name )\u3002","title":"1. \u52a0\u8f7d\u987a\u5e8f"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#2-profile-specific","text":"\u6b64\u7c7b\u6587\u4ef6\u7684\u547d\u540d\u683c\u5f0f\u4e3a application-{profile}.properties \u3002 Application \u73af\u5883\u4e2d\u6709\u4e00\u7cfb\u5217\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u5982\u679c\u6ca1\u6709\u6fc0\u6d3b\u7279\u522b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u90a3\u4e48\u4f7f\u7528\u9ed8\u8ba4\u7684\u3002 profile-specific \u4e0e application.properties \u4e00\u8d77\u52a0\u8f7d\uff0c\u5e76\u4e14\u65e0\u8bba\u5728jar\u5305\u91cc\u9762\u6216\u5916\u9762\u90fd\u4f1a\u8986\u76d6\u6389 application.properties\u7684\u5c5e\u6027\u3002 \u6ce8\u610f \uff1a\u5982\u679c\u4f7f\u7528\u4e86 spring.config.location \u6307\u5b9a\u4e86\u4efb\u4f55\u6587\u4ef6\uff0c\u90a3\u4e48\u8be5\u914d\u7f6e\u6587\u4ef6\u7684\u53d8\u79cd\u4f1a\u5931\u6548\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u6587\u4ef6\u5939\u7684\u5f62\u5f0f\u9632\u6b62\u3002","title":"2. Profile-specific \u5c5e\u6027"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#3","text":"\u5728\u73af\u5883\u4e2d\u5b9a\u4e49\u4e86\u5c5e\u6027\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728 application.properties \u4e2d\u4f7f\u7528\uff1a app.name = MyApp app.description = ${app.name} is a Spring Boot application","title":"3. \u5c5e\u6027\u5360\u4f4d\u7b26"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#4-yaml","text":"SnakeYAML \u5728classpath\u4e2d\u5c31\u53ef\u4ee5\u4f7f\u7528YAML\u4ee3\u66ffproperties\u505a\u914d\u7f6e\u3002 If you use \u201cStarters\u201d, SnakeYAML is automatically provided by spring-boot-starter . \u7f3a\u70b9 \uff1a \u4e0d\u80fd\u901a\u8fc7 @PropertySource \u8f7d\u5165\u914d\u7f6e\u6587\u4ef6\u3002 \u914d\u7f6e\u6587\u4ef6\u5426\u5b9a\u548c\u914d\u7f6e\u6587\u4ef6\u8868\u8fbe\u5f0f\u5c06\u4e0d\u4f1a\u6309\u9884\u671f\u8fd0\u884c\u3002","title":"4. YAML"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#5","text":"\u5c06\u4e00\u5806\u5c5e\u6027\u914d\u7f6e\u6ce8\u5165\u5230 \u5c5e\u6027\u7c7b \u4e0a\u9762\u3002 @Component @ConfigurationProperties ( prefix = \"acme\" ) public class AcmeProperties { \u5c5e\u6027 ... getter setter function } acme\u5c31\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5c5e\u6027\u3002 \u4ee5\u4e0b\u4e2d\u60c5\u51b5\u4e0d\u9700\u8981\u5c5e\u6027\u7684setter\u65b9\u6cd5\uff1a map \u5d4c\u5957\u7684POJO\u7c7b\u578b\u7684\u5c5e\u6027\u5df2\u7ecf\u88ab\u521d\u59cb\u5316\u4e86\u3002\u5982\u679c\u60a8\u5e0c\u671b\u7ed1\u5b9a\u5668\u4f7f\u7528\u5176\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b\uff0c\u5219\u9700\u8981\u4e00\u4e2asetter\u3002","title":"5. \u7c7b\u578b\u5b89\u5168\u7684\u914d\u7f6e\u5c5e\u6027"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#51","text":"@ConfigurationProperties \u53ef\u4ee5\u7528\u5728\u7c7b\u548cpublic @Bean \u65b9\u6cd5\u4e0a\u9762\u3002 @ConfigurationProperties ( prefix = \"another\" ) @Bean public AnotherComponent anotherComponent () { ... }","title":"5.1 \u7b2c\u4e09\u65b9\u914d\u7f6e"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#52","text":"Spring Boot\u5c06 Environment \u5c5e\u6027\u7ed1\u5b9a\u5230 @ConfigurationProperties beans\u65f6\u4f1a\u4f7f\u7528\u4e00\u4e9b\u5bbd\u677e\u7684\u89c4\u5219\uff0c\u6240\u4ee5 Environment \u5c5e\u6027\u540d\u548cbean\u5c5e\u6027\u540d\u4e0d\u9700\u8981\u7cbe\u786e\u5339\u914d\u3002 \u56db\u79cd\u683c\u5f0f\u7684\u5e94\u7528\u8303\u56f4\uff1a Property Note acme.my-project.person.first-name Kebab case, which is recommended for use in .properties and .yml files. acme.myProject.person.firstName Standard camel case syntax. acme.my_project.person.first_name Underscore notation, which is an alternative format for use in .properties and .yml files. ACME_MYPROJECT_PERSON_FIRSTNAME Upper case format, which is recommended when using system environment variables. \u6ce8\u610f \uff1a prefix \u7684\u503c\u5fc5\u987b\u662f\u865a\u7ebf\u5206\u9694\u683c\u5f0f\u3002 \u56db\u79cd\u5c5e\u6027\u5b9a\u4e49\u65b9\u5f0f\u7684\u53ef\u7528\u5c5e\u6027\u547d\u540d\u89c4\u8303\uff1a Property Source Simple List Properties Files Camel case, kebab case, or underscore notation Standard list syntax using [ ] or comma-separated values YAML Files Camel case, kebab case, or underscore notation Standard YAML list syntax or comma-separated values Environment Variables Upper case format with underscore as the delimiter. _ should not be used within a property name Numeric values surrounded by underscores, such as MY_ACME_1_OTHER = my.acme[1].other System properties Camel case, kebab case, or underscore notation Standard list syntax using [ ] or comma-separated values \u5f53\u7ed1\u5b9a Map \u5c5e\u6027\u65f6\uff0c\u5982\u679c key \u4e2d\u6709\u5b57\u7b26\u7684\u8303\u56f4\u4e0d\u5728\uff1a\u5c0f\u5199\u5b57\u6bcd\u6570\u5b57\u3001 - \uff0c\u5c31\u8981\u4f7f\u7528 [] \u5305\u56f4\u3002 acme : map : \"[/key1]\" : value1 \u5426\u5219\u8fd9\u4e9b\u8d85\u8303\u56f4\u5b57\u7b26\u4f1a\u88ab\u53bb\u9664\u3002","title":"5.2 \u5bbd\u677e\u7684\u7ed1\u5b9a\u89c4\u5219"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#53","text":"\u5bf9\u4e8e list \u7c7b\u578b\u6765\u8bf4\uff0c\u53ea\u4f1a\u4f7f\u7528\u591a\u4e2a\u914d\u7f6e\u6e90\u4e2d\u7684\u4e00\u4e2a\u3002 \u5bf9\u4e8e map \u7c7b\u578b\u6765\u8bf4\uff0c\u4f1a\u5408\u5e76\u591a\u4e2a\u914d\u7f6e\u6e90\u3002 \u4f8b\uff1a acme : map : key1 : name : my name 1 description : my description 1 --- spring : profiles : dev acme : map : key1 : name : dev name 1 key2 : name : dev name 2 description : dev description 2 \u82e5\u6fc0\u6d3b\u4e86dev\uff0ckey1\u7684\u503c\u4e3a\uff1aname: dev name 1\uff1bdescription: my description 1\u3002","title":"5.3 \u5408\u5e76\u590d\u6742\u7c7b\u578b"},{"location":"springboot/24.Application \u5c5e\u6027\u6587\u4ef6/#54-configurationproperties","text":"Spring Boot\u4f1a\u9a8c\u8bc1\u6dfb\u52a0\u4e86Spring @Validated \u6ce8\u89e3\u7684 @ConfigurationProperties \u7c7b\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528JSR-303 javax.validation \u7684\u6ce8\u89e3\u3002 @ConfigurationProperties ( prefix = \"acme\" ) @Validated public class AcmeProperties { @NotNull private InetAddress remoteAddress ; @Valid private final Security security = new Security (); // ... getters and setters public static class Security { @NotEmpty public String username ; // ... getters and setters } // ... getters and setters } \u5d4c\u5957\u5c5e\u6027\u6700\u597d\u52a0\u4e0a @Valid \u6ce8\u89e3\u3002 \u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u53eb\u505a configurationPropertiesValidator \u7684bean\u6765\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684Spring Validator \u3002 @Bean \u65b9\u6cd5\u9700\u8981\u58f0\u660e\u4e3a static \u3002 \u793a\u4f8b \u3002","title":"5.4 @ConfigurationProperties \u9a8c\u8bc1"},{"location":"springboot/25.Profiles/","text":"\u5927\u6982\u5c31\u662f\u73af\u5883\u7684\u610f\u601d\u3002 \u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u8fd9\u4e2a\u5c5e\u6027\u5206\u79bb\u4e0d\u540c\u7684\u73af\u5883\uff0c\u6bd4\u5982\u5f00\u53d1\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u3002 1.\u901a\u8fc7java\u4ee3\u7801\u914d\u7f6e\uff1a @Component \u548c @Configuration \u90fd\u53ef\u4ee5\u4f7f\u7528 @Profile \u6807\u8bb0\u3002\u4f8b\u5982\uff1a @Configuration @Profile ( \"production\" ) public class ProductionConfiguration { // ... } 2.\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\uff1a \u7f16\u5199 application-xxx.properties/.yml \u7684Profile\u6587\u4ef6\u3002 1. \u6fc0\u6d3b \u00b6 \u901a\u8fc7 spring.profiles.active \u73af\u5883\u914d\u7f6e\u6307\u5b9a\u6fc0\u6d3b\u54ea\u4e2aProfile\u3002 \u8fd9\u4e2a\u5c5e\u6027\u53ef\u4ee5\u901a\u8fc7\u4efb\u4f55\u914d\u7f6e\u65b9\u5f0f\u8fdb\u884c\u6307\u5b9a\u3002\u6bd4\u5982\u5199\u5728 application.properties \u4e2d\uff0c\u6216\u8ddf\u5728\u547d\u4ee4\u884c\u540e\u9762\uff1a spring.profiles.active = dev,hsqldb spring.profiles.include \u7528\u4e8e\u65e0\u6761\u4ef6\u7684\u6dfb\u52a0\u6fc0\u6d3bprofiles\u3002 \u4f8b\u5982\uff0c\u5f53\u4f7f\u7528 --spring.profiles.active=prod \u65f6\uff0c proddb and prodmq \u4e5f\u88ab\u6fc0\u6d3b\u4e86\uff1a spring.profiles : prod spring.profiles.include : - proddb - prodmq","title":"25.Profiles"},{"location":"springboot/25.Profiles/#1","text":"\u901a\u8fc7 spring.profiles.active \u73af\u5883\u914d\u7f6e\u6307\u5b9a\u6fc0\u6d3b\u54ea\u4e2aProfile\u3002 \u8fd9\u4e2a\u5c5e\u6027\u53ef\u4ee5\u901a\u8fc7\u4efb\u4f55\u914d\u7f6e\u65b9\u5f0f\u8fdb\u884c\u6307\u5b9a\u3002\u6bd4\u5982\u5199\u5728 application.properties \u4e2d\uff0c\u6216\u8ddf\u5728\u547d\u4ee4\u884c\u540e\u9762\uff1a spring.profiles.active = dev,hsqldb spring.profiles.include \u7528\u4e8e\u65e0\u6761\u4ef6\u7684\u6dfb\u52a0\u6fc0\u6d3bprofiles\u3002 \u4f8b\u5982\uff0c\u5f53\u4f7f\u7528 --spring.profiles.active=prod \u65f6\uff0c proddb and prodmq \u4e5f\u88ab\u6fc0\u6d3b\u4e86\uff1a spring.profiles : prod spring.profiles.include : - proddb - prodmq","title":"1. \u6fc0\u6d3b"},{"location":"springboot/26.\u65e5\u5fd7/","text":"\u4e3a Java Util Logging , Log4J2 , and Logback \u63d0\u4f9b\u4e86\u9ed8\u8ba4\u914d\u7f6e\uff08\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff09\u3002 \u5982\u679c\u4f60\u4f7f\u7528\u4e86\u201cStarters\u201d\uff0c\u4f1a\u4f7f\u7528 Logback \u4f5c\u4e3a\u4f60\u7684\u65e5\u5fd7\u7cfb\u7edf\u3002 1. \u63a7\u5236\u53f0\u8f93\u51fa \u00b6 \u65e5\u5fd7\u7ea7\u522b\u6709\u4e94\u79cd\uff1a ERROR , WARN , INFO , DEBUG , or TRACE . \u9ed8\u8ba4\u8f93\u51fa\u65e5\u5fd7\u7684\u7ea7\u522b\u6709 ERROR -level, WARN -level, and INFO -level\u3002 \u53ef\u5728\u542f\u52a8\u5e94\u7528\u65f6\u6dfb\u52a0\u9009\u9879\u6539\u53d8\uff1a $ java -jar myapp.jar --debug \u4e5f\u53ef\u4ee5\u5728 application.properties \u6587\u4ef6\u4e2d\u6539\u53d8\uff1a <debug/trace> = true 2. \u6587\u4ef6\u8f93\u51fa \u00b6 \u4f7f\u7528 logging.file or logging.path \u5c5e\u6027 \u6ce8\u610f \uff1a\u65e5\u5fd7\u7cfb\u7edf\u5728\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u7684\u65e9\u671f\u521d\u59cb\u5316\uff0c\u6545\u4e0d\u80fd\u901a\u8fc7\u4f7f\u7528 @PropertySource \u6ce8\u89e3\u627e\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u65e5\u5fd7\u5c5e\u6027\u3002 3. \u65e5\u5fd7\u7ea7\u522b \u00b6 \u6240\u6709\u652f\u6301\u7684\u65e5\u5fd7\u7cfb\u7edf\u90fd\u80fd\u5728spring\u7684\u73af\u5883\u4e2d\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u3002 logging.level.<logger-name>=<level> \uff0c level is one of TRACE, DEBUG, INFO, WARN, ERROR, FATAL, or OFF. root logger \u53ef\u901a\u8fc7 logging.level.root \u914d\u7f6e\u3002\u4f8b\uff1a logging.level.root = WARN logging.level.org.springframework.web = DEBUG logging.level.org.hibernate = ERROR 4. \u65e5\u5fd7\u7ec4 \u00b6 \u53ef\u5c06\u76f8\u5173\u7684logger\u7ec4\u6210\u4e00\u4e2a\u7ec4\uff0c\u5bf9\u7ec4\u8fdb\u884c\u7ea7\u522b\u8bbe\u7f6e\u3002 \u4f8b\uff0c\u5b9a\u4e49\u201ctomcat\u201d\u7ec4\uff0c\u6539\u53d8\u5176\u65e5\u5fd7\u7ea7\u522b\uff1a logging.group.tomcat = org.apache.catalina, org.apache.coyote, org.apache.tomcat logging.level.tomcat = TRACE springboot\u9884\u7f6e\u4e86\u4e24\u4e2a\u7ec4\uff1a Name Loggers web org.springframework.core.codec , org.springframework.http , org.springframework.web sql org.springframework.jdbc.core , org.hibernate.SQL 5. \u81ea\u5b9a\u4e49\u65e5\u5fd7\u914d\u7f6e \u00b6 \u901a\u8fc7\u5f15\u5165\u65e5\u5fd7\u7cfb\u7edf\u7684jar\u5305\u53ef\u6fc0\u6d3b\u591a\u79cd\u65e5\u5fd7\u7cfb\u7edf\u3002 \u4f8b\uff0c\u4f7f\u7528log4j2\u6765\u4f5c\u4e3a\u65e5\u5fd7\u7cfb\u7edf\uff1a1.\u6392\u9664\u201cstarter\u201d\u4e2d\u7684\u65e5\u5fd7\uff1b2.\u5bfc\u5165log4j2\u7684\u5305\uff1a <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> <!--\u4f7f\u7528log4j2\u9700\u8981\u5c06spring-boot-starter-logging\u6392\u9664--> <exclusions> <exclusion> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-logging </artifactId> </exclusion> </exclusions> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-log4j2 </artifactId> </dependency> \u901a\u8fc7\u5b9a\u4e49 logging.config \u5c5e\u6027\u6765\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u3002 \u4e0b\u8868\u662f\u53ef\u8bc6\u522b\u7684\u6587\u4ef6\uff1a Logging System Customization Logback logback-spring.xml , logback-spring.groovy , logback.xml , or logback.groovy Log4j2 log4j2-spring.xml or log4j2.xml JDK (Java Util Logging) logging.properties \u63a8\u8350\u4f7f\u7528 -spring \u53d8\u4f53\u3002","title":"26.\u65e5\u5fd7"},{"location":"springboot/26.\u65e5\u5fd7/#1","text":"\u65e5\u5fd7\u7ea7\u522b\u6709\u4e94\u79cd\uff1a ERROR , WARN , INFO , DEBUG , or TRACE . \u9ed8\u8ba4\u8f93\u51fa\u65e5\u5fd7\u7684\u7ea7\u522b\u6709 ERROR -level, WARN -level, and INFO -level\u3002 \u53ef\u5728\u542f\u52a8\u5e94\u7528\u65f6\u6dfb\u52a0\u9009\u9879\u6539\u53d8\uff1a $ java -jar myapp.jar --debug \u4e5f\u53ef\u4ee5\u5728 application.properties \u6587\u4ef6\u4e2d\u6539\u53d8\uff1a <debug/trace> = true","title":"1. \u63a7\u5236\u53f0\u8f93\u51fa"},{"location":"springboot/26.\u65e5\u5fd7/#2","text":"\u4f7f\u7528 logging.file or logging.path \u5c5e\u6027 \u6ce8\u610f \uff1a\u65e5\u5fd7\u7cfb\u7edf\u5728\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u7684\u65e9\u671f\u521d\u59cb\u5316\uff0c\u6545\u4e0d\u80fd\u901a\u8fc7\u4f7f\u7528 @PropertySource \u6ce8\u89e3\u627e\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u65e5\u5fd7\u5c5e\u6027\u3002","title":"2. \u6587\u4ef6\u8f93\u51fa"},{"location":"springboot/26.\u65e5\u5fd7/#3","text":"\u6240\u6709\u652f\u6301\u7684\u65e5\u5fd7\u7cfb\u7edf\u90fd\u80fd\u5728spring\u7684\u73af\u5883\u4e2d\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u3002 logging.level.<logger-name>=<level> \uff0c level is one of TRACE, DEBUG, INFO, WARN, ERROR, FATAL, or OFF. root logger \u53ef\u901a\u8fc7 logging.level.root \u914d\u7f6e\u3002\u4f8b\uff1a logging.level.root = WARN logging.level.org.springframework.web = DEBUG logging.level.org.hibernate = ERROR","title":"3. \u65e5\u5fd7\u7ea7\u522b"},{"location":"springboot/26.\u65e5\u5fd7/#4","text":"\u53ef\u5c06\u76f8\u5173\u7684logger\u7ec4\u6210\u4e00\u4e2a\u7ec4\uff0c\u5bf9\u7ec4\u8fdb\u884c\u7ea7\u522b\u8bbe\u7f6e\u3002 \u4f8b\uff0c\u5b9a\u4e49\u201ctomcat\u201d\u7ec4\uff0c\u6539\u53d8\u5176\u65e5\u5fd7\u7ea7\u522b\uff1a logging.group.tomcat = org.apache.catalina, org.apache.coyote, org.apache.tomcat logging.level.tomcat = TRACE springboot\u9884\u7f6e\u4e86\u4e24\u4e2a\u7ec4\uff1a Name Loggers web org.springframework.core.codec , org.springframework.http , org.springframework.web sql org.springframework.jdbc.core , org.hibernate.SQL","title":"4. \u65e5\u5fd7\u7ec4"},{"location":"springboot/26.\u65e5\u5fd7/#5","text":"\u901a\u8fc7\u5f15\u5165\u65e5\u5fd7\u7cfb\u7edf\u7684jar\u5305\u53ef\u6fc0\u6d3b\u591a\u79cd\u65e5\u5fd7\u7cfb\u7edf\u3002 \u4f8b\uff0c\u4f7f\u7528log4j2\u6765\u4f5c\u4e3a\u65e5\u5fd7\u7cfb\u7edf\uff1a1.\u6392\u9664\u201cstarter\u201d\u4e2d\u7684\u65e5\u5fd7\uff1b2.\u5bfc\u5165log4j2\u7684\u5305\uff1a <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> <!--\u4f7f\u7528log4j2\u9700\u8981\u5c06spring-boot-starter-logging\u6392\u9664--> <exclusions> <exclusion> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-logging </artifactId> </exclusion> </exclusions> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-log4j2 </artifactId> </dependency> \u901a\u8fc7\u5b9a\u4e49 logging.config \u5c5e\u6027\u6765\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u3002 \u4e0b\u8868\u662f\u53ef\u8bc6\u522b\u7684\u6587\u4ef6\uff1a Logging System Customization Logback logback-spring.xml , logback-spring.groovy , logback.xml , or logback.groovy Log4j2 log4j2-spring.xml or log4j2.xml JDK (Java Util Logging) logging.properties \u63a8\u8350\u4f7f\u7528 -spring \u53d8\u4f53\u3002","title":"5. \u81ea\u5b9a\u4e49\u65e5\u5fd7\u914d\u7f6e"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/","text":"1. Spring MVC \u81ea\u52a8\u914d\u7f6e 2. HttpMessageConverters 3. \u81ea\u5b9a\u4e49JSON \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 4. MessageCodesResolver 5. \u9519\u8bef\u5904\u7406 6. Spring HATEOAS 1. Spring WebFlux \u6846\u67b6 \u5927\u90e8\u5206web\u5e94\u7528\u4f7f\u7528 spring-boot-starter-web \u5c31\u591f\u4e86\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 spring-boot-starter-webflux \u6784\u5efa\u54cd\u5e94\u5f0f\u7684web\u5e94\u7528\u3002 1. Spring MVC \u81ea\u52a8\u914d\u7f6e \u00b6 \u5728Spring\u9ed8\u8ba4\u529f\u80fd\u4e0a\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u7279\u6027\uff1a Inclusion of\uff08\u5f15\u5165\uff09 ContentNegotiatingViewResolver and BeanNameViewResolver beans. Support for serving static resources, including support for WebJars (covered later in this document )). Automatic registration of Converter , GenericConverter , and Formatter beans. Support for HttpMessageConverters (covered later in this document ). Automatic registration of MessageCodesResolver (covered later in this document ). Static index.html support. Custom Favicon support (covered later in this document ). Automatic use of a ConfigurableWebBindingInitializer bean (covered later in this document ). \u5982\u679c\u60f3\u6dfb\u52a0\u989d\u5916\u7684 MVC configuration (interceptors, formatters, view controllers, and other features)\uff0c\u53ef\u4ee5\u6dfb\u52a0 WebMvcConfigurer \u7c7b\u578b\u7684 @Configuration \u7684\u7c7b\u5e76 \u4e0d\u8981\u6709 @EnableWebMvc \u3002\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684 RequestMappingHandlerMapping , RequestMappingHandlerAdapter , or ExceptionHandlerExceptionResolver \uff0c\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2a WebMvcRegistrationsAdapter \u7c7b\u578b\u7684\u3002 \u5982\u679c\u60f3\u8981\u5b8c\u5168\u7684\u63a7\u5236Spring MVC\uff0c\u5728@Configuration \u7c7b\u4e0a\u6dfb\u52a0 @EnableWebMvc \u6ce8\u89e3\u3002 2. HttpMessageConverters \u00b6 Spring MVC\u4f7f\u7528\u8be5\u63a5\u53e3\u8f6c\u6362HTTP requests\u548cresponses\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b57\u7b26\u4e32\u4f7f\u7528 UTF-8 \u7f16\u7801\u3002 \u4f7f\u7528Spring Boot\u7684 HttpMessageConverters \u7c7b\u6dfb\u52a0\u6216\u5b9a\u5236\u8f6c\u6362\u5668\uff1a import org.springframework.boot.autoconfigure.http.HttpMessageConverters ; import org.springframework.context.annotation.* ; import org.springframework.http.converter.* ; @Configuration public class MyConfiguration { @Bean public HttpMessageConverters customConverters () { HttpMessageConverter <?> additional = ... HttpMessageConverter <?> another = ... return new HttpMessageConverters ( additional , another ); } } \u5728\u4e0a\u4e0b\u6587\u4e2d\u5b58\u5728\u7684\u4efb\u4f55\u8f6c\u6362\u5668\u90fd\u4f1a\u88ab\u52a0\u5165\u5230\u8f6c\u6362\u5668\u5217\u8868\u4e2d\u3002\u4e5f\u53ef\u901a\u8fc7\u6b64\u65b9\u5f0f\u8986\u76d6\u9ed8\u8ba4\u7684\u8f6c\u6362\u5668\u3002 3. \u81ea\u5b9a\u4e49JSON \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316 \u00b6 \u9002\u7528\u4e8e Jackson \u3002\u76f4\u63a5\u5728 JsonSerializer or JsonDeserializer \u4e0a\u4f7f\u7528 @JsonComponent \uff0c\u4e5f\u53ef\u4ee5\u7528\u5728\u5c06\u4e24\u8005\u4f5c\u4e3a\u5185\u90e8\u7c7b\u7684\u7c7b\uff1a import java.io.* ; import com.fasterxml.jackson.core.* ; import com.fasterxml.jackson.databind.* ; import org.springframework.boot.jackson.* ; @JsonComponent public class Example { public static class Serializer extends JsonSerializer < SomeObject > { // ... } public static class Deserializer extends JsonDeserializer < SomeObject > { // ... } } 4. MessageCodesResolver \u00b6 TODO Spring MVC\u6709\u4e00\u7ec4\u751f\u6210\u9519\u8bef\u7801\u7684\u7b56\u7565\uff0c\u7528\u4e8e\u4ece\u7ed1\u5b9a\u9519\u8bef\u4e2d\u5448\u73b0\u9519\u8bef\u6d88\u606f\uff1aMessageCodesResolver\u3002 \u8bbe\u7f6e spring.mvc.message-codes-resolver.format \u5c5e\u6027 PREFIX_ERROR_CODE or POSTFIX_ERROR_CODE \uff0cSpring Boot\u4f1a\u7ed9\u4f60\u521b\u5efa\u4e00\u4e2a\u3002 5. \u9519\u8bef\u5904\u7406 \u00b6 Spring Boot\u9ed8\u8ba4\u63d0\u4f9b\u4e00\u4e2a /error \u6620\u5c04\u5904\u7406\u6240\u6709\u7684\u9519\u8bef\u3002\u5bf9\u4e8e\u6d4f\u89c8\u5668\uff0c\u662f\u4e00\u4e2ahtml\u683c\u5f0f\u7684 whitelabel \u9519\u8bef\u89c6\u56fe\u3002\u66ff\u6362\u9ed8\u8ba4\u884c\u4e3a\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u5b9e\u73b0 ErrorController \u5e76\u6ce8\u518c\u6210bean\u5b8c\u5168\u5730\u6539\u53d8\u8be5\u884c\u4e3a \u6dfb\u52a0 ErrorAttributes \u7c7b\u578b\u7684bean\u66ff\u6362\u6389\u5185\u5bb9 \u8fd8\u53ef\u4ee5\u4f7f\u7528 @ControllerAdvice \u6ce8\u89e3\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u6765\u4e3a\u4e00\u4e2a controller \u548c/\u6216\u8005\u5f02\u5e38\u7c7b\u578b\u81ea\u5b9a\u4e49\u8fd4\u56de\u7684JSON\u6587\u6863\uff1a @ControllerAdvice ( basePackageClasses = AcmeController . class ) public class AcmeControllerAdvice extends ResponseEntityExceptionHandler { @ExceptionHandler ( YourException . class ) @ResponseBody ResponseEntity <?> handleControllerException ( HttpServletRequest request , Throwable ex ) { HttpStatus status = getStatus ( request ); return new ResponseEntity <>( new CustomErrorType ( status . value (), ex . getMessage ()), status ); } private HttpStatus getStatus ( HttpServletRequest request ) { Integer statusCode = ( Integer ) request . getAttribute ( \"javax.servlet.error.status_code\" ); if ( statusCode == null ) { return HttpStatus . INTERNAL_SERVER_ERROR ; } return HttpStatus . valueOf ( statusCode ); } } \u5982\u679c\u8be5controller\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u4f1a\u4f7f\u7528 CustomErrorType POJO\u7684JSON\u8868\u793a\u800c\u4e0d\u662f ErrorAttributes \u8868\u793a\u3002 6. Spring HATEOAS \u00b6 \u5982\u679c\u6b63\u5728\u5f00\u53d1\u57fa\u4e8e\u8d85\u5a92\u4f53\u7684RESTful API\uff0c\u4f60\u53ef\u80fd\u9700\u8981Spring HATEOAS\uff0c\u800cSpring Boot\u4f1a\u4e3a\u5176\u63d0\u4f9b\u81ea\u52a8\u914d\u7f6e\u3002 \u81ea\u52a8\u914d\u7f6e\u53d6\u4ee3\u4e86 @EnableHypermediaSupport \uff0c\u53ea\u9700\u6ce8\u518c\u4e00\u5b9a\u6570\u91cf\u7684beans\u5c31\u80fd\u8f7b\u677e\u6784\u5efa\u57fa\u4e8e\u8d85\u5a92\u4f53\u7684\u5e94\u7528\uff0c\u8fd9\u4e9bbeans\u5305\u62ec LinkDiscoverers \uff08\u5ba2\u6237\u7aef\u652f\u6301\uff09\uff0c ObjectMapper \uff08\u7528\u4e8e\u5c06\u54cd\u5e94\u7f16\u6392\u4e3a\u60f3\u8981\u7684\u5f62\u5f0f\uff09\u3002 ObjectMapper \u53ef\u4ee5\u6839\u636e spring.jackson.* \u5c5e\u6027\u6216 Jackson2ObjectMapperBuilder bean\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002 \u901a\u8fc7\u6ce8\u89e3 @EnableHypermediaSupport \uff0c\u4f60\u53ef\u4ee5\u63a7\u5236Spring HATEOAS\u7684\u914d\u7f6e\uff0c\u4f46\u8fd9\u4f1a\u7981\u7528\u4e0a\u8ff0 ObjectMapper \u7684\u81ea\u5b9a\u4e49\u529f\u80fd\u3002 1. Spring WebFlux \u6846\u67b6 \u00b6 \u5728Spring5.0\u5f15\u5165\u7684\u65b0\u7684\u54cd\u5e94\u5f0f\u7684web\u6846\u67b6\u3002 \u4e0d\u50cfSpring MVC\uff0c\u5b83\u4e0d\u8981\u6c42Servlet API\uff0c\u5b8c\u5168\u5f02\u6b65\u3001\u975e\u963b\u585e\uff0c\u5e76\u901a\u8fc7 the Reactor project \u5b9e\u73b0\u4e86 Reactive Streams \u89c4\u8303\u3002 Spring WebFlux\u6709\u4e24\u79cd\u98ce\u683c\uff1a \u51fd\u6570\u5f0f \u6ce8\u89e3\u5f0f \u6ce8\u89e3\u5f0f\u98ce\u683c\u5f88\u50cfSpring MVC\u6a21\u5f0f\uff1a @RestController @RequestMapping ( \"/users\" ) public class MyRestController { @GetMapping ( \"/{user}\" ) public Mono < User > getUser ( @PathVariable Long user ) { // ... } @GetMapping ( \"/{user}/customers\" ) public Flux < Customer > getUserCustomers ( @PathVariable Long user ) { // ... } @DeleteMapping ( \"/{user}\" ) public Mono < User > deleteUser ( @PathVariable Long user ) { // ... } } \u51fd\u6570\u5f0f\u98ce\u683c\uff1a @Configuration public class RoutingConfiguration { @Bean public RouterFunction < ServerResponse > monoRouterFunction ( UserHandler userHandler ) { return route ( GET ( \"/{user}\" ). and ( accept ( APPLICATION_JSON )), userHandler :: getUser ) . andRoute ( GET ( \"/{user}/customers\" ). and ( accept ( APPLICATION_JSON )), userHandler :: getUserCustomers ) . andRoute ( DELETE ( \"/{user}\" ). and ( accept ( APPLICATION_JSON )), userHandler :: deleteUser ); } } @Component public class UserHandler { public Mono < ServerResponse > getUser ( ServerRequest request ) { // ... } public Mono < ServerResponse > getUserCustomers ( ServerRequest request ) { // ... } public Mono < ServerResponse > deleteUser ( ServerRequest request ) { // ... } } \u8be6\u60c5\u53c2\u8003 reference documentation \u3002 \u6dfb\u52a0 spring-boot-starter-webflux \uff0c\u53bb\u9664 spring-boot-starter-web \u3002","title":"29.\u5f00\u53d1web\u5e94\u7528"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#1-spring-mvc","text":"\u5728Spring\u9ed8\u8ba4\u529f\u80fd\u4e0a\u6dfb\u52a0\u4e86\u4ee5\u4e0b\u7279\u6027\uff1a Inclusion of\uff08\u5f15\u5165\uff09 ContentNegotiatingViewResolver and BeanNameViewResolver beans. Support for serving static resources, including support for WebJars (covered later in this document )). Automatic registration of Converter , GenericConverter , and Formatter beans. Support for HttpMessageConverters (covered later in this document ). Automatic registration of MessageCodesResolver (covered later in this document ). Static index.html support. Custom Favicon support (covered later in this document ). Automatic use of a ConfigurableWebBindingInitializer bean (covered later in this document ). \u5982\u679c\u60f3\u6dfb\u52a0\u989d\u5916\u7684 MVC configuration (interceptors, formatters, view controllers, and other features)\uff0c\u53ef\u4ee5\u6dfb\u52a0 WebMvcConfigurer \u7c7b\u578b\u7684 @Configuration \u7684\u7c7b\u5e76 \u4e0d\u8981\u6709 @EnableWebMvc \u3002\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684 RequestMappingHandlerMapping , RequestMappingHandlerAdapter , or ExceptionHandlerExceptionResolver \uff0c\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2a WebMvcRegistrationsAdapter \u7c7b\u578b\u7684\u3002 \u5982\u679c\u60f3\u8981\u5b8c\u5168\u7684\u63a7\u5236Spring MVC\uff0c\u5728@Configuration \u7c7b\u4e0a\u6dfb\u52a0 @EnableWebMvc \u6ce8\u89e3\u3002","title":"1. Spring MVC \u81ea\u52a8\u914d\u7f6e"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#2-httpmessageconverters","text":"Spring MVC\u4f7f\u7528\u8be5\u63a5\u53e3\u8f6c\u6362HTTP requests\u548cresponses\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b57\u7b26\u4e32\u4f7f\u7528 UTF-8 \u7f16\u7801\u3002 \u4f7f\u7528Spring Boot\u7684 HttpMessageConverters \u7c7b\u6dfb\u52a0\u6216\u5b9a\u5236\u8f6c\u6362\u5668\uff1a import org.springframework.boot.autoconfigure.http.HttpMessageConverters ; import org.springframework.context.annotation.* ; import org.springframework.http.converter.* ; @Configuration public class MyConfiguration { @Bean public HttpMessageConverters customConverters () { HttpMessageConverter <?> additional = ... HttpMessageConverter <?> another = ... return new HttpMessageConverters ( additional , another ); } } \u5728\u4e0a\u4e0b\u6587\u4e2d\u5b58\u5728\u7684\u4efb\u4f55\u8f6c\u6362\u5668\u90fd\u4f1a\u88ab\u52a0\u5165\u5230\u8f6c\u6362\u5668\u5217\u8868\u4e2d\u3002\u4e5f\u53ef\u901a\u8fc7\u6b64\u65b9\u5f0f\u8986\u76d6\u9ed8\u8ba4\u7684\u8f6c\u6362\u5668\u3002","title":"2. HttpMessageConverters"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#3-json","text":"\u9002\u7528\u4e8e Jackson \u3002\u76f4\u63a5\u5728 JsonSerializer or JsonDeserializer \u4e0a\u4f7f\u7528 @JsonComponent \uff0c\u4e5f\u53ef\u4ee5\u7528\u5728\u5c06\u4e24\u8005\u4f5c\u4e3a\u5185\u90e8\u7c7b\u7684\u7c7b\uff1a import java.io.* ; import com.fasterxml.jackson.core.* ; import com.fasterxml.jackson.databind.* ; import org.springframework.boot.jackson.* ; @JsonComponent public class Example { public static class Serializer extends JsonSerializer < SomeObject > { // ... } public static class Deserializer extends JsonDeserializer < SomeObject > { // ... } }","title":"3. \u81ea\u5b9a\u4e49JSON \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#4-messagecodesresolver","text":"TODO Spring MVC\u6709\u4e00\u7ec4\u751f\u6210\u9519\u8bef\u7801\u7684\u7b56\u7565\uff0c\u7528\u4e8e\u4ece\u7ed1\u5b9a\u9519\u8bef\u4e2d\u5448\u73b0\u9519\u8bef\u6d88\u606f\uff1aMessageCodesResolver\u3002 \u8bbe\u7f6e spring.mvc.message-codes-resolver.format \u5c5e\u6027 PREFIX_ERROR_CODE or POSTFIX_ERROR_CODE \uff0cSpring Boot\u4f1a\u7ed9\u4f60\u521b\u5efa\u4e00\u4e2a\u3002","title":"4. MessageCodesResolver"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#5","text":"Spring Boot\u9ed8\u8ba4\u63d0\u4f9b\u4e00\u4e2a /error \u6620\u5c04\u5904\u7406\u6240\u6709\u7684\u9519\u8bef\u3002\u5bf9\u4e8e\u6d4f\u89c8\u5668\uff0c\u662f\u4e00\u4e2ahtml\u683c\u5f0f\u7684 whitelabel \u9519\u8bef\u89c6\u56fe\u3002\u66ff\u6362\u9ed8\u8ba4\u884c\u4e3a\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u5b9e\u73b0 ErrorController \u5e76\u6ce8\u518c\u6210bean\u5b8c\u5168\u5730\u6539\u53d8\u8be5\u884c\u4e3a \u6dfb\u52a0 ErrorAttributes \u7c7b\u578b\u7684bean\u66ff\u6362\u6389\u5185\u5bb9 \u8fd8\u53ef\u4ee5\u4f7f\u7528 @ControllerAdvice \u6ce8\u89e3\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u6765\u4e3a\u4e00\u4e2a controller \u548c/\u6216\u8005\u5f02\u5e38\u7c7b\u578b\u81ea\u5b9a\u4e49\u8fd4\u56de\u7684JSON\u6587\u6863\uff1a @ControllerAdvice ( basePackageClasses = AcmeController . class ) public class AcmeControllerAdvice extends ResponseEntityExceptionHandler { @ExceptionHandler ( YourException . class ) @ResponseBody ResponseEntity <?> handleControllerException ( HttpServletRequest request , Throwable ex ) { HttpStatus status = getStatus ( request ); return new ResponseEntity <>( new CustomErrorType ( status . value (), ex . getMessage ()), status ); } private HttpStatus getStatus ( HttpServletRequest request ) { Integer statusCode = ( Integer ) request . getAttribute ( \"javax.servlet.error.status_code\" ); if ( statusCode == null ) { return HttpStatus . INTERNAL_SERVER_ERROR ; } return HttpStatus . valueOf ( statusCode ); } } \u5982\u679c\u8be5controller\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u4f1a\u4f7f\u7528 CustomErrorType POJO\u7684JSON\u8868\u793a\u800c\u4e0d\u662f ErrorAttributes \u8868\u793a\u3002","title":"5. \u9519\u8bef\u5904\u7406"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#6-spring-hateoas","text":"\u5982\u679c\u6b63\u5728\u5f00\u53d1\u57fa\u4e8e\u8d85\u5a92\u4f53\u7684RESTful API\uff0c\u4f60\u53ef\u80fd\u9700\u8981Spring HATEOAS\uff0c\u800cSpring Boot\u4f1a\u4e3a\u5176\u63d0\u4f9b\u81ea\u52a8\u914d\u7f6e\u3002 \u81ea\u52a8\u914d\u7f6e\u53d6\u4ee3\u4e86 @EnableHypermediaSupport \uff0c\u53ea\u9700\u6ce8\u518c\u4e00\u5b9a\u6570\u91cf\u7684beans\u5c31\u80fd\u8f7b\u677e\u6784\u5efa\u57fa\u4e8e\u8d85\u5a92\u4f53\u7684\u5e94\u7528\uff0c\u8fd9\u4e9bbeans\u5305\u62ec LinkDiscoverers \uff08\u5ba2\u6237\u7aef\u652f\u6301\uff09\uff0c ObjectMapper \uff08\u7528\u4e8e\u5c06\u54cd\u5e94\u7f16\u6392\u4e3a\u60f3\u8981\u7684\u5f62\u5f0f\uff09\u3002 ObjectMapper \u53ef\u4ee5\u6839\u636e spring.jackson.* \u5c5e\u6027\u6216 Jackson2ObjectMapperBuilder bean\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002 \u901a\u8fc7\u6ce8\u89e3 @EnableHypermediaSupport \uff0c\u4f60\u53ef\u4ee5\u63a7\u5236Spring HATEOAS\u7684\u914d\u7f6e\uff0c\u4f46\u8fd9\u4f1a\u7981\u7528\u4e0a\u8ff0 ObjectMapper \u7684\u81ea\u5b9a\u4e49\u529f\u80fd\u3002","title":"6. Spring HATEOAS"},{"location":"springboot/29.\u5f00\u53d1web\u5e94\u7528/#1-spring-webflux","text":"\u5728Spring5.0\u5f15\u5165\u7684\u65b0\u7684\u54cd\u5e94\u5f0f\u7684web\u6846\u67b6\u3002 \u4e0d\u50cfSpring MVC\uff0c\u5b83\u4e0d\u8981\u6c42Servlet API\uff0c\u5b8c\u5168\u5f02\u6b65\u3001\u975e\u963b\u585e\uff0c\u5e76\u901a\u8fc7 the Reactor project \u5b9e\u73b0\u4e86 Reactive Streams \u89c4\u8303\u3002 Spring WebFlux\u6709\u4e24\u79cd\u98ce\u683c\uff1a \u51fd\u6570\u5f0f \u6ce8\u89e3\u5f0f \u6ce8\u89e3\u5f0f\u98ce\u683c\u5f88\u50cfSpring MVC\u6a21\u5f0f\uff1a @RestController @RequestMapping ( \"/users\" ) public class MyRestController { @GetMapping ( \"/{user}\" ) public Mono < User > getUser ( @PathVariable Long user ) { // ... } @GetMapping ( \"/{user}/customers\" ) public Flux < Customer > getUserCustomers ( @PathVariable Long user ) { // ... } @DeleteMapping ( \"/{user}\" ) public Mono < User > deleteUser ( @PathVariable Long user ) { // ... } } \u51fd\u6570\u5f0f\u98ce\u683c\uff1a @Configuration public class RoutingConfiguration { @Bean public RouterFunction < ServerResponse > monoRouterFunction ( UserHandler userHandler ) { return route ( GET ( \"/{user}\" ). and ( accept ( APPLICATION_JSON )), userHandler :: getUser ) . andRoute ( GET ( \"/{user}/customers\" ). and ( accept ( APPLICATION_JSON )), userHandler :: getUserCustomers ) . andRoute ( DELETE ( \"/{user}\" ). and ( accept ( APPLICATION_JSON )), userHandler :: deleteUser ); } } @Component public class UserHandler { public Mono < ServerResponse > getUser ( ServerRequest request ) { // ... } public Mono < ServerResponse > getUserCustomers ( ServerRequest request ) { // ... } public Mono < ServerResponse > deleteUser ( ServerRequest request ) { // ... } } \u8be6\u60c5\u53c2\u8003 reference documentation \u3002 \u6dfb\u52a0 spring-boot-starter-webflux \uff0c\u53bb\u9664 spring-boot-starter-web \u3002","title":"1. Spring WebFlux \u6846\u67b6"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/","text":"1. \u6b22\u8fce\u4f7f\u7528Markdown\u7f16\u8f91\u5668 1.1 \u65b0\u7684\u6539\u53d8 1.2 \u529f\u80fd\u5feb\u6377\u952e 1.3 \u5408\u7406\u7684\u521b\u5efa\u6807\u9898\uff0c\u6709\u52a9\u4e8e\u76ee\u5f55\u7684\u751f\u6210 1.4 \u5982\u4f55\u6539\u53d8\u6587\u672c\u7684\u6837\u5f0f 1.5 \u63d2\u5165\u94fe\u63a5\u4e0e\u56fe\u7247 1.6 \u5982\u4f55\u63d2\u5165\u4e00\u6bb5\u6f02\u4eae\u7684\u4ee3\u7801\u7247 1.7 \u751f\u6210\u4e00\u4e2a\u9002\u5408\u4f60\u7684\u5217\u8868 1.8 \u521b\u5efa\u4e00\u4e2a\u8868\u683c 1.8.1 \u8bbe\u5b9a\u5185\u5bb9\u5c45\u4e2d\u3001\u5c45\u5de6\u3001\u5c45\u53f3 1.8.2 SmartyPants 1.9 \u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5217\u8868 1.10 \u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u6ce8\u811a 1.11 \u6ce8\u91ca\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684 1.12 KaTeX\u6570\u5b66\u516c\u5f0f 1.13 \u65b0\u7684\u7518\u7279\u56fe\u529f\u80fd\uff0c\u4e30\u5bcc\u4f60\u7684\u6587\u7ae0 1.14 UML \u56fe\u8868 1.15 FLowchart\u6d41\u7a0b\u56fe 1.16 \u5bfc\u51fa\u4e0e\u5bfc\u5165 1.16.1 \u5bfc\u51fa 1.16.2 \u5bfc\u5165 1. \u6b22\u8fce\u4f7f\u7528Markdown\u7f16\u8f91\u5668 \u00b6 \u4f60\u597d\uff01 \u8fd9\u662f\u4f60\u7b2c\u4e00\u6b21\u4f7f\u7528 Markdown\u7f16\u8f91\u5668 \u6240\u5c55\u793a\u7684\u6b22\u8fce\u9875\u3002\u5982\u679c\u4f60\u60f3\u5b66\u4e60\u5982\u4f55\u4f7f\u7528Markdown\u7f16\u8f91\u5668, \u53ef\u4ee5\u4ed4\u7ec6\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\uff0c\u4e86\u89e3\u4e00\u4e0bMarkdown\u7684\u57fa\u672c\u8bed\u6cd5\u77e5\u8bc6\u3002 1.1 \u65b0\u7684\u6539\u53d8 \u00b6 \u6211\u4eec\u5bf9Markdown\u7f16\u8f91\u5668\u8fdb\u884c\u4e86\u4e00\u4e9b\u529f\u80fd\u62d3\u5c55\u4e0e\u8bed\u6cd5\u652f\u6301\uff0c\u9664\u4e86\u6807\u51c6\u7684Markdown\u7f16\u8f91\u5668\u529f\u80fd\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u5982\u4e0b\u51e0\u70b9\u65b0\u529f\u80fd\uff0c\u5e2e\u52a9\u4f60\u7528\u5b83\u5199\u535a\u5ba2\uff1a \u5168\u65b0\u7684\u754c\u9762\u8bbe\u8ba1 \uff0c\u5c06\u4f1a\u5e26\u6765\u5168\u65b0\u7684\u5199\u4f5c\u4f53\u9a8c\uff1b \u5728\u521b\u4f5c\u4e2d\u5fc3\u8bbe\u7f6e\u4f60\u559c\u7231\u7684\u4ee3\u7801\u9ad8\u4eae\u6837\u5f0f\uff0cMarkdown \u5c06\u4ee3\u7801\u7247\u663e\u793a\u9009\u62e9\u7684\u9ad8\u4eae\u6837\u5f0f \u8fdb\u884c\u5c55\u793a\uff1b \u589e\u52a0\u4e86 \u56fe\u7247\u62d6\u62fd \u529f\u80fd\uff0c\u4f60\u53ef\u4ee5\u5c06\u672c\u5730\u7684\u56fe\u7247\u76f4\u63a5\u62d6\u62fd\u5230\u7f16\u8f91\u533a\u57df\u76f4\u63a5\u5c55\u793a\uff1b \u5168\u65b0\u7684 KaTeX\u6570\u5b66\u516c\u5f0f \u8bed\u6cd5\uff1b \u589e\u52a0\u4e86\u652f\u6301 \u7518\u7279\u56fe\u7684mermaid\u8bed\u6cd5 1 \u529f\u80fd\uff1b \u589e\u52a0\u4e86 \u591a\u5c4f\u5e55\u7f16\u8f91 Markdown\u6587\u7ae0\u529f\u80fd\uff1b \u589e\u52a0\u4e86 \u7126\u70b9\u5199\u4f5c\u6a21\u5f0f\u3001\u9884\u89c8\u6a21\u5f0f\u3001\u7b80\u6d01\u5199\u4f5c\u6a21\u5f0f\u3001\u5de6\u53f3\u533a\u57df\u540c\u6b65\u6eda\u8f6e\u8bbe\u7f6e \u7b49\u529f\u80fd\uff0c\u529f\u80fd\u6309\u94ae\u4f4d\u4e8e\u7f16\u8f91\u533a\u57df\u4e0e\u9884\u89c8\u533a\u57df\u4e2d\u95f4\uff1b \u589e\u52a0\u4e86 \u68c0\u67e5\u5217\u8868 \u529f\u80fd\u3002 1.2 \u529f\u80fd\u5feb\u6377\u952e \u00b6 \u64a4\u9500\uff1a Ctrl/Command + Z \u91cd\u505a\uff1a Ctrl/Command + Y \u52a0\u7c97\uff1a Ctrl/Command + B \u659c\u4f53\uff1a Ctrl/Command + I \u6807\u9898\uff1a Ctrl/Command + Shift + H \u65e0\u5e8f\u5217\u8868\uff1a Ctrl/Command + Shift + U \u6709\u5e8f\u5217\u8868\uff1a Ctrl/Command + Shift + O \u68c0\u67e5\u5217\u8868\uff1a Ctrl/Command + Shift + C \u63d2\u5165\u4ee3\u7801\uff1a Ctrl/Command + Shift + K \u63d2\u5165\u94fe\u63a5\uff1a Ctrl/Command + Shift + L \u63d2\u5165\u56fe\u7247\uff1a Ctrl/Command + Shift + G 1.3 \u5408\u7406\u7684\u521b\u5efa\u6807\u9898\uff0c\u6709\u52a9\u4e8e\u76ee\u5f55\u7684\u751f\u6210 \u00b6 \u76f4\u63a5\u8f93\u51651\u6b21 # \uff0c\u5e76\u6309\u4e0b space \u540e\uff0c\u5c06\u751f\u62101\u7ea7\u6807\u9898\u3002 \u8f93\u51652\u6b21 # \uff0c\u5e76\u6309\u4e0b space \u540e\uff0c\u5c06\u751f\u62102\u7ea7\u6807\u9898\u3002 \u4ee5\u6b64\u7c7b\u63a8\uff0c\u6211\u4eec\u652f\u63016\u7ea7\u6807\u9898\u3002\u6709\u52a9\u4e8e\u4f7f\u7528 TOC \u8bed\u6cd5\u540e\u751f\u6210\u4e00\u4e2a\u5b8c\u7f8e\u7684\u76ee\u5f55\u3002 1.4 \u5982\u4f55\u6539\u53d8\u6587\u672c\u7684\u6837\u5f0f \u00b6 \u5f3a\u8c03\u6587\u672c \u5f3a\u8c03\u6587\u672c \u52a0\u7c97\u6587\u672c \u52a0\u7c97\u6587\u672c ==\u6807\u8bb0\u6587\u672c== ~~\u5220\u9664\u6587\u672c~~ \u5f15\u7528\u6587\u672c H~2~O is\u662f\u6db2\u4f53\u3002 2^10^ \u8fd0\u7b97\u7ed3\u679c\u662f 1024. 1.5 \u63d2\u5165\u94fe\u63a5\u4e0e\u56fe\u7247 \u00b6 \u94fe\u63a5: link . \u56fe\u7247: \u5e26\u5c3a\u5bf8\u7684\u56fe\u7247: \u5c45\u4e2d\u7684\u56fe\u7247: \u5c45\u4e2d\u5e76\u4e14\u5e26\u5c3a\u5bf8\u7684\u56fe\u7247: \u5f53\u7136\uff0c\u6211\u4eec\u4e3a\u4e86\u8ba9\u7528\u6237\u66f4\u52a0\u4fbf\u6377\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u56fe\u7247\u62d6\u62fd\u529f\u80fd\u3002 1.6 \u5982\u4f55\u63d2\u5165\u4e00\u6bb5\u6f02\u4eae\u7684\u4ee3\u7801\u7247 \u00b6 \u53bb \u535a\u5ba2\u8bbe\u7f6e \u9875\u9762\uff0c\u9009\u62e9\u4e00\u6b3e\u4f60\u559c\u6b22\u7684\u4ee3\u7801\u7247\u9ad8\u4eae\u6837\u5f0f\uff0c\u4e0b\u9762\u5c55\u793a\u540c\u6837\u9ad8\u4eae\u7684 \u4ee3\u7801\u7247 . // An highlighted block var foo = 'bar' ; 1.7 \u751f\u6210\u4e00\u4e2a\u9002\u5408\u4f60\u7684\u5217\u8868 \u00b6 \u9879\u76ee \u9879\u76ee \u9879\u76ee \u9879\u76ee1 \u9879\u76ee2 \u9879\u76ee3 [ ] \u8ba1\u5212\u4efb\u52a1 [x] \u5b8c\u6210\u4efb\u52a1 1.8 \u521b\u5efa\u4e00\u4e2a\u8868\u683c \u00b6 \u4e00\u4e2a\u7b80\u5355\u7684\u8868\u683c\u662f\u8fd9\u4e48\u521b\u5efa\u7684\uff1a \u9879\u76ee | Value -------- | ----- \u7535\u8111 | $1600 \u624b\u673a | $12 \u5bfc\u7ba1 | $1 1.8.1 \u8bbe\u5b9a\u5185\u5bb9\u5c45\u4e2d\u3001\u5c45\u5de6\u3001\u5c45\u53f3 \u00b6 \u4f7f\u7528 :---------: \u5c45\u4e2d \u4f7f\u7528 :---------- \u5c45\u5de6 \u4f7f\u7528 ----------: \u5c45\u53f3 | \u7b2c\u4e00\u5217 | \u7b2c\u4e8c\u5217 | \u7b2c\u4e09\u5217 | |:-----------:| -------------:|:-------------| | \u7b2c\u4e00\u5217\u6587\u672c\u5c45\u4e2d | \u7b2c\u4e8c\u5217\u6587\u672c\u5c45\u53f3 | \u7b2c\u4e09\u5217\u6587\u672c\u5c45\u5de6 | 1.8.2 SmartyPants \u00b6 SmartyPants\u5c06ASCII\u6807\u70b9\u5b57\u7b26\u8f6c\u6362\u4e3a\u201c\u667a\u80fd\u201d\u5370\u5237\u6807\u70b9HTML\u5b9e\u4f53\u3002\u4f8b\u5982\uff1a | TYPE |ASCII |HTML |----------------|-------------------------------|-----------------------------| |Single backticks| 'Isn't this fun?' |'Isn't this fun?' | |Quotes | \"Isn't this fun?\" |\"Isn't this fun?\" | |Dashes | -- is en-dash, --- is em-dash |-- is en-dash, --- is em-dash| 1.9 \u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5217\u8868 \u00b6 Markdown : Text-to-HTML conversion tool Authors : John : Luke 1.10 \u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u6ce8\u811a \u00b6 \u4e00\u4e2a\u5177\u6709\u6ce8\u811a\u7684\u6587\u672c\u3002 2 1.11 \u6ce8\u91ca\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684 \u00b6 Markdown\u5c06\u6587\u672c\u8f6c\u6362\u4e3a HTML\u3002 *[HTML]: \u8d85\u6587\u672c\u6807\u8bb0\u8bed\u8a00 1.12 KaTeX\u6570\u5b66\u516c\u5f0f \u00b6 \u60a8\u53ef\u4ee5\u4f7f\u7528\u6e32\u67d3LaTeX\u6570\u5b66\u8868\u8fbe\u5f0f KaTeX : Gamma\u516c\u5f0f\u5c55\u793a $\\Gamma(n) = (n-1)!\\quad\\forall n\\in\\mathbb N$ \u662f\u901a\u8fc7\u6b27\u62c9\u79ef\u5206 $$ \\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,. $$ \u4f60\u53ef\u4ee5\u627e\u5230\u66f4\u591a\u5173\u4e8e\u7684\u4fe1\u606f LaTeX \u6570\u5b66\u8868\u8fbe\u5f0f here . 1.13 \u65b0\u7684\u7518\u7279\u56fe\u529f\u80fd\uff0c\u4e30\u5bcc\u4f60\u7684\u6587\u7ae0 \u00b6 gantt dateFormat YYYY - MM - DD title Adding GANTT diagram functionality to mermaid section \u73b0\u6709\u4efb\u52a1 \u5df2\u5b8c\u6210 : done , des1 , 2014 - 01 - 06 , 2014 - 01 - 08 \u8fdb\u884c\u4e2d : active , des2 , 2014 - 01 - 09 , 3 d \u8ba1\u5212\u4e00 : des3 , after des2 , 5 d \u8ba1\u5212\u4e8c : des4 , after des3 , 5 d \u5173\u4e8e \u7518\u7279\u56fe \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f , 1.14 UML \u56fe\u8868 \u00b6 \u53ef\u4ee5\u4f7f\u7528UML\u56fe\u8868\u8fdb\u884c\u6e32\u67d3\u3002 Mermaid . \u4f8b\u5982\u4e0b\u9762\u4ea7\u751f\u7684\u4e00\u4e2a\u5e8f\u5217\u56fe\uff1a: sequenceDiagram \u5f20\u4e09 ->> \u674e\u56db : \u4f60\u597d\uff01\u674e\u56db , \u6700\u8fd1\u600e\u4e48\u6837 ? \u674e\u56db -->>\u738b\u4e94: \u4f60\u6700\u8fd1\u600e\u4e48\u6837\uff0c\u738b\u4e94\uff1f \u674e\u56db --x \u5f20\u4e09: \u6211\u5f88\u597d\uff0c\u8c22\u8c22! \u674e\u56db - x \u738b\u4e94 : \u6211\u5f88\u597d\uff0c\u8c22\u8c22 ! Note right of \u738b\u4e94 : \u674e\u56db\u60f3\u4e86\u5f88\u957f\u65f6\u95f4 , \u6587\u5b57\u592a\u957f\u4e86 < br /> \u4e0d\u9002\u5408\u653e\u5728\u4e00\u884c . \u674e\u56db -->>\u5f20\u4e09: \u6253\u91cf\u7740\u738b\u4e94... \u5f20\u4e09 ->> \u738b\u4e94 : \u5f88\u597d ... \u738b\u4e94 , \u4f60\u600e\u4e48\u6837 ? \u8fd9\u5c06\u4ea7\u751f\u4e00\u4e2a\u6d41\u7a0b\u56fe\u3002: graph LR A [ \u957f\u65b9\u5f62 ] -- \u94fe\u63a5 --> B((\u5706)) A --> C(\u5706\u89d2\u957f\u65b9\u5f62) B --> D{\u83f1\u5f62} C --> D \u5173\u4e8e Mermaid \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f , 1.15 FLowchart\u6d41\u7a0b\u56fe \u00b6 \u6211\u4eec\u4f9d\u65e7\u4f1a\u652f\u6301flowchart\u7684\u6d41\u7a0b\u56fe\uff1a flowchat st => start : \u5f00\u59cb e => end : \u7ed3\u675f op => operation : \u6211\u7684\u64cd\u4f5c cond => condition : \u786e\u8ba4\uff1f st -> op -> cond cond ( yes ) -> e cond ( no ) -> op \u5173\u4e8e Flowchart\u6d41\u7a0b\u56fe \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f . 1.16 \u5bfc\u51fa\u4e0e\u5bfc\u5165 \u00b6 1.16.1 \u5bfc\u51fa \u00b6 \u5982\u679c\u4f60\u60f3\u5c1d\u8bd5\u4f7f\u7528\u6b64\u7f16\u8f91\u5668, \u4f60\u53ef\u4ee5\u5728\u6b64\u7bc7\u6587\u7ae0\u4efb\u610f\u7f16\u8f91\u3002\u5f53\u4f60\u5b8c\u6210\u4e86\u4e00\u7bc7\u6587\u7ae0\u7684\u5199\u4f5c, \u5728\u4e0a\u65b9\u5de5\u5177\u680f\u627e\u5230 \u6587\u7ae0\u5bfc\u51fa \uff0c\u751f\u6210\u4e00\u4e2a.md\u6587\u4ef6\u6216\u8005.html\u6587\u4ef6\u8fdb\u884c\u672c\u5730\u4fdd\u5b58\u3002 1.16.2 \u5bfc\u5165 \u00b6 \u5982\u679c\u4f60\u60f3\u52a0\u8f7d\u4e00\u7bc7\u4f60\u5199\u8fc7\u7684.md\u6587\u4ef6\u6216\u8005.html\u6587\u4ef6\uff0c\u5728\u4e0a\u65b9\u5de5\u5177\u680f\u53ef\u4ee5\u9009\u62e9\u5bfc\u5165\u529f\u80fd\u8fdb\u884c\u5bf9\u5e94\u6269\u5c55\u540d\u7684\u6587\u4ef6\u5bfc\u5165\uff0c \u7ee7\u7eed\u4f60\u7684\u521b\u4f5c\u3002 mermaid\u8bed\u6cd5\u8bf4\u660e \u21a9 \u6ce8\u811a\u7684\u89e3\u91ca \u21a9","title":"CSDN\u8bed\u6cd5"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#1-markdown","text":"\u4f60\u597d\uff01 \u8fd9\u662f\u4f60\u7b2c\u4e00\u6b21\u4f7f\u7528 Markdown\u7f16\u8f91\u5668 \u6240\u5c55\u793a\u7684\u6b22\u8fce\u9875\u3002\u5982\u679c\u4f60\u60f3\u5b66\u4e60\u5982\u4f55\u4f7f\u7528Markdown\u7f16\u8f91\u5668, \u53ef\u4ee5\u4ed4\u7ec6\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\uff0c\u4e86\u89e3\u4e00\u4e0bMarkdown\u7684\u57fa\u672c\u8bed\u6cd5\u77e5\u8bc6\u3002","title":"1. \u6b22\u8fce\u4f7f\u7528Markdown\u7f16\u8f91\u5668"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#11","text":"\u6211\u4eec\u5bf9Markdown\u7f16\u8f91\u5668\u8fdb\u884c\u4e86\u4e00\u4e9b\u529f\u80fd\u62d3\u5c55\u4e0e\u8bed\u6cd5\u652f\u6301\uff0c\u9664\u4e86\u6807\u51c6\u7684Markdown\u7f16\u8f91\u5668\u529f\u80fd\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u5982\u4e0b\u51e0\u70b9\u65b0\u529f\u80fd\uff0c\u5e2e\u52a9\u4f60\u7528\u5b83\u5199\u535a\u5ba2\uff1a \u5168\u65b0\u7684\u754c\u9762\u8bbe\u8ba1 \uff0c\u5c06\u4f1a\u5e26\u6765\u5168\u65b0\u7684\u5199\u4f5c\u4f53\u9a8c\uff1b \u5728\u521b\u4f5c\u4e2d\u5fc3\u8bbe\u7f6e\u4f60\u559c\u7231\u7684\u4ee3\u7801\u9ad8\u4eae\u6837\u5f0f\uff0cMarkdown \u5c06\u4ee3\u7801\u7247\u663e\u793a\u9009\u62e9\u7684\u9ad8\u4eae\u6837\u5f0f \u8fdb\u884c\u5c55\u793a\uff1b \u589e\u52a0\u4e86 \u56fe\u7247\u62d6\u62fd \u529f\u80fd\uff0c\u4f60\u53ef\u4ee5\u5c06\u672c\u5730\u7684\u56fe\u7247\u76f4\u63a5\u62d6\u62fd\u5230\u7f16\u8f91\u533a\u57df\u76f4\u63a5\u5c55\u793a\uff1b \u5168\u65b0\u7684 KaTeX\u6570\u5b66\u516c\u5f0f \u8bed\u6cd5\uff1b \u589e\u52a0\u4e86\u652f\u6301 \u7518\u7279\u56fe\u7684mermaid\u8bed\u6cd5 1 \u529f\u80fd\uff1b \u589e\u52a0\u4e86 \u591a\u5c4f\u5e55\u7f16\u8f91 Markdown\u6587\u7ae0\u529f\u80fd\uff1b \u589e\u52a0\u4e86 \u7126\u70b9\u5199\u4f5c\u6a21\u5f0f\u3001\u9884\u89c8\u6a21\u5f0f\u3001\u7b80\u6d01\u5199\u4f5c\u6a21\u5f0f\u3001\u5de6\u53f3\u533a\u57df\u540c\u6b65\u6eda\u8f6e\u8bbe\u7f6e \u7b49\u529f\u80fd\uff0c\u529f\u80fd\u6309\u94ae\u4f4d\u4e8e\u7f16\u8f91\u533a\u57df\u4e0e\u9884\u89c8\u533a\u57df\u4e2d\u95f4\uff1b \u589e\u52a0\u4e86 \u68c0\u67e5\u5217\u8868 \u529f\u80fd\u3002","title":"1.1 \u65b0\u7684\u6539\u53d8"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#12","text":"\u64a4\u9500\uff1a Ctrl/Command + Z \u91cd\u505a\uff1a Ctrl/Command + Y \u52a0\u7c97\uff1a Ctrl/Command + B \u659c\u4f53\uff1a Ctrl/Command + I \u6807\u9898\uff1a Ctrl/Command + Shift + H \u65e0\u5e8f\u5217\u8868\uff1a Ctrl/Command + Shift + U \u6709\u5e8f\u5217\u8868\uff1a Ctrl/Command + Shift + O \u68c0\u67e5\u5217\u8868\uff1a Ctrl/Command + Shift + C \u63d2\u5165\u4ee3\u7801\uff1a Ctrl/Command + Shift + K \u63d2\u5165\u94fe\u63a5\uff1a Ctrl/Command + Shift + L \u63d2\u5165\u56fe\u7247\uff1a Ctrl/Command + Shift + G","title":"1.2 \u529f\u80fd\u5feb\u6377\u952e"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#13","text":"\u76f4\u63a5\u8f93\u51651\u6b21 # \uff0c\u5e76\u6309\u4e0b space \u540e\uff0c\u5c06\u751f\u62101\u7ea7\u6807\u9898\u3002 \u8f93\u51652\u6b21 # \uff0c\u5e76\u6309\u4e0b space \u540e\uff0c\u5c06\u751f\u62102\u7ea7\u6807\u9898\u3002 \u4ee5\u6b64\u7c7b\u63a8\uff0c\u6211\u4eec\u652f\u63016\u7ea7\u6807\u9898\u3002\u6709\u52a9\u4e8e\u4f7f\u7528 TOC \u8bed\u6cd5\u540e\u751f\u6210\u4e00\u4e2a\u5b8c\u7f8e\u7684\u76ee\u5f55\u3002","title":"1.3 \u5408\u7406\u7684\u521b\u5efa\u6807\u9898\uff0c\u6709\u52a9\u4e8e\u76ee\u5f55\u7684\u751f\u6210"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#14","text":"\u5f3a\u8c03\u6587\u672c \u5f3a\u8c03\u6587\u672c \u52a0\u7c97\u6587\u672c \u52a0\u7c97\u6587\u672c ==\u6807\u8bb0\u6587\u672c== ~~\u5220\u9664\u6587\u672c~~ \u5f15\u7528\u6587\u672c H~2~O is\u662f\u6db2\u4f53\u3002 2^10^ \u8fd0\u7b97\u7ed3\u679c\u662f 1024.","title":"1.4 \u5982\u4f55\u6539\u53d8\u6587\u672c\u7684\u6837\u5f0f"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#15","text":"\u94fe\u63a5: link . \u56fe\u7247: \u5e26\u5c3a\u5bf8\u7684\u56fe\u7247: \u5c45\u4e2d\u7684\u56fe\u7247: \u5c45\u4e2d\u5e76\u4e14\u5e26\u5c3a\u5bf8\u7684\u56fe\u7247: \u5f53\u7136\uff0c\u6211\u4eec\u4e3a\u4e86\u8ba9\u7528\u6237\u66f4\u52a0\u4fbf\u6377\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u56fe\u7247\u62d6\u62fd\u529f\u80fd\u3002","title":"1.5 \u63d2\u5165\u94fe\u63a5\u4e0e\u56fe\u7247"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#16","text":"\u53bb \u535a\u5ba2\u8bbe\u7f6e \u9875\u9762\uff0c\u9009\u62e9\u4e00\u6b3e\u4f60\u559c\u6b22\u7684\u4ee3\u7801\u7247\u9ad8\u4eae\u6837\u5f0f\uff0c\u4e0b\u9762\u5c55\u793a\u540c\u6837\u9ad8\u4eae\u7684 \u4ee3\u7801\u7247 . // An highlighted block var foo = 'bar' ;","title":"1.6 \u5982\u4f55\u63d2\u5165\u4e00\u6bb5\u6f02\u4eae\u7684\u4ee3\u7801\u7247"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#17","text":"\u9879\u76ee \u9879\u76ee \u9879\u76ee \u9879\u76ee1 \u9879\u76ee2 \u9879\u76ee3 [ ] \u8ba1\u5212\u4efb\u52a1 [x] \u5b8c\u6210\u4efb\u52a1","title":"1.7 \u751f\u6210\u4e00\u4e2a\u9002\u5408\u4f60\u7684\u5217\u8868"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#18","text":"\u4e00\u4e2a\u7b80\u5355\u7684\u8868\u683c\u662f\u8fd9\u4e48\u521b\u5efa\u7684\uff1a \u9879\u76ee | Value -------- | ----- \u7535\u8111 | $1600 \u624b\u673a | $12 \u5bfc\u7ba1 | $1","title":"1.8 \u521b\u5efa\u4e00\u4e2a\u8868\u683c"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#181","text":"\u4f7f\u7528 :---------: \u5c45\u4e2d \u4f7f\u7528 :---------- \u5c45\u5de6 \u4f7f\u7528 ----------: \u5c45\u53f3 | \u7b2c\u4e00\u5217 | \u7b2c\u4e8c\u5217 | \u7b2c\u4e09\u5217 | |:-----------:| -------------:|:-------------| | \u7b2c\u4e00\u5217\u6587\u672c\u5c45\u4e2d | \u7b2c\u4e8c\u5217\u6587\u672c\u5c45\u53f3 | \u7b2c\u4e09\u5217\u6587\u672c\u5c45\u5de6 |","title":"1.8.1 \u8bbe\u5b9a\u5185\u5bb9\u5c45\u4e2d\u3001\u5c45\u5de6\u3001\u5c45\u53f3"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#182-smartypants","text":"SmartyPants\u5c06ASCII\u6807\u70b9\u5b57\u7b26\u8f6c\u6362\u4e3a\u201c\u667a\u80fd\u201d\u5370\u5237\u6807\u70b9HTML\u5b9e\u4f53\u3002\u4f8b\u5982\uff1a | TYPE |ASCII |HTML |----------------|-------------------------------|-----------------------------| |Single backticks| 'Isn't this fun?' |'Isn't this fun?' | |Quotes | \"Isn't this fun?\" |\"Isn't this fun?\" | |Dashes | -- is en-dash, --- is em-dash |-- is en-dash, --- is em-dash|","title":"1.8.2 SmartyPants"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#19","text":"Markdown : Text-to-HTML conversion tool Authors : John : Luke","title":"1.9 \u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5217\u8868"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#110","text":"\u4e00\u4e2a\u5177\u6709\u6ce8\u811a\u7684\u6587\u672c\u3002 2","title":"1.10 \u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u6ce8\u811a"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#111","text":"Markdown\u5c06\u6587\u672c\u8f6c\u6362\u4e3a HTML\u3002 *[HTML]: \u8d85\u6587\u672c\u6807\u8bb0\u8bed\u8a00","title":"1.11  \u6ce8\u91ca\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#112-katex","text":"\u60a8\u53ef\u4ee5\u4f7f\u7528\u6e32\u67d3LaTeX\u6570\u5b66\u8868\u8fbe\u5f0f KaTeX : Gamma\u516c\u5f0f\u5c55\u793a $\\Gamma(n) = (n-1)!\\quad\\forall n\\in\\mathbb N$ \u662f\u901a\u8fc7\u6b27\u62c9\u79ef\u5206 $$ \\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t}dt\\,. $$ \u4f60\u53ef\u4ee5\u627e\u5230\u66f4\u591a\u5173\u4e8e\u7684\u4fe1\u606f LaTeX \u6570\u5b66\u8868\u8fbe\u5f0f here .","title":"1.12 KaTeX\u6570\u5b66\u516c\u5f0f"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#113","text":"gantt dateFormat YYYY - MM - DD title Adding GANTT diagram functionality to mermaid section \u73b0\u6709\u4efb\u52a1 \u5df2\u5b8c\u6210 : done , des1 , 2014 - 01 - 06 , 2014 - 01 - 08 \u8fdb\u884c\u4e2d : active , des2 , 2014 - 01 - 09 , 3 d \u8ba1\u5212\u4e00 : des3 , after des2 , 5 d \u8ba1\u5212\u4e8c : des4 , after des3 , 5 d \u5173\u4e8e \u7518\u7279\u56fe \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f ,","title":"1.13 \u65b0\u7684\u7518\u7279\u56fe\u529f\u80fd\uff0c\u4e30\u5bcc\u4f60\u7684\u6587\u7ae0"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#114-uml","text":"\u53ef\u4ee5\u4f7f\u7528UML\u56fe\u8868\u8fdb\u884c\u6e32\u67d3\u3002 Mermaid . \u4f8b\u5982\u4e0b\u9762\u4ea7\u751f\u7684\u4e00\u4e2a\u5e8f\u5217\u56fe\uff1a: sequenceDiagram \u5f20\u4e09 ->> \u674e\u56db : \u4f60\u597d\uff01\u674e\u56db , \u6700\u8fd1\u600e\u4e48\u6837 ? \u674e\u56db -->>\u738b\u4e94: \u4f60\u6700\u8fd1\u600e\u4e48\u6837\uff0c\u738b\u4e94\uff1f \u674e\u56db --x \u5f20\u4e09: \u6211\u5f88\u597d\uff0c\u8c22\u8c22! \u674e\u56db - x \u738b\u4e94 : \u6211\u5f88\u597d\uff0c\u8c22\u8c22 ! Note right of \u738b\u4e94 : \u674e\u56db\u60f3\u4e86\u5f88\u957f\u65f6\u95f4 , \u6587\u5b57\u592a\u957f\u4e86 < br /> \u4e0d\u9002\u5408\u653e\u5728\u4e00\u884c . \u674e\u56db -->>\u5f20\u4e09: \u6253\u91cf\u7740\u738b\u4e94... \u5f20\u4e09 ->> \u738b\u4e94 : \u5f88\u597d ... \u738b\u4e94 , \u4f60\u600e\u4e48\u6837 ? \u8fd9\u5c06\u4ea7\u751f\u4e00\u4e2a\u6d41\u7a0b\u56fe\u3002: graph LR A [ \u957f\u65b9\u5f62 ] -- \u94fe\u63a5 --> B((\u5706)) A --> C(\u5706\u89d2\u957f\u65b9\u5f62) B --> D{\u83f1\u5f62} C --> D \u5173\u4e8e Mermaid \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f ,","title":"1.14 UML \u56fe\u8868"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#115-flowchart","text":"\u6211\u4eec\u4f9d\u65e7\u4f1a\u652f\u6301flowchart\u7684\u6d41\u7a0b\u56fe\uff1a flowchat st => start : \u5f00\u59cb e => end : \u7ed3\u675f op => operation : \u6211\u7684\u64cd\u4f5c cond => condition : \u786e\u8ba4\uff1f st -> op -> cond cond ( yes ) -> e cond ( no ) -> op \u5173\u4e8e Flowchart\u6d41\u7a0b\u56fe \u8bed\u6cd5\uff0c\u53c2\u8003 \u8fd9\u513f .","title":"1.15 FLowchart\u6d41\u7a0b\u56fe"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#116","text":"","title":"1.16 \u5bfc\u51fa\u4e0e\u5bfc\u5165"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#1161","text":"\u5982\u679c\u4f60\u60f3\u5c1d\u8bd5\u4f7f\u7528\u6b64\u7f16\u8f91\u5668, \u4f60\u53ef\u4ee5\u5728\u6b64\u7bc7\u6587\u7ae0\u4efb\u610f\u7f16\u8f91\u3002\u5f53\u4f60\u5b8c\u6210\u4e86\u4e00\u7bc7\u6587\u7ae0\u7684\u5199\u4f5c, \u5728\u4e0a\u65b9\u5de5\u5177\u680f\u627e\u5230 \u6587\u7ae0\u5bfc\u51fa \uff0c\u751f\u6210\u4e00\u4e2a.md\u6587\u4ef6\u6216\u8005.html\u6587\u4ef6\u8fdb\u884c\u672c\u5730\u4fdd\u5b58\u3002","title":"1.16.1  \u5bfc\u51fa"},{"location":"\u5176\u5b83/CSDN\u8bed\u6cd5/#1162","text":"\u5982\u679c\u4f60\u60f3\u52a0\u8f7d\u4e00\u7bc7\u4f60\u5199\u8fc7\u7684.md\u6587\u4ef6\u6216\u8005.html\u6587\u4ef6\uff0c\u5728\u4e0a\u65b9\u5de5\u5177\u680f\u53ef\u4ee5\u9009\u62e9\u5bfc\u5165\u529f\u80fd\u8fdb\u884c\u5bf9\u5e94\u6269\u5c55\u540d\u7684\u6587\u4ef6\u5bfc\u5165\uff0c \u7ee7\u7eed\u4f60\u7684\u521b\u4f5c\u3002 mermaid\u8bed\u6cd5\u8bf4\u660e \u21a9 \u6ce8\u811a\u7684\u89e3\u91ca \u21a9","title":"1.16.2 \u5bfc\u5165"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/","text":"1. \u6982\u5ff5 2. \u534f\u8bae\u6982\u8ff0 3. STOMP \u5e27 3.1 Body 3.2 \u6807\u51c6headers 3.2.1 Header content-length 3.2.2 Header content-type 3.2.3 Header receipt\uff08\u56de\u6267\uff09 3.3 \u91cd\u590d\u7684Header\u6761\u76ee 3.4 \u5c3a\u5bf8\u9650\u5236 3.5 Connection Lingering\uff08\u8fde\u63a5\u56de\u73af\uff09 4. \u8fde\u63a5 4.1 CONNECT or STOMP \u5e27 4.2 CONNECTED \u5e27 4.3 Protocol Negotiation\uff08\u534f\u8bae\u9009\u62e9\uff09 4.4 Heart-beating 5. Client Frames 5.1 SEND 5.2 SUBSCRIBE 5.2.1 SUBSCRIBE id Header 5.2.2 SUBSCRIBE ack Header 5.3 UNSUBSCRIBE 5.4 ACK 5.5 NACK 5.6 BEGIN 5.7 COMMIT 5.8 ABORT 5.9 DISCONNECT 6. Server Frames 6.1 MESSAGE 6.2 RECEIPT 6.3 ERROR stomp-specification-1.2 1. \u6982\u5ff5 \u00b6 STOMP\u662f\u7b80\u5355\uff08\u6216\u6d41\u5f0f\uff09\u6587\u672c\u5b9a\u5411\u6d88\u606f\u4f20\u9012\u534f\u8bae\uff0c\u65e8\u5728\u901a\u8fc7\u4e2d\u4ecb\u670d\u52a1\u5668\u5728\u5ba2\u6237\u7aef\u4e4b\u95f4\u4f20\u9012\u5f02\u6b65\u6d88\u606f\u3002 \u5b83\u4e3a\u5728\u8fd9\u4e9b\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u9012\u7684\u6d88\u606f\u5b9a\u4e49\u4e86\u57fa\u4e8e\u6587\u672c\u7684 wire-format \u3002 2. \u534f\u8bae\u6982\u8ff0 \u00b6 STOMP\u662f\u4e00\u79cd\u57fa\u4e8e\u5e27 frame \u7684\u534f\u8bae\uff0c\u5176\u5e27\u5728HTTP\u4e0a\u5efa\u6a21\u3002 \u4e00\u4e2a\u5e27\u5305\u62ec\uff1a \u4e00\u4e2a\u547d\u4ee4 command \u4e00\u7ec4\u53ef\u9009\u5934\u90e8 header \u4e00\u4e2a\u53ef\u9009\u4e3b\u4f53 body STOMP\u670d\u52a1\u5668 \u88ab\u5efa\u6a21\u4e3a\u53ef\u4ee5\u5411\u5176\u53d1\u9001\u6d88\u606f\u7684\u4e00\u7ec4\u76ee\u6807 destination \u3002STOMP\u534f\u8bae\u5c06\u76ee\u6807\u89c6\u4e3a\u4e0d\u900f\u660e\u5b57\u7b26\u4e32\uff0c\u5176\u8bed\u6cd5\u662f\u7279\u5b9a\u4e8e\u670d\u52a1\u5668\u5b9e\u73b0\u7684\u3002\u7740\u5c31\u5bfc\u81f4\u4e86\u76ee\u6807\u7684\u4f20\u9012\u6216\u201c\u6d88\u606f\u4ea4\u6362\u201d\u8bed\u4e49\u53ef\u80fd\u56e0\u670d\u52a1\u5668\u800c\u5f02\uff0c\u751a\u81f3\u4ece\u76ee\u6807\u5230\u76ee\u6807\u4e5f\u4e0d\u540c\u3002 STOMP\u5ba2\u6237\u7aef \u662f\u4e00\u4e2a\u7528\u6237\u4ee3\u7406\uff0c\u53ef\u4ee5\u5728\u4e24\u79cd\uff08\u53ef\u80fd\u662f\u540c\u65f6\u7684\uff09\u6a21\u5f0f\u4e0b\u8fd0\u884c\uff1a \u4f5c\u4e3a\u751f\u4ea7\u8005\uff0c\u901a\u8fc7\u4e00\u4e2a SEND \u5e27\u53d1\u9001\u4fe1\u606f\u5230\u670d\u52a1\u5668\u4e0a\u7684\u76ee\u6807\u3002 \u4f5c\u4e3a\u6d88\u8d39\u8005\uff0c\u5411\u4e00\u4e2a\u7ed9\u5b9a\u7684\u76ee\u6807\u53d1\u9001 SUBSCRIBE \u5e27\u5e76\u4ece\u670d\u52a1\u5668\u63a5\u6536\u6d88\u606f\u4f5c\u4e3a MESSAGE \u5e27\u3002 3. STOMP \u5e27 \u00b6 STOMP\u662f\u4e00\u79cd\u57fa\u4e8e\u5e27\u7684\u534f\u8bae\uff0c\u5b83\u5047\u5b9a\u4e0b\u9762\u6709\u4e00\u4e2a\u53ef\u9760\u7684 \u53cc\u5411\u6d41 \u7f51\u7edc\u534f\u8bae\uff08\u5982TCP\uff09\u3002\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5c06\u4f7f\u7528\u901a\u8fc7\u6d41\u53d1\u9001\u7684STOMP\u5e27\u8fdb\u884c\u901a\u4fe1\u3002\u5e27\u7ed3\u6784\uff1a COMMAND header1 : value1 header2 : value2 Body ^@ \u7b2c\u4e00\u90e8\u5206\uff1a\u4ee5\u4e00\u4e2a\u4ee5\u884c\u5c3e\uff08EOL\uff09\u7ed3\u5c3e\u7684\u547d\u4ee4\u5b57\u7b26\u4e32\u5f00\u59cb\uff0c\u8be5\u884c\u5305\u542b\u4e00\u4e2aOPTIONAL\u56de\u8f66\u7b26\uff08\u516b\u4f4d\u5b57\u828213\uff09\uff0c\u540e\u8ddf\u4e00\u4e2aREQUIRED\u6362\u884c\u7b26\uff08\u516b\u4f4d\u5b57\u828210\uff09\u3002 \u7b2c\u4e8c\u90e8\u5206\uff1a0\u4e2a\u6216\u591a\u4e2a : \u683c\u5f0f\u7684\u5934\u90e8\u6761\u76ee\u3002\u6bcf\u4e2a\u6761\u76ee\u540e\u8ddfEOL\u3002 \u7a7a\u884c\uff1a\u8868\u793a\u5934\u90e8\u7684\u7ed3\u675f\u548c\u4e3b\u4f53\u7684\u5f00\u59cb\u3002 \u7b2c\u4e09\u90e8\u5206\uff1a\u6b63\u6587\u3002\u540e\u8ddf NULL \u516b\u4f4d\u5b57\u8282\u3002\u672c\u6587\u6863\u4e2d\u7684\u793a\u4f8b\u5c06\u4f7f\u7528ASCII\u4e2d\u7684 ^@ \uff0ccontrol-@\u6765\u8868\u793aNULL\u516b\u4f4d\u5b57\u8282\u3002NULL\u516b\u4f4d\u5b57\u8282\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u8ddf\u968f\u591a\u4e2aEOL\u3002 \u672c\u6587\u6863\u4e2d\u5f15\u7528\u7684\u6240\u6709\u547d\u4ee4\u548c\u6807\u5934\u540d\u79f0\u90fd\u533a\u5206\u5927\u5c0f\u5199\u3002 \u9664CONNECT\u548cCONNECTED\u5e27\u4e4b\u5916\u7684\u6240\u6709\u5e27\u4e5f\u5c06\u8f6c\u4e49\u5728\u751f\u6210\u7684UTF-8\u7f16\u7801\u5934\u4e2d\u627e\u5230\u7684\u4efb\u4f55\u56de\u8f66\u7b26\uff0c\u6362\u884c\u7b26\u6216\u5192\u53f7\u3002C\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u6587\u5b57\u8f6c\u4e49\u7528\u4e8e\u7f16\u7801\u5728UTF-8\u7f16\u7801\u5934\u4e2d\u627e\u5230\u7684\u4efb\u4f55\u56de\u8f66\u7b26\uff0c\u6362\u884c\u7b26\u6216\u5192\u53f7\u3002 3.1 Body \u00b6 \u53ea\u6709 SEND , MESSAGE , and ERROR \u53ef\u80fd\u6709\u4e3b\u4f53\u3002\u5176\u5b83\u7684\u5e27\u7c7b\u578b\u4e0d\u5141\u8bb8\u3002 3.2 \u6807\u51c6headers \u00b6 \u53ef\u4ee5\u4f7f\u7528\u67d0\u4e9b\u6807\u9898\uff0c\u5e76\u4e14\u5bf9\u4e8e\u5927\u591a\u6570\u5e27\u5177\u6709\u7279\u6b8a\u542b\u4e49\u3002 3.2.1 Header content-length \u00b6 \u6240\u6709\u7684\u5e27\u90fd\u53ef\u80fd\u542b\u6709 content-length \u5934\u90e8\u3002\u662f\u4e00\u4e2a\u4ee5\u516b\u4f4d\u5b50\u8282\u8ba1\u7b97\u7684\u6d88\u606f\u4e3b\u4f53\u7684\u957f\u5ea6\u3002 \u5982\u679c\u5b58\u5728\u5e27\u4f53\uff0c\u5219 SEND\uff0cMESSAGE\u548cERROR \u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9\u957f\u5ea6\u5934\u4ee5\u4fbf\u4e8e\u5e27\u89e3\u6790\u3002\u5982\u679c\u5e27\u4f53\u5305\u542bNULL\u516b\u4f4d\u5b57\u8282\uff0c\u5219\u5e27\u5fc5\u987b\u5305\u542b\u5185\u5bb9\u957f\u5ea6\u5934\u90e8\u3002 3.2.2 Header content-type \u00b6 \u5982\u679c\u5b58\u5728\u5e27\u4f53\uff0c SEND\uff0cMESSAGE\u548cERROR \u5e27\u5e94\u8be5\u5305\u62ec\u4e00\u4e2a content-type \u7684\u5934\uff0c\u4ee5\u5e2e\u52a9\u5e27\u7684\u63a5\u6536\u8005\u89e3\u91ca\u5b83\u7684\u4e3b\u4f53\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 content-type \u6807\u5934\uff0c\u5219\u5176\u503c\u5fc5\u987b\u662f\u63cf\u8ff0\u6b63\u6587\u683c\u5f0f\u7684 MIME \u7c7b\u578b\u3002\u5426\u5219\uff0c\u63a5\u6536\u5668\u5e94\u8be5\u8ba4\u4e3a\u4e3b\u4f53\u662f\u4e8c\u8fdb\u5236blob\u3002 \u4ee5 text/ \u5f00\u5934\u7684MIME\u7c7b\u578b\u7684\u9690\u542b\u6587\u672c\u7f16\u7801\u662f UTF-8 \u3002\u5982\u679c\u4f7f\u7528\u5177\u6709\u4e0d\u540c\u7f16\u7801\u7684\u57fa\u4e8e\u6587\u672c\u7684MIME\u7c7b\u578b\uff0c\u90a3\u4e48\u60a8\u5e94\u8be5\u8ffd\u52a0 ;charset=<encoding> \u5230MIME\u7c7b\u578b\u3002 \u6240\u6709STOMP\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5fc5\u987b\u652f\u6301UTF-8\u7f16\u7801\u548c\u89e3\u7801\u3002 3.2.3 Header receipt\uff08\u56de\u6267\uff09 \u00b6 \u9664CONNECT\u4e4b\u5916\u7684\u4efb\u4f55\u5ba2\u6237\u7aef\u5e27\u90fd\u53ef\u4ee5\u6307\u5b9a\u5177\u6709\u4efb\u610f\u503c\u7684\u56de\u6267\u6807\u5934\u3002\u8fd9\u5c06\u4f7f\u670d\u52a1\u5668\u7528RECEIPT\u5e27\u786e\u8ba4\u5ba2\u6237\u5e27\u7684\u5904\u7406\u3002 SEND destination : / queue / a receipt : message - 12345 hello queue a ^ @ 3.3 \u91cd\u590d\u7684Header\u6761\u76ee \u00b6 STOMP\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7\u5728\u90ae\u4ef6\u4e2d\u6dfb\u52a0\u6807\u5934\u6216\u5728\u90ae\u4ef6\u4e2d\u5c31\u5730\u4fee\u6539\u6807\u5934\u6765\u201c\u66f4\u65b0\u201d\u6807\u5934\u503c\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u6536\u5230\u91cd\u590d\u7684\u5e27\u5934\u6761\u76ee\uff0c\u5219\u53ea\u5e94\u5c06\u7b2c\u4e00\u4e2a\u5934\u6761\u76ee\u7528\u4f5c\u5934\u6761\u76ee\u7684\u503c\u3002\u540e\u7eed\u503c\u4ec5\u7528\u4e8e\u7ef4\u62a4\u6807\u5934\u7684\u72b6\u6001\u66f4\u6539\u5386\u53f2\u8bb0\u5f55\uff0c\u53ef\u4ee5\u5ffd\u7565\u3002 3.4 \u5c3a\u5bf8\u9650\u5236 \u00b6 \u4e3a\u9632\u6b62\u6076\u610f\u5ba2\u6237\u7aef\u5229\u7528\u670d\u52a1\u5668\u4e2d\u7684\u5185\u5b58\u5206\u914d\uff0c\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u6700\u5927\u9650\u5236\uff1a the number of frame headers allowed in a single frame the maximum length of header lines the maximum size of a frame body \u5982\u679c\u8d85\u51fa\u8fd9\u4e9b\u9650\u5236\uff0c\u670d\u52a1\u5668\u5e94\u8be5\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a ERROR \u5e27\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002 3.5 Connection Lingering\uff08\u8fde\u63a5\u56de\u73af\uff09 \u00b6 STOMP\u670d\u52a1\u5668\u5fc5\u987b\u80fd\u591f\u652f\u6301\u5feb\u901f\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u3002 \u8fd9\u610f\u5473\u7740\u670d\u52a1\u5668\u53ef\u80fd\u53ea\u5141\u8bb8\u5728\u91cd\u7f6e\u8fde\u63a5\u4e4b\u524d\u77ed\u65f6\u95f4\u5185\u5173\u95ed\u8fde\u63a5\u3002 \u56e0\u6b64\uff0c\u5728\u91cd\u7f6e\u5957\u63a5\u5b57\u4e4b\u524d\uff0c\u5ba2\u6237\u7aef\u53ef\u80fd\u4e0d\u4f1a\u63a5\u6536\u670d\u52a1\u5668\u53d1\u9001\u7684\u6700\u540e\u4e00\u5e27\uff08\u4f8b\u5982\uff0cERROR\u5e27\u6216RECEIPT\u5e27\u4ee5\u56de\u590dDISCONNECT\u5e27\uff09\u3002 4. \u8fde\u63a5 \u00b6 STOMP\u5ba2\u6237\u7aef\u901a\u8fc7\u53d1\u9001 CONNECT \u5e27\u6765\u542f\u52a8\u5230\u670d\u52a1\u5668\u7684\u6d41\u6216TCP\u8fde\u63a5\uff1a CONNECT accept - version : 1 . 2 host : stomp . github . org ^ @ \u5982\u679c\u670d\u52a1\u5668\u63a5\u53d7\u8fde\u63a5\u5c1d\u8bd5\uff0c\u5b83\u5c06\u4f7f\u7528CONNECTED\u5e27\u8fdb\u884c\u54cd\u5e94\uff1a CONNECTED version : 1 . 2 ^@ \u670d\u52a1\u5668\u53ef\u4ee5\u62d2\u7edd\u4efb\u4f55\u8fde\u63a5\u5c1d\u8bd5\u3002\u670d\u52a1\u5668\u5e94\u8be5\u56de\u590d\u4e00\u4e2aERROR\u5e27\uff0c\u89e3\u91ca\u8fde\u63a5\u88ab\u62d2\u7edd\u7684\u539f\u56e0\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002 4.1 CONNECT or STOMP \u5e27 \u00b6 STOMP\u670d\u52a1\u5668\u5fc5\u987b\u4ee5\u4e0e CONNECT \u5e27\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406 STOMP \u5e27\u3002 CONNECT \u5e27\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\u4fdd\u7559\u7684\u5e27\u7c7b\u578b\u3002 STOMP \u5e27\u662fStomp1.2\u65b0\u7684\u5e27\u7c7b\u578b\uff0c\u4f18\u70b9\u662f\u534f\u8bae\u55c5\u63a2\u5668/\u9274\u522b\u5668\u5c06\u80fd\u591f\u533a\u5206STOMP\u8fde\u63a5\u548cHTTP\u8fde\u63a5\u3002 STOMP 1.2 \u5ba2\u6237\u7aef\u5fc5\u987b\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a accept-version \uff1a\u5ba2\u6237\u7aef\u652f\u6301\u7684STOMP\u534f\u8bae\u7248\u672c\u3002 host \uff1a\u5ba2\u6237\u7aef\u5e0c\u671b\u8fde\u63a5\u5230\u7684\u865a\u62df\u4e3b\u673a\u7684\u540d\u79f0\u3002\u5efa\u8bae\u5ba2\u6237\u7aef\u5c06\u6b64\u8bbe\u7f6e\u4e3a\u5efa\u7acb\u5957\u63a5\u5b57\u7684\u4e3b\u673a\u540d\uff0c\u6216\u8005\u8bbe\u7f6e\u4e3a\u4ed6\u4eec\u9009\u62e9\u7684\u4efb\u4f55\u540d\u79f0\u3002\u5982\u679c\u6b64\u6807\u5934\u4e0e\u5df2\u77e5\u865a\u62df\u4e3b\u673a\u4e0d\u5339\u914d\uff0c\u5219\u652f\u6301\u865a\u62df\u4e3b\u673a\u7684\u670d\u52a1\u5668\u53ef\u4ee5\u9009\u62e9\u9ed8\u8ba4\u865a\u62df\u4e3b\u673a\u6216\u62d2\u7edd\u8fde\u63a5\u3002 STOMP 1.2 \u5ba2\u6237\u7aef\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a login \uff1a\u7528\u4e8e\u5bf9\u5b89\u5168\u7684STOMP\u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u6807\u8bc6\u7b26\u3002 passcode \uff1a\u7528\u4e8e\u5bf9\u5b89\u5168\u7684STOMP\u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u5bc6\u7801\u3002 heart-beat \uff1a Heart-beating \u8bbe\u7f6e\u6216\u53c2\u8003\u4e0b\u6587\u3002 4.2 CONNECTED \u5e27 \u00b6 STOMP 1.2 \u670d\u52a1\u7aef\u5fc5\u987b\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a version \uff1a\u4f1a\u8bdd session \u5c06\u4f7f\u7528\u7684STOMP\u534f\u8bae\u7684\u7248\u672c\u3002 Protocol Negotiation \u6216\u53c2\u8003\u4e0b\u6587\u3002 STOMP 1.2 \u8bbf\u95ee\u7aef\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a heart-beat \uff1a Heart-beating \u8bbe\u7f6e\u6216\u53c2\u8003\u4e0b\u6587\u3002 session \uff1a\u552f\u4e00\u6807\u8bc6\u4f1a\u8bdd\u7684\u4f1a\u8bdd\u6807\u8bc6\u7b26\u3002 server \uff1a\u5305\u542bSTOMP\u670d\u52a1\u4fe1\u606f\u7684\u5b57\u6bb5\u3002\u8be5\u5b57\u6bb5\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u670d\u52a1\u5668\u540d\u79f0\u5b57\u6bb5\uff0c\u540e\u8ddf\u53ef\u9009\u7684\u6ce8\u91ca\u5b57\u6bb5\uff0c\u4f7f\u7528\u4e00\u4e2a\u7a7a\u683c\u5b57\u7b26\u5206\u9694\u3002 \u683c\u5f0f\uff1a server = name [\"/\" version] *(comment) \u4f8b\u5b50\uff1a server:Apache/1.3.9 4.3 Protocol Negotiation\uff08\u534f\u8bae\u9009\u62e9\uff09 \u00b6 \u4eceSTOMP 1.1\u5f00\u59cb\uff0c\u5ba2\u6237\u7aef CONNECT \u5e27\u5fc5\u987b\u5305\u542b accept-version \u5934\u90e8\uff0c\u4ee5\u9017\u53f7\u5206\u9694\u8868\u660e\u5b83\u652f\u6301\u7684\u7248\u672c\u3002\u82e5\u6ca1\u6709\u6b64\u5934\u90e8\u5219\u8868\u660e\u652f\u6301STOMP 1.0\u3002 \u4e24\u7aef\u90fd\u652f\u6301\u7684\u6700\u9ad8\u7248\u672c\u5c06\u7528\u4e8e\u540e\u7eed\u7684\u4f1a\u8bdd\u901a\u4fe1\u3002 \u4e3e\u4f8b\uff1a \u5ba2\u6237\u7aef\uff1a CONNECT accept - version : 1 . 0 , 1 . 1 , 2 . 0 host : stomp . github . org ^ @ \u670d\u52a1\u7aef\u4f1a\u54cd\u5e94\u8fd4\u56de\u4e00\u4e2a\u6700\u9ad8\u7248\u672c\u7684\u534f\u8bae\uff1a CONNECTED version : 1 . 1 ^@ \u5982\u679c\u6ca1\u6709\u4e24\u8005\u90fd\u652f\u6301\u7684\u7248\u672c\uff0c\u5219\u8fd4\u56de ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\uff1a ERROR version : 1 . 2 , 2 . 1 content - type : text / plain Supported protocol versions are 1 . 2 2 . 1 ^@ 4.4 Heart-beating \u00b6 \u5fc3\u8df3\u7528\u4e8e\u786e\u4fdd\u8fdc\u7a0b\u7aef\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u5e76\u4e14\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002 \u4e3a\u4e86\u5b9e\u73b0\u5fc3\u8df3\u673a\u5236\uff0c\u6bcf\u4e00\u65b9\u90fd\u5fc5\u987b\u58f0\u660e\u5b83\u80fd\u505a\u4ec0\u4e48\u4ee5\u53ca\u5b83\u5e0c\u671b\u5bf9\u65b9\u505a\u4ec0\u4e48\u3002\u5728 CONNECT and CONNECTED \u5e27\u6dfb\u52a0 heart-beat \u5934\u90e8\u3002 \u4f7f\u7528\u65f6\uff0c\u5fc3\u8df3\u5934\u90e8\u5fc5\u987b\u5305\u542b\u4e24\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6b63\u6574\u6570\uff1a \u7b2c\u4e00\u4e2a\u8868\u793a\u5e27\u7684\u53d1\u9001\u7aef\u53ef\u4ee5\u505a\u4ec0\u4e48 0\u8868\u793a\u65e0\u6cd5\u53d1\u9001\u5fc3\u8df3 \u5426\u5219\u5b83\u662f\u5fc3\u8df3\u4e4b\u95f4\u53ef\u4ee5\u4fdd\u8bc1\u7684\u6700\u5c0f\u6beb\u79d2\u6570 \u7b2c\u4e8c\u4e2a\u8868\u793a\u5e27\u7684\u53d1\u9001\u8005\u5e0c\u671b\u63a5\u6536\u5230\u4ec0\u4e48 0\u8868\u793a\u5b83\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3 \u5426\u5219\u5b83\u662f\u5fc3\u8df3\u4e4b\u95f4\u6240\u9700\u7684\u6beb\u79d2\u6570 \u7f3a\u5c11\u5fc3\u8df3\u6807\u9898\u5fc5\u987b\u4e0e heart-beat:0,0 \u6807\u9898\u4e00\u6837\u5bf9\u5f85\uff0c\u5373\uff1a\u4e0d\u80fd\u53d1\u9001\u5e76\u4e14\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3\u3002 CONNECT heart - beat : < cx > , < cy > CONNECTED : heart - beat : < sx > , < sy > \u5bf9\u4e8e\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7684\u5fc3\u8df3\uff1a \u5982\u679c \u4e3a0\uff08\u5ba2\u6237\u7aef\u65e0\u6cd5\u53d1\u9001\u5fc3\u8df3\uff09\u6216 \u4e3a0\uff08\u670d\u52a1\u5668\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3\uff09\u90a3\u4e48\u5c06\u6ca1\u6709\u5fc3\u8df3 \u5426\u5219\uff0c\u6bcf\u9694 MAX(<cx>\uff0c<sy>) \u6beb\u79d2\u5c31\u4f1a\u6709\u4e00\u6b21\u5fc3\u8df3 \u5bf9\u4e8e\u5176\u5b83\u65b9\u5411\u7684\u5fc3\u8df3\uff0c \u548c \u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u4f7f\u7528\u3002\uff1f\uff1f\uff1f \u5173\u4e8e\u5fc3\u8df3\u672c\u8eab\uff0c\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u63a5\u6536\u7684\u4efb\u4f55\u65b0\u6570\u636e\u90fd\u8868\u660e\u8fdc\u7a0b\u7aef\u662f\u6d3b\u7740\u7684\u3002\u5728\u7ed9\u5b9a\u7684\u65b9\u5411\u4e0a\uff0c\u5982\u679c\u6bcf\u9694 \u6beb\u79d2\u9700\u8981\u5fc3\u8df3\uff1a \u53d1\u9001\u65b9\u5fc5\u987b\u81f3\u5c11\u6bcf \u6beb\u79d2\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u53d1\u9001\u65b0\u6570\u636e \u5982\u679c\u53d1\u9001\u65b9\u6ca1\u6709\u8981\u53d1\u9001\u7684\u771f\u5b9eSTOMP\u5e27\uff0c\u5b83\u5fc5\u987b\u53d1\u9001\u4e00\u4e2a\u884c\u5c3e\uff08EOL\uff09 \u5982\u679c\uff0c\u5728\u4e00\u4e2a\u81f3\u5c11 \u6beb\u79d2\u7684\u65f6\u95f4\u7a97\u53e3\u5185\uff0c\u63a5\u6536\u5668\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u65b0\u6570\u636e\uff0c\u5b83\u53ef\u80fd\u8ba4\u4e3a\u8fde\u63a5\u5df2\u6b7b \u7531\u4e8e\u65f6\u5e8f\u4e0d\u51c6\u786e\uff0c\u63a5\u6536\u5668\u5e94\u8be5\u5bb9\u5fcd\u5e76\u8003\u8651\u8bef\u5dee\u8303\u56f4 5. Client Frames \u00b6 \u5ba2\u6237\u7aef\u4e5f\u8bb8\u4f1a\u53d1\u9001\u4e00\u4e2a\u4e0d\u5728\u4e0b\u6587\u4e2d\u7684\u5e27\uff0c\u4f46\u662f\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u54cd\u5e94\u4e00\u4e2a ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\u3002 5.1 SEND \u00b6 SEND \u5e27\u5c06\u6d88\u606f\u53d1\u9001\u5230\u6d88\u606f\u4f20\u9012\u7cfb\u7edf\u4e2d\u7684\u76ee\u6807\u3002 \u8981\u6c42\u6709\u4e00\u4e2a destination \u7684\u5934\u90e8\uff0c\u8868\u660e\u4e86\u53d1\u9001\u5230\u54ea\u91cc\u3002\u4e3b\u4f53\u662f\u8981\u53d1\u9001\u7684\u4fe1\u606f\u3002 \u4f8b\uff1a SEND destination : / queue / a content - type : text / plain hello queue a ^ @ Note STOMP\u5c06\u6b64\u76ee\u6807\u89c6\u4e3a\u4e0d\u900f\u660e\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u76ee\u6807\u540d\u79f0\u4e0d\u627f\u62c5\u4f20\u9012\u8bed\u4e49\u7684\u8d23\u4efb\u3002\u60a8\u5e94\u8be5\u67e5\u9605STOMP\u670d\u52a1\u5668\u7684\u6587\u6863\uff0c\u4ee5\u4e86\u89e3\u5982\u4f55\u6784\u9020\u76ee\u6807\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u4e3a\u60a8\u63d0\u4f9b\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u4f20\u9012\u8bed\u4e49\u3002 SEND\u652f\u6301\u5141\u8bb8\u4e8b\u52a1\u5730\u53d1\u9001\u7684 transaction \u6807\u5934\u3002 \u5e94\u8be5\u5305\u542b content-length \u548c content-type \u5934\u3002 \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5c06\u4efb\u610f\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u6dfb\u52a0\u5230SEND\u5e27\u3002\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u901a\u5e38\u7528\u4e8e\u5141\u8bb8\u4f7f\u7528\u8005\u4f7f\u7528 SUBSCRIBE \u5e27\u4e0a\u7684\u9009\u62e9\u5668\u57fa\u4e8e\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u6807\u5934\u8fc7\u6ee4\u6d88\u606f\u3002\u7528\u6237\u5b9a\u4e49\u7684\u5934\u5fc5\u987b\u5728 MESSAGE \u5e27\u4e2d\u4f20\u9012\u3002 \u5982\u679c\u670d\u52a1\u5668\u4e0d\u80fd\u5904\u7406 SEND \u5e27\uff0c\u5fc5\u987b\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u4e00\u4e2a ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\u3002 5.2 SUBSCRIBE \u00b6 SUBSCRIBE \u7528\u4e8e\u6ce8\u518c\u4ee5\u76d1\u542c\u7ed9\u5b9a\u7684\u76ee\u6807\u3002\u4e5f\u8981\u5305\u542b destination \u8868\u660e\u5ba2\u6237\u7aef\u60f3\u8981\u76d1\u542c\u54ea\u4e2a\u76ee\u6807\u3002 \u5728\u8ba2\u9605\u76ee\u6807\u4e0a\u63a5\u6536\u7684\u4efb\u4f55\u6d88\u606f\u6b64\u540e\u5c06\u4f5c\u4e3a MESSAGE \u5e27\u4ece\u670d\u52a1\u5668\u4f20\u9001\u5230\u5ba2\u6237\u7aef \u3002 ack \u6807\u5934\u63a7\u5236\u6d88\u606f\u786e\u8ba4\u6a21\u5f0f\u3002 \u4f8b\uff1a SUBSCRIBE id : 0 destination : / queue / foo ack : client ^@ \u5982\u679c\u670d\u52a1\u5668\u65e0\u6cd5\u6210\u529f\u521b\u5efa\u8ba2\u9605\uff0c\u5219\u670d\u52a1\u5668\u5fc5\u987b\u5411\u5ba2\u6237\u7aef\u53d1\u9001 ERROR \u5e27\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002 5.2.1 SUBSCRIBE id Header \u00b6 \u7531\u4e8e\u5355\u4e2a\u8fde\u63a5\u53ef\u4ee5\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u591a\u6b21\u8ba2\u9605\uff0c\u6545\u5fc5\u987b\u5728\u5e27\u4e2d\u5305\u542b\u4e00\u4e2a id \u5934\u4ee5\u552f\u4e00\u5730\u6807\u8bc6\u8ba2\u9605\u3002 5.2.2 SUBSCRIBE ack Header \u00b6 ack \u5934\u6709\u4e09\u79cd\u5408\u6cd5\u503c\uff1a auto \uff08\u9ed8\u8ba4\u503c\uff09 \u5ba2\u6237\u7aef\u65e0\u9700\u4e3a\u5b83\u6536\u5230\u7684\u4fe1\u606f\u5411\u670d\u52a1\u7aef\u53d1\u9001 ACK \u5e27\u3002\u6b64\u786e\u8ba4\u6a21\u5f0f\u53ef\u80fd\u5bfc\u81f4\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u7684\u6d88\u606f\u88ab\u4e22\u5f03\u3002 client \u5ba2\u6237\u7aef\u5fc5\u987b\u4e3a\u5b83\u6536\u5230\u7684\u4fe1\u606f\u5411\u670d\u52a1\u7aef\u53d1\u9001 ACK \u5e27\u3002\u5982\u679c\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u7684ACK\u5e27\u4e4b\u524d\u8fde\u63a5\u5931\u8d25\uff0c\u5219\u670d\u52a1\u5668\u5c06\u5047\u5b9a\u6d88\u606f\u5c1a\u672a\u5904\u7406\uff0c\u5e76\u4e14\u53ef\u4ee5\u5c06\u6d88\u606f\u91cd\u65b0\u53d1\u9001\u7ed9\u53e6\u4e00\u4e2a\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u53d1\u9001\u7684ACK\u5e27\u5c06\u88ab\u89c6\u4e3a \u7d2f\u79ef\u786e\u8ba4 \u3002\u8fd9\u610f\u5473\u7740\u786e\u8ba4\u64cd\u4f5c\u5bf9ACK\u5e27\u4e2d\u6307\u5b9a\u7684\u6d88\u606f\u4ee5\u53ca\u5728ACK\u6d88\u606f\u4e4b\u524d\u53d1\u9001\u5230\u8ba2\u9605\u7684\u6240\u6709\u6d88\u606f\u90fd\u6709\u6548\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u5904\u7406\u67d0\u4e9b\u6d88\u606f\uff0c\u5b83\u5e94\u8be5\u53d1\u9001 NACK \u5e27\u544a\u8bc9\u670d\u52a1\u5668\u5b83\u6ca1\u6709\u6d88\u8017\u8fd9\u4e9b\u6d88\u606f\u3002 client-individual \u3002 \u786e\u8ba4\u64cd\u4f5c\u5c31\u50cf\u5ba2\u6237\u7aef\u786e\u8ba4\u6a21\u5f0f\u4e00\u6837\uff0c\u9664\u4e86\u5ba2\u6237\u7aef\u53d1\u9001\u7684ACK\u6216NACK\u5e27\u4e0d\u662f\u7d2f\u79ef\u7684\u3002\u8fd9\u610f\u5473\u7740\u540e\u7eed\u6d88\u606f\u7684 ACK \u6216 NACK \u5e27\u4e0d\u5f97\u5bfc\u81f4\u5148\u524d\u7684\u6d88\u606f\u5f97\u5230\u786e\u8ba4\u3002 5.3 UNSUBSCRIBE \u00b6 UNSUBSCRIBE \u7528\u4e8e\u79fb\u9664\u5b58\u5728\u7684\u8ba2\u9605\u3002 id \u6807\u5934\u5fc5\u987b\u4e0e\u73b0\u6709\u8ba2\u9605\u7684\u8ba2\u9605\u6807\u8bc6\u7b26\u5339\u914d\u3002 \u4f8b\uff1a UNSUBSCRIBE id : 0 ^@ 5.4 ACK \u00b6 \u786e\u8ba4\u5ba2\u6237\u7aef\u6d88\u8d39\u4e86\u4fe1\u606f\uff08\u53c2\u8003 SUBSCRIBE ack Header \uff09\u3002\u5728\u901a\u8fc7ACK\u786e\u8ba4\u6d88\u606f\u4e4b\u524d\uff0c\u4e0d\u4f1a\u8ba4\u4e3a\u4ece\u6b64\u8ba2\u9605\u63a5\u6536\u7684\u4efb\u4f55\u6d88\u606f\u5df2\u88ab\u6d88\u8017\u3002 ACK\u5e27\u5fc5\u987b\u5305\u62ec\u4e0e\u6b63\u88ab\u786e\u8ba4\u7684 MESSAGE \u7684ack\u5934\u5339\u914d\u7684 id \u5934\u3002\u53ef\u9009\u5730\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e8b\u52a1\u5934 transaction \uff0c\u8868\u660e\u6d88\u606f\u786e\u8ba4\u5e94\u8be5\u662f\u547d\u540d\u4e8b\u52a1\u7684\u4e00\u90e8\u5206\u3002 ACK id : 12345 transaction : tx1 ^@ 5.5 NACK \u00b6 NACK \u4e0e ACK \u76f8\u53cd\u3002\u5b83\u7528\u4e8e\u544a\u8bc9\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u6ca1\u6709\u4f7f\u7528\u8be5\u6d88\u606f\u3002 \u7136\u540e\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u5c06\u6d88\u606f\u53d1\u9001\u5230\u5176\u4ed6\u5ba2\u6237\u7aef\uff0c\u4e22\u5f03\u5b83\uff0c\u6216\u5c06\u5176\u653e\u5165\u6b7b\u4fe1\u961f\u5217\u3002\u786e\u5207\u7684\u884c\u4e3a\u662f\u7279\u5b9a\u4e8e\u670d\u52a1\u5668\u7684\u3002 NACK\u91c7\u7528\u4e0eACK\u76f8\u540c\u7684\u6807\u5934\uff1a id \uff08\u5fc5\u9700\uff09\u548c transaction \uff08\u53ef\u9009\uff09\u3002 NACK\u4e5f\u540c\u6837\u9002\u7528 client-individual \u548c client \u786e\u8ba4\u6a21\u5f0f\u3002 5.6 BEGIN \u00b6 BEGIN \u7528\u4e8e\u542f\u52a8\u4e8b\u52a1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u4e8b\u52a1\u9002\u7528\u4e8e\u53d1\u9001\u548c\u786e\u8ba4\u2014\u2014\u5728\u4e8b\u52a1\u671f\u95f4\u53d1\u9001\u6216\u786e\u8ba4\u7684\u4efb\u4f55\u6d88\u606f\u5c06\u57fa\u4e8e\u4ee5\u539f\u5b50\u65b9\u5f0f\u5904\u7406\u3002 BEGIN transaction : tx1 ^@ \u4e8b\u52a1\u6807\u5934 transaction \u662f\u5fc5\u9700\u7684\uff0c\u4e8b\u52a1\u6807\u8bc6\u7b26\u5c06\u7528\u4e8e SEND\uff0cCOMMIT\uff0cABORT\uff0cACK\u548cNACK \u5e27\u4ee5\u5c06\u5b83\u4eec\u7ed1\u5b9a\u5230\u6307\u5b9a\u7684\u4e8b\u52a1\u3002\u5728\u540c\u4e00\u8fde\u63a5\u4e2d\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u5fc5\u987b\u4f7f\u7528\u4e0d\u540c\u7684\u4e8b\u52a1\u6807\u8bc6\u7b26\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001 DISCONNECT \u5e27\u6216 TCP\u8fde\u63a5 \u56e0\u4efb\u4f55\u539f\u56e0\u5931\u8d25\uff0c\u5219\u5c06\u9690\u5f0f\u4e2d\u6b62\u4efb\u4f55\u5c1a\u672a\u63d0\u4ea4\u7684\u5df2\u542f\u52a8\u4e8b\u52a1\u3002 5.7 COMMIT \u00b6 COMMIT \u7528\u4e8e\u63d0\u4ea4\u6b63\u5728\u8fdb\u884c\u7684\u4e8b\u52a1\u3002 COMMIT transaction : tx1 ^@ \u4e8b\u52a1\u5934\u662f\u5fc5\u9700\u7684\uff0c\u5e76\u4e14\u5fc5\u987b\u6307\u5b9a\u8981\u63d0\u4ea4\u7684\u4e8b\u52a1\u7684\u6807\u8bc6\u7b26\u3002 5.8 ABORT \u00b6 ABORT\u7528\u4e8e\u56de\u6eda\u6b63\u5728\u8fdb\u884c\u7684\u4e8b\u52a1\u3002 ABORT transaction : tx1 ^@ \u4e8b\u52a1\u5934\u662f\u5fc5\u9700\u7684\uff0c\u5e76\u4e14\u5fc5\u987b\u6307\u5b9a\u8981\u63d0\u4ea4\u7684\u4e8b\u52a1\u7684\u6807\u8bc6\u7b26\u3002 5.9 DISCONNECT \u00b6 \u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u5173\u95ed\u5957\u63a5\u5b57\u968f\u65f6\u65ad\u5f00\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u670d\u52a1\u5668\u5df2\u6536\u5230\u5148\u524d\u53d1\u9001\u7684\u5e27\u3002 \u8981\u8fdb\u884c\u6b63\u5e38\u5173\u95ed\uff08\u5ba2\u6237\u7aef\u786e\u4fdd\u670d\u52a1\u5668\u5df2\u6536\u5230\u6240\u6709\u5148\u524d\u7684\u5e27\uff09\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\uff1a \u53d1\u9001\u4e00\u4e2a\u5e26\u6709 receipt \u5934\u90e8\u7684 DISCONNECT \u5e27\u3002\u4f8b\uff1a DISCONNECT receipt : 77 ^ @ \u7b49\u5f85\u54cd\u5e94 DISCONNECT \u7684 RECEIPT \u5e27\u3002\u4f8b\uff1a RECEIPT receipt - id : 77 ^@ \u5173\u95edsocket\u3002 Warning \u5982\u679c\u670d\u52a1\u5668\u8fc7\u5feb\u5730\u5173\u95ed\u670d\u52a1\u5668\u7aef\u7684\u5957\u63a5\u5b57\uff0c\u5219\u5ba2\u6237\u7aef\u53ef\u80fd\u6c38\u8fdc\u4e0d\u4f1a\u6536\u5230\u9884\u671f\u7684RECEIPT\u5e27\u3002 Connection Lingering \u6216\u53c2\u8003\u4e0a\u6587\u3002 \u53d1\u9001DISCONNECT\u5e27\u540e\uff0c\u5ba2\u6237\u7aef\u4e0d\u5f97\u518d\u53d1\u9001\u4efb\u4f55\u5e27\u3002 6. Server Frames \u00b6 \u6709\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u5e27\uff08\u9664\u4e86\u521d\u59cb\u7684CONNECTED\u5e27\uff09\u3002 6.1 MESSAGE \u00b6 MESSAGE \u5e27\u7528\u4e8e\u5c06\u6d88\u606f\u4ece\u8ba2\u9605\u5904\u4f20\u9001\u5230\u5ba2\u6237\u7aef\u3002 \u5fc5\u987b\u5305\u542b\uff1a destination \u8868\u660e\u4fe1\u606f\u5c06\u8981\u53d1\u9001\u7684\u76ee\u6807\u7684\u5934\u90e8\uff1b message-id \u552f\u4e00\u6807\u8bc6\u5934\u90e8\uff1b subscription \u5934\u90e8\uff0c\u8868\u793a\u4e0e\u6b63\u5728\u63a5\u6536\u6d88\u606f\u7684\u8ba2\u9605\u7684\u6807\u8bc6\u7b26\u5339\u914d\u7684\u8ba2\u9605\u6807\u5934\u3002\u3002 \u82e5\u4ece\u8ba2\u9605\u5904\u63a5\u6536\u7684\u4fe1\u606f\u8981\u6c42\u5374\u8ba4\uff0c\u90a3\u4e48MESSAGE\u5e27\u5fc5\u987b\u5305\u542b\u5e26\u6709\u4efb\u610f\u503c\u7684 ack \u5934\u90e8\u3002 \u4e3b\u4f53\u90e8\u5206\u5305\u542b\u4fe1\u606f\u7684\u5185\u5bb9\u3002 # \u5ba2\u6237\u7aef\u8ba2\u9605 SUBSCRIBE id : 0 destination : / queue / a # \u670d\u52a1\u7aef\u63a5\u6536\u4fe1\u606f\u5e76\u53d1\u9001\u7ed9\u8ba2\u9605\u8005 MESSAGE subscription : 0 message - id : 007 destination : / queue / a content - type : text / plain hello queue a ^@ MESSAGE\u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9 content-length \u548c content-type \u6807\u9898\uff08\u5982\u679c\u5b58\u5728\u6b63\u6587\uff09\u3002 MESSAGE\u5e27\u8fd8\u5c06\u5305\u62ec\u5728\u5c06\u6d88\u606f\u53d1\u9001\u5230\u76ee\u7684\u5730\u65f6\u5b58\u5728\u7684\u6240\u6709\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u3002\u8bf7\u53c2\u9605\u670d\u52a1\u5668\u7684\u6587\u6863\uff0c\u627e\u51fa\u5b83\u6dfb\u52a0\u5230\u6d88\u606f\u4e2d\u7684\u670d\u52a1\u5668\u7279\u5b9a\u6807\u5934\u3002 6.2 RECEIPT \u00b6 \u4e00\u65e6\u670d\u52a1\u5668\u6210\u529f\u5904\u7406\u4e86\u8bf7\u6c42\u56de\u6267\u7684\u5ba2\u6237\u7aef\u5e27\uff0c\u5c31\u4f1a\u4ece\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001 RECEIPT \u5e27\u3002 \u5fc5\u987b\u5305\u542b receipt-id \u5934\u90e8\uff0c\u5176\u503c\u662f\u8bf7\u6c42\u56de\u6267\u7684\u5e27\u7684 receipt \u5934\u90e8\u503c\u3002 RECEIPT receipt - id : message - 12345 ^@ \u7531\u4e8eSTOMP\u662f\u57fa\u4e8e\u6d41\u7684\uff0c\u56e0\u6b64\u56de\u6267\u4e5f\u662f \u7d2f\u79ef\u786e\u8ba4 \uff08\u8ba4\u4e3a\u5148\u524d\u6240\u6709\u7684\u5e27\u90fd\u5df2\u7ecf\u88ab\u670d\u52a1\u5668\u63a5\u6536\u5230\u4e86\uff09\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u5148\u524d\u7684\u5e27\u53ef\u80fd\u5c1a\u672a\u5b8c\u5168\u5904\u7406\u3002\u5982\u679c\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\uff0c\u4ee5\u524d\u63a5\u6536\u7684\u5e27\u5e94\u8be5\u7ee7\u7eed\u7531\u670d\u52a1\u5668\u5904\u7406\u3002 6.3 ERROR \u00b6 \u5982\u679c\u51fa\u73b0\u95ee\u9898\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u53d1\u9001 ERROR \u5e27\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u5fc5\u987b\u5728\u53d1\u9001ERROR\u5e27\u540e\u7acb\u5373\u5173\u95ed\u8fde\u63a5\u3002 ERROR\u5e27\u5e94\u8be5\u5305\u542b\u4e00\u4e2a\u5e26\u6709\u9519\u8bef\u7b80\u77ed\u63cf\u8ff0\u7684 message \u5934\u90e8\uff0c\u5e76\u4e14\u6b63\u6587\u53ef\u4ee5\u5305\u542b\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff08\u6216\u8005\u53ef\u4ee5\u4e3a\u7a7a\uff09\u3002 ERROR receipt - id : message - 12345 content - type : text / plain content - length : 171 message : malformed frame received The message : ----- MESSAGE destined : / queue / a receipt : message - 12345 Hello queue a ! ----- Did not contain a destination header , which is REQUIRED for message propagation . ^ @ \u5982\u679c\u9519\u8bef\u4e0e\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u7279\u5b9a\u5e27\u6709\u5173\uff0c\u5219\u670d\u52a1\u5668\u5e94\u8be5\u6dfb\u52a0\u989d\u5916\u7684\u6807\u5934\u4ee5\u5e2e\u52a9\u8bc6\u522b\u5bfc\u81f4\u9519\u8bef\u7684\u539f\u59cb\u5e27\u3002 ERROR\u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9 content-length \u548c content-type \u6807\u9898\uff08\u5982\u679c\u5b58\u5728\u6b63\u6587\uff09\u3002","title":"Stomp\u534f\u8bae"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#1","text":"STOMP\u662f\u7b80\u5355\uff08\u6216\u6d41\u5f0f\uff09\u6587\u672c\u5b9a\u5411\u6d88\u606f\u4f20\u9012\u534f\u8bae\uff0c\u65e8\u5728\u901a\u8fc7\u4e2d\u4ecb\u670d\u52a1\u5668\u5728\u5ba2\u6237\u7aef\u4e4b\u95f4\u4f20\u9012\u5f02\u6b65\u6d88\u606f\u3002 \u5b83\u4e3a\u5728\u8fd9\u4e9b\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u9012\u7684\u6d88\u606f\u5b9a\u4e49\u4e86\u57fa\u4e8e\u6587\u672c\u7684 wire-format \u3002","title":"1. \u6982\u5ff5"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#2","text":"STOMP\u662f\u4e00\u79cd\u57fa\u4e8e\u5e27 frame \u7684\u534f\u8bae\uff0c\u5176\u5e27\u5728HTTP\u4e0a\u5efa\u6a21\u3002 \u4e00\u4e2a\u5e27\u5305\u62ec\uff1a \u4e00\u4e2a\u547d\u4ee4 command \u4e00\u7ec4\u53ef\u9009\u5934\u90e8 header \u4e00\u4e2a\u53ef\u9009\u4e3b\u4f53 body STOMP\u670d\u52a1\u5668 \u88ab\u5efa\u6a21\u4e3a\u53ef\u4ee5\u5411\u5176\u53d1\u9001\u6d88\u606f\u7684\u4e00\u7ec4\u76ee\u6807 destination \u3002STOMP\u534f\u8bae\u5c06\u76ee\u6807\u89c6\u4e3a\u4e0d\u900f\u660e\u5b57\u7b26\u4e32\uff0c\u5176\u8bed\u6cd5\u662f\u7279\u5b9a\u4e8e\u670d\u52a1\u5668\u5b9e\u73b0\u7684\u3002\u7740\u5c31\u5bfc\u81f4\u4e86\u76ee\u6807\u7684\u4f20\u9012\u6216\u201c\u6d88\u606f\u4ea4\u6362\u201d\u8bed\u4e49\u53ef\u80fd\u56e0\u670d\u52a1\u5668\u800c\u5f02\uff0c\u751a\u81f3\u4ece\u76ee\u6807\u5230\u76ee\u6807\u4e5f\u4e0d\u540c\u3002 STOMP\u5ba2\u6237\u7aef \u662f\u4e00\u4e2a\u7528\u6237\u4ee3\u7406\uff0c\u53ef\u4ee5\u5728\u4e24\u79cd\uff08\u53ef\u80fd\u662f\u540c\u65f6\u7684\uff09\u6a21\u5f0f\u4e0b\u8fd0\u884c\uff1a \u4f5c\u4e3a\u751f\u4ea7\u8005\uff0c\u901a\u8fc7\u4e00\u4e2a SEND \u5e27\u53d1\u9001\u4fe1\u606f\u5230\u670d\u52a1\u5668\u4e0a\u7684\u76ee\u6807\u3002 \u4f5c\u4e3a\u6d88\u8d39\u8005\uff0c\u5411\u4e00\u4e2a\u7ed9\u5b9a\u7684\u76ee\u6807\u53d1\u9001 SUBSCRIBE \u5e27\u5e76\u4ece\u670d\u52a1\u5668\u63a5\u6536\u6d88\u606f\u4f5c\u4e3a MESSAGE \u5e27\u3002","title":"2. \u534f\u8bae\u6982\u8ff0"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#3-stomp","text":"STOMP\u662f\u4e00\u79cd\u57fa\u4e8e\u5e27\u7684\u534f\u8bae\uff0c\u5b83\u5047\u5b9a\u4e0b\u9762\u6709\u4e00\u4e2a\u53ef\u9760\u7684 \u53cc\u5411\u6d41 \u7f51\u7edc\u534f\u8bae\uff08\u5982TCP\uff09\u3002\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5c06\u4f7f\u7528\u901a\u8fc7\u6d41\u53d1\u9001\u7684STOMP\u5e27\u8fdb\u884c\u901a\u4fe1\u3002\u5e27\u7ed3\u6784\uff1a COMMAND header1 : value1 header2 : value2 Body ^@ \u7b2c\u4e00\u90e8\u5206\uff1a\u4ee5\u4e00\u4e2a\u4ee5\u884c\u5c3e\uff08EOL\uff09\u7ed3\u5c3e\u7684\u547d\u4ee4\u5b57\u7b26\u4e32\u5f00\u59cb\uff0c\u8be5\u884c\u5305\u542b\u4e00\u4e2aOPTIONAL\u56de\u8f66\u7b26\uff08\u516b\u4f4d\u5b57\u828213\uff09\uff0c\u540e\u8ddf\u4e00\u4e2aREQUIRED\u6362\u884c\u7b26\uff08\u516b\u4f4d\u5b57\u828210\uff09\u3002 \u7b2c\u4e8c\u90e8\u5206\uff1a0\u4e2a\u6216\u591a\u4e2a : \u683c\u5f0f\u7684\u5934\u90e8\u6761\u76ee\u3002\u6bcf\u4e2a\u6761\u76ee\u540e\u8ddfEOL\u3002 \u7a7a\u884c\uff1a\u8868\u793a\u5934\u90e8\u7684\u7ed3\u675f\u548c\u4e3b\u4f53\u7684\u5f00\u59cb\u3002 \u7b2c\u4e09\u90e8\u5206\uff1a\u6b63\u6587\u3002\u540e\u8ddf NULL \u516b\u4f4d\u5b57\u8282\u3002\u672c\u6587\u6863\u4e2d\u7684\u793a\u4f8b\u5c06\u4f7f\u7528ASCII\u4e2d\u7684 ^@ \uff0ccontrol-@\u6765\u8868\u793aNULL\u516b\u4f4d\u5b57\u8282\u3002NULL\u516b\u4f4d\u5b57\u8282\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u8ddf\u968f\u591a\u4e2aEOL\u3002 \u672c\u6587\u6863\u4e2d\u5f15\u7528\u7684\u6240\u6709\u547d\u4ee4\u548c\u6807\u5934\u540d\u79f0\u90fd\u533a\u5206\u5927\u5c0f\u5199\u3002 \u9664CONNECT\u548cCONNECTED\u5e27\u4e4b\u5916\u7684\u6240\u6709\u5e27\u4e5f\u5c06\u8f6c\u4e49\u5728\u751f\u6210\u7684UTF-8\u7f16\u7801\u5934\u4e2d\u627e\u5230\u7684\u4efb\u4f55\u56de\u8f66\u7b26\uff0c\u6362\u884c\u7b26\u6216\u5192\u53f7\u3002C\u98ce\u683c\u7684\u5b57\u7b26\u4e32\u6587\u5b57\u8f6c\u4e49\u7528\u4e8e\u7f16\u7801\u5728UTF-8\u7f16\u7801\u5934\u4e2d\u627e\u5230\u7684\u4efb\u4f55\u56de\u8f66\u7b26\uff0c\u6362\u884c\u7b26\u6216\u5192\u53f7\u3002","title":"3. STOMP \u5e27"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#31-body","text":"\u53ea\u6709 SEND , MESSAGE , and ERROR \u53ef\u80fd\u6709\u4e3b\u4f53\u3002\u5176\u5b83\u7684\u5e27\u7c7b\u578b\u4e0d\u5141\u8bb8\u3002","title":"3.1 Body"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#32-headers","text":"\u53ef\u4ee5\u4f7f\u7528\u67d0\u4e9b\u6807\u9898\uff0c\u5e76\u4e14\u5bf9\u4e8e\u5927\u591a\u6570\u5e27\u5177\u6709\u7279\u6b8a\u542b\u4e49\u3002","title":"3.2 \u6807\u51c6headers"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#321-header-content-length","text":"\u6240\u6709\u7684\u5e27\u90fd\u53ef\u80fd\u542b\u6709 content-length \u5934\u90e8\u3002\u662f\u4e00\u4e2a\u4ee5\u516b\u4f4d\u5b50\u8282\u8ba1\u7b97\u7684\u6d88\u606f\u4e3b\u4f53\u7684\u957f\u5ea6\u3002 \u5982\u679c\u5b58\u5728\u5e27\u4f53\uff0c\u5219 SEND\uff0cMESSAGE\u548cERROR \u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9\u957f\u5ea6\u5934\u4ee5\u4fbf\u4e8e\u5e27\u89e3\u6790\u3002\u5982\u679c\u5e27\u4f53\u5305\u542bNULL\u516b\u4f4d\u5b57\u8282\uff0c\u5219\u5e27\u5fc5\u987b\u5305\u542b\u5185\u5bb9\u957f\u5ea6\u5934\u90e8\u3002","title":"3.2.1 Header content-length"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#322-header-content-type","text":"\u5982\u679c\u5b58\u5728\u5e27\u4f53\uff0c SEND\uff0cMESSAGE\u548cERROR \u5e27\u5e94\u8be5\u5305\u62ec\u4e00\u4e2a content-type \u7684\u5934\uff0c\u4ee5\u5e2e\u52a9\u5e27\u7684\u63a5\u6536\u8005\u89e3\u91ca\u5b83\u7684\u4e3b\u4f53\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 content-type \u6807\u5934\uff0c\u5219\u5176\u503c\u5fc5\u987b\u662f\u63cf\u8ff0\u6b63\u6587\u683c\u5f0f\u7684 MIME \u7c7b\u578b\u3002\u5426\u5219\uff0c\u63a5\u6536\u5668\u5e94\u8be5\u8ba4\u4e3a\u4e3b\u4f53\u662f\u4e8c\u8fdb\u5236blob\u3002 \u4ee5 text/ \u5f00\u5934\u7684MIME\u7c7b\u578b\u7684\u9690\u542b\u6587\u672c\u7f16\u7801\u662f UTF-8 \u3002\u5982\u679c\u4f7f\u7528\u5177\u6709\u4e0d\u540c\u7f16\u7801\u7684\u57fa\u4e8e\u6587\u672c\u7684MIME\u7c7b\u578b\uff0c\u90a3\u4e48\u60a8\u5e94\u8be5\u8ffd\u52a0 ;charset=<encoding> \u5230MIME\u7c7b\u578b\u3002 \u6240\u6709STOMP\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5fc5\u987b\u652f\u6301UTF-8\u7f16\u7801\u548c\u89e3\u7801\u3002","title":"3.2.2 Header content-type"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#323-header-receipt","text":"\u9664CONNECT\u4e4b\u5916\u7684\u4efb\u4f55\u5ba2\u6237\u7aef\u5e27\u90fd\u53ef\u4ee5\u6307\u5b9a\u5177\u6709\u4efb\u610f\u503c\u7684\u56de\u6267\u6807\u5934\u3002\u8fd9\u5c06\u4f7f\u670d\u52a1\u5668\u7528RECEIPT\u5e27\u786e\u8ba4\u5ba2\u6237\u5e27\u7684\u5904\u7406\u3002 SEND destination : / queue / a receipt : message - 12345 hello queue a ^ @","title":"3.2.3 Header receipt\uff08\u56de\u6267\uff09"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#33-header","text":"STOMP\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7\u5728\u90ae\u4ef6\u4e2d\u6dfb\u52a0\u6807\u5934\u6216\u5728\u90ae\u4ef6\u4e2d\u5c31\u5730\u4fee\u6539\u6807\u5934\u6765\u201c\u66f4\u65b0\u201d\u6807\u5934\u503c\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u6536\u5230\u91cd\u590d\u7684\u5e27\u5934\u6761\u76ee\uff0c\u5219\u53ea\u5e94\u5c06\u7b2c\u4e00\u4e2a\u5934\u6761\u76ee\u7528\u4f5c\u5934\u6761\u76ee\u7684\u503c\u3002\u540e\u7eed\u503c\u4ec5\u7528\u4e8e\u7ef4\u62a4\u6807\u5934\u7684\u72b6\u6001\u66f4\u6539\u5386\u53f2\u8bb0\u5f55\uff0c\u53ef\u4ee5\u5ffd\u7565\u3002","title":"3.3 \u91cd\u590d\u7684Header\u6761\u76ee"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#34","text":"\u4e3a\u9632\u6b62\u6076\u610f\u5ba2\u6237\u7aef\u5229\u7528\u670d\u52a1\u5668\u4e2d\u7684\u5185\u5b58\u5206\u914d\uff0c\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u6700\u5927\u9650\u5236\uff1a the number of frame headers allowed in a single frame the maximum length of header lines the maximum size of a frame body \u5982\u679c\u8d85\u51fa\u8fd9\u4e9b\u9650\u5236\uff0c\u670d\u52a1\u5668\u5e94\u8be5\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a ERROR \u5e27\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002","title":"3.4 \u5c3a\u5bf8\u9650\u5236"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#35-connection-lingering","text":"STOMP\u670d\u52a1\u5668\u5fc5\u987b\u80fd\u591f\u652f\u6301\u5feb\u901f\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u3002 \u8fd9\u610f\u5473\u7740\u670d\u52a1\u5668\u53ef\u80fd\u53ea\u5141\u8bb8\u5728\u91cd\u7f6e\u8fde\u63a5\u4e4b\u524d\u77ed\u65f6\u95f4\u5185\u5173\u95ed\u8fde\u63a5\u3002 \u56e0\u6b64\uff0c\u5728\u91cd\u7f6e\u5957\u63a5\u5b57\u4e4b\u524d\uff0c\u5ba2\u6237\u7aef\u53ef\u80fd\u4e0d\u4f1a\u63a5\u6536\u670d\u52a1\u5668\u53d1\u9001\u7684\u6700\u540e\u4e00\u5e27\uff08\u4f8b\u5982\uff0cERROR\u5e27\u6216RECEIPT\u5e27\u4ee5\u56de\u590dDISCONNECT\u5e27\uff09\u3002","title":"3.5 Connection Lingering\uff08\u8fde\u63a5\u56de\u73af\uff09"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#4","text":"STOMP\u5ba2\u6237\u7aef\u901a\u8fc7\u53d1\u9001 CONNECT \u5e27\u6765\u542f\u52a8\u5230\u670d\u52a1\u5668\u7684\u6d41\u6216TCP\u8fde\u63a5\uff1a CONNECT accept - version : 1 . 2 host : stomp . github . org ^ @ \u5982\u679c\u670d\u52a1\u5668\u63a5\u53d7\u8fde\u63a5\u5c1d\u8bd5\uff0c\u5b83\u5c06\u4f7f\u7528CONNECTED\u5e27\u8fdb\u884c\u54cd\u5e94\uff1a CONNECTED version : 1 . 2 ^@ \u670d\u52a1\u5668\u53ef\u4ee5\u62d2\u7edd\u4efb\u4f55\u8fde\u63a5\u5c1d\u8bd5\u3002\u670d\u52a1\u5668\u5e94\u8be5\u56de\u590d\u4e00\u4e2aERROR\u5e27\uff0c\u89e3\u91ca\u8fde\u63a5\u88ab\u62d2\u7edd\u7684\u539f\u56e0\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002","title":"4. \u8fde\u63a5"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#41-connect-or-stomp","text":"STOMP\u670d\u52a1\u5668\u5fc5\u987b\u4ee5\u4e0e CONNECT \u5e27\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406 STOMP \u5e27\u3002 CONNECT \u5e27\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\u4fdd\u7559\u7684\u5e27\u7c7b\u578b\u3002 STOMP \u5e27\u662fStomp1.2\u65b0\u7684\u5e27\u7c7b\u578b\uff0c\u4f18\u70b9\u662f\u534f\u8bae\u55c5\u63a2\u5668/\u9274\u522b\u5668\u5c06\u80fd\u591f\u533a\u5206STOMP\u8fde\u63a5\u548cHTTP\u8fde\u63a5\u3002 STOMP 1.2 \u5ba2\u6237\u7aef\u5fc5\u987b\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a accept-version \uff1a\u5ba2\u6237\u7aef\u652f\u6301\u7684STOMP\u534f\u8bae\u7248\u672c\u3002 host \uff1a\u5ba2\u6237\u7aef\u5e0c\u671b\u8fde\u63a5\u5230\u7684\u865a\u62df\u4e3b\u673a\u7684\u540d\u79f0\u3002\u5efa\u8bae\u5ba2\u6237\u7aef\u5c06\u6b64\u8bbe\u7f6e\u4e3a\u5efa\u7acb\u5957\u63a5\u5b57\u7684\u4e3b\u673a\u540d\uff0c\u6216\u8005\u8bbe\u7f6e\u4e3a\u4ed6\u4eec\u9009\u62e9\u7684\u4efb\u4f55\u540d\u79f0\u3002\u5982\u679c\u6b64\u6807\u5934\u4e0e\u5df2\u77e5\u865a\u62df\u4e3b\u673a\u4e0d\u5339\u914d\uff0c\u5219\u652f\u6301\u865a\u62df\u4e3b\u673a\u7684\u670d\u52a1\u5668\u53ef\u4ee5\u9009\u62e9\u9ed8\u8ba4\u865a\u62df\u4e3b\u673a\u6216\u62d2\u7edd\u8fde\u63a5\u3002 STOMP 1.2 \u5ba2\u6237\u7aef\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a login \uff1a\u7528\u4e8e\u5bf9\u5b89\u5168\u7684STOMP\u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u6807\u8bc6\u7b26\u3002 passcode \uff1a\u7528\u4e8e\u5bf9\u5b89\u5168\u7684STOMP\u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u5bc6\u7801\u3002 heart-beat \uff1a Heart-beating \u8bbe\u7f6e\u6216\u53c2\u8003\u4e0b\u6587\u3002","title":"4.1 CONNECT or STOMP \u5e27"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#42-connected","text":"STOMP 1.2 \u670d\u52a1\u7aef\u5fc5\u987b\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a version \uff1a\u4f1a\u8bdd session \u5c06\u4f7f\u7528\u7684STOMP\u534f\u8bae\u7684\u7248\u672c\u3002 Protocol Negotiation \u6216\u53c2\u8003\u4e0b\u6587\u3002 STOMP 1.2 \u8bbf\u95ee\u7aef\u53ef\u80fd\u4f1a\u8bbe\u7f6e\u4ee5\u4e0b\u5934\u90e8\uff1a heart-beat \uff1a Heart-beating \u8bbe\u7f6e\u6216\u53c2\u8003\u4e0b\u6587\u3002 session \uff1a\u552f\u4e00\u6807\u8bc6\u4f1a\u8bdd\u7684\u4f1a\u8bdd\u6807\u8bc6\u7b26\u3002 server \uff1a\u5305\u542bSTOMP\u670d\u52a1\u4fe1\u606f\u7684\u5b57\u6bb5\u3002\u8be5\u5b57\u6bb5\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u670d\u52a1\u5668\u540d\u79f0\u5b57\u6bb5\uff0c\u540e\u8ddf\u53ef\u9009\u7684\u6ce8\u91ca\u5b57\u6bb5\uff0c\u4f7f\u7528\u4e00\u4e2a\u7a7a\u683c\u5b57\u7b26\u5206\u9694\u3002 \u683c\u5f0f\uff1a server = name [\"/\" version] *(comment) \u4f8b\u5b50\uff1a server:Apache/1.3.9","title":"4.2 CONNECTED \u5e27"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#43-protocol-negotiation","text":"\u4eceSTOMP 1.1\u5f00\u59cb\uff0c\u5ba2\u6237\u7aef CONNECT \u5e27\u5fc5\u987b\u5305\u542b accept-version \u5934\u90e8\uff0c\u4ee5\u9017\u53f7\u5206\u9694\u8868\u660e\u5b83\u652f\u6301\u7684\u7248\u672c\u3002\u82e5\u6ca1\u6709\u6b64\u5934\u90e8\u5219\u8868\u660e\u652f\u6301STOMP 1.0\u3002 \u4e24\u7aef\u90fd\u652f\u6301\u7684\u6700\u9ad8\u7248\u672c\u5c06\u7528\u4e8e\u540e\u7eed\u7684\u4f1a\u8bdd\u901a\u4fe1\u3002 \u4e3e\u4f8b\uff1a \u5ba2\u6237\u7aef\uff1a CONNECT accept - version : 1 . 0 , 1 . 1 , 2 . 0 host : stomp . github . org ^ @ \u670d\u52a1\u7aef\u4f1a\u54cd\u5e94\u8fd4\u56de\u4e00\u4e2a\u6700\u9ad8\u7248\u672c\u7684\u534f\u8bae\uff1a CONNECTED version : 1 . 1 ^@ \u5982\u679c\u6ca1\u6709\u4e24\u8005\u90fd\u652f\u6301\u7684\u7248\u672c\uff0c\u5219\u8fd4\u56de ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\uff1a ERROR version : 1 . 2 , 2 . 1 content - type : text / plain Supported protocol versions are 1 . 2 2 . 1 ^@","title":"4.3 Protocol Negotiation\uff08\u534f\u8bae\u9009\u62e9\uff09"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#44-heart-beating","text":"\u5fc3\u8df3\u7528\u4e8e\u786e\u4fdd\u8fdc\u7a0b\u7aef\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u5e76\u4e14\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002 \u4e3a\u4e86\u5b9e\u73b0\u5fc3\u8df3\u673a\u5236\uff0c\u6bcf\u4e00\u65b9\u90fd\u5fc5\u987b\u58f0\u660e\u5b83\u80fd\u505a\u4ec0\u4e48\u4ee5\u53ca\u5b83\u5e0c\u671b\u5bf9\u65b9\u505a\u4ec0\u4e48\u3002\u5728 CONNECT and CONNECTED \u5e27\u6dfb\u52a0 heart-beat \u5934\u90e8\u3002 \u4f7f\u7528\u65f6\uff0c\u5fc3\u8df3\u5934\u90e8\u5fc5\u987b\u5305\u542b\u4e24\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6b63\u6574\u6570\uff1a \u7b2c\u4e00\u4e2a\u8868\u793a\u5e27\u7684\u53d1\u9001\u7aef\u53ef\u4ee5\u505a\u4ec0\u4e48 0\u8868\u793a\u65e0\u6cd5\u53d1\u9001\u5fc3\u8df3 \u5426\u5219\u5b83\u662f\u5fc3\u8df3\u4e4b\u95f4\u53ef\u4ee5\u4fdd\u8bc1\u7684\u6700\u5c0f\u6beb\u79d2\u6570 \u7b2c\u4e8c\u4e2a\u8868\u793a\u5e27\u7684\u53d1\u9001\u8005\u5e0c\u671b\u63a5\u6536\u5230\u4ec0\u4e48 0\u8868\u793a\u5b83\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3 \u5426\u5219\u5b83\u662f\u5fc3\u8df3\u4e4b\u95f4\u6240\u9700\u7684\u6beb\u79d2\u6570 \u7f3a\u5c11\u5fc3\u8df3\u6807\u9898\u5fc5\u987b\u4e0e heart-beat:0,0 \u6807\u9898\u4e00\u6837\u5bf9\u5f85\uff0c\u5373\uff1a\u4e0d\u80fd\u53d1\u9001\u5e76\u4e14\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3\u3002 CONNECT heart - beat : < cx > , < cy > CONNECTED : heart - beat : < sx > , < sy > \u5bf9\u4e8e\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u7684\u5fc3\u8df3\uff1a \u5982\u679c \u4e3a0\uff08\u5ba2\u6237\u7aef\u65e0\u6cd5\u53d1\u9001\u5fc3\u8df3\uff09\u6216 \u4e3a0\uff08\u670d\u52a1\u5668\u4e0d\u60f3\u63a5\u6536\u5fc3\u8df3\uff09\u90a3\u4e48\u5c06\u6ca1\u6709\u5fc3\u8df3 \u5426\u5219\uff0c\u6bcf\u9694 MAX(<cx>\uff0c<sy>) \u6beb\u79d2\u5c31\u4f1a\u6709\u4e00\u6b21\u5fc3\u8df3 \u5bf9\u4e8e\u5176\u5b83\u65b9\u5411\u7684\u5fc3\u8df3\uff0c \u548c \u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u4f7f\u7528\u3002\uff1f\uff1f\uff1f \u5173\u4e8e\u5fc3\u8df3\u672c\u8eab\uff0c\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u63a5\u6536\u7684\u4efb\u4f55\u65b0\u6570\u636e\u90fd\u8868\u660e\u8fdc\u7a0b\u7aef\u662f\u6d3b\u7740\u7684\u3002\u5728\u7ed9\u5b9a\u7684\u65b9\u5411\u4e0a\uff0c\u5982\u679c\u6bcf\u9694 \u6beb\u79d2\u9700\u8981\u5fc3\u8df3\uff1a \u53d1\u9001\u65b9\u5fc5\u987b\u81f3\u5c11\u6bcf \u6beb\u79d2\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u53d1\u9001\u65b0\u6570\u636e \u5982\u679c\u53d1\u9001\u65b9\u6ca1\u6709\u8981\u53d1\u9001\u7684\u771f\u5b9eSTOMP\u5e27\uff0c\u5b83\u5fc5\u987b\u53d1\u9001\u4e00\u4e2a\u884c\u5c3e\uff08EOL\uff09 \u5982\u679c\uff0c\u5728\u4e00\u4e2a\u81f3\u5c11 \u6beb\u79d2\u7684\u65f6\u95f4\u7a97\u53e3\u5185\uff0c\u63a5\u6536\u5668\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u65b0\u6570\u636e\uff0c\u5b83\u53ef\u80fd\u8ba4\u4e3a\u8fde\u63a5\u5df2\u6b7b \u7531\u4e8e\u65f6\u5e8f\u4e0d\u51c6\u786e\uff0c\u63a5\u6536\u5668\u5e94\u8be5\u5bb9\u5fcd\u5e76\u8003\u8651\u8bef\u5dee\u8303\u56f4","title":"4.4 Heart-beating"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#5-client-frames","text":"\u5ba2\u6237\u7aef\u4e5f\u8bb8\u4f1a\u53d1\u9001\u4e00\u4e2a\u4e0d\u5728\u4e0b\u6587\u4e2d\u7684\u5e27\uff0c\u4f46\u662f\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u54cd\u5e94\u4e00\u4e2a ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\u3002","title":"5. Client Frames"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#51-send","text":"SEND \u5e27\u5c06\u6d88\u606f\u53d1\u9001\u5230\u6d88\u606f\u4f20\u9012\u7cfb\u7edf\u4e2d\u7684\u76ee\u6807\u3002 \u8981\u6c42\u6709\u4e00\u4e2a destination \u7684\u5934\u90e8\uff0c\u8868\u660e\u4e86\u53d1\u9001\u5230\u54ea\u91cc\u3002\u4e3b\u4f53\u662f\u8981\u53d1\u9001\u7684\u4fe1\u606f\u3002 \u4f8b\uff1a SEND destination : / queue / a content - type : text / plain hello queue a ^ @ Note STOMP\u5c06\u6b64\u76ee\u6807\u89c6\u4e3a\u4e0d\u900f\u660e\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u76ee\u6807\u540d\u79f0\u4e0d\u627f\u62c5\u4f20\u9012\u8bed\u4e49\u7684\u8d23\u4efb\u3002\u60a8\u5e94\u8be5\u67e5\u9605STOMP\u670d\u52a1\u5668\u7684\u6587\u6863\uff0c\u4ee5\u4e86\u89e3\u5982\u4f55\u6784\u9020\u76ee\u6807\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u4e3a\u60a8\u63d0\u4f9b\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u4f20\u9012\u8bed\u4e49\u3002 SEND\u652f\u6301\u5141\u8bb8\u4e8b\u52a1\u5730\u53d1\u9001\u7684 transaction \u6807\u5934\u3002 \u5e94\u8be5\u5305\u542b content-length \u548c content-type \u5934\u3002 \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5c06\u4efb\u610f\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u6dfb\u52a0\u5230SEND\u5e27\u3002\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u901a\u5e38\u7528\u4e8e\u5141\u8bb8\u4f7f\u7528\u8005\u4f7f\u7528 SUBSCRIBE \u5e27\u4e0a\u7684\u9009\u62e9\u5668\u57fa\u4e8e\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u6807\u5934\u8fc7\u6ee4\u6d88\u606f\u3002\u7528\u6237\u5b9a\u4e49\u7684\u5934\u5fc5\u987b\u5728 MESSAGE \u5e27\u4e2d\u4f20\u9012\u3002 \u5982\u679c\u670d\u52a1\u5668\u4e0d\u80fd\u5904\u7406 SEND \u5e27\uff0c\u5fc5\u987b\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u4e00\u4e2a ERROR \u5e27\u5e76\u5173\u95ed\u8fde\u63a5\u3002","title":"5.1 SEND"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#52-subscribe","text":"SUBSCRIBE \u7528\u4e8e\u6ce8\u518c\u4ee5\u76d1\u542c\u7ed9\u5b9a\u7684\u76ee\u6807\u3002\u4e5f\u8981\u5305\u542b destination \u8868\u660e\u5ba2\u6237\u7aef\u60f3\u8981\u76d1\u542c\u54ea\u4e2a\u76ee\u6807\u3002 \u5728\u8ba2\u9605\u76ee\u6807\u4e0a\u63a5\u6536\u7684\u4efb\u4f55\u6d88\u606f\u6b64\u540e\u5c06\u4f5c\u4e3a MESSAGE \u5e27\u4ece\u670d\u52a1\u5668\u4f20\u9001\u5230\u5ba2\u6237\u7aef \u3002 ack \u6807\u5934\u63a7\u5236\u6d88\u606f\u786e\u8ba4\u6a21\u5f0f\u3002 \u4f8b\uff1a SUBSCRIBE id : 0 destination : / queue / foo ack : client ^@ \u5982\u679c\u670d\u52a1\u5668\u65e0\u6cd5\u6210\u529f\u521b\u5efa\u8ba2\u9605\uff0c\u5219\u670d\u52a1\u5668\u5fc5\u987b\u5411\u5ba2\u6237\u7aef\u53d1\u9001 ERROR \u5e27\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002","title":"5.2 SUBSCRIBE"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#521-subscribe-id-header","text":"\u7531\u4e8e\u5355\u4e2a\u8fde\u63a5\u53ef\u4ee5\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u591a\u6b21\u8ba2\u9605\uff0c\u6545\u5fc5\u987b\u5728\u5e27\u4e2d\u5305\u542b\u4e00\u4e2a id \u5934\u4ee5\u552f\u4e00\u5730\u6807\u8bc6\u8ba2\u9605\u3002","title":"5.2.1 SUBSCRIBE id Header"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#522-subscribe-ack-header","text":"ack \u5934\u6709\u4e09\u79cd\u5408\u6cd5\u503c\uff1a auto \uff08\u9ed8\u8ba4\u503c\uff09 \u5ba2\u6237\u7aef\u65e0\u9700\u4e3a\u5b83\u6536\u5230\u7684\u4fe1\u606f\u5411\u670d\u52a1\u7aef\u53d1\u9001 ACK \u5e27\u3002\u6b64\u786e\u8ba4\u6a21\u5f0f\u53ef\u80fd\u5bfc\u81f4\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u7684\u6d88\u606f\u88ab\u4e22\u5f03\u3002 client \u5ba2\u6237\u7aef\u5fc5\u987b\u4e3a\u5b83\u6536\u5230\u7684\u4fe1\u606f\u5411\u670d\u52a1\u7aef\u53d1\u9001 ACK \u5e27\u3002\u5982\u679c\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u7684ACK\u5e27\u4e4b\u524d\u8fde\u63a5\u5931\u8d25\uff0c\u5219\u670d\u52a1\u5668\u5c06\u5047\u5b9a\u6d88\u606f\u5c1a\u672a\u5904\u7406\uff0c\u5e76\u4e14\u53ef\u4ee5\u5c06\u6d88\u606f\u91cd\u65b0\u53d1\u9001\u7ed9\u53e6\u4e00\u4e2a\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u53d1\u9001\u7684ACK\u5e27\u5c06\u88ab\u89c6\u4e3a \u7d2f\u79ef\u786e\u8ba4 \u3002\u8fd9\u610f\u5473\u7740\u786e\u8ba4\u64cd\u4f5c\u5bf9ACK\u5e27\u4e2d\u6307\u5b9a\u7684\u6d88\u606f\u4ee5\u53ca\u5728ACK\u6d88\u606f\u4e4b\u524d\u53d1\u9001\u5230\u8ba2\u9605\u7684\u6240\u6709\u6d88\u606f\u90fd\u6709\u6548\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u5904\u7406\u67d0\u4e9b\u6d88\u606f\uff0c\u5b83\u5e94\u8be5\u53d1\u9001 NACK \u5e27\u544a\u8bc9\u670d\u52a1\u5668\u5b83\u6ca1\u6709\u6d88\u8017\u8fd9\u4e9b\u6d88\u606f\u3002 client-individual \u3002 \u786e\u8ba4\u64cd\u4f5c\u5c31\u50cf\u5ba2\u6237\u7aef\u786e\u8ba4\u6a21\u5f0f\u4e00\u6837\uff0c\u9664\u4e86\u5ba2\u6237\u7aef\u53d1\u9001\u7684ACK\u6216NACK\u5e27\u4e0d\u662f\u7d2f\u79ef\u7684\u3002\u8fd9\u610f\u5473\u7740\u540e\u7eed\u6d88\u606f\u7684 ACK \u6216 NACK \u5e27\u4e0d\u5f97\u5bfc\u81f4\u5148\u524d\u7684\u6d88\u606f\u5f97\u5230\u786e\u8ba4\u3002","title":"5.2.2 SUBSCRIBE ack Header"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#53-unsubscribe","text":"UNSUBSCRIBE \u7528\u4e8e\u79fb\u9664\u5b58\u5728\u7684\u8ba2\u9605\u3002 id \u6807\u5934\u5fc5\u987b\u4e0e\u73b0\u6709\u8ba2\u9605\u7684\u8ba2\u9605\u6807\u8bc6\u7b26\u5339\u914d\u3002 \u4f8b\uff1a UNSUBSCRIBE id : 0 ^@","title":"5.3 UNSUBSCRIBE"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#54-ack","text":"\u786e\u8ba4\u5ba2\u6237\u7aef\u6d88\u8d39\u4e86\u4fe1\u606f\uff08\u53c2\u8003 SUBSCRIBE ack Header \uff09\u3002\u5728\u901a\u8fc7ACK\u786e\u8ba4\u6d88\u606f\u4e4b\u524d\uff0c\u4e0d\u4f1a\u8ba4\u4e3a\u4ece\u6b64\u8ba2\u9605\u63a5\u6536\u7684\u4efb\u4f55\u6d88\u606f\u5df2\u88ab\u6d88\u8017\u3002 ACK\u5e27\u5fc5\u987b\u5305\u62ec\u4e0e\u6b63\u88ab\u786e\u8ba4\u7684 MESSAGE \u7684ack\u5934\u5339\u914d\u7684 id \u5934\u3002\u53ef\u9009\u5730\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e8b\u52a1\u5934 transaction \uff0c\u8868\u660e\u6d88\u606f\u786e\u8ba4\u5e94\u8be5\u662f\u547d\u540d\u4e8b\u52a1\u7684\u4e00\u90e8\u5206\u3002 ACK id : 12345 transaction : tx1 ^@","title":"5.4 ACK"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#55-nack","text":"NACK \u4e0e ACK \u76f8\u53cd\u3002\u5b83\u7528\u4e8e\u544a\u8bc9\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u6ca1\u6709\u4f7f\u7528\u8be5\u6d88\u606f\u3002 \u7136\u540e\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u5c06\u6d88\u606f\u53d1\u9001\u5230\u5176\u4ed6\u5ba2\u6237\u7aef\uff0c\u4e22\u5f03\u5b83\uff0c\u6216\u5c06\u5176\u653e\u5165\u6b7b\u4fe1\u961f\u5217\u3002\u786e\u5207\u7684\u884c\u4e3a\u662f\u7279\u5b9a\u4e8e\u670d\u52a1\u5668\u7684\u3002 NACK\u91c7\u7528\u4e0eACK\u76f8\u540c\u7684\u6807\u5934\uff1a id \uff08\u5fc5\u9700\uff09\u548c transaction \uff08\u53ef\u9009\uff09\u3002 NACK\u4e5f\u540c\u6837\u9002\u7528 client-individual \u548c client \u786e\u8ba4\u6a21\u5f0f\u3002","title":"5.5 NACK"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#56-begin","text":"BEGIN \u7528\u4e8e\u542f\u52a8\u4e8b\u52a1\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u4e8b\u52a1\u9002\u7528\u4e8e\u53d1\u9001\u548c\u786e\u8ba4\u2014\u2014\u5728\u4e8b\u52a1\u671f\u95f4\u53d1\u9001\u6216\u786e\u8ba4\u7684\u4efb\u4f55\u6d88\u606f\u5c06\u57fa\u4e8e\u4ee5\u539f\u5b50\u65b9\u5f0f\u5904\u7406\u3002 BEGIN transaction : tx1 ^@ \u4e8b\u52a1\u6807\u5934 transaction \u662f\u5fc5\u9700\u7684\uff0c\u4e8b\u52a1\u6807\u8bc6\u7b26\u5c06\u7528\u4e8e SEND\uff0cCOMMIT\uff0cABORT\uff0cACK\u548cNACK \u5e27\u4ee5\u5c06\u5b83\u4eec\u7ed1\u5b9a\u5230\u6307\u5b9a\u7684\u4e8b\u52a1\u3002\u5728\u540c\u4e00\u8fde\u63a5\u4e2d\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u5fc5\u987b\u4f7f\u7528\u4e0d\u540c\u7684\u4e8b\u52a1\u6807\u8bc6\u7b26\u3002 \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001 DISCONNECT \u5e27\u6216 TCP\u8fde\u63a5 \u56e0\u4efb\u4f55\u539f\u56e0\u5931\u8d25\uff0c\u5219\u5c06\u9690\u5f0f\u4e2d\u6b62\u4efb\u4f55\u5c1a\u672a\u63d0\u4ea4\u7684\u5df2\u542f\u52a8\u4e8b\u52a1\u3002","title":"5.6 BEGIN"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#57-commit","text":"COMMIT \u7528\u4e8e\u63d0\u4ea4\u6b63\u5728\u8fdb\u884c\u7684\u4e8b\u52a1\u3002 COMMIT transaction : tx1 ^@ \u4e8b\u52a1\u5934\u662f\u5fc5\u9700\u7684\uff0c\u5e76\u4e14\u5fc5\u987b\u6307\u5b9a\u8981\u63d0\u4ea4\u7684\u4e8b\u52a1\u7684\u6807\u8bc6\u7b26\u3002","title":"5.7 COMMIT"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#58-abort","text":"ABORT\u7528\u4e8e\u56de\u6eda\u6b63\u5728\u8fdb\u884c\u7684\u4e8b\u52a1\u3002 ABORT transaction : tx1 ^@ \u4e8b\u52a1\u5934\u662f\u5fc5\u9700\u7684\uff0c\u5e76\u4e14\u5fc5\u987b\u6307\u5b9a\u8981\u63d0\u4ea4\u7684\u4e8b\u52a1\u7684\u6807\u8bc6\u7b26\u3002","title":"5.8 ABORT"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#59-disconnect","text":"\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u5173\u95ed\u5957\u63a5\u5b57\u968f\u65f6\u65ad\u5f00\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u670d\u52a1\u5668\u5df2\u6536\u5230\u5148\u524d\u53d1\u9001\u7684\u5e27\u3002 \u8981\u8fdb\u884c\u6b63\u5e38\u5173\u95ed\uff08\u5ba2\u6237\u7aef\u786e\u4fdd\u670d\u52a1\u5668\u5df2\u6536\u5230\u6240\u6709\u5148\u524d\u7684\u5e27\uff09\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\uff1a \u53d1\u9001\u4e00\u4e2a\u5e26\u6709 receipt \u5934\u90e8\u7684 DISCONNECT \u5e27\u3002\u4f8b\uff1a DISCONNECT receipt : 77 ^ @ \u7b49\u5f85\u54cd\u5e94 DISCONNECT \u7684 RECEIPT \u5e27\u3002\u4f8b\uff1a RECEIPT receipt - id : 77 ^@ \u5173\u95edsocket\u3002 Warning \u5982\u679c\u670d\u52a1\u5668\u8fc7\u5feb\u5730\u5173\u95ed\u670d\u52a1\u5668\u7aef\u7684\u5957\u63a5\u5b57\uff0c\u5219\u5ba2\u6237\u7aef\u53ef\u80fd\u6c38\u8fdc\u4e0d\u4f1a\u6536\u5230\u9884\u671f\u7684RECEIPT\u5e27\u3002 Connection Lingering \u6216\u53c2\u8003\u4e0a\u6587\u3002 \u53d1\u9001DISCONNECT\u5e27\u540e\uff0c\u5ba2\u6237\u7aef\u4e0d\u5f97\u518d\u53d1\u9001\u4efb\u4f55\u5e27\u3002","title":"5.9 DISCONNECT"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#6-server-frames","text":"\u6709\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u5e27\uff08\u9664\u4e86\u521d\u59cb\u7684CONNECTED\u5e27\uff09\u3002","title":"6. Server Frames"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#61-message","text":"MESSAGE \u5e27\u7528\u4e8e\u5c06\u6d88\u606f\u4ece\u8ba2\u9605\u5904\u4f20\u9001\u5230\u5ba2\u6237\u7aef\u3002 \u5fc5\u987b\u5305\u542b\uff1a destination \u8868\u660e\u4fe1\u606f\u5c06\u8981\u53d1\u9001\u7684\u76ee\u6807\u7684\u5934\u90e8\uff1b message-id \u552f\u4e00\u6807\u8bc6\u5934\u90e8\uff1b subscription \u5934\u90e8\uff0c\u8868\u793a\u4e0e\u6b63\u5728\u63a5\u6536\u6d88\u606f\u7684\u8ba2\u9605\u7684\u6807\u8bc6\u7b26\u5339\u914d\u7684\u8ba2\u9605\u6807\u5934\u3002\u3002 \u82e5\u4ece\u8ba2\u9605\u5904\u63a5\u6536\u7684\u4fe1\u606f\u8981\u6c42\u5374\u8ba4\uff0c\u90a3\u4e48MESSAGE\u5e27\u5fc5\u987b\u5305\u542b\u5e26\u6709\u4efb\u610f\u503c\u7684 ack \u5934\u90e8\u3002 \u4e3b\u4f53\u90e8\u5206\u5305\u542b\u4fe1\u606f\u7684\u5185\u5bb9\u3002 # \u5ba2\u6237\u7aef\u8ba2\u9605 SUBSCRIBE id : 0 destination : / queue / a # \u670d\u52a1\u7aef\u63a5\u6536\u4fe1\u606f\u5e76\u53d1\u9001\u7ed9\u8ba2\u9605\u8005 MESSAGE subscription : 0 message - id : 007 destination : / queue / a content - type : text / plain hello queue a ^@ MESSAGE\u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9 content-length \u548c content-type \u6807\u9898\uff08\u5982\u679c\u5b58\u5728\u6b63\u6587\uff09\u3002 MESSAGE\u5e27\u8fd8\u5c06\u5305\u62ec\u5728\u5c06\u6d88\u606f\u53d1\u9001\u5230\u76ee\u7684\u5730\u65f6\u5b58\u5728\u7684\u6240\u6709\u7528\u6237\u5b9a\u4e49\u7684\u6807\u5934\u3002\u8bf7\u53c2\u9605\u670d\u52a1\u5668\u7684\u6587\u6863\uff0c\u627e\u51fa\u5b83\u6dfb\u52a0\u5230\u6d88\u606f\u4e2d\u7684\u670d\u52a1\u5668\u7279\u5b9a\u6807\u5934\u3002","title":"6.1 MESSAGE"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#62-receipt","text":"\u4e00\u65e6\u670d\u52a1\u5668\u6210\u529f\u5904\u7406\u4e86\u8bf7\u6c42\u56de\u6267\u7684\u5ba2\u6237\u7aef\u5e27\uff0c\u5c31\u4f1a\u4ece\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001 RECEIPT \u5e27\u3002 \u5fc5\u987b\u5305\u542b receipt-id \u5934\u90e8\uff0c\u5176\u503c\u662f\u8bf7\u6c42\u56de\u6267\u7684\u5e27\u7684 receipt \u5934\u90e8\u503c\u3002 RECEIPT receipt - id : message - 12345 ^@ \u7531\u4e8eSTOMP\u662f\u57fa\u4e8e\u6d41\u7684\uff0c\u56e0\u6b64\u56de\u6267\u4e5f\u662f \u7d2f\u79ef\u786e\u8ba4 \uff08\u8ba4\u4e3a\u5148\u524d\u6240\u6709\u7684\u5e27\u90fd\u5df2\u7ecf\u88ab\u670d\u52a1\u5668\u63a5\u6536\u5230\u4e86\uff09\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u5148\u524d\u7684\u5e27\u53ef\u80fd\u5c1a\u672a\u5b8c\u5168\u5904\u7406\u3002\u5982\u679c\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\uff0c\u4ee5\u524d\u63a5\u6536\u7684\u5e27\u5e94\u8be5\u7ee7\u7eed\u7531\u670d\u52a1\u5668\u5904\u7406\u3002","title":"6.2 RECEIPT"},{"location":"\u5176\u5b83/Stomp\u534f\u8bae/#63-error","text":"\u5982\u679c\u51fa\u73b0\u95ee\u9898\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u53d1\u9001 ERROR \u5e27\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u5fc5\u987b\u5728\u53d1\u9001ERROR\u5e27\u540e\u7acb\u5373\u5173\u95ed\u8fde\u63a5\u3002 ERROR\u5e27\u5e94\u8be5\u5305\u542b\u4e00\u4e2a\u5e26\u6709\u9519\u8bef\u7b80\u77ed\u63cf\u8ff0\u7684 message \u5934\u90e8\uff0c\u5e76\u4e14\u6b63\u6587\u53ef\u4ee5\u5305\u542b\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff08\u6216\u8005\u53ef\u4ee5\u4e3a\u7a7a\uff09\u3002 ERROR receipt - id : message - 12345 content - type : text / plain content - length : 171 message : malformed frame received The message : ----- MESSAGE destined : / queue / a receipt : message - 12345 Hello queue a ! ----- Did not contain a destination header , which is REQUIRED for message propagation . ^ @ \u5982\u679c\u9519\u8bef\u4e0e\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u7279\u5b9a\u5e27\u6709\u5173\uff0c\u5219\u670d\u52a1\u5668\u5e94\u8be5\u6dfb\u52a0\u989d\u5916\u7684\u6807\u5934\u4ee5\u5e2e\u52a9\u8bc6\u522b\u5bfc\u81f4\u9519\u8bef\u7684\u539f\u59cb\u5e27\u3002 ERROR\u5e27\u5e94\u8be5\u5305\u62ec\u5185\u5bb9 content-length \u548c content-type \u6807\u9898\uff08\u5982\u679c\u5b58\u5728\u6b63\u6587\uff09\u3002","title":"6.3 ERROR"},{"location":"\u5176\u5b83/Windows\u683c\u5f0f\u5316\u78c1\u76d8/","text":"\u53c2\u8003\uff1ahttps://jingyan.baidu.com/article/e9fb46e140a04a7521f766d4.html \u6b64\u6cd5\u9002\u7528\u4e8e\u4e0d\u80fd\u5728\u56fe\u5f62\u754c\u9762\u683c\u5f0f\u78c1\u76d8\u6216\u683c\u5f0f\u5316\u51fa\u9519\uff08\u6bd4\u5982\u683c\u5f0f\u5316\u5b89\u88c5\u6709linux\u64cd\u4f5c\u7cfb\u7edf\u7684\u78c1\u76d8\uff09\u7684\u60c5\u51b5\u3002 \u5728 cmd \u4e2d\u6267\u884c\uff1a \u547d\u4ee4\u8bf4\u660e\uff1a diskpart \uff1a\u78c1\u76d8\u5206\u533a\u547d\u4ee4 list disk \uff1a\u5217\u51fa\u78c1\u76d8 select disk 1 \uff1a\u9009\u62e9\u4e00\u4e2a\u78c1\u76d8 clean \uff1a\u6e05\u9664\u78c1\u76d8\u5185\u5bb9 create partition primary \uff1a\u521b\u5efa\u4e3b\u5206\u533a format fs=ntfs quick label=\"I:\" \uff1a\u4f7f\u7528NTFS\u683c\u5f0f\u5feb\u901f\u683c\u5f0f\u5316\u78c1\u76d8\uff0c\u5206\u914d I: \u6807\u7b7e\uff08\u5377\u6807\uff09","title":"Windows\u683c\u5f0f\u5316\u78c1\u76d8"},{"location":"\u5176\u5b83/h5ai\u7f8e\u5316\u76ee\u5f55/","text":"\u76ee\u5f55\u7ed3\u6784\uff1a /var/www/html/pub -> /home/pub/ #\u8f6f\u8fde\u63a5 /home/pub/ \u4e0b\u9762\u5b58\u653e\u4e86\u771f\u6b63\u7684\u6587\u4ef6\uff0c\u628a _h5ai \u76ee\u5f55\u653e\u5230 /home/pub/ \u76ee\u5f55\u4e0b\u3002 vi / etc / httpd / conf / httpd . conf DirectoryIndex index . html index . php / pub / _h5ai / public / index . php","title":"h5ai\u7f8e\u5316\u76ee\u5f55"},{"location":"\u5176\u5b83/vdsm\u542f\u52a8\u5931\u8d25/","text":"\u4f4e\u7248\u672c\u7684vdsm\u5728\u9ad8\u7248\u672c\u7684libvirt\u73af\u5883\u4e0b\u7f16\u8bd1\u5b89\u88c5\u4e4b\u540e\u542f\u52a8\u5931\u8d25\uff0c\u56e0\u4e3alibvirt\u7684\u9a8c\u8bc1\u65b9\u5f0f\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u6240\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5199\u5165\u4ee5\u4e0b\u914d\u7f6e\uff1a #libvirt configure echo ' mech_list: digest-md5 sasldb_path: /etc/libvirt/passwd.db ' > /etc/sasl2/libvirt.conf \u91cd\u542flibvirt\u670d\u52a1\uff1b\u91cd\u65b0\u751f\u6210vdsm\u9a8c\u8bc1\u914d\u7f6e\u6587\u4ef6","title":"vdsm\u542f\u52a8\u5931\u8d25"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/","text":"1. \u5236\u4f5c\u955c\u50cf \u00b6 mkisofs -o xxx.iso -J -R -V bb diretory -V\u540e\u9762\u7684bb\u4e3a\u6307\u5b9a\u5149\u76d8\u7684\u5377\u518c\u96c6ID\uff0cdiretory\u4e3a\u9700\u8981\u6253\u5305\u7684\u6587\u4ef6\u5939\u540d\u5b57 \u5982\u679c\u9700\u8981\u4fdd\u6301\u539f\u59cb\u6587\u4ef6\u540d\uff0c\u8981\u6dfb\u52a0-J\u53c2\u6570\uff0c\u5426\u5219\u6253\u5305\u540e\uff0c\u6587\u4ef6\u540d\u5168\u6539\u53d8\u4e86 \u5982\u679c\u9700\u8981\u6392\u9664\u90e8\u5206\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u4f7f\u7528-x excludefolder 2. \u66f4\u65b0rpm\u5305 \u00b6 2.1 1. \u5c06\u5f53\u524d\u7cfb\u7edf\u955c\u50cf\u6587\u4ef6\u62f7\u8d1d\u81f3\u6307\u5b9a\u76ee\u5f55\uff0c\u6302\u8f7d\u955c\u50cf\u6587\u4ef6\uff0c\u4e0e\u672c\u7cfb\u7edf\u7684iso\u6587\u4ef6\u4fdd\u6301\u4e00\u81f4\u3002 \u00b6 \u6302\u8f7d\u955c\u50cf\uff1a mkdir /root/cdrom mount vms.iso /root/cdrom \u590d\u5236\u955c\u50cf\u6587\u4ef6\uff1a mkdir /home/myerh cp -r /media/erhos/. /home/myerh/ 2.2 2. \u76f4\u63a5\u4e0b\u8f7d\u5b89\u88c5\u5305 \u00b6 \u53c2\u89c1 \u53ea\u4e0b\u8f7drpm\u5305 2.3 3. \u5c06\u6253\u5305\u597d\u7684rpm\u5305\u62f7\u8d1d\u5230Packages\u76ee\u5f55\u4e2d\uff0c\u5982\u679c\u8be5rpm\u5305\u662f\u4fee\u6539\u540e\u7684\u5219\u5220\u9664\u539f\u6709\u7684rpm\u5305\uff0c\u5982\u679c\u662f\u65b0\u5efa\u7684\u5219\u4e0d\u9700\u8981 \u00b6 cp redhat-logo-60.0.14-14.el6.centos.noarch.rpm /home/myerh/Packages rm -f /home/myerh/packages/redhat-logo-60.0.14-12.el6.centos.noarch.rpm \u5982\u679c\u955c\u50cf\u672c\u8eab\u6ca1\u6709\u8be5rpm\u5305\uff0c\u9700\u8981\u5728\u5bf9\u5e94\u7684 isolinux/xxx.cfg \u5f15\u5bfc\u6587\u4ef6\u4e2d\u6dfb\u52a0\u8be5\u5305\u7684\u7d22\u5f15\uff0c\u4f9d\u8d56\u5305\u4e0d\u9700\u8981\u6dfb\u52a0 eg . %packages vdsm tree %end 2.4 4. \u66f4\u65b0rpm\u4ed3\u5e93 \u00b6 \u62f7\u8d1d xml\u6587\u4ef6\u5230home\u76ee\u5f55\u4e0b cp 2727 ... comps . xml / home \u6e05\u7a7a repodata\u6587\u4ef6\u5939\u5185\u5bb9 rm - f repodata /* \u62f7\u8d1dxml\u6587\u4ef6\u5230repodata\u5e76\u91cd\u547d\u540d mv /home/...comps.xml repodata/comps.xml createrepo -d -g repodata/comps.xml . 2.5 5. \u66ff\u6362\u5bf9\u5e94\u7684logo \u5728home/myerh/isolinux/erh\u4e2d\u66ff\u6362\u56fe\u7247 \u00b6 2.6 6. \u6253\u5305iso\u955c\u50cf\uff08\u8be5\u64cd\u4f5c\u5728home/myerh\u76ee\u5f55\u4e0b\u8fdb\u884c\uff09 \u00b6 \uff08/home/ovirt3.5.iso\u4e3a\u6587\u4ef6iso\u6587\u4ef6\u540d\uff0covirt\u4e3aISO\u5377\u6807,\u9700\u8981\u8ddfiso\u6587\u4ef6\u4e2d\u7684\u540d\u5b57\u4fdd\u6301\u4e00\u81f4\u3002\uff09 mkisofs -R -J -T -r -l -d -o /home/ovirt3.5.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -V ovirt .","title":"\u5236\u4f5ciso\u955c\u50cf"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#1","text":"mkisofs -o xxx.iso -J -R -V bb diretory -V\u540e\u9762\u7684bb\u4e3a\u6307\u5b9a\u5149\u76d8\u7684\u5377\u518c\u96c6ID\uff0cdiretory\u4e3a\u9700\u8981\u6253\u5305\u7684\u6587\u4ef6\u5939\u540d\u5b57 \u5982\u679c\u9700\u8981\u4fdd\u6301\u539f\u59cb\u6587\u4ef6\u540d\uff0c\u8981\u6dfb\u52a0-J\u53c2\u6570\uff0c\u5426\u5219\u6253\u5305\u540e\uff0c\u6587\u4ef6\u540d\u5168\u6539\u53d8\u4e86 \u5982\u679c\u9700\u8981\u6392\u9664\u90e8\u5206\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u4f7f\u7528-x excludefolder","title":"1. \u5236\u4f5c\u955c\u50cf"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#2-rpm","text":"","title":"2. \u66f4\u65b0rpm\u5305"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#21-1-iso","text":"\u6302\u8f7d\u955c\u50cf\uff1a mkdir /root/cdrom mount vms.iso /root/cdrom \u590d\u5236\u955c\u50cf\u6587\u4ef6\uff1a mkdir /home/myerh cp -r /media/erhos/. /home/myerh/","title":"2.1 1.    \u5c06\u5f53\u524d\u7cfb\u7edf\u955c\u50cf\u6587\u4ef6\u62f7\u8d1d\u81f3\u6307\u5b9a\u76ee\u5f55\uff0c\u6302\u8f7d\u955c\u50cf\u6587\u4ef6\uff0c\u4e0e\u672c\u7cfb\u7edf\u7684iso\u6587\u4ef6\u4fdd\u6301\u4e00\u81f4\u3002"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#22-2","text":"\u53c2\u89c1 \u53ea\u4e0b\u8f7drpm\u5305","title":"2.2 2.    \u76f4\u63a5\u4e0b\u8f7d\u5b89\u88c5\u5305"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#23-3-rpmpackagesrpmrpm","text":"cp redhat-logo-60.0.14-14.el6.centos.noarch.rpm /home/myerh/Packages rm -f /home/myerh/packages/redhat-logo-60.0.14-12.el6.centos.noarch.rpm \u5982\u679c\u955c\u50cf\u672c\u8eab\u6ca1\u6709\u8be5rpm\u5305\uff0c\u9700\u8981\u5728\u5bf9\u5e94\u7684 isolinux/xxx.cfg \u5f15\u5bfc\u6587\u4ef6\u4e2d\u6dfb\u52a0\u8be5\u5305\u7684\u7d22\u5f15\uff0c\u4f9d\u8d56\u5305\u4e0d\u9700\u8981\u6dfb\u52a0 eg . %packages vdsm tree %end","title":"2.3 3.    \u5c06\u6253\u5305\u597d\u7684rpm\u5305\u62f7\u8d1d\u5230Packages\u76ee\u5f55\u4e2d\uff0c\u5982\u679c\u8be5rpm\u5305\u662f\u4fee\u6539\u540e\u7684\u5219\u5220\u9664\u539f\u6709\u7684rpm\u5305\uff0c\u5982\u679c\u662f\u65b0\u5efa\u7684\u5219\u4e0d\u9700\u8981"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#24-4-rpm","text":"\u62f7\u8d1d xml\u6587\u4ef6\u5230home\u76ee\u5f55\u4e0b cp 2727 ... comps . xml / home \u6e05\u7a7a repodata\u6587\u4ef6\u5939\u5185\u5bb9 rm - f repodata /* \u62f7\u8d1dxml\u6587\u4ef6\u5230repodata\u5e76\u91cd\u547d\u540d mv /home/...comps.xml repodata/comps.xml createrepo -d -g repodata/comps.xml .","title":"2.4 4.    \u66f4\u65b0rpm\u4ed3\u5e93"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#25-5-logo-homemyerhisolinuxerh","text":"","title":"2.5 5.    \u66ff\u6362\u5bf9\u5e94\u7684logo \u5728home/myerh/isolinux/erh\u4e2d\u66ff\u6362\u56fe\u7247"},{"location":"\u5176\u5b83/\u5236\u4f5ciso\u955c\u50cf/#26-6-isohomemyerh","text":"\uff08/home/ovirt3.5.iso\u4e3a\u6587\u4ef6iso\u6587\u4ef6\u540d\uff0covirt\u4e3aISO\u5377\u6807,\u9700\u8981\u8ddfiso\u6587\u4ef6\u4e2d\u7684\u540d\u5b57\u4fdd\u6301\u4e00\u81f4\u3002\uff09 mkisofs -R -J -T -r -l -d -o /home/ovirt3.5.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -V ovirt .","title":"2.6 6.    \u6253\u5305iso\u955c\u50cf\uff08\u8be5\u64cd\u4f5c\u5728home/myerh\u76ee\u5f55\u4e0b\u8fdb\u884c\uff09"},{"location":"\u5176\u5b83/\u6ca1\u6709\u6253\u5370\u65e5\u5fd7/","text":"\u5c1d\u8bd5\u5c06\u4e0d\u540c\u7684\u5730\u65b9\u7684\u65e5\u5fd7\u8f93\u51fa\u5230\u4e0d\u540c\u7684\u6587\u4ef6","title":"\u6ca1\u6709\u6253\u5370\u65e5\u5fd7"},{"location":"\u5176\u5b83/\u7f16\u8bd1\u5b89\u88c5vdsm\u4e4b\u540e\u4e3b\u673a\u5b89\u88c5\u5931\u8d25/","text":"\u53ef\u80fd\u7f3a\u5c11rpm\u5305 tripwire.rpm","title":"\u7f16\u8bd1\u5b89\u88c5vdsm\u4e4b\u540e\u4e3b\u673a\u5b89\u88c5\u5931\u8d25"},{"location":"\u547d\u4ee4/awk/","text":"gawk [ POSIX or GNU style options ] - f program - file [ -- ] file ... gawk [ POSIX or GNU style options ] [ -- ] program - text file ... OPTIONS - F fs -- field - separator fs \u6307\u5b9a\u5206\u9694\u7b26 program Built - in Variables FS The input field separator , a space by default . OFS The output field separator , a space by default . RS The input record separator , by default a newline . ORS The output record separator , by default a newline . NF The number of fields in the current input record . NR The total number of input records seen so far . Patterns BEGIN END BEGINFILE ENDFILE / regular expression / relational expression pattern && pattern pattern || pattern pattern ? pattern : pattern ( pattern ) ! pattern pattern1 , pattern2 Control Statements if ( condition ) statement [ else statement ] while ( condition ) statement do statement while ( condition ) for ( expr1 ; expr2 ; expr3 ) statement for ( var in array ) statement break continue delete array [ index ] delete array exit [ expression ] { statements } switch ( expression ) { case value | regex : statement ... [ default : statement ] } [ root@dev vitest ] # cat -n /etc/passwd | awk -F: 'NR==1 {printf \"%12s%12s\\n\", \"name\", \"bash\"}; $3 < 5 {print $1\"\\t\"$7}' name bash 1 root /bin/bash 2 bin /sbin/nologin 3 daemon /sbin/nologin 4 adm /sbin/nologin 5 lp /sbin/nologin # \u5206\u9694\u7b26\u4e5f\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u5b9a\u4e49\uff0c\u6548\u679c\u540c\u4e0a [ root@dev vitest ] # cat -n /etc/passwd | awk 'BEGIN {FS=\":\"}; NR==1 {printf \"%12s%12s\\n\", \"name\", \"bash\"}; $3 < 5 {print $1\"\\t\"$7}' # \u811a\u672c\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u65e0\u9700$\u7b26\u53f7 [ root@dev vitest ] # cat -n /etc/passwd | awk 'BEGIN {FS=\":\"; head1=\"name\"}; NR==1 {head2=\"bash\"; printf \"%12s%12s\\n\", head1, head2}; $3 < 5 {print $1\"\\t\"$7}' awk\u8fd8\u652f\u6301\u8fd0\u7b97\uff1a cat pay. txt | \\ > awk ' {if(NR==1) printf \"%10s %10s %10s %10s %10s\\n\", $1, $2, $3, $4, \"Total\"} > NR>=2{total = $2 + $3 + $4 > printf \"%10s %10d %10d %10d %10.2f\\n\", $1, $2, $3, $4, total}'","title":"Awk"},{"location":"\u547d\u4ee4/echo\u7684\u989c\u8272\u8f93\u51fa\u4e0e\u5149\u6807\u5b9a\u4f4d/","text":"\u4f7f\u7528 -e \u9009\u9879\uff1a\u5f00\u542f\u5bf9\u53cd\u659c\u7ebf \\ \u7684\u8f6c\u4e49\u3002 echo -e \"<\u8f6c\u4e49\u7b26\u53f7>[\u5185\u5bb9]\" \u56e0\u4e3a\u811a\u672c\u4e2d\u7684echo\u8bed\u53e5\u4f1a\u5f71\u54cd\u5230\u547d\u4ee4\u884c\u7684\u8f93\u51fa\u683c\u5f0f\uff0c\u6240\u4ee5\u4e00\u822c\u5728\u8f93\u51fa\u5b8c\u6bd5\u540e\u90fd\u4f1a\u8ffd\u52a0 \\033[0m \u6e05\u9664\u683c\u5f0f\u3002 echo -e \"<\u8f6c\u4e49\u7b26\u53f7>[\u5185\u5bb9]\\033[0m\" \u6ce8\u610f \uff1a\u8f6c\u4e49\u7b26\u53f7\u5e76\u4e0d\u662f echo \u72ec\u6709\u7684\uff0c\u800c\u662f\u5728\u6240\u6709\u652f\u6301\u8f6c\u4e49\u7684\u5e73\u53f0\u4e0a\u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u6bd4\u5982java\u3002 \u5e38\u7528\u7684\u8f6c\u4e49\u7b26\u53f7\u5982\u4e0b\uff1a \u8f6c\u4e49\u7b26\u53f7 \u8f6c\u4e49\u8bf4\u660e \\033[0m \u5173\u95ed\u6240\u6709\u5c5e\u6027 \\033[1m \u8bbe\u7f6e\u9ad8\u4eae\u5ea6 \\033[4m \u4e0b\u5212\u7ebf \\033[5m \u95ea\u70c1 \\033[7m \u53cd\u663e \\033[30m \u2014 \\033[37m \u8bbe\u7f6e\u524d\u666f\u8272 \\033[40m \u2014 \\033[47m \u8bbe\u7f6e\u80cc\u666f\u8272 \\033[nA \u5149\u6807\u4e0a\u79fbn\u884c \\033[nB \u5149\u6807\u4e0b\u79fbn\u884c \\033[nC \u5149\u6807\u53f3\u79fbn\u5217 \\033[nD \u5149\u6807\u5de6\u79fbn\u5217 \\033[y;xH \u8bbe\u7f6e\u5149\u6807\u4f4d\u7f6e\uff1b\u662f\u76f8\u5bf9\u4e8e\u5f53\u524d\u663e\u793a\u7684\u5c4f\u5e55\u6765\u5b9a\u4f4d\u7684 \\033[2J \u6e05\u5c4f \\033[K \u6e05\u9664\u4ece\u5149\u6807\u5230\u884c\u5c3e\u7684\u5185\u5bb9 \\033[s \u4fdd\u5b58\u5149\u6807\u4f4d\u7f6e \\033[u \u6062\u590d\u5149\u6807\u4f4d\u7f6e \\033[?25l \u9690\u85cf\u5149\u6807\uff08\u5c0f\u5199\u7684L\uff09 \\033[?25h \u663e\u793a\u5149\u6807 \\033 \u8868\u793a\u542f\u52a8\u4e00\u4e2a\u8f6c\u4e49\u5e8f\u5217\uff0c [ \u8868\u793a\u5b9a\u4e49\u5f00\u59cb\u3002 \u65f6\u949f\u5c0f\u4f8b\u5b50\uff1a #!/bin/bash n = $1 while [[ $n > 0 ]] do date = ` date + '%Y-%m-%d %H:%M:%S' ` # first implemention echo -e -n \"\\033[?25l\\033[31m ${ date } \\033[0m\\r\" # second implemention #echo -e \"\\033[31m${date}\\033[0m\" #echo -e \"\\033[2A\\033[?25l\" sleep 1 (( n-- )) done echo -e \"\\033[?25h\"","title":"Echo\u7684\u989c\u8272\u8f93\u51fa\u4e0e\u5149\u6807\u5b9a\u4f4d"},{"location":"\u547d\u4ee4/gpg/","text":"gpg(GnuPG)\u662fGNU\u53d1\u5e03\u7684\u514d\u8d39\u52a0\u5bc6\u8f6f\u4ef6\u3002 \u7b97\u6cd5\u652f\u6301\uff1a \u7b7e\u540d: RSA, ?, ?, ELG, DSA \u52a0\u5bc6: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH, CAMELLIA128, CAMELLIA192, CAMELLIA256 \u54c8\u5e0c: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224 \u538b\u7f29: Uncompressed, ZIP, ZLIB, BZIP2 gpg2 [ -- homedir dir ] [ -- options file ] [ options ] command [ args ] Sign , check , encrypt or decrypt , Default operation depends on the input data Commands : - s , -- sign \u7b7e\u540d make a signature -- clearsign make a clear text signature - b , -- detach - sign make a detached signature - e , -- encrypt \u52a0\u5bc6 - c , -- symmetric \u53ea\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u8fdb\u884c\u52a0\u5bc6 -- cipher - algo \u6307\u5b9a\u52a0\u5bc6\u7b97\u6cd5 - d , -- decrypt \u89e3\u5bc6 ( default ) -- verify \u9a8c\u8bc1\u7b7e\u540d -- fingerprint [ names ] show fingerprints - k , -- list - keys , -- list - public - keys \u5217\u51fa keys -- list - sigs \u5217\u51fa keys and signatures -- check - sigs \u5217\u51fa \u5e76 \u68c0\u67e5 key signatures -- fingerprint \u5217\u51fa keys and fingerprints - K , -- list - secret - keys \u5217\u51fa secret keys -- gen - key \u751f\u6210\u4e00\u4e2a\u65b0\u7684\u5bc6\u94a5\u5bf9 -- gen - revoke \u751f\u6210\u4e00\u4e2a\u540a\u9500\u8bc1\u4e66 -- delete - keys \u4ece\u516c\u94a5\u5e93\u4e2d\u5220\u9664\u5bc6\u94a5\u5bf9 -- delete - secret - keys \u4ece\u79c1\u94a5\u5e93\u4e2d\u5220\u9664\u5bc6\u94a5\u5bf9 -- sign - key \u5bf9\u4e00\u4e2a key \u7b7e\u540d -- lsign - key \u5bf9\u4e00\u4e2a key \u8fdb\u884c\u672c\u5730\u7b7e\u540d -- edit - key \u7b7e\u540d\u6216\u7f16\u8f91\u4e00\u4e2a key -- passwd \u4fee\u6539\u5bc6\u7801 -- export export keys -- export - secret - key \u5bfc\u51fa\u79c1\u94a5 export secret keys -- import import / merge keys Options : - a , -- armor create ascii armored output - r , -- recipient USER - ID \u6536\u4ef6\u4eba\uff0c\u63a5\u6536\u65b9 - u , -- local - user USER - ID use USER - ID to sign or decrypt - z N set compress level to N ( 0 disables ) -- textmode use canonical text mode - o , -- output FILE write output to FILE - n , -- dry - run do not make any changes -- openpgp use strict OpenPGP behavior \u4f7f\u7528\u79c1\u94a5\u65f6\u9700\u8981\u8f93\u5165\u5bc6\u7801\uff0c\u4f46\u662f\u4e24\u6b21\u8f93\u5165\u4e4b\u95f4\u4e0d\u8d85\u8fc7\u4e00\u5b9a\u7684\u65f6\u95f4\u5219\u65e0\u9700\u518d\u6b21\u8f93\u5165\uff0c\u7c7b\u4f3c\u4e0esudo\u547d\u4ee4\u3002 1. \u751f\u6210key \u00b6 # \u751f\u6210\u4e00\u4e2a\u53ea\u7528\u4e8e\u7b7e\u540d\u7684 key [ user1@dev ~ ] $ gpg --gen-key Please select what kind of key you want: # \u751f\u6210\u7b7e\u540d\u548c\u52a0\u5bc6\u5bc6\u94a5\u5bf9 ( 1 ) RSA and RSA ( default ) ( 2 ) DSA and Elgamal # \u751f\u6210\u7b7e\u540d\u5bc6\u94a5\u5bf9 ( 3 ) DSA ( sign only ) ( 4 ) RSA ( sign only ) Your selection? 4 # \u586b\u5199\u4e2a\u4eba\u4fe1\u606f Real name: sign-user Email address: sign-user@qq.com Comment: test sign You selected this USER-ID: \"sign-user (test sign) <sign-user@qq.com>\" # \u8fd9\u91cc\u53ef\u4ee5\u7ee7\u7eed\u4fee\u6539 Change ( N ) ame, ( C ) omment, ( E ) mail or ( O ) kay/ ( Q ) uit? O You need a Passphrase to protect your secret key. # \u952e\u5165\u5bc6\u7801 \u2026\u2026 gpg: key E0F6E6AC marked as ultimately trusted public and secret key created and signed. gpg: checking the trustdb gpg: 3 marginal ( s ) needed, 1 complete ( s ) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0 -, 0q, 0n, 0m, 0f, 1u pub 4096R/E0F6E6AC 2019 -10-15 Key fingerprint = 7C66 A689 7C6F A1BA 187F 7204 5F46 7860 E0F6 E6AC uid sign-user ( test sign ) <sign-user@qq.com> # \u751f\u6210\u4e00\u4e2a\u7528\u4e8e\u7b7e\u540d\u548c\u52a0\u5bc6\u7684 key [ user1@dev ~ ] $ gpg --gen-key Please select what kind of key you want: ( 1 ) RSA and RSA ( default ) ( 2 ) DSA and Elgamal ( 3 ) DSA ( sign only ) ( 4 ) RSA ( sign only ) Your selection? 1 \u2026\u2026 Real name: secret-user Email address: secret-user@qq.com Comment: test secret and sign You selected this USER-ID: \"secret-user (test secret and sign) <secret-user@qq.com>\" \u2026\u2026 gpg: key F5CDD34C marked as ultimately trusted public and secret key created and signed. gpg: checking the trustdb gpg: 3 marginal ( s ) needed, 1 complete ( s ) needed, PGP trust model gpg: depth: 0 valid: 2 signed: 0 trust: 0 -, 0q, 0n, 0m, 0f, 2u # \u7528\u4e8e\u7b7e\u540d\u7684key\uff0c\u4e5f\u662fPrimary key pub 4096R/F5CDD34C 2019 -10-15 Key fingerprint = 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u7528\u4e8e\u52a0\u5bc6\u7684key\uff0c\u4e5f\u662f Subkey sub 4096R/8B3EBB7E 2019 -10-15 1.1 \u51fa\u73b0\u7684\u95ee\u9898 \u00b6 \u5728\u8981\u8f93\u5165\u5bc6\u7801\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4e0d\u4f1a\u51fa\u73b0\u5f39\u7a97\uff0c\u751f\u6210\u5bc6\u7801\u8fc7\u7a0b\u76f4\u63a5\u88ab\u53d6\u6d88\u4e86\uff1a gpg : cancelled by user gpg : Key generation canceled . \u6b64\u65f6\u53ef\u4ee5\u5c1d\u8bd5\u8fd9\u6837\u505a\uff1a # \u67e5\u770b tty \u7684\u6743\u9650\u662f\u5426\u548c\u5f53\u524d\u7528\u6237\u4e00\u81f4\uff0c\u8fd9\u91cc\u770b\u5230\u660e\u663e\u4e0d\u5bf9\uff08\u8fd9\u662f\u6211\u4eceroot\u7528\u6237\u5207\u6362\u8fc7\u6765\u7684\uff09 [ gpg-user@convert-rpm ~ ] $ ls -la $( tty ) crw--w----. 1 root tty 136 , 0 Oct 16 06 :06 /dev/pts/0 # \u90a3\u4e48\u5c31\u9000\u51fa\u91cd\u65b0\u4f7f\u7528\u666e\u901a\u7528\u6237\u767b\u5f55\uff0c\u518d\u6b21\u67e5\u770b [ gpg-user@convert-rpm ~ ] $ ll -a $( tty ) crw--w----. 1 gpg-user tty 136 , 0 Oct 16 06 :07 /dev/pts/0 # \u6b64\u65f6\u6743\u9650\u8db3\u591f\uff0c\u53ef\u4ee5\u6b63\u5e38\u7684\u51fa\u73b0\u6587\u5b57\u754c\u9762\u7684\u5f39\u7a97\u5566\uff01 \u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u5728\u8f93\u5b8c\u5bc6\u7801\u4e4b\u540e\u5c31\u6302\u8d77\u4e86\uff0c\u6ca1\u6709\u53cd\u5e94\u4e86\uff1a We need to generate a lot of random bytes .\u2026\u2026 this gives the random number generator a better chance to gain enough entropy . \u8fd9\u662f\u968f\u673a\u6570\u4e0d\u8db3\u5bfc\u81f4\u7684\uff0c\u6b64\u65f6\u6253\u5f00\u53e6\u4e00\u4e2a\u7a97\u53e3\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u6307\u4ee4\uff0c\u751f\u6210\u8db3\u591f\u7684\u968f\u673a\u6570\uff08\u5c31\u662f\u64cd\u4f5c\u78c1\u76d8\uff09\uff0c\u8fc7\u4e00\u4f1a\u4e8c\u5c31\u4f1a\u5b8c\u6210\u5bc6\u7801\u7684\u751f\u6210\u4e86\uff1a dd if = /dev/sda of = /dev/zero 2. \u67e5\u770bkey \u00b6 \u8fd9\u4e9b\u9009\u9879\u5728\u811a\u672c\u6216\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u65f6\u5e94\u642d\u914d --with-colons \u9009\u9879\uff0c\u53d8\u4e3a\u6613\u4e8e\u673a\u5668\u89e3\u6790\u7684\u8f93\u51fa\u3002 [ user1@dev ~ ] $ gpg -k /home/user1/.gnupg/pubring.gpg ------------------------------ # \u7b7e\u540d\u7528\u7684\u516c\u94a5 \u7c7b\u578b \u7b97\u6cd5/\u5bc6\u94a5ID ( \u552f\u4e00\u6807\u8bc6\u7b26\uff0cfingerprint\u7684\u540e8\u4f4d ) pub 4096R/E0F6E6AC 2019 -10-15 uid sign-user ( test sign ) <sign-user@qq.com> # \u7b7e\u540d\u7528\u7684\u516c\u94a5 pub 4096R/F5CDD34C 2019 -10-15 # \u5bc6\u94a5\u7684\u4fe1\u606f uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u52a0\u5bc6\u7528\u7684\u516c\u94a5 sub 4096R/8B3EBB7E 2019 -10-15 [ user1@dev ~ ] $ gpg -K /home/user1/.gnupg/secring.gpg ------------------------------ # \u7b7e\u540d\u7528\u7684\u79c1\u94a5 sec 4096R/E0F6E6AC 2019 -10-15 uid sign-user ( test sign ) <sign-user@qq.com> # \u7b7e\u540d\u7528\u7684\u79c1\u94a5 sec 4096R/F5CDD34C 2019 -10-15 uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u52a0\u5bc6\u7528\u7684\u79c1\u94a5 ssb 4096R/8B3EBB7E 2019 -10-15 # \u4f7f\u7528\u673a\u5668\u89e3\u6790\u683c\u5f0f\u8f93\u51fa\u5e76\u683c\u5f0f\u5316\u8f93\u51fa [ user1@dev ~ ] $ gpg --list-sigs --with-colon | awk -F: 'BEGIN {ORS=\"\\n\"; fileds=21; for(i=1;i<=fileds;++i) printf \"%-5d \", i; printf \"\\n\"}; {print $0; for(i=1;i<=fileds;++i) printf \"%-5.5s \", $i; printf \"\\n\"}' 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 tru::1:1571190311:0:3:1:5 tru 1 15711 0 3 1 5 pub:u:4096:1:5F467860E0F6E6AC:1571129294:::u:::scSC: pub u 4096 1 5F467 15711 u scSC uid:u::::1571129294::65ED1361B91C5E7E527F0CD76F7296C54E1E0EF9::sign-user ( test sign ) <sign-user@qq.com>: uid u 15711 65ED1 sign- sig:::1:5F467860E0F6E6AC:1571129294::::sign-user ( test sign ) <sign-user@qq.com>:13x:::::2: sig 1 5F467 15711 sign- 13x 2 pub:u:4096:1:F3926847F5CDD34C:1571129468:::u:::scESC: pub u 4096 1 F3926 15711 u scESC uid:u::::1571129468::E31596C92F9195FD6F05F65AFD02F2A712FD9CF2::secret-user ( test secret and sign ) <secret-user@qq.com>: uid u 15711 E3159 secre sig:::1:F3926847F5CDD34C:1571129468::::secret-user ( test secret and sign ) <secret-user@qq.com>:13x:::::2: sig 1 F3926 15711 secre 13x 2 sub:u:4096:1:A26E02608B3EBB7E:1571129468::::::e: sub u 4096 1 A26E0 15711 e sig:::1:F3926847F5CDD34C:1571129468::::secret-user ( test secret and sign ) <secret-user@qq.com>:18x:::::2: sig 1 F3926 15711 secre 18x 2 pub:u:4096:1:E16574E67A028145:1571190309:::u:::scSC: pub u 4096 1 E1657 15711 u scSC uid:u::::1571190309::7B6291D3B9F2863E967E7429E864B6A71296E660::local-sign-user ( sign key in local ) <local-sign-user@local.com>: uid u 15711 7B629 local sig:::1:E16574E67A028145:1571190309::::local-sign-user ( sign key in local ) <local-sign-user@local.com>:13x:::::2: sig 1 E1657 15711 local 13x 2 \u5173\u4e8e\u5404\u5b57\u6bb5\u7684\u542b\u4e49\u53c2\u8003\uff1ahttps://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=doc/DETAILS;h=315f56e31157c6e8998f4335bf63d594b10e8923;hb=HEAD \u5e38\u89c1\u7684\u5b57\u6bb5\u610f\u4e49\uff0c\u5e8f\u53f7\u4ee3\u8868\u7b2c\u51e0\u4e2a\u5b57\u6bb5\uff1a \u8bb0\u5f55\u7684\u7c7b\u578b pub :: Public key sub :: Subkey (secondary key) sec :: Secret key ssb :: Secret subkey (secondary key) sig :: Signature uid :: User id crt :: X.509 certificate \u6709\u6548\u671f o :: Unknown (this key is new to the system) u :: The key is ultimately valid. \u5bc6\u94a5\u957f\u5ea6\uff0c\u5355\u4f4d\u662fbit \u516c\u94a5\u7b97\u6cd5\u3002\u4e0e\u5217\u51fa\u7684\u7b97\u6cd5\u987a\u5e8f\u76f8\u5bf9\u5e94 \u5bc6\u94a5ID \u521b\u5efa\u65e5\u671f\uff0c\u5bf9\u4e8e uid \u548c uat \u7c7b\u578b\u7684\u8bb0\u5f55\uff0c\u6b64\u503c\u662f\u81ea\u7b7e\u7684\u65e5\u671f\u3002\u4ece1970.01.01\u4ee5\u6765\u7684\u79d2\u6570 \u8fc7\u671f\u65e5\u671f\u3002 \u8bc1\u4e66\u7684 serial number\uff0cUID\u7684\u54c8\u5e0c\uff0c\u4fe1\u4efb\u7b7e\u540d\u7684\u4fe1\u606f\uff08\u7b2c\u4e00\u4e2a\u503c\u662f\u4fe1\u4efb\u6df1\u5ea6 \uff09 Ownertrust\uff0c\u53ea\u5728\u4e3b\u952e\u4e0a\u5b58\u5728\uff0c\u4fe1\u4efb\u7b7e\u540d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f User-ID \u7b7e\u540d\u7c7b\u578b \u5bc6\u94a5\u80fd\u529b\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4f5c\u7528\u7684\u4efb\u610f\u7ec4\u5408 e :: Encrypt s :: Sign c :: Certify a :: Authentication ? :: Unknown capability D :: \u8868\u793a\u7981\u7528\u7684\u5bc6\u94a5 \u4e3b\u5bc6\u94a5\u4e0a\u7684\u5927\u5199\u5b57\u6bcd\u8868\u793a\u6574\u4e2a\u5bc6\u94a5\u7684\u53ef\u7528\u529f\u80fd \u9881\u53d1\u8005\u8bc1\u4e66\u6307\u7eb9\u6216\u5176\u4ed6\u4fe1\u606f sig\u7684\u54c8\u5e0c\u7b97\u6cd5\u3002\u4e0e\u5217\u51fa\u7684\u7b97\u6cd5\u987a\u5e8f\u76f8\u5bf9\u5e94 3. \u7f16\u8f91key \u00b6 [ user1@dev ~ ] $ gpg --edit-key shihr Secret key is available. pub 4096R/E0F6E6AC created: 2019 -10-15 expires: never usage: SC trust: ultimate validity: ultimate [ ultimate ] ( 1 ) . sign-user ( test sign ) <sign-user@qq.com> # \u4f7f\u7528 ? \u5217\u51fa\u53ef\u7528\u547d\u4ee4 gpg> 4. \u5bfc\u5165\u5bfc\u51fakey \u00b6 \u5bfc\u51fa [ user1@dev ~ ] $ gpg --export secret-user --textmode -o secret-user.pub [ user1@dev ~ ] $ scp secret-user.pub gpg-user@192.168.216.158:/home/gpg-user/gpg-test [ user1@dev ~ ] $ gpg --export --armor F5CDD34C -----BEGIN PGP PUBLIC KEY BLOCK----- Version: GnuPG v2.0.22 ( GNU/Linux ) mQINBF2liHwBEACzdVPSVCyMUNEiS2HCpPyuV5uRYGXOxQMgtSZZX7vOxwUH3SLm \u2026\u2026 -----END PGP PUBLIC KEY BLOCK----- \u5bfc\u5165 [ gpg-user@convert-rpm ~ ] $ gpg --import secret-user.pub gpg: key F5CDD34C: public key \"secret-user (test secret and sign) <secret-user@qq.com>\" imported gpg: Total number processed: 1 gpg: imported: 1 ( RSA: 1 ) [ gpg-user@convert-rpm ~ ] $ gpg -K [ gpg-user@convert-rpm ~ ] $ gpg -k /home/gpg-user/.gnupg/pubring.gpg --------------------------------- pub 4096R/F5CDD34C 2019 -10-15 uid secret-user ( test secret and sign ) <secret-user@qq.com> sub 4096R/8B3EBB7E 2019 -10-15 5. \u52a0\u89e3\u5bc6\u6587\u4ef6 \u00b6 # \u516c\u94a5\u52a0\u5bc6 [ gpg-user@convert-rpm ~ ] $ gpg -r F5CDD34C -e -o secret-f origin-f.txt gpg: 8B3EBB7E: There is no assurance this key belongs to the named user # \u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u52a0\u5bc6\u662f\u4f7f\u7528 Subkey \u6765\u52a0\u5bc6\u7684\uff0c\u800c\u4e0d\u662f Primary key pub 4096R/8B3EBB7E 2019 -10-15 secret-user ( test secret and sign ) <secret-user@qq.com> Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C Subkey fingerprint: 3303 FF26 B8EF 54AB 380C 27B6 A26E 0260 8B3E BB7E It is NOT certain that the key belongs to the person named in the user ID. If you *really* know what you are doing, you may answer the next question with yes. Use this key anyway? ( y/N ) y [ gpg-user@convert-rpm ~ ] $ scp secret-f user1@192.168.216.163:~ # \u79c1\u94a5\u89e3\u5bc6 [ user1@dev ~ ] $ gpg -d -o decryption-f secret-f You need a passphrase to unlock the secret key for user: \"secret-user (test secret and sign) <secret-user@qq.com>\" 4096 -bit RSA key, ID 8B3EBB7E, created 2019 -10-15 ( main key ID F5CDD34C ) # \u8fd9\u91cc\u540c\u6837\u4e5f\u80fd\u770b\u51fa\u662f\u7b2c\u4e8c\u4e2akey\u6765\u52a0\u5bc6\u7684 gpg: encrypted with 4096 -bit RSA key, ID 8B3EBB7E, created 2019 -10-15 \"secret-user (test secret and sign) <secret-user@qq.com>\" [ user1@dev ~ ] $ cat decryption-f hello world 6. \u7b7e\u540d \u00b6 # \u79c1\u94a5\u7b7e\u540d [ user1@dev ~ ] $ gpg -s -r 8B3EBB7E -o signed-f origin-f.txt gpg: WARNING: recipients ( -r ) given without using public key encryption You need a passphrase to unlock the secret key for user: \"sign-user (test sign) <sign-user@qq.com>\" 4096 -bit RSA key, ID E0F6E6AC, created 2019 -10-15 # \u521b\u5efa ascii \u683c\u5f0f\u8f93\u51fa\u7684\u7b7e\u540d\u6587\u4ef6 [ user1@dev ~ ] $ gpg -a -s -u F5CDD34C -o signed-f origin-f.txt [ user1@dev ~ ] $ cat signed-f -----BEGIN PGP MESSAGE----- Version: GnuPG v2.0.22 ( GNU/Linux ) owEBTgKx/ZANAwACAfOSaEf1zdNMAaweYgxvcmlnaW4tZi50eHRdpoqpaGVsbG8g \u2026\u2026 -----END PGP MESSAGE----- # \u521b\u5efa\u660e\u6587\u7b7e\u540d\u6587\u4ef6\u3002\u6ce8\u610f\uff1a \u9a8c\u8bc1\u660e\u6587\u7b7e\u540d\u65f6\uff0cgpg \u4ec5\u9a8c\u8bc1\u6784\u6210\u660e\u6587\u7b7e\u540d\u6570\u636e\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5728\u4eea\u8868\u677f\u884c\u4e4b\u540e\u7684\u660e\u6587\u7b7e\u540d\u6216\u6807\u9898\u884c\u4e4b\u5916\u7684\u4efb\u4f55\u5176\u4ed6\u6570\u636e\u3002\u6b64\u683c\u5f0f\u8fd8\u6709\u5176\u5b83\u7f3a\u9677\uff0c\u5efa\u8bae\u907f\u514d\u4f7f\u7528\u660e\u6587\u7b7e\u540d\uff0c\u800c\u91c7\u7528\u5206\u79bb\u7b7e\u540d\u3002 [ user1@dev ~ ] $ gpg --clearsign -s -u F5CDD34C -o signed-f origin-f.txt [ user1@dev ~ ] $ cat signed-f -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1 hello world -----BEGIN PGP SIGNATURE----- Version: GnuPG v2.0.22 ( GNU/Linux ) iQIcBAEBAgAGBQJdpop/AAoJEPOSaEf1zdNMjJsP/jiUpYyUr+/jjSFKnW2YoMq2 \u2026\u2026 -----END PGP SIGNATURE----- # \u521b\u5efa\u5206\u79bb\u5f0f\u7684\u7b7e\u540d\u6587\u4ef6\uff0c\u91cc\u9762\u4e0d\u5305\u542b\u6587\u4ef6\u5185\u5bb9\uff0c\u9a8c\u8bc1\u65f6\u9700\u8981\u548c\u539f\u6587\u4ef6\u4e00\u8d77\u9a8c\u8bc1 [ user1@dev ~ ] $ gpg -b -s -u F5CDD34C -o signed-f origin-f.txt # \u516c\u94a5\u9a8c\u8bc1 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f gpg: Signature made Tue 15 Oct 2019 09 :00:53 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\" gpg: WARNING: This key is not certified with a trusted signature! gpg: There is no indication that the signature belongs to the owner. Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C # \u9a8c\u8bc1\u5206\u79bb\u5f0f\u7b7e\u540d\u6587\u4ef6 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f origin-f.txt gpg: Signature made Tue 15 Oct 2019 11 :21:56 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\" 7. \u5bf9\u5916\u90e8\u5bfc\u5165\u516c\u94a5\u6dfb\u52a0\u4fe1\u4efb \u00b6 \u5728\u4e0a\u6587\u53ef\u4ee5\u770b\u5230\u5728\u4f7f\u7528\u516c\u94a5\u65f6\u53d1\u51fa\u4e86\u8b66\u544a\uff1a gpg : WARNING : This key is not certified with a trusted signature ! gpg : There is no indication that the signature belongs to the owner . \u65b9\u6cd5\u4e00\uff1a\u7f16\u8f91\u516c\u94a5\uff0c\u6dfb\u52a0\u4fe1\u4efb\u7b49\u7ea7 [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC # \u4fe1\u4efb\u7b49\u7ea7\uff08\u672a\u8bbe\u7f6e\uff09 \u6709\u6548\u671f trust: unknown validity: unknown sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ unknown ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> gpg> trust # \u8fd9\u91cc\u7684\u610f\u601d\u662f\u8bf4\u4f60\u9700\u8981\u53bb\u9a8c\u8bc1\u8fd9\u4e2a\u516c\u94a5\u7684\u5408\u6cd5\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u5bf9\u6bd4\u5bc6\u94a5\u7684 fingerprint \u6765\u68c0\u6d4b Please decide how far you trust this user to correctly verify other users ' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don' t know or won ' t say 2 = I do NOT trust # \u7a0d\u5fae\u4fe1\u4efb 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu # \u8fd9\u91cc\u9009\u62e95\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u4fe1\u4efb Your decision? 5 Do you really want to set this key to ultimate trust? ( y/N ) y pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ unknown ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> Please note that the shown key validity is not necessarily correct unless you restart the program. \u65b9\u6cd5\u4e8c\uff1a\u7f16\u8f91\u516c\u94a5\uff0c\u4f7f\u7528\u672c\u5730\u79c1\u94a5\u8fdb\u884c\u4fe1\u4efb\u7b7e\u540d [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C gpg> tsign pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: undefined validity: unknown Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C secret-user ( test secret and sign ) <secret-user@qq.com> Please decide how far you trust this user to correctly verify other users ' keys ( by looking at passports, checking fingerprints from different sources, etc. ) 1 = I trust marginally 2 = I trust fully Your selection? 2 Please enter the depth of this trust signature. A depth greater than 1 allows the key you are signing to make trust signatures on your behalf. Your selection? 2 # \u8fd9\u91cc\u4e0d\u61c2\uff1f\uff1f\uff1f Please enter a domain to restrict this signature, or enter for none. Your selection? 2 Are you sure that you want to sign this key with your key \"local-sign-user (use for local sign) <local-sign-user@local.com>\" ( C86BB985 ) Really sign? ( y/N ) y You need a passphrase to unlock the secret key for user: \"local-sign-user (use for local sign) <local-sign-user@local.com>\" 4096 -bit RSA key, ID C86BB985, created 2019 -10-16 gpg> save # \u518d\u6b21\u7f16\u8f91\uff0c\u53ef\u4ee5\u770b\u5230\u5c5e\u6027\u5df2\u7ecf\u53d1\u751f\u4e86\u53d8\u5316 [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: full validity: full sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ full ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> # \u540e\u9762\u4f7f\u7528\u516c\u94a5\u5c31\u4e0d\u4f1a\u6709\u8b66\u544a\u5566\uff01 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f gpg: Signature made Tue 15 Oct 2019 09 :00:53 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\" 8. \u4f7f\u7528\u5bf9\u79f0\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6 \u00b6 # \u52a0\u5bc6\uff0c\u9700\u8981\u8f93\u5165\u5bc6\u7801 [ user1@dev ~ ] $ gpg -c -o encryp-f origin-f.txt [ user1@dev ~ ] $ scp encryp-f gpg-user@192.168.216.158:~ # \u89e3\u5bc6 [ gpg-user@convert-rpm ~ ] $ gpg -d encryp-f gpg: CAST5 encrypted data gpg: encrypted with 1 passphrase hello world gpg: WARNING: message was not integrity protected # \u6307\u5b9a\u52a0\u5bc6\u7b97\u6cd5 [ user1@dev ~ ] $ gpg -c --cipher-algo AES -o encryp-f origin-f.txt [ user1@dev ~ ] $ gpg -d encryp-f gpg: AES encrypted data gpg: encrypted with 1 passphrase hello world \u652f\u6301\u7684\u7b97\u6cd5\u53ef\u4ee5\u4f7f\u7528 --verison \u9009\u9879\u5217\u51fa\uff1a [ user1@dev ~ ] $ gpg --version \u2026\u2026 Home: ~/.gnupg Supported algorithms: Pubkey: RSA, ?, ?, ELG, DSA Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH, CAMELLIA128, CAMELLIA192, CAMELLIA256 Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224 Compression: Uncompressed, ZIP, ZLIB, BZIP2 9. \u8d44\u6599 \u00b6 https://www.gnupg.org/howtos/zh/index.html","title":"Gpg"},{"location":"\u547d\u4ee4/gpg/#1-key","text":"# \u751f\u6210\u4e00\u4e2a\u53ea\u7528\u4e8e\u7b7e\u540d\u7684 key [ user1@dev ~ ] $ gpg --gen-key Please select what kind of key you want: # \u751f\u6210\u7b7e\u540d\u548c\u52a0\u5bc6\u5bc6\u94a5\u5bf9 ( 1 ) RSA and RSA ( default ) ( 2 ) DSA and Elgamal # \u751f\u6210\u7b7e\u540d\u5bc6\u94a5\u5bf9 ( 3 ) DSA ( sign only ) ( 4 ) RSA ( sign only ) Your selection? 4 # \u586b\u5199\u4e2a\u4eba\u4fe1\u606f Real name: sign-user Email address: sign-user@qq.com Comment: test sign You selected this USER-ID: \"sign-user (test sign) <sign-user@qq.com>\" # \u8fd9\u91cc\u53ef\u4ee5\u7ee7\u7eed\u4fee\u6539 Change ( N ) ame, ( C ) omment, ( E ) mail or ( O ) kay/ ( Q ) uit? O You need a Passphrase to protect your secret key. # \u952e\u5165\u5bc6\u7801 \u2026\u2026 gpg: key E0F6E6AC marked as ultimately trusted public and secret key created and signed. gpg: checking the trustdb gpg: 3 marginal ( s ) needed, 1 complete ( s ) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0 -, 0q, 0n, 0m, 0f, 1u pub 4096R/E0F6E6AC 2019 -10-15 Key fingerprint = 7C66 A689 7C6F A1BA 187F 7204 5F46 7860 E0F6 E6AC uid sign-user ( test sign ) <sign-user@qq.com> # \u751f\u6210\u4e00\u4e2a\u7528\u4e8e\u7b7e\u540d\u548c\u52a0\u5bc6\u7684 key [ user1@dev ~ ] $ gpg --gen-key Please select what kind of key you want: ( 1 ) RSA and RSA ( default ) ( 2 ) DSA and Elgamal ( 3 ) DSA ( sign only ) ( 4 ) RSA ( sign only ) Your selection? 1 \u2026\u2026 Real name: secret-user Email address: secret-user@qq.com Comment: test secret and sign You selected this USER-ID: \"secret-user (test secret and sign) <secret-user@qq.com>\" \u2026\u2026 gpg: key F5CDD34C marked as ultimately trusted public and secret key created and signed. gpg: checking the trustdb gpg: 3 marginal ( s ) needed, 1 complete ( s ) needed, PGP trust model gpg: depth: 0 valid: 2 signed: 0 trust: 0 -, 0q, 0n, 0m, 0f, 2u # \u7528\u4e8e\u7b7e\u540d\u7684key\uff0c\u4e5f\u662fPrimary key pub 4096R/F5CDD34C 2019 -10-15 Key fingerprint = 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u7528\u4e8e\u52a0\u5bc6\u7684key\uff0c\u4e5f\u662f Subkey sub 4096R/8B3EBB7E 2019 -10-15","title":"1. \u751f\u6210key"},{"location":"\u547d\u4ee4/gpg/#11","text":"\u5728\u8981\u8f93\u5165\u5bc6\u7801\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4e0d\u4f1a\u51fa\u73b0\u5f39\u7a97\uff0c\u751f\u6210\u5bc6\u7801\u8fc7\u7a0b\u76f4\u63a5\u88ab\u53d6\u6d88\u4e86\uff1a gpg : cancelled by user gpg : Key generation canceled . \u6b64\u65f6\u53ef\u4ee5\u5c1d\u8bd5\u8fd9\u6837\u505a\uff1a # \u67e5\u770b tty \u7684\u6743\u9650\u662f\u5426\u548c\u5f53\u524d\u7528\u6237\u4e00\u81f4\uff0c\u8fd9\u91cc\u770b\u5230\u660e\u663e\u4e0d\u5bf9\uff08\u8fd9\u662f\u6211\u4eceroot\u7528\u6237\u5207\u6362\u8fc7\u6765\u7684\uff09 [ gpg-user@convert-rpm ~ ] $ ls -la $( tty ) crw--w----. 1 root tty 136 , 0 Oct 16 06 :06 /dev/pts/0 # \u90a3\u4e48\u5c31\u9000\u51fa\u91cd\u65b0\u4f7f\u7528\u666e\u901a\u7528\u6237\u767b\u5f55\uff0c\u518d\u6b21\u67e5\u770b [ gpg-user@convert-rpm ~ ] $ ll -a $( tty ) crw--w----. 1 gpg-user tty 136 , 0 Oct 16 06 :07 /dev/pts/0 # \u6b64\u65f6\u6743\u9650\u8db3\u591f\uff0c\u53ef\u4ee5\u6b63\u5e38\u7684\u51fa\u73b0\u6587\u5b57\u754c\u9762\u7684\u5f39\u7a97\u5566\uff01 \u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u5728\u8f93\u5b8c\u5bc6\u7801\u4e4b\u540e\u5c31\u6302\u8d77\u4e86\uff0c\u6ca1\u6709\u53cd\u5e94\u4e86\uff1a We need to generate a lot of random bytes .\u2026\u2026 this gives the random number generator a better chance to gain enough entropy . \u8fd9\u662f\u968f\u673a\u6570\u4e0d\u8db3\u5bfc\u81f4\u7684\uff0c\u6b64\u65f6\u6253\u5f00\u53e6\u4e00\u4e2a\u7a97\u53e3\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u6307\u4ee4\uff0c\u751f\u6210\u8db3\u591f\u7684\u968f\u673a\u6570\uff08\u5c31\u662f\u64cd\u4f5c\u78c1\u76d8\uff09\uff0c\u8fc7\u4e00\u4f1a\u4e8c\u5c31\u4f1a\u5b8c\u6210\u5bc6\u7801\u7684\u751f\u6210\u4e86\uff1a dd if = /dev/sda of = /dev/zero","title":"1.1 \u51fa\u73b0\u7684\u95ee\u9898"},{"location":"\u547d\u4ee4/gpg/#2-key","text":"\u8fd9\u4e9b\u9009\u9879\u5728\u811a\u672c\u6216\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u65f6\u5e94\u642d\u914d --with-colons \u9009\u9879\uff0c\u53d8\u4e3a\u6613\u4e8e\u673a\u5668\u89e3\u6790\u7684\u8f93\u51fa\u3002 [ user1@dev ~ ] $ gpg -k /home/user1/.gnupg/pubring.gpg ------------------------------ # \u7b7e\u540d\u7528\u7684\u516c\u94a5 \u7c7b\u578b \u7b97\u6cd5/\u5bc6\u94a5ID ( \u552f\u4e00\u6807\u8bc6\u7b26\uff0cfingerprint\u7684\u540e8\u4f4d ) pub 4096R/E0F6E6AC 2019 -10-15 uid sign-user ( test sign ) <sign-user@qq.com> # \u7b7e\u540d\u7528\u7684\u516c\u94a5 pub 4096R/F5CDD34C 2019 -10-15 # \u5bc6\u94a5\u7684\u4fe1\u606f uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u52a0\u5bc6\u7528\u7684\u516c\u94a5 sub 4096R/8B3EBB7E 2019 -10-15 [ user1@dev ~ ] $ gpg -K /home/user1/.gnupg/secring.gpg ------------------------------ # \u7b7e\u540d\u7528\u7684\u79c1\u94a5 sec 4096R/E0F6E6AC 2019 -10-15 uid sign-user ( test sign ) <sign-user@qq.com> # \u7b7e\u540d\u7528\u7684\u79c1\u94a5 sec 4096R/F5CDD34C 2019 -10-15 uid secret-user ( test secret and sign ) <secret-user@qq.com> # \u52a0\u5bc6\u7528\u7684\u79c1\u94a5 ssb 4096R/8B3EBB7E 2019 -10-15 # \u4f7f\u7528\u673a\u5668\u89e3\u6790\u683c\u5f0f\u8f93\u51fa\u5e76\u683c\u5f0f\u5316\u8f93\u51fa [ user1@dev ~ ] $ gpg --list-sigs --with-colon | awk -F: 'BEGIN {ORS=\"\\n\"; fileds=21; for(i=1;i<=fileds;++i) printf \"%-5d \", i; printf \"\\n\"}; {print $0; for(i=1;i<=fileds;++i) printf \"%-5.5s \", $i; printf \"\\n\"}' 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 tru::1:1571190311:0:3:1:5 tru 1 15711 0 3 1 5 pub:u:4096:1:5F467860E0F6E6AC:1571129294:::u:::scSC: pub u 4096 1 5F467 15711 u scSC uid:u::::1571129294::65ED1361B91C5E7E527F0CD76F7296C54E1E0EF9::sign-user ( test sign ) <sign-user@qq.com>: uid u 15711 65ED1 sign- sig:::1:5F467860E0F6E6AC:1571129294::::sign-user ( test sign ) <sign-user@qq.com>:13x:::::2: sig 1 5F467 15711 sign- 13x 2 pub:u:4096:1:F3926847F5CDD34C:1571129468:::u:::scESC: pub u 4096 1 F3926 15711 u scESC uid:u::::1571129468::E31596C92F9195FD6F05F65AFD02F2A712FD9CF2::secret-user ( test secret and sign ) <secret-user@qq.com>: uid u 15711 E3159 secre sig:::1:F3926847F5CDD34C:1571129468::::secret-user ( test secret and sign ) <secret-user@qq.com>:13x:::::2: sig 1 F3926 15711 secre 13x 2 sub:u:4096:1:A26E02608B3EBB7E:1571129468::::::e: sub u 4096 1 A26E0 15711 e sig:::1:F3926847F5CDD34C:1571129468::::secret-user ( test secret and sign ) <secret-user@qq.com>:18x:::::2: sig 1 F3926 15711 secre 18x 2 pub:u:4096:1:E16574E67A028145:1571190309:::u:::scSC: pub u 4096 1 E1657 15711 u scSC uid:u::::1571190309::7B6291D3B9F2863E967E7429E864B6A71296E660::local-sign-user ( sign key in local ) <local-sign-user@local.com>: uid u 15711 7B629 local sig:::1:E16574E67A028145:1571190309::::local-sign-user ( sign key in local ) <local-sign-user@local.com>:13x:::::2: sig 1 E1657 15711 local 13x 2 \u5173\u4e8e\u5404\u5b57\u6bb5\u7684\u542b\u4e49\u53c2\u8003\uff1ahttps://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=doc/DETAILS;h=315f56e31157c6e8998f4335bf63d594b10e8923;hb=HEAD \u5e38\u89c1\u7684\u5b57\u6bb5\u610f\u4e49\uff0c\u5e8f\u53f7\u4ee3\u8868\u7b2c\u51e0\u4e2a\u5b57\u6bb5\uff1a \u8bb0\u5f55\u7684\u7c7b\u578b pub :: Public key sub :: Subkey (secondary key) sec :: Secret key ssb :: Secret subkey (secondary key) sig :: Signature uid :: User id crt :: X.509 certificate \u6709\u6548\u671f o :: Unknown (this key is new to the system) u :: The key is ultimately valid. \u5bc6\u94a5\u957f\u5ea6\uff0c\u5355\u4f4d\u662fbit \u516c\u94a5\u7b97\u6cd5\u3002\u4e0e\u5217\u51fa\u7684\u7b97\u6cd5\u987a\u5e8f\u76f8\u5bf9\u5e94 \u5bc6\u94a5ID \u521b\u5efa\u65e5\u671f\uff0c\u5bf9\u4e8e uid \u548c uat \u7c7b\u578b\u7684\u8bb0\u5f55\uff0c\u6b64\u503c\u662f\u81ea\u7b7e\u7684\u65e5\u671f\u3002\u4ece1970.01.01\u4ee5\u6765\u7684\u79d2\u6570 \u8fc7\u671f\u65e5\u671f\u3002 \u8bc1\u4e66\u7684 serial number\uff0cUID\u7684\u54c8\u5e0c\uff0c\u4fe1\u4efb\u7b7e\u540d\u7684\u4fe1\u606f\uff08\u7b2c\u4e00\u4e2a\u503c\u662f\u4fe1\u4efb\u6df1\u5ea6 \uff09 Ownertrust\uff0c\u53ea\u5728\u4e3b\u952e\u4e0a\u5b58\u5728\uff0c\u4fe1\u4efb\u7b7e\u540d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f User-ID \u7b7e\u540d\u7c7b\u578b \u5bc6\u94a5\u80fd\u529b\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4f5c\u7528\u7684\u4efb\u610f\u7ec4\u5408 e :: Encrypt s :: Sign c :: Certify a :: Authentication ? :: Unknown capability D :: \u8868\u793a\u7981\u7528\u7684\u5bc6\u94a5 \u4e3b\u5bc6\u94a5\u4e0a\u7684\u5927\u5199\u5b57\u6bcd\u8868\u793a\u6574\u4e2a\u5bc6\u94a5\u7684\u53ef\u7528\u529f\u80fd \u9881\u53d1\u8005\u8bc1\u4e66\u6307\u7eb9\u6216\u5176\u4ed6\u4fe1\u606f sig\u7684\u54c8\u5e0c\u7b97\u6cd5\u3002\u4e0e\u5217\u51fa\u7684\u7b97\u6cd5\u987a\u5e8f\u76f8\u5bf9\u5e94","title":"2. \u67e5\u770bkey"},{"location":"\u547d\u4ee4/gpg/#3-key","text":"[ user1@dev ~ ] $ gpg --edit-key shihr Secret key is available. pub 4096R/E0F6E6AC created: 2019 -10-15 expires: never usage: SC trust: ultimate validity: ultimate [ ultimate ] ( 1 ) . sign-user ( test sign ) <sign-user@qq.com> # \u4f7f\u7528 ? \u5217\u51fa\u53ef\u7528\u547d\u4ee4 gpg>","title":"3. \u7f16\u8f91key"},{"location":"\u547d\u4ee4/gpg/#4-key","text":"\u5bfc\u51fa [ user1@dev ~ ] $ gpg --export secret-user --textmode -o secret-user.pub [ user1@dev ~ ] $ scp secret-user.pub gpg-user@192.168.216.158:/home/gpg-user/gpg-test [ user1@dev ~ ] $ gpg --export --armor F5CDD34C -----BEGIN PGP PUBLIC KEY BLOCK----- Version: GnuPG v2.0.22 ( GNU/Linux ) mQINBF2liHwBEACzdVPSVCyMUNEiS2HCpPyuV5uRYGXOxQMgtSZZX7vOxwUH3SLm \u2026\u2026 -----END PGP PUBLIC KEY BLOCK----- \u5bfc\u5165 [ gpg-user@convert-rpm ~ ] $ gpg --import secret-user.pub gpg: key F5CDD34C: public key \"secret-user (test secret and sign) <secret-user@qq.com>\" imported gpg: Total number processed: 1 gpg: imported: 1 ( RSA: 1 ) [ gpg-user@convert-rpm ~ ] $ gpg -K [ gpg-user@convert-rpm ~ ] $ gpg -k /home/gpg-user/.gnupg/pubring.gpg --------------------------------- pub 4096R/F5CDD34C 2019 -10-15 uid secret-user ( test secret and sign ) <secret-user@qq.com> sub 4096R/8B3EBB7E 2019 -10-15","title":"4. \u5bfc\u5165\u5bfc\u51fakey"},{"location":"\u547d\u4ee4/gpg/#5","text":"# \u516c\u94a5\u52a0\u5bc6 [ gpg-user@convert-rpm ~ ] $ gpg -r F5CDD34C -e -o secret-f origin-f.txt gpg: 8B3EBB7E: There is no assurance this key belongs to the named user # \u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u52a0\u5bc6\u662f\u4f7f\u7528 Subkey \u6765\u52a0\u5bc6\u7684\uff0c\u800c\u4e0d\u662f Primary key pub 4096R/8B3EBB7E 2019 -10-15 secret-user ( test secret and sign ) <secret-user@qq.com> Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C Subkey fingerprint: 3303 FF26 B8EF 54AB 380C 27B6 A26E 0260 8B3E BB7E It is NOT certain that the key belongs to the person named in the user ID. If you *really* know what you are doing, you may answer the next question with yes. Use this key anyway? ( y/N ) y [ gpg-user@convert-rpm ~ ] $ scp secret-f user1@192.168.216.163:~ # \u79c1\u94a5\u89e3\u5bc6 [ user1@dev ~ ] $ gpg -d -o decryption-f secret-f You need a passphrase to unlock the secret key for user: \"secret-user (test secret and sign) <secret-user@qq.com>\" 4096 -bit RSA key, ID 8B3EBB7E, created 2019 -10-15 ( main key ID F5CDD34C ) # \u8fd9\u91cc\u540c\u6837\u4e5f\u80fd\u770b\u51fa\u662f\u7b2c\u4e8c\u4e2akey\u6765\u52a0\u5bc6\u7684 gpg: encrypted with 4096 -bit RSA key, ID 8B3EBB7E, created 2019 -10-15 \"secret-user (test secret and sign) <secret-user@qq.com>\" [ user1@dev ~ ] $ cat decryption-f hello world","title":"5. \u52a0\u89e3\u5bc6\u6587\u4ef6"},{"location":"\u547d\u4ee4/gpg/#6","text":"# \u79c1\u94a5\u7b7e\u540d [ user1@dev ~ ] $ gpg -s -r 8B3EBB7E -o signed-f origin-f.txt gpg: WARNING: recipients ( -r ) given without using public key encryption You need a passphrase to unlock the secret key for user: \"sign-user (test sign) <sign-user@qq.com>\" 4096 -bit RSA key, ID E0F6E6AC, created 2019 -10-15 # \u521b\u5efa ascii \u683c\u5f0f\u8f93\u51fa\u7684\u7b7e\u540d\u6587\u4ef6 [ user1@dev ~ ] $ gpg -a -s -u F5CDD34C -o signed-f origin-f.txt [ user1@dev ~ ] $ cat signed-f -----BEGIN PGP MESSAGE----- Version: GnuPG v2.0.22 ( GNU/Linux ) owEBTgKx/ZANAwACAfOSaEf1zdNMAaweYgxvcmlnaW4tZi50eHRdpoqpaGVsbG8g \u2026\u2026 -----END PGP MESSAGE----- # \u521b\u5efa\u660e\u6587\u7b7e\u540d\u6587\u4ef6\u3002\u6ce8\u610f\uff1a \u9a8c\u8bc1\u660e\u6587\u7b7e\u540d\u65f6\uff0cgpg \u4ec5\u9a8c\u8bc1\u6784\u6210\u660e\u6587\u7b7e\u540d\u6570\u636e\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5728\u4eea\u8868\u677f\u884c\u4e4b\u540e\u7684\u660e\u6587\u7b7e\u540d\u6216\u6807\u9898\u884c\u4e4b\u5916\u7684\u4efb\u4f55\u5176\u4ed6\u6570\u636e\u3002\u6b64\u683c\u5f0f\u8fd8\u6709\u5176\u5b83\u7f3a\u9677\uff0c\u5efa\u8bae\u907f\u514d\u4f7f\u7528\u660e\u6587\u7b7e\u540d\uff0c\u800c\u91c7\u7528\u5206\u79bb\u7b7e\u540d\u3002 [ user1@dev ~ ] $ gpg --clearsign -s -u F5CDD34C -o signed-f origin-f.txt [ user1@dev ~ ] $ cat signed-f -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1 hello world -----BEGIN PGP SIGNATURE----- Version: GnuPG v2.0.22 ( GNU/Linux ) iQIcBAEBAgAGBQJdpop/AAoJEPOSaEf1zdNMjJsP/jiUpYyUr+/jjSFKnW2YoMq2 \u2026\u2026 -----END PGP SIGNATURE----- # \u521b\u5efa\u5206\u79bb\u5f0f\u7684\u7b7e\u540d\u6587\u4ef6\uff0c\u91cc\u9762\u4e0d\u5305\u542b\u6587\u4ef6\u5185\u5bb9\uff0c\u9a8c\u8bc1\u65f6\u9700\u8981\u548c\u539f\u6587\u4ef6\u4e00\u8d77\u9a8c\u8bc1 [ user1@dev ~ ] $ gpg -b -s -u F5CDD34C -o signed-f origin-f.txt # \u516c\u94a5\u9a8c\u8bc1 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f gpg: Signature made Tue 15 Oct 2019 09 :00:53 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\" gpg: WARNING: This key is not certified with a trusted signature! gpg: There is no indication that the signature belongs to the owner. Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C # \u9a8c\u8bc1\u5206\u79bb\u5f0f\u7b7e\u540d\u6587\u4ef6 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f origin-f.txt gpg: Signature made Tue 15 Oct 2019 11 :21:56 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\"","title":"6. \u7b7e\u540d"},{"location":"\u547d\u4ee4/gpg/#7","text":"\u5728\u4e0a\u6587\u53ef\u4ee5\u770b\u5230\u5728\u4f7f\u7528\u516c\u94a5\u65f6\u53d1\u51fa\u4e86\u8b66\u544a\uff1a gpg : WARNING : This key is not certified with a trusted signature ! gpg : There is no indication that the signature belongs to the owner . \u65b9\u6cd5\u4e00\uff1a\u7f16\u8f91\u516c\u94a5\uff0c\u6dfb\u52a0\u4fe1\u4efb\u7b49\u7ea7 [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC # \u4fe1\u4efb\u7b49\u7ea7\uff08\u672a\u8bbe\u7f6e\uff09 \u6709\u6548\u671f trust: unknown validity: unknown sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ unknown ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> gpg> trust # \u8fd9\u91cc\u7684\u610f\u601d\u662f\u8bf4\u4f60\u9700\u8981\u53bb\u9a8c\u8bc1\u8fd9\u4e2a\u516c\u94a5\u7684\u5408\u6cd5\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u5bf9\u6bd4\u5bc6\u94a5\u7684 fingerprint \u6765\u68c0\u6d4b Please decide how far you trust this user to correctly verify other users ' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don' t know or won ' t say 2 = I do NOT trust # \u7a0d\u5fae\u4fe1\u4efb 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu # \u8fd9\u91cc\u9009\u62e95\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u4fe1\u4efb Your decision? 5 Do you really want to set this key to ultimate trust? ( y/N ) y pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ unknown ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> Please note that the shown key validity is not necessarily correct unless you restart the program. \u65b9\u6cd5\u4e8c\uff1a\u7f16\u8f91\u516c\u94a5\uff0c\u4f7f\u7528\u672c\u5730\u79c1\u94a5\u8fdb\u884c\u4fe1\u4efb\u7b7e\u540d [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C gpg> tsign pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: undefined validity: unknown Primary key fingerprint: 9E42 E5DC E58A AF21 FFD0 A7A9 F392 6847 F5CD D34C secret-user ( test secret and sign ) <secret-user@qq.com> Please decide how far you trust this user to correctly verify other users ' keys ( by looking at passports, checking fingerprints from different sources, etc. ) 1 = I trust marginally 2 = I trust fully Your selection? 2 Please enter the depth of this trust signature. A depth greater than 1 allows the key you are signing to make trust signatures on your behalf. Your selection? 2 # \u8fd9\u91cc\u4e0d\u61c2\uff1f\uff1f\uff1f Please enter a domain to restrict this signature, or enter for none. Your selection? 2 Are you sure that you want to sign this key with your key \"local-sign-user (use for local sign) <local-sign-user@local.com>\" ( C86BB985 ) Really sign? ( y/N ) y You need a passphrase to unlock the secret key for user: \"local-sign-user (use for local sign) <local-sign-user@local.com>\" 4096 -bit RSA key, ID C86BB985, created 2019 -10-16 gpg> save # \u518d\u6b21\u7f16\u8f91\uff0c\u53ef\u4ee5\u770b\u5230\u5c5e\u6027\u5df2\u7ecf\u53d1\u751f\u4e86\u53d8\u5316 [ gpg-user@convert-rpm ~ ] $ gpg --edit-key F5CDD34C pub 4096R/F5CDD34C created: 2019 -10-15 expires: never usage: SC trust: full validity: full sub 4096R/8B3EBB7E created: 2019 -10-15 expires: never usage: E [ full ] ( 1 ) . secret-user ( test secret and sign ) <secret-user@qq.com> # \u540e\u9762\u4f7f\u7528\u516c\u94a5\u5c31\u4e0d\u4f1a\u6709\u8b66\u544a\u5566\uff01 [ gpg-user@convert-rpm ~ ] $ gpg --verify signed-f gpg: Signature made Tue 15 Oct 2019 09 :00:53 PM EDT using RSA key ID F5CDD34C gpg: Good signature from \"secret-user (test secret and sign) <secret-user@qq.com>\"","title":"7. \u5bf9\u5916\u90e8\u5bfc\u5165\u516c\u94a5\u6dfb\u52a0\u4fe1\u4efb"},{"location":"\u547d\u4ee4/gpg/#8","text":"# \u52a0\u5bc6\uff0c\u9700\u8981\u8f93\u5165\u5bc6\u7801 [ user1@dev ~ ] $ gpg -c -o encryp-f origin-f.txt [ user1@dev ~ ] $ scp encryp-f gpg-user@192.168.216.158:~ # \u89e3\u5bc6 [ gpg-user@convert-rpm ~ ] $ gpg -d encryp-f gpg: CAST5 encrypted data gpg: encrypted with 1 passphrase hello world gpg: WARNING: message was not integrity protected # \u6307\u5b9a\u52a0\u5bc6\u7b97\u6cd5 [ user1@dev ~ ] $ gpg -c --cipher-algo AES -o encryp-f origin-f.txt [ user1@dev ~ ] $ gpg -d encryp-f gpg: AES encrypted data gpg: encrypted with 1 passphrase hello world \u652f\u6301\u7684\u7b97\u6cd5\u53ef\u4ee5\u4f7f\u7528 --verison \u9009\u9879\u5217\u51fa\uff1a [ user1@dev ~ ] $ gpg --version \u2026\u2026 Home: ~/.gnupg Supported algorithms: Pubkey: RSA, ?, ?, ELG, DSA Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH, CAMELLIA128, CAMELLIA192, CAMELLIA256 Hash: MD5, SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224 Compression: Uncompressed, ZIP, ZLIB, BZIP2","title":"8. \u4f7f\u7528\u5bf9\u79f0\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6"},{"location":"\u547d\u4ee4/gpg/#9","text":"https://www.gnupg.org/howtos/zh/index.html","title":"9. \u8d44\u6599"},{"location":"\u547d\u4ee4/linux\u6302\u8f7dwindows\u5171\u4eab\u6587\u4ef6\u5939/","text":"mount.cifs //172.16.2.27/mkdocs blog/ -o user = xxx,pass = xxx \u5931\u8d25\u5c1d\u8bd5\u6dfb\u52a0\u9009\u9879\u518d\u8bd5\uff1a mount.cifs //172.16.2.27/mkdocs blog/ -o user = xxx,pass = xxx,sec = ntlm","title":"linux\u6302\u8f7dwindows\u5171\u4eab\u6587\u4ef6\u5939"},{"location":"\u547d\u4ee4/locate\u521d\u59cb\u5316/","text":"\u5b89\u88c5 locate \uff1a yum install -y mlocate \u65b0\u5b89\u88c5\u7684 locate \u6267\u884c\u5931\u8d25\uff1a locate: can not stat () ` /var/lib/mlocate/mlocate.db ' : No such file or directory \u9700\u8981\u6267\u884c updatedb \u66f4\u65b0\u6570\u636e\u5e93\u3002","title":"Locate\u521d\u59cb\u5316"},{"location":"\u547d\u4ee4/rsync/","text":"1. \u7b80\u6613\u914d\u7f6e 2. \u8bed\u6cd5 3. \u793a\u4f8b 3.1 \u540c\u6b65\u6587\u4ef6\u5939 3.2 \u540c\u6b65\u76ee\u5f55\u7ed3\u6784 3.3 \u6062\u590dscp\u6587\u4ef6\u4f20\u8f93 3.4 \u5728\u76ee\u6807\u4e2d\u5220\u9664\u6e90\u4e2d\u4e0d\u5b58\u5728\u7684\u6587\u4ef6 3.5 \u9650\u5236\u6587\u4ef6\u4f20\u8f93\u5927\u5c0f 3.6 \u4e0d\u4e88\u590d\u5236\u4fee\u6539\u8fc7\u7684\u76ee\u6807\u6587\u4ef6 3.7 \u540c\u6b65\u5b8c\u6210\u540e\u5220\u9664\u6e90\u6587\u4ef6 3.8 \u9650\u5236\u4f20\u8f93\u901f\u7387 3.9 \u663e\u793a\u6e90\u4e0e\u76ee\u6807\u7684\u4e0d\u540c \u53c2\u8003\uff1ahttps://www.linuxtechi.com/rsync-command-examples-linux/ 1. \u7b80\u6613\u914d\u7f6e \u00b6 \u4f7f\u7528 rsync damon \u6a21\u5f0f\u7684\u914d\u7f6e\uff1a # / etc / rsyncd : configuration file for rsync daemon mode # See rsyncd . conf man page for more options . # configuration example : uid = nobody gid = nobody # use chroot = yes # max connections = 4 # pid file = / var / run / rsyncd . pid # exclude = lost + found / # transfer logging = yes # timeout = 900 # ignore nonreadable = yes # dont compress = * . gz * . tgz * . zip * . z * . Z * . rpm * . deb * . bz2 log file = / var / log / rsyncd . log [ ovirt_iso ] path = / home / pub / ovirt_iso / # [ ftp ] # path = / home / ftp # comment = ftp export area \u8be6\u7ec6\u914d\u7f6e\u6267\u884c\uff1a man rsyncd.conf \u7136\u540e\u670d\u52a1\u7aef\u4ee5daemon\u7684\u5f62\u5f0f\u8fd0\u884c\uff1a rsync --daemon \uff0c\u540c\u65f6\u68c0\u67e5\u9632\u706b\u5899\u7aef\u53e3\u662f\u5426\u5f00\u653e\u3002\u5ba2\u6237\u7aef\u5373\u53ef\u901a\u8fc7rsync\u8fdb\u884c\u8fdc\u7a0b\u540c\u6b65\u3002 2. \u8bed\u6cd5 \u00b6 # \u672c\u5730\u540c\u6b65\u8bed\u6cd5\uff1a rsync [ OPTION... ] SRC... [ DEST ] # \u901a\u8fc7\u8fdc\u7a0bshell\u540c\u6b65\uff1a # \u62c9\u53d6 rsync [ OPTION... ] [ USER@ ] HOST:SRC... [ DEST ] # \u63a8\u9001 rsync [ OPTION... ] SRC... [ USER@ ] HOST:DEST # \u901a\u8fc7rsync daemon\u540c\u6b65\uff1a # \u62c9\u53d6 rsync [ OPTION... ] [ USER@ ] HOST::SRC... [ DEST ] rsync [ OPTION... ] rsync:// [ USER@ ] HOST [ :PORT ] /SRC... [ DEST ] # \u63a8\u9001 rsync [ OPTION... ] SRC... [ USER@ ] HOST::DEST rsync [ OPTION... ] SRC... rsync:// [ USER@ ] HOST [ :PORT ] /DEST # \u53ea\u6709SRC\u6ca1\u6709DEST\u4f1a\u5217\u51fa\u6587\u4ef6\u800c\u4e0d\u4f1a\u590d\u5236 \u5e38\u7528\u9009\u9879\uff1a \u9009\u9879 \u8bf4\u660e -v, \u2013verbose \u8be6\u7ec6\u8f93\u51fa -q, \u2013quiet \u6291\u5236\u4fe1\u606f\u8f93\u51fa -a, \u2013archive \u540c\u6b65\u7684\u65f6\u5019\u5f52\u6863\u6587\u4ef6\u548c\u6587\u4ef6\u5939 ( -a \u7b49\u4e8e -rlptgoD) -r, \u2013recursive \u9012\u5f52\u5730\u540c\u6b65\u6587\u4ef6\u548c\u6587\u4ef6\u5939 -b, \u2013backup \u5728\u540c\u6b65\u65f6\u8fdb\u884c\u5907\u4efd -u, \u2013update \u5982\u4f55\u76ee\u6807\u6587\u4ef6\u6bd4\u6e90\u6587\u4ef6\u66f4\u65b0\u90a3\u4e48\u4e0d\u8981\u4ece\u6e90\u590d\u5236\u6587\u4ef6 -l, \u2013links \u5728\u540c\u6b65\u65f6\u5c06\u7b26\u53f7\u94fe\u63a5\u590d\u5236\u4e3a\u7b26\u53f7\u94fe\u63a5 -n, \u2013dry-run \u6267\u884c\u975e\u540c\u6b65\u7684\u8bd5\u8fd0\u884c\uff0c\u53ef\u4ee5\u7528\u6765\u9884\u5148\u67e5\u770b\u6548\u679c -e, \u2013rsh=COMMAND \u540c\u6b65\u65f6\u6307\u5b9a\u8fdc\u7a0bshell -z, \u2013compress \u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u538b\u7f29\u6587\u4ef6\u6570\u636e -h, \u2013human-readable \u4eba\u7c7b\u53cb\u597d\u6027\u5730\u663e\u793a\u8f93\u51fa\u6570\u5b57 -progress \u5728\u8f6c\u6362\u65f6\u5c55\u793a\u540c\u6b65\u8fdb\u7a0b -p, --perms \u4fdd\u7559\u6743\u9650 -t, --times \u4fdd\u7559\u4fee\u6539\u65f6\u95f4 -g, --group \u4fdd\u7559\u7ec4 -o, --owner \u4fdd\u7559\u7528\u6237\uff08\u53ea\u7528\u4e8e\u8d85\u7ea7\u7528\u6237\uff09 -D \u4fdd\u7559\u8bbe\u5907\u6587\u4ef6\uff08\u53ea\u7528\u4e8e\u8d85\u7ea7\u7528\u6237\uff09\u3001\u7279\u6b8a\u6587\u4ef6 3. \u793a\u4f8b \u00b6 3.1 \u540c\u6b65\u6587\u4ef6\u5939 \u00b6 $ ll test_lv1/ total 20 -rw-r--r-- 1 root root 1575 May 10 16 :07 echo.py -rwxr-xr-x 1 root root 8592 May 13 19 :37 test -rw-r--r-- 1 root root 156 May 13 19 :38 test.c drwxr-xr-x 2 root root 18 May 14 10 :50 ttt \u5f53\u76ee\u5f55\u672b\u5c3e\u4e0d\u5e26 / \u65f6\uff0c\u4f1a\u590d\u5236\u6587\u4ef6\u5939\uff1a $ rsync -avh test_lv1 test_lv2/ $ ll test_lv2/ total 0 drwxr-xr-x 3 root root 58 May 14 10 :50 test_lv1 \u5e26 / \u65f6\uff0c\u53ea\u4f1a\u590d\u5236\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\uff1a $ rsync -avh test_lv1/ test_lv2/ $ ll test_lv2/ total 20 -rw-r--r-- 1 root root 1575 May 10 16 :07 echo.py -rwxr-xr-x 1 root root 8592 May 13 19 :37 test -rw-r--r-- 1 root root 156 May 13 19 :38 test.c drwxr-xr-x 2 root root 18 May 14 10 :50 ttt 3.2 \u540c\u6b65\u76ee\u5f55\u7ed3\u6784 \u00b6 \u4f7f\u7528 -f \u9009\u9879\u6dfb\u52a0\u8fc7\u6ee4\u89c4\u5219\u5b9e\u73b0\uff1a $ rsync -avh -f \"+ */\" -f \"- *\" test_lv1 test_lv2/ $ tree test_lv1/ test_lv1/ \u251c\u2500\u2500 echo.py \u251c\u2500\u2500 test \u251c\u2500\u2500 test.c \u2514\u2500\u2500 ttt \u2514\u2500\u2500 tstg $ tree test_lv2/ test_lv2/ \u2514\u2500\u2500 test_lv1 \u2514\u2500\u2500 ttt 3.3 \u6062\u590dscp\u6587\u4ef6\u4f20\u8f93 \u00b6 \u5982\u679c\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5728\u4f7f\u7528scp\u4f20\u8f93\u6587\u4ef6\u65f6\u505c\u6b62/\u7ec8\u6b62\u4e86\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528rsync\u4ece\u505c\u6b62/\u7ec8\u6b62\u7684\u5730\u65b9\u7ee7\u7eed\u590d\u5236\u6587\u4ef6\u3002 \u4f7f\u7528 -P \uff08--partial --progress\uff09\u9009\u9879\u5b9e\u73b0\uff1a $ scp root@192.168.1.29:/root/ubuntu-18.04-desktop-amd64.iso /opt root@192.168.1.29 's password: ubuntu-18.04-desktop-amd64.iso 28% 526MB 61.5MB/s 00:21 ETA ^CKilled by signal 2. $ rsync -P --rsh=ssh root@192.168.1.29:/root/ubuntu-18.04-desktop-amd64.iso /opt root@192.168.1.29' s password: ubuntu-18.04-desktop-amd64.iso 1 ,921,843,200 100 % 18 .47MB/s 0 :01:39 ( xfr#1, to-chk = 0 /1 ) 3.4 \u5728\u76ee\u6807\u4e2d\u5220\u9664\u6e90\u4e2d\u4e0d\u5b58\u5728\u7684\u6587\u4ef6 \u00b6 \u4f7f\u7528 --delete \u9009\u9879 3.5 \u9650\u5236\u6587\u4ef6\u4f20\u8f93\u5927\u5c0f \u00b6 \u8d85\u8fc7\u5927\u5c0f\u9650\u5236\u7684\u6587\u4ef6\u4e0d\u4e88\u8f6c\u6362\u3002\u4f7f\u7528 --max-size \u9009\u9879\u3002 $ rsync -avz --max-size = '500K' /opt/rpms_db root@192.168.1.28:/tmp \u5355\u4f4d\uff1a 1024\u8fdb\u5236\uff1a\"K\" (or \"KiB\") is a kibibyte (1024), \"M\" (or \"MiB\") is a mebibyte (1024*1024), and \"G\" (or \"GiB\") is a gibibyte (1024*1024*1024). 1000\u8fdb\u5236\uff1a\"KB\", \"MB\", or \"GB\" 3.6 \u4e0d\u4e88\u590d\u5236\u4fee\u6539\u8fc7\u7684\u76ee\u6807\u6587\u4ef6 \u00b6 \u4e0d\u8986\u76d6\u5728\u76ee\u6807\u4e2d\u4fee\u6539\u8fc7\u6587\u4ef6\u3002\u4f7f\u7528 -u \u9009\u9879 3.7 \u540c\u6b65\u5b8c\u6210\u540e\u5220\u9664\u6e90\u6587\u4ef6 \u00b6 \u4f7f\u7528 --remove-source-files \u9009\u9879 3.8 \u9650\u5236\u4f20\u8f93\u901f\u7387 \u00b6 \u4f7f\u7528 \u2013bwlimit=<KB/s> \u9009\u9879\uff1a $ rsync -avz --progress --bwlimit = 600 /home/pkumar/techi root@192.168.1.29:/opt 3.9 \u663e\u793a\u6e90\u4e0e\u76ee\u6807\u7684\u4e0d\u540c \u00b6 \u4f7f\u7528 -i \u9009\u9879 $ tree test_lv1/ test_lv1/ \u251c\u2500\u2500 echo.py \u251c\u2500\u2500 test \u251c\u2500\u2500 test.c \u2514\u2500\u2500 ttt \u2514\u2500\u2500 tstg $ tree sdb1/ sdb1/ \u2514\u2500\u2500 echo.py $ rsync -ani test_lv1/ sdb1/ .d..t...... ./ >f+++++++++ test >f+++++++++ test.c cd+++++++++ ttt/ >f+++++++++ ttt/tstg \u8f93\u51fa\u7684\u5341\u4e00\u4e2a\u5b57\u7b26\u957f\u5ea6\u4ee3\u8868\u7684\u662f\uff1a YXcstpoguax \u3002 Y\uff1a\u6307\u793a\u5c06\u8981\u5b8c\u6210\u7684\u66f4\u65b0\u7c7b\u578b <\uff1a\u8868\u793a\u6587\u4ef6\u5c06\u88ab\u8f6c\u6362\u5230\u8fdc\u7a0b\u4e3b\u673a >\uff1a\u8868\u793a\u6587\u4ef6\u5c06\u88ab\u8f6c\u6362\u5230\u672c\u5730 c\uff1a\u610f\u5473\u7740\u672c\u5730\u5c06\u4f1a\u53d1\u751f\u4e00\u4e2a\u6539\u53d8/\u521b\u5efa h\uff1a\u8868\u793a\u662f\u4e00\u4e2a\u786c\u94fe\u63a5\uff08\u8981\u6c42\u6709\u9009\u9879 --hard-links \uff09 .\uff1a\u8868\u793a\u4e0d\u4f1a\u66f4\u65b0 *\uff1a\u8868\u793a\u5269\u4e0b\u7684\u5b57\u7b26\u5305\u542b\u4e00\u4e2a\u4fe1\u606f\u3002\u4f8b\u5982\"deleting\"\u3002 X\uff1a\u6307\u793a\u6587\u4ef6\u7c7b\u578b f\uff1a\u6587\u4ef6 d\uff1a\u6587\u4ef6\u5939 L\uff1a\u94fe\u63a5 D\uff1a\u8bbe\u5907 S\uff1a\u7279\u6b8a\u6587\u4ef6\u3002\u6bd4\u5982socket\u3002 \u5269\u4e0b\u7684\u5b57\u7b26\u663e\u793a\uff1a\u5c5e\u6027\u503c\u6ca1\u6709\u66f4\u65b0\u663e\u793a . \uff1b\u6709\u66f4\u65b0\u5219\u663e\u793a\uff1a \u65b0\u521b\u5efa\u7684\u6761\u76ee\u6bcf\u4e2a\u90fd\u663e\u793a + \u76f8\u540c\u7684\u6761\u76ee\u7528\u7a7a\u683c \u4ee3\u66ff . \u672a\u77e5\u7684\u5c5e\u6027\u6bcf\u4e2a\u90fd\u7528 ? \u4ee3\u66ff \u76f8\u5173\u7684\u5c5e\u6027\u5982\u4e0b\uff1a c\uff1a\u8868\u793a\u5e38\u89c4\u6587\u4ef6\u5177\u6709\u4e0d\u540c\u7684\u6821\u9a8c\u548c\uff08\u8981\u6c42 --checksum \u9009\u9879\uff09\u6216\u8005\u662f\u94fe\u63a5\u3001\u8bbe\u5907\u6216\u7279\u6b8a\u6587\u4ef6\u7684\u503c\u5df2\u66f4\u6539\u3002 s\uff1a\u8868\u793a\u6587\u4ef6\u7684\u5927\u5c0f\u4e0d\u4e00\u81f4\uff0c\u5c06\u4f1a\u66f4\u65b0 t\uff1a\u8868\u793a\u66f4\u6539\u65f6\u95f4\u4e0d\u540c\uff0c\u5c06\u4f1a\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u65f6\u95f4\uff08\u8981\u6c42 --times \u9009\u9879\uff09 p\uff1a\u8868\u793a\u6743\u9650\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u6743\u9650\uff08\u8981\u6c42 --perms \u9009\u9879\uff09 o\uff1a\u8868\u793a\u6240\u5c5e\u7528\u6237\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u7528\u6237\uff08\u8981\u6c42 --owner \u9009\u9879\u548c\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff09 g\uff1a\u8868\u793a\u6240\u5c5e\u7ec4\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u7ec4\uff08\u8981\u6c42 --group \u9009\u9879\u548c\u8bbe\u7f6e\u7ec4\u7684\u6743\u9650\uff09 u\uff1a\u4fdd\u7559\u505a\u672a\u6765\u4f7f\u7528 a\uff1aACL\u4fe1\u606f\u6539\u53d8\u4e86 x\uff1a\u8868\u793a\u6269\u5c55\u5c5e\u6027\u4fe1\u606f\u6539\u53d8\u4e86","title":"Rsync"},{"location":"\u547d\u4ee4/rsync/#1","text":"\u4f7f\u7528 rsync damon \u6a21\u5f0f\u7684\u914d\u7f6e\uff1a # / etc / rsyncd : configuration file for rsync daemon mode # See rsyncd . conf man page for more options . # configuration example : uid = nobody gid = nobody # use chroot = yes # max connections = 4 # pid file = / var / run / rsyncd . pid # exclude = lost + found / # transfer logging = yes # timeout = 900 # ignore nonreadable = yes # dont compress = * . gz * . tgz * . zip * . z * . Z * . rpm * . deb * . bz2 log file = / var / log / rsyncd . log [ ovirt_iso ] path = / home / pub / ovirt_iso / # [ ftp ] # path = / home / ftp # comment = ftp export area \u8be6\u7ec6\u914d\u7f6e\u6267\u884c\uff1a man rsyncd.conf \u7136\u540e\u670d\u52a1\u7aef\u4ee5daemon\u7684\u5f62\u5f0f\u8fd0\u884c\uff1a rsync --daemon \uff0c\u540c\u65f6\u68c0\u67e5\u9632\u706b\u5899\u7aef\u53e3\u662f\u5426\u5f00\u653e\u3002\u5ba2\u6237\u7aef\u5373\u53ef\u901a\u8fc7rsync\u8fdb\u884c\u8fdc\u7a0b\u540c\u6b65\u3002","title":"1. \u7b80\u6613\u914d\u7f6e"},{"location":"\u547d\u4ee4/rsync/#2","text":"# \u672c\u5730\u540c\u6b65\u8bed\u6cd5\uff1a rsync [ OPTION... ] SRC... [ DEST ] # \u901a\u8fc7\u8fdc\u7a0bshell\u540c\u6b65\uff1a # \u62c9\u53d6 rsync [ OPTION... ] [ USER@ ] HOST:SRC... [ DEST ] # \u63a8\u9001 rsync [ OPTION... ] SRC... [ USER@ ] HOST:DEST # \u901a\u8fc7rsync daemon\u540c\u6b65\uff1a # \u62c9\u53d6 rsync [ OPTION... ] [ USER@ ] HOST::SRC... [ DEST ] rsync [ OPTION... ] rsync:// [ USER@ ] HOST [ :PORT ] /SRC... [ DEST ] # \u63a8\u9001 rsync [ OPTION... ] SRC... [ USER@ ] HOST::DEST rsync [ OPTION... ] SRC... rsync:// [ USER@ ] HOST [ :PORT ] /DEST # \u53ea\u6709SRC\u6ca1\u6709DEST\u4f1a\u5217\u51fa\u6587\u4ef6\u800c\u4e0d\u4f1a\u590d\u5236 \u5e38\u7528\u9009\u9879\uff1a \u9009\u9879 \u8bf4\u660e -v, \u2013verbose \u8be6\u7ec6\u8f93\u51fa -q, \u2013quiet \u6291\u5236\u4fe1\u606f\u8f93\u51fa -a, \u2013archive \u540c\u6b65\u7684\u65f6\u5019\u5f52\u6863\u6587\u4ef6\u548c\u6587\u4ef6\u5939 ( -a \u7b49\u4e8e -rlptgoD) -r, \u2013recursive \u9012\u5f52\u5730\u540c\u6b65\u6587\u4ef6\u548c\u6587\u4ef6\u5939 -b, \u2013backup \u5728\u540c\u6b65\u65f6\u8fdb\u884c\u5907\u4efd -u, \u2013update \u5982\u4f55\u76ee\u6807\u6587\u4ef6\u6bd4\u6e90\u6587\u4ef6\u66f4\u65b0\u90a3\u4e48\u4e0d\u8981\u4ece\u6e90\u590d\u5236\u6587\u4ef6 -l, \u2013links \u5728\u540c\u6b65\u65f6\u5c06\u7b26\u53f7\u94fe\u63a5\u590d\u5236\u4e3a\u7b26\u53f7\u94fe\u63a5 -n, \u2013dry-run \u6267\u884c\u975e\u540c\u6b65\u7684\u8bd5\u8fd0\u884c\uff0c\u53ef\u4ee5\u7528\u6765\u9884\u5148\u67e5\u770b\u6548\u679c -e, \u2013rsh=COMMAND \u540c\u6b65\u65f6\u6307\u5b9a\u8fdc\u7a0bshell -z, \u2013compress \u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u538b\u7f29\u6587\u4ef6\u6570\u636e -h, \u2013human-readable \u4eba\u7c7b\u53cb\u597d\u6027\u5730\u663e\u793a\u8f93\u51fa\u6570\u5b57 -progress \u5728\u8f6c\u6362\u65f6\u5c55\u793a\u540c\u6b65\u8fdb\u7a0b -p, --perms \u4fdd\u7559\u6743\u9650 -t, --times \u4fdd\u7559\u4fee\u6539\u65f6\u95f4 -g, --group \u4fdd\u7559\u7ec4 -o, --owner \u4fdd\u7559\u7528\u6237\uff08\u53ea\u7528\u4e8e\u8d85\u7ea7\u7528\u6237\uff09 -D \u4fdd\u7559\u8bbe\u5907\u6587\u4ef6\uff08\u53ea\u7528\u4e8e\u8d85\u7ea7\u7528\u6237\uff09\u3001\u7279\u6b8a\u6587\u4ef6","title":"2. \u8bed\u6cd5"},{"location":"\u547d\u4ee4/rsync/#3","text":"","title":"3. \u793a\u4f8b"},{"location":"\u547d\u4ee4/rsync/#31","text":"$ ll test_lv1/ total 20 -rw-r--r-- 1 root root 1575 May 10 16 :07 echo.py -rwxr-xr-x 1 root root 8592 May 13 19 :37 test -rw-r--r-- 1 root root 156 May 13 19 :38 test.c drwxr-xr-x 2 root root 18 May 14 10 :50 ttt \u5f53\u76ee\u5f55\u672b\u5c3e\u4e0d\u5e26 / \u65f6\uff0c\u4f1a\u590d\u5236\u6587\u4ef6\u5939\uff1a $ rsync -avh test_lv1 test_lv2/ $ ll test_lv2/ total 0 drwxr-xr-x 3 root root 58 May 14 10 :50 test_lv1 \u5e26 / \u65f6\uff0c\u53ea\u4f1a\u590d\u5236\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\uff1a $ rsync -avh test_lv1/ test_lv2/ $ ll test_lv2/ total 20 -rw-r--r-- 1 root root 1575 May 10 16 :07 echo.py -rwxr-xr-x 1 root root 8592 May 13 19 :37 test -rw-r--r-- 1 root root 156 May 13 19 :38 test.c drwxr-xr-x 2 root root 18 May 14 10 :50 ttt","title":"3.1 \u540c\u6b65\u6587\u4ef6\u5939"},{"location":"\u547d\u4ee4/rsync/#32","text":"\u4f7f\u7528 -f \u9009\u9879\u6dfb\u52a0\u8fc7\u6ee4\u89c4\u5219\u5b9e\u73b0\uff1a $ rsync -avh -f \"+ */\" -f \"- *\" test_lv1 test_lv2/ $ tree test_lv1/ test_lv1/ \u251c\u2500\u2500 echo.py \u251c\u2500\u2500 test \u251c\u2500\u2500 test.c \u2514\u2500\u2500 ttt \u2514\u2500\u2500 tstg $ tree test_lv2/ test_lv2/ \u2514\u2500\u2500 test_lv1 \u2514\u2500\u2500 ttt","title":"3.2 \u540c\u6b65\u76ee\u5f55\u7ed3\u6784"},{"location":"\u547d\u4ee4/rsync/#33-scp","text":"\u5982\u679c\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5728\u4f7f\u7528scp\u4f20\u8f93\u6587\u4ef6\u65f6\u505c\u6b62/\u7ec8\u6b62\u4e86\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528rsync\u4ece\u505c\u6b62/\u7ec8\u6b62\u7684\u5730\u65b9\u7ee7\u7eed\u590d\u5236\u6587\u4ef6\u3002 \u4f7f\u7528 -P \uff08--partial --progress\uff09\u9009\u9879\u5b9e\u73b0\uff1a $ scp root@192.168.1.29:/root/ubuntu-18.04-desktop-amd64.iso /opt root@192.168.1.29 's password: ubuntu-18.04-desktop-amd64.iso 28% 526MB 61.5MB/s 00:21 ETA ^CKilled by signal 2. $ rsync -P --rsh=ssh root@192.168.1.29:/root/ubuntu-18.04-desktop-amd64.iso /opt root@192.168.1.29' s password: ubuntu-18.04-desktop-amd64.iso 1 ,921,843,200 100 % 18 .47MB/s 0 :01:39 ( xfr#1, to-chk = 0 /1 )","title":"3.3 \u6062\u590dscp\u6587\u4ef6\u4f20\u8f93"},{"location":"\u547d\u4ee4/rsync/#34","text":"\u4f7f\u7528 --delete \u9009\u9879","title":"3.4 \u5728\u76ee\u6807\u4e2d\u5220\u9664\u6e90\u4e2d\u4e0d\u5b58\u5728\u7684\u6587\u4ef6"},{"location":"\u547d\u4ee4/rsync/#35","text":"\u8d85\u8fc7\u5927\u5c0f\u9650\u5236\u7684\u6587\u4ef6\u4e0d\u4e88\u8f6c\u6362\u3002\u4f7f\u7528 --max-size \u9009\u9879\u3002 $ rsync -avz --max-size = '500K' /opt/rpms_db root@192.168.1.28:/tmp \u5355\u4f4d\uff1a 1024\u8fdb\u5236\uff1a\"K\" (or \"KiB\") is a kibibyte (1024), \"M\" (or \"MiB\") is a mebibyte (1024*1024), and \"G\" (or \"GiB\") is a gibibyte (1024*1024*1024). 1000\u8fdb\u5236\uff1a\"KB\", \"MB\", or \"GB\"","title":"3.5 \u9650\u5236\u6587\u4ef6\u4f20\u8f93\u5927\u5c0f"},{"location":"\u547d\u4ee4/rsync/#36","text":"\u4e0d\u8986\u76d6\u5728\u76ee\u6807\u4e2d\u4fee\u6539\u8fc7\u6587\u4ef6\u3002\u4f7f\u7528 -u \u9009\u9879","title":"3.6 \u4e0d\u4e88\u590d\u5236\u4fee\u6539\u8fc7\u7684\u76ee\u6807\u6587\u4ef6"},{"location":"\u547d\u4ee4/rsync/#37","text":"\u4f7f\u7528 --remove-source-files \u9009\u9879","title":"3.7 \u540c\u6b65\u5b8c\u6210\u540e\u5220\u9664\u6e90\u6587\u4ef6"},{"location":"\u547d\u4ee4/rsync/#38","text":"\u4f7f\u7528 \u2013bwlimit=<KB/s> \u9009\u9879\uff1a $ rsync -avz --progress --bwlimit = 600 /home/pkumar/techi root@192.168.1.29:/opt","title":"3.8 \u9650\u5236\u4f20\u8f93\u901f\u7387"},{"location":"\u547d\u4ee4/rsync/#39","text":"\u4f7f\u7528 -i \u9009\u9879 $ tree test_lv1/ test_lv1/ \u251c\u2500\u2500 echo.py \u251c\u2500\u2500 test \u251c\u2500\u2500 test.c \u2514\u2500\u2500 ttt \u2514\u2500\u2500 tstg $ tree sdb1/ sdb1/ \u2514\u2500\u2500 echo.py $ rsync -ani test_lv1/ sdb1/ .d..t...... ./ >f+++++++++ test >f+++++++++ test.c cd+++++++++ ttt/ >f+++++++++ ttt/tstg \u8f93\u51fa\u7684\u5341\u4e00\u4e2a\u5b57\u7b26\u957f\u5ea6\u4ee3\u8868\u7684\u662f\uff1a YXcstpoguax \u3002 Y\uff1a\u6307\u793a\u5c06\u8981\u5b8c\u6210\u7684\u66f4\u65b0\u7c7b\u578b <\uff1a\u8868\u793a\u6587\u4ef6\u5c06\u88ab\u8f6c\u6362\u5230\u8fdc\u7a0b\u4e3b\u673a >\uff1a\u8868\u793a\u6587\u4ef6\u5c06\u88ab\u8f6c\u6362\u5230\u672c\u5730 c\uff1a\u610f\u5473\u7740\u672c\u5730\u5c06\u4f1a\u53d1\u751f\u4e00\u4e2a\u6539\u53d8/\u521b\u5efa h\uff1a\u8868\u793a\u662f\u4e00\u4e2a\u786c\u94fe\u63a5\uff08\u8981\u6c42\u6709\u9009\u9879 --hard-links \uff09 .\uff1a\u8868\u793a\u4e0d\u4f1a\u66f4\u65b0 *\uff1a\u8868\u793a\u5269\u4e0b\u7684\u5b57\u7b26\u5305\u542b\u4e00\u4e2a\u4fe1\u606f\u3002\u4f8b\u5982\"deleting\"\u3002 X\uff1a\u6307\u793a\u6587\u4ef6\u7c7b\u578b f\uff1a\u6587\u4ef6 d\uff1a\u6587\u4ef6\u5939 L\uff1a\u94fe\u63a5 D\uff1a\u8bbe\u5907 S\uff1a\u7279\u6b8a\u6587\u4ef6\u3002\u6bd4\u5982socket\u3002 \u5269\u4e0b\u7684\u5b57\u7b26\u663e\u793a\uff1a\u5c5e\u6027\u503c\u6ca1\u6709\u66f4\u65b0\u663e\u793a . \uff1b\u6709\u66f4\u65b0\u5219\u663e\u793a\uff1a \u65b0\u521b\u5efa\u7684\u6761\u76ee\u6bcf\u4e2a\u90fd\u663e\u793a + \u76f8\u540c\u7684\u6761\u76ee\u7528\u7a7a\u683c \u4ee3\u66ff . \u672a\u77e5\u7684\u5c5e\u6027\u6bcf\u4e2a\u90fd\u7528 ? \u4ee3\u66ff \u76f8\u5173\u7684\u5c5e\u6027\u5982\u4e0b\uff1a c\uff1a\u8868\u793a\u5e38\u89c4\u6587\u4ef6\u5177\u6709\u4e0d\u540c\u7684\u6821\u9a8c\u548c\uff08\u8981\u6c42 --checksum \u9009\u9879\uff09\u6216\u8005\u662f\u94fe\u63a5\u3001\u8bbe\u5907\u6216\u7279\u6b8a\u6587\u4ef6\u7684\u503c\u5df2\u66f4\u6539\u3002 s\uff1a\u8868\u793a\u6587\u4ef6\u7684\u5927\u5c0f\u4e0d\u4e00\u81f4\uff0c\u5c06\u4f1a\u66f4\u65b0 t\uff1a\u8868\u793a\u66f4\u6539\u65f6\u95f4\u4e0d\u540c\uff0c\u5c06\u4f1a\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u65f6\u95f4\uff08\u8981\u6c42 --times \u9009\u9879\uff09 p\uff1a\u8868\u793a\u6743\u9650\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u6743\u9650\uff08\u8981\u6c42 --perms \u9009\u9879\uff09 o\uff1a\u8868\u793a\u6240\u5c5e\u7528\u6237\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u7528\u6237\uff08\u8981\u6c42 --owner \u9009\u9879\u548c\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff09 g\uff1a\u8868\u793a\u6240\u5c5e\u7ec4\u4e0d\u540c\uff0c\u5c06\u66f4\u65b0\u6210\u53d1\u9001\u65b9\u7684\u7ec4\uff08\u8981\u6c42 --group \u9009\u9879\u548c\u8bbe\u7f6e\u7ec4\u7684\u6743\u9650\uff09 u\uff1a\u4fdd\u7559\u505a\u672a\u6765\u4f7f\u7528 a\uff1aACL\u4fe1\u606f\u6539\u53d8\u4e86 x\uff1a\u8868\u793a\u6269\u5c55\u5c5e\u6027\u4fe1\u606f\u6539\u53d8\u4e86","title":"3.9 \u663e\u793a\u6e90\u4e0e\u76ee\u6807\u7684\u4e0d\u540c"},{"location":"\u547d\u4ee4/sed/","text":"sed [ OPTION ]... { script - only - if - no - other - script } [ input - file ]... OPTION - n , -- quiet , -- silent \u4e0d\u8f93\u51fa\u6ca1\u6709\u53d8\u52a8\u7684\u884c - f script - file , -- file = script - file \u4ece\u542b\u6709\u811a\u672c\u7684\u6587\u4ef6\u4e2d\u6267\u884c\u52a8\u4f5c - i [ SUFFIX ], -- in - place [ = SUFFIX ] \u76f4\u63a5\u4fee\u6539\u6587\u4ef6\uff0c\u5982\u679c\u63d0\u4f9b SUFFIX \uff0c\u5219\u8fdb\u884c\u5907\u4efd - r , -- regexp - extended \u4f7f\u7528\u6269\u5c55\u7684\u6b63\u5219\u8868\u8fbe\u5f0f { script - only - if - no - other - script }\uff1a ' [n1[,n2]]\u52a8\u4f5c ' \u5e38\u7528\u52a8\u4f5c a \u540e\u63a5\u5b57\u7b26\u4e32\uff0c\u5728\u5339\u914d\u884c\u7684\u4e0b\u4e00\u884c\u65b0\u589e\u5b57\u7b26\u4e32 i \u540e\u63a5\u5b57\u7b26\u4e32\uff0c\u5728\u5339\u914d\u884c\u7684\u4e0a\u4e00\u884c\u65b0\u589e\u5b57\u7b26\u4e32 c \u540e\u63a5\u5b57\u7b26\u4e32\uff0c\u66ff\u6362\u6389 n1 - n2 \u4e4b\u95f4\u7684\u884c d \u5220\u9664\u884c p \u6253\u5370\u884c s \u66ff\u6362\u5b57\u7b26\u4e32 1. \u66ff\u6362\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9 \u00b6 sed -i 's/refa/hyxz/' rpms.list \u9009\u9879\u542b\u610f\uff1a -i\uff1a\u5199\u5165\u5230\u6587\u4ef6\u4e2d -e\uff1a\u6307\u5b9a\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5728\u63a7\u5236\u53f0\u8f93\u51fa \u5982\u679c\u5185\u5bb9\u5305\u542b / \uff0c\u9700\u8981\u52a0\u4e0a\u524d\u7f00\u8fdb\u884c\u8f6c\u4e49\uff1a sed -e 's/virt-v2v/\\/home\\/tmp\\/usr\\/local\\/bin\\/virt-v2v/g' convert.sh 2. \u5220\u9664\u6307\u5b9a\u884c \u00b6 \u6839\u636e\u884c\u53f7\u5220\u9664\uff1a sed -e '2,$d' rpms.list \u6839\u636e\u5339\u914d\u7684\u5b57\u7b26\u4e32\u5220\u9664\uff1a sed -e '/class/d' setup.py 3. \u63d2\u5165\u591a\u884c \u00b6 [ root@dev vitest ] # nl /etc/passwd | sed '2i first line\\ > second line ' 1 root:x:0:0:root:/root:/bin/bash first line second line 2 bin:x:1:1:bin:/bin:/sbin/nologin 4. \u53d6\u4ee3\u884c \u00b6 [ root@dev vitest ] # nl /etc/passwd | sed '1,4c No lines.' No lines. 5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin 5. \u6253\u5370\u884c \u00b6 [ root@dev vitest ] # nl /etc/passwd | sed -n '1,3p' 1 root:x:0:0:root:/root:/bin/bash 2 bin:x:1:1:bin:/bin:/sbin/nologin 3 daemon:x:2:2:daemon:/sbin:/sbin/nologin","title":"sed"},{"location":"\u547d\u4ee4/sed/#1","text":"sed -i 's/refa/hyxz/' rpms.list \u9009\u9879\u542b\u610f\uff1a -i\uff1a\u5199\u5165\u5230\u6587\u4ef6\u4e2d -e\uff1a\u6307\u5b9a\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5728\u63a7\u5236\u53f0\u8f93\u51fa \u5982\u679c\u5185\u5bb9\u5305\u542b / \uff0c\u9700\u8981\u52a0\u4e0a\u524d\u7f00\u8fdb\u884c\u8f6c\u4e49\uff1a sed -e 's/virt-v2v/\\/home\\/tmp\\/usr\\/local\\/bin\\/virt-v2v/g' convert.sh","title":"1. \u66ff\u6362\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9"},{"location":"\u547d\u4ee4/sed/#2","text":"\u6839\u636e\u884c\u53f7\u5220\u9664\uff1a sed -e '2,$d' rpms.list \u6839\u636e\u5339\u914d\u7684\u5b57\u7b26\u4e32\u5220\u9664\uff1a sed -e '/class/d' setup.py","title":"2. \u5220\u9664\u6307\u5b9a\u884c"},{"location":"\u547d\u4ee4/sed/#3","text":"[ root@dev vitest ] # nl /etc/passwd | sed '2i first line\\ > second line ' 1 root:x:0:0:root:/root:/bin/bash first line second line 2 bin:x:1:1:bin:/bin:/sbin/nologin","title":"3. \u63d2\u5165\u591a\u884c"},{"location":"\u547d\u4ee4/sed/#4","text":"[ root@dev vitest ] # nl /etc/passwd | sed '1,4c No lines.' No lines. 5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin","title":"4. \u53d6\u4ee3\u884c"},{"location":"\u547d\u4ee4/sed/#5","text":"[ root@dev vitest ] # nl /etc/passwd | sed -n '1,3p' 1 root:x:0:0:root:/root:/bin/bash 2 bin:x:1:1:bin:/bin:/sbin/nologin 3 daemon:x:2:2:daemon:/sbin:/sbin/nologin","title":"5. \u6253\u5370\u884c"},{"location":"\u547d\u4ee4/split/","text":"\u5206\u5272\u547d\u4ee4\u3002 split [ OPTION ] ... [ INPUT [PREFIX ] ] Output fixed - size pieces of INPUT to PREFIXaa , PREFIXab , ...; default size is 1000 lines , and default PREFIX is 'x' . With no INPUT , or when INPUT is - , read standard input . - a , --suffix-length=N \u751f\u6210\u957f\u5ea6\u4e3a N (default 2)\u7684\u540e\u7f00 --additional-suffix=SUFFIX \u9644\u52a0\u989d\u5916\u7684\u540e\u7f00 - b , --bytes=SIZE \u6309\u6bcf\u4e2a\u8f93\u51fa\u6587\u4ef6\u7684\u5927\u5c0f\u5206\u5272\u3002\u5355\u4f4d\uff1aK, M, G, T, P, E, Z, Y (powers of 1024) or KB, MB, ... (powers of 1000) - d , --numeric-suffixes[=FROM] \u4f7f\u7528\u6570\u5b57\u4ee3\u66ff\u5b57\u6bcd\u4f5c\u4e3a\u540e\u7f00\uff1bFROM \u662f\u8d77\u59cb\u6570\u5b57(default 0) - l , --lines=NUMBER \u6309\u6bcf\u4e2a\u8f93\u51fa\u6587\u4ef6\u7684\u884c\u6570\u5206\u5272 - n , --number=CHUNKS \u751f\u6210 CHUNKS \u4e2a\u8f93\u51fa\u6587\u4ef6 [ root@dev vitest ] # ll man_db.conf -rw-r--r-- 1 sink sink 4561 Oct 8 14 :06 man_db.conf # \u6839\u636e\u6587\u4ef6\u5927\u5c0f\u5206\u5272 [ root@dev vitest ] # split -a 1 --additional-suffix x -b 1K -d man_db.conf man_db.conf [ root@dev vitest ] # ll man_db.conf?? -rw-r--r-- 1 root root 1024 Oct 10 14 :35 man_db.conf0x -rw-r--r-- 1 root root 1024 Oct 10 14 :35 man_db.conf1x -rw-r--r-- 1 root root 1024 Oct 10 14 :35 man_db.conf2x -rw-r--r-- 1 root root 1024 Oct 10 14 :35 man_db.conf3x -rw-r--r-- 1 root root 465 Oct 10 14 :35 man_db.conf4x # \u6839\u636e\u6587\u4ef6\u6570\u91cf\u5206\u5272 [ root@dev vitest ] # split -a 1 -n 4 -d man_db.conf man_db.conf [ root@dev vitest ] # ll man_db.conf? -rw-r--r-- 1 root root 1140 Oct 10 14 :40 man_db.conf0 -rw-r--r-- 1 root root 1140 Oct 10 14 :40 man_db.conf1 -rw-r--r-- 1 root root 1140 Oct 10 14 :40 man_db.conf2 -rw-r--r-- 1 root root 1141 Oct 10 14 :40 man_db.conf3 \u4f7f\u7528\u6d41\u6765\u590d\u539f\u6587\u4ef6: [ root@dev vitest ] # cat man_db.conf? >> man_db.conf.bak [ root@dev vitest ] # diff man_db.conf man_db.conf.bak","title":"Split"},{"location":"\u547d\u4ee4/ssh\u514d\u5bc6\u767b\u5f55/","text":"\u547d\u4ee4\u6dfb\u52a0\u516c\u94a5 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xxx \u6dfb\u52a0\u5b8c\u6210\u5373\u53ef\u514d\u5bc6\u767b\u5f55 root@xxx \u5982\u679c\u8981\u6c42\u4f7f\u7528 ssh-agent \u6765\u6258\u7ba1\u9a8c\u8bc1\u7684\u79c1\u94a5\uff0c\u5219\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5\uff1a # \u751f\u6210\u8ba4\u8bc1socket\uff0c\u901a\u5e38\u4f4d\u4e8e /tmp/ssh-xxx/agent.xxx eval ` ssh-agent -s ` # \u6dfb\u52a0\u79c1\u94a5 ssh-add ssh-agent\u662f\u4e00\u4e2a\u5bc6\u94a5\u7ba1\u7406\u5668\uff0c\u8fd0\u884cssh-agent\u4ee5\u540e\uff0c\u4f7f\u7528ssh-add\u5c06\u79c1\u94a5\u4ea4\u7ed9ssh-agent\u4fdd\u7ba1\uff0c\u5176\u4ed6\u7a0b\u5e8f\u9700\u8981\u8eab\u4efd\u9a8c\u8bc1\u7684\u65f6\u5019\u53ef\u4ee5\u5c06\u9a8c\u8bc1\u7533\u8bf7\u4ea4\u7ed9ssh-agent\u6765\u5b8c\u6210\u6574\u4e2a\u8ba4\u8bc1\u8fc7\u7a0b\u3002","title":"ssh\u514d\u5bc6\u767b\u5f55"},{"location":"\u547d\u4ee4/tar\u547d\u4ee4\u6253\u5305\u53bb\u6389\u8def\u5f84\u524d\u7f00/","text":"\u6240\u6709\u7684\u6587\u4ef6\u90fd\u5728\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\u8fdb\u884c\u6253\u5305\uff1a $ tar -cpvf <tar-name> -C <dir> <files> \u4e0d\u80fd\u4f7f\u7528\u901a\u914d\u7b26\uff0c\u6bd4\u5982\u8fd9\u6837\u662f \u4e0d\u884c \u7684\uff1a $ tar -Jpc -f compress.tar.xz -C compress/ services* \u6587\u4ef6\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u5939\u4e0b\uff0c\u5c31\u9700\u8981\u4f7f\u7528 -r \u9009\u9879\u6765\u628a\u6587\u4ef6\u9010\u4e2a\u6dfb\u52a0\u5230\u538b\u7f29\u5305\u4e2d\uff08\u6ca1\u6709\u538b\u7f29\u5305\u7684\u8bdd\u4f1a\u521b\u5efa\uff09\uff1a $ tar -rpf <tar-name> -C <dir-1> <dir-1/file ( s ) -1> ... $ tar -rpf <tar-name> -C <dir1-N> <dir-N/file ( s ) -N>","title":"tar\u547d\u4ee4\u6253\u5305\u53bb\u6389\u8def\u5f84\u524d\u7f00"},{"location":"\u547d\u4ee4/trap/","text":"1. trap\u4ecb\u7ecd \u00b6 trap\u547d\u4ee4\u662flinux\u4e2d\u7528\u6765\u5728\u547d\u4ee4\u6267\u884c\u8fc7\u7a0b\u4e2d\u6355\u83b7\u4fe1\u53f7\u7684\u3002\u597d\u50cf\u53ea\u80fd\u5728\u811a\u672c\u4e2d\u4f7f\u7528\uff1f\uff1f\uff1f trap [ -lp ] [[ arg ] sigspec ... ] \u5f53shell\u63a5\u6536\u5230\u4e86\u4fe1\u53f7 sigspec \uff08\u53ef\u4ee5\u662f\u591a\u4e2a\uff09\uff0c\u5c31\u4f1a\u6267\u884c arg \u547d\u4ee4\u3002 \u82e5 arg \u4e0d\u5b58\u5728\u6216\u8005\u662f - \uff08\u4f46\u662f\u4e3a\u4e86\u533a\u522b\u4e8e\u9009\u9879\uff0c\u4f1a\u5199\u6210 -- \uff09\uff0c\u5e76\u4e14\u6709\u81f3\u5c11\u4e00\u4e2a\u6307\u5b9a\u7684\u4fe1\u53f7\uff0c\u90a3\u4e48\u5c31\u6309\u7167\u6307\u5b9a\u4fe1\u53f7\u539f\u6765\u7684\u52a8\u4f5c\u884c\u4e8b\uff08\u5373\u6e05\u9664\u6307\u5b9a\u4fe1\u53f7\u7684\u81ea\u5b9a\u4e49\u52a8\u4f5c\uff09\u3002 \u82e5 arg \u662f\u7a7a\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u6307\u5b9a\u7684 sigspec \u4f1a\u88ab\u5ffd\u89c6\u3002 \u82e5 arg \u4e0d\u5b58\u5728\u4e14\u63d0\u4f9b\u4e86\u9009\u9879 -p \uff0c\u5219\u663e\u793a\u4e0e\u6bcf\u4e2a sigspec \u5173\u8054\u7684trap\u547d\u4ee4\u3002 \u82e5\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u53c2\u6570\u6216\u53ea\u6709\u9009\u9879 -p \uff0c\u90a3\u4e48\u6253\u5370\u548c\u6bcf\u4e2a\u4fe1\u53f7\u5173\u8054\u7684\u547d\u4ee4\u5217\u8868\u3002 -l \u9009\u9879\u4f7f shell \u6253\u5370\u4fe1\u53f7\u540d\u79f0\u53ca\u5176\u76f8\u5e94\u7f16\u53f7\u7684\u5217\u8868\u3002 sigspec \u53ef\u4ee5\u662f\u4fe1\u53f7\u53f7\u7801\u6216\u8005\u4fe1\u53f7\u540d\u79f0\uff08\u901a\u8fc7 man 7 signal \u67e5\u770b\uff09\u3002\u4fe1\u53f7\u540d\u79f0\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0cSIG \u524d\u7f00\u662f\u53ef\u9009\u7684\u3002 sigspec \u5176\u5b83\u7684\u503c\uff1a EXIT (0) \uff1a\u8868\u793a\u4eceshell\u9000\u51fa\u540e\u6267\u884c arg \u547d\u4ee4\u3002 DEBUG \uff1a\u5728\u6bcf\u4e2a \u7b80\u5355\u547d\u4ee4\uff08for\u3001\u53d8\u79cdfor\u3001case\u3001select\u547d\u4ee4\uff09\u548cshell\u51fd\u6570\u7684\u7b2c\u4e00\u6761\u547d\u4ee4 \u6267\u884c\u4e4b\u524d\u6267\u884c arg \u547d\u4ee4\u3002 RETURN \uff1a\u6bcf\u6b21\u6267\u884c\u5b8c\u4e00\u4e2ashell\u51fd\u6570\u6216\u811a\u672c ERR \uff1a\u6bcf\u5f53\u7b80\u5355\u547d\u4ee4\u5177\u6709\u975e\u96f6\u9000\u51fa\u72b6\u6001\u65f6\uff0c\u6267\u884c arg \u547d\u4ee4\uff0c\u540c\u65f6\u4e5f\u4f1a\u6267\u884c EXIT \u7684\u547d\u4ee4\u3002\u5982\u679c\u5931\u8d25\u7684\u547d\u4ee4\u662f\u4ee5\u4e0b\u60c5\u51b5\u5219\u4e0d\u4f1a\u6267\u884c arg \u547d\u4ee4\uff1a \u662f\u7d27\u8ddf\u5728 while\u6216until \u5173\u952e\u5b57\u540e\u9762\u7684\u547d\u4ee4\u5217\u8868\u7684\u4e00\u90e8\u5206\uff1b if \u8bed\u53e5\u4e2d\u7684test\u7684\u4e00\u90e8\u5206\uff1b \u5728 &&\u6216|| \u547d\u4ee4\u5217\u8868\u4e2d\u7684\u4e00\u90e8\u5206\uff1b \u547d\u4ee4\u7684\u8fd4\u56de\u503c\u901a\u8fc7 ! \u53cd\u8f6c\u3002 \u4fe1\u53f7\u88ab\u5ffd\u7565\u540e\uff0c\u518d\u8fdb\u5165shell\u65f6\u4e0d\u4f1a\u88ab\u6355\u83b7\u3001\u91cd\u7f6e\u6216\u5217\u51fa\u3002\u521b\u5efa\u672a\u88ab\u5ffd\u7565\u7684\u6355\u83b7\u4fe1\u53f7\u5c06\u91cd\u7f6e\u4e3a\u5b50shell\u6216\u5b50shell\u73af\u5883\u4e2d\u7684\u539f\u59cb\u503c\u3002 \u5982\u679c\u6709\u4efb\u4f55 sigspec \u662f\u4e0d\u5408\u683c\u7684\uff0c\u90a3\u4e48trap\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u662f false \uff0c\u5426\u5219\u662f true \u3002 2. \u5e38\u89c1\u4fe1\u53f7 \u00b6 \u53c2\u8003\uff1a https://www.jianshu.com/p/b26d4e520385 https://dsa.cs.tsinghua.edu.cn/oj/static/unix_signal.html man 7 signal \u4fe1\u53f7 \u503c \u63cf\u8ff0 1 SIGHUP \u6302\u8d77\u8fdb\u7a0b\uff0c\u89c1\u4e0b\u65b9\u8be6\u7ec6\u89e3\u91ca 2 SIGINT \u7ec8\u6b62\u8fdb\u7a0b\uff08\u6253\u65ad\u8fdb\u7a0b\uff1f\uff1f\uff1f\uff09Ctrl+C 3 SIGQUIT \u505c\u6b62\u8fdb\u7a0b 9 SIGKILL \u65e0\u6761\u4ef6\u7ec8\u6b62\u8fdb\u7a0b 15 SIGTERM \u5c3d\u53ef\u80fd\u7ec8\u6b62\u8fdb\u7a0b 17 SIGSTOP \u65e0\u6761\u4ef6\u505c\u6b62\u8fdb\u7a0b\uff0c\u4f46\u4e0d\u662f\u7ec8\u6b62\u8fdb\u7a0b 18 SIGTSTP \u505c\u6b62\u6216\u6682\u505c\u8fdb\u7a0b\uff0c\u4f46\u4e0d\u7ec8\u6b62\u8fdb\u7a0b Ctrl+Z 19 SIGCONT \u7ee7\u7eed\u8fd0\u884c\u505c\u6b62\u7684\u8fdb\u7a0b SIGHUP\uff1a\u63a7\u5236\u7ec8\u7aef\u88ab\u5173\u95ed\u65f6\u8be5\u4fe1\u53f7\u4f1a\u88ab\u53d1\u9001\u5230\u8fdb\u7a0b\u3002\u6700\u521d\u88ab\u8bbe\u8ba1\u6210\u901a\u77e5\u6302\u8d77\u7684\u8fc7\u7a0b\u3002\u5728\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u8be5\u4fe1\u53f7\u901a\u5e38\u610f\u5473\u7740\u4f2a\u7ec8\u7aef\u6216\u865a\u62df\u7ec8\u7aef\u88ab\u5173\u95ed\u4e86\u3002\u8bb8\u591a daemons \u4f1a reload \u5b83\u4eec\u7684\u914d\u7f6e\u6587\u4ef6\u548c reopen \u4ed6\u4eec\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u9000\u51fa\u3002 nohup \u53ef\u4ee5\u8ba9\u6307\u4ee4\u5ffd\u7565\u8be5\u4fe1\u53f7\uff0c\u4e0e & \u642d\u914d\u4f7f\u7528\u53ef\u8ba9\u4f60\u5728\u8131\u673a\u72b6\u6001\u4e0b\u7ee7\u7eed\u6267\u884c\u6307\u4ee4\uff0c \u53c2\u8003\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4 \u3002 3. \u4e3e\u4f8b \u00b6 \u5f53\u53d1\u751f\u4fe1\u53f7\u65f6\u5ffd\u7565\u8be5\u4fe1\u53f7 #!/bin/sh trap \"\" 2 \u6e05\u9664\u6307\u5b9a\u4fe1\u53f7\u7684\u6307\u5b9a\u52a8\u4f5c\uff0c\u6309\u539f\u8ba1\u5212\u884c\u4e8b #!/bin/sh trap \"\" SIGINT do something... # \u4e0b\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u518d\u5ffd\u7565SIGINT\u4fe1\u53f7 trap -- SIGINT do other something... \u9000\u51fa\u65f6\u6267\u884c\u547d\u4ee4 #!/bin/sh # \u5373\u4f7f\u4e2d\u9014\u6253\u65ad\u7a0b\u5e8f(Ctrl+C)\u6267\u884c\u4e5f\u4f1a\u6267\u884c trap \"echo 'goodbye!'\" 0 do something...","title":"Trap"},{"location":"\u547d\u4ee4/trap/#1-trap","text":"trap\u547d\u4ee4\u662flinux\u4e2d\u7528\u6765\u5728\u547d\u4ee4\u6267\u884c\u8fc7\u7a0b\u4e2d\u6355\u83b7\u4fe1\u53f7\u7684\u3002\u597d\u50cf\u53ea\u80fd\u5728\u811a\u672c\u4e2d\u4f7f\u7528\uff1f\uff1f\uff1f trap [ -lp ] [[ arg ] sigspec ... ] \u5f53shell\u63a5\u6536\u5230\u4e86\u4fe1\u53f7 sigspec \uff08\u53ef\u4ee5\u662f\u591a\u4e2a\uff09\uff0c\u5c31\u4f1a\u6267\u884c arg \u547d\u4ee4\u3002 \u82e5 arg \u4e0d\u5b58\u5728\u6216\u8005\u662f - \uff08\u4f46\u662f\u4e3a\u4e86\u533a\u522b\u4e8e\u9009\u9879\uff0c\u4f1a\u5199\u6210 -- \uff09\uff0c\u5e76\u4e14\u6709\u81f3\u5c11\u4e00\u4e2a\u6307\u5b9a\u7684\u4fe1\u53f7\uff0c\u90a3\u4e48\u5c31\u6309\u7167\u6307\u5b9a\u4fe1\u53f7\u539f\u6765\u7684\u52a8\u4f5c\u884c\u4e8b\uff08\u5373\u6e05\u9664\u6307\u5b9a\u4fe1\u53f7\u7684\u81ea\u5b9a\u4e49\u52a8\u4f5c\uff09\u3002 \u82e5 arg \u662f\u7a7a\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u6307\u5b9a\u7684 sigspec \u4f1a\u88ab\u5ffd\u89c6\u3002 \u82e5 arg \u4e0d\u5b58\u5728\u4e14\u63d0\u4f9b\u4e86\u9009\u9879 -p \uff0c\u5219\u663e\u793a\u4e0e\u6bcf\u4e2a sigspec \u5173\u8054\u7684trap\u547d\u4ee4\u3002 \u82e5\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u53c2\u6570\u6216\u53ea\u6709\u9009\u9879 -p \uff0c\u90a3\u4e48\u6253\u5370\u548c\u6bcf\u4e2a\u4fe1\u53f7\u5173\u8054\u7684\u547d\u4ee4\u5217\u8868\u3002 -l \u9009\u9879\u4f7f shell \u6253\u5370\u4fe1\u53f7\u540d\u79f0\u53ca\u5176\u76f8\u5e94\u7f16\u53f7\u7684\u5217\u8868\u3002 sigspec \u53ef\u4ee5\u662f\u4fe1\u53f7\u53f7\u7801\u6216\u8005\u4fe1\u53f7\u540d\u79f0\uff08\u901a\u8fc7 man 7 signal \u67e5\u770b\uff09\u3002\u4fe1\u53f7\u540d\u79f0\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0cSIG \u524d\u7f00\u662f\u53ef\u9009\u7684\u3002 sigspec \u5176\u5b83\u7684\u503c\uff1a EXIT (0) \uff1a\u8868\u793a\u4eceshell\u9000\u51fa\u540e\u6267\u884c arg \u547d\u4ee4\u3002 DEBUG \uff1a\u5728\u6bcf\u4e2a \u7b80\u5355\u547d\u4ee4\uff08for\u3001\u53d8\u79cdfor\u3001case\u3001select\u547d\u4ee4\uff09\u548cshell\u51fd\u6570\u7684\u7b2c\u4e00\u6761\u547d\u4ee4 \u6267\u884c\u4e4b\u524d\u6267\u884c arg \u547d\u4ee4\u3002 RETURN \uff1a\u6bcf\u6b21\u6267\u884c\u5b8c\u4e00\u4e2ashell\u51fd\u6570\u6216\u811a\u672c ERR \uff1a\u6bcf\u5f53\u7b80\u5355\u547d\u4ee4\u5177\u6709\u975e\u96f6\u9000\u51fa\u72b6\u6001\u65f6\uff0c\u6267\u884c arg \u547d\u4ee4\uff0c\u540c\u65f6\u4e5f\u4f1a\u6267\u884c EXIT \u7684\u547d\u4ee4\u3002\u5982\u679c\u5931\u8d25\u7684\u547d\u4ee4\u662f\u4ee5\u4e0b\u60c5\u51b5\u5219\u4e0d\u4f1a\u6267\u884c arg \u547d\u4ee4\uff1a \u662f\u7d27\u8ddf\u5728 while\u6216until \u5173\u952e\u5b57\u540e\u9762\u7684\u547d\u4ee4\u5217\u8868\u7684\u4e00\u90e8\u5206\uff1b if \u8bed\u53e5\u4e2d\u7684test\u7684\u4e00\u90e8\u5206\uff1b \u5728 &&\u6216|| \u547d\u4ee4\u5217\u8868\u4e2d\u7684\u4e00\u90e8\u5206\uff1b \u547d\u4ee4\u7684\u8fd4\u56de\u503c\u901a\u8fc7 ! \u53cd\u8f6c\u3002 \u4fe1\u53f7\u88ab\u5ffd\u7565\u540e\uff0c\u518d\u8fdb\u5165shell\u65f6\u4e0d\u4f1a\u88ab\u6355\u83b7\u3001\u91cd\u7f6e\u6216\u5217\u51fa\u3002\u521b\u5efa\u672a\u88ab\u5ffd\u7565\u7684\u6355\u83b7\u4fe1\u53f7\u5c06\u91cd\u7f6e\u4e3a\u5b50shell\u6216\u5b50shell\u73af\u5883\u4e2d\u7684\u539f\u59cb\u503c\u3002 \u5982\u679c\u6709\u4efb\u4f55 sigspec \u662f\u4e0d\u5408\u683c\u7684\uff0c\u90a3\u4e48trap\u547d\u4ee4\u7684\u8fd4\u56de\u503c\u662f false \uff0c\u5426\u5219\u662f true \u3002","title":"1. trap\u4ecb\u7ecd"},{"location":"\u547d\u4ee4/trap/#2","text":"\u53c2\u8003\uff1a https://www.jianshu.com/p/b26d4e520385 https://dsa.cs.tsinghua.edu.cn/oj/static/unix_signal.html man 7 signal \u4fe1\u53f7 \u503c \u63cf\u8ff0 1 SIGHUP \u6302\u8d77\u8fdb\u7a0b\uff0c\u89c1\u4e0b\u65b9\u8be6\u7ec6\u89e3\u91ca 2 SIGINT \u7ec8\u6b62\u8fdb\u7a0b\uff08\u6253\u65ad\u8fdb\u7a0b\uff1f\uff1f\uff1f\uff09Ctrl+C 3 SIGQUIT \u505c\u6b62\u8fdb\u7a0b 9 SIGKILL \u65e0\u6761\u4ef6\u7ec8\u6b62\u8fdb\u7a0b 15 SIGTERM \u5c3d\u53ef\u80fd\u7ec8\u6b62\u8fdb\u7a0b 17 SIGSTOP \u65e0\u6761\u4ef6\u505c\u6b62\u8fdb\u7a0b\uff0c\u4f46\u4e0d\u662f\u7ec8\u6b62\u8fdb\u7a0b 18 SIGTSTP \u505c\u6b62\u6216\u6682\u505c\u8fdb\u7a0b\uff0c\u4f46\u4e0d\u7ec8\u6b62\u8fdb\u7a0b Ctrl+Z 19 SIGCONT \u7ee7\u7eed\u8fd0\u884c\u505c\u6b62\u7684\u8fdb\u7a0b SIGHUP\uff1a\u63a7\u5236\u7ec8\u7aef\u88ab\u5173\u95ed\u65f6\u8be5\u4fe1\u53f7\u4f1a\u88ab\u53d1\u9001\u5230\u8fdb\u7a0b\u3002\u6700\u521d\u88ab\u8bbe\u8ba1\u6210\u901a\u77e5\u6302\u8d77\u7684\u8fc7\u7a0b\u3002\u5728\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u8be5\u4fe1\u53f7\u901a\u5e38\u610f\u5473\u7740\u4f2a\u7ec8\u7aef\u6216\u865a\u62df\u7ec8\u7aef\u88ab\u5173\u95ed\u4e86\u3002\u8bb8\u591a daemons \u4f1a reload \u5b83\u4eec\u7684\u914d\u7f6e\u6587\u4ef6\u548c reopen \u4ed6\u4eec\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u9000\u51fa\u3002 nohup \u53ef\u4ee5\u8ba9\u6307\u4ee4\u5ffd\u7565\u8be5\u4fe1\u53f7\uff0c\u4e0e & \u642d\u914d\u4f7f\u7528\u53ef\u8ba9\u4f60\u5728\u8131\u673a\u72b6\u6001\u4e0b\u7ee7\u7eed\u6267\u884c\u6307\u4ee4\uff0c \u53c2\u8003\u5728\u540e\u53f0\u6267\u884c\u547d\u4ee4 \u3002","title":"2. \u5e38\u89c1\u4fe1\u53f7"},{"location":"\u547d\u4ee4/trap/#3","text":"\u5f53\u53d1\u751f\u4fe1\u53f7\u65f6\u5ffd\u7565\u8be5\u4fe1\u53f7 #!/bin/sh trap \"\" 2 \u6e05\u9664\u6307\u5b9a\u4fe1\u53f7\u7684\u6307\u5b9a\u52a8\u4f5c\uff0c\u6309\u539f\u8ba1\u5212\u884c\u4e8b #!/bin/sh trap \"\" SIGINT do something... # \u4e0b\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u518d\u5ffd\u7565SIGINT\u4fe1\u53f7 trap -- SIGINT do other something... \u9000\u51fa\u65f6\u6267\u884c\u547d\u4ee4 #!/bin/sh # \u5373\u4f7f\u4e2d\u9014\u6253\u65ad\u7a0b\u5e8f(Ctrl+C)\u6267\u884c\u4e5f\u4f1a\u6267\u884c trap \"echo 'goodbye!'\" 0 do something...","title":"3. \u4e3e\u4f8b"},{"location":"\u547d\u4ee4/wget\u7528\u6cd5/","text":"\u5b83\u7684\u7528\u6cd5\u5f88\u7b80\u5355\uff0cwget\u4f7f\u7528\u683c\u5f0f\u5982\u4e0b\uff1a wget [ \u9009\u9879 ] [ \u4e0b\u8f7d\u5730\u5740 ] \u9009\u9879\uff1a -b\uff1a\u540e\u53f0\u4e0b\u8f7d\uff0cWget\u9ed8\u8ba4\u7684\u662f\u628a\u6587\u4ef6\u4e0b\u8f7d\u5230\u5f53\u524d\u76ee\u5f55\u3002 -O\uff1a\u5c06\u6587\u4ef6\u4e0b\u8f7d\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002 -P\uff1a\u4fdd\u5b58\u6587\u4ef6\u4e4b\u524d\u5148\u521b\u5efa\u6307\u5b9a\u540d\u79f0\u7684\u76ee\u5f55\u3002 -t\uff1a\u5c1d\u8bd5\u8fde\u63a5\u6b21\u6570\uff0c\u5f53Wget\u65e0\u6cd5\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u5c1d\u8bd5\u8fde\u63a5\u591a\u5c11\u6b21\u3002 -c\uff1a\u65ad\u70b9\u7eed\u4f20\uff0c\u5982\u679c\u4e0b\u8f7d\u4e2d\u65ad\uff0c\u90a3\u4e48\u8fde\u63a5\u6062\u590d\u65f6\u4f1a\u4ece\u4e0a\u6b21\u65ad\u70b9\u5f00\u59cb\u4e0b\u8f7d\u3002 -r\uff1a\u4f7f\u7528\u9012\u5f52\u4e0b\u8f7d","title":"wget\u7528\u6cd5"},{"location":"\u547d\u4ee4/xargs\u4e0e\u7ba1\u9053/","text":"\u7ba1\u9053\u662f\u5c06\u524d\u8005\u7684\u6807\u51c6\u8f93\u51fa\u4f5c\u4e3a\u540e\u8005\u7684 \u6807\u51c6\u8f93\u5165 \u3002 xargs \u662f\u7ed9\u547d\u4ee4\u4f20\u9012\u53c2\u6570\u7684\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u4e5f\u662f\u7ec4\u5408\u591a\u4e2a\u547d\u4ee4\u7684\u4e00\u4e2a\u5de5\u5177\u3002\u53ef\u4ee5\u5c06\u7ba1\u9053\u6216\u6807\u51c6\u8f93\u5165\uff08stdin\uff09\u6570\u636e\u8f6c\u6362\u6210 \u547d\u4ee4\u884c\u53c2\u6570 \uff0c\u4e5f\u80fd\u591f\u4ece\u6587\u4ef6\u7684\u8f93\u51fa\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u4e00\u822c\u548c\u7ba1\u9053\u4e00\u8d77\u4f7f\u7528\u3002 xargs \u6559\u7a0b \u5bf9\u4e8e\u4e0d\u652f\u6301\u7ba1\u9053\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528xargs\u6765\u4e3a\u5176\u63d0\u4f9b\u53c2\u6570\uff1a [ root@dev vitest ] # find . -perm /7000 | xargs ls -l -rwSr--r-- 1 root root 18 Oct 10 14 :15 ./num1 \u6b64\u6cd5\u4e5f\u53ef\u4ee5\u89e3\u51b3\u547d\u4ee4\u884c\u53c2\u6570\u8fc7\u957f\u7684\u95ee\u9898\uff1a [ root@dev vitest ] # find / -type f 2> /dev/null | xargs -n 10 grep -l '\\*' 2> /dev/null","title":"Xargs\u4e0e\u7ba1\u9053"},{"location":"\u547d\u4ee4/\u521b\u5efa\u6587\u4ef6\u81ea\u52a8\u6dfb\u52a0\u6267\u884c\u6743\u9650/","text":"\u7f16\u5199\u811a\u672c vix.sh \uff1a #!/bin/bash filename = $1 if [[ ! -f $filename ]] then # \u5982\u679c\u60f3\u811a\u672c\u7684\u6dfb\u52a0\u6267\u884c\u73af\u5883\u4e5f\u53ef\u5728\u6b64\u6dfb\u52a0 # echo '!/bin/python' > $filename touch $filename else exec vim $filename fi chmod +x $filename vim $filename \u94fe\u63a5\u5230 /usr/local/sbin/ \u4e0b\uff1a chmod +x vix.sh mv vix.sh /usr/local/sbin/vix.sh ln /usr/local/sbin/vix.sh /usr/local/sbin/vix","title":"\u521b\u5efa\u6587\u4ef6\u81ea\u52a8\u6dfb\u52a0\u6267\u884c\u6743\u9650"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/","text":"1. tr \u00b6 \u53c2\u8003\uff1a Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362 2. col \u00b6 col [ options ] OPTIONS - x , --spaces convert tabs to spaces - h , --tabs convert spaces to tabs [ sink@dev vitest ] $ cat man_db.conf | col -x | cat -A 3. join \u00b6 join [ OPTION ] ... FILE1 FILE2 \u5c06\u4e24\u4e2a\u6587\u4ef6\u5408\u5e76 OPTION - i , --ignore-case \u5ffd\u7565\u5927\u5c0f\u5199 - t CHAR \u6307\u5b9a\u8f93\u5165\u8f93\u51fa\u7684\u5206\u9694\u7b26 \uff08 \u9ed8\u8ba4\u662f\u7a7a\u683c \uff09 - 1 FIELD \u6839\u636e file 1 \u7684\u8fd9\u4e2a\u57df\u6765\u5408\u5e76 - 2 FIELD \u6839\u636e file 2 \u7684\u8fd9\u4e2a\u57df\u6765\u5408\u5e76 - j FIELD equivalent to '-1 FIELD -2 FIELD' [ root@dev vitest ] # head -n 3 /etc/passwd /etc/shadow == > /etc/passwd < == root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin == > /etc/shadow < == root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:*:17110:0:99999:7::: daemon:*:17110:0:99999:7::: [ root@dev vitest ] # join -t ':' /etc/passwd /etc/shadow | head -n 3 root:x:0:0:root:/root:/bin/bash: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:x:1:1:bin:/bin:/sbin/nologin:*:17110:0:99999:7::: daemon:x:2:2:daemon:/sbin:/sbin/nologin:*:17110:0:99999:7::: [ root@dev vitest ] # head -n 3 /etc/passwd /etc/group == > /etc/passwd < == root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin == > /etc/group < == root:x:0: bin:x:1: daemon:x:2: [ root@dev vitest ] # join -t ':' -j 3 /etc/passwd /etc/group | head -n 3 0 :root:x:0:root:/root:/bin/bash:root:x: 1 :bin:x:1:bin:/bin:/sbin/nologin:bin:x: 2 :daemon:x:2:daemon:/sbin:/sbin/nologin:daemon:x: Note \u5728\u4f7f\u7528 join \u4e4b\u524d\uff0c \u4f60\u6240\u9700\u8981\u5904\u7406\u7684\u6587\u4ef6\u5e94\u8be5\u8981\u4e8b\u5148\u7ecf\u8fc7\u6392\u5e8f\uff08sort\uff09\u5904\u7406\uff01\u5426\u5219\u6709\u4e9b\u6bd4\u5bf9\u7684\u9879\u76ee\u4f1a\u88ab\u7565\u8fc7\u3002 4. paste \u00b6 paste [ OPTION ] ... [ FILE ] ... \u5355\u7eaf\u5730\u5c06\u591a\u4e2a\u6587\u4ef6\u7684\u884c\u5408\u5e76\u8d77\u6765 - d , --delimiters=LIST \u6307\u5b9a\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u662f TABs - s \u4e00\u6b21\u7c98\u8d34\u4e00\u4e2a\u6587\u4ef6 \uff0c \u800c\u4e0d\u662f\u5e76\u884c\u7c98\u8d34 - \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6 [ root@dev vitest ] # cat /etc/passwd | paste /etc/shadow /etc/group - | head -n 3 root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: root:x:0: root:x:0:0:root:/root:/bin/bash bin:*:17110:0:99999:7::: bin:x:1: bin:x:1:1:bin:/bin:/sbin/nologin daemon:*:17110:0:99999:7::: daemon:x:2: daemon:x:2:2:daemon:/sbin:/sbin/nologin [ root@dev vitest ] # head num1 num2 == > num1 < == 1 2 3 == > num2 < == 4 5 6 [ root@dev vitest ] # paste num1 num2 1 4 2 5 3 6 [ root@dev vitest ] # paste -s num1 num2 1 2 3 4 5 6 5. expand \u00b6 expand [ OPTION ] ... [ FILE ] ... \u628a\u6bcf\u4e2a\u6587\u4ef6\u4e2d\u7684 tabs \u8f6c\u4e3a\u7a7a\u683c - t , --tabs=NUMBER \u6307\u5b9a\u7a7a\u683c\u7684\u957f\u5ea6\uff0c\u9ed8\u8ba4\u662f 8 - \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6 [ root@dev vitest ] # cat -A num1; expand num1 | cat -A 1 ^I1.1$ 2 ^I2.2$ 3 ^I3.3$ 1 1 .1$ 2 2 .2$ 3 3 .3$ \u4e0e\u4e4b\u76f8\u53cd\u7684\u662funexpand\u6307\u4ee4 # \u6709\u70b9\u5947\u602a\uff0c\u660e\u660e\u53ea\u67094\u4e2a\u7a7a\u683c\uff0c\u5374\u8981\u4f7f\u75285\u6765\u6307\u5b9a\u5bbd\u5ea6\uff1f\uff1f\uff1f [ root@dev vitest ] # cat -A num2; echo '---------'; unexpand -t 5 num2 | cat -A 4 4 .4$ 5 5 .5$ 6 6 .6$ --------- 4 ^I4.4$ 5 ^I5.5$ 6 ^I6.6$","title":"\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/#1-tr","text":"\u53c2\u8003\uff1a Windows\u3001Mac\u4e0eUnix\u7684\u6362\u884c\u7b26\u4e0e\u7f16\u7801\u8f6c\u6362","title":"1. tr"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/#2-col","text":"col [ options ] OPTIONS - x , --spaces convert tabs to spaces - h , --tabs convert spaces to tabs [ sink@dev vitest ] $ cat man_db.conf | col -x | cat -A","title":"2. col"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/#3-join","text":"join [ OPTION ] ... FILE1 FILE2 \u5c06\u4e24\u4e2a\u6587\u4ef6\u5408\u5e76 OPTION - i , --ignore-case \u5ffd\u7565\u5927\u5c0f\u5199 - t CHAR \u6307\u5b9a\u8f93\u5165\u8f93\u51fa\u7684\u5206\u9694\u7b26 \uff08 \u9ed8\u8ba4\u662f\u7a7a\u683c \uff09 - 1 FIELD \u6839\u636e file 1 \u7684\u8fd9\u4e2a\u57df\u6765\u5408\u5e76 - 2 FIELD \u6839\u636e file 2 \u7684\u8fd9\u4e2a\u57df\u6765\u5408\u5e76 - j FIELD equivalent to '-1 FIELD -2 FIELD' [ root@dev vitest ] # head -n 3 /etc/passwd /etc/shadow == > /etc/passwd < == root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin == > /etc/shadow < == root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:*:17110:0:99999:7::: daemon:*:17110:0:99999:7::: [ root@dev vitest ] # join -t ':' /etc/passwd /etc/shadow | head -n 3 root:x:0:0:root:/root:/bin/bash: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:x:1:1:bin:/bin:/sbin/nologin:*:17110:0:99999:7::: daemon:x:2:2:daemon:/sbin:/sbin/nologin:*:17110:0:99999:7::: [ root@dev vitest ] # head -n 3 /etc/passwd /etc/group == > /etc/passwd < == root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin == > /etc/group < == root:x:0: bin:x:1: daemon:x:2: [ root@dev vitest ] # join -t ':' -j 3 /etc/passwd /etc/group | head -n 3 0 :root:x:0:root:/root:/bin/bash:root:x: 1 :bin:x:1:bin:/bin:/sbin/nologin:bin:x: 2 :daemon:x:2:daemon:/sbin:/sbin/nologin:daemon:x: Note \u5728\u4f7f\u7528 join \u4e4b\u524d\uff0c \u4f60\u6240\u9700\u8981\u5904\u7406\u7684\u6587\u4ef6\u5e94\u8be5\u8981\u4e8b\u5148\u7ecf\u8fc7\u6392\u5e8f\uff08sort\uff09\u5904\u7406\uff01\u5426\u5219\u6709\u4e9b\u6bd4\u5bf9\u7684\u9879\u76ee\u4f1a\u88ab\u7565\u8fc7\u3002","title":"3. join"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/#4-paste","text":"paste [ OPTION ] ... [ FILE ] ... \u5355\u7eaf\u5730\u5c06\u591a\u4e2a\u6587\u4ef6\u7684\u884c\u5408\u5e76\u8d77\u6765 - d , --delimiters=LIST \u6307\u5b9a\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u662f TABs - s \u4e00\u6b21\u7c98\u8d34\u4e00\u4e2a\u6587\u4ef6 \uff0c \u800c\u4e0d\u662f\u5e76\u884c\u7c98\u8d34 - \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6 [ root@dev vitest ] # cat /etc/passwd | paste /etc/shadow /etc/group - | head -n 3 root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: root:x:0: root:x:0:0:root:/root:/bin/bash bin:*:17110:0:99999:7::: bin:x:1: bin:x:1:1:bin:/bin:/sbin/nologin daemon:*:17110:0:99999:7::: daemon:x:2: daemon:x:2:2:daemon:/sbin:/sbin/nologin [ root@dev vitest ] # head num1 num2 == > num1 < == 1 2 3 == > num2 < == 4 5 6 [ root@dev vitest ] # paste num1 num2 1 4 2 5 3 6 [ root@dev vitest ] # paste -s num1 num2 1 2 3 4 5 6","title":"4. paste"},{"location":"\u547d\u4ee4/\u5b57\u7b26\u8f6c\u6362\u547d\u4ee4/#5-expand","text":"expand [ OPTION ] ... [ FILE ] ... \u628a\u6bcf\u4e2a\u6587\u4ef6\u4e2d\u7684 tabs \u8f6c\u4e3a\u7a7a\u683c - t , --tabs=NUMBER \u6307\u5b9a\u7a7a\u683c\u7684\u957f\u5ea6\uff0c\u9ed8\u8ba4\u662f 8 - \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6 [ root@dev vitest ] # cat -A num1; expand num1 | cat -A 1 ^I1.1$ 2 ^I2.2$ 3 ^I3.3$ 1 1 .1$ 2 2 .2$ 3 3 .3$ \u4e0e\u4e4b\u76f8\u53cd\u7684\u662funexpand\u6307\u4ee4 # \u6709\u70b9\u5947\u602a\uff0c\u660e\u660e\u53ea\u67094\u4e2a\u7a7a\u683c\uff0c\u5374\u8981\u4f7f\u75285\u6765\u6307\u5b9a\u5bbd\u5ea6\uff1f\uff1f\uff1f [ root@dev vitest ] # cat -A num2; echo '---------'; unexpand -t 5 num2 | cat -A 4 4 .4$ 5 5 .5$ 6 6 .6$ --------- 4 ^I4.4$ 5 ^I5.5$ 6 ^I6.6$","title":"5. expand"},{"location":"\u547d\u4ee4/\u6587\u4ef6\u5bf9\u6bd4/","text":"\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\u3002 1. diff \u00b6 diff [OPTION]... FILES Compare FILES line by line. FILES are 'FILE1 FILE2' or 'DIR1 DIR2' or 'DIR FILE...' or 'FILE... DIR'. OPTION -s, --report-identical-files report when two files are the same -i, --ignore-case ignore case differences in file contents -B, --ignore-blank-lines ignore changes where lines are all blank -c, -C NUM, --context[=NUM] \u5bf9\u6240\u6709\u6587\u4ef6\u5728\u4e0d\u540c\u5904\u90fd\u8f93\u51fa\u4e00\u81f4\u7684 NUM (default 3) \u884c -u, -U NUM, --unified[=NUM] \u5728\u4e0d\u540c\u5904\u7684\u4e0a\u4e0b\u6587\u8f93\u51fa\u4e00\u81f4\u7684 NUM (default 3) \u884c -N, --new-file treat absent files as empty -a, --text treat all files as text --binary Read and write data in binary mode. -r, --recursive recursively compare any subdirectories found [ sink@dev vitest ] $ diff man_db.conf.bak man.test.conf # 25\u8868\u793a\u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u884c\u53f7\uff0cc\u8868\u793a\u5de6\u8fb9\u7b2c25\u884c\u88ab\u53f3\u8fb925\u884c\u53d6\u4ee3\u4e86\uff0c\u7b2c\u4e8c\u4e2a25\u8868\u793a\u7b2c\u4e8c\u4e2a\u6587\u4ef6\u7684\u884c\u53f7 # d\u8868\u793a\u5220\u9664 25c25 < tree holds man pages for what binary directory. --- > # ie. what man tree holds man pages for what binary directory. # \u8f93\u51fa\u4e24\u884c\u4e0a\u4e0b\u6587 [ sink@dev vitest ] $ diff -C 2 man_db.conf.bak man.test.conf *** man_db.conf.bak 2019 -10-10 14 :45:12.640893299 +0800 --- man.test.conf 2019 -10-08 09 :51:29.652930093 +0800 *************** *** 23 ,27 **** #--------------------------------------------------------- # set up PATH to MANPATH mapping ! tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* --- 23 ,27 ---- #--------------------------------------------------------- # set up PATH to MANPATH mapping ! # ie. what man tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* # \u7c7b\u4f3cgit\u7684\u5f62\u5f0f\u8f93\u51fa [ sink@dev vitest ] $ diff -u man_db.conf.bak man.test.conf --- man_db.conf.bak 2019 -10-10 14 :45:12.640893299 +0800 +++ man.test.conf 2019 -10-08 09 :51:29.652930093 +0800 @@ -22,7 +22,7 @@ MANDATORY_MANPATH /usr/local/share/man #--------------------------------------------------------- # set up PATH to MANPATH mapping -tree holds man pages for what binary directory. +# ie. what man tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* # # \u6bd4\u8f83\u6587\u4ef6\u5939 [ sink@dev vitest ] $ diff /etc/rc0.d/ /etc/rc5.d/ Only in /etc/rc0.d/: K43vmware-tools-thinprint Only in /etc/rc0.d/: K90network Only in /etc/rc0.d/: K99vmware-tools Only in /etc/rc5.d/: S03vmware-tools Only in /etc/rc5.d/: S10network Only in /etc/rc5.d/: S57vmware-tools-thinprint 2. cmp \u00b6 cmp [ OPTION ] ... FILE1 [ FILE2 [SKIP1 [SKIP2 ] ]] Compare two files byte by byte . The optional SKIP1 and SKIP2 specify the number of bytes to skip at the beginning of each file ( zero by default ). - b , --print-bytes print differing bytes - l , --verbose output byte numbers and differing byte values\u3002\u4f1a\u8f93\u51fa\u6240\u6709\u7684\u4e0d\u540c\uff0c\u9ed8\u8ba4\u53ea\u4f1a\u8f93\u51fa\u7b2c\u4e00\u5904\u4e0d\u540c\u3002 - n , --bytes=LIMIT compare at most LIMIT bytes - s , --quiet, --silent suppress all normal output # \u67d0\u4e2a\u6587\u4ef6\u5168\u90e8\u8bfb\u53d6\u5b8c\u6bd5\u5c31\u4e0d\u4f1a\u518d\u7ee7\u7eed\u6bd4\u8f83\u4e86 [ sink@dev vitest ] $ cmp -b -l .gitignore-Windows .gitignore-linux 12 15 ^M 12 ^J 13 12 ^J 165 u 14 165 u 143 c 15 143 c 150 h 16 150 h 153 k 17 153 k 166 v 18 166 v 153 k 19 153 k 56 . 20 56 . 160 p 21 160 p 151 i 22 151 i 146 f 23 146 f 12 ^J cmp: EOF on .gitignore-linux 3. patch \u00b6 patch [ OPTION ] ... [ ORIGFILE [PATCHFILE ] ] Input options : - p NUM --strip=NUM Strip NUM leading components from file names.\u4ece\u8865\u4e01\u6587\u4ef6\u4e2d\u5220\u9664 NUM \u7ea7\u76ee\u5f55\uff08\u6839\u636e\u5236\u4f5c\u8865\u4e01\u6587\u4ef6\u65f6\u7684\u76ee\u5f55\u51b3\u5b9a\uff09 - R --reverse Assume patches were created with old and new files swapped.\u8fd8\u539f \u66f4\u65b0 \uff1a patch - p NUM < patch_file \u8fd8\u539f \uff1a patch - R - p NUM < patch_file [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm old file. ----- I' m new file. # \u5236\u4f5c\u8865\u4e01\u6587\u4ef6 [ sink@dev vitest ] $ diff -uar old new > test.patch # \u66f4\u65b0\u65e7\u6587\u4ef6 [ sink@dev vitest ] $ patch -p0 < test.patch patching file old [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm new file. ----- I' m new file. # \u6062\u590d\u65e7\u6587\u4ef6 [ sink@dev vitest ] $ patch -R -p0 < test.patch patching file old [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm old file. ----- I' m new file.","title":"\u6587\u4ef6\u5bf9\u6bd4"},{"location":"\u547d\u4ee4/\u6587\u4ef6\u5bf9\u6bd4/#1-diff","text":"diff [OPTION]... FILES Compare FILES line by line. FILES are 'FILE1 FILE2' or 'DIR1 DIR2' or 'DIR FILE...' or 'FILE... DIR'. OPTION -s, --report-identical-files report when two files are the same -i, --ignore-case ignore case differences in file contents -B, --ignore-blank-lines ignore changes where lines are all blank -c, -C NUM, --context[=NUM] \u5bf9\u6240\u6709\u6587\u4ef6\u5728\u4e0d\u540c\u5904\u90fd\u8f93\u51fa\u4e00\u81f4\u7684 NUM (default 3) \u884c -u, -U NUM, --unified[=NUM] \u5728\u4e0d\u540c\u5904\u7684\u4e0a\u4e0b\u6587\u8f93\u51fa\u4e00\u81f4\u7684 NUM (default 3) \u884c -N, --new-file treat absent files as empty -a, --text treat all files as text --binary Read and write data in binary mode. -r, --recursive recursively compare any subdirectories found [ sink@dev vitest ] $ diff man_db.conf.bak man.test.conf # 25\u8868\u793a\u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u884c\u53f7\uff0cc\u8868\u793a\u5de6\u8fb9\u7b2c25\u884c\u88ab\u53f3\u8fb925\u884c\u53d6\u4ee3\u4e86\uff0c\u7b2c\u4e8c\u4e2a25\u8868\u793a\u7b2c\u4e8c\u4e2a\u6587\u4ef6\u7684\u884c\u53f7 # d\u8868\u793a\u5220\u9664 25c25 < tree holds man pages for what binary directory. --- > # ie. what man tree holds man pages for what binary directory. # \u8f93\u51fa\u4e24\u884c\u4e0a\u4e0b\u6587 [ sink@dev vitest ] $ diff -C 2 man_db.conf.bak man.test.conf *** man_db.conf.bak 2019 -10-10 14 :45:12.640893299 +0800 --- man.test.conf 2019 -10-08 09 :51:29.652930093 +0800 *************** *** 23 ,27 **** #--------------------------------------------------------- # set up PATH to MANPATH mapping ! tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* --- 23 ,27 ---- #--------------------------------------------------------- # set up PATH to MANPATH mapping ! # ie. what man tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* # \u7c7b\u4f3cgit\u7684\u5f62\u5f0f\u8f93\u51fa [ sink@dev vitest ] $ diff -u man_db.conf.bak man.test.conf --- man_db.conf.bak 2019 -10-10 14 :45:12.640893299 +0800 +++ man.test.conf 2019 -10-08 09 :51:29.652930093 +0800 @@ -22,7 +22,7 @@ MANDATORY_MANPATH /usr/local/share/man #--------------------------------------------------------- # set up PATH to MANPATH mapping -tree holds man pages for what binary directory. +# ie. what man tree holds man pages for what binary directory. # # *PATH* -> *MANPATH* # # \u6bd4\u8f83\u6587\u4ef6\u5939 [ sink@dev vitest ] $ diff /etc/rc0.d/ /etc/rc5.d/ Only in /etc/rc0.d/: K43vmware-tools-thinprint Only in /etc/rc0.d/: K90network Only in /etc/rc0.d/: K99vmware-tools Only in /etc/rc5.d/: S03vmware-tools Only in /etc/rc5.d/: S10network Only in /etc/rc5.d/: S57vmware-tools-thinprint","title":"1. diff"},{"location":"\u547d\u4ee4/\u6587\u4ef6\u5bf9\u6bd4/#2-cmp","text":"cmp [ OPTION ] ... FILE1 [ FILE2 [SKIP1 [SKIP2 ] ]] Compare two files byte by byte . The optional SKIP1 and SKIP2 specify the number of bytes to skip at the beginning of each file ( zero by default ). - b , --print-bytes print differing bytes - l , --verbose output byte numbers and differing byte values\u3002\u4f1a\u8f93\u51fa\u6240\u6709\u7684\u4e0d\u540c\uff0c\u9ed8\u8ba4\u53ea\u4f1a\u8f93\u51fa\u7b2c\u4e00\u5904\u4e0d\u540c\u3002 - n , --bytes=LIMIT compare at most LIMIT bytes - s , --quiet, --silent suppress all normal output # \u67d0\u4e2a\u6587\u4ef6\u5168\u90e8\u8bfb\u53d6\u5b8c\u6bd5\u5c31\u4e0d\u4f1a\u518d\u7ee7\u7eed\u6bd4\u8f83\u4e86 [ sink@dev vitest ] $ cmp -b -l .gitignore-Windows .gitignore-linux 12 15 ^M 12 ^J 13 12 ^J 165 u 14 165 u 143 c 15 143 c 150 h 16 150 h 153 k 17 153 k 166 v 18 166 v 153 k 19 153 k 56 . 20 56 . 160 p 21 160 p 151 i 22 151 i 146 f 23 146 f 12 ^J cmp: EOF on .gitignore-linux","title":"2. cmp"},{"location":"\u547d\u4ee4/\u6587\u4ef6\u5bf9\u6bd4/#3-patch","text":"patch [ OPTION ] ... [ ORIGFILE [PATCHFILE ] ] Input options : - p NUM --strip=NUM Strip NUM leading components from file names.\u4ece\u8865\u4e01\u6587\u4ef6\u4e2d\u5220\u9664 NUM \u7ea7\u76ee\u5f55\uff08\u6839\u636e\u5236\u4f5c\u8865\u4e01\u6587\u4ef6\u65f6\u7684\u76ee\u5f55\u51b3\u5b9a\uff09 - R --reverse Assume patches were created with old and new files swapped.\u8fd8\u539f \u66f4\u65b0 \uff1a patch - p NUM < patch_file \u8fd8\u539f \uff1a patch - R - p NUM < patch_file [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm old file. ----- I' m new file. # \u5236\u4f5c\u8865\u4e01\u6587\u4ef6 [ sink@dev vitest ] $ diff -uar old new > test.patch # \u66f4\u65b0\u65e7\u6587\u4ef6 [ sink@dev vitest ] $ patch -p0 < test.patch patching file old [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm new file. ----- I' m new file. # \u6062\u590d\u65e7\u6587\u4ef6 [ sink@dev vitest ] $ patch -R -p0 < test.patch patching file old [ sink@dev vitest ] $ cat old ; echo '-----' ; cat new I 'm old file. ----- I' m new file.","title":"3. patch"},{"location":"\u547d\u4ee4/\u663e\u793a\u6587\u4ef6\u5939\u5927\u5c0f/","text":"du -h --max-depth = 1 . \u663e\u793a\u7279\u5b9a\u6587\u4ef6\u5939\u7684\u5927\u5c0f\uff1a du -sh xxx","title":"\u663e\u793a\u6587\u4ef6\u5939\u5927\u5c0f"},{"location":"\u547d\u4ee4/\u66f4\u65b0\u3001\u7981\u7528yum\u4ed3\u5e93\u3001\u53ea\u4e0b\u8f7drpm/","text":"\u66f4\u65b0 createrepo --update-md-path = /home/pub/vms-sec/rpm/ /home/pub/vms-sec/rpm/ \u7981\u7528\u3001\u5f00\u542f yum-config-manager --disable base epel epel/x86_64/metalink extras updates yum-config-manager --enable base epel epel/x86_64/metalink extras updates \u53ea\u4e0b\u8f7d\u4e0d\u5b89\u88c5rpm yum install --downloadonly --downloaddir = /tmp <package-name> # \u9700\u8981\u5148\u5b89\u88c5yum-utils yumdownloader --resolve --downloadonly --downloaddir = /tmp <package-name> \u67e5\u770b\u4ed3\u5e93\u4e0b\u6240\u6709\u7684rpm # \u5217\u51fa\u6240\u6709\u4ed3\u5e93\u7684rpm yum list # \u5217\u51fa\u67d0\u4e00\u4ed3\u5e93\u7684rpm yum repo-pkgs <repo-name> list","title":"\u66f4\u65b0\u3001\u7981\u7528yum\u4ed3\u5e93\u3001\u53ea\u4e0b\u8f7drpm"},{"location":"\u547d\u4ee4/\u6dfb\u52a0\u516c\u94a5/","text":"\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u9762\u5220\u9664\u6e90\u4e3b\u673a\u7684\u516c\u94a5\uff1a vi authorized_keys \u5728\u6e90\u4e3b\u673a\u4e0a\u9762\u53d1\u9001\u516c\u94a5\u5230\u76ee\u6807\u4e3b\u673a\uff1a ssh-copy-id -i ~/.ssh/id_rsa.pub <username>@<target-ip>","title":"\u6dfb\u52a0\u516c\u94a5"},{"location":"\u5947\u6280\u6deb\u5de7/\u4f4d\u8fd0\u7b97/","text":"1. \u5224\u65ad\u5947\u5076 2. \u4e24\u6570\u4ea4\u6362 3. 2\u7684n\u6b21\u65b9 4. \u627e\u51fa\u4e0d\u5927\u4e8eN\u7684\u6700\u5927\u76842\u7684\u5e42\u6307\u6570 1. \u5224\u65ad\u5947\u5076 \u00b6 if (( n & 1 ) == 1 ){ // n \u662f\u4e2a\u5947\u6570\u3002 } \u53ea\u9700\u8981\u5224\u65adn\u7684\u4e8c\u8fdb\u5236\u7684\u6700\u540e\u4e00\u4f4d\u5373\u53ef\u3002 2. \u4e24\u6570\u4ea4\u6362 \u00b6 x = x ^ y //\uff081\uff09 y = x ^ y //\uff082\uff09 x = x ^ y //\uff083\uff09 \u4e0d\u4f7f\u7528\u8f85\u52a9\u53d8\u91cf\u5b8c\u6210\u4ea4\u6362\u3002 \u4e24\u4e2a\u76f8\u540c\u7684\u6570\u5f02\u6216\u4e4b\u540e\u662f0\uff1an ^ n = 0 \u4efb\u4f55\u6570\u4e0e0\u5f02\u6216\u7b49\u4e8e\u5176\u672c\u8eab\uff1an ^ 0 = n \u5f02\u6216\u8fd0\u7b97\u652f\u6301\u8fd0\u7b97\u7684 \u4ea4\u6362\u5f8b\u548c\u7ed3\u5408\u5f8b \u63a8\u5bfc\uff1a \u628a\uff081\uff09\u4e2d\u7684 x \u5e26\u5165 \uff082\uff09\u4e2d\u7684 x\uff0c\u6709 y = x^y = (x^y)^y = x^(y^y) = x^0 = x\u3002 x \u7684\u503c\u6210\u529f\u8d4b\u7ed9\u4e86 y\u3002 \u5bf9\u4e8e\uff083\uff09,\u63a8\u5bfc\u5982\u4e0b\uff1a x = x^y = (x^y)^x = (x^x)^y = 0^y = y\u3002 3. 2\u7684n\u6b21\u65b9 \u00b6 int pow ( int n ){ int sum = 1 ; int tmp = 2 ; //\u5b58\u50a8\u4e0b\u4e00\u4f4d\u76842\u7684\u6b21\u65b9\u6570 while ( n != 0 ){ if (( n & 1 ) == 1 ){ sum *= tmp ; } tmp *= tmp ; n = n >> 1 ; } return sum ; } \u4f8b\u5982 n = 13\uff0c\u5219 n \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e3a 1101, \u90a3\u4e48 2 \u7684 13 \u6b21\u65b9\u53ef\u4ee5\u62c6\u89e3\u4e3a: 2 1101 = 2 0001 * 2 0100 * 2 1000 \u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 & 1\u548c >>1 \u6765\u9010\u4f4d\u8bfb\u53d6 1101\uff0c\u4e3a1\u65f6\u5c06\u8be5\u4f4d\u4ee3\u8868\u7684\u4e58\u6570\u7d2f\u4e58\u5230\u6700\u7ec8\u7ed3\u679c\u3002 4. \u627e\u51fa\u4e0d\u5927\u4e8eN\u7684\u6700\u5927\u76842\u7684\u5e42\u6307\u6570 \u00b6 int findN ( int n ){ n |= n >> 1 ; n |= n >> 2 ; n |= n >> 4 ; n |= n >> 8 ; n |= n >> 16 ; // return (n + 1) >> 1; return ( n >> 1 ) + 1 ; } \u628a\u4e8c\u8fdb\u5236\u4e2d \u6700\u5de6\u8fb9\u7684 1 \u4fdd\u7559\uff0c\u540e\u9762\u7684 1 \u5168\u90e8\u53d8\u4e3a 0 \uff0c\u6b64\u6570\u5373\u662f\u4e0d\u5927\u4e8eN\u7684\u6700\u5927\u76842\u7684\u5e42\u6307\u6570\u3002 \u63a8\u5bfc\uff1a \u627e\u5230\u6700\u5de6\u8fb9\u7684 1\uff0c\u7136\u540e\u628a\u5b83\u53f3\u8fb9\u7684\u6240\u6709 0 \u53d8\u6210 1 \u53f3\u79fb\u4e00\u4f4d\u518d\u52a0 1 \u5373\u53ef\u5f97\u5230","title":"\u4f4d\u8fd0\u7b97"},{"location":"\u5947\u6280\u6deb\u5de7/\u4f4d\u8fd0\u7b97/#1","text":"if (( n & 1 ) == 1 ){ // n \u662f\u4e2a\u5947\u6570\u3002 } \u53ea\u9700\u8981\u5224\u65adn\u7684\u4e8c\u8fdb\u5236\u7684\u6700\u540e\u4e00\u4f4d\u5373\u53ef\u3002","title":"1. \u5224\u65ad\u5947\u5076"},{"location":"\u5947\u6280\u6deb\u5de7/\u4f4d\u8fd0\u7b97/#2","text":"x = x ^ y //\uff081\uff09 y = x ^ y //\uff082\uff09 x = x ^ y //\uff083\uff09 \u4e0d\u4f7f\u7528\u8f85\u52a9\u53d8\u91cf\u5b8c\u6210\u4ea4\u6362\u3002 \u4e24\u4e2a\u76f8\u540c\u7684\u6570\u5f02\u6216\u4e4b\u540e\u662f0\uff1an ^ n = 0 \u4efb\u4f55\u6570\u4e0e0\u5f02\u6216\u7b49\u4e8e\u5176\u672c\u8eab\uff1an ^ 0 = n \u5f02\u6216\u8fd0\u7b97\u652f\u6301\u8fd0\u7b97\u7684 \u4ea4\u6362\u5f8b\u548c\u7ed3\u5408\u5f8b \u63a8\u5bfc\uff1a \u628a\uff081\uff09\u4e2d\u7684 x \u5e26\u5165 \uff082\uff09\u4e2d\u7684 x\uff0c\u6709 y = x^y = (x^y)^y = x^(y^y) = x^0 = x\u3002 x \u7684\u503c\u6210\u529f\u8d4b\u7ed9\u4e86 y\u3002 \u5bf9\u4e8e\uff083\uff09,\u63a8\u5bfc\u5982\u4e0b\uff1a x = x^y = (x^y)^x = (x^x)^y = 0^y = y\u3002","title":"2. \u4e24\u6570\u4ea4\u6362"},{"location":"\u5947\u6280\u6deb\u5de7/\u4f4d\u8fd0\u7b97/#3-2n","text":"int pow ( int n ){ int sum = 1 ; int tmp = 2 ; //\u5b58\u50a8\u4e0b\u4e00\u4f4d\u76842\u7684\u6b21\u65b9\u6570 while ( n != 0 ){ if (( n & 1 ) == 1 ){ sum *= tmp ; } tmp *= tmp ; n = n >> 1 ; } return sum ; } \u4f8b\u5982 n = 13\uff0c\u5219 n \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e3a 1101, \u90a3\u4e48 2 \u7684 13 \u6b21\u65b9\u53ef\u4ee5\u62c6\u89e3\u4e3a: 2 1101 = 2 0001 * 2 0100 * 2 1000 \u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 & 1\u548c >>1 \u6765\u9010\u4f4d\u8bfb\u53d6 1101\uff0c\u4e3a1\u65f6\u5c06\u8be5\u4f4d\u4ee3\u8868\u7684\u4e58\u6570\u7d2f\u4e58\u5230\u6700\u7ec8\u7ed3\u679c\u3002","title":"3. 2\u7684n\u6b21\u65b9"},{"location":"\u5947\u6280\u6deb\u5de7/\u4f4d\u8fd0\u7b97/#4-n2","text":"int findN ( int n ){ n |= n >> 1 ; n |= n >> 2 ; n |= n >> 4 ; n |= n >> 8 ; n |= n >> 16 ; // return (n + 1) >> 1; return ( n >> 1 ) + 1 ; } \u628a\u4e8c\u8fdb\u5236\u4e2d \u6700\u5de6\u8fb9\u7684 1 \u4fdd\u7559\uff0c\u540e\u9762\u7684 1 \u5168\u90e8\u53d8\u4e3a 0 \uff0c\u6b64\u6570\u5373\u662f\u4e0d\u5927\u4e8eN\u7684\u6700\u5927\u76842\u7684\u5e42\u6307\u6570\u3002 \u63a8\u5bfc\uff1a \u627e\u5230\u6700\u5de6\u8fb9\u7684 1\uff0c\u7136\u540e\u628a\u5b83\u53f3\u8fb9\u7684\u6240\u6709 0 \u53d8\u6210 1 \u53f3\u79fb\u4e00\u4f4d\u518d\u52a0 1 \u5373\u53ef\u5f97\u5230","title":"4. \u627e\u51fa\u4e0d\u5927\u4e8eN\u7684\u6700\u5927\u76842\u7684\u5e42\u6307\u6570"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/","text":"1. \u7b56\u7565\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u7b97\u6cd5\u65cf\uff0c\u5206\u522b\u5c01\u88c5\u8d77\u6765\uff0c\u8ba9\u4ed6\u4eec\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\uff0c\u6b64\u6a21\u5f0f\u8ba9\u7b97\u6cd5\u7684\u53d8\u6362\u72ec\u7acb\u4e8e\u4f7f\u7528\u7b97\u6cd5\u7684\u5ba2\u6237\u3002 \u5c06\u53ef\u4ee5\u4e92\u6362\u7684\u884c\u4e3a\u5c01\u88c5\u8d77\u6765\uff0c\u7136\u540e\u4f7f\u7528\u59d4\u6258\u7684\u65b9\u6cd5\uff0c\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u4e2a\u884c\u4e3a\u3002 2. \u89c2\u5bdf\u8005\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u5bf9\u8c61\u4e4b\u95f4\u4e00\u5bf9\u591a\u4f9d\u8d56\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u6539\u53d8\u72b6\u6001\u65f6\uff0c\u5b83\u7684\u6240\u6709\u4f9d\u8d56\u8005\u90fd\u4f1a\u53d7\u5230\u901a\u77e5\u5e76\u81ea\u52a8\u66f4\u65b0\u3002 java\u5185\u7f6e\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\uff1aObserver\uff08\u89c2\u5bdf\u8005\uff09\u4e0eObservable\uff08\u89c2\u5bdf\u5bf9\u8c61\uff09\uff0csetChanges()\uff0cnotifyObservers()\uff08\u62c9\u53d6\uff09\uff0cnotifyObservers(Object arg)\uff08\u63a8\u9001\uff09\u3002 3. \u88c5\u9970\u8005\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u52a8\u6001\u5730\u5c06\u8d23\u4efb\u9644\u52a0\u5230\u5bf9\u8c61\u4e0a\u3002\u82e5\u8981\u6269\u5c55\u529f\u80fd\uff0c\u88c5\u9970\u8005\u63d0\u4f9b\u4e86\u6bd4\u7ee7\u627f\u66f4\u5177\u6709\u5f39\u6027\u7684\u66ff\u4ee3\u65b9\u6848\u3002 \u88c5\u9970\u8005\u4e0e\u88ab\u88c5\u9970\u8005\u6709\u76f8\u540c\u7684\u8d85\u7c7b\u578b\uff0c\u4ee5\u6b64\u8fbe\u5230 \u7c7b\u578b\u5339\u914d \uff0c\u800c\u4e0d\u662f\u5229\u7528\u7ee7\u627f\u83b7\u5f97\u884c\u4e3a\u3002 \u88c5\u9970\u8005\u53ef\u4ee5\u5728\u6240\u59d4\u6258\u88ab\u88c5\u9970\u8005\u7684\u884c\u4e3a\u4e4b\u524d\u6216\u4e4b\u540e\uff0c\u52a0\u4e0a\u81ea\u5df1\u7684\u884c\u4e3a\uff0c\u5df2\u8fbe\u5230\u7279\u5b9a\u7684\u76ee\u7684\u3002 java.io\u5305 4. \u7b80\u5355\u5de5\u5382\u3001\u5de5\u5382\u65b9\u6cd5\u4e0e\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f \u00b6 \u7b80\u5355\u5de5\u5382 \uff1a\u4f7f\u7528\u53e6\u4e00\u4e2a\u5bf9\u8c61\u6765\u4f5c\u4e3a\u521b\u5efa\u5bf9\u8c61\u7684\u5de5\u5382\u3002 \u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u4e00\u4e2a\u521b\u5efa\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u4f46\u7531\u5b50\u7c7b\u51b3\u5b9a\u8981\u5b9e\u4f8b\u5316\u7684\u7c7b\u662f\u54ea\u4e00\u4e2a\u3002\u5de5\u5382\u65b9\u6cd5\u8ba9\u7c7b\u628a\u5b9e\u4f8b\u5316\u63a8\u8fdf\u5230\u5b50\u7c7b\u3002 \u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u4e8e\u521b\u5efa\u76f8\u5173\u6216\u4f9d\u8d56\u5bf9\u8c61\u7684\u5bb6\u65cf\uff0c\u800c\u4e0d\u9700\u8981\u660e\u786e\u6307\u5b9a\u5177\u4f53\u7c7b\u3002 \u7b80\u5355\u5de5\u5382\u4e0e\u5de5\u5382\u65b9\u6cd5\u4e4b\u95f4\u7684\u5dee\u5f02\uff1a \u7b80\u5355\u5de5\u5382\u5728\u4e00\u4e2a\u5730\u65b9\u628a\u6240\u6709\u4e1c\u897f\u90fd\u505a\u5b8c\u4e86\uff1b\u5de5\u5382\u65b9\u6cd5\u5374\u521b\u5efa\u4e00\u4e2a\u6846\u67b6\uff0c\u8ba9\u5b50\u7c7b\u51b3\u5b9a\u8981\u5982\u4f55\u5b9e\u73b0\u3002 \u5de5\u5382\u65b9\u6cd5\u4e0e\u62bd\u8c61\u5de5\u5382\u4e4b\u95f4\u7684\u5dee\u5f02\uff1a \u5de5\u5382\u65b9\u6cd5 \u62bd\u8c61\u5de5\u5382 \u4f7f\u7528\u7ee7\u627f\u521b\u5efa\u5bf9\u8c61 \u4f7f\u7528\u5bf9\u8c61\u7684\u7ec4\u5408\u521b\u5efa\u5bf9\u8c61 \u901a\u8fc7\u5b50\u7c7b\u521b\u5efa\u5bf9\u8c61\uff0c\u7531\u5b50\u7c7b\u8d1f\u8d23\u51b3\u5b9a\u5177\u4f53\u7684\u7c7b\u578b\uff1b\u628a\u5ba2\u6237\u4ee3\u7801\u4ece\u9700\u8981\u5b9e\u4f8b\u5316\u7684\u5177\u4f53\u7c7b\u4e2d\u89e3\u8026 \u63d0\u4f9b\u4e00\u4e2a\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u4ea7\u54c1\u5bb6\u65cf\u7684\u62bd\u8c61\u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u7684\u5b50\u7c7b\u5b9a\u4e49\u4e86\u4ea7\u54c1\u88ab\u4ea7\u751f\u7684\u65b9\u6cd5 \u53ea\u521b\u5efa\u4e00\u4e2a\u4ea7\u54c1 \u53ef\u4ee5\u5c06\u4e00\u7fa4\u76f8\u5173\u7684\u4ea7\u54c1\u7ec4\u5408\u8d77\u6765\uff1b\u52a0\u5165\u65b0\u4ea7\u54c1\u5c31\u5fc5\u987b\u6539\u53d8\u63a5\u53e3 \u62bd\u8c61\u5de5\u5382\u7684\u65b9\u6cd5\u7ecf\u5e38\u4ee5\u5de5\u5382\u65b9\u6cd5\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002 5. \u5355\u4f8b\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u5168\u5c40\u8bbf\u95ee\u70b9\u3002 \u89e3\u51b3\u7ebf\u7a0b\u4e0d\u5b89\u5168\u95ee\u9898\uff1a1. \u4f7f\u7528synchronized\uff1b2. \u7c7b\u52a0\u8f7d\u65f6\u7acb\u5373\u5b9e\u4f8b\u5316\u5355\u4e2a\u5b9e\u4f8b\uff1b3. \u53cc\u91cd\u68c0\u67e5\u52a0\u9501\u3002 \u7a0b\u5e8f\u6709\u591a\u4e2a\u7c7b\u52a0\u8f7d\u5668\u65f6\uff0c\u9700\u8981\u81ea\u884c\u6307\u5b9a\u7c7b\u52a0\u8f7d\u5668\uff0c\u5e76\u6307\u5b9a\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u3002 6. \u547d\u4ee4\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5c06\u8bf7\u6c42\u5c01\u88c5\u6210\u5bf9\u8c61\uff0c\u8fd9\u53ef\u4ee5\u8ba9\u4f60\u4f7f\u7528\u4e0d\u540c\u7684\u8bf7\u6c42\u3001\u961f\u5217\u6216\u65e5\u5fd7\u8bf7\u6c42\u6765\u53c2\u6570\u5316\u5176\u5b83\u5bf9\u8c61\u3002\u652f\u6301\u64a4\u9500\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u53d1\u51fa\u8bf7\u6c42\u7684\u5bf9\u8c61\u548c\u6267\u884c\u8bf7\u6c42\u7684\u5bf9\u8c61\u89e3\u8026\u65f6\u4f7f\u7528\u6b64\u6a21\u5f0f\u3002\u4e24\u8005\u662f\u901a\u8fc7\u547d\u4ee4\u5bf9\u8c61\u6765\u6c9f\u901a\u7684\u3002 \u7a7a\u5bf9\u8c61\uff08null object\uff09\uff0c\u4e0d\u60f3\u5904\u7406null\u65f6\u53ef\u7528\u7a7a\u5bf9\u8c61\u4ee3\u66ff\uff0cdo nothing\u3002 client\uff0ccommand\uff0cconcreteCommand\uff0creceiver\uff0cinvoker \u5b8f\u547d\u4ee4 \u961f\u5217\uff0c\u65e5\u5fd7 7. \u9002\u914d\u5668\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\uff0c\u8f6c\u6362\u6210\u5ba2\u6237\u671f\u671b\u7684\u53e6\u4e00\u4e2a\u63a5\u53e3\u3002\u9002\u914d\u5668\u8ba9\u539f\u672c\u63a5\u53e3\u4e0d\u517c\u5bb9\u7684\u7c7b\u53ef\u4ee5\u5408\u4f5c\u65e0\u95f4\u3002 \u7c7b\u9002\u914d\u5668\uff0c\u5bf9\u8c61\u9002\u914d\u5668\uff0c\u53cc\u5411\u9002\u914d\u5668 \u6a21\u5f0f\u4e4b\u95f4\u7684\u533a\u522b\uff1a \u6a21\u5f0f \u76ee\u7684 \u88c5\u9970\u8005 \u4e0d\u6539\u53d8\u63a5\u53e3\uff0c\u4f46\u52a0\u5165\u8d23\u4efb \u9002\u914d\u5668 \u5c06\u63a5\u53e3\u8f6c\u53d8\u4e3a\u53e6\u4e00\u4e2a\u63a5\u53e3 \u5916\u89c2 \u8ba9\u63a5\u53e3\u66f4\u7b80\u5355 8. \u5916\u89c2\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u7528\u6765\u8bbf\u95ee\u5b50\u7cfb\u7edf\u4e2d\u7684\u4e00\u7fa4\u63a5\u53e3\u3002\u5916\u89c2\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9ad8\u5c42\u63a5\u53e3\uff0c\u8ba9\u5b50\u7cfb\u7edf\u66f4\u5bb9\u6613\u4f7f\u7528\u3002\u8ba9\u5ba2\u6237\u4e0e\u5b50\u7cfb\u7edf\u4e4b\u95f4\u907f\u514d\u7d27\u8026\u5408\u3002 9. \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5728\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u7b97\u6cd5\u7684\u9aa8\u67b6\uff0c\u800c\u5c06\u4e00\u4e9b\u6b65\u9aa4\u5ef6\u8fdf\u5230\u5b50\u7c7b\u4e2d\u3002\u6a21\u677f\u65b9\u6cd5\u4f7f\u5f97\u5b50\u7c7b\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8\u7b97\u6cd5\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u91cd\u65b0\u5b9a\u4e49\u7b97\u6cd5\u4e2d\u7684\u67d0\u4e9b\u6b65\u9aa4\u3002 \u4fdd\u6301\u597d\u62bd\u8c61\u65b9\u6cd5\u7684\u6570\u76ee\uff0c\u5728\u5b50\u7c7b\u5b9e\u73b0\u65b9\u6cd5\u7684\u6570\u76ee\u4e0e\u6b65\u9aa4\u6570\u91cf\u4e4b\u95f4\u6298\u4e2d\u3002 \u4e3a\u4e86\u9632\u6b62\u5b50\u7c7b\u6539\u53d8\u6a21\u677f\u65b9\u6cd5\u4e2d\u7684\u7b97\u6cd5\uff0c\u53ef\u4ee5\u5c06\u6a21\u677f\u65b9\u6cd5\u58f0\u660e\u4e3afinal\u3002 \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u4e0e\u7b56\u7565\u6a21\u5f0f\u90fd\u5c01\u88c5\u7b97\u6cd5\uff0c\u524d\u8005\u7528\u7ee7\u627f\uff0c\u540e\u8005\u7528\u7ec4\u5408\u3002 \u5de5\u5382\u65b9\u6cd5\u65f6\u6a21\u677f\u65b9\u6cd5\u7684\u4e00\u79cd\u7279\u6b8a\u7248\u672c\u3002 \u94a9\u5b50\u7684\u51e0\u79cd\u7528\u6cd5\uff1a \u8ba9\u5b50\u7c7b\u5b9e\u73b0\u7b97\u6cd5\u4e2d\u7684\u53ef\u9009\u90e8\u5206 \u5728\u94a9\u5b50\u5bf9\u4e8e\u5b50\u7c7b\u7684\u5b9e\u73b0\u6b65\u91cd\u8981\u7684\u65f6\u5019\uff0c\u5b50\u7c7b\u53ef\u5bf9\u94a9\u5b50\u7f6e\u4e4b\u4e0d\u7406 \u8ba9\u5b50\u7c7b\u80fd\u591f\u6709\u673a\u4f1a\u5bf9\u6a21\u677f\u65b9\u6cd5\u4e2d\u67d0\u4e9b\u5373\u5c06\u53d1\u751f\uff08\u6216\u521a\u53d1\u751f\uff09\u7684\u6b65\u9aa4\u505a\u51fa\u53cd\u5e94 10. \u8fed\u4ee3\u5668\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u987a\u5e8f\u8bbf\u95ee\u4e00\u4e2a\u805a\u5408\u5bf9\u8c61\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\uff0c\u800c\u53c8\u4e0d\u66b4\u9732\u5176\u5185\u90e8\u7684\u8868\u793a\u3002 \u628a\u904d\u5386\u7684\u4efb\u52a1\u653e\u5728\u8fed\u4ee3\u5668\u4e0a\uff0c\u800c\u4e0d\u662f\u805a\u5408\u4e0a\u3002\u7b80\u5316\u4e86\u805a\u5408\u7684\u63a5\u53e3\u548c\u5b9e\u73b0\uff0c\u4e5f\u8ba9\u8d23\u4efb\u5404\u5f97\u5176\u6240\u3002 \u8fed\u4ee3\u5668\u610f\u5473\u7740\u65e0\u5e8f\u7684\u3002 \u8fed\u4ee3\u5668\u5c06\u904d\u5386\u805a\u5408\u7684\u5de5\u4f5c\u5c01\u88c5\u8fdb\u4e00\u4e2a\u5bf9\u8c61\u4e2d\u3002 11. \u7ec4\u5408\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5141\u8bb8\u4f60\u5c06\u5bf9\u8c61\u7ec4\u5408\u6210 \u6811\u5f62\u7ed3\u6784 \u6765\u8868\u73b0 \u6574\u4f53/\u90e8\u5206 \u5c42\u6b21\u7ed3\u6784\u3002\u7ec4\u5408\u80fd\u8ba9\u5ba2\u6237\u4ee5\u4e00\u81f4\u7684\u65b9\u5f0f\u5904\u7406\u4e2a\u522b\u5bf9\u8c61\u53ca\u5bf9\u8c61\u7ec4\u5408\u3002 \u80fd\u628a\u76f8\u540c\u7684\u64cd\u4f5c\u5e94\u7528\u5728\u7ec4\u5408\u548c\u4e2a\u522b\u7684\u5bf9\u8c61\u4e0a\u3002 \u5728\u5b9e\u73b0\u8be5\u6a21\u5f0f\u65f6\uff0c\u6709\u5f88\u591a\u8bbe\u8ba1\u4e0a\u7684\u6298\u4e2d\u3002\u8981\u6839\u636e\u9700\u6c42\u5e73\u8861\u900f\u660e\u6027\u548c\u5b89\u5168\u6027\u3002 12. \u72b6\u6001\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5141\u8bb8\u5bf9\u8c61\u5728\u5185\u90e8\u72b6\u6001\u6539\u53d8\u65f6\u6539\u53d8\u5b83\u7684\u884c\u4e3a\uff0c\u5bf9\u8c61\u770b\u8d77\u6765\u597d\u50cf\u4fee\u6539\u4e86\u5b83\u7684\u7c7b\u3002 \u5c01\u88c5\u57fa\u4e8e\u72b6\u6001\u7684\u884c\u4e3a\uff0c\u5e76\u5c06\u884c\u4e3a\u59d4\u6258\u5230\u5f53\u524d\u72b6\u6001\u3002 \u72b6\u6001\u8f6c\u6362\u53ef\u4ee5\u7531state\u7c7b\u6216context\u7c7b\u63a7\u5236\u3002 \u5982\u679c\u6709\u591a\u4e2acontext\u5b9e\u4f8b\uff0c\u5c31\u9700\u8981\u5c06\u72b6\u6001\u7684\u5b9e\u4f8b\u8f6c\u79fb\u5230\u9759\u6001\u7684\u5b9e\u4f8b\u53d8\u91cf\u4e2d\u5171\u4eab\u3002 \u8be5\u6a21\u5f0f\u4f1a\u5bfc\u81f4\u8bbe\u8ba1\u4e2d\u7c7b\u7684\u6570\u91cf\u5927\u91cf\u589e\u52a0\u3002 13. \u4ee3\u7406\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u4e3a\u53e6\u4e00\u4e2a\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u66ff\u8eab\u6216\u5360\u4f4d\u7b26\u4ee5\u63a7\u5236\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u4f7f\u7528\u8be5\u6a21\u5f0f\u521b\u5efa\u4ee3\u8868\u5bf9\u8c61\uff0c\u8ba9\u4ee3\u8868\u5bf9\u8c61\u63a7\u5236\u67d0\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u63a7\u5236\u8bbf\u95ee\u65b9\u5f0f\uff1a \u8fdc\u7a0b\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\u8fdc\u7a0b\u5bf9\u8c61 \u865a\u62df\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\u521b\u5efa\u5f00\u9500\u5927\u7684\u8d44\u6e90 \u4fdd\u62a4\u4ee3\u7406\u57fa\u4e8e\u6743\u9650\u63a7\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee java\u5185\u7f6e\u7684\u4ee3\u7406\u652f\u6301\uff1ajava.lang.reflect \u52a8\u6001\u4ee3\u7406\u7684\u542b\u4e49\u662f\u5728\u8fd0\u884c\u65f6\u624d\u5c06\u5b83\u7684\u7c7b\u521b\u5efa\u51fa\u6765 \u53d8\u79cd\uff1a \u9632\u706b\u5899\u4ee3\u7406\uff0c\u63a7\u5236\u7f51\u7edc\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c\u4fdd\u62a4\u4e3b\u9898\u514d\u4e8e\u201c\u574f\u5ba2\u6237\u201d\u7684\u4fb5\u5bb3\u3002 \u667a\u80fd\u5f15\u7528\u4ee3\u7406\uff0c\u5f53\u4e3b\u9898\u88ab\u5f15\u7528\u65f6\uff0c\u8fdb\u884c\u989d\u5916\u7684\u52a8\u4f5c\uff0c\u4f8b\u5982\u8ba1\u7b97\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5f15\u7528\u7684\u6b21\u6570\u3002 \u7f13\u5b58\u4ee3\u7406\uff0c\u4e3a\u5f00\u9500\u5927\u7684\u8fd0\u7b97\u7ed3\u679c\u63d0\u4f9b\u6682\u65f6\u7684\u5b58\u50a8\u3002\u5b83\u4e5f\u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u5171\u4eab\u7ed3\u679c\uff0c\u4ee5\u51cf\u5c11\u8ba1\u7b97\u6216\u7f51\u7edc\u5ef6\u8fdf\u3002 \u540c\u6b65\u4ee3\u7406\uff0c\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u4e3a\u4e3b\u9898\u63d0\u4f9b\u5b89\u5168\u7684\u8bbf\u95ee\u3002 \u590d\u6742\u9690\u85cf\u4ee3\u7406\uff0c\u7528\u6765\u9690\u85cf\u4e00\u4e2a\u7c7b\u7684\u590d\u6742\u96c6\u5408\u7684\u590d\u6742\u5ea6\uff0c\u5e76\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u3002\u4e5f\u79f0\u5916\u89c2\u4ee3\u7406\u3002\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\uff0c\u800c\u5916\u89c2\u6a21\u5f0f\u53ea\u63d0\u4f9b\u53e6\u4e00\u7ec4\u63a5\u53e3\u3002 \u5199\u5165\u65f6\u590d\u5236\u4ee3\u7406\uff0c\u7528\u6765\u63a7\u5236\u5bf9\u8c61\u7684\u590d\u5236\uff0c\u65b9\u6cd5\u662f\u5ef6\u8fdf\u5bf9\u8c61\u7684\u590d\u5236\uff0c\u76f4\u5230\u5ba2\u6237\u771f\u7684\u9700\u8981\u4e3a\u6b62\u3002\u662f\u865a\u62df\u4ee3\u7406\u7684\u53d8\u4f53\u3002 14. \u590d\u5408\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u7ed3\u5408\u591a\u4e2a\u6a21\u5f0f\uff0c\u7ec4\u6210\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0c\u89e3\u51b3\u4e00\u518d\u53d1\u751f\u7684\u4e00\u822c\u6027\u95ee\u9898\u3002 15. \u751f\u6210\u5668\u6a21\u5f0f\uff08\u5efa\u9020\u8005\u6a21\u5f0f\uff09 \u00b6 \u5b9a\u4e49 \uff1a\u8bb2\u4e00\u4e2a\u590d\u6742\u7684\u5bf9\u8c61\u5730\u6784\u9020\u4e0e\u5b83\u7684\u8868\u793a\u5206\u79bb\uff0c\u4f7f\u540c\u6837\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u8868\u793a\u3002 \u5c06\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u5c01\u88c5\u8d77\u6765 \u5141\u8bb8\u5bf9\u8c61\u901a\u8fc7\u591a\u4e2a\u6b65\u9aa4\u6765\u521b\u5efa\uff0c\u5e76\u4e14\u53ef\u6539\u53d8\u8fc7\u7a0b\uff08\u5de5\u5382\u65b9\u6cd5\u53ea\u6709\u4e00\u4e2a\u6b65\u9aa4\uff09 \u7ed3\u6784\uff1a \u4ea7\u54c1\uff1a\u5305\u542b\u591a\u4e2a\u7ec4\u6210\u90e8\u4ef6\u7684\u590d\u5236\u5bf9\u8c61 \u62bd\u8c61\u5efa\u9020\u8005\uff1a\u5305\u542b\u521b\u5efa\u4ea7\u54c1\u5404\u4e2a\u90e8\u4ef6\u7684\u63a5\u53e3\uff0c\u5305\u542b\u8fd4\u56de\u4ea7\u54c1\u7684\u65b9\u6cd5 \u5177\u4f53\u5efa\u9020\u8005\uff1a\u5b9e\u73b0\u62bd\u8c61\u5efa\u9020\u8005\u7684\u63a5\u53e3 \u6307\u6325\u8005\uff1a\u8c03\u7528\u5efa\u9020\u8005\u7684\u90e8\u4ef6\u6784\u9020\u5e76\u88c5\u914d\uff0c\u5b8c\u6210\u4ea7\u54c1\u7684\u7ec4\u88c5 \u9002\u7528\u573a\u666f\uff1a \u521b\u5efa\u7684\u5bf9\u8c61\u8f83\u590d\u6742\uff0c\u7531\u591a\u4e2a\u90e8\u4ef6\u6784\u6210\uff0c\u5404\u90e8\u4ef6\u9762\u4e34\u7740\u590d\u6742\u7684\u53d8\u5316\uff0c\u4f46\u6784\u4ef6\u95f4\u7684\u5efa\u9020\u987a\u5e8f\u662f\u7a33\u5b9a\u7684\u3002 \u521b\u5efa\u590d\u6742\u5bf9\u8c61\u7684\u7b97\u6cd5\u72ec\u7acb\u4e8e\u8be5\u5bf9\u8c61\u7684\u7ec4\u6210\u90e8\u5206\u4ee5\u53ca\u5b83\u4eec\u7684\u88c5\u914d\u65b9\u5f0f\uff0c\u5373\u4ea7\u54c1\u7684\u6784\u5efa\u8fc7\u7a0b\u548c\u6700\u7ec8\u7684\u8868\u793a\u662f\u72ec\u7acb\u7684\u3002 \u53ef\u4ee5\u6839\u636e\u9700\u8981\u7701\u7565\u6389\u62bd\u8c61\u5efa\u9020\u8005\u3001\u6307\u6325\u8005 16. \u6865\u63a5\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5c06\u62bd\u8c61\u4e0e\u5b9e\u73b0\u5206\u79bb\uff0c\u4f7f\u5b83\u4eec\u53ef\u4ee5\u72ec\u7acb\u53d8\u5316\u3002 \u5c06\u62bd\u8c61\u5316\u90e8\u5206\u4e0e\u5b9e\u73b0\u5316\u90e8\u5206\u5206\u5f00\uff0c\u53d6\u6d88\u4e8c\u8005\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u6539\u7528\u7ec4\u5408\u5173\u7cfb 17. \u8d23\u4efb\u94fe\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u4e3a\u4e86\u907f\u514d\u8bf7\u6c42\u53d1\u9001\u8005\u4e0e\u591a\u4e2a\u8bf7\u6c42\u5904\u7406\u8005\u7684\u8026\u5408\uff0c\u5c06\u6240\u6709\u8bf7\u6c42\u7684\u5904\u7406\u8005\u901a\u8fc7\u524d\u4e00\u5bf9\u8c61\u8bb0\u4f4f\u5176\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u800c\u8fde\u6210\u4e00\u6761\u94fe\uff1b\u5f53\u6709\u8bf7\u6c42\u53d1\u751f\u65f6\uff0c\u53ef\u5c06\u8bf7\u6c42\u6cbf\u7740\u8fd9\u6761\u94fe\u4f20\u9012\uff0c\u76f4\u5230\u6709\u5bf9\u8c61\u5904\u7406\u5b83\u4e3a\u6b62\uff0c\u6216\u4e0d\u5904\u7406\u3002 \u5c06\u8bf7\u6c42\u7684\u53d1\u9001\u8005\u4e0e\u63a5\u53d7\u8005\u89e3\u8026 \u901a\u8fc7\u6539\u53d8\u94fe\u5185\u7684\u6210\u5458\u6216\u8c03\u52a8\u4ed6\u4eec\u7684\u987a\u5e8f\uff0c\u5141\u8bb8\u52a8\u6001\u5730\u65b0\u589e\u6216\u5220\u9664\u63a5\u53d7\u8005 \u6bcf\u4e2a\u7c7b\u90fd\u8d1f\u8d23\u81ea\u5df1\u7684\u5de5\u4f5c\uff0c\u7b26\u5408\u7c7b\u7684\u5355\u4e00\u804c\u8d23\u539f\u5219 \u6ee1\u8db3\u5f00\u95ed\u539f\u5219 18. \u4eab\u5143\u6a21\u5f0f\uff08\u8747\u91cf\u6a21\u5f0f\uff09 \u00b6 \u5b9a\u4e49 \uff1a\u5229\u7528\u5171\u4eab\u6280\u672f\u6765\u6709\u6548\u5730\u652f\u6301\u5927\u91cf\u7ec6\u7c92\u5ea6\u5bf9\u8c61\u7684\u590d\u7528\u3002\u5b83\u901a\u8fc7\u5171\u4eab\u5df2\u7ecf\u5b58\u5728\u7684\u5bf9\u8c61\u6765\u5927\u5e45\u5ea6\u51cf\u5c11\u9700\u8981\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u91cf\u3001\u907f\u514d\u5927\u91cf\u76f8\u4f3c\u7c7b\u7684\u5f00\u9500\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u8d44\u6e90\u7684\u5229\u7528\u7387\u3002 \u51cf\u5c11\u8fd0\u884c\u65f6\u5bf9\u8c61\u7684\u5b9e\u4f8b\u4e2a\u6570\uff0c\u8282\u7701\u5185\u5b58 \u5c06\u8bb8\u591a\u865a\u62df\u5bf9\u8c61\u7684\u72b6\u6001\u96c6\u4e2d\u7ba1\u7406 \u9700\u8981\u5c06\u4e0d\u80fd\u5171\u4eab\u7684\u72b6\u6001\u5916\u90e8\u5316 \u5355\u4e2a\u903b\u8f91\u5b9e\u4f8b\u5c06\u65e0\u6cd5\u62e5\u6709\u72ec\u7acb\u800c\u4e0d\u540c\u7684\u884c\u4e3a \u4e24\u79cd\u72b6\u6001\uff1a \u5185\u90e8\u72b6\u6001\uff1a\u4e0d\u4f1a\u968f\u7740\u73af\u5883\u53d8\u5316\u800c\u53d1\u751f\u53d8\u5316\u7684\u53ef\u5171\u4eab\u90e8\u5206 \u5916\u90e8\u72b6\u6001\uff1a\u4f1a\u56e0\u73af\u5883\u7684\u6539\u53d8\u800c\u53d1\u751f\u53d8\u5316\u7684\u53ef\u53d8\u90e8\u5206 \u5355\u7eaf\u4eab\u5143\u6a21\u5f0f\uff0c\u8fd9\u79cd\u4eab\u5143\u6a21\u5f0f\u4e2d\u7684\u6240\u6709\u7684\u5177\u4f53\u4eab\u5143\u7c7b\u90fd\u662f\u53ef\u4ee5\u5171\u4eab\u7684\uff0c\u4e0d\u5b58\u5728\u975e\u5171\u4eab\u7684\u5177\u4f53\u4eab\u5143\u7c7b \u590d\u5408\u4eab\u5143\u6a21\u5f0f\uff0c\u8fd9\u79cd\u4eab\u5143\u6a21\u5f0f\u4e2d\u7684\u6709\u4e9b\u4eab\u5143\u5bf9\u8c61\u662f\u7531\u4e00\u4e9b\u5355\u7eaf\u4eab\u5143\u5bf9\u8c61\u7ec4\u5408\u800c\u6210\u7684\uff0c\u5b83\u4eec\u5c31\u662f\u590d\u5408\u4eab\u5143\u5bf9\u8c61\u3002\u867d\u7136\u590d\u5408\u4eab\u5143\u5bf9\u8c61\u672c\u8eab\u4e0d\u80fd\u5171\u4eab\uff0c\u4f46\u5b83\u4eec\u53ef\u4ee5\u5206\u89e3\u6210\u5355\u7eaf\u4eab\u5143\u5bf9\u8c61\u518d\u88ab\u5171\u4eab\u3002 ---------------------------------------\u4ee5\u4e0b\u6a21\u5f0f\u672a\u8be6\u7ec6\u4e86\u89e3------------------------------------ 19. \u89e3\u91ca\u5668\u6a21\u5f0f \u00b6 20. \u4e2d\u4ecb\u8005\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e00\u4e2a\u4e2d\u4ecb\u5bf9\u8c61\u6765\u5c01\u88c5\u4e00\u7cfb\u5217\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u4f7f\u539f\u6709\u5bf9\u8c61\u677e\u8026\u5408\uff0c\u4e14\u53ef\u4ee5\u72ec\u7acb\u5730\u6539\u53d8\u5b83\u4eec\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002 \u8fea\u7c73\u7279\u6cd5\u5219\u7684\u5178\u578b\u5e94\u7528 \u964d\u4f4e\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u8026\u5408\u6027 \u5c06\u5bf9\u8c61\u4e4b\u95f4\u7684\u4e00\u5bf9\u591a\u5173\u8054\u8f6c\u53d8\u4e3a\u4e00\u5bf9\u4e00\u7684\u5173\u8054\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u7075\u6d3b\u6027\uff0c\u4f7f\u5f97\u7cfb\u7edf\u6613\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55 \u540c\u4e8b\u7c7b\u592a\u591a\u65f6\uff0c\u4e2d\u4ecb\u8005\u7684\u804c\u8d23\u5f88\u5927\uff0c\u96be\u4ee5\u7ef4\u62a4 \u9002\u7528\u573a\u666f \u5f53\u5bf9\u8c61\u4e4b\u95f4\u5b58\u5728\u590d\u6742\u7684\u7f51\u72b6\u7ed3\u6784\u5173\u7cfb\u800c\u5bfc\u81f4\u4f9d\u8d56\u5173\u7cfb\u6df7\u4e71\u4e14\u96be\u4ee5\u590d\u7528\u65f6\u3002 \u5f53\u60f3\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u4e8e\u591a\u4e2a\u7c7b\u4e4b\u95f4\u7684\u5bf9\u8c61\uff0c\u53c8\u4e0d\u60f3\u751f\u6210\u65b0\u7684\u5b50\u7c7b\u65f6\u3002 21. \u5907\u5fd8\u5f55\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5728\u4e0d\u7834\u574f\u5c01\u88c5\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u5728\u8be5\u5bf9\u8c61\u4e4b\u5916\u4fdd\u5b58\u8fd9\u4e2a\u72b6\u6001\uff0c\u4ee5\u4fbf\u4ee5\u540e\u5728\u9700\u8981\u65f6\u6062\u590d\u8be5\u72b6\u6001\u3002 \u5c06\u88ab\u5b58\u50a8\u7684\u72b6\u6001\u653e\u5728\u5916\u9762\uff0c\u4e0d\u8981\u548c\u5173\u952e\u5bf9\u8c61\u653e\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u5e2e\u52a9\u7ef4\u62a4\u5185\u805a \u4fdd\u6301\u5173\u952e\u5bf9\u8c61\u7684\u6570\u636e\u5c01\u88c5 \u63d0\u4f9b\u4e86\u5bb9\u6613\u5b9e\u73b0\u7684\u6062\u590d\u80fd\u529b \u50a8\u5b58\u548c\u6062\u590d\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u5f88\u8017\u65f6 java\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5e8f\u5217\u5316\u673a\u5236\u50a8\u5b58\u7cfb\u7edf\u7684\u72b6\u6001 22. \u539f\u578b\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u7528\u4e00\u4e2a\u5df2\u7ecf\u521b\u5efa\u7684\u5b9e\u4f8b\u4f5c\u4e3a\u539f\u578b\uff0c\u901a\u8fc7\u590d\u5236\u8be5\u539f\u578b\u5bf9\u8c61\u6765\u521b\u5efa\u4e00\u4e2a\u548c\u539f\u578b\u76f8\u540c\u6216\u76f8\u4f3c\u7684\u65b0\u5bf9\u8c61\u3002 \u6f5c\u514b\u9686\uff1a\u5c06\u4e00\u4e2a\u5bf9\u8c61\u590d\u5236\u540e\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53d8\u91cf\u90fd\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u800c\u5f15\u7528\u7c7b\u578b\uff0c\u6307\u5411\u7684\u8fd8\u662f\u539f\u5bf9\u8c61\u6240\u6307\u5411\u7684\u3002 \u6df1\u514b\u9686\uff1a\u5c06\u4e00\u4e2a\u5bf9\u8c61\u590d\u5236\u540e\uff0c\u4e0d\u8bba\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8fd8\u6709\u5f15\u7528\u7c7b\u578b\uff0c\u90fd\u662f\u91cd\u65b0\u521b\u5efa\u7684\u3002 Cloneable \u6f5c\u514b\u9686 Serializable \u6df1\u514b\u9686\uff0c\u91c7\u7528\u6d41\u7684\u5f62\u5f0f\u8bfb\u5165\u5f53\u524d\u5bf9\u8c61\u7684\u4e8c\u8fdb\u5236\u8f93\u5165\uff0c\u518d\u5199\u51fa\u4e8c\u8fdb\u5236\u6570\u636e\u5bf9\u5e94\u7684\u5bf9\u8c61\u3002 \u9002\u7528\u573a\u666f\uff1a \u5bf9\u8c61\u4e4b\u95f4\u76f8\u540c\u6216\u76f8\u4f3c\u7684\u65f6\u5019 \u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u590d\u5236\u6bd4\u8f83\u7b80\u5355\u7684\u65f6\u5019 \u514b\u9686\u56f0\u96be\u7684\u573a\u666f\uff1a \u4e00\u4e2a\u7c7b\u5f15\u7528\u4e0d\u652f\u6301\u4e32\u884c\u5316\u7684\u95f4\u63a5\u5bf9\u8c61\uff0c\u6216\u8005\u5f15\u7528\u542b\u6709\u5faa\u73af\u7ed3\u6784\u7684\u65f6\u5019\u3002 \u7ecf\u5e38\u4e0e\u5de5\u5382\u65b9\u6cd5\u4e00\u8d77\u4f7f\u7528 23. \u8bbf\u95ee\u8005\u6a21\u5f0f \u00b6 \u5b9a\u4e49 \uff1a\u5c06\u4f5c\u7528\u4e8e\u67d0\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5404\u5143\u7d20\u7684\u64cd\u4f5c\u5206\u79bb\u51fa\u6765\u5c01\u88c5\u6210\u72ec\u7acb\u7684\u7c7b\uff0c\u4f7f\u5176\u5728\u4e0d\u6539\u53d8\u6570\u636e\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u6dfb\u52a0\u4f5c\u7528\u4e8e\u8fd9\u4e9b\u5143\u7d20\u7684\u65b0\u64cd\u4f5c\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u63d0\u4f9b\u591a\u79cd\u8bbf\u95ee\u65b9\u5f0f\u3002 \u5c06\u6570\u636e\u7ed3\u6784\u53ca\u5176\u64cd\u4f5c\u5206\u79bb \u4f18\u70b9\uff1a \u6269\u5c55\u6027\u597d\u3002\u80fd\u591f\u5728\u4e0d\u4fee\u6539\u5bf9\u8c61\u7ed3\u6784\u4e2d\u7684\u5143\u7d20\u7684\u60c5\u51b5\u4e0b\uff0c\u4e3a\u5143\u7d20\u6dfb\u52a0\u65b0\u529f\u80fd\u3002 \u590d\u7528\u6027\u597d\u3002\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49\u8bbf\u95ee\u8005\u6765\u5b9a\u4e49\u6574\u4e2a\u5bf9\u8c61\u7ed3\u6784\u901a\u7528\u7684\u529f\u80fd\u3002 \u7b26\u5408\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002 \u7f3a\u70b9\uff1a \u589e\u52a0\u65b0\u7684\u5143\u7d20\u7c7b\u5f88\u56f0\u96be\u3002\u6bcf\u589e\u52a0\u4e00\u4e2a\u5143\u7d20\uff0c\u5c31\u8981\u5728\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684\u8bbf\u95ee\u8005\u7c7b\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u5177\u4f53\u64cd\u4f5c\uff0c\u8fdd\u80cc\u4e86 \u5f00\u95ed\u539f\u5219 \u3002 \u7834\u574f\u5c01\u88c5\u3002\u5177\u4f53\u5143\u7d20\u5bf9\u8bbf\u95ee\u8005\u516c\u5e03\u7ec6\u8282\uff0c\u7834\u574f\u4e86\u5bf9\u8c61\u7684 \u5c01\u88c5\u6027 \uff0c\u8fdd\u53cd\u4e86 \u8fea\u7c73\u7279\u6cd5\u5219 \u3002 \u8fdd\u53cd\u4e86 \u4f9d\u8d56\u5012\u7f6e\u539f\u5219 \u3002\u4f9d\u8d56\u4e86\u5177\u4f53\u7c7b\uff0c\u800c\u6ca1\u6709\u4f9d\u8d56\u62bd\u8c61\u7c7b\u3002 \u4e0e\u8fed\u4ee3\u5668\u8054\u7528\uff0c\u4e0e\u7ec4\u5408\u6a21\u5f0f\u8054\u7528","title":"\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#1","text":"\u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u7b97\u6cd5\u65cf\uff0c\u5206\u522b\u5c01\u88c5\u8d77\u6765\uff0c\u8ba9\u4ed6\u4eec\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\uff0c\u6b64\u6a21\u5f0f\u8ba9\u7b97\u6cd5\u7684\u53d8\u6362\u72ec\u7acb\u4e8e\u4f7f\u7528\u7b97\u6cd5\u7684\u5ba2\u6237\u3002 \u5c06\u53ef\u4ee5\u4e92\u6362\u7684\u884c\u4e3a\u5c01\u88c5\u8d77\u6765\uff0c\u7136\u540e\u4f7f\u7528\u59d4\u6258\u7684\u65b9\u6cd5\uff0c\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e00\u4e2a\u884c\u4e3a\u3002","title":"1. \u7b56\u7565\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#2","text":"\u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u5bf9\u8c61\u4e4b\u95f4\u4e00\u5bf9\u591a\u4f9d\u8d56\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u6539\u53d8\u72b6\u6001\u65f6\uff0c\u5b83\u7684\u6240\u6709\u4f9d\u8d56\u8005\u90fd\u4f1a\u53d7\u5230\u901a\u77e5\u5e76\u81ea\u52a8\u66f4\u65b0\u3002 java\u5185\u7f6e\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\uff1aObserver\uff08\u89c2\u5bdf\u8005\uff09\u4e0eObservable\uff08\u89c2\u5bdf\u5bf9\u8c61\uff09\uff0csetChanges()\uff0cnotifyObservers()\uff08\u62c9\u53d6\uff09\uff0cnotifyObservers(Object arg)\uff08\u63a8\u9001\uff09\u3002","title":"2. \u89c2\u5bdf\u8005\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#3","text":"\u5b9a\u4e49 \uff1a\u52a8\u6001\u5730\u5c06\u8d23\u4efb\u9644\u52a0\u5230\u5bf9\u8c61\u4e0a\u3002\u82e5\u8981\u6269\u5c55\u529f\u80fd\uff0c\u88c5\u9970\u8005\u63d0\u4f9b\u4e86\u6bd4\u7ee7\u627f\u66f4\u5177\u6709\u5f39\u6027\u7684\u66ff\u4ee3\u65b9\u6848\u3002 \u88c5\u9970\u8005\u4e0e\u88ab\u88c5\u9970\u8005\u6709\u76f8\u540c\u7684\u8d85\u7c7b\u578b\uff0c\u4ee5\u6b64\u8fbe\u5230 \u7c7b\u578b\u5339\u914d \uff0c\u800c\u4e0d\u662f\u5229\u7528\u7ee7\u627f\u83b7\u5f97\u884c\u4e3a\u3002 \u88c5\u9970\u8005\u53ef\u4ee5\u5728\u6240\u59d4\u6258\u88ab\u88c5\u9970\u8005\u7684\u884c\u4e3a\u4e4b\u524d\u6216\u4e4b\u540e\uff0c\u52a0\u4e0a\u81ea\u5df1\u7684\u884c\u4e3a\uff0c\u5df2\u8fbe\u5230\u7279\u5b9a\u7684\u76ee\u7684\u3002 java.io\u5305","title":"3. \u88c5\u9970\u8005\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#4","text":"\u7b80\u5355\u5de5\u5382 \uff1a\u4f7f\u7528\u53e6\u4e00\u4e2a\u5bf9\u8c61\u6765\u4f5c\u4e3a\u521b\u5efa\u5bf9\u8c61\u7684\u5de5\u5382\u3002 \u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e86\u4e00\u4e2a\u521b\u5efa\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u4f46\u7531\u5b50\u7c7b\u51b3\u5b9a\u8981\u5b9e\u4f8b\u5316\u7684\u7c7b\u662f\u54ea\u4e00\u4e2a\u3002\u5de5\u5382\u65b9\u6cd5\u8ba9\u7c7b\u628a\u5b9e\u4f8b\u5316\u63a8\u8fdf\u5230\u5b50\u7c7b\u3002 \u62bd\u8c61\u5de5\u5382\u6a21\u5f0f\u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u4e8e\u521b\u5efa\u76f8\u5173\u6216\u4f9d\u8d56\u5bf9\u8c61\u7684\u5bb6\u65cf\uff0c\u800c\u4e0d\u9700\u8981\u660e\u786e\u6307\u5b9a\u5177\u4f53\u7c7b\u3002 \u7b80\u5355\u5de5\u5382\u4e0e\u5de5\u5382\u65b9\u6cd5\u4e4b\u95f4\u7684\u5dee\u5f02\uff1a \u7b80\u5355\u5de5\u5382\u5728\u4e00\u4e2a\u5730\u65b9\u628a\u6240\u6709\u4e1c\u897f\u90fd\u505a\u5b8c\u4e86\uff1b\u5de5\u5382\u65b9\u6cd5\u5374\u521b\u5efa\u4e00\u4e2a\u6846\u67b6\uff0c\u8ba9\u5b50\u7c7b\u51b3\u5b9a\u8981\u5982\u4f55\u5b9e\u73b0\u3002 \u5de5\u5382\u65b9\u6cd5\u4e0e\u62bd\u8c61\u5de5\u5382\u4e4b\u95f4\u7684\u5dee\u5f02\uff1a \u5de5\u5382\u65b9\u6cd5 \u62bd\u8c61\u5de5\u5382 \u4f7f\u7528\u7ee7\u627f\u521b\u5efa\u5bf9\u8c61 \u4f7f\u7528\u5bf9\u8c61\u7684\u7ec4\u5408\u521b\u5efa\u5bf9\u8c61 \u901a\u8fc7\u5b50\u7c7b\u521b\u5efa\u5bf9\u8c61\uff0c\u7531\u5b50\u7c7b\u8d1f\u8d23\u51b3\u5b9a\u5177\u4f53\u7684\u7c7b\u578b\uff1b\u628a\u5ba2\u6237\u4ee3\u7801\u4ece\u9700\u8981\u5b9e\u4f8b\u5316\u7684\u5177\u4f53\u7c7b\u4e2d\u89e3\u8026 \u63d0\u4f9b\u4e00\u4e2a\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u4ea7\u54c1\u5bb6\u65cf\u7684\u62bd\u8c61\u7c7b\u578b\uff0c\u8be5\u7c7b\u578b\u7684\u5b50\u7c7b\u5b9a\u4e49\u4e86\u4ea7\u54c1\u88ab\u4ea7\u751f\u7684\u65b9\u6cd5 \u53ea\u521b\u5efa\u4e00\u4e2a\u4ea7\u54c1 \u53ef\u4ee5\u5c06\u4e00\u7fa4\u76f8\u5173\u7684\u4ea7\u54c1\u7ec4\u5408\u8d77\u6765\uff1b\u52a0\u5165\u65b0\u4ea7\u54c1\u5c31\u5fc5\u987b\u6539\u53d8\u63a5\u53e3 \u62bd\u8c61\u5de5\u5382\u7684\u65b9\u6cd5\u7ecf\u5e38\u4ee5\u5de5\u5382\u65b9\u6cd5\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002","title":"4. \u7b80\u5355\u5de5\u5382\u3001\u5de5\u5382\u65b9\u6cd5\u4e0e\u62bd\u8c61\u5de5\u5382\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#5","text":"\u5b9a\u4e49 \uff1a\u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u5168\u5c40\u8bbf\u95ee\u70b9\u3002 \u89e3\u51b3\u7ebf\u7a0b\u4e0d\u5b89\u5168\u95ee\u9898\uff1a1. \u4f7f\u7528synchronized\uff1b2. \u7c7b\u52a0\u8f7d\u65f6\u7acb\u5373\u5b9e\u4f8b\u5316\u5355\u4e2a\u5b9e\u4f8b\uff1b3. \u53cc\u91cd\u68c0\u67e5\u52a0\u9501\u3002 \u7a0b\u5e8f\u6709\u591a\u4e2a\u7c7b\u52a0\u8f7d\u5668\u65f6\uff0c\u9700\u8981\u81ea\u884c\u6307\u5b9a\u7c7b\u52a0\u8f7d\u5668\uff0c\u5e76\u6307\u5b9a\u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u3002","title":"5. \u5355\u4f8b\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#6","text":"\u5b9a\u4e49 \uff1a\u5c06\u8bf7\u6c42\u5c01\u88c5\u6210\u5bf9\u8c61\uff0c\u8fd9\u53ef\u4ee5\u8ba9\u4f60\u4f7f\u7528\u4e0d\u540c\u7684\u8bf7\u6c42\u3001\u961f\u5217\u6216\u65e5\u5fd7\u8bf7\u6c42\u6765\u53c2\u6570\u5316\u5176\u5b83\u5bf9\u8c61\u3002\u652f\u6301\u64a4\u9500\u64cd\u4f5c\u3002 \u5f53\u9700\u8981\u53d1\u51fa\u8bf7\u6c42\u7684\u5bf9\u8c61\u548c\u6267\u884c\u8bf7\u6c42\u7684\u5bf9\u8c61\u89e3\u8026\u65f6\u4f7f\u7528\u6b64\u6a21\u5f0f\u3002\u4e24\u8005\u662f\u901a\u8fc7\u547d\u4ee4\u5bf9\u8c61\u6765\u6c9f\u901a\u7684\u3002 \u7a7a\u5bf9\u8c61\uff08null object\uff09\uff0c\u4e0d\u60f3\u5904\u7406null\u65f6\u53ef\u7528\u7a7a\u5bf9\u8c61\u4ee3\u66ff\uff0cdo nothing\u3002 client\uff0ccommand\uff0cconcreteCommand\uff0creceiver\uff0cinvoker \u5b8f\u547d\u4ee4 \u961f\u5217\uff0c\u65e5\u5fd7","title":"6. \u547d\u4ee4\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#7","text":"\u5b9a\u4e49 \uff1a\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\uff0c\u8f6c\u6362\u6210\u5ba2\u6237\u671f\u671b\u7684\u53e6\u4e00\u4e2a\u63a5\u53e3\u3002\u9002\u914d\u5668\u8ba9\u539f\u672c\u63a5\u53e3\u4e0d\u517c\u5bb9\u7684\u7c7b\u53ef\u4ee5\u5408\u4f5c\u65e0\u95f4\u3002 \u7c7b\u9002\u914d\u5668\uff0c\u5bf9\u8c61\u9002\u914d\u5668\uff0c\u53cc\u5411\u9002\u914d\u5668 \u6a21\u5f0f\u4e4b\u95f4\u7684\u533a\u522b\uff1a \u6a21\u5f0f \u76ee\u7684 \u88c5\u9970\u8005 \u4e0d\u6539\u53d8\u63a5\u53e3\uff0c\u4f46\u52a0\u5165\u8d23\u4efb \u9002\u914d\u5668 \u5c06\u63a5\u53e3\u8f6c\u53d8\u4e3a\u53e6\u4e00\u4e2a\u63a5\u53e3 \u5916\u89c2 \u8ba9\u63a5\u53e3\u66f4\u7b80\u5355","title":"7. \u9002\u914d\u5668\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#8","text":"\u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u7528\u6765\u8bbf\u95ee\u5b50\u7cfb\u7edf\u4e2d\u7684\u4e00\u7fa4\u63a5\u53e3\u3002\u5916\u89c2\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9ad8\u5c42\u63a5\u53e3\uff0c\u8ba9\u5b50\u7cfb\u7edf\u66f4\u5bb9\u6613\u4f7f\u7528\u3002\u8ba9\u5ba2\u6237\u4e0e\u5b50\u7cfb\u7edf\u4e4b\u95f4\u907f\u514d\u7d27\u8026\u5408\u3002","title":"8. \u5916\u89c2\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#9","text":"\u5b9a\u4e49 \uff1a\u5728\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u7b97\u6cd5\u7684\u9aa8\u67b6\uff0c\u800c\u5c06\u4e00\u4e9b\u6b65\u9aa4\u5ef6\u8fdf\u5230\u5b50\u7c7b\u4e2d\u3002\u6a21\u677f\u65b9\u6cd5\u4f7f\u5f97\u5b50\u7c7b\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8\u7b97\u6cd5\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u91cd\u65b0\u5b9a\u4e49\u7b97\u6cd5\u4e2d\u7684\u67d0\u4e9b\u6b65\u9aa4\u3002 \u4fdd\u6301\u597d\u62bd\u8c61\u65b9\u6cd5\u7684\u6570\u76ee\uff0c\u5728\u5b50\u7c7b\u5b9e\u73b0\u65b9\u6cd5\u7684\u6570\u76ee\u4e0e\u6b65\u9aa4\u6570\u91cf\u4e4b\u95f4\u6298\u4e2d\u3002 \u4e3a\u4e86\u9632\u6b62\u5b50\u7c7b\u6539\u53d8\u6a21\u677f\u65b9\u6cd5\u4e2d\u7684\u7b97\u6cd5\uff0c\u53ef\u4ee5\u5c06\u6a21\u677f\u65b9\u6cd5\u58f0\u660e\u4e3afinal\u3002 \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\u4e0e\u7b56\u7565\u6a21\u5f0f\u90fd\u5c01\u88c5\u7b97\u6cd5\uff0c\u524d\u8005\u7528\u7ee7\u627f\uff0c\u540e\u8005\u7528\u7ec4\u5408\u3002 \u5de5\u5382\u65b9\u6cd5\u65f6\u6a21\u677f\u65b9\u6cd5\u7684\u4e00\u79cd\u7279\u6b8a\u7248\u672c\u3002 \u94a9\u5b50\u7684\u51e0\u79cd\u7528\u6cd5\uff1a \u8ba9\u5b50\u7c7b\u5b9e\u73b0\u7b97\u6cd5\u4e2d\u7684\u53ef\u9009\u90e8\u5206 \u5728\u94a9\u5b50\u5bf9\u4e8e\u5b50\u7c7b\u7684\u5b9e\u73b0\u6b65\u91cd\u8981\u7684\u65f6\u5019\uff0c\u5b50\u7c7b\u53ef\u5bf9\u94a9\u5b50\u7f6e\u4e4b\u4e0d\u7406 \u8ba9\u5b50\u7c7b\u80fd\u591f\u6709\u673a\u4f1a\u5bf9\u6a21\u677f\u65b9\u6cd5\u4e2d\u67d0\u4e9b\u5373\u5c06\u53d1\u751f\uff08\u6216\u521a\u53d1\u751f\uff09\u7684\u6b65\u9aa4\u505a\u51fa\u53cd\u5e94","title":"9. \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#10","text":"\u5b9a\u4e49 \uff1a\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u987a\u5e8f\u8bbf\u95ee\u4e00\u4e2a\u805a\u5408\u5bf9\u8c61\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\uff0c\u800c\u53c8\u4e0d\u66b4\u9732\u5176\u5185\u90e8\u7684\u8868\u793a\u3002 \u628a\u904d\u5386\u7684\u4efb\u52a1\u653e\u5728\u8fed\u4ee3\u5668\u4e0a\uff0c\u800c\u4e0d\u662f\u805a\u5408\u4e0a\u3002\u7b80\u5316\u4e86\u805a\u5408\u7684\u63a5\u53e3\u548c\u5b9e\u73b0\uff0c\u4e5f\u8ba9\u8d23\u4efb\u5404\u5f97\u5176\u6240\u3002 \u8fed\u4ee3\u5668\u610f\u5473\u7740\u65e0\u5e8f\u7684\u3002 \u8fed\u4ee3\u5668\u5c06\u904d\u5386\u805a\u5408\u7684\u5de5\u4f5c\u5c01\u88c5\u8fdb\u4e00\u4e2a\u5bf9\u8c61\u4e2d\u3002","title":"10. \u8fed\u4ee3\u5668\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#11","text":"\u5b9a\u4e49 \uff1a\u5141\u8bb8\u4f60\u5c06\u5bf9\u8c61\u7ec4\u5408\u6210 \u6811\u5f62\u7ed3\u6784 \u6765\u8868\u73b0 \u6574\u4f53/\u90e8\u5206 \u5c42\u6b21\u7ed3\u6784\u3002\u7ec4\u5408\u80fd\u8ba9\u5ba2\u6237\u4ee5\u4e00\u81f4\u7684\u65b9\u5f0f\u5904\u7406\u4e2a\u522b\u5bf9\u8c61\u53ca\u5bf9\u8c61\u7ec4\u5408\u3002 \u80fd\u628a\u76f8\u540c\u7684\u64cd\u4f5c\u5e94\u7528\u5728\u7ec4\u5408\u548c\u4e2a\u522b\u7684\u5bf9\u8c61\u4e0a\u3002 \u5728\u5b9e\u73b0\u8be5\u6a21\u5f0f\u65f6\uff0c\u6709\u5f88\u591a\u8bbe\u8ba1\u4e0a\u7684\u6298\u4e2d\u3002\u8981\u6839\u636e\u9700\u6c42\u5e73\u8861\u900f\u660e\u6027\u548c\u5b89\u5168\u6027\u3002","title":"11. \u7ec4\u5408\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#12","text":"\u5b9a\u4e49 \uff1a\u5141\u8bb8\u5bf9\u8c61\u5728\u5185\u90e8\u72b6\u6001\u6539\u53d8\u65f6\u6539\u53d8\u5b83\u7684\u884c\u4e3a\uff0c\u5bf9\u8c61\u770b\u8d77\u6765\u597d\u50cf\u4fee\u6539\u4e86\u5b83\u7684\u7c7b\u3002 \u5c01\u88c5\u57fa\u4e8e\u72b6\u6001\u7684\u884c\u4e3a\uff0c\u5e76\u5c06\u884c\u4e3a\u59d4\u6258\u5230\u5f53\u524d\u72b6\u6001\u3002 \u72b6\u6001\u8f6c\u6362\u53ef\u4ee5\u7531state\u7c7b\u6216context\u7c7b\u63a7\u5236\u3002 \u5982\u679c\u6709\u591a\u4e2acontext\u5b9e\u4f8b\uff0c\u5c31\u9700\u8981\u5c06\u72b6\u6001\u7684\u5b9e\u4f8b\u8f6c\u79fb\u5230\u9759\u6001\u7684\u5b9e\u4f8b\u53d8\u91cf\u4e2d\u5171\u4eab\u3002 \u8be5\u6a21\u5f0f\u4f1a\u5bfc\u81f4\u8bbe\u8ba1\u4e2d\u7c7b\u7684\u6570\u91cf\u5927\u91cf\u589e\u52a0\u3002","title":"12. \u72b6\u6001\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#13","text":"\u5b9a\u4e49 \uff1a\u4e3a\u53e6\u4e00\u4e2a\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u66ff\u8eab\u6216\u5360\u4f4d\u7b26\u4ee5\u63a7\u5236\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u4f7f\u7528\u8be5\u6a21\u5f0f\u521b\u5efa\u4ee3\u8868\u5bf9\u8c61\uff0c\u8ba9\u4ee3\u8868\u5bf9\u8c61\u63a7\u5236\u67d0\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u63a7\u5236\u8bbf\u95ee\u65b9\u5f0f\uff1a \u8fdc\u7a0b\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\u8fdc\u7a0b\u5bf9\u8c61 \u865a\u62df\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\u521b\u5efa\u5f00\u9500\u5927\u7684\u8d44\u6e90 \u4fdd\u62a4\u4ee3\u7406\u57fa\u4e8e\u6743\u9650\u63a7\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee java\u5185\u7f6e\u7684\u4ee3\u7406\u652f\u6301\uff1ajava.lang.reflect \u52a8\u6001\u4ee3\u7406\u7684\u542b\u4e49\u662f\u5728\u8fd0\u884c\u65f6\u624d\u5c06\u5b83\u7684\u7c7b\u521b\u5efa\u51fa\u6765 \u53d8\u79cd\uff1a \u9632\u706b\u5899\u4ee3\u7406\uff0c\u63a7\u5236\u7f51\u7edc\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c\u4fdd\u62a4\u4e3b\u9898\u514d\u4e8e\u201c\u574f\u5ba2\u6237\u201d\u7684\u4fb5\u5bb3\u3002 \u667a\u80fd\u5f15\u7528\u4ee3\u7406\uff0c\u5f53\u4e3b\u9898\u88ab\u5f15\u7528\u65f6\uff0c\u8fdb\u884c\u989d\u5916\u7684\u52a8\u4f5c\uff0c\u4f8b\u5982\u8ba1\u7b97\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5f15\u7528\u7684\u6b21\u6570\u3002 \u7f13\u5b58\u4ee3\u7406\uff0c\u4e3a\u5f00\u9500\u5927\u7684\u8fd0\u7b97\u7ed3\u679c\u63d0\u4f9b\u6682\u65f6\u7684\u5b58\u50a8\u3002\u5b83\u4e5f\u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u5171\u4eab\u7ed3\u679c\uff0c\u4ee5\u51cf\u5c11\u8ba1\u7b97\u6216\u7f51\u7edc\u5ef6\u8fdf\u3002 \u540c\u6b65\u4ee3\u7406\uff0c\u5728\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u4e3a\u4e3b\u9898\u63d0\u4f9b\u5b89\u5168\u7684\u8bbf\u95ee\u3002 \u590d\u6742\u9690\u85cf\u4ee3\u7406\uff0c\u7528\u6765\u9690\u85cf\u4e00\u4e2a\u7c7b\u7684\u590d\u6742\u96c6\u5408\u7684\u590d\u6742\u5ea6\uff0c\u5e76\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u3002\u4e5f\u79f0\u5916\u89c2\u4ee3\u7406\u3002\u4ee3\u7406\u63a7\u5236\u8bbf\u95ee\uff0c\u800c\u5916\u89c2\u6a21\u5f0f\u53ea\u63d0\u4f9b\u53e6\u4e00\u7ec4\u63a5\u53e3\u3002 \u5199\u5165\u65f6\u590d\u5236\u4ee3\u7406\uff0c\u7528\u6765\u63a7\u5236\u5bf9\u8c61\u7684\u590d\u5236\uff0c\u65b9\u6cd5\u662f\u5ef6\u8fdf\u5bf9\u8c61\u7684\u590d\u5236\uff0c\u76f4\u5230\u5ba2\u6237\u771f\u7684\u9700\u8981\u4e3a\u6b62\u3002\u662f\u865a\u62df\u4ee3\u7406\u7684\u53d8\u4f53\u3002","title":"13. \u4ee3\u7406\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#14","text":"\u5b9a\u4e49 \uff1a\u7ed3\u5408\u591a\u4e2a\u6a21\u5f0f\uff0c\u7ec4\u6210\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0c\u89e3\u51b3\u4e00\u518d\u53d1\u751f\u7684\u4e00\u822c\u6027\u95ee\u9898\u3002","title":"14. \u590d\u5408\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#15","text":"\u5b9a\u4e49 \uff1a\u8bb2\u4e00\u4e2a\u590d\u6742\u7684\u5bf9\u8c61\u5730\u6784\u9020\u4e0e\u5b83\u7684\u8868\u793a\u5206\u79bb\uff0c\u4f7f\u540c\u6837\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u8868\u793a\u3002 \u5c06\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u5c01\u88c5\u8d77\u6765 \u5141\u8bb8\u5bf9\u8c61\u901a\u8fc7\u591a\u4e2a\u6b65\u9aa4\u6765\u521b\u5efa\uff0c\u5e76\u4e14\u53ef\u6539\u53d8\u8fc7\u7a0b\uff08\u5de5\u5382\u65b9\u6cd5\u53ea\u6709\u4e00\u4e2a\u6b65\u9aa4\uff09 \u7ed3\u6784\uff1a \u4ea7\u54c1\uff1a\u5305\u542b\u591a\u4e2a\u7ec4\u6210\u90e8\u4ef6\u7684\u590d\u5236\u5bf9\u8c61 \u62bd\u8c61\u5efa\u9020\u8005\uff1a\u5305\u542b\u521b\u5efa\u4ea7\u54c1\u5404\u4e2a\u90e8\u4ef6\u7684\u63a5\u53e3\uff0c\u5305\u542b\u8fd4\u56de\u4ea7\u54c1\u7684\u65b9\u6cd5 \u5177\u4f53\u5efa\u9020\u8005\uff1a\u5b9e\u73b0\u62bd\u8c61\u5efa\u9020\u8005\u7684\u63a5\u53e3 \u6307\u6325\u8005\uff1a\u8c03\u7528\u5efa\u9020\u8005\u7684\u90e8\u4ef6\u6784\u9020\u5e76\u88c5\u914d\uff0c\u5b8c\u6210\u4ea7\u54c1\u7684\u7ec4\u88c5 \u9002\u7528\u573a\u666f\uff1a \u521b\u5efa\u7684\u5bf9\u8c61\u8f83\u590d\u6742\uff0c\u7531\u591a\u4e2a\u90e8\u4ef6\u6784\u6210\uff0c\u5404\u90e8\u4ef6\u9762\u4e34\u7740\u590d\u6742\u7684\u53d8\u5316\uff0c\u4f46\u6784\u4ef6\u95f4\u7684\u5efa\u9020\u987a\u5e8f\u662f\u7a33\u5b9a\u7684\u3002 \u521b\u5efa\u590d\u6742\u5bf9\u8c61\u7684\u7b97\u6cd5\u72ec\u7acb\u4e8e\u8be5\u5bf9\u8c61\u7684\u7ec4\u6210\u90e8\u5206\u4ee5\u53ca\u5b83\u4eec\u7684\u88c5\u914d\u65b9\u5f0f\uff0c\u5373\u4ea7\u54c1\u7684\u6784\u5efa\u8fc7\u7a0b\u548c\u6700\u7ec8\u7684\u8868\u793a\u662f\u72ec\u7acb\u7684\u3002 \u53ef\u4ee5\u6839\u636e\u9700\u8981\u7701\u7565\u6389\u62bd\u8c61\u5efa\u9020\u8005\u3001\u6307\u6325\u8005","title":"15. \u751f\u6210\u5668\u6a21\u5f0f\uff08\u5efa\u9020\u8005\u6a21\u5f0f\uff09"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#16","text":"\u5b9a\u4e49 \uff1a\u5c06\u62bd\u8c61\u4e0e\u5b9e\u73b0\u5206\u79bb\uff0c\u4f7f\u5b83\u4eec\u53ef\u4ee5\u72ec\u7acb\u53d8\u5316\u3002 \u5c06\u62bd\u8c61\u5316\u90e8\u5206\u4e0e\u5b9e\u73b0\u5316\u90e8\u5206\u5206\u5f00\uff0c\u53d6\u6d88\u4e8c\u8005\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u6539\u7528\u7ec4\u5408\u5173\u7cfb","title":"16. \u6865\u63a5\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#17","text":"\u5b9a\u4e49 \uff1a\u4e3a\u4e86\u907f\u514d\u8bf7\u6c42\u53d1\u9001\u8005\u4e0e\u591a\u4e2a\u8bf7\u6c42\u5904\u7406\u8005\u7684\u8026\u5408\uff0c\u5c06\u6240\u6709\u8bf7\u6c42\u7684\u5904\u7406\u8005\u901a\u8fc7\u524d\u4e00\u5bf9\u8c61\u8bb0\u4f4f\u5176\u4e0b\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u800c\u8fde\u6210\u4e00\u6761\u94fe\uff1b\u5f53\u6709\u8bf7\u6c42\u53d1\u751f\u65f6\uff0c\u53ef\u5c06\u8bf7\u6c42\u6cbf\u7740\u8fd9\u6761\u94fe\u4f20\u9012\uff0c\u76f4\u5230\u6709\u5bf9\u8c61\u5904\u7406\u5b83\u4e3a\u6b62\uff0c\u6216\u4e0d\u5904\u7406\u3002 \u5c06\u8bf7\u6c42\u7684\u53d1\u9001\u8005\u4e0e\u63a5\u53d7\u8005\u89e3\u8026 \u901a\u8fc7\u6539\u53d8\u94fe\u5185\u7684\u6210\u5458\u6216\u8c03\u52a8\u4ed6\u4eec\u7684\u987a\u5e8f\uff0c\u5141\u8bb8\u52a8\u6001\u5730\u65b0\u589e\u6216\u5220\u9664\u63a5\u53d7\u8005 \u6bcf\u4e2a\u7c7b\u90fd\u8d1f\u8d23\u81ea\u5df1\u7684\u5de5\u4f5c\uff0c\u7b26\u5408\u7c7b\u7684\u5355\u4e00\u804c\u8d23\u539f\u5219 \u6ee1\u8db3\u5f00\u95ed\u539f\u5219","title":"17. \u8d23\u4efb\u94fe\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#18","text":"\u5b9a\u4e49 \uff1a\u5229\u7528\u5171\u4eab\u6280\u672f\u6765\u6709\u6548\u5730\u652f\u6301\u5927\u91cf\u7ec6\u7c92\u5ea6\u5bf9\u8c61\u7684\u590d\u7528\u3002\u5b83\u901a\u8fc7\u5171\u4eab\u5df2\u7ecf\u5b58\u5728\u7684\u5bf9\u8c61\u6765\u5927\u5e45\u5ea6\u51cf\u5c11\u9700\u8981\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u91cf\u3001\u907f\u514d\u5927\u91cf\u76f8\u4f3c\u7c7b\u7684\u5f00\u9500\uff0c\u4ece\u800c\u63d0\u9ad8\u7cfb\u7edf\u8d44\u6e90\u7684\u5229\u7528\u7387\u3002 \u51cf\u5c11\u8fd0\u884c\u65f6\u5bf9\u8c61\u7684\u5b9e\u4f8b\u4e2a\u6570\uff0c\u8282\u7701\u5185\u5b58 \u5c06\u8bb8\u591a\u865a\u62df\u5bf9\u8c61\u7684\u72b6\u6001\u96c6\u4e2d\u7ba1\u7406 \u9700\u8981\u5c06\u4e0d\u80fd\u5171\u4eab\u7684\u72b6\u6001\u5916\u90e8\u5316 \u5355\u4e2a\u903b\u8f91\u5b9e\u4f8b\u5c06\u65e0\u6cd5\u62e5\u6709\u72ec\u7acb\u800c\u4e0d\u540c\u7684\u884c\u4e3a \u4e24\u79cd\u72b6\u6001\uff1a \u5185\u90e8\u72b6\u6001\uff1a\u4e0d\u4f1a\u968f\u7740\u73af\u5883\u53d8\u5316\u800c\u53d1\u751f\u53d8\u5316\u7684\u53ef\u5171\u4eab\u90e8\u5206 \u5916\u90e8\u72b6\u6001\uff1a\u4f1a\u56e0\u73af\u5883\u7684\u6539\u53d8\u800c\u53d1\u751f\u53d8\u5316\u7684\u53ef\u53d8\u90e8\u5206 \u5355\u7eaf\u4eab\u5143\u6a21\u5f0f\uff0c\u8fd9\u79cd\u4eab\u5143\u6a21\u5f0f\u4e2d\u7684\u6240\u6709\u7684\u5177\u4f53\u4eab\u5143\u7c7b\u90fd\u662f\u53ef\u4ee5\u5171\u4eab\u7684\uff0c\u4e0d\u5b58\u5728\u975e\u5171\u4eab\u7684\u5177\u4f53\u4eab\u5143\u7c7b \u590d\u5408\u4eab\u5143\u6a21\u5f0f\uff0c\u8fd9\u79cd\u4eab\u5143\u6a21\u5f0f\u4e2d\u7684\u6709\u4e9b\u4eab\u5143\u5bf9\u8c61\u662f\u7531\u4e00\u4e9b\u5355\u7eaf\u4eab\u5143\u5bf9\u8c61\u7ec4\u5408\u800c\u6210\u7684\uff0c\u5b83\u4eec\u5c31\u662f\u590d\u5408\u4eab\u5143\u5bf9\u8c61\u3002\u867d\u7136\u590d\u5408\u4eab\u5143\u5bf9\u8c61\u672c\u8eab\u4e0d\u80fd\u5171\u4eab\uff0c\u4f46\u5b83\u4eec\u53ef\u4ee5\u5206\u89e3\u6210\u5355\u7eaf\u4eab\u5143\u5bf9\u8c61\u518d\u88ab\u5171\u4eab\u3002 ---------------------------------------\u4ee5\u4e0b\u6a21\u5f0f\u672a\u8be6\u7ec6\u4e86\u89e3------------------------------------","title":"18. \u4eab\u5143\u6a21\u5f0f\uff08\u8747\u91cf\u6a21\u5f0f\uff09"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#19","text":"","title":"19. \u89e3\u91ca\u5668\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#20","text":"\u5b9a\u4e49 \uff1a\u5b9a\u4e49\u4e00\u4e2a\u4e2d\u4ecb\u5bf9\u8c61\u6765\u5c01\u88c5\u4e00\u7cfb\u5217\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u4f7f\u539f\u6709\u5bf9\u8c61\u677e\u8026\u5408\uff0c\u4e14\u53ef\u4ee5\u72ec\u7acb\u5730\u6539\u53d8\u5b83\u4eec\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002 \u8fea\u7c73\u7279\u6cd5\u5219\u7684\u5178\u578b\u5e94\u7528 \u964d\u4f4e\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u8026\u5408\u6027 \u5c06\u5bf9\u8c61\u4e4b\u95f4\u7684\u4e00\u5bf9\u591a\u5173\u8054\u8f6c\u53d8\u4e3a\u4e00\u5bf9\u4e00\u7684\u5173\u8054\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u7075\u6d3b\u6027\uff0c\u4f7f\u5f97\u7cfb\u7edf\u6613\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55 \u540c\u4e8b\u7c7b\u592a\u591a\u65f6\uff0c\u4e2d\u4ecb\u8005\u7684\u804c\u8d23\u5f88\u5927\uff0c\u96be\u4ee5\u7ef4\u62a4 \u9002\u7528\u573a\u666f \u5f53\u5bf9\u8c61\u4e4b\u95f4\u5b58\u5728\u590d\u6742\u7684\u7f51\u72b6\u7ed3\u6784\u5173\u7cfb\u800c\u5bfc\u81f4\u4f9d\u8d56\u5173\u7cfb\u6df7\u4e71\u4e14\u96be\u4ee5\u590d\u7528\u65f6\u3002 \u5f53\u60f3\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u4e8e\u591a\u4e2a\u7c7b\u4e4b\u95f4\u7684\u5bf9\u8c61\uff0c\u53c8\u4e0d\u60f3\u751f\u6210\u65b0\u7684\u5b50\u7c7b\u65f6\u3002","title":"20. \u4e2d\u4ecb\u8005\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#21","text":"\u5b9a\u4e49 \uff1a\u5728\u4e0d\u7834\u574f\u5c01\u88c5\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u5728\u8be5\u5bf9\u8c61\u4e4b\u5916\u4fdd\u5b58\u8fd9\u4e2a\u72b6\u6001\uff0c\u4ee5\u4fbf\u4ee5\u540e\u5728\u9700\u8981\u65f6\u6062\u590d\u8be5\u72b6\u6001\u3002 \u5c06\u88ab\u5b58\u50a8\u7684\u72b6\u6001\u653e\u5728\u5916\u9762\uff0c\u4e0d\u8981\u548c\u5173\u952e\u5bf9\u8c61\u653e\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u5e2e\u52a9\u7ef4\u62a4\u5185\u805a \u4fdd\u6301\u5173\u952e\u5bf9\u8c61\u7684\u6570\u636e\u5c01\u88c5 \u63d0\u4f9b\u4e86\u5bb9\u6613\u5b9e\u73b0\u7684\u6062\u590d\u80fd\u529b \u50a8\u5b58\u548c\u6062\u590d\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u5f88\u8017\u65f6 java\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5e8f\u5217\u5316\u673a\u5236\u50a8\u5b58\u7cfb\u7edf\u7684\u72b6\u6001","title":"21. \u5907\u5fd8\u5f55\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#22","text":"\u5b9a\u4e49 \uff1a\u7528\u4e00\u4e2a\u5df2\u7ecf\u521b\u5efa\u7684\u5b9e\u4f8b\u4f5c\u4e3a\u539f\u578b\uff0c\u901a\u8fc7\u590d\u5236\u8be5\u539f\u578b\u5bf9\u8c61\u6765\u521b\u5efa\u4e00\u4e2a\u548c\u539f\u578b\u76f8\u540c\u6216\u76f8\u4f3c\u7684\u65b0\u5bf9\u8c61\u3002 \u6f5c\u514b\u9686\uff1a\u5c06\u4e00\u4e2a\u5bf9\u8c61\u590d\u5236\u540e\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53d8\u91cf\u90fd\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u800c\u5f15\u7528\u7c7b\u578b\uff0c\u6307\u5411\u7684\u8fd8\u662f\u539f\u5bf9\u8c61\u6240\u6307\u5411\u7684\u3002 \u6df1\u514b\u9686\uff1a\u5c06\u4e00\u4e2a\u5bf9\u8c61\u590d\u5236\u540e\uff0c\u4e0d\u8bba\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8fd8\u6709\u5f15\u7528\u7c7b\u578b\uff0c\u90fd\u662f\u91cd\u65b0\u521b\u5efa\u7684\u3002 Cloneable \u6f5c\u514b\u9686 Serializable \u6df1\u514b\u9686\uff0c\u91c7\u7528\u6d41\u7684\u5f62\u5f0f\u8bfb\u5165\u5f53\u524d\u5bf9\u8c61\u7684\u4e8c\u8fdb\u5236\u8f93\u5165\uff0c\u518d\u5199\u51fa\u4e8c\u8fdb\u5236\u6570\u636e\u5bf9\u5e94\u7684\u5bf9\u8c61\u3002 \u9002\u7528\u573a\u666f\uff1a \u5bf9\u8c61\u4e4b\u95f4\u76f8\u540c\u6216\u76f8\u4f3c\u7684\u65f6\u5019 \u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4f46\u590d\u5236\u6bd4\u8f83\u7b80\u5355\u7684\u65f6\u5019 \u514b\u9686\u56f0\u96be\u7684\u573a\u666f\uff1a \u4e00\u4e2a\u7c7b\u5f15\u7528\u4e0d\u652f\u6301\u4e32\u884c\u5316\u7684\u95f4\u63a5\u5bf9\u8c61\uff0c\u6216\u8005\u5f15\u7528\u542b\u6709\u5faa\u73af\u7ed3\u6784\u7684\u65f6\u5019\u3002 \u7ecf\u5e38\u4e0e\u5de5\u5382\u65b9\u6cd5\u4e00\u8d77\u4f7f\u7528","title":"22. \u539f\u578b\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u6a21\u5f0f/#23","text":"\u5b9a\u4e49 \uff1a\u5c06\u4f5c\u7528\u4e8e\u67d0\u79cd\u6570\u636e\u7ed3\u6784\u7684\u5404\u5143\u7d20\u7684\u64cd\u4f5c\u5206\u79bb\u51fa\u6765\u5c01\u88c5\u6210\u72ec\u7acb\u7684\u7c7b\uff0c\u4f7f\u5176\u5728\u4e0d\u6539\u53d8\u6570\u636e\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u6dfb\u52a0\u4f5c\u7528\u4e8e\u8fd9\u4e9b\u5143\u7d20\u7684\u65b0\u64cd\u4f5c\uff0c\u4e3a\u6bcf\u4e2a\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u63d0\u4f9b\u591a\u79cd\u8bbf\u95ee\u65b9\u5f0f\u3002 \u5c06\u6570\u636e\u7ed3\u6784\u53ca\u5176\u64cd\u4f5c\u5206\u79bb \u4f18\u70b9\uff1a \u6269\u5c55\u6027\u597d\u3002\u80fd\u591f\u5728\u4e0d\u4fee\u6539\u5bf9\u8c61\u7ed3\u6784\u4e2d\u7684\u5143\u7d20\u7684\u60c5\u51b5\u4e0b\uff0c\u4e3a\u5143\u7d20\u6dfb\u52a0\u65b0\u529f\u80fd\u3002 \u590d\u7528\u6027\u597d\u3002\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49\u8bbf\u95ee\u8005\u6765\u5b9a\u4e49\u6574\u4e2a\u5bf9\u8c61\u7ed3\u6784\u901a\u7528\u7684\u529f\u80fd\u3002 \u7b26\u5408\u5355\u4e00\u804c\u8d23\u539f\u5219\u3002 \u7f3a\u70b9\uff1a \u589e\u52a0\u65b0\u7684\u5143\u7d20\u7c7b\u5f88\u56f0\u96be\u3002\u6bcf\u589e\u52a0\u4e00\u4e2a\u5143\u7d20\uff0c\u5c31\u8981\u5728\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684\u8bbf\u95ee\u8005\u7c7b\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u5177\u4f53\u64cd\u4f5c\uff0c\u8fdd\u80cc\u4e86 \u5f00\u95ed\u539f\u5219 \u3002 \u7834\u574f\u5c01\u88c5\u3002\u5177\u4f53\u5143\u7d20\u5bf9\u8bbf\u95ee\u8005\u516c\u5e03\u7ec6\u8282\uff0c\u7834\u574f\u4e86\u5bf9\u8c61\u7684 \u5c01\u88c5\u6027 \uff0c\u8fdd\u53cd\u4e86 \u8fea\u7c73\u7279\u6cd5\u5219 \u3002 \u8fdd\u53cd\u4e86 \u4f9d\u8d56\u5012\u7f6e\u539f\u5219 \u3002\u4f9d\u8d56\u4e86\u5177\u4f53\u7c7b\uff0c\u800c\u6ca1\u6709\u4f9d\u8d56\u62bd\u8c61\u7c7b\u3002 \u4e0e\u8fed\u4ee3\u5668\u8054\u7528\uff0c\u4e0e\u7ec4\u5408\u6a21\u5f0f\u8054\u7528","title":"23. \u8bbf\u95ee\u8005\u6a21\u5f0f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/","text":"\u627e\u51fa\u5e94\u7528\u4e2d\u53ef\u80fd\u9700\u8981\u53d8\u5316\u7684\u5730\u65b9\uff0c\u628a\u5b83\u4eec\u72ec\u7acb\u5c01\u88c5\u8d77\u6765\uff0c\u4e0d\u8981\u4e0e\u65e0\u9700\u53d8\u5316\u7684\u653e\u5728\u4e00\u8d77 \u00b6 \u9488\u5bf9\u63a5\u53e3\u7f16\u7a0b\uff08\u9488\u5bf9\u8d85\u7c7b\u578b\u7f16\u7a0b\uff09 \u00b6 \u58f0\u660e\u7c7b\u65f6\u4e0d\u7528\u7406\u4f1a\u4ee5\u540e\u6267\u884c\u65f6\u7684\u771f\u6b63\u5bf9\u8c61\u7c7b\u578b \u591a\u7528\u7ec4\u5408\uff0c\u5c11\u7528\u7ee7\u627f \u00b6 \u4e3a\u4e86\u4ea4\u4e92\u5bf9\u8c61\u4e4b\u95f4\u7684\u677e\u8026\u5408\u8bbe\u8ba1\u800c\u52aa\u529b \u00b6 \u7c7b\u5e94\u8be5\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u5bf9\u4fee\u6539\u5173\u95ed \u00b6 \u65e0\u9700\u5bf9\u6bcf\u4e2a\u5730\u65b9\u90fd\u5b9e\u884c\u8fd9\u4e2a\u539f\u5219 \u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff1a\u8981\u4f9d\u8d56\u62bd\u8c61\uff0c\u4e0d\u8981\u4f9d\u8d56\u5177\u4f53\u7c7b \u00b6 \u4e0d\u80fd\u8ba9\u9ad8\u5c42\u7ec4\u4ef6\u4f9d\u8d56\u5e95\u5c42\u7ec4\u4ef6\uff0c\u4e24\u8005\u90fd\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61 \u6700\u5c11\u77e5\u8bc6\u539f\u5219\uff1a\u53ea\u548c\u4f60\u7684\u5bc6\u53cb\u8c08\u8bdd \u00b6 \u51cf\u5c11\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u4f9d\u8d56\uff1b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u6742\u5ea6\u4e0e\u5f00\u53d1\u65f6\u95f4\u7684\u589e\u52a0\uff0c\u5e76\u964d\u4f4e\u8fd0\u884c\u65f6\u6027\u80fd \u597d\u83b1\u575e\u539f\u5219\uff1a\u9ad8\u5c42\u7ec4\u4ef6\u8c03\u7528\u5e95\u5c42\u7ec4\u4ef6\uff0c\u4f4e\u5c42\u7ec4\u4ef6\u4e0d\u8c03\u7528\u9ad8\u5c42\u7ec4\u4ef6 \u00b6 \u4e00\u4e2a\u7c7b\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a\u5f15\u8d77\u53d8\u5316\u7684\u539f\u56e0 \u00b6 \u5c3d\u91cf\u8ba9\u6bcf\u4e2a\u7c7b\u4fdd\u6301\u5355\u4e00\u8d23\u4efb","title":"\u8bbe\u8ba1\u539f\u5219"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_1","text":"","title":"\u627e\u51fa\u5e94\u7528\u4e2d\u53ef\u80fd\u9700\u8981\u53d8\u5316\u7684\u5730\u65b9\uff0c\u628a\u5b83\u4eec\u72ec\u7acb\u5c01\u88c5\u8d77\u6765\uff0c\u4e0d\u8981\u4e0e\u65e0\u9700\u53d8\u5316\u7684\u653e\u5728\u4e00\u8d77"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_2","text":"\u58f0\u660e\u7c7b\u65f6\u4e0d\u7528\u7406\u4f1a\u4ee5\u540e\u6267\u884c\u65f6\u7684\u771f\u6b63\u5bf9\u8c61\u7c7b\u578b","title":"\u9488\u5bf9\u63a5\u53e3\u7f16\u7a0b\uff08\u9488\u5bf9\u8d85\u7c7b\u578b\u7f16\u7a0b\uff09"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_3","text":"","title":"\u591a\u7528\u7ec4\u5408\uff0c\u5c11\u7528\u7ee7\u627f"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_4","text":"","title":"\u4e3a\u4e86\u4ea4\u4e92\u5bf9\u8c61\u4e4b\u95f4\u7684\u677e\u8026\u5408\u8bbe\u8ba1\u800c\u52aa\u529b"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_5","text":"\u65e0\u9700\u5bf9\u6bcf\u4e2a\u5730\u65b9\u90fd\u5b9e\u884c\u8fd9\u4e2a\u539f\u5219","title":"\u7c7b\u5e94\u8be5\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u5bf9\u4fee\u6539\u5173\u95ed"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_6","text":"\u4e0d\u80fd\u8ba9\u9ad8\u5c42\u7ec4\u4ef6\u4f9d\u8d56\u5e95\u5c42\u7ec4\u4ef6\uff0c\u4e24\u8005\u90fd\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61","title":"\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff1a\u8981\u4f9d\u8d56\u62bd\u8c61\uff0c\u4e0d\u8981\u4f9d\u8d56\u5177\u4f53\u7c7b"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_7","text":"\u51cf\u5c11\u4e86\u5bf9\u8c61\u4e4b\u95f4\u7684\u4f9d\u8d56\uff1b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u6742\u5ea6\u4e0e\u5f00\u53d1\u65f6\u95f4\u7684\u589e\u52a0\uff0c\u5e76\u964d\u4f4e\u8fd0\u884c\u65f6\u6027\u80fd","title":"\u6700\u5c11\u77e5\u8bc6\u539f\u5219\uff1a\u53ea\u548c\u4f60\u7684\u5bc6\u53cb\u8c08\u8bdd"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_8","text":"","title":"\u597d\u83b1\u575e\u539f\u5219\uff1a\u9ad8\u5c42\u7ec4\u4ef6\u8c03\u7528\u5e95\u5c42\u7ec4\u4ef6\uff0c\u4f4e\u5c42\u7ec4\u4ef6\u4e0d\u8c03\u7528\u9ad8\u5c42\u7ec4\u4ef6"},{"location":"\u8bbe\u8ba1\u6a21\u5f0f/\u8bbe\u8ba1\u539f\u5219/#_9","text":"\u5c3d\u91cf\u8ba9\u6bcf\u4e2a\u7c7b\u4fdd\u6301\u5355\u4e00\u8d23\u4efb","title":"\u4e00\u4e2a\u7c7b\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a\u5f15\u8d77\u53d8\u5316\u7684\u539f\u56e0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/00 linux\u5e2e\u52a9\u6587\u6863/","text":"man \u7684\u6587\u6863\u5b58\u50a8\u5728 /usr/share/man/ \u3002 info \u7684\u6587\u6863\u5b58\u50a8\u5728 /usr/share/info/ \uff0c\u975einfo\u683c\u5f0f\u7684\u6587\u6863\u4e5f\u80fd\u6253\u5f00\uff0c\u4f46\u662f\u4e0d\u5177\u6709info\u7684\u529f\u80fd\u3002 \u8f6f\u4ef6\u9644\u5e26\u6587\u6863\u5b58\u50a8\u5728 /usr/share/doc/ \u3002","title":"00 linux\u5e2e\u52a9\u6587\u6863"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/01 \u6b63\u786e\u7684\u5173\u673a\u65b9\u6cd5/","text":"1. \u5173\u673a\u4e4b\u524d\u5148\u540c\u6b65\u6570\u636e \u00b6 \u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u4e3a\u4e86\u52a0\u5feb\u6570\u636e\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u6240\u4ee5\u5728\u9ed8\u8ba4\u7684\u60c5\u51b5\u4e2d\uff0c \u67d0\u4e9b\u5df2\u7ecf\u8f7d\u5165\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c06\u4e0d\u4f1a\u76f4\u63a5\u88ab\u5199\u56de\u786c\u76d8\uff0c \u800c\u662f\u5148\u6682\u5b58\u5728\u5185\u5b58\u5f53\u4e2d\u3002 \u5c06\u6570\u636e\u540c\u6b65\u5199\u5165\u786c\u76d8\u4e2d\u7684\u6307\u4ee4\uff1a sync \u867d\u7136\u76ee\u524d\u7684 shutdown/reboot/halt \u7b49\u7b49\u6307\u4ee4\u5747\u5df2\u7ecf\u5728\u5173\u673a\u524d\u8fdb\u884c\u4e86 sync \u8fd9\u4e2a\u5de5\u5177\u7684\u8c03\u7528\uff0c\u4f46\u662f \u6700\u597d\u591a\u6267\u884c\u51e0\u6b21\u3002 2. shutdown\u6307\u4ee4 \u00b6 shutdown [ OPTIONS... ] [ \u65f6\u95f4 ] [ \u8b66\u544a\u4fe1\u606f ] OPTIONS -P --poweroff -r --reboot \u5728\u5c06\u7cfb\u7edf\u7684\u670d\u52a1\u505c\u6389\u540e\u91cd\u542f -h \u5728\u5c06\u7cfb\u7edf\u7684\u670d\u52a1\u505c\u6389\u540e\u5173\u673a -k \u4e0d\u8981 halt/power-off/reboot, \u53ea\u53d1\u9001\u8b66\u544a\u4fe1\u606f --no-wall \u5728 halt/power-off/reboot \u4e4b\u524d\u4e0d\u8981\u53d1\u751f\u8b66\u544a\u4fe1\u606f -c \u53d6\u6d88shutdown\u52a8\u4f5c \u591a\u79cd\u65f6\u95f4\u8868\u8fbe\u65b9\u5f0f\uff1a [ shark@linux ~ ] $ sudo shutdown -h 10 :15 \"shutdown machine\" # 10\u5206\u949f\u540e\u5173\u673a [ shark@linux ~ ] $ sudo shutdown -h +10 \"power off\" [ shark@linux ~ ] $ sudo shutdown -h now \"power off\" 3. \u51e0\u4e2a\u5173\u673a\u547d\u4ee4\u7684\u533a\u522b \u00b6 halt \u8fdb\u5165\u7cfb\u7edf\u505c\u6b62\u7684\u6a21\u5f0f\uff0c\u5c4f\u5e55\u53ef\u80fd\u4f1a\u4fdd\u7559 \u4e00\u4e9b\u8baf\u606f\uff0c\u8fd9\u4e0e\u4f60\u7684\u7535\u6e90\u7ba1\u7406\u6a21\u5f0f\u6709\u5173 poweroff \u8fdb\u5165\u7cfb \u7edf\u5173\u673a\u6a21\u5f0f\uff0c \u76f4\u63a5\u5173\u673a\u6ca1\u6709\u63d0\u4f9b\u7535\u529b\u5594\uff01 reboot \u76f4\u63a5\u91cd\u65b0\u5f00\u673a","title":"01 \u6b63\u786e\u7684\u5173\u673a\u65b9\u6cd5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/01 \u6b63\u786e\u7684\u5173\u673a\u65b9\u6cd5/#1","text":"\u5728Linux\u7cfb\u7edf\u4e2d\uff0c\u4e3a\u4e86\u52a0\u5feb\u6570\u636e\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u6240\u4ee5\u5728\u9ed8\u8ba4\u7684\u60c5\u51b5\u4e2d\uff0c \u67d0\u4e9b\u5df2\u7ecf\u8f7d\u5165\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c06\u4e0d\u4f1a\u76f4\u63a5\u88ab\u5199\u56de\u786c\u76d8\uff0c \u800c\u662f\u5148\u6682\u5b58\u5728\u5185\u5b58\u5f53\u4e2d\u3002 \u5c06\u6570\u636e\u540c\u6b65\u5199\u5165\u786c\u76d8\u4e2d\u7684\u6307\u4ee4\uff1a sync \u867d\u7136\u76ee\u524d\u7684 shutdown/reboot/halt \u7b49\u7b49\u6307\u4ee4\u5747\u5df2\u7ecf\u5728\u5173\u673a\u524d\u8fdb\u884c\u4e86 sync \u8fd9\u4e2a\u5de5\u5177\u7684\u8c03\u7528\uff0c\u4f46\u662f \u6700\u597d\u591a\u6267\u884c\u51e0\u6b21\u3002","title":"1. \u5173\u673a\u4e4b\u524d\u5148\u540c\u6b65\u6570\u636e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/01 \u6b63\u786e\u7684\u5173\u673a\u65b9\u6cd5/#2-shutdown","text":"shutdown [ OPTIONS... ] [ \u65f6\u95f4 ] [ \u8b66\u544a\u4fe1\u606f ] OPTIONS -P --poweroff -r --reboot \u5728\u5c06\u7cfb\u7edf\u7684\u670d\u52a1\u505c\u6389\u540e\u91cd\u542f -h \u5728\u5c06\u7cfb\u7edf\u7684\u670d\u52a1\u505c\u6389\u540e\u5173\u673a -k \u4e0d\u8981 halt/power-off/reboot, \u53ea\u53d1\u9001\u8b66\u544a\u4fe1\u606f --no-wall \u5728 halt/power-off/reboot \u4e4b\u524d\u4e0d\u8981\u53d1\u751f\u8b66\u544a\u4fe1\u606f -c \u53d6\u6d88shutdown\u52a8\u4f5c \u591a\u79cd\u65f6\u95f4\u8868\u8fbe\u65b9\u5f0f\uff1a [ shark@linux ~ ] $ sudo shutdown -h 10 :15 \"shutdown machine\" # 10\u5206\u949f\u540e\u5173\u673a [ shark@linux ~ ] $ sudo shutdown -h +10 \"power off\" [ shark@linux ~ ] $ sudo shutdown -h now \"power off\"","title":"2. shutdown\u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/01 \u6b63\u786e\u7684\u5173\u673a\u65b9\u6cd5/#3","text":"halt \u8fdb\u5165\u7cfb\u7edf\u505c\u6b62\u7684\u6a21\u5f0f\uff0c\u5c4f\u5e55\u53ef\u80fd\u4f1a\u4fdd\u7559 \u4e00\u4e9b\u8baf\u606f\uff0c\u8fd9\u4e0e\u4f60\u7684\u7535\u6e90\u7ba1\u7406\u6a21\u5f0f\u6709\u5173 poweroff \u8fdb\u5165\u7cfb \u7edf\u5173\u673a\u6a21\u5f0f\uff0c \u76f4\u63a5\u5173\u673a\u6ca1\u6709\u63d0\u4f9b\u7535\u529b\u5594\uff01 reboot \u76f4\u63a5\u91cd\u65b0\u5f00\u673a","title":"3. \u51e0\u4e2a\u5173\u673a\u547d\u4ee4\u7684\u533a\u522b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/","text":"1. \u6587\u4ef6\u79cd\u7c7b \u00b6 \u6b63\u89c4\u6587\u4ef6\uff08regular file\uff09\uff1a\u5c31\u662f\u4e00\u822c\u6211\u4eec\u5728\u8fdb\u884c\u5b58\u53d6\u7684\u7c7b\u578b\u7684\u6587\u4ef6\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a - \u3002\u6839\u636e\u6587\u4ef6\u5185\u5bb9\uff0c\u53c8\u53ef\u4ee5\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a \u7eaf\u6587\u672c\u6587\u4ef6\uff08ASCII\uff09\uff1a\u4eba\u7c7b\u53ef\u4ee5\u76f4\u63a5\u8bfb\u5230\u7684\u6570\u636e\u3002 \u4e8c\u8fdb\u5236\u6587\u4ef6\uff08binary\uff09 \u6570\u636e\u683c\u5f0f\u6587\u4ef6\uff08 data\uff09 \uff1a \u6709\u4e9b\u7a0b\u5e8f\u5728\u8fd0\u884c\u7684\u8fc7\u7a0b\u5f53\u4e2d\u4f1a\u8bfb\u53d6\u67d0\u4e9b\u7279\u5b9a\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u90a3\u4e9b\u7279\u5b9a\u683c\u5f0f\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u79f0\u4e3a\u6570\u636e\u6587\u4ef6\uff08data file\uff09\u3002 \u76ee\u5f55\uff08directory\uff09\uff1a\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a d \u3002 \u94fe\u63a5\u6587\u4ef6\uff08link\uff09\uff1a\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a l \u3002 \u8bbe\u5907\u4e0e\u8bbe\u5907\u6587\u4ef6\uff08device\uff09\uff1a\u4e0e\u7cfb\u7edf\u5468\u8fb9\u53ca\u50a8\u5b58\u7b49\u76f8\u5173\u7684\u4e00\u4e9b\u6587\u4ef6\uff0c \u901a\u5e38\u90fd\u96c6\u4e2d\u5728 /dev \u8fd9\u4e2a\u76ee \u5f55\u4e4b\u4e0b\uff01 \u901a\u5e38\u53c8\u5206\u4e3a \u4e24 \u79cd\uff1a \u533a\u5757\uff08block\uff09\u8bbe\u5907\u6587\u4ef6 \uff1a \u5c31\u662f\u4e00\u4e9b\u50a8\u5b58\u6570\u636e\uff0c \u4ee5\u63d0\u4f9b\u7cfb\u7edf\u968f\u673a\u5b58\u53d6\u7684\u5468\u8fb9\u8bbe\u5907\uff0c\u4f8b\u5982\u786c\u76d8\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a b \u3002\u4f60\u53ef\u4ee5\u968f\u673a\u7684\u5728\u786c\u76d8\u7684\u4e0d\u540c\u533a\u5757\u8bfb\u5199 \uff0c \u8fd9\u79cd\u8bbe\u5907\u5c31\u662f\u533a\u5757\u8bbe\u5907\u3002 \u5b57\u7b26\uff08character\uff09\u8bbe\u5907\u6587\u4ef6\uff1a\u4ea6\u5373\u662f\u4e00\u4e9b\u5e8f\u5217\u57e0\u7684\u5468\u8fb9\u8bbe\u5907\uff0c\u4f8b\u5982\u952e\u76d8\u3001\u9f20\u6807\u3002\u4e9b\u8bbe\u5907\u7684\u7279\u8272\u5c31\u662f\u201c\u4e00\u6b21\u6027\u8bfb\u53d6\u201d\u7684\uff0c \u4e0d\u80fd\u591f\u622a\u65ad\u8f93\u51fa\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a c \u3002 \u6570\u636e\u63a5\u53e3\u6587\u4ef6\uff08sockets\uff09\uff1a \u8fd9\u79cd\u7c7b\u578b\u7684\u6587\u4ef6\u901a\u5e38\u88ab\u7528\u5728\u7f51\u7edc\u4e0a\u7684\u6570\u636e\u627f\u63a5\u4e86\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a s \u3002 \u6570\u636e\u8f93\u9001\u6587\u4ef6\uff08 FIFO, pipe\uff09 \uff1a FIFO\u4e5f\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u4ed6\u4e3b\u8981\u7684\u76ee\u7684\u5728\u89e3\u51b3\u591a\u4e2a\u7a0b\u5e8f\u540c\u65f6\u5b58\u53d6\u4e00\u4e2a\u6587\u4ef6\u6240\u9020\u6210\u7684\u9519\u8bef\u95ee \u9898\u3002FIFO\u662f first-in-first-out \u7684\u7f29\u5199 \u3002 \u7b2c \u4e00\u4e2a\u5c5e \u6027\u4e3a p \u3002 2. \u76ee\u5f55\u7684\u6743\u9650\u89e3\u8bfb \u00b6 r\uff08read contents in directory\uff09\uff1a \u8868\u793a\u5177\u6709\u8bfb\u53d6\u76ee\u5f55\u7ed3\u6784\u6e05\u5355\u7684\u6743\u9650\uff0c \u6240\u4ee5\u5f53 \u4f60\u5177\u6709\u8bfb\u53d6\u4e00\u4e2a\u76ee\u5f55\u7684\u6743\u9650\u65f6\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u67e5\u8be2\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540d\u6570\u636e\u3002 \u6240\u4ee5\u4f60\u5c31\u53ef\u4ee5\u5229\u7528 ls \u8fd9\u4e2a\u6307\u4ee4\u5c06\u8be5\u76ee\u5f55\u7684\u5185\u5bb9\u5217\u8868\u663e\u793a\u51fa\u6765\uff01 w \uff08modify contents of directory\uff09\uff1a \u521b\u5efa\u65b0\u7684\u6587\u4ef6\u4e0e\u76ee\u5f55\uff1b \u5220\u9664\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u4e0e\u76ee\u5f55\uff08 \u4e0d\u8bba\u8be5\u6587\u4ef6\u7684\u6743\u9650\u4e3a \u4f55\uff01 \uff09 \u5c06\u5df2\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee \u5f55\u8fdb\u884c\u66f4\u540d\uff1b \u79fb\u52a8\u8be5\u76ee\u5f55\u5185\u7684\u6587\u4ef6\u3001\u76ee\u5f55\u4f4d\u7f6e\u3002 x \uff08access directory\uff09\uff1a \u4ee3\u8868\u7684\u662f\u4f7f\u7528\u8005\u80fd\u5426\u8fdb\u5165\u8be5\u76ee\u5f55\u6210\u4e3a\u5de5\u4f5c\u76ee\u5f55\u3002\u6709\u4e86\u6b64\u6743\u9650\u624d\u53ef\u4ee5\u5207\u6362\u5230\u76ee\u5f55\u3002\u5982\u679c\u4f60\u5728\u67d0\u76ee\u5f55\u4e0b\u4e0d\u5177\u6709x\u7684\u6743\u9650\uff0c \u90a3\u4e48\u4f60\u5c31\u65e0\u6cd5\u5207\u6362\u5230\u8be5\u76ee\u5f55\u4e0b\uff0c\u4e5f\u5c31 \u65e0\u6cd5\u6267\u884c\u8be5\u76ee\u5f55\u4e0b\u7684\u4efb\u4f55\u6307\u4ee4 \uff0c \u5373\u4f7f\u4f60\u5177\u6709\u8be5\u76ee\u5f55\u7684r\u6216w\u7684\u6743\u9650\u3002 \u53ea\u5177\u6709r\u6743\u9650\uff0c\u5176\u5b83\u7528\u6237\u53ef\u4ee5\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff0c\u4f46\u662f\u4e0d\u80fd\u8bfb\u53d6\u5b8c\u6574\u7684\u6587\u4ef6\u4fe1\u606f\uff1a [ root@linux tmp ] # ll drwxr-xr--. 2 root root 16 Aug 2 13 :44 test-permission [ shark@linux ~ ] $ ll /tmp/test-permission/ ls: cannot access /tmp/test-permission/t1: Permission denied total 0 -????????? ? ? ? ? ? t1 \u53ea\u5177\u6709x\u6743\u9650\uff0c\u5176\u5b83\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\uff0c\u5374\u4e0d\u80fd\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff1a [ root@linux tmp ] # ll drwxr-x--x. 2 root root 16 Aug 2 13 :44 test-permission [ shark@linux ~ ] $ ll /tmp/test-permission/ ls: cannot open directory /tmp/test-permission/: Permission denied [ shark@linux ~ ] $ ll /tmp/test-permission/t1 -rw-r--r--. 1 root root 0 Aug 2 13 :44 /tmp/test-permission/t1 3. /lost+found \u00b6 \u8fd9\u4e2a\u76ee\u5f55\u662f\u4f7f\u7528\u6807\u51c6\u7684 ext2/ext3/ext4 \u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u624d\u4f1a\u4ea7\u751f\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u76ee\u7684\u5728\u4e8e\u5f53\u6587\u4ef6\u7cfb\u7edf\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u5c06\u4e00\u4e9b\u9057\u5931\u7684\u7247\u6bb5\u653e\u7f6e\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u3002\u4e0d\u8fc7\u5982\u679c\u4f7f\u7528\u7684\u662f xfs \u6587\u4ef6\u7cfb\u7edf\u7684\u8bdd\uff0c\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e86\uff01 4. \u6839\u76ee\u5f55 \u00b6 \u8ddf\u76ee\u5f55\u4e0b\u4e5f\u6709 . \u548c .. \u4e24\u76ee\u5f55\uff0c\u4f46\u662f\u4e24\u8005\u6743\u9650\u4e0e\u5c5e\u6027\u5b8c\u5168\u76f8\u540c\u3002 \u8fd9\u4ee3\u8868\u6839\u76ee\u5f55\u7684\u4e0a\u4e00\u5c42\u4e0e\u6839\u76ee\u5f55\u81ea\u5df1\u662f\u540c\u4e00\u4e2a\u76ee\u5f55\u3002 [ shark@linux ~ ] $ ll -a / total 20 dr-xr-xr-x. 17 root root 224 Jul 31 14 :27 . dr-xr-xr-x. 17 root root 224 Jul 31 14 :27 .. 5. cp \u547d\u4ee4\u7684\u6743\u9650 \u00b6 \u9009\u9879\u4e0e\u53c2\u6570\uff1a - a \uff1a \u76f8 \u5f53 \u4e8e -dr --preserve = all \u7684\u610f\u601d\uff0c \u81f3\u4e8edr\u8bf7\u53c2\u8003\u4e0b\u5217\u8bf4\u660e\uff1b\uff08\u5e38\u7528\uff09 - d \uff1a \u82e5\u6765\u6e90\u6587\u4ef6\u4e3a\u94fe\u63a5\u6587\u4ef6\u7684\u5c5e\u6027\uff08link file\uff09\uff0c\u5219\u590d\u5236\u94fe\u63a5\u6587\u4ef6\u5c5e\u6027\u800c\u975e\u6587\u4ef6\u672c\u8eab\uff1b - f \uff1a \u4e3a\u5f3a\u5236\uff08force\uff09\u7684\u610f\u601d\uff0c\u82e5\u76ee\u6807\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u4e14\u65e0\u6cd5\u6253\u5f00\uff0c\u5219\u79fb\u9664\u540e \u518d\u5c1d\u8bd5\u4e00\u6b21\uff1b - i \uff1a \u82e5\u76ee\u6807\u6587\u4ef6\uff08destination\uff09\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u5728\u8986\u76d6\u65f6\u4f1a\u5148\u8be2\u95ee\u52a8\u4f5c\u7684\u8fdb\u884c\uff08\u5e38\u7528\uff09 - l \uff1a \u8fdb\u884c\u786c\u5f0f\u94fe\u63a5\uff08hard link\uff09\u7684\u94fe\u63a5\u6587\u4ef6\u521b\u5efa\uff0c \u800c\u975e\u590d\u5236\u6587\u4ef6\u672c\u8eab\uff1b - p \uff1a \u8fde\u540c\u6587\u4ef6\u7684\u5c5e\u6027\uff08\u6743\u9650\u3001\u7528\u6237\u3001\u65f6\u95f4\uff09\u4e00\u8d77\u590d\u5236\u8fc7\u53bb\uff0c\u800c\u975e\u4f7f\u7528\u9ed8\u8ba4\u5c5e\u6027\uff08\u5907\u4efd\u5e38\u7528\uff09\uff1b - r \uff1a \u9012\u56de\u6301\u7eed\u590d\u5236\uff0c\u7528\u4e8e\u76ee\u5f55\u7684\u590d\u5236\u884c\u4e3a\uff1b\uff08\u5e38\u7528\uff09 - s \uff1a \u590d\u5236\u6210\u4e3a\u7b26\u53f7\u94fe\u63a5\u6587\u4ef6\uff08symbolic link\uff09\uff0c\u4ea6\u5373\u201c\u6377\u5f84\u201d\u6587\u4ef6\uff1b - u \uff1a destination \u6bd4 source \u65e7\u624d\u66f4\u65b0 destination\uff0c\u6216 destination \u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u590d\u5236\u3002 - - preserve = all \uff1a \u9664\u4e86 -p \u7684\u6743\u9650\u76f8\u5173\u53c2\u6570\u5916\uff0c \u8fd8\u52a0\u5165 SELinux \u7684\u5c5e\u6027,links,xattr,all \u7b49\u4e5f\u590d\u5236\u4e86 \u3002 \u4e0d\u540c\u8eab\u4efd\u8005\u6267\u884c\u8fd9\u4e2a\u6307\u4ee4\u4f1a\u6709\u4e0d\u540c\u7684\u7ed3\u679c\u4ea7\u751f\uff0c\u5c24\u5176\u662f -a, -p \u7684\u9009\u9879\uff0c \u5bf9\u4e8e\u4e0d\u540c\u8eab\u4efd\u6765\u8bf4\uff0c\u5dee\u5f02\u975e\u5e38\u7684\u5927\uff01 \u9ed8\u8ba4\u7684\u6761\u4ef6\u4e2d \uff0c cp \u7684\u6765\u6e90\u6587\u4ef6\u4e0e\u76ee\u7684\u6587\u4ef6\u7684\u6743\u9650\u662f\u4e0d\u540c\u7684\uff0c \u76ee\u7684\u6587\u4ef6\u7684\u62e5\u6709\u8005\u901a\u5e38\u4f1a\u662f\u6307\u4ee4\u64cd\u4f5c\u8005\u672c\u8eab \u3002 [ shark@linux ~ ] $ cp -a /var/log/wtmp /tmp/wtmp_shark [ shark@linux ~ ] $ ll /tmp/wtmp_shark /var/log/wtmp -rw-rw-r--. 1 shark shark 19584 Aug 7 09 :55 /tmp/wtmp_shark -rw-rw-r--. 1 root utmp 19584 Aug 7 09 :55 /var/log/wtmp \u7531 \u4e8e shark \u7684\u8eab\u4efd\u5e76\u4e0d\u80fd\u968f\u610f\u4fee\u6539\u6587\u4ef6\u7684\u62e5\u6709\u8005\u4e0e\u7fa4\u7ec4\uff0c\u56e0\u6b64\u867d\u7136\u80fd\u591f\u590d\u5236 wtmp \u7684\u76f8\u5173\u6743\u9650\u4e0e\u65f6\u95f4\u7b49\u5c5e\u6027\uff0c\u4f46\u662f\u4e0e\u62e5\u6709\u8005\u3001\u7fa4\u7ec4\u76f8\u5173\u7684\uff0c \u539f\u672c\u8eab\u4efd\u65e0\u6cd5\u8fdb\u884c\u7684\u52a8\u4f5c\uff0c \u5373\u4f7f\u52a0\u4e0a -a \u9009\u9879\uff0c\u4e5f\u662f\u65e0\u6cd5\u8fbe\u6210\u5b8c\u6574\u590d\u5236\u6743\u9650\u7684\uff01 6. \u5220\u9664\u201c--\u201d\u5f00\u5934\u7684\u6587\u4ef6 \u00b6 \u4e0d\u80fd\u76f4\u63a5\u5220\u9664\uff0c\u9700\u8981\u6307\u5b9a\u8def\u5f84\u5220\u9664\uff1a [ shark@linux test ] $ rm -a rm: invalid option -- 'a' Try 'rm ./-a' to remove the file \u2018-a\u2019. Try 'rm --help' for more information. [ shark@linux test ] $ rm --a rm: unrecognized option '--a' Try 'rm ./--a' to remove the file \u2018--a\u2019. Try 'rm --help' for more information. \u6216\u8005\u8fd9\u6837\uff1a [ shark@linux test ] $ rm -- -a [ shark@linux test ] $ rm -- --a 7. \u7279\u6b8a\u6743\u9650 \u00b6 # t \u6743\u9650 [ sink@dev ~ ] $ ll -d /tmp/ drwxrwxrwt. 24 root root 8192 Sep 20 11 :00 /tmp/ # s\u6743\u9650 [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27832 Jun 10 2014 /usr/bin/passwd 7.1 Set UID \u00b6 \u6307\u5f53 s \u8fd9\u4e2a\u6807\u5fd7\u51fa\u73b0\u5728\u6587\u4ef6\u62e5\u6709\u8005\u7684 x \u6743\u9650\u4e0a\u7684\u60c5\u51b5\uff0c\u7b80\u79f0\u4e3a SUID \u7684\u7279\u6b8a\u6743\u9650\u3002 SUID \u6743\u9650 \u4ec5\u5bf9\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff08 binary program\uff09 \u6709\u6548 \uff0c\u5bf9shell\u811a\u672c\u53ca\u76ee\u5f55\u65e0\u6548\uff1b \u6267\u884c\u8005\u5bf9\u4e8e\u8be5\u7a0b\u5e8f\u9700\u8981\u5177\u6709 x \u7684\u53ef\u6267\u884c\u6743\u9650\uff1b \u672c\u6743\u9650\u4ec5\u5728\u6267\u884c\u8be5\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u6709\u6548 \uff08 run-time\uff09 \uff1b \u6267\u884c\u8005\u5c06\u5177\u6709\u8be5\u7a0b\u5e8f\u62e5\u6709\u8005 \uff08 owner\uff09 \u7684\u6743\u9650\u3002 \u4e3e\u4f8b\u8bf4\u660e\u4e00\u4e0b\uff1a /usr/bin/passwd \u662f\u5c5e\u4e8eroot\u7528\u6237\u7684\uff0c\u6267\u884c\u7684\u65f6\u5019\u4f1a\u53bb\u4fee\u6539 /etc/shadow \u6587\u4ef6\uff1a [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27832 Jun 10 2014 /usr/bin/passwd # \u53ef\u89c1\u8be5\u6587\u4ef6\u53ea\u6709root\u624d\u80fd\u5f3a\u5236\u4fee\u6539 [ root@dev playbooks ] # ll /etc/shadow ----------. 1 root root 1349 Nov 8 2018 /etc/shadow \u666e\u901a\u7528\u6237\u4e5f\u6709 /usr/bin/passwd \u6267\u884c\u6743\u9650\uff0c\u4f46\u662f\u5982\u679c\u662f\u666e\u901a\u7684 -rwxr-xr-x \u6743\u9650\u7684\u8bdd\uff0c\u5c31\u4f1a\u6267\u884c\u5931\u8d25\uff0c\u56e0\u4e3a\u666e\u901a\u7528\u6237\u6ca1\u6709\u5bf9 /etc/shadow \u7684\u8bfb\u5199\u6743\u9650\u3002\u6b64\u65f6 s \u6743\u9650\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\uff0c\u5b83\u53ef\u4ee5\u4f7f\u666e\u901a\u7528\u6237\u5728\u8fd0\u884c /usr/bin/passwd \u7684\u65f6\u5019 \u4e34\u65f6 \u83b7\u53d6 /usr/bin/passwd \u7684 \u62e5\u6709\u8005 root\u7684\u6743\u9650\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fee\u6539 /etc/shadow \u6587\u4ef6\u5566\u3002 7.2 Set GID \u00b6 \u4e0e SUID \u7c7b\u4f3c\uff0c SGID \u6307\u7684\u662f\u5f53 s \u8fd9\u4e2a\u6807\u5fd7\u51fa\u73b0\u5728\u7528\u6237\u7ec4\u7684 x \u6743\u9650\u4e0a\u7684\u60c5\u51b5\u3002 7.2.1 \u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e0a\u8bbe\u7f6e \u00b6 \u6267\u884c\u8005\u5bf9\u4e8e\u8be5\u7a0b\u5e8f\u9700\u8981\u5177\u6709 x \u7684\u53ef\u6267\u884c\u6743\u9650\uff1b \u6267\u884c\u8005\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u5c06\u4f1a\u83b7\u5f97\u8be5\u7a0b\u5e8f\u7fa4\u7ec4\u7684\u652f\u6301 # \u6240\u6709\u6267\u884clocate\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u4e34\u65f6\u83b7\u5f97slocate\u7ec4\u7684\u8bfb\u53d6mlocate.db\u6570\u636e\u6587\u4ef6\u6743\u9650 [ root@dev ~ ] # ll /usr/bin/locate /var/lib/mlocate/mlocate.db -rwx--s--x. 1 root slocate 40520 Apr 11 2018 /usr/bin/locate -rw-r----- 1 root slocate 14164378 Sep 23 03 :38 /var/lib/mlocate/mlocate.db 7.2.2 \u5728\u76ee\u5f55\u4e0a\u8bbe\u7f6e \u00b6 \u5f53\u4e00\u4e2a\u76ee\u5f55\u8bbe\u7f6e\u4e86 SGID \u7684\u6743\u9650\u540e\uff0c\u5b83\u5c06\u5177\u6709\u5982\u4e0b\u7684\u529f\u80fd\uff1a \u4f7f\u7528\u8005\u82e5\u5bf9\u4e8e\u6b64\u76ee\u5f55\u5177\u6709 r \u4e0e x \u7684\u6743\u9650\u65f6\uff0c\u8be5\u4f7f\u7528\u8005\u80fd\u591f\u8fdb\u5165\u6b64\u76ee\u5f55\uff1b \u4f7f\u7528\u8005\u5728\u6b64\u76ee\u5f55\u4e0b\u7684\u6709\u6548\u7fa4\u7ec4\uff08effective group\uff09\u5c06\u4f1a\u53d8\u6210\u8be5\u76ee\u5f55\u7684\u7fa4\u7ec4\uff1b \u7528\u9014\uff1a\u82e5\u4f7f\u7528\u8005\u5728\u6b64\u76ee\u5f55\u4e0b\u5177\u6709 w \u7684\u6743\u9650\uff08 \u53ef\u4ee5\u65b0\u5efa\u6587\u4ef6\uff09\uff0c\u5219\u4f7f\u7528\u8005\u6240\u521b\u5efa\u7684\u65b0\u6587\u4ef6\u7684\u7fa4\u7ec4\u4e0e\u6b64\u76ee\u5f55\u7684\u7fa4\u7ec4\u76f8\u540c \u3002 [ root@dev ~ ] # cd /tmp/ [ root@dev ~ ] # mkdir work-together [ root@dev ~ ] # chmod g+s,o=rwx work-together/ [ root@dev ~ ] # ll drwxr-srwx 2 root root 6 Sep 23 11 :16 work-together [ root@dev tmp ] # su sink [ sink@dev tmp ] $ cd work-together/ [ sink@dev work-together ] $ touch sink-file1 # \u666e\u901a\u7528\u6237sink\u521b\u5efa\u7684\u6587\u4ef6\u7684\u7528\u6237\u7ec4\u53d8\u4e3a\u4e86root\u7ec4 [ sink@dev work-together ] $ ll total 0 -rw-rw-r-- 1 sink root 0 Sep 23 11 :18 sink-file1 7.3 Sticky Bit \u00b6 SBIT \u76ee\u524d\u53ea\u9488\u5bf9\u76ee\u5f55\u6709\u6548\u3002 \u5f53\u4f7f\u7528\u8005\u5bf9\u4e8e\u6b64\u76ee\u5f55\u5177\u6709 w, x \u6743\u9650\uff0c \u4ea6\u5373\u5177\u6709\u5199\u5165\u7684\u6743\u9650\u65f6\uff0c\u5f53\u4f7f\u7528\u8005\u5728\u8be5\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\uff0c\u4ec5\u6709\u81ea\u5df1\u4e0e root \u624d \u6709\u6743\u529b\u5220\u9664\u8be5\u6587\u4ef6\u3002 [ root@dev ~ ] # cd /tmp/ [ root@dev tmp ] # ll -d /tmp/ drwxrwxrwt. 25 root root 4096 Sep 23 13 :57 /tmp/ [ root@dev tmp ] # touch root-f1 [ root@dev tmp ] # chmod 777 root-f1 [ root@dev tmp ] # ll root-f1 -rwxrwxrwx 1 root root 0 Sep 23 13 :58 root-f1 [ root@dev tmp ] # su sink [ sink@dev tmp ] $ rm -f root-f1 rm: cannot remove \u2018root-f1\u2019: Operation not permitted 7.4 \u6743\u9650\u8bbe\u7f6e \u00b6 \u4e0a\u8ff0\u7684\u6743\u9650\u53ef\u4ee5\u901a\u8fc7\u6570\u5b57\u6216MODE\uff08 [ugoa]*([-+=]([rwxXst]*|[ugo]))+|[-+=][0-7]+ \uff09\u7684\u5f62\u5f0f\u6765\u8bbe\u7f6e\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u901a\u8fc7\u6570\u5b57\u8bbe\u7f6e\u7279\u6b8a\u6743\u9650\u3002 \u5728\u666e\u901a\u6743\u9650\u76843\u4e2a\u6570\u5b57\u4e4b\u524d\u518d\u52a0\u4e00\u4e2a\u6570\u5b57\u6765\u4ee3\u8868\u7279\u6b8a\u6743\u9650\uff0c\u5206\u522b\u4e3a\uff1a 4\uff1aSUID 2\uff1aSGID 1\uff1aSBIT [ root@dev tmp ] # touch test-SUID [ root@dev tmp ] # chmod 4755 test-SUID [ root@dev tmp ] # ll test-SUID -rwsr-xr-x 1 root root 0 Sep 23 14 :32 test-SUID # \u4e5f\u53ef\u4ee5\u7ec4\u5408\u8d77\u6765\u8bbe\u7f6e [ root@dev tmp ] # chmod 6755 test-SUID [ root@dev tmp ] # ll test-SUID -rwsr-sr-x 1 root root 0 Sep 23 14 :32 test-SUID [ root@dev tmp ] # mkdir test-SBIT [ root@dev tmp ] # chmod 1755 test-SBIT/ [ root@dev tmp ] # ll -d test-SBIT/ drwxr-xr-t 2 root root 6 Sep 23 14 :36 test-SBIT/ \u5f53\u62e5\u6709\u8005\u90fd\u6ca1\u6709\u6267\u884c\u6743\u9650\u65f6\uff0c\u4f1a\u53d8\u4e3a\u5927\u5199\uff1a [ root@dev tmp ] # chmod -x test-SUID [ root@dev tmp ] # ll test-SUID -rwSr-Sr-- 1 root root 0 Sep 23 14 :32 test-SUID","title":"03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#1","text":"\u6b63\u89c4\u6587\u4ef6\uff08regular file\uff09\uff1a\u5c31\u662f\u4e00\u822c\u6211\u4eec\u5728\u8fdb\u884c\u5b58\u53d6\u7684\u7c7b\u578b\u7684\u6587\u4ef6\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a - \u3002\u6839\u636e\u6587\u4ef6\u5185\u5bb9\uff0c\u53c8\u53ef\u4ee5\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a \u7eaf\u6587\u672c\u6587\u4ef6\uff08ASCII\uff09\uff1a\u4eba\u7c7b\u53ef\u4ee5\u76f4\u63a5\u8bfb\u5230\u7684\u6570\u636e\u3002 \u4e8c\u8fdb\u5236\u6587\u4ef6\uff08binary\uff09 \u6570\u636e\u683c\u5f0f\u6587\u4ef6\uff08 data\uff09 \uff1a \u6709\u4e9b\u7a0b\u5e8f\u5728\u8fd0\u884c\u7684\u8fc7\u7a0b\u5f53\u4e2d\u4f1a\u8bfb\u53d6\u67d0\u4e9b\u7279\u5b9a\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u90a3\u4e9b\u7279\u5b9a\u683c\u5f0f\u7684\u6587\u4ef6\u53ef\u4ee5\u88ab\u79f0\u4e3a\u6570\u636e\u6587\u4ef6\uff08data file\uff09\u3002 \u76ee\u5f55\uff08directory\uff09\uff1a\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a d \u3002 \u94fe\u63a5\u6587\u4ef6\uff08link\uff09\uff1a\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a l \u3002 \u8bbe\u5907\u4e0e\u8bbe\u5907\u6587\u4ef6\uff08device\uff09\uff1a\u4e0e\u7cfb\u7edf\u5468\u8fb9\u53ca\u50a8\u5b58\u7b49\u76f8\u5173\u7684\u4e00\u4e9b\u6587\u4ef6\uff0c \u901a\u5e38\u90fd\u96c6\u4e2d\u5728 /dev \u8fd9\u4e2a\u76ee \u5f55\u4e4b\u4e0b\uff01 \u901a\u5e38\u53c8\u5206\u4e3a \u4e24 \u79cd\uff1a \u533a\u5757\uff08block\uff09\u8bbe\u5907\u6587\u4ef6 \uff1a \u5c31\u662f\u4e00\u4e9b\u50a8\u5b58\u6570\u636e\uff0c \u4ee5\u63d0\u4f9b\u7cfb\u7edf\u968f\u673a\u5b58\u53d6\u7684\u5468\u8fb9\u8bbe\u5907\uff0c\u4f8b\u5982\u786c\u76d8\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a b \u3002\u4f60\u53ef\u4ee5\u968f\u673a\u7684\u5728\u786c\u76d8\u7684\u4e0d\u540c\u533a\u5757\u8bfb\u5199 \uff0c \u8fd9\u79cd\u8bbe\u5907\u5c31\u662f\u533a\u5757\u8bbe\u5907\u3002 \u5b57\u7b26\uff08character\uff09\u8bbe\u5907\u6587\u4ef6\uff1a\u4ea6\u5373\u662f\u4e00\u4e9b\u5e8f\u5217\u57e0\u7684\u5468\u8fb9\u8bbe\u5907\uff0c\u4f8b\u5982\u952e\u76d8\u3001\u9f20\u6807\u3002\u4e9b\u8bbe\u5907\u7684\u7279\u8272\u5c31\u662f\u201c\u4e00\u6b21\u6027\u8bfb\u53d6\u201d\u7684\uff0c \u4e0d\u80fd\u591f\u622a\u65ad\u8f93\u51fa\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a c \u3002 \u6570\u636e\u63a5\u53e3\u6587\u4ef6\uff08sockets\uff09\uff1a \u8fd9\u79cd\u7c7b\u578b\u7684\u6587\u4ef6\u901a\u5e38\u88ab\u7528\u5728\u7f51\u7edc\u4e0a\u7684\u6570\u636e\u627f\u63a5\u4e86\u3002\u5c5e\u6027\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e3a s \u3002 \u6570\u636e\u8f93\u9001\u6587\u4ef6\uff08 FIFO, pipe\uff09 \uff1a FIFO\u4e5f\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u4ed6\u4e3b\u8981\u7684\u76ee\u7684\u5728\u89e3\u51b3\u591a\u4e2a\u7a0b\u5e8f\u540c\u65f6\u5b58\u53d6\u4e00\u4e2a\u6587\u4ef6\u6240\u9020\u6210\u7684\u9519\u8bef\u95ee \u9898\u3002FIFO\u662f first-in-first-out \u7684\u7f29\u5199 \u3002 \u7b2c \u4e00\u4e2a\u5c5e \u6027\u4e3a p \u3002","title":"1. \u6587\u4ef6\u79cd\u7c7b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#2","text":"r\uff08read contents in directory\uff09\uff1a \u8868\u793a\u5177\u6709\u8bfb\u53d6\u76ee\u5f55\u7ed3\u6784\u6e05\u5355\u7684\u6743\u9650\uff0c \u6240\u4ee5\u5f53 \u4f60\u5177\u6709\u8bfb\u53d6\u4e00\u4e2a\u76ee\u5f55\u7684\u6743\u9650\u65f6\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u67e5\u8be2\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540d\u6570\u636e\u3002 \u6240\u4ee5\u4f60\u5c31\u53ef\u4ee5\u5229\u7528 ls \u8fd9\u4e2a\u6307\u4ee4\u5c06\u8be5\u76ee\u5f55\u7684\u5185\u5bb9\u5217\u8868\u663e\u793a\u51fa\u6765\uff01 w \uff08modify contents of directory\uff09\uff1a \u521b\u5efa\u65b0\u7684\u6587\u4ef6\u4e0e\u76ee\u5f55\uff1b \u5220\u9664\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u4e0e\u76ee\u5f55\uff08 \u4e0d\u8bba\u8be5\u6587\u4ef6\u7684\u6743\u9650\u4e3a \u4f55\uff01 \uff09 \u5c06\u5df2\u5b58\u5728\u7684\u6587\u4ef6\u6216\u76ee \u5f55\u8fdb\u884c\u66f4\u540d\uff1b \u79fb\u52a8\u8be5\u76ee\u5f55\u5185\u7684\u6587\u4ef6\u3001\u76ee\u5f55\u4f4d\u7f6e\u3002 x \uff08access directory\uff09\uff1a \u4ee3\u8868\u7684\u662f\u4f7f\u7528\u8005\u80fd\u5426\u8fdb\u5165\u8be5\u76ee\u5f55\u6210\u4e3a\u5de5\u4f5c\u76ee\u5f55\u3002\u6709\u4e86\u6b64\u6743\u9650\u624d\u53ef\u4ee5\u5207\u6362\u5230\u76ee\u5f55\u3002\u5982\u679c\u4f60\u5728\u67d0\u76ee\u5f55\u4e0b\u4e0d\u5177\u6709x\u7684\u6743\u9650\uff0c \u90a3\u4e48\u4f60\u5c31\u65e0\u6cd5\u5207\u6362\u5230\u8be5\u76ee\u5f55\u4e0b\uff0c\u4e5f\u5c31 \u65e0\u6cd5\u6267\u884c\u8be5\u76ee\u5f55\u4e0b\u7684\u4efb\u4f55\u6307\u4ee4 \uff0c \u5373\u4f7f\u4f60\u5177\u6709\u8be5\u76ee\u5f55\u7684r\u6216w\u7684\u6743\u9650\u3002 \u53ea\u5177\u6709r\u6743\u9650\uff0c\u5176\u5b83\u7528\u6237\u53ef\u4ee5\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff0c\u4f46\u662f\u4e0d\u80fd\u8bfb\u53d6\u5b8c\u6574\u7684\u6587\u4ef6\u4fe1\u606f\uff1a [ root@linux tmp ] # ll drwxr-xr--. 2 root root 16 Aug 2 13 :44 test-permission [ shark@linux ~ ] $ ll /tmp/test-permission/ ls: cannot access /tmp/test-permission/t1: Permission denied total 0 -????????? ? ? ? ? ? t1 \u53ea\u5177\u6709x\u6743\u9650\uff0c\u5176\u5b83\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u76ee\u5f55\u4e2d\u7684\u5185\u5bb9\uff0c\u5374\u4e0d\u80fd\u83b7\u53d6\u6587\u4ef6\u5217\u8868\uff1a [ root@linux tmp ] # ll drwxr-x--x. 2 root root 16 Aug 2 13 :44 test-permission [ shark@linux ~ ] $ ll /tmp/test-permission/ ls: cannot open directory /tmp/test-permission/: Permission denied [ shark@linux ~ ] $ ll /tmp/test-permission/t1 -rw-r--r--. 1 root root 0 Aug 2 13 :44 /tmp/test-permission/t1","title":"2. \u76ee\u5f55\u7684\u6743\u9650\u89e3\u8bfb"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#3-lostfound","text":"\u8fd9\u4e2a\u76ee\u5f55\u662f\u4f7f\u7528\u6807\u51c6\u7684 ext2/ext3/ext4 \u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u624d\u4f1a\u4ea7\u751f\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u76ee\u7684\u5728\u4e8e\u5f53\u6587\u4ef6\u7cfb\u7edf\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u5c06\u4e00\u4e9b\u9057\u5931\u7684\u7247\u6bb5\u653e\u7f6e\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u3002\u4e0d\u8fc7\u5982\u679c\u4f7f\u7528\u7684\u662f xfs \u6587\u4ef6\u7cfb\u7edf\u7684\u8bdd\uff0c\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e86\uff01","title":"3. /lost+found"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#4","text":"\u8ddf\u76ee\u5f55\u4e0b\u4e5f\u6709 . \u548c .. \u4e24\u76ee\u5f55\uff0c\u4f46\u662f\u4e24\u8005\u6743\u9650\u4e0e\u5c5e\u6027\u5b8c\u5168\u76f8\u540c\u3002 \u8fd9\u4ee3\u8868\u6839\u76ee\u5f55\u7684\u4e0a\u4e00\u5c42\u4e0e\u6839\u76ee\u5f55\u81ea\u5df1\u662f\u540c\u4e00\u4e2a\u76ee\u5f55\u3002 [ shark@linux ~ ] $ ll -a / total 20 dr-xr-xr-x. 17 root root 224 Jul 31 14 :27 . dr-xr-xr-x. 17 root root 224 Jul 31 14 :27 ..","title":"4. \u6839\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#5-cp","text":"\u9009\u9879\u4e0e\u53c2\u6570\uff1a - a \uff1a \u76f8 \u5f53 \u4e8e -dr --preserve = all \u7684\u610f\u601d\uff0c \u81f3\u4e8edr\u8bf7\u53c2\u8003\u4e0b\u5217\u8bf4\u660e\uff1b\uff08\u5e38\u7528\uff09 - d \uff1a \u82e5\u6765\u6e90\u6587\u4ef6\u4e3a\u94fe\u63a5\u6587\u4ef6\u7684\u5c5e\u6027\uff08link file\uff09\uff0c\u5219\u590d\u5236\u94fe\u63a5\u6587\u4ef6\u5c5e\u6027\u800c\u975e\u6587\u4ef6\u672c\u8eab\uff1b - f \uff1a \u4e3a\u5f3a\u5236\uff08force\uff09\u7684\u610f\u601d\uff0c\u82e5\u76ee\u6807\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u4e14\u65e0\u6cd5\u6253\u5f00\uff0c\u5219\u79fb\u9664\u540e \u518d\u5c1d\u8bd5\u4e00\u6b21\uff1b - i \uff1a \u82e5\u76ee\u6807\u6587\u4ef6\uff08destination\uff09\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u5728\u8986\u76d6\u65f6\u4f1a\u5148\u8be2\u95ee\u52a8\u4f5c\u7684\u8fdb\u884c\uff08\u5e38\u7528\uff09 - l \uff1a \u8fdb\u884c\u786c\u5f0f\u94fe\u63a5\uff08hard link\uff09\u7684\u94fe\u63a5\u6587\u4ef6\u521b\u5efa\uff0c \u800c\u975e\u590d\u5236\u6587\u4ef6\u672c\u8eab\uff1b - p \uff1a \u8fde\u540c\u6587\u4ef6\u7684\u5c5e\u6027\uff08\u6743\u9650\u3001\u7528\u6237\u3001\u65f6\u95f4\uff09\u4e00\u8d77\u590d\u5236\u8fc7\u53bb\uff0c\u800c\u975e\u4f7f\u7528\u9ed8\u8ba4\u5c5e\u6027\uff08\u5907\u4efd\u5e38\u7528\uff09\uff1b - r \uff1a \u9012\u56de\u6301\u7eed\u590d\u5236\uff0c\u7528\u4e8e\u76ee\u5f55\u7684\u590d\u5236\u884c\u4e3a\uff1b\uff08\u5e38\u7528\uff09 - s \uff1a \u590d\u5236\u6210\u4e3a\u7b26\u53f7\u94fe\u63a5\u6587\u4ef6\uff08symbolic link\uff09\uff0c\u4ea6\u5373\u201c\u6377\u5f84\u201d\u6587\u4ef6\uff1b - u \uff1a destination \u6bd4 source \u65e7\u624d\u66f4\u65b0 destination\uff0c\u6216 destination \u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u590d\u5236\u3002 - - preserve = all \uff1a \u9664\u4e86 -p \u7684\u6743\u9650\u76f8\u5173\u53c2\u6570\u5916\uff0c \u8fd8\u52a0\u5165 SELinux \u7684\u5c5e\u6027,links,xattr,all \u7b49\u4e5f\u590d\u5236\u4e86 \u3002 \u4e0d\u540c\u8eab\u4efd\u8005\u6267\u884c\u8fd9\u4e2a\u6307\u4ee4\u4f1a\u6709\u4e0d\u540c\u7684\u7ed3\u679c\u4ea7\u751f\uff0c\u5c24\u5176\u662f -a, -p \u7684\u9009\u9879\uff0c \u5bf9\u4e8e\u4e0d\u540c\u8eab\u4efd\u6765\u8bf4\uff0c\u5dee\u5f02\u975e\u5e38\u7684\u5927\uff01 \u9ed8\u8ba4\u7684\u6761\u4ef6\u4e2d \uff0c cp \u7684\u6765\u6e90\u6587\u4ef6\u4e0e\u76ee\u7684\u6587\u4ef6\u7684\u6743\u9650\u662f\u4e0d\u540c\u7684\uff0c \u76ee\u7684\u6587\u4ef6\u7684\u62e5\u6709\u8005\u901a\u5e38\u4f1a\u662f\u6307\u4ee4\u64cd\u4f5c\u8005\u672c\u8eab \u3002 [ shark@linux ~ ] $ cp -a /var/log/wtmp /tmp/wtmp_shark [ shark@linux ~ ] $ ll /tmp/wtmp_shark /var/log/wtmp -rw-rw-r--. 1 shark shark 19584 Aug 7 09 :55 /tmp/wtmp_shark -rw-rw-r--. 1 root utmp 19584 Aug 7 09 :55 /var/log/wtmp \u7531 \u4e8e shark \u7684\u8eab\u4efd\u5e76\u4e0d\u80fd\u968f\u610f\u4fee\u6539\u6587\u4ef6\u7684\u62e5\u6709\u8005\u4e0e\u7fa4\u7ec4\uff0c\u56e0\u6b64\u867d\u7136\u80fd\u591f\u590d\u5236 wtmp \u7684\u76f8\u5173\u6743\u9650\u4e0e\u65f6\u95f4\u7b49\u5c5e\u6027\uff0c\u4f46\u662f\u4e0e\u62e5\u6709\u8005\u3001\u7fa4\u7ec4\u76f8\u5173\u7684\uff0c \u539f\u672c\u8eab\u4efd\u65e0\u6cd5\u8fdb\u884c\u7684\u52a8\u4f5c\uff0c \u5373\u4f7f\u52a0\u4e0a -a \u9009\u9879\uff0c\u4e5f\u662f\u65e0\u6cd5\u8fbe\u6210\u5b8c\u6574\u590d\u5236\u6743\u9650\u7684\uff01","title":"5. cp  \u547d\u4ee4\u7684\u6743\u9650"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#6-","text":"\u4e0d\u80fd\u76f4\u63a5\u5220\u9664\uff0c\u9700\u8981\u6307\u5b9a\u8def\u5f84\u5220\u9664\uff1a [ shark@linux test ] $ rm -a rm: invalid option -- 'a' Try 'rm ./-a' to remove the file \u2018-a\u2019. Try 'rm --help' for more information. [ shark@linux test ] $ rm --a rm: unrecognized option '--a' Try 'rm ./--a' to remove the file \u2018--a\u2019. Try 'rm --help' for more information. \u6216\u8005\u8fd9\u6837\uff1a [ shark@linux test ] $ rm -- -a [ shark@linux test ] $ rm -- --a","title":"6. \u5220\u9664\u201c--\u201d\u5f00\u5934\u7684\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#7","text":"# t \u6743\u9650 [ sink@dev ~ ] $ ll -d /tmp/ drwxrwxrwt. 24 root root 8192 Sep 20 11 :00 /tmp/ # s\u6743\u9650 [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27832 Jun 10 2014 /usr/bin/passwd","title":"7. \u7279\u6b8a\u6743\u9650"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#71-set-uid","text":"\u6307\u5f53 s \u8fd9\u4e2a\u6807\u5fd7\u51fa\u73b0\u5728\u6587\u4ef6\u62e5\u6709\u8005\u7684 x \u6743\u9650\u4e0a\u7684\u60c5\u51b5\uff0c\u7b80\u79f0\u4e3a SUID \u7684\u7279\u6b8a\u6743\u9650\u3002 SUID \u6743\u9650 \u4ec5\u5bf9\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff08 binary program\uff09 \u6709\u6548 \uff0c\u5bf9shell\u811a\u672c\u53ca\u76ee\u5f55\u65e0\u6548\uff1b \u6267\u884c\u8005\u5bf9\u4e8e\u8be5\u7a0b\u5e8f\u9700\u8981\u5177\u6709 x \u7684\u53ef\u6267\u884c\u6743\u9650\uff1b \u672c\u6743\u9650\u4ec5\u5728\u6267\u884c\u8be5\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u4e2d\u6709\u6548 \uff08 run-time\uff09 \uff1b \u6267\u884c\u8005\u5c06\u5177\u6709\u8be5\u7a0b\u5e8f\u62e5\u6709\u8005 \uff08 owner\uff09 \u7684\u6743\u9650\u3002 \u4e3e\u4f8b\u8bf4\u660e\u4e00\u4e0b\uff1a /usr/bin/passwd \u662f\u5c5e\u4e8eroot\u7528\u6237\u7684\uff0c\u6267\u884c\u7684\u65f6\u5019\u4f1a\u53bb\u4fee\u6539 /etc/shadow \u6587\u4ef6\uff1a [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27832 Jun 10 2014 /usr/bin/passwd # \u53ef\u89c1\u8be5\u6587\u4ef6\u53ea\u6709root\u624d\u80fd\u5f3a\u5236\u4fee\u6539 [ root@dev playbooks ] # ll /etc/shadow ----------. 1 root root 1349 Nov 8 2018 /etc/shadow \u666e\u901a\u7528\u6237\u4e5f\u6709 /usr/bin/passwd \u6267\u884c\u6743\u9650\uff0c\u4f46\u662f\u5982\u679c\u662f\u666e\u901a\u7684 -rwxr-xr-x \u6743\u9650\u7684\u8bdd\uff0c\u5c31\u4f1a\u6267\u884c\u5931\u8d25\uff0c\u56e0\u4e3a\u666e\u901a\u7528\u6237\u6ca1\u6709\u5bf9 /etc/shadow \u7684\u8bfb\u5199\u6743\u9650\u3002\u6b64\u65f6 s \u6743\u9650\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\uff0c\u5b83\u53ef\u4ee5\u4f7f\u666e\u901a\u7528\u6237\u5728\u8fd0\u884c /usr/bin/passwd \u7684\u65f6\u5019 \u4e34\u65f6 \u83b7\u53d6 /usr/bin/passwd \u7684 \u62e5\u6709\u8005 root\u7684\u6743\u9650\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fee\u6539 /etc/shadow \u6587\u4ef6\u5566\u3002","title":"7.1 Set UID"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#72-set-gid","text":"\u4e0e SUID \u7c7b\u4f3c\uff0c SGID \u6307\u7684\u662f\u5f53 s \u8fd9\u4e2a\u6807\u5fd7\u51fa\u73b0\u5728\u7528\u6237\u7ec4\u7684 x \u6743\u9650\u4e0a\u7684\u60c5\u51b5\u3002","title":"7.2 Set GID"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#721","text":"\u6267\u884c\u8005\u5bf9\u4e8e\u8be5\u7a0b\u5e8f\u9700\u8981\u5177\u6709 x \u7684\u53ef\u6267\u884c\u6743\u9650\uff1b \u6267\u884c\u8005\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u5c06\u4f1a\u83b7\u5f97\u8be5\u7a0b\u5e8f\u7fa4\u7ec4\u7684\u652f\u6301 # \u6240\u6709\u6267\u884clocate\u7684\u7528\u6237\u90fd\u53ef\u4ee5\u4e34\u65f6\u83b7\u5f97slocate\u7ec4\u7684\u8bfb\u53d6mlocate.db\u6570\u636e\u6587\u4ef6\u6743\u9650 [ root@dev ~ ] # ll /usr/bin/locate /var/lib/mlocate/mlocate.db -rwx--s--x. 1 root slocate 40520 Apr 11 2018 /usr/bin/locate -rw-r----- 1 root slocate 14164378 Sep 23 03 :38 /var/lib/mlocate/mlocate.db","title":"7.2.1 \u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e0a\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#722","text":"\u5f53\u4e00\u4e2a\u76ee\u5f55\u8bbe\u7f6e\u4e86 SGID \u7684\u6743\u9650\u540e\uff0c\u5b83\u5c06\u5177\u6709\u5982\u4e0b\u7684\u529f\u80fd\uff1a \u4f7f\u7528\u8005\u82e5\u5bf9\u4e8e\u6b64\u76ee\u5f55\u5177\u6709 r \u4e0e x \u7684\u6743\u9650\u65f6\uff0c\u8be5\u4f7f\u7528\u8005\u80fd\u591f\u8fdb\u5165\u6b64\u76ee\u5f55\uff1b \u4f7f\u7528\u8005\u5728\u6b64\u76ee\u5f55\u4e0b\u7684\u6709\u6548\u7fa4\u7ec4\uff08effective group\uff09\u5c06\u4f1a\u53d8\u6210\u8be5\u76ee\u5f55\u7684\u7fa4\u7ec4\uff1b \u7528\u9014\uff1a\u82e5\u4f7f\u7528\u8005\u5728\u6b64\u76ee\u5f55\u4e0b\u5177\u6709 w \u7684\u6743\u9650\uff08 \u53ef\u4ee5\u65b0\u5efa\u6587\u4ef6\uff09\uff0c\u5219\u4f7f\u7528\u8005\u6240\u521b\u5efa\u7684\u65b0\u6587\u4ef6\u7684\u7fa4\u7ec4\u4e0e\u6b64\u76ee\u5f55\u7684\u7fa4\u7ec4\u76f8\u540c \u3002 [ root@dev ~ ] # cd /tmp/ [ root@dev ~ ] # mkdir work-together [ root@dev ~ ] # chmod g+s,o=rwx work-together/ [ root@dev ~ ] # ll drwxr-srwx 2 root root 6 Sep 23 11 :16 work-together [ root@dev tmp ] # su sink [ sink@dev tmp ] $ cd work-together/ [ sink@dev work-together ] $ touch sink-file1 # \u666e\u901a\u7528\u6237sink\u521b\u5efa\u7684\u6587\u4ef6\u7684\u7528\u6237\u7ec4\u53d8\u4e3a\u4e86root\u7ec4 [ sink@dev work-together ] $ ll total 0 -rw-rw-r-- 1 sink root 0 Sep 23 11 :18 sink-file1","title":"7.2.2 \u5728\u76ee\u5f55\u4e0a\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#73-sticky-bit","text":"SBIT \u76ee\u524d\u53ea\u9488\u5bf9\u76ee\u5f55\u6709\u6548\u3002 \u5f53\u4f7f\u7528\u8005\u5bf9\u4e8e\u6b64\u76ee\u5f55\u5177\u6709 w, x \u6743\u9650\uff0c \u4ea6\u5373\u5177\u6709\u5199\u5165\u7684\u6743\u9650\u65f6\uff0c\u5f53\u4f7f\u7528\u8005\u5728\u8be5\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\uff0c\u4ec5\u6709\u81ea\u5df1\u4e0e root \u624d \u6709\u6743\u529b\u5220\u9664\u8be5\u6587\u4ef6\u3002 [ root@dev ~ ] # cd /tmp/ [ root@dev tmp ] # ll -d /tmp/ drwxrwxrwt. 25 root root 4096 Sep 23 13 :57 /tmp/ [ root@dev tmp ] # touch root-f1 [ root@dev tmp ] # chmod 777 root-f1 [ root@dev tmp ] # ll root-f1 -rwxrwxrwx 1 root root 0 Sep 23 13 :58 root-f1 [ root@dev tmp ] # su sink [ sink@dev tmp ] $ rm -f root-f1 rm: cannot remove \u2018root-f1\u2019: Operation not permitted","title":"7.3 Sticky Bit"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/03 \u6587\u4ef6\u7c7b\u578b\u4e0e\u76ee\u5f55\u6743\u9650/#74","text":"\u4e0a\u8ff0\u7684\u6743\u9650\u53ef\u4ee5\u901a\u8fc7\u6570\u5b57\u6216MODE\uff08 [ugoa]*([-+=]([rwxXst]*|[ugo]))+|[-+=][0-7]+ \uff09\u7684\u5f62\u5f0f\u6765\u8bbe\u7f6e\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u901a\u8fc7\u6570\u5b57\u8bbe\u7f6e\u7279\u6b8a\u6743\u9650\u3002 \u5728\u666e\u901a\u6743\u9650\u76843\u4e2a\u6570\u5b57\u4e4b\u524d\u518d\u52a0\u4e00\u4e2a\u6570\u5b57\u6765\u4ee3\u8868\u7279\u6b8a\u6743\u9650\uff0c\u5206\u522b\u4e3a\uff1a 4\uff1aSUID 2\uff1aSGID 1\uff1aSBIT [ root@dev tmp ] # touch test-SUID [ root@dev tmp ] # chmod 4755 test-SUID [ root@dev tmp ] # ll test-SUID -rwsr-xr-x 1 root root 0 Sep 23 14 :32 test-SUID # \u4e5f\u53ef\u4ee5\u7ec4\u5408\u8d77\u6765\u8bbe\u7f6e [ root@dev tmp ] # chmod 6755 test-SUID [ root@dev tmp ] # ll test-SUID -rwsr-sr-x 1 root root 0 Sep 23 14 :32 test-SUID [ root@dev tmp ] # mkdir test-SBIT [ root@dev tmp ] # chmod 1755 test-SBIT/ [ root@dev tmp ] # ll -d test-SBIT/ drwxr-xr-t 2 root root 6 Sep 23 14 :36 test-SBIT/ \u5f53\u62e5\u6709\u8005\u90fd\u6ca1\u6709\u6267\u884c\u6743\u9650\u65f6\uff0c\u4f1a\u53d8\u4e3a\u5927\u5199\uff1a [ root@dev tmp ] # chmod -x test-SUID [ root@dev tmp ] # ll test-SUID -rwSr-Sr-- 1 root root 0 Sep 23 14 :32 test-SUID","title":"7.4 \u6743\u9650\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/","text":"1. \u67e5\u9605\u6587\u4ef6\u5185\u5bb9 \u00b6 \u547d\u4ee4\uff1a nl\uff1a\u8f93\u51fa\u65f6\u663e\u793a\u884c\u53f7\u3002\u9ed8\u8ba4\u4e0d\u5217\u51fa\u7a7a\u884c\u7684\u884c\u53f7\uff0c\u4e0ecat\u76f8\u53cd\u3002 less\uff1a\u53ef\u4ee5\u5411\u524d\u7ffb\u9875\uff0cman\u8c03\u7528\u6b64\u547d\u4ee4\u663e\u793a od\uff1a\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9 head\uff1a\u884c\u6570\u4e3a\u8d1f\u6570\u65f6\uff0c\u5217\u51fa \u603b\u884c\u6570-\u884c\u6570 \u7684\u524d\u51e0\u884c \u6bd4\u5982\uff0c\u6709\u4e00\u4e2a\u6587\u4ef6\u662f100\u884c\uff0chead -n -60 file \u4f1a\u663e\u793a\u524d40\u884c\u3002 tail\uff1a\u884c\u6570\u4e3a\u6b63\u6570 +N \uff08\u6bd4\u5982+25\uff09\u65f6\uff0c\u5217\u51fa\u7b2cN\u884c\uff08\u5305\u62ec\u7b2cN\u884c\uff09\u4ee5\u540e\u7684\u884c \u6bd4\u5982\uff0c\u6709\u4e00\u4e2a\u6587\u4ef6\u662f100\u884c\uff0ctail -n +60 file \u4f1a\u663e\u793a60\u884c\u5f00\u59cb\u4ee5\u540e\u7684\u884c\u3002 \u622a\u53d6\u7b2c31~50\u884c\u4e4b\u95f4\u7684\u5185\u5bb9\uff1a [ shark@linux ~ ] $ cat -n /etc/man_db.conf | head -n 50 | tail -n +31 2. \u6587\u4ef6\u65f6\u95f4 \u00b6 modification time \uff08 mtime \uff09\uff1a \u5f53\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u53d8\u66f4\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4 status time \uff08 ctime \uff09\uff1a \u5f53\u8be5\u6587\u4ef6\u7684\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\uff0c\u4e3e\u4f8b\u6765\u8bf4\uff0c \u50cf\u662f\u6743\u9650\u4e0e \u5c5e \u6027\u88ab\u66f4\u6539\u4e86\uff0c\u90fd\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002 access time \uff08 atime \uff09\uff1a \u5f53 \u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u88ab\u53d6\u7528\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u8bfb\u53d6\u65f6\u95f4 \u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0c \u6211\u4eec\u4f7f\u7528 cat \u53bb\u8bfb\u53d6 /etc/man_db.conf\uff0c\u5c31\u4f1a\u66f4\u65b0\u8be5\u6587\u4ef6\u7684 atime \u4e86 \u3002 # \u5b9e\u9645\u4e0a\u9ed8\u8ba4\u663e\u793a\u7684\u5c31\u662fmtime\uff0c--time\u7684\u53c2\u6570\u4e2d\u6ca1\u6709\u8be5\u9009\u9879 [ shark@linux ~ ] $ ll root_data ; ll --time = atime root_data ; ll --time = ctime root_data -rw-------. 1 root root 0 Aug 1 16 :52 root_data -rw-------. 1 root root 0 Aug 1 16 :53 root_data -rw-------. 1 root root 0 Aug 7 11 :31 root_data 2.1 touch\u547d\u4ee4\u4fee\u6539\u6587\u4ef6\u65f6\u95f4 \u00b6 \u5c06\u67d0\u4e2a\u6587\u4ef6\u65e5\u671f\u4fee\u8ba2\u4e3a\u76ee\u524d\uff08mtime \u4e0e atime\uff09\u3002 3. \u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027 \u00b6 3.1 chattr \u6539\u53d8\u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027 \u00b6 \u9700\u8981\u770b\u6587\u4ef6\u7cfb\u7edf\uff08xfs\u3001ext4\u7b49\uff09\u662f\u5426\u652f\u6301\u8fd9\u4e9b\u5c5e\u6027\u3002 chattr [ - RVf ] [ -+= aAcCdDeijsStTu ] [ - v version ] files ... R\uff1a\u5bf9\u76ee\u5f55\u9012\u5f52\u5730\u6539\u53d8\u5c5e\u6027 + \uff1a \u589e\u52a0\u67d0\u4e00\u4e2a\u7279\u6b8a\u53c2\u6570\uff0c \u5176\u4ed6\u539f \u672c\u5b58\u5728\u53c2\u6570\u5219 \u4e0d\u52a8\u3002 - \uff1a \u79fb\u9664\u67d0\u4e00\u4e2a\u7279\u6b8a\u53c2\u6570\uff0c \u5176\u4ed6\u539f \u672c\u5b58\u5728\u53c2\u6570\u5219 \u4e0d\u52a8\u3002 = \uff1a\u8bbe\u7f6e\u4e00\u5b9a\uff0c \u4e14\u4ec5\u6709\u540e\u9762\u63a5\u7684\u53c2\u6570\u3002 a\uff1a \u8ba9\u4e00\u4e2a\u6587\u4ef6\u53ea\u80fd\u5728\u8ffd\u52a0\u6a21\u5f0f\u4e0b\u6253\u5f00\u4ee5\u8fdb\u884c\u5199\u5165\u3002\u4e5f\u4e0d\u80fd\u8fdb\u884c\u5220\u9664\u3001\u4fee\u6539\u7b49\u64cd\u4f5c\u3002\u53ea\u6709 root \u80fd\u8bbe\u7f6e\u6216\u6e05\u9664\u6b64\u5c5e\u6027\u3002 i\uff1a \u8ba9\u4e00\u4e2a\u6587\u4ef6\u201c\u4e0d\u80fd\u88ab\u5220\u9664\u3001\u6539\u540d\u3001\u8bbe\u7f6e\u94fe\u63a5\u3001\u65e0\u6cd5\u5199\u5165\u6216\u65b0\u589e\u6570\u636e\u3002\u53ea\u6709 root \u80fd\u8bbe\u7f6e\u6216\u6e05\u9664\u6b64\u5c5e\u6027\u3002 A\uff1a\u6709\u5b58\u53d6\u6b64\u6587\u4ef6\uff08 \u6216\u76ee\u5f55\uff09\u65f6\uff0c\u4ed6\u7684\u5b58\u53d6\u65f6\u95f4 atime \u5c06\u4e0d\u4f1a\u88ab\u4fee\u6539\uff0c\u53ef\u907f\u514d I/O \u8f83\u6162\u7684\u673a\u5668\u8fc7\u5ea6\u7684\u5b58\u53d6\u78c1\u76d8\u3002\uff08 \u76ee\u524d\u5efa\u8bae\u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u53c2\u6570\u5904\u7406\u8fd9\u4e2a\u9879\u76ee\uff09 3.2 lsattr \u663e\u793a\u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027 \u00b6 lsattr [ - RVadv ] [ files ... ] \u9009\u9879\u7c7b\u4f3c\u4e0e ls \u3002 $ chattr +i upgrade-nodes.yml.bak $ rm upgrade-nodes.yml.bak rm: remove regular file \u2018upgrade-nodes.yml.bak\u2019? y rm: cannot remove \u2018upgrade-nodes.yml.bak\u2019: Operation not permitted $ mv upgrade-nodes.yml.bak goaway mv: cannot move \u2018upgrade-nodes.yml.bak\u2019 to \u2018goaway\u2019: Operation not permitted $ lsattr upgrade-nodes.yml.bak ----i----------- upgrade-nodes.yml.bak $ chattr -i upgrade-nodes.yml.bak 4. \u5bfb\u627e\u6587\u4ef6 \u00b6 4.1 whereis \u00b6 whereis [ options ] file Options : - b search only for binaries - B < dirs > define binaries lookup path - m search only for manuals - M < dirs > define man lookup path - s search only for sources - S < dirs > define sources lookup path - f terminate < dirs > argument list - u search for unusual entries \uff0c\u67e5\u627e\u4e0d\u5728 - b \u3001 - m \u3001 - s \u4e2d\u7684\u6587\u4ef6 - l output effective lookup paths \u4e3b\u8981\u67e5\u627e\u4e8c\u8fdb\u5236\u6587\u4ef6\u548cman\u624b\u518c\u6587\u4ef6\u3002 4.2 locate \u00b6 locate [ OPTION ]... [ PATTERN ]... Search for entries in a mlocate database . - A , -- all only print entries that match all patterns - b , -- basename match only the base name of path names - c , -- count only print number of found entries - d , -- database DBPATH use DBPATH instead of default database ( which is / var / lib / mlocate / mlocate . db ) - e , -- existing only print entries for currently existing files - L , -- follow follow trailing symbolic links when checking file existence ( default ) - i , -- ignore - case ignore case distinctions when matching patterns - l , -- limit , - n LIMIT limit output ( or counting ) to LIMIT entries - P , -- nofollow , - H don ' t follow trailing symbolic links when checking file existence - 0 , -- null separate entries with NUL on output - S , -- statistics don ' t search for entries, print statistics about each used database - q , -- quiet report no error messages about reading databases - r , -- regexp REGEXP search for basic regexp REGEXP instead of patterns -- regex patterns are extended regexps - w , -- wholename match whole path name ( default ) CentOS 7.x \u662f\u6bcf\u5929\u66f4\u65b0\u6570\u636e\u5e93\u4e00\u6b21\uff0c\u4f7f\u7528 updatedb \u624b\u52a8\u66f4\u65b0\u3002 4.3 find \u00b6 find [ - H ] [ - L ] [ - P ] [ - Olevel ] [ - D help | tree | search | stat | rates | opt | exec ] [ path ...] [ expression ] \u9ed8\u8ba4\u8def\u5f84\u662f\u5f53\u524d\u76ee\u5f55\uff1b\u9ed8\u8ba4 expression \u662f - print \uff1b expression \u6709\u4ee5\u4e0b\u56db\u79cd: operators \uff08\u64cd\u4f5c\u7b26\uff09, options , tests , and actions : operators ( \u4f18\u5148\u7ea7\u662f\u9012\u51cf ;\u6ca1\u6709\u6307\u5b9a\u7684\u8bdd\u5c31\u662f -and ): \u62ec\u53f7\uff1a ( EXPR ) \u975e\uff1a ! EXPR - not EXPR \u4e0e\uff1a EXPR1 - a EXPR2 EXPR1 - and EXPR2 \u6216\uff1a EXPR1 - o EXPR2 EXPR1 - or EXPR2 EXPR1 , EXPR2 positional options ( always true ) : - daystart - follow - regextype normal options ( always true , specified before other expressions ) : - depth -- help - maxdepth LEVELS - mindepth LEVELS - mount - noleaf -- version - xautofs - xdev - ignore_readdir_race - noignore_readdir_race tests ( N can be + N or - N or N ) : - amin N - anewer FILE - atime N - cmin N - cnewer FILE - ctime N - empty - false - fstype TYPE - gid N - group NAME - ilname PATTERN - iname PATTERN - inum N - iwholename PATTERN - iregex PATTERN - links N - lname PATTERN - mmin N - mtime N \uff08 N :\u5728 N \u5929\u4e4b\u524d\u7684\u4e00\u5929\u4e4b\u5185\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff1b + N :\u5728 N \u5929\u4e4b\u524d\uff08\u4e0d\u5305\u542b N \u5929\u672c\u8eab\uff09\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff1b - N :\u5728 N \u5929\u4e4b\u5185\uff08\u5305\u542b N \u5929\u672c\u8eab\uff09\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff09 - name PATTERN - newer FILE \uff08\u5217\u51fa\u6bd4 FILE \u8fd8\u8981\u65b0\u7684\u6587\u4ef6\u6587\u4ef6\u540d\uff09 - nouser - nogroup - path PATTERN - perm [ -/ ] MODE \uff08 - MODE \uff1a\u67e5\u627e\u6743\u9650\u5305\u542b\u8be5 MODE \u7684\u6587\u4ef6\uff1b / MODE \uff1a\u67e5\u627e\u542b\u6709\u8be5 MODE \u4efb\u610f\u6743\u9650\u7684\u6587\u4ef6\u3002 MODE \u53ea\u80fd\u662f\u6570\u5b57\u8868\u793a\u6cd5\uff09 - regex PATTERN - readable - writable - executable - wholename PATTERN - size N [ bcwkMG ] - true - type [ bcdpflsD ] \uff08\u4e00\u822c\u6b63\u89c4\u6587\u4ef6\uff08 f \uff09,\u8bbe\u5907\u6587\u4ef6\uff08 b , c \uff09,\u76ee\u5f55\uff08 d \uff09,\u94fe\u63a5\u6587\u4ef6\uff08 l \uff09, socket \uff08 s \uff09 ,\u53ca FIFO \uff08 p \uff09\uff09 - uid N - used N - user NAME - xtype [ bcdpfls ] - context CONTEXT actions : - delete - print0 - printf FORMAT - fprintf FILE FORMAT - print - fprint0 FILE - fprint FILE - ls - fls FILE - prune - quit - exec COMMAND ; -exec COMMAND {} + -ok COMMAND ; - execdir COMMAND ; -execdir COMMAND {} + -okdir COMMAND ; # \u5217\u51fa\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u7684\u4eca\u5929\u6539\u52a8\u7684\u6587\u4ef6 $ find . -mtime 0 $ find . -mtime -1 # \u67e5\u627e\u5305\u542bSUID\u3001SGID\u3001SBIT\u6743\u9650\u7684\u6587\u4ef6 $ find . -perm /7000","title":"04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#1","text":"\u547d\u4ee4\uff1a nl\uff1a\u8f93\u51fa\u65f6\u663e\u793a\u884c\u53f7\u3002\u9ed8\u8ba4\u4e0d\u5217\u51fa\u7a7a\u884c\u7684\u884c\u53f7\uff0c\u4e0ecat\u76f8\u53cd\u3002 less\uff1a\u53ef\u4ee5\u5411\u524d\u7ffb\u9875\uff0cman\u8c03\u7528\u6b64\u547d\u4ee4\u663e\u793a od\uff1a\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9 head\uff1a\u884c\u6570\u4e3a\u8d1f\u6570\u65f6\uff0c\u5217\u51fa \u603b\u884c\u6570-\u884c\u6570 \u7684\u524d\u51e0\u884c \u6bd4\u5982\uff0c\u6709\u4e00\u4e2a\u6587\u4ef6\u662f100\u884c\uff0chead -n -60 file \u4f1a\u663e\u793a\u524d40\u884c\u3002 tail\uff1a\u884c\u6570\u4e3a\u6b63\u6570 +N \uff08\u6bd4\u5982+25\uff09\u65f6\uff0c\u5217\u51fa\u7b2cN\u884c\uff08\u5305\u62ec\u7b2cN\u884c\uff09\u4ee5\u540e\u7684\u884c \u6bd4\u5982\uff0c\u6709\u4e00\u4e2a\u6587\u4ef6\u662f100\u884c\uff0ctail -n +60 file \u4f1a\u663e\u793a60\u884c\u5f00\u59cb\u4ee5\u540e\u7684\u884c\u3002 \u622a\u53d6\u7b2c31~50\u884c\u4e4b\u95f4\u7684\u5185\u5bb9\uff1a [ shark@linux ~ ] $ cat -n /etc/man_db.conf | head -n 50 | tail -n +31","title":"1. \u67e5\u9605\u6587\u4ef6\u5185\u5bb9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#2","text":"modification time \uff08 mtime \uff09\uff1a \u5f53\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u53d8\u66f4\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4 status time \uff08 ctime \uff09\uff1a \u5f53\u8be5\u6587\u4ef6\u7684\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\uff0c\u4e3e\u4f8b\u6765\u8bf4\uff0c \u50cf\u662f\u6743\u9650\u4e0e \u5c5e \u6027\u88ab\u66f4\u6539\u4e86\uff0c\u90fd\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u65f6\u95f4\u3002 access time \uff08 atime \uff09\uff1a \u5f53 \u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u88ab\u53d6\u7528\u65f6\uff0c\u5c31\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u8bfb\u53d6\u65f6\u95f4 \u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0c \u6211\u4eec\u4f7f\u7528 cat \u53bb\u8bfb\u53d6 /etc/man_db.conf\uff0c\u5c31\u4f1a\u66f4\u65b0\u8be5\u6587\u4ef6\u7684 atime \u4e86 \u3002 # \u5b9e\u9645\u4e0a\u9ed8\u8ba4\u663e\u793a\u7684\u5c31\u662fmtime\uff0c--time\u7684\u53c2\u6570\u4e2d\u6ca1\u6709\u8be5\u9009\u9879 [ shark@linux ~ ] $ ll root_data ; ll --time = atime root_data ; ll --time = ctime root_data -rw-------. 1 root root 0 Aug 1 16 :52 root_data -rw-------. 1 root root 0 Aug 1 16 :53 root_data -rw-------. 1 root root 0 Aug 7 11 :31 root_data","title":"2. \u6587\u4ef6\u65f6\u95f4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#21-touch","text":"\u5c06\u67d0\u4e2a\u6587\u4ef6\u65e5\u671f\u4fee\u8ba2\u4e3a\u76ee\u524d\uff08mtime \u4e0e atime\uff09\u3002","title":"2.1 touch\u547d\u4ee4\u4fee\u6539\u6587\u4ef6\u65f6\u95f4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#3","text":"","title":"3. \u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#31-chattr","text":"\u9700\u8981\u770b\u6587\u4ef6\u7cfb\u7edf\uff08xfs\u3001ext4\u7b49\uff09\u662f\u5426\u652f\u6301\u8fd9\u4e9b\u5c5e\u6027\u3002 chattr [ - RVf ] [ -+= aAcCdDeijsStTu ] [ - v version ] files ... R\uff1a\u5bf9\u76ee\u5f55\u9012\u5f52\u5730\u6539\u53d8\u5c5e\u6027 + \uff1a \u589e\u52a0\u67d0\u4e00\u4e2a\u7279\u6b8a\u53c2\u6570\uff0c \u5176\u4ed6\u539f \u672c\u5b58\u5728\u53c2\u6570\u5219 \u4e0d\u52a8\u3002 - \uff1a \u79fb\u9664\u67d0\u4e00\u4e2a\u7279\u6b8a\u53c2\u6570\uff0c \u5176\u4ed6\u539f \u672c\u5b58\u5728\u53c2\u6570\u5219 \u4e0d\u52a8\u3002 = \uff1a\u8bbe\u7f6e\u4e00\u5b9a\uff0c \u4e14\u4ec5\u6709\u540e\u9762\u63a5\u7684\u53c2\u6570\u3002 a\uff1a \u8ba9\u4e00\u4e2a\u6587\u4ef6\u53ea\u80fd\u5728\u8ffd\u52a0\u6a21\u5f0f\u4e0b\u6253\u5f00\u4ee5\u8fdb\u884c\u5199\u5165\u3002\u4e5f\u4e0d\u80fd\u8fdb\u884c\u5220\u9664\u3001\u4fee\u6539\u7b49\u64cd\u4f5c\u3002\u53ea\u6709 root \u80fd\u8bbe\u7f6e\u6216\u6e05\u9664\u6b64\u5c5e\u6027\u3002 i\uff1a \u8ba9\u4e00\u4e2a\u6587\u4ef6\u201c\u4e0d\u80fd\u88ab\u5220\u9664\u3001\u6539\u540d\u3001\u8bbe\u7f6e\u94fe\u63a5\u3001\u65e0\u6cd5\u5199\u5165\u6216\u65b0\u589e\u6570\u636e\u3002\u53ea\u6709 root \u80fd\u8bbe\u7f6e\u6216\u6e05\u9664\u6b64\u5c5e\u6027\u3002 A\uff1a\u6709\u5b58\u53d6\u6b64\u6587\u4ef6\uff08 \u6216\u76ee\u5f55\uff09\u65f6\uff0c\u4ed6\u7684\u5b58\u53d6\u65f6\u95f4 atime \u5c06\u4e0d\u4f1a\u88ab\u4fee\u6539\uff0c\u53ef\u907f\u514d I/O \u8f83\u6162\u7684\u673a\u5668\u8fc7\u5ea6\u7684\u5b58\u53d6\u78c1\u76d8\u3002\uff08 \u76ee\u524d\u5efa\u8bae\u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u53c2\u6570\u5904\u7406\u8fd9\u4e2a\u9879\u76ee\uff09","title":"3.1 chattr\u6539\u53d8\u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#32-lsattr","text":"lsattr [ - RVadv ] [ files ... ] \u9009\u9879\u7c7b\u4f3c\u4e0e ls \u3002 $ chattr +i upgrade-nodes.yml.bak $ rm upgrade-nodes.yml.bak rm: remove regular file \u2018upgrade-nodes.yml.bak\u2019? y rm: cannot remove \u2018upgrade-nodes.yml.bak\u2019: Operation not permitted $ mv upgrade-nodes.yml.bak goaway mv: cannot move \u2018upgrade-nodes.yml.bak\u2019 to \u2018goaway\u2019: Operation not permitted $ lsattr upgrade-nodes.yml.bak ----i----------- upgrade-nodes.yml.bak $ chattr -i upgrade-nodes.yml.bak","title":"3.2 lsattr\u663e\u793a\u6587\u4ef6/\u76ee\u5f55\u9690\u85cf\u5c5e\u6027"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#4","text":"","title":"4. \u5bfb\u627e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#41-whereis","text":"whereis [ options ] file Options : - b search only for binaries - B < dirs > define binaries lookup path - m search only for manuals - M < dirs > define man lookup path - s search only for sources - S < dirs > define sources lookup path - f terminate < dirs > argument list - u search for unusual entries \uff0c\u67e5\u627e\u4e0d\u5728 - b \u3001 - m \u3001 - s \u4e2d\u7684\u6587\u4ef6 - l output effective lookup paths \u4e3b\u8981\u67e5\u627e\u4e8c\u8fdb\u5236\u6587\u4ef6\u548cman\u624b\u518c\u6587\u4ef6\u3002","title":"4.1 whereis"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#42-locate","text":"locate [ OPTION ]... [ PATTERN ]... Search for entries in a mlocate database . - A , -- all only print entries that match all patterns - b , -- basename match only the base name of path names - c , -- count only print number of found entries - d , -- database DBPATH use DBPATH instead of default database ( which is / var / lib / mlocate / mlocate . db ) - e , -- existing only print entries for currently existing files - L , -- follow follow trailing symbolic links when checking file existence ( default ) - i , -- ignore - case ignore case distinctions when matching patterns - l , -- limit , - n LIMIT limit output ( or counting ) to LIMIT entries - P , -- nofollow , - H don ' t follow trailing symbolic links when checking file existence - 0 , -- null separate entries with NUL on output - S , -- statistics don ' t search for entries, print statistics about each used database - q , -- quiet report no error messages about reading databases - r , -- regexp REGEXP search for basic regexp REGEXP instead of patterns -- regex patterns are extended regexps - w , -- wholename match whole path name ( default ) CentOS 7.x \u662f\u6bcf\u5929\u66f4\u65b0\u6570\u636e\u5e93\u4e00\u6b21\uff0c\u4f7f\u7528 updatedb \u624b\u52a8\u66f4\u65b0\u3002","title":"4.2 locate"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/04 \u6587\u4ef6\u5185\u5bb9\u67e5\u9605\u4e0e\u6587\u4ef6\u5c5e\u6027/#43-find","text":"find [ - H ] [ - L ] [ - P ] [ - Olevel ] [ - D help | tree | search | stat | rates | opt | exec ] [ path ...] [ expression ] \u9ed8\u8ba4\u8def\u5f84\u662f\u5f53\u524d\u76ee\u5f55\uff1b\u9ed8\u8ba4 expression \u662f - print \uff1b expression \u6709\u4ee5\u4e0b\u56db\u79cd: operators \uff08\u64cd\u4f5c\u7b26\uff09, options , tests , and actions : operators ( \u4f18\u5148\u7ea7\u662f\u9012\u51cf ;\u6ca1\u6709\u6307\u5b9a\u7684\u8bdd\u5c31\u662f -and ): \u62ec\u53f7\uff1a ( EXPR ) \u975e\uff1a ! EXPR - not EXPR \u4e0e\uff1a EXPR1 - a EXPR2 EXPR1 - and EXPR2 \u6216\uff1a EXPR1 - o EXPR2 EXPR1 - or EXPR2 EXPR1 , EXPR2 positional options ( always true ) : - daystart - follow - regextype normal options ( always true , specified before other expressions ) : - depth -- help - maxdepth LEVELS - mindepth LEVELS - mount - noleaf -- version - xautofs - xdev - ignore_readdir_race - noignore_readdir_race tests ( N can be + N or - N or N ) : - amin N - anewer FILE - atime N - cmin N - cnewer FILE - ctime N - empty - false - fstype TYPE - gid N - group NAME - ilname PATTERN - iname PATTERN - inum N - iwholename PATTERN - iregex PATTERN - links N - lname PATTERN - mmin N - mtime N \uff08 N :\u5728 N \u5929\u4e4b\u524d\u7684\u4e00\u5929\u4e4b\u5185\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff1b + N :\u5728 N \u5929\u4e4b\u524d\uff08\u4e0d\u5305\u542b N \u5929\u672c\u8eab\uff09\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff1b - N :\u5728 N \u5929\u4e4b\u5185\uff08\u5305\u542b N \u5929\u672c\u8eab\uff09\u88ab\u6539\u52a8\u8fc7\u7684\u6587\u4ef6\uff09 - name PATTERN - newer FILE \uff08\u5217\u51fa\u6bd4 FILE \u8fd8\u8981\u65b0\u7684\u6587\u4ef6\u6587\u4ef6\u540d\uff09 - nouser - nogroup - path PATTERN - perm [ -/ ] MODE \uff08 - MODE \uff1a\u67e5\u627e\u6743\u9650\u5305\u542b\u8be5 MODE \u7684\u6587\u4ef6\uff1b / MODE \uff1a\u67e5\u627e\u542b\u6709\u8be5 MODE \u4efb\u610f\u6743\u9650\u7684\u6587\u4ef6\u3002 MODE \u53ea\u80fd\u662f\u6570\u5b57\u8868\u793a\u6cd5\uff09 - regex PATTERN - readable - writable - executable - wholename PATTERN - size N [ bcwkMG ] - true - type [ bcdpflsD ] \uff08\u4e00\u822c\u6b63\u89c4\u6587\u4ef6\uff08 f \uff09,\u8bbe\u5907\u6587\u4ef6\uff08 b , c \uff09,\u76ee\u5f55\uff08 d \uff09,\u94fe\u63a5\u6587\u4ef6\uff08 l \uff09, socket \uff08 s \uff09 ,\u53ca FIFO \uff08 p \uff09\uff09 - uid N - used N - user NAME - xtype [ bcdpfls ] - context CONTEXT actions : - delete - print0 - printf FORMAT - fprintf FILE FORMAT - print - fprint0 FILE - fprint FILE - ls - fls FILE - prune - quit - exec COMMAND ; -exec COMMAND {} + -ok COMMAND ; - execdir COMMAND ; -execdir COMMAND {} + -okdir COMMAND ; # \u5217\u51fa\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u7684\u4eca\u5929\u6539\u52a8\u7684\u6587\u4ef6 $ find . -mtime 0 $ find . -mtime -1 # \u67e5\u627e\u5305\u542bSUID\u3001SGID\u3001SBIT\u6743\u9650\u7684\u6587\u4ef6 $ find . -perm /7000","title":"4.3 find"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/","text":"1. EXT\u6587\u4ef6\u7cfb\u7edf \u00b6 \u4e0b\u9762\u6309\u987a\u5e8f\u4ecb\u7ecd\uff1a 1.1 data block \u00b6 \u5b58\u653e\u6570\u636e\u7684\u5730\u65b9\u3002 \u683c\u5f0f\u5316\u5b8c\u6210\u4e4b\u540eblock\u7684\u5927\u5c0f\u4e0e\u6570\u91cf\u5c31\u56fa\u5b9a\u4e86\u3002 \u4e00\u4e2ablock\u5185\u53ea\u80fd\u5b58\u653e\u4e00\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u3002\u82e5\u6587\u4ef6\u5c0f\u4e8eblock\uff0c\u90a3\u4e48\u4f1a\u9020\u6210\u7a7a\u95f4\u6d6a\u8d39\u3002 1.2 inode table \u00b6 inode\u4e3b\u8981\u8bb0\u5f55\u7684\u6570\u636e\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6587\u4ef6\u7684\u8bfb\u3001\u5199\u3001\u6267\u884c\u6743\u9650 \u6587\u4ef6\u7684\u6240\u5c5e\u7528\u6237\u3001\u7ec4 \u6587\u4ef6\u7684\u5bb9\u91cf \u6587\u4ef6\u7684\u521b\u5efa\u65f6\u95f4\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6700\u540e\u7684\u8bfb\u53d6\u65f6\u95f4 \u6587\u4ef6\u7684\u9690\u85cf\u5c5e\u6027\uff08SUID\uff0cSGID\uff0cSBIT\uff09 \u6587\u4ef6\u5185\u5bb9\u6307\u5411\u7684block \u7279\u6027\uff1a \u6bcf\u4e2a\u6587\u4ef6\u53ea\u5360\u7528\u4e00\u4e2ainode \u683c\u5f0f\u5316\u4e4b\u540e\u6bcf\u4e2ainode\u7684\u5927\u5c0f\u90fd\u662f\u76f8\u540c\u7684 1.3 inode bitmap \u00b6 \u8bb0\u5f55\u5df2\u4f7f\u7528\u4e0e\u672a\u4f7f\u7528\u7684inode\u53f7\u3002 1.4 block bitmap \u00b6 \u8bb0\u5f55\u5df2\u4f7f\u7528\u4e0e\u672a\u4f7f\u7528\u7684block\u53f7\u3002 1.5 \u6587\u4ef6\u7cfb\u7edf\u63cf\u8ff0 \u00b6 \u63cf\u8ff0\u6bcf\u4e2ablock group\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\u7684block\u53f7\uff0c\u4ee5\u53ca\u8bf4\u660e\u6bcf\u4e2a\u533a\u6bb5\u5206\u522b\u4ecb\u4e8e\u54ea\u4e2ablock\u4e4b\u95f4\u3002 1.6 superblock \u00b6 \u8bb0\u5f55\u7684\u662f\u6574\u4e2afiesystem\u7684\u4fe1\u606f\uff0c\u4e3b\u8981\u6709\uff1a \u5168\u90e8\u7684inode\u3001block\u7684\u6570\u91cf \u672a\u4f7f\u7528\u548c\u5df2\u4f7f\u7528\u7684inode\u3001block\u7684\u6570\u91cf inode\u3001block\u7684\u5927\u5c0f \u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u53ef\u80fd\u4e0d\u53ea\u6709\u4e00\u4e2asuperblock\uff0c\u5176\u4f59\u7684\u662f\u7b2c\u4e00\u4e2asuperblock\u7684\u5907\u4efd\u3002 1.7 EXT\u7684\u67e5\u770b \u00b6 \u4f7f\u7528 blkid \u547d\u4ee4\u53ef\u4ee5\u5217\u51fa\u683c\u5f0f\u5316\u7684\u5206\u533a\uff1b\u4f7f\u7528 dumpe2fs \u547d\u4ee4\u53ef\u4ee5\u67e5\u8be2ext\u5bb6\u65cf\u7684\u78c1\u76d8\u4fe1\u606f\u3002 [ root@dev tmp ] # blkid /dev/sda1: UUID = \"decc4fd4-a5a2-487d-bcdc-9125218509c4\" TYPE = \"xfs\" /dev/sda2: UUID = \"rYAGTT-BICS-GotJ-tQR0-dx3q-hcR0-ZTwDgv\" TYPE = \"LVM2_member\" /dev/sdb1: UUID = \"fC445p-tGHZ-ULDg-oQOJ-jSQa-mVtR-Q0KQfN\" TYPE = \"LVM2_member\" /dev/mapper/cl_vdsm--dev-root: UUID = \"77579961-708a-449b-ac26-3f30f16fbfb5\" TYPE = \"xfs\" /dev/mapper/cl_vdsm--dev-swap: UUID = \"66ef502a-63c0-4d37-b69a-c0ced8436c8f\" TYPE = \"swap\" /dev/mapper/cl_vdsm--dev-test_lv: UUID = \"8192f79a-5fed-451c-bac8-5fadecb467da\" TYPE = \"ext2\" /dev/sr0: PTTYPE = \"PMBR\" [ root@dev tmp ] # dumpe2fs /dev/mapper/cl_vdsm--dev-test_lv 1.8 \u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf \u00b6 inode table\u4e0edata block\u6210\u4e3a\u6570\u636e\u5b58\u653e\u533a\u57df\uff1b\u5176\u5b83\u7684\u533a\u6bb5\u79f0\u4e3ametadata\u3002 \u65b0\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\u53d1\u751f\u7684\u52a8\u4f5c\uff1a \u5148\u786e\u8ba4\u7528\u6237\u5bf9\u65b0\u5efa\u6587\u4ef6\u7684\u76ee\u5f55\u6743\u9650\uff08w\u3001x\uff09\uff0c\u901a\u8fc7\u4e86\u624d\u80fd\u65b0\u5efa \u6839\u636einode bitmap\u627e\u5230\u672a\u4f7f\u7528\u7684inode\u53f7\uff0c\u5c06\u65b0\u6587\u4ef6\u7684\u5c5e\u6027\u3001\u6743\u9650\u5199\u5165inode \u6839\u636eblock bitmap\u627e\u5230\u672a\u4f7f\u7528\u7684block\u53f7\uff0c\u5c06\u6587\u4ef6\u5185\u5bb9\u5199\u5165block\uff0c\u5e76\u66f4\u65b0inode\u7684block\u6307\u5411\u6570\u636e \u5c06\u521a\u521a\u5199\u5165\u7684inode\u548cblock\u6570\u636e\u540c\u6b65\u5230bitmap\uff0c\u5e76\u66f4\u65b0superblock \u4e3a\u4e86\u907f\u514d\u4e0a\u8ff0\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u610f\u5916\u60c5\u51b5\u800c\u5bfc\u81f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u51fa\u73b0\u4e86\u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728filesystem\u4e2d\u5212\u5206\u51fa\u4e00\u4e2a\u4e13\u95e8\u8bb0\u5f55\u5199\u5165\u4e0e\u4fee\u6539\u6587\u4ef6\u65f6\u7684\u6b65\u9aa4\uff0c\u6765\u7b80\u5316\u4e00\u81f4\u6027\u68c0\u67e5\u7684\u6b65\u9aa4\uff1a \u9884\u5907\uff1a\u5f53\u7cfb\u7edf\u8981\u5199\u5165\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u4f1a\u5148\u5728\u65e5\u5fd7\u8bb0\u5f55\u533a\u5757\u4e2d\u8bb0\u5f55\u8981\u5199\u5165\u7684\u4fe1\u606f \u5199\u5165\uff1a\u5f00\u59cb\u5199\u5165\u6587\u4ef6\u7684\u6743\u9650\u4e0e\u6570\u636e\uff1b\u5f00\u59cb\u66f4\u65b0metadata\u6570\u636e \u7ed3\u675f\uff1a\u5b8c\u6210\u5199\u5165\u4e4b\u540e\uff0c\u5728\u65e5\u5fd7\u8bb0\u5f55\u533a\u5757\u4e2d\u5b8c\u6210\u8be5\u6587\u4ef6\u7684\u8bb0\u5f55 2. XFS\u6587\u4ef6\u7cfb\u7edf \u00b6 EXT\u5bb6\u65cf\u6700\u5927\u7684\u95ee\u9898\u662f\u683c\u5f0f\u5316\u8fc7\u6162\u3002\u5728\u683c\u5f0f\u5316\u65f6\u5c31\u9884\u5206\u914d\u597d\u6240\u6709\u7684inode\u3001block\u7b49\u6570\u636e\uff0c\u5982\u679c\u78c1\u76d8\u5f88\u5927\u7684\u8bdd\uff0c\u5c31\u4f1a\u683c\u5f0f\u5316\u597d\u957f\u65f6\u95f4\u3002XFS\u4e5f\u662f\u4e00\u4e2a\u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u9ad8\u5bb9\u91cf\u78c1\u76d8\u548c\u9ad8\u6027\u80fd\u6587\u4ef6\u7cfb\u7edf\u3002 xfs\u4e3b\u8981\u5212\u5206\u4e3a\u4e09\u4e2a\u533a\u57df\uff1a\u6570\u636e\u533a\uff08data section\uff09\u3001\u6d3b\u52a8\u767b\u5f55\u533a\uff08log section\uff09\u548c\u5b9e\u65f6\u8fd0\u4f5c\u533a\uff08realtime section\uff09\u3002 2.1 \u6570\u636e\u533a \u00b6 \u4e0eext\u7c7b\u4f3c\uff0c\u4e5f\u5206\u4e3a\u591a\u4e2a\u5b58\u50a8\u533a\u7fa4\u7ec4\uff08allocation groups\uff09\u6765\u5206\u522b\u653e\u7f6efs\u6240\u9700\u7684\u6570\u636e\u3002\u6bcf\u4e2a\u7fa4\u7ec4\u90fd\u5305\u542b\u4e86\uff1a \u6574\u4e2afs\u7684superblock \u5269\u4f59\u7a7a\u95f4\u7684\u7ba1\u7406\u673a\u5236 inode\u7684\u5206\u914d\u4e0e\u8ffd\u8e2a inode\u4e0eblock\u5728\u9700\u8981\u7684\u65f6\u5019\u624d\u4f1a\u52a8\u6001\u914d\u7f6e\u4ea7\u751f\uff0c\u6545\u683c\u5f0f\u5316\u7684\u52a8\u4f5c\u5f88\u5feb\u3002 2.2 \u6d3b\u52a8\u767b\u5f55\u533a \u00b6 \u7c7b\u4f3c\u4e0eext\u7684\u65e5\u5fd7\u533a\u7c7b\u4f3c\u3002\u8fd9\u91cc\u4f1a\u8bb0\u5f55\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u76f4\u5230\u6539\u53d8\u540e\u5b8c\u5168\u88ab\u5199\u5165\u5230\u6570\u636e\u533a\u4e4b\u540e\u624d\u7ec8\u7ed3\u8be5\u8bb0\u5f55\u3002 \u53ef\u4ee5\u6307\u5b9a\u5916\u90e8\u7684\u78c1\u76d8\u4f5c\u4e3axfs\u7684\u767b\u5f55\u533a\u3002 2.3 \u5b9e\u65f6\u8fd0\u4f5c\u533a \u00b6 \u5f53\u6587\u4ef6\u8981\u88ab\u5efa\u7acb\u65f6\uff0c\u5148\u5728\u6b64\u533a\u627e\u4e00\u4e2a\u6216\u591a\u4e2aextent\u533a\u5757\uff0c\u5c06\u6587\u4ef6\u653e\u5728\u8fd9\u4e9b\u533a\u5757\u4e2d\uff0c\u7b49inode\u4e0eblock\u5206\u914d\u5b8c\u6bd5\u4e4b\u540e\uff0c\u518d\u5199\u5165\u5230\u6570\u636e\u533a\u3002\u6b64\u533a\u7684\u5927\u5c0f\u9700\u8981\u5728\u683c\u5f0f\u5316\u7684\u65f6\u5019\u5c31\u6307\u5b9a\uff0c4K~1G\uff0c\u975e\u78c1\u76d8\u9635\u5217\u7684\u9ed8\u8ba464K\u3002 2.4 XFS\u7684\u67e5\u770b \u00b6 \u4f7f\u7528 xfs_info \u5373\u53ef\u3002 [ root@dev tmp ] # xfs_info /dev/sda1 meta-data = /dev/sda1 isize = 512 agcount = 4 , agsize = 65536 blks = sectsz = 512 attr = 2 , projid32bit = 1 = crc = 1 finobt = 0 spinodes = 0 data = bsize = 4096 blocks = 262144 , imaxpct = 25 = sunit = 0 swidth = 0 blks naming = version 2 bsize = 4096 ascii-ci = 0 ftype = 1 log = internal bsize = 4096 blocks = 2560 , version = 2 = sectsz = 512 sunit = 0 blks, lazy-count = 1 realtime = none extsz = 4096 blocks = 0 , rtextents = 0 \u4f7f\u7528 df -Tha \u547d\u4ee4\u65f6\u4f1a\u53d1\u73b0\u4e00\u4e2a /dev/shm \u7684\u6302\u8f7d\u70b9\uff0c\u8fd9\u662f \u5229\u7528\u5185\u5b58\u865a\u62df\u51fa\u6765\u7684\u7a7a\u95f4 \uff0c\u901a\u5e38\u662f\u603b\u7269\u7406\u5185\u5b58\u7684\u4e00\u534a\uff0c\u56e0\u6b64\u5728\u6b64\u76ee\u5f55\u4e0b\u7684\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\u3002","title":"05 \u6587\u4ef6\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#1-ext","text":"\u4e0b\u9762\u6309\u987a\u5e8f\u4ecb\u7ecd\uff1a","title":"1. EXT\u6587\u4ef6\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#11-data-block","text":"\u5b58\u653e\u6570\u636e\u7684\u5730\u65b9\u3002 \u683c\u5f0f\u5316\u5b8c\u6210\u4e4b\u540eblock\u7684\u5927\u5c0f\u4e0e\u6570\u91cf\u5c31\u56fa\u5b9a\u4e86\u3002 \u4e00\u4e2ablock\u5185\u53ea\u80fd\u5b58\u653e\u4e00\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u3002\u82e5\u6587\u4ef6\u5c0f\u4e8eblock\uff0c\u90a3\u4e48\u4f1a\u9020\u6210\u7a7a\u95f4\u6d6a\u8d39\u3002","title":"1.1 data block"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#12-inode-table","text":"inode\u4e3b\u8981\u8bb0\u5f55\u7684\u6570\u636e\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a \u6587\u4ef6\u7684\u8bfb\u3001\u5199\u3001\u6267\u884c\u6743\u9650 \u6587\u4ef6\u7684\u6240\u5c5e\u7528\u6237\u3001\u7ec4 \u6587\u4ef6\u7684\u5bb9\u91cf \u6587\u4ef6\u7684\u521b\u5efa\u65f6\u95f4\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6700\u540e\u7684\u8bfb\u53d6\u65f6\u95f4 \u6587\u4ef6\u7684\u9690\u85cf\u5c5e\u6027\uff08SUID\uff0cSGID\uff0cSBIT\uff09 \u6587\u4ef6\u5185\u5bb9\u6307\u5411\u7684block \u7279\u6027\uff1a \u6bcf\u4e2a\u6587\u4ef6\u53ea\u5360\u7528\u4e00\u4e2ainode \u683c\u5f0f\u5316\u4e4b\u540e\u6bcf\u4e2ainode\u7684\u5927\u5c0f\u90fd\u662f\u76f8\u540c\u7684","title":"1.2 inode table"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#13-inode-bitmap","text":"\u8bb0\u5f55\u5df2\u4f7f\u7528\u4e0e\u672a\u4f7f\u7528\u7684inode\u53f7\u3002","title":"1.3 inode bitmap"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#14-block-bitmap","text":"\u8bb0\u5f55\u5df2\u4f7f\u7528\u4e0e\u672a\u4f7f\u7528\u7684block\u53f7\u3002","title":"1.4 block bitmap"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#15","text":"\u63cf\u8ff0\u6bcf\u4e2ablock group\u7684\u5f00\u59cb\u4e0e\u7ed3\u675f\u7684block\u53f7\uff0c\u4ee5\u53ca\u8bf4\u660e\u6bcf\u4e2a\u533a\u6bb5\u5206\u522b\u4ecb\u4e8e\u54ea\u4e2ablock\u4e4b\u95f4\u3002","title":"1.5 \u6587\u4ef6\u7cfb\u7edf\u63cf\u8ff0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#16-superblock","text":"\u8bb0\u5f55\u7684\u662f\u6574\u4e2afiesystem\u7684\u4fe1\u606f\uff0c\u4e3b\u8981\u6709\uff1a \u5168\u90e8\u7684inode\u3001block\u7684\u6570\u91cf \u672a\u4f7f\u7528\u548c\u5df2\u4f7f\u7528\u7684inode\u3001block\u7684\u6570\u91cf inode\u3001block\u7684\u5927\u5c0f \u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u53ef\u80fd\u4e0d\u53ea\u6709\u4e00\u4e2asuperblock\uff0c\u5176\u4f59\u7684\u662f\u7b2c\u4e00\u4e2asuperblock\u7684\u5907\u4efd\u3002","title":"1.6 superblock"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#17-ext","text":"\u4f7f\u7528 blkid \u547d\u4ee4\u53ef\u4ee5\u5217\u51fa\u683c\u5f0f\u5316\u7684\u5206\u533a\uff1b\u4f7f\u7528 dumpe2fs \u547d\u4ee4\u53ef\u4ee5\u67e5\u8be2ext\u5bb6\u65cf\u7684\u78c1\u76d8\u4fe1\u606f\u3002 [ root@dev tmp ] # blkid /dev/sda1: UUID = \"decc4fd4-a5a2-487d-bcdc-9125218509c4\" TYPE = \"xfs\" /dev/sda2: UUID = \"rYAGTT-BICS-GotJ-tQR0-dx3q-hcR0-ZTwDgv\" TYPE = \"LVM2_member\" /dev/sdb1: UUID = \"fC445p-tGHZ-ULDg-oQOJ-jSQa-mVtR-Q0KQfN\" TYPE = \"LVM2_member\" /dev/mapper/cl_vdsm--dev-root: UUID = \"77579961-708a-449b-ac26-3f30f16fbfb5\" TYPE = \"xfs\" /dev/mapper/cl_vdsm--dev-swap: UUID = \"66ef502a-63c0-4d37-b69a-c0ced8436c8f\" TYPE = \"swap\" /dev/mapper/cl_vdsm--dev-test_lv: UUID = \"8192f79a-5fed-451c-bac8-5fadecb467da\" TYPE = \"ext2\" /dev/sr0: PTTYPE = \"PMBR\" [ root@dev tmp ] # dumpe2fs /dev/mapper/cl_vdsm--dev-test_lv","title":"1.7 EXT\u7684\u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#18","text":"inode table\u4e0edata block\u6210\u4e3a\u6570\u636e\u5b58\u653e\u533a\u57df\uff1b\u5176\u5b83\u7684\u533a\u6bb5\u79f0\u4e3ametadata\u3002 \u65b0\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\u53d1\u751f\u7684\u52a8\u4f5c\uff1a \u5148\u786e\u8ba4\u7528\u6237\u5bf9\u65b0\u5efa\u6587\u4ef6\u7684\u76ee\u5f55\u6743\u9650\uff08w\u3001x\uff09\uff0c\u901a\u8fc7\u4e86\u624d\u80fd\u65b0\u5efa \u6839\u636einode bitmap\u627e\u5230\u672a\u4f7f\u7528\u7684inode\u53f7\uff0c\u5c06\u65b0\u6587\u4ef6\u7684\u5c5e\u6027\u3001\u6743\u9650\u5199\u5165inode \u6839\u636eblock bitmap\u627e\u5230\u672a\u4f7f\u7528\u7684block\u53f7\uff0c\u5c06\u6587\u4ef6\u5185\u5bb9\u5199\u5165block\uff0c\u5e76\u66f4\u65b0inode\u7684block\u6307\u5411\u6570\u636e \u5c06\u521a\u521a\u5199\u5165\u7684inode\u548cblock\u6570\u636e\u540c\u6b65\u5230bitmap\uff0c\u5e76\u66f4\u65b0superblock \u4e3a\u4e86\u907f\u514d\u4e0a\u8ff0\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u610f\u5916\u60c5\u51b5\u800c\u5bfc\u81f4\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0c\u51fa\u73b0\u4e86\u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728filesystem\u4e2d\u5212\u5206\u51fa\u4e00\u4e2a\u4e13\u95e8\u8bb0\u5f55\u5199\u5165\u4e0e\u4fee\u6539\u6587\u4ef6\u65f6\u7684\u6b65\u9aa4\uff0c\u6765\u7b80\u5316\u4e00\u81f4\u6027\u68c0\u67e5\u7684\u6b65\u9aa4\uff1a \u9884\u5907\uff1a\u5f53\u7cfb\u7edf\u8981\u5199\u5165\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u4f1a\u5148\u5728\u65e5\u5fd7\u8bb0\u5f55\u533a\u5757\u4e2d\u8bb0\u5f55\u8981\u5199\u5165\u7684\u4fe1\u606f \u5199\u5165\uff1a\u5f00\u59cb\u5199\u5165\u6587\u4ef6\u7684\u6743\u9650\u4e0e\u6570\u636e\uff1b\u5f00\u59cb\u66f4\u65b0metadata\u6570\u636e \u7ed3\u675f\uff1a\u5b8c\u6210\u5199\u5165\u4e4b\u540e\uff0c\u5728\u65e5\u5fd7\u8bb0\u5f55\u533a\u5757\u4e2d\u5b8c\u6210\u8be5\u6587\u4ef6\u7684\u8bb0\u5f55","title":"1.8 \u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#2-xfs","text":"EXT\u5bb6\u65cf\u6700\u5927\u7684\u95ee\u9898\u662f\u683c\u5f0f\u5316\u8fc7\u6162\u3002\u5728\u683c\u5f0f\u5316\u65f6\u5c31\u9884\u5206\u914d\u597d\u6240\u6709\u7684inode\u3001block\u7b49\u6570\u636e\uff0c\u5982\u679c\u78c1\u76d8\u5f88\u5927\u7684\u8bdd\uff0c\u5c31\u4f1a\u683c\u5f0f\u5316\u597d\u957f\u65f6\u95f4\u3002XFS\u4e5f\u662f\u4e00\u4e2a\u65e5\u5fd7\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u4e8e\u9ad8\u5bb9\u91cf\u78c1\u76d8\u548c\u9ad8\u6027\u80fd\u6587\u4ef6\u7cfb\u7edf\u3002 xfs\u4e3b\u8981\u5212\u5206\u4e3a\u4e09\u4e2a\u533a\u57df\uff1a\u6570\u636e\u533a\uff08data section\uff09\u3001\u6d3b\u52a8\u767b\u5f55\u533a\uff08log section\uff09\u548c\u5b9e\u65f6\u8fd0\u4f5c\u533a\uff08realtime section\uff09\u3002","title":"2. XFS\u6587\u4ef6\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#21","text":"\u4e0eext\u7c7b\u4f3c\uff0c\u4e5f\u5206\u4e3a\u591a\u4e2a\u5b58\u50a8\u533a\u7fa4\u7ec4\uff08allocation groups\uff09\u6765\u5206\u522b\u653e\u7f6efs\u6240\u9700\u7684\u6570\u636e\u3002\u6bcf\u4e2a\u7fa4\u7ec4\u90fd\u5305\u542b\u4e86\uff1a \u6574\u4e2afs\u7684superblock \u5269\u4f59\u7a7a\u95f4\u7684\u7ba1\u7406\u673a\u5236 inode\u7684\u5206\u914d\u4e0e\u8ffd\u8e2a inode\u4e0eblock\u5728\u9700\u8981\u7684\u65f6\u5019\u624d\u4f1a\u52a8\u6001\u914d\u7f6e\u4ea7\u751f\uff0c\u6545\u683c\u5f0f\u5316\u7684\u52a8\u4f5c\u5f88\u5feb\u3002","title":"2.1 \u6570\u636e\u533a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#22","text":"\u7c7b\u4f3c\u4e0eext\u7684\u65e5\u5fd7\u533a\u7c7b\u4f3c\u3002\u8fd9\u91cc\u4f1a\u8bb0\u5f55\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u76f4\u5230\u6539\u53d8\u540e\u5b8c\u5168\u88ab\u5199\u5165\u5230\u6570\u636e\u533a\u4e4b\u540e\u624d\u7ec8\u7ed3\u8be5\u8bb0\u5f55\u3002 \u53ef\u4ee5\u6307\u5b9a\u5916\u90e8\u7684\u78c1\u76d8\u4f5c\u4e3axfs\u7684\u767b\u5f55\u533a\u3002","title":"2.2 \u6d3b\u52a8\u767b\u5f55\u533a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#23","text":"\u5f53\u6587\u4ef6\u8981\u88ab\u5efa\u7acb\u65f6\uff0c\u5148\u5728\u6b64\u533a\u627e\u4e00\u4e2a\u6216\u591a\u4e2aextent\u533a\u5757\uff0c\u5c06\u6587\u4ef6\u653e\u5728\u8fd9\u4e9b\u533a\u5757\u4e2d\uff0c\u7b49inode\u4e0eblock\u5206\u914d\u5b8c\u6bd5\u4e4b\u540e\uff0c\u518d\u5199\u5165\u5230\u6570\u636e\u533a\u3002\u6b64\u533a\u7684\u5927\u5c0f\u9700\u8981\u5728\u683c\u5f0f\u5316\u7684\u65f6\u5019\u5c31\u6307\u5b9a\uff0c4K~1G\uff0c\u975e\u78c1\u76d8\u9635\u5217\u7684\u9ed8\u8ba464K\u3002","title":"2.3 \u5b9e\u65f6\u8fd0\u4f5c\u533a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/05 \u6587\u4ef6\u7cfb\u7edf/#24-xfs","text":"\u4f7f\u7528 xfs_info \u5373\u53ef\u3002 [ root@dev tmp ] # xfs_info /dev/sda1 meta-data = /dev/sda1 isize = 512 agcount = 4 , agsize = 65536 blks = sectsz = 512 attr = 2 , projid32bit = 1 = crc = 1 finobt = 0 spinodes = 0 data = bsize = 4096 blocks = 262144 , imaxpct = 25 = sunit = 0 swidth = 0 blks naming = version 2 bsize = 4096 ascii-ci = 0 ftype = 1 log = internal bsize = 4096 blocks = 2560 , version = 2 = sectsz = 512 sunit = 0 blks, lazy-count = 1 realtime = none extsz = 4096 blocks = 0 , rtextents = 0 \u4f7f\u7528 df -Tha \u547d\u4ee4\u65f6\u4f1a\u53d1\u73b0\u4e00\u4e2a /dev/shm \u7684\u6302\u8f7d\u70b9\uff0c\u8fd9\u662f \u5229\u7528\u5185\u5b58\u865a\u62df\u51fa\u6765\u7684\u7a7a\u95f4 \uff0c\u901a\u5e38\u662f\u603b\u7269\u7406\u5185\u5b58\u7684\u4e00\u534a\uff0c\u56e0\u6b64\u5728\u6b64\u76ee\u5f55\u4e0b\u7684\u6570\u636e\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\u3002","title":"2.4 XFS\u7684\u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/","text":"1. \u67e5\u770b \u00b6 1.1 lsblk \u00b6 lsblk \uff08list block device\uff09\u53ef\u4ee5\u67e5\u770b\u78c1\u76d8\u3002 lsblk [ options ] [ <device> ... ] - i \u53ea\u4f7f\u7528ascii\u5b57\u7b26\u8f93\u51fa - p \u6253\u5370\u5b8c\u6574\u8bbe\u5907\u540d\u79f0 - o --output \u5b9a\u5236\u8f93\u51fa\u5217 [ root@dev tmp ] # lsblk -p NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda 8 :0 0 50G 0 disk \u251c\u2500/dev/sda1 8 :1 0 1G 0 part /boot \u2514\u2500/dev/sda2 8 :2 0 49G 0 part \u251c\u2500/dev/mapper/cl_vdsm--dev-root 253 :0 0 44G 0 lvm / \u2514\u2500/dev/mapper/cl_vdsm--dev-swap 253 :1 0 5G 0 lvm [ SWAP ] /dev/sdb 8 :16 0 1G 0 disk \u2514\u2500/dev/sdb1 8 :17 0 1023M 0 part \u2514\u2500/dev/mapper/cl_vdsm--dev-test_lv 253 :2 0 700M 0 lvm /dev/sr0 11 :0 1 6G 0 rom RM\uff1a\u662f\u5426\u4e3a\u53ef\u79fb\u9664\u8bbe\u5907 RO\uff1a\u662f\u5426\u4e3a\u53ea\u8bfb\u8bbe\u5907 MAJ:MIN\uff1a\u4e3b\u8981\u3001\u6b21\u8981\u8bbe\u5907\u53f7 rom\uff1a\u53ea\u8bfb\u5b58\u50a8\u8bbe\u5907\u3002\u955c\u50cf 1.2 blkid \u00b6 blkid - L < label > | - U < uuid > blkid [ - c < file > ] [ - ghlLv ] [ - o < format > ] [ - s < tag > ] [ - t < token > ] [ < dev > ...] blkid - p [ - s < tag > ] [ - O < offset > ] [ - S < size > ] [ - o < format > ] < dev > ... blkid - i [ - s < tag > ] [ - o < format > ] < dev > ... [ root@dev tmp ] # blkid /dev/sda1: UUID = \"decc4fd4-a5a2-487d-bcdc-9125218509c4\" TYPE = \"xfs\" /dev/sda2: UUID = \"rYAGTT-BICS-GotJ-tQR0-dx3q-hcR0-ZTwDgv\" TYPE = \"LVM2_member\" /dev/sdb1: UUID = \"fC445p-tGHZ-ULDg-oQOJ-jSQa-mVtR-Q0KQfN\" TYPE = \"LVM2_member\" /dev/mapper/cl_vdsm--dev-root: UUID = \"77579961-708a-449b-ac26-3f30f16fbfb5\" TYPE = \"xfs\" /dev/mapper/cl_vdsm--dev-swap: UUID = \"66ef502a-63c0-4d37-b69a-c0ced8436c8f\" TYPE = \"swap\" /dev/mapper/cl_vdsm--dev-test_lv: UUID = \"8192f79a-5fed-451c-bac8-5fadecb467da\" TYPE = \"ext2\" /dev/sr0: PTTYPE = \"PMBR\" linux\u4f1a\u7ed9\u6240\u6709\u7684\u8bbe\u5907\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684UUID\u3002 1.3 parted \u00b6 \u5217\u51fa\u78c1\u76d8\u7684\u5206\u533a\u4fe1\u606f\u3002 parted [ OPTION ] ... [ DEVICE [COMMAND [PARAMETERS ] ... ] ... ] [ root@dev tmp ] # parted -l Model: VMware, VMware Virtual S ( scsi ) # \u78c1\u76d8\u5382\u5546 Disk /dev/sda: 53 .7GB Sector size ( logical/physical ) : 512B/512B Partition Table: msdos # \u5206\u533a\u8868\u683c\u5f0f\uff0c\u8fd8\u6709MBR\u3001GPT\u7b49\u683c\u5f0f Disk Flags: # \u5206\u533a\u6570\u636e Number Start End Size Type File system Flags 1 1049kB 1075MB 1074MB primary xfs boot 2 1075MB 53 .7GB 52 .6GB primary lvm Model: Linux device-mapper ( linear ) ( dm ) Disk /dev/mapper/cl_vdsm--dev-test_lv: 734MB Sector size ( logical/physical ) : 512B/512B Partition Table: loop Disk Flags: Number Start End Size File system Flags 1 0 .00B 734MB 734MB ext2 ...... 2. \u5206\u533a \u00b6 \u4f7f\u7528 fdisk \u547d\u4ee4\u5212\u5206MBR\u5206\u533a\u8868\u7684\u78c1\u76d8\u6216\u65b0\u5efaMBR\u5206\u533a\uff1b\u4f7f\u7528 gdisk \uff08GPT fdisk\uff09\u547d\u4ee4\u5212\u5206GPT\u5206\u533a\u8868\u7684\u78c1\u76d8\u6216\u65b0\u5efaGPT\u5206\u533a\u3002 \u4f7f\u7528\u4e0a\u9762\u7684\u4e24\u547d\u4ee4\u521b\u5efa\u5206\u533a\u4e4b\u540e\uff0c\u901a\u8fc7 cat /proc/partitions \u4f1a\u53d1\u73b0\u5206\u533a\u8868\u8fd8\u672a\u66f4\u65b0\uff0c\u6b64\u65f6\u53ef\u901a\u8fc7\u91cd\u542f\u6216\u6267\u884c\uff1a [ root@dev tmp ] # partprobe -s /dev/sda: msdos partitions 1 2 /dev/sdb: msdos partitions 1 /dev/sdc: gpt partitions 1 2 3 Warning \u4e0d\u8981\u5220\u9664\u6b63\u5728\u4f7f\u7528\u7684\u5206\u533a\uff0c\u8981\u5148\u5378\u8f7d\u518d\u5220\u9664\u3002 2.1 \u4f7f\u7528 parted \u8fdb\u884c\u5206\u533a \u00b6 \u8be5\u6307\u4ee4\u540c\u65f6\u652f\u6301MBR\u5206\u533a\u548cGPT\u5206\u533a\u3002 parted [ OPTION ]... [ DEVICE [ COMMAND [ PARAMETERS ]...]...] COMMANDs : mklabel , mktable LABEL - TYPE \u521b\u5efa\u65b0\u7684 Partition Table mkpart PART - TYPE [ FS - TYPE ] START END make a partition PART - TYPE \uff1a \" primary \" , \" logical \" , \" extended \" FS - TYPE \uff1a \" btrfs \" , \" ext2 \" , \" ext3 \" , \" ext4 \" , \" fat16 \" , \" fat32 \" , \" hfs \" , \" hfs+ \" , \" linux-swap \" , \" ntfs \" , \" reiserfs \" , \" xfs \" print [ devices | free | list , all | NUMBER ] rm NUMBER delete partition NUMBER [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 print Model: Linux device-mapper ( linear ) ( dm ) Disk /dev/mapper/cl_vdsm--dev-test_lv2: 336MB Sector size ( logical/physical ) : 512B/512B Partition Table: loop Disk Flags: Number Start End Size File system Flags 1 0 .00B 336MB 336MB ext4 # \u66f4\u6539\u78c1\u76d8\u5206\u533a\u7c7b\u578b\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u4f1a\u4e22\u5931\uff01\uff01\uff01 [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 mklabel gpt Warning: The existing disk label on /dev/mapper/cl_vdsm--dev-test_lv2 will be destroyed and all data on this disk will be lost. Do you want to continue ? Yes/No? y Information: You may need to update /etc/fstab. [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 mktable msdos Warning: The existing disk label on /dev/mapper/cl_vdsm--dev-test_lv2 will be destroyed and all data on this disk will be lost. Do you want to continue ? Yes/No? y Information: You may need to update /etc/fstab. # \u65b0\u5efa\u5206\u533a # \u8981\u5148\u627e\u51fa\u524d\u4e00\u4e2a\u5206\u533a\u7684\u7ec8\u70b9 [ root@dev tmp ] # parted /dev/sdc print Model: VMware, VMware Virtual S ( scsi ) Disk /dev/sdc: 1074MB Sector size ( logical/physical ) : 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 538MB 537MB linux-swap ( v1 ) Linux swap # PART-TYPE FS-TYPE \u8d77\u70b9 \u7ec8\u70b9 [ root@dev tmp ] # parted /dev/sdc mkpart primary xfs 538MB 1050MB [ root@dev tmp ] # parted /dev/sdc print Model: VMware, VMware Virtual S ( scsi ) Disk /dev/sdc: 1074MB Sector size ( logical/physical ) : 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 538MB 537MB linux-swap ( v1 ) Linux swap 2 538MB 1050MB 512MB primary [ root@dev tmp ] # partprobe # \u8fd9\u91cc\u4ecd\u7136\u8981\u683c\u5f0f\u5316\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528\uff01\uff1f [ root@dev tmp ] # mkfs.xfs /dev/sdc2 3. \u683c\u5f0f\u5316 \u00b6 \u78c1\u76d8\u9635\u5217\u60c5\u51b5\u4e0b\u7684 mkfs \u3002TODO 4. \u6587\u4ef6\u7cfb\u7edf\u68c0\u9a8c \u00b6 fs\u53d1\u751f\u9519\u8bef\u65f6\u7684\u6551\u63f4\u3002 Warning \u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u8981\u4f7f\u7528\u8fd9\u4e9b\u6307\u4ee4\u3002 \u68c0\u67e5/\u4fee\u590d\u65f6\u9700\u8981\u5148\u5378\u8f7d\u8bbe\u5907\u3002\u4f46\u5982\u679c\u662f \u6839\u76ee\u5f55\u7684\u8bdd\u662f\u65e0\u6cd5\u5378\u8f7d\u7684 \uff0c\u9700\u8981\u8fdb\u5165\u5355\u4eba\u7ef4\u62a4\u6216\u6551\u63f4\u6a21\u5f0f\uff0c\u4f7f\u7528 xfs_repair -d \u9009\u9879\u8fdb\u884c\u5904\u7406\uff0c\u68c0\u9a8c\u5b8c\u6bd5\u4e4b\u540e\u81ea\u52a8\u91cd\u542f\u3002 4.1 xfs \u00b6 xfs_repair [ options ] device Options : - f The device is a file - l logdev Specifies the device where the external log resides . - n No modify mode , just checks the filesystem for damage . - t interval Reporting interval in seconds . - d Repair dangerously . 4.2 ext4 \u00b6 fsck . ext4 [ - panyrcdfvtDFV ] [ - b superblock ] [ - B blocksize ] [ - I inode_buffer_blocks ] [ - P process_inode_size ] [ - l |- L bad_blocks_file ] [ - C fd ] [ - j external_journal ] [ - E extended - options ] device - p Automatic repair ( no questions ) - n Make no changes to the filesystem - y Assume \" yes \" to all questions - f Force checking even if filesystem is marked clean - D \u9488\u5bf9 fs \u4e0b\u7684\u76ee\u5f55\u4f18\u5316\u914d\u7f6e - b superblock \u4f7f\u7528\u5907\u4efd\u7684 superblock 5. \u6302\u8f7d \u00b6 mount [ options ] < source > < directory > mount < operation > < mountpoint > [ < target > ] Options \uff1a - n , -- no - mtab Mount without writing in / etc / mtab . - o PARAMTERS PARAMETERS : async \uff0c sync \u6b64 fs \u4f7f\u7528 async \uff08\u5f02\u6b65\uff09\u6216 sync \uff08\u540c\u6b65\uff09\u7684\u5185\u5b58\u673a\u5236 atime \uff0c notime \u662f\u5426\u4fee\u6539\u8bfb\u53d6\u65f6\u95f4 ro \uff0c rw \u53ea\u8bfb\u6216\u8bfb\u5199 auto \uff0c noauto \u5141\u8bb8\u88ab mount - a \u81ea\u52a8\u6302\u8f7d dev \uff0c nodev \u5141\u8bb8\u5efa\u7acb\u8bbe\u5907\u6587\u4ef6 suid \uff0c nosuid \u5141\u8bb8 SUID / SGID exec \uff0c noexec \u5141\u8bb8\u53ef\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 user \uff0c nouser \u5141\u8bb8\u6240\u6709\u4eba\u6267\u884c mount defaults async \uff0c atime \uff0c rw \uff0c dev \uff0c suid \uff0c exec \uff0c nouser remount \u91cd\u65b0\u6302\u8f7d Source : - L , -- label < label > synonym for LABEL =< label > - U , -- uuid < uuid > synonym for UUID =< uuid > LABEL =< label > specifies device by filesystem label UUID =< uuid > specifies device by filesystem UUID PARTLABEL =< label > specifies device by partition label PARTUUID =< uuid > specifies device by partition UUID < device > specifies device by path < directory > mountpoint for bind mounts ( see -- bind / rbind ) < file > regular file for loopdev setup Operations : - B , -- bind mount a subtree somewhere else ( same as - o bind ) - M , -- move move a subtree to some other place - R , -- rbind mount a subtree and all submounts somewhere else \u91cd\u65b0\u6302\u8f7d\uff0c\u5728\u7cfb\u7edf\u51fa\u9519\u6216\u66f4\u65b0\u53c2\u6570\u65f6\u4f7f\u7528 mount -o remount,rw,auto / \u6302\u8f7d\u76ee\u5f55\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u5939 [ root@dev tmp ] # mount --bind t1/ test_lv/ [ root@dev tmp ] # ll -id t1/ test_lv/ 103706375 drwxr-xr-x 2 root root 6 Sep 27 15 :02 t1/ 103706375 drwxr-xr-x 2 root root 6 Sep 27 15 :02 test_lv/ \u5378\u8f7dumount umount - a [ options ] umount [ options ] < source > | < directory > Options : - a , --all unmount all filesystems - f , --force force unmount (in case of an unreachable NFS system) - l , --lazy detach the filesystem now, and cleanup all later - n , --no-mtab don't write to /etc/mtab \u5378\u8f7d\u65f6\u9664\u4e86\u6307\u5b9a\u6302\u8f7d\u70b9\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u8bbe\u5907\u8fdb\u884c\u5378\u8f7d\uff08\u76ee\u5f55\u4e0d\u53ef\u4ee5\uff09\uff1a [ root@dev tmp ] # mount /dev/mapper/cl_vdsm--dev-test_lv test_lv/ [ root@dev tmp ] # umount -l -v test_lv/ umount: /tmp/test_lv ( /dev/mapper/cl_vdsm--dev-test_lv ) unmounted [ root@dev tmp ] # mount /dev/mapper/cl_vdsm--dev-test_lv test_lv/ [ root@dev tmp ] # umount -v /dev/mapper/cl_vdsm--dev-test_lv umount: /tmp/t1 ( /dev/mapper/cl_vdsm--dev-test_lv ) unmounted /home \u5206\u533a\u662f\u6709\u7528\u6237\u767b\u5f55\u5c31\u4f1a\u4f7f\u7528\uff0c\u6545\u9700\u8981\u5c06\u666e\u901a\u7528\u6237\u5168\u90e8\u767b\u51fa\u76f4\u63a5\u4ee5root\u767b\u5f55\u65b9\u53ef\u5378\u8f7d\u3002 5.1 \u81ea\u52a8\u6302\u8f7d \u00b6 /etc/fstab \uff08filesystem table\uff09\u7684\u662f\u81ea\u52a8\u6302\u8f7d\u65f6\u6240\u8bfb\u53d6\u7684\u6587\u4ef6\u3002 [ root@dev tmp ] # cat /etc/fstab # # /etc/fstab # Created by anaconda on Thu Nov 8 00:46:18 2018 # # Accessible filesystems, by reference, are maintained under '/dev/disk' # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info # # \u8bbe\u5907\u3001UUID \u6302\u8f7d\u70b9 \u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b mount\u7684\u6587\u4ef6\u7cfb\u7edf\u53c2\u6570 dump fsck /dev/mapper/cl_vdsm--dev-root / xfs defaults 0 0 UUID = decc4fd4-a5a2-487d-bcdc-9125218509c4 /boot xfs defaults 0 0 /dev/mapper/cl_vdsm--dev-swap swap swap defaults 0 0 mount\u7684\u6587\u4ef6\u7cfb\u7edf\u53c2\u6570\uff1amount\u7684 -o \u9009\u9879\u4e2d\u7684\u5185\u5bb9 dump\uff1a\u80fd\u5426\u88abdump\uff08\u7528\u505a\u5907\u4efd\u7684\u5de5\u5177\uff09\u6307\u4ee4\u4f5c\u7528\u30020\u8868\u793a\u4e0d\u53ef\u7528\u3002 fsck\uff1a\u5728\u65e9\u671f\u7684\u5f00\u673a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u53bb\u68c0\u9a8c\u672c\u673a\u7684fs\uff0c\u770b\u5176\u662f\u5426\u5b8c\u6574\uff08clean\uff09\uff0c\u4e3b\u8981\u662f\u901a\u8fc7 fsck \u5b8c\u6210\uff1b\u4f46\u662fxfs\u4f1a\u81ea\u52a8\u68c0\u9a8c\uff0c\u65e0\u9700\u6b64\u52a8\u4f5c\uff0c\u586b0\u5373\u53ef\u3002 \u5b9e\u9645\u4e0afs\u7684\u6302\u8f7d\u662f\u8bb0\u5f55\u5230 /etc/mtab \u548c /proc/mounts \u6587\u4ef6\u4e2d\u7684\uff0c\u6bcf\u6b21fs\u7684\u6302\u8f7d\u6709\u53d8\u66f4\u65f6\uff0c\u4e5f\u4f1a\u66f4\u65b0\u8fd9\u4e24\u4e2a\u6587\u4ef6\u3002\u5728\u5355\u4eba\u59d4\u4f1a\u6a21\u5f0f\u4e0b\uff0c / \u662f\u53ea\u8bfb\u72b6\u6001\uff0c\u65e0\u6cd5\u66f4\u65b0 /etc/fstab \u4e0e /etc/mtab \uff0c\u6b64\u65f6\u53ef\u4ee5\u6267\u884c mount -n -o remount,rw / \u6765\u89e3\u51b3\u3002 5.2 \u6302\u8f7d\u955c\u50cf \u00b6 [ root@dev tmp ] # mount -o loop /dev/sr0 /mnt/ [ root@dev tmp ] # df -T Filesystem Type 1K-blocks Used Available Use% Mounted on \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 /dev/sr0 iso9660 4227724 4227724 0 100 % /run/media/root/CentOS 7 x86_64 /dev/loop0 iso9660 4227724 4227724 0 100 % /mnt 6. \u78c1\u76d8/\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570\u4fee\u6539 \u00b6 6.1 \u521b\u5efa\u8bbe\u5907 \u00b6 [ root@dev tmp ] # ll /dev/sd* brw-rw---- 1 root disk 8 , 0 Sep 27 15 :32 /dev/sda brw-rw---- 1 root disk 8 , 1 Sep 27 15 :32 /dev/sda1 brw-rw---- 1 root disk 8 , 2 Sep 27 15 :32 /dev/sda2 brw-rw---- 1 root disk 8 , 16 Sep 27 15 :32 /dev/sdb brw-rw---- 1 root disk 8 , 17 Sep 27 15 :32 /dev/sdb1 \u8f93\u51fa\u7684\u4e24\u4e2a\u6570\u5b57\u5206\u522b\u662f \u4e3b\u8981\uff08Major\uff09\u8bbe\u5907id\u3001\u6b21\u8981\uff08Minor\uff09\u8bbe\u5907id \uff0clinux\u5c31\u662f\u901a\u8fc7\u8fd9\u4e24\u4e2a\u6570\u5b57\u6765\u8bc6\u522b\u8bbe\u5907\u7684\u3002\u4e24\u8005\u901a\u8fc7 lsblk \u4e5f\u80fd\u770b\u5230\u3002 mknod [ OPTION ]... NAME TYPE [ MAJOR MINOR ] TYPE : b create a block ( buffered ) special file c , u create a character ( unbuffered ) special file \u8f93\u5165\u8bbe\u5907\uff0c\u4f8b\u5982\u952e\u9f20 p create a FIFO 6.2 \u6539\u53d8xfs\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570 \u00b6 xfs_admin [ - eflpu ] [ - c 0 | 1 ] [ - L label ] [ - U uuid ] device - l Print the current filesystem label . - u Print the current filesystem UUID ( Universally Unique IDentifier ). - L label Set the filesystem label to label . - U uuid Set the UUID of the filesystem to uuid . [ root@dev tmp ] # xfs_admin -l -u /dev/mapper/cl_vdsm--dev-test_lv label = \"\" UUID = f78f6d49-9fa6-41f1-af9c-6a845510addc [ root@dev tmp ] # xfs_admin -L study-lv /dev/mapper/cl_vdsm--dev-test_lv writing all SBs new label = \"study-lv\" [ root@dev tmp ] # xfs_admin -l /dev/mapper/cl_vdsm--dev-test_lv label = \"study-lv\" \u53ef\u4ee5\u4f7f\u7528 uuidgen \u751f\u6210UUID\uff1a [ root@dev tmp ] # uuidgen 288e54b6-d55d-4ab4-90c2-b0c2879e2205 6.3 \u6539\u53d8ext\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570 \u00b6 tune2fs [ -l ] [ -c max-mount-counts ] [ -e errors-behavior ] [ -f ] [ -i interval-between-checks ] [ -j ] [ -J journal-options ] [ -m reserved-blocks-percentage ] [ -o [ ^ ] mount-options [ ,... ] ] [ -r reserved-blocks-count ] [ -s sparse-super-flag ] [ -u user ] [ -g group ] [ -C mount-count ] [ -E extended-options ] [ -L volume-name ] [ -M last-mounted-directory ] [ -O [ ^ ] feature [ ,... ] ] [ -Q quota-options ] [ -T time-last-checked ] [ -U UUID ] device -l \u7c7b\u4f3c\u4e8e dumpe2fs -h\uff0c \u5217\u51fasuperblock\u4e2d\u7684\u6570\u636e -L \u4fee\u6539 Filesystem volume name -U \u4fee\u6539 UUID [ root@dev tmp ] # tune2fs -L ext4-lv /dev/mapper/cl_vdsm--dev-test_lv2 tune2fs 1 .42.9 ( 28 -Dec-2013 ) [ root@dev tmp ] # tune2fs -l /dev/cl_vdsm-dev/test_lv2 tune2fs 1 .42.9 ( 28 -Dec-2013 ) Filesystem volume name: ext4-lv ...... 7. \u521b\u5efa\u5927\u6587\u4ef6\u5236\u4f5cloop\u8bbe\u5907 \u00b6 \u60c5\u666f\u4e00\uff1a\u5728\u78c1\u76d8\u5206\u533a\u65f6\u89c4\u5212\u4e0d\u597d\uff0c\u5bfc\u81f4\u4e00\u4e2a\u5206\u533a\u5df2\u6ee1\u800c\u5176\u5b83\u5206\u533a\u8fd8\u6709\u5f88\u591a\u7a7a\u95f4\uff0c\u6b64\u65f6\u53ef\u4ee5\u5236\u4f5c\u4e00\u4e2aloop\u8bbe\u5907\u6765\u6302\u8f7d\u4f7f\u7528\u3002 [ root@dev tmp ] # dd if=/dev/zero of=loop-dev bs=1M count=512 [ root@dev tmp ] # mkfs.xfs -f loop-dev # \u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u6700\u597d\u52a0\u4e0a -o loop \u9009\u9879 [ root@dev tmp ] # mount -o loop loop-dev /mnt [ root@dev tmp ] # blkid /tmp/loop-dev: UUID = \"c655a24b-46fd-4a8a-a823-a9f6ae088d3f\" TYPE = \"xfs\" /dev/loop0: UUID = \"c655a24b-46fd-4a8a-a823-a9f6ae088d3f\" TYPE = \"xfs\" [ root@dev tmp ] # df -Th /dev/loop0 xfs 509M 26M 483M 6 % /tmp/mnt 8. \u521b\u5efa\u5185\u5b58\u4ea4\u6362\u533a swap \u00b6 \u4e2a\u4ebapc\u662f\u4e0d\u9700\u8981\u8be5\u8bbe\u5907\u7684\uff0c\u4f46\u662f\u670d\u52a1\u5668\u4e00\u5b9a\u8981\u6709\u3002 \u6709\u4e24\u79cd\u521b\u5efa\u65b9\u5f0f\uff1a \u521b\u5efa\u4e00\u4e2alinux swap\u5206\u533a \u521b\u5efa\u4e00\u4e2a\u865a\u62df\u5185\u5b58\u6587\u4ef6 8.1 \u4f7f\u7528\u5206\u533a\u521b\u5efa \u00b6 # \u521b\u5efa\u5206\u533a [ root@dev tmp ] # gdisk /dev/sdc # \u683c\u5f0f\u5316swap [ root@dev tmp ] # mkswap /dev/sdc1 Setting up swapspace version 1 , size = 524284 KiB no label, UUID = c6533ffa-aca3-4cff-a2e9-bf30e258ee42 # \u6253\u5f00swap [ root@dev tmp ] # swapon /dev/sdc1 # \u5217\u51fa\u6253\u5f00\u7684swap [ root@dev tmp ] # swapon -s Filename Type Size Used Priority /dev/sdc1 partition 524284 0 -2 /dev/dm-1 partition 5242876 0 -3 # \u5728 /etc/fstab \u6587\u4ef6\u4e2d\u6dfb\u52a0\uff08\u56e0\u4e3a\u4e0d\u662ffs\uff0c\u6545\u6ca1\u6709\u6302\u8f7d\u70b9\uff0c\u76f4\u63a5\u586b\u5199swap\uff09\uff1a /dev/sdc1 swap swap defaults 0 0 8.2 \u4f7f\u7528\u6587\u4ef6\u521b\u5efa \u00b6 \u4e0e\u521b\u5efaloop\u6587\u4ef6\u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u521b\u5efaswap\u6587\u4ef6\u3002\u5728\u4e0d\u80fd\u4f7f\u7528\u78c1\u76d8\u4e4b\u7c7b\u7684\u8bbe\u5907\u521b\u5efaswap\u65f6\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002 [ root@dev tmp ] # dd if=/dev/zero of=swap-dev bs=1M count=128 [ root@dev tmp ] # mkswap swap-dev Setting up swapspace version 1 , size = 131068 KiB no label, UUID = 9edadcd9-0815-4173-a230-ce5f8327e611 [ root@dev tmp ] # chmod 0600 swap-dev [ root@dev tmp ] # swapon swap-dev [ root@dev tmp ] # swapon -s Filename Type Size Used Priority /dev/sdc1 partition 524284 0 -2 /dev/dm-1 partition 5242876 0 -3 /tmp/swap-dev file 131068 0 -4 [ root@dev tmp ] # cat /etc/fstab \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 # \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528UUID\u6765\u8bc6\u522b\uff0c\u56e0\u4e3a\u7cfb\u7edf\u53ea\u4f1a\u67e5\u8be2\u5757\u8bbe\u5907\uff0c\u4e0d\u4f1a\u67e5\u8be2\u6587\u4ef6 /tmp/swap-dev swap swap defaults 0 0","title":"06 \u78c1\u76d8"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#1","text":"","title":"1. \u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#11-lsblk","text":"lsblk \uff08list block device\uff09\u53ef\u4ee5\u67e5\u770b\u78c1\u76d8\u3002 lsblk [ options ] [ <device> ... ] - i \u53ea\u4f7f\u7528ascii\u5b57\u7b26\u8f93\u51fa - p \u6253\u5370\u5b8c\u6574\u8bbe\u5907\u540d\u79f0 - o --output \u5b9a\u5236\u8f93\u51fa\u5217 [ root@dev tmp ] # lsblk -p NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda 8 :0 0 50G 0 disk \u251c\u2500/dev/sda1 8 :1 0 1G 0 part /boot \u2514\u2500/dev/sda2 8 :2 0 49G 0 part \u251c\u2500/dev/mapper/cl_vdsm--dev-root 253 :0 0 44G 0 lvm / \u2514\u2500/dev/mapper/cl_vdsm--dev-swap 253 :1 0 5G 0 lvm [ SWAP ] /dev/sdb 8 :16 0 1G 0 disk \u2514\u2500/dev/sdb1 8 :17 0 1023M 0 part \u2514\u2500/dev/mapper/cl_vdsm--dev-test_lv 253 :2 0 700M 0 lvm /dev/sr0 11 :0 1 6G 0 rom RM\uff1a\u662f\u5426\u4e3a\u53ef\u79fb\u9664\u8bbe\u5907 RO\uff1a\u662f\u5426\u4e3a\u53ea\u8bfb\u8bbe\u5907 MAJ:MIN\uff1a\u4e3b\u8981\u3001\u6b21\u8981\u8bbe\u5907\u53f7 rom\uff1a\u53ea\u8bfb\u5b58\u50a8\u8bbe\u5907\u3002\u955c\u50cf","title":"1.1 lsblk"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#12-blkid","text":"blkid - L < label > | - U < uuid > blkid [ - c < file > ] [ - ghlLv ] [ - o < format > ] [ - s < tag > ] [ - t < token > ] [ < dev > ...] blkid - p [ - s < tag > ] [ - O < offset > ] [ - S < size > ] [ - o < format > ] < dev > ... blkid - i [ - s < tag > ] [ - o < format > ] < dev > ... [ root@dev tmp ] # blkid /dev/sda1: UUID = \"decc4fd4-a5a2-487d-bcdc-9125218509c4\" TYPE = \"xfs\" /dev/sda2: UUID = \"rYAGTT-BICS-GotJ-tQR0-dx3q-hcR0-ZTwDgv\" TYPE = \"LVM2_member\" /dev/sdb1: UUID = \"fC445p-tGHZ-ULDg-oQOJ-jSQa-mVtR-Q0KQfN\" TYPE = \"LVM2_member\" /dev/mapper/cl_vdsm--dev-root: UUID = \"77579961-708a-449b-ac26-3f30f16fbfb5\" TYPE = \"xfs\" /dev/mapper/cl_vdsm--dev-swap: UUID = \"66ef502a-63c0-4d37-b69a-c0ced8436c8f\" TYPE = \"swap\" /dev/mapper/cl_vdsm--dev-test_lv: UUID = \"8192f79a-5fed-451c-bac8-5fadecb467da\" TYPE = \"ext2\" /dev/sr0: PTTYPE = \"PMBR\" linux\u4f1a\u7ed9\u6240\u6709\u7684\u8bbe\u5907\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684UUID\u3002","title":"1.2 blkid"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#13-parted","text":"\u5217\u51fa\u78c1\u76d8\u7684\u5206\u533a\u4fe1\u606f\u3002 parted [ OPTION ] ... [ DEVICE [COMMAND [PARAMETERS ] ... ] ... ] [ root@dev tmp ] # parted -l Model: VMware, VMware Virtual S ( scsi ) # \u78c1\u76d8\u5382\u5546 Disk /dev/sda: 53 .7GB Sector size ( logical/physical ) : 512B/512B Partition Table: msdos # \u5206\u533a\u8868\u683c\u5f0f\uff0c\u8fd8\u6709MBR\u3001GPT\u7b49\u683c\u5f0f Disk Flags: # \u5206\u533a\u6570\u636e Number Start End Size Type File system Flags 1 1049kB 1075MB 1074MB primary xfs boot 2 1075MB 53 .7GB 52 .6GB primary lvm Model: Linux device-mapper ( linear ) ( dm ) Disk /dev/mapper/cl_vdsm--dev-test_lv: 734MB Sector size ( logical/physical ) : 512B/512B Partition Table: loop Disk Flags: Number Start End Size File system Flags 1 0 .00B 734MB 734MB ext2 ......","title":"1.3 parted"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#2","text":"\u4f7f\u7528 fdisk \u547d\u4ee4\u5212\u5206MBR\u5206\u533a\u8868\u7684\u78c1\u76d8\u6216\u65b0\u5efaMBR\u5206\u533a\uff1b\u4f7f\u7528 gdisk \uff08GPT fdisk\uff09\u547d\u4ee4\u5212\u5206GPT\u5206\u533a\u8868\u7684\u78c1\u76d8\u6216\u65b0\u5efaGPT\u5206\u533a\u3002 \u4f7f\u7528\u4e0a\u9762\u7684\u4e24\u547d\u4ee4\u521b\u5efa\u5206\u533a\u4e4b\u540e\uff0c\u901a\u8fc7 cat /proc/partitions \u4f1a\u53d1\u73b0\u5206\u533a\u8868\u8fd8\u672a\u66f4\u65b0\uff0c\u6b64\u65f6\u53ef\u901a\u8fc7\u91cd\u542f\u6216\u6267\u884c\uff1a [ root@dev tmp ] # partprobe -s /dev/sda: msdos partitions 1 2 /dev/sdb: msdos partitions 1 /dev/sdc: gpt partitions 1 2 3 Warning \u4e0d\u8981\u5220\u9664\u6b63\u5728\u4f7f\u7528\u7684\u5206\u533a\uff0c\u8981\u5148\u5378\u8f7d\u518d\u5220\u9664\u3002","title":"2. \u5206\u533a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#21-parted","text":"\u8be5\u6307\u4ee4\u540c\u65f6\u652f\u6301MBR\u5206\u533a\u548cGPT\u5206\u533a\u3002 parted [ OPTION ]... [ DEVICE [ COMMAND [ PARAMETERS ]...]...] COMMANDs : mklabel , mktable LABEL - TYPE \u521b\u5efa\u65b0\u7684 Partition Table mkpart PART - TYPE [ FS - TYPE ] START END make a partition PART - TYPE \uff1a \" primary \" , \" logical \" , \" extended \" FS - TYPE \uff1a \" btrfs \" , \" ext2 \" , \" ext3 \" , \" ext4 \" , \" fat16 \" , \" fat32 \" , \" hfs \" , \" hfs+ \" , \" linux-swap \" , \" ntfs \" , \" reiserfs \" , \" xfs \" print [ devices | free | list , all | NUMBER ] rm NUMBER delete partition NUMBER [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 print Model: Linux device-mapper ( linear ) ( dm ) Disk /dev/mapper/cl_vdsm--dev-test_lv2: 336MB Sector size ( logical/physical ) : 512B/512B Partition Table: loop Disk Flags: Number Start End Size File system Flags 1 0 .00B 336MB 336MB ext4 # \u66f4\u6539\u78c1\u76d8\u5206\u533a\u7c7b\u578b\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u4f1a\u4e22\u5931\uff01\uff01\uff01 [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 mklabel gpt Warning: The existing disk label on /dev/mapper/cl_vdsm--dev-test_lv2 will be destroyed and all data on this disk will be lost. Do you want to continue ? Yes/No? y Information: You may need to update /etc/fstab. [ root@dev tmp ] # parted /dev/mapper/cl_vdsm--dev-test_lv2 mktable msdos Warning: The existing disk label on /dev/mapper/cl_vdsm--dev-test_lv2 will be destroyed and all data on this disk will be lost. Do you want to continue ? Yes/No? y Information: You may need to update /etc/fstab. # \u65b0\u5efa\u5206\u533a # \u8981\u5148\u627e\u51fa\u524d\u4e00\u4e2a\u5206\u533a\u7684\u7ec8\u70b9 [ root@dev tmp ] # parted /dev/sdc print Model: VMware, VMware Virtual S ( scsi ) Disk /dev/sdc: 1074MB Sector size ( logical/physical ) : 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 538MB 537MB linux-swap ( v1 ) Linux swap # PART-TYPE FS-TYPE \u8d77\u70b9 \u7ec8\u70b9 [ root@dev tmp ] # parted /dev/sdc mkpart primary xfs 538MB 1050MB [ root@dev tmp ] # parted /dev/sdc print Model: VMware, VMware Virtual S ( scsi ) Disk /dev/sdc: 1074MB Sector size ( logical/physical ) : 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 538MB 537MB linux-swap ( v1 ) Linux swap 2 538MB 1050MB 512MB primary [ root@dev tmp ] # partprobe # \u8fd9\u91cc\u4ecd\u7136\u8981\u683c\u5f0f\u5316\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528\uff01\uff1f [ root@dev tmp ] # mkfs.xfs /dev/sdc2","title":"2.1 \u4f7f\u7528 parted \u8fdb\u884c\u5206\u533a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#3","text":"\u78c1\u76d8\u9635\u5217\u60c5\u51b5\u4e0b\u7684 mkfs \u3002TODO","title":"3. \u683c\u5f0f\u5316"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#4","text":"fs\u53d1\u751f\u9519\u8bef\u65f6\u7684\u6551\u63f4\u3002 Warning \u6b63\u5e38\u60c5\u51b5\u4e0b\u4e0d\u8981\u4f7f\u7528\u8fd9\u4e9b\u6307\u4ee4\u3002 \u68c0\u67e5/\u4fee\u590d\u65f6\u9700\u8981\u5148\u5378\u8f7d\u8bbe\u5907\u3002\u4f46\u5982\u679c\u662f \u6839\u76ee\u5f55\u7684\u8bdd\u662f\u65e0\u6cd5\u5378\u8f7d\u7684 \uff0c\u9700\u8981\u8fdb\u5165\u5355\u4eba\u7ef4\u62a4\u6216\u6551\u63f4\u6a21\u5f0f\uff0c\u4f7f\u7528 xfs_repair -d \u9009\u9879\u8fdb\u884c\u5904\u7406\uff0c\u68c0\u9a8c\u5b8c\u6bd5\u4e4b\u540e\u81ea\u52a8\u91cd\u542f\u3002","title":"4. \u6587\u4ef6\u7cfb\u7edf\u68c0\u9a8c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#41-xfs","text":"xfs_repair [ options ] device Options : - f The device is a file - l logdev Specifies the device where the external log resides . - n No modify mode , just checks the filesystem for damage . - t interval Reporting interval in seconds . - d Repair dangerously .","title":"4.1 xfs"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#42-ext4","text":"fsck . ext4 [ - panyrcdfvtDFV ] [ - b superblock ] [ - B blocksize ] [ - I inode_buffer_blocks ] [ - P process_inode_size ] [ - l |- L bad_blocks_file ] [ - C fd ] [ - j external_journal ] [ - E extended - options ] device - p Automatic repair ( no questions ) - n Make no changes to the filesystem - y Assume \" yes \" to all questions - f Force checking even if filesystem is marked clean - D \u9488\u5bf9 fs \u4e0b\u7684\u76ee\u5f55\u4f18\u5316\u914d\u7f6e - b superblock \u4f7f\u7528\u5907\u4efd\u7684 superblock","title":"4.2 ext4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#5","text":"mount [ options ] < source > < directory > mount < operation > < mountpoint > [ < target > ] Options \uff1a - n , -- no - mtab Mount without writing in / etc / mtab . - o PARAMTERS PARAMETERS : async \uff0c sync \u6b64 fs \u4f7f\u7528 async \uff08\u5f02\u6b65\uff09\u6216 sync \uff08\u540c\u6b65\uff09\u7684\u5185\u5b58\u673a\u5236 atime \uff0c notime \u662f\u5426\u4fee\u6539\u8bfb\u53d6\u65f6\u95f4 ro \uff0c rw \u53ea\u8bfb\u6216\u8bfb\u5199 auto \uff0c noauto \u5141\u8bb8\u88ab mount - a \u81ea\u52a8\u6302\u8f7d dev \uff0c nodev \u5141\u8bb8\u5efa\u7acb\u8bbe\u5907\u6587\u4ef6 suid \uff0c nosuid \u5141\u8bb8 SUID / SGID exec \uff0c noexec \u5141\u8bb8\u53ef\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 user \uff0c nouser \u5141\u8bb8\u6240\u6709\u4eba\u6267\u884c mount defaults async \uff0c atime \uff0c rw \uff0c dev \uff0c suid \uff0c exec \uff0c nouser remount \u91cd\u65b0\u6302\u8f7d Source : - L , -- label < label > synonym for LABEL =< label > - U , -- uuid < uuid > synonym for UUID =< uuid > LABEL =< label > specifies device by filesystem label UUID =< uuid > specifies device by filesystem UUID PARTLABEL =< label > specifies device by partition label PARTUUID =< uuid > specifies device by partition UUID < device > specifies device by path < directory > mountpoint for bind mounts ( see -- bind / rbind ) < file > regular file for loopdev setup Operations : - B , -- bind mount a subtree somewhere else ( same as - o bind ) - M , -- move move a subtree to some other place - R , -- rbind mount a subtree and all submounts somewhere else \u91cd\u65b0\u6302\u8f7d\uff0c\u5728\u7cfb\u7edf\u51fa\u9519\u6216\u66f4\u65b0\u53c2\u6570\u65f6\u4f7f\u7528 mount -o remount,rw,auto / \u6302\u8f7d\u76ee\u5f55\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u5939 [ root@dev tmp ] # mount --bind t1/ test_lv/ [ root@dev tmp ] # ll -id t1/ test_lv/ 103706375 drwxr-xr-x 2 root root 6 Sep 27 15 :02 t1/ 103706375 drwxr-xr-x 2 root root 6 Sep 27 15 :02 test_lv/ \u5378\u8f7dumount umount - a [ options ] umount [ options ] < source > | < directory > Options : - a , --all unmount all filesystems - f , --force force unmount (in case of an unreachable NFS system) - l , --lazy detach the filesystem now, and cleanup all later - n , --no-mtab don't write to /etc/mtab \u5378\u8f7d\u65f6\u9664\u4e86\u6307\u5b9a\u6302\u8f7d\u70b9\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u8bbe\u5907\u8fdb\u884c\u5378\u8f7d\uff08\u76ee\u5f55\u4e0d\u53ef\u4ee5\uff09\uff1a [ root@dev tmp ] # mount /dev/mapper/cl_vdsm--dev-test_lv test_lv/ [ root@dev tmp ] # umount -l -v test_lv/ umount: /tmp/test_lv ( /dev/mapper/cl_vdsm--dev-test_lv ) unmounted [ root@dev tmp ] # mount /dev/mapper/cl_vdsm--dev-test_lv test_lv/ [ root@dev tmp ] # umount -v /dev/mapper/cl_vdsm--dev-test_lv umount: /tmp/t1 ( /dev/mapper/cl_vdsm--dev-test_lv ) unmounted /home \u5206\u533a\u662f\u6709\u7528\u6237\u767b\u5f55\u5c31\u4f1a\u4f7f\u7528\uff0c\u6545\u9700\u8981\u5c06\u666e\u901a\u7528\u6237\u5168\u90e8\u767b\u51fa\u76f4\u63a5\u4ee5root\u767b\u5f55\u65b9\u53ef\u5378\u8f7d\u3002","title":"5. \u6302\u8f7d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#51","text":"/etc/fstab \uff08filesystem table\uff09\u7684\u662f\u81ea\u52a8\u6302\u8f7d\u65f6\u6240\u8bfb\u53d6\u7684\u6587\u4ef6\u3002 [ root@dev tmp ] # cat /etc/fstab # # /etc/fstab # Created by anaconda on Thu Nov 8 00:46:18 2018 # # Accessible filesystems, by reference, are maintained under '/dev/disk' # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info # # \u8bbe\u5907\u3001UUID \u6302\u8f7d\u70b9 \u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b mount\u7684\u6587\u4ef6\u7cfb\u7edf\u53c2\u6570 dump fsck /dev/mapper/cl_vdsm--dev-root / xfs defaults 0 0 UUID = decc4fd4-a5a2-487d-bcdc-9125218509c4 /boot xfs defaults 0 0 /dev/mapper/cl_vdsm--dev-swap swap swap defaults 0 0 mount\u7684\u6587\u4ef6\u7cfb\u7edf\u53c2\u6570\uff1amount\u7684 -o \u9009\u9879\u4e2d\u7684\u5185\u5bb9 dump\uff1a\u80fd\u5426\u88abdump\uff08\u7528\u505a\u5907\u4efd\u7684\u5de5\u5177\uff09\u6307\u4ee4\u4f5c\u7528\u30020\u8868\u793a\u4e0d\u53ef\u7528\u3002 fsck\uff1a\u5728\u65e9\u671f\u7684\u5f00\u673a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u53bb\u68c0\u9a8c\u672c\u673a\u7684fs\uff0c\u770b\u5176\u662f\u5426\u5b8c\u6574\uff08clean\uff09\uff0c\u4e3b\u8981\u662f\u901a\u8fc7 fsck \u5b8c\u6210\uff1b\u4f46\u662fxfs\u4f1a\u81ea\u52a8\u68c0\u9a8c\uff0c\u65e0\u9700\u6b64\u52a8\u4f5c\uff0c\u586b0\u5373\u53ef\u3002 \u5b9e\u9645\u4e0afs\u7684\u6302\u8f7d\u662f\u8bb0\u5f55\u5230 /etc/mtab \u548c /proc/mounts \u6587\u4ef6\u4e2d\u7684\uff0c\u6bcf\u6b21fs\u7684\u6302\u8f7d\u6709\u53d8\u66f4\u65f6\uff0c\u4e5f\u4f1a\u66f4\u65b0\u8fd9\u4e24\u4e2a\u6587\u4ef6\u3002\u5728\u5355\u4eba\u59d4\u4f1a\u6a21\u5f0f\u4e0b\uff0c / \u662f\u53ea\u8bfb\u72b6\u6001\uff0c\u65e0\u6cd5\u66f4\u65b0 /etc/fstab \u4e0e /etc/mtab \uff0c\u6b64\u65f6\u53ef\u4ee5\u6267\u884c mount -n -o remount,rw / \u6765\u89e3\u51b3\u3002","title":"5.1 \u81ea\u52a8\u6302\u8f7d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#52","text":"[ root@dev tmp ] # mount -o loop /dev/sr0 /mnt/ [ root@dev tmp ] # df -T Filesystem Type 1K-blocks Used Available Use% Mounted on \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 /dev/sr0 iso9660 4227724 4227724 0 100 % /run/media/root/CentOS 7 x86_64 /dev/loop0 iso9660 4227724 4227724 0 100 % /mnt","title":"5.2 \u6302\u8f7d\u955c\u50cf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#6","text":"","title":"6. \u78c1\u76d8/\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#61","text":"[ root@dev tmp ] # ll /dev/sd* brw-rw---- 1 root disk 8 , 0 Sep 27 15 :32 /dev/sda brw-rw---- 1 root disk 8 , 1 Sep 27 15 :32 /dev/sda1 brw-rw---- 1 root disk 8 , 2 Sep 27 15 :32 /dev/sda2 brw-rw---- 1 root disk 8 , 16 Sep 27 15 :32 /dev/sdb brw-rw---- 1 root disk 8 , 17 Sep 27 15 :32 /dev/sdb1 \u8f93\u51fa\u7684\u4e24\u4e2a\u6570\u5b57\u5206\u522b\u662f \u4e3b\u8981\uff08Major\uff09\u8bbe\u5907id\u3001\u6b21\u8981\uff08Minor\uff09\u8bbe\u5907id \uff0clinux\u5c31\u662f\u901a\u8fc7\u8fd9\u4e24\u4e2a\u6570\u5b57\u6765\u8bc6\u522b\u8bbe\u5907\u7684\u3002\u4e24\u8005\u901a\u8fc7 lsblk \u4e5f\u80fd\u770b\u5230\u3002 mknod [ OPTION ]... NAME TYPE [ MAJOR MINOR ] TYPE : b create a block ( buffered ) special file c , u create a character ( unbuffered ) special file \u8f93\u5165\u8bbe\u5907\uff0c\u4f8b\u5982\u952e\u9f20 p create a FIFO","title":"6.1 \u521b\u5efa\u8bbe\u5907"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#62-xfs","text":"xfs_admin [ - eflpu ] [ - c 0 | 1 ] [ - L label ] [ - U uuid ] device - l Print the current filesystem label . - u Print the current filesystem UUID ( Universally Unique IDentifier ). - L label Set the filesystem label to label . - U uuid Set the UUID of the filesystem to uuid . [ root@dev tmp ] # xfs_admin -l -u /dev/mapper/cl_vdsm--dev-test_lv label = \"\" UUID = f78f6d49-9fa6-41f1-af9c-6a845510addc [ root@dev tmp ] # xfs_admin -L study-lv /dev/mapper/cl_vdsm--dev-test_lv writing all SBs new label = \"study-lv\" [ root@dev tmp ] # xfs_admin -l /dev/mapper/cl_vdsm--dev-test_lv label = \"study-lv\" \u53ef\u4ee5\u4f7f\u7528 uuidgen \u751f\u6210UUID\uff1a [ root@dev tmp ] # uuidgen 288e54b6-d55d-4ab4-90c2-b0c2879e2205","title":"6.2 \u6539\u53d8xfs\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#63-ext","text":"tune2fs [ -l ] [ -c max-mount-counts ] [ -e errors-behavior ] [ -f ] [ -i interval-between-checks ] [ -j ] [ -J journal-options ] [ -m reserved-blocks-percentage ] [ -o [ ^ ] mount-options [ ,... ] ] [ -r reserved-blocks-count ] [ -s sparse-super-flag ] [ -u user ] [ -g group ] [ -C mount-count ] [ -E extended-options ] [ -L volume-name ] [ -M last-mounted-directory ] [ -O [ ^ ] feature [ ,... ] ] [ -Q quota-options ] [ -T time-last-checked ] [ -U UUID ] device -l \u7c7b\u4f3c\u4e8e dumpe2fs -h\uff0c \u5217\u51fasuperblock\u4e2d\u7684\u6570\u636e -L \u4fee\u6539 Filesystem volume name -U \u4fee\u6539 UUID [ root@dev tmp ] # tune2fs -L ext4-lv /dev/mapper/cl_vdsm--dev-test_lv2 tune2fs 1 .42.9 ( 28 -Dec-2013 ) [ root@dev tmp ] # tune2fs -l /dev/cl_vdsm-dev/test_lv2 tune2fs 1 .42.9 ( 28 -Dec-2013 ) Filesystem volume name: ext4-lv ......","title":"6.3 \u6539\u53d8ext\u6587\u4ef6\u7cfb\u7edf\u7684\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#7-loop","text":"\u60c5\u666f\u4e00\uff1a\u5728\u78c1\u76d8\u5206\u533a\u65f6\u89c4\u5212\u4e0d\u597d\uff0c\u5bfc\u81f4\u4e00\u4e2a\u5206\u533a\u5df2\u6ee1\u800c\u5176\u5b83\u5206\u533a\u8fd8\u6709\u5f88\u591a\u7a7a\u95f4\uff0c\u6b64\u65f6\u53ef\u4ee5\u5236\u4f5c\u4e00\u4e2aloop\u8bbe\u5907\u6765\u6302\u8f7d\u4f7f\u7528\u3002 [ root@dev tmp ] # dd if=/dev/zero of=loop-dev bs=1M count=512 [ root@dev tmp ] # mkfs.xfs -f loop-dev # \u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u6700\u597d\u52a0\u4e0a -o loop \u9009\u9879 [ root@dev tmp ] # mount -o loop loop-dev /mnt [ root@dev tmp ] # blkid /tmp/loop-dev: UUID = \"c655a24b-46fd-4a8a-a823-a9f6ae088d3f\" TYPE = \"xfs\" /dev/loop0: UUID = \"c655a24b-46fd-4a8a-a823-a9f6ae088d3f\" TYPE = \"xfs\" [ root@dev tmp ] # df -Th /dev/loop0 xfs 509M 26M 483M 6 % /tmp/mnt","title":"7. \u521b\u5efa\u5927\u6587\u4ef6\u5236\u4f5cloop\u8bbe\u5907"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#8-swap","text":"\u4e2a\u4ebapc\u662f\u4e0d\u9700\u8981\u8be5\u8bbe\u5907\u7684\uff0c\u4f46\u662f\u670d\u52a1\u5668\u4e00\u5b9a\u8981\u6709\u3002 \u6709\u4e24\u79cd\u521b\u5efa\u65b9\u5f0f\uff1a \u521b\u5efa\u4e00\u4e2alinux swap\u5206\u533a \u521b\u5efa\u4e00\u4e2a\u865a\u62df\u5185\u5b58\u6587\u4ef6","title":"8. \u521b\u5efa\u5185\u5b58\u4ea4\u6362\u533a swap"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#81","text":"# \u521b\u5efa\u5206\u533a [ root@dev tmp ] # gdisk /dev/sdc # \u683c\u5f0f\u5316swap [ root@dev tmp ] # mkswap /dev/sdc1 Setting up swapspace version 1 , size = 524284 KiB no label, UUID = c6533ffa-aca3-4cff-a2e9-bf30e258ee42 # \u6253\u5f00swap [ root@dev tmp ] # swapon /dev/sdc1 # \u5217\u51fa\u6253\u5f00\u7684swap [ root@dev tmp ] # swapon -s Filename Type Size Used Priority /dev/sdc1 partition 524284 0 -2 /dev/dm-1 partition 5242876 0 -3 # \u5728 /etc/fstab \u6587\u4ef6\u4e2d\u6dfb\u52a0\uff08\u56e0\u4e3a\u4e0d\u662ffs\uff0c\u6545\u6ca1\u6709\u6302\u8f7d\u70b9\uff0c\u76f4\u63a5\u586b\u5199swap\uff09\uff1a /dev/sdc1 swap swap defaults 0 0","title":"8.1 \u4f7f\u7528\u5206\u533a\u521b\u5efa"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/06 \u78c1\u76d8/#82","text":"\u4e0e\u521b\u5efaloop\u6587\u4ef6\u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u521b\u5efaswap\u6587\u4ef6\u3002\u5728\u4e0d\u80fd\u4f7f\u7528\u78c1\u76d8\u4e4b\u7c7b\u7684\u8bbe\u5907\u521b\u5efaswap\u65f6\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002 [ root@dev tmp ] # dd if=/dev/zero of=swap-dev bs=1M count=128 [ root@dev tmp ] # mkswap swap-dev Setting up swapspace version 1 , size = 131068 KiB no label, UUID = 9edadcd9-0815-4173-a230-ce5f8327e611 [ root@dev tmp ] # chmod 0600 swap-dev [ root@dev tmp ] # swapon swap-dev [ root@dev tmp ] # swapon -s Filename Type Size Used Priority /dev/sdc1 partition 524284 0 -2 /dev/dm-1 partition 5242876 0 -3 /tmp/swap-dev file 131068 0 -4 [ root@dev tmp ] # cat /etc/fstab \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 # \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528UUID\u6765\u8bc6\u522b\uff0c\u56e0\u4e3a\u7cfb\u7edf\u53ea\u4f1a\u67e5\u8be2\u5757\u8bbe\u5907\uff0c\u4e0d\u4f1a\u67e5\u8be2\u6587\u4ef6 /tmp/swap-dev swap swap defaults 0 0","title":"8.2 \u4f7f\u7528\u6587\u4ef6\u521b\u5efa"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/","text":"1. \u538b\u7f29 \u00b6 \u5206\u522b\u4f7f\u7528 gzip \u3001 bzip2 \u3001 xz \u538b\u7f29\u7684\u6587\u4ef6\uff0c\u538b\u7f29\u6027\u80fd\u8d8a\u6765\u8d8a\u597d\uff0c\u4f46\u662f\u538b\u7f29\u65f6\u95f4\u8d8a\u6765\u8d8a\u957f\uff1a [ root@dev tmp ] # ll -Sh services* -rw-r--r-- 1 root root 655K Sep 29 11 :29 services -rw-r--r-- 1 root root 133K Sep 29 11 :29 services.gz -rw-r--r-- 1 root root 122K Sep 29 11 :08 services.bz2 -rw-r--r-- 1 root root 98K Sep 29 11 :08 services.xz \u538b\u7f29\u5305\u7684\u67e5\u770b/\u5185\u5bb9\u67e5\u627e\u53ef\u4f7f\u7528\u5bf9\u5e94\u7684\u6307\u4ee4\u6765\u67e5\u770b\uff1a gzip\uff1azcat, zmore, zless, zgrep, zegrep, zfgrep bzip2\uff1abzcat, bzmore, bzless, bzgrep xz\uff1axzcat, xzmore, xzless, xzgrep, xzegrep, xzfgrep 2. \u6253\u5305 \u00b6 \u538b\u7f29\u6307\u4ee4\u5bf9\u76ee\u5f55\u7684\u538b\u7f29\u662f\u5c06\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5206\u522b\u538b\u7f29\uff0c\u800c\u4e0d\u662f\u641e\u6210\u4e00\u4e2a\u538b\u7f29\u5305\u7684\u5f62\u5f0f\u3002 tar [ OPTION... ] [ FILE ] ... Options : - C , --directory=DIR \u5207\u6362\u76ee\u5f55 - z , --gzip \u901a\u8fc7gzip\u538b\u7f29/\u89e3\u538b\u7f29 - j , --bzip2 \u901a\u8fc7bzip2\u538b\u7f29/\u89e3\u538b\u7f29 - J , --xz \u901a\u8fc7xz\u538b\u7f29/\u89e3\u538b\u7f29 - p , --preserve-permissions \u4fdd\u7559\u6587\u4ef6\u7684\u6743\u9650\uff08\u9ed8\u8ba4\u65f6\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff09 - P , --absolute-names \u4fdd\u7559\u6839\u8def\u5f84\uff0c\u5373\u6253\u5305\u4ee5\u201c/\u201d\u5f00\u5934\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\u4f1a\u5c06\u6839\u76ee\u5f55\u4e5f\u5305\u542b\u8fdb\u53bb\uff0c\u8fd9\u6837\u89e3\u538b\u540e\u4f1a\u8986\u76d6\u6389\u6839\u76ee\u5f55\u7684\u6587\u4ef6\uff0c\u975e\u5e38\u5371\u9669\uff01\uff01\uff01 --exclude=PATTERN \u6392\u9664\u6587\u4ef6 --newer \u53ea\u6253\u5305mtime\u3001ctime\u6bd4\u8be5\u65f6\u95f4\u65b0\u7684\u6587\u4ef6\uff08\u5939\uff09 --newer-mtime \u53ea\u6253\u5305mtime\u6bd4\u8be5\u65f6\u95f4\u65b0\u7684\u6587\u4ef6\uff08\u5939\uff09 [ root@dev tmp ] # ll -h compress/ total 1016K -rw-r--r-- 1 root root 655K Sep 29 11 :29 services -rw-r--r-- 1 root root 122K Sep 29 11 :08 services.bz2 -rw-r--r-- 1 root root 133K Sep 29 11 :29 services.gz -rw-r--r-- 1 root root 98K Sep 29 11 :08 services.xz [ root@dev tmp ] # tar -Jcp -f compress.tar.xz --exclude=services.*z compress/ [ root@dev tmp ] # tar -tvf compress.tar.xz drwxr-xr-x root/root 0 2019 -09-29 13 :49 compress/ -rw-r--r-- root/root 670293 2019 -09-29 11 :29 compress/services -rw-r--r-- root/root 123932 2019 -09-29 11 :08 compress/services.bz2 [ root@dev tmp ] # tar -jpcvf etc.tar.bz2 --newer-mtime 2019-09-28 /etc/ \u8fd8\u53ef\u4ee5\u5c06\u6587\u4ef6\u6253\u5305\u5230\u7279\u522b\u7684\u8bbe\u5907\u53bb\uff1a # \u5c06\u6587\u4ef6\u6253\u5305\u5230\u78c1\u5e26\u673a\u4e2d tar -cv -f /dev/st0 /home /root /etc 3. XFS \u7684\u5907\u4efd\u4e0e\u8fd8\u539f \u00b6 \u5907\u4efd\u5df2\u6302\u8f7d\u7684xfs\u6587\u4ef6\u7cfb\u7edf\u3002 3.1 xfsdump \u00b6 \u652f\u6301\u7d2f\u79ef\u5907\u4efd\uff0c\u7c7b\u4f3c\u4e8e\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u3002 xfsdump [ options ] - f dest [ - f dest ... ] filesystem xfsdump - I [ subopt = value ... ] Options : - f \u8f93\u51fa\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u63a5 / dev / st0 \u8bbe\u5907 - l \u5907\u4efd\u7b49\u7ea7\uff0c\u7c7b\u4f3c\u4e8e git\u7684\u6bcf\u6b21\u63d0\u4ea4\u7684id \uff0c 0 ~ 9 \uff0c 0 \u4e3a\u6700\u4f4e - L session_label \u8bbe\u7f6e session label - M label [ - M label ... ] \u8bbe\u7f6e media label - I \u4ece / var / lib / xfsdump / inventory / \u5217\u51fa\u5907\u4efd\u4fe1\u606f [ root@dev tmp ] # df -hT /boot Filesystem Type Size Used Avail Use% Mounted on /dev/sda1 xfs 1014M 276M 739M 28 % /boot # \u8fd9\u91cc\u7684\u6302\u8f7d\u70b9\u4e0d\u80fd\u4ee5\u201c/\u201d\u7ed3\u5c3e\uff01\uff01\uff01 [ root@dev tmp ] # xfsdump -l 0 -L boot_all -M boot_all -f boot.xfsdump /boot [ root@dev tmp ] # xfsdump -I file system 0 : fs id: decc4fd4-a5a2-487d-bcdc-9125218509c4 session 0 : mount point: dev:/boot device: dev:/dev/sda1 time: Sun Sep 29 15 :21:04 2019 session label: \"boot_all\" session id: 344880f4-819d-4cea-ab22-0cb1041a1e6c level: 0 resumed: NO subtree: NO streams: 1 stream 0 : pathname: /tmp/boot.xfsdump start: ino 68 offset 0 end: ino 1573036 offset 0 interrupted: NO media files: 1 media file 0 : mfile index: 0 mfile type: data mfile size: 254765568 mfile start: ino 68 offset 0 mfile end: ino 1573036 offset 0 media label: \"boot_all\" media id: 1e1be93f-00fe-4f6c-93f1-1fbd37b550c0 # \u6709\u4e86\u539f\u59cb\u5907\u4efd\u4e4b\u540e\u624d\u53ef\u8fdb\u884c\u7d2f\u79ef\u5907\u4efd [ root@dev tmp ] # xfsdump -l 1 -L boot_1 -M boot_1 -f boot.xfsdump1 /boot [ root@dev tmp ] # xfsdump -I \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 session 1 : mount point: dev:/boot device: dev:/dev/sda1 time: Sun Sep 29 15 :28:51 2019 session label: \"boot_1\" session id: 6faa4cb0-3a61-4b68-b0c1-b31735cad2c1 level: 1 resumed: NO subtree: NO streams: 1 stream 0 : pathname: /tmp/boot.xfsdump1 start: ino 238861 offset 0 end: ino 238862 offset 0 interrupted: NO media files: 1 media file 0 : mfile index: 0 mfile type: data mfile size: 23176 mfile start: ino 238861 offset 0 mfile end: ino 238862 offset 0 media label: \"boot_1\" media id: 8584b89d-eb90-4389-866e-167fdfdce0b5 3.2 xfsrestore \u00b6 xfsrestore [ options ] - f source [ - f source ... ] dest xfsrestore - I [ subopt = value ... ] Options \uff1a - L \u6307\u5b9a\u590d\u539f\u7684 session_label - s \u53ea\u590d\u539f\u8be5\u6587\u4ef6\u6216\u76ee\u5f55 - r \u901a\u8fc7\u7d2f\u79ef\u5907\u4efd\u6587\u4ef6\u590d\u539f\u3002\u5982\u679c\u662f\u7528\u6587\u4ef6\u5b58\u50a8\u5907\u4efd\u6570\u636e\uff0c\u4e0d\u9700\u8981\u8be5\u9009\u9879\uff1b\u5982\u679c\u4e00\u4e2a\u78c1\u5e26\u5185\u6709\u591a\u4e2a\u6587\u4ef6\uff0c\u9700\u8981\u8be5\u9009\u9879 - i \u4ea4\u4e92\u6a21\u5f0f - I \u5217\u51fa\u5907\u4efd\u4fe1\u606f \u590d\u539f\u65f6\u9700\u8981\u6309\u7167 level0->...->level9 \u7684\u987a\u5e8f\u53bb\u590d\u539f\u3002 [ root@dev tmp ] # xfsrestore -f boot.xfsdump -L boot_all /boot [ root@dev tmp ] # xfsrestore -f boot.xfsdump1 -L boot_1 /boot # \u4ea4\u6362\u6a21\u5f0f\u3002\u53ea\u4f1a\u5217\u51fa\u4e0e\u76ee\u7684\u547d\u4ee4\u7684\u5dee\u5f02\uff0c\u6240\u4ee5\u4e0d\u8981\u5199\u6302\u8f7d\u70b9 [ root@dev tmp ] # xfsrestore -i -f boot.xfsdump boot2/ 4. \u5149\u76d8\u70e7\u5f55 \u00b6 4.1 \u521b\u5efa\u955c\u50cf\u6587\u4ef6 \u00b6 genisoimage [ options ] [ -o filename ] pathspec [ pathspec ... ] Options \uff1a - graft - points \u5141\u8bb8\u5bf9\u6587\u4ef6 \uff08 \u5939 \uff09 \u4f7f\u7528\u79fb\u690d\u70b9 \u3002 \u7528\u4e8e\u5b9a\u4e49\u955c\u50cf\u6587\u4ef6\u4e2d\u7684\u76ee\u5f55 \uff0c \u683c\u5f0f\u662f \uff1a \u955c\u50cf\u4e2d\u7684\u6587\u4ef6\u76ee\u5f55 = linux\u4e2d\u7684\u6587\u4ef6\u76ee\u5f55 - J \u589e\u52a0\u6587\u4ef6\u540d\u957f\u5ea6\u523064\u4e2aunicode\u5b57\u7b26 \u3002 \u5f53\u955c\u50cf\u88ab\u7528\u4e8eWindows\u7cfb\u7edf\u65f6\u5f88\u6709\u7528\u5904 - r \u8bb0\u5f55\u8f83\u591a\u7684\u4fe1\u606f \uff08 UID \u3001 GID\u7b49 \uff09 - V volid \u6307\u5b9a\u5199\u5165\u4e3bblock\u7684volume id ( volume name or label ) - m glob \u6392\u9664\u6587\u4ef6 \u3002 glob \uff1a shell \u901a\u914d\u7b26\u8868\u8fbe\u5f0f - b eltorito_boot_image \u5236\u4f5cx86\u542f\u52a8CD\u65f6\u6307\u5b9a\u542f\u52a8\u955c\u50cf - c boot_catalog \u5236\u4f5cEl Torito\u542f\u52a8CD\u65f6\u8981\u6c42\u7684\u542f\u52a8\u76ee\u5f55 - no - emul - boot \u521b\u5efa\u975e\u4eff\u771f \uff08 no emulation \uff09 \u955c\u50cf - boot - load - size load_sectors \u6307\u5b9a\u5728\u65e0\u4eff\u771f\u6a21\u5f0f\u4e0b\u52a0\u8f7d\u7684 \"\u865a\u62df\" \uff08 512 \u5b57\u8282 \uff09 \u6247\u533a\u6570 \u3002 \u5fc5\u987b\u65f64\u7684\u500d\u6570 - R \u4f7f\u7528Rock Ridge\u534f\u8bae\u751f\u6210SUS\u548cRR\u8bb0\u5f55 \uff0c \u8fdb\u4e00\u6b65\u63cf\u8ff0ISO9660 \u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6 - T \u5728\u6bcf\u4e2a\u6587\u4ef6\u4e0b\u751f\u6210\u4e00\u4e2a TRANS . TBL \u6587\u4ef6 \uff0c \u7528\u4e8enon - Rock Ridge - capable\u7cfb\u7edf\u8bc6\u522b\u6b63\u786e\u7684\u6587\u4ef6\u540d \u5236\u4f5c\u6587\u4ef6\u5907\u4efd\u955c\u50cf\uff1a # \u5728\u4e0d\u4f7f\u7528 -graft-points \u9009\u9879\u65f6\uff0c\u4f1a\u5c06\u76ee\u5f55\u7684\u6570\u636e\u5168\u90e8\u653e\u5230\u955c\u50cf\u6587\u4ef6\u4e2d\u7684\u6700\u9876\u5c42 [ root@dev tmp ] # mkisofs -r -v -V test-mkisofs -m projects -m isos -m idea-IU* -m clion-2018.3 -m docker -m .CLion2018.3 -o test.img /home /root # \u4f7f\u7528 -graft-points \u9009\u9879\u6765\u5b9a\u5236\u6570\u636e\u6240\u5728\u76ee\u5f55 [ root@dev tmp ] # mkisofs -r -v -V test-mkisofs -m projects -m isos -m idea-IU* -m clion-2018.3 -m docker -m .CLion2018.3 -m .PyCharm2016.2 -m spice-package -o test.img -graft-points /home=/home /linux/root=/root [ root@dev tmp ] # mount test.img img/ [ root@dev tmp ] # cd img/ [ root@dev img ] # tree -d -L 2 . \u251c\u2500\u2500 home \u2502 \u251c\u2500\u2500 amhello-1.0 \u2502 \u251c\u2500\u2500 sink \u2502 \u251c\u2500\u2500 study \u2502 \u251c\u2500\u2500 tmp \u2502 \u251c\u2500\u2500 user1 \u2502 \u251c\u2500\u2500 user2 \u2502 \u2514\u2500\u2500 wine-3.0 \u251c\u2500\u2500 linux \u2502 \u2514\u2500\u2500 root \u2514\u2500\u2500 rr_moved \u5236\u4f5c\u7cfb\u7edf\u542f\u52a8\u76d8\uff0c\u672c\u6b21\u4f7f\u7528VMware\u865a\u62df\u673a\uff1a # \u6302\u8f7d\u6216\u4e0b\u8f7d\u4e00\u4e2aCentOS\u7684iso\u955c\u50cf\u5230\u865a\u62df\u673a\u4e2d $ cd /run/media/root/CentOS \\ 7 \\ x86_64/ # \u590d\u5236\u5230\u65b0\u7684\u76ee\u5f55\u4e0b $ rsync -a . /tmp/img/ # \u8fdb\u5165\u76ee\u5f55\u5236\u4f5c\u955c\u50cf $ cd /tmp/img/ $ mkisofs -o /tmp/custom.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -V 'CentOS 7 x86_64' -boot-load-size 4 -boot-info-table -R -J -v -T . # \u67e5\u770b\u955c\u50cf $ cd .. ; isoinfo -d -i custom.iso 4.2 \u70e7\u5f55\u5230\u5149\u76d8 \u00b6 centos7\u4f7f\u7528wodim\u8fdb\u884c\u70e7\u5f55\uff0c\u4f46\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u5c06cdrecode\u94fe\u63a5\u5230\u4e86wodim\u3002 [ root@dev ~ ] # ll /usr/bin/cdrecord lrwxrwxrwx. 1 root root 26 Nov 8 2018 /usr/bin/cdrecord -> /etc/alternatives/cdrecord [ root@dev ~ ] # ll /etc/alternatives/cdrecord lrwxrwxrwx. 1 root root 14 Nov 8 2018 /etc/alternatives/cdrecord -> /usr/bin/wodim VMware\u597d\u50cf\u6ca1\u6cd5\u5b9e\u9a8c\uff0c\u5148\u8bb0\u5f55\u4e00\u4e0b\u64cd\u4f5c\uff1a # \u626b\u63cf\u70e7\u5f55\u673a $ wodim --devices dev = /dev/sr0 wodim: Overview of accessible drives ( 1 found ) : ------------------------------------------------------------------------- 0 dev = '/dev/sr0' rwrw-- : 'NECVMWar' 'VMware IDE CDR10' ------------------------------------------------------------------------- # \u64e6\u9664\u5149\u76d8\u5185\u5bb9\u3002blank\uff1afast\uff0call $ wodim -v dev = /dev/sr0 blank = fast # \u70e7\u5f55\u3002eject\uff1a\u70e7\u5f55\u5b8c\u6bd5\u540e\u9000\u51fa\u5149\u76d8 $ wodim -v dev = /dev/sr0 speed = 4 -dummy -eject custom.iso # \u6302\u8f7d\u6d4b\u8bd5 5. \u5176\u5b83\u5907\u4efd\u5de5\u5177 \u00b6 5.1 dd \u00b6 # \u5907\u4efd\u666e\u901a\u6587\u4ef6\uff0c\u9ed8\u8ba4\u662f 512Bytes \u4e00\u4e2a\u5355\u4f4d [ root@dev tmp ] # dd if=/etc/passwd of=passwd.back # \u5907\u4efd\u5149\u76d8 [ root@dev tmp ] # dd if=/dev/sr0 of=test.img # \u5907\u4efd\u5230USB\uff0c\u4e0d\u9700\u8981\u683c\u5f0f\u5316 [ root@dev tmp ] # dd if=test.img of=/dev/sdd # \u5907\u4efd\u6587\u4ef6\u7cfb\u7edf [ root@dev tmp ] # dd if=/dev/sda1 of=sda1.img # \u5148\u521b\u5efa\u4e00\u4e2a\u5206\u533a /dev/sdd1(\u5fc5\u987b\u5927\u4e8e\u8981\u5907\u4efd\u7684\u6587\u4ef6) \uff0c\u7528\u4e8e\u5907\u4efd /dev/sda1 [ root@dev tmp ] # df -h /boot Filesystem Size Used Avail Use% Mounted on /dev/sda1 1014M 276M 739M 28 % /boot [ root@dev tmp ] # dd if=/dev/sda1 of=/dev/sdd1 2097152 +0 records in 2097152 +0 records out 1073741824 bytes ( 1 .1 GB ) copied, 6 .84414 s, 157 MB/s # \u4e00\u5b9a\u8981\u6e05\u7406log [ root@dev tmp ] # xfs_repair -L /dev/sdd1 # \u6539\u6389\u539f\u6765\u7684UUID [ root@dev tmp ] # uuidgen 8de09e65-741b-40d0-a66a-caa9fff7bdc5 [ root@dev tmp ] # xfs_admin -U 8de09e65-741b-40d0-a66a-caa9fff7bdc5 /dev/sdd1 Clearing log and setting UUID writing all SBs new UUID = 8de09e65-741b-40d0-a66a-caa9fff7bdc5 [ root@dev tmp ] # mount /dev/sdd1 sdd1/ [ root@dev tmp ] # xfs_growfs sdd1 # \u5f88\u5947\u602a\uff0c\u5907\u4efd\u7684\u6587\u4ef6\u6bd4\u539f\u6587\u4ef6\u5c11\u4e86\u5f88\u591a\u4e1c\u897f\uff08\u4e09\u4e2a\u7248\u672c\u7684\u5185\u6838\u6587\u4ef6\u53ea\u4fdd\u7559\u4e86\u4e00\u4efd\uff0c\u8fd8\u4e0d\u662f\u540c\u4e00\u4e2a\u7248\u672c\u7684\uff09\u3002\uff1f\uff1f\uff1f [ root@dev tmp ] # ll sdd1/ total 21820 -rw-r--r--. 1 root root 137696 Nov 23 2016 config-3.10.0-514.el7.x86_64 drwxr-xr-x. 3 root root 17 Nov 8 2018 efi drwxr-xr-x. 2 root root 4096 Nov 8 2018 extlinux drwxr-xr-x. 2 root root 27 Nov 8 2018 grub drwx------. 5 root root 132 Sep 19 08 :31 grub2 -rw------- 1 root root 13407979 Jun 12 09 :26 initramfs-3.10.0-957.21.2.el7.x86_64kdump.img -rw-r--r--. 1 root root 277953 Nov 23 2016 symvers-3.10.0-514.el7.x86_64.gz -rw-------. 1 root root 3113253 Nov 23 2016 System.map-3.10.0-514.el7.x86_64 -rw-r--r-- 1 root root 0 Sep 29 15 :27 test-xfsdump -rwxr-xr-x. 1 root root 5392080 Nov 23 2016 vmlinuz-3.10.0-514.el7.x86_64 [ root@dev tmp ] # ll /boot/ total 239472 -rw-r--r--. 1 root root 137696 Nov 23 2016 config-3.10.0-514.el7.x86_64 -rw-r--r--. 1 root root 147859 Sep 26 2018 config-3.10.0-862.14.4.el7.x86_64 -rw-r--r-- 1 root root 151923 Jun 5 22 :30 config-3.10.0-957.21.2.el7.x86_64 drwxr-xr-x. 3 root root 17 Nov 8 2018 efi drwxr-xr-x. 2 root root 4096 Nov 8 2018 extlinux drwxr-xr-x. 2 root root 27 Nov 8 2018 grub drwx------. 5 root root 132 Sep 19 08 :31 grub2 -rw-------. 1 root root 64521440 Nov 8 2018 initramfs-0-rescue-3e584bbb71104099905f8ba7873188ea.img -rw-------. 1 root root 31516942 Nov 8 2018 initramfs-3.10.0-514.el7.x86_64.img -rw-------. 1 root root 13729374 Nov 8 2018 initramfs-3.10.0-514.el7.x86_64kdump.img -rw-------. 1 root root 31500158 Nov 8 2018 initramfs-3.10.0-862.14.4.el7.x86_64.img -rw------- 1 root root 13399648 May 20 08 :52 initramfs-3.10.0-862.14.4.el7.x86_64kdump.img -rw------- 1 root root 31647417 Jun 11 17 :06 initramfs-3.10.0-957.21.2.el7.x86_64.img -rw------- 1 root root 13407979 Jun 12 09 :26 initramfs-3.10.0-957.21.2.el7.x86_64kdump.img -rw-r--r--. 1 root root 10209490 Nov 8 2018 initrd-plymouth.img -rw-r--r--. 1 root root 277953 Nov 23 2016 symvers-3.10.0-514.el7.x86_64.gz -rw-r--r--. 1 root root 305158 Sep 26 2018 symvers-3.10.0-862.14.4.el7.x86_64.gz -rw-r--r-- 1 root root 314128 Jun 5 22 :30 symvers-3.10.0-957.21.2.el7.x86_64.gz -rw-------. 1 root root 3113253 Nov 23 2016 System.map-3.10.0-514.el7.x86_64 -rw-------. 1 root root 3414754 Sep 26 2018 System.map-3.10.0-862.14.4.el7.x86_64 -rw------- 1 root root 3545794 Jun 5 22 :30 System.map-3.10.0-957.21.2.el7.x86_64 -rw-r--r-- 1 root root 0 Sep 29 15 :27 test-xfsdump -rwxr-xr-x. 1 root root 5392080 Nov 8 2018 vmlinuz-0-rescue-3e584bbb71104099905f8ba7873188ea -rwxr-xr-x. 1 root root 5392080 Nov 23 2016 vmlinuz-3.10.0-514.el7.x86_64 -rwxr-xr-x. 1 root root 6398144 Sep 26 2018 vmlinuz-3.10.0-862.14.4.el7.x86_64 -rwxr-xr-x 1 root root 6643904 Jun 5 22 :30 vmlinuz-3.10.0-957.21.2.el7.x86_64 5.2 cpio \u00b6 \u53ef\u4ee5\u5907\u4efd\u4efb\u4f55\u4e1c\u897f\u3002 # \u5907\u4efd cpio - o [ options ] > file / device Options : - a \u4e0d\u4fee\u6539\u88ab\u5907\u4efd\u6587\u4ef6\u7684atime - B \u8bbe\u7f6e I / O block size to 5120 bytes . \u9ed8\u8ba4\u662f 512 bytes . - c \u4f7f\u7528\u65b0\u7684 ( SVR4 ) portable format \uff0c \u4e0e \u201c - H newc \u201d \u4e00\u6837 . \u8001\u7684 portable ( ASCII ) archive format \u4f7f\u7528 \u201c - H odc \u201d # \u8fd8\u539f cpio - i < file / device Options : - m \u4e0d\u4fee\u6539mtime - c \u540c\u5907\u4efd\u9009\u9879\u4e00\u6837 - d \u81ea\u52a8\u521b\u5efa\u76ee\u5f55 \u3002 \u56e0\u4e3a\u4f7f\u7528cpio\u5907\u4efd\u7684\u6570\u636e\u5185\u5bb9\u4e0d\u4e00\u5b9a\u4f1a\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d \uff0c \u6240\u4ee5\u5fc5\u987b\u8ba9\u5b83\u53ef\u4ee5\u521b\u5efa\u76ee\u5f55 - u \u81ea\u52a8\u4f7f\u7528\u65b0\u6587\u4ef6\u8986\u76d6\u5c31\u6587\u4ef6 - t \u67e5\u770b\u5907\u4efd\u6587\u4ef6\u7684\u5185\u5bb9 \u5907\u4efd\u53ca\u8fd8\u539f\u90fd\u9002\u7528\u7684\u9009\u9879 \uff1a --no-absolute-filenames \u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6 # \u8f93\u5165\u4e0d\u80fd\u542b\u6709\u6839\u76ee\u5f55\uff01\uff01\uff01 [ root@dev tmp ] # cd / [ root@dev / ] # find boot | cpio -ocBav > /tmp/boot.cpio [ root@dev tmp ] # cpio -icdm < boot.cpio 496612 blocks # \u5185\u5bb9\u4e00\u81f4 [ root@dev tmp ] # ll boot","title":"07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#1","text":"\u5206\u522b\u4f7f\u7528 gzip \u3001 bzip2 \u3001 xz \u538b\u7f29\u7684\u6587\u4ef6\uff0c\u538b\u7f29\u6027\u80fd\u8d8a\u6765\u8d8a\u597d\uff0c\u4f46\u662f\u538b\u7f29\u65f6\u95f4\u8d8a\u6765\u8d8a\u957f\uff1a [ root@dev tmp ] # ll -Sh services* -rw-r--r-- 1 root root 655K Sep 29 11 :29 services -rw-r--r-- 1 root root 133K Sep 29 11 :29 services.gz -rw-r--r-- 1 root root 122K Sep 29 11 :08 services.bz2 -rw-r--r-- 1 root root 98K Sep 29 11 :08 services.xz \u538b\u7f29\u5305\u7684\u67e5\u770b/\u5185\u5bb9\u67e5\u627e\u53ef\u4f7f\u7528\u5bf9\u5e94\u7684\u6307\u4ee4\u6765\u67e5\u770b\uff1a gzip\uff1azcat, zmore, zless, zgrep, zegrep, zfgrep bzip2\uff1abzcat, bzmore, bzless, bzgrep xz\uff1axzcat, xzmore, xzless, xzgrep, xzegrep, xzfgrep","title":"1. \u538b\u7f29"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#2","text":"\u538b\u7f29\u6307\u4ee4\u5bf9\u76ee\u5f55\u7684\u538b\u7f29\u662f\u5c06\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5206\u522b\u538b\u7f29\uff0c\u800c\u4e0d\u662f\u641e\u6210\u4e00\u4e2a\u538b\u7f29\u5305\u7684\u5f62\u5f0f\u3002 tar [ OPTION... ] [ FILE ] ... Options : - C , --directory=DIR \u5207\u6362\u76ee\u5f55 - z , --gzip \u901a\u8fc7gzip\u538b\u7f29/\u89e3\u538b\u7f29 - j , --bzip2 \u901a\u8fc7bzip2\u538b\u7f29/\u89e3\u538b\u7f29 - J , --xz \u901a\u8fc7xz\u538b\u7f29/\u89e3\u538b\u7f29 - p , --preserve-permissions \u4fdd\u7559\u6587\u4ef6\u7684\u6743\u9650\uff08\u9ed8\u8ba4\u65f6\u8d85\u7ea7\u7528\u6237\u6743\u9650\uff09 - P , --absolute-names \u4fdd\u7559\u6839\u8def\u5f84\uff0c\u5373\u6253\u5305\u4ee5\u201c/\u201d\u5f00\u5934\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u65f6\u4f1a\u5c06\u6839\u76ee\u5f55\u4e5f\u5305\u542b\u8fdb\u53bb\uff0c\u8fd9\u6837\u89e3\u538b\u540e\u4f1a\u8986\u76d6\u6389\u6839\u76ee\u5f55\u7684\u6587\u4ef6\uff0c\u975e\u5e38\u5371\u9669\uff01\uff01\uff01 --exclude=PATTERN \u6392\u9664\u6587\u4ef6 --newer \u53ea\u6253\u5305mtime\u3001ctime\u6bd4\u8be5\u65f6\u95f4\u65b0\u7684\u6587\u4ef6\uff08\u5939\uff09 --newer-mtime \u53ea\u6253\u5305mtime\u6bd4\u8be5\u65f6\u95f4\u65b0\u7684\u6587\u4ef6\uff08\u5939\uff09 [ root@dev tmp ] # ll -h compress/ total 1016K -rw-r--r-- 1 root root 655K Sep 29 11 :29 services -rw-r--r-- 1 root root 122K Sep 29 11 :08 services.bz2 -rw-r--r-- 1 root root 133K Sep 29 11 :29 services.gz -rw-r--r-- 1 root root 98K Sep 29 11 :08 services.xz [ root@dev tmp ] # tar -Jcp -f compress.tar.xz --exclude=services.*z compress/ [ root@dev tmp ] # tar -tvf compress.tar.xz drwxr-xr-x root/root 0 2019 -09-29 13 :49 compress/ -rw-r--r-- root/root 670293 2019 -09-29 11 :29 compress/services -rw-r--r-- root/root 123932 2019 -09-29 11 :08 compress/services.bz2 [ root@dev tmp ] # tar -jpcvf etc.tar.bz2 --newer-mtime 2019-09-28 /etc/ \u8fd8\u53ef\u4ee5\u5c06\u6587\u4ef6\u6253\u5305\u5230\u7279\u522b\u7684\u8bbe\u5907\u53bb\uff1a # \u5c06\u6587\u4ef6\u6253\u5305\u5230\u78c1\u5e26\u673a\u4e2d tar -cv -f /dev/st0 /home /root /etc","title":"2. \u6253\u5305"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#3-xfs","text":"\u5907\u4efd\u5df2\u6302\u8f7d\u7684xfs\u6587\u4ef6\u7cfb\u7edf\u3002","title":"3. XFS \u7684\u5907\u4efd\u4e0e\u8fd8\u539f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#31-xfsdump","text":"\u652f\u6301\u7d2f\u79ef\u5907\u4efd\uff0c\u7c7b\u4f3c\u4e8e\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u3002 xfsdump [ options ] - f dest [ - f dest ... ] filesystem xfsdump - I [ subopt = value ... ] Options : - f \u8f93\u51fa\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u63a5 / dev / st0 \u8bbe\u5907 - l \u5907\u4efd\u7b49\u7ea7\uff0c\u7c7b\u4f3c\u4e8e git\u7684\u6bcf\u6b21\u63d0\u4ea4\u7684id \uff0c 0 ~ 9 \uff0c 0 \u4e3a\u6700\u4f4e - L session_label \u8bbe\u7f6e session label - M label [ - M label ... ] \u8bbe\u7f6e media label - I \u4ece / var / lib / xfsdump / inventory / \u5217\u51fa\u5907\u4efd\u4fe1\u606f [ root@dev tmp ] # df -hT /boot Filesystem Type Size Used Avail Use% Mounted on /dev/sda1 xfs 1014M 276M 739M 28 % /boot # \u8fd9\u91cc\u7684\u6302\u8f7d\u70b9\u4e0d\u80fd\u4ee5\u201c/\u201d\u7ed3\u5c3e\uff01\uff01\uff01 [ root@dev tmp ] # xfsdump -l 0 -L boot_all -M boot_all -f boot.xfsdump /boot [ root@dev tmp ] # xfsdump -I file system 0 : fs id: decc4fd4-a5a2-487d-bcdc-9125218509c4 session 0 : mount point: dev:/boot device: dev:/dev/sda1 time: Sun Sep 29 15 :21:04 2019 session label: \"boot_all\" session id: 344880f4-819d-4cea-ab22-0cb1041a1e6c level: 0 resumed: NO subtree: NO streams: 1 stream 0 : pathname: /tmp/boot.xfsdump start: ino 68 offset 0 end: ino 1573036 offset 0 interrupted: NO media files: 1 media file 0 : mfile index: 0 mfile type: data mfile size: 254765568 mfile start: ino 68 offset 0 mfile end: ino 1573036 offset 0 media label: \"boot_all\" media id: 1e1be93f-00fe-4f6c-93f1-1fbd37b550c0 # \u6709\u4e86\u539f\u59cb\u5907\u4efd\u4e4b\u540e\u624d\u53ef\u8fdb\u884c\u7d2f\u79ef\u5907\u4efd [ root@dev tmp ] # xfsdump -l 1 -L boot_1 -M boot_1 -f boot.xfsdump1 /boot [ root@dev tmp ] # xfsdump -I \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 session 1 : mount point: dev:/boot device: dev:/dev/sda1 time: Sun Sep 29 15 :28:51 2019 session label: \"boot_1\" session id: 6faa4cb0-3a61-4b68-b0c1-b31735cad2c1 level: 1 resumed: NO subtree: NO streams: 1 stream 0 : pathname: /tmp/boot.xfsdump1 start: ino 238861 offset 0 end: ino 238862 offset 0 interrupted: NO media files: 1 media file 0 : mfile index: 0 mfile type: data mfile size: 23176 mfile start: ino 238861 offset 0 mfile end: ino 238862 offset 0 media label: \"boot_1\" media id: 8584b89d-eb90-4389-866e-167fdfdce0b5","title":"3.1 xfsdump"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#32-xfsrestore","text":"xfsrestore [ options ] - f source [ - f source ... ] dest xfsrestore - I [ subopt = value ... ] Options \uff1a - L \u6307\u5b9a\u590d\u539f\u7684 session_label - s \u53ea\u590d\u539f\u8be5\u6587\u4ef6\u6216\u76ee\u5f55 - r \u901a\u8fc7\u7d2f\u79ef\u5907\u4efd\u6587\u4ef6\u590d\u539f\u3002\u5982\u679c\u662f\u7528\u6587\u4ef6\u5b58\u50a8\u5907\u4efd\u6570\u636e\uff0c\u4e0d\u9700\u8981\u8be5\u9009\u9879\uff1b\u5982\u679c\u4e00\u4e2a\u78c1\u5e26\u5185\u6709\u591a\u4e2a\u6587\u4ef6\uff0c\u9700\u8981\u8be5\u9009\u9879 - i \u4ea4\u4e92\u6a21\u5f0f - I \u5217\u51fa\u5907\u4efd\u4fe1\u606f \u590d\u539f\u65f6\u9700\u8981\u6309\u7167 level0->...->level9 \u7684\u987a\u5e8f\u53bb\u590d\u539f\u3002 [ root@dev tmp ] # xfsrestore -f boot.xfsdump -L boot_all /boot [ root@dev tmp ] # xfsrestore -f boot.xfsdump1 -L boot_1 /boot # \u4ea4\u6362\u6a21\u5f0f\u3002\u53ea\u4f1a\u5217\u51fa\u4e0e\u76ee\u7684\u547d\u4ee4\u7684\u5dee\u5f02\uff0c\u6240\u4ee5\u4e0d\u8981\u5199\u6302\u8f7d\u70b9 [ root@dev tmp ] # xfsrestore -i -f boot.xfsdump boot2/","title":"3.2 xfsrestore"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#4","text":"","title":"4. \u5149\u76d8\u70e7\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#41","text":"genisoimage [ options ] [ -o filename ] pathspec [ pathspec ... ] Options \uff1a - graft - points \u5141\u8bb8\u5bf9\u6587\u4ef6 \uff08 \u5939 \uff09 \u4f7f\u7528\u79fb\u690d\u70b9 \u3002 \u7528\u4e8e\u5b9a\u4e49\u955c\u50cf\u6587\u4ef6\u4e2d\u7684\u76ee\u5f55 \uff0c \u683c\u5f0f\u662f \uff1a \u955c\u50cf\u4e2d\u7684\u6587\u4ef6\u76ee\u5f55 = linux\u4e2d\u7684\u6587\u4ef6\u76ee\u5f55 - J \u589e\u52a0\u6587\u4ef6\u540d\u957f\u5ea6\u523064\u4e2aunicode\u5b57\u7b26 \u3002 \u5f53\u955c\u50cf\u88ab\u7528\u4e8eWindows\u7cfb\u7edf\u65f6\u5f88\u6709\u7528\u5904 - r \u8bb0\u5f55\u8f83\u591a\u7684\u4fe1\u606f \uff08 UID \u3001 GID\u7b49 \uff09 - V volid \u6307\u5b9a\u5199\u5165\u4e3bblock\u7684volume id ( volume name or label ) - m glob \u6392\u9664\u6587\u4ef6 \u3002 glob \uff1a shell \u901a\u914d\u7b26\u8868\u8fbe\u5f0f - b eltorito_boot_image \u5236\u4f5cx86\u542f\u52a8CD\u65f6\u6307\u5b9a\u542f\u52a8\u955c\u50cf - c boot_catalog \u5236\u4f5cEl Torito\u542f\u52a8CD\u65f6\u8981\u6c42\u7684\u542f\u52a8\u76ee\u5f55 - no - emul - boot \u521b\u5efa\u975e\u4eff\u771f \uff08 no emulation \uff09 \u955c\u50cf - boot - load - size load_sectors \u6307\u5b9a\u5728\u65e0\u4eff\u771f\u6a21\u5f0f\u4e0b\u52a0\u8f7d\u7684 \"\u865a\u62df\" \uff08 512 \u5b57\u8282 \uff09 \u6247\u533a\u6570 \u3002 \u5fc5\u987b\u65f64\u7684\u500d\u6570 - R \u4f7f\u7528Rock Ridge\u534f\u8bae\u751f\u6210SUS\u548cRR\u8bb0\u5f55 \uff0c \u8fdb\u4e00\u6b65\u63cf\u8ff0ISO9660 \u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6 - T \u5728\u6bcf\u4e2a\u6587\u4ef6\u4e0b\u751f\u6210\u4e00\u4e2a TRANS . TBL \u6587\u4ef6 \uff0c \u7528\u4e8enon - Rock Ridge - capable\u7cfb\u7edf\u8bc6\u522b\u6b63\u786e\u7684\u6587\u4ef6\u540d \u5236\u4f5c\u6587\u4ef6\u5907\u4efd\u955c\u50cf\uff1a # \u5728\u4e0d\u4f7f\u7528 -graft-points \u9009\u9879\u65f6\uff0c\u4f1a\u5c06\u76ee\u5f55\u7684\u6570\u636e\u5168\u90e8\u653e\u5230\u955c\u50cf\u6587\u4ef6\u4e2d\u7684\u6700\u9876\u5c42 [ root@dev tmp ] # mkisofs -r -v -V test-mkisofs -m projects -m isos -m idea-IU* -m clion-2018.3 -m docker -m .CLion2018.3 -o test.img /home /root # \u4f7f\u7528 -graft-points \u9009\u9879\u6765\u5b9a\u5236\u6570\u636e\u6240\u5728\u76ee\u5f55 [ root@dev tmp ] # mkisofs -r -v -V test-mkisofs -m projects -m isos -m idea-IU* -m clion-2018.3 -m docker -m .CLion2018.3 -m .PyCharm2016.2 -m spice-package -o test.img -graft-points /home=/home /linux/root=/root [ root@dev tmp ] # mount test.img img/ [ root@dev tmp ] # cd img/ [ root@dev img ] # tree -d -L 2 . \u251c\u2500\u2500 home \u2502 \u251c\u2500\u2500 amhello-1.0 \u2502 \u251c\u2500\u2500 sink \u2502 \u251c\u2500\u2500 study \u2502 \u251c\u2500\u2500 tmp \u2502 \u251c\u2500\u2500 user1 \u2502 \u251c\u2500\u2500 user2 \u2502 \u2514\u2500\u2500 wine-3.0 \u251c\u2500\u2500 linux \u2502 \u2514\u2500\u2500 root \u2514\u2500\u2500 rr_moved \u5236\u4f5c\u7cfb\u7edf\u542f\u52a8\u76d8\uff0c\u672c\u6b21\u4f7f\u7528VMware\u865a\u62df\u673a\uff1a # \u6302\u8f7d\u6216\u4e0b\u8f7d\u4e00\u4e2aCentOS\u7684iso\u955c\u50cf\u5230\u865a\u62df\u673a\u4e2d $ cd /run/media/root/CentOS \\ 7 \\ x86_64/ # \u590d\u5236\u5230\u65b0\u7684\u76ee\u5f55\u4e0b $ rsync -a . /tmp/img/ # \u8fdb\u5165\u76ee\u5f55\u5236\u4f5c\u955c\u50cf $ cd /tmp/img/ $ mkisofs -o /tmp/custom.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -V 'CentOS 7 x86_64' -boot-load-size 4 -boot-info-table -R -J -v -T . # \u67e5\u770b\u955c\u50cf $ cd .. ; isoinfo -d -i custom.iso","title":"4.1 \u521b\u5efa\u955c\u50cf\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#42","text":"centos7\u4f7f\u7528wodim\u8fdb\u884c\u70e7\u5f55\uff0c\u4f46\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u5c06cdrecode\u94fe\u63a5\u5230\u4e86wodim\u3002 [ root@dev ~ ] # ll /usr/bin/cdrecord lrwxrwxrwx. 1 root root 26 Nov 8 2018 /usr/bin/cdrecord -> /etc/alternatives/cdrecord [ root@dev ~ ] # ll /etc/alternatives/cdrecord lrwxrwxrwx. 1 root root 14 Nov 8 2018 /etc/alternatives/cdrecord -> /usr/bin/wodim VMware\u597d\u50cf\u6ca1\u6cd5\u5b9e\u9a8c\uff0c\u5148\u8bb0\u5f55\u4e00\u4e0b\u64cd\u4f5c\uff1a # \u626b\u63cf\u70e7\u5f55\u673a $ wodim --devices dev = /dev/sr0 wodim: Overview of accessible drives ( 1 found ) : ------------------------------------------------------------------------- 0 dev = '/dev/sr0' rwrw-- : 'NECVMWar' 'VMware IDE CDR10' ------------------------------------------------------------------------- # \u64e6\u9664\u5149\u76d8\u5185\u5bb9\u3002blank\uff1afast\uff0call $ wodim -v dev = /dev/sr0 blank = fast # \u70e7\u5f55\u3002eject\uff1a\u70e7\u5f55\u5b8c\u6bd5\u540e\u9000\u51fa\u5149\u76d8 $ wodim -v dev = /dev/sr0 speed = 4 -dummy -eject custom.iso # \u6302\u8f7d\u6d4b\u8bd5","title":"4.2 \u70e7\u5f55\u5230\u5149\u76d8"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#5","text":"","title":"5. \u5176\u5b83\u5907\u4efd\u5de5\u5177"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#51-dd","text":"# \u5907\u4efd\u666e\u901a\u6587\u4ef6\uff0c\u9ed8\u8ba4\u662f 512Bytes \u4e00\u4e2a\u5355\u4f4d [ root@dev tmp ] # dd if=/etc/passwd of=passwd.back # \u5907\u4efd\u5149\u76d8 [ root@dev tmp ] # dd if=/dev/sr0 of=test.img # \u5907\u4efd\u5230USB\uff0c\u4e0d\u9700\u8981\u683c\u5f0f\u5316 [ root@dev tmp ] # dd if=test.img of=/dev/sdd # \u5907\u4efd\u6587\u4ef6\u7cfb\u7edf [ root@dev tmp ] # dd if=/dev/sda1 of=sda1.img # \u5148\u521b\u5efa\u4e00\u4e2a\u5206\u533a /dev/sdd1(\u5fc5\u987b\u5927\u4e8e\u8981\u5907\u4efd\u7684\u6587\u4ef6) \uff0c\u7528\u4e8e\u5907\u4efd /dev/sda1 [ root@dev tmp ] # df -h /boot Filesystem Size Used Avail Use% Mounted on /dev/sda1 1014M 276M 739M 28 % /boot [ root@dev tmp ] # dd if=/dev/sda1 of=/dev/sdd1 2097152 +0 records in 2097152 +0 records out 1073741824 bytes ( 1 .1 GB ) copied, 6 .84414 s, 157 MB/s # \u4e00\u5b9a\u8981\u6e05\u7406log [ root@dev tmp ] # xfs_repair -L /dev/sdd1 # \u6539\u6389\u539f\u6765\u7684UUID [ root@dev tmp ] # uuidgen 8de09e65-741b-40d0-a66a-caa9fff7bdc5 [ root@dev tmp ] # xfs_admin -U 8de09e65-741b-40d0-a66a-caa9fff7bdc5 /dev/sdd1 Clearing log and setting UUID writing all SBs new UUID = 8de09e65-741b-40d0-a66a-caa9fff7bdc5 [ root@dev tmp ] # mount /dev/sdd1 sdd1/ [ root@dev tmp ] # xfs_growfs sdd1 # \u5f88\u5947\u602a\uff0c\u5907\u4efd\u7684\u6587\u4ef6\u6bd4\u539f\u6587\u4ef6\u5c11\u4e86\u5f88\u591a\u4e1c\u897f\uff08\u4e09\u4e2a\u7248\u672c\u7684\u5185\u6838\u6587\u4ef6\u53ea\u4fdd\u7559\u4e86\u4e00\u4efd\uff0c\u8fd8\u4e0d\u662f\u540c\u4e00\u4e2a\u7248\u672c\u7684\uff09\u3002\uff1f\uff1f\uff1f [ root@dev tmp ] # ll sdd1/ total 21820 -rw-r--r--. 1 root root 137696 Nov 23 2016 config-3.10.0-514.el7.x86_64 drwxr-xr-x. 3 root root 17 Nov 8 2018 efi drwxr-xr-x. 2 root root 4096 Nov 8 2018 extlinux drwxr-xr-x. 2 root root 27 Nov 8 2018 grub drwx------. 5 root root 132 Sep 19 08 :31 grub2 -rw------- 1 root root 13407979 Jun 12 09 :26 initramfs-3.10.0-957.21.2.el7.x86_64kdump.img -rw-r--r--. 1 root root 277953 Nov 23 2016 symvers-3.10.0-514.el7.x86_64.gz -rw-------. 1 root root 3113253 Nov 23 2016 System.map-3.10.0-514.el7.x86_64 -rw-r--r-- 1 root root 0 Sep 29 15 :27 test-xfsdump -rwxr-xr-x. 1 root root 5392080 Nov 23 2016 vmlinuz-3.10.0-514.el7.x86_64 [ root@dev tmp ] # ll /boot/ total 239472 -rw-r--r--. 1 root root 137696 Nov 23 2016 config-3.10.0-514.el7.x86_64 -rw-r--r--. 1 root root 147859 Sep 26 2018 config-3.10.0-862.14.4.el7.x86_64 -rw-r--r-- 1 root root 151923 Jun 5 22 :30 config-3.10.0-957.21.2.el7.x86_64 drwxr-xr-x. 3 root root 17 Nov 8 2018 efi drwxr-xr-x. 2 root root 4096 Nov 8 2018 extlinux drwxr-xr-x. 2 root root 27 Nov 8 2018 grub drwx------. 5 root root 132 Sep 19 08 :31 grub2 -rw-------. 1 root root 64521440 Nov 8 2018 initramfs-0-rescue-3e584bbb71104099905f8ba7873188ea.img -rw-------. 1 root root 31516942 Nov 8 2018 initramfs-3.10.0-514.el7.x86_64.img -rw-------. 1 root root 13729374 Nov 8 2018 initramfs-3.10.0-514.el7.x86_64kdump.img -rw-------. 1 root root 31500158 Nov 8 2018 initramfs-3.10.0-862.14.4.el7.x86_64.img -rw------- 1 root root 13399648 May 20 08 :52 initramfs-3.10.0-862.14.4.el7.x86_64kdump.img -rw------- 1 root root 31647417 Jun 11 17 :06 initramfs-3.10.0-957.21.2.el7.x86_64.img -rw------- 1 root root 13407979 Jun 12 09 :26 initramfs-3.10.0-957.21.2.el7.x86_64kdump.img -rw-r--r--. 1 root root 10209490 Nov 8 2018 initrd-plymouth.img -rw-r--r--. 1 root root 277953 Nov 23 2016 symvers-3.10.0-514.el7.x86_64.gz -rw-r--r--. 1 root root 305158 Sep 26 2018 symvers-3.10.0-862.14.4.el7.x86_64.gz -rw-r--r-- 1 root root 314128 Jun 5 22 :30 symvers-3.10.0-957.21.2.el7.x86_64.gz -rw-------. 1 root root 3113253 Nov 23 2016 System.map-3.10.0-514.el7.x86_64 -rw-------. 1 root root 3414754 Sep 26 2018 System.map-3.10.0-862.14.4.el7.x86_64 -rw------- 1 root root 3545794 Jun 5 22 :30 System.map-3.10.0-957.21.2.el7.x86_64 -rw-r--r-- 1 root root 0 Sep 29 15 :27 test-xfsdump -rwxr-xr-x. 1 root root 5392080 Nov 8 2018 vmlinuz-0-rescue-3e584bbb71104099905f8ba7873188ea -rwxr-xr-x. 1 root root 5392080 Nov 23 2016 vmlinuz-3.10.0-514.el7.x86_64 -rwxr-xr-x. 1 root root 6398144 Sep 26 2018 vmlinuz-3.10.0-862.14.4.el7.x86_64 -rwxr-xr-x 1 root root 6643904 Jun 5 22 :30 vmlinuz-3.10.0-957.21.2.el7.x86_64","title":"5.1 dd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/07 \u6253\u5305\u3001\u538b\u7f29\u4e0e\u5907\u4efd/#52-cpio","text":"\u53ef\u4ee5\u5907\u4efd\u4efb\u4f55\u4e1c\u897f\u3002 # \u5907\u4efd cpio - o [ options ] > file / device Options : - a \u4e0d\u4fee\u6539\u88ab\u5907\u4efd\u6587\u4ef6\u7684atime - B \u8bbe\u7f6e I / O block size to 5120 bytes . \u9ed8\u8ba4\u662f 512 bytes . - c \u4f7f\u7528\u65b0\u7684 ( SVR4 ) portable format \uff0c \u4e0e \u201c - H newc \u201d \u4e00\u6837 . \u8001\u7684 portable ( ASCII ) archive format \u4f7f\u7528 \u201c - H odc \u201d # \u8fd8\u539f cpio - i < file / device Options : - m \u4e0d\u4fee\u6539mtime - c \u540c\u5907\u4efd\u9009\u9879\u4e00\u6837 - d \u81ea\u52a8\u521b\u5efa\u76ee\u5f55 \u3002 \u56e0\u4e3a\u4f7f\u7528cpio\u5907\u4efd\u7684\u6570\u636e\u5185\u5bb9\u4e0d\u4e00\u5b9a\u4f1a\u5728\u540c\u4e00\u4e2a\u76ee\u5f55\u4e2d \uff0c \u6240\u4ee5\u5fc5\u987b\u8ba9\u5b83\u53ef\u4ee5\u521b\u5efa\u76ee\u5f55 - u \u81ea\u52a8\u4f7f\u7528\u65b0\u6587\u4ef6\u8986\u76d6\u5c31\u6587\u4ef6 - t \u67e5\u770b\u5907\u4efd\u6587\u4ef6\u7684\u5185\u5bb9 \u5907\u4efd\u53ca\u8fd8\u539f\u90fd\u9002\u7528\u7684\u9009\u9879 \uff1a --no-absolute-filenames \u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6 # \u8f93\u5165\u4e0d\u80fd\u542b\u6709\u6839\u76ee\u5f55\uff01\uff01\uff01 [ root@dev tmp ] # cd / [ root@dev / ] # find boot | cpio -ocBav > /tmp/boot.cpio [ root@dev tmp ] # cpio -icdm < boot.cpio 496612 blocks # \u5185\u5bb9\u4e00\u81f4 [ root@dev tmp ] # ll boot","title":"5.2 cpio"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/","text":"1. \u53d8\u91cf \u00b6 \u4f7f\u7528 env \u5217\u51fa\u53d8\u91cf\uff1b \u4f7f\u7528 export \u5217\u51fa\u4e0e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1b \u4f7f\u7528 set \u3001 declare \u6216 typeset \u5217\u51fa\u53d8\u91cf\uff1b \u4f7f\u7528 unset \u53d6\u6d88\u53d8\u91cf\u3002 \u73af\u5883\u53d8\u91cf PS1 \u8bbe\u7f6e\u547d\u4ee4\u63d0\u793a\u7b26\u3002 [ sink@dev ~ ] $ set | grep PS1 PS1 = '[\\u@\\h \\W]\\$ ' [ sink@dev ~ ] $ PS1 = '[\\u@\\h \\t \\W]\\$ ' [ sink@dev 08 :37:24 ~ ] $ # \u67e5\u8be2\u4f7f\u7528\u8bf4\u660e $ man bash 1.1 \u83b7\u53d6\u952e\u76d8\u8f93\u5165 \u00b6 read [ - p prompt ] [ - t timeout ] [ name ...] \u5c06\u952e\u76d8\u8f93\u5165\u5b58\u5230\u53d8\u91cf\u4e2d - p \u63d0\u793a\u4fe1\u606f - t \u7b49\u5f85\u65f6\u957f name \u53d8\u91cf\u540d [ sink@dev ~ ] $ read -p \"input> \" -t 5 tmp_str input> 123456 [ sink@dev ~ ] $ echo $tmp_str 123456 1.2 \u58f0\u660e\u53d8\u91cf\u7c7b\u578b \u00b6 declare / typeset [ - aAfFgilrtux ] [ - p ] [ name [ = value ] ...] - a \u5b9a\u4e49\u6570\u7ec4\u7c7b\u578b - i \u5b9a\u4e49\u6574\u6570\u7c7b\u578b - x \u4e0e export \u4e00\u6837\uff0c\u5c06\u53d8\u91cf\u58f0\u660e\u4e3a\u73af\u5883\u53d8\u91cf - r \u5b9a\u4e49 readonly \u7c7b\u578b\uff0c\u4e0d\u53ef\u4fee\u6539\uff0c\u4e0d\u53ef unset \u3002\u6ce8\u9500\u91cd\u65b0\u767b\u5f55\u624d\u5f00\u6d88\u9664\u8be5\u4e34\u65f6\u53d8\u91cf - p \u5217\u51fa\u53d8\u91cf\u7684\u503c\u548c\u5c5e\u6027 \u4f7f\u7528\u201c + \u201d\u6765\u53d6\u6d88\u58f0\u660e\u7684\u5c5e\u6027\u3002\u4f8b\u5916\uff1a + a \u4e0d\u80fd\u7528\u4e8e\u9500\u6bc1\u6570\u7ec4\u53d8\u91cf\u548c + r \u4e0d\u4f1a\u5220\u9664\u53ea\u8bfb\u5c5e\u6027\u3002 [ sink@dev ~ ] $ sum = 123 -234 [ sink@dev ~ ] $ echo $sum 123 -234 [ sink@dev ~ ] $ declare -i sum = 123 -234 [ sink@dev ~ ] $ echo $sum -111 [ sink@dev ~ ] $ declare -x sum [ sink@dev ~ ] $ export | grep sum declare -ix sum = \"-111\" [ sink@dev ~ ] $ declare -r sum [ sink@dev ~ ] $ sum = 123 -bash: sum: readonly variable [ sink@dev ~ ] $ unset sum -bash: unset: sum: cannot unset: readonly variable [ sink@dev ~ ] $ declare -p sum declare -irx sum = \"-111\" 1.3 \u6570\u7ec4\u53d8\u91cf \u00b6 \u53ef\u4ee5\u4e0d\u5199declare\u8bed\u53e5\u76f4\u63a5\u58f0\u660e [ sink@dev ~ ] $ var [ 1 ]= \"a1\" [ sink@dev ~ ] $ var [ 2 ]= \"b2\" [ sink@dev ~ ] $ var [ 3 ]= 3 [ sink@dev ~ ] $ declare -a var [ 4 ]= '45' [ sink@dev ~ ] $ declare -p var declare -a var = '([1]=\"a1\" [2]=\"b2\" [3]=\"3\" [4]=\"45\")' # \u6570\u7ec4\u7684\u83b7\u53d6\u4f7f\u7528 ${} \u5f62\u5f0f [ sink@dev ~ ] $ echo $var [ 1 ] [ 1 ] [ sink@dev ~ ] $ echo ${ var [1] } a1 2. \u7cfb\u7edf\u9650\u5236 \u00b6 ulimit [ - HSTabcdefilmnpqrstuvx [ limit ]] \u9650\u5236\u53ef\u521b\u5efa\u7684\u6587\u4ef6\u5927\u5c0f\u3001 CPU \u7b49\u3002 - H \u4e0d\u80fd\u8d85\u8fc7\u8bbe\u5b9a\u503c - S \u8d85\u8fc7\u65f6\u53d1\u51fa\u8b66\u544a - a All current limits are reported - b The maximum socket buffer size - c The maximum size of core files created \u3002\u6838\u5fc3\u6587\u4ef6\uff1a\u7cfb\u7edf\u5c06\u67d0\u4e9b\u51fa\u9519\u7684\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u7684\u4fe1\u606f\u5199\u51fa\u7684\u6587\u4ef6 - d The maximum size of a process ' s data segment - f The maximum size of files written by the shell and its children \u3002\u6ca1\u6709\u9009\u9879\u65f6\u7684\u9ed8\u8ba4\u9009\u9879 - n The maximum number of open file descriptors ( most systems do not allow this value to be set ) - t The maximum amount of cpu time in seconds - u The maximum number of processes available to a single user - T The maximum number of threads [ sink@dev ~ ] $ ulimit -a core file size ( blocks, -c ) 0 # 0\u8868\u793a\u65e0\u9650\u5236 data seg size ( kbytes, -d ) unlimited scheduling priority ( -e ) 0 file size ( blocks, -f ) unlimited pending signals ( -i ) 63335 max locked memory ( kbytes, -l ) 64 max memory size ( kbytes, -m ) unlimited open files ( -n ) 1024 pipe size ( 512 bytes, -p ) 8 POSIX message queues ( bytes, -q ) 819200 real-time priority ( -r ) 0 stack size ( kbytes, -s ) 8192 cpu time ( seconds, -t ) unlimited max user processes ( -u ) 4096 virtual memory ( kbytes, -v ) unlimited file locks ( -x ) unlimited [ sink@dev ~ ] $ ulimit -f 10240 [ sink@dev ~ ] $ dd if = /dev/zero of = limit-file bs = 4k count = 10000 File size limit exceeded [ sink@dev ~ ] $ ll -h limit-file -rw-rw-r-- 1 sink sink 10M Oct 9 09 :37 limit-file \u6ce8\u9500\u91cd\u65b0\u767b\u5f55\u53ef\u6062\u590d\u539f\u5148\u7684\u9650\u5236\u3002 [ sink@dev ~ ] $ exit logout > ssh sink@172.16.2.237 [ sink@dev ~ ] $ ulimit -f unlimited 3. bash\u7684\u64cd\u4f5c\u73af\u5883 \u00b6 3.1 \u6307\u4ee4\u7684\u641c\u5bfb\u987a\u5e8f \u00b6 \u6307\u4ee4\u6309\u7167\u4ee5\u4e0b\u987a\u5e8f\u6765\u641c\u7d22\uff1a \u4ee5\u7edd\u5bf9/\u76f8\u5bf9\u8def\u5f84\u6267\u884c\u6307\u4ee4\uff0c\u4f8b\u5982 /bin/ls \u3001 ./ls \u7531alias\u627e\u5230\u8be5\u6307\u4ee4\u5e76\u6267\u884c \u7531bash\u5185\u7f6e\u7684\u6307\u4ee4\u6765\u6267\u884c \u901a\u8fc7 $PATH \u7684\u987a\u5e8f\u641c\u5bfb\u5230\u7684\u7b2c\u4e00\u4e2a\u6307\u4ee4\u6765\u6267\u884c type -a <command> \u4f1a\u6309\u987a\u5e8f\u5c06\u627e\u5230\u7684\u6307\u4ee4\u5217\u51fa\u3002 3.2 bash\u7684\u8fdb\u5165\u65f6\u7684\u4fe1\u606f \u00b6 \u767b\u5f55\u4e4b\u524d\u663e\u793a\u7684\u4fe1\u606f\u5728 /etc/issue \uff08 /etc/issue.net \u662f\u901a\u8fc7telnet\u767b\u5f55\u65f6\u663e\u793a\u7684\u4fe1\u606f\uff09\u4e2d\u914d\u7f6e\uff0c\u53ef\u5728 man 8 agetty \u7684 ISSUE ESCAPES \u7ae0\u8282\u67e5\u9605\u90fd\u652f\u6301\u54ea\u4e9b\u4fe1\u606f\u3002 [ root@dev vitest ] # cat /etc/issue \\S Kernel \\r on an \\m \u767b\u5f55\u4e4b\u540e\u663e\u793a\u7684\u4fe1\u606f\u5728 /etc/motd \u4e2d\u914d\u7f6e\uff1a [ root@dev vitest ] # cat /etc/motd Warning, the server will be maintained at 2019 .10.10 15 :00~19:00 3.3 bash\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6\uff08 login shell \u4e0e non-login shell \uff09 \u00b6 login shell \uff1a\u53d6\u5f97 bash \u65f6\u9700\u8981\u5b8c\u6574\u7684\u767b\u9646\u6d41\u7a0b\u7684\uff0c\u5c31\u79f0\u4e3a login shell\u3002 non-login shell \uff1a\u4e0d\u9700\u8981\u91cd\u590d\u767b\u9646\u4e3e\u52a8\u7684\u53d6\u5f97 bash \u3002\u6bd4\u5982\u5b50\u7a0b\u5e8f\u3002 3.3.1 login shell \u00b6 \u8bfb\u53d6 /etc/profile \u548c ~/.bash_profile \u6216 ~/.bash_login \u6216 ~/.profile \u6587\u4ef6\u3002 /etc/profile \u662f\u8bbe\u7f6e\u6574\u4f53\u73af\u5883\u53d8\u91cf\u7684\u5730\u65b9\uff0c\u63a7\u5236\u8005\u6240\u6709\u767b\u5f55\u7528\u6237\u7684\u53d8\u91cf\u3002\u4e3b\u8981\u6709\uff1a PATH USER LOGNAME MAIL HOSTNAME HISTSIZE\uff1a\u5386\u53f2\u547d\u4ee4\u6570\u91cf\u3002 umask \u9664\u4e86\u8bbe\u7f6e\u4e00\u4e9b\u5168\u5c40\u53d8\u91cf\uff0c\u8fd8\u4f1a\u53bb\u6267\u884c\u4e00\u4e9bbash\u73af\u5883\u8bbe\u7f6e\u7684\u811a\u672c\uff1a for i in /etc/profile.d/*.sh /etc/profile.d/sh.local ; do if [ -r \" $i \" ] ; then if [ \" ${ -#*i } \" ! = \" $- \" ] ; then . \" $i \" else . \" $i \" >/dev/null fi fi done \u5728\u6267\u884c\u5b8c\u6bd5 /etc/profile \u4e4b\u540e\uff0c\u5c31\u4f1a\u6309\u987a\u5e8f\u8bfb\u53d6\u7528\u6237\u7684\u4e2a\u4eba\u504f\u597d\u8bbe\u7f6e\u6587\u4ef6\uff08\u53ea\u8bfb\u53d6\u627e\u5230\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\uff09\uff1a ~/.bash_profile ~/.bash_login ~/.profile [ root@dev ~ ] # cat ~/.bash_profile # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ] ; then . ~/.bashrc fi # \u7528\u6237\u6307\u5b9a\u7684\u73af\u5883\u548c\u542f\u52a8\u7a0b\u5e8f # User specific environment and startup programs PATH = $PATH : $HOME /bin export PATH \u8fd9\u91cc\u4f1a\u6267\u884c ~/.bashrc \u6587\u4ef6\uff0c\u5c06\u91cc\u9762\u7684\u8bbe\u7f6e\u8bfb\u53d6\u5230\u5f53\u524d\u7684\u73af\u5883\u4e2d\u3002\u800c ~/.bashrc \u91cc\u9762\u8bbe\u7f6e\u4e86\u53d8\u91cf\u522b\u540d\uff0c\u7136\u540e\u5c06 /etc/bashrc \u7684\u8bbe\u7f6e\u8bfb\u53d6\u5230\u5f53\u524dshell\u73af\u5883\u4e2d\uff0c\u81f3\u4e8e /etc/bashrc \u505a\u4e86\u4ec0\u4e48\uff0c\u8bf7\u770b\u4e0b\u9762\u7684 non-login shell \u5c0f\u8282\u3002 3.3.2 non-login shell \u00b6 \u8bfb\u53d6 ~/.bashrc \u6587\u4ef6\u3002 \u4e0a\u6587\u63d0\u5230 ~/.bashrc \u4e3b\u8981\u662f\u8bbe\u7f6e\u53d8\u91cf\u522b\u540d\u4e0e\u6267\u884c /etc/bashrc \uff0c /etc/bashrc \u7684\u4e3b\u8981\u4f5c\u7528\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u6839\u636e\u4e0d\u540c\u7684UID\u89c4\u5b9aunmask\u7684\u503c \u6839\u636e\u4e0d\u540c\u7684UID\u89c4\u5b9a PS1\uff08\u547d\u4ee4\u884c\u63d0\u793a\u7b26\uff09\u53d8\u91cf \u8c03\u7528 /etc/profile.d/*.sh \u7684\u8bbe\u7f6e 4. \u6742\u9879 \u00b6 \u8bfb\u5165\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u7684\u6307\u4ee4\u662f source \u6216 . \u3002 \u6ce8\u9500\u4e4b\u540e\u6267\u884c\u7684\u52a8\u4f5c\u5728 ~/.bash_logout \u4e2d\u914d\u7f6e\u3002 stty \u8bbe\u7f6e\u7ec8\u7aef\u7684\u6309\u952e\u7b49\u3002 Ctrl+U \uff1a\u5728\u547d\u4ee4\u884c\u4e0a\u5411\u524d\u5220\u9664\u547d\u4ee4\uff1b Ctrl+K \uff1a\u5411\u540e\u5220\u9664\u547d\u4ee4\u3002 bash\u7684\u901a\u914d\u7b26\uff1a * \u3001 ? \u3001 [-] \uff08\u4f8b\uff1a[0-9]\uff09\u3001 [] \uff08\u4f8b\uff1a[ABCD]\uff09\u3001 [^] \uff08\u4f8b\uff1a[^abcd]\uff09\u3002","title":"08 bash"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#1","text":"\u4f7f\u7528 env \u5217\u51fa\u53d8\u91cf\uff1b \u4f7f\u7528 export \u5217\u51fa\u4e0e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1b \u4f7f\u7528 set \u3001 declare \u6216 typeset \u5217\u51fa\u53d8\u91cf\uff1b \u4f7f\u7528 unset \u53d6\u6d88\u53d8\u91cf\u3002 \u73af\u5883\u53d8\u91cf PS1 \u8bbe\u7f6e\u547d\u4ee4\u63d0\u793a\u7b26\u3002 [ sink@dev ~ ] $ set | grep PS1 PS1 = '[\\u@\\h \\W]\\$ ' [ sink@dev ~ ] $ PS1 = '[\\u@\\h \\t \\W]\\$ ' [ sink@dev 08 :37:24 ~ ] $ # \u67e5\u8be2\u4f7f\u7528\u8bf4\u660e $ man bash","title":"1. \u53d8\u91cf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#11","text":"read [ - p prompt ] [ - t timeout ] [ name ...] \u5c06\u952e\u76d8\u8f93\u5165\u5b58\u5230\u53d8\u91cf\u4e2d - p \u63d0\u793a\u4fe1\u606f - t \u7b49\u5f85\u65f6\u957f name \u53d8\u91cf\u540d [ sink@dev ~ ] $ read -p \"input> \" -t 5 tmp_str input> 123456 [ sink@dev ~ ] $ echo $tmp_str 123456","title":"1.1 \u83b7\u53d6\u952e\u76d8\u8f93\u5165"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#12","text":"declare / typeset [ - aAfFgilrtux ] [ - p ] [ name [ = value ] ...] - a \u5b9a\u4e49\u6570\u7ec4\u7c7b\u578b - i \u5b9a\u4e49\u6574\u6570\u7c7b\u578b - x \u4e0e export \u4e00\u6837\uff0c\u5c06\u53d8\u91cf\u58f0\u660e\u4e3a\u73af\u5883\u53d8\u91cf - r \u5b9a\u4e49 readonly \u7c7b\u578b\uff0c\u4e0d\u53ef\u4fee\u6539\uff0c\u4e0d\u53ef unset \u3002\u6ce8\u9500\u91cd\u65b0\u767b\u5f55\u624d\u5f00\u6d88\u9664\u8be5\u4e34\u65f6\u53d8\u91cf - p \u5217\u51fa\u53d8\u91cf\u7684\u503c\u548c\u5c5e\u6027 \u4f7f\u7528\u201c + \u201d\u6765\u53d6\u6d88\u58f0\u660e\u7684\u5c5e\u6027\u3002\u4f8b\u5916\uff1a + a \u4e0d\u80fd\u7528\u4e8e\u9500\u6bc1\u6570\u7ec4\u53d8\u91cf\u548c + r \u4e0d\u4f1a\u5220\u9664\u53ea\u8bfb\u5c5e\u6027\u3002 [ sink@dev ~ ] $ sum = 123 -234 [ sink@dev ~ ] $ echo $sum 123 -234 [ sink@dev ~ ] $ declare -i sum = 123 -234 [ sink@dev ~ ] $ echo $sum -111 [ sink@dev ~ ] $ declare -x sum [ sink@dev ~ ] $ export | grep sum declare -ix sum = \"-111\" [ sink@dev ~ ] $ declare -r sum [ sink@dev ~ ] $ sum = 123 -bash: sum: readonly variable [ sink@dev ~ ] $ unset sum -bash: unset: sum: cannot unset: readonly variable [ sink@dev ~ ] $ declare -p sum declare -irx sum = \"-111\"","title":"1.2 \u58f0\u660e\u53d8\u91cf\u7c7b\u578b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#13","text":"\u53ef\u4ee5\u4e0d\u5199declare\u8bed\u53e5\u76f4\u63a5\u58f0\u660e [ sink@dev ~ ] $ var [ 1 ]= \"a1\" [ sink@dev ~ ] $ var [ 2 ]= \"b2\" [ sink@dev ~ ] $ var [ 3 ]= 3 [ sink@dev ~ ] $ declare -a var [ 4 ]= '45' [ sink@dev ~ ] $ declare -p var declare -a var = '([1]=\"a1\" [2]=\"b2\" [3]=\"3\" [4]=\"45\")' # \u6570\u7ec4\u7684\u83b7\u53d6\u4f7f\u7528 ${} \u5f62\u5f0f [ sink@dev ~ ] $ echo $var [ 1 ] [ 1 ] [ sink@dev ~ ] $ echo ${ var [1] } a1","title":"1.3 \u6570\u7ec4\u53d8\u91cf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#2","text":"ulimit [ - HSTabcdefilmnpqrstuvx [ limit ]] \u9650\u5236\u53ef\u521b\u5efa\u7684\u6587\u4ef6\u5927\u5c0f\u3001 CPU \u7b49\u3002 - H \u4e0d\u80fd\u8d85\u8fc7\u8bbe\u5b9a\u503c - S \u8d85\u8fc7\u65f6\u53d1\u51fa\u8b66\u544a - a All current limits are reported - b The maximum socket buffer size - c The maximum size of core files created \u3002\u6838\u5fc3\u6587\u4ef6\uff1a\u7cfb\u7edf\u5c06\u67d0\u4e9b\u51fa\u9519\u7684\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u7684\u4fe1\u606f\u5199\u51fa\u7684\u6587\u4ef6 - d The maximum size of a process ' s data segment - f The maximum size of files written by the shell and its children \u3002\u6ca1\u6709\u9009\u9879\u65f6\u7684\u9ed8\u8ba4\u9009\u9879 - n The maximum number of open file descriptors ( most systems do not allow this value to be set ) - t The maximum amount of cpu time in seconds - u The maximum number of processes available to a single user - T The maximum number of threads [ sink@dev ~ ] $ ulimit -a core file size ( blocks, -c ) 0 # 0\u8868\u793a\u65e0\u9650\u5236 data seg size ( kbytes, -d ) unlimited scheduling priority ( -e ) 0 file size ( blocks, -f ) unlimited pending signals ( -i ) 63335 max locked memory ( kbytes, -l ) 64 max memory size ( kbytes, -m ) unlimited open files ( -n ) 1024 pipe size ( 512 bytes, -p ) 8 POSIX message queues ( bytes, -q ) 819200 real-time priority ( -r ) 0 stack size ( kbytes, -s ) 8192 cpu time ( seconds, -t ) unlimited max user processes ( -u ) 4096 virtual memory ( kbytes, -v ) unlimited file locks ( -x ) unlimited [ sink@dev ~ ] $ ulimit -f 10240 [ sink@dev ~ ] $ dd if = /dev/zero of = limit-file bs = 4k count = 10000 File size limit exceeded [ sink@dev ~ ] $ ll -h limit-file -rw-rw-r-- 1 sink sink 10M Oct 9 09 :37 limit-file \u6ce8\u9500\u91cd\u65b0\u767b\u5f55\u53ef\u6062\u590d\u539f\u5148\u7684\u9650\u5236\u3002 [ sink@dev ~ ] $ exit logout > ssh sink@172.16.2.237 [ sink@dev ~ ] $ ulimit -f unlimited","title":"2. \u7cfb\u7edf\u9650\u5236"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#3-bash","text":"","title":"3. bash\u7684\u64cd\u4f5c\u73af\u5883"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#31","text":"\u6307\u4ee4\u6309\u7167\u4ee5\u4e0b\u987a\u5e8f\u6765\u641c\u7d22\uff1a \u4ee5\u7edd\u5bf9/\u76f8\u5bf9\u8def\u5f84\u6267\u884c\u6307\u4ee4\uff0c\u4f8b\u5982 /bin/ls \u3001 ./ls \u7531alias\u627e\u5230\u8be5\u6307\u4ee4\u5e76\u6267\u884c \u7531bash\u5185\u7f6e\u7684\u6307\u4ee4\u6765\u6267\u884c \u901a\u8fc7 $PATH \u7684\u987a\u5e8f\u641c\u5bfb\u5230\u7684\u7b2c\u4e00\u4e2a\u6307\u4ee4\u6765\u6267\u884c type -a <command> \u4f1a\u6309\u987a\u5e8f\u5c06\u627e\u5230\u7684\u6307\u4ee4\u5217\u51fa\u3002","title":"3.1 \u6307\u4ee4\u7684\u641c\u5bfb\u987a\u5e8f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#32-bash","text":"\u767b\u5f55\u4e4b\u524d\u663e\u793a\u7684\u4fe1\u606f\u5728 /etc/issue \uff08 /etc/issue.net \u662f\u901a\u8fc7telnet\u767b\u5f55\u65f6\u663e\u793a\u7684\u4fe1\u606f\uff09\u4e2d\u914d\u7f6e\uff0c\u53ef\u5728 man 8 agetty \u7684 ISSUE ESCAPES \u7ae0\u8282\u67e5\u9605\u90fd\u652f\u6301\u54ea\u4e9b\u4fe1\u606f\u3002 [ root@dev vitest ] # cat /etc/issue \\S Kernel \\r on an \\m \u767b\u5f55\u4e4b\u540e\u663e\u793a\u7684\u4fe1\u606f\u5728 /etc/motd \u4e2d\u914d\u7f6e\uff1a [ root@dev vitest ] # cat /etc/motd Warning, the server will be maintained at 2019 .10.10 15 :00~19:00","title":"3.2 bash\u7684\u8fdb\u5165\u65f6\u7684\u4fe1\u606f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#33-bashlogin-shellnon-login-shell","text":"login shell \uff1a\u53d6\u5f97 bash \u65f6\u9700\u8981\u5b8c\u6574\u7684\u767b\u9646\u6d41\u7a0b\u7684\uff0c\u5c31\u79f0\u4e3a login shell\u3002 non-login shell \uff1a\u4e0d\u9700\u8981\u91cd\u590d\u767b\u9646\u4e3e\u52a8\u7684\u53d6\u5f97 bash \u3002\u6bd4\u5982\u5b50\u7a0b\u5e8f\u3002","title":"3.3 bash\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6\uff08login shell\u4e0enon-login shell\uff09"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#331-login-shell","text":"\u8bfb\u53d6 /etc/profile \u548c ~/.bash_profile \u6216 ~/.bash_login \u6216 ~/.profile \u6587\u4ef6\u3002 /etc/profile \u662f\u8bbe\u7f6e\u6574\u4f53\u73af\u5883\u53d8\u91cf\u7684\u5730\u65b9\uff0c\u63a7\u5236\u8005\u6240\u6709\u767b\u5f55\u7528\u6237\u7684\u53d8\u91cf\u3002\u4e3b\u8981\u6709\uff1a PATH USER LOGNAME MAIL HOSTNAME HISTSIZE\uff1a\u5386\u53f2\u547d\u4ee4\u6570\u91cf\u3002 umask \u9664\u4e86\u8bbe\u7f6e\u4e00\u4e9b\u5168\u5c40\u53d8\u91cf\uff0c\u8fd8\u4f1a\u53bb\u6267\u884c\u4e00\u4e9bbash\u73af\u5883\u8bbe\u7f6e\u7684\u811a\u672c\uff1a for i in /etc/profile.d/*.sh /etc/profile.d/sh.local ; do if [ -r \" $i \" ] ; then if [ \" ${ -#*i } \" ! = \" $- \" ] ; then . \" $i \" else . \" $i \" >/dev/null fi fi done \u5728\u6267\u884c\u5b8c\u6bd5 /etc/profile \u4e4b\u540e\uff0c\u5c31\u4f1a\u6309\u987a\u5e8f\u8bfb\u53d6\u7528\u6237\u7684\u4e2a\u4eba\u504f\u597d\u8bbe\u7f6e\u6587\u4ef6\uff08\u53ea\u8bfb\u53d6\u627e\u5230\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\uff09\uff1a ~/.bash_profile ~/.bash_login ~/.profile [ root@dev ~ ] # cat ~/.bash_profile # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ] ; then . ~/.bashrc fi # \u7528\u6237\u6307\u5b9a\u7684\u73af\u5883\u548c\u542f\u52a8\u7a0b\u5e8f # User specific environment and startup programs PATH = $PATH : $HOME /bin export PATH \u8fd9\u91cc\u4f1a\u6267\u884c ~/.bashrc \u6587\u4ef6\uff0c\u5c06\u91cc\u9762\u7684\u8bbe\u7f6e\u8bfb\u53d6\u5230\u5f53\u524d\u7684\u73af\u5883\u4e2d\u3002\u800c ~/.bashrc \u91cc\u9762\u8bbe\u7f6e\u4e86\u53d8\u91cf\u522b\u540d\uff0c\u7136\u540e\u5c06 /etc/bashrc \u7684\u8bbe\u7f6e\u8bfb\u53d6\u5230\u5f53\u524dshell\u73af\u5883\u4e2d\uff0c\u81f3\u4e8e /etc/bashrc \u505a\u4e86\u4ec0\u4e48\uff0c\u8bf7\u770b\u4e0b\u9762\u7684 non-login shell \u5c0f\u8282\u3002","title":"3.3.1 login shell"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#332-non-login-shell","text":"\u8bfb\u53d6 ~/.bashrc \u6587\u4ef6\u3002 \u4e0a\u6587\u63d0\u5230 ~/.bashrc \u4e3b\u8981\u662f\u8bbe\u7f6e\u53d8\u91cf\u522b\u540d\u4e0e\u6267\u884c /etc/bashrc \uff0c /etc/bashrc \u7684\u4e3b\u8981\u4f5c\u7528\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u6839\u636e\u4e0d\u540c\u7684UID\u89c4\u5b9aunmask\u7684\u503c \u6839\u636e\u4e0d\u540c\u7684UID\u89c4\u5b9a PS1\uff08\u547d\u4ee4\u884c\u63d0\u793a\u7b26\uff09\u53d8\u91cf \u8c03\u7528 /etc/profile.d/*.sh \u7684\u8bbe\u7f6e","title":"3.3.2 non-login shell"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/08 bash/#4","text":"\u8bfb\u5165\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u7684\u6307\u4ee4\u662f source \u6216 . \u3002 \u6ce8\u9500\u4e4b\u540e\u6267\u884c\u7684\u52a8\u4f5c\u5728 ~/.bash_logout \u4e2d\u914d\u7f6e\u3002 stty \u8bbe\u7f6e\u7ec8\u7aef\u7684\u6309\u952e\u7b49\u3002 Ctrl+U \uff1a\u5728\u547d\u4ee4\u884c\u4e0a\u5411\u524d\u5220\u9664\u547d\u4ee4\uff1b Ctrl+K \uff1a\u5411\u540e\u5220\u9664\u547d\u4ee4\u3002 bash\u7684\u901a\u914d\u7b26\uff1a * \u3001 ? \u3001 [-] \uff08\u4f8b\uff1a[0-9]\uff09\u3001 [] \uff08\u4f8b\uff1a[ABCD]\uff09\u3001 [^] \uff08\u4f8b\uff1a[^abcd]\uff09\u3002","title":"4. \u6742\u9879"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/09 shell\u811a\u672c/","text":"1. \u811a\u672c\u7684\u6267\u884c\u65b9\u5f0f \u00b6 \u9664\u4e86root\u5916\uff0c\u53ef\u6267\u884c\u7684\u811a\u672c\u5fc5\u987b\u5177\u6709\u8bfb\u6743\u9650\u3002 \u6709\u4ee5\u4e0b5\u4e2d\u6267\u884c\u65b9\u5f0f\uff1a \u7edd\u5bf9\u8def\u5f84 \u76f8\u5bf9\u8def\u5f84 \u653e\u5728\u53d8\u91cfPATH\u4e2d \u4ee5bash\u7a0b\u5e8f\u6765\u6267\u884c\u3002 \"bash test.sh\"\uff0c\u6309\u7167 \u6307\u4ee4\u641c\u5bfb\u987a\u5e8f \u6765\u6267\u884c\u3002 \u4ee5source\u7a0b\u5e8f\u6765\u6267\u884c\u3002\"bash test.sh\"\u3002source\u6307\u4ee4\u4e0e\u4e0a\u8ff04\u79cd\u65b9\u5f0f\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e0d\u4f1a\u4ee5\u65b0\u7684shell\u6765\u6267\u884c\uff0c\u800c\u662f\u5728\u5f53\u524dshell\u73af\u5883\u4e0b\u6267\u884c\u811a\u672c\uff0c\u6545\u53ef\u4ee5\u7528\u6765\u91cd\u65b0\u52a0\u8f7d\u73af\u5883\u53d8\u91cf\uff1a\"source ~/.bashrc\"\u3002 2. \u811a\u672c\u7684debug \u00b6 sh [ GNU long option ] [ option ] ... sh [ GNU long option ] [ option ] script - file ... option - n Read commands but do not execute them .\u53ef\u4ee5\u68c0\u67e5\u8bed\u6cd5\u9519\u8bef - v Print shell input lines as they are read . - x Print commands and their arguments as they are executed . [ sink@dev vitest ] $ cat add-until.sh #!/bin/sh read -p 'input a number: ' num num = ${ num :- 10 } echo -n \"1+2+...+ ${ num } = \" sum = 0 for (( i = 1 ; i< = ${ num } ; i++ )) do sum = $(( ${ sum } + i )) done #until [ ${num} -lt 1 ] #do # sum=$((${sum} + $num)) # num=$((${num} - 1)) #done echo ${ sum } # \u68c0\u67e5\u8bed\u6cd5 [ sink@dev vitest ] $ sh -n add-until.sh # \u5c06\u8bfb\u5230\u7684\u8bed\u53e5\u90fd\u6253\u5370\u51fa\u6765 [ sink@dev vitest ] $ sh -v add-until.sh #!/bin/sh read -p 'input a number: ' num input a number: 2 num = ${ num :- 10 } echo -n \"1+2+...+ ${ num } = \" 1 +2+...+2 = sum = 0 for (( i = 1 ; i< = ${ num } ; i++ )) do sum = $(( ${ sum } + i )) done #until [ ${num} -lt 1 ] #do # sum=$((${sum} + $num)) # num=$((${num} - 1)) #done echo ${ sum } 3 # \u6253\u5370\u6267\u884c\u7684\u8bed\u53e5\u53ca\u53c2\u6570 [ sink@dev vitest ] $ sh -x add-until.sh + read -p 'input a number: ' num input a number: 2 + num = 2 + echo -n '1+2+...+2 = ' 1 +2+...+2 = + sum = 0 + (( i = 1 )) + (( i< = 2 )) + sum = 1 + (( i++ )) + (( i< = 2 )) + sum = 3 + (( i++ )) + (( i< = 2 )) + echo 3 3","title":"09 shell\u811a\u672c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/09 shell\u811a\u672c/#1","text":"\u9664\u4e86root\u5916\uff0c\u53ef\u6267\u884c\u7684\u811a\u672c\u5fc5\u987b\u5177\u6709\u8bfb\u6743\u9650\u3002 \u6709\u4ee5\u4e0b5\u4e2d\u6267\u884c\u65b9\u5f0f\uff1a \u7edd\u5bf9\u8def\u5f84 \u76f8\u5bf9\u8def\u5f84 \u653e\u5728\u53d8\u91cfPATH\u4e2d \u4ee5bash\u7a0b\u5e8f\u6765\u6267\u884c\u3002 \"bash test.sh\"\uff0c\u6309\u7167 \u6307\u4ee4\u641c\u5bfb\u987a\u5e8f \u6765\u6267\u884c\u3002 \u4ee5source\u7a0b\u5e8f\u6765\u6267\u884c\u3002\"bash test.sh\"\u3002source\u6307\u4ee4\u4e0e\u4e0a\u8ff04\u79cd\u65b9\u5f0f\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e0d\u4f1a\u4ee5\u65b0\u7684shell\u6765\u6267\u884c\uff0c\u800c\u662f\u5728\u5f53\u524dshell\u73af\u5883\u4e0b\u6267\u884c\u811a\u672c\uff0c\u6545\u53ef\u4ee5\u7528\u6765\u91cd\u65b0\u52a0\u8f7d\u73af\u5883\u53d8\u91cf\uff1a\"source ~/.bashrc\"\u3002","title":"1. \u811a\u672c\u7684\u6267\u884c\u65b9\u5f0f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/09 shell\u811a\u672c/#2-debug","text":"sh [ GNU long option ] [ option ] ... sh [ GNU long option ] [ option ] script - file ... option - n Read commands but do not execute them .\u53ef\u4ee5\u68c0\u67e5\u8bed\u6cd5\u9519\u8bef - v Print shell input lines as they are read . - x Print commands and their arguments as they are executed . [ sink@dev vitest ] $ cat add-until.sh #!/bin/sh read -p 'input a number: ' num num = ${ num :- 10 } echo -n \"1+2+...+ ${ num } = \" sum = 0 for (( i = 1 ; i< = ${ num } ; i++ )) do sum = $(( ${ sum } + i )) done #until [ ${num} -lt 1 ] #do # sum=$((${sum} + $num)) # num=$((${num} - 1)) #done echo ${ sum } # \u68c0\u67e5\u8bed\u6cd5 [ sink@dev vitest ] $ sh -n add-until.sh # \u5c06\u8bfb\u5230\u7684\u8bed\u53e5\u90fd\u6253\u5370\u51fa\u6765 [ sink@dev vitest ] $ sh -v add-until.sh #!/bin/sh read -p 'input a number: ' num input a number: 2 num = ${ num :- 10 } echo -n \"1+2+...+ ${ num } = \" 1 +2+...+2 = sum = 0 for (( i = 1 ; i< = ${ num } ; i++ )) do sum = $(( ${ sum } + i )) done #until [ ${num} -lt 1 ] #do # sum=$((${sum} + $num)) # num=$((${num} - 1)) #done echo ${ sum } 3 # \u6253\u5370\u6267\u884c\u7684\u8bed\u53e5\u53ca\u53c2\u6570 [ sink@dev vitest ] $ sh -x add-until.sh + read -p 'input a number: ' num input a number: 2 + num = 2 + echo -n '1+2+...+2 = ' 1 +2+...+2 = + sum = 0 + (( i = 1 )) + (( i< = 2 )) + sum = 1 + (( i++ )) + (( i< = 2 )) + sum = 3 + (( i++ )) + (( i< = 2 )) + echo 3 3","title":"2. \u811a\u672c\u7684debug"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/","text":"1. \u76f8\u5173\u6587\u4ef6 \u00b6 1.1 /etc/passwd \u6587\u4ef6\u7ed3\u6784 \u00b6 \u6bcf\u884c\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u8d26\u53f7\u3002 [ root@dev communication ] # head /etc/passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin sink:x:1000:1000:sink:/home/sink:/bin/bash user1:x:1001:1002::/home/user1:/bin/bash \u8fd97\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u8d26\u53f7\u540d\u79f0\uff0c\u5373\u7528\u6237\u540d\u3002 \u5bc6\u7801\u3002\u65e9\u671fUnix\u5b58\u653e\u5bc6\u7801\u7684\u5730\u65b9\uff08\u5df2\u8f6c\u79fb\u5230 /etc/shadow \u5b58\u653e\uff09\uff0c\u73b0\u5728\u7528x\u4ee3\u66ff\u3002 UID\uff0c\u7528\u6237\u7684ID\u30020\uff1a\u7cfb\u7edf\u7ba1\u7406\u5458\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\u8d26\u53f7\u90fd\u662f\u7cfb\u7edf\u7ba1\u7406\u5458\uff08\u4e0d\u5efa\u8bae\uff09\uff1b1~999\uff1a\u7cfb\u7edf\u8d26\u53f7\uff0c\u4fdd\u7559\u7ed9\u7cfb\u7edf\u4f7f\u7528\u7684ID\uff1b1000~60000\uff1a\u4e00\u822c\u4f7f\u7528\u8005\u7684\u53ef\u767b\u5f55\u8d26\u53f7\u3002 GID\uff0c\u7528\u6237\u7ec4ID\u3002\u4e0e /etc/group \u5bf9\u5e94\u3002 \u7528\u6237\u4fe1\u606f\u8bf4\u660e\u3002 \u5bb6\u76ee\u5f55\u3002 shell\u3002\u767b\u5f55\u65f6\u7684\u9884\u8bbeshell\u3002 /sbin/nologin \u8868\u793a\u65e0\u6cd5\u767b\u5f55\u7cfb\u7edf\uff1a # \u4e0d\u8bba\u662flogin shell \u8fd8\u662f non-login shell \u90fd\u4e0d\u80fd\u767b\u5f55 [ root@dev ~ ] # su - bin Last login: Thu Oct 17 08 :46:10 CST 2019 on pts/0 This account is currently not available. [ root@dev ~ ] # su bin This account is currently not available. \u53ef\u901a\u8fc7\u7f16\u8f91 /etc/nologin.txt \u6765\u4fee\u6539\u63d0\u793a\u4fe1\u606f\uff1a [ root@dev ~ ] # cat /etc/nologin.txt The account is not allowed to login. [ root@dev ~ ] # su bin The account is not allowed to login. 1.2 /etc/shadow \u6587\u4ef6\u7ed3\u6784 \u00b6 [ root@dev vitest ] # cat /etc/shadow root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:*:17110:0:99999:7::: daemon:*:17110:0:99999:7::: user3:!!:18181:0:99999:7::: \u8fd97\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u8d26\u53f7\u540d\u79f0\uff0c\u4e0e /etc/passwd \u5bf9\u5e94\u3002 \u52a0\u5bc6\u4e4b\u540e\u7684\u5bc6\u7801\u3002 !! \u8868\u793a\u6ca1\u6709\u5408\u6cd5\u5bc6\u7801\u3002 \u6700\u540e\u4e00\u6b21\u4fee\u6539\u5bc6\u7801\u7684\u65f6\u95f4\u3002\u4ece 1970.01.01 \u5f00\u59cb\u8ba1\u7b97\u7684 \u5929\u6570 \u3002 \u80fd\u591f\u51e0\u5929\u4e4b\u540e\u518d\u6b21\u4fee\u6539\u5bc6\u7801\u3002\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u4fee\u6539\u4e4b\u540e\u4e0d\u53ef\u518d\u4fee\u6539\u7684\u5929\u6570\u3002 \u51e0\u5929\u4e4b\u5185\u9700\u8981\u91cd\u65b0\u4fee\u6539\u5bc6\u7801\u3002\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u4fee\u6539\u4e4b\u540e\u9700\u8981\u518d\u6b21\u4fee\u6539\u7684\u5929\u6570\u3002 \u9700\u8981\u4fee\u6539\u5bc6\u7801\u524d\u7684\u8b66\u544a\u5929\u6570\u3002\u5bc6\u7801\u5feb\u5230\u671f\u65f6\uff0c\u7ed9\u8d26\u53f7\u53d1\u51fa\u5373\u5c06\u8fc7\u671f\u8b66\u544a\u3002 \u5bc6\u7801\u8fc7\u671f\u540e\u7684\u5bbd\u9650\u5929\u6570\u3002\u5bc6\u7801\u6709\u6548\u671f=\u6700\u540e\u4e00\u6b21\u4fee\u6539\u5bc6\u7801\u7684\u65f6\u95f4+\u9700\u8981\u91cd\u65b0\u4fee\u6539\u7684\u5929\u6570\uff1b\u8fc7\u4e86\u6709\u6548\u671f\u4e4b\u540e\u8fdb\u5165\u5bc6\u7801\u8fc7\u671f\u72b6\u6001\uff0c\u5f53\u8d26\u53f7\u767b\u5f55\u4e4b\u540e\u4f1a\u5f3a\u5236\u8981\u6c42\u66f4\u6539\u8d26\u53f7\u5bc6\u7801\u3002\u82e5\u5bc6\u7801\u8fc7\u671f\u4e4b\u540e\u7684\u5bbd\u9650\u65f6\u95f4\u5185\u6ca1\u6709\u767b\u5f55\u7cfb\u7edf\u4fee\u6539\u5bc6\u7801\uff0c\u90a3\u4e48\u8d26\u53f7\u5904\u4e8e\u5bc6\u7801\u5931\u6548\u72b6\u6001\uff0c\u518d\u4e5f\u65e0\u6cd5\u4f7f\u7528\u8be5\u5bc6\u7801\u767b\u5f55\u4e86\u3002 \u8d26\u53f7\u5931\u6548\u65e5\u671f\u3002\u8d26\u53f7\u5728\u6b64\u65e5\u671f\u4e4b\u540e\u65e0\u6cd5\u4f7f\u7528\uff08\u4f46\u662froot\u4ecd\u53ef\u5207\u6362\uff09\u3002\u4ece 1970.01.01 \u5f00\u59cb\u8ba1\u7b97\u7684 \u5929\u6570 \u3002 \u4fdd\u7559\u5b57\u6bb5\u3002 \u4f8b\u5b50\uff1a user2 : $ 6 $ mjcTl / W0$h01E8KRCadMIjOMbj . pVg . xQjGdDG4899FSQvItlTqRVo520TzI . BeTspDSXkNaS / YATo00IzrAD . fUoRQGPQ0 : 18181 : 1 : 7 : 2 : 5 : 20000 : \u8fd9\u884c\u914d\u7f6e\u4ee3\u8868\u4ec0\u4e48\u5462\uff1a \u5728 18181 \uff08 2019 - 10 - 12 \uff09\u8fd9\u5929\u4fee\u6539\u4e86\u5bc6\u7801\uff0c\u4e4b\u540e 1 \u5929\u4e0d\u80fd\u4fee\u6539\u518d\u6b21\u4fee\u6539\u5bc6\u7801\uff0c 2 \u5929\u4e4b\u540e\u5c31\u9700\u8981\u4fee\u6539\u5bc6\u7801\u4e86\uff0c\u5728\u4e4b\u540e 5 \uff08 7 - 2 \uff09\u5929\u4e4b\u524d\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c 7 \u5929\u4ecd\u7136\u6709 5 \u5929\u7684\u5bbd\u9650\u65f6\u95f4\uff0c\u5230 20000 \uff08 2024 - 10 - 04 \uff09\u8fd9\u5929\u8d26\u53f7\u5931\u6548\uff0c\u8be5\u8d26\u53f7\u65e0\u6cd5\u518d\u4f7f\u7528\u3002 # \u65e5\u671f\u7684\u8ba1\u7b97 # \u4ece1970\u5e741\u67081\u65e5\u8d77\u4e4b\u540e17843\u5929\u7684\u65e5\u671f [ root@dev vitest ] # date --date=\"19700101 + 17843 day\" +%Y-%m-%d 2018 -11-08 # \u5f53\u524d\u65e5\u671f\u540e\u768499999\u5929 [ root@dev vitest ] # date --date=\"99999 day\" +%Y-%m-%d 2293 -07-26 # \u4ece1970\u5e741\u67081\u65e5\u8d77\u4e4b\u540e17843\u5929\u7684\u65e5\u671f [ root@dev vitest ] # date --date=\"@$((17843*60*60*24))\" +%Y-%m-%d 2018 -11-08 1.2.1 \u5fd8\u8bb0root\u5bc6\u7801 \u00b6 \u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u65b9\u6cd5\u8fdb\u5165linux\u53bb\u4fee\u6539\uff1a \u8fdb\u5165\u5355\u4eba\u7ef4\u62a4\u6a21\u5f0f\uff0c\u4f7f\u7528 passwd \u4fee\u6539\u3002 \u7528\u955c\u50cf\u542f\u52a8\uff0c\u6302\u8f7d\u6839\u76ee\u5f55\u4e4b\u540e\u4fee\u6539 /etc/shadow \u6587\u4ef6\uff0c\u5c06root\u5bc6\u7801\u5b57\u6bb5\u6e05\u7a7a\uff0c\u518d\u6b21\u91cd\u542f\u5373\u53ef\u65e0\u9700\u5bc6\u7801\u767b\u5f55\u3002 1.2.2 \u52a0\u5bc6\u673a\u5236 \u00b6 linux\u7248\u672c\u5dee\u8ddd\u5f88\u5927\uff0c\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u8be2\u662f\u4f7f\u7528\u4e86\u54ea\u79cd\u52a0\u5bc6\u673a\u5236\uff1a [ root@dev vitest ] # authconfig --test | grep hashing password hashing algorithm is sha512 1.3 /etc/group \u6587\u4ef6\u7ed3\u6784 \u00b6 [ root@dev vitest ] # cat /etc/group root:x:0: bin:x:1: daemon:x:2: projects:x:1001:user1,user2 user1:x:1002: user2:x:1003: \u8fd94\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u7ec4\u540d\u3002 \u7ec4\u5bc6\u7801\u3002\u5df2\u8f6c\u79fb\u5230 /etc/gshadow \u5b58\u653e\u4e86\uff0c\u4ee5 x \u4ee3\u66ff\u3002 \u7ec4ID\uff0cGID\u3002 \u5728\u7fa4\u7ec4\u4e2d\u7684\u8d26\u53f7\u3002\u65b0\u7248\u7684linux\u5df2\u4e0d\u4f1a\u5c06\u8d26\u53f7\u52a0\u5165\u5230\u8be5\u5b57\u6bb5\u4e2d\u4e86\uff08\u4f8b\uff1auser1\u7ec4\u4e2d\u5e76\u6ca1\u6709user1\u8fd9\u4e2a\u7528\u6237\uff09\u3002 1.4 /etc/gshadow \u6587\u4ef6\u7ed3\u6784 \u00b6 [ root@dev vitest ] # cat /etc/gshadow root::: bin::: daemon::: user3:!:: \u8fd94\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u7ec4\u540d\u3002 \u5bc6\u7801\u3002 ! \u8868\u793a\u6ca1\u6709\u5408\u6cd5\u5bc6\u7801\u3002 \u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u8d26\u53f7\u3002\u5f88\u5c11\u4f7f\u7528\u3002 \u52a0\u5165\u8be5\u7fa4\u7ec4\u7684\u8d26\u53f7\u3002 2. \u8d26\u53f7\u7ba1\u7406 \u00b6 2.1 \u6dfb\u52a0 \u00b6 useradd [ options ] LOGIN useradd - D useradd - D [ options ] create a new user or update default new user information OPTIONS - u , --uid UID \u6307\u5b9aUID - c , --comment COMMENT \u5bf9\u5e94 /etc/passwd \u4e2d\u7684\u8bf4\u660e\u5b57\u6bb5 - d , --home-dir HOME_DIR \u5bb6\u76ee\u5f55\u7684\u7edd\u5bf9\u8def\u5f84 - g , --gid GROUP \u521d\u59cb\u7fa4\u7ec4 - G , --groups GROUP1[,GROUP2,...]] \u9644\u52a0\u7fa4\u7ec4 - m , --create-home \u521b\u5efa\u5bb6\u76ee\u5f55\u3002\u4e00\u822c\u8d26\u53f7\u9ed8\u8ba4\u503c - M , --no-create-home \u4e0d\u521b\u5efa\u5bb6\u76ee\u5f55\u3002\u7cfb\u7edf\u8d26\u53f7\u9ed8\u8ba4\u503c - N , --no-user-group \u4e0d\u521b\u5efa\u548c\u8d26\u53f7\u540d\u4e00\u81f4\u7684\u7fa4\u7ec4\uff0c\u800c\u662f\u6dfb\u52a0\u5230 -g \u6307\u5b9a\u7684\u7fa4\u7ec4\u4e2d - r , --system \u521b\u5efa\u4e00\u4e2a\u7cfb\u7edf\u8d26\u53f7\uff0c\u901a\u5e38\u4f1a\u6709\u4e00\u4e9b\u9650\u5236 - e , --expiredate EXPIRE_DATE \u6307\u5b9a\u8d26\u53f7\u5931\u6548\u65e5\u671f\uff0c\u683c\u5f0f\u4e3a YYYY-MM-DD - f , --inactive INACTIVE \u6307\u5b9a\u5bc6\u7801\u51e0\u5929\u4e4b\u540e\u4f1a\u8fc7\u671f\u3002\u9ed8\u8ba4\u503c\u4e3a -1 \uff0c\u8868\u793a\u4e0d\u542f\u7528\u8be5\u529f\u80fd [ root@dev vitest ] # useradd -c \"useradd test\" -e 2019-10-13 user3 [ root@dev vitest ] # ll -d /home/user3/ drwx------ 3 user3 user3 78 Oct 12 14 :52 /home/user3/ [ root@dev vitest ] # grep user3 /etc/passwd /etc/shadow /etc/group /etc/passwd:user3:x:1003:1004:useradd test:/home/user3:/bin/bash /etc/shadow:user3:!!:18181:0:99999:7::18182: /etc/group:user3:x:1004: /etc/default/useradd \u914d\u7f6e\u6709\u9ed8\u8ba4\u7684\u521b\u5efa\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7 useradd -D \u6253\u5370\u3002 [ root@dev vitest ] # useradd -D GROUP = 100 HOME = /home INACTIVE = -1 EXPIRE = SHELL = /bin/bash SKEL = /etc/skel # \u5bb6\u76ee\u5f55\u53c2\u8003\u7684\u57fa\u51c6\u76ee\u5f55\uff0c\u521d\u59cb\u5bb6\u76ee\u5f55\u4e0b\u7684\u4e1c\u897f\u90fd\u662f\u4ece\u8fd9\u91cc\u590d\u5236\u7684 CREATE_MAIL_SPOOL = yes \u5176\u5b83\u7684\u914d\u7f6e\u5728 /etc/login.defs \u6587\u4ef6\u4e2d\u3002 2.2 \u5bc6\u7801\u7684\u4fee\u6539 \u00b6 \u8d26\u53f7\u65b0\u589e\u5b8c\u6bd5\u4e4b\u540e\u662f\u9501\u5b9a\u72b6\u6001\uff0c\u8fd8\u4e0d\u80fd\u767b\u5f55\uff0c\u9700\u8981\u4fee\u6539\u5bc6\u7801\u624d\u53ef\u3002 passwd [ -k ] [ -l ] [ -u [-f ] ] [ -d ] [ -e ] [ -n mindays ] [ -x maxdays ] [ -w warndays ] [ -i inactivedays ] [ -S ] [ --stdin ] [ username ] - l , --lock \u4f1a\u5c06 /etc/shadow \u7b2c2\u680f\u6700\u524d\u9762\u52a0\u4e0a ! \uff0c \u4f7f\u5bc6\u7801\u5931\u6548\uff0c\u4f7f\u8d26\u53f7\u53ea\u80fd\u88abroot\u4f7f\u7528 - u , --unlock - d , --delete - e , --expire \u4f7f\u5bc6\u7801\u8fc7\u671f(root only) - f , --force - x , --maximum=DAYS \u591a\u957f\u65f6\u95f4\u4e4b\u5185\u9700\u8981\u4fee\u6539\u5bc6\u7801 (root only) - n , --minimum=DAYS \u591a\u957f\u65f6\u95f4\u4e4b\u5185\u4e0d\u80fd\u4fee\u6539\u5bc6\u7801 (root only) - w , --warning=DAYS \u51e0\u5929\u4e4b\u524d\u6536\u5230\u5bc6\u7801\u8fc7\u671f\u7684\u8b66\u544a (root only) - i , --inactive=DAYS \u5bc6\u7801\u8fc7\u671f\u51e0\u5929\u540e\u8d26\u53f7\u53d8\u4e3a\u4e0d\u53ef\u7528\u72b6\u6001(root only) - S , --status root only [ root@dev vitest ] # passwd -S user2 user2 PS 2019 -10-12 0 1 1 5 ( Password set, SHA512 crypt. ) [ root@dev vitest ] # passwd -l user2 Locking password for user user2. passwd: Success [ root@dev vitest ] # passwd -S user2 user2 LK 2019 -10-12 0 1 1 5 ( Password locked. ) [ root@dev vitest ] # grep /etc/shadow [ root@dev vitest ] # grep user2 /etc/shadow user2:!! $6$mjcTl /W0 $h01E8KRCadMIjOMbj .pVg.xQjGdDG4899FSQvItlTqRVo520TzI.BeTspDSXkNaS/YATo00IzrAD.fUoRQGPQ0:18181:0:1:1:5:10000: \u8fd8\u6709\u4e00\u4e2a\u6307\u4ee4\u4e5f\u53ef\u4ee5\u4fee\u6539\u5bc6\u7801\u4fe1\u606f\uff1a chage [ options ] LOGIN OPTIONS - l , --list - d , --lastday LAST_DAY \u66f4\u6539\u5bc6\u7801\u7684\u4fee\u6539\u65e5\u671f\uff0c\u683c\u5f0f\uff1aYYYY-MM-DD\u3002\u5982\u679c LAST_DAY \u8bbe\u7f6e\u4e3a 0\uff0c\u5219\u7528\u6237\u5728\u4e0b\u4e00\u6b21\u767b\u5f55\u65f6\u4f1a\u88ab\u5f3a\u5236\u66f4\u6539\u5bc6\u7801\u3002 - m , --mindays MIN_DAYS \u8bbe\u7f6e\u5bc6\u7801\u53ef\u4fee\u6539\u4e4b\u524d\u7684\u6700\u77ed\u5929\u6570 - M , --maxdays MAX_DAYS \u8bbe\u7f6e\u5bc6\u7801\u4fee\u6539\u7684\u6700\u957f\u5929\u6570 - W , --warndays WARN_DAYS \u8bbe\u7f6e\u8fc7\u671f\u524d\u63d0\u9192\u5929\u6570 - I , --inactive INACTIVE \u8bbe\u7f6e\u5bc6\u7801\u5931\u6548\u5929\u6570 - E , --expiredate EXPIRE_DATE \u8bbe\u7f6e\u8d26\u53f7\u5931\u6548\u65e5\u671f\uff0c\u683c\u5f0f\uff1aYYYY-MM-DD # \u666e\u901a\u7528\u6237\u4e4b\u80fd\u67e5\u770b\u81ea\u5df1\u7684\u4fe1\u606f [ sink@dev vitest ] $ chage -l sink Last password change : never Password expires : never Password inactive : never Account expires : never Minimum number of days between password change : 0 Maximum number of days between password change : 99999 Number of days of warning before password expires : 7 # \u591a\u4e48\u7684\u76f4\u89c2\u65b9\u4fbf\u554a [ root@dev vitest ] # chage -m 2 -M 30 -W 7 -I 7 -E 2020-01-01 user1 [ root@dev vitest ] # chage -l user1 Last password change : Oct 12 , 2019 Password expires : Nov 11 , 2019 Password inactive : Nov 18 , 2019 Account expires : Jan 01 , 2020 Minimum number of days between password change : 2 Maximum number of days between password change : 30 Number of days of warning before password expires : 7 # \u5f3a\u5236\u7528\u6237\u4e0b\u6b21\u767b\u5f55\u65f6\u66f4\u6539\u5bc6\u7801 [ root@dev vitest ] # chage -d 0 user1 [ root@dev vitest ] # chage -l user1 Last password change : password must be changed Password expires : password must be changed Password inactive : password must be changed Account expires : Jan 01 , 2020 Minimum number of days between password change : 2 Maximum number of days between password change : 30 Number of days of warning before password expires : 7 2.3 \u8d26\u53f7\u7684\u4fee\u6539 \u00b6 usermod [ options ] LOGIN options - L , -- lock lock the user account - U , -- unlock unlock the user account - c , -- comment COMMENT - d , -- home HOME_DIR - u , -- uid UID new UID for the user account - l , -- login NEW_LOGIN new value of the login name - g , -- gid GROUP - G , -- groups GROUPS - a , -- append append the user to the supplemental GROUPS - e , -- expiredate EXPIRE_DATE \u8d26\u53f7\u5931\u6548 - f , -- inactive INACTIVE \u5bc6\u7801\u8fc7\u671f - p , -- password PASSWORD use encrypted password for the new password 2.4 \u5220\u9664 \u00b6 userdel [ options ] LOGIN - f , --force - r , --remove \u628a\u5bb6\u76ee\u5f55\u548c\u90ae\u7bb1\u4e00\u8d77\u5220\u6389 \u82e5\u771f\u6b63\u5730\u60f3\u8981\u5220\u9664\u7528\u6237\u5219\u53ef\u4ee5\u4f7f\u7528\u6539\u6307\u4ee4\uff0c\u5426\u5219\u53ef\u4ee5\u8bbe\u7f6e\u8d26\u53f7\u5931\u6548\u800c\u4fdd\u7559\u6240\u6709\u7684\u76f8\u5173\u6570\u636e\u3002 2.5 \u7528\u6237\u4fe1\u606f\u67e5\u770b \u00b6 finger [ - lmsp ] [ user ...] [ user @ host ...] \u7528\u6237\u4fe1\u606f\u67e5\u8be2\u5de5\u5177 Options - s Finger displays the user ' s login name, real name, terminal name and write status (as a ``* '' after the terminal name if write permission is denied), idle time, login time, office loca\u2010tion and office phone number. - l Produces a multi - line format displaying all of the information described for the - s option as well as the user ' s home directory, home phone number, login shell, mail status, and the contents of the files \u201c.plan\u201d, \u201c.project\u201d, \u201c.pgpkey\u201d and \u201c.forward\u201d from the user ' s home directory . [ root@dev libguestfs ] # finger root Login: root Name: root Directory: /root Shell: /bin/bash On since Tue Oct 8 09 :06 ( CST ) on :0 from :0 ( messages off ) On since Wed Oct 9 17 :09 ( CST ) on pts/0 from 172 .16.2.27 4 seconds idle On since Tue Oct 8 09 :08 ( CST ) on pts/1 from :0 4 days 22 hours idle On since Thu Oct 10 09 :48 ( CST ) on pts/5 from :0 2 days 5 hours idle On since Mon Oct 14 11 :19 ( CST ) on pts/8 from :0 1 hour 47 minutes idle Last login Sat Oct 12 16 :28 ( CST ) on pts/2 New mail received Mon Oct 14 03 :20 2019 ( CST ) Unread since Thu Sep 12 13 :46 2019 ( CST ) No Plan. 2.5.1 \u4fe1\u606f\u4fee\u6539 \u00b6 chfn [ -f full-name ] [ -o office ] , RB [ -p office-phone ] [ -h home-phone ] ] [ username ] change your finger information \u5176\u5b9e\u5c31\u662f\u4fee\u6539\u4e86 /etc/passwd \u7684\u4fe1\u606f\u8bf4\u660e\u5b57\u6bb5\uff1a [ sink@dev vitest ] $ grep sink /etc/passwd sink:x:1000:1000:sink,xxx JiangXi,,xxx:/home/sink:/bin/bash 2.6 \u6539\u53d8\u767b\u5f55 shell \u00b6 chsh [ options ] [ username ] change your login shell Options : - s , -- shell < shell > specify login shell - l , -- list - shells print list of shells and exit [ sink@dev vitest ] $ chsh -s /bin/tcsh Changing shell for sink. Password: Shell changed. [ sink@dev 15 :31:28 vitest ] $ grep sink /etc/passwd sink:x:1000:1000:sink,xxx JiangXi,,xxx:/home/sink:/bin/tcsh 3. \u7fa4\u7ec4 \u00b6 \u521d\u59cb\u7fa4\u7ec4\uff1ainitial group\u3002\u521b\u5efa\u8d26\u53f7\u65f6\u52a0\u5165\u7684\u7fa4\u7ec4\uff1b \u6709\u6548\u7fa4\u7ec4\uff1aeffietive group\u3002\u521b\u5efa\u6587\u4ef6\u4e4b\u7c7b\u7684\u4e1c\u897f\u65f6\u8be5\u6587\u4ef6\u6240\u5c5e\u7684\u7fa4\u7ec4\u3002 \u67e5\u770b\u6709\u6548\u7fa4\u7ec4\uff1a # \u4e24\u4e2a\u547d\u4ee4\u5217\u51fa\u7684\u7b2c\u4e00\u4e2a\u7fa4\u7ec4\u5373\u4e3a \u6709\u6548\u7fa4\u7ec4 [ sink@dev vitest ] $ id uid = 1000 ( sink ) gid = 1000 ( sink ) groups = 1000 ( sink ) ,10 ( wheel ) ,980 ( docker ) [ sink@dev vitest ] $ groups sink wheel docker \u5207\u6362\u6709\u6548\u7fa4\u7ec4\uff08\u53ea\u80fd\u5728\u6240\u5728\u7684\u7fa4\u7ec4\u4e2d\u5207\u6362\uff09\uff1a [ sink@dev vitest ] $ newgrp docker [ sink@dev vitest ] $ id uid = 1000 ( sink ) gid = 980 ( docker ) groups = 980 ( docker ) ,10 ( wheel ) ,1000 ( sink ) [ sink@dev vitest ] $ groups docker wheel sink [ sink@dev vitest ] $ touch group-test [ sink@dev vitest ] $ ll group-test -rw-r--r-- 1 sink docker 0 Oct 12 14 :23 group-test [ sink@dev vitest ] $ exit exit \u7531\u4e8e newgrp \u662f\u901a\u8fc7\u65b0\u7684shell\u6765\u63d0\u4f9b\u8be5\u529f\u80fd\u7684\uff0c\u6240\u4ee5\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981 exit \u3002 3.1 \u76f8\u5173\u6587\u4ef6 \u00b6 FILES / etc / group Group account information . / etc / gshadow Secure group account information . / etc / login . defs Shadow password suite configuration . / etc / passwd User account information . 3.2 \u6dfb\u52a0 \u00b6 \u4e0e useradd \u7c7b\u4f3c\uff0c\u81ea\u7136\u6709 groupadd \u3002 groupadd [ options ] group OPTIONS - f , --force - g , --gid GID - r , --system Create a system group. 3.3 \u4fee\u6539 \u00b6 groupmod [ options ] GROUP OPTIONS - g , --gid GID - n , --new-name NEW_GROUP 3.4 \u5220\u9664 \u00b6 groupdel GROUP \u82e5\u6709\u8d26\u53f7\u5c06\u6b64\u7fa4\u7ec4\u4f5c\u4e3a\u6709\u6548\u7fa4\u7ec4\uff0c\u90a3\u4e48\u4e0d\u80fd\u5220\u9664\u8be5\u7fa4\u7ec4\u3002 [ root@dev libguestfs ] # groupdel user2 groupdel: cannot remove the primary group of user 'user2' 3.5 \u7fa4\u7ec4\u7ba1\u7406\u5458\uff08\u4e0d\u5e38\u7528\uff09 \u00b6 \u7ba1\u7406\u67d0\u4e2a\u7fa4\u7ec4\uff0c\u8d1f\u8d23\u7528\u6237\u7684\u6dfb\u52a0\u3001\u5220\u9664\u3002 gpasswd [ option ] group administer / etc / group and / etc / gshadow OPTIONS # \u6ca1\u6709\u6307\u5b9a\u9009\u9879\u65f6\u4f1a\u4e3a\u8be5\u7fa4\u7ec4\u8bbe\u7f6e\u5bc6\u7801 # \u7cfb\u7edf\u7ba1\u7406\u5458\u7684\u64cd\u4f5c - A , --administrators user,... Set the list of administrative users. - M , --members user,... Set the list of group members. - r , --remove-password - R , --restrict \u7981\u7528 /etc/gshadow \u7684\u5bc6\u7801\u680f # \u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u64cd\u4f5c - a , --add user - d , --delete user 4. \u767b\u5f55\u8d26\u53f7\u4fe1\u606f\u67e5\u8be2 \u00b6 w [ options ] user [...] \u5c55\u793a\u8c01\u5728\u767b\u5f55\u548c\u6b63\u5728\u505a\u4ec0\u4e48 OPTIONS - i , -- ip - addr Display IP address instead of hostname for from field . [ sink@dev study ] $ w 22 :52:58 up 2 :16, 5 users, load average: 0 .14, 0 .05, 0 .06 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT root :0 :0 20 :38 ?xdm? 5 :52 0 .38s gdm-session-worker [ pam/gdm-password ] root pts/0 :0 20 :39 2 :08m 7 :11 0 .66s /home/pycharm-2016.2/bin/fsnotifier64 root pts/1 :0 20 :45 2 :05m 4 :13 0 .64s /home/clion-2018.3/bin/fsnotifier64 root pts/2 192 .168.216.1 21 :39 1 :06 0 .52s 0 .52s -bash sink pts/3 192 .168.216.1 22 :50 2 .00s 0 .05s 0 .00s w who [ OPTION ] \u5c55\u793a\u8c01\u5728\u767b\u5f55 [ sink@dev study ] $ who root :0 2019 -10-20 20 :38 ( :0 ) root pts/0 2019 -10-20 20 :39 ( :0 ) root pts/1 2019 -10-20 20 :45 ( :0 ) root pts/2 2019 -10-20 21 :39 ( 192 .168.216.1 ) sink pts/3 2019 -10-20 22 :50 ( 192 .168.216.1 ) lastlog [ options ] \u62a5\u544a\u8d26\u53f7\u6700\u8fd1\u4e00\u6b21\u7684\u767b\u5f55\u4fe1\u606f Options : - u , --user LOGIN|RANGE RANGE\uff1aUID_MIN-UID_MAX [ sink@dev study ] $ lastlog Username Port From Latest root pts/2 192 .168.216.1 Sun Oct 20 21 :39:09 -0400 2019 bin **Never logged in** daemon **Never logged in** \u2026\u2026 last \u663e\u793a\u6700\u8fd1\u7684\u7528\u6237\u767b\u5f55\u4fe1\u606f - F Print full login and logout times and dates . [ sink@dev study ] $ last sink pts/3 192 .168.216.1 Sun Oct 20 22 :50 still logged in user1 pts/3 192 .168.216.1 Sun Oct 20 22 :08 - 22 :09 ( 00 :00 ) root pts/2 192 .168.216.1 Sun Oct 20 21 :39 still logged in root pts/1 :0 Sun Oct 20 20 :45 still logged in root pts/0 :0 Sun Oct 20 20 :39 still logged in root :0 :0 Sun Oct 20 20 :38 still logged in ( unknown :0 :0 Sun Oct 20 20 :37 - 20 :38 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Sun Oct 20 20 :36 - 23 :06 ( 02 :29 ) ( unknown :0 :0 Sun Oct 20 20 :35 - 20 :35 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Sun Oct 20 20 :34 - 23 :06 ( 02 :31 ) root pts/0 :0 Fri Oct 18 04 :19 - 20 :31 ( 2 +16:11 ) root pts/0 :0 Fri Oct 18 03 :27 - 03 :28 ( 00 :01 ) root pts/2 :0 Fri Oct 18 03 :18 - 04 :19 ( 01 :00 ) root pts/1 :0 Fri Oct 18 02 :29 - 20 :31 ( 2 +18:01 ) root pts/0 :0 Fri Oct 18 09 :57 - 03 :24 ( -6:-33 ) root :0 :0 Fri Oct 18 09 :56 - 20 :31 ( 2 +10:34 ) ( unknown :0 :0 Fri Oct 18 09 :56 - 09 :56 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Fri Oct 18 09 :54 - 20 :31 ( 2 +10:36 ) wtmp begins Fri Oct 18 09 :54:36 2019","title":"10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#1","text":"","title":"1. \u76f8\u5173\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#11-etcpasswd","text":"\u6bcf\u884c\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u8d26\u53f7\u3002 [ root@dev communication ] # head /etc/passwd root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin sink:x:1000:1000:sink:/home/sink:/bin/bash user1:x:1001:1002::/home/user1:/bin/bash \u8fd97\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u8d26\u53f7\u540d\u79f0\uff0c\u5373\u7528\u6237\u540d\u3002 \u5bc6\u7801\u3002\u65e9\u671fUnix\u5b58\u653e\u5bc6\u7801\u7684\u5730\u65b9\uff08\u5df2\u8f6c\u79fb\u5230 /etc/shadow \u5b58\u653e\uff09\uff0c\u73b0\u5728\u7528x\u4ee3\u66ff\u3002 UID\uff0c\u7528\u6237\u7684ID\u30020\uff1a\u7cfb\u7edf\u7ba1\u7406\u5458\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\u8d26\u53f7\u90fd\u662f\u7cfb\u7edf\u7ba1\u7406\u5458\uff08\u4e0d\u5efa\u8bae\uff09\uff1b1~999\uff1a\u7cfb\u7edf\u8d26\u53f7\uff0c\u4fdd\u7559\u7ed9\u7cfb\u7edf\u4f7f\u7528\u7684ID\uff1b1000~60000\uff1a\u4e00\u822c\u4f7f\u7528\u8005\u7684\u53ef\u767b\u5f55\u8d26\u53f7\u3002 GID\uff0c\u7528\u6237\u7ec4ID\u3002\u4e0e /etc/group \u5bf9\u5e94\u3002 \u7528\u6237\u4fe1\u606f\u8bf4\u660e\u3002 \u5bb6\u76ee\u5f55\u3002 shell\u3002\u767b\u5f55\u65f6\u7684\u9884\u8bbeshell\u3002 /sbin/nologin \u8868\u793a\u65e0\u6cd5\u767b\u5f55\u7cfb\u7edf\uff1a # \u4e0d\u8bba\u662flogin shell \u8fd8\u662f non-login shell \u90fd\u4e0d\u80fd\u767b\u5f55 [ root@dev ~ ] # su - bin Last login: Thu Oct 17 08 :46:10 CST 2019 on pts/0 This account is currently not available. [ root@dev ~ ] # su bin This account is currently not available. \u53ef\u901a\u8fc7\u7f16\u8f91 /etc/nologin.txt \u6765\u4fee\u6539\u63d0\u793a\u4fe1\u606f\uff1a [ root@dev ~ ] # cat /etc/nologin.txt The account is not allowed to login. [ root@dev ~ ] # su bin The account is not allowed to login.","title":"1.1 /etc/passwd \u6587\u4ef6\u7ed3\u6784"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#12-etcshadow","text":"[ root@dev vitest ] # cat /etc/shadow root: $6$dEmXqJj8IH07TF97$sD08U6KQTP .Y.2Wr.Fe27m.b7Hq4M0LjIgeNoLI5GYU1e/qvaT/bxWxgF5F8tz5O.Zd4KayZfvnBae/hV2QbA1::0:99999:7::: bin:*:17110:0:99999:7::: daemon:*:17110:0:99999:7::: user3:!!:18181:0:99999:7::: \u8fd97\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u8d26\u53f7\u540d\u79f0\uff0c\u4e0e /etc/passwd \u5bf9\u5e94\u3002 \u52a0\u5bc6\u4e4b\u540e\u7684\u5bc6\u7801\u3002 !! \u8868\u793a\u6ca1\u6709\u5408\u6cd5\u5bc6\u7801\u3002 \u6700\u540e\u4e00\u6b21\u4fee\u6539\u5bc6\u7801\u7684\u65f6\u95f4\u3002\u4ece 1970.01.01 \u5f00\u59cb\u8ba1\u7b97\u7684 \u5929\u6570 \u3002 \u80fd\u591f\u51e0\u5929\u4e4b\u540e\u518d\u6b21\u4fee\u6539\u5bc6\u7801\u3002\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u4fee\u6539\u4e4b\u540e\u4e0d\u53ef\u518d\u4fee\u6539\u7684\u5929\u6570\u3002 \u51e0\u5929\u4e4b\u5185\u9700\u8981\u91cd\u65b0\u4fee\u6539\u5bc6\u7801\u3002\u8ddd\u79bb\u6700\u540e\u4e00\u6b21\u4fee\u6539\u4e4b\u540e\u9700\u8981\u518d\u6b21\u4fee\u6539\u7684\u5929\u6570\u3002 \u9700\u8981\u4fee\u6539\u5bc6\u7801\u524d\u7684\u8b66\u544a\u5929\u6570\u3002\u5bc6\u7801\u5feb\u5230\u671f\u65f6\uff0c\u7ed9\u8d26\u53f7\u53d1\u51fa\u5373\u5c06\u8fc7\u671f\u8b66\u544a\u3002 \u5bc6\u7801\u8fc7\u671f\u540e\u7684\u5bbd\u9650\u5929\u6570\u3002\u5bc6\u7801\u6709\u6548\u671f=\u6700\u540e\u4e00\u6b21\u4fee\u6539\u5bc6\u7801\u7684\u65f6\u95f4+\u9700\u8981\u91cd\u65b0\u4fee\u6539\u7684\u5929\u6570\uff1b\u8fc7\u4e86\u6709\u6548\u671f\u4e4b\u540e\u8fdb\u5165\u5bc6\u7801\u8fc7\u671f\u72b6\u6001\uff0c\u5f53\u8d26\u53f7\u767b\u5f55\u4e4b\u540e\u4f1a\u5f3a\u5236\u8981\u6c42\u66f4\u6539\u8d26\u53f7\u5bc6\u7801\u3002\u82e5\u5bc6\u7801\u8fc7\u671f\u4e4b\u540e\u7684\u5bbd\u9650\u65f6\u95f4\u5185\u6ca1\u6709\u767b\u5f55\u7cfb\u7edf\u4fee\u6539\u5bc6\u7801\uff0c\u90a3\u4e48\u8d26\u53f7\u5904\u4e8e\u5bc6\u7801\u5931\u6548\u72b6\u6001\uff0c\u518d\u4e5f\u65e0\u6cd5\u4f7f\u7528\u8be5\u5bc6\u7801\u767b\u5f55\u4e86\u3002 \u8d26\u53f7\u5931\u6548\u65e5\u671f\u3002\u8d26\u53f7\u5728\u6b64\u65e5\u671f\u4e4b\u540e\u65e0\u6cd5\u4f7f\u7528\uff08\u4f46\u662froot\u4ecd\u53ef\u5207\u6362\uff09\u3002\u4ece 1970.01.01 \u5f00\u59cb\u8ba1\u7b97\u7684 \u5929\u6570 \u3002 \u4fdd\u7559\u5b57\u6bb5\u3002 \u4f8b\u5b50\uff1a user2 : $ 6 $ mjcTl / W0$h01E8KRCadMIjOMbj . pVg . xQjGdDG4899FSQvItlTqRVo520TzI . BeTspDSXkNaS / YATo00IzrAD . fUoRQGPQ0 : 18181 : 1 : 7 : 2 : 5 : 20000 : \u8fd9\u884c\u914d\u7f6e\u4ee3\u8868\u4ec0\u4e48\u5462\uff1a \u5728 18181 \uff08 2019 - 10 - 12 \uff09\u8fd9\u5929\u4fee\u6539\u4e86\u5bc6\u7801\uff0c\u4e4b\u540e 1 \u5929\u4e0d\u80fd\u4fee\u6539\u518d\u6b21\u4fee\u6539\u5bc6\u7801\uff0c 2 \u5929\u4e4b\u540e\u5c31\u9700\u8981\u4fee\u6539\u5bc6\u7801\u4e86\uff0c\u5728\u4e4b\u540e 5 \uff08 7 - 2 \uff09\u5929\u4e4b\u524d\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c 7 \u5929\u4ecd\u7136\u6709 5 \u5929\u7684\u5bbd\u9650\u65f6\u95f4\uff0c\u5230 20000 \uff08 2024 - 10 - 04 \uff09\u8fd9\u5929\u8d26\u53f7\u5931\u6548\uff0c\u8be5\u8d26\u53f7\u65e0\u6cd5\u518d\u4f7f\u7528\u3002 # \u65e5\u671f\u7684\u8ba1\u7b97 # \u4ece1970\u5e741\u67081\u65e5\u8d77\u4e4b\u540e17843\u5929\u7684\u65e5\u671f [ root@dev vitest ] # date --date=\"19700101 + 17843 day\" +%Y-%m-%d 2018 -11-08 # \u5f53\u524d\u65e5\u671f\u540e\u768499999\u5929 [ root@dev vitest ] # date --date=\"99999 day\" +%Y-%m-%d 2293 -07-26 # \u4ece1970\u5e741\u67081\u65e5\u8d77\u4e4b\u540e17843\u5929\u7684\u65e5\u671f [ root@dev vitest ] # date --date=\"@$((17843*60*60*24))\" +%Y-%m-%d 2018 -11-08","title":"1.2 /etc/shadow \u6587\u4ef6\u7ed3\u6784"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#121-root","text":"\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u5404\u79cd\u65b9\u6cd5\u8fdb\u5165linux\u53bb\u4fee\u6539\uff1a \u8fdb\u5165\u5355\u4eba\u7ef4\u62a4\u6a21\u5f0f\uff0c\u4f7f\u7528 passwd \u4fee\u6539\u3002 \u7528\u955c\u50cf\u542f\u52a8\uff0c\u6302\u8f7d\u6839\u76ee\u5f55\u4e4b\u540e\u4fee\u6539 /etc/shadow \u6587\u4ef6\uff0c\u5c06root\u5bc6\u7801\u5b57\u6bb5\u6e05\u7a7a\uff0c\u518d\u6b21\u91cd\u542f\u5373\u53ef\u65e0\u9700\u5bc6\u7801\u767b\u5f55\u3002","title":"1.2.1 \u5fd8\u8bb0root\u5bc6\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#122","text":"linux\u7248\u672c\u5dee\u8ddd\u5f88\u5927\uff0c\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u8be2\u662f\u4f7f\u7528\u4e86\u54ea\u79cd\u52a0\u5bc6\u673a\u5236\uff1a [ root@dev vitest ] # authconfig --test | grep hashing password hashing algorithm is sha512","title":"1.2.2 \u52a0\u5bc6\u673a\u5236"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#13-etcgroup","text":"[ root@dev vitest ] # cat /etc/group root:x:0: bin:x:1: daemon:x:2: projects:x:1001:user1,user2 user1:x:1002: user2:x:1003: \u8fd94\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u7ec4\u540d\u3002 \u7ec4\u5bc6\u7801\u3002\u5df2\u8f6c\u79fb\u5230 /etc/gshadow \u5b58\u653e\u4e86\uff0c\u4ee5 x \u4ee3\u66ff\u3002 \u7ec4ID\uff0cGID\u3002 \u5728\u7fa4\u7ec4\u4e2d\u7684\u8d26\u53f7\u3002\u65b0\u7248\u7684linux\u5df2\u4e0d\u4f1a\u5c06\u8d26\u53f7\u52a0\u5165\u5230\u8be5\u5b57\u6bb5\u4e2d\u4e86\uff08\u4f8b\uff1auser1\u7ec4\u4e2d\u5e76\u6ca1\u6709user1\u8fd9\u4e2a\u7528\u6237\uff09\u3002","title":"1.3 /etc/group \u6587\u4ef6\u7ed3\u6784"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#14-etcgshadow","text":"[ root@dev vitest ] # cat /etc/gshadow root::: bin::: daemon::: user3:!:: \u8fd94\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49\uff1a \u7ec4\u540d\u3002 \u5bc6\u7801\u3002 ! \u8868\u793a\u6ca1\u6709\u5408\u6cd5\u5bc6\u7801\u3002 \u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u8d26\u53f7\u3002\u5f88\u5c11\u4f7f\u7528\u3002 \u52a0\u5165\u8be5\u7fa4\u7ec4\u7684\u8d26\u53f7\u3002","title":"1.4 /etc/gshadow \u6587\u4ef6\u7ed3\u6784"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#2","text":"","title":"2. \u8d26\u53f7\u7ba1\u7406"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#21","text":"useradd [ options ] LOGIN useradd - D useradd - D [ options ] create a new user or update default new user information OPTIONS - u , --uid UID \u6307\u5b9aUID - c , --comment COMMENT \u5bf9\u5e94 /etc/passwd \u4e2d\u7684\u8bf4\u660e\u5b57\u6bb5 - d , --home-dir HOME_DIR \u5bb6\u76ee\u5f55\u7684\u7edd\u5bf9\u8def\u5f84 - g , --gid GROUP \u521d\u59cb\u7fa4\u7ec4 - G , --groups GROUP1[,GROUP2,...]] \u9644\u52a0\u7fa4\u7ec4 - m , --create-home \u521b\u5efa\u5bb6\u76ee\u5f55\u3002\u4e00\u822c\u8d26\u53f7\u9ed8\u8ba4\u503c - M , --no-create-home \u4e0d\u521b\u5efa\u5bb6\u76ee\u5f55\u3002\u7cfb\u7edf\u8d26\u53f7\u9ed8\u8ba4\u503c - N , --no-user-group \u4e0d\u521b\u5efa\u548c\u8d26\u53f7\u540d\u4e00\u81f4\u7684\u7fa4\u7ec4\uff0c\u800c\u662f\u6dfb\u52a0\u5230 -g \u6307\u5b9a\u7684\u7fa4\u7ec4\u4e2d - r , --system \u521b\u5efa\u4e00\u4e2a\u7cfb\u7edf\u8d26\u53f7\uff0c\u901a\u5e38\u4f1a\u6709\u4e00\u4e9b\u9650\u5236 - e , --expiredate EXPIRE_DATE \u6307\u5b9a\u8d26\u53f7\u5931\u6548\u65e5\u671f\uff0c\u683c\u5f0f\u4e3a YYYY-MM-DD - f , --inactive INACTIVE \u6307\u5b9a\u5bc6\u7801\u51e0\u5929\u4e4b\u540e\u4f1a\u8fc7\u671f\u3002\u9ed8\u8ba4\u503c\u4e3a -1 \uff0c\u8868\u793a\u4e0d\u542f\u7528\u8be5\u529f\u80fd [ root@dev vitest ] # useradd -c \"useradd test\" -e 2019-10-13 user3 [ root@dev vitest ] # ll -d /home/user3/ drwx------ 3 user3 user3 78 Oct 12 14 :52 /home/user3/ [ root@dev vitest ] # grep user3 /etc/passwd /etc/shadow /etc/group /etc/passwd:user3:x:1003:1004:useradd test:/home/user3:/bin/bash /etc/shadow:user3:!!:18181:0:99999:7::18182: /etc/group:user3:x:1004: /etc/default/useradd \u914d\u7f6e\u6709\u9ed8\u8ba4\u7684\u521b\u5efa\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7 useradd -D \u6253\u5370\u3002 [ root@dev vitest ] # useradd -D GROUP = 100 HOME = /home INACTIVE = -1 EXPIRE = SHELL = /bin/bash SKEL = /etc/skel # \u5bb6\u76ee\u5f55\u53c2\u8003\u7684\u57fa\u51c6\u76ee\u5f55\uff0c\u521d\u59cb\u5bb6\u76ee\u5f55\u4e0b\u7684\u4e1c\u897f\u90fd\u662f\u4ece\u8fd9\u91cc\u590d\u5236\u7684 CREATE_MAIL_SPOOL = yes \u5176\u5b83\u7684\u914d\u7f6e\u5728 /etc/login.defs \u6587\u4ef6\u4e2d\u3002","title":"2.1 \u6dfb\u52a0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#22","text":"\u8d26\u53f7\u65b0\u589e\u5b8c\u6bd5\u4e4b\u540e\u662f\u9501\u5b9a\u72b6\u6001\uff0c\u8fd8\u4e0d\u80fd\u767b\u5f55\uff0c\u9700\u8981\u4fee\u6539\u5bc6\u7801\u624d\u53ef\u3002 passwd [ -k ] [ -l ] [ -u [-f ] ] [ -d ] [ -e ] [ -n mindays ] [ -x maxdays ] [ -w warndays ] [ -i inactivedays ] [ -S ] [ --stdin ] [ username ] - l , --lock \u4f1a\u5c06 /etc/shadow \u7b2c2\u680f\u6700\u524d\u9762\u52a0\u4e0a ! \uff0c \u4f7f\u5bc6\u7801\u5931\u6548\uff0c\u4f7f\u8d26\u53f7\u53ea\u80fd\u88abroot\u4f7f\u7528 - u , --unlock - d , --delete - e , --expire \u4f7f\u5bc6\u7801\u8fc7\u671f(root only) - f , --force - x , --maximum=DAYS \u591a\u957f\u65f6\u95f4\u4e4b\u5185\u9700\u8981\u4fee\u6539\u5bc6\u7801 (root only) - n , --minimum=DAYS \u591a\u957f\u65f6\u95f4\u4e4b\u5185\u4e0d\u80fd\u4fee\u6539\u5bc6\u7801 (root only) - w , --warning=DAYS \u51e0\u5929\u4e4b\u524d\u6536\u5230\u5bc6\u7801\u8fc7\u671f\u7684\u8b66\u544a (root only) - i , --inactive=DAYS \u5bc6\u7801\u8fc7\u671f\u51e0\u5929\u540e\u8d26\u53f7\u53d8\u4e3a\u4e0d\u53ef\u7528\u72b6\u6001(root only) - S , --status root only [ root@dev vitest ] # passwd -S user2 user2 PS 2019 -10-12 0 1 1 5 ( Password set, SHA512 crypt. ) [ root@dev vitest ] # passwd -l user2 Locking password for user user2. passwd: Success [ root@dev vitest ] # passwd -S user2 user2 LK 2019 -10-12 0 1 1 5 ( Password locked. ) [ root@dev vitest ] # grep /etc/shadow [ root@dev vitest ] # grep user2 /etc/shadow user2:!! $6$mjcTl /W0 $h01E8KRCadMIjOMbj .pVg.xQjGdDG4899FSQvItlTqRVo520TzI.BeTspDSXkNaS/YATo00IzrAD.fUoRQGPQ0:18181:0:1:1:5:10000: \u8fd8\u6709\u4e00\u4e2a\u6307\u4ee4\u4e5f\u53ef\u4ee5\u4fee\u6539\u5bc6\u7801\u4fe1\u606f\uff1a chage [ options ] LOGIN OPTIONS - l , --list - d , --lastday LAST_DAY \u66f4\u6539\u5bc6\u7801\u7684\u4fee\u6539\u65e5\u671f\uff0c\u683c\u5f0f\uff1aYYYY-MM-DD\u3002\u5982\u679c LAST_DAY \u8bbe\u7f6e\u4e3a 0\uff0c\u5219\u7528\u6237\u5728\u4e0b\u4e00\u6b21\u767b\u5f55\u65f6\u4f1a\u88ab\u5f3a\u5236\u66f4\u6539\u5bc6\u7801\u3002 - m , --mindays MIN_DAYS \u8bbe\u7f6e\u5bc6\u7801\u53ef\u4fee\u6539\u4e4b\u524d\u7684\u6700\u77ed\u5929\u6570 - M , --maxdays MAX_DAYS \u8bbe\u7f6e\u5bc6\u7801\u4fee\u6539\u7684\u6700\u957f\u5929\u6570 - W , --warndays WARN_DAYS \u8bbe\u7f6e\u8fc7\u671f\u524d\u63d0\u9192\u5929\u6570 - I , --inactive INACTIVE \u8bbe\u7f6e\u5bc6\u7801\u5931\u6548\u5929\u6570 - E , --expiredate EXPIRE_DATE \u8bbe\u7f6e\u8d26\u53f7\u5931\u6548\u65e5\u671f\uff0c\u683c\u5f0f\uff1aYYYY-MM-DD # \u666e\u901a\u7528\u6237\u4e4b\u80fd\u67e5\u770b\u81ea\u5df1\u7684\u4fe1\u606f [ sink@dev vitest ] $ chage -l sink Last password change : never Password expires : never Password inactive : never Account expires : never Minimum number of days between password change : 0 Maximum number of days between password change : 99999 Number of days of warning before password expires : 7 # \u591a\u4e48\u7684\u76f4\u89c2\u65b9\u4fbf\u554a [ root@dev vitest ] # chage -m 2 -M 30 -W 7 -I 7 -E 2020-01-01 user1 [ root@dev vitest ] # chage -l user1 Last password change : Oct 12 , 2019 Password expires : Nov 11 , 2019 Password inactive : Nov 18 , 2019 Account expires : Jan 01 , 2020 Minimum number of days between password change : 2 Maximum number of days between password change : 30 Number of days of warning before password expires : 7 # \u5f3a\u5236\u7528\u6237\u4e0b\u6b21\u767b\u5f55\u65f6\u66f4\u6539\u5bc6\u7801 [ root@dev vitest ] # chage -d 0 user1 [ root@dev vitest ] # chage -l user1 Last password change : password must be changed Password expires : password must be changed Password inactive : password must be changed Account expires : Jan 01 , 2020 Minimum number of days between password change : 2 Maximum number of days between password change : 30 Number of days of warning before password expires : 7","title":"2.2 \u5bc6\u7801\u7684\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#23","text":"usermod [ options ] LOGIN options - L , -- lock lock the user account - U , -- unlock unlock the user account - c , -- comment COMMENT - d , -- home HOME_DIR - u , -- uid UID new UID for the user account - l , -- login NEW_LOGIN new value of the login name - g , -- gid GROUP - G , -- groups GROUPS - a , -- append append the user to the supplemental GROUPS - e , -- expiredate EXPIRE_DATE \u8d26\u53f7\u5931\u6548 - f , -- inactive INACTIVE \u5bc6\u7801\u8fc7\u671f - p , -- password PASSWORD use encrypted password for the new password","title":"2.3 \u8d26\u53f7\u7684\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#24","text":"userdel [ options ] LOGIN - f , --force - r , --remove \u628a\u5bb6\u76ee\u5f55\u548c\u90ae\u7bb1\u4e00\u8d77\u5220\u6389 \u82e5\u771f\u6b63\u5730\u60f3\u8981\u5220\u9664\u7528\u6237\u5219\u53ef\u4ee5\u4f7f\u7528\u6539\u6307\u4ee4\uff0c\u5426\u5219\u53ef\u4ee5\u8bbe\u7f6e\u8d26\u53f7\u5931\u6548\u800c\u4fdd\u7559\u6240\u6709\u7684\u76f8\u5173\u6570\u636e\u3002","title":"2.4 \u5220\u9664"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#25","text":"finger [ - lmsp ] [ user ...] [ user @ host ...] \u7528\u6237\u4fe1\u606f\u67e5\u8be2\u5de5\u5177 Options - s Finger displays the user ' s login name, real name, terminal name and write status (as a ``* '' after the terminal name if write permission is denied), idle time, login time, office loca\u2010tion and office phone number. - l Produces a multi - line format displaying all of the information described for the - s option as well as the user ' s home directory, home phone number, login shell, mail status, and the contents of the files \u201c.plan\u201d, \u201c.project\u201d, \u201c.pgpkey\u201d and \u201c.forward\u201d from the user ' s home directory . [ root@dev libguestfs ] # finger root Login: root Name: root Directory: /root Shell: /bin/bash On since Tue Oct 8 09 :06 ( CST ) on :0 from :0 ( messages off ) On since Wed Oct 9 17 :09 ( CST ) on pts/0 from 172 .16.2.27 4 seconds idle On since Tue Oct 8 09 :08 ( CST ) on pts/1 from :0 4 days 22 hours idle On since Thu Oct 10 09 :48 ( CST ) on pts/5 from :0 2 days 5 hours idle On since Mon Oct 14 11 :19 ( CST ) on pts/8 from :0 1 hour 47 minutes idle Last login Sat Oct 12 16 :28 ( CST ) on pts/2 New mail received Mon Oct 14 03 :20 2019 ( CST ) Unread since Thu Sep 12 13 :46 2019 ( CST ) No Plan.","title":"2.5 \u7528\u6237\u4fe1\u606f\u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#251","text":"chfn [ -f full-name ] [ -o office ] , RB [ -p office-phone ] [ -h home-phone ] ] [ username ] change your finger information \u5176\u5b9e\u5c31\u662f\u4fee\u6539\u4e86 /etc/passwd \u7684\u4fe1\u606f\u8bf4\u660e\u5b57\u6bb5\uff1a [ sink@dev vitest ] $ grep sink /etc/passwd sink:x:1000:1000:sink,xxx JiangXi,,xxx:/home/sink:/bin/bash","title":"2.5.1 \u4fe1\u606f\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#26-shell","text":"chsh [ options ] [ username ] change your login shell Options : - s , -- shell < shell > specify login shell - l , -- list - shells print list of shells and exit [ sink@dev vitest ] $ chsh -s /bin/tcsh Changing shell for sink. Password: Shell changed. [ sink@dev 15 :31:28 vitest ] $ grep sink /etc/passwd sink:x:1000:1000:sink,xxx JiangXi,,xxx:/home/sink:/bin/tcsh","title":"2.6 \u6539\u53d8\u767b\u5f55 shell"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#3","text":"\u521d\u59cb\u7fa4\u7ec4\uff1ainitial group\u3002\u521b\u5efa\u8d26\u53f7\u65f6\u52a0\u5165\u7684\u7fa4\u7ec4\uff1b \u6709\u6548\u7fa4\u7ec4\uff1aeffietive group\u3002\u521b\u5efa\u6587\u4ef6\u4e4b\u7c7b\u7684\u4e1c\u897f\u65f6\u8be5\u6587\u4ef6\u6240\u5c5e\u7684\u7fa4\u7ec4\u3002 \u67e5\u770b\u6709\u6548\u7fa4\u7ec4\uff1a # \u4e24\u4e2a\u547d\u4ee4\u5217\u51fa\u7684\u7b2c\u4e00\u4e2a\u7fa4\u7ec4\u5373\u4e3a \u6709\u6548\u7fa4\u7ec4 [ sink@dev vitest ] $ id uid = 1000 ( sink ) gid = 1000 ( sink ) groups = 1000 ( sink ) ,10 ( wheel ) ,980 ( docker ) [ sink@dev vitest ] $ groups sink wheel docker \u5207\u6362\u6709\u6548\u7fa4\u7ec4\uff08\u53ea\u80fd\u5728\u6240\u5728\u7684\u7fa4\u7ec4\u4e2d\u5207\u6362\uff09\uff1a [ sink@dev vitest ] $ newgrp docker [ sink@dev vitest ] $ id uid = 1000 ( sink ) gid = 980 ( docker ) groups = 980 ( docker ) ,10 ( wheel ) ,1000 ( sink ) [ sink@dev vitest ] $ groups docker wheel sink [ sink@dev vitest ] $ touch group-test [ sink@dev vitest ] $ ll group-test -rw-r--r-- 1 sink docker 0 Oct 12 14 :23 group-test [ sink@dev vitest ] $ exit exit \u7531\u4e8e newgrp \u662f\u901a\u8fc7\u65b0\u7684shell\u6765\u63d0\u4f9b\u8be5\u529f\u80fd\u7684\uff0c\u6240\u4ee5\u5b8c\u6bd5\u4e4b\u540e\u9700\u8981 exit \u3002","title":"3. \u7fa4\u7ec4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#31","text":"FILES / etc / group Group account information . / etc / gshadow Secure group account information . / etc / login . defs Shadow password suite configuration . / etc / passwd User account information .","title":"3.1 \u76f8\u5173\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#32","text":"\u4e0e useradd \u7c7b\u4f3c\uff0c\u81ea\u7136\u6709 groupadd \u3002 groupadd [ options ] group OPTIONS - f , --force - g , --gid GID - r , --system Create a system group.","title":"3.2 \u6dfb\u52a0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#33","text":"groupmod [ options ] GROUP OPTIONS - g , --gid GID - n , --new-name NEW_GROUP","title":"3.3 \u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#34","text":"groupdel GROUP \u82e5\u6709\u8d26\u53f7\u5c06\u6b64\u7fa4\u7ec4\u4f5c\u4e3a\u6709\u6548\u7fa4\u7ec4\uff0c\u90a3\u4e48\u4e0d\u80fd\u5220\u9664\u8be5\u7fa4\u7ec4\u3002 [ root@dev libguestfs ] # groupdel user2 groupdel: cannot remove the primary group of user 'user2'","title":"3.4 \u5220\u9664"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#35","text":"\u7ba1\u7406\u67d0\u4e2a\u7fa4\u7ec4\uff0c\u8d1f\u8d23\u7528\u6237\u7684\u6dfb\u52a0\u3001\u5220\u9664\u3002 gpasswd [ option ] group administer / etc / group and / etc / gshadow OPTIONS # \u6ca1\u6709\u6307\u5b9a\u9009\u9879\u65f6\u4f1a\u4e3a\u8be5\u7fa4\u7ec4\u8bbe\u7f6e\u5bc6\u7801 # \u7cfb\u7edf\u7ba1\u7406\u5458\u7684\u64cd\u4f5c - A , --administrators user,... Set the list of administrative users. - M , --members user,... Set the list of group members. - r , --remove-password - R , --restrict \u7981\u7528 /etc/gshadow \u7684\u5bc6\u7801\u680f # \u7fa4\u7ec4\u7ba1\u7406\u5458\u7684\u64cd\u4f5c - a , --add user - d , --delete user","title":"3.5 \u7fa4\u7ec4\u7ba1\u7406\u5458\uff08\u4e0d\u5e38\u7528\uff09"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/10 linux\u8d26\u53f7\u4e0e\u7fa4\u7ec4/#4","text":"w [ options ] user [...] \u5c55\u793a\u8c01\u5728\u767b\u5f55\u548c\u6b63\u5728\u505a\u4ec0\u4e48 OPTIONS - i , -- ip - addr Display IP address instead of hostname for from field . [ sink@dev study ] $ w 22 :52:58 up 2 :16, 5 users, load average: 0 .14, 0 .05, 0 .06 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT root :0 :0 20 :38 ?xdm? 5 :52 0 .38s gdm-session-worker [ pam/gdm-password ] root pts/0 :0 20 :39 2 :08m 7 :11 0 .66s /home/pycharm-2016.2/bin/fsnotifier64 root pts/1 :0 20 :45 2 :05m 4 :13 0 .64s /home/clion-2018.3/bin/fsnotifier64 root pts/2 192 .168.216.1 21 :39 1 :06 0 .52s 0 .52s -bash sink pts/3 192 .168.216.1 22 :50 2 .00s 0 .05s 0 .00s w who [ OPTION ] \u5c55\u793a\u8c01\u5728\u767b\u5f55 [ sink@dev study ] $ who root :0 2019 -10-20 20 :38 ( :0 ) root pts/0 2019 -10-20 20 :39 ( :0 ) root pts/1 2019 -10-20 20 :45 ( :0 ) root pts/2 2019 -10-20 21 :39 ( 192 .168.216.1 ) sink pts/3 2019 -10-20 22 :50 ( 192 .168.216.1 ) lastlog [ options ] \u62a5\u544a\u8d26\u53f7\u6700\u8fd1\u4e00\u6b21\u7684\u767b\u5f55\u4fe1\u606f Options : - u , --user LOGIN|RANGE RANGE\uff1aUID_MIN-UID_MAX [ sink@dev study ] $ lastlog Username Port From Latest root pts/2 192 .168.216.1 Sun Oct 20 21 :39:09 -0400 2019 bin **Never logged in** daemon **Never logged in** \u2026\u2026 last \u663e\u793a\u6700\u8fd1\u7684\u7528\u6237\u767b\u5f55\u4fe1\u606f - F Print full login and logout times and dates . [ sink@dev study ] $ last sink pts/3 192 .168.216.1 Sun Oct 20 22 :50 still logged in user1 pts/3 192 .168.216.1 Sun Oct 20 22 :08 - 22 :09 ( 00 :00 ) root pts/2 192 .168.216.1 Sun Oct 20 21 :39 still logged in root pts/1 :0 Sun Oct 20 20 :45 still logged in root pts/0 :0 Sun Oct 20 20 :39 still logged in root :0 :0 Sun Oct 20 20 :38 still logged in ( unknown :0 :0 Sun Oct 20 20 :37 - 20 :38 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Sun Oct 20 20 :36 - 23 :06 ( 02 :29 ) ( unknown :0 :0 Sun Oct 20 20 :35 - 20 :35 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Sun Oct 20 20 :34 - 23 :06 ( 02 :31 ) root pts/0 :0 Fri Oct 18 04 :19 - 20 :31 ( 2 +16:11 ) root pts/0 :0 Fri Oct 18 03 :27 - 03 :28 ( 00 :01 ) root pts/2 :0 Fri Oct 18 03 :18 - 04 :19 ( 01 :00 ) root pts/1 :0 Fri Oct 18 02 :29 - 20 :31 ( 2 +18:01 ) root pts/0 :0 Fri Oct 18 09 :57 - 03 :24 ( -6:-33 ) root :0 :0 Fri Oct 18 09 :56 - 20 :31 ( 2 +10:34 ) ( unknown :0 :0 Fri Oct 18 09 :56 - 09 :56 ( 00 :00 ) reboot system boot 3 .10.0-514.el7.x Fri Oct 18 09 :54 - 20 :31 ( 2 +10:36 ) wtmp begins Fri Oct 18 09 :54:36 2019","title":"4. \u767b\u5f55\u8d26\u53f7\u4fe1\u606f\u67e5\u8be2"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/11 ACL/","text":"ACL\uff1aAccess Control List\uff0c\u7528\u4e8e\u5b9a\u4e49\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u66f4\u7ec6\u7c92\u5ea6\u7684\u4efb\u610f\u8bbf\u95ee\u6743\u9650\u3002 1. \u68c0\u6d4bACL \u00b6 [ sink@dev 16 :30:25 vitest ] $ dmesg | grep ACL [ 2 .493446 ] systemd [ 1 ] : systemd 219 running in system mode. ( +PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN ) [ 5 .829942 ] SGI XFS with ACLs, security attributes, no debug enabled \u53ef\u89c1XFS\u652f\u6301ACL\u3002 2. \u8bbe\u7f6eACL \u00b6 setfacl [ - bkndRLPvh ] [{ - m |- x } acl_spec ] [{ - M |- X } acl_file ] file ... setfacl -- restore = file OPTIONS - b , -- remove - all - k , -- remove - default - d , -- default \u8bbe\u7f6e Default AC \uff0c\u53ea\u5bf9\u76ee\u5f55\u6709\u6548\uff0c\u5728\u8be5\u76ee\u5f55\u65b0\u5efa\u65f6\u4f7f\u7528. - n , -- no - mask \u4e0d\u8981\u91cd\u65b0\u8ba1\u7b97\u6709\u6548\u6743\u9650\u63a9\u7801\u3002 - R , -- recursive \u9012\u5f52\u5730\u64cd\u4f5c\u3002\u4e0d\u80fd\u4e0e -- restore \u5408\u7528 - m -- modify modify the ACL of a file or directory . - M -- modify - file - x -- remove remove ACL entries - X -- remove - file -- End of command line options . All remaining parameters are interpreted as file names , even if they start with a dash . - If the file name parameter is a single dash , setfacl reads a list of files from standard input . ACL ENTRIES # perms \u662f r \u3001 w \u3001 x \u7684\u7ec4\u5408\uff0c\u82e5\u4e0d\u8bbe\u7f6e\u5219\u4e3a\u201c - \u201d [ d [ efault ]:] [ u [ ser ]:] uid [: perms ] Permissions of a named user . Permissions of the file owner if uid is empty . [ d [ efault ]:] g [ roup ]: gid [: perms ] Permissions of a named group . Permissions of the owning group if gid is empty . [ d [ efault ]:] o [ ther ][:] [: perms ] Permissions of others . [ d [ efault ]:] m [ ask ][:] [: perms ] Effective rights mask [ sink@dev 16 :51:17 vitest ] $ ll total 0 drwxrwxr-x 2 sink sink 6 Oct 14 16 :50 test-dir -rw-rw-r-- 1 sink sink 0 Oct 14 16 :51 test-f # \u8bbe\u7f6e user1 \u5bf9\u6587\u4ef6\u6ca1\u6709\u4efb\u4f55\u6743\u9650 [ sink@dev 16 :54:04 vitest ] $ setfacl -m u:user1:- test-f ; ll test-f -rw-rw-r--+ 1 sink sink 0 Oct 14 16 :51 test-f [ sink@dev 16 :54:51 vitest ] $ getfacl test-f # file: test-f # owner: sink # group: sink user::rw- user:user1:--- group::rw- mask::rw- other::r-- [ sink@dev 16 :56:28 vitest ] $ su user1 Password: [ user1@dev vitest ] $ cat test-f cat: test-f: Permission denied # \u8bbe\u7f6e\u5176\u5b83\u7528\u6237\u53ea\u6709 user1 \u5bf9\u6587\u4ef6\u5939\u6709\u8bbf\u95ee\u6743\u9650 [ sink@dev 16 :58:48 vitest ] $ setfacl -m user1:rx test-dir/ ; ll -d test-dir/ drwxrwx---+ 2 sink sink 6 Oct 14 16 :50 test-dir/ [ sink@dev 16 :59:51 vitest ] $ su user1 Password: [ user1@dev vitest ] $ cd test-dir/ [ user1@dev test-dir ] $ [ user1@dev test-dir ] $ touch user1-f touch: cannot touch \u2018user1-f\u2019: Permission denied # \u7528\u6237\u5217\u8868\u4e3a\u7a7a\uff0c\u5c31\u8bbe\u7f6e\u62e5\u6709\u8005\u7684\u6743\u9650 [ sink@dev test-dir ] $ setfacl -m u::r sink-f1 ; ll sink-f1 -r--rw-r-- 1 sink sink 0 Oct 14 17 :13 sink-f1 # \u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a -m \u9009\u9879 [ sink@dev test-dir ] $ setfacl -m g:user1:r -m user2:r sink-f2 # mask\u8868\u793a\u6743\u9650\u8303\u56f4\uff0c\u5f53\u5b83\u8d77\u4f5c\u7528\u65f6\uff0c\u5373\u4f7f\u6709\u67d0\u4e9b\u6743\u9650\uff0c\u4f46\u4e0d\u5728mask\u7684\u8303\u56f4\u4e2d\uff0c\u90a3\u4e48\u6743\u9650\u4e5f\u4e0d\u4f1a\u751f\u6548 # \u6536\u56de\u9664\u62e5\u6709\u8005\u4e4b\u5916\u7684\u6240\u6709\u4eba\u7684\u5199\u6743\u9650\u548c\u6267\u884c\u6743\u9650 [ sink@dev vitest ] $ setfacl -m m:r test-dir/ ; ll -d test-dir/ drwxr-----+ 2 sink sink 21 Oct 14 17 :13 test-dir [ sink@dev vitest ] $ getfacl test-dir/ # file: test-dir/ # owner: sink # group: sink user::rwx # \u867d\u7136\u8fd9\u91cc\u7684\u6743\u9650\u663e\u793a\u6ca1\u6539\u53d8\uff0c\u4f46\u8fd8\u662f\u4f1a\u53d7\u5230 mask \u7684\u9650\u5236\uff0c\u5168\u90e8\u53d8\u4e3a\u53ea\u8bfb user:user1:r-x #effective:r-- group::rwx #effective:r-- mask::r-- other::--- [ sink@dev vitest ] $ su user1 Password: # \u7f3a\u5c11x\u6743\u9650 [ user1@dev vitest ] $ cd test-dir/ bash: cd: test-dir/: Permission denied # \u53ea\u6709r\u6743\u9650 [ user1@dev vitest ] $ ll test-dir/ ls: cannot access test-dir/sink-f1: Permission denied total 0 -????????? ? ? ? ? ? sink-f1 # \u53ef\u7ee7\u627fACL [ sink@dev vitest ] $ setfacl -m d:g:user1:rx test-dir/ # \u8fd9\u6837\u4e00\u6765\uff0c\u5728test-dir\u4e0b\u9762\u65b0\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u90fd\u4f1a\u7ee7\u627ftest-dir\u7684ACL\u6743\u9650 3. \u67e5\u770bACL \u00b6 getfacl [ - aceEsRLPtpndvh ] file ... getfacl [ - aceEsRLPtpndvh ] -","title":"11 ACL"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/11 ACL/#1-acl","text":"[ sink@dev 16 :30:25 vitest ] $ dmesg | grep ACL [ 2 .493446 ] systemd [ 1 ] : systemd 219 running in system mode. ( +PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN ) [ 5 .829942 ] SGI XFS with ACLs, security attributes, no debug enabled \u53ef\u89c1XFS\u652f\u6301ACL\u3002","title":"1. \u68c0\u6d4bACL"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/11 ACL/#2-acl","text":"setfacl [ - bkndRLPvh ] [{ - m |- x } acl_spec ] [{ - M |- X } acl_file ] file ... setfacl -- restore = file OPTIONS - b , -- remove - all - k , -- remove - default - d , -- default \u8bbe\u7f6e Default AC \uff0c\u53ea\u5bf9\u76ee\u5f55\u6709\u6548\uff0c\u5728\u8be5\u76ee\u5f55\u65b0\u5efa\u65f6\u4f7f\u7528. - n , -- no - mask \u4e0d\u8981\u91cd\u65b0\u8ba1\u7b97\u6709\u6548\u6743\u9650\u63a9\u7801\u3002 - R , -- recursive \u9012\u5f52\u5730\u64cd\u4f5c\u3002\u4e0d\u80fd\u4e0e -- restore \u5408\u7528 - m -- modify modify the ACL of a file or directory . - M -- modify - file - x -- remove remove ACL entries - X -- remove - file -- End of command line options . All remaining parameters are interpreted as file names , even if they start with a dash . - If the file name parameter is a single dash , setfacl reads a list of files from standard input . ACL ENTRIES # perms \u662f r \u3001 w \u3001 x \u7684\u7ec4\u5408\uff0c\u82e5\u4e0d\u8bbe\u7f6e\u5219\u4e3a\u201c - \u201d [ d [ efault ]:] [ u [ ser ]:] uid [: perms ] Permissions of a named user . Permissions of the file owner if uid is empty . [ d [ efault ]:] g [ roup ]: gid [: perms ] Permissions of a named group . Permissions of the owning group if gid is empty . [ d [ efault ]:] o [ ther ][:] [: perms ] Permissions of others . [ d [ efault ]:] m [ ask ][:] [: perms ] Effective rights mask [ sink@dev 16 :51:17 vitest ] $ ll total 0 drwxrwxr-x 2 sink sink 6 Oct 14 16 :50 test-dir -rw-rw-r-- 1 sink sink 0 Oct 14 16 :51 test-f # \u8bbe\u7f6e user1 \u5bf9\u6587\u4ef6\u6ca1\u6709\u4efb\u4f55\u6743\u9650 [ sink@dev 16 :54:04 vitest ] $ setfacl -m u:user1:- test-f ; ll test-f -rw-rw-r--+ 1 sink sink 0 Oct 14 16 :51 test-f [ sink@dev 16 :54:51 vitest ] $ getfacl test-f # file: test-f # owner: sink # group: sink user::rw- user:user1:--- group::rw- mask::rw- other::r-- [ sink@dev 16 :56:28 vitest ] $ su user1 Password: [ user1@dev vitest ] $ cat test-f cat: test-f: Permission denied # \u8bbe\u7f6e\u5176\u5b83\u7528\u6237\u53ea\u6709 user1 \u5bf9\u6587\u4ef6\u5939\u6709\u8bbf\u95ee\u6743\u9650 [ sink@dev 16 :58:48 vitest ] $ setfacl -m user1:rx test-dir/ ; ll -d test-dir/ drwxrwx---+ 2 sink sink 6 Oct 14 16 :50 test-dir/ [ sink@dev 16 :59:51 vitest ] $ su user1 Password: [ user1@dev vitest ] $ cd test-dir/ [ user1@dev test-dir ] $ [ user1@dev test-dir ] $ touch user1-f touch: cannot touch \u2018user1-f\u2019: Permission denied # \u7528\u6237\u5217\u8868\u4e3a\u7a7a\uff0c\u5c31\u8bbe\u7f6e\u62e5\u6709\u8005\u7684\u6743\u9650 [ sink@dev test-dir ] $ setfacl -m u::r sink-f1 ; ll sink-f1 -r--rw-r-- 1 sink sink 0 Oct 14 17 :13 sink-f1 # \u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a -m \u9009\u9879 [ sink@dev test-dir ] $ setfacl -m g:user1:r -m user2:r sink-f2 # mask\u8868\u793a\u6743\u9650\u8303\u56f4\uff0c\u5f53\u5b83\u8d77\u4f5c\u7528\u65f6\uff0c\u5373\u4f7f\u6709\u67d0\u4e9b\u6743\u9650\uff0c\u4f46\u4e0d\u5728mask\u7684\u8303\u56f4\u4e2d\uff0c\u90a3\u4e48\u6743\u9650\u4e5f\u4e0d\u4f1a\u751f\u6548 # \u6536\u56de\u9664\u62e5\u6709\u8005\u4e4b\u5916\u7684\u6240\u6709\u4eba\u7684\u5199\u6743\u9650\u548c\u6267\u884c\u6743\u9650 [ sink@dev vitest ] $ setfacl -m m:r test-dir/ ; ll -d test-dir/ drwxr-----+ 2 sink sink 21 Oct 14 17 :13 test-dir [ sink@dev vitest ] $ getfacl test-dir/ # file: test-dir/ # owner: sink # group: sink user::rwx # \u867d\u7136\u8fd9\u91cc\u7684\u6743\u9650\u663e\u793a\u6ca1\u6539\u53d8\uff0c\u4f46\u8fd8\u662f\u4f1a\u53d7\u5230 mask \u7684\u9650\u5236\uff0c\u5168\u90e8\u53d8\u4e3a\u53ea\u8bfb user:user1:r-x #effective:r-- group::rwx #effective:r-- mask::r-- other::--- [ sink@dev vitest ] $ su user1 Password: # \u7f3a\u5c11x\u6743\u9650 [ user1@dev vitest ] $ cd test-dir/ bash: cd: test-dir/: Permission denied # \u53ea\u6709r\u6743\u9650 [ user1@dev vitest ] $ ll test-dir/ ls: cannot access test-dir/sink-f1: Permission denied total 0 -????????? ? ? ? ? ? sink-f1 # \u53ef\u7ee7\u627fACL [ sink@dev vitest ] $ setfacl -m d:g:user1:rx test-dir/ # \u8fd9\u6837\u4e00\u6765\uff0c\u5728test-dir\u4e0b\u9762\u65b0\u5efa\u6587\u4ef6\u6216\u76ee\u5f55\u90fd\u4f1a\u7ee7\u627ftest-dir\u7684ACL\u6743\u9650","title":"2. \u8bbe\u7f6eACL"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/11 ACL/#3-acl","text":"getfacl [ - aceEsRLPtpndvh ] file ... getfacl [ - aceEsRLPtpndvh ] -","title":"3. \u67e5\u770bACL"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/","text":"1. su \u00b6 \u539f\u672c\u4ee5\u4e3a\u8be5\u547d\u4ee4\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u6ca1\u60f3\u5230\u8fd8\u6709\u4e00\u4e9b\u7384\u673a\u5728\u91cc\u9762\u3002 su [ options ] [ USER [ arg ]...] Options : - m , - p , -- preserve - environment do not reset environment variables - , - l , -- login \u4f7f shell \u53d8\u4e3a login shell \uff0c\u9ed8\u8ba4\u4e3a non - login shell - c , -- command < command > pass a single command to the shell with - c - s , -- shell < shell > run shell if / etc / shells allows it # non-login shell [ sink@dev ~ ] $ su Password: [ root@dev sink ] # env # \u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\u4ecd\u7136\u662f\u539f\u6765\u7528\u6237\u7684\uff0c USER = sink PATH = /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/sink/.local/bin:/home/sink/bin MAIL = /var/spool/mail/sink HOME = /root LOGNAME = sink # login shell\uff0c\u76f8\u5f53\u4e8e\u4f7f\u7528 root \u767b\u5f55\uff0c\u6240\u6709\u7684\u73af\u5883\u53d8\u91cf\u4e5f\u4f1a\u6539\u53d8 [ sink@dev ~ ] $ su - Password: Last login: Tue Oct 15 10 :51:57 CST 2019 on pts/2 [ root@dev ~ ] # env USER = root MAIL = /var/spool/mail/root PATH = /home/clion-2018.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin HOME = /root LOGNAME = root # \u6267\u884c\u4e00\u6b21\u547d\u4ee4 [ sink@dev shell ] $ ll -d /root/ dr-xr-x---. 36 root root 4096 Oct 15 14 :36 /root/ [ sink@dev shell ] $ su - -c \"ls -d /root/Desktop\" Password: /root/Desktop [ sink@dev shell ] $ \u5173\u4e8enon-login shell\u53c2\u8003 08 bash \u3002 2. sudo \u00b6 sudo [ options ] [ command ] execute a command as another user Options : - u , -- user = user run command ( or edit file ) as specified user name or ID - b , -- background run command in the background - h , -- host = host run command on host ( if supported by plugin ) - g , -- group = group run command as the specified group name or ID - i , -- login run login shell as the target user ; a command may also be specified - S , -- stdin read password from standard input # \u5207\u6362\u7684\u7528\u6237\u4e5f\u5fc5\u987b\u6709\u6743\u9650\u624d\u53ef\u6267\u884c\u547d\u4ee4 [ root@dev ~ ] # sudo -u sink touch root-for-sink touch: cannot touch \u2018root-for-sink\u2019: Permission denied [ root@dev ~ ] # sudo -u sink touch /tmp/root-for-sink [ root@dev ~ ] # ll /tmp/root-for-sink -rw-r--r-- 1 sink sink 0 Oct 15 14 :46 /tmp/root-for-sink # \u5373\u4f7f\u4e0d\u80fd\u767b\u5f55\u7684\u7528\u6237\u4e5f\u53ef\u4ee5\u5207\u6362 [ root@dev ~ ] # grep sshd /etc/passwd sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin [ root@dev ~ ] # sudo -u sshd sh -c \"ls /tmp\" \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709root\u624d\u53ef\u4ee5\u6267\u884c sudo \u6307\u4ee4\uff0c\u8fd9\u662f\u5728 /etc/sudoers \u4e2d\u914d\u7f6e\u7684\uff0c\u8be5\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528 visudo \u6765\u7f16\u8f91\u3002 visudo [ - chqsV ] [ - f sudoers ] [ - x output_file ] safely edit the sudoers file Options : - c , --check check-only mode - f , --file=sudoers specify sudoers file location - x , --export=output_file write sudoers in JSON format to output_file 2.1 \u4f7f\u5355\u4e00\u8d26\u53f7\u53ef\u6267\u884csudo \u00b6 [ root@dev ~ ] # visudo \u2026\u2026 ## Allow root to run any commands anywhere \u4f7f\u7528\u8005\u5e10\u53f7 \u767b\u9646\u8005\u7684\u6765\u6e90\u4e3b\u673a\u540d\u79f0 =( \u53ef\u5207\u6362\u7684\u8eab\u4efd ) \u53ef\u4e0b\u8fbe\u7684\u6307\u4ee4\uff0c\u4f7f\u7528\u6307\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84 root ALL =( ALL ) ALL sink ALL =( ALL ) NOPASSWD: ALL \u2026\u2026 2.2 \u4f7f\u7fa4\u7ec4\u5185\u7684\u8d26\u53f7\u90fd\u53ef\u6267\u884csudo \u00b6 [ root@dev ~ ] # visudo \u2026\u2026 # \u52a0\u4e86 % \u5c31\u4ee3\u8868\u662f\u7fa4\u7ec4\uff0c\u8be5\u7fa4\u7ec4\u4e0b\u7684\u6240\u6709\u7528\u6237\u90fd\u53ef\u4ee5\u6267\u884c sudo \u6307\u4ee4 ## Allows people in group wheel to run all commands %wheel ALL =( ALL ) ALL ## Same thing without a password # %wheel ALL=(ALL) NOPASSWD: ALL \u2026\u2026 2.3 \u9650\u5236\u884c\u4e3a \u00b6 \u5982\u679c\u8bbe\u7f6e\u6210\u4e0a\u8ff0\u7684\u65b9\u5f0f\uff0c\u90a3\u4e48\u4f1a\u5f88\u5371\u9669\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u8fd9\u79cd\u65b9\u5f0f\u9650\u5236\u7528\u6237\u7684\u884c\u4e3a\uff1a sink ALL = ( root ) NOPASSWD : !/ usr / bin / passwd , !/ usr / bin / passwd root , / usr / bin / passwd [ a - zA - Z ] * %users localhost =/ sbin / shutdown - h now \u8868\u793asink\u7528\u6237\u53ea\u80fd\u6267\u884cpasswd\u6307\u4ee4\uff0c\u4e14\u4e0d\u80fd\u66f4\u6539root\u7684\u5bc6\u7801\u3002 2.4 \u8bbe\u7f6e\u522b\u540d \u00b6 sudo\u53ef\u4ee5\u8bbe\u7f6e\u522b\u540d\u6765\u65b9\u4fbf\u7ba1\u7406\uff0csudo\u5df2\u7ecf\u9884\u8bbe\u597d\u4e86\u4e00\u4e9b\u522b\u540d\uff0c\u53ef\u4ee5\u5206\u522b\u586b\u5199\u5230\u5bf9\u5e94\u4f4d\u7f6e\uff1a ## Host Aliases # Host_Alias MAILSERVERS = smtp , smtp2 ## User Aliases # User_Alias ADMINS = jsmith , mikem ## Command Aliases # Cmnd_Alias SOFTWARE = / bin / rpm , / usr / bin / up2date , / usr / bin / yum 2.5 \u65f6\u95f4\u95f4\u9694 \u00b6 \u5982\u679c\u4e24\u6b21sudo\u7684\u65f6\u95f4\u95f4\u9694\u8d85\u8fc75\u5206\u949f\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u91cd\u65b0\u8f93\u5165\u4e00\u6b21\u5bc6\u7801\u6765\u786e\u8ba4\u7528\u6237\u3002 2.6 \u642d\u914dsu\u6765\u4f7f\u7528 \u00b6 \u642d\u914dsu\u6307\u4ee4\u53ef\u4ee5\u8ba9\u4f60\u4f7f\u7528\u81ea\u5df1\u7684\u5bc6\u7801\u6765\u53d8\u6210root\u7528\u6237\uff1a user1 ALL = ( root ) / bin / su - [ user1@dev ~ ] $ sudo su - We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. [ sudo ] password for user1: Last login: Tue Oct 15 14 :37:53 CST 2019 on pts/2 [ root@dev ~ ] #","title":"12 \u8eab\u4efd\u5207\u6362"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#1-su","text":"\u539f\u672c\u4ee5\u4e3a\u8be5\u547d\u4ee4\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u6ca1\u60f3\u5230\u8fd8\u6709\u4e00\u4e9b\u7384\u673a\u5728\u91cc\u9762\u3002 su [ options ] [ USER [ arg ]...] Options : - m , - p , -- preserve - environment do not reset environment variables - , - l , -- login \u4f7f shell \u53d8\u4e3a login shell \uff0c\u9ed8\u8ba4\u4e3a non - login shell - c , -- command < command > pass a single command to the shell with - c - s , -- shell < shell > run shell if / etc / shells allows it # non-login shell [ sink@dev ~ ] $ su Password: [ root@dev sink ] # env # \u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u73af\u5883\u53d8\u91cf\u4ecd\u7136\u662f\u539f\u6765\u7528\u6237\u7684\uff0c USER = sink PATH = /home/clion-2018.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/sink/.local/bin:/home/sink/bin MAIL = /var/spool/mail/sink HOME = /root LOGNAME = sink # login shell\uff0c\u76f8\u5f53\u4e8e\u4f7f\u7528 root \u767b\u5f55\uff0c\u6240\u6709\u7684\u73af\u5883\u53d8\u91cf\u4e5f\u4f1a\u6539\u53d8 [ sink@dev ~ ] $ su - Password: Last login: Tue Oct 15 10 :51:57 CST 2019 on pts/2 [ root@dev ~ ] # env USER = root MAIL = /var/spool/mail/root PATH = /home/clion-2018.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin HOME = /root LOGNAME = root # \u6267\u884c\u4e00\u6b21\u547d\u4ee4 [ sink@dev shell ] $ ll -d /root/ dr-xr-x---. 36 root root 4096 Oct 15 14 :36 /root/ [ sink@dev shell ] $ su - -c \"ls -d /root/Desktop\" Password: /root/Desktop [ sink@dev shell ] $ \u5173\u4e8enon-login shell\u53c2\u8003 08 bash \u3002","title":"1. su"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#2-sudo","text":"sudo [ options ] [ command ] execute a command as another user Options : - u , -- user = user run command ( or edit file ) as specified user name or ID - b , -- background run command in the background - h , -- host = host run command on host ( if supported by plugin ) - g , -- group = group run command as the specified group name or ID - i , -- login run login shell as the target user ; a command may also be specified - S , -- stdin read password from standard input # \u5207\u6362\u7684\u7528\u6237\u4e5f\u5fc5\u987b\u6709\u6743\u9650\u624d\u53ef\u6267\u884c\u547d\u4ee4 [ root@dev ~ ] # sudo -u sink touch root-for-sink touch: cannot touch \u2018root-for-sink\u2019: Permission denied [ root@dev ~ ] # sudo -u sink touch /tmp/root-for-sink [ root@dev ~ ] # ll /tmp/root-for-sink -rw-r--r-- 1 sink sink 0 Oct 15 14 :46 /tmp/root-for-sink # \u5373\u4f7f\u4e0d\u80fd\u767b\u5f55\u7684\u7528\u6237\u4e5f\u53ef\u4ee5\u5207\u6362 [ root@dev ~ ] # grep sshd /etc/passwd sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin [ root@dev ~ ] # sudo -u sshd sh -c \"ls /tmp\" \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709root\u624d\u53ef\u4ee5\u6267\u884c sudo \u6307\u4ee4\uff0c\u8fd9\u662f\u5728 /etc/sudoers \u4e2d\u914d\u7f6e\u7684\uff0c\u8be5\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528 visudo \u6765\u7f16\u8f91\u3002 visudo [ - chqsV ] [ - f sudoers ] [ - x output_file ] safely edit the sudoers file Options : - c , --check check-only mode - f , --file=sudoers specify sudoers file location - x , --export=output_file write sudoers in JSON format to output_file","title":"2. sudo"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#21-sudo","text":"[ root@dev ~ ] # visudo \u2026\u2026 ## Allow root to run any commands anywhere \u4f7f\u7528\u8005\u5e10\u53f7 \u767b\u9646\u8005\u7684\u6765\u6e90\u4e3b\u673a\u540d\u79f0 =( \u53ef\u5207\u6362\u7684\u8eab\u4efd ) \u53ef\u4e0b\u8fbe\u7684\u6307\u4ee4\uff0c\u4f7f\u7528\u6307\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84 root ALL =( ALL ) ALL sink ALL =( ALL ) NOPASSWD: ALL \u2026\u2026","title":"2.1 \u4f7f\u5355\u4e00\u8d26\u53f7\u53ef\u6267\u884csudo"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#22-sudo","text":"[ root@dev ~ ] # visudo \u2026\u2026 # \u52a0\u4e86 % \u5c31\u4ee3\u8868\u662f\u7fa4\u7ec4\uff0c\u8be5\u7fa4\u7ec4\u4e0b\u7684\u6240\u6709\u7528\u6237\u90fd\u53ef\u4ee5\u6267\u884c sudo \u6307\u4ee4 ## Allows people in group wheel to run all commands %wheel ALL =( ALL ) ALL ## Same thing without a password # %wheel ALL=(ALL) NOPASSWD: ALL \u2026\u2026","title":"2.2 \u4f7f\u7fa4\u7ec4\u5185\u7684\u8d26\u53f7\u90fd\u53ef\u6267\u884csudo"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#23","text":"\u5982\u679c\u8bbe\u7f6e\u6210\u4e0a\u8ff0\u7684\u65b9\u5f0f\uff0c\u90a3\u4e48\u4f1a\u5f88\u5371\u9669\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u8fd9\u79cd\u65b9\u5f0f\u9650\u5236\u7528\u6237\u7684\u884c\u4e3a\uff1a sink ALL = ( root ) NOPASSWD : !/ usr / bin / passwd , !/ usr / bin / passwd root , / usr / bin / passwd [ a - zA - Z ] * %users localhost =/ sbin / shutdown - h now \u8868\u793asink\u7528\u6237\u53ea\u80fd\u6267\u884cpasswd\u6307\u4ee4\uff0c\u4e14\u4e0d\u80fd\u66f4\u6539root\u7684\u5bc6\u7801\u3002","title":"2.3 \u9650\u5236\u884c\u4e3a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#24","text":"sudo\u53ef\u4ee5\u8bbe\u7f6e\u522b\u540d\u6765\u65b9\u4fbf\u7ba1\u7406\uff0csudo\u5df2\u7ecf\u9884\u8bbe\u597d\u4e86\u4e00\u4e9b\u522b\u540d\uff0c\u53ef\u4ee5\u5206\u522b\u586b\u5199\u5230\u5bf9\u5e94\u4f4d\u7f6e\uff1a ## Host Aliases # Host_Alias MAILSERVERS = smtp , smtp2 ## User Aliases # User_Alias ADMINS = jsmith , mikem ## Command Aliases # Cmnd_Alias SOFTWARE = / bin / rpm , / usr / bin / up2date , / usr / bin / yum","title":"2.4 \u8bbe\u7f6e\u522b\u540d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#25","text":"\u5982\u679c\u4e24\u6b21sudo\u7684\u65f6\u95f4\u95f4\u9694\u8d85\u8fc75\u5206\u949f\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u91cd\u65b0\u8f93\u5165\u4e00\u6b21\u5bc6\u7801\u6765\u786e\u8ba4\u7528\u6237\u3002","title":"2.5 \u65f6\u95f4\u95f4\u9694"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/12 \u8eab\u4efd\u5207\u6362/#26-su","text":"\u642d\u914dsu\u6307\u4ee4\u53ef\u4ee5\u8ba9\u4f60\u4f7f\u7528\u81ea\u5df1\u7684\u5bc6\u7801\u6765\u53d8\u6210root\u7528\u6237\uff1a user1 ALL = ( root ) / bin / su - [ user1@dev ~ ] $ sudo su - We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. [ sudo ] password for user1: Last login: Tue Oct 15 14 :37:53 CST 2019 on pts/2 [ root@dev ~ ] #","title":"2.6 \u642d\u914dsu\u6765\u4f7f\u7528"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/","text":"1. \u8d26\u53f7\u68c0\u67e5\u5de5\u5177 \u00b6 1.1 pwck \u00b6 pwck [ options ] [ passwd [ shadow ] ] \u9a8c\u8bc1\u5bc6\u7801\u6587\u4ef6\u7684\u5b8c\u6574\u6027 options - q , --quiet report errors only - r , --read-only display errors and warnings\uff0c\u4e0d\u4fee\u6539\u6587\u4ef6 [ root@dev ~ ] # pwck /etc/passwd #\u3000\u6ca1\u6709\u5bb6\u76ee\u5f55 user 'saslauth' : directory '/run/saslauthd' does not exist user 'pulse' : directory '/var/run/pulse' does not exist user 'gnome-initial-setup' : directory '/run/gnome-initial-setup/' does not exist pwck: no changes \u7fa4\u7ec4\u7684\u68c0\u67e5\u6307\u4ee4\u662f grpck \u3002 1.2 pwconv \u00b6 pwconv , pwunconv , grpconv , grpunconv conv \uff1a\u5c06\u5bc6\u7801\u4ece passwd\u8f6c\u6362\u5230shadow\u4e2d \uff0c unconv \uff1a\u53cd\u5411\u64cd\u4f5c\uff0c\u5e76\u4e14\u5220\u9664 shadow\u6587\u4ef6 \uff01\uff01\uff01 1.3 chpasswd \u00b6 chpasswd [ options ] \u6279\u91cf\u66f4\u65b0 \uff08 \u4e0d\u80fd\u65b0\u5efa\u4e0d\u5b58\u5728\u7684\u7528\u6237\u548c\u5bc6\u7801 \uff09 \u5bc6\u7801 \uff0c \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u7528\u6237\u540d\u548c\u5bc6\u7801\u5bf9\u7684\u5217\u8868 \uff0c \u5e76\u4f7f\u7528\u6b64\u4fe1\u606f\u66f4\u65b0\u4e00\u7ec4\u73b0\u6709\u7528\u6237 \uff08 \u4ece / etc / login . def \u8bfb\u53d6\u52a0\u5bc6\u673a\u5236 \uff09 Options : - c , --crypt-method METHOD the crypt method (one of NONE DES MD5 SHA256 SHA512) - e , --encrypted supplied passwords are encrypted - m , --md5 encrypt the clear text password using the MD5 algorithm [ root@dev ~ ] # grep user /etc/shadow user1: $6$3 KY4ypLh $jpUYfSIhNBmDzsuH /ehSxLYkfd.e88c1WQpBBTeHMJUhjuh0KUfEJGkOEcyp0/lBOSI2h3/n8iiPZ0ZOxfM.l.:18183:0:99999:7::: user2:!!:18183:0:99999:7::: [ root@dev ~ ] # chpasswd <<! > user1:156 user2:654321 > ! # \u53ef\u89c1\u539f\u672c\u6709\u5bc6\u7801\u7684\u7528\u6237\u66f4\u65b0\u4e86\uff0c\u4f46\u662f\u7981\u7528\u5bc6\u7801\u7684\u7528\u6237\u6ca1\u6709\u66f4\u65b0 [ root@dev ~ ] # grep user /etc/shadow user1: $6$2 zO4d8.N0Cfh $xfwK3RfVyFhmm3JxXcrOCTtEdKlzmAGz1C5OuUq /tKNmkavfHHUIuNjXvlv0QIgetwk6Qb2F8qn4IjxT1JmKg0:18186:0:99999:7::: user2:!!:18183:0:99999:7::: [ root@dev ~ ] # echo \"user4:5475676\" | chpasswd chpasswd: line 1 : user 'user4' does not exist chpasswd: error detected, changes ignored 2. \u521b\u5efa\u5927\u91cf\u8d26\u53f7 \u00b6 [ sink@dev study ] $ cat create-accounts.sh #!/bin/sh export PATH = /usr/local/bin:/usr/local/sbin:/usr/bin/:/usr/sbin/ action = $1 usergrp = $2 action = ${ action :- create } if [ \" $action \" ! = \"create\" -a \" $action \" ! = \"delete\" ] ; then echo \"action is not correct.\" exit 1 fi if [ ! -f accounts ] ; then echo \"there is no accounts to read.\" exit 1 fi [ \" $usergrp \" ! = \"\" ] && usergrp = \"-G ${ usergrp } \" || usergrp = \"\" rm -f passwds case $action in \"create\" ) for a in $( cat accounts ) do tmp_passwd = $( openssl rand -base64 1 ) && useradd $usergrp $a && echo ${ tmp_passwd } | passwd --stdin $a chage -d 0 $a echo \" $a ${ tmp_passwd } \" >> passwds done ;; \"delete\" ) for a in $( cat accounts ) do userdel -r $a done esac","title":"13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/#1","text":"","title":"1. \u8d26\u53f7\u68c0\u67e5\u5de5\u5177"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/#11-pwck","text":"pwck [ options ] [ passwd [ shadow ] ] \u9a8c\u8bc1\u5bc6\u7801\u6587\u4ef6\u7684\u5b8c\u6574\u6027 options - q , --quiet report errors only - r , --read-only display errors and warnings\uff0c\u4e0d\u4fee\u6539\u6587\u4ef6 [ root@dev ~ ] # pwck /etc/passwd #\u3000\u6ca1\u6709\u5bb6\u76ee\u5f55 user 'saslauth' : directory '/run/saslauthd' does not exist user 'pulse' : directory '/var/run/pulse' does not exist user 'gnome-initial-setup' : directory '/run/gnome-initial-setup/' does not exist pwck: no changes \u7fa4\u7ec4\u7684\u68c0\u67e5\u6307\u4ee4\u662f grpck \u3002","title":"1.1 pwck"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/#12-pwconv","text":"pwconv , pwunconv , grpconv , grpunconv conv \uff1a\u5c06\u5bc6\u7801\u4ece passwd\u8f6c\u6362\u5230shadow\u4e2d \uff0c unconv \uff1a\u53cd\u5411\u64cd\u4f5c\uff0c\u5e76\u4e14\u5220\u9664 shadow\u6587\u4ef6 \uff01\uff01\uff01","title":"1.2 pwconv"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/#13-chpasswd","text":"chpasswd [ options ] \u6279\u91cf\u66f4\u65b0 \uff08 \u4e0d\u80fd\u65b0\u5efa\u4e0d\u5b58\u5728\u7684\u7528\u6237\u548c\u5bc6\u7801 \uff09 \u5bc6\u7801 \uff0c \u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6\u7528\u6237\u540d\u548c\u5bc6\u7801\u5bf9\u7684\u5217\u8868 \uff0c \u5e76\u4f7f\u7528\u6b64\u4fe1\u606f\u66f4\u65b0\u4e00\u7ec4\u73b0\u6709\u7528\u6237 \uff08 \u4ece / etc / login . def \u8bfb\u53d6\u52a0\u5bc6\u673a\u5236 \uff09 Options : - c , --crypt-method METHOD the crypt method (one of NONE DES MD5 SHA256 SHA512) - e , --encrypted supplied passwords are encrypted - m , --md5 encrypt the clear text password using the MD5 algorithm [ root@dev ~ ] # grep user /etc/shadow user1: $6$3 KY4ypLh $jpUYfSIhNBmDzsuH /ehSxLYkfd.e88c1WQpBBTeHMJUhjuh0KUfEJGkOEcyp0/lBOSI2h3/n8iiPZ0ZOxfM.l.:18183:0:99999:7::: user2:!!:18183:0:99999:7::: [ root@dev ~ ] # chpasswd <<! > user1:156 user2:654321 > ! # \u53ef\u89c1\u539f\u672c\u6709\u5bc6\u7801\u7684\u7528\u6237\u66f4\u65b0\u4e86\uff0c\u4f46\u662f\u7981\u7528\u5bc6\u7801\u7684\u7528\u6237\u6ca1\u6709\u66f4\u65b0 [ root@dev ~ ] # grep user /etc/shadow user1: $6$2 zO4d8.N0Cfh $xfwK3RfVyFhmm3JxXcrOCTtEdKlzmAGz1C5OuUq /tKNmkavfHHUIuNjXvlv0QIgetwk6Qb2F8qn4IjxT1JmKg0:18186:0:99999:7::: user2:!!:18183:0:99999:7::: [ root@dev ~ ] # echo \"user4:5475676\" | chpasswd chpasswd: line 1 : user 'user4' does not exist chpasswd: error detected, changes ignored","title":"1.3 chpasswd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/13 \u6279\u91cf\u521b\u5efa\u8d26\u53f7/#2","text":"[ sink@dev study ] $ cat create-accounts.sh #!/bin/sh export PATH = /usr/local/bin:/usr/local/sbin:/usr/bin/:/usr/sbin/ action = $1 usergrp = $2 action = ${ action :- create } if [ \" $action \" ! = \"create\" -a \" $action \" ! = \"delete\" ] ; then echo \"action is not correct.\" exit 1 fi if [ ! -f accounts ] ; then echo \"there is no accounts to read.\" exit 1 fi [ \" $usergrp \" ! = \"\" ] && usergrp = \"-G ${ usergrp } \" || usergrp = \"\" rm -f passwds case $action in \"create\" ) for a in $( cat accounts ) do tmp_passwd = $( openssl rand -base64 1 ) && useradd $usergrp $a && echo ${ tmp_passwd } | passwd --stdin $a chage -d 0 $a echo \" $a ${ tmp_passwd } \" >> passwds done ;; \"delete\" ) for a in $( cat accounts ) do userdel -r $a done esac","title":"2. \u521b\u5efa\u5927\u91cf\u8d26\u53f7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/","text":"quota\uff08\u914d\u989d\uff09\uff1a\u8bbe\u7f6elinux\u4e0b\u7684\u78c1\u76d8\u4f7f\u7528\u914d\u989d\u3002 quota\u4f7f\u7528\u9650\u5236\uff1a EXT \u6587\u4ef6\u7cfb\u7edf\u4ec5\u9488\u5bf9\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf ext \u5728\u8fdb\u884cquota\u9650\u5236\u7684\u65f6\u5019\u4e0d\u80fd\u5bf9\u5355\u4e00\u76ee\u5f55\u8fdb\u884c\u8bbe\u7f6e\u3002 \u5185\u6838\u5fc5\u987b\u652f\u6301 quota \u53ea\u5bf9\u4e00\u822c\u7528\u6237\u6709\u6548\u3002root\u4e0d\u80fd\uff0c\u56e0\u4e3a\u5b83\u62e5\u6709\u51e0\u4e4e\u6574\u4e2a\u7cfb\u7edf\u7684\u6570\u636e\u3002 \u82e5\u542f\u7528\u4e86 selinux\uff0c\u4e0d\u662f\u6240\u6709\u7684\u76ee\u5f55\u90fd\u53ef\u8bbe\u7f6e quota\u3002 XFS \u7684\u4e3b\u8981\u9650\u5236\u9879\uff1a \u9488\u5bf9\u7528\u6237\uff08user\uff09\u3001\u7fa4\u7ec4\uff08group\uff09\u6216\u76ee\u5f55\uff08project\uff09\u8fdb\u884c\u9650\u5236\u3002\u540e\u4e24\u8005\u4e0d\u80fd\u5171\u5b58\u3002 \u901a\u8fc7\u9650\u5236 inode \u6765\u9650\u5236\u6587\u4ef6\u6570\u91cf\uff1b\u901a\u8fc7\u9650\u5236 block \u6765\u9650\u5236\u78c1\u76d8\u5bb9\u91cf soft\u3001hard\u9650\u5236 soft \u662f\u4ea7\u751f\u8b66\u544a\u7684\u754c\u9650\uff0chard \u662f\u4e0d\u80fd\u518d\u4f7f\u7528\u78c1\u76d8\u7684\u754c\u9650\uff08\u6bd4soft\u9ad8\uff09\uff0cinode/block\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u3002\u4f4d\u4e8e\u4e24\u8005\u4e4b\u95f4\u65f6\uff0c\u6bcf\u6b21\u7528\u6237\u767b\u5f55\u90fd\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c\u82e5\u5728\u5bbd\u9650\u65f6\u95f4\uff08grace time\uff09\u5185\u4e0d\u4e88\u5904\u7406\uff0c\u90a3\u4e48\u5c06soft\u503c\u5c06\u53d6\u4ee3hard\u503c\u4f5c\u4e3aquota\u7684\u9650\u5236\uff0c\u6b64\u65f6\u5c31\u65e0\u6cd5\u518d\u65b0\u589e\u6587\u4ef6\u4e86\u3002 \u5bbd\u9650\u65f6\u95f4 1. \u5b9e\u9a8c \u00b6 1.1 \u642d\u5efa\u5b9e\u9a8c\u73af\u5883 \u00b6 # \u5148\u521b\u5efa\u5b9e\u9a8c\u7528\u7684\u7528\u6237 [ root@dev ~ ] # groupadd qus [ root@dev ~ ] # for i in {1..3}; do useradd -g qus qu$i; echo \"123\" | passwd --stdin qu$i; done Changing password for user qu1. passwd: all authentication tokens updated successfully. Changing password for user qu2. passwd: all authentication tokens updated successfully. Changing password for user qu3. passwd: all authentication tokens updated successfully. # \u68c0\u67e5\u6587\u4ef6\u7cfb\u7edf [ root@dev tmp ] # df -hT disk-sdb/ Filesystem Type Size Used Avail Use% Mounted on /dev/sdb xfs 2 .0G 33M 2 .0G 2 % /tmp/disk-sdb # xfs \u5f00\u542f quota \u5fc5\u987b\u5728 /etc/fstab \u4e2d\u5199\u5165\u6216\u5728\u6302\u8f7d\u4e4b\u521d\u5c31\u6307\u660e\uff0c\u5426\u5219\u4e0d\u4f1a\u751f\u6548\uff08remount\u65e0\u7528\uff09 [ root@dev tmp ] # vim /etc/fstab \u2026\u2026 /dev/sdb /disk-sdb xfs defaults,usrquota,grpquota 0 0 # \u8fd9\u91cc\u4e00\u5b9a\u8981\u5148\u5378\u8f7d\u624d\u80fd\u751f\u6548 [ root@dev tmp ] # umount disk-sdb/ [ root@dev tmp ] # mount -a [ root@dev tmp ] # mount | grep sdb /dev/sdb on /tmp/disk-sdb type xfs ( rw,relatime,seclabel,attr2,inode64,usrquota,grpquota ) [ root@dev tmp ] # cd disk-sdb/ [ root@dev disk-sdb ] # chgrp qus quota-test/; chmod 2770 quota-test/; ll -d quota-test drwxrws---. 2 root qus 6 Oct 22 03 :18 quota-test /etc/fstab \u7684\u5b57\u6bb5\u4e2d\u9488\u5bf9 quota \u7684\u9650\u5236\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a uquota/usrquota/quota\uff1a\u9488\u5bf9\u8d26\u53f7\u7684\u8bbe\u5b9a gquota/grpquota\uff1a\u9488\u5bf9\u7fa4\u7ec4\u7684\u8bbe\u5b9a pquota/prjquota\uff1a\u9488\u5bf9\u5355\u4e00\u76ee\u5f55\u7684\u8bbe\u5b9a\uff0c \u4e0d\u80fd\u4e0e\u7fa4\u7ec4\u7684\u8bbe\u5b9a\u5e76\u5b58 1.2 \u901a\u7528\u547d\u4ee4 \u00b6 xfs_quota - x - c cmd ... [ - d project ] ... [ path ... ] \u7ba1\u7406 XFS \u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u914d\u989d\u4f7f\u7528 - x \u542f\u7528\u4e13\u5bb6\u6a21\u5f0f\u3002\u53ea\u6709\u5728\u6b64\u6a21\u5f0f\u4e0b\u624d\u53ef\u4f7f\u7528 ADMINISTRATOR COMMANDS - c cmd \u975e\u4ea4\u4e92\u6a21\u5f0f\u6267\u884c\u547d\u4ee4\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a - c \u547d\u4ee4\uff0c\u6309\u987a\u5e8f\u6267\u884c\u3002 \u4e0b\u5217\u547d\u4ee4\u7684\u9009\u9879\u8bf4\u660e\u7edf\u4e00\u9002\u7528\u4e8e\u6240\u6709\u540c\u6837\u7684\u9009\u9879 - h \uff1a human - readable - b \uff1a blocks used - i \uff1a inodes used - r \uff1a realtime blocks used - f \uff1a \u8f93\u51fa\u5230\u6587\u4ef6 1.3 \u4fe1\u606f\u83b7\u53d6\u547d\u4ee4 \u00b6 USER COMMANDS \uff1a\u53ea\u6709\u4fe1\u606f\u83b7\u53d6\u547d\u4ee4\u4e2d\u6709\u8be5\u79cd\u6307\u4ee4\uff0c\u5176\u5b83\u7684\u90fd\u662f ADMINISTRATOR COMMANDS print quota [ - g | - p | - u ] [ - bir ] [ - h ] [ - f file ] [ ID | name ] ... \u663e\u793a\u5355\u4e2a\u7528\u6237\u7684\u4f7f\u7528\u4e0e\u9650\u5236\u3002 df / free [ - bir ] [ - h ] [ - f file ] \u62a5\u544a fs\u4f7f\u7528\u60c5\u51b5 \uff0c\u4e0e df ( 1 ) \u5de5\u5177\u7c7b\u4f3c\uff08\u4f46\u662f\u66f4\u5feb\uff09 ADMINISTRATOR COMMANDS \uff1a report [ - gpu ] [ - bir ] [ - ahntlLNU ] [ - f file ] \u62a5\u544a fs\u7684quota\u4fe1\u606f \uff0c\u9ed8\u8ba4\u662f block state [ - gpu ] [ - av ] [ - f file ] \u62a5\u544a\u603b\u4f53 quota\u72b6\u6001\u4fe1\u606f \u3002 [ sink@dev study ] $ xfs_quota -x -c \"print\" Filesystem Pathname / /dev/mapper/cl-root /boot /dev/sda1 /tmp/disk-sdb /dev/sdb ( uquota, gquota ) [ sink@dev study ] $ xfs_quota -x -c \"df -h\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 32 .2M 2 .0G 2 % /tmp/disk-sdb [ sink@dev tmp ] $ xfs_quota -x -c \"state\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 7 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ] 1.4 \u9650\u5236\u547d\u4ee4 \u00b6 ADMINISTRATOR COMMANDS limit [ - g | - p | - u ] bsoft = N | bhard = N | isoft = N | ihard = N | rtbsoft = N | rtbhard = N - d | id | name \u8bbe\u7f6e block limits ( bhard / bsoft ), inode count limits ( ihard / isoft ) and / or realtime block limits ( rtbhard / rtbsoft ) \u3002 - d \u8868\u793a\u5bf9\u9ed8\u8ba4\u7684\u5bf9\u8c61\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4f7f\u7528\u6307\u5b9a\u7684 user / group / project timer [ - g | - p | - u ] [ - bir ] value \u8bbe\u7f6e\u5bbd\u9650\u65f6\u95f4\u3002\u5355\u4f4d\u9ed8\u8ba4\u662f \u79d2\uff0c\u5176\u5b83\u53ef\u8bc6\u522b\u5355\u4f4d\uff1a 'minutes' , 'hours' , 'days' , and 'weeks' \uff0c\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u5f62\u5f0f # \u9650\u5236 inode [ root@dev tmp ] # xfs_quota -x -c \"limit -u isoft=5 ihard=10 qu1\" disk-sdb/ # \u9650\u5236 block [ root@dev tmp ] # for i in {1..3}; do xfs_quota -x -c \"limit -u bsoft=10M bhard=20M qu$i\" disk-sdb/; done # \u9650\u5236 \u7fa4\u7ec4 [ root@dev tmp ] # xfs_quota -x -c \"limit -g bsoft=20M bhard=50M qus\" disk-sdb/ [ root@dev tmp ] # xfs_quota -x -c \"report -u -bih\" /tmp/disk-sdb/ User quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes User ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 4 0 0 00 [ ------ ] qu1 20M 10M 20M 00 [ 2 days ] 1 5 10 00 [ ------ ] qu2 0 10M 20M 00 [ ------ ] 0 0 0 00 [ ------ ] qu3 0 10M 20M 00 [ ------ ] 0 0 0 00 [ ------ ] # \u8c03\u6574\u5bbd\u9650\u65f6\u95f4 [ root@dev tmp ] # xfs_quota -x -c \"timer -g -b 3d\" disk-sdb/ [ root@dev tmp ] # xfs_quota -x -c \"state -gu\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 3 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ] # \u9650\u5236\u6d4b\u8bd5 # \u8d85\u8fc7 soft \u754c\u9650 [ qu1@dev quota-test ] $ dd if = /dev/zero of = qu1-f bs = 1M count = 11 11 +0 records in 11 +0 records out 11534336 bytes ( 12 MB ) copied, 0 .0320814 s, 360 MB/s # \u8d85\u8fc7 hard \u754c\u9650 [ qu1@dev quota-test ] $ dd if = /dev/zero of = qu1-f bs = 1M count = 22 dd: error writing \u2018qu1-f\u2019: Disk quota exceeded 21 +0 records in 20 +0 records out 20971520 bytes ( 21 MB ) copied, 0 .128578 s, 163 MB/s [ qu1@dev quota-test ] $ ll -h total 20M -rw-r--r--. 1 qu1 qus 20M Oct 22 04 :24 qu1-f # qu2\u4e5f\u521b\u5efa\u4e00\u4e2a [ qu2@dev quota-test ] $ dd if = /dev/zero of = qu2-f bs = 1M count = 20 # qu3\u518d\u521b\u5efa\u65f6\u5df2\u7ecf\u8fbe\u5230\u4e86\u7fa4\u7ec4\u7684\u9650\u5236 [ qu3@dev quota-test ] $ dd if = /dev/zero of = qu3-f bs = 1M count = 20 dd: error writing \u2018qu3-f\u2019: Disk quota exceeded 11 +0 records in 10 +0 records out 10485760 bytes ( 10 MB ) copied, 0 .0137186 s, 764 MB/s # \u5f00\u59cb\u5012\u8ba1\u65f6 [ root@dev tmp ] # xfs_quota -x -c \"report -ug -bih\" /tmp/disk-sdb/ User quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes User ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 4 0 0 00 [ ------ ] qu1 20M 10M 20M 00 [ 2 days ] 1 5 10 00 [ ------ ] qu2 20M 10M 20M 00 [ 2 days ] 1 0 0 00 [ ------ ] qu3 10M 10M 20M 00 [ ------ ] 1 0 0 00 [ ------ ] Group quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes Group ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 3 0 0 00 [ ------ ] qus 50M 20M 50M 00 [ 2 days ] 4 0 0 00 [ ------ ] 1.4.1 project\u7684\u9650\u5236\u8bbe\u7f6e \u00b6 # \u547d\u4ee4 project [ - cCs [ - d depth ] [ - p path ] id | name ] - c \u68c0\u67e5\u6811\u7684\u8bbe\u7f6e - s \u521d\u59cb\u5316\u8bbe\u7f6e\u6811 - C \u9012\u5f52\u5730\u6e05\u9664\u9650\u5236 - d \u9650\u5236\u9012\u5f52\u5c42\u7ea7\u3002 - 1 \u662f\u65e0\u9650\u7684\uff0c 0 \u662f\u9876\u5c42\u7684\uff0c 1 \u662f\u7b2c\u4e00\u7ea7\uff0c \u4ee5\u6b64\u7c7b\u63a8 ... - p \u5728\u547d\u4ee4\u884c\u6307\u5b9a project \u7684\u8def\u5f84\uff0c\u800c\u4e0d\u662f\u901a\u8fc7 / etc / projects \u6587\u4ef6\u3002\u4f46\u4e5f\u4f1a\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 \u7531\u4e8egrpquota\u4e0eprjquota\u4e0d\u80fd\u540c\u65f6\u5b58\u5728\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5378\u8f7d\u518d\u91cd\u65b0\u6302\u8f7d\u3002 [ root@dev ~ ] # umount /dev/sdb [ root@dev ~ ] # vi /etc/fstab /dev/sdb /tmp/disk-sdb xfs defaults,usrquota,prjquota 0 0 [ root@dev ~ ] # mount -a [ sink@dev tmp ] $ xfs_quota -x -c \"state\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 3 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ] project\u7684\u9650\u5236\u9700\u8981\u7528\u5230\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a / etc / projects Mapping of numeric project identifiers to directories trees . / etc / projid Mapping of numeric project identifiers to project names . # id\u3001project-name\u90fd\u662f\u81ea\u5df1\u6307\u5b9a [ root@dev ~ ] # echo 1:/tmp/disk-sdb/quota-test >> /etc/projects [ root@dev ~ ] # echo quota-test-files:1 >> /etc/projid # \u521d\u59cb\u5316 [ root@dev ~ ] # xfs_quota -x -c \"project -s quota-test-files\" /tmp/disk-sdb/ Setting up project quota-test-files ( path /tmp/disk-sdb/quota-test ) ... Processed 1 ( /etc/projects and cmdline ) paths for project quota-test-files with recursion depth infinite ( -1 ) . [ root@dev ~ ] # xfs_quota -x -c \"limit -p bsoft=2M bhard=10M 1\" /tmp/disk-sdb/ [ root@dev ~ ] # xfs_quota -x -c \"report -p -h\" /tmp/disk-sdb/ Project quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Project ID Used Soft Hard Warn/Grace ---------- --------------------------------- #0 0 0 0 00 [------] quota-test-files 30M 2M 10M 00 [ -none- ] # \u53ef\u4ee5\u770b\u5230 /tmp/disk-sdb/quota-test \u5df2\u7ecf\u8d85\u51fa\u9650\u5236\u4e86 [ root@dev ~ ] # xfs_quota -x -c \"df -h\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 62 .2M 1 .9G 3 % /tmp/disk-sdb /dev/sdb 2M 30M 8192 .0E 1500 % /tmp/disk-sdb/quota-test # \u68c0\u67e5\u6811\u7684\u8bbe\u7f6e # \u5df2\u8bbe\u7f6e [ root@dev ~ ] # xfs_quota -x -c \"project -c 1\" /tmp/disk-sdb/ Checking project 1 ( path /tmp/disk-sdb/quota-test ) ... Processed 1 ( /etc/projects and cmdline ) paths for project 1 with recursion depth infinite ( -1 ) . # \u672a\u8bbe\u7f6e [ root@dev ~ ] # xfs_quota -x -c \"project -c 2\" /tmp/disk-sdb/ Processed 0 ( /etc/projects and cmdline ) paths for project 2 with recursion depth infinite ( -1 ) . # \u76f4\u63a5\u5728\u547d\u4ee4\u884c\u914d\u7f6e\u6811\uff0c\u4f46\u662f\u8bb8\u591a\u547d\u4ee4\u90fd\u68c0\u6d4b\u4e0d\u5230 [ root@dev ~ ] # xfs_quota -x -c 'project -s -p /tmp/disk-sdb/quota-test2 3' /tmp/disk-sdb/ [ root@dev disk-sdb ] # xfs_quota -x -c \"limit -p bhard=30M 3\" /tmp/disk-sdb/ [ root@dev quota-test2 ] # cp qu1-f qu1-f-1 cp: error writing \u2018qu1-f-1\u2019: No space left on device cp: failed to extend \u2018qu1-f-1\u2019: No space left on device [ root@dev quota-test2 ] # ll -h total 30M -rw-r--r--. 1 root root 20M Oct 23 10 :29 qu1-f -rw-r--r--. 1 root root 10M Oct 23 10 :29 qu1-f-1 # \u68c0\u6d4b [ root@dev quota-test2 ] # xfs_quota -x -c \"df -bh\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 92 .4M 1 .9G 5 % /tmp/disk-sdb /dev/sdb 2M 30M 8192 .0E 1500 % /tmp/disk-sdb/quota-test [ root@dev quota-test2 ] # xfs_quota -x -c \"print\" /tmp/disk-sdb/ Filesystem Pathname /tmp/disk-sdb /dev/sdb ( uquota, pquota ) /tmp/disk-sdb/quota-test /dev/sdb ( project 1 , quota-test-files ) [ root@dev quota-test2 ] # xfs_quota -x -c \"project -c 3\" /tmp/disk-sdb/ Processed 0 ( /etc/projects and cmdline ) paths for project 3 with recursion depth infinite ( -1 ) . # \u5fc5\u987b\u6307\u5b9a\u8def\u5f84\u624d\u53ef [ root@dev quota-test2 ] # xfs_quota -x -c \"project -c -p /tmp/disk-sdb/quota-test2 3\" /tmp/disk-sdb/ Checking project 3 ( path /tmp/disk-sdb/quota-test2 ) ... Processed 1 ( /etc/projects and cmdline ) paths for project 3 with recursion depth infinite ( -1 ) . 1.5 \u53d6\u6d88\u9650\u5236\u547d\u4ee4 \u00b6 disable [ - gpu ] [ - v ] \u6682\u65f6\u5173\u95ed quota \u7684\u9650\u5236 enable [ - gpu ] [ - v ] \u6253\u5f00 quota \u7684\u9650\u5236 off [ - gpu ] [ - v ] \u6c38\u4e45\u5173\u95ed quota \u7684\u9650\u5236\u3002\u53ea\u80fd umount\u4e4b\u540e\u518d\u6b21mount\u6062\u590d remove [ - gpu ] [ - v ] \u5220\u9664 quota \u7684\u9650\u5236\u3002\u53ea\u80fd\u5728 off \u72b6\u6001\u4e0b\u6267\u884c # \u6682\u65f6\u5173\u95ed [ root@dev tmp ] # xfs_quota -x -c \"disable -p\" /tmp/disk-sdb [ root@dev tmp ] # xfs_quota -x -c \"state\" /tmp/disk-sdb \u2026\u2026 Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON # \u8fd9\u91cc\u662f\u5173\u95ed\u72b6\u6001 Enforcement: OFF Inode: #68 (2 blocks, 2 extents) \u2026\u2026 # \u5f7b\u5e95\u5173\u95ed [ root@dev tmp ] # xfs_quota -x -c \"off -p\" /tmp/disk-sdb [ root@dev tmp ] # xfs_quota -x -c \"state\" /tmp/disk-sdb \u2026\u2026 Project quota state on /tmp/disk-sdb ( /dev/sdb ) # \u5168\u90e8\u662f\u5173\u95ed\u72b6\u6001 Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) \u2026\u2026 # \u62a5\u544a\u4e5f\u6ca1\u6709\u4efb\u4f55\u7ed3\u679c [ root@dev tmp ] # xfs_quota -x -c \"report -pbh\" /tmp/disk-sdb # \u6b64\u65f6\u518d\u5220\u9664\u7b56\u7565\uff0c\u7ed3\u679c\u5c45\u7136\u62a5\u9519\uff0c\u800c\u4e14id\u5220\u4e0d\u6389\uff01\uff01\uff01\uff0c\u771f\u662f\u6298\u78e8\uff01\uff01\uff01 FIXME [ root@dev tmp ] # xfs_quota -x -c 'remove -p' /tmp/disk-sdb XFS_QUOTARM: Invalid argument 2. XFS\u4e0eEXT\u5bf9\u6bd4 \u00b6 \u8bbe\u7f6e\u6d41\u7a0b\u9879\u76ee XFS \u6587\u4ef6\u7cfb\u7edf EXT \u5bb6\u65cf /etc/fstab\u53c2\u6570\u8bbe\u7f6e usrquota/grpquota/prjquota usrquota/grpquota quota \u914d\u7f6e\u6587\u4ef6 \u65e0 quotacheck \u8bbe\u7f6e\u7528\u6237/\u7fa4\u7ec4\u9650\u5236\u503c xfs_quota -x -c \"limit -u -g ...\" edquota \u6216 setquota \u8bbe\u7f6e grace time xfs_quota -x -c \"timer...\" edquota \u8bbe\u7f6e\u76ee\u5f55\u9650\u5236\u503c xfs_quota -x -c \"limit -p ...\" \u65e0 \u89c2\u5bdf\u62a5\u544a xfs_quota -x -c \"report...\" repquota \u6216 quota \u542f \u52a8\u4e0e \u5173\u95ed quota \u9650\u5236 xfs_quota -x -c \"[disable|enable]...\" quotaoff, quotaon \u53d1\u9001\u8b66\u544a\u4fe1\u7ed9\u7528 \u6237 \u76ee \u524d\u7248\u672c\u5c1a\u672a\u652f\u6301 warnquota \u5b9e\u9645\u4e0a\uff0c\u540e\u8005\u7684\u547d\u4ee4\u5bf9\u4e8equota\u7684\u9650\u5236\u51e0\u4e4e\u662f\u5bf9\u6240\u6709\u7684FS\u90fd\u662f\u901a\u7528\u7684\u3002\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5\uff1ahttps://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-disk-quotas 3. \u4e0d\u6539\u53d8\u73b0\u6709\u7684 quota \u60c5\u51b5\u4e0b\u5bf9\u5176\u5b83\u8def\u5f84\u6dfb\u52a0\u9650\u5236 \u00b6 \u8be5\u505a\u6cd5\u7684\u524d\u63d0\u662f\u6709\u72ec\u7acb\u7684\u5206\u533a\uff0c\u6bd4\u5982 /home\u3002 \u60c5\u666f\uff1a\u82e5\u67d0\u4e00\u76ee\u5f55\u5728\u89c4\u5212\u7684\u65f6\u5019\u5e76\u672a\u8003\u8651\u5bf9\u5176\u505a\u51fa\u9650\u5236\uff0c\u540e\u6765\u53c8\u60f3\u5bf9\u5176\u8bbe\u7f6e quota\u3002 \u89e3\u51b3\u65b9\u6cd5\u662f\u5c06\u8be5\u76ee\u5f55\u79fb\u52a8\u5230\u8bbe\u7f6e\u4e86 quota \u7684\u72ec\u7acb\u5206\u533a\u4e0b\uff0c\u7136\u540e\u505a\u4e00\u4e2a\u8f6f\u94fe\u63a5\uff0c\u518d\u5bf9\u72ec\u7acb\u5206\u533a\u8fdb\u884c\u914d\u7f6e\u3002 Note \u5728\u79fb\u52a8\u76ee\u5f55\u7684\u65f6\u5019\u53ef\u80fd\u9700\u8981\u66f4\u6539 SELinux\u3002","title":"14 quota"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#1","text":"","title":"1. \u5b9e\u9a8c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#11","text":"# \u5148\u521b\u5efa\u5b9e\u9a8c\u7528\u7684\u7528\u6237 [ root@dev ~ ] # groupadd qus [ root@dev ~ ] # for i in {1..3}; do useradd -g qus qu$i; echo \"123\" | passwd --stdin qu$i; done Changing password for user qu1. passwd: all authentication tokens updated successfully. Changing password for user qu2. passwd: all authentication tokens updated successfully. Changing password for user qu3. passwd: all authentication tokens updated successfully. # \u68c0\u67e5\u6587\u4ef6\u7cfb\u7edf [ root@dev tmp ] # df -hT disk-sdb/ Filesystem Type Size Used Avail Use% Mounted on /dev/sdb xfs 2 .0G 33M 2 .0G 2 % /tmp/disk-sdb # xfs \u5f00\u542f quota \u5fc5\u987b\u5728 /etc/fstab \u4e2d\u5199\u5165\u6216\u5728\u6302\u8f7d\u4e4b\u521d\u5c31\u6307\u660e\uff0c\u5426\u5219\u4e0d\u4f1a\u751f\u6548\uff08remount\u65e0\u7528\uff09 [ root@dev tmp ] # vim /etc/fstab \u2026\u2026 /dev/sdb /disk-sdb xfs defaults,usrquota,grpquota 0 0 # \u8fd9\u91cc\u4e00\u5b9a\u8981\u5148\u5378\u8f7d\u624d\u80fd\u751f\u6548 [ root@dev tmp ] # umount disk-sdb/ [ root@dev tmp ] # mount -a [ root@dev tmp ] # mount | grep sdb /dev/sdb on /tmp/disk-sdb type xfs ( rw,relatime,seclabel,attr2,inode64,usrquota,grpquota ) [ root@dev tmp ] # cd disk-sdb/ [ root@dev disk-sdb ] # chgrp qus quota-test/; chmod 2770 quota-test/; ll -d quota-test drwxrws---. 2 root qus 6 Oct 22 03 :18 quota-test /etc/fstab \u7684\u5b57\u6bb5\u4e2d\u9488\u5bf9 quota \u7684\u9650\u5236\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a uquota/usrquota/quota\uff1a\u9488\u5bf9\u8d26\u53f7\u7684\u8bbe\u5b9a gquota/grpquota\uff1a\u9488\u5bf9\u7fa4\u7ec4\u7684\u8bbe\u5b9a pquota/prjquota\uff1a\u9488\u5bf9\u5355\u4e00\u76ee\u5f55\u7684\u8bbe\u5b9a\uff0c \u4e0d\u80fd\u4e0e\u7fa4\u7ec4\u7684\u8bbe\u5b9a\u5e76\u5b58","title":"1.1 \u642d\u5efa\u5b9e\u9a8c\u73af\u5883"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#12","text":"xfs_quota - x - c cmd ... [ - d project ] ... [ path ... ] \u7ba1\u7406 XFS \u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u914d\u989d\u4f7f\u7528 - x \u542f\u7528\u4e13\u5bb6\u6a21\u5f0f\u3002\u53ea\u6709\u5728\u6b64\u6a21\u5f0f\u4e0b\u624d\u53ef\u4f7f\u7528 ADMINISTRATOR COMMANDS - c cmd \u975e\u4ea4\u4e92\u6a21\u5f0f\u6267\u884c\u547d\u4ee4\u3002\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a - c \u547d\u4ee4\uff0c\u6309\u987a\u5e8f\u6267\u884c\u3002 \u4e0b\u5217\u547d\u4ee4\u7684\u9009\u9879\u8bf4\u660e\u7edf\u4e00\u9002\u7528\u4e8e\u6240\u6709\u540c\u6837\u7684\u9009\u9879 - h \uff1a human - readable - b \uff1a blocks used - i \uff1a inodes used - r \uff1a realtime blocks used - f \uff1a \u8f93\u51fa\u5230\u6587\u4ef6","title":"1.2 \u901a\u7528\u547d\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#13","text":"USER COMMANDS \uff1a\u53ea\u6709\u4fe1\u606f\u83b7\u53d6\u547d\u4ee4\u4e2d\u6709\u8be5\u79cd\u6307\u4ee4\uff0c\u5176\u5b83\u7684\u90fd\u662f ADMINISTRATOR COMMANDS print quota [ - g | - p | - u ] [ - bir ] [ - h ] [ - f file ] [ ID | name ] ... \u663e\u793a\u5355\u4e2a\u7528\u6237\u7684\u4f7f\u7528\u4e0e\u9650\u5236\u3002 df / free [ - bir ] [ - h ] [ - f file ] \u62a5\u544a fs\u4f7f\u7528\u60c5\u51b5 \uff0c\u4e0e df ( 1 ) \u5de5\u5177\u7c7b\u4f3c\uff08\u4f46\u662f\u66f4\u5feb\uff09 ADMINISTRATOR COMMANDS \uff1a report [ - gpu ] [ - bir ] [ - ahntlLNU ] [ - f file ] \u62a5\u544a fs\u7684quota\u4fe1\u606f \uff0c\u9ed8\u8ba4\u662f block state [ - gpu ] [ - av ] [ - f file ] \u62a5\u544a\u603b\u4f53 quota\u72b6\u6001\u4fe1\u606f \u3002 [ sink@dev study ] $ xfs_quota -x -c \"print\" Filesystem Pathname / /dev/mapper/cl-root /boot /dev/sda1 /tmp/disk-sdb /dev/sdb ( uquota, gquota ) [ sink@dev study ] $ xfs_quota -x -c \"df -h\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 32 .2M 2 .0G 2 % /tmp/disk-sdb [ sink@dev tmp ] $ xfs_quota -x -c \"state\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 7 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ]","title":"1.3 \u4fe1\u606f\u83b7\u53d6\u547d\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#14","text":"ADMINISTRATOR COMMANDS limit [ - g | - p | - u ] bsoft = N | bhard = N | isoft = N | ihard = N | rtbsoft = N | rtbhard = N - d | id | name \u8bbe\u7f6e block limits ( bhard / bsoft ), inode count limits ( ihard / isoft ) and / or realtime block limits ( rtbhard / rtbsoft ) \u3002 - d \u8868\u793a\u5bf9\u9ed8\u8ba4\u7684\u5bf9\u8c61\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u4f7f\u7528\u6307\u5b9a\u7684 user / group / project timer [ - g | - p | - u ] [ - bir ] value \u8bbe\u7f6e\u5bbd\u9650\u65f6\u95f4\u3002\u5355\u4f4d\u9ed8\u8ba4\u662f \u79d2\uff0c\u5176\u5b83\u53ef\u8bc6\u522b\u5355\u4f4d\uff1a 'minutes' , 'hours' , 'days' , and 'weeks' \uff0c\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u5f62\u5f0f # \u9650\u5236 inode [ root@dev tmp ] # xfs_quota -x -c \"limit -u isoft=5 ihard=10 qu1\" disk-sdb/ # \u9650\u5236 block [ root@dev tmp ] # for i in {1..3}; do xfs_quota -x -c \"limit -u bsoft=10M bhard=20M qu$i\" disk-sdb/; done # \u9650\u5236 \u7fa4\u7ec4 [ root@dev tmp ] # xfs_quota -x -c \"limit -g bsoft=20M bhard=50M qus\" disk-sdb/ [ root@dev tmp ] # xfs_quota -x -c \"report -u -bih\" /tmp/disk-sdb/ User quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes User ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 4 0 0 00 [ ------ ] qu1 20M 10M 20M 00 [ 2 days ] 1 5 10 00 [ ------ ] qu2 0 10M 20M 00 [ ------ ] 0 0 0 00 [ ------ ] qu3 0 10M 20M 00 [ ------ ] 0 0 0 00 [ ------ ] # \u8c03\u6574\u5bbd\u9650\u65f6\u95f4 [ root@dev tmp ] # xfs_quota -x -c \"timer -g -b 3d\" disk-sdb/ [ root@dev tmp ] # xfs_quota -x -c \"state -gu\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 3 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ] # \u9650\u5236\u6d4b\u8bd5 # \u8d85\u8fc7 soft \u754c\u9650 [ qu1@dev quota-test ] $ dd if = /dev/zero of = qu1-f bs = 1M count = 11 11 +0 records in 11 +0 records out 11534336 bytes ( 12 MB ) copied, 0 .0320814 s, 360 MB/s # \u8d85\u8fc7 hard \u754c\u9650 [ qu1@dev quota-test ] $ dd if = /dev/zero of = qu1-f bs = 1M count = 22 dd: error writing \u2018qu1-f\u2019: Disk quota exceeded 21 +0 records in 20 +0 records out 20971520 bytes ( 21 MB ) copied, 0 .128578 s, 163 MB/s [ qu1@dev quota-test ] $ ll -h total 20M -rw-r--r--. 1 qu1 qus 20M Oct 22 04 :24 qu1-f # qu2\u4e5f\u521b\u5efa\u4e00\u4e2a [ qu2@dev quota-test ] $ dd if = /dev/zero of = qu2-f bs = 1M count = 20 # qu3\u518d\u521b\u5efa\u65f6\u5df2\u7ecf\u8fbe\u5230\u4e86\u7fa4\u7ec4\u7684\u9650\u5236 [ qu3@dev quota-test ] $ dd if = /dev/zero of = qu3-f bs = 1M count = 20 dd: error writing \u2018qu3-f\u2019: Disk quota exceeded 11 +0 records in 10 +0 records out 10485760 bytes ( 10 MB ) copied, 0 .0137186 s, 764 MB/s # \u5f00\u59cb\u5012\u8ba1\u65f6 [ root@dev tmp ] # xfs_quota -x -c \"report -ug -bih\" /tmp/disk-sdb/ User quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes User ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 4 0 0 00 [ ------ ] qu1 20M 10M 20M 00 [ 2 days ] 1 5 10 00 [ ------ ] qu2 20M 10M 20M 00 [ 2 days ] 1 0 0 00 [ ------ ] qu3 10M 10M 20M 00 [ ------ ] 1 0 0 00 [ ------ ] Group quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Inodes Group ID Used Soft Hard Warn/Grace Used Soft Hard Warn/Grace ---------- --------------------------------- --------------------------------- root 0 0 0 00 [ 0 days ] 3 0 0 00 [ ------ ] qus 50M 20M 50M 00 [ 2 days ] 4 0 0 00 [ ------ ]","title":"1.4 \u9650\u5236\u547d\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#141-project","text":"# \u547d\u4ee4 project [ - cCs [ - d depth ] [ - p path ] id | name ] - c \u68c0\u67e5\u6811\u7684\u8bbe\u7f6e - s \u521d\u59cb\u5316\u8bbe\u7f6e\u6811 - C \u9012\u5f52\u5730\u6e05\u9664\u9650\u5236 - d \u9650\u5236\u9012\u5f52\u5c42\u7ea7\u3002 - 1 \u662f\u65e0\u9650\u7684\uff0c 0 \u662f\u9876\u5c42\u7684\uff0c 1 \u662f\u7b2c\u4e00\u7ea7\uff0c \u4ee5\u6b64\u7c7b\u63a8 ... - p \u5728\u547d\u4ee4\u884c\u6307\u5b9a project \u7684\u8def\u5f84\uff0c\u800c\u4e0d\u662f\u901a\u8fc7 / etc / projects \u6587\u4ef6\u3002\u4f46\u4e5f\u4f1a\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6 \u7531\u4e8egrpquota\u4e0eprjquota\u4e0d\u80fd\u540c\u65f6\u5b58\u5728\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5378\u8f7d\u518d\u91cd\u65b0\u6302\u8f7d\u3002 [ root@dev ~ ] # umount /dev/sdb [ root@dev ~ ] # vi /etc/fstab /dev/sdb /tmp/disk-sdb xfs defaults,usrquota,prjquota 0 0 [ root@dev ~ ] # mount -a [ sink@dev tmp ] $ xfs_quota -x -c \"state\" User quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #67 (2 blocks, 2 extents) Group quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON Enforcement: ON Inode: #68 (2 blocks, 2 extents) Blocks grace time: [ 3 days ] Inodes grace time: [ 7 days ] Realtime Blocks grace time: [ 7 days ] project\u7684\u9650\u5236\u9700\u8981\u7528\u5230\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\uff1a / etc / projects Mapping of numeric project identifiers to directories trees . / etc / projid Mapping of numeric project identifiers to project names . # id\u3001project-name\u90fd\u662f\u81ea\u5df1\u6307\u5b9a [ root@dev ~ ] # echo 1:/tmp/disk-sdb/quota-test >> /etc/projects [ root@dev ~ ] # echo quota-test-files:1 >> /etc/projid # \u521d\u59cb\u5316 [ root@dev ~ ] # xfs_quota -x -c \"project -s quota-test-files\" /tmp/disk-sdb/ Setting up project quota-test-files ( path /tmp/disk-sdb/quota-test ) ... Processed 1 ( /etc/projects and cmdline ) paths for project quota-test-files with recursion depth infinite ( -1 ) . [ root@dev ~ ] # xfs_quota -x -c \"limit -p bsoft=2M bhard=10M 1\" /tmp/disk-sdb/ [ root@dev ~ ] # xfs_quota -x -c \"report -p -h\" /tmp/disk-sdb/ Project quota on /tmp/disk-sdb ( /dev/sdb ) Blocks Project ID Used Soft Hard Warn/Grace ---------- --------------------------------- #0 0 0 0 00 [------] quota-test-files 30M 2M 10M 00 [ -none- ] # \u53ef\u4ee5\u770b\u5230 /tmp/disk-sdb/quota-test \u5df2\u7ecf\u8d85\u51fa\u9650\u5236\u4e86 [ root@dev ~ ] # xfs_quota -x -c \"df -h\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 62 .2M 1 .9G 3 % /tmp/disk-sdb /dev/sdb 2M 30M 8192 .0E 1500 % /tmp/disk-sdb/quota-test # \u68c0\u67e5\u6811\u7684\u8bbe\u7f6e # \u5df2\u8bbe\u7f6e [ root@dev ~ ] # xfs_quota -x -c \"project -c 1\" /tmp/disk-sdb/ Checking project 1 ( path /tmp/disk-sdb/quota-test ) ... Processed 1 ( /etc/projects and cmdline ) paths for project 1 with recursion depth infinite ( -1 ) . # \u672a\u8bbe\u7f6e [ root@dev ~ ] # xfs_quota -x -c \"project -c 2\" /tmp/disk-sdb/ Processed 0 ( /etc/projects and cmdline ) paths for project 2 with recursion depth infinite ( -1 ) . # \u76f4\u63a5\u5728\u547d\u4ee4\u884c\u914d\u7f6e\u6811\uff0c\u4f46\u662f\u8bb8\u591a\u547d\u4ee4\u90fd\u68c0\u6d4b\u4e0d\u5230 [ root@dev ~ ] # xfs_quota -x -c 'project -s -p /tmp/disk-sdb/quota-test2 3' /tmp/disk-sdb/ [ root@dev disk-sdb ] # xfs_quota -x -c \"limit -p bhard=30M 3\" /tmp/disk-sdb/ [ root@dev quota-test2 ] # cp qu1-f qu1-f-1 cp: error writing \u2018qu1-f-1\u2019: No space left on device cp: failed to extend \u2018qu1-f-1\u2019: No space left on device [ root@dev quota-test2 ] # ll -h total 30M -rw-r--r--. 1 root root 20M Oct 23 10 :29 qu1-f -rw-r--r--. 1 root root 10M Oct 23 10 :29 qu1-f-1 # \u68c0\u6d4b [ root@dev quota-test2 ] # xfs_quota -x -c \"df -bh\" /tmp/disk-sdb/ Filesystem Size Used Avail Use% Pathname /dev/sdb 2 .0G 92 .4M 1 .9G 5 % /tmp/disk-sdb /dev/sdb 2M 30M 8192 .0E 1500 % /tmp/disk-sdb/quota-test [ root@dev quota-test2 ] # xfs_quota -x -c \"print\" /tmp/disk-sdb/ Filesystem Pathname /tmp/disk-sdb /dev/sdb ( uquota, pquota ) /tmp/disk-sdb/quota-test /dev/sdb ( project 1 , quota-test-files ) [ root@dev quota-test2 ] # xfs_quota -x -c \"project -c 3\" /tmp/disk-sdb/ Processed 0 ( /etc/projects and cmdline ) paths for project 3 with recursion depth infinite ( -1 ) . # \u5fc5\u987b\u6307\u5b9a\u8def\u5f84\u624d\u53ef [ root@dev quota-test2 ] # xfs_quota -x -c \"project -c -p /tmp/disk-sdb/quota-test2 3\" /tmp/disk-sdb/ Checking project 3 ( path /tmp/disk-sdb/quota-test2 ) ... Processed 1 ( /etc/projects and cmdline ) paths for project 3 with recursion depth infinite ( -1 ) .","title":"1.4.1 project\u7684\u9650\u5236\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#15","text":"disable [ - gpu ] [ - v ] \u6682\u65f6\u5173\u95ed quota \u7684\u9650\u5236 enable [ - gpu ] [ - v ] \u6253\u5f00 quota \u7684\u9650\u5236 off [ - gpu ] [ - v ] \u6c38\u4e45\u5173\u95ed quota \u7684\u9650\u5236\u3002\u53ea\u80fd umount\u4e4b\u540e\u518d\u6b21mount\u6062\u590d remove [ - gpu ] [ - v ] \u5220\u9664 quota \u7684\u9650\u5236\u3002\u53ea\u80fd\u5728 off \u72b6\u6001\u4e0b\u6267\u884c # \u6682\u65f6\u5173\u95ed [ root@dev tmp ] # xfs_quota -x -c \"disable -p\" /tmp/disk-sdb [ root@dev tmp ] # xfs_quota -x -c \"state\" /tmp/disk-sdb \u2026\u2026 Project quota state on /tmp/disk-sdb ( /dev/sdb ) Accounting: ON # \u8fd9\u91cc\u662f\u5173\u95ed\u72b6\u6001 Enforcement: OFF Inode: #68 (2 blocks, 2 extents) \u2026\u2026 # \u5f7b\u5e95\u5173\u95ed [ root@dev tmp ] # xfs_quota -x -c \"off -p\" /tmp/disk-sdb [ root@dev tmp ] # xfs_quota -x -c \"state\" /tmp/disk-sdb \u2026\u2026 Project quota state on /tmp/disk-sdb ( /dev/sdb ) # \u5168\u90e8\u662f\u5173\u95ed\u72b6\u6001 Accounting: OFF Enforcement: OFF Inode: #68 (2 blocks, 2 extents) \u2026\u2026 # \u62a5\u544a\u4e5f\u6ca1\u6709\u4efb\u4f55\u7ed3\u679c [ root@dev tmp ] # xfs_quota -x -c \"report -pbh\" /tmp/disk-sdb # \u6b64\u65f6\u518d\u5220\u9664\u7b56\u7565\uff0c\u7ed3\u679c\u5c45\u7136\u62a5\u9519\uff0c\u800c\u4e14id\u5220\u4e0d\u6389\uff01\uff01\uff01\uff0c\u771f\u662f\u6298\u78e8\uff01\uff01\uff01 FIXME [ root@dev tmp ] # xfs_quota -x -c 'remove -p' /tmp/disk-sdb XFS_QUOTARM: Invalid argument","title":"1.5 \u53d6\u6d88\u9650\u5236\u547d\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#2-xfsext","text":"\u8bbe\u7f6e\u6d41\u7a0b\u9879\u76ee XFS \u6587\u4ef6\u7cfb\u7edf EXT \u5bb6\u65cf /etc/fstab\u53c2\u6570\u8bbe\u7f6e usrquota/grpquota/prjquota usrquota/grpquota quota \u914d\u7f6e\u6587\u4ef6 \u65e0 quotacheck \u8bbe\u7f6e\u7528\u6237/\u7fa4\u7ec4\u9650\u5236\u503c xfs_quota -x -c \"limit -u -g ...\" edquota \u6216 setquota \u8bbe\u7f6e grace time xfs_quota -x -c \"timer...\" edquota \u8bbe\u7f6e\u76ee\u5f55\u9650\u5236\u503c xfs_quota -x -c \"limit -p ...\" \u65e0 \u89c2\u5bdf\u62a5\u544a xfs_quota -x -c \"report...\" repquota \u6216 quota \u542f \u52a8\u4e0e \u5173\u95ed quota \u9650\u5236 xfs_quota -x -c \"[disable|enable]...\" quotaoff, quotaon \u53d1\u9001\u8b66\u544a\u4fe1\u7ed9\u7528 \u6237 \u76ee \u524d\u7248\u672c\u5c1a\u672a\u652f\u6301 warnquota \u5b9e\u9645\u4e0a\uff0c\u540e\u8005\u7684\u547d\u4ee4\u5bf9\u4e8equota\u7684\u9650\u5236\u51e0\u4e4e\u662f\u5bf9\u6240\u6709\u7684FS\u90fd\u662f\u901a\u7528\u7684\u3002\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5\uff1ahttps://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/ch-disk-quotas","title":"2. XFS\u4e0eEXT\u5bf9\u6bd4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/14 quota/#3-quota","text":"\u8be5\u505a\u6cd5\u7684\u524d\u63d0\u662f\u6709\u72ec\u7acb\u7684\u5206\u533a\uff0c\u6bd4\u5982 /home\u3002 \u60c5\u666f\uff1a\u82e5\u67d0\u4e00\u76ee\u5f55\u5728\u89c4\u5212\u7684\u65f6\u5019\u5e76\u672a\u8003\u8651\u5bf9\u5176\u505a\u51fa\u9650\u5236\uff0c\u540e\u6765\u53c8\u60f3\u5bf9\u5176\u8bbe\u7f6e quota\u3002 \u89e3\u51b3\u65b9\u6cd5\u662f\u5c06\u8be5\u76ee\u5f55\u79fb\u52a8\u5230\u8bbe\u7f6e\u4e86 quota \u7684\u72ec\u7acb\u5206\u533a\u4e0b\uff0c\u7136\u540e\u505a\u4e00\u4e2a\u8f6f\u94fe\u63a5\uff0c\u518d\u5bf9\u72ec\u7acb\u5206\u533a\u8fdb\u884c\u914d\u7f6e\u3002 Note \u5728\u79fb\u52a8\u76ee\u5f55\u7684\u65f6\u5019\u53ef\u80fd\u9700\u8981\u66f4\u6539 SELinux\u3002","title":"3. \u4e0d\u6539\u53d8\u73b0\u6709\u7684 quota \u60c5\u51b5\u4e0b\u5bf9\u5176\u5b83\u8def\u5f84\u6dfb\u52a0\u9650\u5236"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/","text":"RAID\uff1aRedundant Arrays of Inexpensive Disks\uff0c\u5ec9\u4ef7\u78c1\u76d8\u7684\u5197\u4f59\u9635\u5217\uff0c\u53ef\u901a\u8fc7\u786c\u4ef6\u6216\u8f6f\u4ef6\u5b9e\u73b0\u3002 1. \u7c7b\u578b \u00b6 redhat \u4ecb\u7ecd \u3002 1.1 RAID-0 \u00b6 \u4e5f\u88ab\u79f0\u4e3a\u201c\u6761\u5e26\u5316\u201d\uff08 striping \uff09\u3002 \u8fd9\u79cd\u6a21\u5f0f\u7684 RAID \u4f1a\u5c06\u78c1\u76d8\u5148\u5207\u51fa \u7b49\u91cf\u7684\u533a\u5757\uff08\u540d\u4e3a chunk\uff0c \u4e00\u822c\u53ef\u8bbe\u7f6e 4K~1 M \u4e4b\u95f4 \uff09\uff0c\u7136\u540e\u5f53\u4e00\u4e2a\u6587\u4ef6\u8981\u5199 \u5165 RAID \u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u4f9d\u636e chunk \u7684\u5927\u5c0f\u5207\u5272\u597d\uff0c\u4e4b\u540e\u518d\u4f9d\u5e8f\u653e\u5230\u5404\u4e2a\u78c1\u76d8\u91cc\u9762\u53bb\uff0c\u6240\u4ee5\u6bcf\u4e2a\u78c1\u76d8\u6240\u5b58\u50a8\u7684\u6bcf\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u91cf\u90fd\u662f\u76f8\u540c\u7684\uff08\u5728\u6bcf\u4e2a\u78c1\u76d8\u5bb9\u91cf\u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff09\u3002 \u4ee5\u8f83\u4f4e\u7684\u56fa\u6709\u6210\u672c\u5b9e\u73b0\u4e86\u8f83\u9ad8\u7684 I/O \u6027\u80fd\uff0c\u4f46\u6ca1\u6709\u63d0\u4f9b\u5197\u4f59\u3002\u5982\u679c\u4f7f\u7528\u76f8\u540c\u578b\u53f7\u4e0e\u5bb9\u91cf\u7684\u78c1\u76d8\u6765\u7ec4\u6210\u65f6\uff0c\u6548\u679c\u8f83\u4f73\u3002\u4e0d\u5141\u8bb8\u4e22\u5931\u78c1\u76d8\u3002 1.2 RAID-1 \u00b6 \u201c\u955c\u50cf\u5316\u201d\uff08mirroring\uff09\u3002\u5c06\u6570\u636e\u5728\u6bcf\u4e2a\u78c1\u76d8\u4e0a\u90fd\u5b8c\u6574\u7684\u5b58\u50a8\u4e00\u4efd\u3002 \u63d0\u4f9b\u4e86\u5f88\u597d\u7684\u6570\u636e\u53ef\u9760\u6027\uff0c\u5e76\u63d0\u9ad8\u4e86\u8bfb\u53d6\u5bc6\u96c6\u578b\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u4f46\u5199\u5165\u6027\u80fd\u5dee\uff0c\u6210\u672c\u8f83\u9ad8\u3002\u53ef\u4ee5\u4e22\u5931\u5230\u53ea\u5269\u4e00\u4e2a\u78c1\u76d8\u3002 1.3 RAID-4 \u00b6 \u7ea7\u522b4\u4f7f\u7528\u96c6\u4e2d\u5728\u5355\u4e2a\u78c1\u76d8\u4e0a\u7684\u5947\u5076\u6821\u9a8c\u4fdd\u62a4\u6570\u636e\u3002\u7531\u4e8e\u4e13\u7528\u7684\u5947\u5076\u6821\u9a8c\u78c1\u76d8\u51b3\u5b9a\u4e86\u5bf9RAID\u9635\u5217\u7684\u6240\u6709\u5199\u5165\u4e8b\u52a1\u7684\u56fa\u6709\u74f6\u9888\uff0c\u6240\u4ee5\u5f88\u5c11\u4f7f\u7528\u3002 RAID 4\u9635\u5217\u7684\u6027\u80fd\u59cb\u7ec8\u662f\u4e0d\u5bf9\u79f0\u7684\uff0c\u8fd9\u610f\u5473\u7740\u8bfb\u53d6\u5c06\u80dc\u8fc7\u5199\u5165\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e00\u4e2a\u975e\u5947\u5076\u6821\u9a8c\u78c1\u76d8\u3002 1.4 RAID-5 \u00b6 \u6700\u5e38\u89c1\u7684RAID\u7c7b\u578b\u3002\u901a\u8fc7\u5728\u9635\u5217\u7684\u6240\u6709\u6210\u5458\u78c1\u76d8\u4e0a\u5206\u914d\u5947\u5076\u6821\u9a8c\uff0cRAID 5\u6d88\u9664\u4e864\u7ea7\u56fa\u6709\u7684\u5199\u74f6\u9888\u3002\u552f\u4e00\u7684\u6027\u80fd\u74f6\u9888\u662f\u5947\u5076\u6821\u9a8c\u8ba1\u7b97\u8fc7\u7a0b\u672c\u8eab\uff0c\u4f46\u5bf9\u4e8e\u73b0\u4ee3CPU\u548c\u8f6f\u4ef6RAID\u800c\u8a00\u8fd9\u6839\u672c\u7b97\u4e0d\u4e0a\u74f6\u9888\u3002\u4f46\u5982\u679c\u78c1\u76d8\u6570\u91cf\u592a\u591a\uff0c\u4e5f\u4f1a\u5f71\u54cd\u901f\u5ea6\u3002 \u4e0e\u7ea7\u522b4\u4e00\u6837\uff0c\u7ea7\u522b5\u5177\u6709\u975e\u5bf9\u79f0\u6027\u80fd\uff0c\u8bfb\u53d6\u64cd\u4f5c\u660e\u663e\u4f18\u4e8e\u5199\u5165\u64cd\u4f5c\u3002RAID\u7ea7\u522b5\u7684\u5b58\u50a8\u5bb9\u91cf\u7684\u8ba1\u7b97\u65b9\u6cd5\u4e0e\u7ea7\u522b4\u76f8\u540c\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e00\u4e2a\u78c1\u76d8\u3002 1.5 RAID-6 \u00b6 \u5f53\u6570\u636e\u5197\u4f59\u548c\u4fdd\u62a4\u800c\u975e\u6027\u80fd\u662f\u6700\u91cd\u8981\u7684\u8003\u8651\u56e0\u7d20\uff0c\u4f46\u4e0d\u80fd\u63a5\u53d7\u7ea7\u522b1\u4f4e\u4e0b\u7684\u7a7a\u95f4\u6548\u7387\u65f6\uff0c\u8fd9\u662fRAID\u7684\u5e38\u89c1\u7ea7\u522b\u3002\u7ea7\u522b6\u4f7f\u7528\u590d\u6742\u7684\u5947\u5076\u6821\u9a8c\u65b9\u6848\uff0c\u80fd\u591f\u4ece\u9635\u5217\u4e2d\u4efb\u4f55\u4e24\u4e2a\u78c1\u76d8\u4e22\u5931\u4e2d\u6062\u590d\u3002\u8fd9\u79cd\u590d\u6742\u7684\u5947\u5076\u6821\u9a8c\u65b9\u6848\u5728\u8f6f\u4ef6RAID\u8bbe\u5907\u4e0a\u663e\u7740\u589e\u52a0\u4e86CPU\u8d1f\u62c5\uff0c\u5e76\u4e14\u5728\u5199\u5165\u4e8b\u52a1\u671f\u95f4\u4e5f\u589e\u52a0\u4e86\u8d1f\u62c5\u3002 RAID\u7ea7\u522b6\u9635\u5217\u7684\u603b\u5bb9\u91cf\u7684\u8ba1\u7b97\u65b9\u6cd5\u7c7b\u4f3c\u4e8eRAID\u7ea7\u522b5\u548c4\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u5fc5\u987b\u4e3a\u989d\u5916\u7684\u5947\u5076\u6821\u9a8c\u5b58\u50a8\u7a7a\u95f4\u4ece\u8bbe\u5907\u6570\u4e2d\u51cf\u53bb2\u4e2a\u8bbe\u5907\uff08\u800c\u4e0d\u662f1\u4e2a\uff09\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e24\u4e2a\u78c1\u76d8\u3002 1.6 RAID-10\uff0cRAID-01 \u00b6 \u6b64RAID\u7ea7\u522b\u5c06\u7ea7\u522b0\u7684\u6027\u80fd\u4f18\u52bf\u4e0e\u7ea7\u522b1\u7684\u5197\u4f59\u76f8\u7ed3\u5408\u3002 RAID-10 \u662f\u6307\u5148\u5c06\u78c1\u76d8\u7ec4\u6210\u5404\u81ea\u7684RAID-1\u5197\u4f59\u9635\u5217\uff0c\u518d\u5c06\u6bcf\u4e2a\u5197\u4f59\u9635\u5217\u4f5c\u4e3a\u4e00\u4e2a\u78c1\u76d8\u7ec4\u6210RAID-0\u9635\u5217\uff0c\u662f\u6700\u63a8\u8350\u7684\u5b58\u50a8\u65b9\u5f0f\u3002RAID-01\u5219\u521a\u597d\u76f8\u53cd\u3002 \u63d0\u9ad8\u4e86\u7a7a\u95f4\u5229\u7528\u7387\u4e0e\u8bfb\u5199\u6027\u80fd\u3002 1.7 Spare Disk \u00b6 \u78c1\u76d8\u9635\u5217\u4e2d\u7684\u78c1\u76d8\u574f\u6389\u65f6\uff0c\u9700\u8981 \u624b\u52a8 \u7684\u66f4\u6362\u65b0\u78c1\u76d8\uff0c\u7136\u540e\u9635\u5217\u4f1a\u4e3b\u52a8\u7684rebuild\u6570\u636e\u5230\u65b0\u78c1\u76d8\u4e0a\u3002\u5982\u679c\u7cfb\u7edf\u4e0d\u652f\u6301\u70ed\u63d2\u62d4\uff0c\u8fd8\u9700\u8981\u5173\u673a\u624d\u80fd\u66f4\u6362\u78c1\u76d8\u3002 Spare Disk\uff08\u5907\u7528\u78c1\u76d8\uff09\u7684\u4f5c\u7528\u5c31\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u6ca1\u6709\u5728\u9635\u5217\u4e2d\u7684\u78c1\u76d8\uff0c\u5728\u9635\u5217\u4e2d\u7684\u78c1\u76d8\u6709\u635f\u574f\u65f6\uff0c\u81ea\u52a8\u5730\u5c06\u635f\u574f\u78c1\u76d8\u66f4\u6362\u4e3a\u5907\u7528\u78c1\u76d8\uff0c\u5c06\u635f\u574f\u7684\u78c1\u76d8\u79fb\u9664\u9635\u5217\uff0c\u7acb\u5373rebuild\u6570\u636e\u7cfb\u7edf\u3002\u82e5OS\u652f\u6301\u70ed\u63d2\u62d4\uff0c\u90a3\u4e48\u5c06\u635f\u574f\u7684\u62d4\u51fa\uff0c\u66f4\u6362\u4e00\u5757\u65b0\u7684\u78c1\u76d8\uff0c\u518d\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u5907\u7528\u78c1\u76d8\uff0c\u7b80\u76f4\u5b8c\u7f8e\uff01 1.8 \u5404\u7b49\u7ea7RAID\u5bf9\u6bd4 \u00b6 2. \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217\u4e0e\u786c\u4ef6\u78c1\u76d8\u9635\u5217 \u00b6 \u786c\u4ef6\u7ec4\u6210\u78c1\u76d8\u9635\u5217\u9700\u8981\u78c1\u76d8\u9635\u5217\u5361\u5b9e\u73b0\u3002\u4f18\u70b9\uff1a\u5361\u4e0a\u9762\u6709\u4e13\u95e8\u7684\u82af\u7247\u5904\u7406RAID\u4efb\u52a1\uff0c\u6240\u4ee5\u5f88\u591a\u4efb\u52a1\uff08\u5947\u5076\u6821\u9a8c\u7684\u8fd0\u7b97\uff09\u4e0d\u4f1a\u6d88\u8017OS\u7684I/O\u603b\u7ebf\u3002\u9ad8\u7ea7\u7684\u9635\u5217\u5361\u8fd8\u652f\u6301\u70ed\u63d2\u62d4\u3002\u7f3a\u70b9\uff1a\u5f88\u8d35\uff1b\u4f4e\u9636\u4e3b\u677f\u7684\u9635\u5217\u82af\u7247\u4e0d\u652f\u6301\u9ad8\u9636\u529f\u80fd\uff1bOS\u5fc5\u987b\u6709\u9635\u5217\u5361\u7684\u9a71\u52a8\uff0c\u624d\u80fd\u8bc6\u522b\u6240\u4ea7\u751f\u7684\u78c1\u76d8\u3002 \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217\u901a\u8fc7\u8f6f\u4ef6\u6765\u4eff\u771f\u9635\u5217\uff0ccentos\u4f7f\u7528\u7684\u662f mdadm \uff0c\u652f\u6301partition\u6216disk\u4e3a\u78c1\u76d8\u5355\u4f4d\uff0c\u652f\u6301\u70ed\u63d2\u62d4\u3002 Note \u786c\u4ef6\u78c1\u76d8\u9635\u5217\u5728linux\u7684\u8bbe\u5907\u540d\u662f /dev/sd? \uff1b\u8f6f\u4ef6\u4eff\u771f\u7684\u5219\u662f /dev/md? \u3002Intel \u7684\u5357\u6865\u82af\u7247\u78c1\u76d8\u9635\u5217\uff0c\u5728 Linux \u4e0b\u9762\u53cd\u800c\u4f1a\u662f /dev/md126, /dev/md127 \u7b49\u7b49\u8bbe\u5907\u6587\u4ef6\u540d\u3002 2.1 Firmware RAID \u00b6 \u56fa\u4ef6 RAID \u4e5f\u79f0\u4e3a ATARAID\uff0c\u662f\u4e00\u79cd\u8f6f\u4ef6 RAID\uff0c\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u56fa\u4ef6\u7684\u83dc\u5355\u914d\u7f6e RAID \u96c6\u3002\u8fd9\u79cd\u7c7b\u578b\u7684 RAID \u4f7f\u7528\u7684\u56fa\u4ef6\u4e5f\u6302\u94a9\u5230 BIOS \u4e2d\uff0c\u5141\u8bb8\u60a8\u4ece\u5176 RAID \u96c6\u542f\u52a8\u3002\u4e0d\u540c\u7684\u4f9b\u5e94\u5546\u4f7f\u7528\u4e0d\u540c\u7684\u78c1\u76d8\u5143\u6570\u636e\u683c\u5f0f\u6765\u6807\u8bb0 RAID \u96c6\u6210\u5458\u3002 2.2 \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217 \u00b6 mdadm [ mode ] < raiddevice > [ options ] < component - devices > \u7ba1\u7406 MD \u8bbe\u5907\uff08\u53c8\u540d Linux \u8f6f\u4ef6 RAID \uff09 OPTIONS Options for selecting a mode are ( \u610f\u601d\u662f\u4f7f\u7528\u4e86\u54ea\u4e9b\u7279\u5b9a\u7684\u9009\u9879\u5c31\u5904\u4e8e\u7279\u5b9a\u7684\u6a21\u5f0f\u4e0b ) : - B , -- build Build a legacy array without superblocks .\u6784\u9020\u6a21\u5f0f - C , -- create Create a new array .\u521b\u5efa\u6a21\u5f0f - F , -- follow , -- monitor Select Monitor mode . - I , -- incremental Add / remove a single device to / from an appropriate array , and possibly start the array . -- add , -- re - add , -- add - spare , -- fail , -- remove , or -- replace MANAGE mode \u3002\u7ba1\u7406\u6a21\u5f0f For create , build , or grow : - n , -- raid - devices = Specify the number of active devices in the array . This number can only be changed using -- grow for RAID1 , RAID4 , RAID5 and RAID6 arrays - x , -- spare - devices = Specify the number of spare ( eXtra ) devices in the initial array .\u9884\u5907\u78c1\u76d8\u4e0e\u9635\u5217\u78c1\u76d8\u7684\u6570\u91cf\u52a0\u8d77\u6765\u5fc5\u987b\u7b49\u4e8e\u5217\u51fa\u7684\u8bbe\u5907\u7684\u6570\u91cf - c , -- chunk = Specify chunk size of kilobytes \uff0c\u9ed8\u8ba4 512 KB \u3002\u8be5\u503c\u5fc5\u987b\u662f 4 KB \u7684\u500d\u6570\u3002 RAID4 , RAID5 , RAID6 , and RAID10 \u8fd8\u8981\u6c42\u5fc5\u987b\u662f 2 \u7684 n \u6b21\u5e42\u3002\u5176\u4ed6\u5355\u4f4d\uff1a ' K ' , ' M ' or ' G ' . - l , -- level = Set RAID level . - a , -- auto { = yes , md , mdp , part , p }{ NN } \u6307\u793a\u9700\u8981\u521b\u5efa\u8bbe\u5907\u65f6\u5982\u4f55\u521b\u5efa\u3002\u5bf9\u4e8e\u53ef\u5206\u533a\u6570\u7ec4\uff0c mdadm \u5c06\u4e3a\u6574\u4e2a\u9635\u5217\u548c\u524d 4 \u4e2a\u5206\u533a\u521b\u5efa\u8bbe\u5907\u6587\u4ef6\uff1b\u53ef\u4ee5\u5728\u6b64\u9009\u9879\u7684\u672b\u5c3e\u6307\u5b9a\u4e0d\u540c\u6570\u91cf\u7684\u5206\u533a ( e . g . -- auto = p7 ) \u3002 yes \u662f\u9ed8\u8ba4\u503c\u3002\u5404\u503c\u610f\u4e49\u5982\u4e0b\uff1a yes \uff1a\u8981\u6c42\u547d\u540d\u7684 md \u8bbe\u5907\u5177\u6709 \" \u6807\u51c6 \" \u683c\u5f0f ( / dev / mdNN ) \uff0c\u5e76\u4e14\u786e\u5b9a\u7c7b\u578b\u548c\u6b21\u8981\u7f16\u53f7\u3002 md \uff1a\u4f7f\u7528 non - partitionable \u7684\u9635\u5217\uff08\u5c3d\u7ba1\u81ea Linux 2 . 6 . 28 \u4ee5\u6765\uff0c\u8fd9\u4e9b\u9635\u5217\u8bbe\u5907\u5b9e\u9645\u4e0a\u662f\u53ef\u5206\u533a\u7684\uff09 mdp , part , p \uff1a\u4f7f\u7528 partitionable \u7684\u9635\u5217 - z , -- size = Amount ( in Kilobytes ) of space to use from each drive in RAID levels 1 / 4 / 5 / 6 . \u5176\u4ed6\u5355\u4f4d\uff1a ' K ' , ' M ' or ' G ' . For Misc mode : - Q , -- query \u68c0\u67e5\uff1a 1 \u3001\u662f\u5426\u662f\u4e00\u4e2a md \u8bbe\u5907\uff1b 2 \u3001\u662f\u5426\u4e3a\u4e00\u4e2a md \u9635\u5217\u7684\u4e00\u4e2a\u6210\u5458 - D , -- detail Print details of one or more md devices . 2.2.1 \u521b\u5efa\u78c1\u76d8\u9635\u5217 \u00b6 # \u4f7f\u7528 gdisk \u5728 /dev/sdb \u521b\u5efa\u5206\u533a Number Start ( sector ) End ( sector ) Size Code Name 1 2048 206847 100 .0 MiB FD00 Linux RAID 2 206848 411647 100 .0 MiB FD00 Linux RAID 3 411648 616447 100 .0 MiB FD00 Linux RAID 4 616448 821247 100 .0 MiB FD00 Linux RAID 5 821248 1026047 100 .0 MiB FD00 Linux RAID # \u521b\u5efaRAID5\u78c1\u76d8\u9635\u5217\uff0c\u547d\u540d\u4e3a /dev/md0\uff0c\u4f7f\u75284\u4e2a\u5206\u533a\u4f5c\u4e3a\u9635\u5217\u78c1\u76d8\uff0c\u4f7f\u75281\u4e2a\u5206\u533a\u4f5c\u4e3a\u9884\u5907\u78c1\u76d8\uff0cchunck\u5927\u5c0f512KB [ root@dev ~ ] # mdadm -C /dev/md0 -n 4 -x 1 -c 512K -l 5 --auto=yes /dev/sdb1 /dev/sdb2 /dev/sdb3 /dev/sdb4 /dev/sdb5 mdadm: Defaulting to version 1 .2 metadata mdadm: array /dev/md0 started. # \u67e5\u770b\u78c1\u76d8\u9635\u5217 [ root@dev ~ ] # mdadm -D /dev/md0 /dev/md0: Raid Level : raid5 State : clean Array Size : 301056 ( 294 .00 MiB 308 .28 MB ) Used Dev Size : 100352 ( 98 .00 MiB 102 .76 MB ) Active Devices : 4 Working Devices : 5 Failed Devices : 0 Spare Devices : 1 Chunk Size : 512K \u2026\u2026 Number Major Minor RaidDevice State 0 8 17 0 active sync /dev/sdb1 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 4 8 21 - spare /dev/sdb5 # \u901a\u8fc7\u7cfb\u7edf\u72b6\u6001\u67e5\u770b\u78c1\u76d8\u9635\u5217 [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] md0 : active raid5 sdb4 [ 5 ] sdb5 [ 4 ]( S ) sdb3 [ 2 ] sdb2 [ 1 ] sdb1 [ 0 ] 301056 blocks super 1 .2 level 5 , 512k chunk, algorithm 2 [ 4 /4 ] [ UUUU ] # blocks \u5355\u4f4d\u662f1K\uff0c\u5927\u6982\u5c31\u662f294M\uff0c[m/n]\u8868\u793a\u9635\u5217\u9700\u8981m\u4e2a\u8bbe\u5907\uff0c\u73b0\u5728n\u4e2a\u8bbe\u5907\u6b63\u5e38\u8fd0\u884c\uff0c [UUUU]\u8868\u793a\u8bbe\u5907\u8fd0\u884c\u60c5\u51b5\uff0cU\u4ee3\u8868\u6b63\u5e38\uff0c_\u4ee3\u8868\u4e0d\u6b63\u5e38 2.2.2 \u4f7f\u7528\u78c1\u76d8\u9635\u5217 \u00b6 \u4e0e\u666e\u901a\u7684\u78c1\u76d8\u4e00\u6837\uff0c\u9700\u8981\u5148\u683c\u5f0f\u5316\u518d\u6302\u8f7d\u4f7f\u7528\u3002\u4f46\u662f\u4f1a\u6d89\u53ca\u5230FS\u7684\u4f18\u5316\u3002 mkfs . xfs [ options ] device OPTIONS # \u4f18\u5316\u9009\u9879 - d data_section_options data_section_options : su = value specify the stripe unit for a RAID device or a striped logical volume .\u5355\u4f4d\u662f bytes sw = value specify the stripe width for a RAID device or striped logical volume .\u901a\u5e38\u4e0e\u903b\u8f91\u5377\u914d\u7f6e\u4e2d\u7684\u6761\u5e26\u6210\u5458\u6570\u6216 RAID \u8bbe\u5907\u4e2d\u7684\u6570\u636e\u78c1\u76d8\u6570\u76f8\u540c\u3002 - r realtime_section_options realtime_section_options : extsize = value specify the size of the blocks in the real - time section of the filesystem .\u9ed8\u8ba4\u503c\u662f the stripe width for striped volumes or 64 KiB for non - striped volumes \u3002\u6700\u5c0f\u4e3a 4 k \uff0c\u6700\u5927\u4e3a 1 G \u3002 srtipe\uff08chunk\uff09\u5bb9\u91cf\u4e3a 512K\uff0c\u6240\u4ee5 su=512k \u5171\u6709 4 \u9897\u7ec4\u6210 RAID5\uff0c\u56e0\u6b64\u5bb9\u91cf\u5c11\u4e00\u9897\uff0c\u6240\u4ee5 sw=3 \u7531\u4e0a\u9762\u4e24\u9879\u8ba1\u7b97\u51fa\u6570\u636e\u5bbd\u5ea6\u4e3a\uff1a512K*3=1536k [ root@dev ~ ] # mkfs.xfs -d su=512k,sw=3 -r extsize=1536k /dev/md0 [ root@dev ~ ] # mkdir raid1 [ root@dev ~ ] # mount /dev/md0 raid1/ [ root@dev ~ ] # df -hT /dev/md0 Filesystem Type Size Used Avail Use% Mounted on /dev/md0 xfs 292M 16M 277M 6 % /root/raid1 2.2.3 RAID\u9519\u8bef\u4eff\u771f \u00b6 mdadm -- manage < raiddevice > [ options ] < component - devices > OPTIONS For Manage mode : - f , -- fail Mark listed devices as faulty \uff08\u6545\u969c\uff09. - r , -- remove remove listed devices . They must not be active . i . e . they should be failed or spare devices . - a , -- add hot - add listed devices .\u4e0d\u9002\u7528\u4e8e\u975e\u5197\u4f59\u78c1\u76d8\u9635\u5217 RAID0 or Linear # \u624b\u52a8\u6807\u8bb0 sdb1 \u4e3a\u6545\u969c\u78c1\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --fail /dev/sdb1 mdadm: set /dev/sdb1 faulty in /dev/md0 # \u7acb\u5373\u67e5\u770b\u53ef\u4ee5\u770b\u5230\u539f\u5148\u7684\u5907\u4efd\u78c1\u76d8\u5df2\u7ecf\u9876\u66ff\u4e86\u6545\u969c\u78c1\u76d8\uff0c\u6b63\u5728\u8fdb\u884c\u6570\u636e rebuild [ root@dev ~ ] # mdadm -D /dev/md0 \u2026\u2026 Active Devices : 3 Working Devices : 4 Failed Devices : 1 Spare Devices : 1 \u2026\u2026 Rebuild Status : 32 % complete Name : dev:0 ( local to host dev ) UUID : caf10429:ec50770c:ddad512d:93ace6dc Events : 25 Number Major Minor RaidDevice State 4 8 21 0 spare rebuilding /dev/sdb5 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 0 8 17 - faulty /dev/sdb1 # rebuild \u5b8c\u6bd5 [ root@dev ~ ] # mdadm -D /dev/md0 Active Devices : 4 Working Devices : 4 Failed Devices : 1 Spare Devices : 0 \u2026\u2026 Number Major Minor RaidDevice State 4 8 21 0 active sync /dev/sdb5 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 0 8 17 - faulty /dev/sdb1 \u78c1\u76d8\u635f\u574f\u66ff\u6362\u6b65\u9aa4\uff1a \u4ece\u9635\u5217\u4e2d\u79fb\u9664\u635f\u574f\u78c1\u76d8 \u5173\u673a\uff0c\u5c06\u635f\u574f\u7684\u78c1\u76d8\u62d4\u9664\uff0c\u66f4\u6362\u65b0\u7684\u78c1\u76d8\u3002\u652f\u6301\u70ed\u63d2\u62d4\u7684\u7cfb\u7edf\u4e0d\u9700\u8981\u5173\u673a\u3002 \u5f00\u673a\uff0c\u5c06\u65b0\u78c1\u76d8\u52a0\u5165\u9635\u5217 \u4e0b\u9762\u901a\u8fc7\u8f6f\u4ef6\u6a21\u62df\u4e0a\u8ff0\u8fc7\u7a0b\uff1a # \u5220\u9664\u574f\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --remove /dev/sdb1 mdadm: hot removed /dev/sdb1 from /dev/md0 # \u6dfb\u52a0\u65b0\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --add /dev/sdb1 mdadm: added /dev/sdb1 # \u53c8\u6062\u590d\u539f\u6765\u7684\u6837\u5b50\u55bd [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] md0 : active raid5 sdb1 [ 6 ]( S ) sdb4 [ 5 ] sdb5 [ 4 ] sdb3 [ 2 ] sdb2 [ 1 ] 301056 blocks super 1 .2 level 5 , 512k chunk, algorithm 2 [ 4 /4 ] [ UUUU ] 2.2.4 \u5f00\u673a\u81ea\u52a8\u542f\u52a8 RAID \u5e76\u81ea\u52a8\u6302\u8f7d \u00b6 # \u5148\u83b7\u53d6 uuid [ root@dev ~ ] # mdadm -D /dev/md0 | grep -i uuid UUID : caf10429:ec50770c:ddad512d:93ace6dc # \u7f16\u8f91 mdadm \u914d\u7f6e\u6587\u4ef6,\u8ba9\u7cfb\u7edf\u81ea\u52a8\u542f\u52a8 RAID [ root@dev ~ ] # cat /etc/mdadm.conf ARRAY /dev/md0 UUID = caf10429:ec50770c:ddad512d:93ace6dc # \u7f16\u8f91\u6302\u8f7d\u6587\u4ef6 [ root@dev ~ ] # blkid /dev/md0 /dev/md0: UUID = \"a558b7d2-37a2-481f-806e-822781435313\" TYPE = \"xfs\" [ root@dev ~ ] # cat /etc/fstab | grep raid UUID = a558b7d2-37a2-481f-806e-822781435313 /root/raid1 xfs defaults 0 0 2.2.5 \u5173\u95ed\u8f6f\u4ef6 RAID \u00b6 \u786e\u5b9a\u4e0d\u518d\u4f7f\u7528\u9635\u5217\u65f6\uff0c\u9700\u8981\u5173\u95ed\uff0c\u5426\u5219\u5c06\u6765\u518d\u6b21\u91cd\u65b0\u5206\u533a\u65f6\u4f1a\u51fa\u73b0\u4e00\u4e9b\u9519\u8bef\u3002 \u6709\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a # 1. \u5378\u8f7d [ root@dev ~ ] # umount -v /dev/md0 [ root@dev ~ ] # sed -i '/raid/d' /etc/fstab # 2. \u5148\u8986\u76d6 RAID \u7684 metadata \u4e0e XFS \u7684 superblock [ root@dev ~ ] # dd if=/dev/zero of=/dev/md0 bs=1M count=50 50 +0 records in 50 +0 records out 52428800 bytes ( 52 MB ) copied, 1 .48123 s, 35 .4 MB/s # 3. \u518d\u5173\u95ed RAID [ root@dev ~ ] # mdadm --stop /dev/md0 mdadm: stopped /dev/md0 # 4. \u518d\u8986\u76d6\u6389\u5206\u533a\u7684 metadata\u3001superblock\u3002\u56e0\u4e3a RAID \u7684\u76f8\u5173\u6570\u636e\u5176\u5b9e\u4e5f\u4f1a\u5b58\u4e00\u4efd\u5728\u78c1\u76d8\u5f53\u4e2d\uff0c\u82e5\u53ea\u662f\u5173\u95ed\u4e86 RAID\uff0c \u90a3\u4e48\u91cd\u65b0\u5f00\u673a\u8fc7\u540e\uff0c\u7cfb\u7edf\u8fd8\u662f\u4f1a\u5c06\u8fd9\u9897\u78c1\u76d8\u9635\u5217\u521b\u5efa\u8d77\u6765 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb1 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb2 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb3 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb4 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb5 bs=1M count=10 [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] unused devices: <none> # 5. \u5220\u9664\u6216\u6ce8\u89e3 RAID [ root@dev ~ ] # vi /etc/mdadm.conf","title":"15 \u78c1\u76d8\u9635\u5217"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#1","text":"redhat \u4ecb\u7ecd \u3002","title":"1. \u7c7b\u578b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#11-raid-0","text":"\u4e5f\u88ab\u79f0\u4e3a\u201c\u6761\u5e26\u5316\u201d\uff08 striping \uff09\u3002 \u8fd9\u79cd\u6a21\u5f0f\u7684 RAID \u4f1a\u5c06\u78c1\u76d8\u5148\u5207\u51fa \u7b49\u91cf\u7684\u533a\u5757\uff08\u540d\u4e3a chunk\uff0c \u4e00\u822c\u53ef\u8bbe\u7f6e 4K~1 M \u4e4b\u95f4 \uff09\uff0c\u7136\u540e\u5f53\u4e00\u4e2a\u6587\u4ef6\u8981\u5199 \u5165 RAID \u65f6\uff0c\u8be5\u6587\u4ef6\u4f1a\u4f9d\u636e chunk \u7684\u5927\u5c0f\u5207\u5272\u597d\uff0c\u4e4b\u540e\u518d\u4f9d\u5e8f\u653e\u5230\u5404\u4e2a\u78c1\u76d8\u91cc\u9762\u53bb\uff0c\u6240\u4ee5\u6bcf\u4e2a\u78c1\u76d8\u6240\u5b58\u50a8\u7684\u6bcf\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u91cf\u90fd\u662f\u76f8\u540c\u7684\uff08\u5728\u6bcf\u4e2a\u78c1\u76d8\u5bb9\u91cf\u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff09\u3002 \u4ee5\u8f83\u4f4e\u7684\u56fa\u6709\u6210\u672c\u5b9e\u73b0\u4e86\u8f83\u9ad8\u7684 I/O \u6027\u80fd\uff0c\u4f46\u6ca1\u6709\u63d0\u4f9b\u5197\u4f59\u3002\u5982\u679c\u4f7f\u7528\u76f8\u540c\u578b\u53f7\u4e0e\u5bb9\u91cf\u7684\u78c1\u76d8\u6765\u7ec4\u6210\u65f6\uff0c\u6548\u679c\u8f83\u4f73\u3002\u4e0d\u5141\u8bb8\u4e22\u5931\u78c1\u76d8\u3002","title":"1.1 RAID-0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#12-raid-1","text":"\u201c\u955c\u50cf\u5316\u201d\uff08mirroring\uff09\u3002\u5c06\u6570\u636e\u5728\u6bcf\u4e2a\u78c1\u76d8\u4e0a\u90fd\u5b8c\u6574\u7684\u5b58\u50a8\u4e00\u4efd\u3002 \u63d0\u4f9b\u4e86\u5f88\u597d\u7684\u6570\u636e\u53ef\u9760\u6027\uff0c\u5e76\u63d0\u9ad8\u4e86\u8bfb\u53d6\u5bc6\u96c6\u578b\u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u4f46\u5199\u5165\u6027\u80fd\u5dee\uff0c\u6210\u672c\u8f83\u9ad8\u3002\u53ef\u4ee5\u4e22\u5931\u5230\u53ea\u5269\u4e00\u4e2a\u78c1\u76d8\u3002","title":"1.2 RAID-1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#13-raid-4","text":"\u7ea7\u522b4\u4f7f\u7528\u96c6\u4e2d\u5728\u5355\u4e2a\u78c1\u76d8\u4e0a\u7684\u5947\u5076\u6821\u9a8c\u4fdd\u62a4\u6570\u636e\u3002\u7531\u4e8e\u4e13\u7528\u7684\u5947\u5076\u6821\u9a8c\u78c1\u76d8\u51b3\u5b9a\u4e86\u5bf9RAID\u9635\u5217\u7684\u6240\u6709\u5199\u5165\u4e8b\u52a1\u7684\u56fa\u6709\u74f6\u9888\uff0c\u6240\u4ee5\u5f88\u5c11\u4f7f\u7528\u3002 RAID 4\u9635\u5217\u7684\u6027\u80fd\u59cb\u7ec8\u662f\u4e0d\u5bf9\u79f0\u7684\uff0c\u8fd9\u610f\u5473\u7740\u8bfb\u53d6\u5c06\u80dc\u8fc7\u5199\u5165\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e00\u4e2a\u975e\u5947\u5076\u6821\u9a8c\u78c1\u76d8\u3002","title":"1.3 RAID-4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#14-raid-5","text":"\u6700\u5e38\u89c1\u7684RAID\u7c7b\u578b\u3002\u901a\u8fc7\u5728\u9635\u5217\u7684\u6240\u6709\u6210\u5458\u78c1\u76d8\u4e0a\u5206\u914d\u5947\u5076\u6821\u9a8c\uff0cRAID 5\u6d88\u9664\u4e864\u7ea7\u56fa\u6709\u7684\u5199\u74f6\u9888\u3002\u552f\u4e00\u7684\u6027\u80fd\u74f6\u9888\u662f\u5947\u5076\u6821\u9a8c\u8ba1\u7b97\u8fc7\u7a0b\u672c\u8eab\uff0c\u4f46\u5bf9\u4e8e\u73b0\u4ee3CPU\u548c\u8f6f\u4ef6RAID\u800c\u8a00\u8fd9\u6839\u672c\u7b97\u4e0d\u4e0a\u74f6\u9888\u3002\u4f46\u5982\u679c\u78c1\u76d8\u6570\u91cf\u592a\u591a\uff0c\u4e5f\u4f1a\u5f71\u54cd\u901f\u5ea6\u3002 \u4e0e\u7ea7\u522b4\u4e00\u6837\uff0c\u7ea7\u522b5\u5177\u6709\u975e\u5bf9\u79f0\u6027\u80fd\uff0c\u8bfb\u53d6\u64cd\u4f5c\u660e\u663e\u4f18\u4e8e\u5199\u5165\u64cd\u4f5c\u3002RAID\u7ea7\u522b5\u7684\u5b58\u50a8\u5bb9\u91cf\u7684\u8ba1\u7b97\u65b9\u6cd5\u4e0e\u7ea7\u522b4\u76f8\u540c\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e00\u4e2a\u78c1\u76d8\u3002","title":"1.4 RAID-5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#15-raid-6","text":"\u5f53\u6570\u636e\u5197\u4f59\u548c\u4fdd\u62a4\u800c\u975e\u6027\u80fd\u662f\u6700\u91cd\u8981\u7684\u8003\u8651\u56e0\u7d20\uff0c\u4f46\u4e0d\u80fd\u63a5\u53d7\u7ea7\u522b1\u4f4e\u4e0b\u7684\u7a7a\u95f4\u6548\u7387\u65f6\uff0c\u8fd9\u662fRAID\u7684\u5e38\u89c1\u7ea7\u522b\u3002\u7ea7\u522b6\u4f7f\u7528\u590d\u6742\u7684\u5947\u5076\u6821\u9a8c\u65b9\u6848\uff0c\u80fd\u591f\u4ece\u9635\u5217\u4e2d\u4efb\u4f55\u4e24\u4e2a\u78c1\u76d8\u4e22\u5931\u4e2d\u6062\u590d\u3002\u8fd9\u79cd\u590d\u6742\u7684\u5947\u5076\u6821\u9a8c\u65b9\u6848\u5728\u8f6f\u4ef6RAID\u8bbe\u5907\u4e0a\u663e\u7740\u589e\u52a0\u4e86CPU\u8d1f\u62c5\uff0c\u5e76\u4e14\u5728\u5199\u5165\u4e8b\u52a1\u671f\u95f4\u4e5f\u589e\u52a0\u4e86\u8d1f\u62c5\u3002 RAID\u7ea7\u522b6\u9635\u5217\u7684\u603b\u5bb9\u91cf\u7684\u8ba1\u7b97\u65b9\u6cd5\u7c7b\u4f3c\u4e8eRAID\u7ea7\u522b5\u548c4\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u5fc5\u987b\u4e3a\u989d\u5916\u7684\u5947\u5076\u6821\u9a8c\u5b58\u50a8\u7a7a\u95f4\u4ece\u8bbe\u5907\u6570\u4e2d\u51cf\u53bb2\u4e2a\u8bbe\u5907\uff08\u800c\u4e0d\u662f1\u4e2a\uff09\u3002\u53ea\u5141\u8bb8\u4e22\u5931\u4efb\u610f\u4e24\u4e2a\u78c1\u76d8\u3002","title":"1.5 RAID-6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#16-raid-10raid-01","text":"\u6b64RAID\u7ea7\u522b\u5c06\u7ea7\u522b0\u7684\u6027\u80fd\u4f18\u52bf\u4e0e\u7ea7\u522b1\u7684\u5197\u4f59\u76f8\u7ed3\u5408\u3002 RAID-10 \u662f\u6307\u5148\u5c06\u78c1\u76d8\u7ec4\u6210\u5404\u81ea\u7684RAID-1\u5197\u4f59\u9635\u5217\uff0c\u518d\u5c06\u6bcf\u4e2a\u5197\u4f59\u9635\u5217\u4f5c\u4e3a\u4e00\u4e2a\u78c1\u76d8\u7ec4\u6210RAID-0\u9635\u5217\uff0c\u662f\u6700\u63a8\u8350\u7684\u5b58\u50a8\u65b9\u5f0f\u3002RAID-01\u5219\u521a\u597d\u76f8\u53cd\u3002 \u63d0\u9ad8\u4e86\u7a7a\u95f4\u5229\u7528\u7387\u4e0e\u8bfb\u5199\u6027\u80fd\u3002","title":"1.6 RAID-10\uff0cRAID-01"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#17-spare-disk","text":"\u78c1\u76d8\u9635\u5217\u4e2d\u7684\u78c1\u76d8\u574f\u6389\u65f6\uff0c\u9700\u8981 \u624b\u52a8 \u7684\u66f4\u6362\u65b0\u78c1\u76d8\uff0c\u7136\u540e\u9635\u5217\u4f1a\u4e3b\u52a8\u7684rebuild\u6570\u636e\u5230\u65b0\u78c1\u76d8\u4e0a\u3002\u5982\u679c\u7cfb\u7edf\u4e0d\u652f\u6301\u70ed\u63d2\u62d4\uff0c\u8fd8\u9700\u8981\u5173\u673a\u624d\u80fd\u66f4\u6362\u78c1\u76d8\u3002 Spare Disk\uff08\u5907\u7528\u78c1\u76d8\uff09\u7684\u4f5c\u7528\u5c31\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u6ca1\u6709\u5728\u9635\u5217\u4e2d\u7684\u78c1\u76d8\uff0c\u5728\u9635\u5217\u4e2d\u7684\u78c1\u76d8\u6709\u635f\u574f\u65f6\uff0c\u81ea\u52a8\u5730\u5c06\u635f\u574f\u78c1\u76d8\u66f4\u6362\u4e3a\u5907\u7528\u78c1\u76d8\uff0c\u5c06\u635f\u574f\u7684\u78c1\u76d8\u79fb\u9664\u9635\u5217\uff0c\u7acb\u5373rebuild\u6570\u636e\u7cfb\u7edf\u3002\u82e5OS\u652f\u6301\u70ed\u63d2\u62d4\uff0c\u90a3\u4e48\u5c06\u635f\u574f\u7684\u62d4\u51fa\uff0c\u66f4\u6362\u4e00\u5757\u65b0\u7684\u78c1\u76d8\uff0c\u518d\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u5907\u7528\u78c1\u76d8\uff0c\u7b80\u76f4\u5b8c\u7f8e\uff01","title":"1.7 Spare Disk"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#18-raid","text":"","title":"1.8 \u5404\u7b49\u7ea7RAID\u5bf9\u6bd4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#2","text":"\u786c\u4ef6\u7ec4\u6210\u78c1\u76d8\u9635\u5217\u9700\u8981\u78c1\u76d8\u9635\u5217\u5361\u5b9e\u73b0\u3002\u4f18\u70b9\uff1a\u5361\u4e0a\u9762\u6709\u4e13\u95e8\u7684\u82af\u7247\u5904\u7406RAID\u4efb\u52a1\uff0c\u6240\u4ee5\u5f88\u591a\u4efb\u52a1\uff08\u5947\u5076\u6821\u9a8c\u7684\u8fd0\u7b97\uff09\u4e0d\u4f1a\u6d88\u8017OS\u7684I/O\u603b\u7ebf\u3002\u9ad8\u7ea7\u7684\u9635\u5217\u5361\u8fd8\u652f\u6301\u70ed\u63d2\u62d4\u3002\u7f3a\u70b9\uff1a\u5f88\u8d35\uff1b\u4f4e\u9636\u4e3b\u677f\u7684\u9635\u5217\u82af\u7247\u4e0d\u652f\u6301\u9ad8\u9636\u529f\u80fd\uff1bOS\u5fc5\u987b\u6709\u9635\u5217\u5361\u7684\u9a71\u52a8\uff0c\u624d\u80fd\u8bc6\u522b\u6240\u4ea7\u751f\u7684\u78c1\u76d8\u3002 \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217\u901a\u8fc7\u8f6f\u4ef6\u6765\u4eff\u771f\u9635\u5217\uff0ccentos\u4f7f\u7528\u7684\u662f mdadm \uff0c\u652f\u6301partition\u6216disk\u4e3a\u78c1\u76d8\u5355\u4f4d\uff0c\u652f\u6301\u70ed\u63d2\u62d4\u3002 Note \u786c\u4ef6\u78c1\u76d8\u9635\u5217\u5728linux\u7684\u8bbe\u5907\u540d\u662f /dev/sd? \uff1b\u8f6f\u4ef6\u4eff\u771f\u7684\u5219\u662f /dev/md? \u3002Intel \u7684\u5357\u6865\u82af\u7247\u78c1\u76d8\u9635\u5217\uff0c\u5728 Linux \u4e0b\u9762\u53cd\u800c\u4f1a\u662f /dev/md126, /dev/md127 \u7b49\u7b49\u8bbe\u5907\u6587\u4ef6\u540d\u3002","title":"2. \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217\u4e0e\u786c\u4ef6\u78c1\u76d8\u9635\u5217"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#21-firmware-raid","text":"\u56fa\u4ef6 RAID \u4e5f\u79f0\u4e3a ATARAID\uff0c\u662f\u4e00\u79cd\u8f6f\u4ef6 RAID\uff0c\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u56fa\u4ef6\u7684\u83dc\u5355\u914d\u7f6e RAID \u96c6\u3002\u8fd9\u79cd\u7c7b\u578b\u7684 RAID \u4f7f\u7528\u7684\u56fa\u4ef6\u4e5f\u6302\u94a9\u5230 BIOS \u4e2d\uff0c\u5141\u8bb8\u60a8\u4ece\u5176 RAID \u96c6\u542f\u52a8\u3002\u4e0d\u540c\u7684\u4f9b\u5e94\u5546\u4f7f\u7528\u4e0d\u540c\u7684\u78c1\u76d8\u5143\u6570\u636e\u683c\u5f0f\u6765\u6807\u8bb0 RAID \u96c6\u6210\u5458\u3002","title":"2.1 Firmware RAID"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#22","text":"mdadm [ mode ] < raiddevice > [ options ] < component - devices > \u7ba1\u7406 MD \u8bbe\u5907\uff08\u53c8\u540d Linux \u8f6f\u4ef6 RAID \uff09 OPTIONS Options for selecting a mode are ( \u610f\u601d\u662f\u4f7f\u7528\u4e86\u54ea\u4e9b\u7279\u5b9a\u7684\u9009\u9879\u5c31\u5904\u4e8e\u7279\u5b9a\u7684\u6a21\u5f0f\u4e0b ) : - B , -- build Build a legacy array without superblocks .\u6784\u9020\u6a21\u5f0f - C , -- create Create a new array .\u521b\u5efa\u6a21\u5f0f - F , -- follow , -- monitor Select Monitor mode . - I , -- incremental Add / remove a single device to / from an appropriate array , and possibly start the array . -- add , -- re - add , -- add - spare , -- fail , -- remove , or -- replace MANAGE mode \u3002\u7ba1\u7406\u6a21\u5f0f For create , build , or grow : - n , -- raid - devices = Specify the number of active devices in the array . This number can only be changed using -- grow for RAID1 , RAID4 , RAID5 and RAID6 arrays - x , -- spare - devices = Specify the number of spare ( eXtra ) devices in the initial array .\u9884\u5907\u78c1\u76d8\u4e0e\u9635\u5217\u78c1\u76d8\u7684\u6570\u91cf\u52a0\u8d77\u6765\u5fc5\u987b\u7b49\u4e8e\u5217\u51fa\u7684\u8bbe\u5907\u7684\u6570\u91cf - c , -- chunk = Specify chunk size of kilobytes \uff0c\u9ed8\u8ba4 512 KB \u3002\u8be5\u503c\u5fc5\u987b\u662f 4 KB \u7684\u500d\u6570\u3002 RAID4 , RAID5 , RAID6 , and RAID10 \u8fd8\u8981\u6c42\u5fc5\u987b\u662f 2 \u7684 n \u6b21\u5e42\u3002\u5176\u4ed6\u5355\u4f4d\uff1a ' K ' , ' M ' or ' G ' . - l , -- level = Set RAID level . - a , -- auto { = yes , md , mdp , part , p }{ NN } \u6307\u793a\u9700\u8981\u521b\u5efa\u8bbe\u5907\u65f6\u5982\u4f55\u521b\u5efa\u3002\u5bf9\u4e8e\u53ef\u5206\u533a\u6570\u7ec4\uff0c mdadm \u5c06\u4e3a\u6574\u4e2a\u9635\u5217\u548c\u524d 4 \u4e2a\u5206\u533a\u521b\u5efa\u8bbe\u5907\u6587\u4ef6\uff1b\u53ef\u4ee5\u5728\u6b64\u9009\u9879\u7684\u672b\u5c3e\u6307\u5b9a\u4e0d\u540c\u6570\u91cf\u7684\u5206\u533a ( e . g . -- auto = p7 ) \u3002 yes \u662f\u9ed8\u8ba4\u503c\u3002\u5404\u503c\u610f\u4e49\u5982\u4e0b\uff1a yes \uff1a\u8981\u6c42\u547d\u540d\u7684 md \u8bbe\u5907\u5177\u6709 \" \u6807\u51c6 \" \u683c\u5f0f ( / dev / mdNN ) \uff0c\u5e76\u4e14\u786e\u5b9a\u7c7b\u578b\u548c\u6b21\u8981\u7f16\u53f7\u3002 md \uff1a\u4f7f\u7528 non - partitionable \u7684\u9635\u5217\uff08\u5c3d\u7ba1\u81ea Linux 2 . 6 . 28 \u4ee5\u6765\uff0c\u8fd9\u4e9b\u9635\u5217\u8bbe\u5907\u5b9e\u9645\u4e0a\u662f\u53ef\u5206\u533a\u7684\uff09 mdp , part , p \uff1a\u4f7f\u7528 partitionable \u7684\u9635\u5217 - z , -- size = Amount ( in Kilobytes ) of space to use from each drive in RAID levels 1 / 4 / 5 / 6 . \u5176\u4ed6\u5355\u4f4d\uff1a ' K ' , ' M ' or ' G ' . For Misc mode : - Q , -- query \u68c0\u67e5\uff1a 1 \u3001\u662f\u5426\u662f\u4e00\u4e2a md \u8bbe\u5907\uff1b 2 \u3001\u662f\u5426\u4e3a\u4e00\u4e2a md \u9635\u5217\u7684\u4e00\u4e2a\u6210\u5458 - D , -- detail Print details of one or more md devices .","title":"2.2 \u8f6f\u4ef6\u78c1\u76d8\u9635\u5217"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#221","text":"# \u4f7f\u7528 gdisk \u5728 /dev/sdb \u521b\u5efa\u5206\u533a Number Start ( sector ) End ( sector ) Size Code Name 1 2048 206847 100 .0 MiB FD00 Linux RAID 2 206848 411647 100 .0 MiB FD00 Linux RAID 3 411648 616447 100 .0 MiB FD00 Linux RAID 4 616448 821247 100 .0 MiB FD00 Linux RAID 5 821248 1026047 100 .0 MiB FD00 Linux RAID # \u521b\u5efaRAID5\u78c1\u76d8\u9635\u5217\uff0c\u547d\u540d\u4e3a /dev/md0\uff0c\u4f7f\u75284\u4e2a\u5206\u533a\u4f5c\u4e3a\u9635\u5217\u78c1\u76d8\uff0c\u4f7f\u75281\u4e2a\u5206\u533a\u4f5c\u4e3a\u9884\u5907\u78c1\u76d8\uff0cchunck\u5927\u5c0f512KB [ root@dev ~ ] # mdadm -C /dev/md0 -n 4 -x 1 -c 512K -l 5 --auto=yes /dev/sdb1 /dev/sdb2 /dev/sdb3 /dev/sdb4 /dev/sdb5 mdadm: Defaulting to version 1 .2 metadata mdadm: array /dev/md0 started. # \u67e5\u770b\u78c1\u76d8\u9635\u5217 [ root@dev ~ ] # mdadm -D /dev/md0 /dev/md0: Raid Level : raid5 State : clean Array Size : 301056 ( 294 .00 MiB 308 .28 MB ) Used Dev Size : 100352 ( 98 .00 MiB 102 .76 MB ) Active Devices : 4 Working Devices : 5 Failed Devices : 0 Spare Devices : 1 Chunk Size : 512K \u2026\u2026 Number Major Minor RaidDevice State 0 8 17 0 active sync /dev/sdb1 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 4 8 21 - spare /dev/sdb5 # \u901a\u8fc7\u7cfb\u7edf\u72b6\u6001\u67e5\u770b\u78c1\u76d8\u9635\u5217 [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] md0 : active raid5 sdb4 [ 5 ] sdb5 [ 4 ]( S ) sdb3 [ 2 ] sdb2 [ 1 ] sdb1 [ 0 ] 301056 blocks super 1 .2 level 5 , 512k chunk, algorithm 2 [ 4 /4 ] [ UUUU ] # blocks \u5355\u4f4d\u662f1K\uff0c\u5927\u6982\u5c31\u662f294M\uff0c[m/n]\u8868\u793a\u9635\u5217\u9700\u8981m\u4e2a\u8bbe\u5907\uff0c\u73b0\u5728n\u4e2a\u8bbe\u5907\u6b63\u5e38\u8fd0\u884c\uff0c [UUUU]\u8868\u793a\u8bbe\u5907\u8fd0\u884c\u60c5\u51b5\uff0cU\u4ee3\u8868\u6b63\u5e38\uff0c_\u4ee3\u8868\u4e0d\u6b63\u5e38","title":"2.2.1 \u521b\u5efa\u78c1\u76d8\u9635\u5217"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#222","text":"\u4e0e\u666e\u901a\u7684\u78c1\u76d8\u4e00\u6837\uff0c\u9700\u8981\u5148\u683c\u5f0f\u5316\u518d\u6302\u8f7d\u4f7f\u7528\u3002\u4f46\u662f\u4f1a\u6d89\u53ca\u5230FS\u7684\u4f18\u5316\u3002 mkfs . xfs [ options ] device OPTIONS # \u4f18\u5316\u9009\u9879 - d data_section_options data_section_options : su = value specify the stripe unit for a RAID device or a striped logical volume .\u5355\u4f4d\u662f bytes sw = value specify the stripe width for a RAID device or striped logical volume .\u901a\u5e38\u4e0e\u903b\u8f91\u5377\u914d\u7f6e\u4e2d\u7684\u6761\u5e26\u6210\u5458\u6570\u6216 RAID \u8bbe\u5907\u4e2d\u7684\u6570\u636e\u78c1\u76d8\u6570\u76f8\u540c\u3002 - r realtime_section_options realtime_section_options : extsize = value specify the size of the blocks in the real - time section of the filesystem .\u9ed8\u8ba4\u503c\u662f the stripe width for striped volumes or 64 KiB for non - striped volumes \u3002\u6700\u5c0f\u4e3a 4 k \uff0c\u6700\u5927\u4e3a 1 G \u3002 srtipe\uff08chunk\uff09\u5bb9\u91cf\u4e3a 512K\uff0c\u6240\u4ee5 su=512k \u5171\u6709 4 \u9897\u7ec4\u6210 RAID5\uff0c\u56e0\u6b64\u5bb9\u91cf\u5c11\u4e00\u9897\uff0c\u6240\u4ee5 sw=3 \u7531\u4e0a\u9762\u4e24\u9879\u8ba1\u7b97\u51fa\u6570\u636e\u5bbd\u5ea6\u4e3a\uff1a512K*3=1536k [ root@dev ~ ] # mkfs.xfs -d su=512k,sw=3 -r extsize=1536k /dev/md0 [ root@dev ~ ] # mkdir raid1 [ root@dev ~ ] # mount /dev/md0 raid1/ [ root@dev ~ ] # df -hT /dev/md0 Filesystem Type Size Used Avail Use% Mounted on /dev/md0 xfs 292M 16M 277M 6 % /root/raid1","title":"2.2.2 \u4f7f\u7528\u78c1\u76d8\u9635\u5217"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#223-raid","text":"mdadm -- manage < raiddevice > [ options ] < component - devices > OPTIONS For Manage mode : - f , -- fail Mark listed devices as faulty \uff08\u6545\u969c\uff09. - r , -- remove remove listed devices . They must not be active . i . e . they should be failed or spare devices . - a , -- add hot - add listed devices .\u4e0d\u9002\u7528\u4e8e\u975e\u5197\u4f59\u78c1\u76d8\u9635\u5217 RAID0 or Linear # \u624b\u52a8\u6807\u8bb0 sdb1 \u4e3a\u6545\u969c\u78c1\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --fail /dev/sdb1 mdadm: set /dev/sdb1 faulty in /dev/md0 # \u7acb\u5373\u67e5\u770b\u53ef\u4ee5\u770b\u5230\u539f\u5148\u7684\u5907\u4efd\u78c1\u76d8\u5df2\u7ecf\u9876\u66ff\u4e86\u6545\u969c\u78c1\u76d8\uff0c\u6b63\u5728\u8fdb\u884c\u6570\u636e rebuild [ root@dev ~ ] # mdadm -D /dev/md0 \u2026\u2026 Active Devices : 3 Working Devices : 4 Failed Devices : 1 Spare Devices : 1 \u2026\u2026 Rebuild Status : 32 % complete Name : dev:0 ( local to host dev ) UUID : caf10429:ec50770c:ddad512d:93ace6dc Events : 25 Number Major Minor RaidDevice State 4 8 21 0 spare rebuilding /dev/sdb5 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 0 8 17 - faulty /dev/sdb1 # rebuild \u5b8c\u6bd5 [ root@dev ~ ] # mdadm -D /dev/md0 Active Devices : 4 Working Devices : 4 Failed Devices : 1 Spare Devices : 0 \u2026\u2026 Number Major Minor RaidDevice State 4 8 21 0 active sync /dev/sdb5 1 8 18 1 active sync /dev/sdb2 2 8 19 2 active sync /dev/sdb3 5 8 20 3 active sync /dev/sdb4 0 8 17 - faulty /dev/sdb1 \u78c1\u76d8\u635f\u574f\u66ff\u6362\u6b65\u9aa4\uff1a \u4ece\u9635\u5217\u4e2d\u79fb\u9664\u635f\u574f\u78c1\u76d8 \u5173\u673a\uff0c\u5c06\u635f\u574f\u7684\u78c1\u76d8\u62d4\u9664\uff0c\u66f4\u6362\u65b0\u7684\u78c1\u76d8\u3002\u652f\u6301\u70ed\u63d2\u62d4\u7684\u7cfb\u7edf\u4e0d\u9700\u8981\u5173\u673a\u3002 \u5f00\u673a\uff0c\u5c06\u65b0\u78c1\u76d8\u52a0\u5165\u9635\u5217 \u4e0b\u9762\u901a\u8fc7\u8f6f\u4ef6\u6a21\u62df\u4e0a\u8ff0\u8fc7\u7a0b\uff1a # \u5220\u9664\u574f\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --remove /dev/sdb1 mdadm: hot removed /dev/sdb1 from /dev/md0 # \u6dfb\u52a0\u65b0\u76d8 [ root@dev ~ ] # mdadm --manage /dev/md0 --add /dev/sdb1 mdadm: added /dev/sdb1 # \u53c8\u6062\u590d\u539f\u6765\u7684\u6837\u5b50\u55bd [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] md0 : active raid5 sdb1 [ 6 ]( S ) sdb4 [ 5 ] sdb5 [ 4 ] sdb3 [ 2 ] sdb2 [ 1 ] 301056 blocks super 1 .2 level 5 , 512k chunk, algorithm 2 [ 4 /4 ] [ UUUU ]","title":"2.2.3 RAID\u9519\u8bef\u4eff\u771f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#224-raid","text":"# \u5148\u83b7\u53d6 uuid [ root@dev ~ ] # mdadm -D /dev/md0 | grep -i uuid UUID : caf10429:ec50770c:ddad512d:93ace6dc # \u7f16\u8f91 mdadm \u914d\u7f6e\u6587\u4ef6,\u8ba9\u7cfb\u7edf\u81ea\u52a8\u542f\u52a8 RAID [ root@dev ~ ] # cat /etc/mdadm.conf ARRAY /dev/md0 UUID = caf10429:ec50770c:ddad512d:93ace6dc # \u7f16\u8f91\u6302\u8f7d\u6587\u4ef6 [ root@dev ~ ] # blkid /dev/md0 /dev/md0: UUID = \"a558b7d2-37a2-481f-806e-822781435313\" TYPE = \"xfs\" [ root@dev ~ ] # cat /etc/fstab | grep raid UUID = a558b7d2-37a2-481f-806e-822781435313 /root/raid1 xfs defaults 0 0","title":"2.2.4 \u5f00\u673a\u81ea\u52a8\u542f\u52a8 RAID \u5e76\u81ea\u52a8\u6302\u8f7d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/15 \u78c1\u76d8\u9635\u5217/#225-raid","text":"\u786e\u5b9a\u4e0d\u518d\u4f7f\u7528\u9635\u5217\u65f6\uff0c\u9700\u8981\u5173\u95ed\uff0c\u5426\u5219\u5c06\u6765\u518d\u6b21\u91cd\u65b0\u5206\u533a\u65f6\u4f1a\u51fa\u73b0\u4e00\u4e9b\u9519\u8bef\u3002 \u6709\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a # 1. \u5378\u8f7d [ root@dev ~ ] # umount -v /dev/md0 [ root@dev ~ ] # sed -i '/raid/d' /etc/fstab # 2. \u5148\u8986\u76d6 RAID \u7684 metadata \u4e0e XFS \u7684 superblock [ root@dev ~ ] # dd if=/dev/zero of=/dev/md0 bs=1M count=50 50 +0 records in 50 +0 records out 52428800 bytes ( 52 MB ) copied, 1 .48123 s, 35 .4 MB/s # 3. \u518d\u5173\u95ed RAID [ root@dev ~ ] # mdadm --stop /dev/md0 mdadm: stopped /dev/md0 # 4. \u518d\u8986\u76d6\u6389\u5206\u533a\u7684 metadata\u3001superblock\u3002\u56e0\u4e3a RAID \u7684\u76f8\u5173\u6570\u636e\u5176\u5b9e\u4e5f\u4f1a\u5b58\u4e00\u4efd\u5728\u78c1\u76d8\u5f53\u4e2d\uff0c\u82e5\u53ea\u662f\u5173\u95ed\u4e86 RAID\uff0c \u90a3\u4e48\u91cd\u65b0\u5f00\u673a\u8fc7\u540e\uff0c\u7cfb\u7edf\u8fd8\u662f\u4f1a\u5c06\u8fd9\u9897\u78c1\u76d8\u9635\u5217\u521b\u5efa\u8d77\u6765 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb1 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb2 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb3 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb4 bs=1M count=10 [ root@dev ~ ] # dd if=/dev/zero of=/dev/sdb5 bs=1M count=10 [ root@dev ~ ] # cat /proc/mdstat Personalities : [ raid6 ] [ raid5 ] [ raid4 ] unused devices: <none> # 5. \u5220\u9664\u6216\u6ce8\u89e3 RAID [ root@dev ~ ] # vi /etc/mdadm.conf","title":"2.2.5 \u5173\u95ed\u8f6f\u4ef6 RAID"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/","text":"1. \u4ecb\u7ecd \u00b6 LVM\uff1aLogical Volume Manager\u3002 PV\uff1aPhysical Volume\u3002\u7531\u5206\u533a\u6216\u78c1\u76d8\u6765\u521b\u5efa\u3002 VG\uff1aVolume Group\u3002 LV\uff1aLogical Volume\u3002 PE\uff1aPhysical Extent\u3002\u662f\u6574\u4e2a LVM \u6700\u5c0f\u7684\u50a8\u5b58\u533a\u5757\uff0c\u7c7b\u4f3c\u4e8e FS \u4e2d\u7684 block\u3002\u9ed8\u8ba4\u5927\u5c0f\u662f 4M\u3002LVM \u7684 LV \u572832\u4f4d\u7cfb\u7edf\u4e0a\u6700\u591a\u4ec5\u80fd\u542b\u6709 65534 \u4e2aPE(lvm1\u7684\u683c\u5f0f)\uff0c\u56e0\u6b64\u9ed8\u8ba4\u7684 LVM \u7684 LV \u4f1a\u6709 4M*65534/(1024M/G)=256G\u3002\u5728CentOS 6.x \u4ee5\u540e\uff0c\u7531\u4e8e\u76f4\u63a5\u4f7f\u7528 lvm2 \u7684\u5404\u9879\u683c\u5f0f\u529f\u80fd,\u4ee5\u53ca\u7cfb\u7edf\u8f6c\u4e3a 64 \u4f4d\uff0c\u56e0\u6b64\u8fd9\u4e2a\u9650\u5236\u5df2\u7ecf\u4e0d\u5b58\u5728\u4e86\u3002 \u4e24\u79cd\u5199\u5165\u673a\u5236\uff1a \u7ebf\u6027\u6a21\u5f0f(linear)\u3002\u5f53\u4e00\u4e2apartition\u6216disk\u7684\u5bb9\u91cf\u7528\u5b8c\u4e4b\u540e\uff0c\u518d\u5199\u5165\u4e0b\u4e00\u4e2apartition\u6216disk\u3002\u63a8\u8350\u6a21\u5f0f\u3002 \u4ea4\u9519\u6a21\u5f0f(triped)\u3002\u5c06\u6570\u636e\u5199\u5165\u591a\u4e2a\u78c1\u76d8\u4e2d\uff0c\u8bfb\u5199\u6027\u80fd\u66f4\u597d\u3002 lvm \u4e3b\u8981\u5f3a\u8c03\u7684\u662f\u5f39\u6027\u8c03\u6574\uff0c\u800c\u4e0d\u662f\u6027\u80fd\uff0c\u6240\u4ee5\u9ed8\u8ba4\u4f7f\u7528\u7ebf\u6027\u6a21\u5f0f\u3002\u5982\u679c\u5f3a\u8c03\u6027\u80fd\u4e0e\u5907\u4efd\uff0c\u76f4\u63a5\u4f7f\u7528RAID\u5c31\u5b8c\u4e8b\u4e86\u3002 2. \u6307\u4ee4 \u00b6 2.1 PV \u6307\u4ee4 \u00b6 pvcreate pvscan\uff1a\u626b\u63cf\u6240\u6709\u88ab\u7528\u4f5cPV\u7684\u5757\u8bbe\u5907 pvs\uff1a\u751f\u6210\u6709\u5173 PV \u7684\u683c\u5f0f\u5316\u8f93\u51fa pvdisplay\uff1a\u5217\u51faPV\u7684\u5c5e\u6027 pvremove\uff1a\u79fb\u9664\u8bbe\u5907\u7684PV\u5c5e\u6027 2.2 VG \u6307\u4ee4 \u00b6 vgcreate\uff1a-s\u9009\u9879\u53ef\u4ee5\u6307\u5b9aPE\u5927\u5c0f vgscan vgs vgdisplay vgremove vgextend vgreduce 2.3 LV \u6307\u4ee4 \u00b6 lvresize 3. \u6269\u5bb9\u4e0e\u7f29\u51cf \u00b6 \u5206\u4e3a4\u6b65\uff1a \u65b0\u589e\u6216\u6269\u5bb9PV \u6269\u5bb9VG \u6269\u5bb9LV \u6587\u4ef6\u7cfb\u7edf\u7684\u6269\u5bb9\u4e0e\u7f29\u5c0f\u3002XFS \u53ea\u652f\u6301\u4f7f\u7528 xfs_growfs \u589e\u52a0\u5bb9\u91cf\uff0c\u4e0d\u652f\u6301\u7f29\u51cf\u3002EXT \u5bb6\u65cf\u4e24\u79cd\u90fd\u652f\u6301\uff0c\u4f7f\u7528 resize2fs \u3002 \u53ef\u4ee5\u4ece\u4e0a\u8ff0\u524d\u4e09\u6b65\u7684\u4efb\u610f\u6b65\u9aa4\u5f00\u59cb\u3002 4. \u4f7f\u7528 LVM thin Volume \u7cbe\u7b80\u5206\u914d \u00b6 \u9996\u5148\u4f60\u8981\u6709\u4e00\u4e2a\u5b58\u50a8\u6c60\uff1a lvcreate - T - L | --size Size[m|UNIT] VG/NEW_LV - T \u6307\u793a\u8fd9\u662f\u4e00\u4e2a thin pool [ root@dev ~ ] # lvcreate -T -L 100M test-vg/thin-pool1 Rounding up size to full physical extent 104 .00 MiB Thin pool volume with chunk size 64 .00 KiB can address at most 15 .81 TiB of data. Logical volume \"thin-pool1\" created. [ root@dev ~ ] # lvdisplay /dev/test-vg/thin-pool1 --- Logical volume --- \u2026\u2026 LV Pool metadata thin-pool1_tmeta LV Pool data thin-pool1_tdata LV Status available # open 0 LV Size 104 .00 MiB Allocated pool data 0 .00% Allocated metadata 10 .40% Current LE 13 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253 :5 \u7136\u540e\u521b\u5efalv\uff1a lvcreate - V | --virtualsize Size[m|UNIT] -T VG/LV_thinpool -n NEW_LV [ root@dev ~ ] # lvcreate -V 1G -T test-vg/thin-pool1 -n lv2 WARNING: Sum of all thin volume sizes ( 1 .00 GiB ) exceeds ( \u8d85\u8fc7 ) the size of thin pool test-vg/thin-pool1 and the size of whole volume group ( 288 .00 MiB ) . WARNING: You have not turned on protection against thin pools running out of space. WARNING: Set activation/thin_pool_autoextend_threshold below 100 to trigger automatic extension of thin pools before they get full. Logical volume \"lv2\" created. [ root@dev ~ ] # lvs test-vg LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert lv2 test-vg Vwi-a-tz-- 1 .00g thin-pool1 0 .00 test-lv1 test-vg -wi-a----- 112 .00m thin-pool1 test-vg twi-aotz-- 104 .00m 0 .00 10 .45 Warning \u6ce8\u610f\uff0c\u5982\u679c\u7a81\u7834\u4e86\u5b9e\u9645\u7684\u5bb9\u91cf\uff0cthin pool \u53ef\u662f\u4f1a\u7206\u70b8\u800c\u8ba9\u6570\u636e\u635f\u6bc1\u7684\u3002 [ root@dev ~ ] # mkfs.xfs /dev/test-vg/lv2 [ root@dev ~ ] # mount /dev/test-vg/lv2 lv2/ [ root@dev ~ ] # cd lv2/ # \u663e\u793a\u7684\u67091G\uff0c\u5b9e\u9645\u4e0a thin pool \u603b\u5171\u53ea\u6709 104M [ root@dev lv2 ] # df -hT lv2 Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/test--vg-lv2 xfs 1014M 33M 982M 4 % /root/lv2 [ root@dev lv2 ] # dd if=/dev/zero of=boom bs=1M count=1000 # \u7adf\u7136\u771f\u7684\u4f7f\u7528\u4e861G\u7684\u5bb9\u91cf\uff01\uff01\uff01 [ root@dev lv2 ] # ll -h total 981M -rw-r--r--. 1 root root 981M Oct 25 15 :38 boom [ root@dev lv2 ] # df -h lv2 Filesystem Size Used Avail Use% Mounted on /dev/mapper/test--vg-lv2 1014M 1014M 608K 100 % /root/lv2 5. LV \u78c1\u76d8\u5feb\u7167 \u00b6 \u4e0d\u53d8\u7684PE\u6570\u636e\u7531\u5feb\u7167\u533a\u4e0e\u7cfb\u7edf\u533a\u5171\u4eab\uff0c\u6570\u636e\u53d8\u52a8\u65f6\uff0c\u5c06\u539f\u59cb\u7684PE\u6570\u636e\u79fb\u52a8\u5230\u5feb\u7167\u533a\uff0c\u6539\u52a8\u7684PE\u6570\u636e\u5b58\u653e\u5728\u7cfb\u7edf\u533a\u3002\u7531\u4e8e\u5171\u4eab\u7684\u539f\u56e0\uff0c\u5feb\u7167\u533a\u4e0e\u88ab\u5feb\u7167\u7684 LV \u5fc5\u987b\u8981\u5728\u540c\u4e00\u4e2a VG \u4e0a\u3002\u7531\u4e8e thin pool \u7684\u9650\u5236\u5f88\u591a\uff0c\u6240\u4ee5\u4e0d\u5efa\u8bae\u4f7f\u7528 thin pool \u5feb\u7167\u3002 \u5feb\u7167\u533a\u5b9e\u9645\u4e0a\u4e5f\u662fLV\uff0c\u521b\u5efa\uff1a lvcreate - s | --snapshot <-L|--size Size[m|UNIT]>|<-l|--extents Number[PERCENT]> -n NEW_LV VG/LV # \u67e5\u770b\u8fd8\u6709\u591a\u5c11\u7a7a\u95f4 [ root@dev ~ ] # vgdisplay test-vg Total PE 36 Alloc PE / Size 14 / 112 .00 MiB Free PE / Size 22 / 176 .00 MiB # \u521b\u5efa\u5feb\u7167\u533a [ root@dev ~ ] # lvcreate -s -l 14 -n test-lv1-snapshot1 test-vg/test-lv1 Logical volume \"test-lv1-snapshot1\" created. # \u67e5\u770b\u5feb\u7167 [ root@dev ~ ] # lvdisplay test-vg/test-lv1-snapshot1 --- Logical volume --- \u2026\u2026 LV snapshot status active destination for test-lv1 LV Status available # open 0 LV Size 112 .00 MiB # \u539f\u59cbLV\u7684\u5bb9\u91cf Current LE 14 COW-table size 112 .00 MiB # \u80fd\u591f\u8bb0\u5f55\u7684\u6700\u5927\u5bb9\u91cf COW-table LE 14 Allocated to snapshot 0 .02% # \u88ab\u4f7f\u7528\u7684\u5bb9\u91cf Snapshot chunk size 4 .00 KiB Segments 2 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253 :5 [ root@dev ~ ] # lvs test-vg LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert test-lv1 test-vg owi-aos--- 112 .00m test-lv1-snapshot1 test-vg swi-a-s--- 112 .00m test-lv1 0 .02 # \u6302\u8f7d\u67e5\u770b [ root@dev ~ ] # blkid /dev/mapper/test--vg-test--lv1* /dev/mapper/test--vg-test--lv1: UUID = \"3073018e-d42a-4310-9f93-2cae719abe8f\" TYPE = \"xfs\" /dev/mapper/test--vg-test--lv1--snapshot1: UUID = \"3073018e-d42a-4310-9f93-2cae719abe8f\" TYPE = \"xfs\" # \u56e0\u4e3a\u4e24\u8005\u7684 UUID \u76f8\u540c\uff0c\u6240\u4ee5\u9700\u8981 nouuid\uff08\u4e0d\u8981\u4f7f\u7528uuid\u68c0\u6d4b\u91cd\u590d\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\uff09 \u9009\u9879 [ root@dev ~ ] # mount -o nouuid /dev/test-vg/test-lv1-snapshot1 test-lv1-snapshot1/ # \u4e24\u8005\u662f\u76f8\u540c\u7684\uff01 [ root@dev test-lv1 ] # df -hT /dev/test-vg/* Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/test--vg-test--lv1 xfs 109M 5 .9M 103M 6 % /root/test-lv1 /dev/mapper/test--vg-test--lv1--snapshot1 xfs 109M 5 .9M 103M 6 % /root/test-lv1-snapshot1 5.1 \u590d\u539f \u00b6 \u82e5\u53d8\u66f4\u7684\u6570\u636e\u91cf\u6bd4\u5feb\u7167\u533a\u5927\uff0c\u90a3\u4e48\u5c31\u4f1a\u5931\u6548\u3002 # \u5907\u4efd\u5feb\u7167\u533a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6302\u8f7d\u70b9\u672b\u5c3e\u4e00\u5b9a\u4e0d\u80fd\u5e26\u6709\u201d/\u201c \uff01\uff01\uff01 [ root@dev ~ ] # xfsdump -l 0 -L test-lv1 -M test-lv1 -f test-lv1-0.dump /root/test-lv1-snapshot1 # \u79fb\u9664\u5feb\u7167LV [ root@dev ~ ] # umount test-lv1-snapshot1/ [ root@dev ~ ] # lvremove test-vg/test-lv1-snapshot1 Do you really want to remove active logical volume test-vg/test-lv1-snapshot1? [ y/n ] : y Logical volume \"test-lv1-snapshot1\" successfully removed # \u91cd\u65b0\u683c\u5f0f\u5316\u539f\u59cbLV [ root@dev ~ ] # umount test-lv1 [ root@dev ~ ] # mkfs.xfs -f /dev/test-vg/test-lv1 [ root@dev ~ ] # mount /dev/test-vg/test-lv1 test-lv1 # \u4f7f\u7528\u5feb\u7167\u7684\u5907\u4efd\u6062\u590d\u539f\u59cbLV [ root@dev ~ ] # xfsrestore -f test-lv1-0.dump test-lv1 5.2 \u5feb\u7167\u533a\u4e0e\u539f\u59cb\u533a\u8eab\u4efd\u53cd\u8f6c \u00b6 \u82e5\u628a\u4e24\u8005\u7684\u8eab\u4efd\u53cd\u8f6c\uff08\u5373\u628a\u5feb\u7167\u533a\u5f53\u4f5c\u6d4b\u8bd5\u7528\u7684\u5730\u65b9\uff0c\u628a\u539f\u59cb\u533a\u5f53\u4f5c\u5feb\u7167\u533a\u7684\u5907\u4efd\uff09\u4f1a\u662f\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f \u5728\u5feb\u7167\u533a\u7684\u52a8\u4f5c\uff08\u6bd4\u5982\u6d4b\u8bd5\u3001\u7ec3\u4e60\uff09\u4e5f\u4f1a\u5199\u5728\u5feb\u7167\u533a\uff0c\u800c\u539f\u59cb\u533a\u4f1a\u4fdd\u6301\u4e0d\u53d8\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u9700\u8981\u5220\u9664\u5feb\u7167\u533a\uff0c\u5c31\u53ef\u4ee5\u5c06\u6240\u6709\u7684\u53d8\u52a8\u6570\u636e\u90fd\u5220\u9664\uff0c\u518d\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u5feb\u7167\u533a\u5c31\u8fd8\u80fd\u91cd\u65b0\u4f7f\u7528\u539f\u59cb\u73af\u5883\uff01 6. LVM \u7684\u79fb\u9664 \u00b6 \u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u5c06 LVM \u5173\u95ed\u5c31\u76f4\u63a5\u5c06\u90a3\u4e9b partition \u5220\u9664\u6216\u8f6c\u4e3a\u5176\u4ed6\u7528\u9014\u7684\u8bdd,\u7cfb\u7edf\u662f\u4f1a\u53d1\u751f\u5f88\u5927\u7684\u95ee\u9898\u7684\uff01 \u5148\u5378\u8f7d LVM \u7c7b\u578b\u7684FS \u4f7f\u7528 lvremove \u79fb\u9664 LV \u4f7f\u7528 vgchange -a n VG \u53d6\u6d88\u6fc0\u6d3bVG \u4f7f\u7528 vgremove \u79fb\u9664 VG \u4f7f\u7528 pvremove \u79fb\u9664 PV \u4fee\u6539\u5206\u533a\u6216disk\u7c7b\u578b [ root@dev ~ ] # umount /root/test-lv1 [ root@dev ~ ] # lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert root cl -wi-ao---- < 44 .00g swap cl -wi-ao---- 5 .00g test-lv1 test-vg -wi-a----- 112 .00m [ root@dev ~ ] # lvremove test-vg/test-lv1 Do you really want to remove active logical volume test-vg/test-lv1? [ y/n ] : y Logical volume \"test-lv1\" successfully removed [ root@dev ~ ] # vgchange -a n test-vg 0 logical volume ( s ) in volume group \"test-vg\" now active [ root@dev ~ ] # vgremove test-vg Volume group \"test-vg\" successfully removed [ root@dev ~ ] # pvs PV VG Fmt Attr PSize PFree /dev/sda2 cl lvm2 a-- < 49 .00g 0 /dev/sdb1 lvm2 --- 100 .00m 100 .00m /dev/sdb2 lvm2 --- 100 .00m 100 .00m /dev/sdb3 lvm2 --- 100 .00m 100 .00m [ root@dev ~ ] # pvremove /dev/sdb{1..3} Labels on physical volume \"/dev/sdb1\" successfully wiped. Labels on physical volume \"/dev/sdb2\" successfully wiped. Labels on physical volume \"/dev/sdb3\" successfully wiped. [ root@dev ~ ] # gdisk /dev/sdb Number Start ( sector ) End ( sector ) Size Code Name 1 2048 206847 100 .0 MiB 8300 Linux filesystem","title":"16 LVM"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#1","text":"LVM\uff1aLogical Volume Manager\u3002 PV\uff1aPhysical Volume\u3002\u7531\u5206\u533a\u6216\u78c1\u76d8\u6765\u521b\u5efa\u3002 VG\uff1aVolume Group\u3002 LV\uff1aLogical Volume\u3002 PE\uff1aPhysical Extent\u3002\u662f\u6574\u4e2a LVM \u6700\u5c0f\u7684\u50a8\u5b58\u533a\u5757\uff0c\u7c7b\u4f3c\u4e8e FS \u4e2d\u7684 block\u3002\u9ed8\u8ba4\u5927\u5c0f\u662f 4M\u3002LVM \u7684 LV \u572832\u4f4d\u7cfb\u7edf\u4e0a\u6700\u591a\u4ec5\u80fd\u542b\u6709 65534 \u4e2aPE(lvm1\u7684\u683c\u5f0f)\uff0c\u56e0\u6b64\u9ed8\u8ba4\u7684 LVM \u7684 LV \u4f1a\u6709 4M*65534/(1024M/G)=256G\u3002\u5728CentOS 6.x \u4ee5\u540e\uff0c\u7531\u4e8e\u76f4\u63a5\u4f7f\u7528 lvm2 \u7684\u5404\u9879\u683c\u5f0f\u529f\u80fd,\u4ee5\u53ca\u7cfb\u7edf\u8f6c\u4e3a 64 \u4f4d\uff0c\u56e0\u6b64\u8fd9\u4e2a\u9650\u5236\u5df2\u7ecf\u4e0d\u5b58\u5728\u4e86\u3002 \u4e24\u79cd\u5199\u5165\u673a\u5236\uff1a \u7ebf\u6027\u6a21\u5f0f(linear)\u3002\u5f53\u4e00\u4e2apartition\u6216disk\u7684\u5bb9\u91cf\u7528\u5b8c\u4e4b\u540e\uff0c\u518d\u5199\u5165\u4e0b\u4e00\u4e2apartition\u6216disk\u3002\u63a8\u8350\u6a21\u5f0f\u3002 \u4ea4\u9519\u6a21\u5f0f(triped)\u3002\u5c06\u6570\u636e\u5199\u5165\u591a\u4e2a\u78c1\u76d8\u4e2d\uff0c\u8bfb\u5199\u6027\u80fd\u66f4\u597d\u3002 lvm \u4e3b\u8981\u5f3a\u8c03\u7684\u662f\u5f39\u6027\u8c03\u6574\uff0c\u800c\u4e0d\u662f\u6027\u80fd\uff0c\u6240\u4ee5\u9ed8\u8ba4\u4f7f\u7528\u7ebf\u6027\u6a21\u5f0f\u3002\u5982\u679c\u5f3a\u8c03\u6027\u80fd\u4e0e\u5907\u4efd\uff0c\u76f4\u63a5\u4f7f\u7528RAID\u5c31\u5b8c\u4e8b\u4e86\u3002","title":"1. \u4ecb\u7ecd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#2","text":"","title":"2. \u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#21-pv","text":"pvcreate pvscan\uff1a\u626b\u63cf\u6240\u6709\u88ab\u7528\u4f5cPV\u7684\u5757\u8bbe\u5907 pvs\uff1a\u751f\u6210\u6709\u5173 PV \u7684\u683c\u5f0f\u5316\u8f93\u51fa pvdisplay\uff1a\u5217\u51faPV\u7684\u5c5e\u6027 pvremove\uff1a\u79fb\u9664\u8bbe\u5907\u7684PV\u5c5e\u6027","title":"2.1 PV \u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#22-vg","text":"vgcreate\uff1a-s\u9009\u9879\u53ef\u4ee5\u6307\u5b9aPE\u5927\u5c0f vgscan vgs vgdisplay vgremove vgextend vgreduce","title":"2.2 VG \u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#23-lv","text":"lvresize","title":"2.3 LV \u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#3","text":"\u5206\u4e3a4\u6b65\uff1a \u65b0\u589e\u6216\u6269\u5bb9PV \u6269\u5bb9VG \u6269\u5bb9LV \u6587\u4ef6\u7cfb\u7edf\u7684\u6269\u5bb9\u4e0e\u7f29\u5c0f\u3002XFS \u53ea\u652f\u6301\u4f7f\u7528 xfs_growfs \u589e\u52a0\u5bb9\u91cf\uff0c\u4e0d\u652f\u6301\u7f29\u51cf\u3002EXT \u5bb6\u65cf\u4e24\u79cd\u90fd\u652f\u6301\uff0c\u4f7f\u7528 resize2fs \u3002 \u53ef\u4ee5\u4ece\u4e0a\u8ff0\u524d\u4e09\u6b65\u7684\u4efb\u610f\u6b65\u9aa4\u5f00\u59cb\u3002","title":"3. \u6269\u5bb9\u4e0e\u7f29\u51cf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#4-lvm-thin-volume","text":"\u9996\u5148\u4f60\u8981\u6709\u4e00\u4e2a\u5b58\u50a8\u6c60\uff1a lvcreate - T - L | --size Size[m|UNIT] VG/NEW_LV - T \u6307\u793a\u8fd9\u662f\u4e00\u4e2a thin pool [ root@dev ~ ] # lvcreate -T -L 100M test-vg/thin-pool1 Rounding up size to full physical extent 104 .00 MiB Thin pool volume with chunk size 64 .00 KiB can address at most 15 .81 TiB of data. Logical volume \"thin-pool1\" created. [ root@dev ~ ] # lvdisplay /dev/test-vg/thin-pool1 --- Logical volume --- \u2026\u2026 LV Pool metadata thin-pool1_tmeta LV Pool data thin-pool1_tdata LV Status available # open 0 LV Size 104 .00 MiB Allocated pool data 0 .00% Allocated metadata 10 .40% Current LE 13 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253 :5 \u7136\u540e\u521b\u5efalv\uff1a lvcreate - V | --virtualsize Size[m|UNIT] -T VG/LV_thinpool -n NEW_LV [ root@dev ~ ] # lvcreate -V 1G -T test-vg/thin-pool1 -n lv2 WARNING: Sum of all thin volume sizes ( 1 .00 GiB ) exceeds ( \u8d85\u8fc7 ) the size of thin pool test-vg/thin-pool1 and the size of whole volume group ( 288 .00 MiB ) . WARNING: You have not turned on protection against thin pools running out of space. WARNING: Set activation/thin_pool_autoextend_threshold below 100 to trigger automatic extension of thin pools before they get full. Logical volume \"lv2\" created. [ root@dev ~ ] # lvs test-vg LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert lv2 test-vg Vwi-a-tz-- 1 .00g thin-pool1 0 .00 test-lv1 test-vg -wi-a----- 112 .00m thin-pool1 test-vg twi-aotz-- 104 .00m 0 .00 10 .45 Warning \u6ce8\u610f\uff0c\u5982\u679c\u7a81\u7834\u4e86\u5b9e\u9645\u7684\u5bb9\u91cf\uff0cthin pool \u53ef\u662f\u4f1a\u7206\u70b8\u800c\u8ba9\u6570\u636e\u635f\u6bc1\u7684\u3002 [ root@dev ~ ] # mkfs.xfs /dev/test-vg/lv2 [ root@dev ~ ] # mount /dev/test-vg/lv2 lv2/ [ root@dev ~ ] # cd lv2/ # \u663e\u793a\u7684\u67091G\uff0c\u5b9e\u9645\u4e0a thin pool \u603b\u5171\u53ea\u6709 104M [ root@dev lv2 ] # df -hT lv2 Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/test--vg-lv2 xfs 1014M 33M 982M 4 % /root/lv2 [ root@dev lv2 ] # dd if=/dev/zero of=boom bs=1M count=1000 # \u7adf\u7136\u771f\u7684\u4f7f\u7528\u4e861G\u7684\u5bb9\u91cf\uff01\uff01\uff01 [ root@dev lv2 ] # ll -h total 981M -rw-r--r--. 1 root root 981M Oct 25 15 :38 boom [ root@dev lv2 ] # df -h lv2 Filesystem Size Used Avail Use% Mounted on /dev/mapper/test--vg-lv2 1014M 1014M 608K 100 % /root/lv2","title":"4. \u4f7f\u7528 LVM thin Volume \u7cbe\u7b80\u5206\u914d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#5-lv","text":"\u4e0d\u53d8\u7684PE\u6570\u636e\u7531\u5feb\u7167\u533a\u4e0e\u7cfb\u7edf\u533a\u5171\u4eab\uff0c\u6570\u636e\u53d8\u52a8\u65f6\uff0c\u5c06\u539f\u59cb\u7684PE\u6570\u636e\u79fb\u52a8\u5230\u5feb\u7167\u533a\uff0c\u6539\u52a8\u7684PE\u6570\u636e\u5b58\u653e\u5728\u7cfb\u7edf\u533a\u3002\u7531\u4e8e\u5171\u4eab\u7684\u539f\u56e0\uff0c\u5feb\u7167\u533a\u4e0e\u88ab\u5feb\u7167\u7684 LV \u5fc5\u987b\u8981\u5728\u540c\u4e00\u4e2a VG \u4e0a\u3002\u7531\u4e8e thin pool \u7684\u9650\u5236\u5f88\u591a\uff0c\u6240\u4ee5\u4e0d\u5efa\u8bae\u4f7f\u7528 thin pool \u5feb\u7167\u3002 \u5feb\u7167\u533a\u5b9e\u9645\u4e0a\u4e5f\u662fLV\uff0c\u521b\u5efa\uff1a lvcreate - s | --snapshot <-L|--size Size[m|UNIT]>|<-l|--extents Number[PERCENT]> -n NEW_LV VG/LV # \u67e5\u770b\u8fd8\u6709\u591a\u5c11\u7a7a\u95f4 [ root@dev ~ ] # vgdisplay test-vg Total PE 36 Alloc PE / Size 14 / 112 .00 MiB Free PE / Size 22 / 176 .00 MiB # \u521b\u5efa\u5feb\u7167\u533a [ root@dev ~ ] # lvcreate -s -l 14 -n test-lv1-snapshot1 test-vg/test-lv1 Logical volume \"test-lv1-snapshot1\" created. # \u67e5\u770b\u5feb\u7167 [ root@dev ~ ] # lvdisplay test-vg/test-lv1-snapshot1 --- Logical volume --- \u2026\u2026 LV snapshot status active destination for test-lv1 LV Status available # open 0 LV Size 112 .00 MiB # \u539f\u59cbLV\u7684\u5bb9\u91cf Current LE 14 COW-table size 112 .00 MiB # \u80fd\u591f\u8bb0\u5f55\u7684\u6700\u5927\u5bb9\u91cf COW-table LE 14 Allocated to snapshot 0 .02% # \u88ab\u4f7f\u7528\u7684\u5bb9\u91cf Snapshot chunk size 4 .00 KiB Segments 2 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253 :5 [ root@dev ~ ] # lvs test-vg LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert test-lv1 test-vg owi-aos--- 112 .00m test-lv1-snapshot1 test-vg swi-a-s--- 112 .00m test-lv1 0 .02 # \u6302\u8f7d\u67e5\u770b [ root@dev ~ ] # blkid /dev/mapper/test--vg-test--lv1* /dev/mapper/test--vg-test--lv1: UUID = \"3073018e-d42a-4310-9f93-2cae719abe8f\" TYPE = \"xfs\" /dev/mapper/test--vg-test--lv1--snapshot1: UUID = \"3073018e-d42a-4310-9f93-2cae719abe8f\" TYPE = \"xfs\" # \u56e0\u4e3a\u4e24\u8005\u7684 UUID \u76f8\u540c\uff0c\u6240\u4ee5\u9700\u8981 nouuid\uff08\u4e0d\u8981\u4f7f\u7528uuid\u68c0\u6d4b\u91cd\u590d\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\uff09 \u9009\u9879 [ root@dev ~ ] # mount -o nouuid /dev/test-vg/test-lv1-snapshot1 test-lv1-snapshot1/ # \u4e24\u8005\u662f\u76f8\u540c\u7684\uff01 [ root@dev test-lv1 ] # df -hT /dev/test-vg/* Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/test--vg-test--lv1 xfs 109M 5 .9M 103M 6 % /root/test-lv1 /dev/mapper/test--vg-test--lv1--snapshot1 xfs 109M 5 .9M 103M 6 % /root/test-lv1-snapshot1","title":"5. LV \u78c1\u76d8\u5feb\u7167"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#51","text":"\u82e5\u53d8\u66f4\u7684\u6570\u636e\u91cf\u6bd4\u5feb\u7167\u533a\u5927\uff0c\u90a3\u4e48\u5c31\u4f1a\u5931\u6548\u3002 # \u5907\u4efd\u5feb\u7167\u533a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6302\u8f7d\u70b9\u672b\u5c3e\u4e00\u5b9a\u4e0d\u80fd\u5e26\u6709\u201d/\u201c \uff01\uff01\uff01 [ root@dev ~ ] # xfsdump -l 0 -L test-lv1 -M test-lv1 -f test-lv1-0.dump /root/test-lv1-snapshot1 # \u79fb\u9664\u5feb\u7167LV [ root@dev ~ ] # umount test-lv1-snapshot1/ [ root@dev ~ ] # lvremove test-vg/test-lv1-snapshot1 Do you really want to remove active logical volume test-vg/test-lv1-snapshot1? [ y/n ] : y Logical volume \"test-lv1-snapshot1\" successfully removed # \u91cd\u65b0\u683c\u5f0f\u5316\u539f\u59cbLV [ root@dev ~ ] # umount test-lv1 [ root@dev ~ ] # mkfs.xfs -f /dev/test-vg/test-lv1 [ root@dev ~ ] # mount /dev/test-vg/test-lv1 test-lv1 # \u4f7f\u7528\u5feb\u7167\u7684\u5907\u4efd\u6062\u590d\u539f\u59cbLV [ root@dev ~ ] # xfsrestore -f test-lv1-0.dump test-lv1","title":"5.1 \u590d\u539f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#52","text":"\u82e5\u628a\u4e24\u8005\u7684\u8eab\u4efd\u53cd\u8f6c\uff08\u5373\u628a\u5feb\u7167\u533a\u5f53\u4f5c\u6d4b\u8bd5\u7528\u7684\u5730\u65b9\uff0c\u628a\u539f\u59cb\u533a\u5f53\u4f5c\u5feb\u7167\u533a\u7684\u5907\u4efd\uff09\u4f1a\u662f\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f \u5728\u5feb\u7167\u533a\u7684\u52a8\u4f5c\uff08\u6bd4\u5982\u6d4b\u8bd5\u3001\u7ec3\u4e60\uff09\u4e5f\u4f1a\u5199\u5728\u5feb\u7167\u533a\uff0c\u800c\u539f\u59cb\u533a\u4f1a\u4fdd\u6301\u4e0d\u53d8\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u53ea\u9700\u8981\u5220\u9664\u5feb\u7167\u533a\uff0c\u5c31\u53ef\u4ee5\u5c06\u6240\u6709\u7684\u53d8\u52a8\u6570\u636e\u90fd\u5220\u9664\uff0c\u518d\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u5feb\u7167\u533a\u5c31\u8fd8\u80fd\u91cd\u65b0\u4f7f\u7528\u539f\u59cb\u73af\u5883\uff01","title":"5.2 \u5feb\u7167\u533a\u4e0e\u539f\u59cb\u533a\u8eab\u4efd\u53cd\u8f6c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/16 LVM/#6-lvm","text":"\u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u5c06 LVM \u5173\u95ed\u5c31\u76f4\u63a5\u5c06\u90a3\u4e9b partition \u5220\u9664\u6216\u8f6c\u4e3a\u5176\u4ed6\u7528\u9014\u7684\u8bdd,\u7cfb\u7edf\u662f\u4f1a\u53d1\u751f\u5f88\u5927\u7684\u95ee\u9898\u7684\uff01 \u5148\u5378\u8f7d LVM \u7c7b\u578b\u7684FS \u4f7f\u7528 lvremove \u79fb\u9664 LV \u4f7f\u7528 vgchange -a n VG \u53d6\u6d88\u6fc0\u6d3bVG \u4f7f\u7528 vgremove \u79fb\u9664 VG \u4f7f\u7528 pvremove \u79fb\u9664 PV \u4fee\u6539\u5206\u533a\u6216disk\u7c7b\u578b [ root@dev ~ ] # umount /root/test-lv1 [ root@dev ~ ] # lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert root cl -wi-ao---- < 44 .00g swap cl -wi-ao---- 5 .00g test-lv1 test-vg -wi-a----- 112 .00m [ root@dev ~ ] # lvremove test-vg/test-lv1 Do you really want to remove active logical volume test-vg/test-lv1? [ y/n ] : y Logical volume \"test-lv1\" successfully removed [ root@dev ~ ] # vgchange -a n test-vg 0 logical volume ( s ) in volume group \"test-vg\" now active [ root@dev ~ ] # vgremove test-vg Volume group \"test-vg\" successfully removed [ root@dev ~ ] # pvs PV VG Fmt Attr PSize PFree /dev/sda2 cl lvm2 a-- < 49 .00g 0 /dev/sdb1 lvm2 --- 100 .00m 100 .00m /dev/sdb2 lvm2 --- 100 .00m 100 .00m /dev/sdb3 lvm2 --- 100 .00m 100 .00m [ root@dev ~ ] # pvremove /dev/sdb{1..3} Labels on physical volume \"/dev/sdb1\" successfully wiped. Labels on physical volume \"/dev/sdb2\" successfully wiped. Labels on physical volume \"/dev/sdb3\" successfully wiped. [ root@dev ~ ] # gdisk /dev/sdb Number Start ( sector ) End ( sector ) Size Code Name 1 2048 206847 100 .0 MiB 8300 Linux filesystem","title":"6. LVM \u7684\u79fb\u9664"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/","text":"crontab \uff1a\u5b9a\u671f\u6267\u884c\u547d\u4ee4\u3002\u9700\u8981\u542f\u52a8 crond \u670d\u52a1\u3002 at \uff1a\u6267\u884c\u4e00\u6b21\u547d\u4ee4\u3002\u9700\u8981\u542f\u52a8 atd \u670d\u52a1\u3002 1. at \u00b6 at \u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u9650\u5236\u53ef\u4ee5\u4f7f\u7528\u5b83\u7684\u7528\u6237\uff1a \u5148\u627e\u5bfb /etc/at.allow \u8fd9\u4e2a\u6587\u4ef6\uff0c\u5199\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005\u624d\u80fd\u4f7f\u7528 at \uff0c\u6ca1\u6709\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005\u5219\u4e0d\u80fd\u4f7f\u7528 at (\u5373\u4f7f\u6ca1\u6709\u5199\u5728 at.deny \u5f53\u4e2d)\uff1b \u5982\u679c /etc/at.allow \u4e0d\u5b58\u5728,\u5c31\u5bfb\u627e /etc/at.deny \u8fd9\u4e2a\u6587\u4ef6\uff0c\u82e5\u5199\u5728\u8fd9\u4e2a at.deny \u7684\u4f7f\u7528\u8005\u5219\u4e0d\u80fd\u4f7f\u7528 at \uff0c\u800c\u6ca1\u6709\u5728\u8fd9\u4e2a at.deny \u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005,\u5c31\u53ef\u4ee5\u4f7f\u7528 at \u54af\uff1b \u5982\u679c\u4e24\u4e2a\u6587\u4ef6\u90fd\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u53ea\u6709 root \u53ef\u4ee5\u4f7f\u7528 at \u8fd9\u4e2a\u6307\u4ee4\u3002 at \u521b\u5efa\u7684\u65e5\u7a0b\u4f1a\u5728 /var/spool/at/ \u4e2d\u3002 1.1 \u4f7f\u7528 \u00b6 at [ - q queue ] [ - f file ] [ - mMlv ] timespec ... at [ - q queue ] [ - f file ] [ - mMkv ] [ - t time ] at - c job [ job ...] atq [ - q queue ] atrm job [ job ...] OPTIONS - q queue - m \u5f53 job \u5b8c\u6210\u65f6\uff0c\u5373\u4f7f\u6ca1\u6709\u8f93\u51fa\u4e5f\u53d1\u9001\u90ae\u4ef6\u7ed9\u7528\u6237\u3002 - M Never send mail to the user . - f file \u4ece\u6587\u4ef6\u8bfb\u53d6 job - t time \u683c\u5f0f\uff1a [[ CC ] YY ] MMDDhhmm [. ss ] - l Is an alias for atq . \u67e5\u8be2 job - r , - d Is an alias for atrm . \u5220\u9664 job - b is an alias for batch . \u7a7a\u95f2\u65f6\u6267\u884c job - c cats the jobs listed on the command line to standard output . \u4ece / var / spool / at / \u4e0b\u8bfb\u53d6 timespec HH : MM \u5728\u67d0\u4e2a\u65f6\u523b\u6267\u884c\u6307\u4ee4\u3002\u5982\u679c\u4eca\u5929\u8be5\u65f6\u95f4\u5df2\u7ecf\u8fc7\u53bb\u4e86\uff0c\u90a3\u4e48\u5c31\u660e\u5929\u6267\u884c am or pm in the morning or the evening MMDD [ CC ] YY , MM / DD / [ CC ] YY , DD . MM .[ CC ] YY or [ CC ] YY - MM - DD \u5e74\u6708\u65e5\uff0c\u5e74\u4efd\u53ef\u9009 now + count time - units time - units \uff1a minutes , hours , days , or weeks [ root@dev ~ ] # at now + 10 minutes at> echo \"hi!\" > /dev/pts/3 at> <EOT> job 3 at Wed Oct 30 16 :11:00 2019 [ root@dev ~ ] # atq 3 Wed Oct 30 16 :11:00 2019 a root [ root@dev ~ ] # at -c 3 #!/bin/sh # atrun uid=0 gid=0 # mail root 0 umask 22 \u2026\u2026 ${ SHELL :- /bin/sh } << 'marcinDELIMITER15abe4af' echo \"hi!\" > /dev/pts/3 marcinDELIMITER15abe4af # \u5220\u9664 job [ root@dev ~ ] # atrm 3 \u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9 at \u5728\u8fd0\u4f5c\u65f6,\u4f1a\u8dd1\u5230\u5f53\u65f6\u4e0b\u8fbe at \u6307\u4ee4\u7684\u90a3\u4e2a\u5de5\u4f5c\u76ee\u5f55\u3002\u6240\u4ee5job\u4e2d\u6700\u597d\u4f7f\u7528 \u7edd\u5bf9\u8def\u5f84 \u3002 at \u7684\u6267\u884c\u4e0e\u7ec8\u7aef\u673a\u73af\u5883\u65e0\u5173\uff0c\u800c\u6240\u6709 standard output/standard error output \u90fd\u4f1a\u4f20\u9001\u5230\u6267\u884c\u8005\u7684 mailbox \u53bb\u3002\u5047\u5982\u4f60\u5728 tty1 \u767b\u5165,\u5219\u53ef\u4ee5\u4f7f\u7528 echo \"Hello\" > /dev/tty1 \u6765\u53d6\u4ee3\u3002 \u5982\u679c\u5728 at shell \u5185\u7684\u6307\u4ee4\u5e76\u6ca1\u6709\u4efb\u4f55\u7684\u8baf\u606f\u8f93\u51fa\uff0c\u90a3\u4e48 at \u9ed8\u8ba4\u4e0d\u4f1a\u53d1 email \u7ed9\u6267\u884c\u8005\u7684\u3002\u53ef\u4ee5\u4f7f\u7528 -m \u9009\u9879\u6765\u53d1\u9001\u90ae\u4ef6\uff0c\u544a\u8bc9\u7528\u6237\u662f\u5426\u6267\u884c\u4e86\u6307\u4ee4\u3002 \u7cfb\u7edf\u4f1a\u5c06\u8be5\u9879 at \u5de5\u4f5c\u72ec\u7acb\u51fa\u4f60\u7684 bash \u73af\u5883\u4e2d\uff0c\u76f4\u63a5\u4ea4\u7ed9\u7cfb\u7edf\u7684 atd \u7a0b\u5e8f\u6765\u63a5\u7ba1\u3002 \u5f53\u7528\u6237\u4e89\u7528\u8d44\u6e90\u65f6\uff0c\u5f53\u524d\u4f7f\u7528 at \u548c batch \u4e0d\u9002\u5408\uff0c\u6b64\u65f6\u53ef\u4ee5\u8003\u8651\u5176\u4ed6\u7684\u5de5\u5177\uff0c\u6bd4\u5982 nqs\u3002 1.1.1 batch \u00b6 \u5728 CPU \u7684\u5de5\u4f5c\u8d1f\u8f7d\uff08CPU \u5728\u5355\u4e00\u65f6\u95f4\u70b9\u6240\u8d1f\u8d23\u7684\u5de5\u4f5c\u6570\u91cf\uff0c\u4e0d\u662f CPU \u7684\u4f7f\u7528\u7387!\uff09\u5c0f\u4e8e 0.8 \u7684\u65f6\u5019\uff0c\u624d\u8fdb\u884c\u4f60\u6240\u4e0b\u8fbe\u7684\u5de5\u4f5c\u4efb\u52a1\u3002 \u4e0d\u652f\u6301\u65f6\u95f4\u53c2\u6570\uff0c\u611f\u89c9\u6ca1\u4ec0\u4e48\u7528\u5904\u554a\u3002 2. crontab \u00b6 \u4e0e at \u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u9650\u5236\u7528\u6237\uff1a /etc/cron.allow: \u5c06\u53ef\u4ee5\u4f7f\u7528 crontab \u7684\u8d26\u53f7\u5199\u5165\u5176\u4e2d,\u82e5\u4e0d\u5728\u8fd9\u4e2a\u6587\u4ef6\u5185\u7684\u4f7f\u7528\u8005\u5219\u4e0d\u53ef\u4f7f\u7528 crontab; /etc/cron.deny: \u5c06\u4e0d\u53ef\u4ee5\u4f7f\u7528 crontab \u7684\u8d26\u53f7\u5199\u5165\u5176\u4e2d,\u82e5\u672a\u8bb0\u5f55\u5230\u8fd9\u4e2a\u6587\u4ef6\u5f53\u4e2d\u7684\u4f7f\u7528\u8005,\u5c31\u53ef\u4ee5\u4f7f\u7528 crontab \u3002 /etc/cron.allow \u6bd4 /etc/cron.deny \u4f18\u5148\u7ea7\u9ad8\u3002 \u5f53\u7528\u6237\u4f7f\u7528 crontab \u8fd9\u4e2a\u6307\u4ee4\u6765\u5efa\u7acb\u5de5\u4f5c\u6392\u7a0b\u4e4b\u540e\uff0c\u8be5\u9879\u5de5\u4f5c\u5c31\u4f1a\u88ab\u7eaa\u5f55\u5230 /var/spool/cron/ \u91cc\u9762\u53bb \u4e86\uff0c\u800c\u4e14\u662f\u4ee5\u8d26\u53f7\u6765\u4f5c\u4e3a\u5224\u522b\uff08\u6bd4\u5982sink\u7528\u6237\u5c31\u662f/var/spool/cron/sink\uff09\u3002cron \u6267\u884c\u7684\u6bcf\u4e00\u9879\u5de5\u4f5c\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230 /var/log/cron \u3002 2.1 \u4f7f\u7528 \u00b6 crontab [ - u user ] file crontab [ - u user ] [ - l | - r | - e ] \u670d\u52a1\u4e8e\u5b88\u62a4\u8fdb\u7a0b cron ( 8 ) \uff0c\u6765 install a crontab table file , remove or list the existing tables OPTIONS - u \u8981\u4fee\u6539\u5176 crontab \u7684\u7528\u6237\u7684\u540d\u79f0\u3002 - l Displays the current crontab on standard output . - r Removes the current crontab . \u4f1a\u5220\u9664\u5168\u90e8\u7684 crontab \uff0c\u53ea\u5220\u9664\u4e00\u90e8\u5206\u7684\u8bdd\u4f7f\u7528\u7f16\u8f91\u9009\u9879 - e Edits the current crontab using the editor [ root@dev ~ ] # crontab -u sink -e no crontab for sink - using an empty one # \u82e5\u7528\u6237\u6ca1\u6709 crontab \u4f1a\u51fa\u73b0\u6b64\u63d0\u793a crontab: installing new crontab [ root@dev ~ ] # crontab -u sink -l # \u8fd9\u4e2a\u5c31\u662f\u7f16\u8f91\u65f6\u5199\u5165\u7684\u5185\u5bb9\uff0c\u4e00\u5171\u5206\u4e3a\u516d\u4e2a\u5b57\u6bb5 0 12 * * * mail -s \"dinner time\" sink < /tmp/dinner.remind \u8fd9\u516d\u4e2a\u5b57\u6bb5\u6309\u7167\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u7684\u610f\u4e49\u5206\u522b\u662f\uff1a \u610f\u4e49 \u5206\u949f \u5c0f\u65f6 \u65e5\u671f \u6708\u4efd \u5468 \u6307\u4ee4 \u6570\u5b57\u8303\u56f4 0-59 0-23 1-31 1-12 0-7 0\u548c7\u90fd\u4ee3\u8868\u5468\u65e5 \u2014\u2014 \u8f85\u52a9\u7684\u7279\u6b8a\u5b57\u7b26\uff1a \u5b57\u7b26 \u610f\u4e49 * \u4efb\u4f55\u65f6\u523b\u90fd\u63a5\u53d7 , \u591a\u4e2a\u65f6\u6bb5\u3002\u6bd4\u5982\u5c0f\u65f6\u5b57\u6bb5\u7684 4,8,9 \u8868\u793a\u8fd9\u4e09\u4e2a\u65f6\u95f4\u90fd\u4f1a\u89e6\u53d1\u65e5\u7a0b - \u65f6\u95f4\u8303\u56f4\u3002\u6bd4\u5982 15 2-8 * * * command\uff0c\u4ee3\u88682-8\u70b9\u768415\u5206\u65f6\u523b\u90fd\u6267\u884c\u6307\u4ee4 /N N\u662f\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u9694\u591a\u957f\u65f6\u95f4\u3002\u6bd4\u5982 /10 * * * command\uff0c\u4ee3\u8868\u6bcf\u969410\u5206\u949f\u6267\u884c\u4e00\u6b21\u6307\u4ee4 2.2 \u7cfb\u7edf\u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 crontab -e \u662f\u7ed9\u4f7f\u7528\u8005\u8bbe\u8ba1\u7684\uff0c \u7cfb\u7edf\u6027\u7684\u65e5\u7a0b \u5c31\u9700\u8981\u7f16\u8f91 /etc/crontab \u6587\u4ef6\u5566\u3002 [ root@dev ~ ] # cat /etc/crontab SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin # \u53d1\u9001\u90ae\u4ef6\u7ed9\u7cfb\u7edf\u4e2d\u7684\u8d26\u6237 MAILTO = root # For details see man 4 crontabs # \u6307\u660e\u4e86\u4e03\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49 # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed cron \u8fd9\u4e2a\u670d\u52a1\u7684\u6700\u4f4e\u4fa6\u6d4b\u9650\u5236\u662f \u5206\u949f ,\u6240\u4ee5 cron \u4f1a\u6bcf\u5206\u949f\u53bb\u8bfb\u53d6\u4e00\u6b21 /etc/crontab \u4e0e /var/spool/cron \u91cc\u9762\u7684\u6570\u636e\u5185\u5bb9\u3002 Note \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0ccrontab\u662f\u8bfb\u5230\u5185\u5b58\u4e2d\u7684\uff0c\u6240\u4ee5\u4fee\u6539\u5b8c /etc/crontab \u53ef\u80fd\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u9700\u8981\u91cd\u542f\u670d\u52a1\u3002 /etc/cron.d \u76ee\u5f55\u5219\u662f\u7528\u4e8e\u5b58\u653e\u4e0d\u540c\u7528\u6237\u7684\u7cfb\u7edf\u6027 cron\u3002 [ root@dev ~ ] # cat /etc/cron.d/raid-check # Run system wide raid-check once a week on Sunday at 1am by default 0 1 * * Sun root /usr/sbin/raid-check # \u6bcf\u5c0f\u65f6\u6267\u884c\u4e00\u6b21 run-parts /etc/cron.hourly [ root@dev ~ ] # cat /etc/cron.d/0hourly # Run the hourly jobs SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin MAILTO = root 01 * * * * root run-parts /etc/cron.hourly # run-parts \u811a\u672c\u4f1a\u5728\u5927\u7ea6 5 \u5206\u949f\u5185\u968f\u673a\u9009\u4e00\u4e2a\u65f6\u95f4\u6765\u6267\u884c /etc/cron.hourly \u76ee\u5f55\u5185\u7684\u6240\u6709\u53ef\u6267\u884c\u6587\u4ef6! [ root@dev ~ ] # ll /etc/cron.hourly/ total 4 # \u6b64\u6587\u4ef6\u4e2d\u5b58\u653e\u7684\u662f anacron \u7684\u6267\u884c\u65b9\u5f0f\uff0canacron \u6267\u884c cron.{daily,weekly,monthly} \u4e09\u4e2a\u76ee\u5f55\uff0c\u9632\u6b62 anacron \u4e0e cron \u51b2\u7a81 -rwxr-xr-x. 1 root root 392 Aug 9 07 :07 0anacron cron.{hourly,daily,weekly,monthly} \u90fd\u662f crontabs \uff08\u4e5f\u5373\u662f run-parts \uff09\u7684\u914d\u7f6e\u6587\u4ef6\uff1a [ root@dev ~ ] # ll -d /etc/cron.*ly # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5c0f\u65f6\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 22 Oct 22 16 :03 /etc/cron.hourly # \u4e0b\u9762\u7684\u662f anacron \u76f4\u63a5\u6267\u884c\u7684\u811a\u672c # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5929\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 57 Oct 31 11 :06 /etc/cron.daily # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u6708\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 6 Jun 10 2014 /etc/cron.monthly # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5468\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 6 Jun 10 2014 /etc/cron.weekly # \u5b58\u653e\u7684\u90fd\u662f\u4e00\u4e9b\u53ef\u6267\u884c\u811a\u672c\uff0c\u7531 anacron \u6267\u884c [ root@dev ~ ] # ll /etc/cron.daily total 12 -rwx------. 1 root root 219 Oct 31 2018 logrotate -rwxr-xr-x. 1 root root 618 Oct 30 2018 man-db.cron -rwx------. 1 root root 208 Apr 11 2018 mlocate 2.3 \u6ce8\u610f\u4e8b\u9879 \u00b6 \u8981\u5c06\u65e5\u7a0b\u7684\u6267\u884c\u65f6\u95f4\u9519\u5f00\uff0c\u5e76\u8003\u8651\u5230\u7cfb\u7edf\u7684\u8d44\u6e90\u5206\u914d\u95ee\u9898\uff0c\u5408\u7406\u5730\u89c4\u5212\u65e5\u7a0b\u3002 \u53d6\u6d88\u4e0d\u8981\u7684\u8f93\u51fa\u9879\u3002\u5f53\u6709\u6267\u884c\u6210\u679c\u6216\u8005\u662f\u6267\u884c\u7684\u9879\u76ee\u4e2d\u6709\u8f93\u51fa\u7684\u6570\u636e\u65f6\uff0c\u8be5\u6570\u636e\u5c06\u4f1a mail \u7ed9 MAILTO \u8bbe\u5b9a\u7684\u8d26\u53f7\uff0c\u4e0d\u60f3\u8981\u7684\u8bdd\u5c31\u5229\u7528\u597d\u6570\u636e\u91cd\u5b9a\u5411\u5427\u3002 \u5b89\u5168\u7684\u68c0\u9a8c\u3002 /var/log/cron \u4e2d\u8bb0\u5f55\u4e86\u6240\u6709\u7684 cron \u6d3b\u52a8\uff0c\u67e5\u770b\u6b64\u6587\u4ef6\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e9b\u975e\u672c\u4eba\u8bbe\u5b9a\u7684 cron\u3002 3. anacron \u00b6 anacron \u5e76\u4e0d\u662f\u7528\u6765\u53d6\u4ee3 crontab \u7684\uff0c\u800c\u662f\u5bf9 crontab \u7684\u8865\u5145\u3002anacron \u5b58\u5728\u7684\u76ee\u7684\u5c31\u5728\u4e8e\uff1a\u5904\u7406\u975e 24 \u5c0f\u65f6\u4e00\u76f4\u542f\u52a8\u7684 Linux \u7cfb\u7edf\u7684 crontab\uff1b \u4ee5\u53ca\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5bfc\u81f4\u7684\u8d85\u8fc7\u65f6\u95f4\u800c\u6ca1\u6709\u88ab\u6267\u884c\u7684\u65e5\u7a0b\u3002 \u5176\u5b9e anacron \u4e5f\u662f\u6bcf\u4e2a\u5c0f\u65f6\u88ab crond \u6267\u884c\u4e00\u6b21\uff0c\u7136\u540e anacron \u518d\u53bb\u68c0\u6d4b\u76f8\u5173\u7684\u6392\u7a0b\u4efb\u52a1\u6709\u6ca1\u6709\u88ab\u6267\u884c\uff0c\u5982\u679c\u6709\u8d85\u8fc7\u671f\u9650\u7684\u5de5\u4f5c\u5728\uff0c\u5c31\u6267\u884c\u8be5\u6392\u7a0b\u4efb\u52a1,\u6267\u884c\u5b8c\u6bd5\u6216\u65e0\u987b\u6267\u884c\u4efb\u4f55\u6392\u7a0b\u65f6\uff0canacron \u5c31\u505c\u6b62\u4e86\u3002 anacron \u4f1a\u53bb\u5206\u6790\u73b0\u5728\u7684\u65f6\u95f4\u4e0e\u65f6\u95f4\u8bb0\u5f55\u6587\u4ef6 /var/spool/anacron/cron.daily \u6240\u8bb0\u8f7d\u7684\u4e0a\u6b21\u6267\u884c anacron \u7684\u65f6\u95f4\uff0c\u4e24\u8005\u6bd4\u8f83\u540e\u82e5\u53d1\u73b0\u6709\u5dee\u5f02\uff0c \u90a3\u5c31\u662f\u5728\u67d0\u4e9b\u65f6\u523b\u6ca1\u6709\u8fdb\u884c crontab \u5570!\u6b64\u65f6 anacron \u5c31\u4f1a\u5f00\u59cb\u6267\u884c\u672a\u8fdb\u884c\u7684 crontab \u4efb\u52a1\u4e86\u3002 # \u8fd9\u91cc\u6587\u4ef6\u540d\u52a0\u4e86\u4e2a 0 \u7684\u76ee\u7684\u662f\u6709\u591a\u4e2a\u811a\u672c\u5728\u8be5\u76ee\u5f55\u65f6\u9996\u5148\u6267\u884c anacron\uff0c\u8ba9\u65f6\u95f4\u6233\u5148\u66f4\u65b0\uff0c\u907f\u514d\u8bef\u5224 crontab \u5c1a\u672a\u6267\u884c\u4efb\u4f55\u4efb\u52a1 [ root@dev ~ ] # cat /etc/cron.hourly/0anacron #!/bin/sh # Check whether 0anacron was run today already if test -r /var/spool/anacron/cron.daily ; then day = ` cat /var/spool/anacron/cron.daily ` fi if [ ` date +%Y%m%d ` = \" $day \" ] ; then exit 0 ; fi # \u6d4b\u8bd5\u662f\u5426\u8fde\u63a5\u4e86\u7535\u6e90 # 0 (true)\uff1a System is on line power. # 1 (false)\uff1aSystem is not on line power. # Do not run jobs when on battery power if test -x /usr/bin/on_ac_power ; then /usr/bin/on_ac_power >/dev/null 2 > & 1 if test $? -eq 1 ; then exit 0 fi fi # \u6267\u884c /usr/sbin/anacron -s anacron [ options ] [ job ] ... Options : - s \u5f00\u59cb\u8fde\u7eed\u7684\u6267\u884c\u5404\u9879\u65e5\u7a0b ( job ), \u4f1a\u4f9d\u636e\u65f6\u95f4\u8bb0\u5f55\u6587\u4ef6\u7684\u6570\u636e\u5224\u65ad\u662f\u5426\u8fdb\u884c - f \u5f3a\u5236\u6267\u884c\u65e5\u7a0b \uff0c \u5ffd\u7565\u6240\u6709\u7684\u65f6\u95f4\u6233 - n \u7acb\u5373\u6267\u884c\u65e5\u7a0b \uff0c \u6ca1\u6709\u5ef6\u8fdf \uff0c \u9690\u58eb\u5305\u542b\u4e86 - s \u9009\u9879 - u \u66f4\u65b0\u6240\u6709\u7684\u65f6\u95f4\u6233\u5230\u5f53\u524d\u65e5\u671f \uff0c \u4f46\u4e0d\u6267\u884c\u4efb\u4f55\u65e5\u7a0b anacron \u4ece\u914d\u7f6e\u6587\u4ef6\uff08\u8bf4\u660e\u53ef\u901a\u8fc7 man anacrontab \u67e5\u770b\uff09\u4e2d\u8bfb\u53d6\u4efb\u52a1\uff1a [ root@dev ~ ] # cat /etc/anacrontab # /etc/anacrontab: configuration file for anacron # See anacron(8) and anacrontab(5) for details. SHELL = /bin/sh PATH = /sbin:/bin:/usr/sbin:/usr/bin MAILTO = root # \u5728\u57fa\u7840\u5ef6\u8fdf\u65f6\u95f4\u4e4b\u4e0a\u6dfb\u52a0\u7684\u6700\u5927\u968f\u673a\u5ef6\u8fdf\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u5206\u949f RANDOM_DELAY = 45 # \u65e5\u7a0b\u4f1a\u57283:00-22:00\u5f00\u59cb START_HOURS_RANGE = 3 -22 # \u6267\u884c\u7684\u9891\u7387 \u5ef6\u8fdf\u65f6\u95f4 \u65e5\u7a0bid\uff0c\u53ef\u81ea\u5b9a\u4e49 \u6307\u4ee4 #period in days delay in minutes job-identifier command 1 5 cron.daily nice run-parts /etc/cron.daily # cron.weekly \u7684\u5ef6\u8fdf\u662f 25\u5206\u949f + RANDOM_DELAY 7 25 cron.weekly nice run-parts /etc/cron.weekly @monthly 45 cron.monthly nice run-parts /etc/cron.monthly period in days \uff1a\u82e5\u5f53\u524d\u65f6\u95f4\u4e0e\u65f6\u95f4\u6233\uff08 /var/spool/anacron/cron.{daily,weekly,monthly} \uff09\u7684\u76f8\u5dee\u5929\u6570\u5927\u4e8e\u7b49\u4e8e\u6b64\u65f6\u95f4\uff0c\u5219\u6267\u884c\u8be5\u65e5\u7a0b delay in minutes \uff1a\u57fa\u7840\u5ef6\u8fdf\u65f6\u95f4\uff0c\u5373\u51b3\u5b9a\u6267\u884c\u65e5\u7a0b\u4e4b\u540e\u5ef6\u8fdf\u6267\u884c\u7684\u65f6\u95f4\uff08\u9632\u6b62\u8d44\u6e90\u51b2\u7a81\uff1f\uff09 job-identifier \uff1a\u53d6\u4e2a\u540d\u5b57\u5566\uff0c\u4f1a\u5728 /var/log/cron \u4e2d\u8bb0\u5f55 command \uff1a\u6267\u884c\u7684\u6307\u4ee4 3.1 crond \u4e0e anacron \u7684\u5173\u7cfb \u00b6 crond \u4f1a\u4e3b\u52a8\u53bb\u8bfb\u53d6 /etc/crontab, /var/spool/cron/*, /etc/cron.d/* \u7b49\u914d\u7f6e\u6587\u4ef6,\u5e76\u4f9d\u636e \u5206\u3001\u65f6\u3001\u65e5\u3001\u6708\u3001\u5468 \u7684\u65f6\u95f4\u8bbe\u5b9a\u53bb\u5404\u9879\u5de5\u4f5c\u6392\u7a0b; \u6839\u636e /etc/cron.d/0hourly \u7684\u8bbe\u5b9a,\u4e3b\u52a8\u53bb /etc/cron.hourly/ \u76ee\u5f55\u4e0b,\u6267\u884c\u6240\u6709\u5728\u8be5\u76ee\u5f55\u4e0b\u7684\u6267\u884c\u6587\u4ef6; \u56e0\u4e3a /etc/cron.hourly/0anacron \u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\u7684\u7f18\u6545,\u4e3b\u52a8\u7684\u6bcf\u5c0f\u65f6\u6267\u884c anacron ,\u5e76\u547c\u53eb /etc/anacrontab \u7684\u914d\u7f6e\u6587\u4ef6; \u6839\u636e /etc/anacrontab \u7684\u8bbe\u5b9a,\u4f9d\u636e\u6bcf\u5929\u3001\u6bcf\u5468\u3001\u6bcf\u6708\u53bb\u5206\u6790 /etc/cron.daily/, /etc/cron.weekly/, /etc/cron.monthly/ \u5185\u7684\u6267\u884c\u6587\u4ef6,\u4ee5\u8fdb\u884c\u56fa\u5b9a\u5468\u671f\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\u3002","title":"17 crontab"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#1-at","text":"at \u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u9650\u5236\u53ef\u4ee5\u4f7f\u7528\u5b83\u7684\u7528\u6237\uff1a \u5148\u627e\u5bfb /etc/at.allow \u8fd9\u4e2a\u6587\u4ef6\uff0c\u5199\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005\u624d\u80fd\u4f7f\u7528 at \uff0c\u6ca1\u6709\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005\u5219\u4e0d\u80fd\u4f7f\u7528 at (\u5373\u4f7f\u6ca1\u6709\u5199\u5728 at.deny \u5f53\u4e2d)\uff1b \u5982\u679c /etc/at.allow \u4e0d\u5b58\u5728,\u5c31\u5bfb\u627e /etc/at.deny \u8fd9\u4e2a\u6587\u4ef6\uff0c\u82e5\u5199\u5728\u8fd9\u4e2a at.deny \u7684\u4f7f\u7528\u8005\u5219\u4e0d\u80fd\u4f7f\u7528 at \uff0c\u800c\u6ca1\u6709\u5728\u8fd9\u4e2a at.deny \u6587\u4ef6\u4e2d\u7684\u4f7f\u7528\u8005,\u5c31\u53ef\u4ee5\u4f7f\u7528 at \u54af\uff1b \u5982\u679c\u4e24\u4e2a\u6587\u4ef6\u90fd\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u53ea\u6709 root \u53ef\u4ee5\u4f7f\u7528 at \u8fd9\u4e2a\u6307\u4ee4\u3002 at \u521b\u5efa\u7684\u65e5\u7a0b\u4f1a\u5728 /var/spool/at/ \u4e2d\u3002","title":"1. at"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#11","text":"at [ - q queue ] [ - f file ] [ - mMlv ] timespec ... at [ - q queue ] [ - f file ] [ - mMkv ] [ - t time ] at - c job [ job ...] atq [ - q queue ] atrm job [ job ...] OPTIONS - q queue - m \u5f53 job \u5b8c\u6210\u65f6\uff0c\u5373\u4f7f\u6ca1\u6709\u8f93\u51fa\u4e5f\u53d1\u9001\u90ae\u4ef6\u7ed9\u7528\u6237\u3002 - M Never send mail to the user . - f file \u4ece\u6587\u4ef6\u8bfb\u53d6 job - t time \u683c\u5f0f\uff1a [[ CC ] YY ] MMDDhhmm [. ss ] - l Is an alias for atq . \u67e5\u8be2 job - r , - d Is an alias for atrm . \u5220\u9664 job - b is an alias for batch . \u7a7a\u95f2\u65f6\u6267\u884c job - c cats the jobs listed on the command line to standard output . \u4ece / var / spool / at / \u4e0b\u8bfb\u53d6 timespec HH : MM \u5728\u67d0\u4e2a\u65f6\u523b\u6267\u884c\u6307\u4ee4\u3002\u5982\u679c\u4eca\u5929\u8be5\u65f6\u95f4\u5df2\u7ecf\u8fc7\u53bb\u4e86\uff0c\u90a3\u4e48\u5c31\u660e\u5929\u6267\u884c am or pm in the morning or the evening MMDD [ CC ] YY , MM / DD / [ CC ] YY , DD . MM .[ CC ] YY or [ CC ] YY - MM - DD \u5e74\u6708\u65e5\uff0c\u5e74\u4efd\u53ef\u9009 now + count time - units time - units \uff1a minutes , hours , days , or weeks [ root@dev ~ ] # at now + 10 minutes at> echo \"hi!\" > /dev/pts/3 at> <EOT> job 3 at Wed Oct 30 16 :11:00 2019 [ root@dev ~ ] # atq 3 Wed Oct 30 16 :11:00 2019 a root [ root@dev ~ ] # at -c 3 #!/bin/sh # atrun uid=0 gid=0 # mail root 0 umask 22 \u2026\u2026 ${ SHELL :- /bin/sh } << 'marcinDELIMITER15abe4af' echo \"hi!\" > /dev/pts/3 marcinDELIMITER15abe4af # \u5220\u9664 job [ root@dev ~ ] # atrm 3 \u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9 at \u5728\u8fd0\u4f5c\u65f6,\u4f1a\u8dd1\u5230\u5f53\u65f6\u4e0b\u8fbe at \u6307\u4ee4\u7684\u90a3\u4e2a\u5de5\u4f5c\u76ee\u5f55\u3002\u6240\u4ee5job\u4e2d\u6700\u597d\u4f7f\u7528 \u7edd\u5bf9\u8def\u5f84 \u3002 at \u7684\u6267\u884c\u4e0e\u7ec8\u7aef\u673a\u73af\u5883\u65e0\u5173\uff0c\u800c\u6240\u6709 standard output/standard error output \u90fd\u4f1a\u4f20\u9001\u5230\u6267\u884c\u8005\u7684 mailbox \u53bb\u3002\u5047\u5982\u4f60\u5728 tty1 \u767b\u5165,\u5219\u53ef\u4ee5\u4f7f\u7528 echo \"Hello\" > /dev/tty1 \u6765\u53d6\u4ee3\u3002 \u5982\u679c\u5728 at shell \u5185\u7684\u6307\u4ee4\u5e76\u6ca1\u6709\u4efb\u4f55\u7684\u8baf\u606f\u8f93\u51fa\uff0c\u90a3\u4e48 at \u9ed8\u8ba4\u4e0d\u4f1a\u53d1 email \u7ed9\u6267\u884c\u8005\u7684\u3002\u53ef\u4ee5\u4f7f\u7528 -m \u9009\u9879\u6765\u53d1\u9001\u90ae\u4ef6\uff0c\u544a\u8bc9\u7528\u6237\u662f\u5426\u6267\u884c\u4e86\u6307\u4ee4\u3002 \u7cfb\u7edf\u4f1a\u5c06\u8be5\u9879 at \u5de5\u4f5c\u72ec\u7acb\u51fa\u4f60\u7684 bash \u73af\u5883\u4e2d\uff0c\u76f4\u63a5\u4ea4\u7ed9\u7cfb\u7edf\u7684 atd \u7a0b\u5e8f\u6765\u63a5\u7ba1\u3002 \u5f53\u7528\u6237\u4e89\u7528\u8d44\u6e90\u65f6\uff0c\u5f53\u524d\u4f7f\u7528 at \u548c batch \u4e0d\u9002\u5408\uff0c\u6b64\u65f6\u53ef\u4ee5\u8003\u8651\u5176\u4ed6\u7684\u5de5\u5177\uff0c\u6bd4\u5982 nqs\u3002","title":"1.1 \u4f7f\u7528"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#111-batch","text":"\u5728 CPU \u7684\u5de5\u4f5c\u8d1f\u8f7d\uff08CPU \u5728\u5355\u4e00\u65f6\u95f4\u70b9\u6240\u8d1f\u8d23\u7684\u5de5\u4f5c\u6570\u91cf\uff0c\u4e0d\u662f CPU \u7684\u4f7f\u7528\u7387!\uff09\u5c0f\u4e8e 0.8 \u7684\u65f6\u5019\uff0c\u624d\u8fdb\u884c\u4f60\u6240\u4e0b\u8fbe\u7684\u5de5\u4f5c\u4efb\u52a1\u3002 \u4e0d\u652f\u6301\u65f6\u95f4\u53c2\u6570\uff0c\u611f\u89c9\u6ca1\u4ec0\u4e48\u7528\u5904\u554a\u3002","title":"1.1.1 batch"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#2-crontab","text":"\u4e0e at \u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u9650\u5236\u7528\u6237\uff1a /etc/cron.allow: \u5c06\u53ef\u4ee5\u4f7f\u7528 crontab \u7684\u8d26\u53f7\u5199\u5165\u5176\u4e2d,\u82e5\u4e0d\u5728\u8fd9\u4e2a\u6587\u4ef6\u5185\u7684\u4f7f\u7528\u8005\u5219\u4e0d\u53ef\u4f7f\u7528 crontab; /etc/cron.deny: \u5c06\u4e0d\u53ef\u4ee5\u4f7f\u7528 crontab \u7684\u8d26\u53f7\u5199\u5165\u5176\u4e2d,\u82e5\u672a\u8bb0\u5f55\u5230\u8fd9\u4e2a\u6587\u4ef6\u5f53\u4e2d\u7684\u4f7f\u7528\u8005,\u5c31\u53ef\u4ee5\u4f7f\u7528 crontab \u3002 /etc/cron.allow \u6bd4 /etc/cron.deny \u4f18\u5148\u7ea7\u9ad8\u3002 \u5f53\u7528\u6237\u4f7f\u7528 crontab \u8fd9\u4e2a\u6307\u4ee4\u6765\u5efa\u7acb\u5de5\u4f5c\u6392\u7a0b\u4e4b\u540e\uff0c\u8be5\u9879\u5de5\u4f5c\u5c31\u4f1a\u88ab\u7eaa\u5f55\u5230 /var/spool/cron/ \u91cc\u9762\u53bb \u4e86\uff0c\u800c\u4e14\u662f\u4ee5\u8d26\u53f7\u6765\u4f5c\u4e3a\u5224\u522b\uff08\u6bd4\u5982sink\u7528\u6237\u5c31\u662f/var/spool/cron/sink\uff09\u3002cron \u6267\u884c\u7684\u6bcf\u4e00\u9879\u5de5\u4f5c\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230 /var/log/cron \u3002","title":"2. crontab"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#21","text":"crontab [ - u user ] file crontab [ - u user ] [ - l | - r | - e ] \u670d\u52a1\u4e8e\u5b88\u62a4\u8fdb\u7a0b cron ( 8 ) \uff0c\u6765 install a crontab table file , remove or list the existing tables OPTIONS - u \u8981\u4fee\u6539\u5176 crontab \u7684\u7528\u6237\u7684\u540d\u79f0\u3002 - l Displays the current crontab on standard output . - r Removes the current crontab . \u4f1a\u5220\u9664\u5168\u90e8\u7684 crontab \uff0c\u53ea\u5220\u9664\u4e00\u90e8\u5206\u7684\u8bdd\u4f7f\u7528\u7f16\u8f91\u9009\u9879 - e Edits the current crontab using the editor [ root@dev ~ ] # crontab -u sink -e no crontab for sink - using an empty one # \u82e5\u7528\u6237\u6ca1\u6709 crontab \u4f1a\u51fa\u73b0\u6b64\u63d0\u793a crontab: installing new crontab [ root@dev ~ ] # crontab -u sink -l # \u8fd9\u4e2a\u5c31\u662f\u7f16\u8f91\u65f6\u5199\u5165\u7684\u5185\u5bb9\uff0c\u4e00\u5171\u5206\u4e3a\u516d\u4e2a\u5b57\u6bb5 0 12 * * * mail -s \"dinner time\" sink < /tmp/dinner.remind \u8fd9\u516d\u4e2a\u5b57\u6bb5\u6309\u7167\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\u7684\u610f\u4e49\u5206\u522b\u662f\uff1a \u610f\u4e49 \u5206\u949f \u5c0f\u65f6 \u65e5\u671f \u6708\u4efd \u5468 \u6307\u4ee4 \u6570\u5b57\u8303\u56f4 0-59 0-23 1-31 1-12 0-7 0\u548c7\u90fd\u4ee3\u8868\u5468\u65e5 \u2014\u2014 \u8f85\u52a9\u7684\u7279\u6b8a\u5b57\u7b26\uff1a \u5b57\u7b26 \u610f\u4e49 * \u4efb\u4f55\u65f6\u523b\u90fd\u63a5\u53d7 , \u591a\u4e2a\u65f6\u6bb5\u3002\u6bd4\u5982\u5c0f\u65f6\u5b57\u6bb5\u7684 4,8,9 \u8868\u793a\u8fd9\u4e09\u4e2a\u65f6\u95f4\u90fd\u4f1a\u89e6\u53d1\u65e5\u7a0b - \u65f6\u95f4\u8303\u56f4\u3002\u6bd4\u5982 15 2-8 * * * command\uff0c\u4ee3\u88682-8\u70b9\u768415\u5206\u65f6\u523b\u90fd\u6267\u884c\u6307\u4ee4 /N N\u662f\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u9694\u591a\u957f\u65f6\u95f4\u3002\u6bd4\u5982 /10 * * * command\uff0c\u4ee3\u8868\u6bcf\u969410\u5206\u949f\u6267\u884c\u4e00\u6b21\u6307\u4ee4","title":"2.1 \u4f7f\u7528"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#22","text":"crontab -e \u662f\u7ed9\u4f7f\u7528\u8005\u8bbe\u8ba1\u7684\uff0c \u7cfb\u7edf\u6027\u7684\u65e5\u7a0b \u5c31\u9700\u8981\u7f16\u8f91 /etc/crontab \u6587\u4ef6\u5566\u3002 [ root@dev ~ ] # cat /etc/crontab SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin # \u53d1\u9001\u90ae\u4ef6\u7ed9\u7cfb\u7edf\u4e2d\u7684\u8d26\u6237 MAILTO = root # For details see man 4 crontabs # \u6307\u660e\u4e86\u4e03\u4e2a\u5b57\u6bb5\u7684\u610f\u4e49 # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed cron \u8fd9\u4e2a\u670d\u52a1\u7684\u6700\u4f4e\u4fa6\u6d4b\u9650\u5236\u662f \u5206\u949f ,\u6240\u4ee5 cron \u4f1a\u6bcf\u5206\u949f\u53bb\u8bfb\u53d6\u4e00\u6b21 /etc/crontab \u4e0e /var/spool/cron \u91cc\u9762\u7684\u6570\u636e\u5185\u5bb9\u3002 Note \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0ccrontab\u662f\u8bfb\u5230\u5185\u5b58\u4e2d\u7684\uff0c\u6240\u4ee5\u4fee\u6539\u5b8c /etc/crontab \u53ef\u80fd\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u9700\u8981\u91cd\u542f\u670d\u52a1\u3002 /etc/cron.d \u76ee\u5f55\u5219\u662f\u7528\u4e8e\u5b58\u653e\u4e0d\u540c\u7528\u6237\u7684\u7cfb\u7edf\u6027 cron\u3002 [ root@dev ~ ] # cat /etc/cron.d/raid-check # Run system wide raid-check once a week on Sunday at 1am by default 0 1 * * Sun root /usr/sbin/raid-check # \u6bcf\u5c0f\u65f6\u6267\u884c\u4e00\u6b21 run-parts /etc/cron.hourly [ root@dev ~ ] # cat /etc/cron.d/0hourly # Run the hourly jobs SHELL = /bin/bash PATH = /sbin:/bin:/usr/sbin:/usr/bin MAILTO = root 01 * * * * root run-parts /etc/cron.hourly # run-parts \u811a\u672c\u4f1a\u5728\u5927\u7ea6 5 \u5206\u949f\u5185\u968f\u673a\u9009\u4e00\u4e2a\u65f6\u95f4\u6765\u6267\u884c /etc/cron.hourly \u76ee\u5f55\u5185\u7684\u6240\u6709\u53ef\u6267\u884c\u6587\u4ef6! [ root@dev ~ ] # ll /etc/cron.hourly/ total 4 # \u6b64\u6587\u4ef6\u4e2d\u5b58\u653e\u7684\u662f anacron \u7684\u6267\u884c\u65b9\u5f0f\uff0canacron \u6267\u884c cron.{daily,weekly,monthly} \u4e09\u4e2a\u76ee\u5f55\uff0c\u9632\u6b62 anacron \u4e0e cron \u51b2\u7a81 -rwxr-xr-x. 1 root root 392 Aug 9 07 :07 0anacron cron.{hourly,daily,weekly,monthly} \u90fd\u662f crontabs \uff08\u4e5f\u5373\u662f run-parts \uff09\u7684\u914d\u7f6e\u6587\u4ef6\uff1a [ root@dev ~ ] # ll -d /etc/cron.*ly # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5c0f\u65f6\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 22 Oct 22 16 :03 /etc/cron.hourly # \u4e0b\u9762\u7684\u662f anacron \u76f4\u63a5\u6267\u884c\u7684\u811a\u672c # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5929\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 57 Oct 31 11 :06 /etc/cron.daily # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u6708\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 6 Jun 10 2014 /etc/cron.monthly # \u5b58\u653e\u7740\u9700\u8981\u6bcf\u5468\u6267\u884c\u7684\u811a\u672c drwxr-xr-x. 2 root root 6 Jun 10 2014 /etc/cron.weekly # \u5b58\u653e\u7684\u90fd\u662f\u4e00\u4e9b\u53ef\u6267\u884c\u811a\u672c\uff0c\u7531 anacron \u6267\u884c [ root@dev ~ ] # ll /etc/cron.daily total 12 -rwx------. 1 root root 219 Oct 31 2018 logrotate -rwxr-xr-x. 1 root root 618 Oct 30 2018 man-db.cron -rwx------. 1 root root 208 Apr 11 2018 mlocate","title":"2.2 \u7cfb\u7edf\u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#23","text":"\u8981\u5c06\u65e5\u7a0b\u7684\u6267\u884c\u65f6\u95f4\u9519\u5f00\uff0c\u5e76\u8003\u8651\u5230\u7cfb\u7edf\u7684\u8d44\u6e90\u5206\u914d\u95ee\u9898\uff0c\u5408\u7406\u5730\u89c4\u5212\u65e5\u7a0b\u3002 \u53d6\u6d88\u4e0d\u8981\u7684\u8f93\u51fa\u9879\u3002\u5f53\u6709\u6267\u884c\u6210\u679c\u6216\u8005\u662f\u6267\u884c\u7684\u9879\u76ee\u4e2d\u6709\u8f93\u51fa\u7684\u6570\u636e\u65f6\uff0c\u8be5\u6570\u636e\u5c06\u4f1a mail \u7ed9 MAILTO \u8bbe\u5b9a\u7684\u8d26\u53f7\uff0c\u4e0d\u60f3\u8981\u7684\u8bdd\u5c31\u5229\u7528\u597d\u6570\u636e\u91cd\u5b9a\u5411\u5427\u3002 \u5b89\u5168\u7684\u68c0\u9a8c\u3002 /var/log/cron \u4e2d\u8bb0\u5f55\u4e86\u6240\u6709\u7684 cron \u6d3b\u52a8\uff0c\u67e5\u770b\u6b64\u6587\u4ef6\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e9b\u975e\u672c\u4eba\u8bbe\u5b9a\u7684 cron\u3002","title":"2.3 \u6ce8\u610f\u4e8b\u9879"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#3-anacron","text":"anacron \u5e76\u4e0d\u662f\u7528\u6765\u53d6\u4ee3 crontab \u7684\uff0c\u800c\u662f\u5bf9 crontab \u7684\u8865\u5145\u3002anacron \u5b58\u5728\u7684\u76ee\u7684\u5c31\u5728\u4e8e\uff1a\u5904\u7406\u975e 24 \u5c0f\u65f6\u4e00\u76f4\u542f\u52a8\u7684 Linux \u7cfb\u7edf\u7684 crontab\uff1b \u4ee5\u53ca\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5bfc\u81f4\u7684\u8d85\u8fc7\u65f6\u95f4\u800c\u6ca1\u6709\u88ab\u6267\u884c\u7684\u65e5\u7a0b\u3002 \u5176\u5b9e anacron \u4e5f\u662f\u6bcf\u4e2a\u5c0f\u65f6\u88ab crond \u6267\u884c\u4e00\u6b21\uff0c\u7136\u540e anacron \u518d\u53bb\u68c0\u6d4b\u76f8\u5173\u7684\u6392\u7a0b\u4efb\u52a1\u6709\u6ca1\u6709\u88ab\u6267\u884c\uff0c\u5982\u679c\u6709\u8d85\u8fc7\u671f\u9650\u7684\u5de5\u4f5c\u5728\uff0c\u5c31\u6267\u884c\u8be5\u6392\u7a0b\u4efb\u52a1,\u6267\u884c\u5b8c\u6bd5\u6216\u65e0\u987b\u6267\u884c\u4efb\u4f55\u6392\u7a0b\u65f6\uff0canacron \u5c31\u505c\u6b62\u4e86\u3002 anacron \u4f1a\u53bb\u5206\u6790\u73b0\u5728\u7684\u65f6\u95f4\u4e0e\u65f6\u95f4\u8bb0\u5f55\u6587\u4ef6 /var/spool/anacron/cron.daily \u6240\u8bb0\u8f7d\u7684\u4e0a\u6b21\u6267\u884c anacron \u7684\u65f6\u95f4\uff0c\u4e24\u8005\u6bd4\u8f83\u540e\u82e5\u53d1\u73b0\u6709\u5dee\u5f02\uff0c \u90a3\u5c31\u662f\u5728\u67d0\u4e9b\u65f6\u523b\u6ca1\u6709\u8fdb\u884c crontab \u5570!\u6b64\u65f6 anacron \u5c31\u4f1a\u5f00\u59cb\u6267\u884c\u672a\u8fdb\u884c\u7684 crontab \u4efb\u52a1\u4e86\u3002 # \u8fd9\u91cc\u6587\u4ef6\u540d\u52a0\u4e86\u4e2a 0 \u7684\u76ee\u7684\u662f\u6709\u591a\u4e2a\u811a\u672c\u5728\u8be5\u76ee\u5f55\u65f6\u9996\u5148\u6267\u884c anacron\uff0c\u8ba9\u65f6\u95f4\u6233\u5148\u66f4\u65b0\uff0c\u907f\u514d\u8bef\u5224 crontab \u5c1a\u672a\u6267\u884c\u4efb\u4f55\u4efb\u52a1 [ root@dev ~ ] # cat /etc/cron.hourly/0anacron #!/bin/sh # Check whether 0anacron was run today already if test -r /var/spool/anacron/cron.daily ; then day = ` cat /var/spool/anacron/cron.daily ` fi if [ ` date +%Y%m%d ` = \" $day \" ] ; then exit 0 ; fi # \u6d4b\u8bd5\u662f\u5426\u8fde\u63a5\u4e86\u7535\u6e90 # 0 (true)\uff1a System is on line power. # 1 (false)\uff1aSystem is not on line power. # Do not run jobs when on battery power if test -x /usr/bin/on_ac_power ; then /usr/bin/on_ac_power >/dev/null 2 > & 1 if test $? -eq 1 ; then exit 0 fi fi # \u6267\u884c /usr/sbin/anacron -s anacron [ options ] [ job ] ... Options : - s \u5f00\u59cb\u8fde\u7eed\u7684\u6267\u884c\u5404\u9879\u65e5\u7a0b ( job ), \u4f1a\u4f9d\u636e\u65f6\u95f4\u8bb0\u5f55\u6587\u4ef6\u7684\u6570\u636e\u5224\u65ad\u662f\u5426\u8fdb\u884c - f \u5f3a\u5236\u6267\u884c\u65e5\u7a0b \uff0c \u5ffd\u7565\u6240\u6709\u7684\u65f6\u95f4\u6233 - n \u7acb\u5373\u6267\u884c\u65e5\u7a0b \uff0c \u6ca1\u6709\u5ef6\u8fdf \uff0c \u9690\u58eb\u5305\u542b\u4e86 - s \u9009\u9879 - u \u66f4\u65b0\u6240\u6709\u7684\u65f6\u95f4\u6233\u5230\u5f53\u524d\u65e5\u671f \uff0c \u4f46\u4e0d\u6267\u884c\u4efb\u4f55\u65e5\u7a0b anacron \u4ece\u914d\u7f6e\u6587\u4ef6\uff08\u8bf4\u660e\u53ef\u901a\u8fc7 man anacrontab \u67e5\u770b\uff09\u4e2d\u8bfb\u53d6\u4efb\u52a1\uff1a [ root@dev ~ ] # cat /etc/anacrontab # /etc/anacrontab: configuration file for anacron # See anacron(8) and anacrontab(5) for details. SHELL = /bin/sh PATH = /sbin:/bin:/usr/sbin:/usr/bin MAILTO = root # \u5728\u57fa\u7840\u5ef6\u8fdf\u65f6\u95f4\u4e4b\u4e0a\u6dfb\u52a0\u7684\u6700\u5927\u968f\u673a\u5ef6\u8fdf\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u5206\u949f RANDOM_DELAY = 45 # \u65e5\u7a0b\u4f1a\u57283:00-22:00\u5f00\u59cb START_HOURS_RANGE = 3 -22 # \u6267\u884c\u7684\u9891\u7387 \u5ef6\u8fdf\u65f6\u95f4 \u65e5\u7a0bid\uff0c\u53ef\u81ea\u5b9a\u4e49 \u6307\u4ee4 #period in days delay in minutes job-identifier command 1 5 cron.daily nice run-parts /etc/cron.daily # cron.weekly \u7684\u5ef6\u8fdf\u662f 25\u5206\u949f + RANDOM_DELAY 7 25 cron.weekly nice run-parts /etc/cron.weekly @monthly 45 cron.monthly nice run-parts /etc/cron.monthly period in days \uff1a\u82e5\u5f53\u524d\u65f6\u95f4\u4e0e\u65f6\u95f4\u6233\uff08 /var/spool/anacron/cron.{daily,weekly,monthly} \uff09\u7684\u76f8\u5dee\u5929\u6570\u5927\u4e8e\u7b49\u4e8e\u6b64\u65f6\u95f4\uff0c\u5219\u6267\u884c\u8be5\u65e5\u7a0b delay in minutes \uff1a\u57fa\u7840\u5ef6\u8fdf\u65f6\u95f4\uff0c\u5373\u51b3\u5b9a\u6267\u884c\u65e5\u7a0b\u4e4b\u540e\u5ef6\u8fdf\u6267\u884c\u7684\u65f6\u95f4\uff08\u9632\u6b62\u8d44\u6e90\u51b2\u7a81\uff1f\uff09 job-identifier \uff1a\u53d6\u4e2a\u540d\u5b57\u5566\uff0c\u4f1a\u5728 /var/log/cron \u4e2d\u8bb0\u5f55 command \uff1a\u6267\u884c\u7684\u6307\u4ee4","title":"3. anacron"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/17 crontab/#31-crond-anacron","text":"crond \u4f1a\u4e3b\u52a8\u53bb\u8bfb\u53d6 /etc/crontab, /var/spool/cron/*, /etc/cron.d/* \u7b49\u914d\u7f6e\u6587\u4ef6,\u5e76\u4f9d\u636e \u5206\u3001\u65f6\u3001\u65e5\u3001\u6708\u3001\u5468 \u7684\u65f6\u95f4\u8bbe\u5b9a\u53bb\u5404\u9879\u5de5\u4f5c\u6392\u7a0b; \u6839\u636e /etc/cron.d/0hourly \u7684\u8bbe\u5b9a,\u4e3b\u52a8\u53bb /etc/cron.hourly/ \u76ee\u5f55\u4e0b,\u6267\u884c\u6240\u6709\u5728\u8be5\u76ee\u5f55\u4e0b\u7684\u6267\u884c\u6587\u4ef6; \u56e0\u4e3a /etc/cron.hourly/0anacron \u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\u7684\u7f18\u6545,\u4e3b\u52a8\u7684\u6bcf\u5c0f\u65f6\u6267\u884c anacron ,\u5e76\u547c\u53eb /etc/anacrontab \u7684\u914d\u7f6e\u6587\u4ef6; \u6839\u636e /etc/anacrontab \u7684\u8bbe\u5b9a,\u4f9d\u636e\u6bcf\u5929\u3001\u6bcf\u5468\u3001\u6bcf\u6708\u53bb\u5206\u6790 /etc/cron.daily/, /etc/cron.weekly/, /etc/cron.monthly/ \u5185\u7684\u6267\u884c\u6587\u4ef6,\u4ee5\u8fdb\u884c\u56fa\u5b9a\u5468\u671f\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\u3002","title":"3.1 crond \u4e0e anacron \u7684\u5173\u7cfb"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/","text":"1. \u67e5\u770b\u8fdb\u7a0b \u00b6 1.1 ps \u00b6 \u9759\u6001\u67e5\u770b\u3002 ps aux \u67e5\u770b\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u8fdb\u7a0b ps - l \u8f83\u957f\u3001\u8f83\u8be6\u7ec6\u5730\u8f93\u51fa\u4fe1\u606f ps axjf \u4ee5\u8fdb\u7a0b\u6811\u65b9\u5f0f\u5217\u51fa - a \u4e0d\u4e0e terminal \u6709\u5173\u7684\u6240\u6709 process ; - u \u6709\u6548\u4f7f\u7528\u8005 ( effective user ) \u76f8\u5173\u7684 process ; - e , - A \u9009\u62e9\u5168\u90e8\u7684\u8fdb\u7a0b - f \u5b8c\u6574\u683c\u5f0f\u5730\u8f93\u51fa Output formats : x \u901a\u5e38\u4e0e a \u8fd9\u4e2a\u53c2\u6570\u4e00\u8d77\u4f7f\u7528 , \u53ef\u5217\u51fa\u8f83\u5b8c\u6574\u4fe1\u606f\u3002\u6ce8\u610f\uff0c\u4e0d\u662f - a \u53c2\u6570\u3002 aux \u4e0e - aux \u662f\u4e0d\u4e00\u6837\u7684\uff01 f , --forest ascii art process tree j BSD job control format [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 17428 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps \u5404\u4e2a\u5b57\u6bb5\u7684\u542b\u4e49\uff1a F\uff1a\u8fdb\u7a0b\u7684\u6807\u5fd7\u4f4d\u3002 1 forked but didn't exec 4 used super-user privileges S\uff1a\u8fdb\u7a0b\u7684\u72b6\u6001\u4f4d\u3002 D uninterruptible sleep (usually IO) R running or runnable (on run queue) S interruptible sleep (waiting for an event to complete) T stopped by job control signal t stopped by debugger during the tracing W paging (not valid since the 2.6.xx kernel) X dead (should never be seen) Z defunct (\"zombie\") process, terminated but not reaped by its parent C\uff1aCPU\u4f7f\u7528\u7387 PRI\uff1a\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002\u6570\u5b57\u8d8a\u4f4e\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002 NI\uff1anice \u503c\u3002\u8303\u56f4\uff1a 19 (nicest) to -20 (not nice to others)\u3002\u5177\u4f53\u8bf4\u660e\u53c2\u8003\u4e0b\u6587\u3002 ADDR\uff1akernel function\uff0c\u6307\u51fa\u8be5\u8fdb\u7a0b\u5728\u5185\u5b58\u7684\u54ea\u4e2a\u90e8\u5206\uff0c\u5982\u679c\u662f\u4e2a running \u7684\u8fdb\u7a0b,\u4e00\u822c\u5c31\u4f1a\u663e\u793a - \u3002 SZ\uff1a\u5728\u8fdb\u7a0b\u6838\u5fc3\u6620\u50cf\u7684\u7269\u7406\u9875\u9762\u4e2d\u7684\u5927\u5c0f\u3002\u7528\u6389\u591a\u5c11\u5185\u5b58\u3002 WCHAN\uff1a\u8fdb\u7a0b\u662f\u5904\u4e8e\u4f11\u7720\u72b6\u6001\u7684kernel function\u540d\u79f0\u3002 - \u4ee3\u8868running\uff1b * \u4ee3\u8868\u591a\u7ebf\u7a0b\u3002 TIME\uff1a\u6b64\u8fdb\u7a0b\u5b9e\u9645\u82b1\u8d39 CPU \u8fd0\u4f5c\u7684\u65f6\u95f4 [ root@dev ~ ] # ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0 .0 0 .0 194044 7216 ? Ss Nov04 0 :09 /usr/lib/systemd/systemd --switched-root --system --deserialize 22 root 2 0 .0 0 .0 0 0 ? S Nov04 0 :00 [ kthreadd ] root 4 0 .0 0 .0 0 0 ? S< Nov04 0 :00 [ kworker/0:0H ] root 6 0 .0 0 .0 0 0 ? S Nov04 0 :01 [ ksoftirqd/0 ] \u2026\u2026 root 18454 0 .0 0 .0 155372 1872 pts/7 R+ 15 :15 0 :00 ps aux \u5404\u4e2a\u5b57\u6bb5\u7684\u542b\u4e49\uff1a VSZ\uff1a\u8be5 process \u4f7f\u7528\u6389\u7684\u865a\u62df\u5185\u5b58\u91cf (Kbytes) RSS\uff1a\u8be5 process \u5360\u7528\u7684\u56fa\u5b9a\u7684\u5185\u5b58\u91cf (Kbytes) TTY\uff1a\u4e0e\u7ec8\u7aef\u65e0\u5173\u65f6\u4e3a ? STAT\uff1a\u540c S START\uff1a\u542f\u52a8\u65f6\u95f4\uff0c\u82e5\u65f6\u95f4\u8fc7\u957f\uff0c\u5219\u4e0d\u4f1a\u5217\u51fa\u5177\u4f53\u65f6\u95f4\u70b9 [ root@dev ~ ] # ps axjf PPID PID PGID SID TTY TPGID STAT UID TIME COMMAND 3303 17492 17492 17492 pts / 8 17534 Ss 0 0 : 00 \\ _ - bash 17492 17533 17533 17492 pts / 8 17534 S 0 0 : 00 \\ _ su sink 17533 17534 17534 17492 pts / 8 17534 S + 1000 0 : 00 \\ _ bash [ root@dev ~ ] # ps axf PID TTY STAT TIME COMMAND 1.2 top \u00b6 \u52a8\u6001\u67e5\u770b\u3002 top - bcHiOSs - d secs - n max - u | U user - p pid - o fld - w [ cols ] Options - d \u51e0\u79d2\u66f4\u65b0\u4e00\u6b21 - b \u6279\u91cf\u6a21\u5f0f \u3002 \u5728\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u5176\u4ed6\u7a0b\u5e8f\u6216\u6587\u4ef6\u65f6\u5f88\u6709\u7528 - n \u4e0e - b \u642d\u914d\u4f7f\u7528 \uff0c \u8868\u793a\u8fed\u4ee3\u591a\u5c11\u6b21 - o \u6309\u7167\u54ea\u4e2a\u5b57\u6bb5\u6392\u5e8f \u3002 \u5728\u5b57\u6bb5\u524d\u6dfb\u52a0\u7279\u6b8a\u7b26\u53f7\u6307\u5b9a\u987a\u5e8f\u8fd8\u662f\u964d\u5e8f \uff1a + \u8868\u793a\u964d\u5e8f\u6392\u5217 \uff1b - \u8868\u793a\u5347\u5e8f\u6392\u5217 \u3002 # 3\u79d2\u66f4\u65b0\u4e00\u6b21\uff0c\u4ee5 PID \u964d\u5e8f\u6392\u5e8f [ root@dev ~ ] # top -d 3 -o -PID top - 09 :52:18 up 2 days, 1 :11, 10 users, load average: 0 .37, 0 .40, 0 .34 Tasks: 292 total, 1 running, 291 sleeping, 0 stopped, 0 zombie %Cpu ( s ) : 4 .1 us, 4 .1 sy, 0 .0 ni, 91 .9 id, 0 .0 wa, 0 .0 hi, 0 .0 si, 0 .0 st KiB Mem : 16247672 total, 6168780 free, 5853688 used, 4225204 buff/cache KiB Swap: 5242876 total, 5242876 free, 0 used. 9880640 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 194044 7216 4180 S 0 .0 0 .0 0 :12.42 systemd 2 root 20 0 0 0 0 S 0 .0 0 .0 0 :00.24 kthreadd 4 root 0 -20 0 0 0 S 0 .0 0 .0 0 :00.00 kworker/0:0H \u4e0a\u534a\u90e8\u5206\u7684\u5185\u5bb9\uff1a \u7b2c\u4e00\u884c\uff1a \u5f53\u524d\u65f6\u95f4\u662f 09:52:18\u3002 \u5df2\u7ecf\u5f00\u673a2\u59291\u5c0f\u65f611\u5206\u949f\u4e86\u3002 \u5df2\u767b\u5165\u7cfb\u7edf\u7684\u4eba\u6570\u3002\u540c\u4e00\u4e2a\u8d26\u6237\u53ef\u5728\u4e0d\u540c\u7ec8\u7aef\u540c\u65f6\u767b\u5165\u3002 \u7cfb\u7edf\u5728 1, 5, 15 \u5206\u949f\u7684\u5e73\u5747\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5de5\u4f5c\u8d1f\u8f7d\u662f\u7cfb\u7edf\u5e73\u5747\u8981\u8d1f\u8d23\u8fd0\u4f5c\u51e0\u4e2a\u8fdb\u7a0b(\u5de5\u4f5c)\u7684\u610f\u601d\u3002 \u7b2c\u4e8c\u884c\uff0c\u8868\u793a\u8fdb\u7a0b\u7684\u603b\u4f53\u72b6\u6001 \u7b2c\u4e09\u884c\uff0c\u8868\u793a CPU \u7684\u6574\u4f53\u8d1f\u8f7d us, user : time running un-niced user processes sy, system : time running kernel processes ni, nice : time running niced user processes id, idle : time spent in the kernel idle handler\uff0c\u5185\u6838\u7a7a\u95f2 wa, IO-wait : time waiting for I/O completion\u3002\u5982\u679c\u662f\u591a\u6838\u5fc3\u7684\u8bbe\u5907,\u53ef\u4ee5\u6309\u4e0b\u6570\u5b57\u952e 1 \u6765\u5207\u6362\u6210\u4e0d\u540cCPU \u7684\u8d1f\u8f7d\u7387\u3002 hi : time spent servicing hardware interrupts si : time spent servicing software interrupts st : time stolen from this vm by the hypervisor \u7b2c\u56db\u884c\uff0c\u8868\u793a\u7269\u7406\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5 \u7b2c\u4e94\u884c\uff0c\u8868\u793a\u865a\u62df\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5 \u4e0b\u534a\u90e8\u5206\u7684\u5185\u5bb9\uff1a PR\uff1a\u4f18\u5148\u7ea7 NI\uff1anice\uff0c\u4e0ePR\u6709\u5173\uff0c\u4e5f\u662f\u8d8a\u5c0f\u8d8a\u65e9\u88ab\u6267\u884c # \u5c06\u4e09\u6b21\u7684\u7ed3\u679c\u8f93\u51fa\u5230\u6587\u4ef6 [ root@dev ~ ] # top -b -n 3 > top.log # \u53ea\u67e5\u770b\u6307\u5b9a\u7684\u8fdb\u7a0b [ root@dev ~ ] # top -p 1 -p 4 \u5176\u5b9e\u5728\u6267\u884ctop\u4e4b\u540e\u8fd8\u6709\u4e00\u4e9b\u6307\u4ee4\u53ef\u4ee5\u6267\u884c\uff0c\u6309\u4e0b h \u6765\u67e5\u770b\u5427\u3002 1.3 pstree \u00b6 \u663e\u793a\u8fdb\u7a0b\u6811\u3002 pstree [ options ] [ pid , user ] options - A Use ASCII characters to draw the tree . - U Use UTF - 8 ( Unicode ) line drawing characters . - p Show PIDs . - u Show uid transitions . [ root@dev ~ ] # pstree -pu | grep sink | | -bash ( 17492 ) ---su ( 17533 ) ---bash ( 17534 ,sink ) [ root@dev ~ ] # pstree -pu 2883 xdg-permission- ( 2883 ) \u2500\u252c\u2500 { xdg-permission- }( 2884 ) \u2514\u2500 { xdg-permission- }( 2886 ) [ root@dev ~ ] # pstree -pu sink bash ( 17534 ) 2. \u7ed3\u675f\u8fdb\u7a0b \u00b6 killall \u53ef\u4ee5\u901a\u8fc7\u8fdb\u7a0b\u7684\u540d\u5b57\u6765\u6740\u6389\u8fdb\u7a0b\u3002 killall [ options ] [ -- ] command_name ... options - e , -- exact \u7cbe\u786e\u5339\u914d command_name \u3002\u4e0d\u5f97\u8d85\u8fc7 15 \u4e2a\u5b57\u7b26 - i , -- interactive \u5728 kill \u8fdb\u7a0b\u4e4b\u524d\u4ea4\u4e92\u5f0f\u5730\u8be2\u95ee - I , -- ignore - case \u5ffd\u7565\u5927\u5c0f\u5199 - l , -- list List all known signal names . - s , -- signal Send this signal instead of SIGTERM . - u , -- user Kill only processes the specified user owns . Command names are optional . [ root@dev ~ ] # killall -9 httpd 3. \u8fdb\u7a0b\u6267\u884c\u987a\u5e8f \u00b6 \u8fdb\u7a0b\u7684\u4f18\u5148\u6267\u884c\u5e8f (Priority) \u4e0e CPU \u6392\u7a0b\u3002CPU \u6392\u7a0b\u6307\u7684\u662f\u6bcf\u652f\u8fdb\u7a0b\u88ab CPU \u8fd0\u4f5c\u7684\u6f14\u7b97\u89c4\u5219\u3002 3.1 Priority \u4e0e Nice \u503c \u00b6 PRI (Priority) \u503c\u662f \u7531\u5185\u6838\u52a8\u6001\u8c03\u6574 \u7684, \u7528\u6237\u65e0\u6cd5\u76f4\u63a5\u8c03\u6574 PRI \u503c\u7684\u3002 \u5982\u679c\u4f60\u60f3\u8981\u8c03\u6574\u8fdb\u7a0b\u7684\u4f18\u5148\u6267\u884c\u5e8f\u65f6,\u5c31\u5f97\u8981\u900f\u8fc7 NI (Nice) \u503c\u4e86\u3002 PRI \u4e0e NI \u7684\u5173\u7cfb\u5982\u4e0b\uff1a PRI(new) = PRI(old) + nice \u867d\u7136 nice \u503c\u662f\u53ef\u4ee5\u5f71\u54cd PRI \uff0c\u4e0d\u8fc7\uff0c\u6700\u7ec8\u7684 PRI \u4ecd\u662f\u8981 \u7ecf\u8fc7\u7cfb\u7edf\u5206\u6790 \u540e\u624d\u4f1a\u51b3\u5b9a\u7684\u3002 NI \u7684\u4f7f\u7528\u4e8b\u9879\uff1a nice \u503c\u53ef\u8c03\u6574\u7684\u8303\u56f4\u4e3a -20 ~ 19 ; root \u53ef\u968f\u610f\u8c03\u6574\u81ea\u5df1\u6216\u4ed6\u4eba\u8fdb\u7a0b\u7684 Nice \u503c,\u4e14\u8303\u56f4\u4e3a -20 ~ 19 ; \u4e00\u822c\u4f7f\u7528\u8005\u4ec5\u53ef\u8c03\u6574\u81ea\u5df1\u8fdb\u7a0b\u7684 Nice \u503c,\u4e14\u8303\u56f4\u4ec5\u4e3a 0 ~ 19 (\u907f\u514d\u4e00\u822c\u7528\u6237\u62a2\u5360\u7cfb\u7edf\u8d44\u6e90); \u4e00\u822c\u4f7f\u7528\u8005\u4ec5\u53ef\u5c06 nice \u503c\u8d8a\u8c03\u8d8a\u9ad8,\u4f8b\u5982\u672c\u6765 nice \u4e3a 5 ,\u5219\u672a\u6765\u4ec5\u80fd\u8c03\u6574\u5230\u5927\u4e8e 5; \u5728top\u8fd0\u884c\u7684\u65f6\u5019\u662f\u53ef\u4ee5\u901a\u8fc7\u952e\u5165 r \u6765\u8c03\u6574nice\u503c\u7684\u3002\u4e0b\u9762\u4ecb\u7ecd\u8c03\u6574 NI \u7684\u53e6\u5916\u4e24\u79cd\u65b9\u5f0f\u3002 3.1.1 nice\uff1a\u65b0\u6267\u884c\u7684\u6307\u4ee4\u5373\u7ed9\u4e88\u65b0\u7684 nice \u503c \u00b6 nice [ OPTION ] [ COMMAND [ARG ] ... ] OPTION - n , --adjustment=N add integer N to the niceness (default 10) [ root@dev ~ ] # nice -n -23 vi & [ root@dev ~ ] # vi & [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash # \u6bcf\u6b21\u4e0d\u4e00\u5b9a\u4f1a\u6b63\u597d\u7b26\u5408\u516c\u5f0f\uff0c\u5185\u6838\u4f1a\u52a8\u6001\u8c03\u6574\u7684 4 T 0 31430 15352 0 60 -20 - 31061 do_sig pts/7 00 :00:00 vi 0 T 0 31444 15352 0 80 0 - 31061 do_sig pts/7 00 :00:00 vi 0 R 0 31448 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # killall -9 vi [ 1 ] - Killed nice -n -23 vi [ 2 ] + Killed vi 3.1.2 renice\uff1a\u5bf9\u5b58\u5728\u8fdb\u7a0b\u7684 nice \u91cd\u65b0\u8c03\u6574 \u00b6 renice [ - n ] priority [ - gpu ] identifier ... OPTIONS - n , --priority priority \u5982\u679c\u4f7f\u7528\u8be5\u9009\u9879\uff0c\u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a\u53c2\u6570 - g , --pgrp pgid... - u , --user name_or_uid... - p , --pid pid... # root\u7528\u6237\u8c03\u6574 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31608 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # renice -n -5 15352 15352 ( process ID ) old priority 0 , new priority -5 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 75 -5 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31615 15352 0 75 -5 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # renice -n 5 15352 15352 ( process ID ) old priority -5, new priority 5 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 85 5 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31619 15352 0 85 5 - 38312 - pts/7 00 :00:00 ps # \u666e\u901a\u7528\u6237\u8c03\u6574 [ sink@dev ~ ] $ ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 1000 17534 17533 0 80 0 - 29223 do_wai pts/8 00 :00:00 bash 0 R 1000 31626 17534 0 80 0 - 38312 - pts/8 00 :00:00 ps [ sink@dev ~ ] $ renice -n -10 17534 renice: failed to set priority for 17534 ( process ID ) : Permission denied [ sink@dev ~ ] $ renice 3 17534 17534 ( process ID ) old priority 0 , new priority 3 [ sink@dev ~ ] $ ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 1000 17534 17533 0 83 3 - 29223 do_wai pts/8 00 :00:00 bash 0 R 1000 31649 17534 0 83 3 - 38312 - pts/8 00 :00:00 ps \u5728\u8c03\u6574\u4e86 bash \u7684 nice \u4e4b\u540e\uff0c ps \u7684nice \u4e5f\u8ddf\u7740\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd9\u662f\u56e0\u4e3a \u6574\u4e2a nice \u503c\u662f\u53ef\u4ee5\u5728\u7236\u8fdb\u7a0b --> \u5b50\u8fdb\u7a0b\u4e4b\u95f4\u4f20\u9012\u7684 \u3002 4. \u7279\u6b8a\u6587\u4ef6\u4e0e\u8fdb\u7a0b \u00b6 4.1 \u5177\u6709 SUID/SGID \u6743\u9650\u7684\u6307\u4ee4\u6267\u884c\u72b6\u6001 \u00b6 \u5728\u89e6\u53d1\u5177\u6709 SUID \u7684\u7a0b\u5e8f\u540e,\u4f1a\u53d6\u5f97\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u4e0e PID\uff0c\u8be5 PID \u4ea7\u751f\u65f6\u900f\u8fc7 SUID \u6765\u7ed9\u4e88\u8be5 PID \u7279\u6b8a\u7684\u6743\u9650\u8bbe\u5b9a [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 Aug 9 09 :39 /usr/bin/passwd [ sink@dev ~ ] $ passwd Changing password for user sink. Changing password for sink. # \u6b64\u5904\u6309\u4e0b Ctl+Z \u4e0e \u56de\u8f66 ( current ) UNIX password: [ 1 ] + Stopped passwd [ sink@dev ~ ] $ pstree -pu | sed -n '/passwd/p' | | -bash ( 17492 ) ---su ( 34364 ) ---bash ( 34365 ,sink ) -+-passwd ( 35160 ,root ) \u53ef\u4ee5\u770b\u5230\u7236\u8fdb\u7a0b\uff08bash(34365,sink)\uff09\u7684\u7528\u6237\u662fsink\uff0c\u4f46\u662f\u5176\u5b50\u8fdb\u7a0b\uff08passwd(35160,root)\uff09\u7684\u7528\u6237\u53d8\u4e3a\u4e86root\u3002 4.2 /proc/* \u4ee3\u8868\u7684\u610f\u4e49 \u00b6 \u8fdb\u7a0b\u90fd\u662f\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u800c\u5185\u5b58\u5f53\u4e2d\u7684\u6570\u636e\u53c8\u90fd\u662f\u5199\u5165\u5230 /proc/* \u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u3002\u57fa\u672c\u4e0a\uff0c\u76ee\u524d\u4e3b\u673a\u4e0a\u9762\u7684\u5404\u4e2a\u8fdb\u7a0b\u7684 PID \u90fd\u662f\u4ee5\u76ee\u5f55\u7684\u578b\u6001\u5b58\u5728\u4e8e /proc \u5f53\u4e2d\u3002 [ root@dev ~ ] # ll /proc/1/ total 0 dr-xr-xr-x. 2 root root 0 Nov 6 15 :05 attr -rw-r--r--. 1 root root 0 Nov 7 16 :15 autogroup -r--------. 1 root root 0 Nov 7 16 :15 auxv -r--r--r--. 1 root root 0 Nov 4 08 :40 cgroup \u2026\u2026 \u91cd\u70b9\u5728\u4ee5\u4e0b\u4e24\u4e2a\u6587\u4ef6 cmdline\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u88ab\u542f\u52a8\u7684\u6307\u4ee4\u4e32 environ\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u73af\u5883\u53d8\u91cf\u5185\u5bb9 [ root@dev ~ ] # cat /proc/1/cmdline /usr/lib/systemd/systemd--switched-root--system--deserialize22 \u5305\u542b\u4e86\u6307\u4ee4\u3001\u9009\u9879\u4e0e\u53c2\u6570\uff0c\u9488\u5bf9\u7684\u662f\u8fdb\u7a0b\uff1b\u90a3\u4e48\u9488\u5bf9\u7cfb\u7edf\u7684\u6587\u4ef6\u5c31\u662f\u76f4\u63a5\u5728 /proc/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5566\u3002 4.3 \u67e5\u8be2\u5df2\u5f00\u542f\u6587\u4ef6\u6216\u5df2\u6267\u884c\u8fdb\u7a0b\u5f00\u542f\u7684\u6587\u4ef6 \u00b6 4.3.1 fuser\uff1a\u7531\u6587\u4ef6\u627e\u8fdb\u7a0b \u00b6 fuser [ - fuv ] [ - a |- s ] [ - 4 |- 6 ] [ - c |- m |- n space ] [ - k [ - i ] [ - M ] [ - w ] [ - SIGNAL ] ] name ... OPTIONS - u , -- user Append the user name of the process owner to each PID . - v , -- verbose \u5217\u51fa USER , PID , ACCESS and COMMAND . - a , -- all Show all files specified on the command line . - m , -- mount show all processes using the named filesystems or block device - i , -- interactive ask before killing ( ignored without - k ) - k , -- kill kill processes accessing the named file - SIGNAL send this signal instead of SIGKILL [ root@dev ~ ] # fuser -u /bin/bash /usr/bin/bash: 3313e ( root ) 3366e ( root ) 3367e ( root ) 3819e ( root ) 3906e ( root ) 4051e ( root ) 4249e ( root ) 4569e ( root ) 15352e ( root ) 17492e ( root ) 34365e ( sink ) 92679e ( root ) 92736e ( sink ) 95880e ( root ) 108664e ( root ) 108729e ( sink ) [ root@dev ~ ] # fuser -uv /bin/bash USER PID ACCESS COMMAND /usr/bin/bash: root 3313 ...e. ( root ) bash root 3366 ...e. ( root ) pycharm-start root 3367 ...e. ( root ) pycharm.sh root 3819 ...e. ( root ) bash \u2026\u2026 ACCESS\u6240\u4ee3\u8868\u7684\u610f\u4e49\uff1a c current directory. e executable being run. f open file. f is omitted in default display mode. F open file for writing. F is omitted in default display mode. r root directory. \u9876\u5c42\u76ee\u5f55 m mmap'ed file or shared library. [ root@dev ~ ] # fuser -uv .top.log.swp USER PID ACCESS COMMAND /root/.top.log.swp: root 114662 F.... ( root ) vi 4.3.2 lsof\uff1a\u7531\u8fdb\u7a0b\u627e\u6587\u4ef6 \u00b6 lsof [ options ] [ -- ] [ names ] OPTIONS - a \u6761\u4ef6\u53c2\u6570 \uff0c \u610f\u601d\u662f\u5728\u4e24\u8fb9\u7684\u9009\u9879\u90fd\u6210\u7acb\u65f6\u624d\u5217\u51fa \uff0c \u5373\u903b\u8f91\u4e0e - U \u53ea\u5217\u51fa UNIX socket files . - u s \u5217\u51fa\u8be5\u4f7f\u7528\u8005\u76f8\u5173\u8fdb\u7a0b\u6240\u5f00\u542f\u7684\u6587\u4ef6 \u3002 e . g ., `` sink '' , or `` 548 , root '' . \u4e0d\u80fd\u6709\u7a7a\u683c + D D \u627e\u51fa\u67d0\u4e2a\u76ee\u5f55\u5e95\u4e0b\u5df2\u7ecf\u88ab\u5f00\u542f\u7684\u6587\u4ef6 - i [ i ] - P \u7981\u6b62\u5c06\u7aef\u53e3\u53f7\u8f6c\u6362\u4e3a\u7f51\u7edc\u6587\u4ef6\u7684\u7aef\u53e3\u540d\u79f0 \u3002 [ root@dev ~ ] # lsof | less # NODE \u5373 inode COMMAND PID TID USER FD TYPE DEVICE SIZE/OFF NODE NAME systemd 1 root cwd DIR 253 ,0 246 64 / systemd 1 root rtd DIR 253 ,0 246 64 / systemd 1 root txt REG 253 ,0 1624552 101335647 /usr/lib/systemd/systemd systemd 1 root mem REG 253 ,0 20064 2142819 /usr/lib64/libuuid.so.1.3.0 # \u65e2\u662f root \u53c8\u662f socket \u6587\u4ef6 [ root@dev ~ ] # lsof -u root -a -U \u2026\u2026 # \u7f51\u7edc\u6587\u4ef6 [ root@dev ~ ] # lsof -u root -a -i 4 -P COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME systemd 1 root 42u IPv4 24643 0t0 TCP *:111 ( LISTEN ) systemd 1 root 43u IPv4 24644 0t0 UDP *:111 sshd 1861 root 3u IPv4 33055 0t0 TCP *:22 ( LISTEN ) cupsd 1863 root 12u IPv4 29388 0t0 TCP localhost:631 ( LISTEN ) \u2026\u2026 # \u5217\u51fa\u6587\u4ef6\u5939\u4e0b\u88ab\u6253\u5f00\u7684\u6587\u4ef6 [ root@dev ~ ] # lsof +d . COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME gnome-ses 2647 root cwd DIR 253 ,0 4096 67153985 . \u2026\u2026 4.3.3 pidof\uff1a\u67e5\u627e\u6b63\u5728\u8fd0\u884c\u7684\u7a0b\u5e8f\u7684\u8fdb\u7a0b ID\u3002 \u00b6 pidof [ options ] program [ program.. ] OPTIONS - s \u53ea\u8fd4\u56de\u4e00\u4e2a pid - x \u540c\u65f6\u5217\u51fa\u8be5 program name \u53ef\u80fd\u7684 PPID \u90a3\u4e2a\u8fdb\u7a0b\u7684 PID # \u666e\u901a\u7528\u6237\u4e5f\u80fd\u67e5\u5230 root \u7528\u6237\u7684\u8fdb\u7a0b [ sink@dev ~ ] $ pidof vi bash | xargs ps -fp UID PID PPID C STIME TTY STAT TIME CMD root 3313 3303 0 Nov04 pts/0 Ss 0 :00 -bash root 3366 3313 0 Nov04 pts/0 S+ 0 :00 /bin/bash /usr/local/bin/pycharm-start root 3819 3303 0 Nov04 pts/2 Ss 0 :00 -bash root 118382 17492 0 17 :20 pts/8 T 0 :00 vi top.log \u2026\u2026","title":"18 \u8fdb\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#1","text":"","title":"1. \u67e5\u770b\u8fdb\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#11-ps","text":"\u9759\u6001\u67e5\u770b\u3002 ps aux \u67e5\u770b\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u8fdb\u7a0b ps - l \u8f83\u957f\u3001\u8f83\u8be6\u7ec6\u5730\u8f93\u51fa\u4fe1\u606f ps axjf \u4ee5\u8fdb\u7a0b\u6811\u65b9\u5f0f\u5217\u51fa - a \u4e0d\u4e0e terminal \u6709\u5173\u7684\u6240\u6709 process ; - u \u6709\u6548\u4f7f\u7528\u8005 ( effective user ) \u76f8\u5173\u7684 process ; - e , - A \u9009\u62e9\u5168\u90e8\u7684\u8fdb\u7a0b - f \u5b8c\u6574\u683c\u5f0f\u5730\u8f93\u51fa Output formats : x \u901a\u5e38\u4e0e a \u8fd9\u4e2a\u53c2\u6570\u4e00\u8d77\u4f7f\u7528 , \u53ef\u5217\u51fa\u8f83\u5b8c\u6574\u4fe1\u606f\u3002\u6ce8\u610f\uff0c\u4e0d\u662f - a \u53c2\u6570\u3002 aux \u4e0e - aux \u662f\u4e0d\u4e00\u6837\u7684\uff01 f , --forest ascii art process tree j BSD job control format [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 17428 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps \u5404\u4e2a\u5b57\u6bb5\u7684\u542b\u4e49\uff1a F\uff1a\u8fdb\u7a0b\u7684\u6807\u5fd7\u4f4d\u3002 1 forked but didn't exec 4 used super-user privileges S\uff1a\u8fdb\u7a0b\u7684\u72b6\u6001\u4f4d\u3002 D uninterruptible sleep (usually IO) R running or runnable (on run queue) S interruptible sleep (waiting for an event to complete) T stopped by job control signal t stopped by debugger during the tracing W paging (not valid since the 2.6.xx kernel) X dead (should never be seen) Z defunct (\"zombie\") process, terminated but not reaped by its parent C\uff1aCPU\u4f7f\u7528\u7387 PRI\uff1a\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002\u6570\u5b57\u8d8a\u4f4e\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002 NI\uff1anice \u503c\u3002\u8303\u56f4\uff1a 19 (nicest) to -20 (not nice to others)\u3002\u5177\u4f53\u8bf4\u660e\u53c2\u8003\u4e0b\u6587\u3002 ADDR\uff1akernel function\uff0c\u6307\u51fa\u8be5\u8fdb\u7a0b\u5728\u5185\u5b58\u7684\u54ea\u4e2a\u90e8\u5206\uff0c\u5982\u679c\u662f\u4e2a running \u7684\u8fdb\u7a0b,\u4e00\u822c\u5c31\u4f1a\u663e\u793a - \u3002 SZ\uff1a\u5728\u8fdb\u7a0b\u6838\u5fc3\u6620\u50cf\u7684\u7269\u7406\u9875\u9762\u4e2d\u7684\u5927\u5c0f\u3002\u7528\u6389\u591a\u5c11\u5185\u5b58\u3002 WCHAN\uff1a\u8fdb\u7a0b\u662f\u5904\u4e8e\u4f11\u7720\u72b6\u6001\u7684kernel function\u540d\u79f0\u3002 - \u4ee3\u8868running\uff1b * \u4ee3\u8868\u591a\u7ebf\u7a0b\u3002 TIME\uff1a\u6b64\u8fdb\u7a0b\u5b9e\u9645\u82b1\u8d39 CPU \u8fd0\u4f5c\u7684\u65f6\u95f4 [ root@dev ~ ] # ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0 .0 0 .0 194044 7216 ? Ss Nov04 0 :09 /usr/lib/systemd/systemd --switched-root --system --deserialize 22 root 2 0 .0 0 .0 0 0 ? S Nov04 0 :00 [ kthreadd ] root 4 0 .0 0 .0 0 0 ? S< Nov04 0 :00 [ kworker/0:0H ] root 6 0 .0 0 .0 0 0 ? S Nov04 0 :01 [ ksoftirqd/0 ] \u2026\u2026 root 18454 0 .0 0 .0 155372 1872 pts/7 R+ 15 :15 0 :00 ps aux \u5404\u4e2a\u5b57\u6bb5\u7684\u542b\u4e49\uff1a VSZ\uff1a\u8be5 process \u4f7f\u7528\u6389\u7684\u865a\u62df\u5185\u5b58\u91cf (Kbytes) RSS\uff1a\u8be5 process \u5360\u7528\u7684\u56fa\u5b9a\u7684\u5185\u5b58\u91cf (Kbytes) TTY\uff1a\u4e0e\u7ec8\u7aef\u65e0\u5173\u65f6\u4e3a ? STAT\uff1a\u540c S START\uff1a\u542f\u52a8\u65f6\u95f4\uff0c\u82e5\u65f6\u95f4\u8fc7\u957f\uff0c\u5219\u4e0d\u4f1a\u5217\u51fa\u5177\u4f53\u65f6\u95f4\u70b9 [ root@dev ~ ] # ps axjf PPID PID PGID SID TTY TPGID STAT UID TIME COMMAND 3303 17492 17492 17492 pts / 8 17534 Ss 0 0 : 00 \\ _ - bash 17492 17533 17533 17492 pts / 8 17534 S 0 0 : 00 \\ _ su sink 17533 17534 17534 17492 pts / 8 17534 S + 1000 0 : 00 \\ _ bash [ root@dev ~ ] # ps axf PID TTY STAT TIME COMMAND","title":"1.1 ps"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#12-top","text":"\u52a8\u6001\u67e5\u770b\u3002 top - bcHiOSs - d secs - n max - u | U user - p pid - o fld - w [ cols ] Options - d \u51e0\u79d2\u66f4\u65b0\u4e00\u6b21 - b \u6279\u91cf\u6a21\u5f0f \u3002 \u5728\u5c06\u4fe1\u606f\u8f93\u51fa\u5230\u5176\u4ed6\u7a0b\u5e8f\u6216\u6587\u4ef6\u65f6\u5f88\u6709\u7528 - n \u4e0e - b \u642d\u914d\u4f7f\u7528 \uff0c \u8868\u793a\u8fed\u4ee3\u591a\u5c11\u6b21 - o \u6309\u7167\u54ea\u4e2a\u5b57\u6bb5\u6392\u5e8f \u3002 \u5728\u5b57\u6bb5\u524d\u6dfb\u52a0\u7279\u6b8a\u7b26\u53f7\u6307\u5b9a\u987a\u5e8f\u8fd8\u662f\u964d\u5e8f \uff1a + \u8868\u793a\u964d\u5e8f\u6392\u5217 \uff1b - \u8868\u793a\u5347\u5e8f\u6392\u5217 \u3002 # 3\u79d2\u66f4\u65b0\u4e00\u6b21\uff0c\u4ee5 PID \u964d\u5e8f\u6392\u5e8f [ root@dev ~ ] # top -d 3 -o -PID top - 09 :52:18 up 2 days, 1 :11, 10 users, load average: 0 .37, 0 .40, 0 .34 Tasks: 292 total, 1 running, 291 sleeping, 0 stopped, 0 zombie %Cpu ( s ) : 4 .1 us, 4 .1 sy, 0 .0 ni, 91 .9 id, 0 .0 wa, 0 .0 hi, 0 .0 si, 0 .0 st KiB Mem : 16247672 total, 6168780 free, 5853688 used, 4225204 buff/cache KiB Swap: 5242876 total, 5242876 free, 0 used. 9880640 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 1 root 20 0 194044 7216 4180 S 0 .0 0 .0 0 :12.42 systemd 2 root 20 0 0 0 0 S 0 .0 0 .0 0 :00.24 kthreadd 4 root 0 -20 0 0 0 S 0 .0 0 .0 0 :00.00 kworker/0:0H \u4e0a\u534a\u90e8\u5206\u7684\u5185\u5bb9\uff1a \u7b2c\u4e00\u884c\uff1a \u5f53\u524d\u65f6\u95f4\u662f 09:52:18\u3002 \u5df2\u7ecf\u5f00\u673a2\u59291\u5c0f\u65f611\u5206\u949f\u4e86\u3002 \u5df2\u767b\u5165\u7cfb\u7edf\u7684\u4eba\u6570\u3002\u540c\u4e00\u4e2a\u8d26\u6237\u53ef\u5728\u4e0d\u540c\u7ec8\u7aef\u540c\u65f6\u767b\u5165\u3002 \u7cfb\u7edf\u5728 1, 5, 15 \u5206\u949f\u7684\u5e73\u5747\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5de5\u4f5c\u8d1f\u8f7d\u662f\u7cfb\u7edf\u5e73\u5747\u8981\u8d1f\u8d23\u8fd0\u4f5c\u51e0\u4e2a\u8fdb\u7a0b(\u5de5\u4f5c)\u7684\u610f\u601d\u3002 \u7b2c\u4e8c\u884c\uff0c\u8868\u793a\u8fdb\u7a0b\u7684\u603b\u4f53\u72b6\u6001 \u7b2c\u4e09\u884c\uff0c\u8868\u793a CPU \u7684\u6574\u4f53\u8d1f\u8f7d us, user : time running un-niced user processes sy, system : time running kernel processes ni, nice : time running niced user processes id, idle : time spent in the kernel idle handler\uff0c\u5185\u6838\u7a7a\u95f2 wa, IO-wait : time waiting for I/O completion\u3002\u5982\u679c\u662f\u591a\u6838\u5fc3\u7684\u8bbe\u5907,\u53ef\u4ee5\u6309\u4e0b\u6570\u5b57\u952e 1 \u6765\u5207\u6362\u6210\u4e0d\u540cCPU \u7684\u8d1f\u8f7d\u7387\u3002 hi : time spent servicing hardware interrupts si : time spent servicing software interrupts st : time stolen from this vm by the hypervisor \u7b2c\u56db\u884c\uff0c\u8868\u793a\u7269\u7406\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5 \u7b2c\u4e94\u884c\uff0c\u8868\u793a\u865a\u62df\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5 \u4e0b\u534a\u90e8\u5206\u7684\u5185\u5bb9\uff1a PR\uff1a\u4f18\u5148\u7ea7 NI\uff1anice\uff0c\u4e0ePR\u6709\u5173\uff0c\u4e5f\u662f\u8d8a\u5c0f\u8d8a\u65e9\u88ab\u6267\u884c # \u5c06\u4e09\u6b21\u7684\u7ed3\u679c\u8f93\u51fa\u5230\u6587\u4ef6 [ root@dev ~ ] # top -b -n 3 > top.log # \u53ea\u67e5\u770b\u6307\u5b9a\u7684\u8fdb\u7a0b [ root@dev ~ ] # top -p 1 -p 4 \u5176\u5b9e\u5728\u6267\u884ctop\u4e4b\u540e\u8fd8\u6709\u4e00\u4e9b\u6307\u4ee4\u53ef\u4ee5\u6267\u884c\uff0c\u6309\u4e0b h \u6765\u67e5\u770b\u5427\u3002","title":"1.2 top"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#13-pstree","text":"\u663e\u793a\u8fdb\u7a0b\u6811\u3002 pstree [ options ] [ pid , user ] options - A Use ASCII characters to draw the tree . - U Use UTF - 8 ( Unicode ) line drawing characters . - p Show PIDs . - u Show uid transitions . [ root@dev ~ ] # pstree -pu | grep sink | | -bash ( 17492 ) ---su ( 17533 ) ---bash ( 17534 ,sink ) [ root@dev ~ ] # pstree -pu 2883 xdg-permission- ( 2883 ) \u2500\u252c\u2500 { xdg-permission- }( 2884 ) \u2514\u2500 { xdg-permission- }( 2886 ) [ root@dev ~ ] # pstree -pu sink bash ( 17534 )","title":"1.3 pstree"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#2","text":"killall \u53ef\u4ee5\u901a\u8fc7\u8fdb\u7a0b\u7684\u540d\u5b57\u6765\u6740\u6389\u8fdb\u7a0b\u3002 killall [ options ] [ -- ] command_name ... options - e , -- exact \u7cbe\u786e\u5339\u914d command_name \u3002\u4e0d\u5f97\u8d85\u8fc7 15 \u4e2a\u5b57\u7b26 - i , -- interactive \u5728 kill \u8fdb\u7a0b\u4e4b\u524d\u4ea4\u4e92\u5f0f\u5730\u8be2\u95ee - I , -- ignore - case \u5ffd\u7565\u5927\u5c0f\u5199 - l , -- list List all known signal names . - s , -- signal Send this signal instead of SIGTERM . - u , -- user Kill only processes the specified user owns . Command names are optional . [ root@dev ~ ] # killall -9 httpd","title":"2. \u7ed3\u675f\u8fdb\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#3","text":"\u8fdb\u7a0b\u7684\u4f18\u5148\u6267\u884c\u5e8f (Priority) \u4e0e CPU \u6392\u7a0b\u3002CPU \u6392\u7a0b\u6307\u7684\u662f\u6bcf\u652f\u8fdb\u7a0b\u88ab CPU \u8fd0\u4f5c\u7684\u6f14\u7b97\u89c4\u5219\u3002","title":"3. \u8fdb\u7a0b\u6267\u884c\u987a\u5e8f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#31-priority-nice","text":"PRI (Priority) \u503c\u662f \u7531\u5185\u6838\u52a8\u6001\u8c03\u6574 \u7684, \u7528\u6237\u65e0\u6cd5\u76f4\u63a5\u8c03\u6574 PRI \u503c\u7684\u3002 \u5982\u679c\u4f60\u60f3\u8981\u8c03\u6574\u8fdb\u7a0b\u7684\u4f18\u5148\u6267\u884c\u5e8f\u65f6,\u5c31\u5f97\u8981\u900f\u8fc7 NI (Nice) \u503c\u4e86\u3002 PRI \u4e0e NI \u7684\u5173\u7cfb\u5982\u4e0b\uff1a PRI(new) = PRI(old) + nice \u867d\u7136 nice \u503c\u662f\u53ef\u4ee5\u5f71\u54cd PRI \uff0c\u4e0d\u8fc7\uff0c\u6700\u7ec8\u7684 PRI \u4ecd\u662f\u8981 \u7ecf\u8fc7\u7cfb\u7edf\u5206\u6790 \u540e\u624d\u4f1a\u51b3\u5b9a\u7684\u3002 NI \u7684\u4f7f\u7528\u4e8b\u9879\uff1a nice \u503c\u53ef\u8c03\u6574\u7684\u8303\u56f4\u4e3a -20 ~ 19 ; root \u53ef\u968f\u610f\u8c03\u6574\u81ea\u5df1\u6216\u4ed6\u4eba\u8fdb\u7a0b\u7684 Nice \u503c,\u4e14\u8303\u56f4\u4e3a -20 ~ 19 ; \u4e00\u822c\u4f7f\u7528\u8005\u4ec5\u53ef\u8c03\u6574\u81ea\u5df1\u8fdb\u7a0b\u7684 Nice \u503c,\u4e14\u8303\u56f4\u4ec5\u4e3a 0 ~ 19 (\u907f\u514d\u4e00\u822c\u7528\u6237\u62a2\u5360\u7cfb\u7edf\u8d44\u6e90); \u4e00\u822c\u4f7f\u7528\u8005\u4ec5\u53ef\u5c06 nice \u503c\u8d8a\u8c03\u8d8a\u9ad8,\u4f8b\u5982\u672c\u6765 nice \u4e3a 5 ,\u5219\u672a\u6765\u4ec5\u80fd\u8c03\u6574\u5230\u5927\u4e8e 5; \u5728top\u8fd0\u884c\u7684\u65f6\u5019\u662f\u53ef\u4ee5\u901a\u8fc7\u952e\u5165 r \u6765\u8c03\u6574nice\u503c\u7684\u3002\u4e0b\u9762\u4ecb\u7ecd\u8c03\u6574 NI \u7684\u53e6\u5916\u4e24\u79cd\u65b9\u5f0f\u3002","title":"3.1 Priority \u4e0e Nice \u503c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#311-nice-nice","text":"nice [ OPTION ] [ COMMAND [ARG ] ... ] OPTION - n , --adjustment=N add integer N to the niceness (default 10) [ root@dev ~ ] # nice -n -23 vi & [ root@dev ~ ] # vi & [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash # \u6bcf\u6b21\u4e0d\u4e00\u5b9a\u4f1a\u6b63\u597d\u7b26\u5408\u516c\u5f0f\uff0c\u5185\u6838\u4f1a\u52a8\u6001\u8c03\u6574\u7684 4 T 0 31430 15352 0 60 -20 - 31061 do_sig pts/7 00 :00:00 vi 0 T 0 31444 15352 0 80 0 - 31061 do_sig pts/7 00 :00:00 vi 0 R 0 31448 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # killall -9 vi [ 1 ] - Killed nice -n -23 vi [ 2 ] + Killed vi","title":"3.1.1 nice\uff1a\u65b0\u6267\u884c\u7684\u6307\u4ee4\u5373\u7ed9\u4e88\u65b0\u7684 nice \u503c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#312-renice-nice","text":"renice [ - n ] priority [ - gpu ] identifier ... OPTIONS - n , --priority priority \u5982\u679c\u4f7f\u7528\u8be5\u9009\u9879\uff0c\u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a\u53c2\u6570 - g , --pgrp pgid... - u , --user name_or_uid... - p , --pid pid... # root\u7528\u6237\u8c03\u6574 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 80 0 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31608 15352 0 80 0 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # renice -n -5 15352 15352 ( process ID ) old priority 0 , new priority -5 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 75 -5 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31615 15352 0 75 -5 - 38312 - pts/7 00 :00:00 ps [ root@dev ~ ] # renice -n 5 15352 15352 ( process ID ) old priority -5, new priority 5 [ root@dev ~ ] # ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 0 15352 3303 0 85 5 - 29238 do_wai pts/7 00 :00:00 bash 0 R 0 31619 15352 0 85 5 - 38312 - pts/7 00 :00:00 ps # \u666e\u901a\u7528\u6237\u8c03\u6574 [ sink@dev ~ ] $ ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 1000 17534 17533 0 80 0 - 29223 do_wai pts/8 00 :00:00 bash 0 R 1000 31626 17534 0 80 0 - 38312 - pts/8 00 :00:00 ps [ sink@dev ~ ] $ renice -n -10 17534 renice: failed to set priority for 17534 ( process ID ) : Permission denied [ sink@dev ~ ] $ renice 3 17534 17534 ( process ID ) old priority 0 , new priority 3 [ sink@dev ~ ] $ ps -l F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD 4 S 1000 17534 17533 0 83 3 - 29223 do_wai pts/8 00 :00:00 bash 0 R 1000 31649 17534 0 83 3 - 38312 - pts/8 00 :00:00 ps \u5728\u8c03\u6574\u4e86 bash \u7684 nice \u4e4b\u540e\uff0c ps \u7684nice \u4e5f\u8ddf\u7740\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd9\u662f\u56e0\u4e3a \u6574\u4e2a nice \u503c\u662f\u53ef\u4ee5\u5728\u7236\u8fdb\u7a0b --> \u5b50\u8fdb\u7a0b\u4e4b\u95f4\u4f20\u9012\u7684 \u3002","title":"3.1.2 renice\uff1a\u5bf9\u5b58\u5728\u8fdb\u7a0b\u7684 nice \u91cd\u65b0\u8c03\u6574"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#4","text":"","title":"4. \u7279\u6b8a\u6587\u4ef6\u4e0e\u8fdb\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#41-suidsgid","text":"\u5728\u89e6\u53d1\u5177\u6709 SUID \u7684\u7a0b\u5e8f\u540e,\u4f1a\u53d6\u5f97\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u4e0e PID\uff0c\u8be5 PID \u4ea7\u751f\u65f6\u900f\u8fc7 SUID \u6765\u7ed9\u4e88\u8be5 PID \u7279\u6b8a\u7684\u6743\u9650\u8bbe\u5b9a [ sink@dev ~ ] $ ll /usr/bin/passwd -rwsr-xr-x. 1 root root 27856 Aug 9 09 :39 /usr/bin/passwd [ sink@dev ~ ] $ passwd Changing password for user sink. Changing password for sink. # \u6b64\u5904\u6309\u4e0b Ctl+Z \u4e0e \u56de\u8f66 ( current ) UNIX password: [ 1 ] + Stopped passwd [ sink@dev ~ ] $ pstree -pu | sed -n '/passwd/p' | | -bash ( 17492 ) ---su ( 34364 ) ---bash ( 34365 ,sink ) -+-passwd ( 35160 ,root ) \u53ef\u4ee5\u770b\u5230\u7236\u8fdb\u7a0b\uff08bash(34365,sink)\uff09\u7684\u7528\u6237\u662fsink\uff0c\u4f46\u662f\u5176\u5b50\u8fdb\u7a0b\uff08passwd(35160,root)\uff09\u7684\u7528\u6237\u53d8\u4e3a\u4e86root\u3002","title":"4.1 \u5177\u6709 SUID/SGID \u6743\u9650\u7684\u6307\u4ee4\u6267\u884c\u72b6\u6001"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#42-proc","text":"\u8fdb\u7a0b\u90fd\u662f\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u800c\u5185\u5b58\u5f53\u4e2d\u7684\u6570\u636e\u53c8\u90fd\u662f\u5199\u5165\u5230 /proc/* \u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u3002\u57fa\u672c\u4e0a\uff0c\u76ee\u524d\u4e3b\u673a\u4e0a\u9762\u7684\u5404\u4e2a\u8fdb\u7a0b\u7684 PID \u90fd\u662f\u4ee5\u76ee\u5f55\u7684\u578b\u6001\u5b58\u5728\u4e8e /proc \u5f53\u4e2d\u3002 [ root@dev ~ ] # ll /proc/1/ total 0 dr-xr-xr-x. 2 root root 0 Nov 6 15 :05 attr -rw-r--r--. 1 root root 0 Nov 7 16 :15 autogroup -r--------. 1 root root 0 Nov 7 16 :15 auxv -r--r--r--. 1 root root 0 Nov 4 08 :40 cgroup \u2026\u2026 \u91cd\u70b9\u5728\u4ee5\u4e0b\u4e24\u4e2a\u6587\u4ef6 cmdline\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u88ab\u542f\u52a8\u7684\u6307\u4ee4\u4e32 environ\uff1a\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u73af\u5883\u53d8\u91cf\u5185\u5bb9 [ root@dev ~ ] # cat /proc/1/cmdline /usr/lib/systemd/systemd--switched-root--system--deserialize22 \u5305\u542b\u4e86\u6307\u4ee4\u3001\u9009\u9879\u4e0e\u53c2\u6570\uff0c\u9488\u5bf9\u7684\u662f\u8fdb\u7a0b\uff1b\u90a3\u4e48\u9488\u5bf9\u7cfb\u7edf\u7684\u6587\u4ef6\u5c31\u662f\u76f4\u63a5\u5728 /proc/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5566\u3002","title":"4.2 /proc/* \u4ee3\u8868\u7684\u610f\u4e49"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#43","text":"","title":"4.3 \u67e5\u8be2\u5df2\u5f00\u542f\u6587\u4ef6\u6216\u5df2\u6267\u884c\u8fdb\u7a0b\u5f00\u542f\u7684\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#431-fuser","text":"fuser [ - fuv ] [ - a |- s ] [ - 4 |- 6 ] [ - c |- m |- n space ] [ - k [ - i ] [ - M ] [ - w ] [ - SIGNAL ] ] name ... OPTIONS - u , -- user Append the user name of the process owner to each PID . - v , -- verbose \u5217\u51fa USER , PID , ACCESS and COMMAND . - a , -- all Show all files specified on the command line . - m , -- mount show all processes using the named filesystems or block device - i , -- interactive ask before killing ( ignored without - k ) - k , -- kill kill processes accessing the named file - SIGNAL send this signal instead of SIGKILL [ root@dev ~ ] # fuser -u /bin/bash /usr/bin/bash: 3313e ( root ) 3366e ( root ) 3367e ( root ) 3819e ( root ) 3906e ( root ) 4051e ( root ) 4249e ( root ) 4569e ( root ) 15352e ( root ) 17492e ( root ) 34365e ( sink ) 92679e ( root ) 92736e ( sink ) 95880e ( root ) 108664e ( root ) 108729e ( sink ) [ root@dev ~ ] # fuser -uv /bin/bash USER PID ACCESS COMMAND /usr/bin/bash: root 3313 ...e. ( root ) bash root 3366 ...e. ( root ) pycharm-start root 3367 ...e. ( root ) pycharm.sh root 3819 ...e. ( root ) bash \u2026\u2026 ACCESS\u6240\u4ee3\u8868\u7684\u610f\u4e49\uff1a c current directory. e executable being run. f open file. f is omitted in default display mode. F open file for writing. F is omitted in default display mode. r root directory. \u9876\u5c42\u76ee\u5f55 m mmap'ed file or shared library. [ root@dev ~ ] # fuser -uv .top.log.swp USER PID ACCESS COMMAND /root/.top.log.swp: root 114662 F.... ( root ) vi","title":"4.3.1 fuser\uff1a\u7531\u6587\u4ef6\u627e\u8fdb\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#432-lsof","text":"lsof [ options ] [ -- ] [ names ] OPTIONS - a \u6761\u4ef6\u53c2\u6570 \uff0c \u610f\u601d\u662f\u5728\u4e24\u8fb9\u7684\u9009\u9879\u90fd\u6210\u7acb\u65f6\u624d\u5217\u51fa \uff0c \u5373\u903b\u8f91\u4e0e - U \u53ea\u5217\u51fa UNIX socket files . - u s \u5217\u51fa\u8be5\u4f7f\u7528\u8005\u76f8\u5173\u8fdb\u7a0b\u6240\u5f00\u542f\u7684\u6587\u4ef6 \u3002 e . g ., `` sink '' , or `` 548 , root '' . \u4e0d\u80fd\u6709\u7a7a\u683c + D D \u627e\u51fa\u67d0\u4e2a\u76ee\u5f55\u5e95\u4e0b\u5df2\u7ecf\u88ab\u5f00\u542f\u7684\u6587\u4ef6 - i [ i ] - P \u7981\u6b62\u5c06\u7aef\u53e3\u53f7\u8f6c\u6362\u4e3a\u7f51\u7edc\u6587\u4ef6\u7684\u7aef\u53e3\u540d\u79f0 \u3002 [ root@dev ~ ] # lsof | less # NODE \u5373 inode COMMAND PID TID USER FD TYPE DEVICE SIZE/OFF NODE NAME systemd 1 root cwd DIR 253 ,0 246 64 / systemd 1 root rtd DIR 253 ,0 246 64 / systemd 1 root txt REG 253 ,0 1624552 101335647 /usr/lib/systemd/systemd systemd 1 root mem REG 253 ,0 20064 2142819 /usr/lib64/libuuid.so.1.3.0 # \u65e2\u662f root \u53c8\u662f socket \u6587\u4ef6 [ root@dev ~ ] # lsof -u root -a -U \u2026\u2026 # \u7f51\u7edc\u6587\u4ef6 [ root@dev ~ ] # lsof -u root -a -i 4 -P COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME systemd 1 root 42u IPv4 24643 0t0 TCP *:111 ( LISTEN ) systemd 1 root 43u IPv4 24644 0t0 UDP *:111 sshd 1861 root 3u IPv4 33055 0t0 TCP *:22 ( LISTEN ) cupsd 1863 root 12u IPv4 29388 0t0 TCP localhost:631 ( LISTEN ) \u2026\u2026 # \u5217\u51fa\u6587\u4ef6\u5939\u4e0b\u88ab\u6253\u5f00\u7684\u6587\u4ef6 [ root@dev ~ ] # lsof +d . COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME gnome-ses 2647 root cwd DIR 253 ,0 4096 67153985 . \u2026\u2026","title":"4.3.2 lsof\uff1a\u7531\u8fdb\u7a0b\u627e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/18 \u8fdb\u7a0b/#433-pidof-id","text":"pidof [ options ] program [ program.. ] OPTIONS - s \u53ea\u8fd4\u56de\u4e00\u4e2a pid - x \u540c\u65f6\u5217\u51fa\u8be5 program name \u53ef\u80fd\u7684 PPID \u90a3\u4e2a\u8fdb\u7a0b\u7684 PID # \u666e\u901a\u7528\u6237\u4e5f\u80fd\u67e5\u5230 root \u7528\u6237\u7684\u8fdb\u7a0b [ sink@dev ~ ] $ pidof vi bash | xargs ps -fp UID PID PPID C STIME TTY STAT TIME CMD root 3313 3303 0 Nov04 pts/0 Ss 0 :00 -bash root 3366 3313 0 Nov04 pts/0 S+ 0 :00 /bin/bash /usr/local/bin/pycharm-start root 3819 3303 0 Nov04 pts/2 Ss 0 :00 -bash root 118382 17492 0 17 :20 pts/8 T 0 :00 vi top.log \u2026\u2026","title":"4.3.3 pidof\uff1a\u67e5\u627e\u6b63\u5728\u8fd0\u884c\u7684\u7a0b\u5e8f\u7684\u8fdb\u7a0b ID\u3002"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/","text":"\u9664\u4e86 top \u547d\u4ee4\u5916\uff0c\u8fd8\u6709\u8bb8\u591a\u5176\u4ed6\u5de5\u5177\u6765\u67e5\u770b\u7cfb\u7edf\u8d44\u6e90\u3002 1. free\uff1a\u67e5\u770b\u5185\u5b58 \u00b6 free [ options ] OPTIONS - b , --bytes - k , --kilo Display the amount of memory in kilobytes. This is the default. - m , --mega - g , --giga --tera Display the amount of memory in terabytes. --peta Display the amount of memory in petabytes. - h , --human - s , --seconds seconds - c , --count count \u663e\u793a count \u6b21\u7ed3\u679c\uff0c\u4e0e -s \u9009\u9879\u914d\u5408\u4f7f\u7528\u3002 # \u6bcf\u9694\u4e00\u79d2\u949f\u6253\u5370\u4e00\u6b21\uff0c\u5171\u6253\u5370\u4e09\u6b21 [ root@dev ~ ] # free -h -s 1 -c 3 total used free shared buff/cache available Mem: 15G 3 .9G 7 .5G 203M 4 .1G 11G Swap: 5 .0G 0B 5 .0G # \u4e0b\u9762\u8fd8\u6709\u4e24\u6b21\u7ed3\u679c \u7cfb\u7edf\u662f \u5f88\u6709\u6548\u7387\u7684\u5c06\u6240\u6709\u7684\u5185\u5b58\u7528\u5149 ,\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u7cfb\u7edf\u7684\u5b58\u53d6\u6548\u80fd\u52a0\u901f\u3002 \u4e00\u822c\u6765\u8bf4\uff0cswap \u6700\u597d\u4e0d\u8981\u88ab\u4f7f\u7528\uff0c\u5c24\u5176 swap \u6700\u597d\u4e0d\u8981\u88ab\u4f7f\u7528\u8d85\u8fc7 20% \u4ee5\u4e0a\u3002 2. uname\uff1a\u67e5\u770b\u7cfb\u7edf\u4e0e\u5185\u6838\u76f8\u5173\u4fe1\u606f \u00b6 3. uptime\uff1a\u67e5\u770b\u7cfb\u7edf\u542f\u52a8\u65f6\u95f4\u4e0e\u5de5\u4f5c\u8d1f\u8f7d \u00b6 \u5f00\u673a\u591a\u4e45\u7684\u65f6\u95f4,\u4ee5\u53ca 1, 5, 15 \u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d\u3002 [ root @ dev ~ ]# uptime 10 : 28 : 07 up 3 days , 1 : 47 , 10 users , load average : 0 . 19 , 0 . 26 , 0 . 18 4. netstat\uff1a\u8ffd\u8e2a\u7f51\u7edc\u6216socket\u6587\u4ef6 \u00b6 netstat - Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships\u3002\u6253\u5370\u7f51\u7edc\u8fde\u63a5\u3001\u8def\u7531\u8868\u3001\u63a5\u53e3\u7edf\u8ba1\u4fe1\u606f\u3001\u4f2a\u88c5\u8fde\u63a5\u548c\u591a\u64ad\u6210\u5458\u8eab\u4efd OPTIONS - a , -- all Show both listening and non - listening -- tcp |- t -- udp |- u - l , -- listening Show only listening sockets .\u9ed8\u8ba4\u9009\u9879 - p , -- program Show the PID and name of the program to which each socket belongs . -- numeric , - n \u663e\u793a\u6570\u5b57\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5c1d\u8bd5\u786e\u5b9a\u4e3b\u673a\u540d\u3001\u7aef\u53e3\u6216\u7528\u6237\u540d\u3002 [ root@dev ~ ] # netstat -a # \u7f51\u7edc\u76f8\u5173\u90e8\u5206 Active Internet connections ( servers and established ) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 localhost:ipp 0 .0.0.0:* LISTEN \u2026\u2026 # \u4e0e\u672c\u673a\u8fdb\u7a0b\u76f8\u5173\u7684\u90e8\u5206 Active UNIX domain sockets ( servers and established ) Proto RefCnt Flags Type State I-Node Path unix 2 [ ACC ] STREAM LISTENING 37636 /run/user/0/pulse/native \u2026\u2026 [ root@dev ~ ] # netstat -tlp Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 localhost:ipp 0 .0.0.0:* LISTEN 1863 /cupsd [ root@dev ~ ] # netstat -ntlp Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127 .0.0.1:631 0 .0.0.0:* LISTEN 1863 /cupsd \u5404\u5b57\u6bb5\u7684\u610f\u4e49\u5728man\u6587\u6863\u4e2d\u6709\u8bf4\u660e\u3002 5. dmesg\uff1a\u5206\u6790\u5185\u6838\u4ea7\u751f\u7684\u4fe1\u606f \u00b6 \u6240\u6709\u6838\u5fc3\u4fa6\u6d4b\u7684\u4fe1\u606f\uff0c\u4e0d\u7ba1\u662f\u5f00\u673a\u65f6\u5019\u8fd8\u662f\u7cfb\u7edf\u8fd0\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u53cd\u6b63\u53ea\u8981\u662f\u5185\u6838\u4ea7\u751f\u7684\u4fe1\u606f\uff0c\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u4fdd\u62a4\u533a\u6bb5\u3002 dmesg \u8fd9\u4e2a\u6307\u4ee4\u5c31\u80fd\u591f\u5c06\u8be5\u533a\u6bb5\u7684\u8baf\u606f\u8bfb\u51fa\u6765\u3002 [ root@dev ~ ] # dmesg | less 6. vmstat\uff1a\u4fa6\u6d4b\u7cfb\u7edf\u8d44\u6e90\u53d8\u5316 \u00b6 vmstat [ options ] [ delay [count ] ] Options - S , --unit <char> \u6307\u5b9a\u663e\u793a\u7684\u5355\u4f4d\u6765\u53d6\u4ee3 bytes \u5185\u5b58 \u3001 cpu\u76f8\u5173 - a , --active active/inactive memory\uff0c\u4f1a\u66ff\u6362\u6389 buff/cache \u5185\u5bb9 \u78c1\u76d8\u76f8\u5173 - d , --disk disk statistics - D , --disk-sum summarize disk statistics \u5206\u533a\u76f8\u5173 - p , --partition <dev> partition specific statistics [ root@dev ~ ] # vmstat procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 0 0 7611460 3148 4250592 0 0 2 3 8 17 1 0 99 0 0 [ root@dev ~ ] # vmstat -d disk- ------------reads------------ ------------writes----------- -----IO------ total merged sectors ms total merged sectors ms cur sec sda 62602 130 7012896 1024816 201578 33374 14596157 6508528 0 811 sdb 126 0 5960 1166 0 0 0 0 0 1 sr0 0 0 0 0 0 0 0 0 0 0 dm-0 61533 0 6943670 1026663 234973 0 14592020 10361125 0 810 dm-1 130 0 6472 528 0 0 0 0 0 0 [ root@dev ~ ] # vmstat -p /dev/sda1 sda1 reads read sectors writes requested writes 1170 54130 10 4137 # \u6bcf\u96941\u79d2\u8f93\u51fa\u4e00\u6b21\uff0c\u5171\u8f93\u51fa\u4e24\u6b21 [ root@dev ~ ] # vmstat 1 2 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 0 0 7637540 3148 4252844 0 0 2 3 9 18 1 0 99 0 0 0 0 0 7637540 3148 4252844 0 0 0 0 783 1097 2 1 98 0 0","title":"19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#1-free","text":"free [ options ] OPTIONS - b , --bytes - k , --kilo Display the amount of memory in kilobytes. This is the default. - m , --mega - g , --giga --tera Display the amount of memory in terabytes. --peta Display the amount of memory in petabytes. - h , --human - s , --seconds seconds - c , --count count \u663e\u793a count \u6b21\u7ed3\u679c\uff0c\u4e0e -s \u9009\u9879\u914d\u5408\u4f7f\u7528\u3002 # \u6bcf\u9694\u4e00\u79d2\u949f\u6253\u5370\u4e00\u6b21\uff0c\u5171\u6253\u5370\u4e09\u6b21 [ root@dev ~ ] # free -h -s 1 -c 3 total used free shared buff/cache available Mem: 15G 3 .9G 7 .5G 203M 4 .1G 11G Swap: 5 .0G 0B 5 .0G # \u4e0b\u9762\u8fd8\u6709\u4e24\u6b21\u7ed3\u679c \u7cfb\u7edf\u662f \u5f88\u6709\u6548\u7387\u7684\u5c06\u6240\u6709\u7684\u5185\u5b58\u7528\u5149 ,\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u7cfb\u7edf\u7684\u5b58\u53d6\u6548\u80fd\u52a0\u901f\u3002 \u4e00\u822c\u6765\u8bf4\uff0cswap \u6700\u597d\u4e0d\u8981\u88ab\u4f7f\u7528\uff0c\u5c24\u5176 swap \u6700\u597d\u4e0d\u8981\u88ab\u4f7f\u7528\u8d85\u8fc7 20% \u4ee5\u4e0a\u3002","title":"1. free\uff1a\u67e5\u770b\u5185\u5b58"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#2-uname","text":"","title":"2. uname\uff1a\u67e5\u770b\u7cfb\u7edf\u4e0e\u5185\u6838\u76f8\u5173\u4fe1\u606f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#3-uptime","text":"\u5f00\u673a\u591a\u4e45\u7684\u65f6\u95f4,\u4ee5\u53ca 1, 5, 15 \u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d\u3002 [ root @ dev ~ ]# uptime 10 : 28 : 07 up 3 days , 1 : 47 , 10 users , load average : 0 . 19 , 0 . 26 , 0 . 18","title":"3. uptime\uff1a\u67e5\u770b\u7cfb\u7edf\u542f\u52a8\u65f6\u95f4\u4e0e\u5de5\u4f5c\u8d1f\u8f7d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#4-netstatsocket","text":"netstat - Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships\u3002\u6253\u5370\u7f51\u7edc\u8fde\u63a5\u3001\u8def\u7531\u8868\u3001\u63a5\u53e3\u7edf\u8ba1\u4fe1\u606f\u3001\u4f2a\u88c5\u8fde\u63a5\u548c\u591a\u64ad\u6210\u5458\u8eab\u4efd OPTIONS - a , -- all Show both listening and non - listening -- tcp |- t -- udp |- u - l , -- listening Show only listening sockets .\u9ed8\u8ba4\u9009\u9879 - p , -- program Show the PID and name of the program to which each socket belongs . -- numeric , - n \u663e\u793a\u6570\u5b57\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5c1d\u8bd5\u786e\u5b9a\u4e3b\u673a\u540d\u3001\u7aef\u53e3\u6216\u7528\u6237\u540d\u3002 [ root@dev ~ ] # netstat -a # \u7f51\u7edc\u76f8\u5173\u90e8\u5206 Active Internet connections ( servers and established ) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 localhost:ipp 0 .0.0.0:* LISTEN \u2026\u2026 # \u4e0e\u672c\u673a\u8fdb\u7a0b\u76f8\u5173\u7684\u90e8\u5206 Active UNIX domain sockets ( servers and established ) Proto RefCnt Flags Type State I-Node Path unix 2 [ ACC ] STREAM LISTENING 37636 /run/user/0/pulse/native \u2026\u2026 [ root@dev ~ ] # netstat -tlp Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 localhost:ipp 0 .0.0.0:* LISTEN 1863 /cupsd [ root@dev ~ ] # netstat -ntlp Active Internet connections ( only servers ) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 127 .0.0.1:631 0 .0.0.0:* LISTEN 1863 /cupsd \u5404\u5b57\u6bb5\u7684\u610f\u4e49\u5728man\u6587\u6863\u4e2d\u6709\u8bf4\u660e\u3002","title":"4. netstat\uff1a\u8ffd\u8e2a\u7f51\u7edc\u6216socket\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#5-dmesg","text":"\u6240\u6709\u6838\u5fc3\u4fa6\u6d4b\u7684\u4fe1\u606f\uff0c\u4e0d\u7ba1\u662f\u5f00\u673a\u65f6\u5019\u8fd8\u662f\u7cfb\u7edf\u8fd0\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u53cd\u6b63\u53ea\u8981\u662f\u5185\u6838\u4ea7\u751f\u7684\u4fe1\u606f\uff0c\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u4fdd\u62a4\u533a\u6bb5\u3002 dmesg \u8fd9\u4e2a\u6307\u4ee4\u5c31\u80fd\u591f\u5c06\u8be5\u533a\u6bb5\u7684\u8baf\u606f\u8bfb\u51fa\u6765\u3002 [ root@dev ~ ] # dmesg | less","title":"5. dmesg\uff1a\u5206\u6790\u5185\u6838\u4ea7\u751f\u7684\u4fe1\u606f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/19 \u67e5\u770b\u7cfb\u7edf\u8d44\u6e90/#6-vmstat","text":"vmstat [ options ] [ delay [count ] ] Options - S , --unit <char> \u6307\u5b9a\u663e\u793a\u7684\u5355\u4f4d\u6765\u53d6\u4ee3 bytes \u5185\u5b58 \u3001 cpu\u76f8\u5173 - a , --active active/inactive memory\uff0c\u4f1a\u66ff\u6362\u6389 buff/cache \u5185\u5bb9 \u78c1\u76d8\u76f8\u5173 - d , --disk disk statistics - D , --disk-sum summarize disk statistics \u5206\u533a\u76f8\u5173 - p , --partition <dev> partition specific statistics [ root@dev ~ ] # vmstat procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 0 0 7611460 3148 4250592 0 0 2 3 8 17 1 0 99 0 0 [ root@dev ~ ] # vmstat -d disk- ------------reads------------ ------------writes----------- -----IO------ total merged sectors ms total merged sectors ms cur sec sda 62602 130 7012896 1024816 201578 33374 14596157 6508528 0 811 sdb 126 0 5960 1166 0 0 0 0 0 1 sr0 0 0 0 0 0 0 0 0 0 0 dm-0 61533 0 6943670 1026663 234973 0 14592020 10361125 0 810 dm-1 130 0 6472 528 0 0 0 0 0 0 [ root@dev ~ ] # vmstat -p /dev/sda1 sda1 reads read sectors writes requested writes 1170 54130 10 4137 # \u6bcf\u96941\u79d2\u8f93\u51fa\u4e00\u6b21\uff0c\u5171\u8f93\u51fa\u4e24\u6b21 [ root@dev ~ ] # vmstat 1 2 procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 1 0 0 7637540 3148 4252844 0 0 2 3 9 18 1 0 99 0 0 0 0 0 7637540 3148 4252844 0 0 0 0 783 1097 2 1 98 0 0","title":"6. vmstat\uff1a\u4fa6\u6d4b\u7cfb\u7edf\u8d44\u6e90\u53d8\u5316"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/","text":"red_hat selinux_users_and_administrators_guide 1. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528SELinux \u00b6 \u5f53\u67d0\u4e2a\u8fdb\u7a0b\u60f3\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5b58\u53d6\u65f6\uff0c\u7cfb\u7edf\u5c31\u4f1a\u6839\u636e\u8be5\u8fdb\u7a0b\u7684\u62e5\u6709\u8005/\u7fa4\u7ec4\uff0c\u5e76\u6bd4\u5bf9\u6587\u4ef6\u7684\u6743\u9650\uff0c\u82e5\u901a\u8fc7\u6743\u9650\u68c0\u67e5\uff0c\u5c31\u53ef\u4ee5\u5b58\u53d6\u8be5\u6587\u4ef6\u4e86\u3002\u8fd9\u79cd\u5b58\u53d6\u6587\u4ef6\u7cfb\u7edf\u7684\u65b9\u5f0f\u88ab\u79f0\u4e3a \u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236 (Discretionary Access Control\uff0c DAC) \u3002 Linux\u7cfb\u7edf\u4e2d\u6709\u4e24\u79cd\u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\uff0c\u4e00\u79cd\u662f9\u4f4d\u6743\u9650\u7801\uff08User-Group-Other\uff09\uff0c\u53e6\u4e00\u79cd\u662f\u8bbf\u95ee\u63a7\u5236\u5217\u8868ACL\uff08Access Control List\uff09\u3002\u7f3a\u9677\u5c31\u662f\uff1a root \u5177\u6709\u6700\u9ad8\u7684\u6743\u9650 \u4f7f\u7528\u8005\u53ef\u4ee5\u53d8\u66f4\u6587\u4ef6\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650 \u603b\u4e4b\uff0cDAC\u7684\u4e0d\u8db3\u662f\u7528\u6237\u5bb9\u6613\u968f\u610f\u8bbe\u7f6e\u6743\u9650\u3002\u56e0\u6b64 SELinux \u5bfc\u5165\u4e86 \u5f3a\u5236\u8bbf\u95ee\u63a7\u5236 (Mandatory Access Control\uff0cMAC) \u7684\u65b9\u6cd5\u3002\u8be5\u65b9\u5f0f\u53ef\u4ee5\u9488\u5bf9\u7279\u5b9a\u7684 \u8fdb\u7a0b \u4e0e\u7279\u5b9a\u7684 \u6587\u4ef6\u8d44\u6e90 \u6765\u8fdb\u884c\u6743\u9650\u7684\u63a7\u7ba1\u3002SELinux \u662f\u900f\u8fc7 MAC \u7684\u65b9\u5f0f\u6765\u63a7\u7ba1\u8fdb\u7a0b\uff0c\u4ed6\u63a7\u5236\u7684 \u4e3b\u4f53 \u662f \u8fdb\u7a0b \uff0c\u800c \u76ee\u6807 \u5219\u662f\u8be5\u8fdb\u7a0b\u80fd\u5426\u8bfb\u53d6\u7684 \u6587\u4ef6\u8d44\u6e90 \u3002 2. SELinux \u7684\u8fd0\u4f5c\u6a21\u5f0f \u00b6 \u4e3b\u4f53 (Subject) \u8fdb\u7a0b\u6216\u7ebf\u7a0b\u3002 \u76ee\u6807 (Object) \u4e00\u822c\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u3002 \u7b56\u7565 (Policy) \u7531\u4e8e\u8fdb\u7a0b\u4e0e\u6587\u4ef6\u6570\u91cf\u5e9e\u5927\uff0c\u4f1a\u9884\u8bbe\u4e00\u4e9b\u7b56\u7565\uff0c\u8fd9\u4e9b\u7b56\u7565\u5185\u8fd8\u4f1a\u6709\u8be6\u7ec6\u7684\u89c4\u5219 (rule) \u6765\u6307\u5b9a\u4e0d\u540c\u7684\u670d\u52a1\u5f00\u653e\u67d0\u4e9b\u8d44\u6e90\u7684\u5b58\u53d6\u4e0e\u5426\u3002CentOS 7.x \u91cc\u9762\u4ec5\u6709\u63d0\u4f9b\u4e09\u4e2a\u4e3b\u8981\u7684\u7b56\u7565\uff1a - targeted \uff1a\u9488\u5bf9\u7f51\u7edc\u670d\u52a1\u9650\u5236\u8f83\u591a\uff0c\u9488\u5bf9\u672c\u673a\u9650\u5236\u8f83\u5c11\uff0c\u662f\u9884\u8bbe\u7684\u7b56\u7565\uff1b - minimum \uff1a\u7531 target \u4fee\u8ba2\u800c\u6765\uff0c\u4ec5\u9488\u5bf9\u9009\u62e9\u7684\u8fdb\u7a0b\u6765\u4fdd\u62a4\uff1b - mls \uff1a\u5b8c\u6574\u7684 SELinux \u9650\u5236\uff0c\u9650\u5236\u65b9\u9762\u8f83\u4e3a\u4e25\u683c\u3002 \u5b89\u5168\u6027\u672c\u6587 (security context) \u4e3b\u4f53\u80fd\u4e0d\u80fd\u5b58\u53d6\u76ee\u6807\u9664\u4e86\u7b56\u7565\u6307\u5b9a\u4e4b\u5916\uff0c\u4e3b\u4f53\u4e0e\u76ee\u6807\u7684\u5b89\u5168\u6027\u672c\u6587\u5fc5\u987b\u4e00\u81f4\u624d\u80fd\u591f\u987a\u5229\u5b58\u53d6\u3002\u5b89\u5168\u6027\u672c\u6587 (security context) \u6709\u70b9\u7c7b\u4f3c\u6587\u4ef6\u7cfb\u7edf\u7684 rwx\u3002 \u5de5\u4f5c\u6d41\u7a0b\uff1a Important \u5148\u5224\u65ad\u7684\u662f\u6587\u4ef6\u7cfb\u7edf\u7684 rwx \u6743\u9650\u8bbe\u5b9a\uff0c\u7136\u540e\u518d\u8fdb\u5165selinux\u7684\u6d41\u7a0b\u3002\u5982\u679cDAC\u7684\u6743\u9650\u90fd\u4e0d\u6ee1\u8db3\uff0c\u90a3\u4e48\u4e5f\u4e0d\u4f1a\u8fdb\u884cSELinux policy rules\u7684\u68c0\u67e5\u4e86\u3002\u9e1f\u54e5\u5728\u8fd9\u91cc\u5199\u9519\u4e86\uff0c\u8be6\u89c1 redhat\u8bf4\u660e Note \u90e8\u5206 2.1 \u5b89\u5168\u6027\u672c\u6587 (Security Context) \u00b6 \u5b89\u5168\u6027\u672c\u6587\u5b58\u5728\u4e8e\u4e3b\u4f53\u8fdb\u7a0b\u4e2d\u4e0e\u76ee\u6807\u6587\u4ef6\u8d44\u6e90\u4e2d\u3002\u8fdb\u7a0b\u5728\u5185\u5b58\u5185\uff0c\u5b89\u5168\u6027\u672c\u6587\u53ef\u4ee5\u5b58\u5165\u5185\u5b58\uff1b\u6587\u4ef6\u7684\u5b89\u5168\u6027\u672c\u6587\u662f\u653e\u7f6e\u5230\u6587\u4ef6\u7684 inode \u5185\u7684\u3002 \u67e5\u770b\u8fdb\u7a0b\u7684\u5b89\u5168\u6027\u6587\u672c\uff1a [ sink@dev ~ ] $ ps -Z LABEL PID TTY TIME CMD unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 18876 pts/5 00 :00:00 bash unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 18923 pts/5 00 :00:00 ps \u67e5\u770b\u6587\u4ef6\u7684\u5b89\u5168\u6027\u6587\u672c\uff1a [ sink@dev ~ ] $ ls -Z -rw-rw-r--. sink sink unconfined_u:object_r:user_home_t:s0 f1 \u5185\u5bb9\u683c\u5f0f\u4e3a SELinux user:role:type:level \uff0c\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u5b57\u6bb5\uff1a SELinux user (Identify)\uff1a\u76f8\u5f53\u4e8e\u8d26\u53f7\u65b9\u9762\u7684\u8eab\u4efd\u8bc6\u522b\u3002\u7c7b\u578b\uff1a unconfined_u\uff1a\u4e0d\u53d7\u9650\u7684\u7528\u6237\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be5\u6587\u4ef6\u6765\u81ea\u4e8e \u4e0d\u53d7\u9650\u7684\u8fdb\u7a0b \u6240\u4ea7\u751f\u7684\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u9884\u8bbe\u7684bash\u662f\u4e0d\u53d7SELinux\u7ba1\u63a7\u7684\u3002 system_u\uff1a\u7cfb\u7edf\u7528\u6237\uff0c\u5927\u90e8\u5206\u5c31\u662f\u7cfb\u7edf\u81ea\u5df1\u4ea7\u751f\u7684\u6587\u4ef6\u3002 \u89d2\u8272 (Role)\uff1a\u8bf4\u660e\u8d44\u6599\u662f\u5c5e\u4e8e\u8fdb\u7a0b\u3001\u6587\u4ef6\u8d44\u6e90\u8fd8\u662f\u4ee3\u8868\u4f7f\u7528\u8005\u3002\u7c7b\u578b\uff1a object_r\uff1a\u4ee3\u8868\u7684\u662f\u6587\u4ef6\u6216\u76ee\u5f55\u7b49\u6587\u4ef6\u8d44\u6e90\u3002 system_r\uff1a\u4ee3\u8868\u7684\u5c31\u662f\u8fdb\u7a0b\u5566\uff1b\u4e0d\u8fc7\uff0c\u4e00\u822c\u4f7f\u7528\u8005\u4e5f\u4f1a\u88ab\u6307\u5b9a\u6210\u4e3a system_r\u3002 \u7c7b\u578b (Type)\uff1a\u5b9a\u4e49\u8fdb\u7a0b\u7684\u57df\uff08domain\uff09\u548c\u6587\u4ef6\u7684\u7c7b\u578b\uff08type\uff09\u3002SELinux \u7b56\u7565\u89c4\u5219\u5b9a\u4e49Type\u5982\u4f55\u76f8\u4e92\u8bbf\u95ee\uff0c\u65e0\u8bba\u662f\u8bbf\u95eetype\u7684domain\uff0c\u8fd8\u662f\u8bbf\u95ee\u53e6\u4e00\u4e2adomain\u7684domain\u3002 \u5728 targeted \u7b56\u7565\u4e0b\uff0c\u53ea\u6709\u8be5\u5b57\u6bb5\u4f1a\u5f71\u54cd\u5b58\u53d6\u3002 # \u53ef\u6267\u884c\u6587\u4ef6\u7684 type \u662f crond_exec_t\uff0c\u5728\u6267\u884c\u4e4b\u540e\u8fdb\u7a0b\u7684 domain \u4f1a\u53d8\u6210 crond_t\uff08\u901a\u8fc7 entrypoint\uff09 # entrypoint \u6743\u9650\u5728SELinux policy\u4e2d\u4f7f\u7528\uff0c\u63a7\u5236\u54ea\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u88ab\u7528\u4e8e\u8fdb\u5165\u4e00\u4e2a domain [ root@dev ~ ] # ls -Z /usr/sbin/crond -rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond # domain \u5df2\u7ecf\u53d8\u6210\u4e86 crond_t [ root@dev ~ ] # ps -Z -C crond LABEL PID TTY TIME CMD system_u:system_r:crond_t:s0-s0:c0.c1023 1886 ? 00 :00:01 crond # SELinux policy rule \u89c4\u5b9a\uff0c\u5141\u8bb8 crond_t \u57df\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u6807\u8bb0\u4e3a system_cron_spool_t\u3001user_cron_spool_t \u7c7b\u578b\u7684\u6587\u4ef6 [ root@dev ~ ] # ls -Z /etc/crontab /etc/cron.d /var/spool/cron/ -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab /etc/cron.d: -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 0hourly -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 raid-check -rw-------. root root system_u:object_r:system_cron_spool_t:s0 sysstat /var/spool/cron/: -rw-------. root root unconfined_u:object_r:user_cron_spool_t:s0 root -rw-------. sink sink unconfined_u:object_r:user_cron_spool_t:s0 sink SELinux\u5b9e\u9a8c\uff1a [ root@dev ~ ] # vi selinux_crond_test [ root@dev cron.d ] # cat selinux_crond_test 1 * * * * root echo \"selinux test\" [ root@dev ~ ] # ls -Z selinux_crond_test -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 selinux_crond_test [ root@dev ~ ] # mv selinux_crond_test /etc/cron.d/ [ root@dev ~ ] # sc restart crond # \u8fd9\u4e2a cron \u5931\u8d25\u4e86 [ root@dev ~ ] # tail /var/log/cron Nov 12 17 :26:32 dev crond [ 22054 ] : (( null )) Unauthorized SELinux context = system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 file_context = unconfined_u:object_r:admin_home_t:s0 ( /etc/cron.d/selinux_crond_test ) Nov 12 17 :26:32 dev crond [ 22054 ] : ( root ) FAILED ( loading cron table ) 3. SELinux \u4e09\u79cd\u6a21\u5f0f\u7684\u542f\u52a8\u3001\u5173\u95ed\u4e0e\u89c2\u5bdf \u00b6 \u5e76\u975e\u6240\u6709\u7684 Linux distributions \u90fd\u652f\u6301 SELinux \u7684\u3002 enforcing\uff1a\u5f3a\u5236\u6a21\u5f0f\uff0c\u4ee3\u8868 SELinux \u8fd0\u4f5c\u4e2d\uff0c\u4e14\u5df2\u7ecf\u6b63\u786e\u7684\u5f00\u59cb\u9650\u5236 domain/type \u4e86\uff1b permissive\uff1a\u5bbd\u5bb9\u6a21\u5f0f\uff0c\u4ee3\u8868 SELinux \u8fd0\u4f5c\u4e2d\uff0c\u4e0d\u8fc7\u4ec5\u4f1a\u6709\u8b66\u544a\u8baf\u606f\u5e76\u4e0d\u4f1a\u5b9e\u9645\u9650\u5236 domain/type \u7684\u5b58\u53d6\u3002 \u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u8fd0\u6765\u4f5c\u4e3a SELinux \u7684 debug \u4e4b\u7528\uff1b disabled\uff1a\u5173\u95ed\u3002 \u4f7f\u7528 getenforce \u6765\u67e5\u770b\u5f53\u524d\u6a21\u5f0f\uff1a [ sink@dev ~ ] $ getenforce Enforcing \u4f7f\u7528 setenforce \u6765\u4e34\u65f6\u8bbe\u7f6e\u5f53\u524d\u6a21\u5f0f\uff0c\u8981\u60f3\u6c38\u4e45\u751f\u6548\u5c31\u4fee\u6539 /etc/selinux/config \u6587\u4ef6\uff1a # permissive mode [ root@dev ~ ] # setenforce 0 [ root@dev ~ ] # getenforce Permissive # enforcing mode [ root@dev ~ ] # setenforce 1 [ root@dev ~ ] # getenforce Enforcing \u4e5f\u53ef\u4ee5\u4f7f\u7528 sestatus \u6765\u67e5\u770bSELinux\u4fe1\u606f\uff1a sestatus [ - v ] [ - b ] - v Displays the context of files and processes listed in the / etc / sestatus . conf file . - b \u5c06\u76ee\u524d\u7b56\u7565\u7684\u89c4\u5219\u5e03\u5c14\u503c\u5217\u51fa\uff0c\u5373\u67d0\u4e9b\u89c4\u5219 ( rule ) \u662f\u5426\u542f\u52a8 [ sink@dev ~ ] $ sestatus SELinux status: enabled SELinuxfs mount: /sys/fs/selinux # SELinux \u7684\u76f8\u5173\u6587\u4ef6\u6570\u636e\u6302\u8f7d\u70b9 SELinux root directory: /etc/selinux Loaded policy name: targeted Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled # \u662f\u5426\u542b\u6709 MLS \u7684\u6a21\u5f0f\u673a\u5236 Policy deny_unknown status: allowed # \u662f\u5426\u9884\u8bbe\u62b5\u6321\u672a\u77e5\u7684\u4e3b\u4f53\u8fdb\u7a0b Max kernel policy version: 31 3.1 \u542f\u52a8 \u00b6 Note \u5982\u679c\u6539\u53d8\u4e86\u7b56\u7565\u5219\u9700\u8981\u91cd\u65b0\u542f\u52a8\uff1b\u5982\u679c\u7531 enforcing \u6216 permissive \u6539\u6210 disabled\uff0c\u6216\u7531 disabled \u6539\u6210\u5176\u4ed6\u4e24\u4e2a\uff0c\u90a3\u4e5f\u5fc5\u987b\u8981\u91cd\u65b0\u542f\u52a8\u3002\u8fd9\u662f\u56e0\u4e3a SELinux \u662f\u6574\u5408\u5230\u5185\u6838\u91cc\u9762\u53bb\u7684\uff0c\u4f60\u53ea\u53ef\u4ee5\u5728 SELinux \u8fd0\u4f5c\u4e0b\u5207\u6362\u6210\u4e3a\u5f3a\u5236 (enforcing) \u6216\u5bbd\u5bb9 (permissive) \u6a21\u5f0f\uff0c\u4e0d\u80fd\u591f\u76f4\u63a5\u5173\u95ed SELinux \u7684\u3002 \u200b \u5982\u679c\u4ece disable \u8f6c\u5230\u542f\u52a8 SELinux \u7684\u6a21\u5f0f\u65f6\uff0c \u7531\u4e8e\u7cfb\u7edf\u5fc5\u987b\u8981\u9488\u5bf9\u6587\u4ef6\u5199\u5165\u5b89\u5168\u6027\u672c\u6587\u7684\u4fe1\u606f\uff0c\u56e0\u6b64\u5f00\u673a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u4e0d\u5c11\u65f6\u95f4\u5728\u7b49\u5f85\u91cd\u65b0\u5199\u5165 SELinux \u5b89\u5168\u6027\u672c\u6587 (\u6709\u65f6\u4e5f\u79f0\u4e3aSELinux Label) \uff0c\u800c\u4e14\u5728\u5199\u5b8c\u4e4b\u540e\u8fd8\u5f97\u8981\u518d\u6b21\u7684\u91cd\u65b0\u542f\u52a8\u4e00\u6b21\u3002 3.1.1 \u542f\u52a8\u5931\u8d25\u7684\u60c5\u51b5 \u00b6 \u200b \u5728\u67d0\u4e9b\u7279\u6b8a\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u51fa\u73b0\u4e00\u4e9b\u670d\u52a1\u65e0\u6cd5\u542f\u52a8\u7684\u60c5\u51b5\uff0c\u7c7b\u4f3c\u4e8e\u5728 /lib/xxx \u91cc\u9762\u7684\u6570\u636e\u6ca1\u6709\u6743\u9650\u8bfb\u53d6\uff0c\u5927\u591a\u662f\u7531\u4e8e\u5728\u91cd\u65b0\u5199\u5165 SELinux type (Relabel) \u51fa\u9519\u4e4b\u6545\u3002 \u200b \u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u5728 Permissive \u7684\u72b6\u6001\u4e0b\uff0c\u4f7f\u7528 restorecon -Rv / \u91cd\u65b0\u8fd8\u539f\u6240\u6709 SELinux \u7684\u5b89\u5168\u6027\u6587\u672c\uff0c\u5c31\u80fd\u591f\u5904\u7406\u8fd9\u4e2a\u9519\u8bef\u3002 4. SELinux \u7b56\u7565\u5185\u7684\u89c4\u5219\u7ba1\u7406 \u00b6 4.1 \u67e5\u8be2 SELinux \u89c4\u5219\u7684\u5e03\u5c14\u503c \u00b6 \u4f7f\u7528\u4e0a\u6587\u63d0\u5230\u7684 sestatus -b \u4e0e getsebool -a \u5747\u53ef\uff1a getsebool [ - a ] | [ boolean ] ... boolean :\u89c4\u5219\u540d\u79f0 - a Show all SELinux booleans . [ sink@dev ~ ] $ getsebool -a abrt_anon_write --> off abrt_handle_event --> off abrt_upload_watch_anon_write --> on \u2026\u2026 [ sink@dev ~ ] $ getsebool abrt_anon_write abrt_anon_write --> off 4.2 \u4fee\u6539 SELinux \u89c4\u5219\u7684\u5e03\u5c14\u503c \u00b6 setsebool [ - P ] boolean value | bool1 = val1 bool2 = val2 ... Without the - P option \uff0c only the current boolean value is affected ; the boot - time default settings are not changed - P \u76f4\u63a5\u5c06\u8bbe\u5b9a\u503c\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u6c38\u4e45\u751f\u6548 # \u5173\u95ed\u89c4\u5219 [ root@dev ~ ] # setsebool -P httpd_enable_homedirs 0 4.3 SELinux \u7b56\u7565\u67e5\u8be2 \u00b6 \u9996\u5148\u5b89\u88c5\u8f6f\u4ef6\uff1a yum install setools-console seinfo [ OPTIONS ] [ EXPRESSION ] [ POLICY ...] SELinux \u7b56\u7565\u67e5\u8be2\u5de5\u5177 OPTIONS : - x \uff0c -- expand show more info for specified components -- stats print useful policy statistics \uff0c\u9ed8\u8ba4\u9009\u9879 EXPRESSIONS : - u [ NAME ]\uff0c -- user [ = NAME ] Print a list of users or \uff0c if NAME is provided \uff0c print the user NAME . - r [ NAME ]\uff0c -- role [ = NAME ] - t [ NAME ]\uff0c -- type [ = NAME ] - b [ NAME ]\uff0c -- bool [ = NAME ] -- all Print all components . # \u7edf\u8ba1\u4fe1\u606f [ sink@dev ~ ] $ seinfo Statistics for policy file: /sys/fs/selinux/policy Policy Version & Type: v.31 ( binary\uff0c mls ) Classes: 130 Permissions: 272 Sensitivities: 1 Categories: 1024 Types: 4792 Attributes: 253 Users: 8 Roles: 14 Booleans: 316 Cond. Expr.: 362 \u2026\u2026 # \u7528\u6237\u4fe1\u606f [ sink@dev ~ ] $ seinfo -u Users: 8 sysadm_u system_u xguest_u root guest_u staff_u user_u unconfined_u [ sink@dev ~ ] $ seinfo -u -x Users: 8 sysadm_u default level: s0 range: s0 - s0:c0.c1023 roles: object_r sysadm_r system_u \u2026\u2026 sesearch [ OPTIONS ] RULE_TYPE [ RULE_TYPE ...] [ EXPRESSION ] [ POLICY ...] \u5728 SELinux \u7b56\u7565\u4e2d\u641c\u7d22\u89c4\u5219 RULE TYPE OPTIONS - A \uff0c -- allow Search for allow rules . -- all Search all rule types . - T \uff0c -- type Search for type_transition \uff0c type_member \uff0c and type_change rules . EXPRESSIONS - s NAME \uff0c -- source = NAME Find rules with type / attribute NAME as their source .\u5373\u4e3b\u4f53 - t NAME \uff0c -- target = NAME Find rules with type / attribute NAME as their target .\u5373\u76ee\u6807 - b NAME \uff0c -- bool = NAME Find conditional rules with NAME in their conditional expression .\u5373\u89c4\u5219\u540d\u5b57 [ sink@dev ~ ] $ ls -Z /usr/bin/passwd -rwsr-xr-x. root root system_u:object_r:passwd_exec_t:s0 /usr/bin/passwd [ sink@dev ~ ] $ ps -Z -C passwd LABEL PID TTY TIME CMD unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023 28764 pts/5 00 :00:00 passwd [ sink@dev ~ ] $ ls -Z /etc/shadow ----------. root root system_u:object_r:shadow_t:s0 /etc/shadow # \u5217\u51fa passwd_t \u8fd9\u4e2a\u4e3b\u4f53\u8fdb\u7a0b\u80fd\u5426\u8bfb\u53d6 SELinux type \u4e3a shadow_t \u7684\u6587\u4ef6 [ sink@dev ~ ] $ sesearch --allow -s passwd_t | grep shadow_t allow passwd_t shadow_t : file { ioctl read write create getattr setattr lock relabelfrom relabelto append map unlink link rename open } ; \u67e5\u8be2\u4e00\u4e2a\u89c4\u5219\u5185\u5b9a\u4e49\u4e86\u54ea\u4e9b\u4e1c\u897f\uff1a # \u770b\u4e00\u4e0b\u89c4\u5219\u7684\u8bf4\u660e [ root@dev ~ ] # semanage boolean -l | grep httpd_enable_homedirs httpd_enable_homedirs ( off \uff0c off ) Allow httpd to enable homedirs # \u89c4\u5219\u5185\u5b9a\u4e49\u4e86\u4ec0\u4e48 [ root@dev ~ ] # sesearch --allow -b httpd_enable_homedirs \u2026\u2026 allow httpd_t cifs_t : dir { getattr search open } ; allow httpd_t cifs_t : dir { ioctl read getattr lock search open } ; allow httpd_sys_script_t nfs_t : lnk_file { read getattr } ; \u2026\u2026 5. SELinux \u5b89\u5168\u672c\u6587\u7684\u4fee\u6539 \u00b6 SELinux \u5bf9\u53d7\u9650\u7684\u4e3b\u4f53\u8fdb\u7a0b\u6709\u6ca1\u6709\u5f71\u54cd\uff0c\u7b2c\u4e00\u5173\u8003\u8651 SELinux \u7684\u4e09\u79cd\u6a21\u5f0f\uff0c\u7b2c\u4e8c\u5173\u8003\u8651 SELinux \u7684\u7b56\u7565\u89c4\u5219\u662f\u5426\u653e\u884c\uff0c\u7b2c\u4e09\u5173\u5219\u662f\u5f00\u59cb\u6bd4\u5bf9 SELinux type\u3002 5.1 \u4f7f\u7528 chcon \u624b\u52a8\u4fee\u6539\u6587\u4ef6\u7684 SELinux type \u00b6 chcon [ OPTION ] ... CONTEXT FILE ... chcon [ OPTION ] ... [ -u USER ] [ -r ROLE ] [ -l RANGE ] [ -t TYPE ] FILE ... chcon [ OPTION ] ... --reference=RFILE FILE... OPTION - u , --user=USER \u8bbe\u7f6e\u76ee\u6807 security context \u7684 user \u5b57\u6bb5 --reference=RFILE \u4f7f\u7528 RFILE \u7684\u5b89\u5168\u6027\u6587\u672c\u6765\u8bbe\u7f6e\u76ee\u6807 - R , --recursive - v , --verbose # hello.selinux \u662f\u7528 vi \u7f16\u5199\u7684 cron \u6587\u4ef6 [ root@dev cron.d ] # ls -Z 0hourly hello.selinux -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 0hourly -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 hello.selinux # \u6539\u53d8\u5176 type [ root@dev cron.d ] # chcon -vt shadow_t hello.selinux changing security context of \u2018hello.selinux\u2019 [ root@dev cron.d ] # ls -Z hello.selinux -rw-r--r--. root root unconfined_u:object_r:shadow_t:s0 hello.selinux # \u590d\u5236\u53e6\u4e00\u4e2a\u6587\u4ef6\u7684 \u5b89\u5168\u6027\u6587\u672c [ root@dev cron.d ] # chcon -v --reference=/etc/shadow hello.selinux changing security context of \u2018hello.selinux\u2019 [ root@dev cron.d ] # ls -Z hello.selinux -rw-r--r--. root root system_u:object_r:shadow_t:s0 hello.selinux [ root@dev cron.d ] # ls -Z hello.selinux /etc/shadow ----------. root root system_u:object_r:shadow_t:s0 /etc/shadow -rw-r--r--. root root system_u:object_r:shadow_t:s0 hello.selinux \u867d\u7136 chcon \u53ef\u4ee5\u624b\u52a8\u4fee\u6539\uff0c\u4f46\u662f\u4f1a\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\u4fee\u6539\u503c\u4e0d\u4e00\u5b9a\u7b26\u5408\u8981\u6c42\uff0c\u6743\u9650\u4e0d\u6ee1\u8db3\u7b49\u60c5\u51b5\uff1a [ root@dev cron.d ] # chcon -vt crond_t hello.selinux changing security context of \u2018hello.selinux\u2019 chcon: failed to change context of \u2018hello.selinux\u2019 to \u2018unconfined_u:object_r:crond_t:s0\u2019: Permission denied \u8fd9\u65f6\u5c31\u9700\u8981 restorecon \u767b\u573a\u4e86\uff0c\u5b83\u53ef\u4ee5\u8ba9 SELinux \u81ea\u5df1\u89e3\u51b3\u9ed8\u8ba4\u76ee\u5f55\u4e0b\u7684 SELinux type\u3002 5.2 \u6062\u590d\u9ed8\u8ba4\u7684 SELinux type \u00b6 restorecon [ - R ] [ - n ] [ - p ] [ - v ] [ - e directory ] pathname ... - R , - r change files and directories file labels recursively ( descend directories ) . - v show changes in file labels , if type or role are going to be changed . [ root@dev cron.d ] # restorecon -Rv /etc/cron.d restorecon reset /etc/cron.d/hello.selinux context unconfined_u:object_r:net_conf_t:s0->unconfined_u:object_r:system_cron_spool_t:s0 \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u88ab\u4fee\u6539\u8fc7\u4e3a\u9ed8\u8ba4\u503c\u4e86\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6210\u529f\u91cd\u542f crond \u5566\u3002\u90a3\u4e48\u9ed8\u8ba4\u503c\u5982\u4f55\u67e5\u770b\u4fee\u6539\u5462\uff0c\u4f7f\u7528 semanage \u5c31OK\u5566\uff01 5.3 \u9ed8\u8ba4\u76ee\u5f55\u7684\u5b89\u5168\u6027\u672c\u6587\u67e5\u8be2\u4e0e\u4fee\u6539 \u00b6 semanage < mode > < options > \u6bcf\u79cd mode\u7684\u5177\u4f53\u9009\u9879\u53ef\u4f7f\u7528 man semanage -< mode > \u67e5\u8be2 MODE fcontext Manage file context mapping definitions fcontext \u7684 OPTIONS - l , --list List records of the specified object type - a , --add Add a record of the specified object type - d , --delete Delete a record of the specified object type - m , --modify Modify a record of the specified object type # \u67e5\u8be2 /root \u76ee\u5f55\u4e0b\u7684\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # semanage fcontext -l | grep \"^/root\" SELinux fcontext type Context /root ( /.* ) ? all files system_u:object_r:admin_home_t:s0 /root/.ppprc regular file system_u:object_r:pppd_etc_t:s0 /root/.manpath regular file system_u:object_r:mandb_home_t:s0 /root/bin ( /.* ) ? all files system_u:object_r:bin_t:s0 \u2026\u2026 # \u67e5\u8be2 /etc/cron\\.d \u76ee\u5f55\u4e0b\u7684\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # semanage fcontext -l | grep \"/etc/cron\\.d\" SELinux fcontext type Context /etc/cron.daily ( /.* ) ? all files system_u:object_r:bin_t:s0 # \u65b0\u589e\u9ed8\u8ba4\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # mkdir /my-selinux [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /my-selinux/ # \u8fd9\u91cc\u586b\u5199\u7684\u5fc5\u987b\u662f\u5df2\u5b58\u5728\u7684 user\u3001role\u3001type \u7b49 [ root@dev ~ ] # semanage fcontext -a -t shadow_t \"/my-selinux(/.*)?\" [ root@dev ~ ] # semanage fcontext -l | grep my-selinux /my-selinux ( /.* ) ? all files system_u:object_r:shadow_t:s0 # \u5728\u65b0\u589e\u5b8c\u6bd5\u4e4b\u540e\u4e0d\u4f1a\u7acb\u5373\u751f\u6548 [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /my-selinux/ # \u4f7f\u7528 restorecon \u4e4b\u540e\u624d\u4f1a\u751f\u6548 [ root@dev ~ ] # restorecon -Rv /my-selinux/ restorecon reset /my-selinux context unconfined_u:object_r:default_t:s0->unconfined_u:object_r:shadow_t:s0 [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:shadow_t:s0 /my-selinux/ Important \u5728\u4f7f\u7528 semanage fcontext \u6267\u884c\u4fee\u6539\u52a8\u4f5c\u4e4b\u540e\uff0c\u4e0d\u4f1a\u7acb\u5373\u751f\u6548\uff0c\u9700\u8981\u6267\u884c restorecon \u6765\u751f\u6548\u3002 6. SELinux \u9519\u8bef\u4fa6\u6d4b \u00b6 \u600e\u4e48\u77e5\u9053\u54ea\u4e2a\u65f6\u5019\u624d\u9700\u8981\u6267\u884c\u4e0a\u8ff0\u6307\u4ee4\uff1f\u600e\u4e48\u77e5\u9053\u7cfb\u7edf\u56e0\u4e3a SELinux \u7684\u95ee\u9898\u5bfc\u81f4\u7f51\u7edc\u670d\u52a1\u4e0d\u5bf9\u52b2\uff1fCentOS 7.x \u63d0\u4f9b\u51e0\u652f\u4fa6\u6d4b\u7684\u670d\u52a1\u5728\u767b\u5f55 SELinux \u4ea7\u751f\u7684\u9519\u8bef\u2014\u2014 auditd \u548c setroubleshootd \u3002 6.1 setroubleshoot \u00b6 \u8fd9\u4e2a\u670d\u52a1\u4f1a\u5c06\u5173\u4e8e SELinux \u7684\u9519\u8bef\u8baf\u606f\u4e0e\u89e3\u51b3\u65b9\u6cd5\u8bb0\u5f55\u5230 /var/log/messages \u4e0e /var/log/setroubleshoot/* \u91cc\u5934\u3002 \u539f\u672c\u7684 SELinux \u4fe1\u606f\u672c\u6765\u662f\u4ee5\u4e24\u4e2a\u670d\u52a1\u6765\u8bb0\u5f55\u7684\uff0c\u5206\u522b\u662f auditd \u4e0e setroubleshootd\u3002\u65e2\u7136\u662f\u540c\u6837\u7684\u4fe1\u606f,\u56e0\u6b64 CentOS 6.x (\u542b 7.x) \u4ee5\u540e\u5c06\u4e24\u8005\u6574\u5408\u5728 auditd \u5f53\u4e2d\u5566\uff01\u6240\u4ee5,\u5e76\u6ca1\u6709setroubleshootd \u7684\u670d\u52a1\u5b58\u5728\u4e86\u3002 \u5148\u68c0\u67e5\u4e00\u4e0b\u662f\u5426\u5b89\u88c5\u4e86\u4ee5\u4e0brpm\u5305\uff1a [ sink@dev ~ ] $ rpm -qa | grep setroubleshoot setroubleshoot-plugins-3.0.67-4.el7.noarch setroubleshoot-3.2.30-7.el7.x86_64 setroubleshoot-server-3.2.30-7.el7.x86_64 \u5b89\u88c5\u597d\u4e86 setroubleshoot-server \u4e4b\u540e\uff0c\u8bf7\u8bb0\u5f97\u8981\u91cd\u65b0\u542f\u52a8 auditd\uff0c\u5426\u5219 setroubleshootd \u7684\u529f\u80fd\u4e0d\u4f1a\u88ab\u542f\u52a8\u7684\u3002 6.2 \u4f7f\u7528 FTP \u5b9e\u8df5 \u00b6 \u6309\u9e1f\u54e5\u8bf4\u7684\u505a\u3002 \u5b89\u88c5ftp\u670d\u52a1\u7aef\uff1a [ root@dev ~ ] # yum install -y vsftpd [ root@dev ~ ] # systemctl start vsftpd [ root@dev ~ ] # netstat -tpan | grep ftp tcp6 0 0 :::21 :::* LISTEN 48351 /vsftpd \u521b\u5efaFTP\u8d26\u6237\uff1a [ root@dev ~ ] # useradd -s /sbin/nologin ftp_u [ root@dev ~ ] # passwd ftp_u 6.2.1 \u770b\u770b\u533f\u540d\u8bbf\u95ee\u8005\u80fd\u5426\u83b7\u53d6 \u00b6 # \u4e22\u4e24\u4e2a\u6587\u4ef6\u8fdb\u53bb [ root@dev ~ ] # cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub/ [ root@dev ~ ] # ll /var/ftp/pub/ total 8 -rw-------. 1 root root 221 Oct 31 2018 securetty -rw-r--r--. 1 root root 449 Aug 9 07 :52 sysctl.conf [ root@dev ~ ] # curl ftp://localhost drwxr-xr-x 2 0 0 42 Nov 15 01 :22 pub # \u8bfb\u53d6\u76ee\u5f55\u65f6\u76ee\u5f55\u672b\u5c3e\u5fc5\u987b\u52a0\u4e0a \"/\" [ root@dev ~ ] # curl ftp://localhost/pub/ -rw------- 1 0 0 221 Oct 30 2018 securetty -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf # \u53ef\u4ee5\u8bfb\u53d6 [ root@dev ~ ] # curl ftp://localhost/pub/sysctl.conf \u2026\u2026 [ root@dev ~ ] # curl ftp://localhost/pub/securetty curl: ( 78 ) RETR response: 550 [ root@dev ~ ] # chmod a+r /var/ftp/pub/securetty # \u4fee\u6539\u6743\u9650\u4e4b\u540e\u5c31\u53ef\u4ee5\u5566 [ root@dev ~ ] # curl ftp://localhost/pub/securetty \u2026\u2026 # \u53ef\u9009\u6b65\u9aa4\uff1a\u6062\u590d\u9ed8\u8ba4\u7684 SELinux type [ root@dev ~ ] # restorecon -Rv /var/ftp/pub/ 6.2.2 \u666e\u901a\u8d26\u6237\u8bbf\u95ee/\u4e0b\u8f7d\u81ea\u5df1\u7684\u5bb6\u76ee\u5f55 \u00b6 # \u4e22\u4e24\u4e2a\u6587\u4ef6\u8fdb\u53bb # \uff5e<user> \u4f1a\u66ff\u6362\u6bcf\u4e2a\u5e10\u53f7\u7684\u5bb6\u76ee\u5f55\uff0c\u6bd4\u5982 \uff5eftp \u5c31\u662f /var/ftp [ root@dev ~ ] # echo \"abcdefg\" > ~ftp_u/f1.txt [ root@dev ~ ] # cp -a /etc/hosts /etc/sysctl.conf ~ftp_u/ [ root@dev ~ ] # ll ~ftp_u/ total 12 -rw-r--r--. 1 root root 8 Nov 15 09 :39 f1.txt -rw-r--r--. 1 root root 158 Jun 7 2013 hosts -rw-r--r--. 1 root root 449 Aug 9 07 :52 sysctl.conf # \u8bbf\u95ee\u4e00\u4e0b\uff0cxxx\u662f\u8d26\u6237\u5bc6\u7801 [ root@dev ~ ] # curl ftp://ftp_u:xxx@localhost/~/ -rw-r--r-- 1 0 0 8 Nov 15 01 :39 f1.txt -rw-r--r-- 1 0 0 158 Jun 07 2013 hosts -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf # \u9e1f\u54e5\u8fd9\u91cc\u662f\u83b7\u53d6\u4e0d\u5230\u7684\uff0c\u4f46\u662f\u6211\u5374\u53ef\u4ee5\u83b7\u53d6\uff0c\u5443\u5443\u5443\uff0c\u53ef\u80fd\u662f\u7248\u672c\u7684\u95ee\u9898\uff1f [ root@dev ~ ] # curl ftp://ftp_u:xxx@localhost/~/f1.txt abcdefg # \u867d\u7136\u6210\u529f\u83b7\u53d6\u5230\u4e86\u6587\u4ef6\uff0c\u4f46\u8fd8\u662f\u8bb0\u5f55\u4e00\u4e0b\u51fa\u73b0\u9519\u8bef\u65f6\u7684\u540e\u7eed\u6b65\u9aa4\u5427 1 . \u5207\u6362SELinux\u7684\u6a21\u5f0f\u4e3a Permissive 2 . \u518d\u6b21\u6267\u884c\u4e00\u4e0b\u5931\u8d25\u7684\u6b65\u9aa4\uff0c\u5982\u679c\u53ef\u4ee5\u6210\u529f\u6267\u884c\u5219\u8bf4\u660e\u662fSELinux\u5bfc\u81f4\u7684 3 . \u5207\u6362SELinux\u7684\u6a21\u5f0f\u4e3a Enforcing 4 . \u67e5\u770b /var/log/messages \u6587\u4ef6\u4e86\u89e3\u53ef\u80fd\u7684\u5931\u8d25\u539f\u56e0\u53ca\u89e3\u51b3\u65b9\u6848 5 . \u89e3\u51b3\u95ee\u9898 6 . \u518d\u6b21\u6267\u884c\u5931\u8d25\u7684\u6b65\u9aa4\uff0c\u770b\u80fd\u5426\u6210\u529f 6.2.3 \u666e\u901a\u8d26\u6237\u8bbf\u95ee/\u4e0b\u8f7d\u5176\u4ed6\u76ee\u5f55 \u00b6 # \u8001\u6837\u5b50\uff0c\u5148\u9020\u6570\u636e [ root@dev ~ ] # mkdir /ftp-other [ root@dev ~ ] # chgrp ftp_u /ftp-other/ [ root@dev ~ ] # echo \"ccm\" > /ftp-other/other.txt # \u8bbf\u95ee\u4e00\u4e0b # \u6ce8\u610f\u8def\u5f84\u8981\u5199\u5b8c\u6574 [ root@dev ~ ] # curl ftp://ftp_u:abcd1234@localhost//ftp-other/other.txt curl: ( 78 ) RETR response: 550 # \u54c8\u54c8\uff0c\u7ec8\u4e8e\u51fa\u9519\u4e86 [ root@dev ~ ] # vi /var/log/messages \u2026\u2026 Nov 15 10 :35:26 dev dbus [ 1330 ] : [ system ] Activating service name = 'org.fedoraproject.Setroubleshootd' ( using servicehelper ) Nov 15 10 :35:26 dev dbus [ 1330 ] : [ system ] Successfully activated service 'org.fedoraproject.Setroubleshootd' Nov 15 10 :35:26 dev setroubleshoot: failed to retrieve rpm info for /ftp-other/other.txt Nov 15 10 :35:26 dev setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from getattr access on the file /ftp-other/other.txt. For complete SELinux messages run: sealert -l 68b4938c-32d9-4a07-b3c4-0eead65887c4 \u2026\u2026 [ root@dev ~ ] # sealert -l 8f2821f6-889a-40a8-8ea8-8c4fd85c1d7c SELinux is preventing vsftpd from read access on the file other.txt. # \u610f\u601d\u662f\u8bf4\u670957.6%\u7684\u6982\u7387\u662f\u8fd9\u4e2a\u539f\u56e0\u5f15\u8d77\u7684 ***** Plugin catchall_boolean ( 57 .6 confidence ) suggests ****************** If you want to allow ftpd to full access Then you must tell SELinux about this by enabling the 'ftpd_full_access' boolean. Do setsebool -P ftpd_full_access 1 # \u8fd9\u662f\u89e3\u51b3\u65b9\u6cd5 # \u540c\u4e0a ***** Plugin catchall_labels ( 36 .2 confidence ) suggests ******************* If you want to allow vsftpd to have read access on the other.txt file Then you need to change the label on other.txt Do # semanage fcontext -a -t FILE_TYPE 'other.txt' \u2026\u2026 Then execute: restorecon -v 'other.txt' # \u5176\u4ed6\u8be6\u7ec6\u4fe1\u606f Additional Information: Source Context system_u:system_r:ftpd_t:s0-s0:c0.c1023 Target Context unconfined_u:object_r:default_t:s0 Target Objects other.txt [ file ] Source vsftpd Source Path vsftpd Port <Unknown> Host dev Source RPM Packages Target RPM Packages Policy RPM selinux-policy-3.13.1-252.el7.noarch Selinux Enabled True Policy Type targeted Enforcing Mode Enforcing Host Name dev Platform Linux dev 3 .10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18 :08:02 UTC 2019 x86_64 x86_64 Alert Count 2 First Seen 2019 -11-15 10 :35:26 CST Last Seen 2019 -11-15 10 :35:41 CST Local ID 8f2821f6-889a-40a8-8ea8-8c4fd85c1d7c # \u56e0\u4e3a\u7b2c\u4e00\u4e2a\u5f00\u542f\u7684\u6743\u9650\u592a\u591a\uff0c\u6240\u4ee5\u8fd9\u91cc\u9009\u62e9\u7b2c\u4e8c\u79cd\u89e3\u51b3\u65b9\u6848 [ root@dev ~ ] # ls -dZ ~ftp drwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp [ root@dev ~ ] # semanage fcontext -a -t public_content_t \"/ftp-other(/.*)?\" # \u522b\u5fd8\u4e86\u8fd9\u4e00\u6b65\u54e6 [ root@dev ~ ] # restorecon -Rv /ftp-other/ # \u6210\u529f\u83b7\u53d6\uff01 [ root@dev ~ ] # curl ftp://ftp_u:abcd1234@localhost//ftp-other/other.txt ccm 6.2.4 \u4fee\u6539 FTP \u670d\u52a1\u7aef\u53e3 \u00b6 # \u5148\u76f4\u63a5\u4fee\u6539\u7aef\u53e3\u770b\u770b # \u5728\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c\u6dfb\u52a0 [ root@dev ~ ] # vi /etc/vsftpd/vsftpd.conf \u2026\u2026 listen_port = 555 # \u554a\u54e6\uff0c\u51fa\u9519\u4e86 [ root@dev ~ ] # systemctl restart vsftpd Job for vsftpd.service failed because the control process exited with error code. See \"systemctl status vsftpd.service\" and \"journalctl -xe\" for details. # \u662f SELinux \u51fa\u4e86\u95ee\u9898 [ root@dev ~ ] # journalctl -xe \u2026\u2026 setroubleshoot [ 48235 ] : SELinux is preventing vsftpd from name_bind access on the tcp_socket port 555 . For complete SELinux messages run: sealert -l ac1e407c-d892-445b-9cc5-82337a504a39 \u2026\u2026 # \u89e3\u51b3\u4e4b\u9053 [ root@dev ~ ] # sealert -l ac1e407c-d892-445b-9cc5-82337a504a39 SELinux is preventing vsftpd from name_bind access on the tcp_socket port 555 . ***** Plugin bind_ports ( 92 .2 confidence ) suggests ************************ If you want to allow vsftpd to bind to network port 555 Then you need to modify the port type. Do # semanage port -a -t PORT_TYPE -p tcp 555 where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t, ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t, isns_port_t, port_t, postgrey_port_t, unreserved_port_t. \u2026\u2026 # \u67e5\u770b\u4fee\u6539\u7684\u7aef\u53e3\u5c5e\u4e8e\u54ea\u4e2a type [ root@dev ~ ] # semanage port -l | grep ftp ftp_data_port_t tcp 20 ftp_port_t tcp 21 , 989 , 990 # 21 \u5728\u8fd9\u91cc\uff0c\u5c31\u662f\u4f60\u5566 ftp_port_t udp 989 , 990 tftp_port_t udp 69 [ root@dev ~ ] # semanage port -a -t ftp_port_t -p tcp 555 # OK\uff0c\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u6bd5\u5566 [ root@dev ~ ] # semanage port -l | grep ftp_port_t ftp_port_t tcp 555 , 21 , 989 , 990 ftp_port_t udp 989 , 990 tftp_port_t udp 69 # \u4fee\u6539\u5b8c\u6210\uff01 [ root@dev ~ ] # systemctl restart vsftpd [ root@dev ~ ] # netstat -tpan | grep ftp tcp6 0 0 :::555 :::* LISTEN 48351 /vsftpd [ root@dev ~ ] # curl ftp://localhost:555/pub/ -rw-r--r-- 1 0 0 221 Oct 30 2018 securetty -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf","title":"20 SELinux"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#1-selinux","text":"\u5f53\u67d0\u4e2a\u8fdb\u7a0b\u60f3\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u5b58\u53d6\u65f6\uff0c\u7cfb\u7edf\u5c31\u4f1a\u6839\u636e\u8be5\u8fdb\u7a0b\u7684\u62e5\u6709\u8005/\u7fa4\u7ec4\uff0c\u5e76\u6bd4\u5bf9\u6587\u4ef6\u7684\u6743\u9650\uff0c\u82e5\u901a\u8fc7\u6743\u9650\u68c0\u67e5\uff0c\u5c31\u53ef\u4ee5\u5b58\u53d6\u8be5\u6587\u4ef6\u4e86\u3002\u8fd9\u79cd\u5b58\u53d6\u6587\u4ef6\u7cfb\u7edf\u7684\u65b9\u5f0f\u88ab\u79f0\u4e3a \u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236 (Discretionary Access Control\uff0c DAC) \u3002 Linux\u7cfb\u7edf\u4e2d\u6709\u4e24\u79cd\u81ea\u4e3b\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\uff0c\u4e00\u79cd\u662f9\u4f4d\u6743\u9650\u7801\uff08User-Group-Other\uff09\uff0c\u53e6\u4e00\u79cd\u662f\u8bbf\u95ee\u63a7\u5236\u5217\u8868ACL\uff08Access Control List\uff09\u3002\u7f3a\u9677\u5c31\u662f\uff1a root \u5177\u6709\u6700\u9ad8\u7684\u6743\u9650 \u4f7f\u7528\u8005\u53ef\u4ee5\u53d8\u66f4\u6587\u4ef6\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650 \u603b\u4e4b\uff0cDAC\u7684\u4e0d\u8db3\u662f\u7528\u6237\u5bb9\u6613\u968f\u610f\u8bbe\u7f6e\u6743\u9650\u3002\u56e0\u6b64 SELinux \u5bfc\u5165\u4e86 \u5f3a\u5236\u8bbf\u95ee\u63a7\u5236 (Mandatory Access Control\uff0cMAC) \u7684\u65b9\u6cd5\u3002\u8be5\u65b9\u5f0f\u53ef\u4ee5\u9488\u5bf9\u7279\u5b9a\u7684 \u8fdb\u7a0b \u4e0e\u7279\u5b9a\u7684 \u6587\u4ef6\u8d44\u6e90 \u6765\u8fdb\u884c\u6743\u9650\u7684\u63a7\u7ba1\u3002SELinux \u662f\u900f\u8fc7 MAC \u7684\u65b9\u5f0f\u6765\u63a7\u7ba1\u8fdb\u7a0b\uff0c\u4ed6\u63a7\u5236\u7684 \u4e3b\u4f53 \u662f \u8fdb\u7a0b \uff0c\u800c \u76ee\u6807 \u5219\u662f\u8be5\u8fdb\u7a0b\u80fd\u5426\u8bfb\u53d6\u7684 \u6587\u4ef6\u8d44\u6e90 \u3002","title":"1. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528SELinux"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#2-selinux","text":"\u4e3b\u4f53 (Subject) \u8fdb\u7a0b\u6216\u7ebf\u7a0b\u3002 \u76ee\u6807 (Object) \u4e00\u822c\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u3002 \u7b56\u7565 (Policy) \u7531\u4e8e\u8fdb\u7a0b\u4e0e\u6587\u4ef6\u6570\u91cf\u5e9e\u5927\uff0c\u4f1a\u9884\u8bbe\u4e00\u4e9b\u7b56\u7565\uff0c\u8fd9\u4e9b\u7b56\u7565\u5185\u8fd8\u4f1a\u6709\u8be6\u7ec6\u7684\u89c4\u5219 (rule) \u6765\u6307\u5b9a\u4e0d\u540c\u7684\u670d\u52a1\u5f00\u653e\u67d0\u4e9b\u8d44\u6e90\u7684\u5b58\u53d6\u4e0e\u5426\u3002CentOS 7.x \u91cc\u9762\u4ec5\u6709\u63d0\u4f9b\u4e09\u4e2a\u4e3b\u8981\u7684\u7b56\u7565\uff1a - targeted \uff1a\u9488\u5bf9\u7f51\u7edc\u670d\u52a1\u9650\u5236\u8f83\u591a\uff0c\u9488\u5bf9\u672c\u673a\u9650\u5236\u8f83\u5c11\uff0c\u662f\u9884\u8bbe\u7684\u7b56\u7565\uff1b - minimum \uff1a\u7531 target \u4fee\u8ba2\u800c\u6765\uff0c\u4ec5\u9488\u5bf9\u9009\u62e9\u7684\u8fdb\u7a0b\u6765\u4fdd\u62a4\uff1b - mls \uff1a\u5b8c\u6574\u7684 SELinux \u9650\u5236\uff0c\u9650\u5236\u65b9\u9762\u8f83\u4e3a\u4e25\u683c\u3002 \u5b89\u5168\u6027\u672c\u6587 (security context) \u4e3b\u4f53\u80fd\u4e0d\u80fd\u5b58\u53d6\u76ee\u6807\u9664\u4e86\u7b56\u7565\u6307\u5b9a\u4e4b\u5916\uff0c\u4e3b\u4f53\u4e0e\u76ee\u6807\u7684\u5b89\u5168\u6027\u672c\u6587\u5fc5\u987b\u4e00\u81f4\u624d\u80fd\u591f\u987a\u5229\u5b58\u53d6\u3002\u5b89\u5168\u6027\u672c\u6587 (security context) \u6709\u70b9\u7c7b\u4f3c\u6587\u4ef6\u7cfb\u7edf\u7684 rwx\u3002 \u5de5\u4f5c\u6d41\u7a0b\uff1a Important \u5148\u5224\u65ad\u7684\u662f\u6587\u4ef6\u7cfb\u7edf\u7684 rwx \u6743\u9650\u8bbe\u5b9a\uff0c\u7136\u540e\u518d\u8fdb\u5165selinux\u7684\u6d41\u7a0b\u3002\u5982\u679cDAC\u7684\u6743\u9650\u90fd\u4e0d\u6ee1\u8db3\uff0c\u90a3\u4e48\u4e5f\u4e0d\u4f1a\u8fdb\u884cSELinux policy rules\u7684\u68c0\u67e5\u4e86\u3002\u9e1f\u54e5\u5728\u8fd9\u91cc\u5199\u9519\u4e86\uff0c\u8be6\u89c1 redhat\u8bf4\u660e Note \u90e8\u5206","title":"2. SELinux \u7684\u8fd0\u4f5c\u6a21\u5f0f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#21-security-context","text":"\u5b89\u5168\u6027\u672c\u6587\u5b58\u5728\u4e8e\u4e3b\u4f53\u8fdb\u7a0b\u4e2d\u4e0e\u76ee\u6807\u6587\u4ef6\u8d44\u6e90\u4e2d\u3002\u8fdb\u7a0b\u5728\u5185\u5b58\u5185\uff0c\u5b89\u5168\u6027\u672c\u6587\u53ef\u4ee5\u5b58\u5165\u5185\u5b58\uff1b\u6587\u4ef6\u7684\u5b89\u5168\u6027\u672c\u6587\u662f\u653e\u7f6e\u5230\u6587\u4ef6\u7684 inode \u5185\u7684\u3002 \u67e5\u770b\u8fdb\u7a0b\u7684\u5b89\u5168\u6027\u6587\u672c\uff1a [ sink@dev ~ ] $ ps -Z LABEL PID TTY TIME CMD unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 18876 pts/5 00 :00:00 bash unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 18923 pts/5 00 :00:00 ps \u67e5\u770b\u6587\u4ef6\u7684\u5b89\u5168\u6027\u6587\u672c\uff1a [ sink@dev ~ ] $ ls -Z -rw-rw-r--. sink sink unconfined_u:object_r:user_home_t:s0 f1 \u5185\u5bb9\u683c\u5f0f\u4e3a SELinux user:role:type:level \uff0c\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u5b57\u6bb5\uff1a SELinux user (Identify)\uff1a\u76f8\u5f53\u4e8e\u8d26\u53f7\u65b9\u9762\u7684\u8eab\u4efd\u8bc6\u522b\u3002\u7c7b\u578b\uff1a unconfined_u\uff1a\u4e0d\u53d7\u9650\u7684\u7528\u6237\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be5\u6587\u4ef6\u6765\u81ea\u4e8e \u4e0d\u53d7\u9650\u7684\u8fdb\u7a0b \u6240\u4ea7\u751f\u7684\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u9884\u8bbe\u7684bash\u662f\u4e0d\u53d7SELinux\u7ba1\u63a7\u7684\u3002 system_u\uff1a\u7cfb\u7edf\u7528\u6237\uff0c\u5927\u90e8\u5206\u5c31\u662f\u7cfb\u7edf\u81ea\u5df1\u4ea7\u751f\u7684\u6587\u4ef6\u3002 \u89d2\u8272 (Role)\uff1a\u8bf4\u660e\u8d44\u6599\u662f\u5c5e\u4e8e\u8fdb\u7a0b\u3001\u6587\u4ef6\u8d44\u6e90\u8fd8\u662f\u4ee3\u8868\u4f7f\u7528\u8005\u3002\u7c7b\u578b\uff1a object_r\uff1a\u4ee3\u8868\u7684\u662f\u6587\u4ef6\u6216\u76ee\u5f55\u7b49\u6587\u4ef6\u8d44\u6e90\u3002 system_r\uff1a\u4ee3\u8868\u7684\u5c31\u662f\u8fdb\u7a0b\u5566\uff1b\u4e0d\u8fc7\uff0c\u4e00\u822c\u4f7f\u7528\u8005\u4e5f\u4f1a\u88ab\u6307\u5b9a\u6210\u4e3a system_r\u3002 \u7c7b\u578b (Type)\uff1a\u5b9a\u4e49\u8fdb\u7a0b\u7684\u57df\uff08domain\uff09\u548c\u6587\u4ef6\u7684\u7c7b\u578b\uff08type\uff09\u3002SELinux \u7b56\u7565\u89c4\u5219\u5b9a\u4e49Type\u5982\u4f55\u76f8\u4e92\u8bbf\u95ee\uff0c\u65e0\u8bba\u662f\u8bbf\u95eetype\u7684domain\uff0c\u8fd8\u662f\u8bbf\u95ee\u53e6\u4e00\u4e2adomain\u7684domain\u3002 \u5728 targeted \u7b56\u7565\u4e0b\uff0c\u53ea\u6709\u8be5\u5b57\u6bb5\u4f1a\u5f71\u54cd\u5b58\u53d6\u3002 # \u53ef\u6267\u884c\u6587\u4ef6\u7684 type \u662f crond_exec_t\uff0c\u5728\u6267\u884c\u4e4b\u540e\u8fdb\u7a0b\u7684 domain \u4f1a\u53d8\u6210 crond_t\uff08\u901a\u8fc7 entrypoint\uff09 # entrypoint \u6743\u9650\u5728SELinux policy\u4e2d\u4f7f\u7528\uff0c\u63a7\u5236\u54ea\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u88ab\u7528\u4e8e\u8fdb\u5165\u4e00\u4e2a domain [ root@dev ~ ] # ls -Z /usr/sbin/crond -rwxr-xr-x. root root system_u:object_r:crond_exec_t:s0 /usr/sbin/crond # domain \u5df2\u7ecf\u53d8\u6210\u4e86 crond_t [ root@dev ~ ] # ps -Z -C crond LABEL PID TTY TIME CMD system_u:system_r:crond_t:s0-s0:c0.c1023 1886 ? 00 :00:01 crond # SELinux policy rule \u89c4\u5b9a\uff0c\u5141\u8bb8 crond_t \u57df\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u6807\u8bb0\u4e3a system_cron_spool_t\u3001user_cron_spool_t \u7c7b\u578b\u7684\u6587\u4ef6 [ root@dev ~ ] # ls -Z /etc/crontab /etc/cron.d /var/spool/cron/ -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 /etc/crontab /etc/cron.d: -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 0hourly -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 raid-check -rw-------. root root system_u:object_r:system_cron_spool_t:s0 sysstat /var/spool/cron/: -rw-------. root root unconfined_u:object_r:user_cron_spool_t:s0 root -rw-------. sink sink unconfined_u:object_r:user_cron_spool_t:s0 sink SELinux\u5b9e\u9a8c\uff1a [ root@dev ~ ] # vi selinux_crond_test [ root@dev cron.d ] # cat selinux_crond_test 1 * * * * root echo \"selinux test\" [ root@dev ~ ] # ls -Z selinux_crond_test -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 selinux_crond_test [ root@dev ~ ] # mv selinux_crond_test /etc/cron.d/ [ root@dev ~ ] # sc restart crond # \u8fd9\u4e2a cron \u5931\u8d25\u4e86 [ root@dev ~ ] # tail /var/log/cron Nov 12 17 :26:32 dev crond [ 22054 ] : (( null )) Unauthorized SELinux context = system_u:system_r:system_cronjob_t:s0-s0:c0.c1023 file_context = unconfined_u:object_r:admin_home_t:s0 ( /etc/cron.d/selinux_crond_test ) Nov 12 17 :26:32 dev crond [ 22054 ] : ( root ) FAILED ( loading cron table )","title":"2.1 \u5b89\u5168\u6027\u672c\u6587 (Security Context)"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#3-selinux","text":"\u5e76\u975e\u6240\u6709\u7684 Linux distributions \u90fd\u652f\u6301 SELinux \u7684\u3002 enforcing\uff1a\u5f3a\u5236\u6a21\u5f0f\uff0c\u4ee3\u8868 SELinux \u8fd0\u4f5c\u4e2d\uff0c\u4e14\u5df2\u7ecf\u6b63\u786e\u7684\u5f00\u59cb\u9650\u5236 domain/type \u4e86\uff1b permissive\uff1a\u5bbd\u5bb9\u6a21\u5f0f\uff0c\u4ee3\u8868 SELinux \u8fd0\u4f5c\u4e2d\uff0c\u4e0d\u8fc7\u4ec5\u4f1a\u6709\u8b66\u544a\u8baf\u606f\u5e76\u4e0d\u4f1a\u5b9e\u9645\u9650\u5236 domain/type \u7684\u5b58\u53d6\u3002 \u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u8fd0\u6765\u4f5c\u4e3a SELinux \u7684 debug \u4e4b\u7528\uff1b disabled\uff1a\u5173\u95ed\u3002 \u4f7f\u7528 getenforce \u6765\u67e5\u770b\u5f53\u524d\u6a21\u5f0f\uff1a [ sink@dev ~ ] $ getenforce Enforcing \u4f7f\u7528 setenforce \u6765\u4e34\u65f6\u8bbe\u7f6e\u5f53\u524d\u6a21\u5f0f\uff0c\u8981\u60f3\u6c38\u4e45\u751f\u6548\u5c31\u4fee\u6539 /etc/selinux/config \u6587\u4ef6\uff1a # permissive mode [ root@dev ~ ] # setenforce 0 [ root@dev ~ ] # getenforce Permissive # enforcing mode [ root@dev ~ ] # setenforce 1 [ root@dev ~ ] # getenforce Enforcing \u4e5f\u53ef\u4ee5\u4f7f\u7528 sestatus \u6765\u67e5\u770bSELinux\u4fe1\u606f\uff1a sestatus [ - v ] [ - b ] - v Displays the context of files and processes listed in the / etc / sestatus . conf file . - b \u5c06\u76ee\u524d\u7b56\u7565\u7684\u89c4\u5219\u5e03\u5c14\u503c\u5217\u51fa\uff0c\u5373\u67d0\u4e9b\u89c4\u5219 ( rule ) \u662f\u5426\u542f\u52a8 [ sink@dev ~ ] $ sestatus SELinux status: enabled SELinuxfs mount: /sys/fs/selinux # SELinux \u7684\u76f8\u5173\u6587\u4ef6\u6570\u636e\u6302\u8f7d\u70b9 SELinux root directory: /etc/selinux Loaded policy name: targeted Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled # \u662f\u5426\u542b\u6709 MLS \u7684\u6a21\u5f0f\u673a\u5236 Policy deny_unknown status: allowed # \u662f\u5426\u9884\u8bbe\u62b5\u6321\u672a\u77e5\u7684\u4e3b\u4f53\u8fdb\u7a0b Max kernel policy version: 31","title":"3. SELinux \u4e09\u79cd\u6a21\u5f0f\u7684\u542f\u52a8\u3001\u5173\u95ed\u4e0e\u89c2\u5bdf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#31","text":"Note \u5982\u679c\u6539\u53d8\u4e86\u7b56\u7565\u5219\u9700\u8981\u91cd\u65b0\u542f\u52a8\uff1b\u5982\u679c\u7531 enforcing \u6216 permissive \u6539\u6210 disabled\uff0c\u6216\u7531 disabled \u6539\u6210\u5176\u4ed6\u4e24\u4e2a\uff0c\u90a3\u4e5f\u5fc5\u987b\u8981\u91cd\u65b0\u542f\u52a8\u3002\u8fd9\u662f\u56e0\u4e3a SELinux \u662f\u6574\u5408\u5230\u5185\u6838\u91cc\u9762\u53bb\u7684\uff0c\u4f60\u53ea\u53ef\u4ee5\u5728 SELinux \u8fd0\u4f5c\u4e0b\u5207\u6362\u6210\u4e3a\u5f3a\u5236 (enforcing) \u6216\u5bbd\u5bb9 (permissive) \u6a21\u5f0f\uff0c\u4e0d\u80fd\u591f\u76f4\u63a5\u5173\u95ed SELinux \u7684\u3002 \u200b \u5982\u679c\u4ece disable \u8f6c\u5230\u542f\u52a8 SELinux \u7684\u6a21\u5f0f\u65f6\uff0c \u7531\u4e8e\u7cfb\u7edf\u5fc5\u987b\u8981\u9488\u5bf9\u6587\u4ef6\u5199\u5165\u5b89\u5168\u6027\u672c\u6587\u7684\u4fe1\u606f\uff0c\u56e0\u6b64\u5f00\u673a\u8fc7\u7a0b\u4f1a\u82b1\u8d39\u4e0d\u5c11\u65f6\u95f4\u5728\u7b49\u5f85\u91cd\u65b0\u5199\u5165 SELinux \u5b89\u5168\u6027\u672c\u6587 (\u6709\u65f6\u4e5f\u79f0\u4e3aSELinux Label) \uff0c\u800c\u4e14\u5728\u5199\u5b8c\u4e4b\u540e\u8fd8\u5f97\u8981\u518d\u6b21\u7684\u91cd\u65b0\u542f\u52a8\u4e00\u6b21\u3002","title":"3.1 \u542f\u52a8"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#311","text":"\u200b \u5728\u67d0\u4e9b\u7279\u6b8a\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u51fa\u73b0\u4e00\u4e9b\u670d\u52a1\u65e0\u6cd5\u542f\u52a8\u7684\u60c5\u51b5\uff0c\u7c7b\u4f3c\u4e8e\u5728 /lib/xxx \u91cc\u9762\u7684\u6570\u636e\u6ca1\u6709\u6743\u9650\u8bfb\u53d6\uff0c\u5927\u591a\u662f\u7531\u4e8e\u5728\u91cd\u65b0\u5199\u5165 SELinux type (Relabel) \u51fa\u9519\u4e4b\u6545\u3002 \u200b \u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u5728 Permissive \u7684\u72b6\u6001\u4e0b\uff0c\u4f7f\u7528 restorecon -Rv / \u91cd\u65b0\u8fd8\u539f\u6240\u6709 SELinux \u7684\u5b89\u5168\u6027\u6587\u672c\uff0c\u5c31\u80fd\u591f\u5904\u7406\u8fd9\u4e2a\u9519\u8bef\u3002","title":"3.1.1 \u542f\u52a8\u5931\u8d25\u7684\u60c5\u51b5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#4-selinux","text":"","title":"4. SELinux \u7b56\u7565\u5185\u7684\u89c4\u5219\u7ba1\u7406"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#41-selinux","text":"\u4f7f\u7528\u4e0a\u6587\u63d0\u5230\u7684 sestatus -b \u4e0e getsebool -a \u5747\u53ef\uff1a getsebool [ - a ] | [ boolean ] ... boolean :\u89c4\u5219\u540d\u79f0 - a Show all SELinux booleans . [ sink@dev ~ ] $ getsebool -a abrt_anon_write --> off abrt_handle_event --> off abrt_upload_watch_anon_write --> on \u2026\u2026 [ sink@dev ~ ] $ getsebool abrt_anon_write abrt_anon_write --> off","title":"4.1 \u67e5\u8be2 SELinux \u89c4\u5219\u7684\u5e03\u5c14\u503c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#42-selinux","text":"setsebool [ - P ] boolean value | bool1 = val1 bool2 = val2 ... Without the - P option \uff0c only the current boolean value is affected ; the boot - time default settings are not changed - P \u76f4\u63a5\u5c06\u8bbe\u5b9a\u503c\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u6c38\u4e45\u751f\u6548 # \u5173\u95ed\u89c4\u5219 [ root@dev ~ ] # setsebool -P httpd_enable_homedirs 0","title":"4.2 \u4fee\u6539 SELinux \u89c4\u5219\u7684\u5e03\u5c14\u503c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#43-selinux","text":"\u9996\u5148\u5b89\u88c5\u8f6f\u4ef6\uff1a yum install setools-console seinfo [ OPTIONS ] [ EXPRESSION ] [ POLICY ...] SELinux \u7b56\u7565\u67e5\u8be2\u5de5\u5177 OPTIONS : - x \uff0c -- expand show more info for specified components -- stats print useful policy statistics \uff0c\u9ed8\u8ba4\u9009\u9879 EXPRESSIONS : - u [ NAME ]\uff0c -- user [ = NAME ] Print a list of users or \uff0c if NAME is provided \uff0c print the user NAME . - r [ NAME ]\uff0c -- role [ = NAME ] - t [ NAME ]\uff0c -- type [ = NAME ] - b [ NAME ]\uff0c -- bool [ = NAME ] -- all Print all components . # \u7edf\u8ba1\u4fe1\u606f [ sink@dev ~ ] $ seinfo Statistics for policy file: /sys/fs/selinux/policy Policy Version & Type: v.31 ( binary\uff0c mls ) Classes: 130 Permissions: 272 Sensitivities: 1 Categories: 1024 Types: 4792 Attributes: 253 Users: 8 Roles: 14 Booleans: 316 Cond. Expr.: 362 \u2026\u2026 # \u7528\u6237\u4fe1\u606f [ sink@dev ~ ] $ seinfo -u Users: 8 sysadm_u system_u xguest_u root guest_u staff_u user_u unconfined_u [ sink@dev ~ ] $ seinfo -u -x Users: 8 sysadm_u default level: s0 range: s0 - s0:c0.c1023 roles: object_r sysadm_r system_u \u2026\u2026 sesearch [ OPTIONS ] RULE_TYPE [ RULE_TYPE ...] [ EXPRESSION ] [ POLICY ...] \u5728 SELinux \u7b56\u7565\u4e2d\u641c\u7d22\u89c4\u5219 RULE TYPE OPTIONS - A \uff0c -- allow Search for allow rules . -- all Search all rule types . - T \uff0c -- type Search for type_transition \uff0c type_member \uff0c and type_change rules . EXPRESSIONS - s NAME \uff0c -- source = NAME Find rules with type / attribute NAME as their source .\u5373\u4e3b\u4f53 - t NAME \uff0c -- target = NAME Find rules with type / attribute NAME as their target .\u5373\u76ee\u6807 - b NAME \uff0c -- bool = NAME Find conditional rules with NAME in their conditional expression .\u5373\u89c4\u5219\u540d\u5b57 [ sink@dev ~ ] $ ls -Z /usr/bin/passwd -rwsr-xr-x. root root system_u:object_r:passwd_exec_t:s0 /usr/bin/passwd [ sink@dev ~ ] $ ps -Z -C passwd LABEL PID TTY TIME CMD unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023 28764 pts/5 00 :00:00 passwd [ sink@dev ~ ] $ ls -Z /etc/shadow ----------. root root system_u:object_r:shadow_t:s0 /etc/shadow # \u5217\u51fa passwd_t \u8fd9\u4e2a\u4e3b\u4f53\u8fdb\u7a0b\u80fd\u5426\u8bfb\u53d6 SELinux type \u4e3a shadow_t \u7684\u6587\u4ef6 [ sink@dev ~ ] $ sesearch --allow -s passwd_t | grep shadow_t allow passwd_t shadow_t : file { ioctl read write create getattr setattr lock relabelfrom relabelto append map unlink link rename open } ; \u67e5\u8be2\u4e00\u4e2a\u89c4\u5219\u5185\u5b9a\u4e49\u4e86\u54ea\u4e9b\u4e1c\u897f\uff1a # \u770b\u4e00\u4e0b\u89c4\u5219\u7684\u8bf4\u660e [ root@dev ~ ] # semanage boolean -l | grep httpd_enable_homedirs httpd_enable_homedirs ( off \uff0c off ) Allow httpd to enable homedirs # \u89c4\u5219\u5185\u5b9a\u4e49\u4e86\u4ec0\u4e48 [ root@dev ~ ] # sesearch --allow -b httpd_enable_homedirs \u2026\u2026 allow httpd_t cifs_t : dir { getattr search open } ; allow httpd_t cifs_t : dir { ioctl read getattr lock search open } ; allow httpd_sys_script_t nfs_t : lnk_file { read getattr } ; \u2026\u2026","title":"4.3 SELinux \u7b56\u7565\u67e5\u8be2"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#5-selinux","text":"SELinux \u5bf9\u53d7\u9650\u7684\u4e3b\u4f53\u8fdb\u7a0b\u6709\u6ca1\u6709\u5f71\u54cd\uff0c\u7b2c\u4e00\u5173\u8003\u8651 SELinux \u7684\u4e09\u79cd\u6a21\u5f0f\uff0c\u7b2c\u4e8c\u5173\u8003\u8651 SELinux \u7684\u7b56\u7565\u89c4\u5219\u662f\u5426\u653e\u884c\uff0c\u7b2c\u4e09\u5173\u5219\u662f\u5f00\u59cb\u6bd4\u5bf9 SELinux type\u3002","title":"5. SELinux \u5b89\u5168\u672c\u6587\u7684\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#51-chcon-selinux-type","text":"chcon [ OPTION ] ... CONTEXT FILE ... chcon [ OPTION ] ... [ -u USER ] [ -r ROLE ] [ -l RANGE ] [ -t TYPE ] FILE ... chcon [ OPTION ] ... --reference=RFILE FILE... OPTION - u , --user=USER \u8bbe\u7f6e\u76ee\u6807 security context \u7684 user \u5b57\u6bb5 --reference=RFILE \u4f7f\u7528 RFILE \u7684\u5b89\u5168\u6027\u6587\u672c\u6765\u8bbe\u7f6e\u76ee\u6807 - R , --recursive - v , --verbose # hello.selinux \u662f\u7528 vi \u7f16\u5199\u7684 cron \u6587\u4ef6 [ root@dev cron.d ] # ls -Z 0hourly hello.selinux -rw-r--r--. root root system_u:object_r:system_cron_spool_t:s0 0hourly -rw-r--r--. root root unconfined_u:object_r:admin_home_t:s0 hello.selinux # \u6539\u53d8\u5176 type [ root@dev cron.d ] # chcon -vt shadow_t hello.selinux changing security context of \u2018hello.selinux\u2019 [ root@dev cron.d ] # ls -Z hello.selinux -rw-r--r--. root root unconfined_u:object_r:shadow_t:s0 hello.selinux # \u590d\u5236\u53e6\u4e00\u4e2a\u6587\u4ef6\u7684 \u5b89\u5168\u6027\u6587\u672c [ root@dev cron.d ] # chcon -v --reference=/etc/shadow hello.selinux changing security context of \u2018hello.selinux\u2019 [ root@dev cron.d ] # ls -Z hello.selinux -rw-r--r--. root root system_u:object_r:shadow_t:s0 hello.selinux [ root@dev cron.d ] # ls -Z hello.selinux /etc/shadow ----------. root root system_u:object_r:shadow_t:s0 /etc/shadow -rw-r--r--. root root system_u:object_r:shadow_t:s0 hello.selinux \u867d\u7136 chcon \u53ef\u4ee5\u624b\u52a8\u4fee\u6539\uff0c\u4f46\u662f\u4f1a\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\u4fee\u6539\u503c\u4e0d\u4e00\u5b9a\u7b26\u5408\u8981\u6c42\uff0c\u6743\u9650\u4e0d\u6ee1\u8db3\u7b49\u60c5\u51b5\uff1a [ root@dev cron.d ] # chcon -vt crond_t hello.selinux changing security context of \u2018hello.selinux\u2019 chcon: failed to change context of \u2018hello.selinux\u2019 to \u2018unconfined_u:object_r:crond_t:s0\u2019: Permission denied \u8fd9\u65f6\u5c31\u9700\u8981 restorecon \u767b\u573a\u4e86\uff0c\u5b83\u53ef\u4ee5\u8ba9 SELinux \u81ea\u5df1\u89e3\u51b3\u9ed8\u8ba4\u76ee\u5f55\u4e0b\u7684 SELinux type\u3002","title":"5.1 \u4f7f\u7528 chcon \u624b\u52a8\u4fee\u6539\u6587\u4ef6\u7684 SELinux type"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#52-selinux-type","text":"restorecon [ - R ] [ - n ] [ - p ] [ - v ] [ - e directory ] pathname ... - R , - r change files and directories file labels recursively ( descend directories ) . - v show changes in file labels , if type or role are going to be changed . [ root@dev cron.d ] # restorecon -Rv /etc/cron.d restorecon reset /etc/cron.d/hello.selinux context unconfined_u:object_r:net_conf_t:s0->unconfined_u:object_r:system_cron_spool_t:s0 \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u88ab\u4fee\u6539\u8fc7\u4e3a\u9ed8\u8ba4\u503c\u4e86\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u6210\u529f\u91cd\u542f crond \u5566\u3002\u90a3\u4e48\u9ed8\u8ba4\u503c\u5982\u4f55\u67e5\u770b\u4fee\u6539\u5462\uff0c\u4f7f\u7528 semanage \u5c31OK\u5566\uff01","title":"5.2 \u6062\u590d\u9ed8\u8ba4\u7684 SELinux type"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#53","text":"semanage < mode > < options > \u6bcf\u79cd mode\u7684\u5177\u4f53\u9009\u9879\u53ef\u4f7f\u7528 man semanage -< mode > \u67e5\u8be2 MODE fcontext Manage file context mapping definitions fcontext \u7684 OPTIONS - l , --list List records of the specified object type - a , --add Add a record of the specified object type - d , --delete Delete a record of the specified object type - m , --modify Modify a record of the specified object type # \u67e5\u8be2 /root \u76ee\u5f55\u4e0b\u7684\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # semanage fcontext -l | grep \"^/root\" SELinux fcontext type Context /root ( /.* ) ? all files system_u:object_r:admin_home_t:s0 /root/.ppprc regular file system_u:object_r:pppd_etc_t:s0 /root/.manpath regular file system_u:object_r:mandb_home_t:s0 /root/bin ( /.* ) ? all files system_u:object_r:bin_t:s0 \u2026\u2026 # \u67e5\u8be2 /etc/cron\\.d \u76ee\u5f55\u4e0b\u7684\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # semanage fcontext -l | grep \"/etc/cron\\.d\" SELinux fcontext type Context /etc/cron.daily ( /.* ) ? all files system_u:object_r:bin_t:s0 # \u65b0\u589e\u9ed8\u8ba4\u5b89\u5168\u6027\u6587\u672c [ root@dev ~ ] # mkdir /my-selinux [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /my-selinux/ # \u8fd9\u91cc\u586b\u5199\u7684\u5fc5\u987b\u662f\u5df2\u5b58\u5728\u7684 user\u3001role\u3001type \u7b49 [ root@dev ~ ] # semanage fcontext -a -t shadow_t \"/my-selinux(/.*)?\" [ root@dev ~ ] # semanage fcontext -l | grep my-selinux /my-selinux ( /.* ) ? all files system_u:object_r:shadow_t:s0 # \u5728\u65b0\u589e\u5b8c\u6bd5\u4e4b\u540e\u4e0d\u4f1a\u7acb\u5373\u751f\u6548 [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 /my-selinux/ # \u4f7f\u7528 restorecon \u4e4b\u540e\u624d\u4f1a\u751f\u6548 [ root@dev ~ ] # restorecon -Rv /my-selinux/ restorecon reset /my-selinux context unconfined_u:object_r:default_t:s0->unconfined_u:object_r:shadow_t:s0 [ root@dev ~ ] # ls -dZ /my-selinux/ drwxr-xr-x. root root unconfined_u:object_r:shadow_t:s0 /my-selinux/ Important \u5728\u4f7f\u7528 semanage fcontext \u6267\u884c\u4fee\u6539\u52a8\u4f5c\u4e4b\u540e\uff0c\u4e0d\u4f1a\u7acb\u5373\u751f\u6548\uff0c\u9700\u8981\u6267\u884c restorecon \u6765\u751f\u6548\u3002","title":"5.3 \u9ed8\u8ba4\u76ee\u5f55\u7684\u5b89\u5168\u6027\u672c\u6587\u67e5\u8be2\u4e0e\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#6-selinux","text":"\u600e\u4e48\u77e5\u9053\u54ea\u4e2a\u65f6\u5019\u624d\u9700\u8981\u6267\u884c\u4e0a\u8ff0\u6307\u4ee4\uff1f\u600e\u4e48\u77e5\u9053\u7cfb\u7edf\u56e0\u4e3a SELinux \u7684\u95ee\u9898\u5bfc\u81f4\u7f51\u7edc\u670d\u52a1\u4e0d\u5bf9\u52b2\uff1fCentOS 7.x \u63d0\u4f9b\u51e0\u652f\u4fa6\u6d4b\u7684\u670d\u52a1\u5728\u767b\u5f55 SELinux \u4ea7\u751f\u7684\u9519\u8bef\u2014\u2014 auditd \u548c setroubleshootd \u3002","title":"6. SELinux \u9519\u8bef\u4fa6\u6d4b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#61-setroubleshoot","text":"\u8fd9\u4e2a\u670d\u52a1\u4f1a\u5c06\u5173\u4e8e SELinux \u7684\u9519\u8bef\u8baf\u606f\u4e0e\u89e3\u51b3\u65b9\u6cd5\u8bb0\u5f55\u5230 /var/log/messages \u4e0e /var/log/setroubleshoot/* \u91cc\u5934\u3002 \u539f\u672c\u7684 SELinux \u4fe1\u606f\u672c\u6765\u662f\u4ee5\u4e24\u4e2a\u670d\u52a1\u6765\u8bb0\u5f55\u7684\uff0c\u5206\u522b\u662f auditd \u4e0e setroubleshootd\u3002\u65e2\u7136\u662f\u540c\u6837\u7684\u4fe1\u606f,\u56e0\u6b64 CentOS 6.x (\u542b 7.x) \u4ee5\u540e\u5c06\u4e24\u8005\u6574\u5408\u5728 auditd \u5f53\u4e2d\u5566\uff01\u6240\u4ee5,\u5e76\u6ca1\u6709setroubleshootd \u7684\u670d\u52a1\u5b58\u5728\u4e86\u3002 \u5148\u68c0\u67e5\u4e00\u4e0b\u662f\u5426\u5b89\u88c5\u4e86\u4ee5\u4e0brpm\u5305\uff1a [ sink@dev ~ ] $ rpm -qa | grep setroubleshoot setroubleshoot-plugins-3.0.67-4.el7.noarch setroubleshoot-3.2.30-7.el7.x86_64 setroubleshoot-server-3.2.30-7.el7.x86_64 \u5b89\u88c5\u597d\u4e86 setroubleshoot-server \u4e4b\u540e\uff0c\u8bf7\u8bb0\u5f97\u8981\u91cd\u65b0\u542f\u52a8 auditd\uff0c\u5426\u5219 setroubleshootd \u7684\u529f\u80fd\u4e0d\u4f1a\u88ab\u542f\u52a8\u7684\u3002","title":"6.1 setroubleshoot"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#62-ftp","text":"\u6309\u9e1f\u54e5\u8bf4\u7684\u505a\u3002 \u5b89\u88c5ftp\u670d\u52a1\u7aef\uff1a [ root@dev ~ ] # yum install -y vsftpd [ root@dev ~ ] # systemctl start vsftpd [ root@dev ~ ] # netstat -tpan | grep ftp tcp6 0 0 :::21 :::* LISTEN 48351 /vsftpd \u521b\u5efaFTP\u8d26\u6237\uff1a [ root@dev ~ ] # useradd -s /sbin/nologin ftp_u [ root@dev ~ ] # passwd ftp_u","title":"6.2 \u4f7f\u7528 FTP \u5b9e\u8df5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#621","text":"# \u4e22\u4e24\u4e2a\u6587\u4ef6\u8fdb\u53bb [ root@dev ~ ] # cp -a /etc/securetty /etc/sysctl.conf /var/ftp/pub/ [ root@dev ~ ] # ll /var/ftp/pub/ total 8 -rw-------. 1 root root 221 Oct 31 2018 securetty -rw-r--r--. 1 root root 449 Aug 9 07 :52 sysctl.conf [ root@dev ~ ] # curl ftp://localhost drwxr-xr-x 2 0 0 42 Nov 15 01 :22 pub # \u8bfb\u53d6\u76ee\u5f55\u65f6\u76ee\u5f55\u672b\u5c3e\u5fc5\u987b\u52a0\u4e0a \"/\" [ root@dev ~ ] # curl ftp://localhost/pub/ -rw------- 1 0 0 221 Oct 30 2018 securetty -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf # \u53ef\u4ee5\u8bfb\u53d6 [ root@dev ~ ] # curl ftp://localhost/pub/sysctl.conf \u2026\u2026 [ root@dev ~ ] # curl ftp://localhost/pub/securetty curl: ( 78 ) RETR response: 550 [ root@dev ~ ] # chmod a+r /var/ftp/pub/securetty # \u4fee\u6539\u6743\u9650\u4e4b\u540e\u5c31\u53ef\u4ee5\u5566 [ root@dev ~ ] # curl ftp://localhost/pub/securetty \u2026\u2026 # \u53ef\u9009\u6b65\u9aa4\uff1a\u6062\u590d\u9ed8\u8ba4\u7684 SELinux type [ root@dev ~ ] # restorecon -Rv /var/ftp/pub/","title":"6.2.1 \u770b\u770b\u533f\u540d\u8bbf\u95ee\u8005\u80fd\u5426\u83b7\u53d6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#622","text":"# \u4e22\u4e24\u4e2a\u6587\u4ef6\u8fdb\u53bb # \uff5e<user> \u4f1a\u66ff\u6362\u6bcf\u4e2a\u5e10\u53f7\u7684\u5bb6\u76ee\u5f55\uff0c\u6bd4\u5982 \uff5eftp \u5c31\u662f /var/ftp [ root@dev ~ ] # echo \"abcdefg\" > ~ftp_u/f1.txt [ root@dev ~ ] # cp -a /etc/hosts /etc/sysctl.conf ~ftp_u/ [ root@dev ~ ] # ll ~ftp_u/ total 12 -rw-r--r--. 1 root root 8 Nov 15 09 :39 f1.txt -rw-r--r--. 1 root root 158 Jun 7 2013 hosts -rw-r--r--. 1 root root 449 Aug 9 07 :52 sysctl.conf # \u8bbf\u95ee\u4e00\u4e0b\uff0cxxx\u662f\u8d26\u6237\u5bc6\u7801 [ root@dev ~ ] # curl ftp://ftp_u:xxx@localhost/~/ -rw-r--r-- 1 0 0 8 Nov 15 01 :39 f1.txt -rw-r--r-- 1 0 0 158 Jun 07 2013 hosts -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf # \u9e1f\u54e5\u8fd9\u91cc\u662f\u83b7\u53d6\u4e0d\u5230\u7684\uff0c\u4f46\u662f\u6211\u5374\u53ef\u4ee5\u83b7\u53d6\uff0c\u5443\u5443\u5443\uff0c\u53ef\u80fd\u662f\u7248\u672c\u7684\u95ee\u9898\uff1f [ root@dev ~ ] # curl ftp://ftp_u:xxx@localhost/~/f1.txt abcdefg # \u867d\u7136\u6210\u529f\u83b7\u53d6\u5230\u4e86\u6587\u4ef6\uff0c\u4f46\u8fd8\u662f\u8bb0\u5f55\u4e00\u4e0b\u51fa\u73b0\u9519\u8bef\u65f6\u7684\u540e\u7eed\u6b65\u9aa4\u5427 1 . \u5207\u6362SELinux\u7684\u6a21\u5f0f\u4e3a Permissive 2 . \u518d\u6b21\u6267\u884c\u4e00\u4e0b\u5931\u8d25\u7684\u6b65\u9aa4\uff0c\u5982\u679c\u53ef\u4ee5\u6210\u529f\u6267\u884c\u5219\u8bf4\u660e\u662fSELinux\u5bfc\u81f4\u7684 3 . \u5207\u6362SELinux\u7684\u6a21\u5f0f\u4e3a Enforcing 4 . \u67e5\u770b /var/log/messages \u6587\u4ef6\u4e86\u89e3\u53ef\u80fd\u7684\u5931\u8d25\u539f\u56e0\u53ca\u89e3\u51b3\u65b9\u6848 5 . \u89e3\u51b3\u95ee\u9898 6 . \u518d\u6b21\u6267\u884c\u5931\u8d25\u7684\u6b65\u9aa4\uff0c\u770b\u80fd\u5426\u6210\u529f","title":"6.2.2 \u666e\u901a\u8d26\u6237\u8bbf\u95ee/\u4e0b\u8f7d\u81ea\u5df1\u7684\u5bb6\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#623","text":"# \u8001\u6837\u5b50\uff0c\u5148\u9020\u6570\u636e [ root@dev ~ ] # mkdir /ftp-other [ root@dev ~ ] # chgrp ftp_u /ftp-other/ [ root@dev ~ ] # echo \"ccm\" > /ftp-other/other.txt # \u8bbf\u95ee\u4e00\u4e0b # \u6ce8\u610f\u8def\u5f84\u8981\u5199\u5b8c\u6574 [ root@dev ~ ] # curl ftp://ftp_u:abcd1234@localhost//ftp-other/other.txt curl: ( 78 ) RETR response: 550 # \u54c8\u54c8\uff0c\u7ec8\u4e8e\u51fa\u9519\u4e86 [ root@dev ~ ] # vi /var/log/messages \u2026\u2026 Nov 15 10 :35:26 dev dbus [ 1330 ] : [ system ] Activating service name = 'org.fedoraproject.Setroubleshootd' ( using servicehelper ) Nov 15 10 :35:26 dev dbus [ 1330 ] : [ system ] Successfully activated service 'org.fedoraproject.Setroubleshootd' Nov 15 10 :35:26 dev setroubleshoot: failed to retrieve rpm info for /ftp-other/other.txt Nov 15 10 :35:26 dev setroubleshoot: SELinux is preventing /usr/sbin/vsftpd from getattr access on the file /ftp-other/other.txt. For complete SELinux messages run: sealert -l 68b4938c-32d9-4a07-b3c4-0eead65887c4 \u2026\u2026 [ root@dev ~ ] # sealert -l 8f2821f6-889a-40a8-8ea8-8c4fd85c1d7c SELinux is preventing vsftpd from read access on the file other.txt. # \u610f\u601d\u662f\u8bf4\u670957.6%\u7684\u6982\u7387\u662f\u8fd9\u4e2a\u539f\u56e0\u5f15\u8d77\u7684 ***** Plugin catchall_boolean ( 57 .6 confidence ) suggests ****************** If you want to allow ftpd to full access Then you must tell SELinux about this by enabling the 'ftpd_full_access' boolean. Do setsebool -P ftpd_full_access 1 # \u8fd9\u662f\u89e3\u51b3\u65b9\u6cd5 # \u540c\u4e0a ***** Plugin catchall_labels ( 36 .2 confidence ) suggests ******************* If you want to allow vsftpd to have read access on the other.txt file Then you need to change the label on other.txt Do # semanage fcontext -a -t FILE_TYPE 'other.txt' \u2026\u2026 Then execute: restorecon -v 'other.txt' # \u5176\u4ed6\u8be6\u7ec6\u4fe1\u606f Additional Information: Source Context system_u:system_r:ftpd_t:s0-s0:c0.c1023 Target Context unconfined_u:object_r:default_t:s0 Target Objects other.txt [ file ] Source vsftpd Source Path vsftpd Port <Unknown> Host dev Source RPM Packages Target RPM Packages Policy RPM selinux-policy-3.13.1-252.el7.noarch Selinux Enabled True Policy Type targeted Enforcing Mode Enforcing Host Name dev Platform Linux dev 3 .10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18 :08:02 UTC 2019 x86_64 x86_64 Alert Count 2 First Seen 2019 -11-15 10 :35:26 CST Last Seen 2019 -11-15 10 :35:41 CST Local ID 8f2821f6-889a-40a8-8ea8-8c4fd85c1d7c # \u56e0\u4e3a\u7b2c\u4e00\u4e2a\u5f00\u542f\u7684\u6743\u9650\u592a\u591a\uff0c\u6240\u4ee5\u8fd9\u91cc\u9009\u62e9\u7b2c\u4e8c\u79cd\u89e3\u51b3\u65b9\u6848 [ root@dev ~ ] # ls -dZ ~ftp drwxr-xr-x. root root system_u:object_r:public_content_t:s0 /var/ftp [ root@dev ~ ] # semanage fcontext -a -t public_content_t \"/ftp-other(/.*)?\" # \u522b\u5fd8\u4e86\u8fd9\u4e00\u6b65\u54e6 [ root@dev ~ ] # restorecon -Rv /ftp-other/ # \u6210\u529f\u83b7\u53d6\uff01 [ root@dev ~ ] # curl ftp://ftp_u:abcd1234@localhost//ftp-other/other.txt ccm","title":"6.2.3 \u666e\u901a\u8d26\u6237\u8bbf\u95ee/\u4e0b\u8f7d\u5176\u4ed6\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/20 SELinux/#624-ftp","text":"# \u5148\u76f4\u63a5\u4fee\u6539\u7aef\u53e3\u770b\u770b # \u5728\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c\u6dfb\u52a0 [ root@dev ~ ] # vi /etc/vsftpd/vsftpd.conf \u2026\u2026 listen_port = 555 # \u554a\u54e6\uff0c\u51fa\u9519\u4e86 [ root@dev ~ ] # systemctl restart vsftpd Job for vsftpd.service failed because the control process exited with error code. See \"systemctl status vsftpd.service\" and \"journalctl -xe\" for details. # \u662f SELinux \u51fa\u4e86\u95ee\u9898 [ root@dev ~ ] # journalctl -xe \u2026\u2026 setroubleshoot [ 48235 ] : SELinux is preventing vsftpd from name_bind access on the tcp_socket port 555 . For complete SELinux messages run: sealert -l ac1e407c-d892-445b-9cc5-82337a504a39 \u2026\u2026 # \u89e3\u51b3\u4e4b\u9053 [ root@dev ~ ] # sealert -l ac1e407c-d892-445b-9cc5-82337a504a39 SELinux is preventing vsftpd from name_bind access on the tcp_socket port 555 . ***** Plugin bind_ports ( 92 .2 confidence ) suggests ************************ If you want to allow vsftpd to bind to network port 555 Then you need to modify the port type. Do # semanage port -a -t PORT_TYPE -p tcp 555 where PORT_TYPE is one of the following: certmaster_port_t, cluster_port_t, ephemeral_port_t, ftp_data_port_t, ftp_port_t, hadoop_datanode_port_t, hplip_port_t, isns_port_t, port_t, postgrey_port_t, unreserved_port_t. \u2026\u2026 # \u67e5\u770b\u4fee\u6539\u7684\u7aef\u53e3\u5c5e\u4e8e\u54ea\u4e2a type [ root@dev ~ ] # semanage port -l | grep ftp ftp_data_port_t tcp 20 ftp_port_t tcp 21 , 989 , 990 # 21 \u5728\u8fd9\u91cc\uff0c\u5c31\u662f\u4f60\u5566 ftp_port_t udp 989 , 990 tftp_port_t udp 69 [ root@dev ~ ] # semanage port -a -t ftp_port_t -p tcp 555 # OK\uff0c\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u6bd5\u5566 [ root@dev ~ ] # semanage port -l | grep ftp_port_t ftp_port_t tcp 555 , 21 , 989 , 990 ftp_port_t udp 989 , 990 tftp_port_t udp 69 # \u4fee\u6539\u5b8c\u6210\uff01 [ root@dev ~ ] # systemctl restart vsftpd [ root@dev ~ ] # netstat -tpan | grep ftp tcp6 0 0 :::555 :::* LISTEN 48351 /vsftpd [ root@dev ~ ] # curl ftp://localhost:555/pub/ -rw-r--r-- 1 0 0 221 Oct 30 2018 securetty -rw-r--r-- 1 0 0 449 Aug 08 23 :52 sysctl.conf","title":"6.2.4 \u4fee\u6539 FTP \u670d\u52a1\u7aef\u53e3"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/","text":"\u8fbe\u6210 service \u7684\u7a0b\u5e8f\u6211\u4eec\u5c31\u79f0\u547c\u4ed6\u4e3a daemon \u3002\u53ef\u4ee5\u5c06\u8fd9\u4e24\u8005\u89c6\u4e3a\u7b49\u4ef7\u5173\u7cfb\u3002 1. \u65e9\u671f System V \u7684 init \u00b6 \u65e7\u7248\u7684centos \u542f\u52a8\u7cfb\u7edf\u670d\u52a1\u7684\u7ba1\u7406\u65b9\u5f0f\u88ab\u79f0\u4e3a SysV \u7684 init \u811a\u672c\u7a0b\u5e8f\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u7cfb\u7edf\u5185\u6838\u7b2c\u4e00\u652f\u547c\u53eb\u7684\u7a0b\u5e8f\u662f init \uff0c \u7136\u540e init \u53bb\u5524\u8d77\u6240\u6709\u7684\u7cfb\u7edf\u6240\u9700\u8981\u7684\u670d\u52a1\u3002 init \u7684\u7ba1\u7406\u673a\u5236\u6709\u51e0\u4e2a\u7279\u70b9\uff1a \u6240\u6709\u7684\u670d\u52a1\u542f\u52a8\u811a\u672c\u901a\u901a\u653e\u7f6e\u4e8e /etc/init.d/ \u5e95\u4e0b\uff0c\u57fa\u672c\u4e0a\u90fd\u662f\u4f7f\u7528 bash shell script \u6240\u5199\u6210\u7684\u811a\u672c\u7a0b\u5e8f\u3002 \u670d\u52a1\u662f\u72ec\u7acb\u542f\u52a8\u6216\u88ab\u4e00\u53ea\u603b\u7ba1\u7a0b\u5e8f\u7ba1\u7406\u800c\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a \u72ec\u7acb\u542f\u52a8\u6a21\u5f0f (stand alone)\uff1a\u670d\u52a1\u72ec\u7acb\u542f\u52a8\uff0c\u8be5\u670d\u52a1\u76f4\u63a5\u5e38\u9a7b\u4e8e\u5185\u5b58\u4e2d\uff0c\u63d0\u4f9b\u672c\u673a\u6216\u7528\u6237\u7684\u670d\u52a1\u884c\u4e3a\uff0c\u53cd\u5e94\u901f\u5ea6\u5feb\u3002 \u603b\u7ba1\u7a0b\u5e8f (super daemon)\uff1a\u7531\u7279\u6b8a\u7684 xinetd \u6216 inetd \u8fd9\u4e24\u4e2a\u603b\u7ba1\u7a0b\u5e8f\u63d0\u4f9b socket \u5bf9\u5e94\u6216 port \u5bf9\u5e94\u7684\u7ba1\u7406\u3002\u5f53\u6ca1\u6709\u7528\u6237\u8981\u6c42\u67d0 socket \u6216 port \u65f6\uff0c \u6240\u9700\u8981\u7684\u670d\u52a1\u662f\u4e0d\u4f1a\u88ab\u542f\u52a8\u7684\u3002\u82e5\u6709\u7528\u6237\u8981\u6c42\u65f6\uff0cxinetd \u603b\u7ba1\u624d\u4f1a\u53bb\u5524\u9192\u76f8\u5bf9\u5e94\u7684\u670d\u52a1\u7a0b\u5e8f\u3002\u5f53\u8be5\u8981\u6c42\u7ed3\u675f\u65f6\uff0c\u8fd9\u4e2a\u670d\u52a1\u4e5f\u4f1a\u88ab\u7ed3\u675f\u6389~ \u56e0\u4e3a\u900f\u8fc7xinetd \u6240\u603b\u7ba1\uff0c\u56e0\u6b64\u8fd9\u4e2a\u5bb6\u4f19\u5c31\u88ab\u79f0\u4e3a super daemon\u3002\u597d\u5904\u662f\u53ef\u4ee5\u900f\u8fc7 super daemon \u6765\u8fdb\u884c\u670d\u52a1\u7684\u65f6\u7a0b\u3001\u8054\u673a\u9700\u6c42\u7b49\u7684\u63a7\u5236\uff0c\u7f3a\u70b9\u662f\u5524\u9192\u670d\u52a1\u9700\u8981\u4e00\u70b9\u65f6\u95f4\u7684\u5ef6\u8fdf\u3002 \u670d\u52a1\u7684\u4f9d\u8d56\u6027\u95ee\u9898\u3002init \u5728\u7ba1\u7406\u5458\u81ea\u5df1\u624b\u52a8\u5904\u7406\u8fd9\u4e9b\u670d\u52a1\u65f6\uff0c\u662f\u6ca1\u6709\u529e\u6cd5\u534f\u52a9\u4f9d\u8d56\u670d\u52a1\u7684\u5524\u9192\u7684\u3002 \u6267\u884c\u7b49\u7ea7\u7684\u5206\u7c7b\u3002init \u662f\u5f00\u673a\u540e\u6838\u5fc3\u4e3b\u52a8\u547c\u53eb\u7684\uff0c \u7136\u540e init \u53ef\u4ee5\u6839\u636e\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6267\u884c\u7b49\u7ea7\uff08 runlevel \uff09\u6765\u5524\u9192\u4e0d\u540c\u7684\u670d\u52a1\uff0c\u4ee5\u8fdb\u5165\u4e0d\u540c\u7684\u64cd\u4f5c\u754c\u9762\u3002\u57fa\u672c\u4e0a Linux \u63d0\u4f9b 7 \u4e2a\u6267\u884c\u7b49\u7ea7\uff0c\u5206\u522b\u662f 0\uff0c 1\uff0c 2...6 \uff0c \u6bd4\u8f83\u91cd\u8981\u7684\u662f 1)\u5355\u4eba\u7ef4\u62a4\u6a21\u5f0f\u30013)\u7eaf\u6587\u672c\u6a21\u5f0f\u30015)\u6587\u5b57\u52a0\u56fe\u5f62\u754c\u9762\u3002\u800c\u5404\u4e2a\u6267\u884c\u7b49\u7ea7\u7684\u542f\u52a8\u811a\u672c\u662f\u900f /etc/rc.d/rc[0-6]/SXXdaemon \uff08S \u4e3a\u542f\u52a8\u8be5\u670d\u52a1\uff0c XX \u662f\u6570\u5b57\uff0c\u4e3a\u542f\u52a8\u7684\u987a\u5e8f\uff09\u8fde\u7ed3\u5230 /etc/init.d/daemon \u3002\u5728\u5f00\u673a\u65f6\u53ef\u4ee5 \u4f9d\u5e8f\u6267\u884c \u6240\u6709\u9700\u8981\u7684\u670d\u52a1\uff0c\u540c\u65f6\u4e5f\u80fd\u89e3\u51b3\u4f9d\u8d56\u670d\u52a1\u7684\u95ee\u9898\u3002 \u6267\u884c\u7b49\u7ea7\u7684\u5207\u6362\u884c\u4e3a\u3002\u5f53\u4f60\u8981\u4ece\u7eaf\u6587\u672c\u754c\u9762 (runlevel 3) \u5207\u6362\u5230\u56fe\u5f62\u754c\u9762 (runlevel 5)\uff0c \u4e0d\u9700\u8981\u624b\u52a8\u542f\u52a8\u3001\u5173\u95ed\u8be5\u6267\u884c\u7b49\u7ea7\u7684\u76f8\u5173\u670d\u52a1\uff0c\u53ea\u8981 init 5 \u5373\u53ef\u5207\u6362\u3002 \u9644\uff1a \u9e1f\u54e5\u5bf9\u4e8einit\u7684\u8be6\u7ec6\u4ecb\u7ecd TODO 2. systemd \u00b6 CentOS 7.x \u4ee5\u540e\uff0c\u4ece init \u542f\u52a8\u8f6c\u4e3a systemd \u542f\u52a8\u670d\u52a1\u3002\u7279\u8272\uff1a \u5e73\u884c\u5904\u7406\u6240\u6709\u670d\u52a1\uff0c\u52a0\u901f\u5f00\u673a\u6d41\u7a0b\u3002 \u65e7\u7684 init \u542f\u52a8\u811a\u672c\u662f \u4e00\u9879\u4e00\u9879\u4efb\u52a1\u4f9d\u5e8f\u542f\u52a8 \u7684\u6a21\u5f0f\uff0c\u56e0\u6b64\u4e0d\u76f8\u4f9d\u7684\u670d\u52a1\u4e5f\u662f\u5f97\u8981\u4e00\u4e2a\u4e00\u4e2a\u7684\u7b49\u5f85\u3002 \u4e00\u7ecf\u8981\u6c42\u5c31\u54cd\u5e94\u7684 on-demand \u542f\u52a8\u65b9\u5f0f\u3002 systemd \u7531\u4e8e\u5e38\u9a7b\u5185\u5b58\uff0c\u56e0\u6b64\u4efb\u4f55\u8981\u6c42(on-demand) \u90fd\u53ef\u4ee5\u7acb\u5373\u5904\u7406\u540e\u7eed\u7684 daemon \u542f\u52a8\u7684\u4efb\u52a1\u3002 \u670d\u52a1\u4f9d\u8d56\u6027\u7684\u81ea\u6211\u68c0\u67e5\u3002 systemd \u53ef\u4ee5\u81ea\u5b9a\u4e49\u670d\u52a1\u4f9d\u8d56\u6027\u7684\u68c0\u67e5\u3002 \u4f9d daemon \u529f\u80fd\u5206\u7c7b\u3002 \u9996\u5148 systemd \u5148\u5b9a\u4e49\u6240\u6709\u7684\u670d\u52a1\u4e3a\u4e00\u4e2a\u670d\u52a1\u5355\u4f4d (unit)\uff0c\u5e76\u5c06\u8be5 unit \u5f52\u7c7b\u5230\u4e0d\u540c\u7684\u670d\u52a1\u7c7b\u578b (type) \u53bb\u3002 \u5c06\u591a\u4e2a daemons \u96c6\u5408\u6210\u4e3a\u4e00\u4e2a\u7fa4\u7ec4\u3002 \u5982\u540c systemV \u7684 init \u91cc\u5934\u6709\u4e2a runlevel \u7684\u7279\u8272\uff0csystemd \u4ea6\u5c06\u8bb8\u591a\u7684\u529f\u80fd\u96c6\u5408\u6210\u4e3a\u4e00\u4e2a\u6240\u8c13\u7684 target \u9879\u76ee\u3002 \u5411\u4e0b\u517c\u5bb9\u65e7\u6709\u7684 init \u670d\u52a1\u811a\u672c\u3002 \u65e7\u7684 init \u542f\u52a8\u811a\u672c\u4e5f\u80fd\u591f\u900f\u8fc7 systemd \u6765\u7ba1\u7406\uff0c\u53ea\u662f\u66f4\u8fdb\u9636\u7684 systemd \u529f\u80fd\u5c31\u6ca1\u6709\u529e\u6cd5\u652f\u6301\u5c31\u662f\u4e86\u3002 \u4e0d\u8fc7 systemd \u4e5f\u662f\u6709\u4e9b\u5730\u65b9 \u65e0\u6cd5\u5b8c\u5168\u53d6\u4ee3 init \u7684\uff1a \u5728 runlevel \u7684\u5bf9\u5e94\u4e0a\uff0c\u5927\u6982\u4ec5\u6709 runlevel 1\uff0c 3\uff0c 5 \u6709\u5bf9\u5e94\u5230 systemd \u7684\u67d0\u4e9b target \u7c7b\u578b\u800c\u5df2\uff1b systemctl \u652f\u6301\u7684\u8bed\u6cd5\u6709\u9650\u5236\uff0c\u4e0d\u50cf /etc/init.d/daemon \u5c31\u662f\u7eaf\u811a\u672c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u53c2\u6570\uff0csystemctl \u4e0d\u53ef\u81ea\u5b9a\u4e49\u53c2\u6570\uff1b \u5982\u679c\u67d0\u4e2a\u670d\u52a1\u542f\u52a8\u662f\u7ba1\u7406\u5458\u81ea\u5df1\u624b\u52a8\u6267\u884c\u542f\u52a8\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 systemctl \u53bb\u542f\u52a8\u7684\uff0c\u90a3\u4e48 systemd \u5c06\u65e0\u6cd5\u4fa6\u6d4b\u5230\u8be5\u670d\u52a1\uff0c\u800c\u65e0\u6cd5\u8fdb\u4e00\u6b65\u7ba1\u7406\uff1b systemd \u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u4e0e\u7ba1\u7406\u5458\u900f\u8fc7 standard input \u4f20\u5165\u8baf\u606f\u3002\u81ea\u884c\u64b0\u5199 systemd \u7684\u542f\u52a8\u8bbe\u5b9a\u65f6\uff0c\u52a1\u5fc5\u8981\u53d6\u6d88\u4ea4\u4e92\u673a\u5236\u548c\u542f\u52a8\u65f6\u7684\u6807\u51c6\u8f93\u5165\u4fe1\u606f\u3002 2.1 \u914d\u7f6e\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55 \u00b6 /usr/lib/systemd/system/ \uff1a\u6bcf\u4e2a\u670d\u52a1\u6700\u4e3b\u8981\u7684\u542f\u52a8\u811a\u672c\u8bbe\u5b9a\uff0c\u6709\u70b9\u7c7b\u4f3c\u4ee5\u524d\u7684 /etc/init.d \u5e95\u4e0b\u7684\u6587\u4ef6\uff1b /run/systemd/system/ \uff1a\u7cfb\u7edf\u6267\u884c\u8fc7\u7a0b\u4e2d\u6240\u4ea7\u751f\u7684\u670d\u52a1\u811a\u672c\uff1b /etc/systemd/system/ \uff1a\u7ba1\u7406\u5458\u4f9d\u636e\u4e3b\u673a\u7cfb\u7edf\u7684\u9700\u6c42\u6240\u5efa\u7acb\u7684\u6267\u884c\u811a\u672c\uff0c\u5176\u5b9e\u8fd9\u4e2a\u76ee\u5f55\u6709\u70b9\u50cf\u4ee5\u524d /etc/rc.d/rc5.d/Sxx \u4e4b\u7c7b\u7684\u529f\u80fd\u3002 \u8fd9\u4e09\u4e2a\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u7684\u6267\u884c \u4f18\u5148\u7ea7\u4f9d\u6b21\u9012\u589e \u3002 2.2 \u5e38\u89c1\u670d\u52a1\u7c7b\u578b \u00b6 /usr/lib/systemd/system/ \u4ee5 \u6269\u5c55\u540d \u533a\u5206\u4e0d\u540c\u7684\u670d\u52a1\u7c7b\u578b\u3002 [ sink@dev ~ ] $ ll / usr / lib / systemd / system / | egrep '(vsftpd|crond|multi)' - rw - r --r--. 1 root root 318 Aug 9 07:07 crond.service - rw - r --r--. 1 root root 623 Aug 9 07:08 multipathd.service - rw - r --r--. 1 root root 492 Aug 8 19:58 multi-user.target drwxr - xr - x . 2 root root 258 Oct 22 16 : 17 multi - user . target . wants lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel2 . target -> multi - user . target lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel3 . target -> multi - user . target lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel4 . target -> multi - user . target - rw - r --r--. 1 root root 171 Oct 31 2018 vsftpd.service - rw - r --r--. 1 root root 184 Oct 31 2018 vsftpd@.service - rw - r --r--. 1 root root 89 Oct 31 2018 vsftpd.target \u5e38\u89c1\u7684\u670d\u52a1\u7c7b\u578b\uff1a \u6269\u5c55\u540d \u4e3b\u8981\u670d\u52a1\u529f\u80fd .service \u4e00\u822c\u670d\u52a1\u7c7b\u578b (service unit)\uff1a\u4e3b\u8981\u662f\u7cfb\u7edf\u670d\u52a1\uff0c\u5305\u62ec\u670d\u52a1\u5668\u672c\u8eab\u6240\u9700\u8981\u7684\u672c\u673a\u670d\u52a1\u4ee5\u53ca\u7f51\u7edc\u670d\u52a1\u3002 .socket \u5185\u90e8\u7a0b\u5e8f\u6570\u636e\u4ea4\u6362\u7684\u63d2\u69fd\u670d\u52a1 (socket unit)\uff1a\u4e3b\u8981\u662f IPC (Inter-process communication) \u7684\u4f20\u8f93\u8baf\u606f\u63d2\u69fd\u6587\u4ef6 (socket file) \u529f\u80fd\u3002 .target \u6267\u884c\u73af\u5883\u7c7b\u578b (target unit)\uff1a\u5176\u5b9e\u662f\u4e00\u7fa4 unit \u7684\u96c6\u5408\u3002 .mount .automount \u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u76f8\u5173\u7684\u670d\u52a1 (automount unit / mount unit)\u3002 .path \u4fa6\u6d4b\u7279\u5b9a\u6587\u4ef6\u6216\u76ee\u5f55\u7c7b\u578b (path unit)\uff1a\u67d0\u4e9b\u670d\u52a1\u9700\u8981\u4fa6\u6d4b\u67d0\u4e9b\u7279\u5b9a\u7684\u76ee\u5f55\u6765\u63d0\u4f9b\u961f\u5217\u670d\u52a1\u3002 .timer \u5faa\u73af\u6267\u884c\u7684\u670d\u52a1 (timer unit)\uff1a\u7c7b\u4f3c\u4e8e anacrontab \u3002\u4e0d\u8fc7\u662f\u7531 systemd \u4e3b\u52a8\u63d0\u4f9b\u7684\uff0c\u6bd4 anacrontab \u66f4\u52a0\u6709\u5f39\u6027 2.3 \u670d\u52a1\u72b6\u6001 \u00b6 static\uff1a\u8fd9\u4e2a daemon \u4e0d\u53ef\u4ee5\u81ea\u5df1\u542f\u52a8 (enable \u4e0d\u53ef)\uff0c\u4e0d\u8fc7\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u7684 enabled \u7684\u670d\u52a1\u6765\u5524\u9192 (\u4f9d\u8d56 \u7684\u670d\u52a1) mask\uff1a\u8fd9\u4e2a daemon \u65e0\u8bba\u5982\u4f55\u90fd\u65e0\u6cd5\u88ab\u542f\u52a8!\u56e0\u4e3a\u5df2\u7ecf\u88ab\u5f3a\u5236\u6ce8\u9500 (\u975e\u5220\u9664)\u3002\u53ef\u900f\u8fc7 systemctl unmask \u65b9 \u5f0f\u6539\u56de\u539f\u672c\u72b6\u6001 2.4 \u670d\u52a1\u7ba1\u7406 \u00b6 systemctl mask < unit - name > \u5f3a\u5236\u6ce8\u9500\u670d\u52a1\uff0c\u589e\u5f3a\u7248\u7684 disable \uff0c\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u80fd\u542f\u52a8\u8be5\u670d\u52a1 systemctl unmask < unit - name > \u672c\u8d28\u4e0a\u5c31\u662f\u5229\u7528 /etc/systemd/system/ \u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u5efa\u7acb\u4e00\u6761\u6307\u5411 /dev/null \u7684\u65e0\u7528\u94fe\u63a5\u3002 [ root@dev ~ ] # systemctl is-active cups.service active [ root@dev ~ ] # systemctl is-enabled cups.service enabled [ root@dev ~ ] # systemctl mask cups.service Created symlink from /etc/systemd/system/cups.service to /dev/null. [ root@dev ~ ] # systemctl is-enabled cups.service masked # \u6ce8\u610f\u8fd9\u91cc\u4ecd\u7136\u662f\u542f\u52a8\u72b6\u6001\uff0c\u6240\u4ee5\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5148\u5173\u95ed\u670d\u52a1\uff0c\u518d\u6ce8\u9500\u670d\u52a1 [ root@dev ~ ] # systemctl is-active cups.service active [ root@dev ~ ] # ll /etc/systemd/system/cups.service lrwxrwxrwx. 1 root root 9 Nov 25 14 :11 /etc/systemd/system/cups.service -> /dev/null 2.5 \u67e5\u770bsocket\u6587\u4ef6 \u00b6 systemctl list - sockets [ --all] 2.6 \u67e5\u770b\u670d\u52a1 \u00b6 systemctl \u663e\u793a enabled \u670d\u52a1 systemctl list - unit - files \u5217\u51fa\u6240\u6709\u5df2\u7ecf\u5b89\u88c5\u7684\u670d\u52a1 systemctl list - units [ --type=unit-type] [--all] \u5217\u51fa\u76ee\u524d\u542f\u52a8\u7684 unit\uff0c --all\uff1a\u628a inactive \u7684unit\u4e5f\u5217\u51fa\u6765 2.7 \u7ba1\u7406\u4e0d\u540c\u7684\u64cd\u4f5c\u73af\u5883 \u00b6 2.7.1 \u67e5\u770b \u00b6 [ root@dev ~ ] # systemctl list-units --type target --all UNIT LOAD ACTIVE SUB DESCRIPTION basic.target loaded active active Basic System cryptsetup.target loaded active active Local Encrypted Volumes \u2026\u2026 \u4e0e\u64cd\u4f5c\u754c\u9762\u76f8\u5173\u6027\u6bd4\u8f83\u9ad8\u7684 target\uff1a multi-user.target\uff1a\u7eaf\u6587\u672c\u591a\u7528\u6237\u6a21\u5f0f graphical.target\uff1a\u6587\u672c\u52a0\u4e0a\u56fe\u5f62\u754c\u9762\uff0c\u5305\u542b multi-user.target rescue.target\uff1a\u6551\u63f4\u6a21\u5f0f\u3002\u5728\u65e0\u6cd5\u4f7f\u7528 root \u767b\u5165\u7684\u60c5\u51b5\u4e0b\uff0csystemd \u5728\u5f00\u673a\u65f6\u4f1a\u591a\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u6682\u65f6\u7cfb\u7edf\uff0c\u4e0e\u4f60\u539f\u672c\u7684\u7cfb\u7edf\u65e0\u5173\u3002 emergency.target\uff1a\u6025\u6551\u6a21\u5f0f\u3002\u8fd8\u662f\u9700\u8981\u4f7f\u7528 root \u767b\u5165\u7684\u60c5\u51b5\uff0c\u5728\u65e0\u6cd5\u4f7f\u7528 rescue.target \u65f6\u53ef\u4ee5\u5c1d\u8bd5 shutdown.target\uff1a\u5173\u673a\u7684\u6d41\u7a0b getty.target\uff1a\u53ef\u4ee5\u8bbe\u5b9a\u4f60\u9700\u8981\u51e0\u4e2a tty \u4e4b\u7c7b\u7684\uff0c\u5982\u679c\u60f3\u8981\u964d\u4f4e tty \u7684\u9879\u76ee\uff0c\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u4e1c\u897f\u7684\u914d\u7f6e\u6587\u4ef6 2.7.2 \u7ba1\u7406 \u00b6 systemctl [ command ] [ unit.target ] commands : get - default set - default \u4fee\u6539\u7cfb\u7edf\u7684\u9ed8\u8ba4\u64cd\u4f5c\u6a21\u5f0f isolate \u5207\u6362\u6a21\u5f0f [ sink@dev ~ ] $ systemctl get-default graphical.target # \u6ce8\u610f\u8fd9\u91cc\u4fee\u6539\u7684\u662f\u5168\u90e8\u7528\u6237\u7684\u9ed8\u8ba4\u914d\u7f6e [ sink@dev ~ ] $ systemctl set-default multi-user.target Removed symlink /etc/systemd/system/default.target. Created symlink from /etc/systemd/system/default.target to /usr/lib/systemd/system/multi-user.target. # \u5207\u6362\u5230\u6587\u672c\u6a21\u5f0f [ sink@dev ~ ] $ systemctl isolate multi-user.target 2.7.3 \u6682\u505c\u4e0e\u4f11\u7720\u6a21\u5f0f \u00b6 suspend\uff1a\u6682\u505c\u6a21\u5f0f\u4f1a\u5c06\u7cfb\u7edf\u7684\u72b6\u6001\u6570\u636e\u4fdd\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5173\u95ed\u6389\u5927\u90e8\u5206\u7684\u7cfb\u7edf\u786c\u4ef6\uff0c\u5e76\u6ca1\u6709\u5b9e\u9645\u5173\u673a\u3002\u5524\u9192\u7684\u901f\u5ea6\u8f83\u5feb\u3002 hibernate\uff1a\u4f11\u7720\u6a21\u5f0f\u5219\u662f\u5c06\u7cfb\u7edf\u72b6\u6001\u4fdd\u5b58\u5230\u786c\u76d8\u5f53\u4e2d\uff0c\u4fdd\u5b58\u5b8c\u6bd5\u540e\uff0c\u5c06\u8ba1\u7b97\u673a\u5173\u673a\u3002\u5f53\u7528\u6237\u5c1d\u8bd5\u5524\u9192\u7cfb\u7edf\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5f00\u59cb\u6b63\u5e38\u8fd0\u4f5c\uff0c \u7136\u540e\u5c06\u4fdd\u5b58\u5728\u786c\u76d8\u4e2d\u7684\u7cfb\u7edf\u72b6\u6001\u6062\u590d\u56de\u6765\u3002\u5524\u9192\u7684\u901f\u5ea6\u4e0e\u4f60\u7684\u786c\u76d8\u901f\u5ea6\u6709\u5173\u3002 \u9664\u4e86\u4f7f\u7528 isolate \u6765\u5207\u6362\u5404\u79cd\u6a21\u5f0f\uff0csystemd \u8fd8\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u6307\u4ee4\u6765\u5207\u6362\u6a21\u5f0f\uff1a systemctl suspend systemctl hibernate 2.8 \u5206\u6790\u670d\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb \u00b6 systemctl list - dependencies [ NAME ] Options --reverse \u5217\u51fa\u8c01\u4f9d\u8d56\u8be5 unit --after \u4f4d\u4e8e\u8be5 unit \u4e4b\u524d\u7684 unit\uff08\u4f60\u6ca1\u770b\u9519\uff0c\u6211\u6ca1\u6709\u5199\u53cd\uff09 --before \u4f4d\u4e8e\u8be5 unit \u4e4b\u540e\u7684 unit --all \u9ed8\u8ba4\u53ea\u4f1a\u5217\u51fa target unit \u7684\u4f9d\u8d56\uff0c\u4f7f\u7528\u8be5\u9009\u9879\u5217\u51fa\u5168\u90e8 [ sink@dev ~ ] $ systemctl get-default multi-user.target [ sink@dev ~ ] $ systemctl list-dependencies default.target \u25cf \u251c\u2500abrt-ccpp.service \u25cf \u251c\u2500abrt-oops.service \u25cf \u251c\u2500abrt-vmcore.service \u2026\u2026 # \u5728\u8be5 unit \u542f\u52a8\u4e4b\u540e\u518d\u542f\u52a8\u7684 unit\uff0c\u5373\u8be5 unit \u9700\u8981\u5728\u54ea\u4e9b unit \u4e4b\u524d\u5c31\u542f\u52a8\u4e86 [ sink@dev ~ ] $ systemctl list-dependencies --before default.target \u25cf \u251c\u2500systemd-readahead-done.service \u25cf \u251c\u2500systemd-readahead-done.timer \u25cf \u251c\u2500systemd-update-utmp-runlevel.service \u25cf \u2514\u2500graphical.target \u25cf \u2514\u2500systemd-update-utmp-runlevel.service # target \u4e2d\u53ea\u6709\u56fe\u5f62\u754c\u9762\u4f7f\u7528\u5230\u4e86 multi-user.target [ sink@dev ~ ] $ systemctl list-dependencies --reverse default.target \u25cf \u2514\u2500graphical.target [ sink@dev ~ ] $ systemctl list-dependencies vsftpd vsftpd.service \u25cf \u251c\u2500system.slice \u25cf \u2514\u2500basic.target \u25cf \u251c\u2500firewalld.service \u25cf \u251c\u2500microcode.service \u2026\u2026 2.9 \u4e0e systemd \u7684 daemon \u8fd0\u884c\u8fc7\u7a0b\u76f8\u5173\u7684\u76ee\u5f55 \u00b6 \u54ea\u4e9b\u76ee\u5f55\u8ddf\u7cfb\u7edf\u7684 daemon \u8fd0\u4f5c\u6709\u5173\uff1a /usr/lib/systemd/system/ \u9ed8\u8ba4\u7684\u542f\u52a8\u811a\u672c\u914d\u7f6e\u6587\u4ef6\u90fd\u653e\u5728\u8fd9\u91cc\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u5c3d\u91cf\u4e0d\u8981\u4fee\u6539\uff08\u5230 /etc/systemd/system \u4fee\u6539\uff09 /run/systemd/system/ \u7cfb\u7edf\u6267\u884c\u8fc7\u7a0b\u4e2d\u6240\u4ea7\u751f\u7684\u670d\u52a1\u811a\u672c\uff0c\u8fd9\u4e9b\u811a\u672c\u7684\u4f18\u5148\u5e8f\u8981\u6bd4 /usr/lib/systemd/system/ \u9ad8\u3002 /etc/systemd/system/ \u7ba1\u7406\u5458\u4f9d\u636e\u4e3b\u673a\u7cfb\u7edf\u7684\u9700\u6c42\u6240\u5efa\u7acb\u7684\u6267\u884c\u811a\u672c\uff0c\u6267\u884c\u4f18\u5148\u5e8f\u53c8\u6bd4 /run/systemd/system/ \u9ad8\u3002 /etc/sysconfig/* \u51e0\u4e4e\u6240\u6709\u7684\u670d\u52a1\u90fd\u4f1a\u5c06 \u521d\u59cb\u5316\u7684\u4e00\u4e9b\u9009\u9879 \u8bbe\u5b9a\u5199\u5165\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u3002 /var/lib/ \u4e00\u4e9b\u4f1a\u4ea7\u751f\u6570\u636e\u7684\u670d\u52a1\u90fd\u4f1a\u5c06\u4ed6\u7684\u6570\u636e\u5199\u5165\u5230\u8be5\u76ee\u5f55\u4e0b\u3002 /run/ \u653e\u7f6e\u4e86\u597d\u591a daemon \u7684\u4e34\u65f6\u6587\u4ef6\uff0c\u5305\u62ec lock file \u4ee5\u53ca PID file \u7b49\u7b49\u3002 2.10 service \u7c7b\u578b\u914d\u7f6e\u6587\u4ef6 \u00b6 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u6700\u597d\u5728 /etc/systemd/system/ \u4e0b\u9762\u65b0\u589e\u6216\u8005\u4fee\u6539\uff0c\u800c\u4e0d\u8981\u6539\u52a8\u539f\u5148\u5728 /usr/lib/systemd/system/ \u5c31\u6709\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u4ee5 vsftpd.service \u4e3a\u4f8b\uff0c\u5bf9\u76ee\u5f55\u7684\u4f5c\u7528\u8fdb\u884c\u8bf4\u660e\uff1a /usr/lib/systemd/system/vsftpd.service\uff1a\u5b89\u88c5\u65f6\u9884\u8bbe\u7684\u914d\u7f6e\u6587\u4ef6\uff1b /etc/systemd/system/vsftpd.service.d/custom.conf\uff1a\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5 .conf \u4e3a\u540e\u7f00\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4f1a\u7d2f\u52a0\u5230 /usr/lib/systemd/system/vsftpd.service \u91cc\u9762\uff1b /etc/systemd/system/vsftpd.service.wants/*\uff1a\u6b64\u76ee\u5f55\u4e0b\u90fd\u662f\u94fe\u63a5\u6587\u4ef6\uff0c\u610f\u601d\u662f\u542f\u52a8\u4e86 vsftpd.service \u4e4b\u540e\uff0c\u6700\u597d\u8fd9\u4e9b\u670d\u52a1\u4e5f\u542f\u52a8\uff1b /etc/systemd/system/vsftpd.service.requires/*\uff1a\u6b64\u76ee\u5f55\u4e0b\u90fd\u662f\u94fe\u63a5\u6587\u4ef6\uff0c\u610f\u601d\u662f\u542f\u52a8 vsftpd.service \u4e4b\u524d\uff0c\u8fd9\u4e9b\u670d\u52a1\u5fc5\u987b\u542f\u52a8\u3002 2.10.1 \u914d\u7f6e\u6587\u4ef6\u5185\u5bb9 \u00b6 \u4ee5 /usr/lib/systemd/system/sshd.service \u4e3a\u4f8b\uff1a [ root@dev ~ ] # cat /usr/lib/systemd/system/sshd.service [ Unit ] Description = OpenSSH server daemon Documentation = man:sshd ( 8 ) man:sshd_config ( 5 ) After = network.target sshd-keygen.service Wants = sshd-keygen.service [ Service ] Type = notify EnvironmentFile = /etc/sysconfig/sshd ExecStart = /usr/sbin/sshd -D $OPTIONS ExecReload = /bin/kill -HUP $MAINPID KillMode = process Restart = on-failure RestartSec = 42s [ Install ] WantedBy = multi-user.target \u67e5\u770b\u4e0a\u9762\u7684\u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff1a [Unit]\uff1aunit \u672c\u8eab\u7684\u8bf4\u660e\u3001\u6587\u6863\u3001\u4f9d\u8d56\u7b49\uff1b [Service]\uff1aService \u8868\u660e\u8fd9\u662fservice\u7c7b\u578b\u7684\u670d\u52a1\uff0c\u5176\u4ed6 unit \u7c7b\u578b\u4e5f\u6709\u81ea\u5df1\u5bf9\u5e94\u7684\u540d\u79f0\uff0c\u8fd9\u90e8\u5206\u4e0e\u5b9e\u9645\u6267\u884c\u7684\u6307\u4ee4\u53c2\u6570\u6709\u5173\uff0c\u5305\u62ec\u5982\u4f55\u542f\u52a8\u3001\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u7b49\uff1b [Install]\uff1a\u6b64 unit \u6302\u8f7d\u5230\u54ea\u4e2a target \u4e0b\u9762\u3002 [ root@dev ~ ] # ll /etc/systemd/system/multi-user.target.wants/sshd.service lrwxrwxrwx. 1 root root 36 Oct 18 19 :48 /etc/systemd/system/multi-user.target.wants/sshd.service -> /usr/lib/systemd/system/sshd.service 2.10.1.1 \u914d\u7f6e\u6587\u4ef6\u89c4\u5219 \u00b6 \u8bbe\u5b9a\u53c2\u6570\u901a\u5e38\u662f\u53ef\u4ee5\u91cd\u590d\u7684\uff0c\u4e0d\u8fc7\u540e\u9762\u7684\u4f1a\u8986\u76d6\u6389\u524d\u9762\u7684\u8bbe\u5b9a\uff0c\u90a3\u4e48\u5f52\u96f6\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a After= \uff1b \u5982\u679c\u8bbe\u5b9a\u53c2\u6570\u9700\u8981\u6709 \u662f/\u5426 \u7684\u9879\u76ee (\u5e03\u5c14\u503c\uff0c boolean)\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4efb\u610f\u503c\u53ca\u5176\u76f8\u53cd\u503c\uff1a 1\uff0con\uff0ctrue\uff0cyes \uff1b \u5f00\u5934\u4e3a # \u6216 ; \u7684\u90a3\u4e00\u884c\uff0c\u90fd\u4ee3\u8868\u6ce8\u91ca\u3002 2.10.1.2 \u914d\u7f6e\u6587\u4ef6\u53c2\u6570 \u00b6 \u6bcf\u4e2a\u90e8\u5206\u7684\u90e8\u5206\u53c2\u6570\u5982\u4e0b\u6240\u793a\uff08\u6240\u6709\u53c2\u6570\u7684\u67e5\u9605\uff1a man systemd.unit \u4e2d\u6709 [Unit] \u548c [Install] \u90e8\u5206\u7684\u8bf4\u660e\uff0c\u5404\u79cd\u7c7b\u578b\u7684\u8bf4\u660e\u5728\u5404\u81ea\u7684 man systemd.<unit_type> \u4e2d\u3002\uff09\uff1a \u4ee5 vsftpd2.service \u4e3a\u4f8b\u65b0\u5efa\u4e00\u4e2aftp\u670d\u52a1\uff1a [ root@dev vsftpd ] # cd /etc/vsftpd/ [ root@dev vsftpd ] # cp vsftpd.conf vsftpd2.conf # \u5728\u524d\u9762\u7684 SELinux \u7ae0\u8282\u4fee\u6539\u4e86\u7aef\u53e3\u53f7\u4e3a 555\uff0c\u628a\u5b83\u6539\u56de\u6765 21 [ root@dev vsftpd ] # vi vsftpd.conf [ root@dev vsftpd ] # cd /etc/systemd/system/ [ root@dev system ] # cp /usr/lib/systemd/system/vsftpd.service vsftpd2.service # \u628a\u91cc\u9762\u7684\u542f\u52a8\u914d\u7f6e\u6587\u4ef6\u6362\u6210 vsftpd2.conf [ root@dev system ] # vi vsftpd2.service # \u56e0\u4e3a\u5df2\u7ecf\u5728 SELinux \u7684\u89c4\u5219\u4e2d\u6dfb\u52a0\u4e86 555 \u7aef\u53e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u4f1a\u62a5\u9519\u5566 [ root@dev system ] # systemctl restart vsftpd.service vsftpd2.service [ root@dev system ] # netstat -ntlp | grep ftp tcp6 0 0 :::555 :::* LISTEN 10565 /vsftpd tcp6 0 0 :::21 :::* LISTEN 10564 /vsftpd 2.10.2 \u914d\u7f6e\u591a\u4e2a\u91cd\u590d\u8bbe\u5b9a\u7684\u670d\u52a1 \u00b6 vsftpd \u53ef\u4ee5\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\uff0c\u90a3\u5982\u679c\u6bcf\u4e2a\u51e0\u4e4e\u76f8\u540c\u7684\u5b9e\u4f8b\u90fd\u8981\u5728 /etc/systemd/system/ \u4e0b\u9762\u7f16\u5199\u914d\u7f6e\u5c82\u4e0d\u662f\u8981\u7d2f\u6b7b\u4eba\u4e86\uff1f [ root@dev ~ ] # cd /etc/vsftpd # \u628a\u7aef\u53e3\u6539\u4e3a 9003 [ root@dev vsftpd ] # vi vsftpd3.conf # \u4e0d\u8981 enable \u8be5\u670d\u52a1\uff01\uff01\uff01 [ root@dev vsftpd ] # systemctl start vsftpd@vsftpd3.service [ root@dev vsftpd ] # netstat -ntlp | grep ftp tcp6 0 0 :::9003 :::* LISTEN 11681 /vsftpd tcp6 0 0 :::555 :::* LISTEN 10565 /vsftpd tcp6 0 0 :::21 :::* LISTEN 10564 /vsftpd \u600e\u4e48\u6837\uff0c\u662f\u4e0d\u662f\u5f88\u795e\u5947\uff0c\u5c45\u7136\u53ea\u590d\u5236\u4e86\u4e00\u4efdftp\u8fd0\u884c\u65f6\u914d\u7f6e\u5c31\u53ef\u4ee5\u76f4\u63a5\u8d77\u6765\u4e00\u4e2a\u670d\u52a1\uff01\u4e3b\u8981\u53d1\u6325\u4f5c\u7528\u7684\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u6587\u4ef6\u5566\uff1a [ root@dev vsftpd ] # cat /usr/lib/systemd/system/vsftpd@.service [ Unit ] Description = Vsftpd ftp daemon After = network.target PartOf = vsftpd.target [ Service ] Type = forking ExecStart = /usr/sbin/vsftpd /etc/vsftpd/%i.conf [ Install ] WantedBy = vsftpd.target \u5728\u542f\u52a8\u7684\u811a\u672c\u8bbe\u5b9a\u5f53\u4e2d\uff0c %i \u6216 %I \u5c31\u662f\u4ee3\u8868 @ \u540e\u9762\u63a5\u7684\u8303\u4f8b\u6587\u4ef6\u540d\u7684\u610f\u601d\uff0c\u6709\u4e86\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5c31\u80fd\u50cf\u4e0a\u9762\u90a3\u6837\u91cd\u590d\u542f\u52a8\u670d\u52a1\u5566\u3002 Note \u8fd9\u6b21\u589e\u52a0\u7aef\u53e3\u5374\u4e0d\u9700\u8981\u66f4\u6539SELinux\u7684\u914d\u7f6e\u4e86\uff0c\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4\u542f\u52a8\u5c0f\u4e8e 1024 \u53f7\u7801\u4ee5\u4e0b\u7684\u7aef\u53e3\u53e3\u65f6\uff0c \u9700\u8981\u4f7f\u7528\u5230 root \u7684\u6743\u9650\uff0c\u56e0\u6b64\u5c0f\u4e8e 1024 \u4ee5\u4e0b\u7aef\u53e3\u7684\u542f\u52a8\u8f83\u53ef\u6015\u3002\u800c\u8fd9\u6b21\u8303\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 9003 \u7aef\u53e3\uff0c\u4ed6\u5bf9\u4e8e\u7cfb\u7edf\u7684\u5f71\u54cd\u53ef\u80fd\u5c0f\u4e00\u4e9b (\u5176\u5b9e\u4e00\u6837\u53ef\u6015!)\uff0c \u6240\u4ee5\u5c31\u5ffd\u7565\u4e86 SELinux \u7684\u9650\u5236\u4e86\u3002 2.10.3 \u5236\u4f5c\u670d\u52a1\u793a\u4f8b \u00b6 \u53ea\u6267\u884c\u4e00\u6b21\u7684\u670d\u52a1\u3002 # \u5177\u6709\u6267\u884c\u6743\u9650\u7684\u811a\u672c [ root@dev ~ ] # ll /home/backup.sh -rwxr-xr-x. 1 root root 199 Nov 25 17 :25 /home/backup.sh [ root@dev ~ ] # cat /home/backup.sh #!/bin/sh [ ! -d /tmp/boot_backup ] && mkdir /tmp/boot_backup date_str = $( date +%Y%m%d ) tar -zcf /tmp/boot_backup/boot_backup_ ${ date_str } .tar.gz /boot & > /tmp/boot_backup/boot_backup_ ${ date_str } .log # \u670d\u52a1\u914d\u7f6e\u6587\u4ef6 [ root@dev ~ ] # cat /etc/systemd/system/backup.service [ Unit ] Description = /boot backup service Requires = atd.service [ Service ] Type = simple # \u8fd9\u91cc\u597d\u50cf\u4e0d\u652f\u6301 shell \u62d3\u5c55\uff0c\u53ea\u80fd\u5199\u5728 bash \u53c2\u6570\u91cc\u9762\u4f5c\u4e3a\u652f\u6301\uff1f\uff1f\uff1f ExecStart = /bin/bash -c \"/usr/bin/echo /home/backup.sh | at now\" [ Install ] WantedBy = multi-user.target [ root@dev ~ ] # systemctl daemon-reload # \u6267\u884c\u4e00\u6b21 [ root@dev ~ ] # systemctl start backup.service # \u56e0\u4e3a\u662f\u4e00\u6b21\u6027\u7684\u670d\u52a1\uff0c\u6240\u4ee5\u8fd9\u91cc\u662f inactive [ root@dev ~ ] # systemctl status backup.service \u25cf backup.service - /boot backup service Loaded: loaded ( /etc/systemd/system/backup.service ; disabled ; vendor preset: disabled ) # vendor preset\uff1a\u4f9b\u5e94\u5546\u9884\u8bbe Active: inactive ( dead ) Nov 25 17 :31:34 dev systemd [ 1 ] : Started /boot backup service. Nov 25 17 :31:34 dev bash [ 12851 ] : job 7 at Mon Nov 25 17 :31:00 2019 # \u67e5\u770b\u7ed3\u679c [ root@dev ~ ] # ll /tmp/boot_backup/ total 186324 -rw-r--r--. 1 root root 44 Nov 25 17 :31 boot_backup_20191125.log -rw-r--r--. 1 root root 190790040 Nov 25 17 :31 boot_backup_20191125.tar.gz 2.11 timer \u7c7b\u578b\u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 systemd.timer \u7684\u4f18\u52bf \u7531\u4e8e\u6240\u6709\u7684 systemd \u7684\u670d\u52a1\u4ea7\u751f\u7684\u4fe1\u606f\u90fd\u4f1a\u88ab\u7eaa\u5f55 (log)\uff0c\u56e0\u6b64\u6bd4 crond \u5728 debug \u4e0a\u9762\u8981\u66f4\u6e05\u695a\u65b9\u4fbf\u7684\u591a; \u5404\u9879 timer \u7684\u5de5\u4f5c\u53ef\u4ee5\u8ddf systemd \u7684\u670d\u52a1\u76f8\u7ed3\u5408; \u5404\u9879 timer \u7684\u5de5\u4f5c\u53ef\u4ee5\u8ddf control group (cgroup\uff0c\u7528\u6765\u53d6\u4ee3 /etc/secure/limit.conf \u7684\u529f\u80fd) \u7ed3\u5408\uff0c\u6765\u9650\u5236\u8be5\u5de5\u4f5c\u7684\u8d44\u6e90\u5229\u7528\u3002 \u4f7f\u7528 timer \u7684\u524d\u63d0\uff1a \u7cfb\u7edf\u7684 timer.target \u4e00\u5b9a\u8981\u542f\u52a8 \u8981\u6709\u4e2a sname.service \u7684\u670d\u52a1\u5b58\u5728 (sname \u662f\u4f60\u81ea\u5df1\u6307\u5b9a\u7684\u540d\u79f0) \u8981\u6709\u4e2a sname.timer \u7684\u65f6\u95f4\u542f\u52a8\u670d\u52a1\u5b58\u5728 2.11.1 \u914d\u7f6e\u6587\u4ef6\u5185\u5bb9 \u00b6 timer \u914d\u7f6e\u6587\u4ef6\u7684\u57fa\u672c\u5185\u5bb9\uff08man systemd.timer & man systemd.time\uff09\uff1a 2.11.1.1 OnCalendar\u53c2\u6570\u7684\u8bbe\u7f6e \u00b6 \u57fa\u672c\u4e0a\u7684\u683c\u5f0f\u5982\u4e0b\u6240\u793a\uff1a \u8bed\u6cd5 : \u82f1\u6587\u5468\u540d YYYY - MM - DD HH : MM : SS \u8303\u4f8b : Thu 2015 - 08 - 13 13 : 40 : 00 \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u95f4\u9694\u65f6\u95f4\u6765\u5904\u7406\uff1a us \u6216 usec\uff1a\u5fae\u79d2 (10 -6 \u79d2) ms \u6216 msec\uff1a\u6beb\u79d2 (10 -3 \u79d2) s\uff0c sec\uff0c second\uff0c seconds m\uff0c min\uff0c minute\uff0c minutes h\uff0c hr\uff0c hour\uff0c hours d\uff0c day\uff0c days w\uff0c week\uff0c weeks month\uff0c months y\uff0c year\uff0c years # \u901a\u5e38\u82f1\u6587\u7684\u5199\u6cd5\uff0c\u5c0f\u5355\u4f4d\u5199\u524d\u9762\uff0c\u5927\u5355\u4f4d\u5199\u540e\u9762~\u6240\u4ee5\u5148\u79d2\u3001\u518d\u5206\u3001\u518d\u5c0f\u65f6\u3001\u518d\u5929\u6570\u7b49~ \u9694 3 \u5c0f\u65f6: 3h \u6216 3hr \u6216 3hours \u9694 300 \u5206\u949f\u8fc7 10 \u79d2: 10s 300m \u9694 5 \u5929\u53c8 100 \u5206\u949f: 100m 5day \u6b64\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u82f1\u6587\u5e38\u7528\u7684\u53e3\u8bed\u5316\u65e5\u671f\u4ee3\u8868\uff0c\u4f8b\u5982today\uff0ctomorrow\u7b49\u3002 2.11.2 \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b \u00b6 2.11.2.1 \u5faa\u73af\u5468\u671f\u914d\u7f6e \u00b6 \u91c7\u7528\u4e0a\u4e00\u5c0f\u8282\u7f16\u5199\u7684 backup.service \u6765\u4f5c\u4e3a\u670d\u52a1\uff0c\u4e3a\u5176\u7f16\u5199 timer\uff1a [ root@dev ~ ] # cd /etc/systemd/system/ [ root@dev system ] # cat backup.timer [ Unit ] Description = back up /boot timer [ Timer ] # \u7cfb\u7edf\u542f\u52a8 2\u5c0f\u65f6 \u540e\u6267\u884c OnBootSec = 2h # \u670d\u52a1\u7b2c\u4e00\u6b21\u6267\u884c\u5b8c\u6bd5\u540e\u6bcf\u9694 2\u5929 \u6267\u884c\u4e00\u6b21 OnUnitActiveSec = 2d [ Install ] WantedBy = multi-user.target [ root@dev system ] # systemctl daemon-reload [ root@dev system ] # systemctl enable backup.timer [ root@dev system ] # systemctl start backup.timer # service \u65e0\u9700 enable [ root@dev system ] # systemctl list-unit-files | grep backup backup.service disabled backup.timer enabled [ root@dev system ] # systemctl show timers.target | grep ConditionTimestamp= ConditionTimestamp = Mon 2019 -11-25 08 :32:25 CST [ root@dev system ] # systemctl show backup.service | grep ExecMainExitTimestamp= ExecMainExitTimestamp = Tue 2019 -11-26 09 :36:24 CST # .timer \u7684\u65f6\u95f4\u662f\u6839\u636e .service \u4e0e timers.target \u7684\u65f6\u95f4\u5dee\u6765\u8ba1\u7b97\u7684\uff0c\u8fd9\u91cc\u65f6\u95f4\u6709\u70b9\u5bf9\u4e0d\u4e0a\uff0c\u4e0d\u8fc7\u8bef\u5dee\u4e0d\u5927 [ root@dev system ] # systemctl show backup.timer | egrep \"NextElapseUSecMonotonic|LastTriggerUSecMonotonic=\" NextElapseUSecMonotonic = 3d 1h 7min 5 .741522s # \u4e0b\u6b21\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c LastTriggerUSecMonotonic = 1d 1h 7min 5 .739590s # \u4e0a\u6b21\u662f\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u7684 # Monotonic\uff1a\u5355\u8c03\u65f6\u95f4\uff0c\u5373\u4ece\u67d0\u4e2a\u65f6\u95f4\u70b9\u5f00\u59cb\u5230\u73b0\u5728\u8fc7\u53bb\u7684\u65f6\u95f4\u3002 2.11.2.2 \u56fa\u5b9a\u65e5\u671f\u914d\u7f6e \u00b6 [ root@dev system ] # cat backup2.timer [ Unit ] Description = back up /boot timer2 [ Timer ] OnCalendar = Sun *-*-* 00 :00:00 Persistent = yes Unit = backup.service [ Install ] WantedBy = multi-user.target [ root@dev system ] # systemctl daemon-reload [ root@dev system ] # systemctl enable backup2.timer [ root@dev system ] # systemctl start backup2.timer [ root@dev system ] # systemctl show backup2.timer | grep NextElapseUSecRealtime= NextElapseUSecRealtime = 49y 10month 4w 1d 1h # Realtime\uff1a\u662f\u5b9e\u9645\u7684\u65f6\u95f4\u3002\u662fUnix\u7684\u6807\u51c6\u65f6\u95f4 1970-01-01 00:00:00 \u4ee5\u6765\u7684\u65f6\u95f4","title":"21 \u7cfb\u7edf\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#1-system-v-init","text":"\u65e7\u7248\u7684centos \u542f\u52a8\u7cfb\u7edf\u670d\u52a1\u7684\u7ba1\u7406\u65b9\u5f0f\u88ab\u79f0\u4e3a SysV \u7684 init \u811a\u672c\u7a0b\u5e8f\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u7cfb\u7edf\u5185\u6838\u7b2c\u4e00\u652f\u547c\u53eb\u7684\u7a0b\u5e8f\u662f init \uff0c \u7136\u540e init \u53bb\u5524\u8d77\u6240\u6709\u7684\u7cfb\u7edf\u6240\u9700\u8981\u7684\u670d\u52a1\u3002 init \u7684\u7ba1\u7406\u673a\u5236\u6709\u51e0\u4e2a\u7279\u70b9\uff1a \u6240\u6709\u7684\u670d\u52a1\u542f\u52a8\u811a\u672c\u901a\u901a\u653e\u7f6e\u4e8e /etc/init.d/ \u5e95\u4e0b\uff0c\u57fa\u672c\u4e0a\u90fd\u662f\u4f7f\u7528 bash shell script \u6240\u5199\u6210\u7684\u811a\u672c\u7a0b\u5e8f\u3002 \u670d\u52a1\u662f\u72ec\u7acb\u542f\u52a8\u6216\u88ab\u4e00\u53ea\u603b\u7ba1\u7a0b\u5e8f\u7ba1\u7406\u800c\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a \u72ec\u7acb\u542f\u52a8\u6a21\u5f0f (stand alone)\uff1a\u670d\u52a1\u72ec\u7acb\u542f\u52a8\uff0c\u8be5\u670d\u52a1\u76f4\u63a5\u5e38\u9a7b\u4e8e\u5185\u5b58\u4e2d\uff0c\u63d0\u4f9b\u672c\u673a\u6216\u7528\u6237\u7684\u670d\u52a1\u884c\u4e3a\uff0c\u53cd\u5e94\u901f\u5ea6\u5feb\u3002 \u603b\u7ba1\u7a0b\u5e8f (super daemon)\uff1a\u7531\u7279\u6b8a\u7684 xinetd \u6216 inetd \u8fd9\u4e24\u4e2a\u603b\u7ba1\u7a0b\u5e8f\u63d0\u4f9b socket \u5bf9\u5e94\u6216 port \u5bf9\u5e94\u7684\u7ba1\u7406\u3002\u5f53\u6ca1\u6709\u7528\u6237\u8981\u6c42\u67d0 socket \u6216 port \u65f6\uff0c \u6240\u9700\u8981\u7684\u670d\u52a1\u662f\u4e0d\u4f1a\u88ab\u542f\u52a8\u7684\u3002\u82e5\u6709\u7528\u6237\u8981\u6c42\u65f6\uff0cxinetd \u603b\u7ba1\u624d\u4f1a\u53bb\u5524\u9192\u76f8\u5bf9\u5e94\u7684\u670d\u52a1\u7a0b\u5e8f\u3002\u5f53\u8be5\u8981\u6c42\u7ed3\u675f\u65f6\uff0c\u8fd9\u4e2a\u670d\u52a1\u4e5f\u4f1a\u88ab\u7ed3\u675f\u6389~ \u56e0\u4e3a\u900f\u8fc7xinetd \u6240\u603b\u7ba1\uff0c\u56e0\u6b64\u8fd9\u4e2a\u5bb6\u4f19\u5c31\u88ab\u79f0\u4e3a super daemon\u3002\u597d\u5904\u662f\u53ef\u4ee5\u900f\u8fc7 super daemon \u6765\u8fdb\u884c\u670d\u52a1\u7684\u65f6\u7a0b\u3001\u8054\u673a\u9700\u6c42\u7b49\u7684\u63a7\u5236\uff0c\u7f3a\u70b9\u662f\u5524\u9192\u670d\u52a1\u9700\u8981\u4e00\u70b9\u65f6\u95f4\u7684\u5ef6\u8fdf\u3002 \u670d\u52a1\u7684\u4f9d\u8d56\u6027\u95ee\u9898\u3002init \u5728\u7ba1\u7406\u5458\u81ea\u5df1\u624b\u52a8\u5904\u7406\u8fd9\u4e9b\u670d\u52a1\u65f6\uff0c\u662f\u6ca1\u6709\u529e\u6cd5\u534f\u52a9\u4f9d\u8d56\u670d\u52a1\u7684\u5524\u9192\u7684\u3002 \u6267\u884c\u7b49\u7ea7\u7684\u5206\u7c7b\u3002init \u662f\u5f00\u673a\u540e\u6838\u5fc3\u4e3b\u52a8\u547c\u53eb\u7684\uff0c \u7136\u540e init \u53ef\u4ee5\u6839\u636e\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6267\u884c\u7b49\u7ea7\uff08 runlevel \uff09\u6765\u5524\u9192\u4e0d\u540c\u7684\u670d\u52a1\uff0c\u4ee5\u8fdb\u5165\u4e0d\u540c\u7684\u64cd\u4f5c\u754c\u9762\u3002\u57fa\u672c\u4e0a Linux \u63d0\u4f9b 7 \u4e2a\u6267\u884c\u7b49\u7ea7\uff0c\u5206\u522b\u662f 0\uff0c 1\uff0c 2...6 \uff0c \u6bd4\u8f83\u91cd\u8981\u7684\u662f 1)\u5355\u4eba\u7ef4\u62a4\u6a21\u5f0f\u30013)\u7eaf\u6587\u672c\u6a21\u5f0f\u30015)\u6587\u5b57\u52a0\u56fe\u5f62\u754c\u9762\u3002\u800c\u5404\u4e2a\u6267\u884c\u7b49\u7ea7\u7684\u542f\u52a8\u811a\u672c\u662f\u900f /etc/rc.d/rc[0-6]/SXXdaemon \uff08S \u4e3a\u542f\u52a8\u8be5\u670d\u52a1\uff0c XX \u662f\u6570\u5b57\uff0c\u4e3a\u542f\u52a8\u7684\u987a\u5e8f\uff09\u8fde\u7ed3\u5230 /etc/init.d/daemon \u3002\u5728\u5f00\u673a\u65f6\u53ef\u4ee5 \u4f9d\u5e8f\u6267\u884c \u6240\u6709\u9700\u8981\u7684\u670d\u52a1\uff0c\u540c\u65f6\u4e5f\u80fd\u89e3\u51b3\u4f9d\u8d56\u670d\u52a1\u7684\u95ee\u9898\u3002 \u6267\u884c\u7b49\u7ea7\u7684\u5207\u6362\u884c\u4e3a\u3002\u5f53\u4f60\u8981\u4ece\u7eaf\u6587\u672c\u754c\u9762 (runlevel 3) \u5207\u6362\u5230\u56fe\u5f62\u754c\u9762 (runlevel 5)\uff0c \u4e0d\u9700\u8981\u624b\u52a8\u542f\u52a8\u3001\u5173\u95ed\u8be5\u6267\u884c\u7b49\u7ea7\u7684\u76f8\u5173\u670d\u52a1\uff0c\u53ea\u8981 init 5 \u5373\u53ef\u5207\u6362\u3002 \u9644\uff1a \u9e1f\u54e5\u5bf9\u4e8einit\u7684\u8be6\u7ec6\u4ecb\u7ecd TODO","title":"1. \u65e9\u671f System V \u7684 init"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2-systemd","text":"CentOS 7.x \u4ee5\u540e\uff0c\u4ece init \u542f\u52a8\u8f6c\u4e3a systemd \u542f\u52a8\u670d\u52a1\u3002\u7279\u8272\uff1a \u5e73\u884c\u5904\u7406\u6240\u6709\u670d\u52a1\uff0c\u52a0\u901f\u5f00\u673a\u6d41\u7a0b\u3002 \u65e7\u7684 init \u542f\u52a8\u811a\u672c\u662f \u4e00\u9879\u4e00\u9879\u4efb\u52a1\u4f9d\u5e8f\u542f\u52a8 \u7684\u6a21\u5f0f\uff0c\u56e0\u6b64\u4e0d\u76f8\u4f9d\u7684\u670d\u52a1\u4e5f\u662f\u5f97\u8981\u4e00\u4e2a\u4e00\u4e2a\u7684\u7b49\u5f85\u3002 \u4e00\u7ecf\u8981\u6c42\u5c31\u54cd\u5e94\u7684 on-demand \u542f\u52a8\u65b9\u5f0f\u3002 systemd \u7531\u4e8e\u5e38\u9a7b\u5185\u5b58\uff0c\u56e0\u6b64\u4efb\u4f55\u8981\u6c42(on-demand) \u90fd\u53ef\u4ee5\u7acb\u5373\u5904\u7406\u540e\u7eed\u7684 daemon \u542f\u52a8\u7684\u4efb\u52a1\u3002 \u670d\u52a1\u4f9d\u8d56\u6027\u7684\u81ea\u6211\u68c0\u67e5\u3002 systemd \u53ef\u4ee5\u81ea\u5b9a\u4e49\u670d\u52a1\u4f9d\u8d56\u6027\u7684\u68c0\u67e5\u3002 \u4f9d daemon \u529f\u80fd\u5206\u7c7b\u3002 \u9996\u5148 systemd \u5148\u5b9a\u4e49\u6240\u6709\u7684\u670d\u52a1\u4e3a\u4e00\u4e2a\u670d\u52a1\u5355\u4f4d (unit)\uff0c\u5e76\u5c06\u8be5 unit \u5f52\u7c7b\u5230\u4e0d\u540c\u7684\u670d\u52a1\u7c7b\u578b (type) \u53bb\u3002 \u5c06\u591a\u4e2a daemons \u96c6\u5408\u6210\u4e3a\u4e00\u4e2a\u7fa4\u7ec4\u3002 \u5982\u540c systemV \u7684 init \u91cc\u5934\u6709\u4e2a runlevel \u7684\u7279\u8272\uff0csystemd \u4ea6\u5c06\u8bb8\u591a\u7684\u529f\u80fd\u96c6\u5408\u6210\u4e3a\u4e00\u4e2a\u6240\u8c13\u7684 target \u9879\u76ee\u3002 \u5411\u4e0b\u517c\u5bb9\u65e7\u6709\u7684 init \u670d\u52a1\u811a\u672c\u3002 \u65e7\u7684 init \u542f\u52a8\u811a\u672c\u4e5f\u80fd\u591f\u900f\u8fc7 systemd \u6765\u7ba1\u7406\uff0c\u53ea\u662f\u66f4\u8fdb\u9636\u7684 systemd \u529f\u80fd\u5c31\u6ca1\u6709\u529e\u6cd5\u652f\u6301\u5c31\u662f\u4e86\u3002 \u4e0d\u8fc7 systemd \u4e5f\u662f\u6709\u4e9b\u5730\u65b9 \u65e0\u6cd5\u5b8c\u5168\u53d6\u4ee3 init \u7684\uff1a \u5728 runlevel \u7684\u5bf9\u5e94\u4e0a\uff0c\u5927\u6982\u4ec5\u6709 runlevel 1\uff0c 3\uff0c 5 \u6709\u5bf9\u5e94\u5230 systemd \u7684\u67d0\u4e9b target \u7c7b\u578b\u800c\u5df2\uff1b systemctl \u652f\u6301\u7684\u8bed\u6cd5\u6709\u9650\u5236\uff0c\u4e0d\u50cf /etc/init.d/daemon \u5c31\u662f\u7eaf\u811a\u672c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u53c2\u6570\uff0csystemctl \u4e0d\u53ef\u81ea\u5b9a\u4e49\u53c2\u6570\uff1b \u5982\u679c\u67d0\u4e2a\u670d\u52a1\u542f\u52a8\u662f\u7ba1\u7406\u5458\u81ea\u5df1\u624b\u52a8\u6267\u884c\u542f\u52a8\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 systemctl \u53bb\u542f\u52a8\u7684\uff0c\u90a3\u4e48 systemd \u5c06\u65e0\u6cd5\u4fa6\u6d4b\u5230\u8be5\u670d\u52a1\uff0c\u800c\u65e0\u6cd5\u8fdb\u4e00\u6b65\u7ba1\u7406\uff1b systemd \u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u4e0e\u7ba1\u7406\u5458\u900f\u8fc7 standard input \u4f20\u5165\u8baf\u606f\u3002\u81ea\u884c\u64b0\u5199 systemd \u7684\u542f\u52a8\u8bbe\u5b9a\u65f6\uff0c\u52a1\u5fc5\u8981\u53d6\u6d88\u4ea4\u4e92\u673a\u5236\u548c\u542f\u52a8\u65f6\u7684\u6807\u51c6\u8f93\u5165\u4fe1\u606f\u3002","title":"2. systemd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21","text":"/usr/lib/systemd/system/ \uff1a\u6bcf\u4e2a\u670d\u52a1\u6700\u4e3b\u8981\u7684\u542f\u52a8\u811a\u672c\u8bbe\u5b9a\uff0c\u6709\u70b9\u7c7b\u4f3c\u4ee5\u524d\u7684 /etc/init.d \u5e95\u4e0b\u7684\u6587\u4ef6\uff1b /run/systemd/system/ \uff1a\u7cfb\u7edf\u6267\u884c\u8fc7\u7a0b\u4e2d\u6240\u4ea7\u751f\u7684\u670d\u52a1\u811a\u672c\uff1b /etc/systemd/system/ \uff1a\u7ba1\u7406\u5458\u4f9d\u636e\u4e3b\u673a\u7cfb\u7edf\u7684\u9700\u6c42\u6240\u5efa\u7acb\u7684\u6267\u884c\u811a\u672c\uff0c\u5176\u5b9e\u8fd9\u4e2a\u76ee\u5f55\u6709\u70b9\u50cf\u4ee5\u524d /etc/rc.d/rc5.d/Sxx \u4e4b\u7c7b\u7684\u529f\u80fd\u3002 \u8fd9\u4e09\u4e2a\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u7684\u6267\u884c \u4f18\u5148\u7ea7\u4f9d\u6b21\u9012\u589e \u3002","title":"2.1 \u914d\u7f6e\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#22","text":"/usr/lib/systemd/system/ \u4ee5 \u6269\u5c55\u540d \u533a\u5206\u4e0d\u540c\u7684\u670d\u52a1\u7c7b\u578b\u3002 [ sink@dev ~ ] $ ll / usr / lib / systemd / system / | egrep '(vsftpd|crond|multi)' - rw - r --r--. 1 root root 318 Aug 9 07:07 crond.service - rw - r --r--. 1 root root 623 Aug 9 07:08 multipathd.service - rw - r --r--. 1 root root 492 Aug 8 19:58 multi-user.target drwxr - xr - x . 2 root root 258 Oct 22 16 : 17 multi - user . target . wants lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel2 . target -> multi - user . target lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel3 . target -> multi - user . target lrwxrwxrwx . 1 root root 17 Oct 22 16 : 01 runlevel4 . target -> multi - user . target - rw - r --r--. 1 root root 171 Oct 31 2018 vsftpd.service - rw - r --r--. 1 root root 184 Oct 31 2018 vsftpd@.service - rw - r --r--. 1 root root 89 Oct 31 2018 vsftpd.target \u5e38\u89c1\u7684\u670d\u52a1\u7c7b\u578b\uff1a \u6269\u5c55\u540d \u4e3b\u8981\u670d\u52a1\u529f\u80fd .service \u4e00\u822c\u670d\u52a1\u7c7b\u578b (service unit)\uff1a\u4e3b\u8981\u662f\u7cfb\u7edf\u670d\u52a1\uff0c\u5305\u62ec\u670d\u52a1\u5668\u672c\u8eab\u6240\u9700\u8981\u7684\u672c\u673a\u670d\u52a1\u4ee5\u53ca\u7f51\u7edc\u670d\u52a1\u3002 .socket \u5185\u90e8\u7a0b\u5e8f\u6570\u636e\u4ea4\u6362\u7684\u63d2\u69fd\u670d\u52a1 (socket unit)\uff1a\u4e3b\u8981\u662f IPC (Inter-process communication) \u7684\u4f20\u8f93\u8baf\u606f\u63d2\u69fd\u6587\u4ef6 (socket file) \u529f\u80fd\u3002 .target \u6267\u884c\u73af\u5883\u7c7b\u578b (target unit)\uff1a\u5176\u5b9e\u662f\u4e00\u7fa4 unit \u7684\u96c6\u5408\u3002 .mount .automount \u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u76f8\u5173\u7684\u670d\u52a1 (automount unit / mount unit)\u3002 .path \u4fa6\u6d4b\u7279\u5b9a\u6587\u4ef6\u6216\u76ee\u5f55\u7c7b\u578b (path unit)\uff1a\u67d0\u4e9b\u670d\u52a1\u9700\u8981\u4fa6\u6d4b\u67d0\u4e9b\u7279\u5b9a\u7684\u76ee\u5f55\u6765\u63d0\u4f9b\u961f\u5217\u670d\u52a1\u3002 .timer \u5faa\u73af\u6267\u884c\u7684\u670d\u52a1 (timer unit)\uff1a\u7c7b\u4f3c\u4e8e anacrontab \u3002\u4e0d\u8fc7\u662f\u7531 systemd \u4e3b\u52a8\u63d0\u4f9b\u7684\uff0c\u6bd4 anacrontab \u66f4\u52a0\u6709\u5f39\u6027","title":"2.2 \u5e38\u89c1\u670d\u52a1\u7c7b\u578b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#23","text":"static\uff1a\u8fd9\u4e2a daemon \u4e0d\u53ef\u4ee5\u81ea\u5df1\u542f\u52a8 (enable \u4e0d\u53ef)\uff0c\u4e0d\u8fc7\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u7684 enabled \u7684\u670d\u52a1\u6765\u5524\u9192 (\u4f9d\u8d56 \u7684\u670d\u52a1) mask\uff1a\u8fd9\u4e2a daemon \u65e0\u8bba\u5982\u4f55\u90fd\u65e0\u6cd5\u88ab\u542f\u52a8!\u56e0\u4e3a\u5df2\u7ecf\u88ab\u5f3a\u5236\u6ce8\u9500 (\u975e\u5220\u9664)\u3002\u53ef\u900f\u8fc7 systemctl unmask \u65b9 \u5f0f\u6539\u56de\u539f\u672c\u72b6\u6001","title":"2.3 \u670d\u52a1\u72b6\u6001"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#24","text":"systemctl mask < unit - name > \u5f3a\u5236\u6ce8\u9500\u670d\u52a1\uff0c\u589e\u5f3a\u7248\u7684 disable \uff0c\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u80fd\u542f\u52a8\u8be5\u670d\u52a1 systemctl unmask < unit - name > \u672c\u8d28\u4e0a\u5c31\u662f\u5229\u7528 /etc/systemd/system/ \u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u5efa\u7acb\u4e00\u6761\u6307\u5411 /dev/null \u7684\u65e0\u7528\u94fe\u63a5\u3002 [ root@dev ~ ] # systemctl is-active cups.service active [ root@dev ~ ] # systemctl is-enabled cups.service enabled [ root@dev ~ ] # systemctl mask cups.service Created symlink from /etc/systemd/system/cups.service to /dev/null. [ root@dev ~ ] # systemctl is-enabled cups.service masked # \u6ce8\u610f\u8fd9\u91cc\u4ecd\u7136\u662f\u542f\u52a8\u72b6\u6001\uff0c\u6240\u4ee5\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5148\u5173\u95ed\u670d\u52a1\uff0c\u518d\u6ce8\u9500\u670d\u52a1 [ root@dev ~ ] # systemctl is-active cups.service active [ root@dev ~ ] # ll /etc/systemd/system/cups.service lrwxrwxrwx. 1 root root 9 Nov 25 14 :11 /etc/systemd/system/cups.service -> /dev/null","title":"2.4 \u670d\u52a1\u7ba1\u7406"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#25-socket","text":"systemctl list - sockets [ --all]","title":"2.5 \u67e5\u770bsocket\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#26","text":"systemctl \u663e\u793a enabled \u670d\u52a1 systemctl list - unit - files \u5217\u51fa\u6240\u6709\u5df2\u7ecf\u5b89\u88c5\u7684\u670d\u52a1 systemctl list - units [ --type=unit-type] [--all] \u5217\u51fa\u76ee\u524d\u542f\u52a8\u7684 unit\uff0c --all\uff1a\u628a inactive \u7684unit\u4e5f\u5217\u51fa\u6765","title":"2.6 \u67e5\u770b\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#27","text":"","title":"2.7 \u7ba1\u7406\u4e0d\u540c\u7684\u64cd\u4f5c\u73af\u5883"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#271","text":"[ root@dev ~ ] # systemctl list-units --type target --all UNIT LOAD ACTIVE SUB DESCRIPTION basic.target loaded active active Basic System cryptsetup.target loaded active active Local Encrypted Volumes \u2026\u2026 \u4e0e\u64cd\u4f5c\u754c\u9762\u76f8\u5173\u6027\u6bd4\u8f83\u9ad8\u7684 target\uff1a multi-user.target\uff1a\u7eaf\u6587\u672c\u591a\u7528\u6237\u6a21\u5f0f graphical.target\uff1a\u6587\u672c\u52a0\u4e0a\u56fe\u5f62\u754c\u9762\uff0c\u5305\u542b multi-user.target rescue.target\uff1a\u6551\u63f4\u6a21\u5f0f\u3002\u5728\u65e0\u6cd5\u4f7f\u7528 root \u767b\u5165\u7684\u60c5\u51b5\u4e0b\uff0csystemd \u5728\u5f00\u673a\u65f6\u4f1a\u591a\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u6682\u65f6\u7cfb\u7edf\uff0c\u4e0e\u4f60\u539f\u672c\u7684\u7cfb\u7edf\u65e0\u5173\u3002 emergency.target\uff1a\u6025\u6551\u6a21\u5f0f\u3002\u8fd8\u662f\u9700\u8981\u4f7f\u7528 root \u767b\u5165\u7684\u60c5\u51b5\uff0c\u5728\u65e0\u6cd5\u4f7f\u7528 rescue.target \u65f6\u53ef\u4ee5\u5c1d\u8bd5 shutdown.target\uff1a\u5173\u673a\u7684\u6d41\u7a0b getty.target\uff1a\u53ef\u4ee5\u8bbe\u5b9a\u4f60\u9700\u8981\u51e0\u4e2a tty \u4e4b\u7c7b\u7684\uff0c\u5982\u679c\u60f3\u8981\u964d\u4f4e tty \u7684\u9879\u76ee\uff0c\u53ef\u4ee5\u4fee\u6539\u8fd9\u4e2a\u4e1c\u897f\u7684\u914d\u7f6e\u6587\u4ef6","title":"2.7.1 \u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#272","text":"systemctl [ command ] [ unit.target ] commands : get - default set - default \u4fee\u6539\u7cfb\u7edf\u7684\u9ed8\u8ba4\u64cd\u4f5c\u6a21\u5f0f isolate \u5207\u6362\u6a21\u5f0f [ sink@dev ~ ] $ systemctl get-default graphical.target # \u6ce8\u610f\u8fd9\u91cc\u4fee\u6539\u7684\u662f\u5168\u90e8\u7528\u6237\u7684\u9ed8\u8ba4\u914d\u7f6e [ sink@dev ~ ] $ systemctl set-default multi-user.target Removed symlink /etc/systemd/system/default.target. Created symlink from /etc/systemd/system/default.target to /usr/lib/systemd/system/multi-user.target. # \u5207\u6362\u5230\u6587\u672c\u6a21\u5f0f [ sink@dev ~ ] $ systemctl isolate multi-user.target","title":"2.7.2 \u7ba1\u7406"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#273","text":"suspend\uff1a\u6682\u505c\u6a21\u5f0f\u4f1a\u5c06\u7cfb\u7edf\u7684\u72b6\u6001\u6570\u636e\u4fdd\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5173\u95ed\u6389\u5927\u90e8\u5206\u7684\u7cfb\u7edf\u786c\u4ef6\uff0c\u5e76\u6ca1\u6709\u5b9e\u9645\u5173\u673a\u3002\u5524\u9192\u7684\u901f\u5ea6\u8f83\u5feb\u3002 hibernate\uff1a\u4f11\u7720\u6a21\u5f0f\u5219\u662f\u5c06\u7cfb\u7edf\u72b6\u6001\u4fdd\u5b58\u5230\u786c\u76d8\u5f53\u4e2d\uff0c\u4fdd\u5b58\u5b8c\u6bd5\u540e\uff0c\u5c06\u8ba1\u7b97\u673a\u5173\u673a\u3002\u5f53\u7528\u6237\u5c1d\u8bd5\u5524\u9192\u7cfb\u7edf\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5f00\u59cb\u6b63\u5e38\u8fd0\u4f5c\uff0c \u7136\u540e\u5c06\u4fdd\u5b58\u5728\u786c\u76d8\u4e2d\u7684\u7cfb\u7edf\u72b6\u6001\u6062\u590d\u56de\u6765\u3002\u5524\u9192\u7684\u901f\u5ea6\u4e0e\u4f60\u7684\u786c\u76d8\u901f\u5ea6\u6709\u5173\u3002 \u9664\u4e86\u4f7f\u7528 isolate \u6765\u5207\u6362\u5404\u79cd\u6a21\u5f0f\uff0csystemd \u8fd8\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u6307\u4ee4\u6765\u5207\u6362\u6a21\u5f0f\uff1a systemctl suspend systemctl hibernate","title":"2.7.3 \u6682\u505c\u4e0e\u4f11\u7720\u6a21\u5f0f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#28","text":"systemctl list - dependencies [ NAME ] Options --reverse \u5217\u51fa\u8c01\u4f9d\u8d56\u8be5 unit --after \u4f4d\u4e8e\u8be5 unit \u4e4b\u524d\u7684 unit\uff08\u4f60\u6ca1\u770b\u9519\uff0c\u6211\u6ca1\u6709\u5199\u53cd\uff09 --before \u4f4d\u4e8e\u8be5 unit \u4e4b\u540e\u7684 unit --all \u9ed8\u8ba4\u53ea\u4f1a\u5217\u51fa target unit \u7684\u4f9d\u8d56\uff0c\u4f7f\u7528\u8be5\u9009\u9879\u5217\u51fa\u5168\u90e8 [ sink@dev ~ ] $ systemctl get-default multi-user.target [ sink@dev ~ ] $ systemctl list-dependencies default.target \u25cf \u251c\u2500abrt-ccpp.service \u25cf \u251c\u2500abrt-oops.service \u25cf \u251c\u2500abrt-vmcore.service \u2026\u2026 # \u5728\u8be5 unit \u542f\u52a8\u4e4b\u540e\u518d\u542f\u52a8\u7684 unit\uff0c\u5373\u8be5 unit \u9700\u8981\u5728\u54ea\u4e9b unit \u4e4b\u524d\u5c31\u542f\u52a8\u4e86 [ sink@dev ~ ] $ systemctl list-dependencies --before default.target \u25cf \u251c\u2500systemd-readahead-done.service \u25cf \u251c\u2500systemd-readahead-done.timer \u25cf \u251c\u2500systemd-update-utmp-runlevel.service \u25cf \u2514\u2500graphical.target \u25cf \u2514\u2500systemd-update-utmp-runlevel.service # target \u4e2d\u53ea\u6709\u56fe\u5f62\u754c\u9762\u4f7f\u7528\u5230\u4e86 multi-user.target [ sink@dev ~ ] $ systemctl list-dependencies --reverse default.target \u25cf \u2514\u2500graphical.target [ sink@dev ~ ] $ systemctl list-dependencies vsftpd vsftpd.service \u25cf \u251c\u2500system.slice \u25cf \u2514\u2500basic.target \u25cf \u251c\u2500firewalld.service \u25cf \u251c\u2500microcode.service \u2026\u2026","title":"2.8 \u5206\u6790\u670d\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#29-systemd-daemon","text":"\u54ea\u4e9b\u76ee\u5f55\u8ddf\u7cfb\u7edf\u7684 daemon \u8fd0\u4f5c\u6709\u5173\uff1a /usr/lib/systemd/system/ \u9ed8\u8ba4\u7684\u542f\u52a8\u811a\u672c\u914d\u7f6e\u6587\u4ef6\u90fd\u653e\u5728\u8fd9\u91cc\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u5c3d\u91cf\u4e0d\u8981\u4fee\u6539\uff08\u5230 /etc/systemd/system \u4fee\u6539\uff09 /run/systemd/system/ \u7cfb\u7edf\u6267\u884c\u8fc7\u7a0b\u4e2d\u6240\u4ea7\u751f\u7684\u670d\u52a1\u811a\u672c\uff0c\u8fd9\u4e9b\u811a\u672c\u7684\u4f18\u5148\u5e8f\u8981\u6bd4 /usr/lib/systemd/system/ \u9ad8\u3002 /etc/systemd/system/ \u7ba1\u7406\u5458\u4f9d\u636e\u4e3b\u673a\u7cfb\u7edf\u7684\u9700\u6c42\u6240\u5efa\u7acb\u7684\u6267\u884c\u811a\u672c\uff0c\u6267\u884c\u4f18\u5148\u5e8f\u53c8\u6bd4 /run/systemd/system/ \u9ad8\u3002 /etc/sysconfig/* \u51e0\u4e4e\u6240\u6709\u7684\u670d\u52a1\u90fd\u4f1a\u5c06 \u521d\u59cb\u5316\u7684\u4e00\u4e9b\u9009\u9879 \u8bbe\u5b9a\u5199\u5165\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u3002 /var/lib/ \u4e00\u4e9b\u4f1a\u4ea7\u751f\u6570\u636e\u7684\u670d\u52a1\u90fd\u4f1a\u5c06\u4ed6\u7684\u6570\u636e\u5199\u5165\u5230\u8be5\u76ee\u5f55\u4e0b\u3002 /run/ \u653e\u7f6e\u4e86\u597d\u591a daemon \u7684\u4e34\u65f6\u6587\u4ef6\uff0c\u5305\u62ec lock file \u4ee5\u53ca PID file \u7b49\u7b49\u3002","title":"2.9 \u4e0e systemd \u7684 daemon \u8fd0\u884c\u8fc7\u7a0b\u76f8\u5173\u7684\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#210-service","text":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u6700\u597d\u5728 /etc/systemd/system/ \u4e0b\u9762\u65b0\u589e\u6216\u8005\u4fee\u6539\uff0c\u800c\u4e0d\u8981\u6539\u52a8\u539f\u5148\u5728 /usr/lib/systemd/system/ \u5c31\u6709\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u4ee5 vsftpd.service \u4e3a\u4f8b\uff0c\u5bf9\u76ee\u5f55\u7684\u4f5c\u7528\u8fdb\u884c\u8bf4\u660e\uff1a /usr/lib/systemd/system/vsftpd.service\uff1a\u5b89\u88c5\u65f6\u9884\u8bbe\u7684\u914d\u7f6e\u6587\u4ef6\uff1b /etc/systemd/system/vsftpd.service.d/custom.conf\uff1a\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5 .conf \u4e3a\u540e\u7f00\uff0c\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4f1a\u7d2f\u52a0\u5230 /usr/lib/systemd/system/vsftpd.service \u91cc\u9762\uff1b /etc/systemd/system/vsftpd.service.wants/*\uff1a\u6b64\u76ee\u5f55\u4e0b\u90fd\u662f\u94fe\u63a5\u6587\u4ef6\uff0c\u610f\u601d\u662f\u542f\u52a8\u4e86 vsftpd.service \u4e4b\u540e\uff0c\u6700\u597d\u8fd9\u4e9b\u670d\u52a1\u4e5f\u542f\u52a8\uff1b /etc/systemd/system/vsftpd.service.requires/*\uff1a\u6b64\u76ee\u5f55\u4e0b\u90fd\u662f\u94fe\u63a5\u6587\u4ef6\uff0c\u610f\u601d\u662f\u542f\u52a8 vsftpd.service \u4e4b\u524d\uff0c\u8fd9\u4e9b\u670d\u52a1\u5fc5\u987b\u542f\u52a8\u3002","title":"2.10 service \u7c7b\u578b\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2101","text":"\u4ee5 /usr/lib/systemd/system/sshd.service \u4e3a\u4f8b\uff1a [ root@dev ~ ] # cat /usr/lib/systemd/system/sshd.service [ Unit ] Description = OpenSSH server daemon Documentation = man:sshd ( 8 ) man:sshd_config ( 5 ) After = network.target sshd-keygen.service Wants = sshd-keygen.service [ Service ] Type = notify EnvironmentFile = /etc/sysconfig/sshd ExecStart = /usr/sbin/sshd -D $OPTIONS ExecReload = /bin/kill -HUP $MAINPID KillMode = process Restart = on-failure RestartSec = 42s [ Install ] WantedBy = multi-user.target \u67e5\u770b\u4e0a\u9762\u7684\u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff1a [Unit]\uff1aunit \u672c\u8eab\u7684\u8bf4\u660e\u3001\u6587\u6863\u3001\u4f9d\u8d56\u7b49\uff1b [Service]\uff1aService \u8868\u660e\u8fd9\u662fservice\u7c7b\u578b\u7684\u670d\u52a1\uff0c\u5176\u4ed6 unit \u7c7b\u578b\u4e5f\u6709\u81ea\u5df1\u5bf9\u5e94\u7684\u540d\u79f0\uff0c\u8fd9\u90e8\u5206\u4e0e\u5b9e\u9645\u6267\u884c\u7684\u6307\u4ee4\u53c2\u6570\u6709\u5173\uff0c\u5305\u62ec\u5982\u4f55\u542f\u52a8\u3001\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u7b49\uff1b [Install]\uff1a\u6b64 unit \u6302\u8f7d\u5230\u54ea\u4e2a target \u4e0b\u9762\u3002 [ root@dev ~ ] # ll /etc/systemd/system/multi-user.target.wants/sshd.service lrwxrwxrwx. 1 root root 36 Oct 18 19 :48 /etc/systemd/system/multi-user.target.wants/sshd.service -> /usr/lib/systemd/system/sshd.service","title":"2.10.1 \u914d\u7f6e\u6587\u4ef6\u5185\u5bb9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21011","text":"\u8bbe\u5b9a\u53c2\u6570\u901a\u5e38\u662f\u53ef\u4ee5\u91cd\u590d\u7684\uff0c\u4e0d\u8fc7\u540e\u9762\u7684\u4f1a\u8986\u76d6\u6389\u524d\u9762\u7684\u8bbe\u5b9a\uff0c\u90a3\u4e48\u5f52\u96f6\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a After= \uff1b \u5982\u679c\u8bbe\u5b9a\u53c2\u6570\u9700\u8981\u6709 \u662f/\u5426 \u7684\u9879\u76ee (\u5e03\u5c14\u503c\uff0c boolean)\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4efb\u610f\u503c\u53ca\u5176\u76f8\u53cd\u503c\uff1a 1\uff0con\uff0ctrue\uff0cyes \uff1b \u5f00\u5934\u4e3a # \u6216 ; \u7684\u90a3\u4e00\u884c\uff0c\u90fd\u4ee3\u8868\u6ce8\u91ca\u3002","title":"2.10.1.1 \u914d\u7f6e\u6587\u4ef6\u89c4\u5219"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21012","text":"\u6bcf\u4e2a\u90e8\u5206\u7684\u90e8\u5206\u53c2\u6570\u5982\u4e0b\u6240\u793a\uff08\u6240\u6709\u53c2\u6570\u7684\u67e5\u9605\uff1a man systemd.unit \u4e2d\u6709 [Unit] \u548c [Install] \u90e8\u5206\u7684\u8bf4\u660e\uff0c\u5404\u79cd\u7c7b\u578b\u7684\u8bf4\u660e\u5728\u5404\u81ea\u7684 man systemd.<unit_type> \u4e2d\u3002\uff09\uff1a \u4ee5 vsftpd2.service \u4e3a\u4f8b\u65b0\u5efa\u4e00\u4e2aftp\u670d\u52a1\uff1a [ root@dev vsftpd ] # cd /etc/vsftpd/ [ root@dev vsftpd ] # cp vsftpd.conf vsftpd2.conf # \u5728\u524d\u9762\u7684 SELinux \u7ae0\u8282\u4fee\u6539\u4e86\u7aef\u53e3\u53f7\u4e3a 555\uff0c\u628a\u5b83\u6539\u56de\u6765 21 [ root@dev vsftpd ] # vi vsftpd.conf [ root@dev vsftpd ] # cd /etc/systemd/system/ [ root@dev system ] # cp /usr/lib/systemd/system/vsftpd.service vsftpd2.service # \u628a\u91cc\u9762\u7684\u542f\u52a8\u914d\u7f6e\u6587\u4ef6\u6362\u6210 vsftpd2.conf [ root@dev system ] # vi vsftpd2.service # \u56e0\u4e3a\u5df2\u7ecf\u5728 SELinux \u7684\u89c4\u5219\u4e2d\u6dfb\u52a0\u4e86 555 \u7aef\u53e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u4f1a\u62a5\u9519\u5566 [ root@dev system ] # systemctl restart vsftpd.service vsftpd2.service [ root@dev system ] # netstat -ntlp | grep ftp tcp6 0 0 :::555 :::* LISTEN 10565 /vsftpd tcp6 0 0 :::21 :::* LISTEN 10564 /vsftpd","title":"2.10.1.2 \u914d\u7f6e\u6587\u4ef6\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2102","text":"vsftpd \u53ef\u4ee5\u5b58\u5728\u591a\u4e2a\u5b9e\u4f8b\uff0c\u90a3\u5982\u679c\u6bcf\u4e2a\u51e0\u4e4e\u76f8\u540c\u7684\u5b9e\u4f8b\u90fd\u8981\u5728 /etc/systemd/system/ \u4e0b\u9762\u7f16\u5199\u914d\u7f6e\u5c82\u4e0d\u662f\u8981\u7d2f\u6b7b\u4eba\u4e86\uff1f [ root@dev ~ ] # cd /etc/vsftpd # \u628a\u7aef\u53e3\u6539\u4e3a 9003 [ root@dev vsftpd ] # vi vsftpd3.conf # \u4e0d\u8981 enable \u8be5\u670d\u52a1\uff01\uff01\uff01 [ root@dev vsftpd ] # systemctl start vsftpd@vsftpd3.service [ root@dev vsftpd ] # netstat -ntlp | grep ftp tcp6 0 0 :::9003 :::* LISTEN 11681 /vsftpd tcp6 0 0 :::555 :::* LISTEN 10565 /vsftpd tcp6 0 0 :::21 :::* LISTEN 10564 /vsftpd \u600e\u4e48\u6837\uff0c\u662f\u4e0d\u662f\u5f88\u795e\u5947\uff0c\u5c45\u7136\u53ea\u590d\u5236\u4e86\u4e00\u4efdftp\u8fd0\u884c\u65f6\u914d\u7f6e\u5c31\u53ef\u4ee5\u76f4\u63a5\u8d77\u6765\u4e00\u4e2a\u670d\u52a1\uff01\u4e3b\u8981\u53d1\u6325\u4f5c\u7528\u7684\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u6587\u4ef6\u5566\uff1a [ root@dev vsftpd ] # cat /usr/lib/systemd/system/vsftpd@.service [ Unit ] Description = Vsftpd ftp daemon After = network.target PartOf = vsftpd.target [ Service ] Type = forking ExecStart = /usr/sbin/vsftpd /etc/vsftpd/%i.conf [ Install ] WantedBy = vsftpd.target \u5728\u542f\u52a8\u7684\u811a\u672c\u8bbe\u5b9a\u5f53\u4e2d\uff0c %i \u6216 %I \u5c31\u662f\u4ee3\u8868 @ \u540e\u9762\u63a5\u7684\u8303\u4f8b\u6587\u4ef6\u540d\u7684\u610f\u601d\uff0c\u6709\u4e86\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5c31\u80fd\u50cf\u4e0a\u9762\u90a3\u6837\u91cd\u590d\u542f\u52a8\u670d\u52a1\u5566\u3002 Note \u8fd9\u6b21\u589e\u52a0\u7aef\u53e3\u5374\u4e0d\u9700\u8981\u66f4\u6539SELinux\u7684\u914d\u7f6e\u4e86\uff0c\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4\u542f\u52a8\u5c0f\u4e8e 1024 \u53f7\u7801\u4ee5\u4e0b\u7684\u7aef\u53e3\u53e3\u65f6\uff0c \u9700\u8981\u4f7f\u7528\u5230 root \u7684\u6743\u9650\uff0c\u56e0\u6b64\u5c0f\u4e8e 1024 \u4ee5\u4e0b\u7aef\u53e3\u7684\u542f\u52a8\u8f83\u53ef\u6015\u3002\u800c\u8fd9\u6b21\u8303\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 9003 \u7aef\u53e3\uff0c\u4ed6\u5bf9\u4e8e\u7cfb\u7edf\u7684\u5f71\u54cd\u53ef\u80fd\u5c0f\u4e00\u4e9b (\u5176\u5b9e\u4e00\u6837\u53ef\u6015!)\uff0c \u6240\u4ee5\u5c31\u5ffd\u7565\u4e86 SELinux \u7684\u9650\u5236\u4e86\u3002","title":"2.10.2 \u914d\u7f6e\u591a\u4e2a\u91cd\u590d\u8bbe\u5b9a\u7684\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2103","text":"\u53ea\u6267\u884c\u4e00\u6b21\u7684\u670d\u52a1\u3002 # \u5177\u6709\u6267\u884c\u6743\u9650\u7684\u811a\u672c [ root@dev ~ ] # ll /home/backup.sh -rwxr-xr-x. 1 root root 199 Nov 25 17 :25 /home/backup.sh [ root@dev ~ ] # cat /home/backup.sh #!/bin/sh [ ! -d /tmp/boot_backup ] && mkdir /tmp/boot_backup date_str = $( date +%Y%m%d ) tar -zcf /tmp/boot_backup/boot_backup_ ${ date_str } .tar.gz /boot & > /tmp/boot_backup/boot_backup_ ${ date_str } .log # \u670d\u52a1\u914d\u7f6e\u6587\u4ef6 [ root@dev ~ ] # cat /etc/systemd/system/backup.service [ Unit ] Description = /boot backup service Requires = atd.service [ Service ] Type = simple # \u8fd9\u91cc\u597d\u50cf\u4e0d\u652f\u6301 shell \u62d3\u5c55\uff0c\u53ea\u80fd\u5199\u5728 bash \u53c2\u6570\u91cc\u9762\u4f5c\u4e3a\u652f\u6301\uff1f\uff1f\uff1f ExecStart = /bin/bash -c \"/usr/bin/echo /home/backup.sh | at now\" [ Install ] WantedBy = multi-user.target [ root@dev ~ ] # systemctl daemon-reload # \u6267\u884c\u4e00\u6b21 [ root@dev ~ ] # systemctl start backup.service # \u56e0\u4e3a\u662f\u4e00\u6b21\u6027\u7684\u670d\u52a1\uff0c\u6240\u4ee5\u8fd9\u91cc\u662f inactive [ root@dev ~ ] # systemctl status backup.service \u25cf backup.service - /boot backup service Loaded: loaded ( /etc/systemd/system/backup.service ; disabled ; vendor preset: disabled ) # vendor preset\uff1a\u4f9b\u5e94\u5546\u9884\u8bbe Active: inactive ( dead ) Nov 25 17 :31:34 dev systemd [ 1 ] : Started /boot backup service. Nov 25 17 :31:34 dev bash [ 12851 ] : job 7 at Mon Nov 25 17 :31:00 2019 # \u67e5\u770b\u7ed3\u679c [ root@dev ~ ] # ll /tmp/boot_backup/ total 186324 -rw-r--r--. 1 root root 44 Nov 25 17 :31 boot_backup_20191125.log -rw-r--r--. 1 root root 190790040 Nov 25 17 :31 boot_backup_20191125.tar.gz","title":"2.10.3 \u5236\u4f5c\u670d\u52a1\u793a\u4f8b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#211-timer","text":"systemd.timer \u7684\u4f18\u52bf \u7531\u4e8e\u6240\u6709\u7684 systemd \u7684\u670d\u52a1\u4ea7\u751f\u7684\u4fe1\u606f\u90fd\u4f1a\u88ab\u7eaa\u5f55 (log)\uff0c\u56e0\u6b64\u6bd4 crond \u5728 debug \u4e0a\u9762\u8981\u66f4\u6e05\u695a\u65b9\u4fbf\u7684\u591a; \u5404\u9879 timer \u7684\u5de5\u4f5c\u53ef\u4ee5\u8ddf systemd \u7684\u670d\u52a1\u76f8\u7ed3\u5408; \u5404\u9879 timer \u7684\u5de5\u4f5c\u53ef\u4ee5\u8ddf control group (cgroup\uff0c\u7528\u6765\u53d6\u4ee3 /etc/secure/limit.conf \u7684\u529f\u80fd) \u7ed3\u5408\uff0c\u6765\u9650\u5236\u8be5\u5de5\u4f5c\u7684\u8d44\u6e90\u5229\u7528\u3002 \u4f7f\u7528 timer \u7684\u524d\u63d0\uff1a \u7cfb\u7edf\u7684 timer.target \u4e00\u5b9a\u8981\u542f\u52a8 \u8981\u6709\u4e2a sname.service \u7684\u670d\u52a1\u5b58\u5728 (sname \u662f\u4f60\u81ea\u5df1\u6307\u5b9a\u7684\u540d\u79f0) \u8981\u6709\u4e2a sname.timer \u7684\u65f6\u95f4\u542f\u52a8\u670d\u52a1\u5b58\u5728","title":"2.11 timer \u7c7b\u578b\u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2111","text":"timer \u914d\u7f6e\u6587\u4ef6\u7684\u57fa\u672c\u5185\u5bb9\uff08man systemd.timer & man systemd.time\uff09\uff1a","title":"2.11.1 \u914d\u7f6e\u6587\u4ef6\u5185\u5bb9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21111-oncalendar","text":"\u57fa\u672c\u4e0a\u7684\u683c\u5f0f\u5982\u4e0b\u6240\u793a\uff1a \u8bed\u6cd5 : \u82f1\u6587\u5468\u540d YYYY - MM - DD HH : MM : SS \u8303\u4f8b : Thu 2015 - 08 - 13 13 : 40 : 00 \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u95f4\u9694\u65f6\u95f4\u6765\u5904\u7406\uff1a us \u6216 usec\uff1a\u5fae\u79d2 (10 -6 \u79d2) ms \u6216 msec\uff1a\u6beb\u79d2 (10 -3 \u79d2) s\uff0c sec\uff0c second\uff0c seconds m\uff0c min\uff0c minute\uff0c minutes h\uff0c hr\uff0c hour\uff0c hours d\uff0c day\uff0c days w\uff0c week\uff0c weeks month\uff0c months y\uff0c year\uff0c years # \u901a\u5e38\u82f1\u6587\u7684\u5199\u6cd5\uff0c\u5c0f\u5355\u4f4d\u5199\u524d\u9762\uff0c\u5927\u5355\u4f4d\u5199\u540e\u9762~\u6240\u4ee5\u5148\u79d2\u3001\u518d\u5206\u3001\u518d\u5c0f\u65f6\u3001\u518d\u5929\u6570\u7b49~ \u9694 3 \u5c0f\u65f6: 3h \u6216 3hr \u6216 3hours \u9694 300 \u5206\u949f\u8fc7 10 \u79d2: 10s 300m \u9694 5 \u5929\u53c8 100 \u5206\u949f: 100m 5day \u6b64\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u82f1\u6587\u5e38\u7528\u7684\u53e3\u8bed\u5316\u65e5\u671f\u4ee3\u8868\uff0c\u4f8b\u5982today\uff0ctomorrow\u7b49\u3002","title":"2.11.1.1 OnCalendar\u53c2\u6570\u7684\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#2112","text":"","title":"2.11.2 \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21121","text":"\u91c7\u7528\u4e0a\u4e00\u5c0f\u8282\u7f16\u5199\u7684 backup.service \u6765\u4f5c\u4e3a\u670d\u52a1\uff0c\u4e3a\u5176\u7f16\u5199 timer\uff1a [ root@dev ~ ] # cd /etc/systemd/system/ [ root@dev system ] # cat backup.timer [ Unit ] Description = back up /boot timer [ Timer ] # \u7cfb\u7edf\u542f\u52a8 2\u5c0f\u65f6 \u540e\u6267\u884c OnBootSec = 2h # \u670d\u52a1\u7b2c\u4e00\u6b21\u6267\u884c\u5b8c\u6bd5\u540e\u6bcf\u9694 2\u5929 \u6267\u884c\u4e00\u6b21 OnUnitActiveSec = 2d [ Install ] WantedBy = multi-user.target [ root@dev system ] # systemctl daemon-reload [ root@dev system ] # systemctl enable backup.timer [ root@dev system ] # systemctl start backup.timer # service \u65e0\u9700 enable [ root@dev system ] # systemctl list-unit-files | grep backup backup.service disabled backup.timer enabled [ root@dev system ] # systemctl show timers.target | grep ConditionTimestamp= ConditionTimestamp = Mon 2019 -11-25 08 :32:25 CST [ root@dev system ] # systemctl show backup.service | grep ExecMainExitTimestamp= ExecMainExitTimestamp = Tue 2019 -11-26 09 :36:24 CST # .timer \u7684\u65f6\u95f4\u662f\u6839\u636e .service \u4e0e timers.target \u7684\u65f6\u95f4\u5dee\u6765\u8ba1\u7b97\u7684\uff0c\u8fd9\u91cc\u65f6\u95f4\u6709\u70b9\u5bf9\u4e0d\u4e0a\uff0c\u4e0d\u8fc7\u8bef\u5dee\u4e0d\u5927 [ root@dev system ] # systemctl show backup.timer | egrep \"NextElapseUSecMonotonic|LastTriggerUSecMonotonic=\" NextElapseUSecMonotonic = 3d 1h 7min 5 .741522s # \u4e0b\u6b21\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c LastTriggerUSecMonotonic = 1d 1h 7min 5 .739590s # \u4e0a\u6b21\u662f\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u7684 # Monotonic\uff1a\u5355\u8c03\u65f6\u95f4\uff0c\u5373\u4ece\u67d0\u4e2a\u65f6\u95f4\u70b9\u5f00\u59cb\u5230\u73b0\u5728\u8fc7\u53bb\u7684\u65f6\u95f4\u3002","title":"2.11.2.1 \u5faa\u73af\u5468\u671f\u914d\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/21 \u7cfb\u7edf\u670d\u52a1/#21122","text":"[ root@dev system ] # cat backup2.timer [ Unit ] Description = back up /boot timer2 [ Timer ] OnCalendar = Sun *-*-* 00 :00:00 Persistent = yes Unit = backup.service [ Install ] WantedBy = multi-user.target [ root@dev system ] # systemctl daemon-reload [ root@dev system ] # systemctl enable backup2.timer [ root@dev system ] # systemctl start backup2.timer [ root@dev system ] # systemctl show backup2.timer | grep NextElapseUSecRealtime= NextElapseUSecRealtime = 49y 10month 4w 1d 1h # Realtime\uff1a\u662f\u5b9e\u9645\u7684\u65f6\u95f4\u3002\u662fUnix\u7684\u6807\u51c6\u65f6\u95f4 1970-01-01 00:00:00 \u4ee5\u6765\u7684\u65f6\u95f4","title":"2.11.2.2 \u56fa\u5b9a\u65e5\u671f\u914d\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/","text":"\u65e5\u5fd7\u6587\u4ef6\u7684\u4f5c\u7528\uff1a\u8bb0\u5f55\u7cfb\u7edf\u5728\u4ec0\u4e48\u65f6\u5019\u7531\u54ea\u4e2a\u7a0b\u5e8f\u6709\u4ec0\u4e48\u6837\u7684\u884c\u4e3a\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48\u4e8b\u7b49\u7b49\u3002 1. CentOS 7 \u65e5\u5fd7\u6587\u4ef6 \u00b6 1.1 \u5e38\u89c1\u7684\u65e5\u5fd7\u6587\u4ef6 \u00b6 /var/log/boot.log \u8bb0\u5f55 \u672c\u6b21\u5f00\u673a\u542f\u52a8 \u7684\u4fe1\u606f\u3002 /var/log/cron \u8bb0\u5f55\u4e0e crontab \u76f8\u5173\u7684\u4fe1\u606f\u3002 /var/log/dmesg \u8bb0\u5f55\u7cfb\u7edf\u5728 \u5f00\u673a\u7684\u65f6\u5019 \u5185\u6838\u6240\u4ea7\u751f\u7684\u5404\u9879\u4fe1\u606f\u3002\u7531\u4e8e CentOS \u9ed8\u8ba4\u5c06\u5f00\u673a\u65f6\u5185\u6838\u7684\u786c\u4ef6\u4fa6\u6d4b\u8fc7\u7a0b\u53d6\u6d88\u663e\u793a\uff0c \u56e0\u6b64\u989d\u5916\u5c06\u6570\u636e\u8bb0\u5f55\u4e00\u4efd\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002 /var/log/lastlog \u8bb0\u5f55\u7cfb\u7edf\u4e0a\u9762\u6240\u6709\u7684\u8d26\u53f7\u6700\u8fd1\u4e00\u6b21\u767b\u5165\u7cfb\u7edf\u65f6\u7684\u76f8\u5173\u4fe1\u606f\u3002 lastlog \u6307\u4ee4\u5c31\u662f\u8bfb\u53d6\u8be5\u6587\u4ef6\u7684\u3002 /var/log/maillog \u6216 /var/log/mail/* \u8bb0\u5f55\u90ae\u4ef6\u7684\u5f80\u6765\u4fe1\u606f\uff0c\u5176\u5b9e\u4e3b\u8981\u662f\u8bb0\u5f55 postfix (SMTP \u534f\u8bae\u63d0\u4f9b\u8005\uff0c\u53d1\u9001) \u4e0e dovecot (POP3 \u534f\u8bae\u63d0\u4f9b\u8005\uff0c\u63a5\u6536) \u6240\u4ea7\u751f\u7684\u4fe1\u606f\u3002 /var/log/messages \u51e0\u4e4e\u7cfb\u7edf\u53d1\u751f\u7684\u9519\u8bef\u4fe1\u606f (\u6216\u8005\u662f\u91cd\u8981\u7684\u4fe1\u606f) \u90fd\u4f1a\u8bb0\u5f55\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002 \u5f88\u91cd\u8981 \uff01\uff01\uff01 /var/log/secure \u57fa\u672c\u4e0a\uff0c\u53ea\u8981\u7275\u6d89\u5230 \u9700\u8981\u8f93\u5165\u8d26\u53f7\u5bc6\u7801 \u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48\u5f53\u767b\u5165\u65f6 (\u4e0d\u7ba1\u767b\u5165\u6b63\u786e\u6216\u9519\u8bef) \u90fd\u4f1a\u88ab\u8bb0\u5f55\u5728\u6b64\u6587\u4ef6\u4e2d\u3002 /var/log/wtmp\uff0c /var/log/faillog \u8bb0\u5f55\u6b63\u786e\u767b\u5165\u7cfb\u7edf\u8005\u7684\u5e10\u6237\u4fe1\u606f (wtmp) \u4e0e\u9519\u8bef\u767b\u5165\u65f6\u6240\u4f7f\u7528\u7684\u5e10\u6237\u4fe1\u606f (faillog)\u3002 last \u6307\u4ee4\u5c31\u662f\u8bfb\u53d6 wtmp \u7684\u3002 /var/log/httpd/*\uff0c /var/log/samba/* http \u670d\u52a1\u548c samba \u670d\u52a1\u65e5\u5fd7\u3002\u5176\u4ed6\u7684\u7f51\u7edc\u670d\u52a1\u65e5\u5fd7\u4e5f\u4f1a\u4f7f\u7528\u5404\u81ea\u7684\u65e5\u5fd7\u6587\u4ef6\u6765\u5b58\u50a8\u4fe1\u606f\u3002 1.2 \u65e5\u5fd7\u6587\u4ef6\u6240\u9700\u76f8\u5173\u670d\u52a1 (daemon) \u4e0e\u7a0b\u5e8f \u00b6 \u65e5\u5fd7\u6587\u4ef6\u662f\u600e\u4e48\u4ea7\u751f\u7684\u5462\uff1f\u57fa\u672c\u4e0a\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u7531\u8f6f\u4ef6\u5f00\u53d1\u5546\u81ea\u884c\u5b9a\u4e49\u5982\u4f55\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\u3002 \u7531 Linux distribution \u63d0\u4f9b\u7684\u65e5\u5fd7\u6587\u4ef6\u7ba1\u7406\u670d\u52a1\u6765\u7edf\u4e00\u7ba1\u7406\u3002\u4f60\u53ea\u8981\u5c06\u4fe1\u606f\u4e22\u7ed9\u8fd9\u4e2a\u670d\u52a1\u540e\uff0c\u4ed6\u5c31\u4f1a\u81ea\u5df1\u5206\u95e8\u522b\u7c7b\u7684\u5c06\u5404\u79cd\u4fe1\u606f\u653e\u7f6e\u5230\u76f8\u5173\u7684\u65e5\u5fd7\u6587\u4ef6\u53bb\uff01CentOS \u63d0\u4f9b rsyslog.service \u8fd9\u4e2a\u670d\u52a1\u6765\u7edf\u4e00\u7ba1\u7406\u65e5\u5fd7\u6587\u4ef6\u3002 CentOS 7 \u9664\u4e86\u4fdd\u6709\u65e2\u6709\u7684 rsyslog.service \u4e4b\u5916\uff0c\u5176\u5b9e\u6700\u4e0a\u6e38\u8fd8\u4f7f\u7528\u4e86 systemd \u81ea\u5df1\u7684\u65e5\u5fd7\u6587\u4ef6\u65e5\u5fd7\u7ba1\u7406\u529f\u80fd\u3002\u4ed6\u4f7f\u7528\u7684\u662f systemd-journald.service \u8fd9\u4e2a\u670d\u52a1\u6765\u652f\u6301\u7684\u3002\u6240\u6709\u7ecf\u7531 systemd \u542f\u52a8\u7684\u670d\u52a1\uff0c\u5176\u4ea7\u751f\u7684\u4fe1\u606f\u90fd\u4f1a\u7531 systemd-journald.service \u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e4b\u540e\u518d\u5c06\u8fd9\u4e2a\u4fe1\u606f\u53d1\u9001\u7ed9 rsyslog.service \u4f5c\u8fdb\u4e00\u6b65\u7684\u8bb0\u5f55\u3002 \u6587\u4ef6\u5982\u679c\u8d8a\u6765\u8d8a\u5927\u600e\u4e48\u529e\uff1f\u90a3\u5c31\u4f7f\u7528 logrotate \u6765\u81ea\u52a8\u5316\u5904\u7406\u65e5\u5fd7\u6587\u4ef6\u5bb9\u91cf\u4e0e\u66f4\u65b0\u7684\u95ee\u9898\u5427\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u7531\u7cfb\u7edf\u7ba1\u7406\u7684\u65e5\u5fd7\u6587\u4ef6\u6240\u9700\u8981\u7684 daemon \u6709\uff1a systemd-journald.service\uff1a\u6700\u4e3b\u8981\u7684\u4fe1\u606f\u6536\u53d7\u8005\uff0c\u7531 systemd \u63d0\u4f9b\u7684\uff1b rsyslog.service\uff1a\u4e3b\u8981\u8bb0\u5f55\u767b\u5f55\u7cfb\u7edf\u4e0e\u7f51\u7edc\u7b49\u670d\u52a1\u7684\u4fe1\u606f\uff1b logrotate\uff1a\u4e3b\u8981\u8fdb\u884c\u65e5\u5fd7\u6587\u4ef6\u7684\u8f6e\u66ff\u529f\u80fd\u3002 2. rsyslog.service \u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 /etc/rsyslog.conf \u4e3b\u8981\u5b9a\u4e49\u4e86\uff1a (1)\u4ec0\u4e48\u670d\u52a1 (2)\u7684\u4ec0\u4e48\u7b49\u7ea7\u4fe1\u606f (3)\u9700\u8981\u88ab\u8bb0\u5f55\u5728\u54ea\u91cc(\u88c5\u7f6e\u6216\u6587\u4ef6) \u3002 [ root@dev ~ ] # vi /etc/rsyslog.conf \u2026\u2026 #### RULES #### # \u670d\u52a1\u540d\u79f0[.=!]\u4fe1\u606f\u7b49\u7ea7 \u4fe1\u606f\u8bb0\u5f55\u7684\u6587\u4ef6\u540d\u6216\u88c5\u7f6e\u6216\u4e3b\u673a # Log all kernel messages to the console. # Logging much else clutters up the screen. #kern.* /dev/console # Log anything (except mail) of level info or higher. # Don't log private authentication messages! *.info ; mail.none ; authpriv.none ; cron.none /var/log/messages # The authpriv file has restricted access. authpriv.* /var/log/secure # Log all the mail messages in one place. mail.* -/var/log/maillog # Everybody gets emergency messages\uff0c\u53d1\u9001\u7ed9\u6240\u6709\u4eba *.emerg :omusrmsg:* \u2026\u2026 \u6ce8\u610f \uff1a\u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u9700\u8981\u91cd\u542f\u670d\u52a1\uff1a systemctl restart rsyslog.service Warning rsyslogd \u7684\u767b\u5f55\u6863\u53ea\u8981\u88ab\u7f16\u8f91\u8fc7\u5c31\u65e0\u6cd5\u7ee7\u7eed\u8bb0\u5f55\uff01\uff01\uff01\u6b64\u65f6\u9700\u8981\u91cd\u65b0\u542f\u52a8 rsyslog.service \u670d\u52a1\u624d\u884c\u3002 2.1 \u670d\u52a1\u540d\u79f0 \u00b6 rsyslogd \u4e3b\u8981\u8fd8\u662f\u900f\u8fc7 Linux \u5185\u6838\u63d0\u4f9b\u7684 syslog \u76f8\u5173\u89c4\u8303\u6765\u8bbe\u5b9a\u6570\u636e\u7684\u5206\u7c7b\u7684\uff0cLinux \u7684 syslog \u672c\u8eab\u6709\u89c4\u8303\u4e00\u4e9b\u670d\u52a1\u4fe1\u606f\uff0c \u4f60\u53ef\u4ee5\u900f\u8fc7\u8fd9\u4e9b\u670d\u52a1\u6765\u50a8\u5b58\u7cfb\u7edf\u7684\u4fe1\u606f\u3002 Linux \u5185\u6838\u7684 syslog \u8ba4\u8bc6\u7684\u670d\u52a1\u7c7b\u578b\uff08man 3 syslog\uff09\u4e3b\u8981\u6709\uff1a 2.2 \u4fe1\u606f\u7b49\u7ea7 \u00b6 syslog \u5c06\u4fe1\u606f\u7b49\u7ea7\u5206\u4e3a\u4e03\u7ea7\uff1a \u9664\u4e86 0 \u5230 6 \u4e4b\u5916\u8fd8\u6709\u4e24\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u7b49\u7ea7\uff0c \u90a3\u5c31\u662f debug (\u9519\u8bef\u4fa6\u6d4b\u7b49\u7ea7) \u4e0e none (\u4e0d\u9700\u767b\u5f55\u7b49\u7ea7) \u4e24\u4e2a\uff0c\u9002\u7528\u4e8e\u60f3\u8981\u4f5c\u4e00\u4e9b\u9519\u8bef\u4fa6\u6d4b\uff0c\u6216\u8005\u662f\u5ffd\u7565\u6389\u67d0\u4e9b\u670d\u52a1\u7684\u4fe1\u606f\u65f6\u7684\u60c5\u51b5\u3002 . \uff1a\u4ee3\u8868\u6bd4\u540e\u9762\u8fd8\u8981\u4e25\u91cd\u7684\u7b49\u7ea7 (\u542b\u8be5\u7b49\u7ea7) \u90fd\u88ab\u8bb0\u5f55\u4e0b\u6765\u7684\u610f\u601d\u3002 .= \uff1a\u4ee3\u8868\u6240\u9700\u8981\u7684\u7b49\u7ea7\u5c31\u662f\u540e\u9762\u63a5\u7684\u7b49\u7ea7\u800c\u5df2\uff0c \u5176\u4ed6\u7684\u4e0d\u8981! .! \uff1a\u4ee3\u8868\u4e0d\u7b49\u4e8e\uff0c \u4ea6\u5373\u662f\u9664\u4e86\u8be5\u7b49\u7ea7\u5916\u7684\u5176\u4ed6\u7b49\u7ea7\u90fd\u8bb0\u5f55\u3002 2.3 \u4fe1\u606f\u8bb0\u5f55\u7684\u6587\u4ef6\u540d\u6216\u88c5\u7f6e\u6216\u4e3b\u673a \u00b6 \u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\uff1a\u901a\u5e38\u5c31\u662f\u653e\u5728 /var/log \u91cc\u5934\u7684\u6587\u4ef6\u5566! \u6253\u5370\u673a\u6216\u5176\u4ed6\uff1a\u4f8b\u5982 /dev/lp0 \u8fd9\u4e2a\u6253\u5370\u673a\u88c5\u7f6e \u4f7f\u7528\u8005\u540d\u79f0\uff1a\u663e\u793a\u7ed9\u7528\u6237 \u8fdc\u7a0b\u4e3b\u673a\uff1a\u4f8b\u5982 @test.com\uff0c\u5f53\u7136\u5566\uff0c\u8981\u5bf9\u65b9\u4e3b\u673a\u4e5f\u80fd\u652f\u6301\u624d\u884c! *\uff1a\u4ee3\u8868 \u76ee\u524d\u5728\u5728\u7ebf\u7684\u6240\u6709\u4eba \uff0c\u7c7b\u4f3c wall \u8fd9\u4e2a\u6307\u4ee4 Note \u4f7f\u7528 \u9017\u53f7 \u5206\u9694\u65f6\uff0c\u90a3\u4e48\u7b49\u7ea7\u53ea\u8981\u63a5\u5728\u6700\u540e\u4e00\u4e2a\u5373\u53ef\uff0c\u5982\u679c\u662f\u4ee5 \u5206\u53f7 \u6765\u5206\u7684\u8bdd\uff0c \u90a3\u4e48\u5c31\u9700\u8981\u5c06\u670d\u52a1\u4e0e\u7b49\u7ea7\u90fd\u5199\u4e0a\u53bb\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u8fd9\u4e24\u79cd\u5199\u6cd5\u662f\u4e00\u6837\u7684\uff1a # \u8bb0\u5f55\u9664 news\uff0ccron\uff0cmail \u4e4b\u5916\u7684\u4efb\u4f55\u7a0b\u5e8f\u7684\u4fe1\u606f *.*;news,cron,mail.none /var/log/messages *.*;news.none;cron.none;mail.none /var/log/messages 2.4 \u9632\u6b62\u65e5\u5fd7\u6587\u4ef6\u88ab\u4e0d\u5c0f\u5fc3\u4fee\u6539 \u00b6 \u524d\u9762\u8bf4\u5230\uff0c\u5f53\u4f60\u7f16\u8f91\u4e86rsyslogd\u7684\u65e5\u5fd7\u6587\u4ef6\u4e4b\u540e\uff0c\u5c31\u65e0\u6cd5\u7ee7\u7eed\u8bb0\u5f55\u4e86\u3002\u6b64\u65f6\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e0b\u9690\u85cf\u5c5e\u6027\uff1a # a \u5c5e\u6027\u4f1a\u8ba9\u6587\u4ef6\u53d8\u4e3a\u53ea\u80fd\u8ffd\u52a0\u7684\u72b6\u6001\uff0c\u4e0d\u53ef\u88ab\u4fee\u6539\u3001\u79fb\u52a8\u53ca\u5220\u9664 [ root@dev ~ ] # chattr +a /var/log/messages [ root@dev ~ ] # lsattr /var/log/messages -----a---------- /var/log/messages # \u770b\u5427\uff0c\u4e0d\u80fd\u4fee\u6539\u54e6 [ root@dev ~ ] # vi /var/log/messages hahahahahahahaha ~ \"/var/log/messages\" \"/var/log/messages\" E212: Can ' t open file for writing \u4f46\u8fd9\u6837\u4e5f\u4f1a\u9020\u6210 logrotate \u4e0d\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u89e3\u51b3\u4e4b\u9053\u8bf7\u770b\u4e0b\u6587\u3002 2.5 \u8bbe\u7f6e\u767b\u5f55\u670d\u52a1\u5668 \u00b6 \u5bf9\u4e8e\u5927\u89c4\u6a21linux\u96c6\u7fa4\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4e13\u95e8\u7684\u4e3b\u673a\u7528\u6765\u8bb0\u5f55\u6240\u6709\u670d\u52a1\u5668\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u67e5\u770b\u55bd\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u670d\u52a1\u5668\u4f1a\u542f\u52a8\u76d1\u542c\u7684\u7aef\u53e3\uff0c\u5ba2\u6237\u7aef\u5219\u5c06\u65e5\u5fd7\u6587\u4ef6\u518d\u8f6c\u51fa\u4e00\u4efd\u9001\u5230\u670d\u52a1\u5668\u53bb\u3002 # 1.\u670d\u52a1\u7aef\u914d\u7f6e [ root@centos-1810 ~ ] # vi /etc/rsyslog.conf # \u7f51\u7edc\u7a33\u5b9a\u5c31\u7528UDP # Provides UDP syslog reception #$ModLoad imudp #$UDPServerRun 514 # \u60f3\u8981\u6570\u636e\u7a33\u5b9a\u4f20\u8f93\u5c31\u7528TCP # Provides TCP syslog reception #$ModLoad imtcp #$InputTCPServerRun 514 $ModLoad imtcp $InputTCPServerRun 514 # \u91cd\u542f\u670d\u52a1 [ root@centos-1810 ~ ] # systemctl restart rsyslog.service [ root@centos-1810 ~ ] # lsof -i -n -P | grep syslog rsyslogd 30805 root 3u IPv4 114368696 0t0 TCP *:514 ( LISTEN ) rsyslogd 30805 root 4u IPv6 114368697 0t0 TCP *:514 ( LISTEN ) # 2.\u5ba2\u6237\u7aef\u914d\u7f6e [ root@dev ~ ] # vi /etc/rsyslog.conf # send log to server --shihr # TCP \u8bbe\u7f6e *.* @@172.16.7.54 # UDP \u8bbe\u7f6e #*.* @172.16.7.54 [ root@dev ~ ] # systemctl restart rsyslog.service 3. \u65e5\u5fd7\u5206\u5272\uff08logrotate\uff09 \u00b6 logrotate \u662f\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5230\u4e86\u4e4b\u540e\u624d\u6765\u8fdb\u884c\u65e5\u5fd7\u7684\u5206\u5272\u3002\u65e5\u5fd7\u5206\u5272\u662f\u914d\u7f6e\u5728 anacron \u91cc\u9762\u7684\uff1a /etc/cron.daily/logrotate \u3002 [ root@dev ~ ] # cat /etc/cron.daily/logrotate #!/bin/sh /usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf EXITVALUE = $? if [ $EXITVALUE ! = 0 ] ; then /usr/bin/logger -t logrotate \"ALERT exited abnormally with [ $EXITVALUE ]\" fi exit 0 3.1 logrotate \u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 /etc/logrotate.conf /etc/logrotate.d \uff1a\u8be5\u76ee\u5f55\u91cc\u9762\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u4e3b\u52a8\u7684\u8bfb\u5165 /etc/logrotate.conf \u5f53\u4e2d\u6765\u8fdb\u884c [ root@dev ~ ] # cat /etc/logrotate.conf # see \"man logrotate\" for details # \u4e0a\u9762\u8fd9\u4e9b\u662f\u9ed8\u8ba4\u53c2\u6570\uff0c\u5728\u4e0b\u9762\u7684\u89c4\u5219\u6ca1\u6709\u914d\u7f6e\u65f6\u5c31\u4f7f\u7528\u8fd9\u4e9b\u503c # rotate log files weekly weekly # keep 4 weeks worth of backlogs rotate 4 # create new (empty) log files after rotating old ones create # use date as a suffix of the rotated file dateext # uncomment this if you want your log files compressed #compress # \u5b9a\u5236\u65e5\u5fd7\u7684\u5207\u5272\u89c4\u5219 # RPM packages drop log rotation information into this directory include /etc/logrotate.d # no packages own wtmp and btmp -- we'll rotate them here /var/log/wtmp { monthly create 0664 root utmp minsize 1M # \u81f3\u5c11\u8fbe\u52301M\u7684\u5927\u5c0f\u624d\u8fdb\u884c\u5207\u5272\uff0c\u9ad8\u4e8e\u65f6\u95f4\u53c2\u6570\u7684\u8bbe\u7f6e rotate 1 } /var/log/btmp { missingok monthly create 0600 root utmp rotate 1 } # system-specific logs may be also be configured here. [ root@dev ~ ] # cat /etc/logrotate.d/syslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { missingok sharedscripts postrotate /bin/kill -HUP ` cat /var/run/syslogd.pid 2 > /dev/null ` 2 > /dev/null || true endscript } logrotate\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\uff08 man logrotate \uff09\uff1a \u65e5\u5fd7\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u53ef\u4ee5\u4f7f\u7528\u7a7a\u683c\u5206\u9694\u591a\u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002 \u53c2\u6570\u3002\u5b9a\u4e49\u4e86\u4f55\u65f6\u6267\u884c\u7b49\u95ee\u9898 \u6267\u884c\u811a\u672c\u3002\u53ef\u4ee5\u8c03\u7528\u5916\u90e8\u7684\u547d\u4ee4\uff0c\u4f7f\u7528 sharedscript......endscript \u5305\u56f4\u3002\u8c03\u7528\u7684\u65f6\u671f\u6709\u4e24\u79cd\uff1a prerotate\uff1a\u5728\u542f\u52a8 logrotate \u4e4b\u524d\u8fdb\u884c\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u4fee\u6539\u65e5\u5fd7\u6587\u4ef6\u7684\u5c5e\u6027\u7b49\u52a8\u4f5c; postrotate\uff1a\u5728\u505a\u5b8c logrotate \u4e4b\u540e\u542f\u52a8\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u91cd\u65b0\u542f\u52a8 (kill -HUP) \u67d0\u4e2a\u670d\u52a1! prerotate \u4e0e postrotate \u5bf9\u4e8e\u5df2\u52a0\u4e0a\u7279\u6b8a\u5c5e\u6027\u7684\u6587\u4ef6\u5904\u7406\u4e0a\u9762\uff0c\u662f\u76f8\u5f53\u91cd\u8981\u7684\u6267\u884c\u7a0b\u5e8f! \u8ba9\u524d\u6587\u8bbe\u7f6e\u7684\u9690\u85cf\u5c5e\u6027\u5728\u8fdb\u884c\u65e5\u5fd7\u5207\u5272\u7684\u65f6\u5019\u6682\u65f6\u5931\u6548\uff1a [ root@dev ~ ] # vim /etc/logrotate.d/syslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { missingok sharedscripts presrotate /usr/bin/chattr -a /var/log/messages endscript sharedscripts postrotate /bin/kill -HUP ` cat /var/run/syslogd.pid 2 > /dev/null ` 2 > /dev/null || true /usr/bin/chattr +a /var/log/messages endscript } 3.2 \u624b\u52a8\u6267\u884c\u65e5\u5fd7\u5206\u5272 \u00b6 logrotate [ - dv ] [ - f |-- force ] [ - s |-- state file ] config_file .. - d , -- debug Turns on debug mode and implies - v . In debug mode , no changes will be made to the logs or to the logrotate state file . +- v , -- verbose Turns on verbose mode , ie . display messages during rotation . - f , -- force Tells logrotate to force the rotation , even if it doesn ' t think this is necessary. Sometimes this is useful after adding new entries to a logrotate config file, or if old log files have been removed by hand, as the new files will be created, and logging will continue correctly. [ root@dev ~ ] # logrotate -v -f /etc/logrotate.conf reading config file /etc/logrotate.conf including /etc/logrotate.d reading config file bootlog \u2026\u2026 4. systemd-journald.service \u00b6 \u5185\u6838\u5524\u9192\u7b2c\u4e00\u4e2a\u7a0b\u5e8f systemd \u4e4b\u540e\uff0c\u4ed6\u4f1a\u4e3b\u52a8\u547c\u53eb systemd-journald.service \u6765\u8bb0\u5f55\u65e5\u5fd7\u6587\u4ef6\uff0c\u56e0\u6b64\u5728\u5f00\u673a\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u542f\u52a8\u670d\u52a1\u4e0e\u670d\u52a1\u82e5\u542f\u52a8\u5931\u8d25\u7684\u60c5\u51b5\u7b49\u7b49\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u88ab\u8bb0\u5f55\u5230 systemd-journald \u91cc\u3002\u4e0d\u8fc7 systemd-journald \u7531\u4e8e\u662f\u4f7f\u7528\u4e8e\u5185\u5b58\u7684\u65e5\u5fd7\u6587\u4ef6\u8bb0\u5f55\u65b9\u5f0f\uff0c\u6240\u4ee5\u53ea\u4f1a\u8bb0\u5f55\u672c\u6b21\u5f00\u673a\u4fe1\u606f\uff0c\u800c rsyslogd \u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u4ee5\u524d\u53ca\u73b0\u5728\u7684\u6240\u4ee5\u6570\u636e\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf\u672a\u6765\u8fdb\u884c\u67e5\u8be2\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u4e24\u8005\u534f\u4f5c\u5566\u3002 4.1 \u4f7f\u7528 journalctl \u89c2\u5bdf\u767b\u5f55\u4fe1\u606f \u00b6 journalctl [ OPTIONS ...] [ MATCHES ...] \u4e0d\u6dfb\u52a0\u4efb\u4f55\u53c2\u6570\u65f6\uff0c\u4f1a\u4ece\u6700\u8001\u7684\u65e5\u5fd7\u5f00\u59cb\u663e\u793a\u5b8c\u6574\u7684\u7cfb\u7edf\u65e5\u5fd7 MATCHES \uff1a\u683c\u5f0f\u4e3a \" FIELD=VALUE \" \uff0c\u53ef\u8f93\u5165\u591a\u4e2a\u3002\u5168\u90e8\u7684\u53ef\u7528\u503c\u67e5\u8be2\uff1a man systemd . journal - fields _SYSTEMD_UNIT = unit . service \u53ea\u8f93\u51fa unit . service \u7684\u4fe1\u606f _COMM = bash \u53ea\u8f93\u51fa\u4e0e bash \u6709\u5173\u7684\u4fe1\u606f _PID = pid \u53ea\u8f93\u51fa\u4e0e PID \u53f7\u7801\u6709\u5173\u7684\u4fe1\u606f _UID = uid \u53ea\u8f93\u51fa UID \u4e3a uid \u7684\u4fe1\u606f SYSLOG_FACILITY = [ 0 - 23 ] \u4f7f\u7528 syslog . h \u89c4\u8303\u7684\u670d\u52a1\u76f8\u5bf9\u5e8f\u53f7\u6765\u547c\u53eb\u51fa\u6b63\u786e\u7684\u6570\u636e OPTIONS - f , -- follow \u6301\u7eed\u8f93\u51fa\uff0c\u7c7b\u4f3c\u4e8e tailf \u7684\u529f\u80fd - r , -- reverse \u4ece\u6700\u65b0\u7684\u5f00\u59cb\u663e\u793a - n , -- lines = \u663e\u793a\u6700\u8fd1\u7684 N \u884c - p , -- priority = \u6839\u636e\u4f18\u5148\u7ea7\uff08\u5c0f\u4e8e\u7b49\u4e8e\uff09\u8fdb\u884c\u8fc7\u6ee4\u3002 \" emerg \" ( 0 ) , \" alert \" ( 1 ) , \" crit \" ( 2 ) , \" err \" ( 3 ) , \" warning \" ( 4 ) , \" notice \" ( 5 ) , \" info \" ( 6 ) , \" debug \" ( 7 ) - S , -- since = , - U , -- until = \u683c\u5f0f\uff1a \" 2012-10-30 18:17:16 \" - x , -- catalog \u6dfb\u52a0\u6d88\u606f\u8bf4\u660e\uff08\u5982\u679c\u53ef\u7528\uff09 - e , -- pager - end \u8df3\u5230\u663e\u793a\u7684\u672b\u5c3e [ root@dev ~ ] # journalctl -S \"2019-11-28\" -- Logs begin at Mon 2019 -11-25 08 :29:16 CST, end at Fri 2019 -11-29 10 :40:01 CST. -- Nov 28 00 :00:01 dev systemd [ 1 ] : Started Session 462 of user root. Nov 28 00 :00:01 dev CROND [ 32262 ] : ( root ) CMD ( /usr/lib64/sa/sa1 1 1 ) Nov 28 00 :01:01 dev systemd [ 1 ] : Started Session 463 of user root. Nov 28 00 :01:01 dev CROND [ 32270 ] : ( root ) CMD ( run-parts /etc/cron.hourly ) Nov 28 00 :01:01 dev run-parts ( /etc/cron.hourly )[ 32273 ] : starting 0anacron Nov 28 00 :01:01 dev anacron [ 32280 ] : Anacron started on 2019 -11-28 Nov 28 00 :01:01 dev anacron [ 32280 ] : Normal exit ( 0 jobs run ) 4.2 \u4f7f\u7528 logger \u8bb0\u5f55\u5230\u65e5\u5fd7\u6587\u4ef6 \u00b6 \u628a\u6570\u636e\u50a8\u5b58\u5230\u65e5\u5fd7\u6587\u4ef6\u3002 logger [ options ] [ message ] OPTIONS - f , --file file Log the contents of the specified file. - S , --size size Sets the maximum permitted message size. - p , --priority priority Enter the message into the log with the specified priority.\u683c\u5f0f\u662f facility.level\uff0c\u9ed8\u8ba4 user.notice\u3002\u5177\u4f53\u67e5\u9605 FACILITIES AND LEVELS \u7ae0\u8282 [ root@dev ~ ] # logger -p user.debug \"test log to systemd with logger\" [ root@dev ~ ] # journalctl -n 1 -- Logs begin at Mon 2019 -11-25 08 :29:16 CST, end at Fri 2019 -11-29 10 :59:12 CST. -- Nov 29 10 :59:12 dev root [ 45214 ] : test log to systemd with logger 4.3 \u4fdd\u5b58 journal \u7684\u65b9\u5f0f \u00b6 [ root@dev ~ ] # mkdir /var/log/journal [ root@dev ~ ] # chown root:systemd-journal /var/log/journal/ [ root@dev ~ ] # chmod 2755 /var/log/journal/ # \u9e1f\u54e5\u8bf4\u8981\u91cd\u542f\u670d\u52a1\u624d\u4f1a\u4fdd\u5b58\uff0c\u4e0d\u8fc7\u6211\u8fd9\u91cc\u4e0d\u9700\u8981\uff08CentOS Linux release 7.7.1908 (Core)\uff09\uff1asystemctl restart systemd-journald.service [ root@dev ~ ] # tree /var/log/journal/ /var/log/journal/ \u2514\u2500\u2500 0242c388ca104d46b8d6d9a4b951ff3f \u2514\u2500\u2500 system.journal \u4e0d\u8fc7\u9e1f\u54e5\u8bf4\u6ca1\u5fc5\u8981\u518d\u989d\u5916\u5b58\u50a8\u4e00\u4efd\u3002 5. \u5206\u6790\u65e5\u5fd7\u6587\u4ef6 \u00b6 last, lastlog, dmesg \u7b49\u6307\u4ee4\u63d0\u4f9b\u7684\u6570\u636e\u6bd4\u8f83\u5206\u6563\u3002\u4e86\u89e3\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u8fd8\u662f\u5f97\u8981\u5206\u6790\u6574\u4e2a\u65e5\u5fd7\u6587\u4ef6\u624d\u884c\u3002 5.1 CentOS \u9884\u8bbe\u63d0\u4f9b\u7684 logwatch \u00b6 \u6bcf\u5929\u5206\u6790\u4e00\u6b21\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u6570\u636e\u4ee5 email \u7684\u683c\u5f0f\u5bc4\u9001\u7ed9 root\u3002 \u5148\u5b89\u88c5\u55bd\uff1a [ root@dev ~ ] # yum install logwatch # \u5b89\u88c5\u5b8c\u6bd5\u4e4b\u540e\uff0c\u65e5\u7a0b\u4e0b\u9762\u5c31\u6709\u6587\u4ef6\u4e86 [ root@dev ~ ] # ll /etc/cron.daily/0logwatch -rwxr-xr-x. 1 root root 434 Aug 16 2018 /etc/cron.daily/0logwatch [ root@dev ~ ] # /etc/cron.daily/0logwatch [ root@dev ~ ] # mail \u2026\u2026 ################### Logwatch 7.4.0 (03/01/11) #################### Processing Initiated: Fri Nov 29 15 :18:29 2019 Date Range Processed: yesterday ( 2019 -Nov-28 ) Period is day. Detail Level of Output: 0 Type of Output/Format: mail / text Logfiles for Host: dev ################################################################## --------------------- pam_unix Begin ------------------------ su-l: Sessions Opened: root -> sink: 1 Time ( s ) sudo: Sessions Opened: root -> root: 1 Time ( s ) ---------------------- pam_unix End ------------------------- --------------------- Connections ( secure-log ) Begin ------------------------ **Unmatched Entries** --More-- 5.2 \u9e1f\u54e5\u7684\u65e5\u5fd7\u6587\u4ef6\u5206\u6790\u5de5\u5177 \u00b6 \u4e0b\u8f7d\uff1a \u9e1f\u54e5\u7684\u4e0b\u8f7d\u5730\u5740 \u7b80\u4f53\u4e2d\u6587\u7248\u5730\u5740 [ root@dev ~ ] # tar -zxf logfile_centos7.tar.gz -C /","title":"22 \u65e5\u5fd7\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#1-centos-7","text":"","title":"1. CentOS 7 \u65e5\u5fd7\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#11","text":"/var/log/boot.log \u8bb0\u5f55 \u672c\u6b21\u5f00\u673a\u542f\u52a8 \u7684\u4fe1\u606f\u3002 /var/log/cron \u8bb0\u5f55\u4e0e crontab \u76f8\u5173\u7684\u4fe1\u606f\u3002 /var/log/dmesg \u8bb0\u5f55\u7cfb\u7edf\u5728 \u5f00\u673a\u7684\u65f6\u5019 \u5185\u6838\u6240\u4ea7\u751f\u7684\u5404\u9879\u4fe1\u606f\u3002\u7531\u4e8e CentOS \u9ed8\u8ba4\u5c06\u5f00\u673a\u65f6\u5185\u6838\u7684\u786c\u4ef6\u4fa6\u6d4b\u8fc7\u7a0b\u53d6\u6d88\u663e\u793a\uff0c \u56e0\u6b64\u989d\u5916\u5c06\u6570\u636e\u8bb0\u5f55\u4e00\u4efd\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002 /var/log/lastlog \u8bb0\u5f55\u7cfb\u7edf\u4e0a\u9762\u6240\u6709\u7684\u8d26\u53f7\u6700\u8fd1\u4e00\u6b21\u767b\u5165\u7cfb\u7edf\u65f6\u7684\u76f8\u5173\u4fe1\u606f\u3002 lastlog \u6307\u4ee4\u5c31\u662f\u8bfb\u53d6\u8be5\u6587\u4ef6\u7684\u3002 /var/log/maillog \u6216 /var/log/mail/* \u8bb0\u5f55\u90ae\u4ef6\u7684\u5f80\u6765\u4fe1\u606f\uff0c\u5176\u5b9e\u4e3b\u8981\u662f\u8bb0\u5f55 postfix (SMTP \u534f\u8bae\u63d0\u4f9b\u8005\uff0c\u53d1\u9001) \u4e0e dovecot (POP3 \u534f\u8bae\u63d0\u4f9b\u8005\uff0c\u63a5\u6536) \u6240\u4ea7\u751f\u7684\u4fe1\u606f\u3002 /var/log/messages \u51e0\u4e4e\u7cfb\u7edf\u53d1\u751f\u7684\u9519\u8bef\u4fe1\u606f (\u6216\u8005\u662f\u91cd\u8981\u7684\u4fe1\u606f) \u90fd\u4f1a\u8bb0\u5f55\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002 \u5f88\u91cd\u8981 \uff01\uff01\uff01 /var/log/secure \u57fa\u672c\u4e0a\uff0c\u53ea\u8981\u7275\u6d89\u5230 \u9700\u8981\u8f93\u5165\u8d26\u53f7\u5bc6\u7801 \u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48\u5f53\u767b\u5165\u65f6 (\u4e0d\u7ba1\u767b\u5165\u6b63\u786e\u6216\u9519\u8bef) \u90fd\u4f1a\u88ab\u8bb0\u5f55\u5728\u6b64\u6587\u4ef6\u4e2d\u3002 /var/log/wtmp\uff0c /var/log/faillog \u8bb0\u5f55\u6b63\u786e\u767b\u5165\u7cfb\u7edf\u8005\u7684\u5e10\u6237\u4fe1\u606f (wtmp) \u4e0e\u9519\u8bef\u767b\u5165\u65f6\u6240\u4f7f\u7528\u7684\u5e10\u6237\u4fe1\u606f (faillog)\u3002 last \u6307\u4ee4\u5c31\u662f\u8bfb\u53d6 wtmp \u7684\u3002 /var/log/httpd/*\uff0c /var/log/samba/* http \u670d\u52a1\u548c samba \u670d\u52a1\u65e5\u5fd7\u3002\u5176\u4ed6\u7684\u7f51\u7edc\u670d\u52a1\u65e5\u5fd7\u4e5f\u4f1a\u4f7f\u7528\u5404\u81ea\u7684\u65e5\u5fd7\u6587\u4ef6\u6765\u5b58\u50a8\u4fe1\u606f\u3002","title":"1.1 \u5e38\u89c1\u7684\u65e5\u5fd7\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#12-daemon","text":"\u65e5\u5fd7\u6587\u4ef6\u662f\u600e\u4e48\u4ea7\u751f\u7684\u5462\uff1f\u57fa\u672c\u4e0a\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u7531\u8f6f\u4ef6\u5f00\u53d1\u5546\u81ea\u884c\u5b9a\u4e49\u5982\u4f55\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\u3002 \u7531 Linux distribution \u63d0\u4f9b\u7684\u65e5\u5fd7\u6587\u4ef6\u7ba1\u7406\u670d\u52a1\u6765\u7edf\u4e00\u7ba1\u7406\u3002\u4f60\u53ea\u8981\u5c06\u4fe1\u606f\u4e22\u7ed9\u8fd9\u4e2a\u670d\u52a1\u540e\uff0c\u4ed6\u5c31\u4f1a\u81ea\u5df1\u5206\u95e8\u522b\u7c7b\u7684\u5c06\u5404\u79cd\u4fe1\u606f\u653e\u7f6e\u5230\u76f8\u5173\u7684\u65e5\u5fd7\u6587\u4ef6\u53bb\uff01CentOS \u63d0\u4f9b rsyslog.service \u8fd9\u4e2a\u670d\u52a1\u6765\u7edf\u4e00\u7ba1\u7406\u65e5\u5fd7\u6587\u4ef6\u3002 CentOS 7 \u9664\u4e86\u4fdd\u6709\u65e2\u6709\u7684 rsyslog.service \u4e4b\u5916\uff0c\u5176\u5b9e\u6700\u4e0a\u6e38\u8fd8\u4f7f\u7528\u4e86 systemd \u81ea\u5df1\u7684\u65e5\u5fd7\u6587\u4ef6\u65e5\u5fd7\u7ba1\u7406\u529f\u80fd\u3002\u4ed6\u4f7f\u7528\u7684\u662f systemd-journald.service \u8fd9\u4e2a\u670d\u52a1\u6765\u652f\u6301\u7684\u3002\u6240\u6709\u7ecf\u7531 systemd \u542f\u52a8\u7684\u670d\u52a1\uff0c\u5176\u4ea7\u751f\u7684\u4fe1\u606f\u90fd\u4f1a\u7531 systemd-journald.service \u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u8bb0\u5f55\u4e0b\u6765\uff0c\u4e4b\u540e\u518d\u5c06\u8fd9\u4e2a\u4fe1\u606f\u53d1\u9001\u7ed9 rsyslog.service \u4f5c\u8fdb\u4e00\u6b65\u7684\u8bb0\u5f55\u3002 \u6587\u4ef6\u5982\u679c\u8d8a\u6765\u8d8a\u5927\u600e\u4e48\u529e\uff1f\u90a3\u5c31\u4f7f\u7528 logrotate \u6765\u81ea\u52a8\u5316\u5904\u7406\u65e5\u5fd7\u6587\u4ef6\u5bb9\u91cf\u4e0e\u66f4\u65b0\u7684\u95ee\u9898\u5427\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u7531\u7cfb\u7edf\u7ba1\u7406\u7684\u65e5\u5fd7\u6587\u4ef6\u6240\u9700\u8981\u7684 daemon \u6709\uff1a systemd-journald.service\uff1a\u6700\u4e3b\u8981\u7684\u4fe1\u606f\u6536\u53d7\u8005\uff0c\u7531 systemd \u63d0\u4f9b\u7684\uff1b rsyslog.service\uff1a\u4e3b\u8981\u8bb0\u5f55\u767b\u5f55\u7cfb\u7edf\u4e0e\u7f51\u7edc\u7b49\u670d\u52a1\u7684\u4fe1\u606f\uff1b logrotate\uff1a\u4e3b\u8981\u8fdb\u884c\u65e5\u5fd7\u6587\u4ef6\u7684\u8f6e\u66ff\u529f\u80fd\u3002","title":"1.2 \u65e5\u5fd7\u6587\u4ef6\u6240\u9700\u76f8\u5173\u670d\u52a1 (daemon) \u4e0e\u7a0b\u5e8f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#2-rsyslogservice","text":"/etc/rsyslog.conf \u4e3b\u8981\u5b9a\u4e49\u4e86\uff1a (1)\u4ec0\u4e48\u670d\u52a1 (2)\u7684\u4ec0\u4e48\u7b49\u7ea7\u4fe1\u606f (3)\u9700\u8981\u88ab\u8bb0\u5f55\u5728\u54ea\u91cc(\u88c5\u7f6e\u6216\u6587\u4ef6) \u3002 [ root@dev ~ ] # vi /etc/rsyslog.conf \u2026\u2026 #### RULES #### # \u670d\u52a1\u540d\u79f0[.=!]\u4fe1\u606f\u7b49\u7ea7 \u4fe1\u606f\u8bb0\u5f55\u7684\u6587\u4ef6\u540d\u6216\u88c5\u7f6e\u6216\u4e3b\u673a # Log all kernel messages to the console. # Logging much else clutters up the screen. #kern.* /dev/console # Log anything (except mail) of level info or higher. # Don't log private authentication messages! *.info ; mail.none ; authpriv.none ; cron.none /var/log/messages # The authpriv file has restricted access. authpriv.* /var/log/secure # Log all the mail messages in one place. mail.* -/var/log/maillog # Everybody gets emergency messages\uff0c\u53d1\u9001\u7ed9\u6240\u6709\u4eba *.emerg :omusrmsg:* \u2026\u2026 \u6ce8\u610f \uff1a\u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u9700\u8981\u91cd\u542f\u670d\u52a1\uff1a systemctl restart rsyslog.service Warning rsyslogd \u7684\u767b\u5f55\u6863\u53ea\u8981\u88ab\u7f16\u8f91\u8fc7\u5c31\u65e0\u6cd5\u7ee7\u7eed\u8bb0\u5f55\uff01\uff01\uff01\u6b64\u65f6\u9700\u8981\u91cd\u65b0\u542f\u52a8 rsyslog.service \u670d\u52a1\u624d\u884c\u3002","title":"2. rsyslog.service \u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#21","text":"rsyslogd \u4e3b\u8981\u8fd8\u662f\u900f\u8fc7 Linux \u5185\u6838\u63d0\u4f9b\u7684 syslog \u76f8\u5173\u89c4\u8303\u6765\u8bbe\u5b9a\u6570\u636e\u7684\u5206\u7c7b\u7684\uff0cLinux \u7684 syslog \u672c\u8eab\u6709\u89c4\u8303\u4e00\u4e9b\u670d\u52a1\u4fe1\u606f\uff0c \u4f60\u53ef\u4ee5\u900f\u8fc7\u8fd9\u4e9b\u670d\u52a1\u6765\u50a8\u5b58\u7cfb\u7edf\u7684\u4fe1\u606f\u3002 Linux \u5185\u6838\u7684 syslog \u8ba4\u8bc6\u7684\u670d\u52a1\u7c7b\u578b\uff08man 3 syslog\uff09\u4e3b\u8981\u6709\uff1a","title":"2.1 \u670d\u52a1\u540d\u79f0"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#22","text":"syslog \u5c06\u4fe1\u606f\u7b49\u7ea7\u5206\u4e3a\u4e03\u7ea7\uff1a \u9664\u4e86 0 \u5230 6 \u4e4b\u5916\u8fd8\u6709\u4e24\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u7b49\u7ea7\uff0c \u90a3\u5c31\u662f debug (\u9519\u8bef\u4fa6\u6d4b\u7b49\u7ea7) \u4e0e none (\u4e0d\u9700\u767b\u5f55\u7b49\u7ea7) \u4e24\u4e2a\uff0c\u9002\u7528\u4e8e\u60f3\u8981\u4f5c\u4e00\u4e9b\u9519\u8bef\u4fa6\u6d4b\uff0c\u6216\u8005\u662f\u5ffd\u7565\u6389\u67d0\u4e9b\u670d\u52a1\u7684\u4fe1\u606f\u65f6\u7684\u60c5\u51b5\u3002 . \uff1a\u4ee3\u8868\u6bd4\u540e\u9762\u8fd8\u8981\u4e25\u91cd\u7684\u7b49\u7ea7 (\u542b\u8be5\u7b49\u7ea7) \u90fd\u88ab\u8bb0\u5f55\u4e0b\u6765\u7684\u610f\u601d\u3002 .= \uff1a\u4ee3\u8868\u6240\u9700\u8981\u7684\u7b49\u7ea7\u5c31\u662f\u540e\u9762\u63a5\u7684\u7b49\u7ea7\u800c\u5df2\uff0c \u5176\u4ed6\u7684\u4e0d\u8981! .! \uff1a\u4ee3\u8868\u4e0d\u7b49\u4e8e\uff0c \u4ea6\u5373\u662f\u9664\u4e86\u8be5\u7b49\u7ea7\u5916\u7684\u5176\u4ed6\u7b49\u7ea7\u90fd\u8bb0\u5f55\u3002","title":"2.2 \u4fe1\u606f\u7b49\u7ea7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#23","text":"\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\uff1a\u901a\u5e38\u5c31\u662f\u653e\u5728 /var/log \u91cc\u5934\u7684\u6587\u4ef6\u5566! \u6253\u5370\u673a\u6216\u5176\u4ed6\uff1a\u4f8b\u5982 /dev/lp0 \u8fd9\u4e2a\u6253\u5370\u673a\u88c5\u7f6e \u4f7f\u7528\u8005\u540d\u79f0\uff1a\u663e\u793a\u7ed9\u7528\u6237 \u8fdc\u7a0b\u4e3b\u673a\uff1a\u4f8b\u5982 @test.com\uff0c\u5f53\u7136\u5566\uff0c\u8981\u5bf9\u65b9\u4e3b\u673a\u4e5f\u80fd\u652f\u6301\u624d\u884c! *\uff1a\u4ee3\u8868 \u76ee\u524d\u5728\u5728\u7ebf\u7684\u6240\u6709\u4eba \uff0c\u7c7b\u4f3c wall \u8fd9\u4e2a\u6307\u4ee4 Note \u4f7f\u7528 \u9017\u53f7 \u5206\u9694\u65f6\uff0c\u90a3\u4e48\u7b49\u7ea7\u53ea\u8981\u63a5\u5728\u6700\u540e\u4e00\u4e2a\u5373\u53ef\uff0c\u5982\u679c\u662f\u4ee5 \u5206\u53f7 \u6765\u5206\u7684\u8bdd\uff0c \u90a3\u4e48\u5c31\u9700\u8981\u5c06\u670d\u52a1\u4e0e\u7b49\u7ea7\u90fd\u5199\u4e0a\u53bb\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u8fd9\u4e24\u79cd\u5199\u6cd5\u662f\u4e00\u6837\u7684\uff1a # \u8bb0\u5f55\u9664 news\uff0ccron\uff0cmail \u4e4b\u5916\u7684\u4efb\u4f55\u7a0b\u5e8f\u7684\u4fe1\u606f *.*;news,cron,mail.none /var/log/messages *.*;news.none;cron.none;mail.none /var/log/messages","title":"2.3 \u4fe1\u606f\u8bb0\u5f55\u7684\u6587\u4ef6\u540d\u6216\u88c5\u7f6e\u6216\u4e3b\u673a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#24","text":"\u524d\u9762\u8bf4\u5230\uff0c\u5f53\u4f60\u7f16\u8f91\u4e86rsyslogd\u7684\u65e5\u5fd7\u6587\u4ef6\u4e4b\u540e\uff0c\u5c31\u65e0\u6cd5\u7ee7\u7eed\u8bb0\u5f55\u4e86\u3002\u6b64\u65f6\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e0b\u9690\u85cf\u5c5e\u6027\uff1a # a \u5c5e\u6027\u4f1a\u8ba9\u6587\u4ef6\u53d8\u4e3a\u53ea\u80fd\u8ffd\u52a0\u7684\u72b6\u6001\uff0c\u4e0d\u53ef\u88ab\u4fee\u6539\u3001\u79fb\u52a8\u53ca\u5220\u9664 [ root@dev ~ ] # chattr +a /var/log/messages [ root@dev ~ ] # lsattr /var/log/messages -----a---------- /var/log/messages # \u770b\u5427\uff0c\u4e0d\u80fd\u4fee\u6539\u54e6 [ root@dev ~ ] # vi /var/log/messages hahahahahahahaha ~ \"/var/log/messages\" \"/var/log/messages\" E212: Can ' t open file for writing \u4f46\u8fd9\u6837\u4e5f\u4f1a\u9020\u6210 logrotate \u4e0d\u80fd\u6b63\u5e38\u6267\u884c\uff0c\u89e3\u51b3\u4e4b\u9053\u8bf7\u770b\u4e0b\u6587\u3002","title":"2.4 \u9632\u6b62\u65e5\u5fd7\u6587\u4ef6\u88ab\u4e0d\u5c0f\u5fc3\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#25","text":"\u5bf9\u4e8e\u5927\u89c4\u6a21linux\u96c6\u7fa4\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4e13\u95e8\u7684\u4e3b\u673a\u7528\u6765\u8bb0\u5f55\u6240\u6709\u670d\u52a1\u5668\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u67e5\u770b\u55bd\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u670d\u52a1\u5668\u4f1a\u542f\u52a8\u76d1\u542c\u7684\u7aef\u53e3\uff0c\u5ba2\u6237\u7aef\u5219\u5c06\u65e5\u5fd7\u6587\u4ef6\u518d\u8f6c\u51fa\u4e00\u4efd\u9001\u5230\u670d\u52a1\u5668\u53bb\u3002 # 1.\u670d\u52a1\u7aef\u914d\u7f6e [ root@centos-1810 ~ ] # vi /etc/rsyslog.conf # \u7f51\u7edc\u7a33\u5b9a\u5c31\u7528UDP # Provides UDP syslog reception #$ModLoad imudp #$UDPServerRun 514 # \u60f3\u8981\u6570\u636e\u7a33\u5b9a\u4f20\u8f93\u5c31\u7528TCP # Provides TCP syslog reception #$ModLoad imtcp #$InputTCPServerRun 514 $ModLoad imtcp $InputTCPServerRun 514 # \u91cd\u542f\u670d\u52a1 [ root@centos-1810 ~ ] # systemctl restart rsyslog.service [ root@centos-1810 ~ ] # lsof -i -n -P | grep syslog rsyslogd 30805 root 3u IPv4 114368696 0t0 TCP *:514 ( LISTEN ) rsyslogd 30805 root 4u IPv6 114368697 0t0 TCP *:514 ( LISTEN ) # 2.\u5ba2\u6237\u7aef\u914d\u7f6e [ root@dev ~ ] # vi /etc/rsyslog.conf # send log to server --shihr # TCP \u8bbe\u7f6e *.* @@172.16.7.54 # UDP \u8bbe\u7f6e #*.* @172.16.7.54 [ root@dev ~ ] # systemctl restart rsyslog.service","title":"2.5 \u8bbe\u7f6e\u767b\u5f55\u670d\u52a1\u5668"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#3-logrotate","text":"logrotate \u662f\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5230\u4e86\u4e4b\u540e\u624d\u6765\u8fdb\u884c\u65e5\u5fd7\u7684\u5206\u5272\u3002\u65e5\u5fd7\u5206\u5272\u662f\u914d\u7f6e\u5728 anacron \u91cc\u9762\u7684\uff1a /etc/cron.daily/logrotate \u3002 [ root@dev ~ ] # cat /etc/cron.daily/logrotate #!/bin/sh /usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf EXITVALUE = $? if [ $EXITVALUE ! = 0 ] ; then /usr/bin/logger -t logrotate \"ALERT exited abnormally with [ $EXITVALUE ]\" fi exit 0","title":"3. \u65e5\u5fd7\u5206\u5272\uff08logrotate\uff09"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#31-logrotate","text":"/etc/logrotate.conf /etc/logrotate.d \uff1a\u8be5\u76ee\u5f55\u91cc\u9762\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u4e3b\u52a8\u7684\u8bfb\u5165 /etc/logrotate.conf \u5f53\u4e2d\u6765\u8fdb\u884c [ root@dev ~ ] # cat /etc/logrotate.conf # see \"man logrotate\" for details # \u4e0a\u9762\u8fd9\u4e9b\u662f\u9ed8\u8ba4\u53c2\u6570\uff0c\u5728\u4e0b\u9762\u7684\u89c4\u5219\u6ca1\u6709\u914d\u7f6e\u65f6\u5c31\u4f7f\u7528\u8fd9\u4e9b\u503c # rotate log files weekly weekly # keep 4 weeks worth of backlogs rotate 4 # create new (empty) log files after rotating old ones create # use date as a suffix of the rotated file dateext # uncomment this if you want your log files compressed #compress # \u5b9a\u5236\u65e5\u5fd7\u7684\u5207\u5272\u89c4\u5219 # RPM packages drop log rotation information into this directory include /etc/logrotate.d # no packages own wtmp and btmp -- we'll rotate them here /var/log/wtmp { monthly create 0664 root utmp minsize 1M # \u81f3\u5c11\u8fbe\u52301M\u7684\u5927\u5c0f\u624d\u8fdb\u884c\u5207\u5272\uff0c\u9ad8\u4e8e\u65f6\u95f4\u53c2\u6570\u7684\u8bbe\u7f6e rotate 1 } /var/log/btmp { missingok monthly create 0600 root utmp rotate 1 } # system-specific logs may be also be configured here. [ root@dev ~ ] # cat /etc/logrotate.d/syslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { missingok sharedscripts postrotate /bin/kill -HUP ` cat /var/run/syslogd.pid 2 > /dev/null ` 2 > /dev/null || true endscript } logrotate\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\uff08 man logrotate \uff09\uff1a \u65e5\u5fd7\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u53ef\u4ee5\u4f7f\u7528\u7a7a\u683c\u5206\u9694\u591a\u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002 \u53c2\u6570\u3002\u5b9a\u4e49\u4e86\u4f55\u65f6\u6267\u884c\u7b49\u95ee\u9898 \u6267\u884c\u811a\u672c\u3002\u53ef\u4ee5\u8c03\u7528\u5916\u90e8\u7684\u547d\u4ee4\uff0c\u4f7f\u7528 sharedscript......endscript \u5305\u56f4\u3002\u8c03\u7528\u7684\u65f6\u671f\u6709\u4e24\u79cd\uff1a prerotate\uff1a\u5728\u542f\u52a8 logrotate \u4e4b\u524d\u8fdb\u884c\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u4fee\u6539\u65e5\u5fd7\u6587\u4ef6\u7684\u5c5e\u6027\u7b49\u52a8\u4f5c; postrotate\uff1a\u5728\u505a\u5b8c logrotate \u4e4b\u540e\u542f\u52a8\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\u91cd\u65b0\u542f\u52a8 (kill -HUP) \u67d0\u4e2a\u670d\u52a1! prerotate \u4e0e postrotate \u5bf9\u4e8e\u5df2\u52a0\u4e0a\u7279\u6b8a\u5c5e\u6027\u7684\u6587\u4ef6\u5904\u7406\u4e0a\u9762\uff0c\u662f\u76f8\u5f53\u91cd\u8981\u7684\u6267\u884c\u7a0b\u5e8f! \u8ba9\u524d\u6587\u8bbe\u7f6e\u7684\u9690\u85cf\u5c5e\u6027\u5728\u8fdb\u884c\u65e5\u5fd7\u5207\u5272\u7684\u65f6\u5019\u6682\u65f6\u5931\u6548\uff1a [ root@dev ~ ] # vim /etc/logrotate.d/syslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { missingok sharedscripts presrotate /usr/bin/chattr -a /var/log/messages endscript sharedscripts postrotate /bin/kill -HUP ` cat /var/run/syslogd.pid 2 > /dev/null ` 2 > /dev/null || true /usr/bin/chattr +a /var/log/messages endscript }","title":"3.1 logrotate \u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#32","text":"logrotate [ - dv ] [ - f |-- force ] [ - s |-- state file ] config_file .. - d , -- debug Turns on debug mode and implies - v . In debug mode , no changes will be made to the logs or to the logrotate state file . +- v , -- verbose Turns on verbose mode , ie . display messages during rotation . - f , -- force Tells logrotate to force the rotation , even if it doesn ' t think this is necessary. Sometimes this is useful after adding new entries to a logrotate config file, or if old log files have been removed by hand, as the new files will be created, and logging will continue correctly. [ root@dev ~ ] # logrotate -v -f /etc/logrotate.conf reading config file /etc/logrotate.conf including /etc/logrotate.d reading config file bootlog \u2026\u2026","title":"3.2 \u624b\u52a8\u6267\u884c\u65e5\u5fd7\u5206\u5272"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#4-systemd-journaldservice","text":"\u5185\u6838\u5524\u9192\u7b2c\u4e00\u4e2a\u7a0b\u5e8f systemd \u4e4b\u540e\uff0c\u4ed6\u4f1a\u4e3b\u52a8\u547c\u53eb systemd-journald.service \u6765\u8bb0\u5f55\u65e5\u5fd7\u6587\u4ef6\uff0c\u56e0\u6b64\u5728\u5f00\u673a\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u542f\u52a8\u670d\u52a1\u4e0e\u670d\u52a1\u82e5\u542f\u52a8\u5931\u8d25\u7684\u60c5\u51b5\u7b49\u7b49\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u88ab\u8bb0\u5f55\u5230 systemd-journald \u91cc\u3002\u4e0d\u8fc7 systemd-journald \u7531\u4e8e\u662f\u4f7f\u7528\u4e8e\u5185\u5b58\u7684\u65e5\u5fd7\u6587\u4ef6\u8bb0\u5f55\u65b9\u5f0f\uff0c\u6240\u4ee5\u53ea\u4f1a\u8bb0\u5f55\u672c\u6b21\u5f00\u673a\u4fe1\u606f\uff0c\u800c rsyslogd \u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u4ee5\u524d\u53ca\u73b0\u5728\u7684\u6240\u4ee5\u6570\u636e\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf\u672a\u6765\u8fdb\u884c\u67e5\u8be2\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u4e24\u8005\u534f\u4f5c\u5566\u3002","title":"4. systemd-journald.service"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#41-journalctl","text":"journalctl [ OPTIONS ...] [ MATCHES ...] \u4e0d\u6dfb\u52a0\u4efb\u4f55\u53c2\u6570\u65f6\uff0c\u4f1a\u4ece\u6700\u8001\u7684\u65e5\u5fd7\u5f00\u59cb\u663e\u793a\u5b8c\u6574\u7684\u7cfb\u7edf\u65e5\u5fd7 MATCHES \uff1a\u683c\u5f0f\u4e3a \" FIELD=VALUE \" \uff0c\u53ef\u8f93\u5165\u591a\u4e2a\u3002\u5168\u90e8\u7684\u53ef\u7528\u503c\u67e5\u8be2\uff1a man systemd . journal - fields _SYSTEMD_UNIT = unit . service \u53ea\u8f93\u51fa unit . service \u7684\u4fe1\u606f _COMM = bash \u53ea\u8f93\u51fa\u4e0e bash \u6709\u5173\u7684\u4fe1\u606f _PID = pid \u53ea\u8f93\u51fa\u4e0e PID \u53f7\u7801\u6709\u5173\u7684\u4fe1\u606f _UID = uid \u53ea\u8f93\u51fa UID \u4e3a uid \u7684\u4fe1\u606f SYSLOG_FACILITY = [ 0 - 23 ] \u4f7f\u7528 syslog . h \u89c4\u8303\u7684\u670d\u52a1\u76f8\u5bf9\u5e8f\u53f7\u6765\u547c\u53eb\u51fa\u6b63\u786e\u7684\u6570\u636e OPTIONS - f , -- follow \u6301\u7eed\u8f93\u51fa\uff0c\u7c7b\u4f3c\u4e8e tailf \u7684\u529f\u80fd - r , -- reverse \u4ece\u6700\u65b0\u7684\u5f00\u59cb\u663e\u793a - n , -- lines = \u663e\u793a\u6700\u8fd1\u7684 N \u884c - p , -- priority = \u6839\u636e\u4f18\u5148\u7ea7\uff08\u5c0f\u4e8e\u7b49\u4e8e\uff09\u8fdb\u884c\u8fc7\u6ee4\u3002 \" emerg \" ( 0 ) , \" alert \" ( 1 ) , \" crit \" ( 2 ) , \" err \" ( 3 ) , \" warning \" ( 4 ) , \" notice \" ( 5 ) , \" info \" ( 6 ) , \" debug \" ( 7 ) - S , -- since = , - U , -- until = \u683c\u5f0f\uff1a \" 2012-10-30 18:17:16 \" - x , -- catalog \u6dfb\u52a0\u6d88\u606f\u8bf4\u660e\uff08\u5982\u679c\u53ef\u7528\uff09 - e , -- pager - end \u8df3\u5230\u663e\u793a\u7684\u672b\u5c3e [ root@dev ~ ] # journalctl -S \"2019-11-28\" -- Logs begin at Mon 2019 -11-25 08 :29:16 CST, end at Fri 2019 -11-29 10 :40:01 CST. -- Nov 28 00 :00:01 dev systemd [ 1 ] : Started Session 462 of user root. Nov 28 00 :00:01 dev CROND [ 32262 ] : ( root ) CMD ( /usr/lib64/sa/sa1 1 1 ) Nov 28 00 :01:01 dev systemd [ 1 ] : Started Session 463 of user root. Nov 28 00 :01:01 dev CROND [ 32270 ] : ( root ) CMD ( run-parts /etc/cron.hourly ) Nov 28 00 :01:01 dev run-parts ( /etc/cron.hourly )[ 32273 ] : starting 0anacron Nov 28 00 :01:01 dev anacron [ 32280 ] : Anacron started on 2019 -11-28 Nov 28 00 :01:01 dev anacron [ 32280 ] : Normal exit ( 0 jobs run )","title":"4.1 \u4f7f\u7528 journalctl \u89c2\u5bdf\u767b\u5f55\u4fe1\u606f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#42-logger","text":"\u628a\u6570\u636e\u50a8\u5b58\u5230\u65e5\u5fd7\u6587\u4ef6\u3002 logger [ options ] [ message ] OPTIONS - f , --file file Log the contents of the specified file. - S , --size size Sets the maximum permitted message size. - p , --priority priority Enter the message into the log with the specified priority.\u683c\u5f0f\u662f facility.level\uff0c\u9ed8\u8ba4 user.notice\u3002\u5177\u4f53\u67e5\u9605 FACILITIES AND LEVELS \u7ae0\u8282 [ root@dev ~ ] # logger -p user.debug \"test log to systemd with logger\" [ root@dev ~ ] # journalctl -n 1 -- Logs begin at Mon 2019 -11-25 08 :29:16 CST, end at Fri 2019 -11-29 10 :59:12 CST. -- Nov 29 10 :59:12 dev root [ 45214 ] : test log to systemd with logger","title":"4.2 \u4f7f\u7528 logger \u8bb0\u5f55\u5230\u65e5\u5fd7\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#43-journal","text":"[ root@dev ~ ] # mkdir /var/log/journal [ root@dev ~ ] # chown root:systemd-journal /var/log/journal/ [ root@dev ~ ] # chmod 2755 /var/log/journal/ # \u9e1f\u54e5\u8bf4\u8981\u91cd\u542f\u670d\u52a1\u624d\u4f1a\u4fdd\u5b58\uff0c\u4e0d\u8fc7\u6211\u8fd9\u91cc\u4e0d\u9700\u8981\uff08CentOS Linux release 7.7.1908 (Core)\uff09\uff1asystemctl restart systemd-journald.service [ root@dev ~ ] # tree /var/log/journal/ /var/log/journal/ \u2514\u2500\u2500 0242c388ca104d46b8d6d9a4b951ff3f \u2514\u2500\u2500 system.journal \u4e0d\u8fc7\u9e1f\u54e5\u8bf4\u6ca1\u5fc5\u8981\u518d\u989d\u5916\u5b58\u50a8\u4e00\u4efd\u3002","title":"4.3 \u4fdd\u5b58 journal \u7684\u65b9\u5f0f"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#5","text":"last, lastlog, dmesg \u7b49\u6307\u4ee4\u63d0\u4f9b\u7684\u6570\u636e\u6bd4\u8f83\u5206\u6563\u3002\u4e86\u89e3\u7cfb\u7edf\u7684\u72b6\u6001\uff0c\u8fd8\u662f\u5f97\u8981\u5206\u6790\u6574\u4e2a\u65e5\u5fd7\u6587\u4ef6\u624d\u884c\u3002","title":"5. \u5206\u6790\u65e5\u5fd7\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#51-centos-logwatch","text":"\u6bcf\u5929\u5206\u6790\u4e00\u6b21\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u4e14\u5c06\u6570\u636e\u4ee5 email \u7684\u683c\u5f0f\u5bc4\u9001\u7ed9 root\u3002 \u5148\u5b89\u88c5\u55bd\uff1a [ root@dev ~ ] # yum install logwatch # \u5b89\u88c5\u5b8c\u6bd5\u4e4b\u540e\uff0c\u65e5\u7a0b\u4e0b\u9762\u5c31\u6709\u6587\u4ef6\u4e86 [ root@dev ~ ] # ll /etc/cron.daily/0logwatch -rwxr-xr-x. 1 root root 434 Aug 16 2018 /etc/cron.daily/0logwatch [ root@dev ~ ] # /etc/cron.daily/0logwatch [ root@dev ~ ] # mail \u2026\u2026 ################### Logwatch 7.4.0 (03/01/11) #################### Processing Initiated: Fri Nov 29 15 :18:29 2019 Date Range Processed: yesterday ( 2019 -Nov-28 ) Period is day. Detail Level of Output: 0 Type of Output/Format: mail / text Logfiles for Host: dev ################################################################## --------------------- pam_unix Begin ------------------------ su-l: Sessions Opened: root -> sink: 1 Time ( s ) sudo: Sessions Opened: root -> root: 1 Time ( s ) ---------------------- pam_unix End ------------------------- --------------------- Connections ( secure-log ) Begin ------------------------ **Unmatched Entries** --More--","title":"5.1 CentOS \u9884\u8bbe\u63d0\u4f9b\u7684 logwatch"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/22 \u65e5\u5fd7\u6587\u4ef6/#52","text":"\u4e0b\u8f7d\uff1a \u9e1f\u54e5\u7684\u4e0b\u8f7d\u5730\u5740 \u7b80\u4f53\u4e2d\u6587\u7248\u5730\u5740 [ root@dev ~ ] # tar -zxf logfile_centos7.tar.gz -C /","title":"5.2 \u9e1f\u54e5\u7684\u65e5\u5fd7\u6587\u4ef6\u5206\u6790\u5de5\u5177"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/","text":"\u52a0\u8f7d BIOS \u7684\u786c\u4ef6\u4fe1\u606f\u4e0e\u8fdb\u884c\u81ea\u6211\u6d4b\u8bd5\uff0c\u5e76\u4f9d\u636e\u8bbe\u5b9a\u53d6\u5f97\u7b2c\u4e00\u4e2a\u53ef\u5f00\u673a\u7684\u88c5\u7f6e\uff1b \u8bfb\u53d6\u5e76\u6267\u884c\u7b2c\u4e00\u4e2a\u5f00\u673a\u88c5\u7f6e\u5185 MBR \u7684 boot Loader (\u4ea6\u5373\u662f grub2\uff0c spfdisk \u7b49\u7a0b\u5e8f)\uff1b \u4f9d\u636e boot loader \u7684\u8bbe\u5b9a\u52a0\u8f7d Kernel \uff0cKernel \u4f1a\u5f00\u59cb\u4fa6\u6d4b\u786c\u4ef6\u4e0e\u52a0\u8f7d\u9a71\u52a8\u7a0b\u5e8f\uff1b \u5728\u786c\u4ef6\u9a71\u52a8\u6210\u529f\u540e\uff0cKernel \u4f1a\u4e3b\u52a8\u547c\u53eb systemd \u7a0b\u5e8f\uff0c\u5e76\u4ee5 default.target \u6d41\u7a0b\u5f00\u673a\uff1b systemd \u6267\u884c sysinit.target \u521d\u59cb\u5316\u7cfb\u7edf\u53ca basic.target \u51c6\u5907\u64cd\u4f5c\u7cfb\u7edf\uff1b systemd \u542f\u52a8 multi-user.target \u4e0b\u7684\u672c\u673a\u4e0e\u670d\u52a1\u5668\u670d\u52a1\uff1b systemd \u6267\u884c multi-user.target \u4e0b\u7684 /etc/rc.d/rc.local \u6587\u4ef6\uff1b systemd \u6267\u884c multi-user.target \u4e0b\u7684 getty.target \u53ca\u767b\u5165\u670d\u52a1\uff1b systemd \u6267\u884c graphical \u9700\u8981\u7684\u670d\u52a1 \u672c\u6587\u540d\u8bcd\u8bf4\u660e\uff1a BIOS\uff1a\u4e0d\u8bba\u4f20\u7edf BIOS \u8fd8\u662f UEFI BIOS \u90fd\u4f1a\u88ab\u7b80\u79f0\u4e3a BIOS\uff1b MBR\uff1a\u867d\u7136\u5206\u533a\u8868\u6709\u4f20\u7edf MBR \u4ee5\u53ca\u65b0\u5f0f GPT\uff0c\u4e0d\u8fc7 GPT \u4e5f\u6709\u4fdd\u7559\u4e00\u5757\u517c\u5bb9 MBR \u7684\u533a\u5757\uff0cMBR \u5c31\u4ee3\u8868\u8be5\u78c1\u76d8\u7684\u6700\u524d\u9762\u53ef\u5b89\u88c5 boot loader \u7684\u90a3\u4e2a\u533a\u5757\u3002 1. BIOS\uff0c boot loader \u4e0e kernel \u8f7d\u5165 \u00b6 1.1 BIOS\uff0c \u5f00\u673a\u81ea\u6211\u6d4b\u8bd5\u4e0e MBR/GPT \u00b6 \u5728\u4e2a\u4eba\u8ba1\u7b97\u673a\u67b6\u6784\u4e0b\uff0c\u4f60\u60f3\u8981\u542f\u52a8\u6574\u90e8\u7cfb\u7edf\u9996\u5148\u5c31\u5f97\u8981\u8ba9\u7cfb\u7edf\u53bb\u52a0\u8f7d BIOS (Basic Input Output System)\uff0c\u5e76\u900f\u8fc7 BIOS \u7a0b\u5e8f\u53bb\u52a0\u8f7d CMOS \u7684\u4fe1\u606f\uff0c\u5e76\u4e14\u85c9\u7531 CMOS \u5185\u7684\u8bbe\u5b9a\u503c\u53d6\u5f97\u4e3b\u673a\u7684\u5404\u9879\u786c\u4ef6\u914d\u7f6e\uff1b\u8fdb\u884c\u5f00\u673a\u81ea\u6211\u6d4b\u8bd5 (Power-on Self Test\uff0c POST) \u3002 \u7136\u540e\u5f00\u59cb\u6267\u884c\u786c\u4ef6\u4fa6\u6d4b\u7684\u521d\u59cb\u5316\uff0c\u5e76\u8bbe\u5b9a PnP \u88c5\u7f6e\uff0c\u4e4b\u540e\u518d\u5b9a\u4e49\u51fa\u53ef\u5f00\u673a\u7684\u88c5\u7f6e\u987a\u5e8f\uff0c\u63a5\u4e0b\u6765\u5c31\u4f1a\u5f00\u59cb\u8fdb\u884c\u5f00\u673a\u88c5\u7f6e\u7684\u6570\u636e\u8bfb\u53d6\u4e86\u3002 \u4f46\u7531\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4ed6\u7684\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u4e0d\u76f8\u540c\uff0c\u56e0\u6b64\u6211\u4eec\u5fc5\u987b\u8981\u4ee5\u4e00\u4e2a\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u6765\u5904\u7406\u5185\u6838\u6587\u4ef6\u52a0\u8f7d (load) \u7684\u95ee\u9898\uff0c\u5373 Boot Loader \u3002\u8be5\u7a0b\u5e8f\u5b89\u88c5\u5728\u5728\u5f00\u673a\u88c5\u7f6e\u7684\u7b2c\u4e00\u4e2a\u6247\u533a (sector) \u5185\uff0c\u5373 MBR (Master Boot Record\uff0c \u4e3b\u8981\u542f\u52a8\u8bb0\u5f55\u533a)\u3002 \u56e0\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u6709\u81ea\u5df1\u7684 boot loader \uff0c\u6240\u4ee5 BIOS \u662f\u900f\u8fc7\u786c\u4ef6\u7684 INT 13 \u4e2d\u65ad\u529f\u80fd\u6765\u8bfb\u53d6 MBR \u7684\u3002\u53ea\u8981 BIOS \u80fd\u591f\u68c0\u6d4b\u7684\u5230\u4f60\u7684\u78c1\u76d8\uff0c\u5b83\u5c31\u80fd\u8bfb\u53d6\u5230 boot loader \u5e76\u6267\u884c\u3002 Note \u6bcf\u9897\u786c\u76d8\u7684\u6700\u524d\u9762\u533a\u5757\u542b\u6709 MBR \u6216 GPT \u5206\u533a\u8868\u7684\u63d0\u4f9b loader \u7684\u533a\u5757\uff0c\u8bfb\u53d6\u54ea\u4e2a\u8981\u770bBIOS \u7684\u8bbe\u7f6e\u4e86\u3002\u7cfb\u7edf\u7684 MBR \u5176\u5b9e\u6307\u7684\u662f \u7b2c\u4e00\u4e2a\u5f00\u673a\u8bbe\u5907\u7684 MBR \u3002 1.2 Boot Loader \u7684\u529f\u80fd \u00b6 \u95ee\u9898\uff1a\u5fc5\u987b\u8981\u4f7f\u7528\u81ea\u5df1\u7684 loader \u624d\u80fd\u591f\u52a0\u8f7d\u5c5e\u4e8e\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff0c\u4f46\u662f\u7cfb\u7edf\u7684 MBR \u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u5b89\u88c5\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5462\uff1f \u5176\u5b9e\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf (filesystem\uff0c\u6216\u8005\u662f partition) \u90fd\u4f1a\u4fdd\u7559\u4e00\u5757\u542f\u52a8\u6247\u533a (boot sector) \u63d0\u4f9b\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5 boot loader \uff0c \u800c\u901a\u5e38\u64cd\u4f5c\u7cfb\u7edf\u9ed8\u8ba4\u90fd\u4f1a\u5b89\u88c5\u4e00\u4efd loader \u5230\u5b83\u6839\u76ee\u5f55\u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u7684 boot sector \u4e0a\u3002\u4e0b\u9762\u662f boot loader \u5b58\u653e\u793a\u610f\u56fe\uff1a \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u9ed8\u8ba4\u662f\u4f1a\u5b89\u88c5\u4e00\u5957 boot loader \u5230\u4ed6\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u5728 Linux \u7cfb\u7edf\u5b89\u88c5\u65f6\uff0c\u5c06 boot loader \u5b89\u88c5\u5230 MBR \u53bb\u662f\u53ef\u9009\u7684\uff1b\u5728 Windows \u5b89\u88c5\u65f6\uff0c\u4ed6\u9884\u8bbe\u4f1a\u4e3b\u52a8\u7684\u5c06 MBR \u4e0e boot sector \u90fd\u88c5\u4e0a\u4e00\u4efd\u3002boot loader \u4e3b\u8981\u7684\u529f\u80fd\u5982\u4e0b\uff1a \u63d0\u4f9b\u9009\u5355\uff1a\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u5f00\u673a\u9879\u76ee\uff0c\u8fd9\u4e5f\u662f\u591a\u91cd\u5f15\u5bfc\u7684\u91cd\u8981\u529f\u80fd\uff01 \u8f7d\u5165\u5185\u6838\u6587\u4ef6\uff1a\u76f4\u63a5\u6307\u5411\u53ef\u5f00\u673a\u7684\u7a0b\u5e8f\u533a\u6bb5\u6765\u5f00\u59cb\u64cd\u4f5c\u7cfb\u7edf\uff1b \u8f6c\u4ea4\u5176\u4ed6 loader\uff1a\u5c06\u5f00\u673a\u7ba1\u7406\u529f\u80fd\u8f6c\u4ea4\u7ed9\u5176\u4ed6 loader \u8d1f\u8d23\u3002 \u7531\u4e8e\u5177\u6709\u9009\u5355\u529f\u80fd\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u5185\u6838\u6765\u5f00\u673a\u3002\u800c\u7531\u4e8e\u5177\u6709\u63a7\u5236\u6743\u8f6c\u4ea4\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u52a0\u8f7d\u5176\u4ed6 boot sector \u5185\u7684 loader \u5566\uff01\u4e0d\u8fc7 Windows \u7684 loader \u9884\u8bbe\u4e0d\u5177\u6709\u63a7\u5236\u6743\u8f6c\u4ea4\u7684\u529f\u80fd \uff0c\u56e0\u6b64\u4f60\u4e0d\u80fd\u4f7f\u7528 Windows \u7684 loader \u6765\u52a0\u8f7d Linux \u7684 loader\uff01\u6240\u4ee5\u5728 \u5b89\u88c5\u591a\u91cd\u64cd\u4f5c\u7cfb\u7edf\u65f6\u5fc5\u987b\u8981\u5148\u5b89\u88c5Windows \uff01 \u6700\u7ec8 boot loader \u7684\u529f\u80fd\u5c31\u662f\u52a0\u8f7d kernel \u6587\u4ef6 \u5566\u3002 1.3 \u52a0\u8f7d\u5185\u6838\u68c0\u6d4b\u786c\u4ef6\u4e0e initramfs \u7684\u529f\u80fd \u00b6 \u85c9\u7531 boot loader \u7684\u7ba1\u7406\u800c\u5f00\u59cb\u8bfb\u53d6\u5185\u6838\u6587\u4ef6\u540e\uff0c\u63a5\u4e0b\u6765\uff0c Linux \u5c31\u4f1a\u5c06\u5185\u6838\u89e3\u538b\u7f29\u5230\u4e3b\u5b58\u50a8\u5668\u5f53\u4e2d\uff0c \u5e76\u4e14\u5229\u7528\u5185\u6838\u7684\u529f\u80fd\uff0c\u5f00\u59cb\u6d4b\u8bd5\u4e0e\u9a71\u52a8\u5404\u4e2a\u5468\u8fb9\u88c5\u7f6e\u3002\u6b64\u65f6 Linux \u5185\u6838\u4f1a\u4ee5\u81ea\u5df1\u7684\u529f\u80fd\u91cd\u65b0\u4fa6\u6d4b\u4e00\u6b21\u786c\u4ef6\uff0c\u800c\u4e0d\u4e00\u5b9a\u4f1a\u4f7f\u7528 BIOS \u4fa6\u6d4b\u5230\u7684\u786c\u4ef6\u4fe1\u606f\uff01\u4e5f\u5c31\u662f\u8bf4\uff0c \u5185\u6838\u6b64\u65f6\u5f00\u59cb\u63a5\u7ba1 BIOS \u540e\u7684\u5de5\u4f5c \u4e86\u3002 \u5185\u6838\u6587\u4ef6 /boot/vmlinuz \uff1a [ sink@dev ~ ] $ ls -1 /boot/ config-3.10.0-1062.el7.x86_64 # \u6b64\u7248\u672c\u5185\u6838\u88ab\u7f16\u8bd1\u65f6\u9009\u62e9\u7684\u529f\u80fd\u4e0e\u6a21\u5757\u914d\u7f6e\u6587\u4ef6 efi extlinux grub # \u65e7\u7248 grub\uff0c\u4e0d\u7ba1\u5b83 grub2 # \u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f grub2 \u76f8\u5173\u6570\u636e\u76ee\u5f55 initramfs-0-rescue-0242c388ca104d46b8d6d9a4b951ff3f.img # \u6551\u63f4\u7528\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u6587\u4ef6 initramfs-3.10.0-1062.el7.x86_64.img # \u6b63\u5e38\u5f00\u673a\u4f1a\u7528\u5230\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf initramfs-3.10.0-1062.el7.x86_64kdump.img # \u5185\u6838\u51fa\u95ee\u9898\u65f6\u4f1a\u7528\u5230\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf initrd-plymouth.img symvers-3.10.0-1062.el7.x86_64.gz System.map-3.10.0-1062.el7.x86_64 # \u5185\u6838\u529f\u80fd\u653e\u7f6e\u5230\u5185\u5b58\u5730\u5740\u7684\u5bf9\u5e94\u8868 vmlinuz-0-rescue-0242c388ca104d46b8d6d9a4b951ff3f # \u6551\u63f4\u7528\u7684\u5185\u6838\u6587\u4ef6 vmlinuz-3.10.0-1062.el7.x86_64 # \u5185\u6838\u6587\u4ef6 Linux \u5185\u6838\u662f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684(\u5c31\u8bf7\u60f3\u6210\u9a71\u52a8\u7a0b\u5e8f\u5373\u53ef)\uff0c\u8fd9\u4e9b\u5185\u6838\u6a21\u5757\u5c31\u653e\u7f6e\u5728 /lib/modules/ \u76ee\u5f55\u5185\u3002\u7531\u4e8e\u6a21\u5757\u653e\u7f6e\u5230\u78c1\u76d8\u6839\u76ee\u5f55\u5185 (\u8981\u8bb0\u5f97 /lib \u4e0d\u53ef\u4ee5\u4e0e / \u5206\u522b\u653e\u5728\u4e0d\u540c\u7684 partition !)\uff0c \u56e0\u6b64\u5728\u5f00\u673a\u7684\u8fc7\u7a0b\u4e2d \u5185\u6838\u5fc5\u987b\u8981\u6302\u8f7d\u6839\u76ee\u5f55\uff0c\u8fd9\u6837\u624d\u80fd\u591f\u8bfb\u53d6\u5185\u6838\u6a21\u5757\u63d0\u4f9b\u52a0\u8f7d\u9a71\u52a8\u7a0b\u5e8f \u7684\u529f\u80fd\u3002 \u800c\u4e14\u4e3a\u4e86\u62c5\u5fc3\u5f71\u54cd\u5230\u78c1\u76d8\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u56e0\u6b64\u5f00\u673a\u8fc7\u7a0b\u4e2d\u6839\u76ee\u5f55\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6765\u6302\u8f7d\u7684\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u975e\u5fc5\u8981\u7684\u529f\u80fd\u4e14\u53ef\u4ee5\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\u7684\u5185\u6838\u529f\u80fd\uff0c\u76ee\u524d\u7684 Linux distributions \u90fd\u4f1a\u5c06\u4ed6\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\u3002\u56e0\u6b64 USB\uff0c SATA\uff0c SCSI... \u7b49\u78c1\u76d8\u88c5\u7f6e\u7684\u9a71\u52a8\u7a0b\u5e8f\u901a\u5e38\u90fd\u662f\u4ee5\u6a21\u5757\u7684\u65b9\u5f0f\u6765\u5b58\u5728\u7684 \u3002 \u95ee\u9898\u662f\uff0c\u5185\u6838\u6839\u672c\u4e0d\u8ba4\u8bc6 SATA \u78c1\u76d8\uff0c\u6240\u4ee5\u9700\u8981\u52a0\u8f7d SATA \u78c1\u76d8\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c \u5426\u5219\u6839\u672c\u5c31\u65e0\u6cd5\u6302\u8f7d\u6839\u76ee\u5f55\u3002\u4f46\u662f SATA \u7684\u9a71\u52a8\u7a0b\u5e8f\u5728 /lib/modules \u5185\uff0c\u4f60\u6839\u672c\u65e0\u6cd5\u6302\u8f7d\u6839\u76ee\u5f55\u53c8\u600e\u4e48\u8bfb\u53d6\u5230 /lib/modules/ \u5185\u7684\u9a71\u52a8\u7a0b\u5e8f\uff1f\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u65b9\u6cd5\u5c31\u662f\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u3002 \u865a\u62df\u6587\u4ef6\u7cfb\u7edf (Initial RAM Disk \u6216 Initial RAM Filesystem) \u4e00\u822c\u4f7f\u7528\u7684\u6587\u4ef6\u540d\u4e3a /boot/initrd \u6216 /boot/initramfs \u3002\u4e5f\u80fd\u591f\u900f\u8fc7 boot loader \u6765\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u8fd9\u4e2a\u6587\u4ef6\u4f1a\u88ab\u89e3\u538b\u7f29\u5e76\u4e14 \u5728\u5185\u5b58\u5f53\u4e2d\u4eff\u771f\u6210\u4e00\u4e2a\u6839\u76ee\u5f55 \uff0c \u4e14\u6b64\u4eff\u771f\u5728\u5185\u5b58\u5f53\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u80fd\u591f\u63d0\u4f9b\u4e00\u652f\u53ef\u6267\u884c\u7684\u7a0b\u5e8f\uff0c\u900f\u8fc7\u8be5\u7a0b\u5e8f\u6765\u52a0\u8f7d\u5f00\u673a\u8fc7\u7a0b\u4e2d\u6240\u6700\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\uff0c \u901a\u5e38\u8fd9\u4e9b\u6a21\u5757\u5c31\u662f USB\uff0c RAID\uff0c LVM\uff0cSCSI \u7b49\u6587\u4ef6\u7cfb\u7edf\u4e0e\u78c1\u76d8\u63a5\u53e3\u7684\u9a71\u52a8\u7a0b\u5e8f\u5566\uff01\u7b49\u8f7d\u5165\u5b8c\u6210\u540e\uff0c \u4f1a\u5e2e\u52a9\u5185\u6838\u91cd\u65b0\u547c\u53eb systemd \u6765\u5f00\u59cb\u540e\u7eed\u7684\u6b63\u5e38\u5f00\u673a\u6d41\u7a0b \u3002 \u66f4\u8be6\u7ec6\u7684 initramfs \u8bf4\u660e\uff0c\u4f7f\u7528 man initrd \u67e5\u9605\u3002 initramfs \u6587\u4ef6\u5185\u5bb9\uff1a [ root@dev boot ] $ lsinitrd initramfs-3.10.0-1062.el7.x86_64.img # \u6570\u636e\u4ecb\u7ecd\uff0c\u4f1a\u5360\u7528\u5bb9\u91cf Image: initramfs-3.10.0-1062.el7.x86_64.img: 31M ======================================================================== Early CPIO image ======================================================================== drwxr-xr-x 3 root root 0 Oct 22 16 :19 . -rw-r--r-- 1 root root 2 Oct 22 16 :19 early_cpio drwxr-xr-x 3 root root 0 Oct 22 16 :19 kernel drwxr-xr-x 3 root root 0 Oct 22 16 :19 kernel/x86 drwxr-xr-x 2 root root 0 Oct 22 16 :19 kernel/x86/microcode -rw-r--r-- 1 root root 100352 Oct 22 16 :19 kernel/x86/microcode/GenuineIntel.bin ======================================================================== Version: dracut-033-564.el7 Arguments: -f # \u6240\u6709\u7684\u6a21\u5757 dracut modules: bash nss-softokn i18n \u2026\u2026 shutdown ======================================================================== # \u6240\u6709\u7684\u6587\u4ef6 drwxr-xr-x 12 root root 0 Oct 22 16 :19 . crw-r--r-- 1 root root 5 , 1 Oct 22 16 :19 dev/console crw-r--r-- 1 root root 1 , 11 Oct 22 16 :19 dev/kmsg crw-r--r-- 1 root root 1 , 3 Oct 22 16 :19 dev/null lrwxrwxrwx 1 root root 7 Oct 22 16 :19 bin -> usr/bin \u2026\u2026 lrwxrwxrwx 1 root root 23 Oct 22 16 :19 init -> usr/lib/systemd/systemd lrwxrwxrwx 1 root root 9 Oct 22 16 :19 lib64 -> usr/lib64 lrwxrwxrwx 1 root root 7 Oct 22 16 :19 lib -> usr/lib \u2026\u2026 drwxr-xr-x 2 root root 0 Oct 22 16 :19 usr/lib/dracut/hooks/mount drwxr-xr-x 2 root root 0 Oct 22 16 :19 usr/lib/dracut/hooks/netroot \u2026\u2026 lrwxrwxrwx 1 root root 6 Oct 22 16 :19 var/run -> ../run ======================================================================== \u89e3\u538b\u67e5\u770b\u5185\u5bb9\uff1a [ root@dev boot ] # mkdir /tmp/initramfs [ root@dev boot ] # cd /tmp/initramfs [ root@dev initramfs ] # cp /boot/initramfs-3.10.0-1062.el7.x86_64.img . [ root@dev initramfs ] # file initramfs-3.10.0-1062.el7.x86_64.img initramfs-3.10.0-1062.el7.x86_64.img: ASCII cpio archive ( SVR4 with no CRC ) [ root@dev initramfs ] # cpio -i -d -H newc --no-absolute-filenames < initramfs-3.10.0-1062.el7.x86_64.img 198 blocks [ root@dev initramfs ] # ll # \u8fd9\u91cc\u5c31\u5bf9\u5e94\u4e86 lsinitrd \u5217\u51fa\u4fe1\u606f\u7684\u524d\u4e09\u90e8\u5206 total 31188 -rw-r--r--. 1 root root 2 Dec 5 16 :10 early_cpio -rw-------. 1 root root 31929564 Dec 5 16 :10 initramfs-3.10.0-1062.el7.x86_64.img drwxr-xr-x. 3 root root 17 Dec 5 16 :10 kernel \u8981\u60f3\u771f\u6b63\u5730\u89e3\u538b initramfs.img \uff0c\u5c31\u8981\u5148\u53bb\u6389\u53bb\u9664\u524d\u9762\u4e0d\u9700\u8981\u7684\u6587\u4ef6\u5934\u6570\u636e\u90e8\u4efd\uff1a \u8ba1\u7b97\u504f\u79fb\u91cf\u7684\u65b9\u6cd5\uff1a \u65b9\u6cd5\u4e00\uff1a\u5176\u5b9e initramfs.img \u662fcpio\u6253\u5305\u7684gzip\u683c\u5f0f\u7684\u6587\u4ef6\uff0cgzip\u6587\u4ef6\u538b\u7f29\u7684\u53c8\u662fcpio\u6253\u5305\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u9700\u8981\u77e5\u9053gzip\u6587\u4ef6\u5728\u6700\u5916\u5c42\u7684cpio\u6587\u4ef6\u7684\u504f\u79fb\u91cf\u3002\u800cgzip\u683c\u5f0f\u7684\u6587\u4ef6\u5f00\u5934\u5b57\u8282\u662f 0x1f 0x8b 0x08 \uff0c\u6240\u4ee5\u53ea\u8981\u67e5\u627e\u51fa\u8fd9\u51e0\u4e2a\u5b57\u8282\u7684\u504f\u79fb\u91cf\u5373\u53ef\u3002 # \u547d\u4ee4\u4e00\u3002\u6bcf\u4e00\u4e2a\u5355\u5143\u4ee3\u8868\u4e00\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u504f\u79fb\u91cf\u662f 101376 + 0 = 101376 # -t \u8f93\u51fa\u683c\u5f0f\uff0cx1 \u8868\u793a\u6bcf\u4e2a\u6574\u6570\u53601\u4e2a\u5b57\u8282\uff0c-A \u6587\u4ef6\u504f\u79fb\u91cf\u683c\u5f0f\uff0cd \u8868\u793a\u4f7f\u7528\u5e26\u7b26\u53f7\u7684\u5341\u8fdb\u5236 [ root@dev initramfs ] # od -t x1 -A d initramfs-3.10.0-1062.el7.x86_64.img | grep \"1f 8b 08\" 0101376 1f 8b 08 00 9e bb ae 5d 02 03 9c bd 07 5c 13 4d # \u547d\u4ee4\u4e8c\u3002\u6bcf\u4e00\u4e2a\u5355\u5143\u4ee3\u8868\u4e00\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u504f\u79fb\u91cf\u662f 0018c00(\u5341\u516d\u8fdb\u5236) = 101376(\u5341\u8fdb\u5236) [ root@dev initramfs ] # xxd -g 1 initramfs-3.10.0-1062.el7.x86_64.img | grep \"1f 8b 08\" 0018c00: 1f 8b 08 00 9e bb ae 5d 02 03 9c bd 07 5c 13 4d ....... ] ..... \\. M ^C \u65b9\u6cd5\u4e8c\uff1a\u83b7\u53d6kernel\u76ee\u5f55\u4e0b\u7684\u90a3\u4e2a\u6587\u4ef6\u5927\u5c0f\uff0c\u7136\u540e\u52a0\u4e0a1024\uff0c\u5373\u5f97\u5230\u504f\u79fb\u91cf\u3002\u770b\u51fa\u6765\u7684\u89c4\u5f8b\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u3002//TODO # \u9996\u5148\u8ba1\u7b97\u51fa\u504f\u79fb\u91cf\u4e3a 0101376 [ root@dev initramfs ] # dd if=initramfs-3.10.0-1062.el7.x86_64.img of=initramfs.gz bs=0101376 skip=1 [ root@dev initramfs ] # file initramfs.gz initramfs.gz: gzip compressed data, from Unix, last modified: Tue Oct 22 16 :19:42 2019 , max compression [ root@dev initramfs ] # mkdir initramfs && mv initramfs.gz initramfs/ && cd initramfs/ # \u5148\u7528 gzip \u89e3\u538b [ root@dev initramfs ] # gzip -d initramfs.gz # \u89e3\u538b\u51fa\u6765\u4e00\u4e2a cpio \u6587\u4ef6 [ root@dev initramfs ] # ll total 64348 -rw-r--r--. 1 root root 65891328 Dec 5 16 :57 initramfs [ root@dev initramfs ] # file initramfs initramfs: ASCII cpio archive ( SVR4 with no CRC ) # \u518d\u7528 cpio \u89e3\u538b [ root@dev initramfs ] # cpio -i -d -F initramfs --no-absolute-filenames -c [ root@dev initramfs ] # ll total 64356 lrwxrwxrwx. 1 root root 7 Dec 5 17 :10 bin -> usr/bin drwxr-xr-x. 2 root root 45 Dec 5 17 :10 dev drwxr-xr-x. 12 root root 4096 Dec 5 17 :10 etc lrwxrwxrwx. 1 root root 23 Dec 5 17 :10 init -> usr/lib/systemd/systemd -rw-r--r--. 1 root root 65891328 Dec 5 16 :57 initramfs # \u8fd9\u662f\u539f\u6587\u4ef6 lrwxrwxrwx. 1 root root 7 Dec 5 17 :10 lib -> usr/lib lrwxrwxrwx. 1 root root 9 Dec 5 17 :10 lib64 -> usr/lib64 drwxr-xr-x. 2 root root 6 Dec 5 17 :10 proc drwxr-xr-x. 2 root root 6 Dec 5 17 :10 root drwxr-xr-x. 2 root root 6 Dec 5 17 :10 run lrwxrwxrwx. 1 root root 8 Dec 5 17 :10 sbin -> usr/sbin -rwxr-xr-x. 1 root root 3117 Dec 5 17 :10 shutdown drwxr-xr-x. 2 root root 6 Dec 5 17 :10 sys drwxr-xr-x. 2 root root 6 Dec 5 17 :10 sysroot drwxr-xr-x. 2 root root 6 Dec 5 17 :10 tmp drwxr-xr-x. 7 root root 66 Dec 5 17 :10 usr drwxr-xr-x. 2 root root 29 Dec 5 17 :10 var \u6574\u4e2a\u6587\u4ef6\u5939\u5c31\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6839\u76ee\u5f55\uff0c\u8fd9\u6837kernel\u5c31\u80fd\u6302\u8f7d\u4e86\u3002 # \u770b\u770b\u9ed8\u8ba4\u7684\u64cd\u4f5c\u73af\u5883\uff0c\u6307\u5411\u7684\u5c31\u662f initrd.target [ root@dev initramfs ] # ll usr/lib/systemd/system/default.target lrwxrwxrwx. 1 root root 13 Dec 6 08 :40 usr/lib/systemd/system/default.target -> initrd.target initrd.target \u4e5f\u662f\u9700\u8981\u8bfb\u5165\u4e00\u5806\u4f8b\u5982 basic.target\uff0c sysinit.target \u7b49\u7b49\u7684\u786c\u4ef6\u68c0\u6d4b\u3001\u5185\u6838\u529f\u80fd\u542f\u7528\u7684\u6d41\u7a0b\uff0c \u7136\u540e\u5f00\u59cb\u8ba9\u7cfb\u7edf\u987a\u5229\u8fd0\u4f5c\u3002 \u6700\u7ec8\u624d\u53c8\u5378\u8f7d initramfs \u7684\u5c0f\u578b\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b9e\u9645\u6302\u8f7d\u7cfb\u7edf\u7684\u6839\u76ee\u5f55 \u3002 \u540c\u7406\uff0c\u76f4\u63a5\u5c06\u5f00\u673a\u6240\u9700\u6a21\u5757\u7f16\u8bd1\u5230\u5185\u6838\u4e2d\uff0c\u4e5f\u80fd\u987a\u5229\u542f\u52a8\u4e86\u3002 2. \u7b2c\u4e00\u4e2a\u7a0b\u5e8f systemd \u53ca\u4f7f\u7528 default.target \u8fdb\u5165\u5f00\u673a\u7a0b\u5e8f\u5206\u6790 \u00b6 systemd \u6700\u4e3b\u8981\u7684\u529f\u80fd\u5c31\u662f\u51c6\u5907\u8f6f\u4ef6\u6267\u884c\u7684\u73af\u5883\uff0c\u5305\u62ec\u7cfb\u7edf\u7684\u4e3b\u673a\u540d\u3001\u7f51\u7edc\u8bbe\u5b9a\u3001\u8bed\u7cfb\u5904\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u53ca\u5176\u4ed6\u670d\u52a1\u7684\u542f\u52a8\u7b49\u3002 \u800c\u6240\u6709\u7684\u52a8\u4f5c\u90fd\u4f1a\u900f\u8fc7 systemd \u7684\u9ed8\u8ba4\u542f\u52a8\u670d\u52a1\u96c6\u5408\uff0c\u4ea6\u5373\u662f /etc/systemd/system/default.target \u6765\u89c4\u5212\u3002 2.1 \u517c\u5bb9\u4e8e runlevel \u7684\u7b49\u7ea7 \u00b6 systemd \u4e3a\u4e86\u517c\u5bb9\u4e8e\u65e7\u5f0f\u7684 system V \u64cd\u4f5c\u884c\u4e3a, \u6240\u4ee5\u4e5f\u5c06 runlevel \u4e0e\u64cd\u4f5c\u73af\u5883\u505a\u4e86\u7ed3\u5408\uff1a [ root@dev ~ ] # ll /usr/lib/systemd/system/runlevel?.target lrwxrwxrwx. 1 root root 15 Oct 22 16 :01 /usr/lib/systemd/system/runlevel0.target -> poweroff.target lrwxrwxrwx. 1 root root 13 Oct 22 16 :01 /usr/lib/systemd/system/runlevel1.target -> rescue.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel2.target -> multi-user.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel3.target -> multi-user.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel4.target -> multi-user.target lrwxrwxrwx. 1 root root 16 Oct 22 16 :01 /usr/lib/systemd/system/runlevel5.target -> graphical.target lrwxrwxrwx. 1 root root 13 Oct 22 16 :01 /usr/lib/systemd/system/runlevel6.target -> reboot.target \u5207\u6362\u6267\u884c\u7b49\u7ea7\u53ef\u4ee5\u4f7f\u7528 init <number> \u6765\u6267\u884c\uff0c\u4f8b\u5982\uff1a init 3 \uff0c\u76f8\u5f53\u4e8e systemctl isolate multi-user.target \u3002 2.2 systemd \u7684\u5904\u7406\u6d41\u7a0b \u00b6 CentOS 7.x \u7684 systemd \u5f00\u673a\u6d41\u7a0b\u5927\u7ea6\u662f\u8fd9\u6837\uff1a local-fs.target + swap.target\uff1a\u8fd9\u4e24\u4e2a target \u4e3b\u8981\u5728\u6302\u8f7d\u672c\u673a /etc/fstab \u91cc\u9762\u6240\u89c4\u8303\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0e\u76f8\u5173\u7684\u5185\u5b58\u4ea4\u6362\u7a7a\u95f4\u3002 sysinit.target\uff1a\u8fd9\u4e2a target \u4e3b\u8981\u5728\u4fa6\u6d4b\u786c\u4ef6\uff0c\u52a0\u8f7d\u6240\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\u7b49\u52a8\u4f5c\u3002 basic.target\uff1a\u52a0\u8f7d\u4e3b\u8981\u7684\u5916\u90e8\u786c\u4ef6\u9a71\u52a8\u7a0b\u5e8f\u4e0e\u9632\u706b\u5899\u76f8\u5173\u4efb\u52a1 multi-user.target \u5e95\u4e0b\u7684\u5176\u5b83\u4e00\u822c\u7cfb\u7edf\u6216\u7f51\u7edc\u670d\u52a1\u7684\u52a0\u8f7d \u56fe\u5f62\u754c\u9762\u76f8\u5173\u670d\u52a1\u5982 gdm.service \u7b49\u5176\u4ed6\u670d\u52a1\u7684\u52a0\u8f7d \u4e0b\u9762\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e9btarget\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff0c\u8be6\u7ec6\u7684\u670d\u52a1\u8fd8\u662f\u6839\u636e\u914d\u7f6e\u7684\u4f9d\u8d56\u5173\u7cfb\u67e5\u770b\u5427\uff0c systemctl list-dependencies xxx \u3002 2.2.1 sysinit.target \u521d\u59cb\u5316\u7cfb\u7edf\u3001basic.target \u51c6\u5907\u7cfb\u7edf \u00b6 2.2.1.1 sysinit.target \u5927\u81f4\u5185\u5bb9 \u00b6 - \u7279\u6b8a\u6587\u4ef6\u7cfb\u7edf\u88c5\u7f6e\u7684\u6302\u8f7d\uff1a\u5305\u62ec dev-hugepages.mount dev-mqueue.mount \u7b49\u6302\u8f7d\u670d\u52a1\uff0c\u4e3b\u8981\u5728\u6302\u8f7d\u8ddf\u5de8\u91cf\u5185\u5b58\u5206\u9875\u4f7f\u7528\u4e0e\u6d88\u606f\u961f\u5217\u7684\u529f\u80fd\u3002 \u6302\u8f7d\u6210\u529f\u540e\uff0c\u4f1a\u5728 /dev \u5e95\u4e0b\u5efa\u7acb /dev/hugepages/\uff0c /dev/mqueue/ \u7b49\u76ee\u5f55; \u00b6 \u7279\u6b8a\u6587\u4ef6\u7cfb\u7edf\u7684\u542f\u7528\uff1a\u5305\u62ec\u78c1\u76d8\u9635\u5217\u3001\u7f51\u7edc\u9a71\u52a8\u5668 (iscsi)\u3001LVM \u6587\u4ef6\u7cfb\u7edf\u3001\u6587\u4ef6\u7cfb\u7edf\u5bf9\u7167\u670d\u52a1 (multipath)\u7b49\u7b49\uff0c\u4e5f\u4f1a\u5728\u8fd9\u91cc\u88ab\u4fa6\u6d4b\u4e0e\u4f7f\u7528\u5230\uff01 - \u5f00\u673a\u8fc7\u7a0b\u7684\u8baf\u606f\u4f20\u9012\u4e0e\u52a8\u753b\u6267\u884c\uff1a\u4f7f\u7528 plymouthd \u670d\u52a1\u642d\u914d plymouth \u6307\u4ee4\u6765\u4f20\u9012\u52a8\u753b\u4e0e\u8baf\u606f - \u65e5\u5fd7\u5f0f\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\u7684\u4f7f\u7528\uff1a\u5c31\u662f systemd-journald \u8fd9\u4e2a\u670d\u52a1\u7684\u542f\u7528\u554a\uff01 - \u52a0\u8f7d\u989d\u5916\u7684\u5185\u6838\u6a21\u5757\uff1a\u900f\u8fc7 /etc/modules-load.d/*.conf \u6587\u4ef6\u7684\u8bbe\u5b9a\uff0c\u8ba9\u5185\u6838\u989d\u5916\u52a0\u8f7d\u7ba1\u7406\u5458\u6240\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\uff01 - \u52a0\u8f7d\u989d\u5916\u7684\u5185\u6838\u53c2\u6570\u8bbe\u5b9a\uff1a\u5305\u62ec /etc/sysctl.conf \u4ee5\u53ca /etc/sysctl.d/*.conf \u5185\u90e8\u8bbe\u5b9a\uff01 - \u542f\u52a8\u7cfb\u7edf\u7684\u968f\u673a\u6570\u751f\u6210\u5668\uff1a\u968f\u673a\u6570\u751f\u6210\u5668\u53ef\u4ee5\u5e2e\u52a9\u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u5bc6\u7801\u52a0\u5bc6\u6f14\u7b97\u7684\u529f\u80fd - \u8bbe\u5b9a\u7ec8\u7aef\u673a (console) \u5b57\u5f62 - \u542f\u52a8\u52a8\u6001\u8bbe\u5907\u7ba1\u7406\u5668\uff1a\u5c31\u662f udevd \u8fd9\u4e2a\u5bb6\u4f19\uff01\u7528\u5728\u52a8\u6001\u5bf9\u5e94\u5b9e\u9645\u88c5\u7f6e\u5b58\u53d6\u4e0e\u88c5\u7f6e\u6587\u4ef6\u540d\u5bf9\u5e94\u7684\u4e00\u4e2a\u670d\u52a1\uff01\u76f8\u5f53\u91cd\u8981\u5594\uff01\u4e5f\u662f\u5728\u8fd9\u91cc\u542f\u52a8\u7684\uff01 2.2.1.2 basic.target \u5927\u81f4\u5185\u5bb9 \u00b6 sysinit.target \u5728\u521d\u59cb\u5316\u7cfb\u7edf\uff0c\u800c\u8fd9\u4e2a basic .target \u5219\u662f\u4e00\u4e2a\u6700\u7b80\u964b\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e86\u3002 \u52a0\u8f7d alsa \u97f3\u6548\u9a71\u52a8\u7a0b\u5e8f\uff1a\u8fd9\u4e2a alsa \u662f\u4e2a\u97f3\u6548\u76f8\u5173\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4f1a\u8ba9\u4f60\u7684\u7cfb\u7edf\u6709\u97f3\u6548\u4ea7\u751f\u5570\uff1b \u8f7d\u5165 firewalld \u9632\u706b\u5899\uff1aCentOS 7.x \u4ee5\u540e\u4f7f\u7528 firewalld \u53d6\u4ee3 iptables \u7684\u9632\u706b\u5899\u8bbe\u5b9a\uff0c\u867d\u7136\u6700\u7ec8\u90fd\u662f\u4f7f\u7528 iptables \u7684\u67b6\u6784\uff0c \u4e0d\u8fc7\u5728\u8bbe\u5b9a\u4e0a\u9762\u5dee\u5f88\u591a\u5594\uff01 \u52a0\u8f7d CPU \u7684\u5fae\u6307\u4ee4\u529f\u80fd\uff1b \u542f\u52a8\u4e0e\u8bbe\u5b9a SELinux \u7684\u5b89\u5168\u672c\u6587\uff1a\u5982\u679c\u7531 disable \u7684\u72b6\u6001\u6539\u6210 enable \u7684\u72b6\u6001\uff0c\u6216\u8005\u662f\u7ba1\u7406\u5458\u8bbe\u5b9a\u5f3a\u5236\u91cd\u65b0\u8bbe\u5b9a\u4e00\u6b21 SELinux \u7684\u5b89\u5168\u672c\u6587\uff0c \u4e5f\u5728\u8fd9\u4e2a\u9636\u6bb5\u5904\u7406\u5594\uff01 \u5c06\u76ee\u524d\u7684\u5f00\u673a\u8fc7\u7a0b\u6240\u4ea7\u751f\u7684\u5f00\u673a\u4fe1\u606f\u5199\u5165\u5230 /var/log/dmesg \u5f53\u4e2d \u7531 /etc/sysconfig/modules/*.modules \u53ca /etc/rc.modules \u52a0\u8f7d\u7ba1\u7406\u5458\u6307\u5b9a\u7684\u6a21\u5757\uff01 \u52a0\u8f7d systemd \u652f\u6301\u7684 timer \u529f\u80fd 2.2.2 \u542f\u52a8 multi-user.target \u4e0b\u7684\u670d\u52a1 \u00b6 basic.target \u8ba9\u7cfb\u7edf\u6210\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u7840\uff0c\u4e4b\u540e\u5c31\u662f\u670d\u52a1\u5668\u8981\u987a\u5229\u8fd0\u4f5c\u65f6\uff0c\u9700\u8981\u7684\u5404\u79cd\u4e3b\u673a\u670d\u52a1\u4ee5\u53ca\u63d0\u4f9b\u670d\u52a1\u5668\u529f\u80fd\u7684\u7f51\u7edc\u670d\u52a1\u7684\u542f\u52a8\u4e86\u3002\u8fd9\u4e9b\u670d\u52a1\u7684\u542f\u52a8\u5219\u5927\u591a\u662f\u9644\u6302\u5728 multi-user.target \u8fd9\u4e2a\u64cd\u4f5c\u73af\u5883\u5e95\u4e0b\u3002 2.2.2.1 \u517c\u5bb9 systemV \u7684 rc-local.service \u00b6 \u5728\u4ee5\u524d\u7684\u7248\u672c\u4e2d\uff0c\u5f53\u7cfb\u7edf\u5b8c\u6210\u5f00\u673a\u540e\u8fd8\u60f3\u8981\u8ba9\u7cfb\u7edf\u989d\u5916\u6267\u884c\u67d0\u4e9b\u7a0b\u5e8f\u7684\u8bdd\uff0c\u53ef\u4ee5\u5c06\u8be5\u7a0b\u5e8f\u6307\u4ee4\u6216\u811a\u672c\u7684\u7edd\u5bf9\u8def\u5f84\u540d\u79f0\u5199\u5165\u5230 /etc/rc.d/rc.local \u8fd9\u4e2a\u6587\u4ef6\u53bb\uff01\u65b0\u7684 systemd \u673a\u5236\u4e2d\uff0c\u5b83\u5efa\u8bae\u76f4\u63a5\u5199\u4e00\u4e2a systemd \u7684\u542f\u52a8\u811a\u672c\u914d\u7f6e\u6587\u4ef6\u5230 /etc/systemd/system \u5e95\u4e0b\uff0c\u7136\u540e\u4f7f\u7528systemctl enable \u7684\u65b9\u5f0f\u6765\u8bbe\u5b9a\u542f\u7528\u5b83\uff0c\u800c\u4e0d\u8981\u76f4\u63a5\u4f7f\u7528 rc.local \u8fd9\u4e2a\u6587\u4ef6\u3002 [ sink@dev boot ] $ cat /etc/rc.d/rc.local #!/bin/bash # THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES # # It is highly advisable to create own systemd services or udev rules # to run scripts during boot instead of using this file. # # In contrast to previous versions due to parallel execution during boot # this script will NOT be run after all other services. # # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure # that this script will be executed during boot. touch /var/lock/subsys/local 2.2.2.2 \u63d0\u4f9b tty \u754c\u9762\u4e0e\u767b\u5165\u7684\u670d\u52a1 \u00b6 \u7531\u4e8e\u670d\u52a1\u90fd\u662f\u540c\u6b65\u8fd0\u4f5c\uff0c\u4e0d\u4e00\u5b9a\u54ea\u4e2a\u670d\u52a1\u5148\u542f\u52a8\u5b8c\u6bd5\u3002\u5982\u679c getty \u670d\u52a1\u5148\u542f\u52a8\u5b8c\u6bd5\u65f6\uff0c\u4f60\u4f1a\u53d1\u73b0\u5230\u6709\u53ef\u7528\u7684\u7ec8\u7aef\u673a\u5c1d\u8bd5\u8ba9\u4f60\u767b\u5165\u7cfb\u7edf\u4e86\u3002 \u95ee\u9898\u662f\uff0c\u5982\u679c systemd-logind.service \u6216 systemd-user-sessions.service \u670d\u52a1\u5c1a\u672a\u6267\u884c\u5b8c\u6bd5\u7684\u8bdd\uff0c\u90a3\u4e48\u4f60\u8fd8\u662f\u65e0\u6cd5\u767b\u5165\u7cfb\u7edf\u7684\u3002 2.2.3 \u542f\u52a8 graphical.target \u4e0b\u7684\u670d\u52a1 \u00b6 [ sink@dev ~ ] $ systemctl list-dependencies graphical.target graphical.target \u25cf \u251c\u2500accounts-daemon.service \u25cf \u251c\u2500gdm.service # \u8ba9\u7528\u6237\u53ef\u4ee5\u5229\u7528\u56fe\u5f62\u754c\u9762\u767b\u5165\u7684\u6700\u91cd\u8981\u670d\u52a1 \u25cf \u251c\u2500network.service \u25cf \u251c\u2500rtkit-daemon.service \u25cf \u251c\u2500systemd-readahead-collect.service \u25cf \u251c\u2500systemd-readahead-replay.service \u25cf \u251c\u2500systemd-update-utmp-runlevel.service \u25cf \u2514\u2500multi-user.target \u25cf \u251c\u2500abrt-ccpp.service \u25cf \u251c\u2500abrt-oops.service 3. \u5f00\u673a\u8fc7\u7a0b\u4f1a\u7528\u5230\u7684\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6 \u00b6 systemd \u6709\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u5904\u7406\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u4e3a\u4e86\u517c\u5bb9\u4e8e systemV ,\u5176\u5b9e\u5f88\u591a\u7684\u670d\u52a1\u811a\u672c\u8bbe\u5b9a\u8fd8\u662f\u4f1a\u8bfb\u53d6\u4f4d\u4e8e /etc/sysconfig/ \u5e95\u4e0b\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u3002 3.1 \u6a21\u5757\u914d\u7f6e\u6587\u4ef6 \u00b6 sysinit.target \u4e2d\u6709\u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u6a21\u5757\u7684\u5730\u65b9\uff1a /etc/modules-load.d/*.conf \uff1a\u5355\u7eaf\u8981\u5185\u6838\u52a0\u8f7d\u6a21\u5757\u7684\u4f4d\u7f6e\uff1b /etc/modprobe.d/*.conf \uff1a\u53ef\u4ee5\u52a0\u4e0a\u6a21\u5757\u53c2\u6570\u7684\u4f4d\u7f6e\u3002 systemd \u5728\u5f00\u673a\u65f6\u5df2\u7ecf\u628a\u9700\u8981\u7684\u9a71\u52a8\u90fd\u52a0\u8f7d\u4e86\uff0c\u57fa\u672c\u4e0a\u65e0\u9700\u6539\u52a8\u3002\u5982\u679c\u4f60\u6709\u67d0\u4e9b\u7279\u5b9a\u7684\u53c2\u6570\u8981\u5904\u7406\u65f6\uff0c\u624d\u9700\u8981\u5728\u8fd9\u91cc\u505a\u4e00\u4e9b\u5904\u7406\u3002 \u4e0b\u9762\u662f\u9e1f\u54e5\u4e3e\u7684\u4e00\u4e2a\u4f8b\u5b50\u3002 \u5728\u524d\u6587\u4e2d\u6211\u4eec\u5411 vdftpd de\u7aef\u53e3\u6539\u6210\u4e86 555\uff0c\u5176\u4e2d\u4e00\u4e2a\u9488\u5bf9 FTP \u5f88\u91cd\u8981\u7684\u9632\u706b\u5899\u6a21\u5757\u4e3a nf_conntrack_ftp \uff0c\u4f60\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6a21\u5757\u5199\u5165\u5230\u7cfb\u7edf\u5f00\u673a\u6d41\u7a0b\u4e2d\uff1a [ root@dev ~ ] # cat /etc/modules-load.d/sink.conf nf_conntrack_ftp \u4e00\u4e2a\u6a21\u5757 (\u9a71\u52a8\u7a0b\u5e8f) \u5199\u4e00\u884c\u3002\u4e0a\u8ff0\u7684\u6a21\u5757\u57fa\u672c\u4e0a\u662f\u9488\u5bf9\u9ed8\u8ba4 FTP \u7aef\u53e3 21 \u6240\u8bbe\u5b9a\u7684\uff0c\u5982\u679c\u9700\u8981\u8c03\u6574\u5230 port 555 \u7684\u8bdd\uff0c\u5f97\u5728\u53e6\u4e00\u4e2a\u76ee\u5f55\u4e0b\u5916\u5e26\u53c2\u6570\u624d\u884c\uff1a [ root@dev ~ ] # cat /etc/modprobe.d/sink.conf options nf_conntrack_ftp ports = 555 \u4e4b\u540e\u91cd\u65b0\u542f\u52a8\u5c31\u80fd\u591f\u987a\u5229\u7684\u8f7d\u5165\u5e76\u4e14\u5904\u7406\u597d\u8fd9\u4e2a\u6a21\u5757\u4e86\u3002\u90a3\u4e48\u975e\u91cd\u542f\u7684\u65b9\u6cd5\u662f\u4ec0\u4e48\u5462\uff1a [ root@dev ~ ] # lsmod | grep nf_conntrack_ftp [ root@dev ~ ] # systemctl restart systemd-modules-load.service [ root@dev ~ ] # lsmod | grep nf_conntrack_ftp nf_conntrack_ftp 18478 0 nf_conntrack 139224 8 nf_nat,nf_nat_ipv4,nf_nat_ipv6,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_ftp,nf_conntrack_ipv4,nf_conntrack_ipv6 3.2 \u5176\u5b83\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6 \u00b6 \u8fd9\u4e9b\u6587\u4ef6\u90fd\u5728 /etc/sysconfig/ \u76ee\u5f55\u4e0b\uff1a authconfig \u8fd9\u4e2a\u6587\u4ef6\u4e3b\u8981\u5728\u89c4\u8303\u4f7f\u7528\u8005\u7684\u8eab\u4efd\u8ba4\u8bc1\u7684\u673a\u5236\uff0c\u5305\u62ec\u662f\u5426\u4f7f\u7528\u672c\u673a\u7684 /etc/passwd\uff0c /etc/shadow \u7b49\uff0c \u4ee5\u53ca /etc/shadow \u5bc6\u7801\u8bb0\u5f55\u4f7f\u7528\u4f55\u79cd\u52a0\u5bc6\u7b97\u6cd5\uff0c\u8fd8\u6709\u662f\u5426\u4f7f\u7528\u5916\u90e8\u5bc6\u7801\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u8d26\u53f7\u9a8c\u8bc1 (NIS, LDAP) \u7b49\u3002\u4f7f\u7528 authconfig-tui \u6765\u4fee\u6539\u3002 cpupower cpupower.service \u670d\u52a1\u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4e3b\u8981\u662f Linux \u5185\u6838\u5982\u4f55\u64cd\u4f5c CPU \u7684\u89c4\u5219\u3002 \u4e00\u822c\u6765\u8bf4,\u542f\u52a8 cpupower.service \u4e4b\u540e\uff0c\u7cfb\u7edf\u4f1a\u8ba9 CPU \u4ee5\u6700\u5927\u6548\u80fd\u7684\u65b9\u5f0f\u6765\u8fd0\u4f5c\uff0c\u5426\u5219\u9884\u8bbe\u5c31\u662f\u7528\u591a\u5c11\u7b97\u591a\u5c11\u7684\u6a21\u5f0f\u6765\u5904\u7406\u7684\u3002 firewalld, iptables-config, iptables-config, ebtables-config \u9632\u706b\u5899\u670d\u52a1\u3002\u53c2\u8003\u670d\u52a1\u5668\u7bc7\u3002 network-scripts/ \u8bbe\u5b9a\u7f51\u5361\u3002\u53c2\u8003\u670d\u52a1\u5668\u7bc7\u3002 4. \u5185\u6838\u4e0e\u5185\u6838\u6a21\u5757 \u00b6 \u5728\u4e0a\u6587\u4e2d\u63d0\u5230\uff0c\u5728\u6574\u4e2a\u5f00\u673a\u7684\u8fc7\u7a0b\u5f53\u4e2d\uff0c\u662f\u5426\u80fd\u591f\u6210\u529f\u7684\u9a71\u52a8\u6211\u4eec\u4e3b\u673a\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u662f\u5185\u6838 (kernel) \u7684\u5de5\u4f5c\u3002\u76ee\u524d\u7684\u5185\u6838\u90fd\u5177\u6709 modules (\u6a21\u5757\u5316) \u7684\u529f\u80fd\u3002 \u5185\u6838\u4e0e\u5185\u6838\u6a21\u5757\u7684\u4f4d\u7f6e\uff1a \u5185\u6838\uff1a /boot/vmlinuz \u6216 /boot/vmlinuz-version\uff1b \u5185\u6838\u89e3\u538b\u7f29\u6240\u9700 RAM Disk\uff1a /boot/initramfs (/boot/initramfs-version)\uff1b \u5185\u6838\u6a21\u5757\uff1a /lib/modules/version/kernel \u6216 /lib/modules/$(uname -r)/kernel\uff1b \u5185\u6838\u539f\u7801\uff1a /usr/src/linux \u6216 /usr/src/kernels/ (\u8981\u5b89\u88c5\u624d\u4f1a\u6709,\u9884\u8bbe\u4e0d\u5b89\u88c5)\u3002 \u5982\u679c\u8be5\u5185\u6838\u88ab\u987a\u5229\u7684\u52a0\u8f7d\u7cfb\u7edf\u5f53\u4e2d\u4e86,\u90a3\u4e48\u5c31\u4f1a\u6709\u51e0\u4e2a\u4fe1\u606f\u7eaa\u5f55\u4e0b\u6765: \u5185\u6838\u7248\u672c\uff1a/proc/version \u7cfb\u7edf\u5185\u6838\u529f\u80fd\uff1a/proc/sys/kernel/ \u5982\u679c\u6709\u4e2a\u65b0\u7684\u786c\u4ef6\uff0c\u8ba9\u7cfb\u7edf\u652f\u6301\u7684\u4e24\u79cd\u65b9\u6cd5\uff1a \u91cd\u65b0\u7f16\u8bd1\u5185\u6838,\u5e76\u52a0\u5165\u6700\u65b0\u7684\u786c\u4ef6\u9a71\u52a8\u7a0b\u5e8f\u539f\u59cb\u7801\uff1b \u5c06\u8be5\u786c\u4ef6\u7684\u9a71\u52a8\u7a0b\u5e8f\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\uff0c\u5728\u5f00\u673a\u65f6\u52a0\u8f7d\u8be5\u6a21\u5757\u3002 \u5173\u4e8e\u7f16\u8bd1\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53c2\u8003\u540e\u7eed\u7ae0\u8282\u3002\u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5982\u4f55\u52a0\u8f7d\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6a21\u5757\u3002 4.1 \u5185\u6838\u6a21\u5757\u4e0e\u4f9d\u8d56 \u00b6 \u5185\u6838\u6a21\u5757\u4e00\u822c\u653e\u5728 /lib/modules/$(uname -r)/kernel \u76ee\u5f55\u4e0b\uff1a [ root@dev ~ ] # ls -1 /lib/modules/$(uname -r)/kernel/ arch # \u4e0e\u786c\u4ef6\u5e73\u53f0\u6709\u5173\u7684\u9879\u76ee,\u4f8b\u5982 CPU \u7684\u7b49\u7ea7\u7b49\u7b49 crypto # \u5185\u6838\u6240\u652f\u6301\u7684\u52a0\u5bc6\u7684\u6280\u672f,\u4f8b\u5982 md5 \u6216\u8005\u662f des \u7b49\u7b49 drivers # \u4e00\u4e9b\u786c\u4ef6\u7684\u9a71\u52a8\u7a0b\u5e8f fs # \u5185\u6838\u6240\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf kernel lib # \u4e00\u4e9b\u51fd\u6570\u5e93; mm net # \u4e0e\u7f51\u7edc\u6709\u5173\u7684\u5404\u9879\u534f\u8bae\u6570\u636e,\u8fd8\u6709\u9632\u706b\u5899\u6a21\u5757 (net/ipv4/netfilter/*) \u7b49\u7b49; sound # \u4e0e\u97f3\u6548\u6709\u5173\u7684\u5404\u9879\u6a21\u5757; virt /lib/modules/$(uname -r)/modules.dep \u6587\u4ef6\u8bb0\u5f55\u4e86\u5728\u5185\u6838\u652f\u6301\u7684\u6a21\u5757\u7684\u5404\u9879\u4f9d\u8d56\u3002\u5229\u7528 depmod \u8fd9\u4e2a\u6307\u4ee4\u5c31\u53ef\u4ee5\u5efa\u7acb\u8be5\u6587\u4ef6\uff1a depmod - [ aA ] [ options ] [ forced_version ] \u8f93\u51fa\u9002\u7528\u4e8e modprobe \u7684\u4f9d\u8d56\u5217\u8868 \u4e0d\u52a0\u4efb\u4f55\u9009\u9879\u7b49\u540c\u4e8e\u201c depmod - a \u201d Options : - a , -- all Probe all modules \uff0c\u5e76\u5199\u5165\u5230\u6587\u4ef6\u4e2d - A , -- quick \u627e\u5230\u65b0\u6a21\u5757\u624d\u66f4\u65b0\u6587\u4ef6 - n , -- show \u4e0d\u5199\u5165 modules . dep ,\u800c\u662f\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a ( standard out ) - e , -- errsyms \u663e\u793a\u51fa\u76ee\u524d\u5df2\u52a0\u8f7d\u7684\u4e0d\u53ef\u6267\u884c\u7684\u6a21\u5757\u540d\u79f0 \u82e5\u6211\u505a\u597d\u4e00\u4e2a\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f a.ko \uff0c\u8be5\u5982\u4f55\u66f4\u65b0\u6838\u5fc3\u7684\u4f9d\u8d56\uff1a cp a.ko /lib/modules/ $( uname -r ) /kernel/drivers/net depmod 4.2 \u5185\u6838\u6a21\u5757\u7684\u67e5\u770b \u00b6 \u5217\u51fa\u6a21\u5757\u3001\u5927\u5c0f\u3001\u4f9d\u8d56\uff1a [ root@dev ~ ] # lsmod # \u540d\u5b57 \u5927\u5c0f \u6b64\u6a21\u5757\u662f\u5426\u88ab\u5176\u4ed6\u6a21\u5757\u6240\u4f7f\u7528 Module Size Used by nf_conntrack_ftp 18478 0 tcp_lp 12663 0 llc 14552 2 stp,bridge \u2026\u2026 \u67e5\u770b\u5177\u4f53\u7684\u67d0\u4e2a\u6a21\u5757\u7684\u4fe1\u606f\uff1a modinfo [ options ] filename [ args ] filename \u53ef\u4ee5\u662f\u6a21\u5757\u540d\u5b57\u6216\u6a21\u5757\u6587\u4ef6 Options : - a , --author Print only 'author' - d , --description Print only 'description' - l , --license Print only 'license' - p , --parameters Print only 'parm' - n , --filename Print only 'filename' - F , --field=FIELD Print only provided FIELD [ root@dev ~ ] # modinfo fuse filename: /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fuse/fuse.ko.xz alias: devname:fuse alias: char-major-10-229 alias: fs-fuseblk alias: fs-fuse license: GPL description: Filesystem in Userspace \u2026\u2026 # \u67e5\u770b\u81ea\u5df1\u7684\u6a21\u5757\u4fe1\u606f [ root@dev ~ ] # modinfo a.ko 4.3 \u5185\u6838\u6a21\u5757\u7684\u52a0\u8f7d\u4e0e\u79fb\u9664 \u00b6 \u6709\u4e24\u4e2a\u52a0\u8f7d\u6a21\u5757\u7684\u547d\u4ee4\uff1a modprobe\uff1a\u4f1a\u4e3b\u52a8\u7684\u53bb\u641c\u5bfb modules.dep \u7684\u5185\u5bb9\uff0c\u5148\u89e3\u51b3\u6a21\u5757\u7684\u4f9d\u8d56\u540e\uff0c \u624d\u51b3\u5b9a\u9700\u8981\u52a0\u8f7d\u7684\u6a21\u5757\u6709\u54ea\u4e9b\uff0c\u5f88\u65b9\u4fbf\u3002 insmod\uff1a\u5b8c\u5168\u7531\u4f7f\u7528\u8005\u81ea\u884c\u52a0\u8f7d\u4e00\u4e2a \u5b8c\u6574\u6587\u4ef6\u540d \u7684\u6a21\u5757\uff0c \u5e76\u4e0d\u4f1a\u4e3b\u52a8\u7684\u5206\u6790\u6a21\u5757\u7684\u4f9d\u8d56\u3002 [ root@dev ~ ] # lsmod | grep fat # \u52a0\u8f7d [ root@dev ~ ] # insmod /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fat/fat.ko.xz [ root@dev ~ ] # lsmod | grep fat fat 65950 0 # \u79fb\u9664 [ root@dev ~ ] # rmmod /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fat/fat.ko.xz \u4f7f\u7528 insmod \u4e0e rmmod \u7684\u95ee\u9898\u5c31\u662f\uff0c\u4f60\u5fc5\u987b\u8981\u81ea\u884c\u627e\u5230\u6a21\u5757\u7684\u5b8c\u6574\u6587\u4ef6\u540d\u624d\u884c\uff0c\u800c\u4e14\u4e07\u4e00\u6a21\u5757\u6709\u4f9d\u8d56\u6027\u95ee\u9898\uff0c\u4f60\u5c06\u65e0\u6cd5\u76f4\u63a5\u52a0\u8f7d\u6216\u79fb\u9664\u8be5\u6a21\u5757\u3002 modprobe [ options ] modulename Management Options : - r , -- remove Remove modules instead of inserting - f , -- force Force module insertion or removal . Query Options : - c , -- showconfig Print out known configuration and exit General Options : - n , -- dry - run Do not execute operations , just print out [ root@dev ~ ] # modprobe fat [ root@dev ~ ] # lsmod | grep fat fat 65950 0 [ root@dev ~ ] # modprobe -r fat \u771f\u662f\u6bd4 insmod \u65b9\u4fbf\u591a\u4e86\uff01 \u81f3\u4e8e\u6a21\u5757\u7684\u9009\u9879\u6307\u5b9a\u53c2\u8003\u4e0a\u6587\u55bd\u3002","title":"23 \u5f00\u673a\u6d41\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#1-bios-boot-loader-kernel","text":"","title":"1. BIOS\uff0c boot loader \u4e0e kernel \u8f7d\u5165"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#11-bios-mbrgpt","text":"\u5728\u4e2a\u4eba\u8ba1\u7b97\u673a\u67b6\u6784\u4e0b\uff0c\u4f60\u60f3\u8981\u542f\u52a8\u6574\u90e8\u7cfb\u7edf\u9996\u5148\u5c31\u5f97\u8981\u8ba9\u7cfb\u7edf\u53bb\u52a0\u8f7d BIOS (Basic Input Output System)\uff0c\u5e76\u900f\u8fc7 BIOS \u7a0b\u5e8f\u53bb\u52a0\u8f7d CMOS \u7684\u4fe1\u606f\uff0c\u5e76\u4e14\u85c9\u7531 CMOS \u5185\u7684\u8bbe\u5b9a\u503c\u53d6\u5f97\u4e3b\u673a\u7684\u5404\u9879\u786c\u4ef6\u914d\u7f6e\uff1b\u8fdb\u884c\u5f00\u673a\u81ea\u6211\u6d4b\u8bd5 (Power-on Self Test\uff0c POST) \u3002 \u7136\u540e\u5f00\u59cb\u6267\u884c\u786c\u4ef6\u4fa6\u6d4b\u7684\u521d\u59cb\u5316\uff0c\u5e76\u8bbe\u5b9a PnP \u88c5\u7f6e\uff0c\u4e4b\u540e\u518d\u5b9a\u4e49\u51fa\u53ef\u5f00\u673a\u7684\u88c5\u7f6e\u987a\u5e8f\uff0c\u63a5\u4e0b\u6765\u5c31\u4f1a\u5f00\u59cb\u8fdb\u884c\u5f00\u673a\u88c5\u7f6e\u7684\u6570\u636e\u8bfb\u53d6\u4e86\u3002 \u4f46\u7531\u4e8e\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u4ed6\u7684\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u4e0d\u76f8\u540c\uff0c\u56e0\u6b64\u6211\u4eec\u5fc5\u987b\u8981\u4ee5\u4e00\u4e2a\u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f\u6765\u5904\u7406\u5185\u6838\u6587\u4ef6\u52a0\u8f7d (load) \u7684\u95ee\u9898\uff0c\u5373 Boot Loader \u3002\u8be5\u7a0b\u5e8f\u5b89\u88c5\u5728\u5728\u5f00\u673a\u88c5\u7f6e\u7684\u7b2c\u4e00\u4e2a\u6247\u533a (sector) \u5185\uff0c\u5373 MBR (Master Boot Record\uff0c \u4e3b\u8981\u542f\u52a8\u8bb0\u5f55\u533a)\u3002 \u56e0\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u6709\u81ea\u5df1\u7684 boot loader \uff0c\u6240\u4ee5 BIOS \u662f\u900f\u8fc7\u786c\u4ef6\u7684 INT 13 \u4e2d\u65ad\u529f\u80fd\u6765\u8bfb\u53d6 MBR \u7684\u3002\u53ea\u8981 BIOS \u80fd\u591f\u68c0\u6d4b\u7684\u5230\u4f60\u7684\u78c1\u76d8\uff0c\u5b83\u5c31\u80fd\u8bfb\u53d6\u5230 boot loader \u5e76\u6267\u884c\u3002 Note \u6bcf\u9897\u786c\u76d8\u7684\u6700\u524d\u9762\u533a\u5757\u542b\u6709 MBR \u6216 GPT \u5206\u533a\u8868\u7684\u63d0\u4f9b loader \u7684\u533a\u5757\uff0c\u8bfb\u53d6\u54ea\u4e2a\u8981\u770bBIOS \u7684\u8bbe\u7f6e\u4e86\u3002\u7cfb\u7edf\u7684 MBR \u5176\u5b9e\u6307\u7684\u662f \u7b2c\u4e00\u4e2a\u5f00\u673a\u8bbe\u5907\u7684 MBR \u3002","title":"1.1 BIOS\uff0c \u5f00\u673a\u81ea\u6211\u6d4b\u8bd5\u4e0e MBR/GPT"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#12-boot-loader","text":"\u95ee\u9898\uff1a\u5fc5\u987b\u8981\u4f7f\u7528\u81ea\u5df1\u7684 loader \u624d\u80fd\u591f\u52a0\u8f7d\u5c5e\u4e8e\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\uff0c\u4f46\u662f\u7cfb\u7edf\u7684 MBR \u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u4e48\u8be5\u5982\u4f55\u5b89\u88c5\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5462\uff1f \u5176\u5b9e\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf (filesystem\uff0c\u6216\u8005\u662f partition) \u90fd\u4f1a\u4fdd\u7559\u4e00\u5757\u542f\u52a8\u6247\u533a (boot sector) \u63d0\u4f9b\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5 boot loader \uff0c \u800c\u901a\u5e38\u64cd\u4f5c\u7cfb\u7edf\u9ed8\u8ba4\u90fd\u4f1a\u5b89\u88c5\u4e00\u4efd loader \u5230\u5b83\u6839\u76ee\u5f55\u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u7684 boot sector \u4e0a\u3002\u4e0b\u9762\u662f boot loader \u5b58\u653e\u793a\u610f\u56fe\uff1a \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u9ed8\u8ba4\u662f\u4f1a\u5b89\u88c5\u4e00\u5957 boot loader \u5230\u4ed6\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u5728 Linux \u7cfb\u7edf\u5b89\u88c5\u65f6\uff0c\u5c06 boot loader \u5b89\u88c5\u5230 MBR \u53bb\u662f\u53ef\u9009\u7684\uff1b\u5728 Windows \u5b89\u88c5\u65f6\uff0c\u4ed6\u9884\u8bbe\u4f1a\u4e3b\u52a8\u7684\u5c06 MBR \u4e0e boot sector \u90fd\u88c5\u4e0a\u4e00\u4efd\u3002boot loader \u4e3b\u8981\u7684\u529f\u80fd\u5982\u4e0b\uff1a \u63d0\u4f9b\u9009\u5355\uff1a\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u5f00\u673a\u9879\u76ee\uff0c\u8fd9\u4e5f\u662f\u591a\u91cd\u5f15\u5bfc\u7684\u91cd\u8981\u529f\u80fd\uff01 \u8f7d\u5165\u5185\u6838\u6587\u4ef6\uff1a\u76f4\u63a5\u6307\u5411\u53ef\u5f00\u673a\u7684\u7a0b\u5e8f\u533a\u6bb5\u6765\u5f00\u59cb\u64cd\u4f5c\u7cfb\u7edf\uff1b \u8f6c\u4ea4\u5176\u4ed6 loader\uff1a\u5c06\u5f00\u673a\u7ba1\u7406\u529f\u80fd\u8f6c\u4ea4\u7ed9\u5176\u4ed6 loader \u8d1f\u8d23\u3002 \u7531\u4e8e\u5177\u6709\u9009\u5355\u529f\u80fd\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u7684\u5185\u6838\u6765\u5f00\u673a\u3002\u800c\u7531\u4e8e\u5177\u6709\u63a7\u5236\u6743\u8f6c\u4ea4\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u52a0\u8f7d\u5176\u4ed6 boot sector \u5185\u7684 loader \u5566\uff01\u4e0d\u8fc7 Windows \u7684 loader \u9884\u8bbe\u4e0d\u5177\u6709\u63a7\u5236\u6743\u8f6c\u4ea4\u7684\u529f\u80fd \uff0c\u56e0\u6b64\u4f60\u4e0d\u80fd\u4f7f\u7528 Windows \u7684 loader \u6765\u52a0\u8f7d Linux \u7684 loader\uff01\u6240\u4ee5\u5728 \u5b89\u88c5\u591a\u91cd\u64cd\u4f5c\u7cfb\u7edf\u65f6\u5fc5\u987b\u8981\u5148\u5b89\u88c5Windows \uff01 \u6700\u7ec8 boot loader \u7684\u529f\u80fd\u5c31\u662f\u52a0\u8f7d kernel \u6587\u4ef6 \u5566\u3002","title":"1.2 Boot Loader \u7684\u529f\u80fd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#13-initramfs","text":"\u85c9\u7531 boot loader \u7684\u7ba1\u7406\u800c\u5f00\u59cb\u8bfb\u53d6\u5185\u6838\u6587\u4ef6\u540e\uff0c\u63a5\u4e0b\u6765\uff0c Linux \u5c31\u4f1a\u5c06\u5185\u6838\u89e3\u538b\u7f29\u5230\u4e3b\u5b58\u50a8\u5668\u5f53\u4e2d\uff0c \u5e76\u4e14\u5229\u7528\u5185\u6838\u7684\u529f\u80fd\uff0c\u5f00\u59cb\u6d4b\u8bd5\u4e0e\u9a71\u52a8\u5404\u4e2a\u5468\u8fb9\u88c5\u7f6e\u3002\u6b64\u65f6 Linux \u5185\u6838\u4f1a\u4ee5\u81ea\u5df1\u7684\u529f\u80fd\u91cd\u65b0\u4fa6\u6d4b\u4e00\u6b21\u786c\u4ef6\uff0c\u800c\u4e0d\u4e00\u5b9a\u4f1a\u4f7f\u7528 BIOS \u4fa6\u6d4b\u5230\u7684\u786c\u4ef6\u4fe1\u606f\uff01\u4e5f\u5c31\u662f\u8bf4\uff0c \u5185\u6838\u6b64\u65f6\u5f00\u59cb\u63a5\u7ba1 BIOS \u540e\u7684\u5de5\u4f5c \u4e86\u3002 \u5185\u6838\u6587\u4ef6 /boot/vmlinuz \uff1a [ sink@dev ~ ] $ ls -1 /boot/ config-3.10.0-1062.el7.x86_64 # \u6b64\u7248\u672c\u5185\u6838\u88ab\u7f16\u8bd1\u65f6\u9009\u62e9\u7684\u529f\u80fd\u4e0e\u6a21\u5757\u914d\u7f6e\u6587\u4ef6 efi extlinux grub # \u65e7\u7248 grub\uff0c\u4e0d\u7ba1\u5b83 grub2 # \u5f00\u673a\u7ba1\u7406\u7a0b\u5e8f grub2 \u76f8\u5173\u6570\u636e\u76ee\u5f55 initramfs-0-rescue-0242c388ca104d46b8d6d9a4b951ff3f.img # \u6551\u63f4\u7528\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u6587\u4ef6 initramfs-3.10.0-1062.el7.x86_64.img # \u6b63\u5e38\u5f00\u673a\u4f1a\u7528\u5230\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf initramfs-3.10.0-1062.el7.x86_64kdump.img # \u5185\u6838\u51fa\u95ee\u9898\u65f6\u4f1a\u7528\u5230\u7684\u865a\u62df\u6587\u4ef6\u7cfb\u7edf initrd-plymouth.img symvers-3.10.0-1062.el7.x86_64.gz System.map-3.10.0-1062.el7.x86_64 # \u5185\u6838\u529f\u80fd\u653e\u7f6e\u5230\u5185\u5b58\u5730\u5740\u7684\u5bf9\u5e94\u8868 vmlinuz-0-rescue-0242c388ca104d46b8d6d9a4b951ff3f # \u6551\u63f4\u7528\u7684\u5185\u6838\u6587\u4ef6 vmlinuz-3.10.0-1062.el7.x86_64 # \u5185\u6838\u6587\u4ef6 Linux \u5185\u6838\u662f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684(\u5c31\u8bf7\u60f3\u6210\u9a71\u52a8\u7a0b\u5e8f\u5373\u53ef)\uff0c\u8fd9\u4e9b\u5185\u6838\u6a21\u5757\u5c31\u653e\u7f6e\u5728 /lib/modules/ \u76ee\u5f55\u5185\u3002\u7531\u4e8e\u6a21\u5757\u653e\u7f6e\u5230\u78c1\u76d8\u6839\u76ee\u5f55\u5185 (\u8981\u8bb0\u5f97 /lib \u4e0d\u53ef\u4ee5\u4e0e / \u5206\u522b\u653e\u5728\u4e0d\u540c\u7684 partition !)\uff0c \u56e0\u6b64\u5728\u5f00\u673a\u7684\u8fc7\u7a0b\u4e2d \u5185\u6838\u5fc5\u987b\u8981\u6302\u8f7d\u6839\u76ee\u5f55\uff0c\u8fd9\u6837\u624d\u80fd\u591f\u8bfb\u53d6\u5185\u6838\u6a21\u5757\u63d0\u4f9b\u52a0\u8f7d\u9a71\u52a8\u7a0b\u5e8f \u7684\u529f\u80fd\u3002 \u800c\u4e14\u4e3a\u4e86\u62c5\u5fc3\u5f71\u54cd\u5230\u78c1\u76d8\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u56e0\u6b64\u5f00\u673a\u8fc7\u7a0b\u4e2d\u6839\u76ee\u5f55\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6765\u6302\u8f7d\u7684\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u975e\u5fc5\u8981\u7684\u529f\u80fd\u4e14\u53ef\u4ee5\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\u7684\u5185\u6838\u529f\u80fd\uff0c\u76ee\u524d\u7684 Linux distributions \u90fd\u4f1a\u5c06\u4ed6\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\u3002\u56e0\u6b64 USB\uff0c SATA\uff0c SCSI... \u7b49\u78c1\u76d8\u88c5\u7f6e\u7684\u9a71\u52a8\u7a0b\u5e8f\u901a\u5e38\u90fd\u662f\u4ee5\u6a21\u5757\u7684\u65b9\u5f0f\u6765\u5b58\u5728\u7684 \u3002 \u95ee\u9898\u662f\uff0c\u5185\u6838\u6839\u672c\u4e0d\u8ba4\u8bc6 SATA \u78c1\u76d8\uff0c\u6240\u4ee5\u9700\u8981\u52a0\u8f7d SATA \u78c1\u76d8\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c \u5426\u5219\u6839\u672c\u5c31\u65e0\u6cd5\u6302\u8f7d\u6839\u76ee\u5f55\u3002\u4f46\u662f SATA \u7684\u9a71\u52a8\u7a0b\u5e8f\u5728 /lib/modules \u5185\uff0c\u4f60\u6839\u672c\u65e0\u6cd5\u6302\u8f7d\u6839\u76ee\u5f55\u53c8\u600e\u4e48\u8bfb\u53d6\u5230 /lib/modules/ \u5185\u7684\u9a71\u52a8\u7a0b\u5e8f\uff1f\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u65b9\u6cd5\u5c31\u662f\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u3002 \u865a\u62df\u6587\u4ef6\u7cfb\u7edf (Initial RAM Disk \u6216 Initial RAM Filesystem) \u4e00\u822c\u4f7f\u7528\u7684\u6587\u4ef6\u540d\u4e3a /boot/initrd \u6216 /boot/initramfs \u3002\u4e5f\u80fd\u591f\u900f\u8fc7 boot loader \u6765\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u8fd9\u4e2a\u6587\u4ef6\u4f1a\u88ab\u89e3\u538b\u7f29\u5e76\u4e14 \u5728\u5185\u5b58\u5f53\u4e2d\u4eff\u771f\u6210\u4e00\u4e2a\u6839\u76ee\u5f55 \uff0c \u4e14\u6b64\u4eff\u771f\u5728\u5185\u5b58\u5f53\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u80fd\u591f\u63d0\u4f9b\u4e00\u652f\u53ef\u6267\u884c\u7684\u7a0b\u5e8f\uff0c\u900f\u8fc7\u8be5\u7a0b\u5e8f\u6765\u52a0\u8f7d\u5f00\u673a\u8fc7\u7a0b\u4e2d\u6240\u6700\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\uff0c \u901a\u5e38\u8fd9\u4e9b\u6a21\u5757\u5c31\u662f USB\uff0c RAID\uff0c LVM\uff0cSCSI \u7b49\u6587\u4ef6\u7cfb\u7edf\u4e0e\u78c1\u76d8\u63a5\u53e3\u7684\u9a71\u52a8\u7a0b\u5e8f\u5566\uff01\u7b49\u8f7d\u5165\u5b8c\u6210\u540e\uff0c \u4f1a\u5e2e\u52a9\u5185\u6838\u91cd\u65b0\u547c\u53eb systemd \u6765\u5f00\u59cb\u540e\u7eed\u7684\u6b63\u5e38\u5f00\u673a\u6d41\u7a0b \u3002 \u66f4\u8be6\u7ec6\u7684 initramfs \u8bf4\u660e\uff0c\u4f7f\u7528 man initrd \u67e5\u9605\u3002 initramfs \u6587\u4ef6\u5185\u5bb9\uff1a [ root@dev boot ] $ lsinitrd initramfs-3.10.0-1062.el7.x86_64.img # \u6570\u636e\u4ecb\u7ecd\uff0c\u4f1a\u5360\u7528\u5bb9\u91cf Image: initramfs-3.10.0-1062.el7.x86_64.img: 31M ======================================================================== Early CPIO image ======================================================================== drwxr-xr-x 3 root root 0 Oct 22 16 :19 . -rw-r--r-- 1 root root 2 Oct 22 16 :19 early_cpio drwxr-xr-x 3 root root 0 Oct 22 16 :19 kernel drwxr-xr-x 3 root root 0 Oct 22 16 :19 kernel/x86 drwxr-xr-x 2 root root 0 Oct 22 16 :19 kernel/x86/microcode -rw-r--r-- 1 root root 100352 Oct 22 16 :19 kernel/x86/microcode/GenuineIntel.bin ======================================================================== Version: dracut-033-564.el7 Arguments: -f # \u6240\u6709\u7684\u6a21\u5757 dracut modules: bash nss-softokn i18n \u2026\u2026 shutdown ======================================================================== # \u6240\u6709\u7684\u6587\u4ef6 drwxr-xr-x 12 root root 0 Oct 22 16 :19 . crw-r--r-- 1 root root 5 , 1 Oct 22 16 :19 dev/console crw-r--r-- 1 root root 1 , 11 Oct 22 16 :19 dev/kmsg crw-r--r-- 1 root root 1 , 3 Oct 22 16 :19 dev/null lrwxrwxrwx 1 root root 7 Oct 22 16 :19 bin -> usr/bin \u2026\u2026 lrwxrwxrwx 1 root root 23 Oct 22 16 :19 init -> usr/lib/systemd/systemd lrwxrwxrwx 1 root root 9 Oct 22 16 :19 lib64 -> usr/lib64 lrwxrwxrwx 1 root root 7 Oct 22 16 :19 lib -> usr/lib \u2026\u2026 drwxr-xr-x 2 root root 0 Oct 22 16 :19 usr/lib/dracut/hooks/mount drwxr-xr-x 2 root root 0 Oct 22 16 :19 usr/lib/dracut/hooks/netroot \u2026\u2026 lrwxrwxrwx 1 root root 6 Oct 22 16 :19 var/run -> ../run ======================================================================== \u89e3\u538b\u67e5\u770b\u5185\u5bb9\uff1a [ root@dev boot ] # mkdir /tmp/initramfs [ root@dev boot ] # cd /tmp/initramfs [ root@dev initramfs ] # cp /boot/initramfs-3.10.0-1062.el7.x86_64.img . [ root@dev initramfs ] # file initramfs-3.10.0-1062.el7.x86_64.img initramfs-3.10.0-1062.el7.x86_64.img: ASCII cpio archive ( SVR4 with no CRC ) [ root@dev initramfs ] # cpio -i -d -H newc --no-absolute-filenames < initramfs-3.10.0-1062.el7.x86_64.img 198 blocks [ root@dev initramfs ] # ll # \u8fd9\u91cc\u5c31\u5bf9\u5e94\u4e86 lsinitrd \u5217\u51fa\u4fe1\u606f\u7684\u524d\u4e09\u90e8\u5206 total 31188 -rw-r--r--. 1 root root 2 Dec 5 16 :10 early_cpio -rw-------. 1 root root 31929564 Dec 5 16 :10 initramfs-3.10.0-1062.el7.x86_64.img drwxr-xr-x. 3 root root 17 Dec 5 16 :10 kernel \u8981\u60f3\u771f\u6b63\u5730\u89e3\u538b initramfs.img \uff0c\u5c31\u8981\u5148\u53bb\u6389\u53bb\u9664\u524d\u9762\u4e0d\u9700\u8981\u7684\u6587\u4ef6\u5934\u6570\u636e\u90e8\u4efd\uff1a \u8ba1\u7b97\u504f\u79fb\u91cf\u7684\u65b9\u6cd5\uff1a \u65b9\u6cd5\u4e00\uff1a\u5176\u5b9e initramfs.img \u662fcpio\u6253\u5305\u7684gzip\u683c\u5f0f\u7684\u6587\u4ef6\uff0cgzip\u6587\u4ef6\u538b\u7f29\u7684\u53c8\u662fcpio\u6253\u5305\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u9700\u8981\u77e5\u9053gzip\u6587\u4ef6\u5728\u6700\u5916\u5c42\u7684cpio\u6587\u4ef6\u7684\u504f\u79fb\u91cf\u3002\u800cgzip\u683c\u5f0f\u7684\u6587\u4ef6\u5f00\u5934\u5b57\u8282\u662f 0x1f 0x8b 0x08 \uff0c\u6240\u4ee5\u53ea\u8981\u67e5\u627e\u51fa\u8fd9\u51e0\u4e2a\u5b57\u8282\u7684\u504f\u79fb\u91cf\u5373\u53ef\u3002 # \u547d\u4ee4\u4e00\u3002\u6bcf\u4e00\u4e2a\u5355\u5143\u4ee3\u8868\u4e00\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u504f\u79fb\u91cf\u662f 101376 + 0 = 101376 # -t \u8f93\u51fa\u683c\u5f0f\uff0cx1 \u8868\u793a\u6bcf\u4e2a\u6574\u6570\u53601\u4e2a\u5b57\u8282\uff0c-A \u6587\u4ef6\u504f\u79fb\u91cf\u683c\u5f0f\uff0cd \u8868\u793a\u4f7f\u7528\u5e26\u7b26\u53f7\u7684\u5341\u8fdb\u5236 [ root@dev initramfs ] # od -t x1 -A d initramfs-3.10.0-1062.el7.x86_64.img | grep \"1f 8b 08\" 0101376 1f 8b 08 00 9e bb ae 5d 02 03 9c bd 07 5c 13 4d # \u547d\u4ee4\u4e8c\u3002\u6bcf\u4e00\u4e2a\u5355\u5143\u4ee3\u8868\u4e00\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u504f\u79fb\u91cf\u662f 0018c00(\u5341\u516d\u8fdb\u5236) = 101376(\u5341\u8fdb\u5236) [ root@dev initramfs ] # xxd -g 1 initramfs-3.10.0-1062.el7.x86_64.img | grep \"1f 8b 08\" 0018c00: 1f 8b 08 00 9e bb ae 5d 02 03 9c bd 07 5c 13 4d ....... ] ..... \\. M ^C \u65b9\u6cd5\u4e8c\uff1a\u83b7\u53d6kernel\u76ee\u5f55\u4e0b\u7684\u90a3\u4e2a\u6587\u4ef6\u5927\u5c0f\uff0c\u7136\u540e\u52a0\u4e0a1024\uff0c\u5373\u5f97\u5230\u504f\u79fb\u91cf\u3002\u770b\u51fa\u6765\u7684\u89c4\u5f8b\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u3002//TODO # \u9996\u5148\u8ba1\u7b97\u51fa\u504f\u79fb\u91cf\u4e3a 0101376 [ root@dev initramfs ] # dd if=initramfs-3.10.0-1062.el7.x86_64.img of=initramfs.gz bs=0101376 skip=1 [ root@dev initramfs ] # file initramfs.gz initramfs.gz: gzip compressed data, from Unix, last modified: Tue Oct 22 16 :19:42 2019 , max compression [ root@dev initramfs ] # mkdir initramfs && mv initramfs.gz initramfs/ && cd initramfs/ # \u5148\u7528 gzip \u89e3\u538b [ root@dev initramfs ] # gzip -d initramfs.gz # \u89e3\u538b\u51fa\u6765\u4e00\u4e2a cpio \u6587\u4ef6 [ root@dev initramfs ] # ll total 64348 -rw-r--r--. 1 root root 65891328 Dec 5 16 :57 initramfs [ root@dev initramfs ] # file initramfs initramfs: ASCII cpio archive ( SVR4 with no CRC ) # \u518d\u7528 cpio \u89e3\u538b [ root@dev initramfs ] # cpio -i -d -F initramfs --no-absolute-filenames -c [ root@dev initramfs ] # ll total 64356 lrwxrwxrwx. 1 root root 7 Dec 5 17 :10 bin -> usr/bin drwxr-xr-x. 2 root root 45 Dec 5 17 :10 dev drwxr-xr-x. 12 root root 4096 Dec 5 17 :10 etc lrwxrwxrwx. 1 root root 23 Dec 5 17 :10 init -> usr/lib/systemd/systemd -rw-r--r--. 1 root root 65891328 Dec 5 16 :57 initramfs # \u8fd9\u662f\u539f\u6587\u4ef6 lrwxrwxrwx. 1 root root 7 Dec 5 17 :10 lib -> usr/lib lrwxrwxrwx. 1 root root 9 Dec 5 17 :10 lib64 -> usr/lib64 drwxr-xr-x. 2 root root 6 Dec 5 17 :10 proc drwxr-xr-x. 2 root root 6 Dec 5 17 :10 root drwxr-xr-x. 2 root root 6 Dec 5 17 :10 run lrwxrwxrwx. 1 root root 8 Dec 5 17 :10 sbin -> usr/sbin -rwxr-xr-x. 1 root root 3117 Dec 5 17 :10 shutdown drwxr-xr-x. 2 root root 6 Dec 5 17 :10 sys drwxr-xr-x. 2 root root 6 Dec 5 17 :10 sysroot drwxr-xr-x. 2 root root 6 Dec 5 17 :10 tmp drwxr-xr-x. 7 root root 66 Dec 5 17 :10 usr drwxr-xr-x. 2 root root 29 Dec 5 17 :10 var \u6574\u4e2a\u6587\u4ef6\u5939\u5c31\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u6839\u76ee\u5f55\uff0c\u8fd9\u6837kernel\u5c31\u80fd\u6302\u8f7d\u4e86\u3002 # \u770b\u770b\u9ed8\u8ba4\u7684\u64cd\u4f5c\u73af\u5883\uff0c\u6307\u5411\u7684\u5c31\u662f initrd.target [ root@dev initramfs ] # ll usr/lib/systemd/system/default.target lrwxrwxrwx. 1 root root 13 Dec 6 08 :40 usr/lib/systemd/system/default.target -> initrd.target initrd.target \u4e5f\u662f\u9700\u8981\u8bfb\u5165\u4e00\u5806\u4f8b\u5982 basic.target\uff0c sysinit.target \u7b49\u7b49\u7684\u786c\u4ef6\u68c0\u6d4b\u3001\u5185\u6838\u529f\u80fd\u542f\u7528\u7684\u6d41\u7a0b\uff0c \u7136\u540e\u5f00\u59cb\u8ba9\u7cfb\u7edf\u987a\u5229\u8fd0\u4f5c\u3002 \u6700\u7ec8\u624d\u53c8\u5378\u8f7d initramfs \u7684\u5c0f\u578b\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b9e\u9645\u6302\u8f7d\u7cfb\u7edf\u7684\u6839\u76ee\u5f55 \u3002 \u540c\u7406\uff0c\u76f4\u63a5\u5c06\u5f00\u673a\u6240\u9700\u6a21\u5757\u7f16\u8bd1\u5230\u5185\u6838\u4e2d\uff0c\u4e5f\u80fd\u987a\u5229\u542f\u52a8\u4e86\u3002","title":"1.3 \u52a0\u8f7d\u5185\u6838\u68c0\u6d4b\u786c\u4ef6\u4e0e initramfs \u7684\u529f\u80fd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#2-systemd-defaulttarget","text":"systemd \u6700\u4e3b\u8981\u7684\u529f\u80fd\u5c31\u662f\u51c6\u5907\u8f6f\u4ef6\u6267\u884c\u7684\u73af\u5883\uff0c\u5305\u62ec\u7cfb\u7edf\u7684\u4e3b\u673a\u540d\u3001\u7f51\u7edc\u8bbe\u5b9a\u3001\u8bed\u7cfb\u5904\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u53ca\u5176\u4ed6\u670d\u52a1\u7684\u542f\u52a8\u7b49\u3002 \u800c\u6240\u6709\u7684\u52a8\u4f5c\u90fd\u4f1a\u900f\u8fc7 systemd \u7684\u9ed8\u8ba4\u542f\u52a8\u670d\u52a1\u96c6\u5408\uff0c\u4ea6\u5373\u662f /etc/systemd/system/default.target \u6765\u89c4\u5212\u3002","title":"2. \u7b2c\u4e00\u4e2a\u7a0b\u5e8f systemd \u53ca\u4f7f\u7528 default.target \u8fdb\u5165\u5f00\u673a\u7a0b\u5e8f\u5206\u6790"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#21-runlevel","text":"systemd \u4e3a\u4e86\u517c\u5bb9\u4e8e\u65e7\u5f0f\u7684 system V \u64cd\u4f5c\u884c\u4e3a, \u6240\u4ee5\u4e5f\u5c06 runlevel \u4e0e\u64cd\u4f5c\u73af\u5883\u505a\u4e86\u7ed3\u5408\uff1a [ root@dev ~ ] # ll /usr/lib/systemd/system/runlevel?.target lrwxrwxrwx. 1 root root 15 Oct 22 16 :01 /usr/lib/systemd/system/runlevel0.target -> poweroff.target lrwxrwxrwx. 1 root root 13 Oct 22 16 :01 /usr/lib/systemd/system/runlevel1.target -> rescue.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel2.target -> multi-user.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel3.target -> multi-user.target lrwxrwxrwx. 1 root root 17 Oct 22 16 :01 /usr/lib/systemd/system/runlevel4.target -> multi-user.target lrwxrwxrwx. 1 root root 16 Oct 22 16 :01 /usr/lib/systemd/system/runlevel5.target -> graphical.target lrwxrwxrwx. 1 root root 13 Oct 22 16 :01 /usr/lib/systemd/system/runlevel6.target -> reboot.target \u5207\u6362\u6267\u884c\u7b49\u7ea7\u53ef\u4ee5\u4f7f\u7528 init <number> \u6765\u6267\u884c\uff0c\u4f8b\u5982\uff1a init 3 \uff0c\u76f8\u5f53\u4e8e systemctl isolate multi-user.target \u3002","title":"2.1 \u517c\u5bb9\u4e8e runlevel \u7684\u7b49\u7ea7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#22-systemd","text":"CentOS 7.x \u7684 systemd \u5f00\u673a\u6d41\u7a0b\u5927\u7ea6\u662f\u8fd9\u6837\uff1a local-fs.target + swap.target\uff1a\u8fd9\u4e24\u4e2a target \u4e3b\u8981\u5728\u6302\u8f7d\u672c\u673a /etc/fstab \u91cc\u9762\u6240\u89c4\u8303\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0e\u76f8\u5173\u7684\u5185\u5b58\u4ea4\u6362\u7a7a\u95f4\u3002 sysinit.target\uff1a\u8fd9\u4e2a target \u4e3b\u8981\u5728\u4fa6\u6d4b\u786c\u4ef6\uff0c\u52a0\u8f7d\u6240\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\u7b49\u52a8\u4f5c\u3002 basic.target\uff1a\u52a0\u8f7d\u4e3b\u8981\u7684\u5916\u90e8\u786c\u4ef6\u9a71\u52a8\u7a0b\u5e8f\u4e0e\u9632\u706b\u5899\u76f8\u5173\u4efb\u52a1 multi-user.target \u5e95\u4e0b\u7684\u5176\u5b83\u4e00\u822c\u7cfb\u7edf\u6216\u7f51\u7edc\u670d\u52a1\u7684\u52a0\u8f7d \u56fe\u5f62\u754c\u9762\u76f8\u5173\u670d\u52a1\u5982 gdm.service \u7b49\u5176\u4ed6\u670d\u52a1\u7684\u52a0\u8f7d \u4e0b\u9762\u7b80\u8981\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e9btarget\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff0c\u8be6\u7ec6\u7684\u670d\u52a1\u8fd8\u662f\u6839\u636e\u914d\u7f6e\u7684\u4f9d\u8d56\u5173\u7cfb\u67e5\u770b\u5427\uff0c systemctl list-dependencies xxx \u3002","title":"2.2 systemd \u7684\u5904\u7406\u6d41\u7a0b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#221-sysinittarget-basictarget","text":"","title":"2.2.1 sysinit.target \u521d\u59cb\u5316\u7cfb\u7edf\u3001basic.target \u51c6\u5907\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#2211-sysinittarget","text":"","title":"2.2.1.1 sysinit.target \u5927\u81f4\u5185\u5bb9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#-dev-hugepagesmount-dev-mqueuemount-dev-devhugepages-devmqueue","text":"\u7279\u6b8a\u6587\u4ef6\u7cfb\u7edf\u7684\u542f\u7528\uff1a\u5305\u62ec\u78c1\u76d8\u9635\u5217\u3001\u7f51\u7edc\u9a71\u52a8\u5668 (iscsi)\u3001LVM \u6587\u4ef6\u7cfb\u7edf\u3001\u6587\u4ef6\u7cfb\u7edf\u5bf9\u7167\u670d\u52a1 (multipath)\u7b49\u7b49\uff0c\u4e5f\u4f1a\u5728\u8fd9\u91cc\u88ab\u4fa6\u6d4b\u4e0e\u4f7f\u7528\u5230\uff01 - \u5f00\u673a\u8fc7\u7a0b\u7684\u8baf\u606f\u4f20\u9012\u4e0e\u52a8\u753b\u6267\u884c\uff1a\u4f7f\u7528 plymouthd \u670d\u52a1\u642d\u914d plymouth \u6307\u4ee4\u6765\u4f20\u9012\u52a8\u753b\u4e0e\u8baf\u606f - \u65e5\u5fd7\u5f0f\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\u7684\u4f7f\u7528\uff1a\u5c31\u662f systemd-journald \u8fd9\u4e2a\u670d\u52a1\u7684\u542f\u7528\u554a\uff01 - \u52a0\u8f7d\u989d\u5916\u7684\u5185\u6838\u6a21\u5757\uff1a\u900f\u8fc7 /etc/modules-load.d/*.conf \u6587\u4ef6\u7684\u8bbe\u5b9a\uff0c\u8ba9\u5185\u6838\u989d\u5916\u52a0\u8f7d\u7ba1\u7406\u5458\u6240\u9700\u8981\u7684\u5185\u6838\u6a21\u5757\uff01 - \u52a0\u8f7d\u989d\u5916\u7684\u5185\u6838\u53c2\u6570\u8bbe\u5b9a\uff1a\u5305\u62ec /etc/sysctl.conf \u4ee5\u53ca /etc/sysctl.d/*.conf \u5185\u90e8\u8bbe\u5b9a\uff01 - \u542f\u52a8\u7cfb\u7edf\u7684\u968f\u673a\u6570\u751f\u6210\u5668\uff1a\u968f\u673a\u6570\u751f\u6210\u5668\u53ef\u4ee5\u5e2e\u52a9\u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u5bc6\u7801\u52a0\u5bc6\u6f14\u7b97\u7684\u529f\u80fd - \u8bbe\u5b9a\u7ec8\u7aef\u673a (console) \u5b57\u5f62 - \u542f\u52a8\u52a8\u6001\u8bbe\u5907\u7ba1\u7406\u5668\uff1a\u5c31\u662f udevd \u8fd9\u4e2a\u5bb6\u4f19\uff01\u7528\u5728\u52a8\u6001\u5bf9\u5e94\u5b9e\u9645\u88c5\u7f6e\u5b58\u53d6\u4e0e\u88c5\u7f6e\u6587\u4ef6\u540d\u5bf9\u5e94\u7684\u4e00\u4e2a\u670d\u52a1\uff01\u76f8\u5f53\u91cd\u8981\u5594\uff01\u4e5f\u662f\u5728\u8fd9\u91cc\u542f\u52a8\u7684\uff01","title":"- \u7279\u6b8a\u6587\u4ef6\u7cfb\u7edf\u88c5\u7f6e\u7684\u6302\u8f7d\uff1a\u5305\u62ec dev-hugepages.mount dev-mqueue.mount \u7b49\u6302\u8f7d\u670d\u52a1\uff0c\u4e3b\u8981\u5728\u6302\u8f7d\u8ddf\u5de8\u91cf\u5185\u5b58\u5206\u9875\u4f7f\u7528\u4e0e\u6d88\u606f\u961f\u5217\u7684\u529f\u80fd\u3002 \u6302\u8f7d\u6210\u529f\u540e\uff0c\u4f1a\u5728 /dev \u5e95\u4e0b\u5efa\u7acb /dev/hugepages/\uff0c /dev/mqueue/ \u7b49\u76ee\u5f55;"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#2212-basictarget","text":"sysinit.target \u5728\u521d\u59cb\u5316\u7cfb\u7edf\uff0c\u800c\u8fd9\u4e2a basic .target \u5219\u662f\u4e00\u4e2a\u6700\u7b80\u964b\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e86\u3002 \u52a0\u8f7d alsa \u97f3\u6548\u9a71\u52a8\u7a0b\u5e8f\uff1a\u8fd9\u4e2a alsa \u662f\u4e2a\u97f3\u6548\u76f8\u5173\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u4f1a\u8ba9\u4f60\u7684\u7cfb\u7edf\u6709\u97f3\u6548\u4ea7\u751f\u5570\uff1b \u8f7d\u5165 firewalld \u9632\u706b\u5899\uff1aCentOS 7.x \u4ee5\u540e\u4f7f\u7528 firewalld \u53d6\u4ee3 iptables \u7684\u9632\u706b\u5899\u8bbe\u5b9a\uff0c\u867d\u7136\u6700\u7ec8\u90fd\u662f\u4f7f\u7528 iptables \u7684\u67b6\u6784\uff0c \u4e0d\u8fc7\u5728\u8bbe\u5b9a\u4e0a\u9762\u5dee\u5f88\u591a\u5594\uff01 \u52a0\u8f7d CPU \u7684\u5fae\u6307\u4ee4\u529f\u80fd\uff1b \u542f\u52a8\u4e0e\u8bbe\u5b9a SELinux \u7684\u5b89\u5168\u672c\u6587\uff1a\u5982\u679c\u7531 disable \u7684\u72b6\u6001\u6539\u6210 enable \u7684\u72b6\u6001\uff0c\u6216\u8005\u662f\u7ba1\u7406\u5458\u8bbe\u5b9a\u5f3a\u5236\u91cd\u65b0\u8bbe\u5b9a\u4e00\u6b21 SELinux \u7684\u5b89\u5168\u672c\u6587\uff0c \u4e5f\u5728\u8fd9\u4e2a\u9636\u6bb5\u5904\u7406\u5594\uff01 \u5c06\u76ee\u524d\u7684\u5f00\u673a\u8fc7\u7a0b\u6240\u4ea7\u751f\u7684\u5f00\u673a\u4fe1\u606f\u5199\u5165\u5230 /var/log/dmesg \u5f53\u4e2d \u7531 /etc/sysconfig/modules/*.modules \u53ca /etc/rc.modules \u52a0\u8f7d\u7ba1\u7406\u5458\u6307\u5b9a\u7684\u6a21\u5757\uff01 \u52a0\u8f7d systemd \u652f\u6301\u7684 timer \u529f\u80fd","title":"2.2.1.2 basic.target \u5927\u81f4\u5185\u5bb9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#222-multi-usertarget","text":"basic.target \u8ba9\u7cfb\u7edf\u6210\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u7840\uff0c\u4e4b\u540e\u5c31\u662f\u670d\u52a1\u5668\u8981\u987a\u5229\u8fd0\u4f5c\u65f6\uff0c\u9700\u8981\u7684\u5404\u79cd\u4e3b\u673a\u670d\u52a1\u4ee5\u53ca\u63d0\u4f9b\u670d\u52a1\u5668\u529f\u80fd\u7684\u7f51\u7edc\u670d\u52a1\u7684\u542f\u52a8\u4e86\u3002\u8fd9\u4e9b\u670d\u52a1\u7684\u542f\u52a8\u5219\u5927\u591a\u662f\u9644\u6302\u5728 multi-user.target \u8fd9\u4e2a\u64cd\u4f5c\u73af\u5883\u5e95\u4e0b\u3002","title":"2.2.2 \u542f\u52a8 multi-user.target \u4e0b\u7684\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#2221-systemv-rc-localservice","text":"\u5728\u4ee5\u524d\u7684\u7248\u672c\u4e2d\uff0c\u5f53\u7cfb\u7edf\u5b8c\u6210\u5f00\u673a\u540e\u8fd8\u60f3\u8981\u8ba9\u7cfb\u7edf\u989d\u5916\u6267\u884c\u67d0\u4e9b\u7a0b\u5e8f\u7684\u8bdd\uff0c\u53ef\u4ee5\u5c06\u8be5\u7a0b\u5e8f\u6307\u4ee4\u6216\u811a\u672c\u7684\u7edd\u5bf9\u8def\u5f84\u540d\u79f0\u5199\u5165\u5230 /etc/rc.d/rc.local \u8fd9\u4e2a\u6587\u4ef6\u53bb\uff01\u65b0\u7684 systemd \u673a\u5236\u4e2d\uff0c\u5b83\u5efa\u8bae\u76f4\u63a5\u5199\u4e00\u4e2a systemd \u7684\u542f\u52a8\u811a\u672c\u914d\u7f6e\u6587\u4ef6\u5230 /etc/systemd/system \u5e95\u4e0b\uff0c\u7136\u540e\u4f7f\u7528systemctl enable \u7684\u65b9\u5f0f\u6765\u8bbe\u5b9a\u542f\u7528\u5b83\uff0c\u800c\u4e0d\u8981\u76f4\u63a5\u4f7f\u7528 rc.local \u8fd9\u4e2a\u6587\u4ef6\u3002 [ sink@dev boot ] $ cat /etc/rc.d/rc.local #!/bin/bash # THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES # # It is highly advisable to create own systemd services or udev rules # to run scripts during boot instead of using this file. # # In contrast to previous versions due to parallel execution during boot # this script will NOT be run after all other services. # # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure # that this script will be executed during boot. touch /var/lock/subsys/local","title":"2.2.2.1 \u517c\u5bb9 systemV \u7684 rc-local.service"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#2222-tty","text":"\u7531\u4e8e\u670d\u52a1\u90fd\u662f\u540c\u6b65\u8fd0\u4f5c\uff0c\u4e0d\u4e00\u5b9a\u54ea\u4e2a\u670d\u52a1\u5148\u542f\u52a8\u5b8c\u6bd5\u3002\u5982\u679c getty \u670d\u52a1\u5148\u542f\u52a8\u5b8c\u6bd5\u65f6\uff0c\u4f60\u4f1a\u53d1\u73b0\u5230\u6709\u53ef\u7528\u7684\u7ec8\u7aef\u673a\u5c1d\u8bd5\u8ba9\u4f60\u767b\u5165\u7cfb\u7edf\u4e86\u3002 \u95ee\u9898\u662f\uff0c\u5982\u679c systemd-logind.service \u6216 systemd-user-sessions.service \u670d\u52a1\u5c1a\u672a\u6267\u884c\u5b8c\u6bd5\u7684\u8bdd\uff0c\u90a3\u4e48\u4f60\u8fd8\u662f\u65e0\u6cd5\u767b\u5165\u7cfb\u7edf\u7684\u3002","title":"2.2.2.2 \u63d0\u4f9b tty \u754c\u9762\u4e0e\u767b\u5165\u7684\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#223-graphicaltarget","text":"[ sink@dev ~ ] $ systemctl list-dependencies graphical.target graphical.target \u25cf \u251c\u2500accounts-daemon.service \u25cf \u251c\u2500gdm.service # \u8ba9\u7528\u6237\u53ef\u4ee5\u5229\u7528\u56fe\u5f62\u754c\u9762\u767b\u5165\u7684\u6700\u91cd\u8981\u670d\u52a1 \u25cf \u251c\u2500network.service \u25cf \u251c\u2500rtkit-daemon.service \u25cf \u251c\u2500systemd-readahead-collect.service \u25cf \u251c\u2500systemd-readahead-replay.service \u25cf \u251c\u2500systemd-update-utmp-runlevel.service \u25cf \u2514\u2500multi-user.target \u25cf \u251c\u2500abrt-ccpp.service \u25cf \u251c\u2500abrt-oops.service","title":"2.2.3 \u542f\u52a8 graphical.target \u4e0b\u7684\u670d\u52a1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#3","text":"systemd \u6709\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u5904\u7406\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u4e3a\u4e86\u517c\u5bb9\u4e8e systemV ,\u5176\u5b9e\u5f88\u591a\u7684\u670d\u52a1\u811a\u672c\u8bbe\u5b9a\u8fd8\u662f\u4f1a\u8bfb\u53d6\u4f4d\u4e8e /etc/sysconfig/ \u5e95\u4e0b\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6\u3002","title":"3. \u5f00\u673a\u8fc7\u7a0b\u4f1a\u7528\u5230\u7684\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#31","text":"sysinit.target \u4e2d\u6709\u52a0\u8f7d\u7528\u6237\u81ea\u5b9a\u4e49\u6a21\u5757\u7684\u5730\u65b9\uff1a /etc/modules-load.d/*.conf \uff1a\u5355\u7eaf\u8981\u5185\u6838\u52a0\u8f7d\u6a21\u5757\u7684\u4f4d\u7f6e\uff1b /etc/modprobe.d/*.conf \uff1a\u53ef\u4ee5\u52a0\u4e0a\u6a21\u5757\u53c2\u6570\u7684\u4f4d\u7f6e\u3002 systemd \u5728\u5f00\u673a\u65f6\u5df2\u7ecf\u628a\u9700\u8981\u7684\u9a71\u52a8\u90fd\u52a0\u8f7d\u4e86\uff0c\u57fa\u672c\u4e0a\u65e0\u9700\u6539\u52a8\u3002\u5982\u679c\u4f60\u6709\u67d0\u4e9b\u7279\u5b9a\u7684\u53c2\u6570\u8981\u5904\u7406\u65f6\uff0c\u624d\u9700\u8981\u5728\u8fd9\u91cc\u505a\u4e00\u4e9b\u5904\u7406\u3002 \u4e0b\u9762\u662f\u9e1f\u54e5\u4e3e\u7684\u4e00\u4e2a\u4f8b\u5b50\u3002 \u5728\u524d\u6587\u4e2d\u6211\u4eec\u5411 vdftpd de\u7aef\u53e3\u6539\u6210\u4e86 555\uff0c\u5176\u4e2d\u4e00\u4e2a\u9488\u5bf9 FTP \u5f88\u91cd\u8981\u7684\u9632\u706b\u5899\u6a21\u5757\u4e3a nf_conntrack_ftp \uff0c\u4f60\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u6a21\u5757\u5199\u5165\u5230\u7cfb\u7edf\u5f00\u673a\u6d41\u7a0b\u4e2d\uff1a [ root@dev ~ ] # cat /etc/modules-load.d/sink.conf nf_conntrack_ftp \u4e00\u4e2a\u6a21\u5757 (\u9a71\u52a8\u7a0b\u5e8f) \u5199\u4e00\u884c\u3002\u4e0a\u8ff0\u7684\u6a21\u5757\u57fa\u672c\u4e0a\u662f\u9488\u5bf9\u9ed8\u8ba4 FTP \u7aef\u53e3 21 \u6240\u8bbe\u5b9a\u7684\uff0c\u5982\u679c\u9700\u8981\u8c03\u6574\u5230 port 555 \u7684\u8bdd\uff0c\u5f97\u5728\u53e6\u4e00\u4e2a\u76ee\u5f55\u4e0b\u5916\u5e26\u53c2\u6570\u624d\u884c\uff1a [ root@dev ~ ] # cat /etc/modprobe.d/sink.conf options nf_conntrack_ftp ports = 555 \u4e4b\u540e\u91cd\u65b0\u542f\u52a8\u5c31\u80fd\u591f\u987a\u5229\u7684\u8f7d\u5165\u5e76\u4e14\u5904\u7406\u597d\u8fd9\u4e2a\u6a21\u5757\u4e86\u3002\u90a3\u4e48\u975e\u91cd\u542f\u7684\u65b9\u6cd5\u662f\u4ec0\u4e48\u5462\uff1a [ root@dev ~ ] # lsmod | grep nf_conntrack_ftp [ root@dev ~ ] # systemctl restart systemd-modules-load.service [ root@dev ~ ] # lsmod | grep nf_conntrack_ftp nf_conntrack_ftp 18478 0 nf_conntrack 139224 8 nf_nat,nf_nat_ipv4,nf_nat_ipv6,xt_conntrack,nf_nat_masquerade_ipv4,nf_conntrack_ftp,nf_conntrack_ipv4,nf_conntrack_ipv6","title":"3.1 \u6a21\u5757\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#32","text":"\u8fd9\u4e9b\u6587\u4ef6\u90fd\u5728 /etc/sysconfig/ \u76ee\u5f55\u4e0b\uff1a authconfig \u8fd9\u4e2a\u6587\u4ef6\u4e3b\u8981\u5728\u89c4\u8303\u4f7f\u7528\u8005\u7684\u8eab\u4efd\u8ba4\u8bc1\u7684\u673a\u5236\uff0c\u5305\u62ec\u662f\u5426\u4f7f\u7528\u672c\u673a\u7684 /etc/passwd\uff0c /etc/shadow \u7b49\uff0c \u4ee5\u53ca /etc/shadow \u5bc6\u7801\u8bb0\u5f55\u4f7f\u7528\u4f55\u79cd\u52a0\u5bc6\u7b97\u6cd5\uff0c\u8fd8\u6709\u662f\u5426\u4f7f\u7528\u5916\u90e8\u5bc6\u7801\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u8d26\u53f7\u9a8c\u8bc1 (NIS, LDAP) \u7b49\u3002\u4f7f\u7528 authconfig-tui \u6765\u4fee\u6539\u3002 cpupower cpupower.service \u670d\u52a1\u4f7f\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4e3b\u8981\u662f Linux \u5185\u6838\u5982\u4f55\u64cd\u4f5c CPU \u7684\u89c4\u5219\u3002 \u4e00\u822c\u6765\u8bf4,\u542f\u52a8 cpupower.service \u4e4b\u540e\uff0c\u7cfb\u7edf\u4f1a\u8ba9 CPU \u4ee5\u6700\u5927\u6548\u80fd\u7684\u65b9\u5f0f\u6765\u8fd0\u4f5c\uff0c\u5426\u5219\u9884\u8bbe\u5c31\u662f\u7528\u591a\u5c11\u7b97\u591a\u5c11\u7684\u6a21\u5f0f\u6765\u5904\u7406\u7684\u3002 firewalld, iptables-config, iptables-config, ebtables-config \u9632\u706b\u5899\u670d\u52a1\u3002\u53c2\u8003\u670d\u52a1\u5668\u7bc7\u3002 network-scripts/ \u8bbe\u5b9a\u7f51\u5361\u3002\u53c2\u8003\u670d\u52a1\u5668\u7bc7\u3002","title":"3.2 \u5176\u5b83\u7684\u73af\u5883\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#4","text":"\u5728\u4e0a\u6587\u4e2d\u63d0\u5230\uff0c\u5728\u6574\u4e2a\u5f00\u673a\u7684\u8fc7\u7a0b\u5f53\u4e2d\uff0c\u662f\u5426\u80fd\u591f\u6210\u529f\u7684\u9a71\u52a8\u6211\u4eec\u4e3b\u673a\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u662f\u5185\u6838 (kernel) \u7684\u5de5\u4f5c\u3002\u76ee\u524d\u7684\u5185\u6838\u90fd\u5177\u6709 modules (\u6a21\u5757\u5316) \u7684\u529f\u80fd\u3002 \u5185\u6838\u4e0e\u5185\u6838\u6a21\u5757\u7684\u4f4d\u7f6e\uff1a \u5185\u6838\uff1a /boot/vmlinuz \u6216 /boot/vmlinuz-version\uff1b \u5185\u6838\u89e3\u538b\u7f29\u6240\u9700 RAM Disk\uff1a /boot/initramfs (/boot/initramfs-version)\uff1b \u5185\u6838\u6a21\u5757\uff1a /lib/modules/version/kernel \u6216 /lib/modules/$(uname -r)/kernel\uff1b \u5185\u6838\u539f\u7801\uff1a /usr/src/linux \u6216 /usr/src/kernels/ (\u8981\u5b89\u88c5\u624d\u4f1a\u6709,\u9884\u8bbe\u4e0d\u5b89\u88c5)\u3002 \u5982\u679c\u8be5\u5185\u6838\u88ab\u987a\u5229\u7684\u52a0\u8f7d\u7cfb\u7edf\u5f53\u4e2d\u4e86,\u90a3\u4e48\u5c31\u4f1a\u6709\u51e0\u4e2a\u4fe1\u606f\u7eaa\u5f55\u4e0b\u6765: \u5185\u6838\u7248\u672c\uff1a/proc/version \u7cfb\u7edf\u5185\u6838\u529f\u80fd\uff1a/proc/sys/kernel/ \u5982\u679c\u6709\u4e2a\u65b0\u7684\u786c\u4ef6\uff0c\u8ba9\u7cfb\u7edf\u652f\u6301\u7684\u4e24\u79cd\u65b9\u6cd5\uff1a \u91cd\u65b0\u7f16\u8bd1\u5185\u6838,\u5e76\u52a0\u5165\u6700\u65b0\u7684\u786c\u4ef6\u9a71\u52a8\u7a0b\u5e8f\u539f\u59cb\u7801\uff1b \u5c06\u8be5\u786c\u4ef6\u7684\u9a71\u52a8\u7a0b\u5e8f\u7f16\u8bd1\u6210\u4e3a\u6a21\u5757\uff0c\u5728\u5f00\u673a\u65f6\u52a0\u8f7d\u8be5\u6a21\u5757\u3002 \u5173\u4e8e\u7f16\u8bd1\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53c2\u8003\u540e\u7eed\u7ae0\u8282\u3002\u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5982\u4f55\u52a0\u8f7d\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6a21\u5757\u3002","title":"4. \u5185\u6838\u4e0e\u5185\u6838\u6a21\u5757"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#41","text":"\u5185\u6838\u6a21\u5757\u4e00\u822c\u653e\u5728 /lib/modules/$(uname -r)/kernel \u76ee\u5f55\u4e0b\uff1a [ root@dev ~ ] # ls -1 /lib/modules/$(uname -r)/kernel/ arch # \u4e0e\u786c\u4ef6\u5e73\u53f0\u6709\u5173\u7684\u9879\u76ee,\u4f8b\u5982 CPU \u7684\u7b49\u7ea7\u7b49\u7b49 crypto # \u5185\u6838\u6240\u652f\u6301\u7684\u52a0\u5bc6\u7684\u6280\u672f,\u4f8b\u5982 md5 \u6216\u8005\u662f des \u7b49\u7b49 drivers # \u4e00\u4e9b\u786c\u4ef6\u7684\u9a71\u52a8\u7a0b\u5e8f fs # \u5185\u6838\u6240\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf kernel lib # \u4e00\u4e9b\u51fd\u6570\u5e93; mm net # \u4e0e\u7f51\u7edc\u6709\u5173\u7684\u5404\u9879\u534f\u8bae\u6570\u636e,\u8fd8\u6709\u9632\u706b\u5899\u6a21\u5757 (net/ipv4/netfilter/*) \u7b49\u7b49; sound # \u4e0e\u97f3\u6548\u6709\u5173\u7684\u5404\u9879\u6a21\u5757; virt /lib/modules/$(uname -r)/modules.dep \u6587\u4ef6\u8bb0\u5f55\u4e86\u5728\u5185\u6838\u652f\u6301\u7684\u6a21\u5757\u7684\u5404\u9879\u4f9d\u8d56\u3002\u5229\u7528 depmod \u8fd9\u4e2a\u6307\u4ee4\u5c31\u53ef\u4ee5\u5efa\u7acb\u8be5\u6587\u4ef6\uff1a depmod - [ aA ] [ options ] [ forced_version ] \u8f93\u51fa\u9002\u7528\u4e8e modprobe \u7684\u4f9d\u8d56\u5217\u8868 \u4e0d\u52a0\u4efb\u4f55\u9009\u9879\u7b49\u540c\u4e8e\u201c depmod - a \u201d Options : - a , -- all Probe all modules \uff0c\u5e76\u5199\u5165\u5230\u6587\u4ef6\u4e2d - A , -- quick \u627e\u5230\u65b0\u6a21\u5757\u624d\u66f4\u65b0\u6587\u4ef6 - n , -- show \u4e0d\u5199\u5165 modules . dep ,\u800c\u662f\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a ( standard out ) - e , -- errsyms \u663e\u793a\u51fa\u76ee\u524d\u5df2\u52a0\u8f7d\u7684\u4e0d\u53ef\u6267\u884c\u7684\u6a21\u5757\u540d\u79f0 \u82e5\u6211\u505a\u597d\u4e00\u4e2a\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f a.ko \uff0c\u8be5\u5982\u4f55\u66f4\u65b0\u6838\u5fc3\u7684\u4f9d\u8d56\uff1a cp a.ko /lib/modules/ $( uname -r ) /kernel/drivers/net depmod","title":"4.1 \u5185\u6838\u6a21\u5757\u4e0e\u4f9d\u8d56"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#42","text":"\u5217\u51fa\u6a21\u5757\u3001\u5927\u5c0f\u3001\u4f9d\u8d56\uff1a [ root@dev ~ ] # lsmod # \u540d\u5b57 \u5927\u5c0f \u6b64\u6a21\u5757\u662f\u5426\u88ab\u5176\u4ed6\u6a21\u5757\u6240\u4f7f\u7528 Module Size Used by nf_conntrack_ftp 18478 0 tcp_lp 12663 0 llc 14552 2 stp,bridge \u2026\u2026 \u67e5\u770b\u5177\u4f53\u7684\u67d0\u4e2a\u6a21\u5757\u7684\u4fe1\u606f\uff1a modinfo [ options ] filename [ args ] filename \u53ef\u4ee5\u662f\u6a21\u5757\u540d\u5b57\u6216\u6a21\u5757\u6587\u4ef6 Options : - a , --author Print only 'author' - d , --description Print only 'description' - l , --license Print only 'license' - p , --parameters Print only 'parm' - n , --filename Print only 'filename' - F , --field=FIELD Print only provided FIELD [ root@dev ~ ] # modinfo fuse filename: /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fuse/fuse.ko.xz alias: devname:fuse alias: char-major-10-229 alias: fs-fuseblk alias: fs-fuse license: GPL description: Filesystem in Userspace \u2026\u2026 # \u67e5\u770b\u81ea\u5df1\u7684\u6a21\u5757\u4fe1\u606f [ root@dev ~ ] # modinfo a.ko","title":"4.2 \u5185\u6838\u6a21\u5757\u7684\u67e5\u770b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/23 \u5f00\u673a\u6d41\u7a0b/#43","text":"\u6709\u4e24\u4e2a\u52a0\u8f7d\u6a21\u5757\u7684\u547d\u4ee4\uff1a modprobe\uff1a\u4f1a\u4e3b\u52a8\u7684\u53bb\u641c\u5bfb modules.dep \u7684\u5185\u5bb9\uff0c\u5148\u89e3\u51b3\u6a21\u5757\u7684\u4f9d\u8d56\u540e\uff0c \u624d\u51b3\u5b9a\u9700\u8981\u52a0\u8f7d\u7684\u6a21\u5757\u6709\u54ea\u4e9b\uff0c\u5f88\u65b9\u4fbf\u3002 insmod\uff1a\u5b8c\u5168\u7531\u4f7f\u7528\u8005\u81ea\u884c\u52a0\u8f7d\u4e00\u4e2a \u5b8c\u6574\u6587\u4ef6\u540d \u7684\u6a21\u5757\uff0c \u5e76\u4e0d\u4f1a\u4e3b\u52a8\u7684\u5206\u6790\u6a21\u5757\u7684\u4f9d\u8d56\u3002 [ root@dev ~ ] # lsmod | grep fat # \u52a0\u8f7d [ root@dev ~ ] # insmod /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fat/fat.ko.xz [ root@dev ~ ] # lsmod | grep fat fat 65950 0 # \u79fb\u9664 [ root@dev ~ ] # rmmod /lib/modules/3.10.0-1062.el7.x86_64/kernel/fs/fat/fat.ko.xz \u4f7f\u7528 insmod \u4e0e rmmod \u7684\u95ee\u9898\u5c31\u662f\uff0c\u4f60\u5fc5\u987b\u8981\u81ea\u884c\u627e\u5230\u6a21\u5757\u7684\u5b8c\u6574\u6587\u4ef6\u540d\u624d\u884c\uff0c\u800c\u4e14\u4e07\u4e00\u6a21\u5757\u6709\u4f9d\u8d56\u6027\u95ee\u9898\uff0c\u4f60\u5c06\u65e0\u6cd5\u76f4\u63a5\u52a0\u8f7d\u6216\u79fb\u9664\u8be5\u6a21\u5757\u3002 modprobe [ options ] modulename Management Options : - r , -- remove Remove modules instead of inserting - f , -- force Force module insertion or removal . Query Options : - c , -- showconfig Print out known configuration and exit General Options : - n , -- dry - run Do not execute operations , just print out [ root@dev ~ ] # modprobe fat [ root@dev ~ ] # lsmod | grep fat fat 65950 0 [ root@dev ~ ] # modprobe -r fat \u771f\u662f\u6bd4 insmod \u65b9\u4fbf\u591a\u4e86\uff01 \u81f3\u4e8e\u6a21\u5757\u7684\u9009\u9879\u6307\u5b9a\u53c2\u8003\u4e0a\u6587\u55bd\u3002","title":"4.3 \u5185\u6838\u6a21\u5757\u7684\u52a0\u8f7d\u4e0e\u79fb\u9664"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/","text":"1. boot loader \u7684\u4e24\u4e2a stage \u00b6 \u5728\u524d\u6587 \u5f00\u673a\u6d41\u7a0b \u4e2d\u63d0\u5230\uff0c\u5728 BIOS \u8bfb\u5b8c\u4fe1\u606f\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4f1a\u5230\u7b2c\u4e00\u4e2a\u5f00\u673a\u8bbe\u5907\u7684 MBR \u53bb\u8bfb\u53d6 boot loader \u4e86\u3002 \u4f46 MBR \u662f\u6574\u4e2a\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a sector \u5185\u7684\u4e00\u4e2a\u533a\u5757\uff0c\u5145\u5176\u91cf\u6574\u4e2a\u5927\u5c0f\u4e5f\u624d 446 bytes \u800c\u5df2\u3002\u5373\u4f7f\u662f GPT \u4e5f\u6ca1\u6709\u5f88\u5927\u7684\u6247\u533a\u6765\u50a8\u5b58 loader \u7684\u6570\u636e\u3002\u8fd9\u4e2a\u5927\u5c0f\u80af\u5b9a\u662f\u4e0d\u591f\u7528\u7684\u3002\u5173\u4e8e\u78c1\u76d8\u7684\u8be6\u7ec6\u4ecb\u7ecd\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\u7b2c\u4e8c\u7ae0\u7684 2.2 \u78c1\u76d8\u5206\u533a \u5c0f\u8282\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cLinux \u5c06 boot loader \u7684\u7a0b\u5e8f\u4ee3\u7801\u6267\u884c\u4e0e\u8bbe\u5b9a\u503c\u52a0\u8f7d\u5206\u6210\u4e24\u4e2a\u9636\u6bb5 (stage)\u6765\u6267\u884c: Stage 1\uff1a\u6267\u884c boot loader \u4e3b\u7a0b\u5e8f\uff1a \u7b2c\u4e00\u9636\u6bb5\u4e3a\u6267\u884c boot loader \u7684\u4e3b\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u4e3b\u7a0b\u5e8f\u5fc5\u987b\u8981\u88ab\u5b89\u88c5\u5728\u5f00\u673a\u533a\uff0c\u4ea6\u5373\u662f MBR \u6216\u8005\u662f boot sector \u3002\u4f46\u5982\u524d\u6240\u8ff0\uff0c\u56e0\u4e3a MBR \u5b9e\u5728\u592a\u5c0f\u4e86\uff0c\u6240\u4ee5\uff0cMBR \u6216 boot sector \u901a\u5e38\u4ec5\u5b89\u88c5 boot loader \u7684\u6700\u5c0f\u4e3b\u7a0b\u5e8f\uff0c \u5e76\u6ca1\u6709\u5b89\u88c5 loader \u7684\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\uff1b Stage 2\uff1a\u4e3b\u7a0b\u5e8f\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a \u7b2c\u4e8c\u9636\u6bb5\u4e3a\u900f\u8fc7 boot loader \u52a0\u8f7d\u6240\u6709\u914d\u7f6e\u6587\u4ef6\u4e0e\u76f8\u5173\u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6 (\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u5b9a\u4e49\u4e0e\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6 grub.cfg )\uff0c \u4e00\u822c\u6765\u8bf4\uff0c\u914d\u7f6e\u6587\u4ef6\u90fd\u5728 /boot \u5e95\u4e0b\u3002 [ root@dev ~ ] # ls -1p /boot/grub2 device.map # grub2 \u7684\u8bbe\u5907\u5bf9\u5e94\u6587\u4ef6 fonts/ # \u5f00\u673a\u8fc7\u7a0b\u4e2d\u7684\u753b\u9762\u4f1a\u4f7f\u7528\u5230\u7684\u5b57\u578b\u6570\u636e grub.cfg # grub2 \u7684\u4e3b\u914d\u7f6e\u6587\u4ef6 grubenv # \u4e00\u4e9b\u73af\u5883\u533a\u5757\u7684\u7b26\u53f7 i386-pc/ # \u9488\u5bf9\u4e00\u822c x86 PC \u6240\u9700\u8981\u7684 grub2 \u7684\u76f8\u5173\u6a21\u5757\uff0c\u4e0b\u9762\u6709\u5404\u79cd\u6a21\u5757 locale/ # \u8bed\u7cfb\u76f8\u5173\u7684\u6570\u636e 2. /boot/grub2/grub.cfg \u521d\u63a2 \u00b6 grub2 \u7684\u4f18\u70b9\u633a\u591a\u7684\uff0c\u5305\u62ec\u6709: \u8ba4\u8bc6\u4e0e\u652f\u6301\u8f83\u591a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528 grub2 \u7684\u4e3b\u7a0b\u5e8f\u76f4\u63a5\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u5bfb\u5185\u6838\u6587\u4ef6\u540d\uff1b \u5f00\u673a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5 \u81ea\u884c\u7f16\u8f91\u4e0e\u4fee\u6539\u5f00\u673a\u8bbe\u5b9a\u9879\u76ee \uff0c\u7c7b\u4f3c bash \u7684\u6307\u4ee4\u6a21\u5f0f\uff1b \u53ef\u4ee5\u52a8\u6001\u641c\u5bfb\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u5728\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u91cd\u65b0\u5b89\u88c5 grub2 \u3002\u4ea6\u5373\u662f\u6211\u4eec\u53ea\u8981\u4fee\u6539\u5b8c /boot/grub2/grub.cfg \u91cc\u5934\u7684\u8bbe\u5b9a\u540e\uff0c\u4e0b\u6b21\u5f00\u673a\u5c31\u751f\u6548\u4e86\u3002 2.1 \u78c1\u76d8\u4e0e\u5206\u533a\u69fd\u5728 grub2 \u4e2d\u7684\u4ee3\u53f7 \u00b6 grub2 \u5bf9\u786c\u76d8\u7684\u8bc6\u522b\uff08info grub2\uff09\u4f7f\u7528\u7684\u662f\u5982\u4e0b\u7684\u4ee3\u53f7\uff1a ( hd0,1 ) # \u4e00\u822c\u7684\u9ed8\u8ba4\u8bed\u6cd5,\u7531 grub2 \u81ea\u52a8\u5224\u65ad\u5206\u533a\u683c\u5f0f ( hd0,msdos1 ) # \u6b64\u78c1\u76d8\u7684\u5206\u533a\u4e3a\u4f20\u7edf\u7684 MBR \u6a21\u5f0f ( hd0,gpt1 ) # \u6b64\u78c1\u76d8\u7684\u5206\u533a\u4e3a GPT \u6a21\u5f0f \u786c\u76d8\u4ee3\u53f7\u4ee5\u5c0f\u62ec\u53f7 ( ) \u5305\u8d77\u6765\uff1b \u786c\u76d8\u4ee5 hd \u8868\u793a,\u540e\u9762\u4f1a\u63a5\u4e00\u7ec4\u6570\u5b57\uff1b \u4ee5 \u641c\u5bfb\u987a\u5e8f \u505a\u4e3a\u786c\u76d8\u7684\u7f16\u53f7\uff01(\u8fd9\u4e2a\u91cd\u8981\uff01) \u7b2c\u4e00\u4e2a\u641c\u5bfb\u5230\u7684\u786c\u76d8\u4e3a 0 \u53f7,\u7b2c\u4e8c\u4e2a\u4e3a 1 \u53f7\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff1b \u6bcf\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a partition \u4ee3\u53f7\u4e3a 1 \uff0c\u4f9d\u5e8f\u7c7b\u63a8\u3002 \u7531\u4e8e BIOS \u53ef\u4ee5\u8c03\u6574\u78c1\u76d8\u7684\u5f00\u673a\u987a\u5e8f\uff0c\u56e0\u6b64\u4e0a\u8ff0\u7684\u78c1\u76d8\u5bf9\u5e94\u7684 (hdN) \u90a3\u4e2a\u53f7\u7801 N \u662f\u53ef\u80fd\u4f1a\u53d8\u3002 \u4f8b\u5b50\uff1a \u786c\u76d8\u641c\u5bfb\u987a\u5e8f \u5728 Grub2 \u5f53\u4e2d\u7684\u4ee3\u53f7 \u7b2c\u4e00\u9897(MBR) (hd0) (hd0,msdos1) (hd0,msdos2) (hd0,msdos3).... \u7b2c\u4e8c\u9897(GPT) (hd1) (hd1,gpt1) (hd1,gpt2) (hd1,gpt3).... \u7b2c\u4e09\u9897 (hd2) (hd2,1) (hd2,2) (hd2,3).... \u7b2c\u4e00\u9897\u786c\u76d8\u7684 MBR \u5b89\u88c5\u5904\u7684\u786c\u76d8\u4ee3\u53f7\u5c31\u662f (hd0) \uff0c\u800c\u7b2c\u4e00\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u5206\u533a\u69fd\u7684 boot sector \u4ee3\u53f7\u5c31\u662f (hd0,msdos1) \uff0c\u7b2c\u4e00\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u5206\u533a\u69fd\u7684 boot sector \u4ee3\u53f7\u4e3a (hd0,msdos5) \u3002 2.2 /boot/grub2/grub.cfg \u914d\u7f6e\u6587\u4ef6(\u91cd\u70b9\u5728\u4e86\u89e3\uff0c\u4e0d\u8981\u968f\u4fbf\u6539!) \u00b6 [ root@dev ~ ] # vi /boot/grub2/grub.cfg # /etc/grub.d/00_header \u8fd9\u4e2a\u811a\u672c\u6267\u884c\u7684\u7ed3\u679c\u5c55\u793a,\u4e3b\u8981\u4e0e\u57fa\u7840\u8bbe\u5b9a\u73af\u5883\u6709\u5173 ### BEGIN /etc/grub.d/00_header ### \u2026\u2026 if [ x \" ${ feature_menuentry_id } \" = xy ] ; then menuentry_id_option = \"--id\" else menuentry_id_option = \"\" fi export menuentry_id_option \u2026\u2026 terminal_output console if [ x $feature_timeout_style = xy ] ; then set timeout_style = menu set timeout = 5 # Fallback normal timeout code in case the timeout_style feature is # unavailable. else set timeout = 5 fi ### END /etc/grub.d/00_header ### # /etc/grub.d/10_linux,\u4e3b\u8981\u9488\u5bf9\u5b9e\u9645\u7684 Linux \u5185\u6838\u6587\u4ef6\u7684\u5f00\u673a\u73af\u5883 ### BEGIN /etc/grub.d/10_linux ### menuentry 'CentOS Linux (3.10.0-1062.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-514.el7.x86_64-advanced-eb74cab9-cb1a-4f23-8719-b876f3b012cd' { load_video set gfxpayload = keep insmod gzio insmod part_msdos insmod xfs set root = 'hd0,msdos1' if [ x $feature_platform_search_hint = xy ] ; then search --no-floppy --fs-uuid --set = root --hint-bios = hd0,msdos1 --hint-efi = hd0,msdos1 --hint-baremetal = ahci0,msdos1 --hint = 'hd0,msdos1' 2029e8fc-9ca4-42fe-819e-c3fdead51690 else search --no-floppy --fs-uuid --set = root 2029e8fc-9ca4-42fe-819e-c3fdead51690 fi linux16 /vmlinuz-3.10.0-1062.el7.x86_64 root = /dev/mapper/cl-root ro crashkernel = auto rd.lvm.lv = cl/root rd.lvm.lv = cl/swap rhgb quiet LANG = en_US.UTF-8 initrd16 /initramfs-3.10.0-1062.el7.x86_64.img } \u2026\u2026 ### END /etc/grub.d/10_linux ### # \u5b9a\u5236\u83dc\u5355 ### BEGIN /etc/grub.d/40_custom ### # This file provides an easy way to add custom menu entries. Simply type the # menu entries you want to add after this comment. Be careful not to change # the 'exec tail' line above. ### END /etc/grub.d/40_custom ### \u2026\u2026 \u6bcf\u4e2a menuentry \u5c31\u662f\u4e00\u4e2a\u5f00\u673a\u9009\u5355\u55bd\uff0c { } \u4ee3\u8868\u9009\u62e9\u4e86\u8be5\u9009\u5355\u540e\u6267\u884c\u7684\u52a8\u4f5c\uff0c\u4e0b\u9762\u662f\u4e09\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u9879\u76ee\uff1a set root='hd0,msdos1' root \u662f\u6307\u5b9a grub2 \u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u90a3\u4e2a\u8bbe\u5907\uff1a [ root@dev ~ ] # lsblk -p /dev/sda1 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda1 8 :1 0 1G 0 part /boot linux16 /vmlinuz-...... root=/dev/mapper/cl-root ...... \u8fd9\u4e2a\u5c31\u662f Linux \u5185\u6838\u6587\u4ef6\u4ee5\u53ca\u5185\u6838\u6267\u884c\u65f6\u6240\u4e0b\u8fbe\u7684\u53c2\u6570\u3002\u5185\u6838\u6587\u4ef6\u7684\u8bbe\u5b9a\u8ddf\u4e0a\u9762\u7684 root \u6709\u5173\u3002\u6709\u6ca1\u6709 /boot \u5206\u533a\u662f\u4f1a\u5bf9\u6587\u4ef6\u540d\u6709\u5f71\u54cd\u7684\uff1a \u5982\u679c\u6ca1\u6709 /boot \u5206\u533a\uff0c\u4ec5\u6709 / \u5206\u533a\uff1a /boot/vmlinuz-xxx --> (/)/boot/vmlinuz-xxx --> (hd0,msdos1)/boot/vmlinuz-xxx \u5982\u679c /boot \u662f\u72ec\u7acb\u5206\u533a\uff1a /boot/vmlinuz-xxx --> (/boot)/vmlinuz-xxx --> (hd0,msdos1)/vmlinuz-xxx \u81f3\u4e8e\u672c\u547d\u4ee4\u7684 root \u6307\u7684\u662f linux \u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u6839\u76ee\u5f55\u662f\u5728\u54ea\u4e2a\u88c5\u7f6e\u4e0a \u7684\u610f\u601d\uff1a [ root@dev ~ ] # lsblk -p /dev/sda2 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda2 8 :2 0 49G 0 part \u251c\u2500/dev/mapper/cl-root 253 :0 0 44G 0 lvm / \u2514\u2500/dev/mapper/cl-swap 253 :1 0 5G 0 lvm [ SWAP ] initrd16 /initramfs-...... \u8fd9\u4e2a\u6863\u540d\u4e5f\u662f\u9700\u8981\u642d\u914d set root=xxx \u90a3\u4e2a\u9879\u76ee\u7684\u88c5\u7f6e\uff0c \u624d\u4f1a\u5f97\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u3002 3. grub2 \u914d\u7f6e\u6587\u4ef6\u7ef4\u62a4 /etc/default/grub \u4e0e /etc/grub.d \u00b6 3.1 \u4e3b\u8981\u73af\u5883\u914d\u7f6e\u6587\u4ef6 \u00b6 [ root@dev ~ ] # cat /etc/default/grub GRUB_TIMEOUT = 5 # \u6307\u5b9a\u9884\u8bbe\u5012\u6570\u8bfb\u79d2\u7684\u79d2\u6570 GRUB_DISTRIBUTOR = \" $( sed 's, release .*$,,g' /etc/system-release ) \" GRUB_DEFAULT = saved # \u6307\u5b9a\u9884\u8bbe\u7531\u54ea\u4e00\u4e2a\u9009\u5355\u6765\u5f00\u673a GRUB_DISABLE_SUBMENU = true # \u662f\u5426\u8981\u9690\u85cf\u6b21\u9009\u5355,\u901a\u5e38\u662f\u9690\u85cf GRUB_TERMINAL_OUTPUT = \"console\" # \u6307\u5b9a\u6570\u636e\u8f93\u51fa\u7684\u7ec8\u7aef\u673a\u683c\u5f0f,\u9ed8\u8ba4\u662f\u900f\u8fc7\u6587\u5b57\u7ec8\u7aef\u673a GRUB_CMDLINE_LINUX = \"crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet\" # \u5c31\u662f\u5728 menuentry \u62ec\u53f7\u5185\u7684 linux16 \u9879\u76ee\u540e\u7eed\u7684\u5185\u6838\u53c2\u6570 GRUB_DISABLE_RECOVERY = \"true\" # \u53d6\u6d88\u6551\u63f4\u9009\u5355\u7684\u5236\u4f5c \u662f\u5426\u9690\u85cf\u9009\u5355\u9879\u76ee\uff1aGRUB_TIMEOUT_STYLE \u53ef\u9009\u503c\uff1amenu, countdown, hidden\u3002countdown \u4f1a\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u5269\u4f59\u7684\u7b49\u5f85\u79d2\u6570\uff0c\u800c hidden \u5219\u7a7a\u7a7a\u5982\u4e5f\u3002 \u9ed8\u8ba4\u5f00\u673a\u9009\u5355\u9879\u76ee\uff1aGRUB_DEFAULT \u5047\u8bbe\u4f60\u6709\u4e09\u6761 menuentry \u7684\u9879\u76ee\u5927\u7ea6\u50cf\u8fd9\u6837\uff1a menuentry '1st linux system' --id 1st-linux-system { ...} menuentry '2nd linux system' --id 2nd-linux-system { ...} menuentry '3rd win system' --id 3rd-win-system { ...} \u90a3\u4e48\u51e0\u4e2a\u5e38\u89c1\u7684\u8bbe\u5b9a\u503c\u662f\u8fd9\u6837\u7684\uff1a GRUB_DEFAULT = 1 # \u4ee3\u8868\u4f7f\u7528\u7b2c\u4e8c\u4e2a menuentry \u5f00\u673a,\u56e0\u4e3a\u6570\u5b57\u7684\u7f16\u53f7\u662f\u4ee5 0 \u53f7\u5f00\u59cb\u7f16\u7684! GRUB_DEFAULT = 3rd-win-system # \u4ee3\u8868\u4f7f\u7528\u7b2c\u4e09\u4e2a menuentry \u5f00\u673a,\u56e0\u4e3a\u91cc\u5934\u4ee3\u8868\u7684\u662f ID \u7684\u9879\u76ee!\u5b83\u4f1a\u627e\u5230 --id \u5594! GRUB_DEFAULT = saved # \u4ee3\u8868\u4f7f\u7528 grub2-set-default \u6765\u8bbe\u5b9a\u54ea\u4e00\u4e2a menuentry \u4e3a\u9ed8\u8ba4\u503c\u7684\u610f\u601d\u3002\u901a\u5e38\u9884\u8bbe\u4e3a 0 \u5185\u6838\u7684\u5916\u52a0\u53c2\u6570\u529f\u80fd\uff1aGRUB_CMDLINE_LINUX \u5728\u5185\u6838\u542f\u52a8\u7684\u65f6\u5019\u52a0\u5165\u989d\u5916\u7684\u53c2\u6570\u3002 3.2 \u9009\u5355\u5185\u7f6e\u7684\u811a\u672c /etc/grub.d/* \u00b6 00_header \u4e3b\u8981\u5728\u5efa\u7acb\u521d\u59cb\u7684\u663e\u793a\u9879\u76ee\u3002\u5927\u90e8\u5206\u5728 /etc/default/grub \u91cc\u9762\u6240\u8bbe\u5b9a\u7684\u53d8\u91cf\uff0c\u5927\u6982\u90fd\u4f1a\u5728\u8fd9\u4e2a\u811a\u672c\u5f53\u4e2d\u88ab\u5229\u7528\u6765\u91cd\u5efa grub.cfg \u3002 10_linux \u6839\u636e\u5206\u6790 /boot \u5e95\u4e0b\u7684\u6587\u4ef6\uff0c\u5c1d\u8bd5\u627e\u5230\u6b63\u786e\u7684 linux \u5185\u6838\u4e0e\u8bfb\u53d6\u8fd9\u4e2a\u5185\u6838\u9700\u8981\u7684\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757\u4e0e\u53c2\u6570\u7b49\uff0c\u90fd\u5728\u8fd9\u4e2a\u811a\u672c\u8fd0\u4f5c\u540e\u627e\u5230\u5e76\u8bbe\u5b9a\u5230 grub.cfg \u5f53\u4e2d\u3002 30_os-prober \u8fd9\u4e2a\u811a\u672c\u9ed8\u8ba4\u4f1a\u5230\u7cfb\u7edf\u4e0a\u627e\u5176\u4ed6\u7684 partition \u91cc\u9762\u53ef\u80fd\u542b\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7136\u540e\u5c06\u8be5\u64cd\u4f5c\u7cfb\u7edf\u505a\u6210\u9009\u5355\u6765\u5904\u7406\u5c31\u662f\u4e86\u3002\u4f7f\u7528 GRUB_DISABLE_OS_PROBER=true \u6765\u5173\u95ed\u5b83\u3002 40_custom \u5728\u8fd9\u91cc\u8865\u5145\u81ea\u5b9a\u4e49\u9009\u5355\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u6539\u52a8\u5c31\u662f\u4ec5\u6709 40_custom \u8fd9\u4e2a\u6587\u4ef6\u3002 3.2.1 menuentry \u7684\u8bbe\u7f6e \u00b6 \u76f4\u63a5\u6307\u5b9a\u5185\u6838\u5f00\u673a \u5982\u679c\u4f60\u6709\u6bd4\u8f83\u7279\u522b\u7684\u53c2\u6570\u9700\u8981\u4fee\u6539\uff1a(1)\u5148\u5230 grub.cfg \u5f53\u4e2d\u53d6\u5f97\u4f60\u8981\u5236\u4f5c\u7684\u90a3\u4e2a\u5185\u6838\u7684\u9009\u5355\u9879\u76ee\uff0c\u7136\u540e\u5c06\u5b83\u590d\u5236\u523040_custom \u5f53\u4e2d (2)\u518d\u5230 40_custom \u5f53\u4e2d\u4f9d\u636e\u4f60\u7684\u9700\u6c42\u4fee\u6539\u5373\u53ef\u3002 \u900f\u8fc7 chainloader \u7684\u65b9\u5f0f\u79fb\u4ea4 loader \u63a7\u5236\u6743 grub2 \u5e76\u4e0d\u9700\u8981\u8ba4\u8bc6\u4e0e\u627e\u51fa kernel \u7684\u6587\u4ef6\u540d\uff0c \u53ea\u662f\u5c06 boot \u7684\u63a7\u5236\u6743\u4ea4\u7ed9\u4e0b\u4e00\u4e2a boot sector \u6216 MBR \u5185\u7684 boot loader \u800c\u5df2 \u3002\u6240\u4ee5\u901a\u5e38\u4ed6\u4e5f\u4e0d\u9700\u8981\u53bb\u67e5\u9a8c\u4e0b\u4e00\u4e2a boot loader \u7684\u6587\u4ef6\u7cfb\u7edf\u3002 \u4e00\u822c\u6765\u8bf4\uff0c chain loader \u7684\u8bbe\u5b9a\u53ea\u8981\u4e24\u4e2a\u5c31\u591f\u4e86\uff0c\u4e00\u4e2a\u662f\u9884\u8ba1\u8981\u524d\u5f80\u7684 boot sector \u6240\u5728\u7684\u5206\u533a\u69fd\u4ee3\u53f7\uff0c\u53e6\u4e00\u4e2a\u5219\u662f\u8bbe\u7f6e chainloader \u4e3a\u90a3\u4e2a\u5206\u533a\u69fd\u7684 boot sector (\u7b2c\u4e00\u4e2a\u6247\u533a) \u4e0a\u3002\u4f8b\u5b50\uff1a [ root@linux ~ ] # cat /etc/grub.d/40_custom \u2026\u2026 # \u5c06\u63a7\u5236\u6743\u4ea4\u7ed9 windows \u7684 loader menuentry \"Windows\" { insmod chain # \u4f60\u5f97\u8981\u5148\u52a0\u8f7d chainloader \u7684\u6a21\u5757\u5bf9\u5427? insmod ntfs # \u5efa\u8bae\u52a0\u5165 windows \u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757\u8f83\u4f73! set root =( hd0,1 ) # \u662f\u5728\u54ea\u4e00\u4e2a\u5206\u533a\u69fd~\u6700\u91cd\u8981\u7684\u9879\u76ee! chainloader +1 # \u8bf7\u53bb boot sector \u5c06 loader \u8f6f\u4ef6\u8bfb\u51fa\u6765\u7684\u610f\u601d! } # \u56de\u5230 MBR \u7684\u9884\u8bbe\u73af\u5883 menuentry 'Go to MBR' $menuentry_id_option 'mbr' { insmod chain insmod part_gpt set root =( hd0 ) chainloader +1 } 3.3 \u91cd\u65b0\u751f\u6210\u914d\u7f6e\u6587\u4ef6 \u00b6 \u5728\u6bcf\u6b21\u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u90fd\u9700\u8981\u6267\u884c grub2-mkconfig \u6307\u4ee4\u6765\u91cd\u65b0\u751f\u6210 grub.cfg \u6587\u4ef6 grub2-mkconfig -o /boot/grub2/grub.cfg 4. \u65b0\u5efa initramfs \u6587\u4ef6 \u00b6 \u4e00\u822c\u6765\u8bf4\uff0c\u9700\u8981 initramfs \u7684\u65f6\u523b\u4e3a: \u6839\u76ee\u5f55\u6240\u5728\u78c1\u76d8\u4e3a SATA\u3001USB \u6216 SCSI \u7b49\u8fde\u63a5\u63a5\u53e3\uff1b \u6839\u76ee\u5f55\u6240\u5728\u6587\u4ef6\u7cfb\u7edf\u4e3a LVM, RAID \u7b49\u7279\u6b8a\u683c\u5f0f\uff1b \u6839\u76ee\u5f55\u6240\u5728\u6587\u4ef6\u7cfb\u7edf\u4e3a\u975e\u4f20\u7edf Linux \u8ba4\u8bc6\u7684\u6587\u4ef6\u7cfb\u7edf\u65f6\uff1b \u5176\u4ed6\u5fc5\u987b\u8981\u5728\u6838\u5fc3\u52a0\u8f7d\u65f6\u63d0\u4f9b\u7684\u6a21\u5757\u3002 Linux \u5185\u6838\u672c\u8eab\u5c31\u8ba4\u8bc6 IDE \u63a5\u53e3\u7684\u78c1\u76d8\uff0c\u56e0\u6b64\u4e0d\u9700\u8981 initramfs \u4e5f\u53ef\u4ee5\u987a\u5229\u5f00\u673a\u3002 \u5982\u679c\u6709\u7279\u6b8a\u9700\u8981\u6240\u4ee5\u60f3\u91cd\u5236 initramfs \u6587\u4ef6\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 dracut/mkinitrd \u6765\u5904\u7406\u3002 dracut [ OPTION... ] [ <image> [<kernel version> ] ] \u751f\u6210\u4e00\u4e2a initramfs \u6587\u4ef6 OPTION - v , --verbose --kver [VERSION] Set kernel version to [VERSION]. - f , --force Overwrite existing initramfs file. --add-drivers [LIST] \u5728\u539f\u672c\u7684\u9ed8\u8ba4\u6838\u5fc3\u6a21\u5757\u4e2d,\u589e\u52a0\u67d0\u4e9b\u4f60\u60f3\u8981\u7684\u6a21\u5757\uff0c\u6a21\u5757\u4f4d\u4e8e\u5185\u6838\u6240\u5728\u76ee\u5f55 / lib / modules / $ ( uname - r ) / kernel /*\u3002LIST \u683c\u5f0f\u4e3a \"module1 module2 ...\" --omit-drivers [LIST] \u6307\u5b9a\u4e0d\u6dfb\u52a0\u5230 initramfs \u4e2d\u7684\u6a21\u5757\u3002 --filesystems [LIST] \u52a0\u5165\u67d0\u4e9b\u989d\u5916\u7684\u6587\u4ef6\u7cfb\u7edf\u652f\u6301 dracut -v --add-drivers \"e1000e\" --filesystems \"ext4 nfs\" 5. \u6d4b\u8bd5\u4e0e\u5b89\u88c5 grub2 \u00b6 \u5982\u679c\u4f60\u7684 Linux \u539f\u6765\u4f7f\u7528\u7684\u5e76\u975e grub2\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5b89\u88c5\u4e86\u3002 \u9996\u5148\uff0c\u4f60\u5fc5\u987b\u8981\u4f7f\u7528 grub-install \u5c06\u4e00\u4e9b\u5fc5\u8981\u7684\u6587\u4ef6\u590d\u5236\u5230 /boot/grub2 \u91cc\u9762\u53bb\uff1a grub2 - install [ OPTION ...] [ INSTALL_DEVICE ] OPTION -- boot - directory = DIR install GRUB images under the directory DIR / grub2 instead of the boot / grub2 directory - s , -- skip - fs - probe do not probe for filesystems in DEVICE -- force install even if problems are detected -- recheck delete device map if it already exists INSTALL_DEVICE \uff1a\u8981\u5b89\u88c5\u7684\u8bbe\u5907 \u57fa\u672c\u4e0a\uff0cgrub2-install \u5927\u6982\u4ec5\u80fd\u5b89\u88c5 grub2 \u4e3b\u7a0b\u5e8f\u4e0e\u76f8\u5173\u8f6f\u4ef6\u5230 /boot/grub2/ \u90a3\u4e2a\u76ee\u5f55\u53bb\uff0c \u5982\u679c\u540e\u9762\u7684\u8bbe\u5907\u586b\u7684\u662f\u6574\u4e2a\u7cfb\u7edf ( /dev/vda, /dev/sda... )\uff0c\u90a3 loader \u7684\u7a0b\u5e8f\u624d\u4f1a\u5199\u5165\u5230 MBR \u91cc\u9762\u53bb \u3002 # \u66f4\u65b0 /boot/grub2/ [ root@linux ~ ] # grub2-install /dev/sda Installing for i386-pc platform. Installation finished. No error reported. [ root@linux ~ ] # ll /boot/grub2/ total 28 drwxr-xr-x. 2 root root 25 Jul 31 14 :27 fonts -rw-r--r--. 1 root root 4287 Jul 31 14 :28 grub.cfg -rw-r--r--. 1 root root 1024 Jul 31 14 :28 grubenv drwxr-xr-x. 2 root root 8192 Dec 11 17 :26 i386-pc drwxr-xr-x. 2 root root 4096 Dec 11 17 :26 locale \u5982\u679c\u662f XFS \u6587\u4ef6\u7cfb\u7edf\u7684\u67d0\u4e2a\u5206\u533a\uff0cgrub2-install \u4f1a\u62a5\u9519\uff0c\u6307\u51fa\u4e0d\u652f\u6301\u8be5\u6587\u4ef6\u7cfb\u7edf\uff1a # \u5c06 (/dev/sda2) \u7684 grub2 \u5b89\u88c5\u5230 /dev/sda4 \u4e0e MBR \u4e2d [ root@linux ~ ] # df -Th Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/centos-root xfs 10G 1 .2G 8 .9G 12 % / devtmpfs devtmpfs 899M 0 899M 0 % /dev tmpfs tmpfs 911M 0 911M 0 % /dev/shm tmpfs tmpfs 911M 9 .6M 902M 2 % /run tmpfs tmpfs 911M 0 911M 0 % /sys/fs/cgroup /dev/mapper/centos-home xfs 5 .0G 33M 5 .0G 1 % /home /dev/sda2 xfs 1014M 142M 873M 14 % /boot tmpfs tmpfs 183M 0 183M 0 % /run/user/0 /dev/sda4 xfs 2 .0G 33M 2 .0G 2 % /root/sda4 [ root@linux ~ ] # grub2-install /dev/sda4 Installing for i386-pc platform. grub2-install: error: hd0 appears to contain a xfs filesystem which isn 't known to reserve space for DOS-style boot. Installing GRUB there could result in FILESYSTEM DESTRUCTION if valuable data is overwritten by grub-setup (--skip-fs-probe disables this check, use at your own risk). [root@linux ~]# grub2-install --skip-fs-probe /dev/sda4 Installing for i386-pc platform. grub2-install: warning: File system `xfs' doesn 't support embedding. grub2-install: warning: Embedding is not possible. GRUB can only be installed in this setup by using blocklists. However, blocklists are UNRELIABLE and their use is discouraged.. grub2-install: error: will not proceed with blocklists. # \u5b89\u88c5\u6210\u529f\uff01\uff01\uff01 [root@linux ~]# grub2-install --skip-fs-probe --force --recheck /dev/sda4 Installing for i386-pc platform. grub2-install: warning: File system `xfs' doesn ' t support embedding. grub2-install: warning: Embedding is not possible. GRUB can only be installed in this setup by using blocklists. However, blocklists are UNRELIABLE and their use is discouraged.. Installation finished. No error reported. [ root@linux ~ ] # ll /boot/grub2/ total 28 drwxr-xr-x. 2 root root 25 Jul 31 14 :27 fonts -rw-r--r--. 1 root root 4287 Jul 31 14 :28 grub.cfg -rw-r--r--. 1 root root 1024 Jul 31 14 :28 grubenv drwxr-xr-x. 2 root root 8192 Dec 11 17 :27 i386-pc drwxr-xr-x. 2 root root 4096 Dec 11 17 :27 locale \u4e0a\u9762\u8fd9\u6837\u5c31\u5c06 grub2 \u7684\u4e3b\u7a0b\u5e8f\u5b89\u88c5\u5230 /dev/sda4 \u4ee5\u53ca\u91cd\u65b0\u5b89\u88c5\u5230 MBR \u91cc\u9762\u53bb\u4e86\u3002 Warning \u5982\u679c\u4f60\u5f53\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5728\u90a3\u5757\u78c1\u76d8\u4e0a\uff0c\u90a3\u4e48\u4f60\u662f\u4e0d\u80fd\u64cd\u4f5c\u6210\u529f\u7684\uff01\uff01\uff01\u6bd4\u5982\u4f60\u73b0\u5728\u8fdb\u5165\u7684\u662f\u4f4d\u4e8e /dev/sda \u7684OS\uff0c\u4f60\u662f\u65e0\u6cd5\u4e3a /dev/sdb \u5b89\u88c5 grub2 \u7684\uff01 5.1 \u9e1f\u54e5\u4e3e\u4f8b \u00b6 Important \u5982\u679c\u662f\u591a\u91cd\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9700\u8981\u91cd\u65b0\u8fdb\u5165\u65b0\u7cfb\u7edf\u624d\u80fd\u591f\u5b89\u88c5\u5566\uff01 \u5047\u8bbe\u4f60\u7684\u6d4b\u8bd5\u7cfb\u7edf\u4e0a\u9762\u4f7f\u7528 MBR \u5206\u533a\u69fd\uff0c\u5e76\u4e14\u51fa\u73b0\u5982\u4e0b\u7684\u6570\u636e\uff1a [ root @ study ~ ]# fdisk - l / dev / vda Device Boot Start End Blocks Id System / dev / vda1 2048 6143 2048 83 Linux / dev / vda2 * 6144 2103295 1048576 7 HPFS / NTFS / exFAT / dev / vda3 2103296 54540287 26218496 8 e Linux \u5176\u4e2d /dev/vda1, /dev/vda3 \u662f\u4e24\u4e2a CentOS 7 \u7cfb\u7edf,\u800c /dev/vda2 \u5219\u662f windows 7 \u7cfb\u7edf\u3002 \u5b89\u88c5\u7684\u6d41\u7a0b\u662f\u4f9d\u5e8f /dev/vda1 --> /dev/vda2 --> /dev/vda3 \u3002\u56e0\u6b64\uff0c\u5b89\u88c5\u597d\u800c\u4e14\u91cd\u65b0\u542f\u52a8\u540e\uff0c\u7cfb\u7edf\u5176\u5b9e\u662f\u9ed8\u8ba4\u8fdb\u5165 /dev/vda3 \u8fd9\u4e2a CentOS 7 \u7684\u7cfb\u7edf\u7684\u3002\u6b64\u65f6 MBR \u4f1a\u53bb\u8bfb\u53d6\u7684\u914d\u7f6e\u6587\u4ef6\u5728 (/dev/vda3)/boot/grub2/grub.cfg \u624d\u5bf9\u3002 \u90a3\u5982\u4f55\u8ba9\u7cfb\u7edf\u6c38\u8fdc\u90fd\u662f\u4f7f\u7528 /dev/vda1 \u5f00\u673a\u5462\uff1f\u56e0\u4e3a MBR \u7684 boot loader \u5e94\u8be5\u8981\u53bb (/dev/vda1)/boot/grub2/grub.cfg \u8bfb\u53d6\u76f8\u5173\u8bbe\u5b9a\u624d\u662f\u6b63\u5e38\u7684\uff01\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u51e0\u79cd\u57fa\u672c\u7684\u65b9\u5f0f\u6765\u5904\u7406\uff1a \u56e0\u4e3a CentOS 7 \u4f1a\u4e3b\u52a8\u627e\u5230\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u5728 /dev/vda3 \u7684\u5f00\u673a\u9009\u5355\u4e2d\u627e\u5230 /dev/vda1 \u7684\u5f00\u673a\u9009\u9879\uff0c\u8bf7\u7528\u8be5\u9009\u9879\u8fdb\u5165\u7cfb\u7edf\uff0c \u4f60\u5c31\u80fd\u591f\u8fdb\u5165 /dev/vda1 \u4e86\uff01 \u5047\u8bbe\u6ca1\u80fd\u6293\u5230 /dev/vda1 \uff0c\u90a3\u4f60\u53ef\u4ee5\u5728 /dev/vda3 \u5e95\u4e0b\u4f7f\u7528 chroot \u6765\u8fdb\u5165 /dev/vda1 \u5594\uff01 \u4f7f\u7528\u6551\u63f4\u5149\u76d8\u53bb\u6293\u5230\u6b63\u786e\u7684 /dev/vda1\uff0c\u7136\u540e\u53d6\u5f97 /dev/vda1 \u7684\u7cfb\u7edf\u5594\uff01 \u8fdb\u5165\u7cfb\u7edf\u4e4b\u540e\uff1a\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08\u53ef\u9009\uff09\uff0c grub2-mkconfig -o /boot/grub2/grub.cfg \uff0c grub2-install /dev/vda \uff0c\u5c31\u80fd\u591f\u8ba9\u4f60\u7684 MBR \u53bb\u53d6\u5f97 /dev/vda1 \u5185\u7684\u914d\u7f6e\u6587\u4ef6\u5570\uff01 6. \u5f00\u673a\u524d\u7684\u989d\u5916\u529f\u80fd\u4fee\u6539 \u00b6 \u5728\u5f00\u673a\u754c\u9762\u53ef\u4ee5\u4fee\u6539 grub2 \u7684\u914d\u7f6e\u54e6 \u5728\u5f00\u673a\u754c\u9762\u7f16\u8f91 grub2\uff0c\u542f\u7528\u6551\u63f4\u6a21\u5f0f\uff1a \u6ce8\u610f \uff1a\u4e00\u65e6\u4f60\u9000\u51fa\u4e86\u7f16\u8f91\u754c\u9762\u800c\u4e0d\u662f\u76f4\u63a5\u5f00\u673a\uff0c\u90a3\u4e48\u6240\u6709\u7684\u7f16\u8f91\u90fd\u4e0d\u4f1a\u4fdd\u5b58\u4e0e\u751f\u6548\u3002 \u65e9\u671f SystemV \u7684\u7cfb\u7edf\u4e2d,\u8fdb\u5165 runlevel 1 \u7684\u72b6\u6001\u662f\u4e0d\u9700\u8981\u8f93\u5165 root \u5bc6\u7801\u7684\uff01\u5728 systemd \u4e2d\u5982\u679c\u5fd8\u8bb0\u4e86root\u5bc6\u7801\uff0c\u5c31\u8981\u4f7f\u7528\u522b\u7684\u65b9\u6cd5\u4e86\uff01 7. \u4e3a\u4e2a\u522b\u9009\u5355\u52a0\u4e0a\u5bc6\u7801 \u00b6 \u5728 grub2 \u7684\u9009\u5355\u7ba1\u7406\u4e2d\uff0c\u6709\u9488\u5bf9\u4e24\u79cd\u8eab\u4efd\u8fdb\u884c\u5bc6\u7801\u8bbe\u5b9a: superusers\uff1a \u8bbe\u5b9a\u7cfb\u7edf\u7ba1\u7406\u5458\u4e0e\u76f8\u5173\u53c2\u6570\u8fd8\u6709\u5bc6\u7801\u7b49\uff0c\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u7684\u7528\u6237\uff0c\u5c06\u53ef\u5728 grub2 \u5185\u5177\u6709\u6240\u6709\u4fee \u6539\u7684\u6743\u9650\u3002 \u4f46\u4e00\u65e6\u8bbe\u5b9a\u4e86\u8fd9\u4e2a superusers \u7684\u53c2\u6570\uff0c\u5219\u6240\u6709\u7684\u6307\u4ee4\u4fee\u6539\u5c06\u4f1a\u88ab\u53d8\u6210\u53d7\u9650\u5236\u7684 \uff01 users\uff1a \u8bbe\u5b9a\u4e00\u822c\u8d26\u53f7\u7684\u76f8\u5173\u53c2\u6570\u4e0e\u5bc6\u7801\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u591a\u4e2a\u7528\u6237\u5594\uff01\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u7684\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u8981\u8fdb\u5165\u67d0\u4e9b \u9009\u5355\u9879\u76ee\u3002 \u4e0d\u8fc7\uff0c\u9009\u5355\u9879\u76ee\u4e5f\u5f97\u8981\u642d\u914d\u76f8\u5bf9\u7684\u8d26\u53f7\u624d\u884c\u5594\uff01(\u4e00\u822c\u6765\u8bf4\uff0c\u4f7f\u7528\u8fd9\u79cd\u5bc6\u7801\u7684\u8d26\u53f7\u5e76\u4e0d\u80fd\u4fee\u6539\u9009 \u5355\u7684\u5185\u5bb9\uff0c \u4ec5\u80fd\u9009\u62e9\u8fdb\u5165\u9009\u5355\u53bb\u5f00\u673a\u800c\u5df2 ) \u5bc6\u7801\u7684\u7ed9\u4e88\u6709\u4e24\u79cd\u8bed\u6cd5\uff1a password_pbkdf2 \u8d26\u53f7 \u4f7f\u7528 grub2-mkpasswd-pbkdf2 \u6240\u4ea7\u751f\u7684\u5bc6\u7801 password \u8d26\u53f7 \u6ca1\u52a0\u5bc6\u7684\u660e\u6587\u5bc6\u7801 password_pbkdf2 \u7684\u751f\u6210\u65b9\u6cd5\uff1a [ root@linux ~ ] # grub2-mkpasswd-pbkdf2 Enter password: Reenter password: PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.D5D87FCB8A91E15669072A33A16EC9B5353A300A6515D102A73167122564FE8BDEE7C6BC3F989BDF574CB6CA1F45EC74A9F5C5B6A040DE67794404D09CA439D7.ADAE646439BC01833A91C9C70D5E3791750A2069E7C3DF4C1BEAA1F6456110F1D41BDB34DE76ED7389A9CFA0F80A79145EC11F9601C4D142D3D0D8D98F0F2C5F \u628a\u4e0a\u9762\u751f\u6210\u7684hash\u503c\u653e\u5230password_pbkdf2\u7684\u5bf9\u5e94\u5b57\u6bb5\u4e2d\u5373\u53ef\u3002 \u5c06\u8d26\u6237\u4e0emenuentry\u7ed1\u5b9a\u7684\u9009\u9879\u662f --unrestricted \u4e0e --user \u3002 --unrestricted \u8868\u793a\u53ef\u4ee5\u76f4\u63a5\u5f00\u673a\uff08\u65e0\u9700\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\uff0c --user \u53ef\u4ee5\u6307\u5b9a\u54ea\u4e9b\u8d26\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u9009\u5355\u5f00\u673a\uff08\u9700\u8981\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\uff1a menuentry \"\u5927\u5bb6\u90fd\u53ef\u4ee5\u9009\u62e9\u6211\u6765\u5f00\u673a\u5594!\" --unrestricted { set root =( hd0,1 ) chainloader +1 } menuentry \"\u53ea\u6709\u7ba1\u7406\u5458\u7684\u5bc6\u7801\u624d\u6709\u529e\u6cd5\u4f7f\u7528\" --users \"\" { set root =( hd0,2 ) chainloader +1 } menuentry \"\u53ea\u6709\u7ba1\u7406\u5458\u4e0e dmtsai \u624d\u6709\u529e\u6cd5\u4f7f\u7528\u5594!\" --users dmtsai { set root =( hd0,3 ) chainloader +1 } \u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u4e0d\u8981\u5fd8\u8bb0\u91cd\u65b0\u751f\u6210 grub.cfg \u6587\u4ef6\u54e6\uff01 \u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5728\u54ea\u91cc\u5b9a\u4e49\u8d26\u6237\u5bc6\u7801\u3002 7.1 grub2 \u5bc6\u7801\u8bbe\u5b9a\u7684\u6587\u4ef6\u4f4d\u7f6e\u4e0e\u52a0\u5bc6\u7684\u5bc6\u7801 \u00b6 \u5728\u9e1f\u54e5\u7684\u7248\u672c\u662f\u8fd9\u6837\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\uff1a [ root@study ~ ] # vim /etc/grub.d/01_users cat << eof set superusers=\"vbird\" password_pbkdf2 vbird grub.pbkdf2.sha512.10000.9A2EBF7A1F484904FF3681F97AE22D58DFBFE65A... password_pbkdf2 dmtsai grub.pbkdf2.sha512.10000.B59584C33BC12F3C9DB8B18BE9F557631473AED... eof [ root@study ~ ] # chmod a+x /etc/grub.d/01_users \u4f46\u662f\u5728 CentOS Linux release 7.5.1804 (Core) \u4e2d\u8be5\u6587\u4ef6\u53d8\u6210\u4e86\u8fd9\u6837\uff1a [ root@linux ~ ] # cat /etc/grub.d/01_users #!/bin/sh -e cat << EOF if [ -f \\${prefix}/user.cfg ]; then source \\${prefix}/user.cfg if [ -n \"\\${GRUB2_PASSWORD}\" ]; then set superusers=\"root\" export superusers password_pbkdf2 root \\${GRUB2_PASSWORD} fi fi EOF \u4ece\u6587\u4ef6\u4e2d\u770b\u51fa\u5f53\u524d\u7248\u672c\u662f\u5728 ${prefix}/user.cfg \u4e2d\u5b9a\u4e49\u8d26\u6237\u5bc6\u7801\u7684\uff0c\u8fd9\u4e2a ${prefix} \u5728 grub.cfg \u6587\u4ef6\u4e2d\u7684\u8bed\u53e5 if [ -s $prefix/grubenv ]; \u53ef\u4ee5\u731c\u6d4b\u5b83\u5176\u5b9e\u5c31\u662f\u76ee\u5f55 /boot/grub2/ \uff0c\u6240\u4ee5\u73b0\u5728\u6211\u4eec\u8981\u5728 /boot/grub2/user.cfg \u4e2d\u5b9a\u4e49\u8d26\u6237\u5566\uff1a [ root@linux ~ ] # cat /boot/grub2/user.cfg # \u5b9a\u4e49\u54ea\u4e9b\u662f\u8d85\u7ea7\u7528\u6237\uff0c\u53ef\u4ee5\u505a\u6240\u6709\u7684\u52a8\u4f5c\uff1b\u666e\u901a\u7528\u6237\u53ea\u80fd\u5f00\u673a set superusers = \"sink\" # \u5b89\u5168\u7684\u8bbe\u7f6e\u5bc6\u7801 password_pbkdf2 sink grub.pbkdf2.sha512.10000.D5D87FCB8A91E15669072A33A16EC9B5353A300A6515D102A73167122564FE8BDEE7C6BC3F989BDF574CB6CA1F45EC74A9F5C5B6A040DE67794404D09CA439D7.ADAE646439BC01833A91C9C70D5E3791750A2069E7C3DF4C1BEAA1F6456110F1D41BDB34DE76ED7389A9CFA0F80A79145EC11F9601C4D142D3D0D8D98F0F2C5F # \u4e0d\u5b89\u5168\u7684\u8bbe\u7f6e\u5bc6\u7801 password grub2_user1 1234","title":"24 grub2"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#1-boot-loader-stage","text":"\u5728\u524d\u6587 \u5f00\u673a\u6d41\u7a0b \u4e2d\u63d0\u5230\uff0c\u5728 BIOS \u8bfb\u5b8c\u4fe1\u606f\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4f1a\u5230\u7b2c\u4e00\u4e2a\u5f00\u673a\u8bbe\u5907\u7684 MBR \u53bb\u8bfb\u53d6 boot loader \u4e86\u3002 \u4f46 MBR \u662f\u6574\u4e2a\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a sector \u5185\u7684\u4e00\u4e2a\u533a\u5757\uff0c\u5145\u5176\u91cf\u6574\u4e2a\u5927\u5c0f\u4e5f\u624d 446 bytes \u800c\u5df2\u3002\u5373\u4f7f\u662f GPT \u4e5f\u6ca1\u6709\u5f88\u5927\u7684\u6247\u533a\u6765\u50a8\u5b58 loader \u7684\u6570\u636e\u3002\u8fd9\u4e2a\u5927\u5c0f\u80af\u5b9a\u662f\u4e0d\u591f\u7528\u7684\u3002\u5173\u4e8e\u78c1\u76d8\u7684\u8be6\u7ec6\u4ecb\u7ecd\u53c2\u8003\u300a\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc\u300b\u7b2c\u4e8c\u7ae0\u7684 2.2 \u78c1\u76d8\u5206\u533a \u5c0f\u8282\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cLinux \u5c06 boot loader \u7684\u7a0b\u5e8f\u4ee3\u7801\u6267\u884c\u4e0e\u8bbe\u5b9a\u503c\u52a0\u8f7d\u5206\u6210\u4e24\u4e2a\u9636\u6bb5 (stage)\u6765\u6267\u884c: Stage 1\uff1a\u6267\u884c boot loader \u4e3b\u7a0b\u5e8f\uff1a \u7b2c\u4e00\u9636\u6bb5\u4e3a\u6267\u884c boot loader \u7684\u4e3b\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u4e3b\u7a0b\u5e8f\u5fc5\u987b\u8981\u88ab\u5b89\u88c5\u5728\u5f00\u673a\u533a\uff0c\u4ea6\u5373\u662f MBR \u6216\u8005\u662f boot sector \u3002\u4f46\u5982\u524d\u6240\u8ff0\uff0c\u56e0\u4e3a MBR \u5b9e\u5728\u592a\u5c0f\u4e86\uff0c\u6240\u4ee5\uff0cMBR \u6216 boot sector \u901a\u5e38\u4ec5\u5b89\u88c5 boot loader \u7684\u6700\u5c0f\u4e3b\u7a0b\u5e8f\uff0c \u5e76\u6ca1\u6709\u5b89\u88c5 loader \u7684\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\uff1b Stage 2\uff1a\u4e3b\u7a0b\u5e8f\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff1a \u7b2c\u4e8c\u9636\u6bb5\u4e3a\u900f\u8fc7 boot loader \u52a0\u8f7d\u6240\u6709\u914d\u7f6e\u6587\u4ef6\u4e0e\u76f8\u5173\u7684\u73af\u5883\u53c2\u6570\u6587\u4ef6 (\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u5b9a\u4e49\u4e0e\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6 grub.cfg )\uff0c \u4e00\u822c\u6765\u8bf4\uff0c\u914d\u7f6e\u6587\u4ef6\u90fd\u5728 /boot \u5e95\u4e0b\u3002 [ root@dev ~ ] # ls -1p /boot/grub2 device.map # grub2 \u7684\u8bbe\u5907\u5bf9\u5e94\u6587\u4ef6 fonts/ # \u5f00\u673a\u8fc7\u7a0b\u4e2d\u7684\u753b\u9762\u4f1a\u4f7f\u7528\u5230\u7684\u5b57\u578b\u6570\u636e grub.cfg # grub2 \u7684\u4e3b\u914d\u7f6e\u6587\u4ef6 grubenv # \u4e00\u4e9b\u73af\u5883\u533a\u5757\u7684\u7b26\u53f7 i386-pc/ # \u9488\u5bf9\u4e00\u822c x86 PC \u6240\u9700\u8981\u7684 grub2 \u7684\u76f8\u5173\u6a21\u5757\uff0c\u4e0b\u9762\u6709\u5404\u79cd\u6a21\u5757 locale/ # \u8bed\u7cfb\u76f8\u5173\u7684\u6570\u636e","title":"1. boot loader \u7684\u4e24\u4e2a stage"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#2-bootgrub2grubcfg","text":"grub2 \u7684\u4f18\u70b9\u633a\u591a\u7684\uff0c\u5305\u62ec\u6709: \u8ba4\u8bc6\u4e0e\u652f\u6301\u8f83\u591a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528 grub2 \u7684\u4e3b\u7a0b\u5e8f\u76f4\u63a5\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u5bfb\u5185\u6838\u6587\u4ef6\u540d\uff1b \u5f00\u673a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5 \u81ea\u884c\u7f16\u8f91\u4e0e\u4fee\u6539\u5f00\u673a\u8bbe\u5b9a\u9879\u76ee \uff0c\u7c7b\u4f3c bash \u7684\u6307\u4ee4\u6a21\u5f0f\uff1b \u53ef\u4ee5\u52a8\u6001\u641c\u5bfb\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u5728\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\u91cd\u65b0\u5b89\u88c5 grub2 \u3002\u4ea6\u5373\u662f\u6211\u4eec\u53ea\u8981\u4fee\u6539\u5b8c /boot/grub2/grub.cfg \u91cc\u5934\u7684\u8bbe\u5b9a\u540e\uff0c\u4e0b\u6b21\u5f00\u673a\u5c31\u751f\u6548\u4e86\u3002","title":"2. /boot/grub2/grub.cfg \u521d\u63a2"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#21-grub2","text":"grub2 \u5bf9\u786c\u76d8\u7684\u8bc6\u522b\uff08info grub2\uff09\u4f7f\u7528\u7684\u662f\u5982\u4e0b\u7684\u4ee3\u53f7\uff1a ( hd0,1 ) # \u4e00\u822c\u7684\u9ed8\u8ba4\u8bed\u6cd5,\u7531 grub2 \u81ea\u52a8\u5224\u65ad\u5206\u533a\u683c\u5f0f ( hd0,msdos1 ) # \u6b64\u78c1\u76d8\u7684\u5206\u533a\u4e3a\u4f20\u7edf\u7684 MBR \u6a21\u5f0f ( hd0,gpt1 ) # \u6b64\u78c1\u76d8\u7684\u5206\u533a\u4e3a GPT \u6a21\u5f0f \u786c\u76d8\u4ee3\u53f7\u4ee5\u5c0f\u62ec\u53f7 ( ) \u5305\u8d77\u6765\uff1b \u786c\u76d8\u4ee5 hd \u8868\u793a,\u540e\u9762\u4f1a\u63a5\u4e00\u7ec4\u6570\u5b57\uff1b \u4ee5 \u641c\u5bfb\u987a\u5e8f \u505a\u4e3a\u786c\u76d8\u7684\u7f16\u53f7\uff01(\u8fd9\u4e2a\u91cd\u8981\uff01) \u7b2c\u4e00\u4e2a\u641c\u5bfb\u5230\u7684\u786c\u76d8\u4e3a 0 \u53f7,\u7b2c\u4e8c\u4e2a\u4e3a 1 \u53f7\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff1b \u6bcf\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a partition \u4ee3\u53f7\u4e3a 1 \uff0c\u4f9d\u5e8f\u7c7b\u63a8\u3002 \u7531\u4e8e BIOS \u53ef\u4ee5\u8c03\u6574\u78c1\u76d8\u7684\u5f00\u673a\u987a\u5e8f\uff0c\u56e0\u6b64\u4e0a\u8ff0\u7684\u78c1\u76d8\u5bf9\u5e94\u7684 (hdN) \u90a3\u4e2a\u53f7\u7801 N \u662f\u53ef\u80fd\u4f1a\u53d8\u3002 \u4f8b\u5b50\uff1a \u786c\u76d8\u641c\u5bfb\u987a\u5e8f \u5728 Grub2 \u5f53\u4e2d\u7684\u4ee3\u53f7 \u7b2c\u4e00\u9897(MBR) (hd0) (hd0,msdos1) (hd0,msdos2) (hd0,msdos3).... \u7b2c\u4e8c\u9897(GPT) (hd1) (hd1,gpt1) (hd1,gpt2) (hd1,gpt3).... \u7b2c\u4e09\u9897 (hd2) (hd2,1) (hd2,2) (hd2,3).... \u7b2c\u4e00\u9897\u786c\u76d8\u7684 MBR \u5b89\u88c5\u5904\u7684\u786c\u76d8\u4ee3\u53f7\u5c31\u662f (hd0) \uff0c\u800c\u7b2c\u4e00\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u5206\u533a\u69fd\u7684 boot sector \u4ee3\u53f7\u5c31\u662f (hd0,msdos1) \uff0c\u7b2c\u4e00\u9897\u786c\u76d8\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u5206\u533a\u69fd\u7684 boot sector \u4ee3\u53f7\u4e3a (hd0,msdos5) \u3002","title":"2.1 \u78c1\u76d8\u4e0e\u5206\u533a\u69fd\u5728 grub2 \u4e2d\u7684\u4ee3\u53f7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#22-bootgrub2grubcfg","text":"[ root@dev ~ ] # vi /boot/grub2/grub.cfg # /etc/grub.d/00_header \u8fd9\u4e2a\u811a\u672c\u6267\u884c\u7684\u7ed3\u679c\u5c55\u793a,\u4e3b\u8981\u4e0e\u57fa\u7840\u8bbe\u5b9a\u73af\u5883\u6709\u5173 ### BEGIN /etc/grub.d/00_header ### \u2026\u2026 if [ x \" ${ feature_menuentry_id } \" = xy ] ; then menuentry_id_option = \"--id\" else menuentry_id_option = \"\" fi export menuentry_id_option \u2026\u2026 terminal_output console if [ x $feature_timeout_style = xy ] ; then set timeout_style = menu set timeout = 5 # Fallback normal timeout code in case the timeout_style feature is # unavailable. else set timeout = 5 fi ### END /etc/grub.d/00_header ### # /etc/grub.d/10_linux,\u4e3b\u8981\u9488\u5bf9\u5b9e\u9645\u7684 Linux \u5185\u6838\u6587\u4ef6\u7684\u5f00\u673a\u73af\u5883 ### BEGIN /etc/grub.d/10_linux ### menuentry 'CentOS Linux (3.10.0-1062.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-514.el7.x86_64-advanced-eb74cab9-cb1a-4f23-8719-b876f3b012cd' { load_video set gfxpayload = keep insmod gzio insmod part_msdos insmod xfs set root = 'hd0,msdos1' if [ x $feature_platform_search_hint = xy ] ; then search --no-floppy --fs-uuid --set = root --hint-bios = hd0,msdos1 --hint-efi = hd0,msdos1 --hint-baremetal = ahci0,msdos1 --hint = 'hd0,msdos1' 2029e8fc-9ca4-42fe-819e-c3fdead51690 else search --no-floppy --fs-uuid --set = root 2029e8fc-9ca4-42fe-819e-c3fdead51690 fi linux16 /vmlinuz-3.10.0-1062.el7.x86_64 root = /dev/mapper/cl-root ro crashkernel = auto rd.lvm.lv = cl/root rd.lvm.lv = cl/swap rhgb quiet LANG = en_US.UTF-8 initrd16 /initramfs-3.10.0-1062.el7.x86_64.img } \u2026\u2026 ### END /etc/grub.d/10_linux ### # \u5b9a\u5236\u83dc\u5355 ### BEGIN /etc/grub.d/40_custom ### # This file provides an easy way to add custom menu entries. Simply type the # menu entries you want to add after this comment. Be careful not to change # the 'exec tail' line above. ### END /etc/grub.d/40_custom ### \u2026\u2026 \u6bcf\u4e2a menuentry \u5c31\u662f\u4e00\u4e2a\u5f00\u673a\u9009\u5355\u55bd\uff0c { } \u4ee3\u8868\u9009\u62e9\u4e86\u8be5\u9009\u5355\u540e\u6267\u884c\u7684\u52a8\u4f5c\uff0c\u4e0b\u9762\u662f\u4e09\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u9879\u76ee\uff1a set root='hd0,msdos1' root \u662f\u6307\u5b9a grub2 \u914d\u7f6e\u6587\u4ef6\u6240\u5728\u7684\u90a3\u4e2a\u8bbe\u5907\uff1a [ root@dev ~ ] # lsblk -p /dev/sda1 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda1 8 :1 0 1G 0 part /boot linux16 /vmlinuz-...... root=/dev/mapper/cl-root ...... \u8fd9\u4e2a\u5c31\u662f Linux \u5185\u6838\u6587\u4ef6\u4ee5\u53ca\u5185\u6838\u6267\u884c\u65f6\u6240\u4e0b\u8fbe\u7684\u53c2\u6570\u3002\u5185\u6838\u6587\u4ef6\u7684\u8bbe\u5b9a\u8ddf\u4e0a\u9762\u7684 root \u6709\u5173\u3002\u6709\u6ca1\u6709 /boot \u5206\u533a\u662f\u4f1a\u5bf9\u6587\u4ef6\u540d\u6709\u5f71\u54cd\u7684\uff1a \u5982\u679c\u6ca1\u6709 /boot \u5206\u533a\uff0c\u4ec5\u6709 / \u5206\u533a\uff1a /boot/vmlinuz-xxx --> (/)/boot/vmlinuz-xxx --> (hd0,msdos1)/boot/vmlinuz-xxx \u5982\u679c /boot \u662f\u72ec\u7acb\u5206\u533a\uff1a /boot/vmlinuz-xxx --> (/boot)/vmlinuz-xxx --> (hd0,msdos1)/vmlinuz-xxx \u81f3\u4e8e\u672c\u547d\u4ee4\u7684 root \u6307\u7684\u662f linux \u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u6839\u76ee\u5f55\u662f\u5728\u54ea\u4e2a\u88c5\u7f6e\u4e0a \u7684\u610f\u601d\uff1a [ root@dev ~ ] # lsblk -p /dev/sda2 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT /dev/sda2 8 :2 0 49G 0 part \u251c\u2500/dev/mapper/cl-root 253 :0 0 44G 0 lvm / \u2514\u2500/dev/mapper/cl-swap 253 :1 0 5G 0 lvm [ SWAP ] initrd16 /initramfs-...... \u8fd9\u4e2a\u6863\u540d\u4e5f\u662f\u9700\u8981\u642d\u914d set root=xxx \u90a3\u4e2a\u9879\u76ee\u7684\u88c5\u7f6e\uff0c \u624d\u4f1a\u5f97\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u3002","title":"2.2 /boot/grub2/grub.cfg \u914d\u7f6e\u6587\u4ef6(\u91cd\u70b9\u5728\u4e86\u89e3\uff0c\u4e0d\u8981\u968f\u4fbf\u6539!)"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#3-grub2-etcdefaultgrub-etcgrubd","text":"","title":"3. grub2 \u914d\u7f6e\u6587\u4ef6\u7ef4\u62a4 /etc/default/grub \u4e0e /etc/grub.d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#31","text":"[ root@dev ~ ] # cat /etc/default/grub GRUB_TIMEOUT = 5 # \u6307\u5b9a\u9884\u8bbe\u5012\u6570\u8bfb\u79d2\u7684\u79d2\u6570 GRUB_DISTRIBUTOR = \" $( sed 's, release .*$,,g' /etc/system-release ) \" GRUB_DEFAULT = saved # \u6307\u5b9a\u9884\u8bbe\u7531\u54ea\u4e00\u4e2a\u9009\u5355\u6765\u5f00\u673a GRUB_DISABLE_SUBMENU = true # \u662f\u5426\u8981\u9690\u85cf\u6b21\u9009\u5355,\u901a\u5e38\u662f\u9690\u85cf GRUB_TERMINAL_OUTPUT = \"console\" # \u6307\u5b9a\u6570\u636e\u8f93\u51fa\u7684\u7ec8\u7aef\u673a\u683c\u5f0f,\u9ed8\u8ba4\u662f\u900f\u8fc7\u6587\u5b57\u7ec8\u7aef\u673a GRUB_CMDLINE_LINUX = \"crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet\" # \u5c31\u662f\u5728 menuentry \u62ec\u53f7\u5185\u7684 linux16 \u9879\u76ee\u540e\u7eed\u7684\u5185\u6838\u53c2\u6570 GRUB_DISABLE_RECOVERY = \"true\" # \u53d6\u6d88\u6551\u63f4\u9009\u5355\u7684\u5236\u4f5c \u662f\u5426\u9690\u85cf\u9009\u5355\u9879\u76ee\uff1aGRUB_TIMEOUT_STYLE \u53ef\u9009\u503c\uff1amenu, countdown, hidden\u3002countdown \u4f1a\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u5269\u4f59\u7684\u7b49\u5f85\u79d2\u6570\uff0c\u800c hidden \u5219\u7a7a\u7a7a\u5982\u4e5f\u3002 \u9ed8\u8ba4\u5f00\u673a\u9009\u5355\u9879\u76ee\uff1aGRUB_DEFAULT \u5047\u8bbe\u4f60\u6709\u4e09\u6761 menuentry \u7684\u9879\u76ee\u5927\u7ea6\u50cf\u8fd9\u6837\uff1a menuentry '1st linux system' --id 1st-linux-system { ...} menuentry '2nd linux system' --id 2nd-linux-system { ...} menuentry '3rd win system' --id 3rd-win-system { ...} \u90a3\u4e48\u51e0\u4e2a\u5e38\u89c1\u7684\u8bbe\u5b9a\u503c\u662f\u8fd9\u6837\u7684\uff1a GRUB_DEFAULT = 1 # \u4ee3\u8868\u4f7f\u7528\u7b2c\u4e8c\u4e2a menuentry \u5f00\u673a,\u56e0\u4e3a\u6570\u5b57\u7684\u7f16\u53f7\u662f\u4ee5 0 \u53f7\u5f00\u59cb\u7f16\u7684! GRUB_DEFAULT = 3rd-win-system # \u4ee3\u8868\u4f7f\u7528\u7b2c\u4e09\u4e2a menuentry \u5f00\u673a,\u56e0\u4e3a\u91cc\u5934\u4ee3\u8868\u7684\u662f ID \u7684\u9879\u76ee!\u5b83\u4f1a\u627e\u5230 --id \u5594! GRUB_DEFAULT = saved # \u4ee3\u8868\u4f7f\u7528 grub2-set-default \u6765\u8bbe\u5b9a\u54ea\u4e00\u4e2a menuentry \u4e3a\u9ed8\u8ba4\u503c\u7684\u610f\u601d\u3002\u901a\u5e38\u9884\u8bbe\u4e3a 0 \u5185\u6838\u7684\u5916\u52a0\u53c2\u6570\u529f\u80fd\uff1aGRUB_CMDLINE_LINUX \u5728\u5185\u6838\u542f\u52a8\u7684\u65f6\u5019\u52a0\u5165\u989d\u5916\u7684\u53c2\u6570\u3002","title":"3.1 \u4e3b\u8981\u73af\u5883\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#32-etcgrubd","text":"00_header \u4e3b\u8981\u5728\u5efa\u7acb\u521d\u59cb\u7684\u663e\u793a\u9879\u76ee\u3002\u5927\u90e8\u5206\u5728 /etc/default/grub \u91cc\u9762\u6240\u8bbe\u5b9a\u7684\u53d8\u91cf\uff0c\u5927\u6982\u90fd\u4f1a\u5728\u8fd9\u4e2a\u811a\u672c\u5f53\u4e2d\u88ab\u5229\u7528\u6765\u91cd\u5efa grub.cfg \u3002 10_linux \u6839\u636e\u5206\u6790 /boot \u5e95\u4e0b\u7684\u6587\u4ef6\uff0c\u5c1d\u8bd5\u627e\u5230\u6b63\u786e\u7684 linux \u5185\u6838\u4e0e\u8bfb\u53d6\u8fd9\u4e2a\u5185\u6838\u9700\u8981\u7684\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757\u4e0e\u53c2\u6570\u7b49\uff0c\u90fd\u5728\u8fd9\u4e2a\u811a\u672c\u8fd0\u4f5c\u540e\u627e\u5230\u5e76\u8bbe\u5b9a\u5230 grub.cfg \u5f53\u4e2d\u3002 30_os-prober \u8fd9\u4e2a\u811a\u672c\u9ed8\u8ba4\u4f1a\u5230\u7cfb\u7edf\u4e0a\u627e\u5176\u4ed6\u7684 partition \u91cc\u9762\u53ef\u80fd\u542b\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7136\u540e\u5c06\u8be5\u64cd\u4f5c\u7cfb\u7edf\u505a\u6210\u9009\u5355\u6765\u5904\u7406\u5c31\u662f\u4e86\u3002\u4f7f\u7528 GRUB_DISABLE_OS_PROBER=true \u6765\u5173\u95ed\u5b83\u3002 40_custom \u5728\u8fd9\u91cc\u8865\u5145\u81ea\u5b9a\u4e49\u9009\u5355\u3002 \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u6539\u52a8\u5c31\u662f\u4ec5\u6709 40_custom \u8fd9\u4e2a\u6587\u4ef6\u3002","title":"3.2 \u9009\u5355\u5185\u7f6e\u7684\u811a\u672c /etc/grub.d/*"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#321-menuentry","text":"\u76f4\u63a5\u6307\u5b9a\u5185\u6838\u5f00\u673a \u5982\u679c\u4f60\u6709\u6bd4\u8f83\u7279\u522b\u7684\u53c2\u6570\u9700\u8981\u4fee\u6539\uff1a(1)\u5148\u5230 grub.cfg \u5f53\u4e2d\u53d6\u5f97\u4f60\u8981\u5236\u4f5c\u7684\u90a3\u4e2a\u5185\u6838\u7684\u9009\u5355\u9879\u76ee\uff0c\u7136\u540e\u5c06\u5b83\u590d\u5236\u523040_custom \u5f53\u4e2d (2)\u518d\u5230 40_custom \u5f53\u4e2d\u4f9d\u636e\u4f60\u7684\u9700\u6c42\u4fee\u6539\u5373\u53ef\u3002 \u900f\u8fc7 chainloader \u7684\u65b9\u5f0f\u79fb\u4ea4 loader \u63a7\u5236\u6743 grub2 \u5e76\u4e0d\u9700\u8981\u8ba4\u8bc6\u4e0e\u627e\u51fa kernel \u7684\u6587\u4ef6\u540d\uff0c \u53ea\u662f\u5c06 boot \u7684\u63a7\u5236\u6743\u4ea4\u7ed9\u4e0b\u4e00\u4e2a boot sector \u6216 MBR \u5185\u7684 boot loader \u800c\u5df2 \u3002\u6240\u4ee5\u901a\u5e38\u4ed6\u4e5f\u4e0d\u9700\u8981\u53bb\u67e5\u9a8c\u4e0b\u4e00\u4e2a boot loader \u7684\u6587\u4ef6\u7cfb\u7edf\u3002 \u4e00\u822c\u6765\u8bf4\uff0c chain loader \u7684\u8bbe\u5b9a\u53ea\u8981\u4e24\u4e2a\u5c31\u591f\u4e86\uff0c\u4e00\u4e2a\u662f\u9884\u8ba1\u8981\u524d\u5f80\u7684 boot sector \u6240\u5728\u7684\u5206\u533a\u69fd\u4ee3\u53f7\uff0c\u53e6\u4e00\u4e2a\u5219\u662f\u8bbe\u7f6e chainloader \u4e3a\u90a3\u4e2a\u5206\u533a\u69fd\u7684 boot sector (\u7b2c\u4e00\u4e2a\u6247\u533a) \u4e0a\u3002\u4f8b\u5b50\uff1a [ root@linux ~ ] # cat /etc/grub.d/40_custom \u2026\u2026 # \u5c06\u63a7\u5236\u6743\u4ea4\u7ed9 windows \u7684 loader menuentry \"Windows\" { insmod chain # \u4f60\u5f97\u8981\u5148\u52a0\u8f7d chainloader \u7684\u6a21\u5757\u5bf9\u5427? insmod ntfs # \u5efa\u8bae\u52a0\u5165 windows \u6240\u5728\u7684\u6587\u4ef6\u7cfb\u7edf\u6a21\u5757\u8f83\u4f73! set root =( hd0,1 ) # \u662f\u5728\u54ea\u4e00\u4e2a\u5206\u533a\u69fd~\u6700\u91cd\u8981\u7684\u9879\u76ee! chainloader +1 # \u8bf7\u53bb boot sector \u5c06 loader \u8f6f\u4ef6\u8bfb\u51fa\u6765\u7684\u610f\u601d! } # \u56de\u5230 MBR \u7684\u9884\u8bbe\u73af\u5883 menuentry 'Go to MBR' $menuentry_id_option 'mbr' { insmod chain insmod part_gpt set root =( hd0 ) chainloader +1 }","title":"3.2.1 menuentry \u7684\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#33","text":"\u5728\u6bcf\u6b21\u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u90fd\u9700\u8981\u6267\u884c grub2-mkconfig \u6307\u4ee4\u6765\u91cd\u65b0\u751f\u6210 grub.cfg \u6587\u4ef6 grub2-mkconfig -o /boot/grub2/grub.cfg","title":"3.3 \u91cd\u65b0\u751f\u6210\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#4-initramfs","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u9700\u8981 initramfs \u7684\u65f6\u523b\u4e3a: \u6839\u76ee\u5f55\u6240\u5728\u78c1\u76d8\u4e3a SATA\u3001USB \u6216 SCSI \u7b49\u8fde\u63a5\u63a5\u53e3\uff1b \u6839\u76ee\u5f55\u6240\u5728\u6587\u4ef6\u7cfb\u7edf\u4e3a LVM, RAID \u7b49\u7279\u6b8a\u683c\u5f0f\uff1b \u6839\u76ee\u5f55\u6240\u5728\u6587\u4ef6\u7cfb\u7edf\u4e3a\u975e\u4f20\u7edf Linux \u8ba4\u8bc6\u7684\u6587\u4ef6\u7cfb\u7edf\u65f6\uff1b \u5176\u4ed6\u5fc5\u987b\u8981\u5728\u6838\u5fc3\u52a0\u8f7d\u65f6\u63d0\u4f9b\u7684\u6a21\u5757\u3002 Linux \u5185\u6838\u672c\u8eab\u5c31\u8ba4\u8bc6 IDE \u63a5\u53e3\u7684\u78c1\u76d8\uff0c\u56e0\u6b64\u4e0d\u9700\u8981 initramfs \u4e5f\u53ef\u4ee5\u987a\u5229\u5f00\u673a\u3002 \u5982\u679c\u6709\u7279\u6b8a\u9700\u8981\u6240\u4ee5\u60f3\u91cd\u5236 initramfs \u6587\u4ef6\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 dracut/mkinitrd \u6765\u5904\u7406\u3002 dracut [ OPTION... ] [ <image> [<kernel version> ] ] \u751f\u6210\u4e00\u4e2a initramfs \u6587\u4ef6 OPTION - v , --verbose --kver [VERSION] Set kernel version to [VERSION]. - f , --force Overwrite existing initramfs file. --add-drivers [LIST] \u5728\u539f\u672c\u7684\u9ed8\u8ba4\u6838\u5fc3\u6a21\u5757\u4e2d,\u589e\u52a0\u67d0\u4e9b\u4f60\u60f3\u8981\u7684\u6a21\u5757\uff0c\u6a21\u5757\u4f4d\u4e8e\u5185\u6838\u6240\u5728\u76ee\u5f55 / lib / modules / $ ( uname - r ) / kernel /*\u3002LIST \u683c\u5f0f\u4e3a \"module1 module2 ...\" --omit-drivers [LIST] \u6307\u5b9a\u4e0d\u6dfb\u52a0\u5230 initramfs \u4e2d\u7684\u6a21\u5757\u3002 --filesystems [LIST] \u52a0\u5165\u67d0\u4e9b\u989d\u5916\u7684\u6587\u4ef6\u7cfb\u7edf\u652f\u6301 dracut -v --add-drivers \"e1000e\" --filesystems \"ext4 nfs\"","title":"4. \u65b0\u5efa initramfs \u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#5-grub2","text":"\u5982\u679c\u4f60\u7684 Linux \u539f\u6765\u4f7f\u7528\u7684\u5e76\u975e grub2\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5b89\u88c5\u4e86\u3002 \u9996\u5148\uff0c\u4f60\u5fc5\u987b\u8981\u4f7f\u7528 grub-install \u5c06\u4e00\u4e9b\u5fc5\u8981\u7684\u6587\u4ef6\u590d\u5236\u5230 /boot/grub2 \u91cc\u9762\u53bb\uff1a grub2 - install [ OPTION ...] [ INSTALL_DEVICE ] OPTION -- boot - directory = DIR install GRUB images under the directory DIR / grub2 instead of the boot / grub2 directory - s , -- skip - fs - probe do not probe for filesystems in DEVICE -- force install even if problems are detected -- recheck delete device map if it already exists INSTALL_DEVICE \uff1a\u8981\u5b89\u88c5\u7684\u8bbe\u5907 \u57fa\u672c\u4e0a\uff0cgrub2-install \u5927\u6982\u4ec5\u80fd\u5b89\u88c5 grub2 \u4e3b\u7a0b\u5e8f\u4e0e\u76f8\u5173\u8f6f\u4ef6\u5230 /boot/grub2/ \u90a3\u4e2a\u76ee\u5f55\u53bb\uff0c \u5982\u679c\u540e\u9762\u7684\u8bbe\u5907\u586b\u7684\u662f\u6574\u4e2a\u7cfb\u7edf ( /dev/vda, /dev/sda... )\uff0c\u90a3 loader \u7684\u7a0b\u5e8f\u624d\u4f1a\u5199\u5165\u5230 MBR \u91cc\u9762\u53bb \u3002 # \u66f4\u65b0 /boot/grub2/ [ root@linux ~ ] # grub2-install /dev/sda Installing for i386-pc platform. Installation finished. No error reported. [ root@linux ~ ] # ll /boot/grub2/ total 28 drwxr-xr-x. 2 root root 25 Jul 31 14 :27 fonts -rw-r--r--. 1 root root 4287 Jul 31 14 :28 grub.cfg -rw-r--r--. 1 root root 1024 Jul 31 14 :28 grubenv drwxr-xr-x. 2 root root 8192 Dec 11 17 :26 i386-pc drwxr-xr-x. 2 root root 4096 Dec 11 17 :26 locale \u5982\u679c\u662f XFS \u6587\u4ef6\u7cfb\u7edf\u7684\u67d0\u4e2a\u5206\u533a\uff0cgrub2-install \u4f1a\u62a5\u9519\uff0c\u6307\u51fa\u4e0d\u652f\u6301\u8be5\u6587\u4ef6\u7cfb\u7edf\uff1a # \u5c06 (/dev/sda2) \u7684 grub2 \u5b89\u88c5\u5230 /dev/sda4 \u4e0e MBR \u4e2d [ root@linux ~ ] # df -Th Filesystem Type Size Used Avail Use% Mounted on /dev/mapper/centos-root xfs 10G 1 .2G 8 .9G 12 % / devtmpfs devtmpfs 899M 0 899M 0 % /dev tmpfs tmpfs 911M 0 911M 0 % /dev/shm tmpfs tmpfs 911M 9 .6M 902M 2 % /run tmpfs tmpfs 911M 0 911M 0 % /sys/fs/cgroup /dev/mapper/centos-home xfs 5 .0G 33M 5 .0G 1 % /home /dev/sda2 xfs 1014M 142M 873M 14 % /boot tmpfs tmpfs 183M 0 183M 0 % /run/user/0 /dev/sda4 xfs 2 .0G 33M 2 .0G 2 % /root/sda4 [ root@linux ~ ] # grub2-install /dev/sda4 Installing for i386-pc platform. grub2-install: error: hd0 appears to contain a xfs filesystem which isn 't known to reserve space for DOS-style boot. Installing GRUB there could result in FILESYSTEM DESTRUCTION if valuable data is overwritten by grub-setup (--skip-fs-probe disables this check, use at your own risk). [root@linux ~]# grub2-install --skip-fs-probe /dev/sda4 Installing for i386-pc platform. grub2-install: warning: File system `xfs' doesn 't support embedding. grub2-install: warning: Embedding is not possible. GRUB can only be installed in this setup by using blocklists. However, blocklists are UNRELIABLE and their use is discouraged.. grub2-install: error: will not proceed with blocklists. # \u5b89\u88c5\u6210\u529f\uff01\uff01\uff01 [root@linux ~]# grub2-install --skip-fs-probe --force --recheck /dev/sda4 Installing for i386-pc platform. grub2-install: warning: File system `xfs' doesn ' t support embedding. grub2-install: warning: Embedding is not possible. GRUB can only be installed in this setup by using blocklists. However, blocklists are UNRELIABLE and their use is discouraged.. Installation finished. No error reported. [ root@linux ~ ] # ll /boot/grub2/ total 28 drwxr-xr-x. 2 root root 25 Jul 31 14 :27 fonts -rw-r--r--. 1 root root 4287 Jul 31 14 :28 grub.cfg -rw-r--r--. 1 root root 1024 Jul 31 14 :28 grubenv drwxr-xr-x. 2 root root 8192 Dec 11 17 :27 i386-pc drwxr-xr-x. 2 root root 4096 Dec 11 17 :27 locale \u4e0a\u9762\u8fd9\u6837\u5c31\u5c06 grub2 \u7684\u4e3b\u7a0b\u5e8f\u5b89\u88c5\u5230 /dev/sda4 \u4ee5\u53ca\u91cd\u65b0\u5b89\u88c5\u5230 MBR \u91cc\u9762\u53bb\u4e86\u3002 Warning \u5982\u679c\u4f60\u5f53\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5728\u90a3\u5757\u78c1\u76d8\u4e0a\uff0c\u90a3\u4e48\u4f60\u662f\u4e0d\u80fd\u64cd\u4f5c\u6210\u529f\u7684\uff01\uff01\uff01\u6bd4\u5982\u4f60\u73b0\u5728\u8fdb\u5165\u7684\u662f\u4f4d\u4e8e /dev/sda \u7684OS\uff0c\u4f60\u662f\u65e0\u6cd5\u4e3a /dev/sdb \u5b89\u88c5 grub2 \u7684\uff01","title":"5. \u6d4b\u8bd5\u4e0e\u5b89\u88c5 grub2"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#51","text":"Important \u5982\u679c\u662f\u591a\u91cd\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9700\u8981\u91cd\u65b0\u8fdb\u5165\u65b0\u7cfb\u7edf\u624d\u80fd\u591f\u5b89\u88c5\u5566\uff01 \u5047\u8bbe\u4f60\u7684\u6d4b\u8bd5\u7cfb\u7edf\u4e0a\u9762\u4f7f\u7528 MBR \u5206\u533a\u69fd\uff0c\u5e76\u4e14\u51fa\u73b0\u5982\u4e0b\u7684\u6570\u636e\uff1a [ root @ study ~ ]# fdisk - l / dev / vda Device Boot Start End Blocks Id System / dev / vda1 2048 6143 2048 83 Linux / dev / vda2 * 6144 2103295 1048576 7 HPFS / NTFS / exFAT / dev / vda3 2103296 54540287 26218496 8 e Linux \u5176\u4e2d /dev/vda1, /dev/vda3 \u662f\u4e24\u4e2a CentOS 7 \u7cfb\u7edf,\u800c /dev/vda2 \u5219\u662f windows 7 \u7cfb\u7edf\u3002 \u5b89\u88c5\u7684\u6d41\u7a0b\u662f\u4f9d\u5e8f /dev/vda1 --> /dev/vda2 --> /dev/vda3 \u3002\u56e0\u6b64\uff0c\u5b89\u88c5\u597d\u800c\u4e14\u91cd\u65b0\u542f\u52a8\u540e\uff0c\u7cfb\u7edf\u5176\u5b9e\u662f\u9ed8\u8ba4\u8fdb\u5165 /dev/vda3 \u8fd9\u4e2a CentOS 7 \u7684\u7cfb\u7edf\u7684\u3002\u6b64\u65f6 MBR \u4f1a\u53bb\u8bfb\u53d6\u7684\u914d\u7f6e\u6587\u4ef6\u5728 (/dev/vda3)/boot/grub2/grub.cfg \u624d\u5bf9\u3002 \u90a3\u5982\u4f55\u8ba9\u7cfb\u7edf\u6c38\u8fdc\u90fd\u662f\u4f7f\u7528 /dev/vda1 \u5f00\u673a\u5462\uff1f\u56e0\u4e3a MBR \u7684 boot loader \u5e94\u8be5\u8981\u53bb (/dev/vda1)/boot/grub2/grub.cfg \u8bfb\u53d6\u76f8\u5173\u8bbe\u5b9a\u624d\u662f\u6b63\u5e38\u7684\uff01\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u51e0\u79cd\u57fa\u672c\u7684\u65b9\u5f0f\u6765\u5904\u7406\uff1a \u56e0\u4e3a CentOS 7 \u4f1a\u4e3b\u52a8\u627e\u5230\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u5728 /dev/vda3 \u7684\u5f00\u673a\u9009\u5355\u4e2d\u627e\u5230 /dev/vda1 \u7684\u5f00\u673a\u9009\u9879\uff0c\u8bf7\u7528\u8be5\u9009\u9879\u8fdb\u5165\u7cfb\u7edf\uff0c \u4f60\u5c31\u80fd\u591f\u8fdb\u5165 /dev/vda1 \u4e86\uff01 \u5047\u8bbe\u6ca1\u80fd\u6293\u5230 /dev/vda1 \uff0c\u90a3\u4f60\u53ef\u4ee5\u5728 /dev/vda3 \u5e95\u4e0b\u4f7f\u7528 chroot \u6765\u8fdb\u5165 /dev/vda1 \u5594\uff01 \u4f7f\u7528\u6551\u63f4\u5149\u76d8\u53bb\u6293\u5230\u6b63\u786e\u7684 /dev/vda1\uff0c\u7136\u540e\u53d6\u5f97 /dev/vda1 \u7684\u7cfb\u7edf\u5594\uff01 \u8fdb\u5165\u7cfb\u7edf\u4e4b\u540e\uff1a\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08\u53ef\u9009\uff09\uff0c grub2-mkconfig -o /boot/grub2/grub.cfg \uff0c grub2-install /dev/vda \uff0c\u5c31\u80fd\u591f\u8ba9\u4f60\u7684 MBR \u53bb\u53d6\u5f97 /dev/vda1 \u5185\u7684\u914d\u7f6e\u6587\u4ef6\u5570\uff01","title":"5.1 \u9e1f\u54e5\u4e3e\u4f8b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#6","text":"\u5728\u5f00\u673a\u754c\u9762\u53ef\u4ee5\u4fee\u6539 grub2 \u7684\u914d\u7f6e\u54e6 \u5728\u5f00\u673a\u754c\u9762\u7f16\u8f91 grub2\uff0c\u542f\u7528\u6551\u63f4\u6a21\u5f0f\uff1a \u6ce8\u610f \uff1a\u4e00\u65e6\u4f60\u9000\u51fa\u4e86\u7f16\u8f91\u754c\u9762\u800c\u4e0d\u662f\u76f4\u63a5\u5f00\u673a\uff0c\u90a3\u4e48\u6240\u6709\u7684\u7f16\u8f91\u90fd\u4e0d\u4f1a\u4fdd\u5b58\u4e0e\u751f\u6548\u3002 \u65e9\u671f SystemV \u7684\u7cfb\u7edf\u4e2d,\u8fdb\u5165 runlevel 1 \u7684\u72b6\u6001\u662f\u4e0d\u9700\u8981\u8f93\u5165 root \u5bc6\u7801\u7684\uff01\u5728 systemd \u4e2d\u5982\u679c\u5fd8\u8bb0\u4e86root\u5bc6\u7801\uff0c\u5c31\u8981\u4f7f\u7528\u522b\u7684\u65b9\u6cd5\u4e86\uff01","title":"6. \u5f00\u673a\u524d\u7684\u989d\u5916\u529f\u80fd\u4fee\u6539"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#7","text":"\u5728 grub2 \u7684\u9009\u5355\u7ba1\u7406\u4e2d\uff0c\u6709\u9488\u5bf9\u4e24\u79cd\u8eab\u4efd\u8fdb\u884c\u5bc6\u7801\u8bbe\u5b9a: superusers\uff1a \u8bbe\u5b9a\u7cfb\u7edf\u7ba1\u7406\u5458\u4e0e\u76f8\u5173\u53c2\u6570\u8fd8\u6709\u5bc6\u7801\u7b49\uff0c\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u7684\u7528\u6237\uff0c\u5c06\u53ef\u5728 grub2 \u5185\u5177\u6709\u6240\u6709\u4fee \u6539\u7684\u6743\u9650\u3002 \u4f46\u4e00\u65e6\u8bbe\u5b9a\u4e86\u8fd9\u4e2a superusers \u7684\u53c2\u6570\uff0c\u5219\u6240\u6709\u7684\u6307\u4ee4\u4fee\u6539\u5c06\u4f1a\u88ab\u53d8\u6210\u53d7\u9650\u5236\u7684 \uff01 users\uff1a \u8bbe\u5b9a\u4e00\u822c\u8d26\u53f7\u7684\u76f8\u5173\u53c2\u6570\u4e0e\u5bc6\u7801\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u591a\u4e2a\u7528\u6237\u5594\uff01\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u7684\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u8981\u8fdb\u5165\u67d0\u4e9b \u9009\u5355\u9879\u76ee\u3002 \u4e0d\u8fc7\uff0c\u9009\u5355\u9879\u76ee\u4e5f\u5f97\u8981\u642d\u914d\u76f8\u5bf9\u7684\u8d26\u53f7\u624d\u884c\u5594\uff01(\u4e00\u822c\u6765\u8bf4\uff0c\u4f7f\u7528\u8fd9\u79cd\u5bc6\u7801\u7684\u8d26\u53f7\u5e76\u4e0d\u80fd\u4fee\u6539\u9009 \u5355\u7684\u5185\u5bb9\uff0c \u4ec5\u80fd\u9009\u62e9\u8fdb\u5165\u9009\u5355\u53bb\u5f00\u673a\u800c\u5df2 ) \u5bc6\u7801\u7684\u7ed9\u4e88\u6709\u4e24\u79cd\u8bed\u6cd5\uff1a password_pbkdf2 \u8d26\u53f7 \u4f7f\u7528 grub2-mkpasswd-pbkdf2 \u6240\u4ea7\u751f\u7684\u5bc6\u7801 password \u8d26\u53f7 \u6ca1\u52a0\u5bc6\u7684\u660e\u6587\u5bc6\u7801 password_pbkdf2 \u7684\u751f\u6210\u65b9\u6cd5\uff1a [ root@linux ~ ] # grub2-mkpasswd-pbkdf2 Enter password: Reenter password: PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.D5D87FCB8A91E15669072A33A16EC9B5353A300A6515D102A73167122564FE8BDEE7C6BC3F989BDF574CB6CA1F45EC74A9F5C5B6A040DE67794404D09CA439D7.ADAE646439BC01833A91C9C70D5E3791750A2069E7C3DF4C1BEAA1F6456110F1D41BDB34DE76ED7389A9CFA0F80A79145EC11F9601C4D142D3D0D8D98F0F2C5F \u628a\u4e0a\u9762\u751f\u6210\u7684hash\u503c\u653e\u5230password_pbkdf2\u7684\u5bf9\u5e94\u5b57\u6bb5\u4e2d\u5373\u53ef\u3002 \u5c06\u8d26\u6237\u4e0emenuentry\u7ed1\u5b9a\u7684\u9009\u9879\u662f --unrestricted \u4e0e --user \u3002 --unrestricted \u8868\u793a\u53ef\u4ee5\u76f4\u63a5\u5f00\u673a\uff08\u65e0\u9700\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\uff0c --user \u53ef\u4ee5\u6307\u5b9a\u54ea\u4e9b\u8d26\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u9009\u5355\u5f00\u673a\uff08\u9700\u8981\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\uff1a menuentry \"\u5927\u5bb6\u90fd\u53ef\u4ee5\u9009\u62e9\u6211\u6765\u5f00\u673a\u5594!\" --unrestricted { set root =( hd0,1 ) chainloader +1 } menuentry \"\u53ea\u6709\u7ba1\u7406\u5458\u7684\u5bc6\u7801\u624d\u6709\u529e\u6cd5\u4f7f\u7528\" --users \"\" { set root =( hd0,2 ) chainloader +1 } menuentry \"\u53ea\u6709\u7ba1\u7406\u5458\u4e0e dmtsai \u624d\u6709\u529e\u6cd5\u4f7f\u7528\u5594!\" --users dmtsai { set root =( hd0,3 ) chainloader +1 } \u4fee\u6539\u5b8c\u914d\u7f6e\u6587\u4ef6\u4e4b\u540e\u4e0d\u8981\u5fd8\u8bb0\u91cd\u65b0\u751f\u6210 grub.cfg \u6587\u4ef6\u54e6\uff01 \u4e0b\u9762\u8bf4\u660e\u4e00\u4e0b\u5728\u54ea\u91cc\u5b9a\u4e49\u8d26\u6237\u5bc6\u7801\u3002","title":"7. \u4e3a\u4e2a\u522b\u9009\u5355\u52a0\u4e0a\u5bc6\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/24 grub2/#71-grub2","text":"\u5728\u9e1f\u54e5\u7684\u7248\u672c\u662f\u8fd9\u6837\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\uff1a [ root@study ~ ] # vim /etc/grub.d/01_users cat << eof set superusers=\"vbird\" password_pbkdf2 vbird grub.pbkdf2.sha512.10000.9A2EBF7A1F484904FF3681F97AE22D58DFBFE65A... password_pbkdf2 dmtsai grub.pbkdf2.sha512.10000.B59584C33BC12F3C9DB8B18BE9F557631473AED... eof [ root@study ~ ] # chmod a+x /etc/grub.d/01_users \u4f46\u662f\u5728 CentOS Linux release 7.5.1804 (Core) \u4e2d\u8be5\u6587\u4ef6\u53d8\u6210\u4e86\u8fd9\u6837\uff1a [ root@linux ~ ] # cat /etc/grub.d/01_users #!/bin/sh -e cat << EOF if [ -f \\${prefix}/user.cfg ]; then source \\${prefix}/user.cfg if [ -n \"\\${GRUB2_PASSWORD}\" ]; then set superusers=\"root\" export superusers password_pbkdf2 root \\${GRUB2_PASSWORD} fi fi EOF \u4ece\u6587\u4ef6\u4e2d\u770b\u51fa\u5f53\u524d\u7248\u672c\u662f\u5728 ${prefix}/user.cfg \u4e2d\u5b9a\u4e49\u8d26\u6237\u5bc6\u7801\u7684\uff0c\u8fd9\u4e2a ${prefix} \u5728 grub.cfg \u6587\u4ef6\u4e2d\u7684\u8bed\u53e5 if [ -s $prefix/grubenv ]; \u53ef\u4ee5\u731c\u6d4b\u5b83\u5176\u5b9e\u5c31\u662f\u76ee\u5f55 /boot/grub2/ \uff0c\u6240\u4ee5\u73b0\u5728\u6211\u4eec\u8981\u5728 /boot/grub2/user.cfg \u4e2d\u5b9a\u4e49\u8d26\u6237\u5566\uff1a [ root@linux ~ ] # cat /boot/grub2/user.cfg # \u5b9a\u4e49\u54ea\u4e9b\u662f\u8d85\u7ea7\u7528\u6237\uff0c\u53ef\u4ee5\u505a\u6240\u6709\u7684\u52a8\u4f5c\uff1b\u666e\u901a\u7528\u6237\u53ea\u80fd\u5f00\u673a set superusers = \"sink\" # \u5b89\u5168\u7684\u8bbe\u7f6e\u5bc6\u7801 password_pbkdf2 sink grub.pbkdf2.sha512.10000.D5D87FCB8A91E15669072A33A16EC9B5353A300A6515D102A73167122564FE8BDEE7C6BC3F989BDF574CB6CA1F45EC74A9F5C5B6A040DE67794404D09CA439D7.ADAE646439BC01833A91C9C70D5E3791750A2069E7C3DF4C1BEAA1F6456110F1D41BDB34DE76ED7389A9CFA0F80A79145EC11F9601C4D142D3D0D8D98F0F2C5F # \u4e0d\u5b89\u5168\u7684\u8bbe\u7f6e\u5bc6\u7801 password grub2_user1 1234","title":"7.1 grub2 \u5bc6\u7801\u8bbe\u5b9a\u7684\u6587\u4ef6\u4f4d\u7f6e\u4e0e\u52a0\u5bc6\u7684\u5bc6\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3/","text":"1. \u5fd8\u8bb0 root \u5bc6\u7801 \u00b6 \u53ea\u8981\u80fd\u591f\u8fdb\u5165OS\u5e76\u4e14\u6302\u8f7d / \uff0c \u7136\u540e\u91cd\u65b0\u8bbe\u7f6e\u4e00\u4e0b root \u7684\u5bc6\u7801\uff0c\u5c31OK\u4e86\u3002 \u53ea\u662f\u65b0\u7248\u7684 systemd \u7684\u7ba1\u7406\u673a\u5236\u4e2d\uff0c\u9ed8\u8ba4\u7684 rescue \u6a21\u5f0f\u662f\u65e0\u6cd5\u76f4\u63a5\u53d6\u5f97 root \u6743\u9650\u7684\uff0c\u8fd8\u9700\u8981\u8f93\u5165\u5bc6\u7801\uff01 \u6b64\u65f6\u53ef\u4ee5\u900f\u8fc7\u4e00\u4e2a\u540d\u4e3a rd.break \u7684\u6838\u5fc3\u53c2\u6570\u6765\u5904\u7406\u3002\u4e0b\u9762\u5217\u4e00\u4e0b\u6b65\u9aa4\u3002 \u5728\u5f00\u673a\u5185\u6838\u53c2\u6570\u4e2d\u6dfb\u52a0 rd.break \u5207\u6362\u5230\u539f\u7cfb\u7edf\u4e0b \u6b64\u65f6\u662f\u5728RAM Disk \u7684\u73af\u5883\uff0c\u5e76\u4e0d\u662f\u539f\u672c\u7684\u73af\u5883\u3002 \u4fee\u6539\u5bc6\u7801 \u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\u6839\u76ee\u5f55\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6302\u8f7d\u7684\uff0c\u73b0\u5728\u4ee5\u53ef\u8bfb\u5199\u7684\u65b9\u5f0f\u91cd\u65b0\u6302\u8f7d\u4e00\u4e0b\u5e76\u4fee\u6539\u5bc6\u7801\uff1a 1.1 \u4e3a\u4f55\u9700\u8981 /.autorelabel \u00b6 \u5728 rd.break \u7684 RAM Disk \u73af\u5883\u4e0b\uff0c\u7cfb\u7edf\u662f\u6ca1\u6709 SELinux \u7684\uff0c\u800c\u4f60\u521a\u521a\u66f4\u6539\u4e86 /etc/shadow \uff0c\u6240\u4ee5 \u8fd9\u4e2a\u6587\u4ef6\u7684 SELinux \u5b89\u5168\u672c\u6587\u7684\u7279\u6027\u5c06\u4f1a\u88ab\u53d6\u6d88 \uff01\u5982\u679c\u4f60\u6ca1\u6709\u8ba9\u7cfb\u7edf\u4e8e\u5f00\u673a\u65f6\u81ea\u52a8\u7684\u56de\u590d SELinux \u7684\u5b89\u5168\u672c\u6587\uff0c \u4f60\u7684\u7cfb\u7edf\u5c06\u4ea7\u751f \u65e0\u6cd5\u767b\u5165 \u7684\u95ee\u9898 (\u5728 SELinux \u4e3a Enforcing \u7684\u6a21\u5f0f\u4e0b\uff01)\u52a0\u4e0a /.autorelabel \u5c31\u662f\u8981\u8ba9\u7cfb\u7edf\u5728\u5f00\u673a\u7684\u65f6\u5019\u81ea\u52a8\u7684\u4f7f\u7528\u9884\u8bbe\u7684 SELinux type \u91cd\u65b0\u5199\u5165 SELinux \u5b89\u5168\u672c\u6587\u5230\u6bcf\u4e2a\u6587\u4ef6\u53bb\uff01 \u4e0d\u8fc7\u52a0\u4e0a /.autorelabel \u4e4b\u540e\uff0c\u7cfb\u7edf\u5728\u5f00\u673a\u5c31\u4f1a\u91cd\u65b0\u5199\u5165 SELinux \u7684 type \u5230\u6bcf\u4e2a\u6587\u4ef6\uff0c\u56e0\u6b64\u4f1a\u82b1\u4e0d\u5c11\u7684\u65f6\u95f4\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u8981\u82b1\u592a\u591a\u65f6\u95f4\uff0c\u8fd8\u6709\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5904\u7406\uff1a \u5728 rd.break \u6a21\u5f0f\u4e0b\uff0c\u4fee\u6539\u5b8c root \u5bc6\u7801\u540e\uff0c\u5c06 /etc/selinux/config \u5185\u7684 SELinux \u7c7b\u578b\u6539\u4e3a permissive \u91cd\u65b0\u542f\u52a8\u540e\uff0c\u4f7f\u7528 root \u7684\u8eab\u4efd\u4e0b\u8fbe restorecon -Rv /etc \u4ec5\u4fee\u6539 /etc \u5e95\u4e0b\u7684\u6587\u4ef6 \u91cd\u65b0\u4fee\u6539 /etc/selinux/config \u6539\u56de enforcing \uff0c\u7136\u540e setenforce 1 \u5373\u53ef\uff01 2. \u76f4\u63a5\u5f00\u673a\u5c31\u4ee5 root \u6267\u884c bash \u7684\u65b9\u6cd5 \u00b6 \u9664\u4e86\u4e0a\u8ff0\u7684 rd.break \u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5f00\u673a\u53d6\u5f97\u7cfb\u7edf\u6839\u76ee\u5f55\u540e\uff0c\u8ba9\u7cfb\u7edf\u76f4\u63a5\u4e22\u4e00\u4e2a bash \u7ed9\u6211\u4eec\u4f7f\u7528\u3002 \u540c\u5728 linux16 \u7684\u90a3\u4e00\u884c\uff0c\u6700\u540e\u9762\u4e0d\u8981\u4f7f\u7528 rd.break \u800c\u662f\u4f7f\u7528 init=/bin/bash \u5373\u53ef\uff01 \u6700\u540e\u5f00\u673a\u5b8c\u6210\u5c31\u4f1a\u4e22\u4e00\u4e2a bash \u7ed9\u6211\u4eec\uff01\u540c\u6837\u4e0d\u9700\u8981 root \u5bc6\u7801\u800c\u6709 root \u6743\u9650\uff01 \u4f46\u662f\u8981\u5b8c\u6574\u7684\u64cd\u4f5c\u8be5\u7cfb\u7edf\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06 PID \u4e00\u53f7\u66f4\u6539\u4e3a bash \u5566\uff01\u6240\u4ee5\u8fde PATH \u90fd\u4ec5\u6709 /bin \u800c\u5df2~\u6240\u4ee5\u4f60\u4e0d\u80fd\u4e0b\u8fbe reboot\uff1a \u6b64\u65f6\u53ea\u80fd\u6309\u4e0b reset \u6216\u8005\u662f\u5f3a\u5236\u5173\u673a\u540e\uff0c\u624d\u80fd\u518d\u6b21\u5f00\u673a \uff01 \u91cd\u542f\u540e\u6062\u590d\u4e00\u4e0bSELinux\uff1a [ root@linux ~ ] # getenforce Permissive [ root@linux ~ ] # vi /etc/selinux/config [ root@linux ~ ] # grep enforcing /etc/selinux/config # enforcing - SELinux security policy is enforced. # permissive - SELinux prints warnings instead of enforcing. SELINUX = enforcing [ root@linux ~ ] # restorecon -Rv /etc/ restorecon reset /etc/shadow context system_u:object_r:unlabeled_t:s0->system_u:object_r:shadow_t:s0 restorecon reset /etc/selinux/config context system_u:object_r:unlabeled_t:s0->system_u:object_r:selinux_config_t:s0 [ root@linux ~ ] # setenforce 1 3. \u6587\u4ef6\u7cfb\u7edf\u9519\u8bef\u800c\u65e0\u6cd5\u5f00\u673a \u00b6 \u6700\u5bb9\u6613\u51fa\u9519\u7684\u8bbe\u5b9a\u800c\u5bfc\u81f4\u65e0\u6cd5\u987a\u5229\u5f00\u673a\u7684\u6b65\u9aa4\uff0c\u901a\u5e38\u5c31\u662f /etc/fstab \u8fd9\u4e2a\u6587\u4ef6\u4e86\uff0c\u5c24\u5176\u662f\u4f7f\u7528\u8005\u5728\u64cd\u4f5c Quota/LVM/RAID \u65f6\uff0c\u6700\u5bb9\u6613\u5199\u9519\u53c2\u6570\uff0c \u53c8\u6ca1\u6709\u7ecf\u8fc7 mount -a \u6765\u6d4b\u8bd5\u6302\u8f7d\uff0c\u5c31\u7acb\u523b\u76f4\u63a5\u91cd\u65b0\u542f\u52a8\uff01 \u8fd9\u79cd\u60c5\u51b5\u4e00\u822c\u90fd\u4f1a\u544a\u8bc9\u4f60\u662f\u54ea\u4e2a\u6587\u4ef6\u7cfb\u7edf\u51fa\u4e86\u95ee\u9898\uff0c\u4ee5root\u767b\u5f55\u4e4b\u540e\u91cd\u65b0\u4ee5\u53ef\u8bfb\u5199\u7684\u65b9\u5f0f\u6302\u8f7d / \uff0c\u7ee7\u7eed\u5904\u7406\u3002 \u5982\u679c\u662f\u6247\u533a\u9519\u4e71\u7684\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u78c1\u76d8\u4fee\u590d\u5de5\u5177 fsck \u3001 xfs_repair \u4fee\u590d\u55bd\u3002 \u800c\u4e14\u5982\u679c\u4f60\u7684 partition \u4e0a\u9762\u7684 filesystem \u6709\u8fc7\u591a\u7684\u6570\u636e\u635f\u6bc1\u65f6\uff0c\u5373\u4f7f fsck/xfs_repair \u5b8c\u6210\u540e\uff0c\u53ef\u80fd\u56e0\u4e3a\u4f24\u5230\u7cfb\u7edf\u69fd\uff0c\u5bfc\u81f4\u67d0\u4e9b\u5173\u952e\u7cfb\u7edf\u6587\u4ef6\u6570\u636e\u7684\u635f\u6bc1\uff0c\u90a3\u4e48\u4f9d\u65e7\u662f\u65e0\u6cd5\u8fdb\u5165 Linux \u7684\u3002\u6b64\u65f6\uff0c\u5c31\u597d\u5c31\u662f\u5c06\u7cfb\u7edf\u5f53\u4e2d\u7684\u91cd\u8981\u6570\u636e\u590d\u5236\u51fa\u6765\uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\uff0c\u5e76\u4e14\u68c0\u9a8c\u4e00\u4e0b\uff0c\u662f\u5426\u5b9e\u4f53\u786c\u76d8\u6709\u635f\u4f24\u7684\u73b0\u8c61\u3002","title":"25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3/#1-root","text":"\u53ea\u8981\u80fd\u591f\u8fdb\u5165OS\u5e76\u4e14\u6302\u8f7d / \uff0c \u7136\u540e\u91cd\u65b0\u8bbe\u7f6e\u4e00\u4e0b root \u7684\u5bc6\u7801\uff0c\u5c31OK\u4e86\u3002 \u53ea\u662f\u65b0\u7248\u7684 systemd \u7684\u7ba1\u7406\u673a\u5236\u4e2d\uff0c\u9ed8\u8ba4\u7684 rescue \u6a21\u5f0f\u662f\u65e0\u6cd5\u76f4\u63a5\u53d6\u5f97 root \u6743\u9650\u7684\uff0c\u8fd8\u9700\u8981\u8f93\u5165\u5bc6\u7801\uff01 \u6b64\u65f6\u53ef\u4ee5\u900f\u8fc7\u4e00\u4e2a\u540d\u4e3a rd.break \u7684\u6838\u5fc3\u53c2\u6570\u6765\u5904\u7406\u3002\u4e0b\u9762\u5217\u4e00\u4e0b\u6b65\u9aa4\u3002 \u5728\u5f00\u673a\u5185\u6838\u53c2\u6570\u4e2d\u6dfb\u52a0 rd.break \u5207\u6362\u5230\u539f\u7cfb\u7edf\u4e0b \u6b64\u65f6\u662f\u5728RAM Disk \u7684\u73af\u5883\uff0c\u5e76\u4e0d\u662f\u539f\u672c\u7684\u73af\u5883\u3002 \u4fee\u6539\u5bc6\u7801 \u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\u6839\u76ee\u5f55\u662f\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6302\u8f7d\u7684\uff0c\u73b0\u5728\u4ee5\u53ef\u8bfb\u5199\u7684\u65b9\u5f0f\u91cd\u65b0\u6302\u8f7d\u4e00\u4e0b\u5e76\u4fee\u6539\u5bc6\u7801\uff1a","title":"1. \u5fd8\u8bb0 root \u5bc6\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3/#11-autorelabel","text":"\u5728 rd.break \u7684 RAM Disk \u73af\u5883\u4e0b\uff0c\u7cfb\u7edf\u662f\u6ca1\u6709 SELinux \u7684\uff0c\u800c\u4f60\u521a\u521a\u66f4\u6539\u4e86 /etc/shadow \uff0c\u6240\u4ee5 \u8fd9\u4e2a\u6587\u4ef6\u7684 SELinux \u5b89\u5168\u672c\u6587\u7684\u7279\u6027\u5c06\u4f1a\u88ab\u53d6\u6d88 \uff01\u5982\u679c\u4f60\u6ca1\u6709\u8ba9\u7cfb\u7edf\u4e8e\u5f00\u673a\u65f6\u81ea\u52a8\u7684\u56de\u590d SELinux \u7684\u5b89\u5168\u672c\u6587\uff0c \u4f60\u7684\u7cfb\u7edf\u5c06\u4ea7\u751f \u65e0\u6cd5\u767b\u5165 \u7684\u95ee\u9898 (\u5728 SELinux \u4e3a Enforcing \u7684\u6a21\u5f0f\u4e0b\uff01)\u52a0\u4e0a /.autorelabel \u5c31\u662f\u8981\u8ba9\u7cfb\u7edf\u5728\u5f00\u673a\u7684\u65f6\u5019\u81ea\u52a8\u7684\u4f7f\u7528\u9884\u8bbe\u7684 SELinux type \u91cd\u65b0\u5199\u5165 SELinux \u5b89\u5168\u672c\u6587\u5230\u6bcf\u4e2a\u6587\u4ef6\u53bb\uff01 \u4e0d\u8fc7\u52a0\u4e0a /.autorelabel \u4e4b\u540e\uff0c\u7cfb\u7edf\u5728\u5f00\u673a\u5c31\u4f1a\u91cd\u65b0\u5199\u5165 SELinux \u7684 type \u5230\u6bcf\u4e2a\u6587\u4ef6\uff0c\u56e0\u6b64\u4f1a\u82b1\u4e0d\u5c11\u7684\u65f6\u95f4\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u8981\u82b1\u592a\u591a\u65f6\u95f4\uff0c\u8fd8\u6709\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5904\u7406\uff1a \u5728 rd.break \u6a21\u5f0f\u4e0b\uff0c\u4fee\u6539\u5b8c root \u5bc6\u7801\u540e\uff0c\u5c06 /etc/selinux/config \u5185\u7684 SELinux \u7c7b\u578b\u6539\u4e3a permissive \u91cd\u65b0\u542f\u52a8\u540e\uff0c\u4f7f\u7528 root \u7684\u8eab\u4efd\u4e0b\u8fbe restorecon -Rv /etc \u4ec5\u4fee\u6539 /etc \u5e95\u4e0b\u7684\u6587\u4ef6 \u91cd\u65b0\u4fee\u6539 /etc/selinux/config \u6539\u56de enforcing \uff0c\u7136\u540e setenforce 1 \u5373\u53ef\uff01","title":"1.1 \u4e3a\u4f55\u9700\u8981 /.autorelabel"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3/#2-root-bash","text":"\u9664\u4e86\u4e0a\u8ff0\u7684 rd.break \u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5f00\u673a\u53d6\u5f97\u7cfb\u7edf\u6839\u76ee\u5f55\u540e\uff0c\u8ba9\u7cfb\u7edf\u76f4\u63a5\u4e22\u4e00\u4e2a bash \u7ed9\u6211\u4eec\u4f7f\u7528\u3002 \u540c\u5728 linux16 \u7684\u90a3\u4e00\u884c\uff0c\u6700\u540e\u9762\u4e0d\u8981\u4f7f\u7528 rd.break \u800c\u662f\u4f7f\u7528 init=/bin/bash \u5373\u53ef\uff01 \u6700\u540e\u5f00\u673a\u5b8c\u6210\u5c31\u4f1a\u4e22\u4e00\u4e2a bash \u7ed9\u6211\u4eec\uff01\u540c\u6837\u4e0d\u9700\u8981 root \u5bc6\u7801\u800c\u6709 root \u6743\u9650\uff01 \u4f46\u662f\u8981\u5b8c\u6574\u7684\u64cd\u4f5c\u8be5\u7cfb\u7edf\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06 PID \u4e00\u53f7\u66f4\u6539\u4e3a bash \u5566\uff01\u6240\u4ee5\u8fde PATH \u90fd\u4ec5\u6709 /bin \u800c\u5df2~\u6240\u4ee5\u4f60\u4e0d\u80fd\u4e0b\u8fbe reboot\uff1a \u6b64\u65f6\u53ea\u80fd\u6309\u4e0b reset \u6216\u8005\u662f\u5f3a\u5236\u5173\u673a\u540e\uff0c\u624d\u80fd\u518d\u6b21\u5f00\u673a \uff01 \u91cd\u542f\u540e\u6062\u590d\u4e00\u4e0bSELinux\uff1a [ root@linux ~ ] # getenforce Permissive [ root@linux ~ ] # vi /etc/selinux/config [ root@linux ~ ] # grep enforcing /etc/selinux/config # enforcing - SELinux security policy is enforced. # permissive - SELinux prints warnings instead of enforcing. SELINUX = enforcing [ root@linux ~ ] # restorecon -Rv /etc/ restorecon reset /etc/shadow context system_u:object_r:unlabeled_t:s0->system_u:object_r:shadow_t:s0 restorecon reset /etc/selinux/config context system_u:object_r:unlabeled_t:s0->system_u:object_r:selinux_config_t:s0 [ root@linux ~ ] # setenforce 1","title":"2. \u76f4\u63a5\u5f00\u673a\u5c31\u4ee5 root \u6267\u884c bash \u7684\u65b9\u6cd5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/25 \u5f00\u673a\u8fc7\u7a0b\u7684\u95ee\u9898\u89e3\u51b3/#3","text":"\u6700\u5bb9\u6613\u51fa\u9519\u7684\u8bbe\u5b9a\u800c\u5bfc\u81f4\u65e0\u6cd5\u987a\u5229\u5f00\u673a\u7684\u6b65\u9aa4\uff0c\u901a\u5e38\u5c31\u662f /etc/fstab \u8fd9\u4e2a\u6587\u4ef6\u4e86\uff0c\u5c24\u5176\u662f\u4f7f\u7528\u8005\u5728\u64cd\u4f5c Quota/LVM/RAID \u65f6\uff0c\u6700\u5bb9\u6613\u5199\u9519\u53c2\u6570\uff0c \u53c8\u6ca1\u6709\u7ecf\u8fc7 mount -a \u6765\u6d4b\u8bd5\u6302\u8f7d\uff0c\u5c31\u7acb\u523b\u76f4\u63a5\u91cd\u65b0\u542f\u52a8\uff01 \u8fd9\u79cd\u60c5\u51b5\u4e00\u822c\u90fd\u4f1a\u544a\u8bc9\u4f60\u662f\u54ea\u4e2a\u6587\u4ef6\u7cfb\u7edf\u51fa\u4e86\u95ee\u9898\uff0c\u4ee5root\u767b\u5f55\u4e4b\u540e\u91cd\u65b0\u4ee5\u53ef\u8bfb\u5199\u7684\u65b9\u5f0f\u6302\u8f7d / \uff0c\u7ee7\u7eed\u5904\u7406\u3002 \u5982\u679c\u662f\u6247\u533a\u9519\u4e71\u7684\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u78c1\u76d8\u4fee\u590d\u5de5\u5177 fsck \u3001 xfs_repair \u4fee\u590d\u55bd\u3002 \u800c\u4e14\u5982\u679c\u4f60\u7684 partition \u4e0a\u9762\u7684 filesystem \u6709\u8fc7\u591a\u7684\u6570\u636e\u635f\u6bc1\u65f6\uff0c\u5373\u4f7f fsck/xfs_repair \u5b8c\u6210\u540e\uff0c\u53ef\u80fd\u56e0\u4e3a\u4f24\u5230\u7cfb\u7edf\u69fd\uff0c\u5bfc\u81f4\u67d0\u4e9b\u5173\u952e\u7cfb\u7edf\u6587\u4ef6\u6570\u636e\u7684\u635f\u6bc1\uff0c\u90a3\u4e48\u4f9d\u65e7\u662f\u65e0\u6cd5\u8fdb\u5165 Linux \u7684\u3002\u6b64\u65f6\uff0c\u5c31\u597d\u5c31\u662f\u5c06\u7cfb\u7edf\u5f53\u4e2d\u7684\u91cd\u8981\u6570\u636e\u590d\u5236\u51fa\u6765\uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\uff0c\u5e76\u4e14\u68c0\u9a8c\u4e00\u4e0b\uff0c\u662f\u5426\u5b9e\u4f53\u786c\u76d8\u6709\u635f\u4f24\u7684\u73b0\u8c61\u3002","title":"3. \u6587\u4ef6\u7cfb\u7edf\u9519\u8bef\u800c\u65e0\u6cd5\u5f00\u673a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/","text":"CentOS 6.x \u4ee5\u524d\u6709\u4e2a\u540d\u4e3a setup \u7684\u8f6f\u4ef6\u5c06\u8bb8\u591a\u7684\u8bbe\u5b9a\u505a\u6210\u7c7b\u56fe\u5f62\u754c\u9762\uff0c CentOS 7 \u5df2\u7ecf\u4e3a\u5f88\u591a\u547d\u4ee4\u52a0\u5165\u4e86 bash-complete \u7684\u529f\u80fd\u3002 1. \u7f51\u7edc\u8bbe\u7f6e \u00b6 \u9e1f\u54e5\u7684\u7f51\u7edc\u57fa\u7840\u4ecb\u7ecd nmcli [ OPTIONS ] OBJECT { COMMAND | help } \u63a7\u5236 NetworkManager \u7684\u547d\u4ee4\u884c\u5de5\u5177 OBJECT c [ onnection ] NetworkManager 's connections d [ evice ] devices managed by NetworkManager CONNECTION MANAGEMENT COMMANDS nmcli connection { show | up | down | modify | add | edit | clone | delete | monitor | reload | load | import | export } [ ARGUMENTS ... ] nmcli \u662f\u900f\u8fc7\u4e00\u4e2a\u540d\u4e3a \u8054\u673a\u4ee3\u53f7 \u7684\u540d\u79f0\u6765\u8bbe\u5b9a\u662f\u5426\u8981\u4e0a\u7f51\uff0c\u800c\u6bcf\u4e2a\u8054\u673a\u4ee3\u53f7\u4f1a\u6709\u4e2a \u7f51\u5361\u4ee3\u53f7 \uff0c \u8fd9\u4e24\u4e2a\u4e1c\u897f\u901a\u5e38\u8bbe\u5b9a\u6210\u76f8\u540c\u5c31\u662f\u4e86\u3002 1.1 \u67e5\u770b\u7f51\u7edc\u53c2\u6570 \u00b6 # \u9996\u5148\uff0c\u5fc5\u987b\u8981\u5f00\u542fNetworkManager\u670d\u52a1\u554a [ root@dev ~ ] # systemctl start NetworkManager [ root@dev ~ ] # nmcli connection show # NAME \u5c31\u662f\u8054\u673a\u4ee3\u53f7,\u901a\u5e38\u4e0e\u540e\u9762\u7684\u7f51\u5361 DEVICE \u4f1a\u4e00\u6837! # UUID \u8fd9\u4e2a\u662f\u7279\u6b8a\u7684\u88c5\u7f6e\u8bc6\u522b,\u4fdd\u7559\u5c31\u597d\u4e0d\u8981\u7406\u4ed6! # TYPE \u5c31\u662f\u7f51\u5361\u7684\u7c7b\u578b,\u901a\u5e38\u5c31\u662f\u4ee5\u592a\u7f51\u5361! # DEVICE \u5f53\u7136\u5c31\u662f\u7f51\u5361\u540d\u79f0\u5570! NAME UUID TYPE DEVICE ens37 4a5516a4-dfa4-24af-b1c4-e843e312e2fd ethernet ens37 ens33 a0adb700-66e5-4fa5-9ad9-ffe048c7f33b ethernet ens33 virbr0 5584116b-5bdd-4c5d-bfb4-436e3f88ac4e bridge virbr0 # \u8fd9\u91cc\u4e3a\u4ec0\u4e48\u591a\u4e86\u4e00\u5f20\uff01\uff01\uff01 ens33 e8f7f6ec-8d65-43d1-91a1-b5ec5792515a ethernet -- # \u8be6\u7ec6\u7684\u53c2\u6570\u5c31\u8981\u5e26\u4e0a\u540d\u5b57\u55bd [ root@dev ~ ] # nmcli connection show ens33 connection.id: ens33 connection.uuid: e8f7f6ec-8d65-43d1-91a1-b5ec5792515a connection.stable-id: -- connection.type: 802 -3-ethernet connection.interface-name: ens33 connection.autoconnect: yes \u2026\u2026 ipv4.method: manual ipv4.dns: 8 .8.8.8 ipv4.dns-search: -- ipv4.dns-options: \"\" ipv4.dns-priority: 0 ipv4.addresses: 192 .168.216.10/24 ipv4.gateway: 192 .168.216.2 \u2026\u2026 # \u5728\u6211\u7684\u673a\u5668\u4e0a\u4e0a\u9762\u7684\u4fe1\u606f\u4f1a\u6709\u4e24\u6bb5\uff0c\u4e5f\u7b26\u5408\u4e24\u4e2a\u8054\u673a\u4ee3\u53f7\uff1f IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.GATEWAY: -- \u5982\u4e0a\u8868\u7684\u8f93\u51fa\uff0c\u6700\u5e95\u4e0b\u7684\u5927\u5199\u7684 IP4\uff0c IP6 \u6307\u7684\u662f\u76ee\u524d\u7684\u5b9e\u9645\u4f7f\u7528\u7684\u7f51\u7edc\u53c2\u6570\uff0c\u6700\u4e0a\u9762\u7684 connection \u5f00\u5934\u7684\u90e8\u4efd\u5219\u6307\u7684\u662f\u8054\u673a\u7684\u72b6\u6001\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u53c2\u6570\uff1a connection.autoconnect [yes|no] \uff1a\u662f\u5426\u4e8e\u5f00\u673a\u65f6\u542f\u52a8\u8fd9\u4e2a\u8054\u673a\uff0c\u9884\u8bbe\u901a\u5e38\u662f yes \u624d\u5bf9! ipv4.method [auto|manual] \uff1a\u81ea\u52a8\u8fd8\u662f\u624b\u52a8\u8bbe\u5b9a\u7f51\u7edc\u53c2\u6570\u7684\u610f\u601d ipv4.dns [dns_server_ip] :\u5c31\u662f\u586b\u5199 DNS \u7684 IP \u5730\u5740~ ipv4.addresses [IP/Netmask] \uff1a\u5c31\u662f IP \u4e0e netmask \u7684\u96c6\u5408\uff0c\u4e2d\u95f4\u7528\u659c\u7ebf / \u6765\u9694\u5f00~ ipv4.gateway [gw_ip] \uff1a\u5c31\u662f gateway \u7684 IP \u5730\u5740! 1.2 \u624b\u52a8\u8bbe\u7f6e\u7f51\u7edc\u53c2\u6570 \u00b6 # \u4fee\u6539 [ root@dev ~ ] # nmcli connection modify ens33 connection.autoconnect yes ipv4.method manual ipv4.addresses 192.168.216.10/24 ipv4.gateway 192.168.216.2 ipv4.dns 8.8.8.8 # \u542f\u52a8 [ root@dev ~ ] # nmcli connection up ens33 Connection successfully activated ( D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4 ) # \u8bbe\u7f6e\u5b8c\u6210\u4e4b\u540e\u6709\u4e00\u4e2a\u8054\u673a\u4ee3\u53f7\u6d88\u5931\u4e86\u3002\u3002\u3002 [ root@dev ~ ] # nmcli connection show NAME UUID TYPE DEVICE ens37 4a5516a4-dfa4-24af-b1c4-e843e312e2fd ethernet ens37 ens33 e8f7f6ec-8d65-43d1-91a1-b5ec5792515a ethernet ens33 virbr0 5584116b-5bdd-4c5d-bfb4-436e3f88ac4e bridge virbr0 # \u518d\u6765\u67e5\u770b [ root@dev ~ ] # nmcli connection show ens33 \u2026\u2026 IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.GATEWAY: 192 .168.216.2 IP4.DNS [ 1 ] : 8 .8.8.8 1.3 \u81ea\u52a8\u8bbe\u7f6e\u7f51\u7edc\u53c2\u6570 \u00b6 \u5176\u5b9e\u8ddf\u4e0a\u9762\u5f88\u7c7b\u4f3c\u5566 [ root@dev ~ ] # nmcli connection modify ens33 connection.autoconnect yes ipv4.method auto [ root@dev ~ ] # nmcli connection up ens33 Connection successfully activated ( D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/5 ) # \u54e6\uff0c\u5c45\u7136\u6709\u4e24\u4e2aip\uff0c\u5e76\u4e14\u90fd\u53ef\u4ee5\u4f7f\u7528\uff01 [ root@dev ~ ] # nmcli connection show ens33 \u2026\u2026 IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.ADDRESS [ 2 ] : 192 .168.216.165/24 IP4.GATEWAY: 192 .168.216.2 nmcli \u7684\u53c2\u6570\u4e5f\u662f\u652f\u6301\u81ea\u52a8\u8865\u5168\u7684\u54e6\uff01 2. \u4fee\u6539\u4e3b\u673a\u540d \u00b6 hostnamectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current hostname settings set - hostname NAME Set system hostname [ root@dev ~ ] # hostnamectl Static hostname: dev Icon name: computer-vm Chassis: vm Machine ID: 0242c388ca104d46b8d6d9a4b951ff3f Boot ID: 8c349cebf0d1404483efc44765754ea4 Virtualization: vmware Operating System: CentOS Linux 7 ( Core ) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3 .10.0-1062.el7.x86_64 Architecture: x86-64 [ root@dev ~ ] # hostnamectl set-hostname shark [ root@dev ~ ] # hostname shark # \u65b0\u6253\u5f00\u7684\u7ec8\u7aef\u624d\u4f1a\u6539\u53d8\u54e6 [ root@shark ~ ] # 3. \u65e5\u671f\u4e0e\u65f6\u95f4\u8bbe\u7f6e \u00b6 timedatectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current time settings set - time TIME Set system time set - timezone ZONE Set system time zone list - timezones Show known time zones set - ntp BOOL Control whether NTP \uff08 Network Time Protocol \uff09 is enabled [ root@dev ~ ] # timedatectl Local time: Fri 2019 -12-13 10 :02:29 CST # \u672c\u5730\u65f6\u95f4 Universal time: Fri 2019 -12-13 02 :02:29 UTC # UTC \u65f6\u95f4,\u53ef\u79f0\u4e3a\u683c\u6797\u5a01\u6cbb\u6807\u51c6\u65f6\u95f4 RTC time: Fri 2019 -12-13 02 :02:29 Time zone: Asia/Shanghai ( CST, +0800 ) NTP enabled: yes NTP synchronized: yes RTC in local TZ: no DST active: n/a \u8fc7\u53bb\u6211\u4eec\u4f7f\u7528 date \u53bb\u4fee\u6539\u65e5\u671f\u540e\uff0c\u8fd8\u5f97\u8981\u4f7f\u7528 hwclock \u53bb\u8ba2\u6b63 BIOS \u8bb0\u5f55\u7684\u65f6\u95f4\u3002\u73b0\u5728\u900f\u8fc7 timedatectl \u53ef\u4ee5\u4e00\u6b65\u5230\u4f4d\uff01 3.1 \u7528 ntpdate \u624b\u52a8\u7f51\u7edc\u6821\u65f6 \u00b6 [ root@dev ~ ] # ntpdate ntp1.aliyun.com 13 Dec 10 :29:59 ntpdate [ 23726 ] : adjust time server 120 .25.115.20 offset 0 .002090 sec # \u5c06\u6b63\u786e\u7684\u65f6\u95f4\u5199\u5165\u4f60\u7684 BIOS \u65f6\u95f4\u8bb0\u5f55 [ root@dev ~ ] # hwclock -w \u540e\u7eed\u53ef\u4ee5\u5229\u7528 crontab \u6765\u66f4\u65b0\u7cfb\u7edf\u65f6\u95f4\u3002 4. \u8bed\u8a00\u73af\u5883\u8bbe\u7f6e \u00b6 \u7cfb\u7edf \u7684\u8bed\u8a00\u73af\u5883\u4e0e \u5f53\u524d\u7ec8\u7aef \u7684\u8bed\u8a00\u73af\u5883\u4e0d\u4e00\u5b9a\u662f\u4e00\u81f4\u7684\u3002 localectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current locale settings set - locale LOCALE ... Set system locale list - locales Show known locales [ root@dev ~ ] # locale LANG = en_US.UTF-8 # \u5f53\u524d\u7ec8\u7aef\u7684\u8bed\u8a00\u73af\u5883 LC_CTYPE = \"en_US.UTF-8\" LC_NUMERIC = \"en_US.UTF-8\" \u2026\u2026 LC_MEASUREMENT = \"en_US.UTF-8\" LC_IDENTIFICATION = \"en_US.UTF-8\" LC_ALL = # \u7cfb\u7edf\u7684\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # localectl System Locale: LANG = en_US.UTF-8 VC Keymap: us X11 Layout: us \u6539\u53d8\u8bed\u8a00\u73af\u5883\uff1a # \u6539\u53d8\u5f53\u524d\u7ec8\u7aef\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # export LC_ALL=zh_CN.UTF-8 [ root@dev ~ ] # locale LANG = en_US.UTF-8 LC_CTYPE = \"zh_CN.UTF-8\" \u2026\u2026 LC_IDENTIFICATION = \"zh_CN.UTF-8\" LC_ALL = zh_CN.UTF-8 # \u6539\u53d8\u7cfb\u7edf\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # localectl set-locale LANG=zh_CN.UTF-8 [ root@dev ~ ] # localectl System Locale: LANG = zh_CN.UTF-8 VC Keymap: us X11 Layout: us [ root@dev ~ ] # cat /etc/locale.conf LANG = zh_CN.UTF-8","title":"26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#1","text":"\u9e1f\u54e5\u7684\u7f51\u7edc\u57fa\u7840\u4ecb\u7ecd nmcli [ OPTIONS ] OBJECT { COMMAND | help } \u63a7\u5236 NetworkManager \u7684\u547d\u4ee4\u884c\u5de5\u5177 OBJECT c [ onnection ] NetworkManager 's connections d [ evice ] devices managed by NetworkManager CONNECTION MANAGEMENT COMMANDS nmcli connection { show | up | down | modify | add | edit | clone | delete | monitor | reload | load | import | export } [ ARGUMENTS ... ] nmcli \u662f\u900f\u8fc7\u4e00\u4e2a\u540d\u4e3a \u8054\u673a\u4ee3\u53f7 \u7684\u540d\u79f0\u6765\u8bbe\u5b9a\u662f\u5426\u8981\u4e0a\u7f51\uff0c\u800c\u6bcf\u4e2a\u8054\u673a\u4ee3\u53f7\u4f1a\u6709\u4e2a \u7f51\u5361\u4ee3\u53f7 \uff0c \u8fd9\u4e24\u4e2a\u4e1c\u897f\u901a\u5e38\u8bbe\u5b9a\u6210\u76f8\u540c\u5c31\u662f\u4e86\u3002","title":"1. \u7f51\u7edc\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#11","text":"# \u9996\u5148\uff0c\u5fc5\u987b\u8981\u5f00\u542fNetworkManager\u670d\u52a1\u554a [ root@dev ~ ] # systemctl start NetworkManager [ root@dev ~ ] # nmcli connection show # NAME \u5c31\u662f\u8054\u673a\u4ee3\u53f7,\u901a\u5e38\u4e0e\u540e\u9762\u7684\u7f51\u5361 DEVICE \u4f1a\u4e00\u6837! # UUID \u8fd9\u4e2a\u662f\u7279\u6b8a\u7684\u88c5\u7f6e\u8bc6\u522b,\u4fdd\u7559\u5c31\u597d\u4e0d\u8981\u7406\u4ed6! # TYPE \u5c31\u662f\u7f51\u5361\u7684\u7c7b\u578b,\u901a\u5e38\u5c31\u662f\u4ee5\u592a\u7f51\u5361! # DEVICE \u5f53\u7136\u5c31\u662f\u7f51\u5361\u540d\u79f0\u5570! NAME UUID TYPE DEVICE ens37 4a5516a4-dfa4-24af-b1c4-e843e312e2fd ethernet ens37 ens33 a0adb700-66e5-4fa5-9ad9-ffe048c7f33b ethernet ens33 virbr0 5584116b-5bdd-4c5d-bfb4-436e3f88ac4e bridge virbr0 # \u8fd9\u91cc\u4e3a\u4ec0\u4e48\u591a\u4e86\u4e00\u5f20\uff01\uff01\uff01 ens33 e8f7f6ec-8d65-43d1-91a1-b5ec5792515a ethernet -- # \u8be6\u7ec6\u7684\u53c2\u6570\u5c31\u8981\u5e26\u4e0a\u540d\u5b57\u55bd [ root@dev ~ ] # nmcli connection show ens33 connection.id: ens33 connection.uuid: e8f7f6ec-8d65-43d1-91a1-b5ec5792515a connection.stable-id: -- connection.type: 802 -3-ethernet connection.interface-name: ens33 connection.autoconnect: yes \u2026\u2026 ipv4.method: manual ipv4.dns: 8 .8.8.8 ipv4.dns-search: -- ipv4.dns-options: \"\" ipv4.dns-priority: 0 ipv4.addresses: 192 .168.216.10/24 ipv4.gateway: 192 .168.216.2 \u2026\u2026 # \u5728\u6211\u7684\u673a\u5668\u4e0a\u4e0a\u9762\u7684\u4fe1\u606f\u4f1a\u6709\u4e24\u6bb5\uff0c\u4e5f\u7b26\u5408\u4e24\u4e2a\u8054\u673a\u4ee3\u53f7\uff1f IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.GATEWAY: -- \u5982\u4e0a\u8868\u7684\u8f93\u51fa\uff0c\u6700\u5e95\u4e0b\u7684\u5927\u5199\u7684 IP4\uff0c IP6 \u6307\u7684\u662f\u76ee\u524d\u7684\u5b9e\u9645\u4f7f\u7528\u7684\u7f51\u7edc\u53c2\u6570\uff0c\u6700\u4e0a\u9762\u7684 connection \u5f00\u5934\u7684\u90e8\u4efd\u5219\u6307\u7684\u662f\u8054\u673a\u7684\u72b6\u6001\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u53c2\u6570\uff1a connection.autoconnect [yes|no] \uff1a\u662f\u5426\u4e8e\u5f00\u673a\u65f6\u542f\u52a8\u8fd9\u4e2a\u8054\u673a\uff0c\u9884\u8bbe\u901a\u5e38\u662f yes \u624d\u5bf9! ipv4.method [auto|manual] \uff1a\u81ea\u52a8\u8fd8\u662f\u624b\u52a8\u8bbe\u5b9a\u7f51\u7edc\u53c2\u6570\u7684\u610f\u601d ipv4.dns [dns_server_ip] :\u5c31\u662f\u586b\u5199 DNS \u7684 IP \u5730\u5740~ ipv4.addresses [IP/Netmask] \uff1a\u5c31\u662f IP \u4e0e netmask \u7684\u96c6\u5408\uff0c\u4e2d\u95f4\u7528\u659c\u7ebf / \u6765\u9694\u5f00~ ipv4.gateway [gw_ip] \uff1a\u5c31\u662f gateway \u7684 IP \u5730\u5740!","title":"1.1 \u67e5\u770b\u7f51\u7edc\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#12","text":"# \u4fee\u6539 [ root@dev ~ ] # nmcli connection modify ens33 connection.autoconnect yes ipv4.method manual ipv4.addresses 192.168.216.10/24 ipv4.gateway 192.168.216.2 ipv4.dns 8.8.8.8 # \u542f\u52a8 [ root@dev ~ ] # nmcli connection up ens33 Connection successfully activated ( D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4 ) # \u8bbe\u7f6e\u5b8c\u6210\u4e4b\u540e\u6709\u4e00\u4e2a\u8054\u673a\u4ee3\u53f7\u6d88\u5931\u4e86\u3002\u3002\u3002 [ root@dev ~ ] # nmcli connection show NAME UUID TYPE DEVICE ens37 4a5516a4-dfa4-24af-b1c4-e843e312e2fd ethernet ens37 ens33 e8f7f6ec-8d65-43d1-91a1-b5ec5792515a ethernet ens33 virbr0 5584116b-5bdd-4c5d-bfb4-436e3f88ac4e bridge virbr0 # \u518d\u6765\u67e5\u770b [ root@dev ~ ] # nmcli connection show ens33 \u2026\u2026 IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.GATEWAY: 192 .168.216.2 IP4.DNS [ 1 ] : 8 .8.8.8","title":"1.2 \u624b\u52a8\u8bbe\u7f6e\u7f51\u7edc\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#13","text":"\u5176\u5b9e\u8ddf\u4e0a\u9762\u5f88\u7c7b\u4f3c\u5566 [ root@dev ~ ] # nmcli connection modify ens33 connection.autoconnect yes ipv4.method auto [ root@dev ~ ] # nmcli connection up ens33 Connection successfully activated ( D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/5 ) # \u54e6\uff0c\u5c45\u7136\u6709\u4e24\u4e2aip\uff0c\u5e76\u4e14\u90fd\u53ef\u4ee5\u4f7f\u7528\uff01 [ root@dev ~ ] # nmcli connection show ens33 \u2026\u2026 IP4.ADDRESS [ 1 ] : 192 .168.216.10/24 IP4.ADDRESS [ 2 ] : 192 .168.216.165/24 IP4.GATEWAY: 192 .168.216.2 nmcli \u7684\u53c2\u6570\u4e5f\u662f\u652f\u6301\u81ea\u52a8\u8865\u5168\u7684\u54e6\uff01","title":"1.3 \u81ea\u52a8\u8bbe\u7f6e\u7f51\u7edc\u53c2\u6570"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#2","text":"hostnamectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current hostname settings set - hostname NAME Set system hostname [ root@dev ~ ] # hostnamectl Static hostname: dev Icon name: computer-vm Chassis: vm Machine ID: 0242c388ca104d46b8d6d9a4b951ff3f Boot ID: 8c349cebf0d1404483efc44765754ea4 Virtualization: vmware Operating System: CentOS Linux 7 ( Core ) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3 .10.0-1062.el7.x86_64 Architecture: x86-64 [ root@dev ~ ] # hostnamectl set-hostname shark [ root@dev ~ ] # hostname shark # \u65b0\u6253\u5f00\u7684\u7ec8\u7aef\u624d\u4f1a\u6539\u53d8\u54e6 [ root@shark ~ ] #","title":"2. \u4fee\u6539\u4e3b\u673a\u540d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#3","text":"timedatectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current time settings set - time TIME Set system time set - timezone ZONE Set system time zone list - timezones Show known time zones set - ntp BOOL Control whether NTP \uff08 Network Time Protocol \uff09 is enabled [ root@dev ~ ] # timedatectl Local time: Fri 2019 -12-13 10 :02:29 CST # \u672c\u5730\u65f6\u95f4 Universal time: Fri 2019 -12-13 02 :02:29 UTC # UTC \u65f6\u95f4,\u53ef\u79f0\u4e3a\u683c\u6797\u5a01\u6cbb\u6807\u51c6\u65f6\u95f4 RTC time: Fri 2019 -12-13 02 :02:29 Time zone: Asia/Shanghai ( CST, +0800 ) NTP enabled: yes NTP synchronized: yes RTC in local TZ: no DST active: n/a \u8fc7\u53bb\u6211\u4eec\u4f7f\u7528 date \u53bb\u4fee\u6539\u65e5\u671f\u540e\uff0c\u8fd8\u5f97\u8981\u4f7f\u7528 hwclock \u53bb\u8ba2\u6b63 BIOS \u8bb0\u5f55\u7684\u65f6\u95f4\u3002\u73b0\u5728\u900f\u8fc7 timedatectl \u53ef\u4ee5\u4e00\u6b65\u5230\u4f4d\uff01","title":"3. \u65e5\u671f\u4e0e\u65f6\u95f4\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#31-ntpdate","text":"[ root@dev ~ ] # ntpdate ntp1.aliyun.com 13 Dec 10 :29:59 ntpdate [ 23726 ] : adjust time server 120 .25.115.20 offset 0 .002090 sec # \u5c06\u6b63\u786e\u7684\u65f6\u95f4\u5199\u5165\u4f60\u7684 BIOS \u65f6\u95f4\u8bb0\u5f55 [ root@dev ~ ] # hwclock -w \u540e\u7eed\u53ef\u4ee5\u5229\u7528 crontab \u6765\u66f4\u65b0\u7cfb\u7edf\u65f6\u95f4\u3002","title":"3.1 \u7528 ntpdate \u624b\u52a8\u7f51\u7edc\u6821\u65f6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/26 \u7cfb\u7edf\u57fa\u672c\u8bbe\u5b9a/#4","text":"\u7cfb\u7edf \u7684\u8bed\u8a00\u73af\u5883\u4e0e \u5f53\u524d\u7ec8\u7aef \u7684\u8bed\u8a00\u73af\u5883\u4e0d\u4e00\u5b9a\u662f\u4e00\u81f4\u7684\u3002 localectl [ OPTIONS ...] COMMAND ... OPTIONS - H -- host = [ USER @] HOST Operate on remote host COMMAND status Show current locale settings set - locale LOCALE ... Set system locale list - locales Show known locales [ root@dev ~ ] # locale LANG = en_US.UTF-8 # \u5f53\u524d\u7ec8\u7aef\u7684\u8bed\u8a00\u73af\u5883 LC_CTYPE = \"en_US.UTF-8\" LC_NUMERIC = \"en_US.UTF-8\" \u2026\u2026 LC_MEASUREMENT = \"en_US.UTF-8\" LC_IDENTIFICATION = \"en_US.UTF-8\" LC_ALL = # \u7cfb\u7edf\u7684\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # localectl System Locale: LANG = en_US.UTF-8 VC Keymap: us X11 Layout: us \u6539\u53d8\u8bed\u8a00\u73af\u5883\uff1a # \u6539\u53d8\u5f53\u524d\u7ec8\u7aef\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # export LC_ALL=zh_CN.UTF-8 [ root@dev ~ ] # locale LANG = en_US.UTF-8 LC_CTYPE = \"zh_CN.UTF-8\" \u2026\u2026 LC_IDENTIFICATION = \"zh_CN.UTF-8\" LC_ALL = zh_CN.UTF-8 # \u6539\u53d8\u7cfb\u7edf\u8bed\u8a00\u73af\u5883 [ root@dev ~ ] # localectl set-locale LANG=zh_CN.UTF-8 [ root@dev ~ ] # localectl System Locale: LANG = zh_CN.UTF-8 VC Keymap: us X11 Layout: us [ root@dev ~ ] # cat /etc/locale.conf LANG = zh_CN.UTF-8","title":"4. \u8bed\u8a00\u73af\u5883\u8bbe\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/","text":"1. \u7528\u7cfb\u7edf\u5185\u7f6e\u7684 dmidecode \u89e3\u6790\u786c\u4ef6\u914d\u5907 \u00b6 dmidecode \u662f\u4e00\u79cd\u4ee5\u4eba\u53ef\u8bfb\u683c\u5f0f\u8f6c\u6362\u8ba1\u7b97\u673a\u7684 DMI\uff08\u6709\u4eba\u8bf4\u662f SMBIOS\uff09\u8868\u5185\u5bb9\u7684\u5de5\u5177\u3002\u6b64\u8868\u5305\u542b\u7cfb\u7edf\u786c\u4ef6\u7ec4\u4ef6\u7684\u8bf4\u660e\uff0c\u4ee5\u53ca\u5176\u4ed6\u6709\u7528\u7684\u4fe1\u606f\uff0c\u5982\u5e8f\u5217\u53f7\u548c BIOS \u4fee\u8ba2\u7248\u3002\u867d\u7136\u5c31\u62a5\u544a\u901f\u5ea6\u548c\u5b89\u5168\u6027\u800c\u8a00\u5f88\u4e0d\u9519\uff0c\u4f46\u8fd9\u4e5f\u4f7f\u5f97\u63d0\u4f9b\u7684\u4fe1\u606f\u53ef\u80fd\u4e0d\u53ef\u9760\u3002 dmidecode [ - t TYPE ] TYPE # \u66f4\u8be6\u7ec6\u7684\u53c2\u8003 \u201c man dmidecode \u201d 1 : \u8be6\u7ec6\u7684\u7cfb\u7edf\u6570\u636e , \u542b\u4e3b\u677f\u7684\u578b\u53f7\u4e0e\u786c\u4ef6\u7684\u57fa\u7840\u6570\u636e\u7b49 4 : CPU \u7684\u76f8\u5173\u8d44\u6599 , \u5305\u62ec\u500d\u9891\u3001\u5916\u9891\u3001\u6838\u5fc3\u6570\u3001\u6838\u5fc3\u7eea\u6570\u7b49 9 : \u7cfb\u7edf\u7684\u76f8\u5173\u63d2\u69fd\u683c\u5f0f , \u5305\u62ec PCI , PCI - E \u7b49\u7b49\u7684\u63d2\u69fd\u89c4\u683c\u8bf4\u660e 17 : \u6bcf\u4e00\u4e2a\u5185\u5b58\u63d2\u69fd\u7684\u89c4\u683c , \u82e5\u5185\u6709\u5185\u5b58 , \u5219\u5217\u51fa\u8be5\u5185\u5b58\u7684\u5bb9\u91cf\u4e0e\u578b\u53f7 [ root@dev ~ ] # dmidecode | less # dmidecode 3.2 Getting SMBIOS data from sysfs. SMBIOS 2 .7 present. 620 structures occupying 28932 bytes. Table at 0x000E0010. Handle 0x0000, DMI type 0 , 24 bytes BIOS Information Vendor: Phoenix Technologies LTD Version: 6 .00 Release Date: 05 /19/2017 \u2026\u2026 Handle 0x0002, DMI type 2 , 15 bytes Base Board Information Manufacturer: Intel Corporation Product Name: 440BX Desktop Reference Platform \u2026\u2026 Handle 0x026B, DMI type 127 , 4 bytes End Of Table 2. \u786c\u4ef6\u8d44\u6e90\u7684\u6536\u96c6\u4e0e\u5206\u6790 \u00b6 \u5185\u6838\u6240\u4fa6\u6d4b\u5230\u7684\u5404\u9879\u786c\u4ef6\u88c5\u7f6e\uff0c\u540e\u6765\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5728 /proc \u4e0e /sys \u5f53\u4e2d\u4e86\u3002 \u5176\u5b9e\u6838\u5fc3\u6240\u4fa6\u6d4b\u5230\u7684\u786c\u4ef6\u53ef\u80fd\u5e76\u975e\u5b8c\u5168\u6b63\u786e\uff01\u56e0\u4e3a\u4ed6\u4ec5\u662f \u4f7f\u7528\u6700\u9002\u5f53\u7684\u6a21\u5757\u6765\u9a71\u52a8\u8fd9\u4e2a\u786c\u4ef6 \u800c\u5df2\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u96be\u514d\u4f1a\u8bef\u5224\u5566 (\u867d\u7136\u673a\u7387\u975e\u5e38\u4e4b\u4f4e)\uff01 \u9664\u4e86\u76f4\u63a5\u547c\u53eb\u51fa /proc \u5e95\u4e0b\u7684\u6587\u4ef6\u5185\u5bb9\u4e4b\u5916\uff0c \u8fd8\u6709\u4e00\u4e9b\u6307\u4ee4\u53ef\u7528\uff0c\u5e38\u89c1\u7684\u6307\u4ee4\u6709\u5e95\u4e0b\u8fd9\u4e9b\uff1a gdisk dmesg vmstat \uff1a\u5206\u6790\u7cfb\u7edf (CPU/RAM/IO) \u76ee\u524d\u7684\u72b6\u6001 lspci \uff1a\u5217\u51fa\u6574\u4e2a PC \u7cfb\u7edf\u7684 PCI \u63a5\u53e3\u88c5\u7f6e lsusb \uff1a\u5217\u51fa\u76ee\u524d\u7cfb\u7edf\u4e0a\u9762\u5404\u4e2a USB \u7aef\u53e3\u53e3\u7684\u72b6\u6001,\u4e0e\u8fde\u63a5\u7684 USB \u88c5\u7f6e iostat \uff1a\u4e0e vmstat \u7c7b\u4f3c,\u53ef\u5b9e\u65f6\u5217\u51fa\u6574\u4e2a CPU \u4e0e\u63a5\u53e3\u8bbe\u5907\u7684 Input/Output \u72b6\u6001 2.1 lspci \u00b6 lspci [ options ] Display options - v - vv Options to control resolving ID ' s to names - n \u76f4\u63a5\u89c2\u5bdf PCI \u7684 ID \u800c\u4e0d\u662f\u5382\u5546\u540d\u79f0 Options for selection of devices - s [[[[ < domain > ]:] < bus > ]:][ < device > ][.[ < func > ]] Show only devices in the specified domain , bus , device and function [ root@dev ~ ] # lspci 00 :00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge ( rev 01 ) 00 :01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge ( rev 01 ) \u2026\u2026 02 :05.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller ( Copper ) ( rev 01 ) 03 :00.0 USB controller: VMware USB3 xHCI 1 .0 Controller [ root@dev ~ ] # lspci -s 03:00.0 -v 03 :00.0 USB controller: VMware USB3 xHCI 1 .0 Controller ( prog-if 30 [ XHCI ]) Subsystem: VMware USB3 xHCI 1 .0 Controller Physical Slot: 160 Flags: bus master, fast devsel, latency 64 , IRQ 18 Memory at fd4e0000 ( 64 -bit, non-prefetchable ) [ size = 128K ] Capabilities: [ 64 ] Power Management version 3 Capabilities: [ 6c ] Express Endpoint, MSI 00 Capabilities: [ a8 ] MSI: Enable- Count = 1 /1 Maskable+ 64bit+ Capabilities: [ c0 ] MSI-X: Enable+ Count = 31 Masked- Kernel driver in use: xhci_hcd -s \u63a5\u7684\u53c2\u6570\u5c31\u662f\u6bcf\u4e2a\u8bbe\u5907\u7684\u603b\u7ebf\u3001\u63d2\u69fd\u53ca\u51fd\u6570\uff0c\u53ef\u4ee5\u5bf9\u7167 /usr/share/hwdata/pci.ids \uff08\u5c31\u662f PCI \u7684\u6807\u51c6 ID \u4e0e\u5382\u724c\u540d\u79f0\u7684\u5bf9\u5e94\u8868\uff09\u6765\u4e86\u89e3\u8fd9\u4e32\u6570\u636e\u7684\u610f\u4e49\u3002 \u4e0d\u8fc7\uff0c\u7531\u4e8e\u786c\u4ef6\u7684\u53d1\u5c55\u592a\u8fc7\u8fc5\u901f\uff0c\u6240\u4ee5\u4f60\u7684 pci.ids \u6587\u4ef6\u53ef\u80fd\u4f1a\u843d\u4f0d\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528\u5e95\u4e0b\u7684\u65b9\u5f0f\u6765\u5728\u7ebf\u66f4\u65b0\u4f60\u7684\u5bf9\u5e94\u6587\u4ef6\uff1a [ root@dev ~ ] # update-pciids % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 254k 100 254k 0 0 3268 0 0 :01:19 0 :01:19 --:--:-- 2752 Done. 2.2 lsusb \u00b6 lsusb [ options ]... options - v , -- verbose - s [[ bus ]:][ devnum ] Show only devices with specified device and / or bus numbers ( 10 \u8fdb\u5236 ) [ root@dev ~ ] # lsusb Bus 004 Device 001 : ID 1d6b:0003 Linux Foundation 3 .0 root hub Bus 003 Device 002 : ID 0e0f:0003 VMware, Inc. Virtual Mouse \u2026\u2026 Bus 002 Device 001 : ID 1d6b:0001 Linux Foundation 1 .1 root hub [ root@dev ~ ] # lsusb -s 004:001 -v Bus 004 Device 001 : ID 1d6b:0003 Linux Foundation 3 .0 root hub Device Descriptor: \u2026\u2026 ID \u53f7\u7801\u4e0e\u5382\u5546\u5bf9\u7167\u8868\u4f4d\u4e8e /usr/share/hwdata/usb.ids \u6587\u4ef6\u3002 2.3 iostat \u00b6 iostat [ - c |- d ] [ - k |- m ] [ - t ] [ device [...] | ALL ] [ \u95f4\u9694\u79d2\u6570 ] [ \u4fa6\u6d4b\u6b21\u6570 ] \u9009\u9879\u4e0e\u53c2\u6570 : - c : \u4ec5\u663e\u793a CPU \u7684\u72b6\u6001 ; - d : \u4ec5\u663e\u793a\u50a8\u5b58\u8bbe\u5907\u7684\u72b6\u6001 , \u4e0d\u53ef\u4e0e - c \u4e00\u8d77\u7528 ; - k : \u9ed8\u8ba4\u663e\u793a\u7684\u662f block , \u8fd9\u91cc\u53ef\u4ee5\u6539\u6210 K bytes \u7684\u5927\u5c0f\u6765\u663e\u793a ; - m : \u4e0e - k \u7c7b\u4f3c , \u53ea\u662f\u4ee5 MB \u7684\u5355\u4f4d\u6765\u663e\u793a\u7ed3\u679c\u3002 - t : \u663e\u793a\u65e5\u671f\u51fa\u6765 ; [ root@dev ~ ] # iostat Linux 3 .10.0-1062.el7.x86_64 ( dev ) 12 /13/2019 _x86_64_ ( 8 CPU ) avg-cpu: %user %nice %system %iowait %steal %idle 0 .48 0 .00 0 .36 0 .04 0 .00 99 .13 Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .97 25 .98 17 .73 2025195 1381850 sdb 0 .00 0 .04 0 .00 2800 0 dm-0 1 .03 23 .22 17 .70 1809962 1379441 dm-1 0 .00 0 .03 0 .00 2208 0 tps\uff1a\u5e73\u5747\u6bcf\u79d2\u949f\u7684\u4f20\u9001\u6b21\u6570\uff0c\u4e0e\u6570\u636e\u4f20\u8f93 \u6b21\u6570 \u6709\u5173\uff0c\u975e\u5bb9\u91cf kB_read/s\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5e73\u5747\u7684\u8bfb\u53d6\u5355\u4f4d kB_wrtn/s\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5e73\u5747\u7684\u8bfb\u53d6\u5355\u4f4d kB_read\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5168\u90e8\u7684\u8bfb\u53d6\u5355\u4f4d # \u4ec5\u9488\u5bf9 sda ,\u6bcf\u4e24\u79d2\u949f\u4fa6\u6d4b\u4e00\u6b21,\u5e76\u4e14\u5171\u4fa6\u6d4b\u4e09\u6b21\u50a8\u5b58\u88c5\u7f6e [ root@dev ~ ] # iostat -d sda 2 3 Linux 3 .10.0-1062.el7.x86_64 ( dev ) 12 /13/2019 _x86_64_ ( 8 CPU ) # \u7b2c\u4e00\u6b21\u663e\u793a\u7684\u662f\u201c\u4ece\u5f00\u673a\u5230\u73b0\u5728\u7684\u6570\u636e\u201c Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .99 25 .91 19 .15 2025195 1496529 # \u7b2c\u4e8c\u6b21\u4ee5\u540e\u6240\u663e\u793a\u7684\u6570\u636e\u5219\u4ee3\u8868\u4e24\u6b21\u4fa6\u6d4b\u4e4b\u95f4\u7684\u7cfb\u7edf\u4f20\u8f93\u503c Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .00 0 .00 0 .00 0 0 Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 1 .00 0 .00 4 .00 0 8 3. \u4e86\u89e3\u78c1\u76d8\u7684\u5065\u5eb7\u72b6\u6001 \u00b6 \u78c1\u76d8\u5065\u5eb7\u72b6\u51b5\u53ef\u4ee5\u901a\u8fc7 smartd \u670d\u52a1\u6765\u76d1\u6d4b\uff0c\u4f46\u662f\u88ab\u76d1\u6d4b\u7684\u78c1\u76d8\u4e5f\u5fc5\u987b\u8981\u652f\u6301 SMART \u7684\u534f\u8bae\uff01 smartctl \u6307\u4ee4\u63a7\u5236\u5185\u7f6e\u4e8e\u5927\u591a\u6570 ATA/SATA \u548c SCSI/SAS \u786c\u76d8\u548c\u56fa\u6001\u9a71\u52a8\u5668\u4e2d\u7684 Self-Monitoring, Analysis and Reporting Technology (SMART) \u7cfb\u7edf\u3002 smartctl [ options ] device options - a , --all Prints all SMART information about the disk - t TEST , --test=TEST Executes TEST immediately.TEST\uff1aoffline\uff0cshort\uff0clong\uff0cconveyance [ root@dev ~ ] # smartctl -a /dev/sda smartctl 7 .0 2018 -12-30 r4883 [ x86_64-linux-3.10.0-1062.el7.x86_64 ] ( local build ) Copyright ( C ) 2002 -18, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Vendor: VMware, Product: VMware Virtual S Revision: 1 .0 User Capacity: 53 ,687,091,200 bytes [ 53 .6 GB ] Logical block size: 512 bytes Device type: disk Local Time is: Fri Dec 13 14 :54:13 2019 CST SMART support is: Unavailable - device lacks SMART capability. # \u865a\u62df\u673a\u4e0d\u652f\u6301\uff01\u5728\u7269\u7406\u673a\u4e0a\u6d4b\u8bd5 //TODO === START OF READ SMART DATA SECTION === # \u90a3\u4e48\u4e0b\u9762\u4e5f\u5c31\u6ca1\u4ec0\u4e48\u4fe1\u606f\u4e86 \u2026\u2026 Device does not support Self Test logging # \u8fdb\u884c\u4e00\u6b21\u81ea\u6211\u68c0\u6d4b [ root@dev ~ ] # smartctl -t offline /dev/sdb \u2026\u2026 Default Self Test Successful \u6ce8\u610f \uff1a\u8fdb\u884c\u78c1\u76d8\u81ea\u6211\u68c0\u67e5\u65f6\uff0c\u78c1\u76d8\u7684 I/O \u72b6\u6001\u53ef\u80fd\u4f1a\u6bd4\u8f83\u9891\u7e41\u3002","title":"27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#1-dmidecode","text":"dmidecode \u662f\u4e00\u79cd\u4ee5\u4eba\u53ef\u8bfb\u683c\u5f0f\u8f6c\u6362\u8ba1\u7b97\u673a\u7684 DMI\uff08\u6709\u4eba\u8bf4\u662f SMBIOS\uff09\u8868\u5185\u5bb9\u7684\u5de5\u5177\u3002\u6b64\u8868\u5305\u542b\u7cfb\u7edf\u786c\u4ef6\u7ec4\u4ef6\u7684\u8bf4\u660e\uff0c\u4ee5\u53ca\u5176\u4ed6\u6709\u7528\u7684\u4fe1\u606f\uff0c\u5982\u5e8f\u5217\u53f7\u548c BIOS \u4fee\u8ba2\u7248\u3002\u867d\u7136\u5c31\u62a5\u544a\u901f\u5ea6\u548c\u5b89\u5168\u6027\u800c\u8a00\u5f88\u4e0d\u9519\uff0c\u4f46\u8fd9\u4e5f\u4f7f\u5f97\u63d0\u4f9b\u7684\u4fe1\u606f\u53ef\u80fd\u4e0d\u53ef\u9760\u3002 dmidecode [ - t TYPE ] TYPE # \u66f4\u8be6\u7ec6\u7684\u53c2\u8003 \u201c man dmidecode \u201d 1 : \u8be6\u7ec6\u7684\u7cfb\u7edf\u6570\u636e , \u542b\u4e3b\u677f\u7684\u578b\u53f7\u4e0e\u786c\u4ef6\u7684\u57fa\u7840\u6570\u636e\u7b49 4 : CPU \u7684\u76f8\u5173\u8d44\u6599 , \u5305\u62ec\u500d\u9891\u3001\u5916\u9891\u3001\u6838\u5fc3\u6570\u3001\u6838\u5fc3\u7eea\u6570\u7b49 9 : \u7cfb\u7edf\u7684\u76f8\u5173\u63d2\u69fd\u683c\u5f0f , \u5305\u62ec PCI , PCI - E \u7b49\u7b49\u7684\u63d2\u69fd\u89c4\u683c\u8bf4\u660e 17 : \u6bcf\u4e00\u4e2a\u5185\u5b58\u63d2\u69fd\u7684\u89c4\u683c , \u82e5\u5185\u6709\u5185\u5b58 , \u5219\u5217\u51fa\u8be5\u5185\u5b58\u7684\u5bb9\u91cf\u4e0e\u578b\u53f7 [ root@dev ~ ] # dmidecode | less # dmidecode 3.2 Getting SMBIOS data from sysfs. SMBIOS 2 .7 present. 620 structures occupying 28932 bytes. Table at 0x000E0010. Handle 0x0000, DMI type 0 , 24 bytes BIOS Information Vendor: Phoenix Technologies LTD Version: 6 .00 Release Date: 05 /19/2017 \u2026\u2026 Handle 0x0002, DMI type 2 , 15 bytes Base Board Information Manufacturer: Intel Corporation Product Name: 440BX Desktop Reference Platform \u2026\u2026 Handle 0x026B, DMI type 127 , 4 bytes End Of Table","title":"1. \u7528\u7cfb\u7edf\u5185\u7f6e\u7684 dmidecode \u89e3\u6790\u786c\u4ef6\u914d\u5907"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#2","text":"\u5185\u6838\u6240\u4fa6\u6d4b\u5230\u7684\u5404\u9879\u786c\u4ef6\u88c5\u7f6e\uff0c\u540e\u6765\u5c31\u4f1a\u88ab\u8bb0\u5f55\u5728 /proc \u4e0e /sys \u5f53\u4e2d\u4e86\u3002 \u5176\u5b9e\u6838\u5fc3\u6240\u4fa6\u6d4b\u5230\u7684\u786c\u4ef6\u53ef\u80fd\u5e76\u975e\u5b8c\u5168\u6b63\u786e\uff01\u56e0\u4e3a\u4ed6\u4ec5\u662f \u4f7f\u7528\u6700\u9002\u5f53\u7684\u6a21\u5757\u6765\u9a71\u52a8\u8fd9\u4e2a\u786c\u4ef6 \u800c\u5df2\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u96be\u514d\u4f1a\u8bef\u5224\u5566 (\u867d\u7136\u673a\u7387\u975e\u5e38\u4e4b\u4f4e)\uff01 \u9664\u4e86\u76f4\u63a5\u547c\u53eb\u51fa /proc \u5e95\u4e0b\u7684\u6587\u4ef6\u5185\u5bb9\u4e4b\u5916\uff0c \u8fd8\u6709\u4e00\u4e9b\u6307\u4ee4\u53ef\u7528\uff0c\u5e38\u89c1\u7684\u6307\u4ee4\u6709\u5e95\u4e0b\u8fd9\u4e9b\uff1a gdisk dmesg vmstat \uff1a\u5206\u6790\u7cfb\u7edf (CPU/RAM/IO) \u76ee\u524d\u7684\u72b6\u6001 lspci \uff1a\u5217\u51fa\u6574\u4e2a PC \u7cfb\u7edf\u7684 PCI \u63a5\u53e3\u88c5\u7f6e lsusb \uff1a\u5217\u51fa\u76ee\u524d\u7cfb\u7edf\u4e0a\u9762\u5404\u4e2a USB \u7aef\u53e3\u53e3\u7684\u72b6\u6001,\u4e0e\u8fde\u63a5\u7684 USB \u88c5\u7f6e iostat \uff1a\u4e0e vmstat \u7c7b\u4f3c,\u53ef\u5b9e\u65f6\u5217\u51fa\u6574\u4e2a CPU \u4e0e\u63a5\u53e3\u8bbe\u5907\u7684 Input/Output \u72b6\u6001","title":"2. \u786c\u4ef6\u8d44\u6e90\u7684\u6536\u96c6\u4e0e\u5206\u6790"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#21-lspci","text":"lspci [ options ] Display options - v - vv Options to control resolving ID ' s to names - n \u76f4\u63a5\u89c2\u5bdf PCI \u7684 ID \u800c\u4e0d\u662f\u5382\u5546\u540d\u79f0 Options for selection of devices - s [[[[ < domain > ]:] < bus > ]:][ < device > ][.[ < func > ]] Show only devices in the specified domain , bus , device and function [ root@dev ~ ] # lspci 00 :00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge ( rev 01 ) 00 :01.0 PCI bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge ( rev 01 ) \u2026\u2026 02 :05.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller ( Copper ) ( rev 01 ) 03 :00.0 USB controller: VMware USB3 xHCI 1 .0 Controller [ root@dev ~ ] # lspci -s 03:00.0 -v 03 :00.0 USB controller: VMware USB3 xHCI 1 .0 Controller ( prog-if 30 [ XHCI ]) Subsystem: VMware USB3 xHCI 1 .0 Controller Physical Slot: 160 Flags: bus master, fast devsel, latency 64 , IRQ 18 Memory at fd4e0000 ( 64 -bit, non-prefetchable ) [ size = 128K ] Capabilities: [ 64 ] Power Management version 3 Capabilities: [ 6c ] Express Endpoint, MSI 00 Capabilities: [ a8 ] MSI: Enable- Count = 1 /1 Maskable+ 64bit+ Capabilities: [ c0 ] MSI-X: Enable+ Count = 31 Masked- Kernel driver in use: xhci_hcd -s \u63a5\u7684\u53c2\u6570\u5c31\u662f\u6bcf\u4e2a\u8bbe\u5907\u7684\u603b\u7ebf\u3001\u63d2\u69fd\u53ca\u51fd\u6570\uff0c\u53ef\u4ee5\u5bf9\u7167 /usr/share/hwdata/pci.ids \uff08\u5c31\u662f PCI \u7684\u6807\u51c6 ID \u4e0e\u5382\u724c\u540d\u79f0\u7684\u5bf9\u5e94\u8868\uff09\u6765\u4e86\u89e3\u8fd9\u4e32\u6570\u636e\u7684\u610f\u4e49\u3002 \u4e0d\u8fc7\uff0c\u7531\u4e8e\u786c\u4ef6\u7684\u53d1\u5c55\u592a\u8fc7\u8fc5\u901f\uff0c\u6240\u4ee5\u4f60\u7684 pci.ids \u6587\u4ef6\u53ef\u80fd\u4f1a\u843d\u4f0d\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528\u5e95\u4e0b\u7684\u65b9\u5f0f\u6765\u5728\u7ebf\u66f4\u65b0\u4f60\u7684\u5bf9\u5e94\u6587\u4ef6\uff1a [ root@dev ~ ] # update-pciids % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 254k 100 254k 0 0 3268 0 0 :01:19 0 :01:19 --:--:-- 2752 Done.","title":"2.1 lspci"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#22-lsusb","text":"lsusb [ options ]... options - v , -- verbose - s [[ bus ]:][ devnum ] Show only devices with specified device and / or bus numbers ( 10 \u8fdb\u5236 ) [ root@dev ~ ] # lsusb Bus 004 Device 001 : ID 1d6b:0003 Linux Foundation 3 .0 root hub Bus 003 Device 002 : ID 0e0f:0003 VMware, Inc. Virtual Mouse \u2026\u2026 Bus 002 Device 001 : ID 1d6b:0001 Linux Foundation 1 .1 root hub [ root@dev ~ ] # lsusb -s 004:001 -v Bus 004 Device 001 : ID 1d6b:0003 Linux Foundation 3 .0 root hub Device Descriptor: \u2026\u2026 ID \u53f7\u7801\u4e0e\u5382\u5546\u5bf9\u7167\u8868\u4f4d\u4e8e /usr/share/hwdata/usb.ids \u6587\u4ef6\u3002","title":"2.2 lsusb"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#23-iostat","text":"iostat [ - c |- d ] [ - k |- m ] [ - t ] [ device [...] | ALL ] [ \u95f4\u9694\u79d2\u6570 ] [ \u4fa6\u6d4b\u6b21\u6570 ] \u9009\u9879\u4e0e\u53c2\u6570 : - c : \u4ec5\u663e\u793a CPU \u7684\u72b6\u6001 ; - d : \u4ec5\u663e\u793a\u50a8\u5b58\u8bbe\u5907\u7684\u72b6\u6001 , \u4e0d\u53ef\u4e0e - c \u4e00\u8d77\u7528 ; - k : \u9ed8\u8ba4\u663e\u793a\u7684\u662f block , \u8fd9\u91cc\u53ef\u4ee5\u6539\u6210 K bytes \u7684\u5927\u5c0f\u6765\u663e\u793a ; - m : \u4e0e - k \u7c7b\u4f3c , \u53ea\u662f\u4ee5 MB \u7684\u5355\u4f4d\u6765\u663e\u793a\u7ed3\u679c\u3002 - t : \u663e\u793a\u65e5\u671f\u51fa\u6765 ; [ root@dev ~ ] # iostat Linux 3 .10.0-1062.el7.x86_64 ( dev ) 12 /13/2019 _x86_64_ ( 8 CPU ) avg-cpu: %user %nice %system %iowait %steal %idle 0 .48 0 .00 0 .36 0 .04 0 .00 99 .13 Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .97 25 .98 17 .73 2025195 1381850 sdb 0 .00 0 .04 0 .00 2800 0 dm-0 1 .03 23 .22 17 .70 1809962 1379441 dm-1 0 .00 0 .03 0 .00 2208 0 tps\uff1a\u5e73\u5747\u6bcf\u79d2\u949f\u7684\u4f20\u9001\u6b21\u6570\uff0c\u4e0e\u6570\u636e\u4f20\u8f93 \u6b21\u6570 \u6709\u5173\uff0c\u975e\u5bb9\u91cf kB_read/s\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5e73\u5747\u7684\u8bfb\u53d6\u5355\u4f4d kB_wrtn/s\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5e73\u5747\u7684\u8bfb\u53d6\u5355\u4f4d kB_read\uff1a\u5f00\u673a\u5230\u73b0\u5728\u5168\u90e8\u7684\u8bfb\u53d6\u5355\u4f4d # \u4ec5\u9488\u5bf9 sda ,\u6bcf\u4e24\u79d2\u949f\u4fa6\u6d4b\u4e00\u6b21,\u5e76\u4e14\u5171\u4fa6\u6d4b\u4e09\u6b21\u50a8\u5b58\u88c5\u7f6e [ root@dev ~ ] # iostat -d sda 2 3 Linux 3 .10.0-1062.el7.x86_64 ( dev ) 12 /13/2019 _x86_64_ ( 8 CPU ) # \u7b2c\u4e00\u6b21\u663e\u793a\u7684\u662f\u201c\u4ece\u5f00\u673a\u5230\u73b0\u5728\u7684\u6570\u636e\u201c Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .99 25 .91 19 .15 2025195 1496529 # \u7b2c\u4e8c\u6b21\u4ee5\u540e\u6240\u663e\u793a\u7684\u6570\u636e\u5219\u4ee3\u8868\u4e24\u6b21\u4fa6\u6d4b\u4e4b\u95f4\u7684\u7cfb\u7edf\u4f20\u8f93\u503c Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 0 .00 0 .00 0 .00 0 0 Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn sda 1 .00 0 .00 4 .00 0 8","title":"2.3 iostat"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/27 \u786c\u4ef6\u6570\u636e\u7684\u6536\u96c6/#3","text":"\u78c1\u76d8\u5065\u5eb7\u72b6\u51b5\u53ef\u4ee5\u901a\u8fc7 smartd \u670d\u52a1\u6765\u76d1\u6d4b\uff0c\u4f46\u662f\u88ab\u76d1\u6d4b\u7684\u78c1\u76d8\u4e5f\u5fc5\u987b\u8981\u652f\u6301 SMART \u7684\u534f\u8bae\uff01 smartctl \u6307\u4ee4\u63a7\u5236\u5185\u7f6e\u4e8e\u5927\u591a\u6570 ATA/SATA \u548c SCSI/SAS \u786c\u76d8\u548c\u56fa\u6001\u9a71\u52a8\u5668\u4e2d\u7684 Self-Monitoring, Analysis and Reporting Technology (SMART) \u7cfb\u7edf\u3002 smartctl [ options ] device options - a , --all Prints all SMART information about the disk - t TEST , --test=TEST Executes TEST immediately.TEST\uff1aoffline\uff0cshort\uff0clong\uff0cconveyance [ root@dev ~ ] # smartctl -a /dev/sda smartctl 7 .0 2018 -12-30 r4883 [ x86_64-linux-3.10.0-1062.el7.x86_64 ] ( local build ) Copyright ( C ) 2002 -18, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Vendor: VMware, Product: VMware Virtual S Revision: 1 .0 User Capacity: 53 ,687,091,200 bytes [ 53 .6 GB ] Logical block size: 512 bytes Device type: disk Local Time is: Fri Dec 13 14 :54:13 2019 CST SMART support is: Unavailable - device lacks SMART capability. # \u865a\u62df\u673a\u4e0d\u652f\u6301\uff01\u5728\u7269\u7406\u673a\u4e0a\u6d4b\u8bd5 //TODO === START OF READ SMART DATA SECTION === # \u90a3\u4e48\u4e0b\u9762\u4e5f\u5c31\u6ca1\u4ec0\u4e48\u4fe1\u606f\u4e86 \u2026\u2026 Device does not support Self Test logging # \u8fdb\u884c\u4e00\u6b21\u81ea\u6211\u68c0\u6d4b [ root@dev ~ ] # smartctl -t offline /dev/sdb \u2026\u2026 Default Self Test Successful \u6ce8\u610f \uff1a\u8fdb\u884c\u78c1\u76d8\u81ea\u6211\u68c0\u67e5\u65f6\uff0c\u78c1\u76d8\u7684 I/O \u72b6\u6001\u53ef\u80fd\u4f1a\u6bd4\u8f83\u9891\u7e41\u3002","title":"3. \u4e86\u89e3\u78c1\u76d8\u7684\u5065\u5eb7\u72b6\u6001"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/","text":"1. \u5907\u4efd\u8981\u70b9 \u00b6 1.1 \u5907\u4efd\u8d44\u6599\u7684\u8003\u8651 \u00b6 \u9020\u6210\u7cfb\u7edf\u635f\u6bc1\u7684\u95ee\u9898-\u786c\u4ef6\u95ee\u9898 \u9020\u6210\u7cfb\u7edf\u635f\u6bc1\u7684\u95ee\u9898-\u8f6f\u4ef6\u4e0e\u4eba\u7684\u95ee\u9898 \u4e3b\u673a\u89d2\u8272\u4e0d\u540c\uff0c\u5907\u4efd\u4efb\u52a1\u4e5f\u4e0d\u540c \u5907\u4efd\u56e0\u7d20\u8003\u8651 \u5907\u4efd\u54ea\u4e9b\u6587\u4ef6\uff1a\u5bf9\u7cfb\u7edf\u6216\u7528\u6237\u6765\u8bf4\u662f\u91cd\u8981\u7684\u6570\u636e \u5907\u4efd\u7684\u8f7d\u4f53 \u8003\u8651\u5907\u4efd\u7684\u65b9\u5f0f\uff1a\u5b8c\u6574\u5907\u4efd\u3001\u7d2f\u79ef\u5907\u4efd\u3001\u5dee\u5f02\u5907\u4efd \u5907\u4efd\u7684\u9891\u7387 \u5907\u4efd\u4f7f\u7528\u7684\u5de5\u5177\uff1atar \u3001 cpio \u3001 dd \u3001 dump \u7b49\u7b49 1.2 \u54ea\u4e9b Linux \u6570\u636e\u5177\u6709\u5907\u4efd\u7684\u610f\u4e49 \u00b6 \u5177\u6709\u5907\u4efd\u610f\u4e49\u7684\u6587\u4ef6\u901a\u5e38\u53ef\u4ee5\u7c97\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a \u7cfb\u7edf\u57fa\u672c\u8bbe\u7f6e\u4fe1\u606f\uff1b \u7c7b\u4f3c\u7f51\u7edc\u670d\u52a1\u7684\u5185\u5bb9\u6570\u636e\u3002 1.2.1 \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u9700\u8981\u5907\u4efd\u7684\u6587\u4ef6 \u00b6 \u8fd9\u65b9\u9762\u7684\u6587\u4ef6\u4e3b\u8981\u662f \u8d26\u53f7\u4e0e\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6 \uff1a /etc/ \u6574\u4e2a\u76ee\u5f55 /home/ \u6574\u4e2a\u76ee\u5f55 /var/spool/mail/ /var/spoll/{at|cron}/ /boot/ /root/ \u5982\u679c\u4f60\u81ea\u884c\u5b89\u88c5\u8fc7\u5176\u4ed6\u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48 /usr/local/ \u6216 /opt \u4e5f\u6700\u597d\u5907\u4efd\u4e00\u4e0b! 1.2.2 \u7f51\u7edc\u670d\u52a1\u7684\u6570\u636e\u5e93\u65b9\u9762 \u00b6 \u8f6f\u4ef6\u672c\u8eab\u7684\u914d\u7f6e\u6587\u4ef6\u6848\u3002\u4f8b\u5982\uff1a/etc/ \u6574\u4e2a\u76ee\u5f55\uff0c/usr/local/ \u6574\u4e2a\u76ee\u5f55\uff08\u82e5\u4f60\u7684\u5957\u4ef6\u5927\u591a\u6765\u81ea\u4e8e\u81ea\u884c\u7684\u5b89\u88c5\uff0c\u90a3\u4e48 /usr/local \u8fd9\u4e2a\u76ee\u5f55\u53ef\u5c31\u76f8\u5f53\u7684\u91cd\u8981\u4e86\uff09 \u8f6f\u4ef6\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\u3002\u4ee5 WWW \u53ca Mariadb \u4e3a\u4f8b\uff1a WWW \u6587\u4ef6\uff1a/var/www \u6574\u4e2a\u76ee\u5f55\u6216 /srv/www \u6574\u4e2a\u76ee\u5f55\uff0c\u53ca\u7cfb\u7edf\u7684\u7528\u6237\u5bb6\u76ee\u5f55 Mariadb \uff1a /var/lib/mysql \u6574\u4e2a\u76ee\u5f55 \u5176\u4ed6\u5728 Linux \u4e3b\u673a\u4e0a\u9762\u63d0\u4f9b\u7684\u670d\u52a1\u7684\u6570\u636e\u5e93\u6587\u4ef6\u3002 1.2.3 \u9e1f\u54e5\u63a8\u8350\u9700\u8981\u5907\u4efd\u7684\u76ee\u5f55 \u00b6 \u5982\u679c\u4e0d\u80fd\u5168\u90e8\u5907\u4efd\uff0c\u90a3\u4e48\u9e1f\u54e5\u5efa\u8bae\u81f3\u5c11\u9700\u8981\u5907\u4efd\u8fd9\u4e9b\u76ee\u5f55\uff1a /etc /home /root /var/spool/mail/\uff0c /var/spool/cron/\uff0c /var/spool/at/ /var/lib/ 1.2.4 \u4e0d\u9700\u8981\u5907\u4efd\u7684\u76ee\u5f55 \u00b6 /dev\uff1a\u8fd9\u4e2a\u968f\u4fbf\u4f60\u8981\u4e0d\u8981\u5907\u4efd /proc\uff0c /sys\uff0c /run\uff1a\u8fd9\u4e2a\u771f\u7684\u4e0d\u9700\u8981\u5907\u4efd\u5566! /mnt\uff0c /media\uff1a\u5982\u679c\u4f60\u6ca1\u6709\u5728\u8fd9\u4e2a\u76ee\u5f55\u5185\u653e\u7f6e\u4f60\u81ea\u5df1\u7cfb\u7edf\u7684\u4e1c\u897f\uff0c\u4e5f\u4e0d\u9700\u8981\u5907\u4efd /tmp\uff1a\u5e72\u561b\u5b58\u6682\u5b58\u6863!\u4e0d\u9700\u8981\u5907\u4efd! 1.3 \u5907\u4efd\u7528\u50a8\u5b58\u8f7d\u4f53\u7684\u9009\u62e9 \u00b6 1.3.1 \u5f02\u5730\u5907\u4efd\u7cfb\u7edf \u00b6 \u5c06\u7cfb\u7edf\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u5907\u4efd\u5230\u5176\u4ed6\u7684\u5730\u65b9\u53bb\uff0c\u7f3a\u70b9\u5c31\u662f \u5e26\u5bbd\u4e25\u91cd\u7684\u4e0d\u8db3 \u3002 1.3.2 \u50a8\u5b58\u8f7d\u4f53\u7684\u8003\u8651 \u00b6 \u7ecf\u8d39\u5145\u8db3\u7684\u60c5\u51b5 \u4e0b\uff0c\u9e1f\u54e5\u5efa\u8bae\u4f7f\u7528\u5916\u63a5\u5f0f\u7684 NAS \u8bbe\u5907\uff0cNAS \u50a8\u5b58\u8bbe\u5907\u5c31\u7b49\u4e8e\u662f\u4e00\u90e8\u5c0f\u578b Linux \u6216 unix-like server\uff0c \u91cc\u9762\u8fd8\u80fd\u591f\u63d0\u4f9b\u5ba2\u5236\u5316\u7684\u670d\u52a1\uff0c\u5305\u62ec\u4e0d\u540c\u7684\u8fde\u63a5\u754c\u9762\u4e0e\u4f20\u8f93\u534f\u8bae\uff0c\u63d0\u4f9b\u786c\u4ef6\u6216\u8f6f\u4ef6\u7684\u78c1\u76d8\u9635\u5217\uff0c\u8ba9\u4f60\u53ef\u4ee5\u67b6\u8bbe RAID10 \u6216 RAID5\uff0c6 \u7b49\u7684\u7b49\u7ea7\u3002\u56e0\u6b64\uff0c\u4f60\u53ea\u8981\u8bb0\u5f97\uff0c\u5c31\u662f\u4e70\u8fd8\u80fd\u591f\u81ea\u6211\u5bb9\u9519\u7684 NAS \u8bbe\u5907\u6765\u5907\u4efd\u5c31\u5bf9\u4e86\u3002 \u82e5\u7ecf\u8d39\u4e0d\u8db3\uff0c\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u4e92\u76f8\u8f6e\u6d41\u5907\u4efd\u3002 \u5982\u679c\u4f60\u60f3\u8981\u6709\u6bd4\u8f83\u957f\u65f6\u95f4\u7684\u5907\u4efd\u50a8\u5b58\uff0c\u540c\u65f6\u4e5f\u6bd4\u8f83\u62c5\u5fc3\u78b0\u649e\u7684\u95ee\u9898\uff0c\u76ee\u524d\u4f01\u4e1a\u754c\u8fd8\u662f\u5f88\u591a\u4eba\u4f1a\u559c\u6b22\u4f7f\u7528 Tape \u6765\u50a8\u5b58\u5c31\u662f\u4e86\u3002 2. \u5907\u4efd\u7684\u79cd\u7c7b\u3001\u9891\u7387\u4e0e\u5de5\u5177\u7684\u9009\u62e9 \u00b6 2.1 \u5b8c\u6574\u5907\u4efd\u4e4b\u7d2f\u79ef\u5907\u4efd (Incremental backup) \u00b6 \u5982\u679c\u4ec5\u5907\u4efd\u5173\u952e\u6570\u636e\u65f6\uff0c \u90a3\u4e48\u4f60\u5f97\u8981\u5728\u7cfb\u7edf\u51fa\u9519\u540e\uff0c\u518d\u53bb\u627e\u65b0\u7684 Linux distribution \u6765\u5b89\u88c5\uff0c\u5b89\u88c5\u5b8c\u6bd5\u540e\u8fd8\u5f97\u8981\u8003\u8651\u5230\u6570\u636e\u65b0\u65e7\u7248\u672c\u7684\u5dee\u5f02\u95ee\u9898\uff0c \u8fd8\u5f97\u8981\u8fdb\u884c\u6570\u636e\u7684\u79fb\u690d\u4e0e\u7cfb\u7edf\u670d\u52a1\u7684\u91cd\u65b0\u5efa\u7acb\u7b49\u7b49\uff0c\u7b49\u5230\u5efa\u7acb\u59a5\u5f53\u540e\uff0c\u8fd8\u5f97\u8981\u8fdb\u884c\u76f8\u5173\u6d4b\u8bd5\uff01\u6240\u4ee5\uff0c \u4ec5\u6709\u5173\u952e\u6570\u636e\u662f\u4e0d\u591f\u7684 \uff01 \u5b8c\u6574\u5907\u4efd\u5c31\u662f\u5c06\u6839\u76ee\u5f55 (/) \u6574\u4e2a\u7cfb\u7edf\u901a\u901a\u5907\u4efd\u4e0b\u6765\u7684\u610f\u601d\uff01\u4e0d\u8fc7\uff0c\u5728\u67d0\u4e9b\u573a\u5408\u5e95\u4e0b\uff0c\u5b8c\u6574\u5907\u4efd\u4e5f\u53ef\u4ee5\u662f\u5907\u4efd\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf (filesystem)\uff01\u4f8b\u5982 /dev/sda1 \u6216 /dev/md0 \u6216 /dev/myvg/mylv \u4e4b\u7c7b\u7684\u6587\u4ef6\u7cfb\u7edf\u5c31\u662f\u4e86\u3002 2.2 \u7d2f\u79ef\u5907\u4efd\u7684\u539f\u5219 \u00b6 \u7d2f\u79ef\u5907\u4efd\uff1a\u5728\u7cfb\u7edf\u5728\u8fdb\u884c\u5b8c\u7b2c\u4e00\u6b21\u5b8c\u6574\u5907\u4efd\u540e\uff0c\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u8fd0\u4f5c\uff0c \u6bd4\u8f83\u7cfb\u7edf\u4e0e\u5907\u4efd\u6587\u4ef6\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u4ec5\u5907\u4efd\u6709\u5dee\u5f02\u7684\u6587\u4ef6\u800c\u5df2\u3002\u800c\u7b2c\u4e8c\u6b21\u7d2f\u79ef\u5907\u4efd\u5219\u4e0e\u7b2c\u4e00\u6b21\u7d2f\u79ef\u5907\u4efd\u7684\u6570\u636e\u6bd4\u8f83\uff0c\u4e5f\u662f\u4ec5\u5907\u4efd\u6709\u5dee\u5f02\u7684\u6570\u636e\u800c\u5df2\u3002 \u8fd8\u539f\u65f6\u9700\u8981\u4f9d\u5e8f\u8fd8\u539f\u3002 2.2.1 \u7d2f\u79ef\u5907\u4efd\u4f7f\u7528\u7684\u5907\u4efd\u8f6f\u4ef6 \u00b6 \u5b8c\u6574\u5907\u4efd\u5e38\u7528\u7684\u5de5\u5177\u6709 tar\uff0c dd\uff0c cpio\uff0c xfsdump/xfsrestore \u7b49\u7b49\u3002 dd \u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u78c1\u76d8\u7684\u6247\u533a (sector) \u800c\u4e0d\u7406\u4f1a\u6587\u4ef6\u7cfb\u7edf\uff0c\u662f\u76f8\u5f53\u826f\u597d\u7684\u5907\u4efd\u5de5\u5177!\u4e0d\u8fc7\u7f3a\u70b9\u5c31\u662f\u6162\u5f88\u591a! cpio \u662f\u80fd\u591f\u5907\u4efd\u6240\u6709\u6863\u540d\uff0c\u4e0d\u8fc7\uff0c\u5f97\u8981\u914d\u5408 find \u6216\u5176\u4ed6\u627e\u6587\u4ef6\u540d\u7684\u6307\u4ee4\u624d\u80fd\u591f\u5904\u7406\u59a5\u5f53\u3002 \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u80fd\u591f\u8fdb\u884c\u5b8c\u6574\u5907\u4efd\uff0c \u4f46\u7d2f\u79ef\u5907\u4efd\u5c31\u5f97\u8981\u989d\u5916\u4f7f\u7528\u811a\u672c\u7a0b\u5e8f\u6765\u5904\u7406\u3002 \u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u7d2f\u79ef\u5907\u4efd\u7684\u5c31\u662f xfsdump \u6307\u4ee4\u3002 2.3 \u5b8c\u6574\u5907\u4efd\u4e4b\u5dee\u5f02\u5907\u4efd (Differential backup) \u00b6 \u5dee\u5f02\u5907\u4efd\uff1a\u6bcf\u6b21\u7684\u5907\u4efd\u90fd\u662f\u4e0e\u539f\u59cb\u7684\u5b8c\u6574\u5907\u4efd\u6bd4\u8f83\u7684\u7ed3\u679c\u3002 \u56e0\u4e3a\u90fd\u9700\u8981\u5b8c\u6574\u5907\u4efd\uff0c\u6240\u4ee5\u5dee\u5f02\u5907\u4efd\u5e38\u7528\u7684\u5de5\u5177\u4e0e\u7d2f\u79ef\u5907\u4efd\u5dee\u4e0d\u591a\u3002\u5982\u679c\u4f7f\u7528 xfsdump \u6765\u5907\u4efd\u7684\u8bdd\uff0c\u90a3\u4e48\u6bcf\u6b21\u5907\u4efd\u7684\u7b49\u7ea7 (level) \u5c31\u90fd\u4f1a\u662f level 1 \u3002 \u8fd8\u53ef\u4ee5\u900f\u8fc7 tar \u7684 -N \u9009\u9879\u6765\u5907\u4efd\uff1a # \u53ea\u6253\u5305\u6bd4 2019-12-10 \u8981\u65b0\u7684\u6587\u4ef6 [ root@dev ~ ] # tar -N '2019-12-10' -jcpv -f /tmp/etc_20191218.tar.bz2 /etc \u8fd8\u53ef\u4ee5\u900f\u8fc7 rsync \u6765\u5bf9\u4e24\u4e2a\u76ee\u5f55\u8fdb\u884c\u955c\u50cf\u5907\u4efd\u3002 2.4 \u5173\u952e\u6570\u636e\u5907\u4efd \u00b6 \u7531\u4e8e\u5b8c\u6574\u5907\u4efd\u53ef\u80fd\u662f\u5728\u7cfb\u7edf\u8fd0\u4f5c\u671f\u95f4\u8fdb\u884c\uff0c\u4e0d\u4f46\u4f1a\u82b1\u8d39\u975e\u5e38\u591a\u65f6\u95f4\uff0c\u800c\u4e14\u5982\u679c\u5907\u4efd\u5f53\u65f6\u7cfb\u7edf\u5df2\u7ecf\u88ab\u653b\u7834\uff0c \u90a3\u4f60\u5907\u4efd\u7684\u6570\u636e\u662f\u6709\u95ee\u9898\u7684\uff0c\u90a3\u8fd8\u539f\u56de\u53bb\u4e5f\u662f\u6709\u95ee\u9898\u7684\u7cfb\u7edf\u3002 \u82e5\u56e0\u4e3a\u8f6f\u4ef6\u95ee\u9898\u800c\u5bfc\u81f4\u7cfb\u7edf\u88ab\u653b\u7834\u6216\u635f\u6bc1\u65f6\uff0c\u76f4\u63a5\u83b7\u53d6\u6700\u65b0\u7684 Linux distribution \uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\uff0c \u7136\u540e\u518d\u5c06\u7cfb\u7edf\u6570\u636e (\u5982\u8d26\u53f7/\u5bc6\u7801\u4e0e\u5bb6\u76ee\u5f55\u7b49\u7b49) \u4e0e\u670d\u52a1\u6570\u636e (\u5982www/email/crontab/ftp \u7b49\u7b49) \u4e00\u4e2a\u4e00\u4e2a\u7684\u586b\u56de\u53bb\u3002 \u5907\u4efd\u5173\u952e\u6570\u636e\u6700\u9ebb\u70e6\u7684\u5730\u65b9\u5176\u5b9e\u5c31\u662f\u5728\u8fd8\u539f\u5566!\u4e0a\u8ff0\u7684\u8fd8\u539f\u65b9\u5f0f\u662f\u4f60\u5fc5\u987b\u8981\u5f88\u719f\u6089\u7cfb\u7edf\u8fd0\u4f5c\uff0c\u5426\u5219\u8fd8\u539f\u5f97\u8981\u82b1\u8d39\u5f88\u591a\u65f6\u95f4\u7684\u3002 3. \u9e1f\u54e5\u7684\u5907\u4efd\u7b56\u7565 \u00b6 \u4e3b\u673a\u786c\u4ef6\uff1a\u4f7f\u7528\u4e00\u4e2a\u72ec\u7acb\u7684 filesystem \u6765\u50a8\u5b58\u5907\u4efd\u6570\u636e\uff0c\u6b64 filesystem \u6302\u8f7d\u5230 /backup \u5f53\u4e2d; \u6bcf\u65e5\u8fdb\u884c\uff1a\u76ee\u524d\u4ec5\u5907\u4efd MySQL \u6570\u636e\u5e93; \u6bcf\u5468\u8fdb\u884c\uff1a\u5305\u62ec /home\uff0c /var\uff0c /etc\uff0c /boot\uff0c /usr/local \u7b49\u76ee\u5f55\u4e0e\u7279\u6b8a\u670d\u52a1\u7684\u76ee\u5f55; \u81ea\u52a8\u5904\u7406\uff1a\u8fd9\u65b9\u9762\u5229\u7528 /etc/crontab \u6765\u81ea\u52a8\u63d0\u4f9b\u5907\u4efd\u7684\u8fdb\u884c; \u5f02\u5730\u5907\u63f4\uff1a\u6bcf\u6708\u5b9a\u671f\u7684\u5c06\u6570\u636e\u5206\u522b \uff1a(a)\u523b\u5f55\u5230\u5149\u76d8\u4e0a\u9762 \uff1b(b)\u4f7f\u7528\u7f51\u7edc\u4f20\u8f93\u5230\u53e6\u4e00\u90e8\u673a\u5668\u4e0a\u9762\u3002 3.1 \u6bcf\u5468\u7cfb\u7edf\u5907\u4efd\u7684 script \u00b6 backupwk.sh #!/bin/bash # ==================================================================== # \u7528\u6237\u53c2\u6570\u8f93\u5165\u4f4d\u7f6e: # basedir=\u4f60\u7528\u6765\u50a8\u5b58\u6b64\u811a\u672c\u6240\u9884\u8ba1\u5907\u4efd\u7684\u6570\u636e\u4e4b\u76ee\u5f55(\u8bf7\u72ec\u7acb\u6587\u4ef6\u7cfb\u7edf) basedir = /backup/weekly # \u60a8\u53ea\u8981\u6539\u8fd9\u91cc\u5c31\u597d\u4e86! # ==================================================================== # \u5e95\u4e0b\u8bf7\u4e0d\u8981\u4fee\u6539\u4e86!\u7528\u9ed8\u8ba4\u503c\u5373\u53ef! PATH = /bin:/usr/bin:/sbin:/usr/sbin ; export PATH export LANG = C # \u8bbe\u5b9a\u8981\u5907\u4efd\u7684\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6,\u4ee5\u53ca\u5907\u4efd\u7684\u76ee\u5f55 named = $basedir /named postfixd = $basedir /postfix vsftpd = $basedir /vsftp sshd = $basedir /ssh sambad = $basedir /samba wwwd = $basedir /www others = $basedir /others userinfod = $basedir /userinfo # \u5224\u65ad\u76ee\u5f55\u662f\u5426\u5b58\u5728,\u82e5\u4e0d\u5b58\u5728\u5219\u4e88\u4ee5\u5efa\u7acb\u3002 for dirs in $named $postfixd $vsftpd $sshd $sambad $wwwd $others $userinfod do [ ! -d \" $dirs \" ] && mkdir -p $dirs done # 1. \u5c06\u7cfb\u7edf\u4e3b\u8981\u7684\u670d\u52a1\u4e4b\u914d\u7f6e\u6587\u4ef6\u5206\u522b\u5907\u4efd\u4e0b\u6765,\u540c\u65f6\u4e5f\u5907\u4efd /etc \u5168\u90e8\u3002 cp -a /var/named/chroot/ { etc,var } $named cp -a /etc/postfix /etc/dovecot.conf $postfixd cp -a /etc/vsftpd/* $vsftpd cp -a /etc/ssh/* $sshd cp -a /etc/samba/* $sambad cp -a /etc/ { my.cnf,php.ini,httpd } $wwwd cd /var/lib tar -jpc -f $wwwd /mysql.tar.bz2 mysql cd /var/www tar -jpc -f $wwwd /html.tar.bz2 html cgi-bin cd / tar -jpc -f $others /etc.tar.bz2 etc cd /usr/ tar -jpc -f $others /local.tar.bz2 local # 2. \u5173\u4e8e\u4f7f\u7528\u8005\u53c2\u6570\u65b9\u9762 cp -a /etc/ { passwd,shadow,group } $userinfod cd /var/spool tar -jpc -f $userinfod /mail.tar.bz2 mail cd / tar -jpc -f $userinfod /home.tar.bz2 home cd /var/spool tar -jpc -f $userinfod /cron.tar.bz2 cron at 3.2 \u6bcf\u65e5\u5907\u4efd\u8d44\u6599\u7684 script \u00b6 backupday.sh #!/bin/bash # ========================================================= # \u8bf7\u8f93\u5165,\u4f60\u60f3\u8ba9\u5907\u4efd\u6570\u636e\u653e\u7f6e\u5230\u90a3\u4e2a\u72ec\u7acb\u7684\u76ee\u5f55\u53bb basedir = /backup/daily/ # \u4f60\u53ea\u8981\u6539\u8fd9\u91cc\u5c31\u53ef\u4ee5\u4e86! # ========================================================= PATH = /bin:/usr/bin:/sbin:/usr/sbin ; export PATH export LANG = C basefile1 = $basedir /mysql. $( date +%Y-%m-%d ) .tar.bz2 basefile2 = $basedir /cgi-bin. $( date +%Y-%m-%d ) .tar.bz2 [ ! -d \" $basedir \" ] && mkdir $basedir # 1. MysQL (\u6570\u636e\u5e93\u76ee\u5f55\u5728 /var/lib/mysql) cd /var/lib tar -jpc -f $basefile1 mysql # 2. WWW \u7684 CGI \u7a0b\u5e8f (\u5982\u679c\u6709\u4f7f\u7528 CGI \u7a0b\u5e8f\u7684\u8bdd) cd /var/www tar -jpc -f $basefile2 cgi-bin \u6700\u597d\u5148\u628a\u670d\u52a1\u5173\u6389\u518d\u8fdb\u884c\u5907\u4efd\uff01\uff01\uff01 \u7136\u540e\u901a\u8fc7crontab\u6765\u6267\u884c\u5907\u4efd\u3002 3.3 \u8fdc\u7a0b\u5907\u4efd\u7684 script \u00b6 \u4f7f\u7528 rsync \u4e0a\u4f20\u5907\u4efd\u6570\u636e [ root@study ~ ] # vi /backup/rsync.sh #!/bin/bash remotedir = /home/backup/ basedir = /backup/weekly host = 127 .0.0.1 id = dmtsai # \u5e95\u4e0b\u4e3a\u7a0b\u5e8f\u9636\u6bb5!\u4e0d\u9700\u8981\u4fee\u6539\u5594! rsync -av -e ssh $basedir ${ id } @ ${ host } : ${ remotedir } 4. \u707e\u96be\u590d\u539f\u7684\u8003\u8651 \u00b6 4.1 \u786c\u4ef6\u635f\u6bc1\uff0c\u4e14\u5177\u6709\u5b8c\u6574\u5907\u4efd\u7684\u6570\u636e\u65f6 \u00b6 \u8981\u5148\u5904\u7406\u597d\u4f60\u7684\u786c\u4ef6\uff0c\u7136\u540e\u4f9d\u636e\u4f60\u7684\u5907\u4efd\u72b6\u6001\u6765\u590d\u539f\u3002 4.2 \u7531\u4e8e\u8f6f\u4ef6\u7684\u95ee\u9898\u4ea7\u751f\u7684\u88ab\u653b\u7834\u7684\u5b89\u5168\u4e8b\u4ef6 \u00b6 \u5148\u62d4\u9664\u7f51\u7edc\u7ebf\uff0c\u6700\u597d\u5c06\u7cfb\u7edf\u8fdb\u884c\u5b8c\u6574\u5907\u4efd\u5230\u5176\u4ed6\u5a92\u4f53\u4e0a\uff0c\u4ee5\u5907\u672a\u6765\u67e5\u9a8c \u5f00\u59cb\u67e5\u9605\u65e5\u5fd7\u6587\u4ef6 \u5f00\u59cb\u5b89\u88c5\u65b0\u7cfb\u7edf (\u6700\u597d\u627e\u6700\u65b0\u7684 distribution) \u8fdb\u884c\u7cfb\u7edf\u7684\u5347\u7ea7\uff0c\u4e0e\u9632\u706b\u5899\u76f8\u5173\u673a\u5236\u7684\u5236\u8ba2 \u6839\u636e 2 \u7684\u9519\u8bef\uff0c\u5728\u5b89\u88c5\u5b8c\u6210\u65b0\u7cfb\u7edf\u540e\uff0c\u5c06\u90a3\u4e9b bug \u4fee\u590d \u8fdb\u884c\u5404\u9879\u670d\u52a1\u4e0e\u76f8\u5173\u6570\u636e\u7684\u6062\u590d \u6b63\u5f0f\u4e0a\u7ebf\u63d0\u4f9b\u670d\u52a1\uff0c\u5e76\u4e14\u5f00\u59cb\u6d4b\u8bd5","title":"28 \u5907\u4efd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#1","text":"","title":"1. \u5907\u4efd\u8981\u70b9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#11","text":"\u9020\u6210\u7cfb\u7edf\u635f\u6bc1\u7684\u95ee\u9898-\u786c\u4ef6\u95ee\u9898 \u9020\u6210\u7cfb\u7edf\u635f\u6bc1\u7684\u95ee\u9898-\u8f6f\u4ef6\u4e0e\u4eba\u7684\u95ee\u9898 \u4e3b\u673a\u89d2\u8272\u4e0d\u540c\uff0c\u5907\u4efd\u4efb\u52a1\u4e5f\u4e0d\u540c \u5907\u4efd\u56e0\u7d20\u8003\u8651 \u5907\u4efd\u54ea\u4e9b\u6587\u4ef6\uff1a\u5bf9\u7cfb\u7edf\u6216\u7528\u6237\u6765\u8bf4\u662f\u91cd\u8981\u7684\u6570\u636e \u5907\u4efd\u7684\u8f7d\u4f53 \u8003\u8651\u5907\u4efd\u7684\u65b9\u5f0f\uff1a\u5b8c\u6574\u5907\u4efd\u3001\u7d2f\u79ef\u5907\u4efd\u3001\u5dee\u5f02\u5907\u4efd \u5907\u4efd\u7684\u9891\u7387 \u5907\u4efd\u4f7f\u7528\u7684\u5de5\u5177\uff1atar \u3001 cpio \u3001 dd \u3001 dump \u7b49\u7b49","title":"1.1 \u5907\u4efd\u8d44\u6599\u7684\u8003\u8651"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#12-linux","text":"\u5177\u6709\u5907\u4efd\u610f\u4e49\u7684\u6587\u4ef6\u901a\u5e38\u53ef\u4ee5\u7c97\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a \u7cfb\u7edf\u57fa\u672c\u8bbe\u7f6e\u4fe1\u606f\uff1b \u7c7b\u4f3c\u7f51\u7edc\u670d\u52a1\u7684\u5185\u5bb9\u6570\u636e\u3002","title":"1.2 \u54ea\u4e9b Linux \u6570\u636e\u5177\u6709\u5907\u4efd\u7684\u610f\u4e49"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#121","text":"\u8fd9\u65b9\u9762\u7684\u6587\u4ef6\u4e3b\u8981\u662f \u8d26\u53f7\u4e0e\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6 \uff1a /etc/ \u6574\u4e2a\u76ee\u5f55 /home/ \u6574\u4e2a\u76ee\u5f55 /var/spool/mail/ /var/spoll/{at|cron}/ /boot/ /root/ \u5982\u679c\u4f60\u81ea\u884c\u5b89\u88c5\u8fc7\u5176\u4ed6\u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48 /usr/local/ \u6216 /opt \u4e5f\u6700\u597d\u5907\u4efd\u4e00\u4e0b!","title":"1.2.1 \u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u9700\u8981\u5907\u4efd\u7684\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#122","text":"\u8f6f\u4ef6\u672c\u8eab\u7684\u914d\u7f6e\u6587\u4ef6\u6848\u3002\u4f8b\u5982\uff1a/etc/ \u6574\u4e2a\u76ee\u5f55\uff0c/usr/local/ \u6574\u4e2a\u76ee\u5f55\uff08\u82e5\u4f60\u7684\u5957\u4ef6\u5927\u591a\u6765\u81ea\u4e8e\u81ea\u884c\u7684\u5b89\u88c5\uff0c\u90a3\u4e48 /usr/local \u8fd9\u4e2a\u76ee\u5f55\u53ef\u5c31\u76f8\u5f53\u7684\u91cd\u8981\u4e86\uff09 \u8f6f\u4ef6\u670d\u52a1\u63d0\u4f9b\u7684\u6570\u636e\u3002\u4ee5 WWW \u53ca Mariadb \u4e3a\u4f8b\uff1a WWW \u6587\u4ef6\uff1a/var/www \u6574\u4e2a\u76ee\u5f55\u6216 /srv/www \u6574\u4e2a\u76ee\u5f55\uff0c\u53ca\u7cfb\u7edf\u7684\u7528\u6237\u5bb6\u76ee\u5f55 Mariadb \uff1a /var/lib/mysql \u6574\u4e2a\u76ee\u5f55 \u5176\u4ed6\u5728 Linux \u4e3b\u673a\u4e0a\u9762\u63d0\u4f9b\u7684\u670d\u52a1\u7684\u6570\u636e\u5e93\u6587\u4ef6\u3002","title":"1.2.2 \u7f51\u7edc\u670d\u52a1\u7684\u6570\u636e\u5e93\u65b9\u9762"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#123","text":"\u5982\u679c\u4e0d\u80fd\u5168\u90e8\u5907\u4efd\uff0c\u90a3\u4e48\u9e1f\u54e5\u5efa\u8bae\u81f3\u5c11\u9700\u8981\u5907\u4efd\u8fd9\u4e9b\u76ee\u5f55\uff1a /etc /home /root /var/spool/mail/\uff0c /var/spool/cron/\uff0c /var/spool/at/ /var/lib/","title":"1.2.3 \u9e1f\u54e5\u63a8\u8350\u9700\u8981\u5907\u4efd\u7684\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#124","text":"/dev\uff1a\u8fd9\u4e2a\u968f\u4fbf\u4f60\u8981\u4e0d\u8981\u5907\u4efd /proc\uff0c /sys\uff0c /run\uff1a\u8fd9\u4e2a\u771f\u7684\u4e0d\u9700\u8981\u5907\u4efd\u5566! /mnt\uff0c /media\uff1a\u5982\u679c\u4f60\u6ca1\u6709\u5728\u8fd9\u4e2a\u76ee\u5f55\u5185\u653e\u7f6e\u4f60\u81ea\u5df1\u7cfb\u7edf\u7684\u4e1c\u897f\uff0c\u4e5f\u4e0d\u9700\u8981\u5907\u4efd /tmp\uff1a\u5e72\u561b\u5b58\u6682\u5b58\u6863!\u4e0d\u9700\u8981\u5907\u4efd!","title":"1.2.4 \u4e0d\u9700\u8981\u5907\u4efd\u7684\u76ee\u5f55"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#13","text":"","title":"1.3 \u5907\u4efd\u7528\u50a8\u5b58\u8f7d\u4f53\u7684\u9009\u62e9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#131","text":"\u5c06\u7cfb\u7edf\u6570\u636e\u901a\u8fc7\u7f51\u7edc\u5907\u4efd\u5230\u5176\u4ed6\u7684\u5730\u65b9\u53bb\uff0c\u7f3a\u70b9\u5c31\u662f \u5e26\u5bbd\u4e25\u91cd\u7684\u4e0d\u8db3 \u3002","title":"1.3.1 \u5f02\u5730\u5907\u4efd\u7cfb\u7edf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#132","text":"\u7ecf\u8d39\u5145\u8db3\u7684\u60c5\u51b5 \u4e0b\uff0c\u9e1f\u54e5\u5efa\u8bae\u4f7f\u7528\u5916\u63a5\u5f0f\u7684 NAS \u8bbe\u5907\uff0cNAS \u50a8\u5b58\u8bbe\u5907\u5c31\u7b49\u4e8e\u662f\u4e00\u90e8\u5c0f\u578b Linux \u6216 unix-like server\uff0c \u91cc\u9762\u8fd8\u80fd\u591f\u63d0\u4f9b\u5ba2\u5236\u5316\u7684\u670d\u52a1\uff0c\u5305\u62ec\u4e0d\u540c\u7684\u8fde\u63a5\u754c\u9762\u4e0e\u4f20\u8f93\u534f\u8bae\uff0c\u63d0\u4f9b\u786c\u4ef6\u6216\u8f6f\u4ef6\u7684\u78c1\u76d8\u9635\u5217\uff0c\u8ba9\u4f60\u53ef\u4ee5\u67b6\u8bbe RAID10 \u6216 RAID5\uff0c6 \u7b49\u7684\u7b49\u7ea7\u3002\u56e0\u6b64\uff0c\u4f60\u53ea\u8981\u8bb0\u5f97\uff0c\u5c31\u662f\u4e70\u8fd8\u80fd\u591f\u81ea\u6211\u5bb9\u9519\u7684 NAS \u8bbe\u5907\u6765\u5907\u4efd\u5c31\u5bf9\u4e86\u3002 \u82e5\u7ecf\u8d39\u4e0d\u8db3\uff0c\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u4e92\u76f8\u8f6e\u6d41\u5907\u4efd\u3002 \u5982\u679c\u4f60\u60f3\u8981\u6709\u6bd4\u8f83\u957f\u65f6\u95f4\u7684\u5907\u4efd\u50a8\u5b58\uff0c\u540c\u65f6\u4e5f\u6bd4\u8f83\u62c5\u5fc3\u78b0\u649e\u7684\u95ee\u9898\uff0c\u76ee\u524d\u4f01\u4e1a\u754c\u8fd8\u662f\u5f88\u591a\u4eba\u4f1a\u559c\u6b22\u4f7f\u7528 Tape \u6765\u50a8\u5b58\u5c31\u662f\u4e86\u3002","title":"1.3.2 \u50a8\u5b58\u8f7d\u4f53\u7684\u8003\u8651"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#2","text":"","title":"2. \u5907\u4efd\u7684\u79cd\u7c7b\u3001\u9891\u7387\u4e0e\u5de5\u5177\u7684\u9009\u62e9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#21-incremental-backup","text":"\u5982\u679c\u4ec5\u5907\u4efd\u5173\u952e\u6570\u636e\u65f6\uff0c \u90a3\u4e48\u4f60\u5f97\u8981\u5728\u7cfb\u7edf\u51fa\u9519\u540e\uff0c\u518d\u53bb\u627e\u65b0\u7684 Linux distribution \u6765\u5b89\u88c5\uff0c\u5b89\u88c5\u5b8c\u6bd5\u540e\u8fd8\u5f97\u8981\u8003\u8651\u5230\u6570\u636e\u65b0\u65e7\u7248\u672c\u7684\u5dee\u5f02\u95ee\u9898\uff0c \u8fd8\u5f97\u8981\u8fdb\u884c\u6570\u636e\u7684\u79fb\u690d\u4e0e\u7cfb\u7edf\u670d\u52a1\u7684\u91cd\u65b0\u5efa\u7acb\u7b49\u7b49\uff0c\u7b49\u5230\u5efa\u7acb\u59a5\u5f53\u540e\uff0c\u8fd8\u5f97\u8981\u8fdb\u884c\u76f8\u5173\u6d4b\u8bd5\uff01\u6240\u4ee5\uff0c \u4ec5\u6709\u5173\u952e\u6570\u636e\u662f\u4e0d\u591f\u7684 \uff01 \u5b8c\u6574\u5907\u4efd\u5c31\u662f\u5c06\u6839\u76ee\u5f55 (/) \u6574\u4e2a\u7cfb\u7edf\u901a\u901a\u5907\u4efd\u4e0b\u6765\u7684\u610f\u601d\uff01\u4e0d\u8fc7\uff0c\u5728\u67d0\u4e9b\u573a\u5408\u5e95\u4e0b\uff0c\u5b8c\u6574\u5907\u4efd\u4e5f\u53ef\u4ee5\u662f\u5907\u4efd\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf (filesystem)\uff01\u4f8b\u5982 /dev/sda1 \u6216 /dev/md0 \u6216 /dev/myvg/mylv \u4e4b\u7c7b\u7684\u6587\u4ef6\u7cfb\u7edf\u5c31\u662f\u4e86\u3002","title":"2.1 \u5b8c\u6574\u5907\u4efd\u4e4b\u7d2f\u79ef\u5907\u4efd (Incremental backup)"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#22","text":"\u7d2f\u79ef\u5907\u4efd\uff1a\u5728\u7cfb\u7edf\u5728\u8fdb\u884c\u5b8c\u7b2c\u4e00\u6b21\u5b8c\u6574\u5907\u4efd\u540e\uff0c\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u8fd0\u4f5c\uff0c \u6bd4\u8f83\u7cfb\u7edf\u4e0e\u5907\u4efd\u6587\u4ef6\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u4ec5\u5907\u4efd\u6709\u5dee\u5f02\u7684\u6587\u4ef6\u800c\u5df2\u3002\u800c\u7b2c\u4e8c\u6b21\u7d2f\u79ef\u5907\u4efd\u5219\u4e0e\u7b2c\u4e00\u6b21\u7d2f\u79ef\u5907\u4efd\u7684\u6570\u636e\u6bd4\u8f83\uff0c\u4e5f\u662f\u4ec5\u5907\u4efd\u6709\u5dee\u5f02\u7684\u6570\u636e\u800c\u5df2\u3002 \u8fd8\u539f\u65f6\u9700\u8981\u4f9d\u5e8f\u8fd8\u539f\u3002","title":"2.2 \u7d2f\u79ef\u5907\u4efd\u7684\u539f\u5219"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#221","text":"\u5b8c\u6574\u5907\u4efd\u5e38\u7528\u7684\u5de5\u5177\u6709 tar\uff0c dd\uff0c cpio\uff0c xfsdump/xfsrestore \u7b49\u7b49\u3002 dd \u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u78c1\u76d8\u7684\u6247\u533a (sector) \u800c\u4e0d\u7406\u4f1a\u6587\u4ef6\u7cfb\u7edf\uff0c\u662f\u76f8\u5f53\u826f\u597d\u7684\u5907\u4efd\u5de5\u5177!\u4e0d\u8fc7\u7f3a\u70b9\u5c31\u662f\u6162\u5f88\u591a! cpio \u662f\u80fd\u591f\u5907\u4efd\u6240\u6709\u6863\u540d\uff0c\u4e0d\u8fc7\uff0c\u5f97\u8981\u914d\u5408 find \u6216\u5176\u4ed6\u627e\u6587\u4ef6\u540d\u7684\u6307\u4ee4\u624d\u80fd\u591f\u5904\u7406\u59a5\u5f53\u3002 \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u80fd\u591f\u8fdb\u884c\u5b8c\u6574\u5907\u4efd\uff0c \u4f46\u7d2f\u79ef\u5907\u4efd\u5c31\u5f97\u8981\u989d\u5916\u4f7f\u7528\u811a\u672c\u7a0b\u5e8f\u6765\u5904\u7406\u3002 \u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u7d2f\u79ef\u5907\u4efd\u7684\u5c31\u662f xfsdump \u6307\u4ee4\u3002","title":"2.2.1 \u7d2f\u79ef\u5907\u4efd\u4f7f\u7528\u7684\u5907\u4efd\u8f6f\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#23-differential-backup","text":"\u5dee\u5f02\u5907\u4efd\uff1a\u6bcf\u6b21\u7684\u5907\u4efd\u90fd\u662f\u4e0e\u539f\u59cb\u7684\u5b8c\u6574\u5907\u4efd\u6bd4\u8f83\u7684\u7ed3\u679c\u3002 \u56e0\u4e3a\u90fd\u9700\u8981\u5b8c\u6574\u5907\u4efd\uff0c\u6240\u4ee5\u5dee\u5f02\u5907\u4efd\u5e38\u7528\u7684\u5de5\u5177\u4e0e\u7d2f\u79ef\u5907\u4efd\u5dee\u4e0d\u591a\u3002\u5982\u679c\u4f7f\u7528 xfsdump \u6765\u5907\u4efd\u7684\u8bdd\uff0c\u90a3\u4e48\u6bcf\u6b21\u5907\u4efd\u7684\u7b49\u7ea7 (level) \u5c31\u90fd\u4f1a\u662f level 1 \u3002 \u8fd8\u53ef\u4ee5\u900f\u8fc7 tar \u7684 -N \u9009\u9879\u6765\u5907\u4efd\uff1a # \u53ea\u6253\u5305\u6bd4 2019-12-10 \u8981\u65b0\u7684\u6587\u4ef6 [ root@dev ~ ] # tar -N '2019-12-10' -jcpv -f /tmp/etc_20191218.tar.bz2 /etc \u8fd8\u53ef\u4ee5\u900f\u8fc7 rsync \u6765\u5bf9\u4e24\u4e2a\u76ee\u5f55\u8fdb\u884c\u955c\u50cf\u5907\u4efd\u3002","title":"2.3 \u5b8c\u6574\u5907\u4efd\u4e4b\u5dee\u5f02\u5907\u4efd (Differential backup)"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#24","text":"\u7531\u4e8e\u5b8c\u6574\u5907\u4efd\u53ef\u80fd\u662f\u5728\u7cfb\u7edf\u8fd0\u4f5c\u671f\u95f4\u8fdb\u884c\uff0c\u4e0d\u4f46\u4f1a\u82b1\u8d39\u975e\u5e38\u591a\u65f6\u95f4\uff0c\u800c\u4e14\u5982\u679c\u5907\u4efd\u5f53\u65f6\u7cfb\u7edf\u5df2\u7ecf\u88ab\u653b\u7834\uff0c \u90a3\u4f60\u5907\u4efd\u7684\u6570\u636e\u662f\u6709\u95ee\u9898\u7684\uff0c\u90a3\u8fd8\u539f\u56de\u53bb\u4e5f\u662f\u6709\u95ee\u9898\u7684\u7cfb\u7edf\u3002 \u82e5\u56e0\u4e3a\u8f6f\u4ef6\u95ee\u9898\u800c\u5bfc\u81f4\u7cfb\u7edf\u88ab\u653b\u7834\u6216\u635f\u6bc1\u65f6\uff0c\u76f4\u63a5\u83b7\u53d6\u6700\u65b0\u7684 Linux distribution \uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\uff0c \u7136\u540e\u518d\u5c06\u7cfb\u7edf\u6570\u636e (\u5982\u8d26\u53f7/\u5bc6\u7801\u4e0e\u5bb6\u76ee\u5f55\u7b49\u7b49) \u4e0e\u670d\u52a1\u6570\u636e (\u5982www/email/crontab/ftp \u7b49\u7b49) \u4e00\u4e2a\u4e00\u4e2a\u7684\u586b\u56de\u53bb\u3002 \u5907\u4efd\u5173\u952e\u6570\u636e\u6700\u9ebb\u70e6\u7684\u5730\u65b9\u5176\u5b9e\u5c31\u662f\u5728\u8fd8\u539f\u5566!\u4e0a\u8ff0\u7684\u8fd8\u539f\u65b9\u5f0f\u662f\u4f60\u5fc5\u987b\u8981\u5f88\u719f\u6089\u7cfb\u7edf\u8fd0\u4f5c\uff0c\u5426\u5219\u8fd8\u539f\u5f97\u8981\u82b1\u8d39\u5f88\u591a\u65f6\u95f4\u7684\u3002","title":"2.4 \u5173\u952e\u6570\u636e\u5907\u4efd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#3","text":"\u4e3b\u673a\u786c\u4ef6\uff1a\u4f7f\u7528\u4e00\u4e2a\u72ec\u7acb\u7684 filesystem \u6765\u50a8\u5b58\u5907\u4efd\u6570\u636e\uff0c\u6b64 filesystem \u6302\u8f7d\u5230 /backup \u5f53\u4e2d; \u6bcf\u65e5\u8fdb\u884c\uff1a\u76ee\u524d\u4ec5\u5907\u4efd MySQL \u6570\u636e\u5e93; \u6bcf\u5468\u8fdb\u884c\uff1a\u5305\u62ec /home\uff0c /var\uff0c /etc\uff0c /boot\uff0c /usr/local \u7b49\u76ee\u5f55\u4e0e\u7279\u6b8a\u670d\u52a1\u7684\u76ee\u5f55; \u81ea\u52a8\u5904\u7406\uff1a\u8fd9\u65b9\u9762\u5229\u7528 /etc/crontab \u6765\u81ea\u52a8\u63d0\u4f9b\u5907\u4efd\u7684\u8fdb\u884c; \u5f02\u5730\u5907\u63f4\uff1a\u6bcf\u6708\u5b9a\u671f\u7684\u5c06\u6570\u636e\u5206\u522b \uff1a(a)\u523b\u5f55\u5230\u5149\u76d8\u4e0a\u9762 \uff1b(b)\u4f7f\u7528\u7f51\u7edc\u4f20\u8f93\u5230\u53e6\u4e00\u90e8\u673a\u5668\u4e0a\u9762\u3002","title":"3. \u9e1f\u54e5\u7684\u5907\u4efd\u7b56\u7565"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#31-script","text":"backupwk.sh #!/bin/bash # ==================================================================== # \u7528\u6237\u53c2\u6570\u8f93\u5165\u4f4d\u7f6e: # basedir=\u4f60\u7528\u6765\u50a8\u5b58\u6b64\u811a\u672c\u6240\u9884\u8ba1\u5907\u4efd\u7684\u6570\u636e\u4e4b\u76ee\u5f55(\u8bf7\u72ec\u7acb\u6587\u4ef6\u7cfb\u7edf) basedir = /backup/weekly # \u60a8\u53ea\u8981\u6539\u8fd9\u91cc\u5c31\u597d\u4e86! # ==================================================================== # \u5e95\u4e0b\u8bf7\u4e0d\u8981\u4fee\u6539\u4e86!\u7528\u9ed8\u8ba4\u503c\u5373\u53ef! PATH = /bin:/usr/bin:/sbin:/usr/sbin ; export PATH export LANG = C # \u8bbe\u5b9a\u8981\u5907\u4efd\u7684\u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6,\u4ee5\u53ca\u5907\u4efd\u7684\u76ee\u5f55 named = $basedir /named postfixd = $basedir /postfix vsftpd = $basedir /vsftp sshd = $basedir /ssh sambad = $basedir /samba wwwd = $basedir /www others = $basedir /others userinfod = $basedir /userinfo # \u5224\u65ad\u76ee\u5f55\u662f\u5426\u5b58\u5728,\u82e5\u4e0d\u5b58\u5728\u5219\u4e88\u4ee5\u5efa\u7acb\u3002 for dirs in $named $postfixd $vsftpd $sshd $sambad $wwwd $others $userinfod do [ ! -d \" $dirs \" ] && mkdir -p $dirs done # 1. \u5c06\u7cfb\u7edf\u4e3b\u8981\u7684\u670d\u52a1\u4e4b\u914d\u7f6e\u6587\u4ef6\u5206\u522b\u5907\u4efd\u4e0b\u6765,\u540c\u65f6\u4e5f\u5907\u4efd /etc \u5168\u90e8\u3002 cp -a /var/named/chroot/ { etc,var } $named cp -a /etc/postfix /etc/dovecot.conf $postfixd cp -a /etc/vsftpd/* $vsftpd cp -a /etc/ssh/* $sshd cp -a /etc/samba/* $sambad cp -a /etc/ { my.cnf,php.ini,httpd } $wwwd cd /var/lib tar -jpc -f $wwwd /mysql.tar.bz2 mysql cd /var/www tar -jpc -f $wwwd /html.tar.bz2 html cgi-bin cd / tar -jpc -f $others /etc.tar.bz2 etc cd /usr/ tar -jpc -f $others /local.tar.bz2 local # 2. \u5173\u4e8e\u4f7f\u7528\u8005\u53c2\u6570\u65b9\u9762 cp -a /etc/ { passwd,shadow,group } $userinfod cd /var/spool tar -jpc -f $userinfod /mail.tar.bz2 mail cd / tar -jpc -f $userinfod /home.tar.bz2 home cd /var/spool tar -jpc -f $userinfod /cron.tar.bz2 cron at","title":"3.1 \u6bcf\u5468\u7cfb\u7edf\u5907\u4efd\u7684 script"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#32-script","text":"backupday.sh #!/bin/bash # ========================================================= # \u8bf7\u8f93\u5165,\u4f60\u60f3\u8ba9\u5907\u4efd\u6570\u636e\u653e\u7f6e\u5230\u90a3\u4e2a\u72ec\u7acb\u7684\u76ee\u5f55\u53bb basedir = /backup/daily/ # \u4f60\u53ea\u8981\u6539\u8fd9\u91cc\u5c31\u53ef\u4ee5\u4e86! # ========================================================= PATH = /bin:/usr/bin:/sbin:/usr/sbin ; export PATH export LANG = C basefile1 = $basedir /mysql. $( date +%Y-%m-%d ) .tar.bz2 basefile2 = $basedir /cgi-bin. $( date +%Y-%m-%d ) .tar.bz2 [ ! -d \" $basedir \" ] && mkdir $basedir # 1. MysQL (\u6570\u636e\u5e93\u76ee\u5f55\u5728 /var/lib/mysql) cd /var/lib tar -jpc -f $basefile1 mysql # 2. WWW \u7684 CGI \u7a0b\u5e8f (\u5982\u679c\u6709\u4f7f\u7528 CGI \u7a0b\u5e8f\u7684\u8bdd) cd /var/www tar -jpc -f $basefile2 cgi-bin \u6700\u597d\u5148\u628a\u670d\u52a1\u5173\u6389\u518d\u8fdb\u884c\u5907\u4efd\uff01\uff01\uff01 \u7136\u540e\u901a\u8fc7crontab\u6765\u6267\u884c\u5907\u4efd\u3002","title":"3.2 \u6bcf\u65e5\u5907\u4efd\u8d44\u6599\u7684 script"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#33-script","text":"\u4f7f\u7528 rsync \u4e0a\u4f20\u5907\u4efd\u6570\u636e [ root@study ~ ] # vi /backup/rsync.sh #!/bin/bash remotedir = /home/backup/ basedir = /backup/weekly host = 127 .0.0.1 id = dmtsai # \u5e95\u4e0b\u4e3a\u7a0b\u5e8f\u9636\u6bb5!\u4e0d\u9700\u8981\u4fee\u6539\u5594! rsync -av -e ssh $basedir ${ id } @ ${ host } : ${ remotedir }","title":"3.3 \u8fdc\u7a0b\u5907\u4efd\u7684 script"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#4","text":"","title":"4. \u707e\u96be\u590d\u539f\u7684\u8003\u8651"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#41","text":"\u8981\u5148\u5904\u7406\u597d\u4f60\u7684\u786c\u4ef6\uff0c\u7136\u540e\u4f9d\u636e\u4f60\u7684\u5907\u4efd\u72b6\u6001\u6765\u590d\u539f\u3002","title":"4.1 \u786c\u4ef6\u635f\u6bc1\uff0c\u4e14\u5177\u6709\u5b8c\u6574\u5907\u4efd\u7684\u6570\u636e\u65f6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/28 \u5907\u4efd/#42","text":"\u5148\u62d4\u9664\u7f51\u7edc\u7ebf\uff0c\u6700\u597d\u5c06\u7cfb\u7edf\u8fdb\u884c\u5b8c\u6574\u5907\u4efd\u5230\u5176\u4ed6\u5a92\u4f53\u4e0a\uff0c\u4ee5\u5907\u672a\u6765\u67e5\u9a8c \u5f00\u59cb\u67e5\u9605\u65e5\u5fd7\u6587\u4ef6 \u5f00\u59cb\u5b89\u88c5\u65b0\u7cfb\u7edf (\u6700\u597d\u627e\u6700\u65b0\u7684 distribution) \u8fdb\u884c\u7cfb\u7edf\u7684\u5347\u7ea7\uff0c\u4e0e\u9632\u706b\u5899\u76f8\u5173\u673a\u5236\u7684\u5236\u8ba2 \u6839\u636e 2 \u7684\u9519\u8bef\uff0c\u5728\u5b89\u88c5\u5b8c\u6210\u65b0\u7cfb\u7edf\u540e\uff0c\u5c06\u90a3\u4e9b bug \u4fee\u590d \u8fdb\u884c\u5404\u9879\u670d\u52a1\u4e0e\u76f8\u5173\u6570\u636e\u7684\u6062\u590d \u6b63\u5f0f\u4e0a\u7ebf\u63d0\u4f9b\u670d\u52a1\uff0c\u5e76\u4e14\u5f00\u59cb\u6d4b\u8bd5","title":"4.2 \u7531\u4e8e\u8f6f\u4ef6\u7684\u95ee\u9898\u4ea7\u751f\u7684\u88ab\u653b\u7834\u7684\u5b89\u5168\u4e8b\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/","text":"1. Tarball \u5b89\u88c5\u7684\u57fa\u672c\u6b65\u9aa4 \u00b6 \u53d6\u5f97\u539f\u59cb\u6863\uff1a\u5c06 tarball \u6587\u4ef6\u5728 /usr/local/src \u76ee\u5f55\u4e0b\u89e3\u538b\u7f29\uff1b \u53d6\u5f97\u6b65\u9aa4\u6d41\u7a0b\uff1a\u8fdb\u5165\u65b0\u5efa\u7acb\u7684\u76ee\u5f55\u5e95\u4e0b\uff0c\u53bb\u67e5\u9605 INSTALL \u4e0e README \u7b49\u76f8\u5173\u6587\u4ef6\u5185\u5bb9 (\u5f88\u91cd\u8981\u7684\u6b65\u9aa4\uff01 )\uff1b \u4f9d\u8d56\u8f6f\u4ef6\u5b89\u88c5\uff1a\u6839\u636e INSTALL/README \u7684\u5185\u5bb9\u5bdf\u770b\u5e76\u5b89\u88c5\u597d\u4e00\u4e9b\u4f9d\u8d56\u7684\u8f6f\u4ef6 (\u975e\u5fc5\u8981)\uff1b \u5efa\u7acb makefile\uff1a\u4ee5\u81ea\u52a8\u68c0\u6d4b\u7a0b\u5e8f (configure \u6216 config) \u68c0\u6d4b\u4f5c\u4e1a\u73af\u5883\uff0c\u5e76\u5efa\u7acb Makefile \u6587\u4ef6\uff1b \u7f16\u8bd1\uff1a\u4ee5 make \u8fd9\u4e2a\u7a0b\u5e8f\u5e76\u4f7f\u7528\u8be5\u76ee\u5f55\u4e0b\u7684 Makefile \u505a\u4e3a\u4ed6\u7684\u53c2\u6570\u914d\u7f6e\u6587\u4ef6\uff0c\u6765\u8fdb\u884c make (\u7f16\u8bd1\u6216\u5176\u4ed6)\u7684\u52a8\u4f5c\uff1b \u5b89\u88c5\uff1a\u4ee5 make \u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u5e76\u4ee5 Makefile \u8fd9\u4e2a\u53c2\u6570\u914d\u7f6e\u6587\u4ef6\uff0c\u4f9d\u636e install \u8fd9\u4e2a\u76ee\u6807 (target) \u7684\u6307\u5b9a\u6765\u5b89\u88c5\u5230\u6b63\u786e\u7684\u8def\u5f84\uff01 2. \u4e00\u822c Tarball \u8f6f\u4ef6\u5b89\u88c5\u7684\u5efa\u8bae\uff08\u79fb\u9664\uff0c\u5347\u7ea7\uff09 \u00b6 \u4e3a\u4e86\u65b9\u4fbf Tarball \u7684\u7ba1\u7406\uff0c\u901a\u5e38\u9e1f\u54e5\u4f1a\u8fd9\u6837\u5efa\u8bae\u4f7f\u7528\u8005\uff1a 1. \u6700\u597d\u5c06 tarball \u7684\u539f\u59cb\u6570\u636e\u89e3\u538b\u7f29\u5230 /usr/local/src \u5f53\u4e2d\uff1b \u5b89\u88c5\u65f6\uff0c\u6700\u597d\u5b89\u88c5\u5230 /usr/local \u8fd9\u4e2a\u9ed8\u8ba4\u8def\u5f84\u4e0b\uff1b \u8003\u8651\u672a\u6765\u7684\u5378\u8f7d\u6b65\u9aa4\uff0c\u6700\u597d\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u8f6f\u4ef6\u5355\u72ec\u7684\u5b89\u88c5\u5728 /usr/local/<software> \u5e95\u4e0b\u3002\u4f8b\u5982 /usr/local/wine/ \uff0c\u901a\u8fc7\u5b9a\u4e49\u5b89\u88c5\u8def\u5f84\u6765\u5b9e\u73b0\uff1a ./configure --prefix=/usr/local/ntp \uff1b \u4e3a\u5b89\u88c5\u5230\u5355\u72ec\u76ee\u5f55\u7684\u8f6f\u4ef6\u4e4b man page \u52a0\u5165 man path \u641c\u5bfb\uff1a \u5982\u679c\u4f60\u5b89\u88c5\u7684\u8f6f\u4ef6\u653e\u7f6e\u5230 /usr/local/<software>/ \uff0c\u90a3\u4e48 man page \u641c\u5bfb\u7684\u8bbe\u5b9a\u4e2d\uff0c\u53ef\u80fd\u5c31\u5f97\u8981\u5728 /etc/man_db.conf \u5185\u7684 40~50 \u884c\u5de6\u53f3\u5904\uff0c\u5199\u5165\u5982\u4e0b\u7684\u4e00\u884c\uff1a MANPATH_MAP /usr/local/software/bin /usr/local/software/man \u8fd9\u6837\u624d\u53ef\u4ee5\u4f7f\u7528 man \u6765\u67e5\u8be2\u8be5\u8f6f\u4ef6\u7684\u5728\u7ebf\u6587\u4ef6\uff01 2.1 \u79fb\u9664 \u00b6 \u5982\u679c\u5355\u72ec\u5b89\u88c5\u5728 /usr/local/<software> \uff0c \u4e00\u822c\u60c5\u51b5\u4e0b \u53ea\u8981\u5c06\u8be5\u8f6f\u4ef6\u5b89\u88c5\u76ee\u5f55\u79fb\u9664\u5373\u53ef\u89c6\u4e3a\u8be5\u8f6f\u4ef6\u5df2\u7ecf\u88ab\u79fb\u9664\u3002 make uninstall \u3002 2.2 \u5347\u7ea7 \u00b6 WWW \u670d\u52a1\u5668\u4e3a\u4e86\u8003\u8651\u4e92\u52a8\u6027\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u5c06 PHP+MySQL+Apache \u4e00\u8d77\u5b89\u88c5\u8d77\u6765\u3002\u56e0\u4e3a\u4ed6\u4eec\u4e09\u8005\u4e4b\u95f4\u5177\u6709\u76f8\u5173\u6027\uff0c\u6240\u4ee5\u5b89\u88c5\u65f6\u5fc5\u9700\u8981\u4e09\u8005\u540c\u65f6\u8003\u8651\u5230\u4ed6\u4eec\u7684\u5e93\u6587\u4ef6\u4e0e\u76f8\u5173\u7684\u7f16\u8bd1\u53c2\u6570\u3002 \u5982\u679c\u4eca\u5929 PHP \u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u7684\u6a21\u5757\u6bd4\u8f83\u591a\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u8fde\u5e26\u7684\uff0c\u8fde Apache \u8fd9\u4e2a\u7a0b\u5e8f\u4e5f\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u8fc7\u624d\u884c\u3002\u8fd9\u662f\u6ca1\u529e\u6cd5\u7684\u4e8b\u5566\u3002 3. \u5229\u7528 patch \u66f4\u65b0\u539f\u7801 \u00b6 \u5173\u4e8e diff \u4e0e patch \u547d\u4ee4\u53c2\u8003 \u6587\u4ef6\u5bf9\u6bd4 \u3002 [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <stdio.h> -------- # include <string.h> # \u5236\u4f5c patch file [ root@dev tar-test ] # diff -aur version-1/ version-2/ > 1_to_2.patch [ root@dev tar-test ] # cat 1_to_2.patch diff -aur version-1/main.c version-2/main.c --- version-1/main.c 2019 -12-24 14 :03:56.058127380 +0800 +++ version-2/main.c 2019 -12-23 17 :03:22.759351459 +0800 @@ -1 +1 @@ -# include <stdio.h> +# include <string.h> # \u5e94\u7528 patch file [ root@dev tar-test ] # patch -p0 < 1_to_2.patch # \u6216\u8005 cd version-1/ ; patch -p1 < ../1_to_2.patch\uff0c\u6ce8\u610f -p \u662f\u6839\u636e\u6240\u5728\u76ee\u5f55\u51b3\u5b9a\u7684 patching file version-1/main.c [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <string.h> -------- # include <string.h> # \u8fd8\u539f\u65e7\u7248\u672c\u6587\u4ef6 [ root@dev tar-test ] # patch -R -p0 < 1_to_2.patch patching file version-1/main.c [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <stdio.h> -------- # include <string.h>","title":"29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/#1-tarball","text":"\u53d6\u5f97\u539f\u59cb\u6863\uff1a\u5c06 tarball \u6587\u4ef6\u5728 /usr/local/src \u76ee\u5f55\u4e0b\u89e3\u538b\u7f29\uff1b \u53d6\u5f97\u6b65\u9aa4\u6d41\u7a0b\uff1a\u8fdb\u5165\u65b0\u5efa\u7acb\u7684\u76ee\u5f55\u5e95\u4e0b\uff0c\u53bb\u67e5\u9605 INSTALL \u4e0e README \u7b49\u76f8\u5173\u6587\u4ef6\u5185\u5bb9 (\u5f88\u91cd\u8981\u7684\u6b65\u9aa4\uff01 )\uff1b \u4f9d\u8d56\u8f6f\u4ef6\u5b89\u88c5\uff1a\u6839\u636e INSTALL/README \u7684\u5185\u5bb9\u5bdf\u770b\u5e76\u5b89\u88c5\u597d\u4e00\u4e9b\u4f9d\u8d56\u7684\u8f6f\u4ef6 (\u975e\u5fc5\u8981)\uff1b \u5efa\u7acb makefile\uff1a\u4ee5\u81ea\u52a8\u68c0\u6d4b\u7a0b\u5e8f (configure \u6216 config) \u68c0\u6d4b\u4f5c\u4e1a\u73af\u5883\uff0c\u5e76\u5efa\u7acb Makefile \u6587\u4ef6\uff1b \u7f16\u8bd1\uff1a\u4ee5 make \u8fd9\u4e2a\u7a0b\u5e8f\u5e76\u4f7f\u7528\u8be5\u76ee\u5f55\u4e0b\u7684 Makefile \u505a\u4e3a\u4ed6\u7684\u53c2\u6570\u914d\u7f6e\u6587\u4ef6\uff0c\u6765\u8fdb\u884c make (\u7f16\u8bd1\u6216\u5176\u4ed6)\u7684\u52a8\u4f5c\uff1b \u5b89\u88c5\uff1a\u4ee5 make \u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u5e76\u4ee5 Makefile \u8fd9\u4e2a\u53c2\u6570\u914d\u7f6e\u6587\u4ef6\uff0c\u4f9d\u636e install \u8fd9\u4e2a\u76ee\u6807 (target) \u7684\u6307\u5b9a\u6765\u5b89\u88c5\u5230\u6b63\u786e\u7684\u8def\u5f84\uff01","title":"1. Tarball \u5b89\u88c5\u7684\u57fa\u672c\u6b65\u9aa4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/#2-tarball","text":"\u4e3a\u4e86\u65b9\u4fbf Tarball \u7684\u7ba1\u7406\uff0c\u901a\u5e38\u9e1f\u54e5\u4f1a\u8fd9\u6837\u5efa\u8bae\u4f7f\u7528\u8005\uff1a 1. \u6700\u597d\u5c06 tarball \u7684\u539f\u59cb\u6570\u636e\u89e3\u538b\u7f29\u5230 /usr/local/src \u5f53\u4e2d\uff1b \u5b89\u88c5\u65f6\uff0c\u6700\u597d\u5b89\u88c5\u5230 /usr/local \u8fd9\u4e2a\u9ed8\u8ba4\u8def\u5f84\u4e0b\uff1b \u8003\u8651\u672a\u6765\u7684\u5378\u8f7d\u6b65\u9aa4\uff0c\u6700\u597d\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u8f6f\u4ef6\u5355\u72ec\u7684\u5b89\u88c5\u5728 /usr/local/<software> \u5e95\u4e0b\u3002\u4f8b\u5982 /usr/local/wine/ \uff0c\u901a\u8fc7\u5b9a\u4e49\u5b89\u88c5\u8def\u5f84\u6765\u5b9e\u73b0\uff1a ./configure --prefix=/usr/local/ntp \uff1b \u4e3a\u5b89\u88c5\u5230\u5355\u72ec\u76ee\u5f55\u7684\u8f6f\u4ef6\u4e4b man page \u52a0\u5165 man path \u641c\u5bfb\uff1a \u5982\u679c\u4f60\u5b89\u88c5\u7684\u8f6f\u4ef6\u653e\u7f6e\u5230 /usr/local/<software>/ \uff0c\u90a3\u4e48 man page \u641c\u5bfb\u7684\u8bbe\u5b9a\u4e2d\uff0c\u53ef\u80fd\u5c31\u5f97\u8981\u5728 /etc/man_db.conf \u5185\u7684 40~50 \u884c\u5de6\u53f3\u5904\uff0c\u5199\u5165\u5982\u4e0b\u7684\u4e00\u884c\uff1a MANPATH_MAP /usr/local/software/bin /usr/local/software/man \u8fd9\u6837\u624d\u53ef\u4ee5\u4f7f\u7528 man \u6765\u67e5\u8be2\u8be5\u8f6f\u4ef6\u7684\u5728\u7ebf\u6587\u4ef6\uff01","title":"2. \u4e00\u822c Tarball \u8f6f\u4ef6\u5b89\u88c5\u7684\u5efa\u8bae\uff08\u79fb\u9664\uff0c\u5347\u7ea7\uff09"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/#21","text":"\u5982\u679c\u5355\u72ec\u5b89\u88c5\u5728 /usr/local/<software> \uff0c \u4e00\u822c\u60c5\u51b5\u4e0b \u53ea\u8981\u5c06\u8be5\u8f6f\u4ef6\u5b89\u88c5\u76ee\u5f55\u79fb\u9664\u5373\u53ef\u89c6\u4e3a\u8be5\u8f6f\u4ef6\u5df2\u7ecf\u88ab\u79fb\u9664\u3002 make uninstall \u3002","title":"2.1 \u79fb\u9664"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/#22","text":"WWW \u670d\u52a1\u5668\u4e3a\u4e86\u8003\u8651\u4e92\u52a8\u6027\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u5c06 PHP+MySQL+Apache \u4e00\u8d77\u5b89\u88c5\u8d77\u6765\u3002\u56e0\u4e3a\u4ed6\u4eec\u4e09\u8005\u4e4b\u95f4\u5177\u6709\u76f8\u5173\u6027\uff0c\u6240\u4ee5\u5b89\u88c5\u65f6\u5fc5\u9700\u8981\u4e09\u8005\u540c\u65f6\u8003\u8651\u5230\u4ed6\u4eec\u7684\u5e93\u6587\u4ef6\u4e0e\u76f8\u5173\u7684\u7f16\u8bd1\u53c2\u6570\u3002 \u5982\u679c\u4eca\u5929 PHP \u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u7684\u6a21\u5757\u6bd4\u8f83\u591a\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u8fde\u5e26\u7684\uff0c\u8fde Apache \u8fd9\u4e2a\u7a0b\u5e8f\u4e5f\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u8fc7\u624d\u884c\u3002\u8fd9\u662f\u6ca1\u529e\u6cd5\u7684\u4e8b\u5566\u3002","title":"2.2 \u5347\u7ea7"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/29 Tarball \u7684\u7ba1\u7406\u4e0e\u5efa\u8bae/#3-patch","text":"\u5173\u4e8e diff \u4e0e patch \u547d\u4ee4\u53c2\u8003 \u6587\u4ef6\u5bf9\u6bd4 \u3002 [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <stdio.h> -------- # include <string.h> # \u5236\u4f5c patch file [ root@dev tar-test ] # diff -aur version-1/ version-2/ > 1_to_2.patch [ root@dev tar-test ] # cat 1_to_2.patch diff -aur version-1/main.c version-2/main.c --- version-1/main.c 2019 -12-24 14 :03:56.058127380 +0800 +++ version-2/main.c 2019 -12-23 17 :03:22.759351459 +0800 @@ -1 +1 @@ -# include <stdio.h> +# include <string.h> # \u5e94\u7528 patch file [ root@dev tar-test ] # patch -p0 < 1_to_2.patch # \u6216\u8005 cd version-1/ ; patch -p1 < ../1_to_2.patch\uff0c\u6ce8\u610f -p \u662f\u6839\u636e\u6240\u5728\u76ee\u5f55\u51b3\u5b9a\u7684 patching file version-1/main.c [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <string.h> -------- # include <string.h> # \u8fd8\u539f\u65e7\u7248\u672c\u6587\u4ef6 [ root@dev tar-test ] # patch -R -p0 < 1_to_2.patch patching file version-1/main.c [ root@dev tar-test ] # cat version-1/main.c ; echo \"--------\" ; cat version-2/main.c # include <stdio.h> -------- # include <string.h>","title":"3. \u5229\u7528 patch \u66f4\u65b0\u539f\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/","text":"1. \u5e93\u6587\u4ef6\u7ba1\u7406 \u00b6 1.1 \u52a8\u6001\u5e93\u4e0e\u9759\u6001\u5e93 \u00b6 1.1.1 \u9759\u6001\u5e93 \u00b6 \u6269\u5c55\u540d\uff1a \u8fd9\u7c7b\u7684\u5e93\u6587\u4ef6\u901a\u5e38\u6269\u5c55\u540d\u4e3a libxxx.a \u7684\u7c7b\u578b\uff1bWindows\u4e0b\u7684\u6269\u5c55\u540d\u4e3a .lib \u3002 \u7f16\u8bd1\u884c\u4e3a\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u6574\u5408\u5230\u6267\u884c\u7a0b\u5e8f\u5f53\u4e2d\uff0c\u6240\u4ee5\u5229\u7528\u9759\u6001\u5e93\u6587\u4ef6\u7f16\u8bd1\u6210\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5927\u4e00\u4e9b\uff1b \u72ec\u7acb\u6267\u884c\u7684\u72b6\u6001\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u6700\u5927\u7684\u4f18\u70b9\uff0c\u5c31\u662f\u7f16\u8bd1\u6210\u529f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u72ec\u7acb\u6267\u884c\uff0c\u800c\u4e0d\u9700\u8981\u518d\u5411\u5916\u90e8\u8981\u6c42\u8bfb\u53d6\u5e93\u6587\u4ef6\u7684\u5185\u5bb9 (\u8bf7\u53c2\u7167\u52a8\u6001\u5e93\u6587\u4ef6\u7684\u8bf4\u660e)\u3002 \u5347\u7ea7\u96be\u6613\u5ea6\uff1a \u867d\u7136\u6267\u884c\u6587\u4ef6\u53ef\u4ee5 \u72ec\u7acb\u6267\u884c \uff0c\u4f46\u56e0\u4e3a\u5e93\u6587\u4ef6\u662f\u76f4\u63a5\u6574\u5408\u5230\u6267\u884c\u6587\u4ef6\u4e2d\uff0c \u56e0\u6b64\u82e5\u5e93\u6587\u4ef6\u5347\u7ea7\u65f6\uff0c\u6574\u4e2a\u6267\u884c\u6587\u4ef6\u5fc5\u987b\u8981\u91cd\u65b0\u7f16\u8bd1\u624d\u80fd\u5c06\u65b0\u7248\u7684\u5e93\u6587\u4ef6\u6574\u5408\u5230\u7a0b\u5e8f\u5f53\u4e2d\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u5347\u7ea7\u65b9\u9762\uff0c\u53ea\u8981\u5e93\u6587\u4ef6\u5347\u7ea7\u4e86\uff0c\u6240\u6709\u5c06\u6b64\u5e93\u6587\u4ef6\u7eb3\u5165\u7684\u7a0b\u5e8f\u90fd\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\uff01 1.1.2 \u52a8\u6001\u5e93 \u00b6 \u6269\u5c55\u540d\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u901a\u5e38\u6269\u5c55\u540d\u4e3a libxxx.so \u7684\u7c7b\u578b\uff1bWindows\u4e0b\u7684\u6269\u5c55\u540d\u4e3a .dll \u3002 \u7f16\u8bd1\u884c\u4e3a\uff1a \u52a8\u6001\u5e93\u6587\u4ef6\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5728\u7a0b\u5e8f\u91cc\u9762\u53ea\u6709\u4e00\u4e2a \u6307\u5411 (Pointer) \u7684\u4f4d\u7f6e\u800c\u5df2\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u52a8\u6001\u5e93\u6587\u4ef6\u7684\u5185\u5bb9\u5e76\u6ca1\u6709\u88ab\u6574\u5408\u5230\u6267\u884c\u6587\u4ef6\u5f53\u4e2d\uff0c\u800c\u662f\u5f53\u6267\u884c\u6587\u4ef6\u8981\u4f7f\u7528\u5230\u5e93\u6587\u4ef6\u7684\u673a\u5236\u65f6\uff0c \u7a0b\u5e8f\u624d\u4f1a\u53bb\u8bfb\u53d6\u5e93\u6587\u4ef6\u6765\u4f7f\u7528\u3002\u7531\u4e8e\u6267\u884c\u6587\u4ef6\u5f53\u4e2d\u4ec5\u5177\u6709\u6307\u5411\u52a8\u6001\u5e93\u6587\u4ef6\u6240\u5728\u7684\u6307\u6807\u800c\u5df2\uff0c \u5e76\u4e0d\u5305\u542b\u5e93\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u4ed6\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5c0f\u4e00\u70b9\u3002 \u72ec\u7acb\u6267\u884c\u7684\u72b6\u6001\uff1a \u8fd9\u7c7b\u578b\u7684\u5e93\u6587\u4ef6\u6240\u7f16\u8bd1\u51fa\u6765\u7684\u7a0b\u5e8f\u4e0d\u80fd\u88ab\u72ec\u7acb\u6267\u884c\uff0c \u56e0\u4e3a\u5f53\u6211\u4eec\u4f7f\u7528\u5230\u5e93\u6587\u4ef6\u7684\u673a\u5236\u65f6\uff0c\u7a0b\u5e8f\u624d\u4f1a\u53bb\u8bfb\u53d6\u5e93\u6587\u4ef6\uff0c\u6240\u4ee5\u5e93\u6587\u4ef6\u6587\u4ef6 \u5fc5\u987b\u8981\u5b58\u5728 \u624d\u884c\uff0c\u800c\u4e14\uff0c\u5e93\u6587\u4ef6\u7684 \u6240\u5728\u76ee\u5f55\u4e5f\u4e0d\u80fd\u6539\u53d8 \uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u9762\u4ec5\u6709\u6307\u6807\u4ea6\u5373\u5f53\u8981\u53d6\u7528\u8be5\u52a8\u6001\u5e93\u6587\u4ef6\u65f6\uff0c \u7a0b\u5e8f\u4f1a\u4e3b\u52a8\u53bb\u67d0\u4e2a\u8def\u5f84\u4e0b\u8bfb\u53d6\u3002\u6240\u4ee5\u52a8\u6001\u5e93\u6587\u4ef6\u53ef\u4e0d\u80fd\u968f\u610f\u79fb\u52a8\u6216\u5220\u9664\uff0c\u4f1a\u5f71\u54cd\u5f88\u591a\u4f9d\u8d56\u7684\u7a0b\u5e8f\u8f6f\u4ef6\uff01 \u5347\u7ea7\u96be\u6613\u5ea6\uff1a \u867d\u7136\u8fd9\u7c7b\u578b\u7684\u6267\u884c\u6587\u4ef6\u65e0\u6cd5\u72ec\u7acb\u8fd0\u4f5c\uff0c\u7136\u800c\u7531\u4e8e\u662f\u5177\u6709\u6307\u5411\u7684\u529f\u80fd\uff0c \u6240\u4ee5\uff0c\u5f53\u5e93\u6587\u4ef6\u5347\u7ea7\u540e\uff0c\u6267\u884c\u6587\u4ef6\u6839\u672c\u4e0d\u9700\u8981\u8fdb\u884c\u91cd\u65b0\u7f16\u8bd1\u7684\u884c\u4e3a\uff0c\u56e0\u4e3a\u6267\u884c\u6587\u4ef6\u4f1a\u76f4\u63a5\u6307\u5411\u65b0\u7684\u5e93\u6587\u4ef6\u6587\u4ef6 (\u524d\u63d0\u662f\u5e93\u6587\u4ef6\u65b0\u65e7\u7248\u672c\u7684\u6587\u4ef6\u540d\u76f8\u540c\uff01 )\u3002 1.1.3 \u5e93\u6587\u4ef6\u7684\u4f4d\u7f6e \u00b6 \u7edd\u5927\u591a\u6570\u7684\u5e93\u6587\u4ef6\u90fd\u653e\u7f6e\u5728 /lib64\uff0c /lib \u76ee\u5f55\u4e0b\uff01\u6b64\u5916\uff0cLinux \u7cfb\u7edf\u91cc\u9762\u5f88\u591a\u7684\u5e93\u6587\u4ef6\u5176\u5b9e kernel \u5c31\u63d0\u4f9b\u4e86\uff0c\u4f4d\u4e8e /lib/modules \u76ee\u5f55\u4e0b\u3002 Note \u4e0d\u540c\u7248\u672c\u7684\u6838\u5fc3\u63d0\u4f9b\u7684\u5e93\u6587\u4ef6\u5dee\u5f02\u6027\u662f\u633a\u5927\u7684\uff0c\u6240\u4ee5 kernel 2.4.xx \u7248\u672c\u7684\u7cfb\u7edf\u4e0d\u8981\u60f3\u5c06\u6838\u5fc3\u6362\u6210 2.6.xx \u5594\uff01 \u5f88\u5bb9\u6613\u7531\u4e8e\u5e93\u6587\u4ef6\u7684\u4e0d\u540c\u800c\u5bfc\u81f4\u5f88\u591a\u539f\u672c\u53ef\u4ee5\u6267\u884c\u7684\u8f6f\u4ef6\u65e0\u6cd5\u987a\u5229\u8fd0\u4f5c\u5462\uff01 1.2 ldconfig \u4e0e /etc/ld.so.conf \u00b6 \u5c06\u52a8\u6001\u5e93\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\uff1a \u9996\u5148,\u6211\u4eec\u5fc5\u987b\u8981\u5728 /etc/ld.so.conf \u91cc\u9762\u5199\u4e0b \u60f3\u8981\u8bfb\u5165\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\u7684\u52a8\u6001\u5e93\u6240\u5728\u7684\u76ee\u5f55 \uff1b \u63a5\u4e0b\u6765\u5219\u662f\u5229\u7528 ldconfig \u8fd9\u4e2a\u6267\u884c\u6587\u4ef6\u5c06 /etc/ld.so.conf \u7684\u5185\u5bb9\u8bfb\u5165\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\uff1b \u540c\u65f6\u4e5f\u5c06\u6570\u636e\u8bb0\u5f55\u4e00\u4efd\u5728 /etc/ld.so.cache \u8fd9\u4e2a\u6587\u4ef6\u5f53\u4e2d\u3002 ldconfig \u8fd8\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u52a8\u6001\u51fd\u5f0f\u5e93\u7684\u94fe\u63a5\u4fe1\u606f\u3002 ldconfig [ OPTION ...] OPTION - p , --print-cache Print cache # \u914d\u7f6e [ root@dev src ] # cat /etc/ld.so.conf.d/mariadb-x86_64.conf /usr/lib64/mysql # \u8f7d\u5165 [ root@dev src ] # ldconfig # \u67e5\u770b [ root@dev src ] # ldconfig -p | grep mysql libmysqlclient.so.18 ( libc6,x86-64 ) = > /usr/lib64/mysql/libmysqlclient.so.18 1.3 \u7a0b\u5e8f\u7684\u52a8\u6001\u5e93\u89e3\u6790\uff1aldd \u00b6 \u68c0\u67e5\u6587\u4ef6\u4f9d\u8d56\u54ea\u4e9b\u52a8\u6001\u5e93\u3002 ldd [ OPTION ] ... FILE ... OPTIONS - d , --data-relocs \u6267\u884c\u91cd\u5b9a\u4f4d\u5e76\u62a5\u544a\u4efb\u4f55\u4e22\u5931\u7684\u5bf9\u8c61\uff08\u4ec5\u9650 ELF\uff09\u3002 - r , --function-relocs \u5bf9\u6570\u636e\u5bf9\u8c61\u548c\u51fd\u6570\u6267\u884c\u91cd\u5b9a\u4f4d\uff0c\u5e76\u62a5\u544a\u4efb\u4f55\u7f3a\u5c11\u7684\u5bf9\u8c61\u6216\u51fd\u6570\uff08\u4ec5\u9650 ELF\uff09\u3002 - v --verbose [ root@dev src ] # ldd -v /usr/bin/ls linux-vdso.so.1 = > ( 0x00007ffe877bf000 ) libselinux.so.1 = > /lib64/libselinux.so.1 ( 0x00007fbbdfcd4000 ) libcap.so.2 = > /lib64/libcap.so.2 ( 0x00007fbbdfacf000 ) libacl.so.1 = > /lib64/libacl.so.1 ( 0x00007fbbdf8c6000 ) \u2026\u2026 Version information: /usr/bin/ls: libacl.so.1 ( ACL_1.0 ) = > /lib64/libacl.so.1 libc.so.6 ( GLIBC_2.14 ) = > /lib64/libc.so.6 libc.so.6 ( GLIBC_2.4 ) = > /lib64/libc.so.6 \u2026\u2026 \u2026\u2026 [ root@dev src ] # ldd -v /lib64/libacl.so.1 linux-vdso.so.1 = > ( 0x00007fff16152000 ) \u2026\u2026 2. \u68c0\u9a8c\u6587\u4ef6\u6b63\u786e\u6027 \u00b6 \u57fa\u672c\u4e0a\uff0c\u4f60\u5fc5\u987b\u8981\u5728\u4f60\u7684 Linux \u7cfb\u7edf\u4e0a\u4e3a\u4f60\u7684\u8fd9\u4e9b\u91cd\u8981\u7684\u6587\u4ef6\u8fdb\u884c\u6307\u7eb9\u6570\u636e\u5e93\u7684\u5efa\u7acb\uff1a /etc/passwd /etc/shadow (\u5047\u5982\u4f60\u4e0d\u8ba9\u7528\u6237\u6539\u5bc6\u7801\u4e86) /etc/group /usr/bin/passwd /sbin/rpcbind /bin/login (\u8fd9\u4e2a\u4e5f\u5f88\u5bb9\u6613\u88ab\u9ed1!) /bin/ls /bin/ps /bin/top \u8fd9\u51e0\u4e2a\u6587\u4ef6\u6700\u5bb9\u6613\u88ab\u4fee\u6539\u4e86\uff01\u56e0\u4e3a\u5f88\u591a\u6728\u9a6c\u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u6709\u6240\u8c13\u7684\u201c\u6267\u884c\u5e8f, PID\u201c\uff0c\u56e0\u4e3a\u6015\u88ab root \u8ffd\u67e5\u51fa\u6765\uff0c\u6240\u4ee5\u4ed6\u4eec\u4f1a\u4fee\u6539\u8fd9\u4e9b\u6587\u4ef6\u3002 2.1 \u4e3e\u4f8b \u00b6 \u5c06 /etc/{passwd,shadow,group} \u4ee5\u53ca\u7cfb\u7edf\u4e0a\u9762\u6240\u6709\u7684 SUID/SGID \u6587\u4ef6\u5efa\u7acb\u6587\u4ef6\u5217\u8868\uff1a [ root@dev src ] # ls /etc/{passwd,shadow,group} > important.file [ root@dev src ] # find /usr/sbin /usr/bin -perm /6000 >> important.file \u4e3a\u8be5\u6587\u4ef6\u5efa\u7acb\u6307\u7eb9\u6587\u4ef6\uff1a [ root@dev file-check ] # cat important-md5-check.sh #!/bin/sh if [ \"x $1 \" == \"xnew\" ] then date_str = \"origin\" origin = true else date_str = $( date + \"%Y%m%d%H%M%S\" ) fi finger_file = important_finger_ ${ date_str } .file # remove important_finger_origin.file if [ -f ${ finger_file } ] then chattr -i ${ finger_file } rm ${ finger_file } fi for file in $( cat important.file ) do md5sum ${ file } >> ${ finger_file } done chattr +i ${ finger_file } diff_str = $( diff important_finger_origin.file important_finger_ ${ date_str } .file ) if [[ -n ${ origin } && ${ diff_str } ! = \"\" ]] then diff important_finger_origin.file important_finger_ ${ date_str } .file | mail -s \"important file has been modified!\" root elif [ -z ${ origin } ] then chattr -i ${ finger_file } rm ${ finger_file } fi # \u751f\u6210\u5bf9\u6bd4\u7684\u6307\u7eb9\u6587\u4ef6 [ root@dev file-check ] # sh important-md5-check.sh new [ root@dev file-check ] # ls important.file important_finger_origin.file important-md5-check.sh \u4e3a\u68c0\u67e5\u5efa\u7acb\u65e5\u7a0b\uff1a [ root@dev file-check ] # crontab -l 00 03 * * * cd /root/file-check ; sh important-md5-check.sh","title":"30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#1","text":"","title":"1. \u5e93\u6587\u4ef6\u7ba1\u7406"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#11","text":"","title":"1.1 \u52a8\u6001\u5e93\u4e0e\u9759\u6001\u5e93"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#111","text":"\u6269\u5c55\u540d\uff1a \u8fd9\u7c7b\u7684\u5e93\u6587\u4ef6\u901a\u5e38\u6269\u5c55\u540d\u4e3a libxxx.a \u7684\u7c7b\u578b\uff1bWindows\u4e0b\u7684\u6269\u5c55\u540d\u4e3a .lib \u3002 \u7f16\u8bd1\u884c\u4e3a\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u6574\u5408\u5230\u6267\u884c\u7a0b\u5e8f\u5f53\u4e2d\uff0c\u6240\u4ee5\u5229\u7528\u9759\u6001\u5e93\u6587\u4ef6\u7f16\u8bd1\u6210\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5927\u4e00\u4e9b\uff1b \u72ec\u7acb\u6267\u884c\u7684\u72b6\u6001\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u6700\u5927\u7684\u4f18\u70b9\uff0c\u5c31\u662f\u7f16\u8bd1\u6210\u529f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u72ec\u7acb\u6267\u884c\uff0c\u800c\u4e0d\u9700\u8981\u518d\u5411\u5916\u90e8\u8981\u6c42\u8bfb\u53d6\u5e93\u6587\u4ef6\u7684\u5185\u5bb9 (\u8bf7\u53c2\u7167\u52a8\u6001\u5e93\u6587\u4ef6\u7684\u8bf4\u660e)\u3002 \u5347\u7ea7\u96be\u6613\u5ea6\uff1a \u867d\u7136\u6267\u884c\u6587\u4ef6\u53ef\u4ee5 \u72ec\u7acb\u6267\u884c \uff0c\u4f46\u56e0\u4e3a\u5e93\u6587\u4ef6\u662f\u76f4\u63a5\u6574\u5408\u5230\u6267\u884c\u6587\u4ef6\u4e2d\uff0c \u56e0\u6b64\u82e5\u5e93\u6587\u4ef6\u5347\u7ea7\u65f6\uff0c\u6574\u4e2a\u6267\u884c\u6587\u4ef6\u5fc5\u987b\u8981\u91cd\u65b0\u7f16\u8bd1\u624d\u80fd\u5c06\u65b0\u7248\u7684\u5e93\u6587\u4ef6\u6574\u5408\u5230\u7a0b\u5e8f\u5f53\u4e2d\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u5347\u7ea7\u65b9\u9762\uff0c\u53ea\u8981\u5e93\u6587\u4ef6\u5347\u7ea7\u4e86\uff0c\u6240\u6709\u5c06\u6b64\u5e93\u6587\u4ef6\u7eb3\u5165\u7684\u7a0b\u5e8f\u90fd\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\uff01","title":"1.1.1 \u9759\u6001\u5e93"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#112","text":"\u6269\u5c55\u540d\uff1a \u8fd9\u7c7b\u5e93\u6587\u4ef6\u901a\u5e38\u6269\u5c55\u540d\u4e3a libxxx.so \u7684\u7c7b\u578b\uff1bWindows\u4e0b\u7684\u6269\u5c55\u540d\u4e3a .dll \u3002 \u7f16\u8bd1\u884c\u4e3a\uff1a \u52a8\u6001\u5e93\u6587\u4ef6\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5728\u7a0b\u5e8f\u91cc\u9762\u53ea\u6709\u4e00\u4e2a \u6307\u5411 (Pointer) \u7684\u4f4d\u7f6e\u800c\u5df2\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u52a8\u6001\u5e93\u6587\u4ef6\u7684\u5185\u5bb9\u5e76\u6ca1\u6709\u88ab\u6574\u5408\u5230\u6267\u884c\u6587\u4ef6\u5f53\u4e2d\uff0c\u800c\u662f\u5f53\u6267\u884c\u6587\u4ef6\u8981\u4f7f\u7528\u5230\u5e93\u6587\u4ef6\u7684\u673a\u5236\u65f6\uff0c \u7a0b\u5e8f\u624d\u4f1a\u53bb\u8bfb\u53d6\u5e93\u6587\u4ef6\u6765\u4f7f\u7528\u3002\u7531\u4e8e\u6267\u884c\u6587\u4ef6\u5f53\u4e2d\u4ec5\u5177\u6709\u6307\u5411\u52a8\u6001\u5e93\u6587\u4ef6\u6240\u5728\u7684\u6307\u6807\u800c\u5df2\uff0c \u5e76\u4e0d\u5305\u542b\u5e93\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u4ed6\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5c0f\u4e00\u70b9\u3002 \u72ec\u7acb\u6267\u884c\u7684\u72b6\u6001\uff1a \u8fd9\u7c7b\u578b\u7684\u5e93\u6587\u4ef6\u6240\u7f16\u8bd1\u51fa\u6765\u7684\u7a0b\u5e8f\u4e0d\u80fd\u88ab\u72ec\u7acb\u6267\u884c\uff0c \u56e0\u4e3a\u5f53\u6211\u4eec\u4f7f\u7528\u5230\u5e93\u6587\u4ef6\u7684\u673a\u5236\u65f6\uff0c\u7a0b\u5e8f\u624d\u4f1a\u53bb\u8bfb\u53d6\u5e93\u6587\u4ef6\uff0c\u6240\u4ee5\u5e93\u6587\u4ef6\u6587\u4ef6 \u5fc5\u987b\u8981\u5b58\u5728 \u624d\u884c\uff0c\u800c\u4e14\uff0c\u5e93\u6587\u4ef6\u7684 \u6240\u5728\u76ee\u5f55\u4e5f\u4e0d\u80fd\u6539\u53d8 \uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u53ef\u6267\u884c\u6587\u4ef6\u91cc\u9762\u4ec5\u6709\u6307\u6807\u4ea6\u5373\u5f53\u8981\u53d6\u7528\u8be5\u52a8\u6001\u5e93\u6587\u4ef6\u65f6\uff0c \u7a0b\u5e8f\u4f1a\u4e3b\u52a8\u53bb\u67d0\u4e2a\u8def\u5f84\u4e0b\u8bfb\u53d6\u3002\u6240\u4ee5\u52a8\u6001\u5e93\u6587\u4ef6\u53ef\u4e0d\u80fd\u968f\u610f\u79fb\u52a8\u6216\u5220\u9664\uff0c\u4f1a\u5f71\u54cd\u5f88\u591a\u4f9d\u8d56\u7684\u7a0b\u5e8f\u8f6f\u4ef6\uff01 \u5347\u7ea7\u96be\u6613\u5ea6\uff1a \u867d\u7136\u8fd9\u7c7b\u578b\u7684\u6267\u884c\u6587\u4ef6\u65e0\u6cd5\u72ec\u7acb\u8fd0\u4f5c\uff0c\u7136\u800c\u7531\u4e8e\u662f\u5177\u6709\u6307\u5411\u7684\u529f\u80fd\uff0c \u6240\u4ee5\uff0c\u5f53\u5e93\u6587\u4ef6\u5347\u7ea7\u540e\uff0c\u6267\u884c\u6587\u4ef6\u6839\u672c\u4e0d\u9700\u8981\u8fdb\u884c\u91cd\u65b0\u7f16\u8bd1\u7684\u884c\u4e3a\uff0c\u56e0\u4e3a\u6267\u884c\u6587\u4ef6\u4f1a\u76f4\u63a5\u6307\u5411\u65b0\u7684\u5e93\u6587\u4ef6\u6587\u4ef6 (\u524d\u63d0\u662f\u5e93\u6587\u4ef6\u65b0\u65e7\u7248\u672c\u7684\u6587\u4ef6\u540d\u76f8\u540c\uff01 )\u3002","title":"1.1.2 \u52a8\u6001\u5e93"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#113","text":"\u7edd\u5927\u591a\u6570\u7684\u5e93\u6587\u4ef6\u90fd\u653e\u7f6e\u5728 /lib64\uff0c /lib \u76ee\u5f55\u4e0b\uff01\u6b64\u5916\uff0cLinux \u7cfb\u7edf\u91cc\u9762\u5f88\u591a\u7684\u5e93\u6587\u4ef6\u5176\u5b9e kernel \u5c31\u63d0\u4f9b\u4e86\uff0c\u4f4d\u4e8e /lib/modules \u76ee\u5f55\u4e0b\u3002 Note \u4e0d\u540c\u7248\u672c\u7684\u6838\u5fc3\u63d0\u4f9b\u7684\u5e93\u6587\u4ef6\u5dee\u5f02\u6027\u662f\u633a\u5927\u7684\uff0c\u6240\u4ee5 kernel 2.4.xx \u7248\u672c\u7684\u7cfb\u7edf\u4e0d\u8981\u60f3\u5c06\u6838\u5fc3\u6362\u6210 2.6.xx \u5594\uff01 \u5f88\u5bb9\u6613\u7531\u4e8e\u5e93\u6587\u4ef6\u7684\u4e0d\u540c\u800c\u5bfc\u81f4\u5f88\u591a\u539f\u672c\u53ef\u4ee5\u6267\u884c\u7684\u8f6f\u4ef6\u65e0\u6cd5\u987a\u5229\u8fd0\u4f5c\u5462\uff01","title":"1.1.3 \u5e93\u6587\u4ef6\u7684\u4f4d\u7f6e"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#12-ldconfig-etcldsoconf","text":"\u5c06\u52a8\u6001\u5e93\u52a0\u8f7d\u5230\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\uff1a \u9996\u5148,\u6211\u4eec\u5fc5\u987b\u8981\u5728 /etc/ld.so.conf \u91cc\u9762\u5199\u4e0b \u60f3\u8981\u8bfb\u5165\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\u7684\u52a8\u6001\u5e93\u6240\u5728\u7684\u76ee\u5f55 \uff1b \u63a5\u4e0b\u6765\u5219\u662f\u5229\u7528 ldconfig \u8fd9\u4e2a\u6267\u884c\u6587\u4ef6\u5c06 /etc/ld.so.conf \u7684\u5185\u5bb9\u8bfb\u5165\u9ad8\u901f\u7f13\u5b58\u5f53\u4e2d\uff1b \u540c\u65f6\u4e5f\u5c06\u6570\u636e\u8bb0\u5f55\u4e00\u4efd\u5728 /etc/ld.so.cache \u8fd9\u4e2a\u6587\u4ef6\u5f53\u4e2d\u3002 ldconfig \u8fd8\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u52a8\u6001\u51fd\u5f0f\u5e93\u7684\u94fe\u63a5\u4fe1\u606f\u3002 ldconfig [ OPTION ...] OPTION - p , --print-cache Print cache # \u914d\u7f6e [ root@dev src ] # cat /etc/ld.so.conf.d/mariadb-x86_64.conf /usr/lib64/mysql # \u8f7d\u5165 [ root@dev src ] # ldconfig # \u67e5\u770b [ root@dev src ] # ldconfig -p | grep mysql libmysqlclient.so.18 ( libc6,x86-64 ) = > /usr/lib64/mysql/libmysqlclient.so.18","title":"1.2 ldconfig \u4e0e /etc/ld.so.conf"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#13-ldd","text":"\u68c0\u67e5\u6587\u4ef6\u4f9d\u8d56\u54ea\u4e9b\u52a8\u6001\u5e93\u3002 ldd [ OPTION ] ... FILE ... OPTIONS - d , --data-relocs \u6267\u884c\u91cd\u5b9a\u4f4d\u5e76\u62a5\u544a\u4efb\u4f55\u4e22\u5931\u7684\u5bf9\u8c61\uff08\u4ec5\u9650 ELF\uff09\u3002 - r , --function-relocs \u5bf9\u6570\u636e\u5bf9\u8c61\u548c\u51fd\u6570\u6267\u884c\u91cd\u5b9a\u4f4d\uff0c\u5e76\u62a5\u544a\u4efb\u4f55\u7f3a\u5c11\u7684\u5bf9\u8c61\u6216\u51fd\u6570\uff08\u4ec5\u9650 ELF\uff09\u3002 - v --verbose [ root@dev src ] # ldd -v /usr/bin/ls linux-vdso.so.1 = > ( 0x00007ffe877bf000 ) libselinux.so.1 = > /lib64/libselinux.so.1 ( 0x00007fbbdfcd4000 ) libcap.so.2 = > /lib64/libcap.so.2 ( 0x00007fbbdfacf000 ) libacl.so.1 = > /lib64/libacl.so.1 ( 0x00007fbbdf8c6000 ) \u2026\u2026 Version information: /usr/bin/ls: libacl.so.1 ( ACL_1.0 ) = > /lib64/libacl.so.1 libc.so.6 ( GLIBC_2.14 ) = > /lib64/libc.so.6 libc.so.6 ( GLIBC_2.4 ) = > /lib64/libc.so.6 \u2026\u2026 \u2026\u2026 [ root@dev src ] # ldd -v /lib64/libacl.so.1 linux-vdso.so.1 = > ( 0x00007fff16152000 ) \u2026\u2026","title":"1.3 \u7a0b\u5e8f\u7684\u52a8\u6001\u5e93\u89e3\u6790\uff1aldd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#2","text":"\u57fa\u672c\u4e0a\uff0c\u4f60\u5fc5\u987b\u8981\u5728\u4f60\u7684 Linux \u7cfb\u7edf\u4e0a\u4e3a\u4f60\u7684\u8fd9\u4e9b\u91cd\u8981\u7684\u6587\u4ef6\u8fdb\u884c\u6307\u7eb9\u6570\u636e\u5e93\u7684\u5efa\u7acb\uff1a /etc/passwd /etc/shadow (\u5047\u5982\u4f60\u4e0d\u8ba9\u7528\u6237\u6539\u5bc6\u7801\u4e86) /etc/group /usr/bin/passwd /sbin/rpcbind /bin/login (\u8fd9\u4e2a\u4e5f\u5f88\u5bb9\u6613\u88ab\u9ed1!) /bin/ls /bin/ps /bin/top \u8fd9\u51e0\u4e2a\u6587\u4ef6\u6700\u5bb9\u6613\u88ab\u4fee\u6539\u4e86\uff01\u56e0\u4e3a\u5f88\u591a\u6728\u9a6c\u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u6709\u6240\u8c13\u7684\u201c\u6267\u884c\u5e8f, PID\u201c\uff0c\u56e0\u4e3a\u6015\u88ab root \u8ffd\u67e5\u51fa\u6765\uff0c\u6240\u4ee5\u4ed6\u4eec\u4f1a\u4fee\u6539\u8fd9\u4e9b\u6587\u4ef6\u3002","title":"2. \u68c0\u9a8c\u6587\u4ef6\u6b63\u786e\u6027"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/30 \u5e93\u6587\u4ef6\u7684\u7ba1\u7406\u4e0e\u6587\u4ef6\u6b63\u786e\u6027\u68c0\u67e5/#21","text":"\u5c06 /etc/{passwd,shadow,group} \u4ee5\u53ca\u7cfb\u7edf\u4e0a\u9762\u6240\u6709\u7684 SUID/SGID \u6587\u4ef6\u5efa\u7acb\u6587\u4ef6\u5217\u8868\uff1a [ root@dev src ] # ls /etc/{passwd,shadow,group} > important.file [ root@dev src ] # find /usr/sbin /usr/bin -perm /6000 >> important.file \u4e3a\u8be5\u6587\u4ef6\u5efa\u7acb\u6307\u7eb9\u6587\u4ef6\uff1a [ root@dev file-check ] # cat important-md5-check.sh #!/bin/sh if [ \"x $1 \" == \"xnew\" ] then date_str = \"origin\" origin = true else date_str = $( date + \"%Y%m%d%H%M%S\" ) fi finger_file = important_finger_ ${ date_str } .file # remove important_finger_origin.file if [ -f ${ finger_file } ] then chattr -i ${ finger_file } rm ${ finger_file } fi for file in $( cat important.file ) do md5sum ${ file } >> ${ finger_file } done chattr +i ${ finger_file } diff_str = $( diff important_finger_origin.file important_finger_ ${ date_str } .file ) if [[ -n ${ origin } && ${ diff_str } ! = \"\" ]] then diff important_finger_origin.file important_finger_ ${ date_str } .file | mail -s \"important file has been modified!\" root elif [ -z ${ origin } ] then chattr -i ${ finger_file } rm ${ finger_file } fi # \u751f\u6210\u5bf9\u6bd4\u7684\u6307\u7eb9\u6587\u4ef6 [ root@dev file-check ] # sh important-md5-check.sh new [ root@dev file-check ] # ls important.file important_finger_origin.file important-md5-check.sh \u4e3a\u68c0\u67e5\u5efa\u7acb\u65e5\u7a0b\uff1a [ root@dev file-check ] # crontab -l 00 03 * * * cd /root/file-check ; sh important-md5-check.sh","title":"2.1 \u4e3e\u4f8b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/","text":"RPM \u7684\u4f18\u70b9 RPM \u5185\u542b\u5df2\u7ecf\u7f16\u8bd1\u8fc7\u7684\u7a0b\u5e8f\u4e0e\u914d\u7f6e\u6587\u4ef6\u7b49\u6570\u636e\uff0c\u53ef\u4ee5\u8ba9\u7528\u6237\u514d\u9664\u91cd\u65b0\u7f16\u8bd1\u7684\u56f0\u6270\uff1b RPM \u5728\u88ab\u5b89\u88c5\u4e4b\u524d\uff0c\u4f1a\u5148\u68c0\u67e5\u7cfb\u7edf\u7684\u786c\u76d8\u5bb9\u91cf\u3001\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u7b49\uff0c\u53ef\u907f\u514d\u6587\u4ef6\u88ab\u9519\u8bef\u5b89\u88c5\uff1b RPM \u6587\u4ef6\u672c\u8eab\u63d0\u4f9b\u8f6f\u4ef6\u7248\u672c\u4fe1\u606f\u3001\u4f9d\u8d56\u8f6f\u4ef6\u540d\u79f0\u3001\u8f6f\u4ef6\u7528\u9014\u8bf4\u660e\u3001\u8f6f\u4ef6\u6240\u542b\u6587\u4ef6\u7b49\u4fe1\u606f\uff0c\u4fbf\u4e8e\u4e86\u89e3\u8f6f\u4ef6\uff1b RPM \u7ba1\u7406\u7684\u65b9\u5f0f\u4f7f\u7528\u6570\u636e\u5e93\u8bb0\u5f55 RPM \u6587\u4ef6\u7684\u76f8\u5173\u53c2\u6570\uff0c\u4fbf\u4e8e\u5347\u7ea7\u3001\u79fb\u9664\u3001\u67e5\u8be2\u4e0e\u9a8c\u8bc1\u3002 1. rpm\u6307\u4ee4 \u00b6 rpm [ OPTION ...] \u5b89\u88c5 \u9009\u9879 - i , -- install install package ( s ) -- nodeps do not verify package dependencies -- replacefiles \u6587\u4ef6\u51b2\u7a81\u65f6\u8986\u76d6\u6389\u5c31\u6587\u4ef6 -- replacepkgs \u91cd\u65b0\u5b89\u88c5\u5df2\u7ecf\u5b89\u88c5\u8fc7\u7684\u8f6f\u4ef6 -- force -- replacepkgs -- replacefiles -- test don ' t install, but tell if it would work or not -- justdb \u7531\u4e8e RPM \u6570\u636e\u5e93\u635f\u574f\u6216\u8005\u662f\u67d0\u4e9b\u7f18\u6545\u4ea7\u751f\u9519\u8bef\u65f6,\u53ef\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u6765\u66f4\u65b0\u8f6f\u4ef6\u5728\u6570\u636e\u5e93\u5185\u7684\u76f8\u5173\u4fe1\u606f -- prefix =< dir > \u5c06\u8f6f\u4ef6\u5b89\u88c5\u5230\u5176\u4ed6\u975e\u6b63\u89c4\u76ee\u5f55 \u5347\u7ea7 \u9009\u9879 - U , -- upgrade =< packagefile >+ upgrade package ( s ) - F , -- freshen =< packagefile >+ \u53ea\u5347\u7ea7\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6 \u67e5\u8be2 / \u9a8c\u8bc1 \u5171\u7528\u7684\u9009\u9879 - a , -- all query / verify \u6240\u6709\u5305\uff08\u5df2\u5b89\u88c5\uff09 - f , -- file query \u6587\u4ef6\u5c5e\u4e8e\u54ea\u4e2a\u5305\uff1b verify \u6587\u4ef6\u662f\u5426\u88ab\u6539\u52a8\u8fc7\uff08\u5df2\u5b89\u88c5\uff09 - p , -- package query / verify \u5305\u6587\u4ef6 \u67e5\u8be2 \u9009\u9879\uff08\u4e0e - p \u914d\u5408\u4f7f\u7528\uff09 - q \u67e5\u8be2\u662f\u5426\u5b89\u88c5 - c , -- configfiles list all configuration files - l , -- list list files in package - s , -- state display the states of the listed files - i \u5217\u51fa\u8be5\u8f6f\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f - R \u5217\u51fa\u8f6f\u4ef6\u4f9d\u8d56\u7684\u6587\u4ef6 \u9a8c\u8bc1 \u9009\u9879\uff08\u4e0e - V \u914d\u5408\u4f7f\u7528\uff09 \u4f7f\u7528 / var / lib / rpm \u5e95\u4e0b\u7684\u6570\u636e\u5e93\u5185\u5bb9\u6765\u6bd4\u5bf9\u76ee\u524d Linux \u7cfb\u7edf\u7684\u73af\u5883\u4e0b\u7684\u6240\u6709\u8f6f\u4ef6\u6587\u4ef6\uff0c\u53ef\u7528\u4e8e\u67e5\u8be2\u6587\u4ef6\u662f\u5426\u88ab\u6539\u52a8\u8fc7 -- nodeps don ' t verify package dependencies \u5378\u8f7d \u9009\u9879 - e , -- erase =< package >+ erase ( uninstall ) package \u7531\u4e8e RPM \u6587\u4ef6\u5e38\u5e38\u4f1a\u5b89\u88c5/\u79fb\u9664/\u5347\u7ea7\u7b49\uff0c\u67d0\u4e9b\u52a8\u4f5c\u6216\u8bb8\u53ef\u80fd\u4f1a\u5bfc\u81f4 RPM \u6570\u636e\u5e93 /var/lib/rpm/ \u5185\u7684\u6587\u4ef6\u635f\u574f\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u6307\u4ee4\u91cd\u5efa\u6570\u636e\u5e93\uff1a rpmdb [ OPTION ...] \u539f\u6765\u7684 rpm --rebuilddb \u79fb\u52a8\u5230\u8be5\u547d\u4ee4\u4e0b\u6765\u4e86 Database options : --initdb initialize database --rebuilddb rebuild database inverted lists from installed package headers \u67e5\u8be2 [ root@dev ~ ] # rpm -q tree tree-1.6.0-10.el7.x86_64 [ root@dev ~ ] # rpm -q treee package treee is not installed \u9a8c\u8bc1 [ root@dev ~ ] # rpm -V rootfiles S.5....T. c /root/.bashrc [ root@dev ~ ] # rpm -Vf /root/.bashrc S.5....T. c /root/.bashrc [ root@dev ~ ] # rpm -Vf test.py file /root/test.py is not owned by any package \u524d\u97629\u4e2a\u5b57\u6bb5\u4ee3\u8868\u7684\u610f\u4e49\uff1a S \uff1a(file Size differs) \u6587\u4ef6\u7684\u5bb9\u91cf\u5927\u5c0f\u662f\u5426\u88ab\u6539\u53d8 M \uff1a(Mode differs) \u6587\u4ef6\u7684\u7c7b\u578b\u6216\u6587\u4ef6\u7684\u5c5e\u6027 (rwx) \u662f\u5426\u88ab\u6539\u53d8?\u5982\u662f\u5426\u53ef\u6267\u884c\u7b49\u53c2\u6570\u5df2\u88ab\u6539\u53d8 5 \uff1a(MD5 sum differs) MD5 \u8fd9\u4e00\u79cd\u6307\u7eb9\u7801\u7684\u5185\u5bb9\u5df2\u7ecf\u4e0d\u540c D \uff1a(Device major/minor number mis-match) \u8bbe\u5907\u7684\u4e3b/\u6b21\u4ee3\u7801\u5df2\u7ecf\u6539\u53d8 L \uff1a(readLink(2) path mis-match) Link \u8def\u5f84\u5df2\u88ab\u6539\u53d8 U \uff1a(User ownership differs) \u6587\u4ef6\u7684\u6240\u5c5e\u4eba\u5df2\u88ab\u6539\u53d8 G \uff1a(Group ownership differs) \u6587\u4ef6\u7684\u6240\u5c5e\u7fa4\u7ec4\u5df2\u88ab\u6539\u53d8 T \uff1a(mTime differs) \u6587\u4ef6\u7684\u5efa\u7acb\u65f6\u95f4\u5df2\u88ab\u6539\u53d8 P \uff1a(caPabilities differ) \u529f\u80fd\u5df2\u7ecf\u88ab\u6539\u53d8 \u540e\u9762\u7684\u4e00\u4e2a\u5b57\u7b26\u8868\u793a\u5c5e\u4e8e\u4ec0\u4e48\u6587\u4ef6\u7c7b\u578b\uff1a c \uff1a\u914d\u7f6e\u6587\u4ef6 (config file) d \uff1a\u6587\u4ef6\u6570\u636e\u6587\u4ef6 (documentation) g \uff1a\u9b3c\u6587\u4ef6~\u901a\u5e38\u662f\u8be5\u6587\u4ef6\u4e0d\u88ab\u67d0\u4e2a\u8f6f\u4ef6\u6240\u5305\u542b\uff0c\u8f83\u5c11\u53d1\u751f (ghost file) l \uff1a\u8bb8\u53ef\u8bc1\u6587\u4ef6 (license file) r \uff1a\u81ea\u8ff0\u6587\u4ef6 (read me) 1.1 \u6570\u5b57\u7b7e\u540d(digital signature) \u00b6 \u5f53\u4f60\u8981\u5b89\u88c5\u4e00\u4e2a RPM \u6587\u4ef6\u65f6\uff1a \u9996\u5148\u4f60\u5fc5\u987b\u8981\u5148\u5b89\u88c5\u539f\u5382\u53d1\u5e03\u7684\u516c\u94a5\u6587\u4ef6; \u5b9e\u9645\u5b89\u88c5\u539f\u5382\u7684 RPM \u8f6f\u4ef6\u65f6\uff0crpm \u6307\u4ee4\u4f1a\u53bb\u8bfb\u53d6 RPM \u6587\u4ef6\u7684\u7b7e\u540d\u4fe1\u606f\uff0c\u4e0e\u672c\u673a\u7cfb\u7edf\u5185\u7684\u7b7e\u540d\u4fe1\u606f\u6bd4\u5bf9\uff1b \u82e5\u7b7e\u540d\u76f8\u540c\u5219\u4e88\u4ee5\u5b89\u88c5\uff0c\u82e5\u627e\u4e0d\u5230\u76f8\u5173\u7684\u7b7e\u540d\u4fe1\u606f\u65f6\uff0c\u5219\u7ed9\u4e88\u8b66\u544a\u5e76\u4e14\u505c\u6b62\u5b89\u88c5\u3002 \u6570\u5b57\u516c\u94a5\u4e00\u822c\u4f4d\u4e8e /etc/pki/rpm-gpg/ \u76ee\u5f55\uff1a [ root@dev ~ ] # ls -1 /etc/pki/rpm-gpg/ RPM-GPG-KEY-CentOS-7 RPM-GPG-KEY-CentOS-Debug-7 RPM-GPG-KEY-CentOS-Testing-7 RPM-GPG-KEY-EPEL-7 \u5b89\u88c5\u516c\u94a5\uff1a [ root@dev ~ ] # rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 # \u5b89\u88c5\u5b8c\u6210\u4e4b\u540e,\u8fd9\u4e2a\u5bc6\u94a5\u7684\u5185\u5bb9\u4f1a\u4ee5\u8f6f\u4ef6\u7684\u5f62\u5f0f\u5448\u73b0 [ root@dev ~ ] # rpm -qa | grep pubkey gpg-pubkey-f4a80eb5-53a7ff4b gpg-pubkey-7bd9bf62-5762b5f8 gpg-pubkey-fe590cb7-5337fb76 gpg-pubkey-352c64e5-52ae6884 [ root@dev ~ ] # rpm -qi gpg-pubkey-f4a80eb5-53a7ff4b | grep Summary Summary : gpg ( CentOS-7 Key ( CentOS 7 Official Signing Key ) <security@centos.org> ) 2. yum \u00b6 yum provides \u9664\u4e86\u641c\u5bfb\u6307\u4ee4\u7684\u63d0\u4f9b\u5305\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u641c\u5bfb\u6587\u4ef6\u7684\u63d0\u4f9b\u5305\uff1a [ root@dev ~ ] # yum provides /root/.bashrc Loaded plugins: fastestmirror, langpacks Loading mirror speeds from cached hostfile * base: mirrors.neusoft.edu.cn * epel: www.ftp.ne.jp rootfiles-8.1-11.el7.noarch : The basic required files for the root user 's directory Repo : base Matched from: Filename : /root/.bashrc rootfiles-8.1-11.el7.noarch : The basic required files for the root user' s directory Repo : @anaconda Matched from: Filename : /root/.bashrc 2.1 yum \u4ed3\u5e93\u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 [ root@dev ~ ] # cat /etc/yum.repos.d/CentOS-Base.repo [ base ] name = CentOS- $releasever - Base mirrorlist = http://mirrorlist.centos.org/?release = $releasever & arch = $basearch & repo = os & infra = $infra #baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck = 1 gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 enabled = 1 \u5e38\u89c1\u5b57\u6bb5\uff08 man yum.conf \uff09\uff1a base\uff1a\u4ee3\u8868\u4ed3\u5e93\u7684\u540d\u5b57\u3002\u4e2d\u62ec\u53f7\u4e00\u5b9a\u8981\u5b58\u5728\uff0c\u91cc\u9762\u7684\u540d\u79f0\u5219\u53ef\u4ee5\u968f\u610f\u53d6\u4f46\u5fc5\u987b\u552f\u4e00\uff1b name\uff1a\u53ea\u662f\u8bf4\u660e\u4e00\u4e0b\u8fd9\u4e2a\u8f6f\u4ef6\u5e93\u7684\u610f\u4e49\u800c\u5df2\uff0c\u91cd\u8981\u6027\u4e0d\u9ad8\uff1b mirrorlist\uff1a\u5217\u51fa\u8fd9\u4e2a\u8f6f\u4ef6\u5e93\u53ef\u4ee5\u4f7f\u7528\u7684\u6620\u5c04\u7f51\u7ad9\uff0c\u5982\u679c\u4e0d\u60f3\u4f7f\u7528\uff0c\u53ef\u4ee5\u6279\u6ce8\u5230\u8fd9\u884c\uff1b baseurl\uff1a\u8fd9\u4e2a\u6700\u91cd\u8981\uff0c\u56e0\u4e3a\u540e\u9762\u63a5\u7684\u5c31\u662f\u8f6f\u4ef6\u5e93\u7684\u5b9e\u9645\u7f51\u5740\u3002mirrorlist \u662f\u7531 yum \u7a0b\u5e8f\u81ea\u884c\u641c\u5bfb\u6620\u50cf\u7f51\u7ad9\uff0c baseurl \u5219\u662f\u6307\u5b9a\u56fa\u5b9a\u7684\u4e00\u4e2a\u8f6f\u4ef6\u5e93\u7f51\u5740\u3002\u652f\u6301 http://, ftp://, file:// \u4e09\u79cd\u534f\u8bae\uff1b enable=1\uff1a\u662f\u5426\u542f\u7528\u8be5\u4ed3\u5e93\uff1b gpgcheck=1\uff1a\u662f\u5426\u9700\u8981\u67e5\u9605 RPM \u6587\u4ef6\u5185\u7684\u6570\u5b57\u7b7e\u540d\uff1b gpgkey\uff1a\u5c31\u662f\u6570\u5b57\u7b7e\u540d\u7684\u516c\u94a5\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002 2.2 \u6570\u636e\u540c\u6b65 \u00b6 yum \u4f1a\u5148\u4e0b\u8f7d\u8f6f\u4ef6\u5e93\u7684\u6e05\u5355\u5230\u672c\u673a\u7684 /var/cache/yum \u3002\u90a3\u6211\u4eec\u4fee\u6539\u4e86\u7f51\u5740\u5374\u6ca1\u6709\u4fee\u6539\u8f6f\u4ef6\u5e93\u540d\u79f0 (\u4e2d\u62ec\u53f7\u5185\u7684\u6587\u5b57)\uff0c\u53ef\u80fd\u5c31\u4f1a\u9020\u6210\u672c\u673a\u7684\u5217\u8868\u4e0e yum \u670d\u52a1\u5668\u7684\u5217\u8868\u4e0d\u540c\u6b65\uff0c\u6b64\u65f6\u5c31\u4f1a\u51fa\u73b0\u65e0\u6cd5\u66f4\u65b0\u7684\u95ee\u9898\u3002\u90a3\u4e48\u5c31\u6e05\u9664\u6389\u672c\u673a\u4e0a\u9762\u7684\u65e7\u6570\u636e\u5427\uff1a yum clean [ options ] options packages \u5c06\u5df2\u4e0b\u8f7d\u7684\u5305\u6587\u4ef6\u5220\u9664 headers \u5c06\u4e0b\u8f7d\u7684\u5305\u6587\u4ef6\u5934\u5220\u9664 all \u5c06\u6240\u6709\u5305\u6570\u636e\u90fd\u5220\u9664 2.3 yum \u7684\u8f6f\u4ef6\u7fa4\u7ec4\u529f\u80fd \u00b6 yum groups [ actions ] actions install list remove info \u53ef\u662f\u5f53\u4f60\u4e0b\u8fbe\u5b89\u88c5\u547d\u4ee4\u65f6\uff0c\u5374\u6ca1\u6709\u5b89\u88c5\uff1a [ root@dev ~ ] # yum groups install \"Scientific Support\" \u2026\u2026 No packages in any requested group available to install or update \u8fd9\u662f\u56e0\u4e3a Scientific Support \u91cc\u9762\u7684\u8f6f\u4ef6\u90fd\u662f\u53ef\u9009\u62e9\u7684 (optional)\uff0c\u800c\u4e0d\u662f\u4e3b\u8981\u7684 (mandatory)\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5b89\u88c5 optional \u7684\u8f6f\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08\u4f7f\u7528 man yum.conf \u67e5\u770b\uff09\uff0c\u6dfb\u52a0\u4e00\u884c\u55bd\uff1a [ root@dev ~ ] # vi /etc/yum.conf [ main ] cachedir = /var/cache/yum/ $basearch / $releasever keepcache = 0 \u2026\u2026 bugtracker_url = http://bugs.centos.org/set_project.php?project_id = 23 & ref = http://bugs.centos.org/bug_report_page.php?category = yum distroverpkg = centos-release # \u8fd9\u91cc\u5c31\u662f\u65b0\u589e\u7684\u914d\u7f6e\uff01 group_package_types = default, mandatory, optional \u7136\u540e\u5c31\u53ef\u4ee5\u5b89\u88c5\u5566\uff01 3. RPM \u8fd8\u662f Tarball \u00b6 \u5982\u679c\u6211\u8981\u5347\u7ea7\u7684\u8bdd\uff0c\u6216\u8005\u662f\u5168\u65b0\u5b89\u88c5\u4e00\u4e2a\u65b0\u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48\u8be5\u9009\u62e9 RPM \u8fd8\u662f Tarball \u6765\u5b89\u88c5\u5462\uff1f\u4e8b\u5b9e\u4e0a\u8003\u8651\u7684\u56e0\u7d20\u5f88\u591a\uff0c\u4e0d\u8fc7\u9e1f\u54e5\u901a\u5e38\u662f\u8fd9\u6837\u5efa\u8bae\u7684\uff1a \u4f18\u5148\u9009\u62e9\u539f\u5382\u7684 RPM \u529f\u80fd \u9009\u62e9\u8f6f\u4ef6\u5b98\u7f51\u91ca\u51fa\u7684 RPM \u6216\u8005\u662f\u63d0\u4f9b\u7684\u8f6f\u4ef6\u5e93\u7f51\u5740 \u5229\u7528 Tarball \u5b89\u88c5\u7279\u6b8a\u8f6f\u4ef6 \u67d0\u4e9b\u7279\u6b8a\u7528\u9014\u7684\u8f6f\u4ef6\u5e76\u4e0d\u4f1a\u7279\u522b\u5e2e\u4f60\u5236\u4f5c RPM \u6587\u4ef6\u7684\u3002\u6b64\u65f6\u5efa\u8bae\u4f60\u4e5f\u4e0d\u8981\u5984\u60f3\u81ea\u884c\u5236\u4f5c SRPM \u6765\u8f6c\u6210 RPM \u5566\uff0c\u56e0\u4e3a\u4f60\u53ea\u6709\u533a\u533a\u4e00\u90e8\u4e3b\u673a\u800c\u5df2\u3002\u82e5\u662f\u4f60\u8981\u7ba1\u7406\u76f8\u540c\u7684 100 \u90e8\u4e3b\u673a\uff0c\u90a3\u4e48\u5c06\u539f\u59cb\u7801\u8f6c\u5236\u4f5c\u6210 RPM \u5c31\u6709\u4ef7\u503c\u3002 \u7528 Tarball \u6d4b\u8bd5\u65b0\u7248\u8f6f\u4ef6 \u53ef\u4ee5\u7528 tarball \u5b89\u88c5\u65b0\u8f6f\u4ef6\u5230 /usr/local \u5e95\u4e0b\uff0c \u90a3\u4e48\u8be5\u8f6f\u4ef6\u5c31\u80fd\u591f\u540c\u65f6\u5b89\u88c5\u4e24\u4e2a\u7248\u672c\u5728\u7cfb\u7edf\u4e0a\u9762\u4e86\u3002\u800c\u4e14\u5927\u591a\u6570\u8f6f\u4ef6\u5b89\u88c5\u6570\u79cd\u7248\u672c\u65f6\u8fd8\u4e0d\u4f1a\u4e92\u76f8\u5e72\u6270\u3002 \u5982\u679c\u8f6f\u4ef6\u7684\u67b6\u6784\u5dee\u5f02\u6027\u592a\u5927\uff0c\u6216\u8005\u662f\u65e0\u6cd5\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\uff0c\u90a3\u4e48\u4e0e\u5176\u82b1\u5927\u628a\u7684\u65f6\u95f4\u4e0e\u7cbe\u529b\u5728\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\u4e0a\uff0c\u8fd8\u4e0d\u5982\u76f4\u63a5\u4ee5 tarball \u6765\u5b89\u88c5\u3002 4. rpmbuild \u00b6 \u5bf9\u4e8e SRPM \u6587\u4ef6\uff1a --rebuild \u7f16\u8bd1\u3001\u6253\u5305 --recompile \u7f16\u8bd1\u3001\u6253\u5305\u3001\u5b89\u88c5 \u66f4\u591a\u8bf4\u660e\u53c2\u8003\uff1a \u6253\u5305\u8f6f\u4ef6","title":"31 RPM \u4e0e YUM"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#1-rpm","text":"rpm [ OPTION ...] \u5b89\u88c5 \u9009\u9879 - i , -- install install package ( s ) -- nodeps do not verify package dependencies -- replacefiles \u6587\u4ef6\u51b2\u7a81\u65f6\u8986\u76d6\u6389\u5c31\u6587\u4ef6 -- replacepkgs \u91cd\u65b0\u5b89\u88c5\u5df2\u7ecf\u5b89\u88c5\u8fc7\u7684\u8f6f\u4ef6 -- force -- replacepkgs -- replacefiles -- test don ' t install, but tell if it would work or not -- justdb \u7531\u4e8e RPM \u6570\u636e\u5e93\u635f\u574f\u6216\u8005\u662f\u67d0\u4e9b\u7f18\u6545\u4ea7\u751f\u9519\u8bef\u65f6,\u53ef\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u6765\u66f4\u65b0\u8f6f\u4ef6\u5728\u6570\u636e\u5e93\u5185\u7684\u76f8\u5173\u4fe1\u606f -- prefix =< dir > \u5c06\u8f6f\u4ef6\u5b89\u88c5\u5230\u5176\u4ed6\u975e\u6b63\u89c4\u76ee\u5f55 \u5347\u7ea7 \u9009\u9879 - U , -- upgrade =< packagefile >+ upgrade package ( s ) - F , -- freshen =< packagefile >+ \u53ea\u5347\u7ea7\u5df2\u5b89\u88c5\u7684\u8f6f\u4ef6 \u67e5\u8be2 / \u9a8c\u8bc1 \u5171\u7528\u7684\u9009\u9879 - a , -- all query / verify \u6240\u6709\u5305\uff08\u5df2\u5b89\u88c5\uff09 - f , -- file query \u6587\u4ef6\u5c5e\u4e8e\u54ea\u4e2a\u5305\uff1b verify \u6587\u4ef6\u662f\u5426\u88ab\u6539\u52a8\u8fc7\uff08\u5df2\u5b89\u88c5\uff09 - p , -- package query / verify \u5305\u6587\u4ef6 \u67e5\u8be2 \u9009\u9879\uff08\u4e0e - p \u914d\u5408\u4f7f\u7528\uff09 - q \u67e5\u8be2\u662f\u5426\u5b89\u88c5 - c , -- configfiles list all configuration files - l , -- list list files in package - s , -- state display the states of the listed files - i \u5217\u51fa\u8be5\u8f6f\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f - R \u5217\u51fa\u8f6f\u4ef6\u4f9d\u8d56\u7684\u6587\u4ef6 \u9a8c\u8bc1 \u9009\u9879\uff08\u4e0e - V \u914d\u5408\u4f7f\u7528\uff09 \u4f7f\u7528 / var / lib / rpm \u5e95\u4e0b\u7684\u6570\u636e\u5e93\u5185\u5bb9\u6765\u6bd4\u5bf9\u76ee\u524d Linux \u7cfb\u7edf\u7684\u73af\u5883\u4e0b\u7684\u6240\u6709\u8f6f\u4ef6\u6587\u4ef6\uff0c\u53ef\u7528\u4e8e\u67e5\u8be2\u6587\u4ef6\u662f\u5426\u88ab\u6539\u52a8\u8fc7 -- nodeps don ' t verify package dependencies \u5378\u8f7d \u9009\u9879 - e , -- erase =< package >+ erase ( uninstall ) package \u7531\u4e8e RPM \u6587\u4ef6\u5e38\u5e38\u4f1a\u5b89\u88c5/\u79fb\u9664/\u5347\u7ea7\u7b49\uff0c\u67d0\u4e9b\u52a8\u4f5c\u6216\u8bb8\u53ef\u80fd\u4f1a\u5bfc\u81f4 RPM \u6570\u636e\u5e93 /var/lib/rpm/ \u5185\u7684\u6587\u4ef6\u635f\u574f\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u6307\u4ee4\u91cd\u5efa\u6570\u636e\u5e93\uff1a rpmdb [ OPTION ...] \u539f\u6765\u7684 rpm --rebuilddb \u79fb\u52a8\u5230\u8be5\u547d\u4ee4\u4e0b\u6765\u4e86 Database options : --initdb initialize database --rebuilddb rebuild database inverted lists from installed package headers \u67e5\u8be2 [ root@dev ~ ] # rpm -q tree tree-1.6.0-10.el7.x86_64 [ root@dev ~ ] # rpm -q treee package treee is not installed \u9a8c\u8bc1 [ root@dev ~ ] # rpm -V rootfiles S.5....T. c /root/.bashrc [ root@dev ~ ] # rpm -Vf /root/.bashrc S.5....T. c /root/.bashrc [ root@dev ~ ] # rpm -Vf test.py file /root/test.py is not owned by any package \u524d\u97629\u4e2a\u5b57\u6bb5\u4ee3\u8868\u7684\u610f\u4e49\uff1a S \uff1a(file Size differs) \u6587\u4ef6\u7684\u5bb9\u91cf\u5927\u5c0f\u662f\u5426\u88ab\u6539\u53d8 M \uff1a(Mode differs) \u6587\u4ef6\u7684\u7c7b\u578b\u6216\u6587\u4ef6\u7684\u5c5e\u6027 (rwx) \u662f\u5426\u88ab\u6539\u53d8?\u5982\u662f\u5426\u53ef\u6267\u884c\u7b49\u53c2\u6570\u5df2\u88ab\u6539\u53d8 5 \uff1a(MD5 sum differs) MD5 \u8fd9\u4e00\u79cd\u6307\u7eb9\u7801\u7684\u5185\u5bb9\u5df2\u7ecf\u4e0d\u540c D \uff1a(Device major/minor number mis-match) \u8bbe\u5907\u7684\u4e3b/\u6b21\u4ee3\u7801\u5df2\u7ecf\u6539\u53d8 L \uff1a(readLink(2) path mis-match) Link \u8def\u5f84\u5df2\u88ab\u6539\u53d8 U \uff1a(User ownership differs) \u6587\u4ef6\u7684\u6240\u5c5e\u4eba\u5df2\u88ab\u6539\u53d8 G \uff1a(Group ownership differs) \u6587\u4ef6\u7684\u6240\u5c5e\u7fa4\u7ec4\u5df2\u88ab\u6539\u53d8 T \uff1a(mTime differs) \u6587\u4ef6\u7684\u5efa\u7acb\u65f6\u95f4\u5df2\u88ab\u6539\u53d8 P \uff1a(caPabilities differ) \u529f\u80fd\u5df2\u7ecf\u88ab\u6539\u53d8 \u540e\u9762\u7684\u4e00\u4e2a\u5b57\u7b26\u8868\u793a\u5c5e\u4e8e\u4ec0\u4e48\u6587\u4ef6\u7c7b\u578b\uff1a c \uff1a\u914d\u7f6e\u6587\u4ef6 (config file) d \uff1a\u6587\u4ef6\u6570\u636e\u6587\u4ef6 (documentation) g \uff1a\u9b3c\u6587\u4ef6~\u901a\u5e38\u662f\u8be5\u6587\u4ef6\u4e0d\u88ab\u67d0\u4e2a\u8f6f\u4ef6\u6240\u5305\u542b\uff0c\u8f83\u5c11\u53d1\u751f (ghost file) l \uff1a\u8bb8\u53ef\u8bc1\u6587\u4ef6 (license file) r \uff1a\u81ea\u8ff0\u6587\u4ef6 (read me)","title":"1. rpm\u6307\u4ee4"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#11-digital-signature","text":"\u5f53\u4f60\u8981\u5b89\u88c5\u4e00\u4e2a RPM \u6587\u4ef6\u65f6\uff1a \u9996\u5148\u4f60\u5fc5\u987b\u8981\u5148\u5b89\u88c5\u539f\u5382\u53d1\u5e03\u7684\u516c\u94a5\u6587\u4ef6; \u5b9e\u9645\u5b89\u88c5\u539f\u5382\u7684 RPM \u8f6f\u4ef6\u65f6\uff0crpm \u6307\u4ee4\u4f1a\u53bb\u8bfb\u53d6 RPM \u6587\u4ef6\u7684\u7b7e\u540d\u4fe1\u606f\uff0c\u4e0e\u672c\u673a\u7cfb\u7edf\u5185\u7684\u7b7e\u540d\u4fe1\u606f\u6bd4\u5bf9\uff1b \u82e5\u7b7e\u540d\u76f8\u540c\u5219\u4e88\u4ee5\u5b89\u88c5\uff0c\u82e5\u627e\u4e0d\u5230\u76f8\u5173\u7684\u7b7e\u540d\u4fe1\u606f\u65f6\uff0c\u5219\u7ed9\u4e88\u8b66\u544a\u5e76\u4e14\u505c\u6b62\u5b89\u88c5\u3002 \u6570\u5b57\u516c\u94a5\u4e00\u822c\u4f4d\u4e8e /etc/pki/rpm-gpg/ \u76ee\u5f55\uff1a [ root@dev ~ ] # ls -1 /etc/pki/rpm-gpg/ RPM-GPG-KEY-CentOS-7 RPM-GPG-KEY-CentOS-Debug-7 RPM-GPG-KEY-CentOS-Testing-7 RPM-GPG-KEY-EPEL-7 \u5b89\u88c5\u516c\u94a5\uff1a [ root@dev ~ ] # rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 # \u5b89\u88c5\u5b8c\u6210\u4e4b\u540e,\u8fd9\u4e2a\u5bc6\u94a5\u7684\u5185\u5bb9\u4f1a\u4ee5\u8f6f\u4ef6\u7684\u5f62\u5f0f\u5448\u73b0 [ root@dev ~ ] # rpm -qa | grep pubkey gpg-pubkey-f4a80eb5-53a7ff4b gpg-pubkey-7bd9bf62-5762b5f8 gpg-pubkey-fe590cb7-5337fb76 gpg-pubkey-352c64e5-52ae6884 [ root@dev ~ ] # rpm -qi gpg-pubkey-f4a80eb5-53a7ff4b | grep Summary Summary : gpg ( CentOS-7 Key ( CentOS 7 Official Signing Key ) <security@centos.org> )","title":"1.1 \u6570\u5b57\u7b7e\u540d(digital signature)"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#2-yum","text":"yum provides \u9664\u4e86\u641c\u5bfb\u6307\u4ee4\u7684\u63d0\u4f9b\u5305\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u641c\u5bfb\u6587\u4ef6\u7684\u63d0\u4f9b\u5305\uff1a [ root@dev ~ ] # yum provides /root/.bashrc Loaded plugins: fastestmirror, langpacks Loading mirror speeds from cached hostfile * base: mirrors.neusoft.edu.cn * epel: www.ftp.ne.jp rootfiles-8.1-11.el7.noarch : The basic required files for the root user 's directory Repo : base Matched from: Filename : /root/.bashrc rootfiles-8.1-11.el7.noarch : The basic required files for the root user' s directory Repo : @anaconda Matched from: Filename : /root/.bashrc","title":"2. yum"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#21-yum","text":"[ root@dev ~ ] # cat /etc/yum.repos.d/CentOS-Base.repo [ base ] name = CentOS- $releasever - Base mirrorlist = http://mirrorlist.centos.org/?release = $releasever & arch = $basearch & repo = os & infra = $infra #baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck = 1 gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 enabled = 1 \u5e38\u89c1\u5b57\u6bb5\uff08 man yum.conf \uff09\uff1a base\uff1a\u4ee3\u8868\u4ed3\u5e93\u7684\u540d\u5b57\u3002\u4e2d\u62ec\u53f7\u4e00\u5b9a\u8981\u5b58\u5728\uff0c\u91cc\u9762\u7684\u540d\u79f0\u5219\u53ef\u4ee5\u968f\u610f\u53d6\u4f46\u5fc5\u987b\u552f\u4e00\uff1b name\uff1a\u53ea\u662f\u8bf4\u660e\u4e00\u4e0b\u8fd9\u4e2a\u8f6f\u4ef6\u5e93\u7684\u610f\u4e49\u800c\u5df2\uff0c\u91cd\u8981\u6027\u4e0d\u9ad8\uff1b mirrorlist\uff1a\u5217\u51fa\u8fd9\u4e2a\u8f6f\u4ef6\u5e93\u53ef\u4ee5\u4f7f\u7528\u7684\u6620\u5c04\u7f51\u7ad9\uff0c\u5982\u679c\u4e0d\u60f3\u4f7f\u7528\uff0c\u53ef\u4ee5\u6279\u6ce8\u5230\u8fd9\u884c\uff1b baseurl\uff1a\u8fd9\u4e2a\u6700\u91cd\u8981\uff0c\u56e0\u4e3a\u540e\u9762\u63a5\u7684\u5c31\u662f\u8f6f\u4ef6\u5e93\u7684\u5b9e\u9645\u7f51\u5740\u3002mirrorlist \u662f\u7531 yum \u7a0b\u5e8f\u81ea\u884c\u641c\u5bfb\u6620\u50cf\u7f51\u7ad9\uff0c baseurl \u5219\u662f\u6307\u5b9a\u56fa\u5b9a\u7684\u4e00\u4e2a\u8f6f\u4ef6\u5e93\u7f51\u5740\u3002\u652f\u6301 http://, ftp://, file:// \u4e09\u79cd\u534f\u8bae\uff1b enable=1\uff1a\u662f\u5426\u542f\u7528\u8be5\u4ed3\u5e93\uff1b gpgcheck=1\uff1a\u662f\u5426\u9700\u8981\u67e5\u9605 RPM \u6587\u4ef6\u5185\u7684\u6570\u5b57\u7b7e\u540d\uff1b gpgkey\uff1a\u5c31\u662f\u6570\u5b57\u7b7e\u540d\u7684\u516c\u94a5\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c\u5373\u53ef\u3002","title":"2.1 yum \u4ed3\u5e93\u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#22","text":"yum \u4f1a\u5148\u4e0b\u8f7d\u8f6f\u4ef6\u5e93\u7684\u6e05\u5355\u5230\u672c\u673a\u7684 /var/cache/yum \u3002\u90a3\u6211\u4eec\u4fee\u6539\u4e86\u7f51\u5740\u5374\u6ca1\u6709\u4fee\u6539\u8f6f\u4ef6\u5e93\u540d\u79f0 (\u4e2d\u62ec\u53f7\u5185\u7684\u6587\u5b57)\uff0c\u53ef\u80fd\u5c31\u4f1a\u9020\u6210\u672c\u673a\u7684\u5217\u8868\u4e0e yum \u670d\u52a1\u5668\u7684\u5217\u8868\u4e0d\u540c\u6b65\uff0c\u6b64\u65f6\u5c31\u4f1a\u51fa\u73b0\u65e0\u6cd5\u66f4\u65b0\u7684\u95ee\u9898\u3002\u90a3\u4e48\u5c31\u6e05\u9664\u6389\u672c\u673a\u4e0a\u9762\u7684\u65e7\u6570\u636e\u5427\uff1a yum clean [ options ] options packages \u5c06\u5df2\u4e0b\u8f7d\u7684\u5305\u6587\u4ef6\u5220\u9664 headers \u5c06\u4e0b\u8f7d\u7684\u5305\u6587\u4ef6\u5934\u5220\u9664 all \u5c06\u6240\u6709\u5305\u6570\u636e\u90fd\u5220\u9664","title":"2.2 \u6570\u636e\u540c\u6b65"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#23-yum","text":"yum groups [ actions ] actions install list remove info \u53ef\u662f\u5f53\u4f60\u4e0b\u8fbe\u5b89\u88c5\u547d\u4ee4\u65f6\uff0c\u5374\u6ca1\u6709\u5b89\u88c5\uff1a [ root@dev ~ ] # yum groups install \"Scientific Support\" \u2026\u2026 No packages in any requested group available to install or update \u8fd9\u662f\u56e0\u4e3a Scientific Support \u91cc\u9762\u7684\u8f6f\u4ef6\u90fd\u662f\u53ef\u9009\u62e9\u7684 (optional)\uff0c\u800c\u4e0d\u662f\u4e3b\u8981\u7684 (mandatory)\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5b89\u88c5 optional \u7684\u8f6f\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08\u4f7f\u7528 man yum.conf \u67e5\u770b\uff09\uff0c\u6dfb\u52a0\u4e00\u884c\u55bd\uff1a [ root@dev ~ ] # vi /etc/yum.conf [ main ] cachedir = /var/cache/yum/ $basearch / $releasever keepcache = 0 \u2026\u2026 bugtracker_url = http://bugs.centos.org/set_project.php?project_id = 23 & ref = http://bugs.centos.org/bug_report_page.php?category = yum distroverpkg = centos-release # \u8fd9\u91cc\u5c31\u662f\u65b0\u589e\u7684\u914d\u7f6e\uff01 group_package_types = default, mandatory, optional \u7136\u540e\u5c31\u53ef\u4ee5\u5b89\u88c5\u5566\uff01","title":"2.3 yum \u7684\u8f6f\u4ef6\u7fa4\u7ec4\u529f\u80fd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#3-rpm-tarball","text":"\u5982\u679c\u6211\u8981\u5347\u7ea7\u7684\u8bdd\uff0c\u6216\u8005\u662f\u5168\u65b0\u5b89\u88c5\u4e00\u4e2a\u65b0\u7684\u8f6f\u4ef6\uff0c\u90a3\u4e48\u8be5\u9009\u62e9 RPM \u8fd8\u662f Tarball \u6765\u5b89\u88c5\u5462\uff1f\u4e8b\u5b9e\u4e0a\u8003\u8651\u7684\u56e0\u7d20\u5f88\u591a\uff0c\u4e0d\u8fc7\u9e1f\u54e5\u901a\u5e38\u662f\u8fd9\u6837\u5efa\u8bae\u7684\uff1a \u4f18\u5148\u9009\u62e9\u539f\u5382\u7684 RPM \u529f\u80fd \u9009\u62e9\u8f6f\u4ef6\u5b98\u7f51\u91ca\u51fa\u7684 RPM \u6216\u8005\u662f\u63d0\u4f9b\u7684\u8f6f\u4ef6\u5e93\u7f51\u5740 \u5229\u7528 Tarball \u5b89\u88c5\u7279\u6b8a\u8f6f\u4ef6 \u67d0\u4e9b\u7279\u6b8a\u7528\u9014\u7684\u8f6f\u4ef6\u5e76\u4e0d\u4f1a\u7279\u522b\u5e2e\u4f60\u5236\u4f5c RPM \u6587\u4ef6\u7684\u3002\u6b64\u65f6\u5efa\u8bae\u4f60\u4e5f\u4e0d\u8981\u5984\u60f3\u81ea\u884c\u5236\u4f5c SRPM \u6765\u8f6c\u6210 RPM \u5566\uff0c\u56e0\u4e3a\u4f60\u53ea\u6709\u533a\u533a\u4e00\u90e8\u4e3b\u673a\u800c\u5df2\u3002\u82e5\u662f\u4f60\u8981\u7ba1\u7406\u76f8\u540c\u7684 100 \u90e8\u4e3b\u673a\uff0c\u90a3\u4e48\u5c06\u539f\u59cb\u7801\u8f6c\u5236\u4f5c\u6210 RPM \u5c31\u6709\u4ef7\u503c\u3002 \u7528 Tarball \u6d4b\u8bd5\u65b0\u7248\u8f6f\u4ef6 \u53ef\u4ee5\u7528 tarball \u5b89\u88c5\u65b0\u8f6f\u4ef6\u5230 /usr/local \u5e95\u4e0b\uff0c \u90a3\u4e48\u8be5\u8f6f\u4ef6\u5c31\u80fd\u591f\u540c\u65f6\u5b89\u88c5\u4e24\u4e2a\u7248\u672c\u5728\u7cfb\u7edf\u4e0a\u9762\u4e86\u3002\u800c\u4e14\u5927\u591a\u6570\u8f6f\u4ef6\u5b89\u88c5\u6570\u79cd\u7248\u672c\u65f6\u8fd8\u4e0d\u4f1a\u4e92\u76f8\u5e72\u6270\u3002 \u5982\u679c\u8f6f\u4ef6\u7684\u67b6\u6784\u5dee\u5f02\u6027\u592a\u5927\uff0c\u6216\u8005\u662f\u65e0\u6cd5\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\uff0c\u90a3\u4e48\u4e0e\u5176\u82b1\u5927\u628a\u7684\u65f6\u95f4\u4e0e\u7cbe\u529b\u5728\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\u4e0a\uff0c\u8fd8\u4e0d\u5982\u76f4\u63a5\u4ee5 tarball \u6765\u5b89\u88c5\u3002","title":"3. RPM \u8fd8\u662f Tarball"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/31 RPM \u4e0e YUM/#4-rpmbuild","text":"\u5bf9\u4e8e SRPM \u6587\u4ef6\uff1a --rebuild \u7f16\u8bd1\u3001\u6253\u5305 --recompile \u7f16\u8bd1\u3001\u6253\u5305\u3001\u5b89\u88c5 \u66f4\u591a\u8bf4\u660e\u53c2\u8003\uff1a \u6253\u5305\u8f6f\u4ef6","title":"4. rpmbuild"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/","text":"\u7f16\u8bd1\u5185\u6838\u7684\u52a8\u673a\u53ef\u4ee5\u5f52\u7eb3\u4e3a\u51e0\u5927\u7c7b\uff1a \u65b0\u529f\u80fd\u7684\u9700\u6c42 \u539f\u672c\u5185\u6838\u592a\u8fc7\u81c3\u80bf \u4e0e\u786c\u4ef6\u642d\u914d\u7684\u7a33\u5b9a\u6027 \u5176\u4ed6\u9700\u6c42 (\u5982\u5d4c\u5165\u5f0f\u7cfb\u7edf) 1. \u4e0b\u8f7d\u5185\u6838\u6e90\u7801 \u00b6 \u5185\u6838\u4e0b\u8f7d\u7f51\u5740\uff1ahttps://mirror.bjtu.edu.cn/kernel/linux/kernel/v3.x/ [ root@linux ~ ] # cd /usr/src/kernels/ [ root@linux kernels ] # wget https://mirror.bjtu.edu.cn/kernel/linux/kernel/v3.x/linux-3.18.140.tar.xz [ root@linux kernels ] # tar -Jxf linux-3.18.140 [ root@linux kernels ] # cd linux-3.18.140 \u6216\u5230centos\u7684\u7f51\u7ad9\u4e0b\u8f7d kernel \u7684SRPM\u5305\uff0c\u7136\u540e\u4ece\u91cc\u9762\u83b7\u53d6\uff1a [ root@dev src ] # wget http://vault.centos.org/7.7.1908/os/Source/SPackages/kernel-3.10.0-1062.el7.src.rpm [ root@dev src ] # rpm -ivh kernel-3.10.0-1062.el7.src.rpm [ root@dev src ] # cd \uff5e/rpmbuild/SOURCES/ [ root@dev SOURCES ] # ll linux-3.10.0-1062.el7.tar.xz -h -rw-rw-r--. 1 root root 89M Aug 7 21 :40 linux-3.10.0-1062.el7.tar.xz [ root@dev SOURCES ] # tar -Jxf linux-3.10.0-1062.el7.tar.xz -C /usr/local/src/ [ root@dev SOURCES ] # cd /usr/local/src/linux-3.10.0-1062.el7/ 2. \u5185\u6838\u7f16\u8bd1\u524d\u7684\u5904\u7406\u4e0e\u5185\u6838\u529f\u80fd\u9009\u62e9 \u00b6 2.1 \u7f16\u8bd1\u524d\u7684\u5de5\u4f5c \u00b6 \u67e5\u770b\u4e3b\u673a\u786c\u4ef6\u73af\u5883 \u6e05\u7406\u6e90\u7801\u6b8b\u7559\u7684\u6587\u4ef6\u3002\u4e3b\u8981\u7528\u4e8e\u5220\u9664\u524d\u4e00\u6b21\u7f16\u8bd1\u8fc7\u7a0b\u7684\u6b8b\u7559\u6570\u636e\u3002 # \u5220\u9664\u7f16\u8bd1\u8fc7\u7a0b\u4ea7\u751f\u7684\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u914d\u7f6e\u6587\u4ef6 [ root@dev linux-3.18.140 ] # make mrproper \u6ce8\u610f \uff1a\u5185\u6838\u529f\u80fd\u9009\u62e9\u6587\u4ef6\u4e5f\u4f1a\u88ab\u5220\u9664\u6389\uff01 2.2 \u9009\u62e9\u5185\u6838\u529f\u80fd \u00b6 [ root@linux linux-3.18.140 ] # make mrproper # /boot/config-xxx \u6587\u4ef6\u5c31\u662f .config \u6587\u4ef6 [ root@linux linux-3.18.140 ] # cp /boot/config-3.10.0-862.el7.x86_64 .config [ root@linux linux-3.18.140 ] # make menuconfig General setup loadable module + block layer CPU \u7684\u7c7b\u578b\u4e0e\u529f\u80fd\u9009\u62e9 \u7535\u6e90\u7ba1\u7406\u529f\u80fd \u4e00\u4e9b\u603b\u7ebf (bus) \u7684\u9009\u9879 \u7f16\u8bd1\u540e\u6267\u884c\u6587\u4ef6\u7684\u683c\u5f0f \u5185\u6838\u7684\u7f51\u7edc\u529f\u80fd \u5404\u79cd\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f \u6587\u4ef6\u7cfb\u7edf\u652f\u6301 \u5b89\u5168\u9009\u9879 \u865a\u62df\u5316 save\u4e4b\u540eexit\u5373\u53ef\u3002 3. \u5185\u6838\u7684\u7f16\u8bd1\u4e0e\u5b89\u88c5 \u00b6 3.1 \u7f16\u8bd1\u5185\u6838\u4e0e\u6a21\u5757 \u00b6 make vmlinux # \u672a\u7ecf\u538b\u7f29\u7684\u5185\u6838 make modules # \u4ec5\u5185\u6838\u6a21\u5757 make bzImage # \u7ecf\u538b\u7f29\u8fc7\u7684\u5185\u6838(\u9884\u8bbe) make all # \u8fdb\u884c\u4e0a\u8ff0\u7684\u4e09\u4e2a\u52a8\u4f5c \u66f4\u591a\u7684\u9009\u9879\u901a\u8fc7 make help \u6765\u67e5\u770b\u5427\u3002 \u6267\u884c\uff1a [ root@linux linux-3.18.140 ] # make -j 1 clean # \u6e05\u9664\u4e34\u65f6\u6587\u4ef6 [ root@linux linux-3.18.140 ] # make -j 1 bzImage # \u7f16\u8bd1\u538b\u7f29\u7684\u5185\u6838 \u2026\u2026 CRC 1d0071b2 Kernel: arch/x86/boot/bzImage is ready ( #2) [ root@linux linux-3.18.140 ] # make -j 1 modules # \u518d\u7f16\u8bd1\u6a21\u5757 \u6216\u8005\u4e00\u6b65\u5230\u4f4d\uff1a [ root@linux linux-3.18.140 ] # make -j 1 clean bzImage modules \u5728\u4e0a\u9762\u7684\u7f16\u8bd1\u8fc7\u7a0b\u5f53\u4e2d\uff0c\u5982\u679c\u6709\u53d1\u751f\u4efb\u4f55\u9519\u8bef\u7684\u8bdd\uff0c \u5f88\u53ef\u80fd\u662f\u7531\u4e8e\u5185\u6838\u9879\u76ee\u7684\u9009\u62e9\u95ee\u9898\uff0c\u53ef\u80fd\u4f60\u9700\u8981\u91cd\u65b0\u4ee5 make menuconfig \u518d\u6b21\u68c0\u67e5\u4e00\u4e0b\u4f60\u7684\u76f8\u5173\u8bbe\u5b9a\u3002\u5982\u679c\u8fd8\u662f\u65e0\u6cd5\u6210\u529f\u7684\u8bdd\uff0c\u90a3\u4e48\u6216\u8bb8\u5c06\u539f\u672c\u7684\u5185\u6838\u6570\u636e\u5185\u7684 .config \u6587\u4ef6\uff0c\u590d\u5236\u5230\u4f60\u7684\u5185\u6838\u539f\u59cb\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0c \u7136\u540e\u52a0\u4ee5\u4fee\u6539\uff0c\u5e94\u8be5\u5c31\u53ef\u4ee5\u987a\u5229\u7684\u7f16\u8bd1\u51fa\u4f60\u7684\u5185\u6838\u4e86\u3002 3.2 \u5b89\u88c5\u5185\u6838\u6a21\u5757 \u00b6 \u5185\u6838\u6a21\u5757\u662f\u653e\u7f6e\u5728 /lib/modules/$(uname -r) \u4e0b\u9762\u7684\uff0c\u4f46\u662f\u540c\u4e00\u4e2a\u7248\u672c\u7684\u6a21\u5757\u88ab\u53cd\u590d\u7f16\u8bd1\u540e\u6765\u5b89\u88c5\u65f6\uff0c\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u89e3\u51b3\u529e\u6cd5\u6709\u4e24\u4e2a\uff1a \u5148\u91cd\u547d\u540d\u65e7\u7684\u6a21\u5757\u76ee\u5f55\uff0c\u7136\u540e\u624d\u5b89\u88c5\u6a21\u5757\u5230\u76ee\u6807\u76ee\u5f55\u53bb\uff1b \u5728 make menuconfig \u65f6\uff0c\u628a\u90a3\u4e2a General setup \u5185\u7684 Local version \u4fee\u6539\u6210\u65b0\u7684\u540d\u79f0\u3002 \u9e1f\u54e5\u5efa\u8bae\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u5f0f\u3002 [ root@linux linux-3.18.140 ] # make modules_install [ root@linux linux-3.18.140 ] # ll /lib/modules/ total 8 drwxr-xr-x. 7 root root 4096 Jul 31 14 :27 3 .10.0-862.el7.x86_64 # \u8fd9\u4e2a\u5c31\u662f\u65b0\u7f16\u8bd1\u7684\u6a21\u5757\u7684\u5b89\u88c5\u76ee\u5f55 drwxr-xr-x. 3 root root 4096 Dec 30 10 :26 3 .18.140 3.3 \u5b89\u88c5\u5185\u6838\u4e0e\u5236\u4f5c\u9009\u5355 \u00b6 3.3.1 \u590d\u5236\u5185\u6838\u6587\u4ef6 \u00b6 \u7f16\u8bd1\u5b8c\u6210\u7684\u5185\u6838\u4f4d\u4e8e /usr/src/kernels/linux-3.18.140/arch/x86/boot/bzImage \uff0c\u4f46\u5728\u524d\u6587\u4e2d\u63d0\u8fc7\u7cfb\u7edf\u5185\u6838\u7406\u5e94\u4f4d\u4e8e /boot \u4e0b\u9762\uff0c\u4e14\u4ee5 vmlinuz \u5f00\u5934\u7684\u6587\u4ef6\u540d\u3002 [ root@linux linux-3.18.140 ] # file arch/x86/boot/bzImage arch/x86/boot/bzImage: Linux kernel x86 boot executable bzImage, version 3 .18.140 ( root@linux.study ) #2 SMP Mon Dec 30 09:53:07 CST 2019, RO-rootFS, swap_dev 0x5, Normal VGA # \u5185\u6838\u6587\u4ef6 [ root@linux linux-3.18.140 ] # cp arch/x86/boot/bzImage /boot/vmlinuz-3.18.140 [ root@linux linux-3.18.140 ] # chmod +x /boot/vmlinuz-3.18.140 [ root@linux linux-3.18.140 ] # cp .config /boot/config-3.18.140 [ root@linux linux-3.18.140 ] # gzip -c Module.symvers > /boot/symvers-3.18.140.gz # \u8bbe\u7f6e\u4e00\u4e0b SELinux [ root@linux linux-3.18.140 ] # restorecon -Rv /boot/ restorecon reset /boot/System.map-3.18.140 context unconfined_u:object_r:boot_t:s0->unconfined_u:object_r:system_map_t:s0 3.3.2 \u521b\u5efa Initial Ram Disk \u00b6 \u5173\u4e8e\u4f55\u65f6\u9700\u8981\u521b\u5efa\u8be5\u6587\u4ef6\u53c2\u8003\uff1a \u65b0\u5efa initramfs \u6587\u4ef6 [ root@linux linux-3.18.140 ] # dracut -v /boot/initramfs-3.18.140.img 3.18.140 3.3.3 \u5236\u4f5c\u5f00\u673a\u9009\u5355 \u00b6 [ root@linux linux-3.18.140 ] # grub2-mkconfig -o /boot/grub2/grub.cfg Generating grub configuration file ... Found linux image: /boot/vmlinuz-3.18.140 Found initrd image: /boot/initramfs-3.18.140.img Found linux image: /boot/vmlinuz-3.10.0-862.el7.x86_64 Found initrd image: /boot/initramfs-3.10.0-862.el7.x86_64.img Found linux image: /boot/vmlinuz-0-rescue-57e79e9165254f54ac88ab28cdd9c64f Found initrd image: /boot/initramfs-0-rescue-57e79e9165254f54ac88ab28cdd9c64f.img done \u9884\u8bbe\u8f83\u65b0\u7248\u672c\u7684\u5185\u6838\u4f1a\u653e\u5728\u6700\u524d\u9762\u6210\u4e3a\u9ed8\u8ba4\u7684\u5f00\u673a\u9009\u5355\u9879\u76ee\u3002 \u4e0a\u8ff0\u6b65\u9aa4\u5168\u90e8\u6210\u529f\u4e4b\u540e\u5c31\u53ef\u4ee5\u91cd\u542f\u9009\u62e9\u65b0\u5185\u6838\u5f00\u673a\u5566\uff01 \u4f46\u662f\u6211\u7f16\u8bd1\u7684\u5185\u6838\u5e76\u6ca1\u6709\u987a\u5229\u7684\u5f00\u673a\uff5e\u662f\u56e0\u4e3a device-mapper driver \u6a21\u5757\u52a0\u8f7d\u51fa\u9519\uff08 modprobe: ERROR: could not insert 'dm_mod': Exec format error \uff09\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8bc6\u522b\u5206\u533a\uff1a 4. \u5355\u72ec\u7f16\u8bd1\u5185\u6838\u6a21\u5757 \u00b6 \u5927\u81f4\u6d41\u7a0b\uff1a \u4e0b\u8f7d kernel \u7684\u6e90\u7801\uff0c\u7f6e\u4e8e /usr/src/kernels/ \u4e0b\u9762\u3002\u56e0\u4e3a\u5382\u5546\u7684\u9a71\u52a8\u90fd\u662f\u6839\u636e kernel \u6765\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\u4f1a\u7528\u5230\u5bf9\u5e94 kernel \u7684\u5934\u6587\u4ef6\u4e4b\u7c7b\u7684\u4e1c\u897f\uff0c\u8fd9\u4e9b\u6587\u4ef6\u662f\u6e90\u7801\u6240\u63d0\u4f9b\u7684\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5 kenel \u6e90\u7801\u3002\u4e5f\u53ef\u4ee5\u5b89\u88c5 kernel-devel \u5305\u6765\u76f4\u63a5\u5b89\u88c5\u5185\u6838\u6e90\u7801\u3002 \u5728\u7f16\u8bd1\u65f6\u6307\u5b9a\u7684\u5185\u6838\u7248\u672c\u5fc5\u987b\u6709\u5b83\u7684\u6e90\u7801\u5b58\u5728 \u3002\u5185\u6838\u4ee5 /lib/modules/$(uname -r)/{build,source} \u4e24\u4e2a\u94fe\u63a5\u6587\u4ef6\u6307\u5411\u7684\u5c31\u662f\u6e90\u7801\u6240\u5728\u5904\u3002 [ root@linux \uff5e ] # ll /lib/modules/3.18.140/ total 2768 lrwxrwxrwx. 1 root root 31 Dec 30 10 :12 build -> /usr/src/kernels/linux-3.18.140 drwxr-xr-x. 11 root root 116 Dec 30 10 :25 kernel \u2026\u2026 -rw-r--r--. 1 root root 305836 Dec 30 10 :26 modules.symbols -rw-r--r--. 1 root root 380795 Dec 30 10 :26 modules.symbols.bin lrwxrwxrwx. 1 root root 31 Dec 30 10 :12 source -> /usr/src/kernels/linux-3.18.140 \u83b7\u53d6\u9a71\u52a8\u6e90\u7801\uff0c\u7f16\u8bd1\u9a71\u52a8\u6a21\u5757\u3002\u83b7\u53d6\u5230\u6e90\u7801\u4e4b\u540e\uff0c \u4e00\u5b9a\u8981\u53c2\u8003 README \u6587\u4ef6 \uff0c\u7136\u540e\u5bf9\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u6700\u540e\u653e\u5230\u6b63\u786e\u7684\u76ee\u5f55\u4e0b\u3002 \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6\u5e76\u52a0\u8f7d\u3002 # \u6a21\u5757\u4f9d\u8d56\u6587\u4ef6 depmod -a # \u82e5\u662f\u5bf9\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684 kernel \u7f16\u8bd1\u7684\u9a71\u52a8\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c1d\u8bd5\u52a0\u8f7d modprobe rr640l # \u60f3\u8981\u5f00\u673a\u65f6\u5c31\u52a0\u8f7d\u6b64\u6a21\u5757 dracut --force -v --add-drivers rr640l /boot/initramfs-3.18.140.img 3 .18.140 # \u67e5\u770b\u662f\u5426\u5df2\u7ecf\u5728 initramfs \u4e2d lsinitrd /boot/initramfs-3.18.140 | grep rr640 4.1 \u4e3e\u4f8b \u00b6 4.1.1 \u83b7\u53d6\u5185\u6838\u6e90\u7801 \u00b6 [ root@dev tmp ] # uname -a Linux dev 3 .10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux # \u4e0e\u5f53\u524d\u8fd0\u884c\u7684\u5185\u6838\u7248\u672c\u4e00\u81f4 [ root@dev tmp ] # yum install kernel-devel-3.10.0-1062.el7.x86_64 # \u6e90\u7801\u5df2\u7ecf\u5b89\u88c5\u4e86 [ root@dev tmp ] # ls -d /usr/src/kernels/3.10.0-1062.el7.x86_64/ /usr/src/kernels/3.10.0-1062.el7.x86_64/ 4.1.2 \u83b7\u53d6\u9a71\u52a8\u6e90\u7801\u5e76\u7f16\u8bd1 \u00b6 \u9e1f\u54e5\u7684\u4f8b\u5b50\u4e2d\u6240\u7528\u7684\u9a71\u52a8\u5728\u5f53\u524d\u4e0d\u80fd\u4f7f\u7528\uff0c\u6211\u53c8\u627e\u4e86\u4e00\u4e2a\u82f1\u7279\u5c14\u7684\u9a71\u52a8\uff1ahttps://downloadcenter.intel.com/zh-cn/download/27981/-Linux- [ root@dev tmp ] # unzip Intel_MR_Linux_drv_7.5-07.705.04.00_pv.zip [ root@dev tmp ] # cd Intel_MR_Linux_drv_7.5-07.705.04.00_pv/ [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # ll total 28888 -rw-r--r--. 1 root root 10132 Oct 31 2017 Installation_Readme.txt -rw-r--r--. 1 root root 11384 May 23 2017 License_v2.pdf -r--r--r--. 1 root root 29525408 Mar 1 2018 megaraid_sas_components.tgz -rw-r--r--. 1 root root 18073 Jun 19 2018 MR_Linux_drv_v07.705.04.00_readme.txt -r--r--r--. 1 root root 4936 Mar 1 2018 OS_Support_list_mr7.5.txt \u5728\u67e5\u770b\u4e86 Installation_Readme.txt \u6587\u4ef6\u4e4b\u540e\uff0c\u4e86\u89e3\u5230\u540e\u7eed\u6b65\u9aa4\u662f\uff1a 1 ) Untar driver source tarball - # tar - zxvf megaraid_sas -< driver_version >- src . tar . gz 2 ) Go to driver source directory - # cd megaraid_sas -< driver_version >/ 3 ) To compile the driver for distro use the helper script \" compile.sh \" bundled inside source code - #. / compile . sh [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # mkdir megaraid_sas [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # tar -zxf megaraid_sas_components.tgz -C megaraid_sas [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # cd megaraid_sas/ # \u4e0b\u9762\u662f\u4e00\u4e9b\u5df2\u7ecf\u505a\u6210\u5404\u79cd\u7248\u672c\u548c\u5f62\u5f0f\u7684\u6587\u4ef6\uff0c\u8fd8\u6709\u6e90\u7801\u7684\u538b\u7f29\u5305 [ root@dev megaraid_sas ] # ll total 144 drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 citrix7 drwxrwxr-x. 2 500 nginx 128 Mar 1 2018 dkms-rpms-1 drwxr-xr-x. 2 500 nginx 49 Mar 1 2018 generic_srpm drwxr-xr-x. 2 500 nginx 49 Mar 1 2018 kmod_srpm drwxr-xr-x. 2 500 nginx 53 Mar 1 2018 kmp_srpm -rwxrw-r--. 1 500 nginx 143926 Mar 1 2018 megaraid_sas-07.705.04.00-src.tar.gz drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 oel6_uek drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 oel7_uek drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 rhel6_oel6_centos6 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 rhel7_oel7_centos7 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 sles11 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 sles12 drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 ubuntu # \u89e3\u538b\u6e90\u7801\u5305 [ root@dev megaraid_sas ] # tar -zxf megaraid_sas-07.705.04.00-src.tar.gz [ root@dev megaraid_sas ] # cd megaraid_sas-07.705.04.00/ [ root@dev megaraid_sas-07.705.04.00 ] # ll total 620 -r-xr-xr-x. 1 root root 1439 Feb 28 2018 compile.sh -r-xr-xr-x. 1 root root 1819 Feb 28 2018 dkms.conf -r-xr-xr-x. 1 root root 109 Feb 28 2018 Makefile -r-xr-xr-x. 1 root root 1021 Feb 28 2018 Makefile.standalone -r-xr-xr-x. 1 root root 288460 Feb 28 2018 megaraid_sas_base.c -r-xr-xr-x. 1 root root 40784 Feb 28 2018 megaraid_sas_fp.c -r-xr-xr-x. 1 root root 150733 Feb 28 2018 megaraid_sas_fusion.c -r-xr-xr-x. 1 root root 52563 Feb 28 2018 megaraid_sas_fusion.h -r-xr-xr-x. 1 root root 81914 Feb 28 2018 megaraid_sas.h # \u7ecf\u67e5\u770b compile.sh \u53d1\u73b0\u53ef\u4ee5\u5728\u811a\u6b65\u91cc\u9762\u6307\u5b9a kernel \u7684\u7248\u672c\uff0c\u90a3\u4e48\u4fee\u6539\u6210\u60f3\u8981\u9002\u914d\u7684\u7248\u672c\uff1a [ root@dev megaraid_sas-07.705.04.00 ] # vi compile.sh kernel = \"3.10.0-1062.el7.x86_64\" # \u7f16\u8bd1 [ root@dev megaraid_sas-07.705.04.00 ] # ./compile.sh [ root@dev megaraid_sas-07.705.04.00 ] # ll *.ko -rw-r--r--. 1 root root 2705768 Dec 30 17 :07 megaraid_sas.ko 4.1.3 \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6\u5e76\u52a0\u8f7d \u00b6 # \u5148\u67e5\u770b\u4e00\u4e0b\u6709\u6ca1\u6709\u8fd9\u4e2a\u9a71\u52a8 [ root@dev megaraid_sas-07.705.04.00 ] # modinfo megaraid_sas filename: /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz \u2026\u2026 # \u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u90a3\u4e48\u66ff\u6362\u6389\u8bd5\u8bd5 # \u5148\u5378\u8f7d [ root@dev megaraid_sas-07.705.04.00 ] # modprobe -r megaraid_sas # \u5907\u4efd [ root@dev megaraid_sas-07.705.04.00 ] # mv /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz /home/ [ root@dev megaraid_sas-07.705.04.00 ] # xz -k megaraid_sas.ko # \u590d\u5236 [ root@dev megaraid_sas-07.705.04.00 ] # cp megaraid_sas.ko.xz /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz # \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6 [ root@dev megaraid_sas-07.705.04.00 ] # depmod -a # OK\uff0c\u6210\u529f\u52a0\u8f7d [ root@dev megaraid_sas-07.705.04.00 ] # modprobe megaraid_sas [ root@dev megaraid_sas-07.705.04.00 ] # lsmod | grep megaraid_sas megaraid_sas 172871 0 4.2 \u5229\u7528\u539f\u6709\u7684\u5185\u6838\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1 \u00b6 \u4ec5\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\u6a21\u5757\u7684\u60c5\u51b5\u3002\u4e0b\u9762\u4ee5 ntfs \u4e3e\u4f8b\uff1a \u5148\u5230\u76ee\u524d\u7684\u5185\u6838\u6e90\u7801\u6240\u5728\u76ee\u5f55\u4e0b\u8fbe make menuconfig \uff0c\u7136\u540e\u5c06 NTFS \u7684\u9009\u9879\u8bbe\u5b9a\u6210\u4e3a\u6a21\u5757\uff0c\u7136\u540e\u4e0b\u8fbe make fs/ntfs/ \uff0c\u90a3\u4e48 ntfs \u7684\u6a21\u5757 (ntfs.ko) \u5c31\u4f1a\u81ea\u52a8\u7684\u88ab\u7f16\u8bd1\u51fa\u6765\u4e86\u3002\u7136\u540e\u5c06\u8be5\u6a21\u5757\u590d\u5236\u5230 /lib/modules/3.18.140/kernel/fs/ntsf/ \u76ee\u5f55\u4e0b, \u518d\u6267\u884c depmod -a \uff0c\u5c31\u5b8c\u6210\u4e86\u5728\u73b0\u6709\u5185\u6838\u4e0b\u65b0\u589e\u6a21\u5757\u7684\u529f\u80fd\u4e86\u3002 Important \u5728\u9605\u8bfb\u5b8c\u4e0a\u6587\u540e\uff0c\u4f60\u5e94\u8be5\u77e5\u9053\uff1a\u5f53\u5185\u6838\u66f4\u65b0\u4e4b\u540e\uff0c\u81ea\u5df1\u4e4b\u524d\u6240\u7f16\u8bd1\u7684\u5185\u6838\u6a21\u5757\u4f1a\u5931\u6548\uff01 5. \u7f16\u8bd1\u6253\u5305\u6700\u65b0\u7248\u7684 CentOS 7.x \u5185\u6838 \u00b6 \u9664\u4e86\u5b89\u88c5\u4e0a\u8ff0\u6b65\u9aa4\u6765\u7f16\u8bd1\u4e4b\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ELRepo \u7f51\u7ad9\u63d0\u4f9b\u7684 SRPM \u6765\u91cd\u65b0\u7f16\u8bd1\u6253\u5305\uff0c\u6216\u4f7f\u7528\u8be5\u7f51\u7ad9\u63d0\u4f9b\u7684 CentOS 7.x \u6765\u76f4\u63a5\u5b89\u88c5\u3002\u7f16\u8bd1\u65f6\u9664\u4e86\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\uff0c\u8fd8\u5fc5\u987b\u8981\u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff01 \u4e0b\u9762\u4f7f\u7528 SRPM \u6765\u7f16\u8bd1\u6253\u5305\u3002 # \u4ece ELReo \u83b7\u53d6 SRPM [ root@dev ~ ] # wget https://elrepo.org/linux/kernel/el7/SRPMS/kernel-ml-5.4.7-1.el7.elrepo.nosrc.rpm [ root@dev ~ ] # rpm -ivh kernel-ml-5.4.7-1.el7.elrepo.nosrc.rpm # \u6839\u636e\u7248\u672c\u83b7\u53d6\u5185\u6838\u6e90\u7801\u3002\u8fd9\u4e00\u6b65\u53ef\u4ee5\u8df3\u8fc7\uff0c\u7f16\u8bd1\u65f6\u4f1a\u81ea\u52a8\u4e0b\u8f7d\u3002\u4ece\u5185\u6838\u7f51\u7ad9 https://www.kernel.org/ \u8fdb\u5165\u3002 [ root@dev ~ ] # cd rpmbuild/SOURCES/ [ root@dev SOURCES ] # wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.4.7.tar.xz [ root@dev SOURCES ] # ls -1 config-5.4.7-x86_64 # \u9009\u5355\u6587\u4ef6 cpupower.config cpupower.service linux-5.4.7.tar.xz # \u5185\u6838\u6e90\u7801 \u7136\u540e\u4f60\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u50cf\u9e1f\u54e5\u8fd9\u6837\uff1a [ root@dev SOURCES ] # vi config-5.4.7-x86_64 # CONFIG_VFIO_PCI_VGA is not set CONFIG_VFIO_PCI_VGA = y \u7f16\u8bd1\u6253\u5305\uff1a [ root@dev SOURCES ] # cd ../SPECS/ # \u5982\u679c\u521a\u521a\u4e0b\u8f7d\u8fc7\u4e86\u5185\u6838\u6e90\u7801\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u4e0d\u9700\u8981\u518d\u6b21\u4e0b\u8f7d\u4e86\uff0c\u628a\u5b83\u6539\u6389 [ root@dev SPECS ] # vi kernel-ml-5.4.spec # Sources. # Source0: https://www.kernel.org/pub/linux/kernel/v5.x/linux-%{LKAver}.tar.xz Source0: linux-% { LKAver } .tar.xz [ root@dev SPECS ] # rpmbuild -bb kernel-ml-5.4.spec \u4e00\u5207\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u540e\u4f1a\u8f93\u51fa\u4e00\u7cfb\u5217\u7684 RPM \u5305\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\u5185\u6838\u5e76\u91cd\u542f\u4f7f\u7528\uff0c\u800c\u4e0d\u7528\u50cf\u4e0a\u6587\u90a3\u6837\u4e00\u6b65\u6b65\u5730\u64cd\u4f5c\u5566\uff01 6. \u5185\u6838\u7f16\u8bd1\u7684\u6b65\u9aa4\u5c0f\u7ed3 \u00b6 \u5148\u4e0b\u8f7d\u5185\u6838\u6e90\u7801\uff0c\u53ef\u4ee5\u4ece http://www.kernel.org \u6216\u8005\u662f distributions \u7684 SRPM \u6765\u7740\u624b\uff1b \u4ee5\u4e0b\u4ee5 Tarball \u6765\u5904\u7406\uff0c\u89e3\u538b\u6e90\u7801\u5230 /usr/src/kernels \u76ee\u5f55\u4e0b\uff1b \u5148\u8fdb\u884c\u65e7\u6570\u636e\u5220\u9664\u7684\u52a8\u4f5c\uff1a make mrproper \uff1b \u5f00\u59cb\u6311\u9009\u5185\u6838\u529f\u80fd\uff0c\u53ef\u4ee5\u5229\u7528 make menuconfig \u3001 make oldconfig \u3001 make gconfig \u7b49\u7b49\uff1b \u6e05\u9664\u8fc7\u53bb\u7684\u4e2d\u95f4\u6682\u5b58\u76d8\u8d44\u6599\uff1a make clean \u5f00\u59cb\u5185\u6838\u6587\u4ef6\u4e0e\u5185\u6838\u6a21\u5757\u7684\u7f16\u8bd1\uff1a make bzImage \u3001 make modules \u5f00\u59cb\u5185\u6838\u6a21\u5757\u7684\u5b89\u88c5\uff1a make modules_install \u5f00\u59cb\u5185\u6838\u6587\u4ef6\u7684\u5b89\u88c5\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u65b9\u5f0f\u6709\uff1a make install \u6216\u8005\u662f\u901a\u8fc7\u8fc7\u624b\u52a8\u7684\u65b9\u5f0f\u590d\u5236\u5185\u6838\u6587\u4ef6\u5230 /boot/ \u5f53\u4e2d\uff1b \u5efa\u7acb initramfs \u6587\u4ef6\uff1b \u4f7f\u7528 g rub2-mkconfig \u4fee\u6539 /boot/grub2/grub.cfg \u6587\u4ef6\u3002","title":"32 \u5185\u6838\u7f16\u8bd1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#1","text":"\u5185\u6838\u4e0b\u8f7d\u7f51\u5740\uff1ahttps://mirror.bjtu.edu.cn/kernel/linux/kernel/v3.x/ [ root@linux ~ ] # cd /usr/src/kernels/ [ root@linux kernels ] # wget https://mirror.bjtu.edu.cn/kernel/linux/kernel/v3.x/linux-3.18.140.tar.xz [ root@linux kernels ] # tar -Jxf linux-3.18.140 [ root@linux kernels ] # cd linux-3.18.140 \u6216\u5230centos\u7684\u7f51\u7ad9\u4e0b\u8f7d kernel \u7684SRPM\u5305\uff0c\u7136\u540e\u4ece\u91cc\u9762\u83b7\u53d6\uff1a [ root@dev src ] # wget http://vault.centos.org/7.7.1908/os/Source/SPackages/kernel-3.10.0-1062.el7.src.rpm [ root@dev src ] # rpm -ivh kernel-3.10.0-1062.el7.src.rpm [ root@dev src ] # cd \uff5e/rpmbuild/SOURCES/ [ root@dev SOURCES ] # ll linux-3.10.0-1062.el7.tar.xz -h -rw-rw-r--. 1 root root 89M Aug 7 21 :40 linux-3.10.0-1062.el7.tar.xz [ root@dev SOURCES ] # tar -Jxf linux-3.10.0-1062.el7.tar.xz -C /usr/local/src/ [ root@dev SOURCES ] # cd /usr/local/src/linux-3.10.0-1062.el7/","title":"1. \u4e0b\u8f7d\u5185\u6838\u6e90\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#2","text":"","title":"2. \u5185\u6838\u7f16\u8bd1\u524d\u7684\u5904\u7406\u4e0e\u5185\u6838\u529f\u80fd\u9009\u62e9"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#21","text":"\u67e5\u770b\u4e3b\u673a\u786c\u4ef6\u73af\u5883 \u6e05\u7406\u6e90\u7801\u6b8b\u7559\u7684\u6587\u4ef6\u3002\u4e3b\u8981\u7528\u4e8e\u5220\u9664\u524d\u4e00\u6b21\u7f16\u8bd1\u8fc7\u7a0b\u7684\u6b8b\u7559\u6570\u636e\u3002 # \u5220\u9664\u7f16\u8bd1\u8fc7\u7a0b\u4ea7\u751f\u7684\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u914d\u7f6e\u6587\u4ef6 [ root@dev linux-3.18.140 ] # make mrproper \u6ce8\u610f \uff1a\u5185\u6838\u529f\u80fd\u9009\u62e9\u6587\u4ef6\u4e5f\u4f1a\u88ab\u5220\u9664\u6389\uff01","title":"2.1 \u7f16\u8bd1\u524d\u7684\u5de5\u4f5c"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#22","text":"[ root@linux linux-3.18.140 ] # make mrproper # /boot/config-xxx \u6587\u4ef6\u5c31\u662f .config \u6587\u4ef6 [ root@linux linux-3.18.140 ] # cp /boot/config-3.10.0-862.el7.x86_64 .config [ root@linux linux-3.18.140 ] # make menuconfig General setup loadable module + block layer CPU \u7684\u7c7b\u578b\u4e0e\u529f\u80fd\u9009\u62e9 \u7535\u6e90\u7ba1\u7406\u529f\u80fd \u4e00\u4e9b\u603b\u7ebf (bus) \u7684\u9009\u9879 \u7f16\u8bd1\u540e\u6267\u884c\u6587\u4ef6\u7684\u683c\u5f0f \u5185\u6838\u7684\u7f51\u7edc\u529f\u80fd \u5404\u79cd\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f \u6587\u4ef6\u7cfb\u7edf\u652f\u6301 \u5b89\u5168\u9009\u9879 \u865a\u62df\u5316 save\u4e4b\u540eexit\u5373\u53ef\u3002","title":"2.2 \u9009\u62e9\u5185\u6838\u529f\u80fd"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#3","text":"","title":"3. \u5185\u6838\u7684\u7f16\u8bd1\u4e0e\u5b89\u88c5"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#31","text":"make vmlinux # \u672a\u7ecf\u538b\u7f29\u7684\u5185\u6838 make modules # \u4ec5\u5185\u6838\u6a21\u5757 make bzImage # \u7ecf\u538b\u7f29\u8fc7\u7684\u5185\u6838(\u9884\u8bbe) make all # \u8fdb\u884c\u4e0a\u8ff0\u7684\u4e09\u4e2a\u52a8\u4f5c \u66f4\u591a\u7684\u9009\u9879\u901a\u8fc7 make help \u6765\u67e5\u770b\u5427\u3002 \u6267\u884c\uff1a [ root@linux linux-3.18.140 ] # make -j 1 clean # \u6e05\u9664\u4e34\u65f6\u6587\u4ef6 [ root@linux linux-3.18.140 ] # make -j 1 bzImage # \u7f16\u8bd1\u538b\u7f29\u7684\u5185\u6838 \u2026\u2026 CRC 1d0071b2 Kernel: arch/x86/boot/bzImage is ready ( #2) [ root@linux linux-3.18.140 ] # make -j 1 modules # \u518d\u7f16\u8bd1\u6a21\u5757 \u6216\u8005\u4e00\u6b65\u5230\u4f4d\uff1a [ root@linux linux-3.18.140 ] # make -j 1 clean bzImage modules \u5728\u4e0a\u9762\u7684\u7f16\u8bd1\u8fc7\u7a0b\u5f53\u4e2d\uff0c\u5982\u679c\u6709\u53d1\u751f\u4efb\u4f55\u9519\u8bef\u7684\u8bdd\uff0c \u5f88\u53ef\u80fd\u662f\u7531\u4e8e\u5185\u6838\u9879\u76ee\u7684\u9009\u62e9\u95ee\u9898\uff0c\u53ef\u80fd\u4f60\u9700\u8981\u91cd\u65b0\u4ee5 make menuconfig \u518d\u6b21\u68c0\u67e5\u4e00\u4e0b\u4f60\u7684\u76f8\u5173\u8bbe\u5b9a\u3002\u5982\u679c\u8fd8\u662f\u65e0\u6cd5\u6210\u529f\u7684\u8bdd\uff0c\u90a3\u4e48\u6216\u8bb8\u5c06\u539f\u672c\u7684\u5185\u6838\u6570\u636e\u5185\u7684 .config \u6587\u4ef6\uff0c\u590d\u5236\u5230\u4f60\u7684\u5185\u6838\u539f\u59cb\u6587\u4ef6\u76ee\u5f55\u4e0b\uff0c \u7136\u540e\u52a0\u4ee5\u4fee\u6539\uff0c\u5e94\u8be5\u5c31\u53ef\u4ee5\u987a\u5229\u7684\u7f16\u8bd1\u51fa\u4f60\u7684\u5185\u6838\u4e86\u3002","title":"3.1 \u7f16\u8bd1\u5185\u6838\u4e0e\u6a21\u5757"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#32","text":"\u5185\u6838\u6a21\u5757\u662f\u653e\u7f6e\u5728 /lib/modules/$(uname -r) \u4e0b\u9762\u7684\uff0c\u4f46\u662f\u540c\u4e00\u4e2a\u7248\u672c\u7684\u6a21\u5757\u88ab\u53cd\u590d\u7f16\u8bd1\u540e\u6765\u5b89\u88c5\u65f6\uff0c\u5c31\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u89e3\u51b3\u529e\u6cd5\u6709\u4e24\u4e2a\uff1a \u5148\u91cd\u547d\u540d\u65e7\u7684\u6a21\u5757\u76ee\u5f55\uff0c\u7136\u540e\u624d\u5b89\u88c5\u6a21\u5757\u5230\u76ee\u6807\u76ee\u5f55\u53bb\uff1b \u5728 make menuconfig \u65f6\uff0c\u628a\u90a3\u4e2a General setup \u5185\u7684 Local version \u4fee\u6539\u6210\u65b0\u7684\u540d\u79f0\u3002 \u9e1f\u54e5\u5efa\u8bae\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u65b9\u5f0f\u3002 [ root@linux linux-3.18.140 ] # make modules_install [ root@linux linux-3.18.140 ] # ll /lib/modules/ total 8 drwxr-xr-x. 7 root root 4096 Jul 31 14 :27 3 .10.0-862.el7.x86_64 # \u8fd9\u4e2a\u5c31\u662f\u65b0\u7f16\u8bd1\u7684\u6a21\u5757\u7684\u5b89\u88c5\u76ee\u5f55 drwxr-xr-x. 3 root root 4096 Dec 30 10 :26 3 .18.140","title":"3.2 \u5b89\u88c5\u5185\u6838\u6a21\u5757"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#33","text":"","title":"3.3 \u5b89\u88c5\u5185\u6838\u4e0e\u5236\u4f5c\u9009\u5355"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#331","text":"\u7f16\u8bd1\u5b8c\u6210\u7684\u5185\u6838\u4f4d\u4e8e /usr/src/kernels/linux-3.18.140/arch/x86/boot/bzImage \uff0c\u4f46\u5728\u524d\u6587\u4e2d\u63d0\u8fc7\u7cfb\u7edf\u5185\u6838\u7406\u5e94\u4f4d\u4e8e /boot \u4e0b\u9762\uff0c\u4e14\u4ee5 vmlinuz \u5f00\u5934\u7684\u6587\u4ef6\u540d\u3002 [ root@linux linux-3.18.140 ] # file arch/x86/boot/bzImage arch/x86/boot/bzImage: Linux kernel x86 boot executable bzImage, version 3 .18.140 ( root@linux.study ) #2 SMP Mon Dec 30 09:53:07 CST 2019, RO-rootFS, swap_dev 0x5, Normal VGA # \u5185\u6838\u6587\u4ef6 [ root@linux linux-3.18.140 ] # cp arch/x86/boot/bzImage /boot/vmlinuz-3.18.140 [ root@linux linux-3.18.140 ] # chmod +x /boot/vmlinuz-3.18.140 [ root@linux linux-3.18.140 ] # cp .config /boot/config-3.18.140 [ root@linux linux-3.18.140 ] # gzip -c Module.symvers > /boot/symvers-3.18.140.gz # \u8bbe\u7f6e\u4e00\u4e0b SELinux [ root@linux linux-3.18.140 ] # restorecon -Rv /boot/ restorecon reset /boot/System.map-3.18.140 context unconfined_u:object_r:boot_t:s0->unconfined_u:object_r:system_map_t:s0","title":"3.3.1 \u590d\u5236\u5185\u6838\u6587\u4ef6"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#332-initial-ram-disk","text":"\u5173\u4e8e\u4f55\u65f6\u9700\u8981\u521b\u5efa\u8be5\u6587\u4ef6\u53c2\u8003\uff1a \u65b0\u5efa initramfs \u6587\u4ef6 [ root@linux linux-3.18.140 ] # dracut -v /boot/initramfs-3.18.140.img 3.18.140","title":"3.3.2 \u521b\u5efa Initial Ram Disk"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#333","text":"[ root@linux linux-3.18.140 ] # grub2-mkconfig -o /boot/grub2/grub.cfg Generating grub configuration file ... Found linux image: /boot/vmlinuz-3.18.140 Found initrd image: /boot/initramfs-3.18.140.img Found linux image: /boot/vmlinuz-3.10.0-862.el7.x86_64 Found initrd image: /boot/initramfs-3.10.0-862.el7.x86_64.img Found linux image: /boot/vmlinuz-0-rescue-57e79e9165254f54ac88ab28cdd9c64f Found initrd image: /boot/initramfs-0-rescue-57e79e9165254f54ac88ab28cdd9c64f.img done \u9884\u8bbe\u8f83\u65b0\u7248\u672c\u7684\u5185\u6838\u4f1a\u653e\u5728\u6700\u524d\u9762\u6210\u4e3a\u9ed8\u8ba4\u7684\u5f00\u673a\u9009\u5355\u9879\u76ee\u3002 \u4e0a\u8ff0\u6b65\u9aa4\u5168\u90e8\u6210\u529f\u4e4b\u540e\u5c31\u53ef\u4ee5\u91cd\u542f\u9009\u62e9\u65b0\u5185\u6838\u5f00\u673a\u5566\uff01 \u4f46\u662f\u6211\u7f16\u8bd1\u7684\u5185\u6838\u5e76\u6ca1\u6709\u987a\u5229\u7684\u5f00\u673a\uff5e\u662f\u56e0\u4e3a device-mapper driver \u6a21\u5757\u52a0\u8f7d\u51fa\u9519\uff08 modprobe: ERROR: could not insert 'dm_mod': Exec format error \uff09\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8bc6\u522b\u5206\u533a\uff1a","title":"3.3.3 \u5236\u4f5c\u5f00\u673a\u9009\u5355"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#4","text":"\u5927\u81f4\u6d41\u7a0b\uff1a \u4e0b\u8f7d kernel \u7684\u6e90\u7801\uff0c\u7f6e\u4e8e /usr/src/kernels/ \u4e0b\u9762\u3002\u56e0\u4e3a\u5382\u5546\u7684\u9a71\u52a8\u90fd\u662f\u6839\u636e kernel \u6765\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\u4f1a\u7528\u5230\u5bf9\u5e94 kernel \u7684\u5934\u6587\u4ef6\u4e4b\u7c7b\u7684\u4e1c\u897f\uff0c\u8fd9\u4e9b\u6587\u4ef6\u662f\u6e90\u7801\u6240\u63d0\u4f9b\u7684\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5 kenel \u6e90\u7801\u3002\u4e5f\u53ef\u4ee5\u5b89\u88c5 kernel-devel \u5305\u6765\u76f4\u63a5\u5b89\u88c5\u5185\u6838\u6e90\u7801\u3002 \u5728\u7f16\u8bd1\u65f6\u6307\u5b9a\u7684\u5185\u6838\u7248\u672c\u5fc5\u987b\u6709\u5b83\u7684\u6e90\u7801\u5b58\u5728 \u3002\u5185\u6838\u4ee5 /lib/modules/$(uname -r)/{build,source} \u4e24\u4e2a\u94fe\u63a5\u6587\u4ef6\u6307\u5411\u7684\u5c31\u662f\u6e90\u7801\u6240\u5728\u5904\u3002 [ root@linux \uff5e ] # ll /lib/modules/3.18.140/ total 2768 lrwxrwxrwx. 1 root root 31 Dec 30 10 :12 build -> /usr/src/kernels/linux-3.18.140 drwxr-xr-x. 11 root root 116 Dec 30 10 :25 kernel \u2026\u2026 -rw-r--r--. 1 root root 305836 Dec 30 10 :26 modules.symbols -rw-r--r--. 1 root root 380795 Dec 30 10 :26 modules.symbols.bin lrwxrwxrwx. 1 root root 31 Dec 30 10 :12 source -> /usr/src/kernels/linux-3.18.140 \u83b7\u53d6\u9a71\u52a8\u6e90\u7801\uff0c\u7f16\u8bd1\u9a71\u52a8\u6a21\u5757\u3002\u83b7\u53d6\u5230\u6e90\u7801\u4e4b\u540e\uff0c \u4e00\u5b9a\u8981\u53c2\u8003 README \u6587\u4ef6 \uff0c\u7136\u540e\u5bf9\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1\uff0c\u6700\u540e\u653e\u5230\u6b63\u786e\u7684\u76ee\u5f55\u4e0b\u3002 \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6\u5e76\u52a0\u8f7d\u3002 # \u6a21\u5757\u4f9d\u8d56\u6587\u4ef6 depmod -a # \u82e5\u662f\u5bf9\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684 kernel \u7f16\u8bd1\u7684\u9a71\u52a8\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c1d\u8bd5\u52a0\u8f7d modprobe rr640l # \u60f3\u8981\u5f00\u673a\u65f6\u5c31\u52a0\u8f7d\u6b64\u6a21\u5757 dracut --force -v --add-drivers rr640l /boot/initramfs-3.18.140.img 3 .18.140 # \u67e5\u770b\u662f\u5426\u5df2\u7ecf\u5728 initramfs \u4e2d lsinitrd /boot/initramfs-3.18.140 | grep rr640","title":"4. \u5355\u72ec\u7f16\u8bd1\u5185\u6838\u6a21\u5757"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#41","text":"","title":"4.1 \u4e3e\u4f8b"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#411","text":"[ root@dev tmp ] # uname -a Linux dev 3 .10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux # \u4e0e\u5f53\u524d\u8fd0\u884c\u7684\u5185\u6838\u7248\u672c\u4e00\u81f4 [ root@dev tmp ] # yum install kernel-devel-3.10.0-1062.el7.x86_64 # \u6e90\u7801\u5df2\u7ecf\u5b89\u88c5\u4e86 [ root@dev tmp ] # ls -d /usr/src/kernels/3.10.0-1062.el7.x86_64/ /usr/src/kernels/3.10.0-1062.el7.x86_64/","title":"4.1.1 \u83b7\u53d6\u5185\u6838\u6e90\u7801"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#412","text":"\u9e1f\u54e5\u7684\u4f8b\u5b50\u4e2d\u6240\u7528\u7684\u9a71\u52a8\u5728\u5f53\u524d\u4e0d\u80fd\u4f7f\u7528\uff0c\u6211\u53c8\u627e\u4e86\u4e00\u4e2a\u82f1\u7279\u5c14\u7684\u9a71\u52a8\uff1ahttps://downloadcenter.intel.com/zh-cn/download/27981/-Linux- [ root@dev tmp ] # unzip Intel_MR_Linux_drv_7.5-07.705.04.00_pv.zip [ root@dev tmp ] # cd Intel_MR_Linux_drv_7.5-07.705.04.00_pv/ [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # ll total 28888 -rw-r--r--. 1 root root 10132 Oct 31 2017 Installation_Readme.txt -rw-r--r--. 1 root root 11384 May 23 2017 License_v2.pdf -r--r--r--. 1 root root 29525408 Mar 1 2018 megaraid_sas_components.tgz -rw-r--r--. 1 root root 18073 Jun 19 2018 MR_Linux_drv_v07.705.04.00_readme.txt -r--r--r--. 1 root root 4936 Mar 1 2018 OS_Support_list_mr7.5.txt \u5728\u67e5\u770b\u4e86 Installation_Readme.txt \u6587\u4ef6\u4e4b\u540e\uff0c\u4e86\u89e3\u5230\u540e\u7eed\u6b65\u9aa4\u662f\uff1a 1 ) Untar driver source tarball - # tar - zxvf megaraid_sas -< driver_version >- src . tar . gz 2 ) Go to driver source directory - # cd megaraid_sas -< driver_version >/ 3 ) To compile the driver for distro use the helper script \" compile.sh \" bundled inside source code - #. / compile . sh [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # mkdir megaraid_sas [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # tar -zxf megaraid_sas_components.tgz -C megaraid_sas [ root@dev Intel_MR_Linux_drv_7.5-07.705.04.00_pv ] # cd megaraid_sas/ # \u4e0b\u9762\u662f\u4e00\u4e9b\u5df2\u7ecf\u505a\u6210\u5404\u79cd\u7248\u672c\u548c\u5f62\u5f0f\u7684\u6587\u4ef6\uff0c\u8fd8\u6709\u6e90\u7801\u7684\u538b\u7f29\u5305 [ root@dev megaraid_sas ] # ll total 144 drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 citrix7 drwxrwxr-x. 2 500 nginx 128 Mar 1 2018 dkms-rpms-1 drwxr-xr-x. 2 500 nginx 49 Mar 1 2018 generic_srpm drwxr-xr-x. 2 500 nginx 49 Mar 1 2018 kmod_srpm drwxr-xr-x. 2 500 nginx 53 Mar 1 2018 kmp_srpm -rwxrw-r--. 1 500 nginx 143926 Mar 1 2018 megaraid_sas-07.705.04.00-src.tar.gz drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 oel6_uek drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 oel7_uek drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 rhel6_oel6_centos6 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 rhel7_oel7_centos7 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 sles11 drwxrwxr-x. 4 500 nginx 35 Mar 1 2018 sles12 drwxrwxr-x. 3 500 nginx 20 Mar 1 2018 ubuntu # \u89e3\u538b\u6e90\u7801\u5305 [ root@dev megaraid_sas ] # tar -zxf megaraid_sas-07.705.04.00-src.tar.gz [ root@dev megaraid_sas ] # cd megaraid_sas-07.705.04.00/ [ root@dev megaraid_sas-07.705.04.00 ] # ll total 620 -r-xr-xr-x. 1 root root 1439 Feb 28 2018 compile.sh -r-xr-xr-x. 1 root root 1819 Feb 28 2018 dkms.conf -r-xr-xr-x. 1 root root 109 Feb 28 2018 Makefile -r-xr-xr-x. 1 root root 1021 Feb 28 2018 Makefile.standalone -r-xr-xr-x. 1 root root 288460 Feb 28 2018 megaraid_sas_base.c -r-xr-xr-x. 1 root root 40784 Feb 28 2018 megaraid_sas_fp.c -r-xr-xr-x. 1 root root 150733 Feb 28 2018 megaraid_sas_fusion.c -r-xr-xr-x. 1 root root 52563 Feb 28 2018 megaraid_sas_fusion.h -r-xr-xr-x. 1 root root 81914 Feb 28 2018 megaraid_sas.h # \u7ecf\u67e5\u770b compile.sh \u53d1\u73b0\u53ef\u4ee5\u5728\u811a\u6b65\u91cc\u9762\u6307\u5b9a kernel \u7684\u7248\u672c\uff0c\u90a3\u4e48\u4fee\u6539\u6210\u60f3\u8981\u9002\u914d\u7684\u7248\u672c\uff1a [ root@dev megaraid_sas-07.705.04.00 ] # vi compile.sh kernel = \"3.10.0-1062.el7.x86_64\" # \u7f16\u8bd1 [ root@dev megaraid_sas-07.705.04.00 ] # ./compile.sh [ root@dev megaraid_sas-07.705.04.00 ] # ll *.ko -rw-r--r--. 1 root root 2705768 Dec 30 17 :07 megaraid_sas.ko","title":"4.1.2 \u83b7\u53d6\u9a71\u52a8\u6e90\u7801\u5e76\u7f16\u8bd1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#413","text":"# \u5148\u67e5\u770b\u4e00\u4e0b\u6709\u6ca1\u6709\u8fd9\u4e2a\u9a71\u52a8 [ root@dev megaraid_sas-07.705.04.00 ] # modinfo megaraid_sas filename: /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz \u2026\u2026 # \u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u90a3\u4e48\u66ff\u6362\u6389\u8bd5\u8bd5 # \u5148\u5378\u8f7d [ root@dev megaraid_sas-07.705.04.00 ] # modprobe -r megaraid_sas # \u5907\u4efd [ root@dev megaraid_sas-07.705.04.00 ] # mv /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz /home/ [ root@dev megaraid_sas-07.705.04.00 ] # xz -k megaraid_sas.ko # \u590d\u5236 [ root@dev megaraid_sas-07.705.04.00 ] # cp megaraid_sas.ko.xz /lib/modules/3.10.0-1062.el7.x86_64/kernel/drivers/scsi/megaraid/megaraid_sas.ko.xz # \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6 [ root@dev megaraid_sas-07.705.04.00 ] # depmod -a # OK\uff0c\u6210\u529f\u52a0\u8f7d [ root@dev megaraid_sas-07.705.04.00 ] # modprobe megaraid_sas [ root@dev megaraid_sas-07.705.04.00 ] # lsmod | grep megaraid_sas megaraid_sas 172871 0","title":"4.1.3 \u751f\u6210\u6a21\u5757\u4f9d\u8d56\u6587\u4ef6\u5e76\u52a0\u8f7d"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#42","text":"\u4ec5\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\u6a21\u5757\u7684\u60c5\u51b5\u3002\u4e0b\u9762\u4ee5 ntfs \u4e3e\u4f8b\uff1a \u5148\u5230\u76ee\u524d\u7684\u5185\u6838\u6e90\u7801\u6240\u5728\u76ee\u5f55\u4e0b\u8fbe make menuconfig \uff0c\u7136\u540e\u5c06 NTFS \u7684\u9009\u9879\u8bbe\u5b9a\u6210\u4e3a\u6a21\u5757\uff0c\u7136\u540e\u4e0b\u8fbe make fs/ntfs/ \uff0c\u90a3\u4e48 ntfs \u7684\u6a21\u5757 (ntfs.ko) \u5c31\u4f1a\u81ea\u52a8\u7684\u88ab\u7f16\u8bd1\u51fa\u6765\u4e86\u3002\u7136\u540e\u5c06\u8be5\u6a21\u5757\u590d\u5236\u5230 /lib/modules/3.18.140/kernel/fs/ntsf/ \u76ee\u5f55\u4e0b, \u518d\u6267\u884c depmod -a \uff0c\u5c31\u5b8c\u6210\u4e86\u5728\u73b0\u6709\u5185\u6838\u4e0b\u65b0\u589e\u6a21\u5757\u7684\u529f\u80fd\u4e86\u3002 Important \u5728\u9605\u8bfb\u5b8c\u4e0a\u6587\u540e\uff0c\u4f60\u5e94\u8be5\u77e5\u9053\uff1a\u5f53\u5185\u6838\u66f4\u65b0\u4e4b\u540e\uff0c\u81ea\u5df1\u4e4b\u524d\u6240\u7f16\u8bd1\u7684\u5185\u6838\u6a21\u5757\u4f1a\u5931\u6548\uff01","title":"4.2 \u5229\u7528\u539f\u6709\u7684\u5185\u6838\u6e90\u7801\u8fdb\u884c\u7f16\u8bd1"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#5-centos-7x","text":"\u9664\u4e86\u5b89\u88c5\u4e0a\u8ff0\u6b65\u9aa4\u6765\u7f16\u8bd1\u4e4b\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ELRepo \u7f51\u7ad9\u63d0\u4f9b\u7684 SRPM \u6765\u91cd\u65b0\u7f16\u8bd1\u6253\u5305\uff0c\u6216\u4f7f\u7528\u8be5\u7f51\u7ad9\u63d0\u4f9b\u7684 CentOS 7.x \u6765\u76f4\u63a5\u5b89\u88c5\u3002\u7f16\u8bd1\u65f6\u9664\u4e86\u89e3\u51b3\u4f9d\u8d56\u95ee\u9898\uff0c\u8fd8\u5fc5\u987b\u8981\u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff01 \u4e0b\u9762\u4f7f\u7528 SRPM \u6765\u7f16\u8bd1\u6253\u5305\u3002 # \u4ece ELReo \u83b7\u53d6 SRPM [ root@dev ~ ] # wget https://elrepo.org/linux/kernel/el7/SRPMS/kernel-ml-5.4.7-1.el7.elrepo.nosrc.rpm [ root@dev ~ ] # rpm -ivh kernel-ml-5.4.7-1.el7.elrepo.nosrc.rpm # \u6839\u636e\u7248\u672c\u83b7\u53d6\u5185\u6838\u6e90\u7801\u3002\u8fd9\u4e00\u6b65\u53ef\u4ee5\u8df3\u8fc7\uff0c\u7f16\u8bd1\u65f6\u4f1a\u81ea\u52a8\u4e0b\u8f7d\u3002\u4ece\u5185\u6838\u7f51\u7ad9 https://www.kernel.org/ \u8fdb\u5165\u3002 [ root@dev ~ ] # cd rpmbuild/SOURCES/ [ root@dev SOURCES ] # wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.4.7.tar.xz [ root@dev SOURCES ] # ls -1 config-5.4.7-x86_64 # \u9009\u5355\u6587\u4ef6 cpupower.config cpupower.service linux-5.4.7.tar.xz # \u5185\u6838\u6e90\u7801 \u7136\u540e\u4f60\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u50cf\u9e1f\u54e5\u8fd9\u6837\uff1a [ root@dev SOURCES ] # vi config-5.4.7-x86_64 # CONFIG_VFIO_PCI_VGA is not set CONFIG_VFIO_PCI_VGA = y \u7f16\u8bd1\u6253\u5305\uff1a [ root@dev SOURCES ] # cd ../SPECS/ # \u5982\u679c\u521a\u521a\u4e0b\u8f7d\u8fc7\u4e86\u5185\u6838\u6e90\u7801\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u4e0d\u9700\u8981\u518d\u6b21\u4e0b\u8f7d\u4e86\uff0c\u628a\u5b83\u6539\u6389 [ root@dev SPECS ] # vi kernel-ml-5.4.spec # Sources. # Source0: https://www.kernel.org/pub/linux/kernel/v5.x/linux-%{LKAver}.tar.xz Source0: linux-% { LKAver } .tar.xz [ root@dev SPECS ] # rpmbuild -bb kernel-ml-5.4.spec \u4e00\u5207\u6b63\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u540e\u4f1a\u8f93\u51fa\u4e00\u7cfb\u5217\u7684 RPM \u5305\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\u5185\u6838\u5e76\u91cd\u542f\u4f7f\u7528\uff0c\u800c\u4e0d\u7528\u50cf\u4e0a\u6587\u90a3\u6837\u4e00\u6b65\u6b65\u5730\u64cd\u4f5c\u5566\uff01","title":"5. \u7f16\u8bd1\u6253\u5305\u6700\u65b0\u7248\u7684 CentOS 7.x \u5185\u6838"},{"location":"\u9e1f\u54e5\u7684linux\u79c1\u623f\u83dc/32 \u5185\u6838\u7f16\u8bd1/#6","text":"\u5148\u4e0b\u8f7d\u5185\u6838\u6e90\u7801\uff0c\u53ef\u4ee5\u4ece http://www.kernel.org \u6216\u8005\u662f distributions \u7684 SRPM \u6765\u7740\u624b\uff1b \u4ee5\u4e0b\u4ee5 Tarball \u6765\u5904\u7406\uff0c\u89e3\u538b\u6e90\u7801\u5230 /usr/src/kernels \u76ee\u5f55\u4e0b\uff1b \u5148\u8fdb\u884c\u65e7\u6570\u636e\u5220\u9664\u7684\u52a8\u4f5c\uff1a make mrproper \uff1b \u5f00\u59cb\u6311\u9009\u5185\u6838\u529f\u80fd\uff0c\u53ef\u4ee5\u5229\u7528 make menuconfig \u3001 make oldconfig \u3001 make gconfig \u7b49\u7b49\uff1b \u6e05\u9664\u8fc7\u53bb\u7684\u4e2d\u95f4\u6682\u5b58\u76d8\u8d44\u6599\uff1a make clean \u5f00\u59cb\u5185\u6838\u6587\u4ef6\u4e0e\u5185\u6838\u6a21\u5757\u7684\u7f16\u8bd1\uff1a make bzImage \u3001 make modules \u5f00\u59cb\u5185\u6838\u6a21\u5757\u7684\u5b89\u88c5\uff1a make modules_install \u5f00\u59cb\u5185\u6838\u6587\u4ef6\u7684\u5b89\u88c5\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u65b9\u5f0f\u6709\uff1a make install \u6216\u8005\u662f\u901a\u8fc7\u8fc7\u624b\u52a8\u7684\u65b9\u5f0f\u590d\u5236\u5185\u6838\u6587\u4ef6\u5230 /boot/ \u5f53\u4e2d\uff1b \u5efa\u7acb initramfs \u6587\u4ef6\uff1b \u4f7f\u7528 g rub2-mkconfig \u4fee\u6539 /boot/grub2/grub.cfg \u6587\u4ef6\u3002","title":"6. \u5185\u6838\u7f16\u8bd1\u7684\u6b65\u9aa4\u5c0f\u7ed3"}]}