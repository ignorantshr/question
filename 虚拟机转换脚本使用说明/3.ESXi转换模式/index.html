<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>3.ESXi转换模式 - Work Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "1. \u6784\u9020URI", url: "#_top", children: [
          ]},
          {title: "2. \u6d4b\u8bd5libvirt\u5230ESXi hypervisor\u7684\u8fde\u63a5", url: "#2-libvirtesxi-hypervisor", children: [
          ]},
          {title: "3. \u6784\u9020\u8f93\u5165\u9009\u9879", url: "#3", children: [
              {title: "\u4e3e\u4f8b\u8bf4\u660e\uff1a", url: "#_1" },
          ]},
          {title: "4. \u8f6c\u6362\u5230ovirt\u5e73\u53f0", url: "#4-ovirt", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p><strong>目录</strong></p>
<div class="toc">
<ul>
<li><a href="#1-uri">1. 构造URI</a></li>
<li><a href="#2-libvirtesxi-hypervisor">2. 测试libvirt到ESXi hypervisor的连接</a></li>
<li><a href="#3">3. 构造输入选项</a><ul>
<li><a href="#_1">举例说明：</a></li>
</ul>
</li>
<li><a href="#4-ovirt">4. 转换到ovirt平台</a></li>
</ul>
</div>
<p>通过访问ESXi服务器来转换虚拟机。</p>
<p>尽量使用ova或vmx的输入方式，因为它们比本篇的方法更快且需要的空间也更少。</p>
<p><strong>注意</strong>：此方式要求<strong>转换服务器执行脚本的目录下</strong>和<strong>目标存储域</strong>都有充足的空间来转换虚拟机，否则会转换失败。</p>
<h1 id="1-uri">1. 构造URI</h1>
<p>在转换时需要一个URI链接来访问ESXi服务器。</p>
<p>一般的URI格式如下：</p>
<pre><code class="shell">esx://user@esxi.example.com?no_verify=1
</code></pre>

<ul>
<li><code>esx</code>：固定参数，表示这是一个ESXi类型的链接</li>
<li><code>user</code>：登录到ESXi服务器的用户名</li>
<li><code>esxi.example.com</code>：ESXi服务器的IP地址或域名</li>
<li><code>?no_verify=1</code>：用于取消TLS证书检查。</li>
</ul>
<h1 id="2-libvirtesxi-hypervisor">2. 测试libvirt到ESXi hypervisor的连接</h1>
<p>在转换之前，首先确保该URI是有效的，使用<code>virsh</code>命令测试：</p>
<pre><code class="shell"> $ virsh -c esx://root@esxi.example.com?no_verify=1 list --all
 Enter root's password for esxi.example.com: ***
  Id    Name                           State
 ----------------------------------------------------
  -     guest                          shut off
</code></pre>

<p>如果能看到虚拟机列表则表示该URI可用。</p>
<p><strong><code>警告</code></strong>：如果测试失败，那么虚拟机转换不会成功！</p>
<h1 id="3">3. 构造输入选项</h1>
<p>在ESXi模式的转换方式下，转换脚本的输入选项有以下几个：</p>
<ul>
<li><code>--mode</code>：转换模式。此处为ESXi。</li>
<li><code>--uri</code>：连接到ESXi服务器的远程链接。</li>
<li><code>--vm-name</code>：要转换的虚拟机名字。此虚拟机必须在测试URI连接结果的虚拟机列表中。</li>
<li><code>--password-file</code>：存放登录到ESXi服务器密码的文件。该文件存放在转换服务器上面，文件中的密码必须是完整的密码且不能跟随任何换行符。可选选项，如果不指定在转换时需要手动输入密码。</li>
</ul>
<h4 id="_1">举例说明：</h4>
<p>现在有一台ESXi服务器，其IP地址为<code>172.16.2.179</code>，上面有一台虚拟机<code>centos-esxi-1</code>，登录密码存在转换服务器上面的<code>esxi.pass</code>文件中。</p>
<p>那么其URI：</p>
<pre><code class="shell">esx://root@172.16.2.179?no_verify=1
</code></pre>

<p>然后在转换服务器上进行连接测试：</p>
<pre><code class="shell">$ virsh -c 'esx://root@172.16.2.179?no_verify=1' list --all
Enter root's password for 172.16.2.179:
 Id    Name                           State
----------------------------------------------------
 -     centos-esxi-1                  shut off
</code></pre>

<p>测试成功，输入选项构造如下：</p>
<pre><code class="shell">--mode ESXi --uri esx://root@172.16.2.179?no_verify=1 --vm-name centos-esxi-1 --password-file esxi.pass
</code></pre>

<h1 id="4-ovirt">4. 转换到ovirt平台</h1>
<p>参考：<a href="../转换到ovirt平台/">转换到ovirt平台</a></p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>