<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>1. 文档的目的 - Work Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "1. \u6587\u6863\u7684\u76ee\u7684", url: "#_top", children: [
          ]},
          {title: "2. \u642d\u5efa\u8f6c\u6362\u670d\u52a1\u5668", url: "#2", children: [
          ]},
          {title: "3. \u811a\u672c\u7684\u4f7f\u7528\u8bf4\u660e", url: "#3", children: [
              {title: "\u8f93\u5165\u9009\u9879\u7684\u6784\u9020", url: "#_1" },
              {title: "\u8f93\u51fa\u9009\u9879\u7684\u6784\u9020", url: "#_2" },
              {title: "\u4e3e\u4f8b\u8bf4\u660e", url: "#_3" },
          ]},
          {title: "4. \u6ce8\u610f\u4e8b\u9879", url: "#4", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="1">1. 文档的目的</h1>
<p>本文档说明的是<strong>虚拟机转换脚本</strong>的使用。该脚本位于<code>shell/convert.sh</code>。</p>
<p>该脚本的目的是将<code>VMware平台及Xen虚拟化平台</code>的虚拟机转换到<code>ovirt或ACloudAge KS</code>平台。</p>
<h1 id="2">2. 搭建转换服务器</h1>
<p>执行转换脚本的服务器称作<code>转换服务器</code>。</p>
<p>在使用该脚本之前，请首先阅读<a href="../转换服务器的搭建/">转换服务器的搭建</a>为脚本提供必要的运行环境，并查看本文<strong>4.注意事项</strong>章节。</p>
<h1 id="3">3. 脚本的使用说明</h1>
<p>脚本在命令行按以下格式执行：</p>
<pre><code class="bash">convert 输入选项 输出选项
</code></pre>

<p>将<code>输入选项</code>与<code>输出选项</code>补充完整后才可执行命令，如何填写参考下方的构造说明，你也可以执行<code>convert --help</code>查阅简单的使用说明。</p>
<h4 id="_1">输入选项的构造</h4>
<p>脚本支持6种输入模式，每种都有对应的如何构造输入选项的说明文档：</p>
<table>
<thead>
<tr>
<th align="center">模式</th>
<th align="center">模式说明</th>
<th align="center">对应的说明文档</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ova</td>
<td align="center">利用VMware平台的虚拟机ova文件进行虚拟机转换。</td>
<td align="center"><a href="../1.ova转换模式/">1.ova转换模式</a></td>
</tr>
<tr>
<td align="center">vmx</td>
<td align="center">利用VMware平台的虚拟机工作目录进行虚拟机转换。</td>
<td align="center"><a href="../2.vmx转换模式/">2.vmx转换模式</a></td>
</tr>
<tr>
<td align="center">ESXi</td>
<td align="center">通过访问ESXi服务器来转换虚拟机。</td>
<td align="center"><a href="../3.ESXi转换模式/">3.ESXi转换模式</a></td>
</tr>
<tr>
<td align="center">vCenter</td>
<td align="center">通过访问VMware vCenter服务器进行虚拟机转换。</td>
<td align="center"><a href="../4.vCenter转换模式/">4.vCenter转换模式</a></td>
</tr>
<tr>
<td align="center">vddk</td>
<td align="center">通过VMware的开发库vddk进行虚拟机转换。</td>
<td align="center"><a href="../5.vddk转换模式/">5.vddk转换模式</a></td>
</tr>
<tr>
<td align="center">xen</td>
<td align="center">从xen虚拟化平台上转换虚拟机。</td>
<td align="center"><a href="../6.xen转换模式/">6.xen转换模式</a></td>
</tr>
</tbody>
</table>
<h4 id="_2">输出选项的构造</h4>
<p>输出选项的构造则参考<a href="../转换到ovirt平台/">转换到ovirt平台</a>。</p>
<h4 id="_3">举例说明</h4>
<p>转换场景：想要转换VMware Workstation上的一台虚拟机到ovirt平台。</p>
<p>首先通过上述的构造输入选项的参考文档<code>1.ova转换模式</code>获取了一台虚拟机的ova文件（centos.ova），并构造了输入选项：</p>
<pre><code class="shell">--mode ova --file centos.ova
</code></pre>

<p>然后通过上述的构造输出选项的参考文档<code>转换到ovirt平台</code>构造了输出选项：</p>
<pre><code class="shell">--export-path 172.16.2.124:/home/exports
</code></pre>

<p>此时，就可以在转换服务器上面执行命令转换虚拟机：</p>
<pre><code class="shell">convert --mode ova --file centos.ova --export-path 172.16.2.124:/home/exports
</code></pre>

<h1 id="4">4. 注意事项</h1>
<ul>
<li>
<p>支持转换的虚拟机的操作系统有以下几种：</p>
<ul>
<li>Red Hat Enterprise Linux 3, 4, 5, 6, 7</li>
<li>CentOS 3, 4, 5, 6, 7 </li>
<li>Scientific Linux 3, 4, 5, 6, 7 </li>
<li>Oracle Linux</li>
<li>Fedora  </li>
<li>SLES 10 及以上</li>
<li>OpenSUSE 10 及以上</li>
<li>Debian 6 及以上</li>
<li>Ubuntu 10.04, 12.04, 14.04, 16.04, 及以上</li>
<li>Windows XP 到 Windows 10 / Windows Server 2016</li>
</ul>
</li>
<li>
<p>在转换之前虚拟机必须是<strong>关机状态</strong>。</p>
</li>
<li>
<p>使用之前根据需要搭建VMware的服务器或xen的虚拟化服务器。</p>
</li>
<li>
<p>所有的VMware平台的Windows虚拟机在转换之前都需要先卸载<code>VMware-tools</code>。</p>
</li>
<li>
<p>如果Windows虚拟机开启了<code>快速启动</code>的功能，那么需要关闭该功能。否则会出现如下字样的错误信息并转换失败：</p>
<blockquote>
<p>guestfsd: error: mount exited with status 14: The disk contains an unclean file system (0, 0).
Metadata kept in Windows cache, refused to mount.</p>
</blockquote>
</li>
<li>
<p>在转换过程中如果出现了类似<code>iPXE (http://ipxe.org) 00:05.0 C100 PCI2.10 PnP PMM</code>的字样并卡住不继续向下执行的情况，此时需要升级<code>qemu</code>的版本：</p>
</li>
</ul>
<pre><code class="shell">yum install centos-release-qemu-ev
yum install qemu-kvm qemu-img -y
</code></pre>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>