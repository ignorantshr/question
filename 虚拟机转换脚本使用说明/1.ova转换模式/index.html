<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>1.ova转换模式 - Work Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "1. \u83b7\u53d6ova", url: "#_top", children: [
              {title: "1.1 \u5728\u670d\u52a1\u5668\u7684\u7ba1\u7406\u754c\u9762\u5bfc\u51fa", url: "#11" },
              {title: "1.2 \u901a\u8fc7\u547d\u4ee4\u5bfc\u51fa", url: "#12" },
              {title: "1.3 \u5728VMware Workstation\u7684\u7ba1\u7406\u754c\u9762\u5bfc\u51fa", url: "#13-vmware-workstation" },
          ]},
          {title: "2. \u6784\u9020\u8f93\u5165\u9009\u9879", url: "#2", children: [
              {title: "\u4e3e\u4f8b\u8bf4\u660e", url: "#_3" },
          ]},
          {title: "3. \u8f6c\u6362\u5230ovirt\u5e73\u53f0", url: "#3-ovirt", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <p><strong>目录</strong></p>
<div class="toc">
<ul>
<li><a href="#1-ova">1. 获取ova</a><ul>
<li><a href="#11">1.1 在服务器的管理界面导出</a><ul>
<li><a href="#111-vcenter">1.1.1 在vCenter界面导出</a></li>
<li><a href="#112-esxi">1.1.2 在ESXi界面导出</a></li>
</ul>
</li>
<li><a href="#12">1.2 通过命令导出</a><ul>
<li><a href="#121-ovftool">1.2.1 安装ovftool</a></li>
<li><a href="#122-ovftoolova">1.2.2 通过ovftool导出虚拟机ova文件</a><ul>
<li><a href="#1221-esxi">1.2.2.1 导出ESXi服务器上面的虚拟机</a></li>
<li><a href="#_1">举例说明：</a></li>
<li><a href="#1222-vcenter">1.2.2.2 导出vCenter服务器上面的虚拟机</a></li>
<li><a href="#_2">举例说明：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#13-vmware-workstation">1.3 在VMware Workstation的管理界面导出</a></li>
</ul>
</li>
<li><a href="#2">2. 构造输入选项</a><ul>
<li><a href="#_3">举例说明</a></li>
</ul>
</li>
<li><a href="#3-ovirt">3. 转换到ovirt平台</a></li>
</ul>
</div>
<p>利用VMware平台的虚拟机ova文件进行虚拟机转换。</p>
<p><strong>注意</strong>：此方式要求<strong>转换服务器</strong>和<strong>目标存储域</strong>都有充足的空间来转换虚拟机，否则会转换失败。</p>
<h1 id="1-ova">1. 获取ova</h1>
<p>转换之前首先需要提供ova文件。
ova文件可通过三种方式获取：</p>
<ul>
<li>在服务器的管理界面导出</li>
<li>通过命令导出</li>
<li>在VMware Workstation的管理界面导出</li>
</ul>
<p><strong>不推荐使用第一种方式</strong>，步骤复杂，且文件校验容易失败，导致转换失败。</p>
<h2 id="11">1.1 在服务器的管理界面导出</h2>
<p>在<code>vCenter服务器</code>和<code>ESXi服务器</code>都能通过管理界面导出虚拟机的ova文件。</p>
<p>不推荐使用这种方式，请尽可能地使用<strong>1.2 通过命令导出</strong>的方式。</p>
<h3 id="111-vcenter">1.1.1 在vCenter界面导出</h3>
<p>登录进入vCenter管理界面，点击<code>导出OVF模板</code>（选中某个<strong>关机的</strong>虚拟机-&gt;鼠标右键-&gt;模板-&gt;导出OVF模板），即可看到如下界面：</p>
<p><img alt="" src="../img/vcenter-ovf导出界面.png" /></p>
<p>点击<code>确定</code>按钮之后会下载一些文件，需要将它们保存在同一个文件夹下（比如<code>centos-esxi-1</code>）。</p>
<p>然后将文件夹放入<code>转换服务器</code>中打包即可得到ova文件：</p>
<pre><code class="shell">cd centos-esxi-1
tar -cvf centos-esxi-1.ova .
</code></pre>

<h3 id="112-esxi">1.1.2 在ESXi界面导出</h3>
<p>登录进入vCenter管理界面，点击<code>导出</code>（选中某个<strong>关机的</strong>虚拟机-&gt;鼠标右键-&gt;导出），即可看到如下界面：</p>
<p><img alt="" src="../img/esxi-ovf导出界面.png" /></p>
<p>点击<code>确定</code>按钮之后会下载一些文件，需要将它们保存在同一个文件夹下（比如<code>centos-esxi-1-2</code>）。</p>
<p>然后将文件夹放入<code>转换服务器</code>中打包成ova文件：</p>
<pre><code class="shell">cd centos-esxi-1-2
tar -cvf centos-esxi-1-2.ova .
</code></pre>

<h2 id="12">1.2 通过命令导出</h2>
<h3 id="121-ovftool">1.2.1 安装ovftool</h3>
<p>首先获取导出工具<code>ovftool</code>，有两种方式：</p>
<ul>
<li>从VMware官网下载linux64位版本的ovftool。<a href="https://www.vmware.com/support/developer/ovf/">ovftool下载地址</a></li>
<li>从<code>resources</code>文件夹下取出<code>VMware-ovftool-4.3.0-7948156-lin.x86_64.bundle</code></li>
</ul>
<p>将该工具放入<code>转换服务器</code>中安装：</p>
<pre><code class="shell">chmod +x VMware-ovftool-4.3.0-7948156-lin.x86_64.bundle
./VMware-ovftool-4.3.0-7948156-lin.x86_64.bundle
</code></pre>

<p>安装过程中会让你阅读协议（左下角出现<code>More</code>字样），不想看的话按<code>q</code>退出，输入<code>yes</code>同意安装。</p>
<h3 id="122-ovftoolova">1.2.2 通过ovftool导出虚拟机ova文件</h3>
<h4 id="1221-esxi">1.2.2.1 导出ESXi服务器上面的虚拟机</h4>
<p>导出ESXi主机上面的虚拟机使用下面格式的命令：</p>
<pre><code class="shell"> ovftool --noSSLVerify \
   vi://USER:PASSWORD@esxi.example.com/VM \
   VM.ova
</code></pre>

<p>下面是各参数的含义：</p>
<ul>
<li><code>USER</code>：登录到ESXi服务器的用户名。</li>
<li><code>PASSWORD</code>：登录到ESXi服务器的密码。</li>
<li><code>esxi.example.com</code>：ESXi服务器的域名或IP地址。</li>
<li><code>VM</code>：ESXi服务器上面的虚拟机的相对路径。</li>
<li><code>VM.ova</code>：导出的ova文件名。</li>
</ul>
<h4 id="_1">举例说明：</h4>
<p>有一台<code>centos-esxi-1</code>的虚拟机在ESXi服务器的路径如下图所示：</p>
<p><img alt="" src="../img/esxi-ovftool虚拟机定位界面.png" /></p>
<p>那么其导出ova命令为：</p>
<pre><code>ovftool --noSSLVerify \
    vi://root:ABC.123456@172.16.2.179/centos-esxi-1 \
    centos-esxi-1-ovftool.ova
</code></pre>

<p><strong>注意</strong>：如果链接中存在特殊符号则需要替换为ASCII 十六进制码。比如<code>vi://root:ABC.123456@172.16.2.179/centos esxi 1</code>应写为<code>vi://root:ABC.123456@172.16.2.179/centos%20esxi%201</code>（空格的ASCII 十六进制码是20）。</p>
<h4 id="1222-vcenter">1.2.2.2 导出vCenter服务器上面的虚拟机</h4>
<p>导出vCenter主机上面的虚拟机使用下面格式的命令：</p>
<pre><code class="shell"> ovftool --noSSLVerify \
   vi://USER:PASSWORD@vcenter.example.com/DATACENTER-NAME/vm/VM \
   VM.ova
</code></pre>

<p>下面是各参数的含义：</p>
<ul>
<li><code>USER</code>：登录到vCenter服务器的用户名。需要时可添加域：<code>USER@DOMAIN</code>。</li>
<li><code>PASSWORD</code>：登录到vCenter服务器的密码。</li>
<li><code>vcenter.example.com</code>：vCenter服务器的域名或IP地址。</li>
<li><code>DATACENTER-NAME</code>：虚拟机所在的数据中心名字。</li>
<li><code>vm</code>：固定参数。表示获取虚拟机。</li>
<li><code>VM</code>：vCenter服务器上面的虚拟机的相对路径。</li>
<li><code>VM.ova</code>：导出的ova文件名。</li>
</ul>
<h4 id="_2">举例说明：</h4>
<p>有一台<code>centos-esxi-1</code>的虚拟机在vCenter服务器的路径如下图所示：</p>
<p><img alt="" src="../img/vcenter-ovftool虚拟机定位界面.png" /></p>
<p>那么其导出ova命令为：</p>
<pre><code class="shell">ovftool --noSSLVerify \ 
    vi://administrator@vsphere.local:ABCDabcd.1234@172.16.2.178/Datacenter-test/vm/vms/centos-esxi-1 \
    centos-esxi-1-ovftool.ova
</code></pre>

<p><strong>注意</strong>：如果链接中存在特殊符号则需要替换为ASCII 十六进制码。比如<code>vi://administrator@vsphere.local:ABCDabcd.1234@172.16.2.178/Datacenter-test/vm/discovered vms/centos-esxi-1</code>应写为<code>vi://administrator@vsphere.local:ABCDabcd.1234@172.16.2.178/Datacenter-test/vm/discovered%20vms/centos-esxi-1</code>（空格的ASCII 十六进制码是20）。</p>
<h2 id="13-vmware-workstation">1.3 在VMware Workstation的管理界面导出</h2>
<p>在<code>VMware Workstation</code>界面选中一台<strong>关机的</strong>虚拟机，依次点击左上角的选项：<code>文件-&gt;导出为OVF</code>。</p>
<p>此时会弹出一个界面，让你选择导出文件的存储路径。选择好存储路径之后，修改文件后缀名<code>.ovf</code>为<code>.ova</code>，否则导出的是ovf文件夹。点击保存之后等待导出完成，再将ova文件拷贝或挂载到<code>转换服务器</code>中。</p>
<h1 id="2">2. 构造输入选项</h1>
<p>通过上述的方式获取到ova文件之后，就可以构造输入选项了。</p>
<p>使用ova转换虚拟机时，转换脚本的支持的输入选项有下列几个：</p>
<ul>
<li><code>--mode</code>：输入模式。此处应选 ova。</li>
<li><code>--file</code>：转换的ova文件。</li>
</ul>
<h4 id="_3">举例说明</h4>
<p>现在Windows上面共享了一个文件夹<code>ovas</code>，里面有虚拟机的ova文件，想要通过ova模式对其中的centos.ova文件进行转换。</p>
<p>直接将ova文件放到转换服务器上的<code>ovas/</code>目录下；</p>
<p>或者 通过挂载的方式将其挂载到转换服务器，在转换服务器上面执行挂载命令：</p>
<pre><code class="shell"># 安装挂载工具
yum install cifs-utils
# 挂载共享文件夹
mount.cifs //172.16.2.27/ovas ovas/ -o user=xxx,pass=xxx,sec=ntlm
</code></pre>

<p>其中<code>172.16.2.27</code>是Windows的IP地址；<code>ovas</code>是虚拟机的共享文件夹的名称；<code>ovas/</code>是转换服务器上面的一个文件夹；<code>user=xxx</code>、<code>pass=xxx</code>分别填入Windows登录的用户名和密码。挂载的方式可能会出现各种问题，自行解决一下。</p>
<p>那么输入选项的构造如下：</p>
<pre><code class="shell">--mode ova --file ovas/centos.ova
</code></pre>

<h1 id="3-ovirt">3. 转换到ovirt平台</h1>
<p>有了ova作为输入之后，就可以转换到ovirt平台了。</p>
<p>参考：<a href="../转换到ovirt平台/">转换到ovirt平台</a></p>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>