# 1. 文档的目的

本文档说明的是**虚拟机转换脚本**的使用。该脚本位于`shell/convert.sh`。

该脚本的目的是将`VMware平台及Xen虚拟化平台`的虚拟机转换到`ovirt或ACloudAge KS`平台。

# 2. 搭建转换服务器

执行转换脚本的服务器称作`转换服务器`。

在使用该脚本之前，请首先阅读[转换服务器的搭建](转换服务器的搭建.md)为脚本提供必要的运行环境，并查看本文**4.注意事项**章节。

# 3. 脚本的使用说明

脚本在命令行按以下格式执行：

```bash
convert <输入选项> <输出选项>
```

将<输入选项>与<输出选项>填入后才可执行命令。

#### 输入选项的构造

脚本支持6种输入模式，每种都有对应的如何构造输入选项的说明文档：

|  模式   |                    模式说明                    |              对应的说明文档               |
| :-----: | :--------------------------------------------: | :---------------------------------------: |
|   ova   | 利用VMware平台的虚拟机ova文件进行虚拟机转换。  |     [1.ova转换模式](1.ova转换模式.md)     |
|   vmx   | 利用VMware平台的虚拟机工作目录进行虚拟机转换。 |     [2.vmx转换模式](2.vmx转换模式.md)     |
|  ESXi   |        通过访问ESXi服务器来转换虚拟机。        |    [3.ESXi转换模式](3.ESXi转换模式.md)    |
| vCenter |  通过访问VMware vCenter服务器进行虚拟机转换。  | [4.vCenter转换模式](4.vCenter转换模式.md) |
|  vddk   |     通过VMware的开发库vddk进行虚拟机转换。     |    [5.vddk转换模式](5.vddk转换模式.md)    |
|   xen   |         从xen虚拟化平台上转换虚拟机。          |     [6.xen转换模式](6.xen转换模式.md)     |

#### 输出选项的构造

输出选项的构造则参考[转换到ovirt平台](转换到ovirt平台.md)。

你也可以执行`convert --help`查阅简单的使用说明。

#### 举例说明

转换场景：想要转换VMware Workstation上的一台虚拟机到ovirt平台。

首先通过上述的构造输入选项的参考文档`1.ova转换模式`获取了一台虚拟机的ova文件（centos.ova），并构造了输入选项：

```shell
--mode ova --file centos.ova
```

然后通过上述的构造输出选项的参考文档`转换到ovirt平台`构造了输出选项：

```shell
--export-path 172.16.2.124:/home/exports
```

此时，就可以在转换服务器上面执行命令转换虚拟机：

```shell
convert --mode ova --file centos.ova --export-path 172.16.2.124:/home/exports
```



# 4. 注意事项

- 在转换之前虚拟机必须是**关机状态**。
- 使用之前根据需要搭建VMware的服务器或xen的虚拟化服务器。
- 所有的VMware平台的Windows虚拟机在转换之前都需要先卸载`VMware-tools`。
