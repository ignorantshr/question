<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="shihr">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>9.其它派生对象 - Sink</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "9.1 \u53ef\u6267\u884c\u811a\u672c", url: "#_top", children: [
          ]},
          {title: "9.2 \u5934\u6587\u4ef6", url: "#92", children: [
          ]},
          {title: "9.3 \u67b6\u6784\u65e0\u5173\u6570\u636e\u6587\u4ef6", url: "#93", children: [
          ]},
          {title: "9.4 \u6784\u5efa\u6e90\u6587\u4ef6", url: "#94", children: [
              {title: "1.\u4f7f\u7528 BUILT_SOURCES", url: "#1-built_sources" },
              {title: "2.\u624b\u52a8\u7f16\u5199\u4f9d\u8d56", url: "#2" },
              {title: "3.\u4ece configure \u6784\u5efa \u5934\u6587\u4ef6", url: "#3-configure" },
              {title: "4.\u6784\u5efa .c \u6587\u4ef6\uff0c\u800c\u4e0d\u662f .h \u6587\u4ef6", url: "#4-c-h" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../简介/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../简介/" class="btn btn-xs btn-link">
        简介
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../8.构建程序和库/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../8.构建程序和库/" class="btn btn-xs btn-link">
        8.构建程序和库
      </a>
    </div>
    
  </div>

    

    <p>Automake还支持处理 C程序以外 的派生对象。</p>
<h2 id="91">9.1 可执行脚本</h2>
<p>完全可以定义和安装脚本类型的程序。使用<code>_SCRIPTS</code>primary。
脚本默认是不发布的，可以使用<code>dist_</code>来改变。</p>
<pre><code class="make"># Install my_script in $(bindir) and distribute it.
dist_bin_SCRIPTS = my_script
</code></pre>

<p>脚本可以安装到<code>bindir, sbindir, libexecdir, pkglibexecdir, pkgdatadir</code>。</p>
<p>无需安装的脚本列在<code>noinst_SCRIPTS</code>，在他们中，只被<code>make check</code>需要的列在<code>check_SCRIPTS</code>。</p>
<h2 id="92">9.2 头文件</h2>
<p>必须被安装的头文件通过<code>_HEADERS</code>变量实现。可以被安装到<code>includedir, oldincludedir, pkgincludedir</code>或者任何自定义的目录。例如：</p>
<pre><code>include_HEADERS = foo.h bar/bar.h
</code></pre>

<p>将安装两个文件 $(includedir)/foo.h and $(includedir)/bar.h。</p>
<p>所有的头文件必须被列在<code>_SOURCES</code>或<code>_HEADERS</code>中。</p>
<p>一定不能发布的头文件写在<code>nodist_include_HEADERS or nodist_prog_SOURCES</code>中。</p>
<h2 id="93">9.3 架构无关数据文件</h2>
<p>Automake支持杂数据文件的安装，使用<code>_DATA</code>变量。</p>
<p>可以被安装到的文件夹：<code>datadir, sysconfdir, sharedstatedir, localstatedir, or pkgdatadir</code>。</p>
<pre><code>dist_pkgdata_DATA = clean-kr.am clean.am …
</code></pre>

<h2 id="94">9.4 构建源文件</h2>
<p>自动依赖追踪依赖于编译，所以只有在第一次编译的时候才能知道其依赖关系。</p>
<p>存在的问题：如果需要构建可执行程序foo，但是却没有foo.h，比如foo.h是其它规则的对象并且该规则没有执行，那么会构建失败。</p>
<p>为了解决这一问题，可使用<code>BUILT_SOURCES</code>变量。在该变量中列出的源文件是在<code>make all or make check (or even make install)</code>时在其他目标被执行之前创建的。</p>
<h4 id="1-built_sources">1.使用 BUILT_SOURCES</h4>
<p>所以，可以使用<code>BUILT_SOURCES = foo.h</code>来确保<code>make all or make check</code>的时候，该文件在其他目标之前被构建。</p>
<h4 id="2">2.手动编写依赖</h4>
<p>如果你在上述三个make命令之前执行了其他的 make foo 命令，那么会报错。？？？不会报错啊</p>
<p>解决这个问题的替代<code>BUILT_SOURCES</code>的写法是</p>
<pre><code>foo.$(OBJEXT): bindir.h
</code></pre>

<h4 id="3-configure">3.从 configure 构建 头文件</h4>
<p>可以在config.h中定义头文件的宏（<a href="http://www.gnu.org/software/autoconf/manual/autoconf.html#Defining-Directories">see Defining Directories</a>），或者使用<code>AC_CONFIG_FILES</code>(<a href="http://www.gnu.org/software/autoconf/manual/autoconf.html#Configuration-Actions">see Configuration Actions</a>)驱动 bindir.h.in 文件。</p>
<p>如此一来，Makefile.am就能写地很简短：</p>
<pre><code>bin_PROGRAMS = foo
foo_SOURCES = foo.c
</code></pre>

<p>但是总会有不能从configure构建源文件的情况。</p>
<h4 id="4-c-h">4.构建 .c 文件，而不是 .h 文件</h4>
<pre><code>noinst_PROGRAMS = foo
foo_SOURCES = foo.c bindir.h
nodist_foo_SOURCES = bindir.c
CLEANFILES = bindir.c
bindir.c: Makefile
        echo 'const char bindir[] = &quot;$(bindir)&quot;;' &gt;$@
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../简介/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../简介/" class="btn btn-xs btn-link">
        简介
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../8.构建程序和库/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../8.构建程序和库/" class="btn btn-xs btn-link">
        8.构建程序和库
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>