



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="shihr">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.4.3">
    
    
      
        <title>简介 - Work Sink</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#automake" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Work Sink" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Work Sink
            </span>
            <span class="md-header-nav__topic">
              
                简介
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/shihr/question/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Work Sink" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Work Sink
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/shihr/question/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="1. Home" class="md-nav__link">
      1. Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      2. 虚拟机转换
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        2. 虚拟机转换
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/libguestfs/" title="libguestfs" class="md-nav__link">
      libguestfs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/%E4%BB%A5ova%E4%B8%BA%E4%BE%8Bvirt-v2v%E7%A3%81%E7%9B%98%E8%BD%AC%E6%8D%A2%E6%B5%81%E7%A8%8B/" title="以ova为例virt-v2v磁盘转换流程" class="md-nav__link">
      以ova为例virt-v2v磁盘转换流程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/virt-p2v-make-disk%E8%84%9A%E6%9C%AC%E5%88%86%E6%9E%90/" title="virt-p2v-make-disk脚本分析" class="md-nav__link">
      virt-p2v-make-disk脚本分析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/virt-p2v%E4%BB%8B%E7%BB%8D/" title="virt-p2v介绍" class="md-nav__link">
      virt-p2v介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/virt-p2v%E7%A3%81%E7%9B%98%E8%BD%AC%E6%8D%A2%E6%B5%81%E7%A8%8B/" title="virt-p2v磁盘转换流程" class="md-nav__link">
      virt-p2v磁盘转换流程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/VMware-ova%E8%BD%AC%E6%8D%A2/" title="VMware-ova转换" class="md-nav__link">
      VMware-ova转换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/VMware-vmx%E8%BD%AC%E6%8D%A2/" title="VMware-vmx转换" class="md-nav__link">
      VMware-vmx转换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/VMware-vCenter%E8%BD%AC%E6%8D%A2/" title="VMware-vCenter转换" class="md-nav__link">
      VMware-vCenter转换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/VMware-ESXI-hypervisor%E8%BD%AC%E6%8D%A2/" title="VMware-ESXI-hypervisor转换" class="md-nav__link">
      VMware-ESXI-hypervisor转换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/VMware-vddk%E8%BD%AC%E6%8D%A2/" title="VMware-vddk转换" class="md-nav__link">
      VMware-vddk转换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E6%8D%A2/Xen%E8%BD%AC%E6%8D%A2/" title="Xen转换" class="md-nav__link">
      Xen转换
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      3. Citrix
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        3. Citrix
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../citrix/00%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/" title="00技术概述" class="md-nav__link">
      00技术概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../citrix/01%E5%AE%89%E8%A3%85/" title="01安装" class="md-nav__link">
      01安装
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      4. Spice
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        4. Spice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../spice/%E7%AE%80%E4%BB%8B/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../spice/%E4%BD%BF%E7%94%A8%E8%8C%83%E4%BE%8B/" title="使用范例" class="md-nav__link">
      使用范例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../spice/%E5%87%BD%E6%95%B0%E6%89%80%E5%9C%A8%E6%96%87%E4%BB%B6/" title="函数所在文件" class="md-nav__link">
      函数所在文件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      5. Make
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        5. Make
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/%E7%AE%80%E4%BB%8B/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/4.%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99/" title="4.编写规则" class="md-nav__link">
      4.编写规则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/5.%E7%BC%96%E5%86%99recipes/" title="5.编写recipes" class="md-nav__link">
      5.编写recipes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/6.%E5%8F%98%E9%87%8F/" title="6.变量" class="md-nav__link">
      6.变量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/7.Makefile%E4%B8%AD%E7%9A%84%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/" title="7.Makefile中的条件语句" class="md-nav__link">
      7.Makefile中的条件语句
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/8.%E8%BD%AC%E6%8D%A2%E6%96%87%E6%9C%AC%E5%87%BD%E6%95%B0/" title="8.转换文本函数" class="md-nav__link">
      8.转换文本函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/10.%E4%BD%BF%E7%94%A8%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99/" title="10.使用隐含规则" class="md-nav__link">
      10.使用隐含规则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/11.%E4%BD%BF%E7%94%A8make%E6%9B%B4%E6%96%B0%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6/" title="11.使用make更新归档文件" class="md-nav__link">
      11.使用make更新归档文件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../make/16.Makefile%E7%BA%A6%E5%AE%9A/" title="16.Makefile约定" class="md-nav__link">
      16.Makefile约定
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      6. M4
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        6. M4
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m4/%E7%AE%80%E4%BB%8B/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m4/6.%E6%9D%A1%E4%BB%B6%E3%80%81%E5%BE%AA%E7%8E%AF%E3%80%81%E9%80%92%E5%BD%92/" title="6.条件、循环、递归" class="md-nav__link">
      6.条件、循环、递归
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m4/11.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E7%9A%84%E5%AE%8F/" title="11.文本处理的宏" class="md-nav__link">
      11.文本处理的宏
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      7. Bash
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        7. Bash
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bash/3.%E5%9F%BA%E6%9C%ACshell%E5%8A%9F%E8%83%BD/" title="3.基本shell功能" class="md-nav__link">
      3.基本shell功能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bash/4.shell%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4/" title="4.shell内置命令" class="md-nav__link">
      4.shell内置命令
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      8. Automake
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        8. Automake
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        简介
      </label>
    
    <a href="./" title="简介" class="md-nav__link md-nav__link--active">
      简介
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#automake" class="md-nav__link">
    Automake介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    Autotools介绍
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3 标准目录变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-vpath" class="md-nav__link">
    2.2.6 并行构建树（VPATH 构建）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    对比源码树与构建树
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    虚拟路径构建
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    一些特性
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#228" class="md-nav__link">
    2.2.8 交叉编译
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229" class="md-nav__link">
    2.2.9 重命名程序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210" class="md-nav__link">
    2.2.10 指定目的文件夹构建二进制文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211" class="md-nav__link">
    2.2.11 准备发布
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    生成构建系统
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    2.4 小程序文件解读
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configureac" class="md-nav__link">
    configure.ac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmakefileam" class="md-nav__link">
    src/Makefile.am
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefilam" class="md-nav__link">
    Makefil.am
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 基本理念
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 一般操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 严格程度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 命名格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 命令长度限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    3.6 用户保留变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 一些示例包
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5.%E5%88%9B%E5%BB%BAMakefile.in/" title="5.创建Makefile.in" class="md-nav__link">
      5.创建Makefile.in
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6.%E6%89%AB%E6%8F%8Fconfigure.ac%EF%BC%8C%E4%BD%BF%E7%94%A8aclocal/" title="6.扫描configure.ac，使用aclocal" class="md-nav__link">
      6.扫描configure.ac，使用aclocal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../7.%E6%96%87%E4%BB%B6%E5%A4%B9/" title="7.文件夹" class="md-nav__link">
      7.文件夹
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../8.%E6%9E%84%E5%BB%BA%E7%A8%8B%E5%BA%8F%E5%92%8C%E5%BA%93/" title="8.构建程序和库" class="md-nav__link">
      8.构建程序和库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../9.%E5%85%B6%E5%AE%83%E6%B4%BE%E7%94%9F%E5%AF%B9%E8%B1%A1/" title="9.其它派生对象" class="md-nav__link">
      9.其它派生对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10.%E5%85%B6%E5%AE%83GNU%E5%B7%A5%E5%85%B7/" title="10.其它GNU工具" class="md-nav__link">
      10.其它GNU工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../12.%E5%AE%89%E8%A3%85/" title="12.安装" class="md-nav__link">
      12.安装
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../13.%E6%B8%85%E7%90%86/" title="13.清理" class="md-nav__link">
      13.清理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../14.%E5%8F%91%E5%B8%83/" title="14.发布" class="md-nav__link">
      14.发布
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../15.%E6%B5%8B%E8%AF%95%E5%A5%97%E4%BB%B6%E7%9A%84%E6%94%AF%E6%8C%81/" title="15.测试套件的支持" class="md-nav__link">
      15.测试套件的支持
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../18.%E8%A7%84%E5%88%99%E6%9D%82%E9%A1%B9/" title="18.规则杂项" class="md-nav__link">
      18.规则杂项
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../19.Include/" title="19.Include" class="md-nav__link">
      19.Include
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../20.%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5/" title="20.条件语句" class="md-nav__link">
      20.条件语句
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../23.Automake%E4%B8%8D%E8%83%BD%E6%BB%A1%E8%B6%B3%E4%BD%BF%E7%94%A8%E6%97%B6/" title="23.Automake不能满足使用时" class="md-nav__link">
      23.Automake不能满足使用时
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      9. Autogen
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        9. Autogen
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../autogen/%E7%AE%80%E4%BB%8B/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      10. Autoconf
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        10. Autoconf
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/%E7%AE%80%E4%BB%8B/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6/" title="4.初始化和输出文件" class="md-nav__link">
      4.初始化和输出文件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/5.%E7%8E%B0%E6%9C%89%E6%B5%8B%E8%AF%95/" title="5.现有测试" class="md-nav__link">
      5.现有测试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/6.%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95/" title="6.编写测试" class="md-nav__link">
      6.编写测试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/7.%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C/" title="7.测试结果" class="md-nav__link">
      7.测试结果
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/8.%E4%BD%BF%E7%94%A8M4%E7%BC%96%E7%A8%8B/" title="8.使用M4编程" class="md-nav__link">
      8.使用M4编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/9.%E4%BD%BF%E7%94%A8M4sh%E7%BC%96%E7%A8%8B/" title="9.使用M4sh编程" class="md-nav__link">
      9.使用M4sh编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/10.%E7%BC%96%E5%86%99Autoconf%E5%AE%8F/" title="10.编写Autoconf宏" class="md-nav__link">
      10.编写Autoconf宏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/11.%E4%BE%BF%E6%90%BA%E5%BC%8Fshell%E7%BC%96%E7%A8%8B/" title="11.便携式shell编程" class="md-nav__link">
      11.便携式shell编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/14.%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE/" title="14.手动配置" class="md-nav__link">
      14.手动配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../autoconf/15.Site%E9%85%8D%E7%BD%AE/" title="15.Site配置" class="md-nav__link">
      15.Site配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#automake" class="md-nav__link">
    Automake介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    Autotools介绍
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    2.2.3 标准目录变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-vpath" class="md-nav__link">
    2.2.6 并行构建树（VPATH 构建）
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    对比源码树与构建树
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    虚拟路径构建
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    一些特性
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#228" class="md-nav__link">
    2.2.8 交叉编译
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229" class="md-nav__link">
    2.2.9 重命名程序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210" class="md-nav__link">
    2.2.10 指定目的文件夹构建二进制文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211" class="md-nav__link">
    2.2.11 准备发布
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    生成构建系统
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    2.4 小程序文件解读
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configureac" class="md-nav__link">
    configure.ac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcmakefileam" class="md-nav__link">
    src/Makefile.am
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefilam" class="md-nav__link">
    Makefil.am
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 基本理念
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 一般操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2 严格程度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 命名格式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 命令长度限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    3.6 用户保留变量
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 一些示例包
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shihr/question/edit/master/docs/automake/简介.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>简介</h1>
                
                <h2 id="automake">Automake介绍<a class="headerlink" href="#automake" title="Permanent link">&para;</a></h2>
<p>Automake是从Makefile.am(定义一系列make变量的文件)自动生成Makefile.in文件的工具。生成的Makefile.in符合GNU Makefile 标准。</p>
<p>因为不同的平台需要修改Makefile，所以编写<code>configure</code>脚本自动修改Makefile，再执行<code>./configure &amp;&amp; make &amp;&amp; make install</code>命令安装包，形成了GNU构建系统。</p>
<h2 id="autotools">Autotools介绍<a class="headerlink" href="#autotools" title="Permanent link">&para;</a></h2>
<p><code>Autotools</code>是为包创建GNU构建系统的工具；<code>Autoconf</code>主要关注<code>configure</code>；<code>Automake</code>主要关注<code>Makefile</code>。</p>
<p>当安装一个程序时，安装步骤有以下几步：</p>
<ul>
<li>tar -zxf xxx.tar.gz</li>
<li>cd xxx</li>
<li>./configure #检查要求的环境，生成包括Makefile（s）在内的多个文件</li>
<li>make #构建所有的文件结构，生成文件</li>
<li>make check #源码检查</li>
<li>su #切换到root用户</li>
<li>make install #复制源码文件到目的目录</li>
<li>make installcheck #安装后检查</li>
</ul>
<p><em>note</em>：</p>
<ul>
<li>make uninstall 需要在构建树下运行</li>
<li>make clean 删除make生成的文件</li>
<li>make distclean 额外删除 ./configure生成的文件</li>
<li>make dist 从源码重新创建xxx.tar.gz</li>
</ul>
<p>有一些可配置变量，可以通过<code>./configure --help</code>查看完整版
如果想配置系统默认变量，可以修改<code>/usr/local/share/config.site</code>文件中指定</p>
<h3 id="223">2.2.3 标准目录变量<a class="headerlink" href="#223" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>Directory variable  Default value
prefix              /usr/local
exec_prefix         <span class="cp">${</span><span class="n">prefix</span><span class="cp">}</span>
bindir              <span class="cp">${</span><span class="n">exec_prefix</span><span class="cp">}</span>/bin
libdir              <span class="cp">${</span><span class="n">exec_prefix</span><span class="cp">}</span>/lib
…
includedir          <span class="cp">${</span><span class="n">prefix</span><span class="cp">}</span>/include
datarootdir         <span class="cp">${</span><span class="n">prefix</span><span class="cp">}</span>/share
datadir             <span class="cp">${</span><span class="n">datarootdir</span><span class="cp">}</span>
mandir              <span class="cp">${</span><span class="n">datarootdir</span><span class="cp">}</span>/man
infodir             <span class="cp">${</span><span class="n">datarootdir</span><span class="cp">}</span>/info
docdir              <span class="cp">${</span><span class="n">datarootdir</span><span class="cp">}</span>/doc/<span class="cp">${</span><span class="n">PACKAGE</span><span class="cp">}</span>
</code></pre></div>


<p>通过<code>./configure --help</code>查看完整版。
可以在运行时改变这些目录：<code>./configure --prefix ~/usr</code>。</p>
<h3 id="226-vpath">2.2.6 并行构建树（VPATH 构建）<a class="headerlink" href="#226-vpath" title="Permanent link">&para;</a></h3>
<h4 id="_1">对比源码树与构建树<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<p><strong>源码树</strong>：包含了configure文件的所有源文件</p>
<p><strong>构建树</strong>：在源码树的基础上，包含上运行configure之后派生出来的文件。通常目录结构与源码树一致，子目录是被构建系统自动创建出来的</p>
<h5 id="_2">虚拟路径构建<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h5>
<p>可以在解压完压缩包之后在任意位置新建一个build子文件夹并在该文件夹下执行后续步骤，所有的派生文件会存放在build目录下，这样的构建叫做<code>parallel build</code>或者<code>VPATH builds</code>。</p>
<p>虚拟路径构建可以创建多个子文件夹进行构建，这样就可以使用不同的参数构建同一份源码。</p>
<h2 id="_3">一些特性<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="228">2.2.8 交叉编译<a class="headerlink" href="#228" title="Permanent link">&para;</a></h3>
<p>在指定的构建平台上编译可以在运行平台上执行的二进制文件
./configure --build指定构建平台，--host指定运行平台
<em>notes</em>：如果需要构建的包本身就是一个交叉编译器，需要使用--target参数指定架构</p>
<h3 id="229">2.2.9 重命名程序<a class="headerlink" href="#229" title="Permanent link">&para;</a></h3>
<p>可以在执行configure的时候对安装的程序重命名，比如安装<code>tar</code>变为<code>gtar</code><br>
以下三个参数可以满足该需求：</p>
<ul>
<li>--program-prefix  #给程序名字添加前缀</li>
<li>--program-suffix  #给程序名字添加后缀</li>
<li>--program-transform-name  #重命名程序</li>
</ul>
<p>eg.</p>
<div class="codehilite"><pre><span></span><code>./configure --program-prefix tea
</code></pre></div>


<h3 id="2210">2.2.10 指定目的文件夹构建二进制文件<a class="headerlink" href="#2210" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>make <span class="nv">DESTDIR</span><span class="o">=</span><span class="nv">$HOME</span>/inst install
</code></pre></div>


<p>此举会将程序安装在<code>~/inst</code>文件夹下，文件夹下包含了程序的安装结构
安装的目录结构如下所示：</p>
<p><img alt="指定文件夹安装程序" src="../img/%E5%AE%89%E8%A3%85%E5%88%B0%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E5%A4%B9.png" /></p>
<p>打包：</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> ~/inst
find . -type f -print &gt; ../files.lst
tar zcvf ~/amhello-1.0-i686.tar.gz <span class="sb">`</span>cat ../files.lst<span class="sb">`</span>
</code></pre></div>


<p>如此一来，直接解压这个压缩包，就可以直接完成amhello的安装。</p>
<h3 id="2211">2.2.11 准备发布<a class="headerlink" href="#2211" title="Permanent link">&para;</a></h3>
<p>使用<code>make distcheck</code>来保证包拥有所需要的构建步骤并且不会报错</p>
<ul>
<li>尝试完整的打包、解包、运行make、make check、make install、make installcheck、make dist</li>
<li>测试只读源码树的<code>VPATH Builds</code></li>
<li>保证make clean、make distclean、make uninstall不会遗漏任何文件</li>
<li>检查<code>DESTDIR</code>安装工作</li>
</ul>
<h2 id="_4">生成构建系统<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p><code>autoreconfig</code>是一个按照正确执行autoconf、automake和一堆其它命令的脚本，用于生成构建系统。<br>
编写configure.ac、Makefile.am、main.c、README文件，执行
<code>autoreconfig --install</code>实例化一个构建系统</p>
<div class="codehilite"><pre><span></span><code><span class="err">autoconf负责从configure.ac生成configure文件</span>
<span class="err">automake负责从Makefile.am和configure.ac生成Makefile.in文件</span>
</code></pre></div>


<p><em>note</em>：只有构建系统没有时才执行<code>autoreconfig</code>，如果修改了<code>configure.ac</code>或者<code>Makefile.am</code>，执行make时会自动重新生成相关文件。<code>configure.ac</code>的语法参考Autoconf手册。</p>
<h2 id="24">2.4 小程序文件解读<a class="headerlink" href="#24" title="Permanent link">&para;</a></h2>
<p>在<code>/usr/share/doc/automake-1.13.4</code>目录下，会有一个amhello的软件包，以它作为例子讲解：</p>
<div class="codehilite"><pre><span></span><code><span class="err">    amhello-1.0</span>
<span class="err">    ├── aclocal.m4</span>
<span class="err">    ├── config.h.in</span>
<span class="err">    ├── configure</span>
<span class="err">    ├── configure.ac</span>
<span class="err">    ├── depcomp</span>
<span class="err">    ├── install-sh</span>
<span class="err">    ├── Makefile.am</span>
<span class="err">    ├── Makefile.in</span>
<span class="err">    ├── missing</span>
<span class="err">    ├── README</span>
<span class="err">    └── src</span>
<span class="err">        ├── main.c</span>
<span class="err">        ├── Makefile.am</span>
<span class="err">        └── Makefile.in</span>
</code></pre></div>


<h3 id="configureac">configure.ac<a class="headerlink" href="#configureac" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">AC_INIT</span><span class="p">(</span><span class="o">[</span><span class="n">amhello</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">1.0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">bug-automake@gnu.org</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="n">AM_INIT_AUTOMAKE</span><span class="p">(</span><span class="o">[</span><span class="n">-Wall -Werror foreign</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="n">AC_PROG_CC</span><span class="w"></span>
<span class="n">AC_CONFIG_HEADERS</span><span class="p">(</span><span class="o">[</span><span class="n">config.h</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="n">AC_CONFIG_FILES</span><span class="p">(</span><span class="o">[</span><span class="n"></span>
<span class="n"> Makefile</span>
<span class="n"> src/Makefile</span>
<span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="n">AC_OUTPUT</span><span class="w"></span>
</code></pre></div>


<ul>
<li><code>AC_</code>开头的是autocofig的宏；<code>AM_</code>开头的是automake的宏。</li>
<li>AC_INIT 定义了包名、版本、联系地址</li>
<li>AM_INIT_AUTOMAKE 括号中的是automake的选项。-Wall -Werror 意味着关闭警告并作为错误进行报告；foreign 不要遵守GNU的规则，GNU包总是还应该有其他的文件</li>
<li>AC_PROG_CC 使configure脚本搜索C编译器然后用其名字定义变量CC，src/Makefile.in文件需要使用CC变量来构建hello</li>
<li>AC_CONFIG_HEADERS 使configure脚本创建config.h文件收集在configure.ac文件中定义的宏</li>
<li>AC_CONFIG_FILES 声明了configure文件应该从*.in模板创建的文件列表，否则不会使用Makefile.am文件</li>
<li>AC_OUTPUT 是一个关闭命令，是真正的负责生成文件（在AC_CONFIG_HEADERS和AC_CONFIG_FILES中注册的）的脚本部分</li>
</ul>
<h3 id="srcmakefileam">src/Makefile.am<a class="headerlink" href="#srcmakefileam" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="err">bin_PROGRAMS = hello</span>
<span class="err">hello_SOURCES = main.c</span>
</code></pre></div>


<p>与Makefile的语法一样。automake驱动该文件时会将整个内容复制到<code>Makefile.in</code>文件，但是会通过构建规则和其他变量对特定的变量定义做出反应。通常该文件只包含上述的变量定义列表，但也可以包含其他的变量和规则，只是automake仅仅传递他们，不对其进行处理。</p>
<ul>
<li>bin表明了安装位置</li>
<li>以<code>_PROGRAMS</code>结尾的特殊变量指定了Makefile应该构建的文件类型。Automake将这些变量称之为<code>primary</code>，其他的primary例如 _SCRIPTS， _DATA， _LIBRARIES 等等，对应不同的文件类型。</li>
<li>bin 意味着程序应该被安装到<code>${exec_prefix}/bin</code>文件夹下</li>
<li>hello_SOURCES 该声明的副作用是当执行<code>make dist</code>时main.c会成为tar包的一部分</li>
<li>因为程序需要从源文件构建，所以每个程序在一个<code>_PROGRAMS</code>变量中列出了<code>prog</code>，automake会寻找另一个名为<code>prog_SOURCES</code>的变量列出其所有的源文件。所有的源文件会被一起编译和链接。</li>
</ul>
<h3 id="makefilam">Makefil.am<a class="headerlink" href="#makefilam" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="err">SUBDIRS = src</span>
<span class="err">dist_doc_DATA = README</span>
</code></pre></div>


<ul>
<li>SUBDIRS 列出所有的在驱动当前目录之前make需要递归进入的文件夹，make install也会先安装src/hello，再安装README</li>
<li>dist_doc_DATA <code>_DATA primary</code>列出的文件列表不会自动地成为tar包的一部分，所以加上了dist前缀来达到这个目的。唯一重要的影响是此行在<code>make install</code>的时候会安装README。</li>
</ul>
<p><em>note</em>：文件中没有涉及到安装路径，请参考autocong手册中的<a href="http://www.gnu.org/software/autoconf/manual/autoconf.html#Defining-Directories">Defining Directories</a>。</p>
<h2 id="3">3. 基本理念<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 一般操作<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>Automake读取Makefile.am生成Makefile.in文件。某些在Makefile.am中定义的变量和规则指导Automake生成更加专用的代码。</p>
<p>大部分GNU make扩展不能被Automake所识别。</p>
<p>定义在Makefile.am或者configure.ac中的变量会覆盖automake的默认变量。</p>
<p>automake在检查变量定义的时候会递归检查所有引用的变量</p>
<p>注释以<code>##</code>开头</p>
<h3 id="32">3.2 严格程度<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>虽然Automake旨在供GNU包维护中使用，但是并不想遵守其全部的规定。</p>
<p>有以下三个等级：</p>
<ul>
<li>foreign - 只检查正确操作所必须的东西。</li>
<li>gnu - 会尽可能多的满足GNU标准。默认选项</li>
<li>gnits - 会检查还未成文的GNU标准，比GNU标准更细。通常不会使用该选项</li>
</ul>
<h3 id="33">3.3 命名格式<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>Automake变量遵守<code>uniform naming scheme</code>，使何时程序被构建和如何被安装变得很容易。</p>
<p>一套不同的名字用来决定构建对象应该被安装到哪里。这些名字是primary的前缀，定义了哪个标准文件夹是安装目录。标准的文件夹名字参考 <a href="http://www.gnu.org/prep/standards/standards.html#Directory-Variables">Directory Variables</a> in The GNU Coding Standards</p>
<p>每个primary都有一个额外的以<code>EXTRA_</code>作为前缀的变量名。它用于列出可能会或不会被构建的对象，取决于configure。</p>
<p>可以自定义目录，任何在Makefile.am中以<code>dir</code>结尾的自定义变量都可以用作<em>primary</em>的合法前缀：</p>
<div class="codehilite"><pre><span></span><code>    <span class="nv">xmldir</span> <span class="o">=</span> <span class="k">$(</span>datadir<span class="k">)</span>/xml
    <span class="nv">xml_DATA</span> <span class="o">=</span> file.xml
</code></pre></div>


<p>不是在每个文件夹的每个对象的每个部分都会被安装。Automake会标记这些错误。还会检查目录名的拼写错误。</p>
<p><code>noinst_</code>前缀表示变量只构建不安装。</p>
<p><code>check_</code>表明变量不能被构建直到<code>make check</code>命令运行。也不可安装。</p>
<p>所有的变量名期望 字母、数字、@、其它符号变为下划线，比如libmum++.a，派生变量会是libmum___a_SOURCES</p>
<p>超级前缀：</p>
<ul>
<li>dist #指明哪些文件应该被发布</li>
<li>nodist</li>
<li>nobase #禁止去掉路径前缀的规则，举例：</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">nobase_dist_include_HEADERS</span> <span class="o">=</span> <span class="err">\</span>

  <span class="n">jupiter</span><span class="o">/</span><span class="n">jupiter_interface</span><span class="p">.</span><span class="n">h</span>
</code></pre></div>


<p>正常情况下，该头文件会被安装到<code>/usr(/local)/include/jupiter_interface.h</code>，加了<code>nobase</code>前缀之后，会变为<code>/usr(/local)/include/jupiter/jupiter_interface.h</code>。</p>
<p><code>nobase_</code>可以使用下面的写法代替:</p>
<div class="codehilite"><pre><span></span><code><span class="n">nobase_dist_pkgdata_HEADERS</span> <span class="o">=</span> <span class="n">jupiter</span><span class="o">/</span><span class="n">jupiter</span><span class="p">.</span><span class="n">ogg</span>

<span class="n">jupiterdir</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="n">pkgdatadir</span><span class="p">)</span><span class="o">/</span><span class="n">jupiter</span>
<span class="n">dist_jupiter_DATA</span> <span class="o">=</span> <span class="n">jupiter</span><span class="o">/</span><span class="n">jupiter</span><span class="p">.</span><span class="n">ogg</span>
</code></pre></div>


<p>EXTRA_DIST变量应该被加到发布包的文件或文件夹。</p>
<h3 id="34">3.4 命令长度限制<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>例如</p>
<div class="codehilite"><pre><span></span><code>    <span class="nv">data_DATA</span> <span class="o">=</span> file1 … fileN fileN+1 … file2N
</code></pre></div>


<p>可以写成</p>
<div class="codehilite"><pre><span></span><code>    <span class="nv">data_DATA</span> <span class="o">=</span> file1 … fileN
    <span class="nv">data2dir</span> <span class="o">=</span> <span class="k">$(</span>datadir<span class="k">)</span>
    <span class="nv">data2_DATA</span> <span class="o">=</span> fileN+1 … file2N
</code></pre></div>


<h3 id="36">3.6 用户保留变量<a class="headerlink" href="#36" title="Permanent link">&para;</a></h3>
<p>一些保留变量为构建包的用户使用，让他们的工作更轻松。但是这些变量不能出现在要求正确编译的包中。</p>
<p>Automake引入了特殊的阴影便量为用户标记变量。添加前缀<code>AM_</code>到用户变量名就是阴影变量。</p>
<h2 id="4">4. 一些示例包<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<ul>
<li>使用不同的编译参数从一个文件构建两个项目。通过设定不同的变量名及其标志指向同一个文件俩达到效果</li>
</ul>
<div class="codehilite"><pre><span></span><code>    <span class="nv">bin_PROGRAMS</span> <span class="o">=</span> <span class="nb">true</span> <span class="nb">false</span>
    <span class="nv">false_SOURCES</span> <span class="o">=</span>
    <span class="nv">false_LDADD</span> <span class="o">=</span> false.o

    true.o: true.c
            <span class="k">$(</span>COMPILE<span class="k">)</span> -DEXIT_CODE<span class="o">=</span><span class="m">0</span> -c true.c

    false.o: true.c
            <span class="k">$(</span>COMPILE<span class="k">)</span> -DEXIT_CODE<span class="o">=</span><span class="m">1</span> -o false.o -c true.c
</code></pre></div>


<p>true_SOURCES没有写，Automake会默认有一个true.c文件和默认的规则来编译true.o、链接true。<a href="http://www.gnu.org/software/automake/manual/automake.html#Default-_005fSOURCES">see Default _SOURCES</a></p>
<div class="codehilite"><pre><span></span><code>    <span class="nv">bin_PROGRAMS</span> <span class="o">=</span> <span class="nb">false</span> <span class="nb">true</span>

    <span class="nv">false_SOURCES</span> <span class="o">=</span> true.c
    <span class="nv">false_CPPFLAGS</span> <span class="o">=</span> -DEXIT_CODE<span class="o">=</span><span class="m">1</span>

    <span class="nv">true_SOURCES</span> <span class="o">=</span> true.c
    <span class="nv">true_CPPFLAGS</span> <span class="o">=</span> -DEXIT_CODE<span class="o">=</span><span class="m">0</span>
</code></pre></div>


<p>该种写法会生成 false-true.o and true-true.o</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../bash/4.shell%E5%86%85%E7%BD%AE%E5%91%BD%E4%BB%A4/" title="4.shell内置命令" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                4.shell内置命令
              </span>
            </div>
          </a>
        
        
          <a href="../5.%E5%88%9B%E5%BB%BAMakefile.in/" title="5.创建Makefile.in" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                5.创建Makefile.in
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>